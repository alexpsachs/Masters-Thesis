{
    "emqplus": "add emqtt_keep_alive module:\n-module(emqtt_keep_alive).\n-export([new/2,\n        state/1,\n        activate/1,\n        reset/1,\n        cancel/1]).\n-record(keep_alive, {state, period, timer, msg}).\nnew(undefined, ) -> \n    undefined;\nnew(0, ) -> \n    undefined;\nnew(Period, TimeoutMsg) when is_integer(Period) ->\n    Ref = erlang:send_after(Period, self(), TimeoutMsg),\n    #keep_alive{state=idle, period=Period, timer=Ref, msg=TimeoutMsg}.\nstate(undefined) -> \n    undefined;\nstate(#keep_alive{state=State}) ->\n    State.\nactivate(undefined) -> \n    undefined; \nactivate(KeepAlive) when is_record(KeepAlive, keep_alive) -> \n    KeepAlive#keep_alive{state=ative}.\nreset(undefined) ->\n    undefined;\nreset(KeepAlive=#keep_alive{period=Period, timer=Timer, msg=Msg}) ->\n    catch erlang:cancel_timer(Timer),\n    Ref = erlang:send_after(Period, self(), Msg),\n    KeepAlive#keep_alive{state=idle, timer = Ref}.\ncancel(undefined) -> \n    undefined;\ncancel(KeepAlive=#keep_alive{timer=Timer}) -> \n    catch erlang:cancel_timer(Timer),\n    KeepAlive#keep_alive{timer=undefined}.\n. simple support for qos_2.\nNOTE: message is stored in memory, discarded when broker stopped.\n. # modified:   src/emqtt_client.erl\nmodified:   src/emqtt_router.erl\nmodified:   src/emqtt_sup.erl\n\n(use \"git add ...\" to include in what will be committed)\n\nsrc/emqtt_retained.erl\n. emqtt 0.2.1 support simple cluster by mnesia database copy.\n. fixed\n. support.\n. except \"Do not include the null character (Unicode \\x0000) in any topic.\"\n. add emqtt_will.erl to handle will msg\n. merge nextalk's startup code \n. fixed.\n. fixed, caused by 'mqttc' client, qos protect:\nvalidate_frame(?SUBSCRIBE, #mqtt_frame{variable = #mqtt_frame_subscribe{topic_t\n-       ErrTopics = [Topic || #mqtt_topic{name=Topic} <- Topics,\n-                                               not emqtt_topic:validate({subscr\n-       ErrTopics = [Topic || #mqtt_topic{name=Topic, qos=Qos} <- Topics,\n-                                               not (emqtt_topic:validate({subsc\n      case ErrTopics of\n      [] -> ok;\n      _ -> ?ERROR(\"error topics: ~p\", [ErrTopics]), {error, badtopic}\n  :\n. multiple directories contains lager, install lager before?\n\u5728 2013-1-25\uff0c\u4e0b\u53482:56\uff0cMichael notifications@github.com \u5199\u9053\uff1a\n\nThis is the error:\n$ cd emqtt \n$ make generate \n./rebar generate -f\n==> rel (generate)\nERROR: generate failed while processing /home/michael/repos/erlang/emqtt/rel: {'EXIT',{{badmatch,{error,\"lager: Application version clash. Multiple directories contains version \\\"2.0.0\\\".\"}},\n[{rebar_reltool,generate,2,\n[{file,\"src/rebar_reltool.erl\"},{line,50}]},\n{rebar_core,run_modules,4,[{file,\"src/rebar_core.erl\"},{line,405}]},\n{rebar_core,execute,5,[{file,\"src/rebar_core.erl\"},{line,334}]},\n{rebar_core,process_dir1,6,[{file,\"src/rebar_core.erl\"},{line,197}]},\n{rebar_core,process_each,5,[{file,\"src/rebar_core.erl\"},{line,268}]},\n{rebar_core,process_dir1,6,[{file,\"src/rebar_core.erl\"},{line,173}]},\n{rebar_core,process_commands,2,\n[{file,\"src/rebar_core.erl\"},{line,61}]},\n{rebar,main,1,[{file,\"src/rebar.erl\"},{line,58}]}]}}\nmake: *** [generate] \u9519\u8bef 1\n\u2014\nReply to this email directly or view it on GitHub.\n. \u6ca1\u6709\uff0c\u4f60\u5230lib\u76ee\u5f55\u770b\u4e0b\u3002\n\n\u5728 2013-1-30\uff0c\u4e0a\u534811:01\uff0cMichael notifications@github.com \u5199\u9053\uff1a\n\nlager \u662f\u81ea\u52a8\u4e0b\u8f7d\u5230lib\u76ee\u5f55\u7684, \u8fd9\u6837\u5b50\u6709\u95ee\u9898\u7801\uff1f\n\u2014\nReply to this email directly or view it on GitHub.\n. \u4f60\u4e4b\u524d\u662f\u5426\u5b89\u88c5\u8fc7lager? \u68c0\u67e5\u4e0berlang\u81ea\u5e26\u5e93\u8def\u5f84\u4f8b\u5982/usr/local/lib/erlang/lib/\uff0c\u7b2c\u4e09\u65b9\u5e93\u6700\u597d\u4e0d\u8981\u88c5\u5728erlang\u4e0b\u3002\n. code:lib_dir(). to check erlang lib.\n. \u8fd8\u6709\u4e00\u79cd\u53ef\u80fd\u662f\uff0c\u4f60emqtt\u4e0a\u5c42\u76ee\u5f55\u4e0b\u6709\u4e00\u4efdlager\uff0c\u4f8b\u5982\u76ee\u5f55\u7ed3\u6784:\n\nDIR/lager\nDIR/emqtt\nrebar\u7f16\u8bd1\u751f\u6210release\u7684\u65f6\u5019\uff0c\u4f1a\u5728emqtt\u4e0a\u5c42\u76ee\u5f55\u53bb\u627e\u5e93\u7684\uff0c\u5c31\u591a\u4e86\u4e00\u4efdlager\u3002\n\u5728 2013-1-31\uff0c\u4e0a\u534811:32\uff0cMichael notifications@github.com \u5199\u9053\uff1a\n\n1> code:lib_dir().\n\"/usr/local/lib/erlang/lib\"\n\u8fd9\u4e2a\u662f\u6211\u7684lib\u8def\u5f84\uff0c\u8be5\u8def\u5f84\u4e0b\u9762\u6ca1\u6709lager. \u4f3c\u4e4e\u4e0d\u662f\u4f60\u8bf4\u7684\u539f\u56e0\u3002\n\u2014\nReply to this email directly or view it on GitHub.\n. \u68c0\u67e5emqtt\u7236\u76ee\u5f55\u4e86\uff1f\u5e94\u8be5\u6709\u4efdlager\u3002\n. \u6b22\u8fce\uff0c\u521a\u9080\u8bf7\u4f60\u5e10\u6237\u4e86\u3002\n\n\u5728 2013-1-31\uff0c\u4e0b\u53483:16\uff0cMichael notifications@github.com \u5199\u9053\uff1a\n\n\u5bf9\uff0c\u8ddfemqtt\u5e73\u7ea7\u7684\u6709\u4e00\u4e2alager\uff0crebar\u5bb3\u7684\u3002\u9700\u8981\u5f00\u53d1\u3001\u6d4b\u8bd5\u5417\uff1f\u6211\u5bf9\u8fd9\u4e2a\u9879\u76ee\u5f88\u6709\u5174\u8da3\n\u2014\nReply to this email directly or view it on GitHub.\n. cd /Users/nodephp/ && mv emqtt-master emqtt\n\n\u5728 2013-5-31\uff0c\u4e0a\u53489:49\uff0cnodephp notifications@github.com \u5199\u9053\uff1a\n\n./rebar generate -f\n==> rel (generate)\nERROR: generate failed while processing /Users/nodephp/emqtt-master/rel: {'EXIT',{{badmatch,{error,\"emqtt: : Missing application directory.\"}},\n[{rebar_reltool,generate,2,\n[{file,\"src/rebar_reltool.erl\"},{line,50}]},\n{rebar_core,run_modules,4,[{file,\"src/rebar_core.erl\"},{line,405}]},\n{rebar_core,execute,5,[{file,\"src/rebar_core.erl\"},{line,334}]},\n{rebar_core,process_dir1,6,[{file,\"src/rebar_core.erl\"},{line,197}]},\n{rebar_core,process_each,5,[{file,\"src/rebar_core.erl\"},{line,268}]},\n{rebar_core,process_dir1,6,[{file,\"src/rebar_core.erl\"},{line,173}]},\n{rebar_core,process_commands,2,\n[{file,\"src/rebar_core.erl\"},{line,61}]},\n{rebar,main,1,[{file,\"src/rebar.erl\"},{line,58}]}]}}\nmake: *** [generate] Error 1\n\u2014\nReply to this email directly or view it on GitHub.\n. remove emqtt_router.erl, use emqtt_pubsub to monitor all subscribers\n. emqtt don't need gold rush, did u modify rel/reltool.config by yourself?\n\n\u5728 2013-7-6\uff0c\u4e0a\u534812:09\uff0c\u5f20\u632f\u6c5f notifications@github.com \u5199\u9053\uff1a\n\n[root@ailk3 emqtt]# make generate\n./rebar generate -f\n==> rel (generate)\nERROR: generate failed while processing /opt/emqtt/rel: {'EXIT',{{badmatch,{error,\"Application goldrush is used in release \\\"emqtt\\\" and cannot be excluded\"}},\n[{rebar_reltool,generate,2,\n[{file,\"src/rebar_reltool.erl\"},{line,50}]},\n{rebar_core,run_modules,4,[{file,\"src/rebar_core.erl\"},{line,405}]},\n{rebar_core,execute,5,[{file,\"src/rebar_core.erl\"},{line,334}]},\n{rebar_core,process_dir1,6,[{file,\"src/rebar_core.erl\"},{line,197}]},\n{rebar_core,process_each,5,[{file,\"src/rebar_core.erl\"},{line,268}]},\n{rebar_core,process_dir1,6,[{file,\"src/rebar_core.erl\"},{line,173}]},\n{rebar_core,process_commands,2,\n[{file,\"src/rebar_core.erl\"},{line,61}]},\n{rebar,main,1,[{file,\"src/rebar.erl\"},{line,58}]}]}}\nmake: *** [generate] \u9519\u8bef 1\n\u2014\nReply to this email directly or view it on GitHub.\n. Ok, I will test with R16B01\n\n\u5728 2013-7-16\uff0c\u4e0a\u534811:29\uff0c\u5f20\u632f\u6c5f notifications@github.com \u5199\u9053\uff1a\n\ngold rush need by lager\n[root@ailk3 lager]# cat rebar.config \n{erl_opts, [debug_info]}.\n{erl_first_files, [\"src/lager_util.erl\"]}.\n{deps, [\n{goldrush, \".*\",\n{git, \"git://github.com/DeadZen/goldrush.git\", {tag, \"879c69874a\"}}}\n]}.\n{cover_enabled, true}.\n{edoc_opts, [{stylesheet_file, \"./priv/edoc.css\"}]}.\n\u2014\nReply to this email directly or view it on GitHub.\n. fixed, this issue is caused by lager upgrade. add 'goldrush' application in rel/reltool.config.\n. shutdown when duplicate clientid found.\n\ndiff --git a/src/emqtt_client.erl b/src/emqtt_client.erl\nindex e05c438..94b005a 100644\n--- a/src/emqtt_client.erl\n+++ b/src/emqtt_client.erl\n@@ -67,6 +67,10 @@ info(Pid) ->\n init([]) ->\n     {ok, undefined, hibernate, {backoff, 1000, 1000, 10000}}.\n+handle_call(duplicate_id, _From, State=#state{conn_name=ConnName, client_id=ClientId}) ->\n-       ?ERROR(\"Shutdown for duplicate clientid:~s, conn:~s\", [ClientId, ConnName]), \n- stop({shutdown, duplicate_id}, State);\n+\n  handle_call(info, _From, #state{conn_name=ConnName, \n        message_id=MsgId, client_id=ClientId} = State) ->\n        Info = [{conn_name, ConnName},\n  @@ -418,7 +422,6 @@ control_throttle(State = #state{ connection_state = Flow,\n   end.\n## stop(Reason, State ) ->\n{stop, Reason, State}.\n. what\u2019s the matter?\n\u5728 2013\u5e7411\u670815\u65e5\uff0c\u4e0a\u53481:48\uff0cMarc Worrell notifications@github.com \u5199\u9053\uff1a\n\nI am changing some things in the ACL connection, which turned out to be a bad fit.\nWill redo this pull request in the coming days.\n\u2014\nReply to this email directly or view it on GitHub.\n. marc, thanks. merge you pull request later.\n\n\u5728 2013\u5e7411\u670815\u65e5\uff0c\u4e0b\u53483:47\uff0cMarc Worrell notifications@github.com \u5199\u9053\uff1a\n\nI am connecting to emqtt to zotonic and after some more testing I found problems with the mapping of topic trees between sites. This is now fixed and being tested.\nI also made the way the acl is configured more similar to the way auth can be configured, less confusion.\n\u2014\nReply to this email directly or view it on GitHub.\n. development or test, not prod, thinks\n\n\u5728 2014\u5e742\u670813\u65e5\uff0c\u4e0a\u53481:39\uff0crefugeio notifications@github.com \u5199\u9053\uff1a\n\nWhat's the stays of eqmtt? Is this usable in prod?\n\u2014\nReply to this email directly or view it on GitHub.\n. Joshua,\n\nplease check your elrang environment:\nrun 'crypto:start().\u2019 under erl console\n\u5728 2014\u5e747\u67085\u65e5\uff0c\u4e0a\u53489:36\uff0cJoshua Napoli notifications@github.com \u5199\u9053\uff1a\n\nI wasn't able to build emqtt using R16B02.\necho:emqtt joshuanapoli$ make\n./rebar get-deps\nUncaught error in rebar_core: {'EXIT',\n                               {undef,\n                                [{crypto,start,[],[]},\n                                 {rebar,run_aux,2,\n                                  [{file,\"src/rebar.erl\"},{line,143}]},\n                                 {rebar,main,1,\n                                  [{file,\"src/rebar.erl\"},{line,58}]},\n                                 {escript,run,2,\n                                  [{file,\"escript.erl\"},{line,747}]},\n                                 {escript,start,1,\n                                  [{file,\"escript.erl\"},{line,277}]},\n                                 {init,start_it,1,[]},\n                                 {init,start_em,1,[]}]}}\nmake: *** [deps] Error 1\n\u2014\nReply to this email directly or view it on GitHub.\n. yes, please compile emqtt under erlang R16. Erlang R17 has compatible issues.\n\n\u5728 2014\u5e747\u67087\u65e5\uff0c\u4e0a\u53488:55\uff0cJoshua Napoli notifications@github.com \u5199\u9053\uff1a\n\nThanks, I originally had a problem with a bad build of Erlang (from Homebrew on OSX). I figured that out but ran into another problem:\n==> goldrush (compile)\nERROR: Cannot parse OTP Release version string: 17\nProbably because version strings seemed to have changed format with the release of Erlang/OTP 17.\n\u2014\nReply to this email directly or view it on GitHub.\n. fixed\n. emqtt_keepalive module has been rewritten in 0.2.2\n. eMQTT v0.3.0 Release passed org.eclipse.paho.mqtt.testing/interoperability tests, is full MQTT V3.1.1 support now. \n. ClientId B4B5F086-A2A2-47FC-8FDB-EF113B1D3D10 is longer than 23,  will be fixed in 0.2.1 this weekend. \n. temporary fix: https://github.com/emqtt/emqtt/commit/4a2b586ff9d544b3cb85fca0df6a36bd104da8ed\n. hi, desoulter,\n\nI rewrite emqtt_topic.erl accoding to your fix. Now we use '', '#', '+' to replace <<>>, <<\"#\">>, <<\"+\">>. \nok? pls checkt it.\n. desoulter, thanks for your fix:) I will add more features these days.\n. done\n. done\n. send will message when client keepalive timeout\n. RECV from mosqpub/9752-iMac.local@127.0.0.1:55767: CONNECT(Qos=0, Retain=false, Dup=false, ClientId=mosqpub/9752-iMac.local, ProtoName=MQIsdp, ProtoVsn=3, CleanSess=true, KeepAlive=60, Username=test, Password=**, Will(Qos=1, Retain=false, Topic=/will, Msg=willmsg))\n. RECV from mosqpub/9752-iMac.local@127.0.0.1:55767: CONNECT(Qos=0, Retain=false, Dup=false, ClientId=mosqpub/9752-iMac.local, ProtoName=MQIsdp, ProtoVsn=3, CleanSess=true, KeepAlive=60, Username=test, Password=****, Will(Qos=1, Retain=false, Topic=/will, Msg=willmsg))\n. when null clientId received, emqtt will use socket peername base64 to generate one.\ncode below:\nclientid(<<>>, #proto_state{peer_name = PeerName}) ->\n    <<\"eMQTT/\", (base64:encode(PeerName))/binary>>;\n. --- a/apps/emqtt/src/emqtt_protocol.erl\n+++ b/apps/emqtt/src/emqtt_protocol.erl\n@@ -230,9 +230,14 @@ make_packet(Type) when Type >= ?CONNECT andalso Type =< ?DISCONNECT ->\n     #mqtt_packet{ header = #mqtt_packet_header { type = Type } }.\nmake_packet(PubAck, PacketId) when PubAck >= ?PUBACK andalso PubAck =< ?PUBCOMP ->\n-  #mqtt_packet { header = #mqtt_packet_header { type = PubAck},\n-  #mqtt_packet { header = #mqtt_packet_header { type = PubAck, qos = puback_qos(PubAck) },\n                variable = #mqtt_packet_puback { packet_id = PacketId}}.\n+puback_qos(?PUBACK) ->  ?QOS_0;\n+puback_qos(?PUBREC) ->  ?QOS_0;\n+puback_qos(?PUBREL) ->  ?QOS_1;\n+puback_qos(?PUBCOMP) -> ?QOS_0;\n. ## emqtt1@127.0.0.1\nemqtt/etc/vm.args\n-name emqtt1@127.0.0.1\n-setcookie emqtt\nemqtt/etc/app.config\n{listen, [\n        {mqtt, 1883, [\n            {max_conns, 1024},\n            {acceptor_pool, 4}\n        ]},\n        {http, 8083, [\n            {max_conns, 512},\n            {acceptor_pool, 1}\n        ]}\n    ]}\nemqtt2@127.0.0.1\nemqtt/etc/vm.args\n-name emqtt2@127.0.0.1\n-setcookie emqtt\nemqtt/etc/app.config\n{listen, [\n        {mqtt, 2883, [\n            {max_conns, 1024},\n            {acceptor_pool, 4}\n        ]},\n        {http, 8283, [\n            {max_conns, 512},\n            {acceptor_pool, 1}\n        ]}\n    ]}\n. run './bin/emqtt_ctl cluster emqtt1@127.0.0.1' under emqtt2\nor\nrun './bin/emqtt_ctl cluster emqtt2@127.0.0.1' under emqtt1\n. done\n. fixed.\n. Qos2 sub: mosquitto_sub -t a/b -q 2 -d \nClient mosqsub/21004-iMac.loca sending CONNECT\nClient mosqsub/21004-iMac.loca received CONNACK\nClient mosqsub/21004-iMac.loca sending SUBSCRIBE (Mid: 1, Topic: a/b, QoS: 2)\nClient mosqsub/21004-iMac.loca received SUBACK\nSubscribed (mid: 1): 2\nQos2 pub: mosquitto_pub -t a/b -m Qos2 -q 2 -d\nClient mosqpub/21003-iMac.loca sending CONNECT\nClient mosqpub/21003-iMac.loca received CONNACK\nClient mosqpub/21003-iMac.loca sending PUBLISH (d0, q2, r0, m1, 'a/b', ... (4 bytes))\nClient mosqpub/21003-iMac.loca received PUBREC (Mid: 1)\nClient mosqpub/21003-iMac.loca sending PUBREL (Mid: 1)\nClient mosqpub/21003-iMac.loca received PUBCOMP (Mid: 1)\nClient mosqpub/21003-iMac.loca sending DISCONNECT\n. emqtt_pubsub to remove old subscription when different Qos\n. MQTT Over WebSocket supported in 0.7.0\nadd/update modules:\napp/emqttd/src/emqttd_http.erl\napp/emqttd/src/emqttd_ws_client.erl\n. fixed. org.eclipse.paho.mqtt.testing: Redelivery on reconnect test passed.\n. fixed by https://github.com/emqtt/emqtt/commit/e31068787b4ba5810f78f082f119122b9301a656\n. add emqtt_server module to support retained messages.\n. emqtt_http.erl to support 'qos', 'retain' parameters.\n. dupliated with issue #50\n. Bridge Design: https://github.com/emqtt/emqtt/wiki/Bridge-Design\nImplemented in 0.5.0\n. Support authentication, ACL in 0.6.0 release. Add modules:\nemqttd_access_control.erl\nemqttd_access_rule.erl\nemqttd_acl_internal.erl\nemqttd_acl_mod.erl\nemqttd_auth_anonymous.erl\nemqttd_auth_clientid.erl\nemqttd_auth_mod.erl\nemqttd_auth_username.erl\n. upgrade deps/esockd to 0.2.0 to support ssl socket.\netc/app.config:\n{'mqtts', 8883, [\n            {max_clients, 1024},\n            {acceptor_pool, 4},\n            %{cacertfile, \"etc/ssl/cacert.pem\"},\n            {ssl, [{certfile, \"etc/ssl.crt\"},\n                   {keyfile,  \"etc/ssl.key\"}]}\n        ]},\n. @Ethanjfobrien, WebSocket should have 'Sec-WebSocket-Protocol' Header with value that start with 'mqtt'.\n. I use mqtt.js too:)\n\n\u5728 2015\u5e746\u670819\u65e5\uff0c\u4e0b\u53486:40\uff0cEthan notifications@github.com \u5199\u9053\uff1a\nThanks very much,\nI got it working using mqtt.js:\nmqtt pub -t 'hello' -l 'ws' -h 'localhost' -p '' -m 'hello' -v\nwscat doesn't support the mqtt socket protocol\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/48#issuecomment-113468002.\n. duplicated with issue #105. A simple plugin mechanism is supported in 0.7.0\n. 0.4.0 support $SYS Topics in Wiki $SYS Topics\n. handle_info({'DOWN', MRef, process, DownPid, Reason}, State) ->\n-       ets:match_delete(emqtt_client, {{'', DownPid, MRef}}),\n-       ets:match_delete(?TABLE, {{'_', DownPid, MRef}}),\n. @kansifang, do you subscribe the same topic with same Qos? \n\nFor example, if you subscribe with same Qos:\n{ok, C} = emqttc:start_link().\nemqttc:subscribe(C, <<\"t\">>, 1).\nemqttc:subscribe(C, <<\"t\">>, 1).\nclient should receive only one message.\n. @huangdan please check the issue\n. MQTT V3.1.1 [MQTT-3.8.4-3]:\nIf a Server receives a SUBSCRIBE Packet containing a Topic Filter that is identical to an existing Subscription\u2019s Topic Filter then it MUST completely replace that existing Subscription with a new Subscription. The Topic Filter in the new Subscription will be identical to that in the previous Subscription, although its maximum QoS value could be different. Any existing retained messages matching the Topic Filter MUST be re-sent, but the flow of publications MUST NOT be interrupted [MQTT-3.8.4-3].\n. @kansifang, @sailingchen, this issue is fixed in 0.8.5. The broker will remove the overlapping subscriptions with different QoS.\n. pending, cannot reoccur this issue...\n. * Reason for termination ==\n* {function_clause,\n       [{prim_inet,getstat,\n            [{ssl_socket,#Port<0.2811>,\n                 {sslsocket,\n                     {gen_tcp,#Port<0.2811>,tls_connection,undefined},\n                     <0.183.0>}},\n             [recv_oct]],\n            []},\n        {emqtt_keepalive,new,3,[{file,\"src/emqtt_keepalive.erl\"},{line,35}]},\n        {emqtt_client,handle_info,2,\n            [{file,\"src/emqtt_client.erl\"},{line,127}]},\n        {gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,593}]},\n        {gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,659}]},\n        {proc_lib,wake_up,3,[{file,\"proc_lib.erl\"},{line,247}]}]}\n. merged files:\nemqtt_parser.erl\nemqtt_serialiser.erl\nemqtt_protocol.erl\nemqtt_packet.hrl\n. etc/app.config support:\n{packet, [\n    {max_clientid_len, 1024},\n    {max_packet_size, 16#ffff}\n]},\n. add emqtt_opts:merge/2\n. emqtt_serialiser.erl:\nserialise_variable(?PINGRESP, undefined, undefined) ->\n        {<<>>, <<>>};\n. support all these $SYS Topics\n. Support topics:\nmessages/received\nmessages/sent\nmessages/retained/count\nmessages/dropped\nNot Support yet:\nmessages/dropped\n. Usage: emqttd_ctl\n        status                         #query emqttd status\n        listeners                      #query emqttd listeners\n        broker [stats | metrics]       #query broker stats/metrics\n        cluster []               #query or cluster nodes\n        bridges                        #querey bridges\n        start_bridge      #start bridge\n        stop_bridge       #stop bridge\n        useradd    #add user\n        userdel              #delete user\n. add emqttd_mnesia:wait/0 to wait for topic, topic_trie, topic_trie_node tables...\n. emqttd_bridge will monitor down node. rm emqttd_nodes_monitor.\n. 0 will not tick:\ntick(0, State) ->\n    State;\ntick(Delay, State) ->\n    State#state{tick_timer = erlang:send_after(Delay * 1000, self(), tick)}.\n. bullshit bug...\n-- a/apps/emqttd/src/emqttd_topic.erl\n+++ b/apps/emqttd/src/emqttd_topic.erl\n@@ -169,8 +169,8 @@ triples([W|Words], Parent, Acc) ->\n     Node = join(Parent, W),\n     triples(Words, Node, [{Parent, W, Node}|Acc]).\n-join(root, W) ->\n-    W;\n  +join(root, W) ->\n-    bin(W);\n  join(Parent, W) ->\n     <<(bin(Parent))/binary, $/, (bin(W))/binary>>.\n. Two issues:\n1. The topic should be '$SYS/brokers/+/clients/+/connected', \u2018borkers' in wiki is a spelling error.\n2. mosquito_pub/sub will generate a random clientId that contains '/', for example:\nmosqpub/88741-iMac.loca\nThen \"clients/+/connected\" cannot match the presence topics, have to use '$SYS/brokers/+/clients/#'\n. Example:\niMac:~ feng$ mosquitto_sub -t '$SYS/brokers/+/clients/#' -d\nClient mosqsub/88740-iMac.loca sending CONNECT\nClient mosqsub/88740-iMac.loca received CONNACK\nClient mosqsub/88740-iMac.loca sending SUBSCRIBE (Mid: 1, Topic: $SYS/brokers/+/clients/#, QoS: 0)\nClient mosqsub/88740-iMac.loca received SUBACK\nSubscribed (mid: 1): 0\nClient mosqsub/88740-iMac.loca received PUBLISH (d0, q0, r0, m0, '$SYS/brokers/emqttd@127.0.0.1/clients/mosqpub/88741-iMac.loca/connected', ... (105 bytes))\n{\"username\":\"undefined\",\"ipaddress\":\"127.0.0.1\",\"session\":false,\"protocol\":3,\"connack\":0,\"ts\":1433243924}\nClient mosqsub/88740-iMac.loca received PUBLISH (d0, q0, r0, m0, '$SYS/brokers/emqttd@127.0.0.1/clients/mosqpub/88741-iMac.loca/disconnected', ... (35 bytes))\n{\"reason\":\"normal\",\"ts\":1433243924}\n. The messages published to $SYS/# will not match topic filters: #, +/#...\n. done, thx.\nnotice that 'plugins' command still not work, will be supported in 0.6.x\n. use 'ets:insert_new/2' first.\n%%------------------------------------------------------------------------------\n%% @doc Register clientId with pid.\n%% @end\n%%------------------------------------------------------------------------------\n-spec register(ClientId :: binary()) -> ok.\nregister(ClientId) when is_binary(ClientId) ->\n    Pid = self(),\n    %% this is atomic\n    case ets:insert_new(?CLIENT_TABLE, {ClientId, Pid, undefined}) of\n        true -> gen_server:cast(?SERVER, {monitor, ClientId, Pid});\n        false -> gen_server:cast(?SERVER, {register, ClientId, Pid})\n    end.\n. Now could support 2K+/sec\n. duplicated with issue #72 \n. emqttd_cm.erl:\nhandle_info({'DOWN', MRef, process, DownPid, Reason}, State) ->\n-       ets:match_delete(?CLIENT_TAB, {{'', DownPid, MRef}}),\n-       ets:match_delete(?CLIENT_TAB, {'_', DownPid, MRef}),\n   {noreply, setstats(State)};\nemqttd_sm.erl:\n--- a/apps/emqttd/src/emqttd_sm.erl\n+++ b/apps/emqttd/src/emqttd_sm.erl\n@@ -142,7 +142,7 @@ handle_cast(_Msg, State) ->\n     {noreply, State}.\nhandle_info({'DOWN', MRef, process, DownPid, Reason}, State) ->\n-       ets:match_delete(?SESSION_TAB, {{'', DownPid, MRef}}),\n- ets:match_delete(?SESSION_TAB, {'_', DownPid, MRef}),\n{noreply, setstats(State)};\n. hi, Martin, \nI will try Elixir after 1.0 release with all required features. For I have written Erlang program for about ten years, I really love erlang syntax:) \nElixir looks like borrowing syntax from languages like ruby, I don't like Ruby:(\n. yes, I did it: https://github.com/emqtt/emqttd/wiki/ACL-Design\nACL Pattern: allow | deny Who subscribe | publish Topic\nExamples:\nallow {ipaddr, \"127.0.0.1\"} subscribe \"$SYS/#\"\nallow {clientid, \"clientid\"} subscribe  \"#\"\nHow about this design?\n. Topic filters in ACL rule support 'eq' tag now\nFor example:\n{deny, all, subscribe, [{eq, \"$SYS/#\"}, {eq, \"#\"}]}.\nMeans all cannot subscribe \"$SYS/#\", \"#\". but:\n{deny, all, subscribe, [\"$SYS/#\", \"#\"]}.\nMeans that cannot subscribe any topics.\n. hi, chen,\nPlease check ACL Design in 0.6.1: https://github.com/emqtt/emqttd/wiki/ACL-Design\n. Fix.  Dialyzer will be used to check in 0.7\nemqttd1.x will adopt the architecture that copy Topic Tree in all clustered nodes. \n2.x will slice and distribute subtree.\n. Makefile add build_plt, dialyzer targets.\n```\nPLT  = $(BASE_DIR)/.emqttd_dialyzer.plt\nAPPS = erts kernel stdlib sasl crypto ssl os_mon syntax_tools \\\n       public_key mnesia inets compiler\ncheck_plt: compile\n    dialyzer --check_plt --plt $(PLT) --apps $(APPS) \\\n        deps//ebin apps//ebin\nbuild_plt: compile\n    dialyzer --build_plt --output_plt $(PLT) --apps $(APPS) \\\n        deps//ebin apps//ebin\ndialyzer: compile\n    dialyzer -Wno_return --plt $(PLT) deps//ebin apps//ebin\n```\n. 1. add emqttd_auth_clientid.erl module\n2. add etc/clients.config\n. 1. rename 'mqtt_retained' table to 'message_retained'\n2. rewrite emqttd_retained in 0.6.0\n. Should copy topic_subscriber table in emqttd_pubsub:init/1\nmnesia:create_table(topic_subscriber, [\n        {type, bag},\n        {ram_copies, [node()]},\n        {attributes, record_info(fields, topic_subscriber)},\n        {index, [subpid]},\n        {local_content, true}]),\n    mnesia:add_table_copy(topic_subscriber, node(), ram_copies),\n. Issue explain: emqttd_cm will be overloaded when there are too many concurrent connections for we use a single gen_server to register all client ids:\n-spec register(ClientId :: binary(), Pid :: pid()) -> ok.\nregister(ClientId, Pid) when is_binary(ClientId), is_pid(Pid) ->\n    %%TODO: infinify to block requests when too many clients, this will be redesinged in 0.9.x...\n    gen_server:call(?SERVER, {register, ClientId, Pid}, infinity).\n. use ets:insert_new and gen_server:cast to improve performance:\n```\n-spec register(ClientId :: binary()) -> ok.\nregister(ClientId) when is_binary(ClientId) ->\n    Pid = self(),\n    %% this is atomic\n    case ets:insert_new(?CLIENT_TABLE, {ClientId, Pid, undefined}) of\n        true -> gen_server:cast(?SERVER, {monitor, ClientId, Pid});\n        false -> gen_server:cast(?SERVER, {register, ClientId, Pid})\n    end.\n```\nNow could support 2k connections/sec.\n. (emqttd3@127.0.0.1)3> mnesia:info().\n---> Processes holding locks <---\n---> Processes waiting for locks <---\n---> Participant transactions <---\n---> Coordinator transactions <---\n---> Uncertain transactions <---\n---> Active tables <---\nmqtt_retained  : with 6        records occupying 221      words of mem\ntopic_subscriber: with 0        records occupying 305      words of mem\ntopic_trie_node: with 129      records occupying 3195     words of mem\ntopic_trie     : with 128      records occupying 3986     words of mem\ntopic          : with 93       records occupying 1797     words of mem\nschema         : with 6        records occupying 1081     words of mem\n===> System info in version \"4.12.4\", debug level = none <===\nopt_disc. Directory \"/Users/erylee/Projects/emqttd/rel/emqttd3/data/mnesia\" is NOT used.\nuse fallback at restart = false\nrunning db nodes   = ['emqttd2@127.0.0.1','emqttd@127.0.0.1','emqttd3@127.0.0.1']\nstopped db nodes   = []\nmaster node tables = []\nremote             = []\nram_copies         = [mqtt_retained,schema,topic,topic_subscriber,topic_trie,\n                      topic_trie_node]\ndisc_copies        = []\ndisc_only_copies   = []\n[{'emqttd2@127.0.0.1',ram_copies},\n {'emqttd3@127.0.0.1',ram_copies},\n {'emqttd@127.0.0.1',disc_copies}] = [schema]\n[{'emqttd2@127.0.0.1',ram_copies},\n {'emqttd3@127.0.0.1',ram_copies},\n {'emqttd@127.0.0.1',ram_copies}] = [topic,topic_trie,topic_trie_node,\n                                     mqtt_retained]\n[{'emqttd3@127.0.0.1',ram_copies}] = [topic_subscriber]\n44 transactions committed, 5 aborted, 0 restarted, 0 logged to disc\n0 held locks, 0 in queue; 0 local transactions, 0 remote\n0 transactions waits for other nodes: []\nok\n. emqttd_mnesia.erl to handle mnesia database start, init and cluster\nemqttd_ctl.erl cluster/1:\ncluster([SNode]) ->\n    Node = node_name(SNode),\n    case net_adm:ping(Node) of\n    pong ->\n        application:stop(emqttd),\n        application:stop(esockd),\n        emqttd_mnesia:cluster(Node),\n        application:start(esockd),\n        application:start(emqttd),\n        ?PRINT(\"cluster with ~p successfully.~n\", [Node]);\n    pang ->\n        ?PRINT(\"failed to connect to ~p~n\", [Node])\n    end.\ncluster process:\n1. stop esockd, emqttd applications\n2. stop mnesia database, and delete local schema\n3. mnesia:change_config(extra_db_nodes, [Node])\n4. copy tables and wait for ready\n5. start esockd, emqttd.\n. The cluster Architecture is one 'disc_copies' node, and many 'ram_copies' nodes.\n. 1. rename table 'mqtt_retained' to 'message_retained'\n2. use mnesia:async_dirty/2 to store and read\n3. use mnesia:foldl/3 to match wildcard topic\n. fixed.\n. emqttd_pubsub is redesigen in 0.6.1:\n1. use gproc_pool to start many emqttd_pubsub processes\n2. all mnesia:transaction is protected by gen_server:call\n3. improve subscribe, publish API design\n. log in emqttd_session.erl\n. Thx:)\n. 1. rm mqtt_user record\n2. emqttd_auth:login(mqtt_client(), Password :: binary())\n3. emqttd_acl.erl:\n-spec check({Client, PubSub, Topic}) -> allow | deny when\n      Client :: mqtt_client(),\n      PubSub :: pubsub(),\n      Topic  :: binary().\n. Modules that need to create/replicate mnesia table, declare attributes:\n```\n%% Mnesia Callbacks\n-export([mnesia/1]).\n-boot_mnesia({mnesia, [boot]}).\n-copy_mnesia({mnesia, [copy]}).\n```\nemqttd_mnesia.erl find all the modules with attributes 'boot_mnesia', 'copy_mneisa' :\n```\ncreate_tables() ->\n    emqttd_utils:apply_module_attributes(boot_mnesia).\ncopy_tables() ->\n    emqttd_utils:apply_module_attributes(copy_mnesia).\n```\n. Modules that need to create/replicate mnesia table, declare attributes:\n```\n%% Mnesia Callbacks\n-export([mnesia/1]).\n-boot_mnesia({mnesia, [boot]}).\n-copy_mnesia({mnesia, [copy]}).\n```\nemqttd_mnesia.erl find all the modules with attributes 'boot_mnesia', 'copy_mneisa' :\n```\ncreate_tables() ->\n    emqttd_utils:apply_module_attributes(boot_mnesia).\ncopy_tables() ->\n    emqttd_utils:apply_module_attributes(copy_mnesia).\n```\n. erlang environment error?\n. closed?\n. R17+ required\n. lager config in etc/app.config\n{lager_file_backend, [\n            {formatter_config, [time, \" [\",severity,\"] \", message, \"\\n\"]},\n            {file, \"log/emqttd_info.log\"},\n            {level, info},\n            {size, 104857600},\n            {date, \"$D0\"},\n            {count, 10}\n        ]},\n        {lager_file_backend, [\n            {formatter_config, [time, \" [\",severity,\"] \", message, \"\\n\"]},\n            {file, \"log/emqttd_error.log\"},\n            {level, error},\n            {size, 10485760},\n            {date, \"$D0\"},\n            {count, 10}\n        ]}\n. Pooler mechanism based on gproc_pool:\nemqttd_pooler.erl\nemqttd_pooler_sup.erl\n. merge emqttd_acl, emqttd_auth to emqttd_access_control\n. Trace Design: https://github.com/emqtt/emqttd/wiki/Trace-Design\n. Integrate with gproc_pool:\n1. emqttd_pubsub_sup to start 'pubsub' pool to control pubsub mnesia transactions.\n2. emqttd_pooler, emqttd_pooler_sup to provide a general pooler.\n. --- a/apps/emqttd/src/emqttd_access_rule.erl\n+++ b/apps/emqttd/src/emqttd_access_rule.erl\n@@ -58,7 +58,7 @@ compile({A, all}) when (A =:= allow) orelse (A =:= deny) ->\n     {A, all};\ncompile({A, Who, Access, TopicFilters}) when (A =:= allow) orelse (A =:= deny) ->\n-    {A, compile(who, Who), Access, [compile(topic, bin(Topic)) || Topic <- TopicFilters]}.\n-    {A, compile(who, Who), Access, [compile(topic, Topic) || Topic <- TopicFilters]}.\ncompile(who, all) ->\n     all;\n  @@ -74,8 +74,10 @@ compile(who, {user, all}) ->\n  compile(who, {user, Username}) ->\n     {user, bin(Username)};\n+compile(topic, {eq, Topic}) ->\n-    {eq, emqtt_topic:words(bin(Topic))};\n  compile(topic, Topic) ->\n-    Words = emqtt_topic:words(Topic),\n-    Words = emqtt_topic:words(bin(Topic)),\n   case 'pattern?'(Words) of\n       true -> {pattern, Words};\n       false -> Words\n  @@ -138,6 +140,8 @@ match_topics(Client, Topic, [TopicFilter|Filters]) ->\n   false -> match_topics(Client, Topic, Filters)\n   end.\n+match_topic(Topic, {eq, TopicFilter}) ->\n-    Topic =:= TopicFilter;\n  match_topic(Topic, TopicFilter) ->\n     emqtt_topic:match(Topic, TopicFilter).\n. add 'Architecture' section.\n. Done. Rewrite GetStarted for 0.7.0 release.\n. Done. Write first version 'User Guide' in Wiki.\n. Add 'Developer Guide' chapter in Wiki.\n. yes. I tagged 0.7.0 last weekend, and will commit the plugin today.\n. add more test cases if issues found. close this issue.\n. emqttd_protocol.erl to cache ACL for publish:\n+%% publish ACL is cached in process dictionary.\n+check_acl(publish, Topic, State) ->\n+    case get({acl, publish, Topic}) of\n+        undefined ->\n+            AllowDeny = emqttd_access_control:check_acl(client(State), publish, Topic),\n+            put({acl, publish, Topic}, AllowDeny),\n+            AllowDeny;\n+        AllowDeny ->\n+            AllowDeny\n+    end;\n+\n+check_acl(subscribe, Topic, State) ->\n+    emqttd_access_control:check_acl(client(State), subscribe, Topic).\n+\n. fix rebar.config\n{recursive_cmds, [ct, eunit, clean]}.\n. not support this feature now.\ncould you write the requirements in detail?\n. hi, this feature will be released in 0.7.x after websocket support.\n. @caferain0, emqttd 0.8.1 release with a new feature: Presence. \nWhen client connected or disconnected, broker will publish messages to $SYS topics:\n$SYS/borkers/${broker}/clients/${clientId}/connected\n$SYS/borkers/${broker}/clients/${clientId}/disconnected\nPlease check if this works for your requirements\n. @phanimahesh, I did not support this feature for performance issue. If all the logs published to one topic, an erlang proccess may be overloaded. \nSo I think we should support \"shared subscription\" feature in issue #191 first and then redesign the log. Thanks for your suggestion:)\n. 0.5.4? or 0.6.1? mnesia crash?\n. any log?\n. first of all, do you tune linux kernel parameter?\nhttps://github.com/emqtt/emqttd/wiki/One-Million-Connections(Draft)\n. and you should provide information about:\n1. server cpu, memory, os...\n2. how many concurrent connections?\n3. crash log\n4. benchmark tools config\n. duplicated with issue #54 and fixed in 0.6.2 release.\n. Support Plugin Design Now.\n. \u4f60\u8fd9\u95ee\u9898\u5355\u63d0\u5f97\u2026... \u6bd4\u5982\u9000\u51fa:\n1. emqttd\u8fd0\u884c\u7684\u670d\u52a1\u5668\u7c7b\u578b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u3001\u5185\u5b58\u7b49\n2. \u8fdb\u7a0b\u5f02\u5e38\u9000\u51fa\uff0c\u7cfb\u7edf\u65e5\u5fd7\u662f\u4ec0\u4e48\uff0cemqttd crash\u65e5\u5fd7\u662f\u4ec0\u4e48\uff1f\n3. \u5ba2\u6237\u7aef\u6536\u5230\u4ec0\u4e48\u9519\u8bef\uff1f\n\u95ee\u9898\u5355\u4e0a\uff0c\u4ec0\u4e48\u90fd\u4e0d\u8d34\u3002\u5c31\u4e00\u53e5\u201c\u5730\u7403\u81ea\u8f6c\u597d\u50cf\u4e0d\u5bf9\u4e86\u201d\uff0c\u4f60\u89c9\u5f97\u6211\u8be5\u5982\u4f55\u5904\u7406\uff1f\n. ok, I check it now...\n\n\u5728 2015\u5e744\u670823\u65e5\uff0c\u4e0b\u53481:42\uff0c\u6768\u5ef6\u658c notifications@github.com \u5199\u9053\uff1a\n\u627e\u5230\u95ee\u9898\u4e86\uff0c\u53ea\u8981\u8bbe\u7f6e cleansession=0 \u5c31\u9000\u51fa\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/106#issuecomment-95445087.\n. \u6768\uff0c\n\nMy QQ: 22061135,\nSkype: feng.emqtt.io\n\u65e5\u5fd7emqttd/log/\u6253\u5305\u7ed9\u6211\n\n\u5728 2015\u5e744\u670823\u65e5\uff0c\u4e0b\u53481:42\uff0c\u6768\u5ef6\u658c notifications@github.com \u5199\u9053\uff1a\n\u627e\u5230\u95ee\u9898\u4e86\uff0c\u53ea\u8981\u8bbe\u7f6e cleansession=0 \u5c31\u9000\u51fa\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/106#issuecomment-95445087.\n. My Test: \n\n13:54:04.633 [info] Connect from 127.0.0.1:51342 -> 127.0.0.1:1883\n13:54:04.634 [info] RECV from undefined@127.0.0.1:51342: CONNECT(Qos=0, Retain=false, Dup=false, ClientId=testClientId, ProtoName=MQTT, ProtoVsn=4, CleanSess=false, KeepAlive=60, Username=undefined, Password=undefined)\n13:54:04.634 [info] event PUBLISH to $SYS/brokers/emqttd@127.0.0.1/clients/testClientId/connected\n13:54:04.634 [info] SEND to testClientId@127.0.0.1:51342: CONNACK(Qos=0, Retain=false, Dup=false, AckFlags=0, RetainCode=0)\n13:55:04.641 [info] RECV from testClientId@127.0.0.1:51342: PINGREQ(Qos=0, Retain=false, Dup=false)\n13:55:04.641 [info] SEND to testClientId@127.0.0.1:51342: PINGRESP(Qos=0, Retain=false, Dup=false)\n13:55:28.259 [info] RECV from testClientId@127.0.0.1:51342: SUBSCRIBE(Qos=1, Retain=false, Dup=false, PacketId=1, TopicTable=[{<<\"a/bc/d\">>,0}])\n13:55:28.260 [info] <0.255.0> call <0.199.0>\n13:55:28.261 [info] Client testClientId subscribe [{<<\"a/bc/d\">>,0}]. Granted QoS: [0]\n13:55:54.794 [info] RECV from testClientId@127.0.0.1:51342: PUBLISH(Qos=0, Retain=false, Dup=false, TopicName=a/bc/d, PacketId=undefined, Payload=<<\"haha\">>)\n13:55:54.794 [info] testClientId PUBLISH to a/bc/d\n13:55:54.795 [info] SEND to testClientId@127.0.0.1:51342: PUBLISH(Qos=0, Retain=false, Dup=false, TopicName=a/bc/d, PacketId=undefined, Payload=<<\"haha\">>)\n. This issue is duplicated with #54 and fixed in 0.6.2 release.\n. emqttd\u652f\u6301\u96c6\u7fa4\u591a\u4e2a\u8282\u70b9\uff0c\u6240\u4ee5\u9700\u8981subscribe: $SYS/brokers/+/clients/max\n\u6587\u6863: https://github.com/emqtt/emqttd/wiki/%24SYS%20Topics%20of%20Broker\n. please rm data/mnesia/* first if you changed node name.\n. cannot start still?\n\n\u5728 2015\u5e744\u670824\u65e5\uff0c\u4e0b\u534812:23\uff0c\u6768\u5ef6\u658c notifications@github.com \u5199\u9053\uff1a\n\u6211\u8bd5\u4e86\uff0c\u4ecd\u7136\u4e0d\u80fd\u6210\u529f\u3002\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/108#issuecomment-95797682.\n. first, my etc/vm.args config:\n\n-name emqttd@192.168.18.124\nsecond:\nrm -rf data/mnesia/*\nand then:\n./bin/emqttd console\n```\nairlee:emqttd erylee$ ./bin/emqttd console\nExec: /Users/erylee/Projects/emqttd/rel/emqttd/erts-6.3/bin/erlexec -boot /Users/erylee/Projects/emqttd/rel/emqttd/releases/0.6.0/emqttd             -embedded -config /Users/erylee/Projects/emqttd/rel/emqttd/etc/app.config             -pa ./lib/basho-patches             -args_file /Users/erylee/Projects/emqttd/rel/emqttd/etc/vm.args -- console\nRoot: /Users/erylee/Projects/emqttd/rel/emqttd\nErlang/OTP 17 [erts-6.3] [source] [64-bit] [smp:4:4] [async-threads:32] [hipe] [kernel-poll:true]\n=INFO REPORT==== 24-Apr-2015::15:36:04 ===\n    alarm_handler: {set,{system_memory_high_watermark,[]}}\nstarting emqttd on node 'emqttd@192.168.18.124'\nemqttd config is starting...[done]\nemqttd event is starting...[done]\nemqttd pooler is starting...[done]\nemqttd client manager is starting...[done]\nemqttd session manager is starting...[done]\nemqttd session supervisor is starting...[done]\nemqttd pubsub is starting...[done]\nemqttd broker is starting...[done]\nemqttd metrics is starting...[done]\nemqttd bridge supervisor is starting...[done]\nemqttd access control is starting...[done]\nemqttd system monitor is starting...[done]\n15:36:05.245 [info] mqtt listen on 0.0.0.0:1883 with 16 acceptors.\n15:36:05.246 [info] mqtts listen on 0.0.0.0:8883 with 4 acceptors.\n15:36:05.256 [info] http listen on 0.0.0.0:8083 with 4 acceptors.\nErlang MQTT Broker 0.6.2 is running now\nEshell V6.3  (abort with ^G)\n(emqttd@192.168.18.124)1> node().\n'emqttd@192.168.18.124'\n```\n. Hi, Yang, I released 0.6.2, thanks for your bug report.\n. Broker event pub/sub based on gproc:\n```\n%%------------------------------------------------------------------------------\n%% @doc Subscribe broker event\n%% @end\n%%------------------------------------------------------------------------------\n-spec subscribe(EventType :: any()) -> ok.\nsubscribe(EventType) ->\n    gproc:reg({p, l, {broker, EventType}}).\n%%------------------------------------------------------------------------------\n%% @doc Notify broker event\n%% @end\n%%------------------------------------------------------------------------------\n-spec notify(EventType :: any(), Event :: any()) -> ok.\nnotify(EventType, Event) ->\n     Key = {broker, EventType},\n     gproc:send({p, l, Key}, {self(), Key, Event}).\n```\n. The feature is easy to implemented I think if pubsub works well:)\nHave a question about the 'point 2 point' mode: which topic the sender publish message to?\n. okay, I will write a simple design first and plan this feature in 0.7.x release.\n. @Hades32, please checkout 'issue#111' branch and build.  I implemented a simple P2P queue that a client will subscribe automatically when connected. \n1. etc/emqttd.config:\n%% Subscribe these topics automatically when client connected\n {forced_subscriptions, [{\"$Q/client/$c\", 0}]},\n1. send message to the queue.\nIf the feature works for your project, I will improve the design.\n. @Hades32, This feature works well in cluster environment. I write a simple introduction about Queue: https://github.com/emqtt/emqttd/wiki/Queue-Design\nI will improve the design in 0.8.0 release. Any suggestion and issue report is welcome:)\n. Support this feature by emqttd_mod_autosub module in formal 0.8.0 release\n. just copy plugins:\n```\nrel: compile\n    @cd rel && ../rebar generate -f\nplugins:\n    @for plugin in ./plugins/* ; do \\\n        cp -R $${plugin} $(DIST)/plugins/ && rm -rf $(DIST)/$${plugin}/src/ ; \\\n    done\ndist: rel plugins\n```\n. Giorgio,\nThis is cool, I will check it later. emqtt 0.7.0 release will support a simple plugin architecture based on OTP application.\nRegards\nFeng\n\n\u5728 2015\u5e744\u670828\u65e5\uff0c\u4e0a\u53481:48\uff0cGiorgio Salluzzo notifications@github.com \u5199\u9053\uff1a\nWhat about adding ErlPort (http://erlport.org/ http://erlport.org/) to support plugins made in Python and Ruby?\nThe project is on GitHub, as well, at:\nhttps://github.com/hdima/erlport https://github.com/hdima/erlport\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/113.\n. @mindflayer, I released 0.8.0 with a simple plugin mechanism, please try and help me write some test plugins:)  \n\nPlugin Design: https://github.com/emqtt/emqttd/wiki/Plugin%20Design\n. Write plugin with Erlang, and use ErlPort to connect to python or ruby program\n. please paste your sub/unsub process.  I check this issue with emqttc and it could work well, test code below:\n{ok, C} = emqttc:start_link([{client_id, <<\"testClient\">>}]).\nemqttc:subscribe(C, <<\"topic/#\">>).\nemqttc:publish(C, <<\"topic/a\">>, <<\"haha\">>).\nemqttc:unsubscribe(C, <<\"topic/#\">>).\nemqttc:publish(C, <<\"topic/a\">>, <<\"haha\">>).\n. past your php code here\n. php mqtt client issue. emqttd broker did not receive any UNSUBSCRIBE packet.\n. emqtt/mochiweb project support WebSocket(SSL) Now!\n. @goldalworming I am tagging 0.7.0 release with plugin samples. I will write a simple emqttd_auth_mysql plugin this weekend.\n. hi, @goldalworming, please checkout 'plugins' branch. I commit a demo emqttd_auth_mysql plugin.\nIf you want to authenticate with your own database and users table,  you could:\n1. configure database parameters in 'etc/plugins.config'\n{emysql, [\n    {pool_size, 4},\n    {host, \"localhost\"},\n    {port, 3306},\n    {username, \"\"},\n    {password, \"\"},\n    {database, \"mqtt\"},\n    {encoding, utf8}\n ]},\n {emqttd_auth_mysql, [\n    {user_table, mqtt_users}\n ]}\n1. modify plugins/emqttd_auth_mysql/src/emqttd_auth_mysql.erl to hash your password if not plaintext is stored.\n. 1. start emqttd console:\n./bin/emqttd console\n1. check mysql:\nemysql:select(UserTab, {{username, Username}, {password, Password}}).\nUserTab: your user table, atom type.\n. emysql:select('mqtt_user', {{username, 'alice'}, {password, 'secret'}}).\n. must be ended with \".\" \ntry the query above.\n. @goldalworming, I fixed the mysql query issue that 'where' condition of select is wrong:\nemysql:select(UserTab, {'and', {username, Username}, {password, Password}}).\nPlease checkout 'plugins' branch and build to test.\n. git clone -b plugins https://github.com/emqtt/emqttd.git && make && make dist\nclone 'plugins' branch to a new folder, and try to build\n. find . -name goldrush\n\n\u5728 2015\u5e745\u67086\u65e5\uff0c\u4e0b\u53484:33\uff0carief nur andono notifications@github.com \u5199\u9053\uff1a\ngoldrush\n. emqttd_broker add start_tick/1, stop_tick/1 API.\n. Move the WebSocket Page to emqttd_dashboard project.\n\nPlease check https://github.com/emqtt/emqttd_dashboard/issues/1\n. @lsxredrain, I will merge this plugin from dev branch to master this week.\n. released in 0.8.0\n. LVS\u96c6\u7fa4\u4e0b\uff0c\u4e00\u53f0\u670d\u52a1\u5668down\uff0c\u8fde\u63a5\u5230\u8be5\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\uff0c\u5fc5\u9700\u91cd\u65b0\u8fde\u63a5\u5230\u5176\u4ed6\u670d\u52a1\u5668\u3002\nemqttd\u5e94\u7528\u5c42\u9762\u96c6\u7fa4\u65e0\u95ee\u9898\uff0c\u5ba2\u6237\u7aef\u5e94\u8be5\u652f\u6301\u81ea\u52a8\u91cd\u8fde\u673a\u5236\u3002\n. @goldalworming, timestamp+mid cannot work if there are too many concurrent messages, I think.\nThere are two issues:\n1. Qos0 message has no mid\n2. Qos1/2 message has a increase mid that is only unique in same session\n. duplicated with #185.\n.  unload_all_plugins() ->\n     PluginApps = application:get_env(emqttd, plugins, []),\n-    [{App, unload_plugin(App)} || {App, _Env} <- PluginApps].\n-    [{App, unload_plugin(App)} || App <- PluginApps].\n. no idea.\n. The clientId cannot be null here for emqttd_protocol will assure clientId is ok\n. An experimental design in 0.8.0 release: https://github.com/emqtt/emqttd/wiki/Rewrite\n. @Hades32, released 0.8.0-alpha with this feature. please try it.\n. No, ACL are applied before rewrite. \n. @Hades32, no finally conclusion. We could improve the design when more users use the Rewrite feature. For this feature is planned in 0.8.0 release, I close it first and we could submit new issue to enhance this feature in the late release.\n. 1. \u540c\u4e00\u6d88\u606f\u7684PUBACK, PUBREC, PUBREL messageid\u4e00\u81f4\uff0c\u5ba2\u6237\u7aef\u5fc5\u987b\u901a\u8fc7msgid\u786e\u5b9aqos1, qos2\u6d88\u606f\u3002\u4f60\u4eecphp\u5ba2\u6237\u7aefid\u5904\u7406\u9519\u8bef\uff0c\u53ea\u4fdd\u7559\u4e86last message ID\uff0c\u5e94\u8be5\u4fdd\u5b58\u672a\u54cd\u5e94\u7684sub\u3001unsub\u3001qos1\u3001qos2 publish\u3002\n2. \u5ba2\u6237\u7aef\u7aef\u5f00\uff0cemqttd\u4f1a\u91cd\u7f6emsgid\u3002\n. @brangi, It seems your packet is too long. You could configure 'max_packet_size' in etc/emqttd.config, for example:\n%% MQTT Protocol Options\n    {mqtt, [\n        %% Packet\n        {packet, [\n            %% Max ClientId Length Allowed\n            {max_clientid_len, 1024},\n            %% Max Packet Size Allowed, 4K default\n            {max_packet_size,  4096}\n        ]},\n. 64K default in 0.8.0 release.\netc/emqttd.config:\n%% Max Packet Size Allowed, 64K default\n            {max_packet_size,  65536}\n. The new configuration syntax in 2.0:\n```\nMax Packet Size Allowed, 64K by default.\nmqtt.max_packet_size = 64KB\n```\n. All the features about presence management implemented in 0.10.0 version.\n1. emqttd_cm to register all connected clients\n2. $SYS/brokers/${node}/clients/${clientid}/+ to publish presence\n3. support \"./bin/emqttd_ctl clients\" cli command\n4. Web Dashboard \"Clients\" Page to show all connected clients \n. emqttd\u96c6\u7fa4\u540e\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u8fde\u63a5\u4efb\u610f\u5730\u5740\u3002\n\n\u5728 2015\u5e745\u670813\u65e5\uff0c\u4e0b\u53486:20\uff0ckansifang notifications@github.com \u5199\u9053\uff1a\n\u5728\u914d\u7f6e\u96c6\u7fa4\u540e\u5ba2\u6237\u7aef\u8fde\u63a5\u5730\u5740\u662f\u5426\u9700\u8981\u6539\u53d8\u5462\uff1f\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/130.\n. Build:\n\n```\ngit clone https://github.com/emqtt/emqttd.git\ncd emqttd && make && make dist\n```\nYour have to install erlang R17+ and git before build\napt-get install erlang\napt-get install git\n. cannot print chinese in log file.\n. No, for we don't know whether the payload is string or bytes.  You could subscribe '#' or some topics to log messages.\n. Please check your etc/acl.config. Default config only allow localhost to subscribe '$SYS/#':\n```\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", \"#\"]}.\n{deny, all, subscribe, [\"$SYS/#\", {eq, \"#\"}]}.\n{allow, all}.\n```\n. Please check issue #111, Forced Subscription feature is supported in 0.8.0.\n. Any client will subscribe '$Q/client/ClientId' topic when connected successfully. So Other clients could publish messages to the client directly by '$Q/client/ClientId' topic.\n. Has been fixed in 0.13.x\n. Has been fixed in 1.x\n. fix in 0.9.0 release. emqttd_mod_presence will publish 'disconnected' message.\n. fix in 0.9.0 release. emqttd_mod_presence will publish 'disconnected' message.\n. This feature is invalid. Messages published to client contain topic name. \n. 1. Topic tree\u6bcf\u53f0\u673a\u5668\u6709\u526f\u672c\uff0cdown\u673a\u4e0d\u5f71\u54cd\u6570\u636e\n2. \u8fde\u63a5\u3001\u8ba2\u9605\u662f\u5355\u8282\u70b9\uff0cdown\u673a\u5ba2\u6237\u7aef\u5fc5\u987b\u91cd\u7ec3\u5176\u4ed6\u8282\u70b9\uff0c\u5e76\u91cd\u65b0\u8ba2\u9605\u3002\n. 1. MQTT detected network error 'closed', \u5148\u68c0\u67e5\u670d\u52a1\u7aef\u662f\u5426\u6709keepalive_timeout\u7684\u65e5\u5fd7\uff0c\u5982\u6ca1\u6709\u662f\u5ba2\u6237\u7aef\u4e3b\u52a8\u5173\u95ed\u4e86\u8fde\u63a5\n2. Android\u4e0b\u4f60mqtt\u5ba2\u6237\u7aef\u662f\u5426\u5199\u6210Android\u7684Service\uff1f\u5982\u679cActivity\u4e2d\u5efa\u7acbmqtt\u8fde\u63a5\uff0c\u4e00\u62c5\u5c4f\u5e55\u5207\u6362\u4f1a\u81ea\u52a8\u65ad\u5f00\n. 1. emqttd_session.erl supports publish timeout for Qos1, Qos2 messages\n2. etc/emqttd.config supports 'unack_timeout', 'unack_retries':\n```\n        %% Session\n        {session, [\n            %% Expired after 2 days\n            {expired_after, 48},\n        %% Max number of QoS 1 and 2 messages that can be \u201cin flight\u201d at one time.\n        %% 0 means no limit\n        {max_inflight, 100},\n\n        %% Max retries for unack Qos1/2 messages\n        {unack_retries, 3},\n\n        %% Retry after 4, 8, 16 seconds\n        {unack_timeout, 4},\n\n        %% Awaiting PUBREL Timeout\n        {await_rel_timeout, 8},\n\n        %% Max Packets that Awaiting PUBREL, 0 means no limit\n        {max_awaiting_rel, 0}\n\n```\n. @Hades32, The 'ingoing_rate_limit' config should be global or per clientId based? I don't know if a global config is enough?\n. move to 0.11.0\n. esockd  3.0 supports Rate Limiting based on Token Bucket algorithm.\netc/emqttd.config:\n```\n    %% Listeners\n    {listeners, [\n        {mqtt, 1883, [\n            %% Size of acceptor pool\n            {acceptors, 16},\n        %% Maximum number of concurrent clients\n        {max_clients, 512},\n\n        %% Socket Access Control\n        {access, [{allow, all}]},\n\n        %% Connection Options\n        {connopts, [\n            %% Rate Limit. Format is 'burst, rate', Unit is KB/Sec\n            %% {rate_limit, \"100,10\"} %% 100K burst, 10K rate\n        ]},\n\n        %% Socket Options\n        {sockopts, [\n            %Set buffer if hight thoughtput\n            %{recbuf, 4096},\n            %{sndbuf, 4096},\n            %{buffer, 4096},\n            %{nodelay, true},\n            {backlog, 512}\n        ]}\n    ]},\n\n```\n. Done. Wiki: https://github.com/emqtt/emqttd/wiki/Improve-the-Session-Queue-Design\n. Fix in 0.8.2. Commit: 4c38cb37f5bdedae9941b6f12898801c91497ac1\n. Fixed in 0.8.2.  Commit: 8aa2b8fbedbf3e306eec065b69dd6b60d3a304a8\n. Please check: https://github.com/emqtt/emqttd/wiki/Presence.\nCould subscribe the $SYS topics to trace clients.\n. @roytan883, HTTP API will be supported in 0.9.0, and you could subscribe the $SYS topics to record all presence messages.\n. @kansifang, @roytan883, this feature has been released in 0.10.0. Pls check issue #230.\n. Fixed in 0.8.3. Commits: 5a75e59dd1842cbfe062de5e0e5b74938d918bd9 0044514a878da363539a5d089b20abc72df9eb88\n. 1. When a client connected to broker with 'clean session' flag 0, a session identified by clientId will be created. The session will expire after 24 hours if no client connections bind with it,  and all queued messages and subscriptions will be dropped.\n2.  max_queued_messages for session. Topic just dispatch messages to clients or sessions that matched the subscriptions. Topic has no idea about offline messages.\n3. By default, the broker only keep the latest retained message of one topic.\n. @sailingchen, I am rewriting session and queue, and will write a Wiki to explain the design in detail.\n. @sailingchen,  @roytan883, I move the discussion to FAQ wiki: \nhttps://github.com/emqtt/emqttd/wiki/FAQ\nAnd the broker released a new design of queue/session in 0.9.0: \nhttps://github.com/emqtt/emqttd/wiki/Improve-the-Session-Queue-Design\n. No. According the MQTT Specification, clientId cannot be duplicated. If two connections with the same clientId, the older one will be kicked out.\n. @roytan883, no definition about duplicated clientIds in MQTT protocol I think. This is a big issue if two conflict clients reconnect all the time...\nI will check MQTT V3.1.1 protocol specification later. And have any suggestions?\n. CONNACK packet should have a payload...\n. Most MQTT client libraries will not handle the 'kick' message...\n. The clientId is a secret key in MQTT protocol I think,  something like deviceId of a mobile. So client should not leak its clientId, there is little chance to conflict in broker?\n. Design of \"userId as clientID\" is not common  practice in MQTT I think.  'Username' of CONNECT packet  could be user ID. \n. @lsxredrain, please submit a 'Feature Request' issue. Kick out client by clientId by cli command or web console?\n. @sufish, Last Will Message could only report abnormal disconnection.\n. The core features are solid and scalable, and there are some users integrate emqttd in their projects. A small full-time team with many contributors are developing this project. You could submit issues if any feature requests or bug reports.\n. @sailingchen, move this question to wiki: https://github.com/emqtt/emqttd/wiki/FAQ\n. 4369 and some random ports are opened by erlang node for internal communication.  Configure your firewall to allow 1883, 8883, 8083 ports to be accessed from outside for security.\n. Erlang\u7528\u4e8e\u5206\u5e03\u5f0f\u8282\u70b9\u95f4\u901a\u4fe1\u7684\u7aef\u53e3\uff0c\u5efa\u8bae\u901a\u8fc7\u9632\u706b\u5899\u5c4f\u853d\u5916\u90e8\u8bbf\u95ee\u3002\u9632\u706b\u5899\u8bbe\u7f6e\u4e3a\u53ea\u5f00\u653e1883\u7b49\u5916\u90e8\u8bbf\u95ee\u7aef\u53e3\u3002\nemqttd\u8bbf\u95ee\u63a7\u5236\u6709\u4e24\u4e2a\u5c42\u9762\u652f\u6301\uff1a\n1. eSockd TCP Acceptor\u5e93, \u652f\u6301\u57fa\u4e8eIP\u5730\u5740\u7684\u8bbf\u95ee\u63a7\u5236\uff0c\u4f8b\u5982\u53ea\u5141\u8bb8192.168.1.0/24\u7f51\u6bb5\uff0c\u9664192.168.1.1\u4ee5\u5916\u7684IP\u8bbf\u95ee\n{access, [{deny, \"192.168.1.1\"},\n             {allow, \"192.168.1.0/24\"},\n             {deny, all}]}\n   ]).\n2. emqttd\u672c\u8eabMQTT\u534f\u8bae\u5c42\u9762\u7684Subscribe/Publish\u8bbf\u95ee\u63a7\u5236\uff0c\u901a\u8fc7etc/acl.config\u53ef\u914d\u7f6e\u89c4\u5219\u3002\nRegards\nFeng\n\n\u5728 2015\u5e746\u67084\u65e5\uff0c\u4e0a\u534812:42\uff0csailingchen notifications@github.com \u5199\u9053\uff1a\n\u8ffd\u52a0\uff1a \u5982\u679c \u7528\u4e8e\u8282\u70b9\u4e4b\u95f4\u5185\u90e8\u901a\u4fe1\u7684\u7aef\u53e3 4369 \u548c\u53e6\u5916\u4e00\u4e9b\u968f\u673a\u6253\u5f00\u7684\u7aef\u53e3\u66b4\u9732\u5728\u516c\u7f51\u4f1a\u4e0d\u4f1a\u6709\u5b89\u5168\u95ee\u9898, \u53ef\u4ee5\u8bbe\u7f6e\u76d1\u542c\u5185\u7f51IP\u5417\uff0c1883, 8883, 8083 \u8fd9\u4e09\u4e2a\u7aef\u53e3\u6709\u8ba4\u8bc1\uff0c\u6709ACL\u63a7\u5236\uff0c\u5b89\u5168\u4e0d\u592a\u6210\u95ee\u9898\u3002\n\u6211\u4eec\u6bd4\u8f83\u5173\u6ce8\u7684\u5b89\u5168\u5c31\u662f\u63a7\u5236publish \u6743\u9650\uff0c\u76ee\u524d\u7248\u672c\u529f\u80fd\u5df2\u6ee1\u8db3\uff0c\u901a\u8fc7\u4e0d\u540c\u7528\u6237+acl \u63a7\u5236 topic\u3002\n\u8c22\u8c22\uff01\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/154#issuecomment-108518398.\n. move to https://github.com/emqtt/emqttd/wiki/FAQ\n. Commit: 053ddf61136700d9706c29083d6db56376c605b2\n. @lsxredrain,  emqttd_mod_autosub just send a 'subcribe' message to client pid,  the message will be handled until all hooks include your code 'emqttd_pubsub:publish'  executed.\n. emqttd_pubsub:subscribe is a synchronous call. If you call the subscribe first, the broker assure it will execute first. Now the problem is your pub/sub messages are sent to two erlang processes asynchronously, so the sequence is time depended. You have to fix the logic of your code.\n\n\"a systemid for every session\" is a great idea! let's discuss it in detail.\n. synchronous subscribe in emqttd_mod_autosub.erl:\nclient_connected(?CONNACK_ACCEPT, #mqtt_client{clientid = ClientId, client_pid = ClientPid}, Top|    end.\nics) ->                                                                                         |\n    F = fun(Topic) -> emqtt_topic:feed_var(<<\"$c\">>, ClientId, Topic) end,  \n   emqttd_pubsub:subscribe([{F(Topic), Qos} || {Topic, Qos} <- Topics]);\n. Cluster Design: https://github.com/emqtt/emqttd/wiki/Cluster%20Design https://github.com/emqtt/emqttd/wiki/Cluster%20Design\nTopic tree will be copied to each cluster nod, but clients, sessions and subscriptions are local.\n\n\u5728 2015\u5e746\u67084\u65e5\uff0c\u4e0b\u53488:17\uff0csailingchen notifications@github.com \u5199\u9053\uff1a\nI configure the emqttd cluster and test it , I found the client session will not be copied to every clusterd node , so every clusterd node is not equal \u3002\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/157.\n. \u5ba2\u6237\u7aefsession\u6a21\u5f0f\u8fde\u63a5\uff0c\u65ad\u7ebf\u91cd\u8fde\u5176\u4ed6Node\uff0c\u90a3\u4e48\u79bb\u7ebf\u6d88\u606f\u6536\u4e0d\u5230\u3002\u5982\u679c\u6709\u8fd9\u4e2a\u9700\u6c42\uff0c\u53ef\u4ee5\u652f\u6301session takeover\uff0c\u63a5\u7ba1\u5176\u4ed6\u8282\u70b9\u7684session\u3002\n. Broker\u5b9e\u73b0\u7684Session Take-Over, \u548c\u4f60\u4e0a\u9762\u7684\u6587\u6863\u4e0d\u540c\u3002Broker\u96c6\u7fa4\u6a21\u5f0f\u4e0b\uff0c\u6bd4\u5982Session\u4e4b\u524d\u5728A\u8282\u70b9\uff0c\u65ad\u7ebf\u91cd\u8fde\u540e\u4eceB\u8282\u70b9\u4e0a\u7ebf\uff1b\u90a3\u4e48\u628aA\u8282\u70b9\u7684Session\u6570\u636e\uff0c\u5e94\u8be5\u4f20\u9012\u7ed9B\u8282\u70b9\u7684\u65b0Session\u3002\n. @sailingchen, this feature is not supported now. I could plan in late release if the feature is important in cluster deploy.\n. fixed in commit: b544bdc10b1c31be9f4542b2c9f66863f3f0fc95\n. Please check logs of the broker, or discuss benchmark test with @turtleDeng.  He achieved 300K concurrent connections with 2000 messages per second a few days ago.\n. Please configure log level of lager in etc/emqttd.config:\n\n{lager, [\n    {colored, true},\n    {async_threshold, 1000},\n    {error_logger_redirect, false},\n    {crash_log, \"log/emqttd_crash.log\"},\n    {handlers, [\n        {lager_file_backend, [\n            {formatter_config, [time, \" \", pid, \" [\",severity,\"] \", message, \"\\n\"]},\n            {file, \"log/emqttd_error.log\"},\n            {level, error},\n            {size, 104857600},\n            {date, \"$D0\"},\n            {count, 30}\n        ]}\n    ]}\n ]},\n. update wiki: https://github.com/emqtt/emqttd/wiki/One-Million-Connections\n. update FAQ, and close this issue\n. Martin, thanks for your report. I remove the 'forkme' ribbon first.\n. @lsxredrain, ClientPid will change when client disconnect from and then reconnect to the broker again.\n. Hi Behrad,\nThanks for your suggestion. I am rewriting the code about session(emqttd_session) and queue(emqttd_queue). I will add puback, pubcomp hooks that you could extend the broker later.\nFeng \n\n\u5728 2015\u5e746\u67088\u65e5\uff0c\u4e0a\u53482:00\uff0cBehrad notifications@github.com \u5199\u9053\uff1a\nHow can I know when a message is acked (puback received on the server)? \nmy app wants to update it's models with the delivery timestamp.\nP.S. very nice and promising work \n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/164.\n. @behrad, I forgot to check the issue. The delivered/acked hooks have been implemented in 1.0 release.\n\nDemo: https://github.com/emqtt/emqttd_plugin_template/blob/master/src/emqttd_plugin_template.erl\n. Where the Topic Filter is not identical to any existing Subscription\u2019s filter, a new Subscription is created\n974 and all matching retained messages are sent.\n. Fixed in 0.8.4. Commit: 9d5223dd1ace63ea2b07dfddc7db7d99a5e846d5.\nSolution: publish retained messages to new Subscription.\n. emqttd_session.erl will redeliver all the inflight/queued messages when client reconnected:\n```\nhandle_cast({resume, ClientId, ClientPid}, Session) ->\n    ......\n    ......\n    %% Redeliver inflight messages\n    Session2 =\n    lists:foldl(fun({_Id, Msg}, Sess) ->\n            redeliver(Msg#mqtt_message{dup = true}, Sess)\n        end, Session1, lists:reverse(InflightQ)),\n%% Dequeue pending messages\n{noreply, dequeue(Session2), hibernate};\n\n```\n. 1. emqttd_session.erl supports 'inflight_queue' in 0.9 release.\n2. etc/emqttd.config support 'max_inflight' configuration:\n```\n        {session, [\n            %% Expired after 2 days\n            {expired_after, 48},\n        %% Max number of QoS 1 and 2 messages that can be \u201cin flight\u201d at one time.\n        %% 0 means no limit\n        {max_inflight, 100},\n\n```\n. @sufish, supported in 0.9.0\n.  'Session across nodes' feature has been implemented in 1.1.x release.\n. Hooks in 0.9.0:\n1. client.connected\n2. client.disconnected\n3. client.subscribe\n4. client.unsubscribe\n5. message.publish\n6. message.acked\nPlease check wiki: https://github.com/emqtt/emqttd/wiki/Hooks-Design\n. 1. Support $SYS topics for alarms:\nNew Alarm:  $SYS/brokers/${node}/alarms/${alarmId}/alert\nClear Alarm:  $SYS/brokers/${node}/alarms/${alarmId}/clear\n1. add src/emqttd_alarm.erl to manage broker's alarms.\n. Fixed in 1.x\n. The broker supports Pluggable Authentication/ACL. Please check these two plugins as example:\nhttps://github.com/emqtt/emqttd/tree/master/plugins/emqttd_auth_mysql\nor\nhttps://github.com/emqtt/emqttd_plugin_mysql\n. @dvorobiov, 0.10.0 released with new plugin design and mysql/pgsql auth/ACL plugins.\nMySQL Plugin: https://github.com/emqtt/emqttd_plugin_mysql\nPgSQL Plugin:  https://github.com/emqtt/emqttd_plugin_pgsql\n. @dvorobiov, I agree with you. Let's discuss the issue in detail later. The queue in emqttd should be extended and plugined, and could integrate with RabbitMQ, Redis or Kafka. \n. @huangdan, please check the feature request, and we should write plugins for RabbitMQ, Redis and Kafka Now I think. \n. Create https://github.com/emqtt/emqttd_plugin_kafka project and release the first version in 0.11.0\n. fixed\n. follow the rule 3: The Client closes the Network Connection without first sending a DISCONNECT Packet.\n. @behrad, we use https://github.com/emqtt/emqttd_benchmark to do simple benchmark test.\n. Hi Behrad,\nNo:) I created 6 nodes on QingCloud(a cloud provider in China), and start about 50k connections on each client node.\nIt\u2019s very cheap if you only use these nodes for benchmark test. I\u2019d like to share with your project if you want to benchmark Mosca.\nRegards\nFeng Lee\n\n\u5728 2015\u5e746\u670815\u65e5\uff0c\u4e0b\u53486:38\uff0cBehrad notifications@github.com \u5199\u9053\uff1a\nnice @erylee https://github.com/erylee I'll try it out.\nHave you ever successfully tried to go over 65K client connections with in a single machine? adding extra ip addresses as localAddresses but couldn't get it to work...\nthat way we need tons of client machines!!!\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/176#issuecomment-112014930.\n. It's really great. I had thought node.js could not handle too many concurrent connections...\n\nMy settings of Linux and Broker for benchmark: https://github.com/emqtt/emqttd/wiki/One%20Million%20Connections \nI will check the detailed kernel parameters and compare with yours later. I reached about 200k connections on a 8core, 32G RAM server with Centos, and one of my friends reached about 300k.\n. About 7~8G RAM. @Behrad, I never use node.js before. could it scale one process on multicores, or start a process on each core?\n\n\u5728 2015\u5e746\u670815\u65e5\uff0c\u4e0b\u53487:25\uff0cBehrad notifications@github.com \u5199\u9053\uff1a\nhow much memory were emqtt consuming when reaching 200K? what showed free -m\nI've written both in node.js and Erlang, and believe both are GOLD\nhowever node.js should be more memory hungry than Erlang optimized VM.\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/176#issuecomment-112023943.\n. mv to wiki: https://github.com/emqtt/emqttd/wiki/linux-kernel-tuning\n. Cluster will replicate topic trees, and bridge will not.\n\nhttps://github.com/emqtt/emqttd/wiki/Cluster-Design https://github.com/emqtt/emqttd/wiki/Cluster-Design\nhttps://github.com/emqtt/emqttd/wiki/Bridge https://github.com/emqtt/emqttd/wiki/Bridge\nRegards\nFeng\n\n\u5728 2015\u5e746\u670815\u65e5\uff0c\u4e0b\u53485:39\uff0cqian miao notifications@github.com \u5199\u9053\uff1a\nHow did i select mode between bridge and cluster? did it has some criteria?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/177.\n. @MQ-EL, we provide admin commands with 'bin/emqttd_ctl'\n\nbridges list                  #query bridges\n  bridges start <Node> <Topic>  #start bridge\n  bridges stop <Node> <Topic>   #stop bridge\nYes, bridge could relay msg between clusters. We hope use cluster and bridge to build complicated broker topology.\nNotice that the bridge design is not production ready, and we will improve it later. Any suggestion or bug report is welcome:)\n. @sailingchen, 'max_queue' in 0.8.0 release means length of offline message queue.\nIn 0.9.0 release, we support 'max_inflight' config like mosquitto:\n```\n        {session, [\n            %% Expired after 2 days\n            {expired_after, 48},\n        %% Max number of QoS 1 and 2 messages that can be \u201cin flight\u201d at one time.\n        %% 0 means no limit\n        {max_inflight, 100},\n\n        %% Max retries for unack Qos1/2 messages\n        {unack_retries, 3},\n\n        %% Retry after 4, 8, 16 seconds\n        {unack_timeout, 4},\n\n        %% Awaiting PUBREL Timeout\n        {await_rel_timeout, 8},\n\n        %% Max Packets that Awaiting PUBREL, 0 means no limit\n        {max_awaiting_rel, 0}\n\n    ]},\n    %% Session\n    {queue, [\n        %% Max queue length. enqueued messages when persistent client disconnected,\n        %% or inflight window is full.\n        {max_length, 1000},\n\n        %% Low-water mark of queued messsages\n        {low_watermark, 0.2},\n\n        %% High-water mark of queued messsages\n        {high_watermark, 0.6},\n\n        %% Queue Qos0 messages?\n        {queue_qos0, true}\n    ]}\n\n```\n. Project structure in 0.9:\nCHANGELOG.md\nLICENSE\nMakefile\nREADME.md\ndeps\ndoc\nebin\ninclude\nrebar\nrebar.config\nrel\nsrc\ntest\n. etc/emqttd.config:\n```\n%% Modules\n{modules, [\n%% Subscribe topics automatically when client connected\n{autosub, [{\"$Q/client/$c\", 0}]}\n\n```\nRegards\nFeng@emqtt.io\n\n\u5728 2015\u5e747\u67081\u65e5\uff0c\u4e0b\u53483:54\uff0croytan883 notifications@github.com \u5199\u9053\uff1a\nGranted\n. @roytan883, {autosub, [{\"$Q/client/qos2/$c\", 2}]} , then you can publish with 0, 1, 2\n. @sufish, expired fo all retained messages?\n. Configure the expiration time in etc/emqttd.config:\n\n```\n        %% Retained messages\n        {retained, [\n            %% Expired after seconds, never expired if 0\n            {expired_after, 0},\n        %% Max number of retained messages\n        {max_message_num, 100000},\n\n        %% Max Payload Size of retained message\n        {max_playload_size, 65536}\n    ]},\n\n```\n. @sufish, @brangi, @berrywira. The feature has been merged to the latest master branch. Please check \nPR: https://github.com/emqtt/emqttd/pull/329\n. Start the broker with './bin/emqttd console'. \n. @lsxredrain, resolved?\n. how many concurrent connections?\n. please close this issue, thx.\n. make this function atomic first:\n%%------------------------------------------------------------------------------\n %% @doc Set stats with max\n-%% TODO: this is wrong...\n %% @end\n %%------------------------------------------------------------------------------\n -spec setstats(Stat :: atom(), MaxStat :: atom(), Val :: pos_integer()) -> boolean().\n setstats(Stat, MaxStat, Val) ->\n-    MaxVal = ets:lookup_element(?STATS_TAB, MaxStat, 2),\n-    if\n-        Val > MaxVal ->\n-            ets:update_element(?STATS_TAB, MaxStat, {2, Val});\n-        true -> ok\n-    end,\n-    ets:update_element(?STATS_TAB, Stat, {2, Val}).\n+    gen_server:cast(?MODULE, {setstats, Stat, MaxStat, Val}).\n. emqttd_guid.erl to generate K-Ordered Unique ID for qos1/2 message:\n```\n\n|        Timestamp       |  NodeID + PID  |  Sequence  |\n |<------- 64bits ------->|<--- 48bits --->|<- 16bits ->|\n\n```\n1. Timestamp: erlang:system_time if Erlang >= R18, otherwise os:timestamp\n2. NodeId:    encode node() to 2 bytes integer\n3. Pid:       encode pid to 4 bytes integer\n4. Sequence:  2 bytes sequence  per pid\n. Yes, emqttd_cm module will be restored in 0.9.0 normal release. For We start a session for each client, I remove this module first. Then we find these module should be kept and store all clients to display on dashboard.\n\n\u5728 2015\u5e747\u67088\u65e5\uff0c\u4e0a\u534811:19\uff0clsxredrain notifications@github.com \u5199\u9053\uff1a\nhi, I want to use emqttd_cm:lookup to check clientid is online or offline,\nbut in new version, this file is cut, can emqttd rerserve it?\nClient = emqttd_cm:lookup(emqttd_util:bin(ClientId)),\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/186.\n. Will tag 0.9 this evening:)\n\u5728 2015\u5e747\u67088\u65e5\uff0c\u4e0b\u53486:41\uff0clsxredrain notifications@github.com \u5199\u9053\uff1a\nok\uff0cthanks,\nhow long 0.90 version will be released?\nnow I have to store these infomation to redis.\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/186#issuecomment-119537902.\n. commited\n. src/emqttd.er to add:\n\n%% open https port\nopen_listener({https, Port, Options}) ->\n    MFArgs = {emqttd_http, handle_request, []},\n    mochiweb:start_http(Port, Options, MFArgs).\n. it's okay\n\n\u5728 2015\u5e747\u67089\u65e5\uff0c\u4e0b\u53488:37\uff0csailingchen notifications@github.com \u5199\u9053\uff1a\nCluster support more than two nodes ?\nNode                Host            IpAddress\nnode1(disc_copy)    host1   192.168.0.10\nnode2(ram_copy) host2       192.168.0.20\nnode3           host3   192.168.0.30\nRun './bin/emqttd_ctl cluster' on host2:\n./bin/emqttd_ctl cluster emqttd@192.168.0.10\n./bin/emqttd_ctl cluster emqttd@192.168.0.30\nRun './bin/emqttd_ctl cluster' on host3:\n./bin/emqttd_ctl cluster emqttd@192.168.0.10\n./bin/emqttd_ctl cluster emqttd@192.168.0.20\nthree nodes config , is right?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/188.\n. Caused by emqttd_net:peername(SslSocket):\n\n=SUPERVISOR REPORT==== 10-Jul-2015::10:27:59 ===\n     Supervisor: 'esockd_connection_sup - <0.243.0>'\n     Context:    connection_crashed\n     Reason:     {function_clause,\n                     [{emqttd_net,peername,\n                          [{ssl_socket,#Port<0.4906>,\n                               {sslsocket,\n                                   {gen_tcp,#Port<0.4906>,tls_connection,\n                                       undefined},\n                                   <0.304.0>}}],\n                          [{file,\"src/emqttd_net.erl\"},{line,203}]},\n                      {emqttd_ws_client,init,1,\n                          [{file,\"src/emqttd_ws_client.erl\"},{line,106}]},\n                      {gen_server,init_it,6,\n                          [{file,\"gen_server.erl\"},{line,306}]},\n                      {proc_lib,init_p_do_apply,3,\n                          [{file,\"proc_lib.erl\"},{line,237}]}]}\n     Offender:   [{pid,<0.303.0>},\n                  {name,connection},\n                  {mfargs,\n                      {mochiweb_http,start_link,\n                          [{emqttd_http,handle_request,[]}]}}]\n. @lsxredrain,  pubsub sequence: emqttd_client -> emqttd_session -> emqttd_pubusb\nIf you develop plugins or modules, should call emqttd_pubsub directly\n. @toh2526, I agree that no queue in MQTT is painful for workload distribution. \"shared subscription\" or \"queue\" will be implemented in 0.10\n. Hi @KrishnaPG, The 1.x release supports \"$queue/topic\" style workload distribution. The enterprise edition of the broker will support local, shared subscriptions in R2 release.\n. @lsxredrain, the issue is not valid. You should not publish message to self when client connected.\nYou should hook \"client.subscribe.after\" in 0.9.x, publish message when the client subscribed topic.\n. This plugin cannot work in 0.9.0 release, I will fix this issue in 0.9.2. \n\n\u5728 2015\u5e747\u670815\u65e5\uff0c\u4e0b\u534811:10\uff0ctitus7lite notifications@github.com \u5199\u9053\uff1a\ni am trying to use emqtt on a windows server, which is working great.\nThing is that i am having some issues with the plugins for mysql auth/acl support. i have download both the plugin sources: emysql and emqttd_plugin_mysql into the plugins folder, created the ebin folders inside them, renamed the app.src files to .app and moved them to ebin folder and also erlc compiled the .erl files and moved them to ebin too.\nNow i did append the plugins.config to enable both of the plugins, but when i restart emqtt i get:\nload plugin emysql error: {\"no such file or directory\",\"emysql.app\"}\nload plugin emqttd_plugin_mysql error: {\"no such file or directory\",\"emqttd_plugin_mysql.app\"}\nis it something i am missing because of my luck of experience with erlang or is the issue closer to my OS type?\nregards\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/194.\n. @titus7lite, I released a new plugin design and merged the code to master branch. Could you build by yourself now? The binary package is not available now for I am waiting for emqttd_dashboard ready.\n. Please use emqttd_pubsub:publish directly. \n. ```\n     {ok, GrantedQos} = emqttd_pubsub:subscribe(TopicTable),\n\n\nemqttd_broker:foreach_hooks('client.subscribe.after', [ClientId, TopicTable]),\n+\n     lager:info([{client, ClientId}], \"Session ~s subscribe ~p, Granted QoS: ~p\",\n                 [ClientId, TopicTable, GrantedQos]),\n```\n. Could send image, audio, video with payload of MQTT. \n\nMax allowed packet size could be configured in etc/emqtt.config:\n{mqtt, [\n        %% Packet\n        {packet, [\n            %% Max ClientId Length Allowed\n            {max_clientid_len, 1024},\n            %% Max Packet Size Allowed, 64K default\n            {max_packet_size,  65536}\n        ]},\n. @dtxlink, you need client statistics or detailed connected clients?\n. emqttd_dashboard will add the JSON/HTTP API. released with 0.10.0\n. Move to https://github.com/emqtt/emqttd_dashboard/issues/8\n. okay, will plan a thoroughly benchmark with 0.10.0 release:)\n. move to 0.11.0\n. @Hades32, done in 0.12.0 release: https://github.com/emqtt/emqttd/wiki/benchmark-for-0.12.0-release\n. @dtxlink, you could join QQ Group: 12222225 to ask for help, this is not a issue really:)\n. 1. \u96c6\u7fa4\u6a21\u5f0f\u4e0b\uff0c\u5047\u8bbe\u67092\u4e2a\u8282\u70b9\uff0cA\u548cB\u3002\u5ba2\u6237\u7aefC\u8fde\u63a5\u5230A\u8282\u70b9\u4e86\uff0c\u5982\u679cA\u6302\u4e86\uff0cC\u662f\u5426\u81ea\u52a8\u8fde\u63a5\u5230B?session\u662f\u5426\u4f1a\u4e22\u5931?\n\u7b54\u590d\uff1aSession\u4e22\u5931\u3002\n2session\u7684\u6301\u4e45\u5316\u652f\u6301\u5916\u90e8\u5b58\u50a8\u5417,\u6bd4\u5982redis\u7b49?\n\u7b54\u590d\uff1aSession\u4e0d\u652f\u6301\u5916\u90e8\u5b58\u50a8\uff0c\u5982\u679c\u6709\u597d\u7684\u5916\u90e8\u5b58\u50a8\u5efa\u8bae\u6216\u65b9\u6848\uff0c\u4f1a\u8003\u8651\u5728\u540e\u7eed\u7248\u672c\u52a0\u5165\u3002\n3\u5bf9\u4e8e\u4e00\u4e2atopic\uff0c\u652f\u6301\u591a\u4e2aclient\u7ec4\u6210\u4e00\u4e2agroup\u6765\u6d88\u8d39\u5417\uff0c\u5176\u4e2dgroup\u4e2d\u6bcf\u4e2aclient\u53ea\u63a5\u6536\u5230\u90e8\u5206\u6d88\u606f\uff0c\u4fbf\u4e8e\u5ba2\u6237\u7aef\u6269\u5c55?\n\u7b54\u590d\uff1a\u7c7b\u4f3c\u8d1f\u8f7d\u5747\u8861\u7684Queue\u5417\uff1f0.10.0\u8ba1\u5212\u652f\u6301\"Shared Subscription\"\uff0c\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\u65b9\u5f0f\u5411\u8ba2\u9605\u8005\u6d3e\u53d1\u6d88\u606f\u3002\n4topic\u7684\u5b9e\u73b0\uff0ctoipc A\u4e2d\u5047\u8bbe\u670910\u6761\u6d88\u606f\uff0c10\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aef\u6d88\u8d39\u7684\u8fdb\u5ea6\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u5982\u4f55\u8bb0\u5f55client\u6d88\u8d39\u7684\u72b6\u6001\u5462\uff0c\u6bcf\u4e2a\u6d88\u8d39\u8005\u6709\u4e00\u4e2a\u961f\u5217?\n\u7b54\u590d\uff1a\u5bf9\uff0ctopic A\u7684\u6d88\u606f\u4f1a\u6d3e\u53d1\u5230\u6bcf\u4e2a\u8ba2\u9605\u5339\u914d\u7684\u5ba2\u6237\u7aef\u961f\u5217\u3002\u6d88\u8d39\u72b6\u6001\u53ef\u4ee5\u901a\u8fc7\u6269\u5c55'message.acked'\u76d1\u542c\u7eaa\u5f55\u3002\n5\u8ba2\u9605\u4e3b\u9898\u7684\u6a21\u5f0f\u5339\u914d\u662f\u5426\u652f\u6301\u6269\u5c55\u5462?\n\u7b54\u590d\uff1a\u8bf7\u63d0\u5355\u8be6\u7ec6\u4ecb\u7ecd\u3002\n. Should move to FAQ later.\n. Configure max allowed packet size in etc/emqttd.config:\n%% Max Packet Size Allowed, 64K default\n{max_packet_size,  65536}\n. please check etc/vm.args.  Start the broker with \"-name emqttd@your_node_ip\".\n. Wiki: https://github.com/emqtt/emqttd/wiki/WebSocket\n. Yes, same strategies as you described. I will update wiki later: https://github.com/emqtt/emqttd/wiki/Cluster-Design\n. @bmcustodio, please describe your issue in detail.\nFor example, I cluster two nodes:\n| Name | Node | MQTT Port |\n| --- | --- | --- |\n| emqttd1 | emqttd1@127.0.0.1 | 1883 |\n| emqttd2 | emqttd2@127.0.0.1 | 2883 |\nFollow steps:\n1. Start brokers\ncd emqttd1 && ./bin/emqttd console\ncd emqttd2 && ./bin/emqttd console\n2. Cluster\ncd emqttd2 && ./bin/emqttd_ctl cluster emqttd1@127.0.0.1\n3. Subscribe on emqttd2\nmosquitto_sub -p 2883 -t topic/test -q 2\n4. Publish to emqttd1\nmosquitto_pub -t topic/test -m haha\nIt works well.\n. 0.9.3 Release Notes: https://github.com/emqtt/emqttd/releases. No fix for cluster.\nCould check cluster nodes by CLI:\n./bin/emqttd_ctl cluster\nPlease close this issue.\n. okay, @bmcustodio,  I will try 0.9.1 later, thanks:) \n. @bmcustodio, fixed in 0.9.3 and update Wiki: https://github.com/emqtt/emqttd/wiki/Bridge.\nAny suggestions on bridge design will be welcome:)\n. 0.9.3 released, and the issue fixed.\n. Caused by your erlang environment that there are lager libraries in multiple directories.\nClosed.\n. Fixed. Please download: http://emqtt.io/downloads/ubuntu\n. @santif, Are your sure about your requirements? It means the broker should publish messages at the rate of 125K~250K msg/sec!  \nI write a new benchmark tool. Your could benchmark the case with the latest broker by yourself:\nSubscribe with 5000 clients:\n./emqtt_bench_sub -h 10.61.63.50 -i 10 -c 5000 -t bench -q 1\nPublish messages at the rate of 10 msg/sec:\n./emqtt_bench_pub -h 10.61.63.50 -c 1 -I 100 -t bench -q 1 -s 150\n. Please remove 'data/mnesia' if you change node name.\n. 1. comment the lager log\n2. gen_server2 behavihour.\n. 1. emqttd_sm creates two ets tables: mqtt_transient_session, mqtt_persistent_session to store session statistics.\n2. emqttd_ctl provide session query command.\n3. emqttd_dashboard add a page to display sessions.\n. \u8bf7\u8be6\u7ec6\u63cf\u8ff0\u5177\u4f53\u95ee\u9898\uff0c\u6bd4\u5982\u7528\u6237\u6570\u3001\u53d1\u9001\u7684\u6d88\u606fQos\u3001\u6536\u53d1\u6d88\u606f\u901f\u7387\u3001\u53d1\u9001\u6162\u8fd8\u662f\u63a5\u6536\u6162\uff1femqttd_error.log\u662f\u5426\u6709\u65e5\u5fd7\uff1f\u662f\u5426\u6253\u5370\u4e86\u5927\u91cfinfo\u65e5\u5fd7\uff1f\nBTW, emqttd_benchmark\u4e3b\u8981\u6d4b\u8bd5\u5e76\u53d1\u8fde\u63a5\u6570\u91cf\uff0c\u4f60\u662f\u5982\u4f55\u83b7\u5f97\u6536\u53d1\u901f\u7387\u6570\u636e\u7684\uff1f\n. \u6b63\u5f0f\u90e8\u7f72\u8981\u5173\u95edinfo\u65e5\u5fd7\uff0c\u5426\u5219\u5c31\u79ef\u538b\u5927\u91cf\u65e5\u5fd7\u6d88\u606f:) \u8bf7\u8bbe\u7f6eetc/emqttd.config:\n{lager, [\n    {colored, true},\n    {async_threshold, 1000},\n    {error_logger_redirect, false},\n    {crash_log, \"log/emqttd_crash.log\"},\n    {handlers, [\n        {lager_file_backend, [\n            {formatter_config, [time, \" \", pid, \" [\",severity,\"] \", message, \"\\n\"]},\n            {file, \"log/emqttd_error.log\"},\n            {level, error},\n            {size, 104857600},\n            {date, \"$D0\"},\n            {count, 30}\n        ]}\n    ]}\n ]},\n. @bayuemu, \u6211\u4eec\u9700\u8981\u8be6\u7ec6\u8ba8\u8bba\u4e0b\u573a\u666f\uff0c0.9.x\u7248\u672c\u4e3a\u6bcf\u4e2asession\u589e\u52a0\u4e86inflight window\u548cqueue\uff0c\u53c2\u6570\u914d\u7f6e\u5728etc/emqttd.config\uff0c\u9ed8\u8ba4\u5bf9Qos1/2\u6d88\u606f\uff0cinflight 100\u6761\uff0cqueue 1000\u6761\u3002\u5982\u679c\u5ba2\u6237\u7aef\u65e0\u6cd5\u53ca\u65f6ack\uff0cinflight/queue\u5c31\u4f1a\u7d2f\u79ef\uff0c\u4f60\u52a0\u6211QQ: 22061135\uff0c\u8be6\u7ec6\u8ba8\u8bba\u4f60\u7684\u5e94\u7528\u573a\u666f\u3002\n```\n       %% Session\n        {session, [\n            %% Expired after 2 days\n            {expired_after, 48},\n        %% Max number of QoS 1 and 2 messages that can be \u201cin flight\u201d at one time.\n        %% 0 means no limit\n        {max_inflight, 100},\n\n        %% Max retries for unack Qos1/2 messages\n        {unack_retries, 3},\n\n        %% Retry after 4, 8, 16 seconds\n        {unack_timeout, 4},\n\n        %% Awaiting PUBREL Timeout\n        {await_rel_timeout, 8},\n\n        %% Max Packets that Awaiting PUBREL, 0 means no limit\n        {max_awaiting_rel, 0}\n\n    ]},\n    %% Session\n    {queue, [\n        %% Max queue length. enqueued messages when persistent client disconnected,\n        %% or inflight window is full.\n        {max_length, 1000},\n\n        %% Low-water mark of queued messsages\n        {low_watermark, 0.2},\n\n        %% High-water mark of queued messsages\n        {high_watermark, 0.6},\n\n        %% Queue Qos0 messages?\n        {queue_qos0, true}\n    ]}\n\n```\n. @bayuemu, this issue is invalid. Please read Erlang Garbage collection and Memory management. And discuss benchmark of 0.9.x in issue #225.\n. Wait for 0.10.0 release. I will integrate dashboard plugin.\n. Hi, we will integrate with the dashboard plugin in 0.10.0, and release it next week.\n\n\u5728 2015\u5e747\u670828\u65e5\uff0c\u4e0a\u53489:45\uff0chzaupj notifications@github.com \u5199\u9053\uff1a\n\u6211\u7684\u6b65\u9aa4\n1\u3001\u4e0b\u8f7demqttd_dashboard\u5230plugins\u76ee\u5f55\n2\u3001\u65b0\u5efaebin\u76ee\u5f55\uff0c\u4f7f\u7528erlc\u7f16\u8bd1src\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6e90\u7801\uff0c\u8f93\u51fa\u5230ebin\u76ee\u5f55\n3\u3001\u5c06emqttd_dashboard.app.src\u62f7\u8d1d\u5230ebin\u76ee\u5f55\u5e76\u53bb\u9664.src\u540e\u7f00\n4\u3001plugins.config\u914d\u7f6e\u4e2d\u6dfb\u52a0emqttd_dashboard\u7684\u914d\u7f6e\n5\u3001load \u63d2\u4ef6\n6\u3001emqttd_ctl plugins list \u663e\u793a{emqttd_dashboard,\"emqttd web dashboard\",\"0.1\"}\n\u8fd9\u6837\u5e94\u8be5\u5c31\u662f\u63d2\u4ef6\u5b89\u88c5\u6210\u529f\u4e86\u5427\n\u4f46\u662f\u6d4f\u89c8\u5668\u8bbf\u95ee18083\u7aef\u53e3\uff0c\u663e\u793aERR_EMPTY_RESPONSE\uff1f\n\u54ea\u91cc\u8fd8\u6709\u95ee\u9898\u4e48\uff1f\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/215.\n. @hzaupj, 0.10.0 released with the new emqttd_dashboard plugin. please pull latest master branch.\n. All the code has been merged to master branch, but the Dashboard still has a issue to fix.\n\u5728 2015\u5e748\u670817\u65e5\uff0c\u4e0b\u53482:03\uff0chzaupj notifications@github.com \u5199\u9053\uff1a\n\u73b0\u5728\u8fd8\u6ca1\u67090.10.0\u7684binary packages\u53ef\u4f9b\u4e0b\u8f7d\u5427\uff1f\n. Client should connect the broker with 'clean session' 0.\n. Invalid issue.\n. Will release a new mysql_plugin in 0.10.0\n. about next week. \n. @prakashr87, The new plugin design has been merged to master branch. Could you pull the latest master branch to build?  I will release 0.10.0 binary packet when emqttd_dashboard ready.\n\nWiki: https://github.com/emqtt/emqttd/wiki/Plugin%20Design\n. If you start the broker with node name emqttd@127.0.0.1, and then stop it and change node name to cluster, you should rm 'data/mnesia/*' .\n. Okay, I will update wiki about cluster\n. @bayuemu, please add my QQ: 22061135, let's discuss this issue.\n. This metrics are invalid, one hundred connections will not consume so much memory anyway!\nPlease check issue #225.\n. Wiki: https://github.com/emqtt/emqttd/wiki/One%20Million%20Connections https://github.com/emqtt/emqttd/wiki/One%20Million%20Connections\n\n\u5728 2015\u5e747\u670830\u65e5\uff0c\u4e0b\u53486:32\uff0ceurus9989 notifications@github.com \u5199\u9053\uff1a\nI benchmark my emqttd chat server and get this error\n\"[error] acceptor on 0.0.0.0:1883 suspend 100(ms) for 2300 emfile errors!!!\"\nWhen this error happen, I can't create connections to server anymore. Current connection when error happen only is about 1000 current connections. \nMy emqttd chat system had 1 disc node and 1 ram node, error happen in ram node ( 4CPU, 15 GB memory)\nThis is my emqttd.config file, what have I done wrong? Plz help me, thank you\n%% -- mode: erlang;erlang-indent-level: 4;indent-tabs-mode: nil --\n%% ex: ft=erlang ts=4 sw=4 et\n[{kernel, \n[{start_timer, true},\n{start_pg2, true}\n]},\n{sasl, [\n{sasl_error_logger, {file, \"log/emqttd_sasl.log\"}}\n]},\n{ssl, [\n%{versions, ['tlsv1.2', 'tlsv1.1']}\n]},\n{lager, [\n{colored, true},\n{async_threshold, 1000},\n{error_logger_redirect, false},\n{crash_log, \"log/emqttd_crash.log\"},\n{handlers, [\n{lager_console_backend, info},\n{lager_file_backend, [\n{formatter_config, [time, \" \", pid, \" [\",severity,\"] \", message, \"\\n\"]},\n{file, \"log/emqttd_info.log\"},\n{level, info},\n{size, 104857600},\n{date, \"$D0\"},\n{count, 30}\n]},\n{lager_file_backend, [\n{formatter_config, [time, \" \", pid, \" [\",severity,\"] \", message, \"\\n\"]},\n{file, \"log/emqttd_error.log\"},\n{level, error},\n{size, 104857600},\n{date, \"$D0\"},\n{count, 30}\n]}\n]}\n]},\n{esockd, [\n{logger, {lager, info}}\n]},\n{emqttd, [\n%% Authentication and Authorization\n{access, [\n%% Authetication. Anonymous Default\n{auth, [\n%% Authentication with username, password\n%{username, []},\n```\n    %% Authentication with clientid\n    %{clientid, [{password, no}, {file, \"etc/clients.config\"}]},\n%% Authentication with LDAP\n% {ldap, [\n%    {servers, [\"localhost\"]},\n%    {port, 389},\n%    {timeout, 30},\n%    {user_dn, \"uid=$u,ou=People,dc=example,dc=com\"},\n%    {ssl, fasle},\n%    {sslopts, [\n%        {\"certfile\", \"ssl.crt\"},\n%        {\"keyfile\", \"ssl.key\"}]}\n% ]},\n\n%% Allow all\n{anonymous, []}\n\n]},\n%% ACL config\n{acl, [\n    %% Internal ACL module\n    {internal,  [{file, \"etc/acl.config\"}, {nomatch, allow}]}\n]}\n```\n]},\n%% MQTT Protocol Options\n{mqtt, [\n    %% Packet\n    {packet, [\n        %% Max ClientId Length Allowed\n        {max_clientid_len, 1024},\n        %% Max Packet Size Allowed, 64K default\n        {max_packet_size, 65356}\n    ]},\n    %% Client\n    {client, [\n        %TODO: Network ingoing limit\n        %{ingoing_rate_limit, '64KB/s'}\n        %TODO: Reconnet control\n    ]},\n    %% Session\n    {session, [\n        %% Expired after 24 hours\n        {expires, 24},\n        %% Max offline message queue\n        {max_queue, 100},\n        %% Store Qos0?\n        {store_qos0, false}\n    ]}\n]},\n%% Broker Options\n{broker, [\n    %% System interval of publishing broker $SYS messages\n    {sys_interval, 60},\n%% Retained messages\n{retained, [\n    %% Max number of retained messages\n    {max_message_num, 1000000},\n    %% Max Payload Size of retained message\n    {max_playload_size, 1200000}\n]},\n%% PubSub\n{pubsub, [\n    %% default should be scheduler numbers\n    %% {pool_size, 4}\n]},\n%% Bridge\n{bridge, [\n    %%TODO: bridge queue size\n    {max_queue_len, 1000},\n    %% Ping Interval of bridge node\n    {ping_down_interval, 1} %seconds\n]}\n]},\n%% Modules\n{modules, [\n    %% Client presence management module.\n    %% Publish messages when client connected or disconnected\n    {presence, [{qos, 0}]},\n```\n%% Subscribe topics automatically when client connected\n{autosub, [{\"$Q/client/$c\", 0}]}\n%% Rewrite rules\n%% {rewrite, [{file, \"etc/rewrite.config\"}]}\n```\n]},\n%% Listeners\n{listeners, [\n    {mqtt, 1883, [\n        %% Size of acceptor pool\n        {acceptors, 64},\n        %% Maximum number of concurrent clients\n        {max_clients, 1000000},\n        %% Socket Access Control\n        {access, [{allow, all}]},\n        %% Socket Options\n        {sockopts, [\n            {backlog, 1024}\n            %Set buffer if hight thoughtput\n            %{recbuf, 4096},\n            %{sndbuf, 4096},\n            %{buffer, 4096}\n        ]}\n    ]},\n    {mqtts, 9988, [\n        %% Size of acceptor pool\n        {acceptors, 64},\n        %% Maximum number of concurrent clients\n        {max_clients, 1000000},\n        %% Socket Access Control\n        {access, [{allow, all}]},\n        %% SSL certificate and key files\n        {ssl, [{certfile, \"etc/ssl/ssl.crt\"},\n               {keyfile,  \"etc/ssl/ssl.key\"}]},\n        %% Socket Options\n        {sockopts, [\n            {backlog, 1024}\n            %{buffer, 4096}\n        ]}\n    ]},\n    %% HTTP and WebSocket Listener\n    {http, 9987, [\n        %% Size of acceptor pool\n        {acceptors, 4},\n        %% Maximum number of concurrent clients\n        {max_clients, 1024},\n        %% Socket Access Control\n        {access, [{allow, all}]},\n        %% Socket Options\n        {sockopts, [\n            {backlog, 1024}\n            %{buffer, 4096}\n        ]}\n    ]}\n]}\n]}\n].\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/222.\n. @phanimahesh, I will improve the plugin loading mechanism and release it this weekend.\n. @phanimahesh, I merged new plugin design to master branch, please pull the the latest master branch and check if it works for your plugin. Wiki: https://github.com/emqtt/emqttd/wiki/Plugin%20Design\n. @bmcustodio, Please pull latest master branch and check the new plugin design. \n\n@phanimahesh,  Could we close this issue now? Thanks.\n. @bmcustodio, A new plugins design has been merged to master branch, please check it.\nWiki updated: https://github.com/emqtt/emqttd/wiki/Plugin%20Design\n. 1. packets dropped\nnetstat -s -p | grep buffer\n   20775 packets pruned from receive queue because of socket buffer overrun\n   249281 packets collapsed in receive queue due to low socket buffer\n   so without logs i got up to 350K+ solid connections\n   also i am getting these at times\n2. eaddrnotavail \nclient 34962 EXIT: {shutdown,eaddrnotavail}\n   client 34959 EXIT: {shutdown,eaddrnotavail}\n3. server kernel\nfs.file-max = 1000000\n   net.core.somaxconn = 65536\n   net.ipv4.ip_local_port_range = 500 65535\n   net.nf_conntrack_max = 1000000\n   net.netfilter.nf_conntrack_max = 1000000\n   net.ipv4.tcp_rmem = 4096 4096 16777216\n   net.ipv4.tcp_wmem = 4096 4096 16777216\n4. client kernel\nsysctl -w net.ipv4.ip_local_port_range=\"500   65535\"\necho 1000000 > /proc/sys/fs/nr_open\n\n. Done in 0.12.0: https://github.com/emqtt/emqttd/wiki/benchmark-for-0.12.0-release\n. @zgysc, './bin/emqttd_ctl' support to kick a client in 0.10.0 release. \nCommand: ./bin/emqttd_ctl clients kick  \n. do you change the node name in etc/vm.args?\n. The node name is not right. Should not use the public IP. Close the issue.\n\n\u5728 2015\u5e748\u67083\u65e5\uff0c\u4e0b\u53485:04\uff0cLenix notifications@github.com \u5199\u9053\uff1a\n\u662f\u7684\uff0c\u6539\u4e3a\u4e86 cypush@162.168.6.156\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/227#issuecomment-127170358.\n. \u8bbe\u7f6e\u516c\u7f51IP\uff0c\u4f60\u4e24\u4e2aErlang Node\u95f4\u65e0\u6cd5\u8bbf\u95ee\uff0c\u548cbroker\u7248\u672c\u6ca1\u5173\u7cfb\u3002\n\n\u6d4b\u8bd5:\n```\nerl -name a@162.168.6.156\nerl -name b@162.168.6.156\nping b on  a@162.168.6.156\nnet_adm:ping('b@162.168.6.156').\nor ping a on b@162.168.6.156\nnet_adm:ping('a@162.168.6.156').\n```\n. \u670d\u52a1\u5668\u79c1\u7f51IP\n. \u6d4b\u8bd5\u7528IP 162.168.6.156\uff0c\u4e24\u4e2aErlang Node\u662f\u5426\u53ef\u4ee5\u8bbf\u95ee:\n```\nerl -name a@162.168.6.156\nerl -name b@162.168.6.156\nping b on  a@162.168.6.156\nnet_adm:ping('b@162.168.6.156').\nor ping a on b@162.168.6.156\nnet_adm:ping('a@162.168.6.156').\n```\n. Add my QQ: 22061135, or Join QQ Group: 12222225 to discuss this issue\n\n\u5728 2015\u5e748\u67084\u65e5\uff0c\u4e0b\u534812:20\uff0cLenix notifications@github.com \u5199\u9053\uff1a\n\u4ee5\u524d\u7528 111.206.. \u8fd9\u6837\u7684\u4e5f\u662f\u6ca1\u95ee\u9898\u7684\uff0c\u6211\u518d\u770b\u770b\u3002\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/227#issuecomment-127472739.\n. pls check issue #230. 0.10.0 release the the emqttd_dashboard plugin that provide this feature.\n. 1. etc/emqttd.config\n\n{auth, [\n            %% Authentication with username, password\n            {username, []},\n1. Cli\nadd user, and store in mnesia database\n./bin/emqttd_ctl  useradd  \n\n\u5728 2015\u5e748\u67086\u65e5\uff0c\u4e0b\u53486:56\uff0cyon86 notifications@github.com \u5199\u9053\uff1a\nI would like to register users preferably using http api is there support for this...and do u provide disk persistence for username and password\nthanks\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/229.\n. @yon86, this issue has been moved to emqttd_dashboard project.\n. emqttd 0.10.0 released with a emqttd_dashboard plugin contributed by @huangdan. And you could find all connected clients by three ways:\n1. JSON/HTTP API: http://127.0.0.1:18083/api/clients\n2. Dashboard: http://127.0.0.1:18083/#/clients\n3. Admin Command: ./bin/emqttd_ctl sessions list \n. @phanimahesh,  this is a good idea:) Do your write Erlang? Please read emqttd_ws_client.erl that the module could get cookie from HTTP Upgrade request\n. @phanimahesh, If I add a 'cookie' field to 'mqtt_user' record, will it work for your project?\n. @phanimahesh, I create a branch for this issue:) and submit a quick fix. Please check it now.\n\nBranch:  https://github.com/emqtt/emqttd/tree/issue%23231\nCommit: bb02ced4f21bd44c5c7d153eef989ae49d00db51\n. @phanimahesh, It's awesome:) I merge the pull request to 0.10.0 release. Thanks.\n. 1. fix rebar.config: \n{lib_dirs, [\"../\"]}.\n2. add ebin/.placeholder file\n. Merged to 'master' branch: https://github.com/emqtt/emqttd/pull/234\n. create a plugin project: emqttd_plugin_recon\n. first release: https://github.com/emqtt/emqttd_recon\n. 1. comment the lager:error log\n2. emqttd_mqueue add 'dropped' statistics\n. Comment this error log and show inflight queue size on web dashboard.\n. @dvliman Thanks.\n. @bmcustodio please check emqttd_mod_autosub module, you could hook 'client.connected' and subscribe some topics when client connected.\n```\nload(Opts) ->\n    Topics = [{list_to_binary(Topic), Qos} || {Topic, Qos} <- Opts, 0 =< Qos, Qos =< 2],\n    emqttd_broker:hook('client.connected', {?MODULE, client_connected},\n                       {?MODULE, client_connected, [Topics]}),\n    {ok, #state{topics = Topics}}.\nclient_connected(?CONNACK_ACCEPT, #mqtt_client{client_id = ClientId, client_pid = ClientPid}, Topics) ->\n    F = fun(Topic) -> emqttd_topic:feed_var(<<\"$c\">>, ClientId, Topic) end,\n    ClientPid ! {subscribe, [{F(Topic), Qos} || {Topic, Qos} <- Topics]};\n```\n. @bmcustodio, I will support this feature.\n. @bmcustodio, I plan to design and coding this feature this weekend. Let's discuss the design in detail later:)\n. @bmcustodio, I am working on design of this issue:) The big problem is that current emqttd still not support to persist messages of a topic. It's easy to create a persistent subscription by CLI or admin HTTP API, but how to retrieve the offline messages?\n. please check etc/vm.arg config:\n```\nmax process numbers\n+P 1000000\nIncrease number of concurrent ports/sockets\n-env ERL_MAX_PORTS 1000000\n-env ERTS_MAX_PORTS 1000000\n```\n. do you check \"ulimit -n\" ?\n. \"emfile error\" means that the broker cannot open new file descriptor.\n. Any error logs when authentication with your plugin?\n\n\u5728 2015\u5e748\u670821\u65e5\uff0c\u4e0a\u53481:49\uff0cBruno M. Cust\u00f3dio notifications@github.com \u5199\u9053\uff1a\nWith the new plugin architecture, a custom-written authentication plugin that was working flawlessly under 0.9.3 stopped working in 0.10.0. I modified the plugin so as to include the etc/plugin.config configuration file and imported it according to the wiki's instructions, but it just doesn't work. Do I need to modify anything in the Erlang code itself? Did the hooks change?\nWhen I run bin/emqttd console I get\nHi!\n18:39:34.583 [info] started Apps: [emqttd_auth_custom]\n18:39:34.583 [info] load plugin emqttd_auth_custom successfully\nbeing that Hi! is written by the plugin on init/1. However, when I try to connect to the broker, the authentication tokens that used to work do not work... It seems that the plugin isn't being used for authentication. How can I make it work?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/254.\n. Please check if the auth_mod is registered successfully. For example in emqttd_plugin_mysql:\n\nok = emqttd_access_control:register_mod(auth, emqttd_auth_mysql, {AuthSql, HashType}),\nOr dump all the auth modules on console:\n(emqttd@127.0.0.1)1> emqttd_access_control:lookup_mods(auth).\n[{emqttd_auth_anonymous,[]}]\n. @bmcustodio, could you zip your plugin and send me by email if it does not contain confidential information?\n. Two ways:\n1. ./bin/emqttd_ctl plugins load emqttd_plugin_yours, then the plugin will become active.\n2. or write your plugin name to ./data/loaded_plugins file directly, for example:\nemqttd_dashboard.\nemqttd_plugin_yours.\n\n\u5728 2015\u5e748\u670821\u65e5\uff0c\u4e0b\u53489:32\uff0cBruno M. Cust\u00f3dio notifications@github.com \u5199\u9053\uff1a\n@erylee https://github.com/erylee after a few hours struggling with this I managed to get it working. I'm still not quite sure what was wrong, though --- anyway, I changed the plugin's structure to match emqttd_plugin_mysql and it seems to be working.\nThe only thing that I'm missing is how to make the plugin active by default, as on a fresh build it will only become active after I run emqttd_plugins:load(emqttd_auth_custom).. Am I missing something?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/254#issuecomment-133425891.\n. Fixed, Thanks.\n. Rewrite emqttd_ctl.erl and allow plugins to register new commands with api:\n\n-spec register_cmd(atom(), {module(), atom()}, list()) -> true.\n. This issue is caused by mnesia dir config in 'etc/vm.args':\n```\n-------------------------------------------------------------------------\nMnesia dir. NOTICE: quote the dir with '\" \"'\n-------------------------------------------------------------------------\nmnesia dir '\"data/mnesia\"'\n```\nWhen node name changed, the broker still use the same data dir for mnesia that will load the error schema.\nSolution: set mnesia data dir in 'bin/emqttd' script. Changes:\n# Extract the target cookie\n COOKIE_ARG=`grep '^\\-setcookie' $RUNNER_ETC_DIR/vm.args`\n@@ -264,9 +267,12 @@ case \"$1\" in\n         BINDIR=$ROOTDIR/erts-$ERTS_VSN/bin\n         EMU=beam\n         PROGNAME=`echo $0 | sed 's/.*\\///'`\n+        # Setup Mnesia Dir\n+        MNESIA_DIR=\"$RUNNER_DATA_DIR/mnesia/$NODE_NAME\"\n         CMD=\"$BINDIR/erlexec -boot $RUNNER_BASE_DIR/releases/$APP_VSN/$SCRIPT \\\n             -embedded -config $RUNNER_ETC_DIR/emqttd.config \\\n             -pa $RUNNER_LIB_DIR/basho-patches \\\n+            -mnesia dir \"\\\"${MNESIA_DIR}\\\"\" \\\n             -args_file $RUNNER_ETC_DIR/vm.args -- ${1+\"$@\"}\"\n         export EMU\n         export ROOTDIR\n. Fixed. Please check PR: https://github.com/emqtt/emqttd/pull/261\n. Fixed. PR: https://github.com/emqtt/emqttd/pull/263\n. @sailingchen, @chiarishow, This issue has been fixed. Please check PR: https://github.com/emqtt/emqttd/pull/323, and pull the latest master branch.\n. Duplicated with #273\n. Fixed in 0.12.1 release\n. Use 'bash' please:\n```\n!/bin/bash\n```\n. ./bin/emqttd console to check if the tcp listener is started.\n\n\u5728 2015\u5e748\u670826\u65e5\uff0c\u4e0b\u53489:51\uff0czuogan notifications@github.com \u5199\u9053\uff1a\nI install the emqtt newest zip in centos, erlang env is ok, and when i start emqtt, it shows success. Strangely, i can't connect any port(8083,18083etc) with telnet, and cant' access the dashboard(port 18083)from chrome, i insert the port rule in iptable as this 'iptables -I INPUT -p tcp --dport 8083-j ACCEPT' and save the iptable after update. To my suprise, any of these port still can't connect. so i don't know why, everything seems ok. could you give me some advice pls ? Thx.\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/270.\n. @zuogan, the broker is started successfully. please check your firewall.\n. Fixed. Commit: 07b717104b6d97650dcbb895b38093ae2760a531\n. lager:warning/2. Commit: 5117d88b7a876de3c03e4ae63dd8ca9b81550300\n. Hi Berry,\n\nCannot. emqttd 0.10.x changed the mnesia data dir to avoid the collision when node name changed. \nHave to deploy the new release and merge your configuration(such as username, acl\u2026) manually.\nRegards\nFeng\n\n\u5728 2015\u5e748\u670831\u65e5\uff0c\u4e0b\u53482:49\uff0cBerry wirattama notifications@github.com \u5199\u9053\uff1a\nHi,\nCan I upgrade to new version emqttd without turn off the service (Live update)?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/275.\n. @berrywira, will support live upgrade after 1.0 released:)\n. @sailingchen, please try to configure etc/emqttd.config:\n\n{sasl, [\n    {sasl_error_logger, {file, \"log/emqttd_sasl.log\"}}\n ]},\n...\n {lager, [\n    {colored, true},\n    {async_threshold, 1000},\n    {error_logger_redirect, true},\n...\nLager will replace the 'sasl_error_logger' and write logs to 'emqttd_error.log' .\n. @rock59, the broker side could add sockjs support, but what protocol used on the browser side?\n. @rock59,  I read some documents about SockJS. It seems SockJS use JSONP on older browsers that cannot support WebSocket. For MQTT(same to AMQP) is a binary protocol,  it will not work with JSONP, I think.\nWe have to write a Stomp over SockJS plugin to support your requirements.\n. @rock59, I will support Stomp over SockJS and release the first version in this week. I think SockJS will not be the bottleneck anyway.\n\n\u5728 2015\u5e749\u67087\u65e5\uff0c\u4e0b\u53485:45\uff0crock59 notifications@github.com \u5199\u9053\uff1a\nThis is correct.. SockJS uses Websocket in modern browsers and fallbacks to JSONP , Long Polling or other Text based Protocols(HTTP) in older browsers..\nSockJS has two problems\n1- It uses Text based protocols in fallback mode\n2- Some develpers have doubt about its performance in clustered environments\nWe must use emqtt in clustered mode and performance is critical.\nHow much it cost to develop an stomp plugin for us?\nDo you guaranty its performance in clustered mode specially when our users using older browsers with SockJS?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/277#issuecomment-138254150.\n. @lsxredrain, Stomp plugin has been ready: https://github.com/emqtt/emqttd_stomp \nWe will integrate SockJS later.\n. @rock59, The SockJS/Stomp plugin has been released in 0.11.0: https://github.com/emqtt/emqttd_sockjs\n. Hi Berry,\n1. Yes. The broker will not persist messages in current releases\n2. All brokers crashed for inconsistent_schema or other reasons?\n\nRegards\nFeng\n\n\u5728 2015\u5e749\u67083\u65e5\uff0c\u4e0b\u53484:24\uff0cBerry wirattama notifications@github.com \u5199\u9053\uff1a\nHi,\nI have 2 question :\nClient A send message to client B, when client B offline. after that service emqttd dead or restart, client B online when service has up, but client B not received retained message from client A?\nEmqttd 3 clustering, when 1 cluster crash, service dead, Client A send message to client B, when client B offline. after that service emqttd up on all cluster ( 3 cluster ), but all emqttd crash. I cannot send any message. and must delete Mnesia on all node emqttd.\nCan you help me?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/278.\n. @berrywira \n1. emqttd will support persistent messages about 0.12.0\n2. I will check the cluster issue.\n. @berrywira, I cannot reproduce the cluster issue. I start three nodes:\n\n[{'emqttd0@127.0.0.1',disc_copies},\n {'emqttd1@127.0.0.1',ram_copies},\n {'emqttd2@127.0.0.1',ram_copies}] = [schema]\n\nStep1:\nStop emqttd1 and pubsub messages on emqttd0 and emqttd2, and then start emqttd1. \nStep2:\nStop emqtt0 and pubsub messages on emqttd1 and emqttd2, and then start emqttd0.\nCould you send me your crash dump file:\n. @berrywira, I will check this issue after 0.11.0 tagged:)\n. @SakaYK, Move to https://github.com/emqtt/emqttd_plugin_pgsql/issues/1\n. ./run 127.0.0.1 1883 30000 10\n\n\u5728 2015\u5e749\u67086\u65e5\uff0c\u4e0b\u534811:32\uff0czuogan notifications@github.com \u5199\u9053\uff1a\nI download the emqttd_benchmark code from your git, and i run this benchmark test with 30000 clients, and i used two brokers for testing, emqtt and mosquitto. Of course, i adjust my client machine file max limit. Each time i run the benchmark, it only connect almost half(about 15000 clients) successfully(tcp established). and others failed with error(\" {shutdown,timeout}\"), i search many docs from others and of course adjust many linux tcp parameters. Unfortunately, they are no use, could you help me how to solve it? Cause i need to test the broker server max concurrent clients number, so i think your benchmark program can help me. Thanks.\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/281.\n. Mem/CPU of your test client/server? And any logs in emqttd/log/emqttd_error.log?\n\u5728 2015\u5e749\u67087\u65e5\uff0c\u4e0a\u534810:06\uff0czuogan notifications@github.com \u5199\u9053\uff1a\nI run the test again as your advice, set the create interval time value 10, still 30000 clients test, and this time the broker server holds 17878 clients established. There are still many clients error(\"shutdown, timeout\"). And at the same time, some clients throw other error, such as \"connecttion lost tcp_closed\" and \"shutdown connack timeout\", so do you know what is the reason? Thanks.\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/281#issuecomment-138157632.\n. I will write a benchmark guide later.\n. @zuogan, @taoyonggang. Please download my emqttd.config for your benchmark test. \n\nI create about 50K connections with 2K qos0 messages/sec on a 4G/2Core node:\n\nThe broker is on a 32G/8Cores node:\n[root@i-m7nrq9fa emqttd-0.10.3]# ./bin/emqttd_ctl stats\nsubscribers/max: 49995\ntopics/count: 50029\nclients/count: 49995\ntopics/max: 50029\nqueues/count: 0\nsessions/count: 0\nsessions/max: 0\nqueues/max: 0\nclients/max: 49995\nsubscribers/count: 49995\n[root@i-m7nrq9fa emqttd-0.10.3]# ./bin/emqttd_ctl metrics\nbytes/received: 88416722\nbytes/sent: 84902404\nmessages/dropped: 2136\nmessages/received: 1778374\nmessages/retained: 2\nmessages/sent: 1778374\npackets/connack: 49995\npackets/connect: 49995\npackets/disconnect: 0\npackets/pingreq: 0\npackets/pingresp: 0\npackets/publish/received: 1778374\npackets/publish/sent: 1778374\npackets/received: 1878364\npackets/sent: 1878364\npackets/suback: 49995\npackets/subscribe: 49995\npackets/unsuback: 0\npackets/unsubscribe: 0\n[root@i-m7nrq9fa emqttd-0.10.3]# ./bin/emqttd_ctl listeners\nlistener http:8083\n  acceptors: 4\n  max_clients: 64\n  current_clients: 0\n  shutdown_count: []\nlistener mqtt:1883\n  acceptors: 64\n  max_clients: 1000000\n  current_clients: 49995\n  shutdown_count: []\nlistener http:18083\n  acceptors: 4\n  max_clients: 512\n  current_clients: 0\n  shutdown_count: []\nTop:\n\n. https://github.com/emqtt/emqttd/wiki/emqttd.config\n. should add 'bin/etop' script\n. Fixed in 0.11.1, add two debug commands:\n./bin/emqttd_top msg_q\n./bin/emqttd_ctl broker pubsub | grep queue_len\n. emqttd_vm.erl:    {current_function, list_to_atom(lists:concat([atom_to_list(M),\":\",atom_to_list(F),\"/\",integer_to_list(A)]))};\nemqttd_vm.erl:    erlang:list_to_atom(pid_to_list(Term));\nemqttd_vm.erl:    erlang:list_to_atom(erlang:port_to_list(Term));\nemqttd_vm.erl:    erlang:list_to_atom(erlang:fun_to_list(Term));\n. The broker has supported to trace messages of a specific client or topic.\nUsage:\nemqttd_ctl trace list\nemqttd_ctl trace client <ClientId> <LogFile>\nemqttd_ctl trace client <ClientId> off\nemqttd_ctl trace topic <Topic> <LogFile>\nemqttd_ctl trace topic <Topic> off\n. @hbyscpp, Invalid issue, closed. \nFor your subscriber is persistent: \n\u8ba2\u9605\u8005\nMQTT mqtt = new MQTT();\nmqtt.setCleanSession(false);\nmqtt.setClientId(\"t123456\");\nIf you have ever connected to the broker with clientId 't123456', there will be a persistent session to enqueue messages when client is offline.\nSo the two messages you got are offline, not retained. \nYou could reproduce with mosquitto_pub/sub:\n1. publish two mesages to topic 'test'\nmosquitto_pub -t test -m 456 -q 2 -r\n   mosquitto_pub -t test -m 789 -q 2 -r\n2. subscriber connects to the broker for the first time\nmosquitto_sub -t test -q 2 -c -i t12345\n   789\n3. disconnect the subscriber and publish messages again\nmosquitto_pub -t test -m 456 -q 2 -r\n   mosquitto_pub -t test -m 789 -q 2 -r\n4. subscriber connects the broker again\nmosquitto_sub -t test -q 2 -c -i t12345\n   456\n   789\nYou got two offline messages for persistent session.\n. Invalid issue. You still use the default etc/plugin.config: https://github.com/emqtt/emqttd_plugin_mysql/blob/master/etc/plugin.config\n\"#28000Access denied for user ''@'localhost' (using password: YES)\"\n. @phanimahesh, agree:) would you like to fork the project to try rebar3 first? \n. @joaohf, cool:) I agree that the plugins should be revisited. A plugin is just a normal erlang application that could be started/stopped as required. Maybe I need to change the project structure for rebar3.\n. @joaohf, You did right:) I developed an emqttd_sockjs plugin yesterday and tried to manage the dependencies with:https://github.com/emqtt/emqttd_sockjs/blob/master/rebar.config. But I failed to make a release for rebar will not include the plugin's deps if I don't modify the rel/reltool.config...( \n. In rebar.config:\n%% fail_on_warning,\n{erl_opts, [debug_info, {parse_transform, lager_transform}]}.\nPlease check how to configure this options in rebar3.\n. @joaohf, I resolved the dependency issue of plugins on my 'dev-feng' branch by adding  'rel/reltool.config.script' :)  Each plugin could have a 'rebar.config' file and let rebar to manage the deps now.  Please check if rebar3 could work with 'rebar.config.script', 'reltool.config.script' like rebar.\n. How about the ebin/emqttd_plugin_xxx.app to configure environments of a plugin? \n. @phanimahesh, Agree with you. Could we copy all of the plugin's config files to emqttd/etc/plugins/ folder when building a release?\nemqttd/etc/plugins/\n     emqttd_dashboard.config\n     emqttd_stomp.config\n     emqttd_plugin_pgsql.config\n. Switch to erlang.mk in 2.0 release: https://github.com/emqtt/emqttd-relx\n. pipe_dir error, fixed.\n. @taoyonggang, This is the traditional DMA copy trick that Kafka sendFile used. It works for persistent queue/log systems that need high throughput. It's not suitable for in-memory pubsub broker like emqttd that aimed to handle massive connections with low latency and low throughput.\nClosed, Thanks. \n. @hbyscpp, Please check issue: https://github.com/emqtt/esockd/issues/10\nThis issue is caused by aliyun's health check that will shutdown the TCP connection right after 3 way handshake. esockd 2.7.x close the socket quietly when 'enotconn' error happened.\nIf you build emqttd from source, please 'rebar update-deps' to update esockd.\n. MQTT protocol supports 'clean session' flag.  If the 'clean session' is set to false, the broker will keep a session to receive messages when the client is disconnected. \n. Please check logs first, or start the broker with console. \n. ```\nbmcustodio@n1$ bin/emqttd start\nbmcustodio@n2$ bin/emqttd console\nbmcustodio@n2$ bin/emqttd_ctl cluster emqttd@n1\n```\nstart emqttd on n2 with console, and if any error messages when load your plugin?\n. \"Erlang MQTT Broker 0.10.0 is running now\"?  Do you compile the broker from the latest master branch?\nPlease check emqttd_ctl:cluster/1 function, the plugins should be unloaded before cluster:\nI fixed this issue in 0.10.1. PR: https://github.com/emqtt/emqttd/pull/261/files\ncluster([SNode]) ->\n    Node = node_name(SNode),\n    case net_adm:ping(Node) of\n    pong ->\n        case emqttd:is_running(Node) of\n            true ->\n                emqttd_plugins:unload(),\n. fixed?\n. @therahulprasad, could write an extended module like emqttd_mod_autosub.erl, then configure etc/emqttd.config to add your module.\n```\n   %% Modules\n    {modules, [\n    {yourmod, []},\n\n    %% Client presence management module.\n    %% Publish messages when client connected or disconnected\n    {presence, [{qos, 0}]}\n\n    %% Subscribe topics automatically when client connected\n    %% {autosub, [{\"$Q/client/$c\", 0}]}\n\n```\nIn the extended module named emqttd_mod_yourmod:\nclient_connected(?CONNACK_ACCEPT, #mqtt_client{ username = <<\"user_\", UniqueId/binary>>, client_pid = ClientPid}, Opts) ->\n    emqttd_client:subscribe(ClientPid, [{<<\"user/\", UniqueId/binary>>, qos1}]);\n. This feature has been supported in 0.10.x. The emqttd_mod_autosub.erl module supports $c, $u variables without regex pattern. You could use the whole username in the topic, I think:)\n{autosub, [{\"user/$u\", 0}]}\n. 1. Memory\n2. Only topics tree copied.\n3. No. Will support later.\nWiki: https://github.com/emqtt/emqttd/wiki/Cluster%20Design\n. 1. Client will connect another node, messages not delivered will be dropped. \n2. No. I plan to persist subscriptions/messages to leveldb or kakfa after emqttd 1.0. released.\n. @therahulprasad, what's type of your application? IoT, Mobile IM? Please check https://github.com/emqtt/emqttd_plugin_template. Could extend the broker by hooks and plugin, and persist subscriptions/messages to redis, mongodb or sql database.\n. Hi Rahul, I sent a mail to rahul@bobbleapp.me.\n. Move to https://github.com/emqtt/emqttd_stomp/issues/1\n. @FlowerWrong, Wiki:\nhttps://github.com/emqtt/emqttd/wiki/One%20Million%20Connections\nhttps://github.com/emqtt/emqttd/wiki/etc-emqttd.config-for-benchmark\nhttps://github.com/emqtt/emqttd/wiki/etc-vm.args-for-benchmark\n. @muhun, You could use Paho Java Client or https://github.com/fusesource/mqtt-client\nThese client libraries works well with emqttd broker:) \n. Okay, The broker could support 1 million client connections now:) Please check Wiki for benchmark and tuning guide.\n. @elsennov, Paho.\n. @berrywira, How many connections, messages per sec? How much memory consumed?  Please check logs to find if there are errors occurred.\n. @berrywira,there are something wrong... It should not consume memory more than 100M!\n```\n./bin/emqttd_ctl broker\n./bin/emqttd_ctl vm\n./bin/emqttd_ctl listeners\n```\nPls zip your log files and send to me: feng@emqtt.io, Thanks.\nBTW, your OS?\n. @hbyscpp, the broker version? please attach result of the admin commands:\n```\n./bin/emqttd_ctl vm\n./bin/emqttd_ctl stats\n./bin/emqttd_ctl listeners\n```\nAnd then send me your logs.\nThe mail I sent to @berrywira:\nThere are three issues I found from logs:\n1. Should remove the \u2018info\u2019 level log of lager:  \n{lager, [\n    {colored, true},\n    {async_threshold, 1000},\n    {error_logger_redirect, false},\n    {crash_log, \"log/emqttd_crash.log\"},\n    {handlers, [\n        {lager_file_backend, [\n            {formatter_config, [time, \" \", pid, \" [\",severity,\"] \", message, \"\\n\"]},\n            {file, \"log/emqttd_error.log\"},\n            {level, error},\n            {size, 104857600},\n            {date, \"$D0\"},\n            {count, 30}\n        ]}\n    ]}\n ]},\n1. Configure pool_size of pubsub:\n%% PubSub\n        {pubsub, [\n            %% default should be scheduler numbers\n           {pool_size, 8}\n        ]},\n....\n. @berrywira, @hbyscpp. Please check your Erlang/OTP version. It seems this issue is caused by Erlang/OTP R18.0 binary memory leak: http://erlang.org/pipermail/erlang-questions/2015-September/086098.html\nR18.1 released: http://www.erlang.org/download.html\n. @berrywira, yes, just an Erlang/OTP R18 issue. All the binary memory allocated for logs will not be GC.\n1. Keep the 'info' log level if Erlang/OTP upgraded. \n2. Tune the pubsub pool_size\nThanks for you bug report:)\n. For QoS1/2 message, the message id contains timestamp:\nemqttd_guid:timestamp(MsgId)\n. Want the timestamp from client??? You have to sync the time with the broker first, and then calculate the timestamp.\n. @bmcustodio,  'message.publish' hook.\nhttps://github.com/emqtt/emqttd_plugin_template/blob/master/src/emqttd_plugin_template.erl\n. Invalid now.\n. This issue is caused by emqttd_plugin_template plugin. \n```\ndiff --git a/src/emqttd_plugin_template.erl b/src/emqttd_plugin_template.erl\nindex b120d02..466a18e 100644\n--- a/src/emqttd_plugin_template.erl\n+++ b/src/emqttd_plugin_template.erl\n@@ -79,7 +79,8 @@ on_client_subscribe_after(ClientId, TopicTable, _Env) ->\n     io:format(\"client ~s subscribed ~p~n\", [ClientId, TopicTable]).\non_client_unsubscribe(ClientId, Topics, _Env) ->\n-    io:format(\"client ~s unsubscribe ~p~n\", [ClientId, Topics]).\n+    io:format(\"client ~s unsubscribe ~p~n\", [ClientId, Topics]),\n+    Topics.\n```\n. Hi, @rock59, please write your own auth/ACL plugin. The template: https://github.com/emqtt/emqttd_plugin_template\n. @grimmlink, I am tagging 0.11.0 beta, and this release will use rebar to manage plugin's deps.\nPlease 'git pull && make' again, and check the latest Wiki: https://github.com/emqtt/emqttd/wiki/Plugin%20Design\n. @grimmlink, the ACL rule is not right. The 'ipaddr', 'username' and 'clientid' fields should not have a value in the same time. Please check discussion: https://github.com/emqtt/emqttd_plugin_pgsql/issues/1\n\n. @phanimahesh, fixed, thanks:)\n. @bmcustodio, I write Erlang with vim. If you try to use intellij-erlang, you should import the project as 'rebar' mode, I think.\nFor erlang is a FP lauguage, I never set breakpoints and debug the program:) Write some tests, let it crash, and fix it.\n. Try:\ncase emqttd_cm:lookup(ClientId) of\n    undefined -> ok;\n    Client -> do_something\nend.\n. Of c. Cluster will not replicate the client.\n. @galvezlj, would you like to use mqtt.js test subscription to benchmark 0.12.0 release again?\n. @bmcustodio, There is a plan to persist MQTT messages. I am considering LevelDB, Cassandra, Kafka or a storage wrote from scratch. What's your suggestion?\n. Haha:) I really like Cassandra too. But that means users of emqttd need extra work to deploy and configure Cassandra. If we use LevelDB, we could integrate with eLevelDB library. Your idea?\n. @bmcustodio, plan to support Cassandra and Kafka fist:)\n. @kennethalong, I will integrate the broker with Kafka and Cassandra after 0.14.x released:) \n. @bangarharshit, I will check the docs:)\n. @aksswami, sorry for late reply, preparing for 1.0 release these days. We will integrate emqttd with various backends including SQL or NoSQL databases when 1.0 is ready.\n. Released a 'EMQ X' Product to help persist MQTT messages.\n. Ignore the warning messages.\n. Attach to the VM and find the processes with large heap:\n```\n./bin/emqttd attach\nerlang:process_info(pid(0, 443,0)).\n```\nCTRL+D to exit.\n. Suppress sysmon messages: https://github.com/emqtt/emqttd/pull/338\n. @rock59, plan to support Kafka and Cassandra.\n. We have released a 'EMQPlus' product to help persist MQTT messages in Redis, MySQL, PostgreSQL, MongoDB and Kafka. I'd like to close this issue now.\n. ./bin/emqttd console to check what's wrong.\n. thanks\n. The current release is stable enough. 1.0 will come soon.\n. The feature is supported in 0.14 release. \netc/emqttd.config:\n```\n        %% PubSub and Router\n        {pubsub, [\n            %% Default should be scheduler numbers\n            %% {pool_size, 8},\n        %% Subscription: disc | ram | false\n        {subscription, disc},\n\n        ......\n\n```\n. Hi, @rock59, please check etc/emqttd.config: \n%% MQTT Protocol Options\n    {mqtt, [\n        %% Packet\n        {packet, [\n            %% Max ClientId Length Allowed\n            {max_clientid_len, 1024},\n            %% Max Packet Size Allowed, 64K default\n            {max_packet_size,  65536}\n        ]},\n. @phanimahesh, agree that this is a boring issue.\nIf we use relative path, have to \"-inclue(\"../../../include/emqttd.hrl\"). It seems a bit ugly:( \n. Hi @phanimahesh, I comment the 'lib_dir'  in rebar.config:)\n. @bmcustodio, sorry for late reply. A business trip to Beijing yesterday. \nThe retained messages will be delivered when new subscriptions created. The persistent sessions(clean session = 0) cached all the subscriptions, so retained messages will not be dispatched when a client resume an existed session. \nI will check the MQTT V3.1.1 protocol specification to check if the broker works properly. \n. Okay, I will check it later. Maybe we could add a config item in etc/emqttd.config to support this feature.\n. Close the issue.. Has been fixed in 1.x\n. @zhaohaolin, The 'sysmon' module will produce logs like:\n18:22:38.248 <0.246.0> [error] long_schedule warning: pid = <0.68.0>, info: [{timeout,114},\n{in,\n{memsup,get_worst_memory_user,\n3}},\n{out,{memsup,process_memory,1}}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{memsup,get_worst_memory_user,3}},{registered_name,memsup},{status,runnable},{message_queue_len,0},{group_leader,<0.64.0>},{priority,low},{trap_exit,true},{reductions,287545586},{binary,[]},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,29496632},{total_heap_size,3686956},{heap_size,1199557},{stack_size,19},{min_heap_size,233}]\n18:23:38.802 <0.246.0> [error] long_schedule warning: pid = <0.68.0>, info: [{timeout,114},\n{in,\n{memsup,get_worst_memory_user,\n3}},\n{out,{memsup,process_memory,1}}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{memsup,get_worst_memory_user,3}},{registered_name,memsup},{status,runnable},{message_queue_len,0},{group_leader,<0.64.0>},{priority,low},{trap_exit,true},{reductions,289557189},{binary,[]},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,29496632},{total_heap_size,3686956},{heap_size,1199557},{stack_size,19},{min_heap_size,233}]\netc/emqttd.config:\n```\n    %% Erlang System Monitor\n    {sysmon, [\n    %% Long GC, don't monitor in production mode for:\n    %% https://github.com/erlang/otp/blob/feb45017da36be78d4c5784d758ede619fa7bfd3/erts/emulator/beam/erl_gc.c#L421\n    {long_gc, false},\n\n    %% Long Schedule(ms)\n    {long_schedule, 100},\n\n    %% 8M words. 32MB on 32-bit VM, 64MB on 64-bit VM.\n    %% 8 * 1024 * 1024\n    {large_heap, 8388608},\n\n    %% Busy Port\n    {busy_port, true},\n\n    %% Busy Dist Port\n    {busy_dist_port, true}\n\n]}\n\n```\n. Fixed in 0.13.0 release:\n1. emqttd_cm will monitor all registered clients\n2. emqttd_session will change clean_sess from true to false.\n. Fixed in 0.13.0:\nSendFun = fun(Data) ->\n        try Connection:async_send(Data) of\n            true -> ok\n        catch\n            error:Error -> exit({shutdown, Error})\n        end\n    end,\n. Upgrade eSockd to 3.0\n. Upgrade to eSockd3.0 and support asynchronous TCP send/recv.\n. Add './bin/emqttd_ctl subscriptions' command:\n$ ./bin/emqttd_ctl subscriptions\nsubscriptions list                      #list all subscriptions\nsubscriptions show <ClientId>           #show subscriptions of a client\nsubscriptions add <ClientId> <Topic> <Qo#add subscription\nsubscriptions del <ClientId> <Topic>    #delete subscription\n. HTTP API should be supported by dashboard plugin:  https://github.com/emqtt/emqttd_dashboard/issues/40\n. @VikramTiwari, Thanks.\n. What\u2019s benchmark tool you used? How many SUBSCRIBE requests per second? emqttd will create topic trees, subscriptions in mnesia database.\n\n\u5728 2015\u5e7410\u670829\u65e5\uff0c\u4e0b\u53489:10\uff0cBruno M. Cust\u00f3dio notifications@github.com \u5199\u9053\uff1a\nI recently started noticing that subscribing to multiple topics at once (multiple topics per SUBSCRIBE packet) takes a very long time. In a simple test I tried subscribing to multiple topics of the form sensor/{UUID}/# and got the following results:\n[2015-10-29 13:04:07.423] [I] Subscribing 50 topics: 26ms\n[2015-10-29 13:04:07.502] [I] Subscribing 100 topics: 75ms\n[2015-10-29 13:04:07.834] [I] Subscribing 150 topics: 327ms\n[2015-10-29 13:04:08.485] [I] Subscribing 200 topics: 646ms\n[2015-10-29 13:04:09.497] [I] Subscribing 250 topics: 1010ms\n[2015-10-29 13:04:11.633] [I] Subscribing 300 topics: 2126ms\n[2015-10-29 13:04:15.666] [I] Subscribing 350 topics: 4029ms\n[2015-10-29 13:04:22.090] [I] Subscribing 400 topics: 6421ms\n[2015-10-29 13:04:32.312] [I] Subscribing 450 topics: 10218ms\n[2015-10-29 13:04:46.822] [I] Subscribing 500 topics: 14503ms\nI tried switching emqttd with vernemq and got the following results:\n[2015-10-29 13:09:29.313] [I] Subscribing 50 topics: 14ms\n[2015-10-29 13:09:29.338] [I] Subscribing 100 topics: 21ms\n[2015-10-29 13:09:29.366] [I] Subscribing 150 topics: 24ms\n[2015-10-29 13:09:29.470] [I] Subscribing 200 topics: 101ms\n[2015-10-29 13:09:29.574] [I] Subscribing 250 topics: 100ms\n[2015-10-29 13:09:29.701] [I] Subscribing 300 topics: 101ms\n[2015-10-29 13:09:29.889] [I] Subscribing 350 topics: 184ms\n[2015-10-29 13:09:30.043] [I] Subscribing 400 topics: 145ms\n[2015-10-29 13:09:30.219] [I] Subscribing 450 topics: 172ms\n[2015-10-29 13:09:30.336] [I] Subscribing 500 topics: 114ms\n@erylee https://github.com/erylee do you have any idea about what can be causing this? Is there anything that can be made to speed things up?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/365.\n. @bmcustodio, I will benchmark this issue later:) \n. @bmcustodio, This issue fixed in 0.14 release. \n\nBenchmark on my Air:\n80ms to subscribe 500\n130ms to subscribe 1000\n3s to subscribe 10000\n. Fixed. 0.14 release could handle 4000+ SUBSCRIBE/second.\n. @phanimahesh, Disconnect the client when ACL deny occurs? Or extend PUBACK packet with an error payload?\n. @phanimahesh, PUBACK packet has no payload according to MQTT V3.1.1 protocol specification. I think MQTT.org will improve this design later.\n. @chriswue The MQTT 5 specification will return an error code in PUBACK package. We plan to support MQTT 5 in EMQ 3.0, which will be released soon.. benchmark for 0.13.0 release\n. # ./bin/emqttd_ctl recon bin_leak\n```\n{<10106.187.0>,-181,\n [emqttd_pubsub_1,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10106.194.0>,-63,\n [emqttd_pubsub_8,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10106.189.0>,-59,\n [emqttd_pubsub_3,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10106.228.0>,-58,\n [emqttd_alarm,\n  {current_function,{gen_event,fetch_msg,5}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10106.192.0>,-57,\n [emqttd_pubsub_6,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10106.227.0>,-5,\n [emqttd_broker,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10106.235.0>,-4,\n [emqttd_sysmon,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n...\n```\n. Fixed in 0.14. Hibernate if subscriber 'DOWN' received to gc binary:\n```\nhandle_info({'DOWN', _Mon, _Type, DownPid, _Info}, State) ->\nRoutes = ?ROUTER:lookup_routes(DownPid),\n\n%% Delete all routes of the process\n?ROUTER:delete_routes(DownPid),\n\n?HELPER:aging([Topic || Topic <- Routes, not ?ROUTER:has_route(Topic)]),\n\n{noreply, State, hibernate};\n\n```\n. Hi Igor, call emqttd_pubsub:publish/1 API directly?\n\n\u5728 2015\u5e7411\u670810\u65e5\uff0c\u4e0b\u53489:31\uff0cIgor Prots notifications@github.com \u5199\u9053\uff1a\nI'm developing plugin for emqttd, and have a question: how I can publish message to client from plugin after subscription not using once more emqttc and TCP connection ?\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/376.\n. It works.\n\u5728 2015\u5e7411\u670810\u65e5\uff0c\u4e0b\u534810:06\uff0cIgor Prots notifications@github.com \u5199\u9053\uff1a\nI think I found a solution =)\non_client_subscribe_after(_ClientId, TopicTable, _Env) ->\n    [{Topic, _Type}] = TopicTable,\n    Msg = emqttd_message:make(broker, Topic, <<\"Hello client\">>),\n    io:format(\"Message for client: ~p~n\", [Msg]),\n    Res = emqttd_pubsub:publish(Msg),\n    io:format(\"emqttd_pubsub:publish: ~p~n\", [Res]).\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/376#issuecomment-155429500.\n. The solution is elegant:)\n\non_client_subscribe_after(_ClientId, TopicTable, _Env) ->\n    .....\n. emqttd_cm:  dict to store mref -> clientId\n. ./bin/emqttd console \n\u67e5\u770b\u63a7\u5236\u53f0\u9519\u8bef\uff1f\u542f\u52a8\u672c\u6765\u5c31\u4e0d\u5e94\u8be5root\uff0c\u5e94\u8be5\u662fhostname\u4e4b\u7c7b\u95ee\u9898\u3002\n\n\u5728 2015\u5e7411\u670812\u65e5\uff0c\u4e0a\u534811:59\uff0ckansifang notifications@github.com \u5199\u9053\uff1a\n\u6211\u5728CentOS\u7cfb\u7edf\u4e0a\u4f7f\u7528\u975eroot\u7528\u6237\u542f\u52a8emqttd\u65f6\u542f\u52a8\u4e0d\u4e86\uff0c\u9519\u8bef\u4fe1\u606f\u5982\u4e0b\uff1a\n[emqttd]$ bin/emqttd start\nemqttd failed to start within 15 seconds,\nsee the output of 'emqttd console' for more information.\nIf you want to wait longer, set the environment variable\nWAIT_FOR_ERLANG to the number of seconds to wait.\n\u2014\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/379.\n. @huyp, MQTT is a PubSub protocol and route messages by Topics. If you want to send messages, just publish to topic, it's not necessary to know if the clients are online, I think.\n. @s1ckness, could you past your php code?  Or send me logs of the broker. My email: feng@emqtt.io\n. @s1ckness, I cannot reproduce this issue with the php code u sent to me. \n. @ReadmeCritic, Thanks:)\n. hi, @com9009, did you configure the '-name emqttd@private ip' in etc/vm.args? \n\nplease try to debug, for example:\non host 10.10.10.10, start erl console:\nerl -name a@10.10.10.10\nhost 10.10.10.11, start erl console:\n```\nerl -name b@10.10.10.11\nEshell V6.4  (abort with ^G)\n1> net_adm:ping('a@10.10.10.10').\n```\n. Duplicated with #496.\n. The benchmark report: http://emq-xmeter-benchmark-en.readthedocs.io/en/latest/. @obi458, could you create a Pull Request for this issue?\n. hi @dophlin, it's easy to bridge to RabbitMQ, I think. I will plan this feature. \n. hi @dophlin, about bridge of the emqttd broker: http://docs.emqtt.com/en/latest/bridge.html\nemqttd can only bridge to another emqttd broker, cannot bridge to mosquitto.\n. Hi @dophlin, I plan to develop a plugin to bridge emqttd to RabbitMQ. For we decide to tag 1.0 soon, I am writing documents for the project these days. The RabbitMQ bridge will be released after 1.0 ready.\n. Thanks. Fix issue #387 \n. hi @sakayoga, please attach the log/emqttd_sasl.log, log/emqttd_error.log files. The 'crasher' above is not the root cause.\n. @sakayoga, which release you are running on EC2?  And please check your 'etc/vm.args', crasher is usually caused by there are not enough processes or ports.\n```\nmax process numbers\n+P 8192\nSets the maximum number of simultaneously existing ports for this system\n+Q 8192\nmax atom number\n+t\nSet the distribution buffer busy limit (dist_buf_busy_limit) in kilobytes.\nValid range is 1-2097151. Default is 1024.\n+zdbbl 8192\n-------------------------------------------------------------------------\nEnv\n-------------------------------------------------------------------------\nIncrease number of concurrent ports/sockets, deprecated in R17\n-env ERL_MAX_PORTS 8192\n-env ERTS_MAX_PORTS 8192\n```\n. hi @sakayoga, First, please backup all the logs if the broker crashed. Second, the \"+Q 8192\" should be lager than max allowed clients, and the \"+P 8192\" should be larger than max allowed clients * 2:)\n. hi @sakayoga, could we close this issue now?\n. hi @abhidtu, from feedbacks of emqtt users, there are three ways:\n1. LVS+Virtual IP Address\n2. Load Balancer provided by the cloud vendor\n3. Random IPAddress\n. hi @kevsmith, the 'io:format' will print log into 'log/erlang.log'. \n. Hi @kevsmith, Thanks for the PR.  The emqttd 1.1 has been released with eSockd 4.0, and supports to  configure the human-friendly IP Address now:\n```\n       {mqtt, {\"127.0.0.1\", 1883}, [\n            %% Size of acceptor pool\n            {acceptors, 16},\n        %% Maximum number of concurrent clients\n        {max_clients, 512},\n\n        ...\n\n    ]},\n\n```\n. emqttd_aut_ldap is a module, not a plugin. Please uncomment LDAP authentication config in etc/emqttd.config :\n%% Authentication with LDAP\n            % {ldap, [\n            %    {servers, [\"localhost\"]},\n            %    {port, 389},\n            %    {timeout, 30},\n            %    {user_dn, \"uid=$u,ou=People,dc=example,dc=com\"},\n            %    {ssl, fasle},\n            %    {sslopts, [\n            %        {\"certfile\", \"ssl.crt\"},\n            %        {\"keyfile\", \"ssl.key\"}]}\n            % ]},\n. nodetool cannot access ~/.erlang.cookie, remove it first:\nrm ~/.erlang.cookie\n. Hi @Bazmundi,  could only start one instance, otherwise the later one will crash for erlang node name collision.\n. Hi @abhidtu, this is not a bug, the 'retain=true' message will be stored and redelivered. Please check MQTT specification. \n. hi @abhidtu, have you read the specification about the 'retain' flag?  could we close this issue now?\n. @abhidtu, current design of the retained message is appropriate, I think.\nFirst, the retained messages we published to one node, should be received by clients connected to other nodes in the cluster. So each node in the cluster will replicate the retained messages.\nSecond, if a node crashed,  the session and subscriptions of a client will be removed by the broker. The same client connected to another node later will be treated as a new one. \n. hi @joaohf, really an awesome PR:) I am preparing a PPT for an open source meeting now, and will check the PR in detail later. Thanks for your great work, @joaohf. \n. @hachreak, yeah:) We plan to replace rebar with erlang.mk in 2.0 release.\n. I think erlang.mk did the thing right. Make is the right tool for make:)\nhttps://medium.com/@jlouis666/why-i-use-erlang-mk-708597c0dd08#.ybt74nvoc\n. Hi @hachreak, Thanks. I will merge the PR in 1.1 release.\n. @hachreak, 1.1 release will be ready next week:) I will merge the PR to emq10 branch first.\n. @Yongke, we are working on this feature which will be released in 2.0\n. The 'Shared Subscription' feature has been released in 2.0-beta.3. For example:\nmosquitto_sub -t '$share/group/topic'\n. @prakashr87 @abhidtu, I am working on this plugin and coding the connection pool now. The first release will be ready by this weekend if everything going on well:)\n. @prakashr87 @abhidtu, please checkout https://github.com/emqtt/emqttd_mongodb plugin. The release has been test ready.\n. This issue will be closed for mongodb plugin has been released. If any issues, please submit to  https://github.com/emqtt/emqttd_mongodb.\n. Move to:\n- etc/emqttd.config for benchmark\n- etc/vm.args for benchmark\n- linux kernel tuning\n. Please check the openssl version of your centos:\nopenssl version\nOpenSSL 1.0.1e-fips 11 Feb 2013\n. @yifengjin, this issue has been fixed in 0.16 release. Please check issue #449.\n. 'ulimit -n' is not enough, please check wiki: https://github.com/emqtt/emqttd/wiki/linux-kernel-tuning\n. Change 'route' table to 'duplicate_bag' type.\n. Fixed in 0.15.0 release\n. Fix Commit: https://github.com/emqtt/emqttd/commit/4f9d42947853dce562e94269f905aed5ff5f6949\n. This feature has been implemented in 0.17.0 release. We create two mnesia tables for static or dynamic subscriptions:\n1. 'backend_subscription' table(disc_copies) for static subscriptions\n2. 'subscription' table(ram_copies) for dynamic subscriptions\n. etc/emqttd.config:\n{mqtt, 1883, [\n            ...\n            %% Socket Options\n            {sockopts, [\n                {ifaddr, {192,168,33,13}},\n                ...\n            ]}\n        ]},\n. 1. The emqttd_mqueue module supports '{type, priority}' now: https://github.com/emqtt/emqttd/blob/master/src/emqttd_mqueue.erl\n2. The etc/emqttd.config supports more options for queue:\n```\n        %% Queue\n        {queue, [\n            %% simple | priority\n            {type, priority},\n        %% Topic Priority: 0~255, Default is 0\n        %% {priority, [{\"topic/1\", 10}, {\"topic/2\", 8}]},\n        ....\n\n```\n. Hi @VikramTiwari, I have no idea about how to use GPU on Erlang/OTP platform, any examples? Thanks:)\n. Merge later for docs and plugins not ready.\n. @shrikantlahase, please check wiki: https://github.com/emqtt/emqttd/wiki/Bridge\n. @shrikantlahase, I am not sure if mosquitto could bridge to emqttd. If any issues, please contact us:)\n. Hi @shrikantlahase \n1. Please add my Skype: feng.emqtt.io to discuss the bridge issue.\n2. We also use The paho client library written in python to test emqttd broker, so it should work well with emqttd.\n. please open the console log in etc/emqttd.config, and then \u2018./bin/emqttd console\u2019 to debug:\n{handlers, [\n        {lager_console_backend, info},\n       ...\n. @shrikantlahase, @jianglinchun mosquitto bridge works now.\nThe mosquitto bridge uses a special 0x83 as protocol version in the CONNECT packet.\nPlease check out the '0.17' branch.\n. Please check the console log of emqttd broker, configure etc/emqttd.config:\n{lager_console_backend, info},\n. @jianglinchun The broker will reply 'unacceptable protocol version' error code when mosquitto bridge CONNECT packet received. I fixed in the latest 0.17 branch, please pull and verify.\n. hi @shrikantlahase, could we close the issue?\n. Hi Giorgio, Thanks.\n. fixed in 2.0\n. @gbrehmer What type of application? Current release of the broker will not persist Last Will Messages.\n. hi @dianyong, wiki: https://github.com/emqtt/emqttd/wiki/Authentication\n. The issue caused by incorrect 'ulimit -n' setting. I will change the default 'max_clients' of the broker to 512.\n. @callbay, The issue is fixed in gen_logger library: https://github.com/emqtt/esockd/issues/25\n. Hi @Prots, please 'grep crasher log/*'. It seems some services crashed when the broker started.\nBTW, we could discuss the issue by Skype: feng.emqtt.io\n. @87sanchavan, please load the 'subscription' module:\n```\n    %% Modules\n    {modules, [\n        ......\n        %% Subscribe topics automatically when client connected\n        {subscription, [\n            %% Subscription from stored table\n            stored,\n        %% $u will be replaced with username\n        {\"$Q/username/$u\", 1},\n\n        %% $c will be replaced with clientid\n        {\"$Q/client/$c\", 1}\n    ]}\n    ......\n\n.\n  %% Subscription: disc | ram | false\n       %% {subscription, ram},\n        {subscription, disc},\n```\nThe broker will persist the subscriptions to disc, but will not persist offline messages.\n. $ ./bin/emqttd_ctl cluster\ncluster join <Node>                     #Join the cluster\ncluster leave                           #Leave the cluster\ncluster remove <Node>                   #Remove the node from cluster\ncluster status                          #Cluster status\n. Fixed. Print a hint message if the username authentication is not enabled.\n. @bangarharshit @Nishant-Pathak I will check this feature in 0.17 release.\n. @mingchuno, sorry for late reply. The new documents have been released on http://docs.emqtt.com/en/latest/cluster.html.\n. @mingchuno Thanks. Please help me review the documents. For english isn't my mother tongue, there might be many problems in the documents. Please submit a PR if any issue you found:) \n. hi @TangMonk, please configure username authentication in etc/emqttd.config first:\n{auth, [\n     %% Authentication with username, password\n     {username, []},\n     ...\n. @TangMonk, I will improve this CLI later, Please check issue #450\n. Hi @bangarharshit,Thanks for your awesome work. I am considering to optimize the hooks design for chat application these days. Reading the slides now:)\n. @bangarharshit, Some mobile push applications do not use HAProxy and connect to the broker directly by round-robbin DNS. One instance of emqttd broker handles about 500K concurrent MQTT connections in production. \nWe have not done benchmark test for MQTT Over WebSocket connections. But I believe the broker could also handle 500K WebSocket connections. The difference of two types of connection is:\nNormal MQTT Connection(1883):\nTCP-->Client Pid -> Session Pid\nMQTT Over WebSocket(8083):\nWebSocket-->WS Pid -> WsClient Pid -> Session Pid\n. Tick at interval of (Keepalive * 0.75).\n. hi @rock59, Thanks. I researched the radix tree of nanomsg months ago and tried to improve the design of emqttd broker. For we use mnesia database of erlang to store topic trie, the bottleneck will not be trie structure but the trie size. Finally I removed the topic names from the trie and only store the topic filters(wildcard):\n```\n|          t             |\n|         / \\            |\n|        +   #           |\n|      /  \\              |\n|    x      y            |\n\n| t/+/x -> node1, node3  |\n| t/+/y -> node1         |\n| t/#   -> node2         |\n| t/a   -> node3         |\n\n```\nhttp://docs.emqtt.com/en/latest/cluster.html\n. @rock59, Thanks for your help:) I'd like to close the discussion now.\n. A message with empty payload will delete the retained one of the topic. Please read MQTT V3.1.1 protocol specification. \n. Hi sylvek, Please check your emqttd_mod_kafka_presence module. \n. Hi @Zordiac91:\n1. Please check log/emqttd_error.log\n2. Configure etc/vm.args and tune '+P', '+Q' parameters\nDocs: \nhttp://docs.emqtt.com/en/latest/config.html#etc-vm-args\nhttp://docs.emqtt.com/en/latest/tune.html\n. hi @87sanchavan, we release 0.17 this week and then tag 1.0. \n. Hi Sanjay, If we enable several authentication modules(plugins) at the same time, the authentication process:\n----------------           ----------------           -------------\nClient --> |   Username   | -ignore-> |   ClientID   | -ignore-> | Anonymous |\n           ----------------           ----------------           -------------\n                  |                         |                         |\n                 \\|/                       \\|/                       \\|/\n            allow | deny              allow | deny              allow | deny\nIf you want authentication with both redis and anonymous, please customize the emqttd_plugin_redis/src/emqttd_auth_redis.erl. For example:\ncheck(#mqtt_client{username = Anonymous}, Password, _State) ->\n    ignore;\n. Hi @towtooth, Please check log/emqttd_sasl.log\n. @nikolatesla11, the mysql plugin supports this pattern, for example:\nINSERT INTO `mqtt_acl` (`id`, `allow`, `ipaddr`, `username`, `clientid`, `access`, `topic`)\nVALUES\n    (1, 0, NULL, '$all', NULL, 1, '#'),\n    (2, 1, NULL, '$all', NULL, 3, '/command/$u/test');\n_The variable name is '$u', not '%u'. _\n. Hi @Prots, Do you build the broker from latest master? How to reproduce the issue?\n. Sorry for that I improved the the Hooks API design in 0.17.0 release in order to consolidate the 'foreach_hooks' and 'foldl_hooks'. \nI added a new emqttd_hook.erl module, and hook/unhook APIs to emqttd.erl module:\n```\n-spec(hook(atom(), function(), list(any())) -> ok | {error, any()}).\nhook(Hook, Function, InitArgs) ->\n    emqttd_hook:add(Hook, Function, InitArgs).\n-spec(hook(atom(), function(), list(any()), integer()) -> ok | {error, any()}).\nhook(Hook, Function, InitArgs, Priority) ->\n    emqttd_hook:add(Hook, Function, InitArgs, Priority).\n-spec(unhook(atom(), function()) -> ok | {error, any()}).\nunhook(Hook, Function) ->\n    emqttd_hook:delete(Hook, Function).\n-spec(run_hooks(atom(), list(any()), any()) -> {ok | stop, any()}).\nrun_hooks(Hook, Args, Acc) ->\n    emqttd_hook:run(Hook, Args, Acc).\n```\nThe latest template plugin shows how to use the new Hooks API:\nhttps://github.com/emqtt/emqttd_plugin_template/blob/master/src/emqttd_plugin_template.erl\n. Invalid issue.\n. Hi @Karity, Redis Plugin: https://github.com/emqtt/emqttd_plugin_redis\n. @Karity, I updated the README: https://github.com/emqtt/emqttd_plugin_redis/blob/master/README.md\n. @obi458, Agree that there is a possible race condition issue. I will check the design later. But notice that you should not lookup the 'mqtt_client' record in on_client_subscribe for the function is called by session process. The session and client may be on different nodes in a cluster.\n. Hi @obi458, please checkout the latest '0.17' branch and verify this issue. Thanks.\n. The timeout is a tradeoff to ensure the broker could handle about 1k+ TCP connections per second.\n@obi458, would you like to benchmark the fix? The tool: https://github.com/emqtt/emqtt_benchmark\n./emqtt_bench_sub -h server -p 1883 -c 50000 -i 1 -t test/%i -q 1\n. Hi @obi458, could we close the issue now?\n. Please check the latest mongodb plugin: https://github.com/emqtt/emq_auth_mongo\n. Please configure the correct username and password of PostgreSQL in plugins/emqttd_plugin_pgsql/etc/plugin.config:\n```\n    {pgsql_pool, [\n    %% pgsql options\n    {host, \"localhost\"},\n    {port, 5432},\n    {ssl, false},\n    {username, \"feng\"},\n    {password, \"\"},\n    {database, \"mqtt\"},\n    {encoding,  utf8}\n]},\n\n```\n\n\u5728 2016\u5e743\u670830\u65e5\uff0c\u4e0b\u53481:31\uff0cmkj-git notifications@github.com \u5199\u9053\uff1a\nI was following http://docs.emqtt.com/en/latest/guide.html#postgresql http://docs.emqtt.com/en/latest/guide.html#postgresql guide to use postgres for authentication. When executing\n./bin/emqttd_ctl plugins load emqttd_plugin_pgsql\ni am getting this error\nload plugin error: {emqttd_plugin_pgsql,\n                    {bad_return,\n                     {{emqttd_plugin_pgsql_app,start,[normal,[]]},\n                      {'EXIT',\n                       {{badmatch,\n                         {error,\n                          {shutdown,\n                           {failed_to_start_child,pgsql_pool,\n                            {shutdown,\n                             {failed_to_start_child,worker_sup,\n                              {shutdown,\n                               {failed_to_start_child,\n                                {worker,1},\n                                invalid_password}}}}}}}},\n                        [{emqttd_plugin_pgsql_app,start,2,\n                          [{file,\"src/emqttd_plugin_pgsql_app.erl\"},\n                           {line,30}]},\n                         {application_master,start_it_old,4,\n                          [{file,\"application_master.erl\"},{line,273}]}]}}}}}\ni have created mqtt_user table in postgres\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly or view it on GitHub https://github.com/emqtt/emqttd/issues/488\n. hi @mkj-git, could you connect to your PostgreSQL database with the empty password?\n\n{username, \"postgres\"},\n{password, \"\"},\n{database, \"mqtt\"},\n. Check the log/emqttd_sasl.log:\ncd log && grep crasher *\n. Hi @mkj-git, please close this issue:)\n. hi @87sanchavan, the mongodb plugin is not built by default for it depends on many third-party libraries. Please build the plugin by yourself.\n. @87sanchavan, I created a 'plugins' branch from the latest master and added the mongodb plugin. could we close the issue now?\n. @87sanchavan, The mongodb plugin will be released in 1.1\n. Hi @borntorock, sorry for late reply. Please start the broker in console mode first: \n./bin/emqttd console\n. Hi @sleepingshorty, the binary package downloaded from emqtt.io is 64bit:) \nPlease build from source: http://docs.emqtt.com/en/latest/install.html#installing-from-source\n. Erlang/OTP R17+ Required.\n. @sleepingshorty, please close the issue. Thanks.\n. Yeah, there are about 100+ deployments in production. We are a startup to provide open source MQTT broker, and more information will be available on our web site after 1.0 release.\n. Hi @mkj-git, we are working on the new web site these days. 1.0 release will come next week.\n. @AngeloBestetti, sorry for late reply, we will add a section for upgrade steps in release notes when 1.0 is ready. \n. Invalid issue. Closed.\n. The Firewall: http://docs.emqtt.com/en/latest/cluster.html#the-firewall\n. @congleetea Which client library you used? The QoS of PUREL packet <<96,2,0,1>> is incorrect, which should be 1.\n. @congleetea sorry for late reply, working on 1.0 release these days:)\n1. The hivemq javascript library sends PUBREL with incorrect QoS. You could submit an issue to HiveMQ or try: https://github.com/mqttjs\n2. The QoS of PUBLISH delivered to subscribers depends on the Subscription, for example:\n```\nmosquitto_sub -t '#' -q 2 -d\ncurl -v --basic -u myusername:mypassword -d \"qos=2&retain=0&topic=/a/b/c&message=hello from http...\" -k http://localhost:8083/mqtt/publish\n```\nYou will receive:\nClient mosqsub/8483-172-13-0-4 received PUBLISH (d0, q2, r0, m1, '/a/b/c', ... (18 bytes))\nClient mosqsub/8483-172-13-0-4 sending PUBREC (Mid: 1)\nClient mosqsub/8483-172-13-0-4 received PUBREL (Mid: 1)\nhello from http...\nClient mosqsub/8483-172-13-0-4 sending PUBCOMP (Mid: 1)\n. @congleetea, I closed this issue first. Thanks.\n. Duplidate with #636 \n. Hi @quant67, Thanks a lot:)\n. Hi @prakashr87, I have no idea about what's happened:) I created a 'plugins' branch and built the mongodb plugin successfully. Please checkout the 'plugins' branch to verify this issue.\n. @prakashr87, The mongodb plugin has been upgraded in 1.1 release: https://github.com/emqtt/emqttd_plugin_mongo\n. Hi @iammehrabalam, plan to support this feature by a management plugin.\n. @iammehrabalam, please check the 'message.acked' hook in https://github.com/emqtt/emqttd_plugin_template/blob/master/src/emqttd_plugin_template.erl\n. Hi @hachreak, support of CoAP will be released in 1.2 as a plugin.\n. We will write the code from scratch and implement CoAP protocol inside emqttd.\n. @drasko, cooking on CoAP, MQTT-SN and 2.0 release these days. Thanks for your patience:)\n. @edfungus, set the log level to info and check log/emqttd_error.log\n. @obi458, it's not race condition. The SUBSCRIBE is asynchronous.\n. Use the 'client.subscribe.after' hook:\non_client_subscribe_after(ClientId, TopicTable, _Env) ->\n    io:format(\"client ~s subscribed ~p~n\", [ClientId, TopicTable]),\n    self() ! {dispatch, Topic, Msg},\n    {ok, TopicTable}.\nTemplate code: \nhttps://github.com/emqtt/emqttd_plugin_template/blob/master/src/emqttd_plugin_template.erl\n. @obi458 The design of async subscribe is a bit confusing, I think. Any suggestions?\n. Invalid issue. Closed.\n. @51systems I will update docs later.\n. @51systems, Thanks. I have updated the docs about cluster setup in 2.0 release: http://emqtt.io/docs/v2/cluster.html#cluster-setup\n. @jemc, I agree with you that the cluster design should be enhanced to handle netsplit.\n1. Provide tools which help administrator recover the cluster from net partition quickly\n2. Define some strategies to recover the cluster from network partitions automatically\n. Hi @mjason3, have to reboot the nodes in the minority.\n. EMQ R2.3 integrated with Ekka library to support Autocluster and Autoheal features.\n. @kunaldawn. The trace cannot match topic filter.\n. Hi @kunaldawn, why not use mqtt client to trace '#', for example:\nmosquitto_sub -t '#' -q 1 -d > mqtt.log\n. @koleto, emqttd can be built on the ARM platform, such as Raspberry Pi. You can build the broker and contact us if any issues.\n. @koleto, please install reltool package:\napt-get install erlang-reltool\n. apt-get install erlang-crypto erlang-eldap erlang-public-key erlang-runtime-tools erlang-ssl\n. @koleto Great:) The emqtt broker on Raspberry Pi can handle about 1000+ MQTT connections. You can tune the etc/vm.args and benchmark it. \n. Hi @yon86, this issue is usually caused by hostname. Did you change the '-name' in etc/vm.args?\n. @51systems, It seems the plugin cannot connect to mysql. Please check the options in emqttd_plugin_mysql/etc/plugin.config\n. @51systems, @hulucat, @congleetea, a quick fix: https://github.com/emqtt/emqttd_plugin_mysql/issues/15\nThe Pull Request: https://github.com/mysql-otp/mysql-otp/pull/42\n. @hulucat, @congleetea, @51systems, we upgrade the mysql driver to 1.2.0 now:) The issue https://github.com/mysql-otp/mysql-otp/issues/33 has been fixed. \n. Hi @lpfeup, do you mean 'base64:encode(Password)' directly?\n. hi @yinweinidongle, please move this issue to emqtt/emqttd_plugin_redis project, thanks.\n. No. Depends on memory.\n. Hi @balcruz, I was going to merge this PR in 1.1 release, but postponed for I have no time to test;)\n. Hi @hachreak, sorry for the delay. I am considering to consolidate the dependency management.\n. hi @hachreak, @balcruz, I plan to use erlang.mk to manage dependencies in 2.0 release. And I created 'relx' project for emqttd broker: https://github.com/emqtt/emqttd-relx, and improved the plugins' configuration and management. Now we could build the emqttd with plugins:\ngit clone https://github.com/emqtt/emqttd-relx.git && make\nPlease help review the emqttd-relx project and post comments here if any suggestions:)\n. @kunaldawn There are two types of subscription: static and dynamic.\n1. The subscriptions you created manually by './bin/emqttd_ctl' are static and will be persisted.\n2. The subscriptions created by the broker when a client subscribes to topics are dynamic and stored only in memory\n3. './bin/emqttd_ctl subscriptions list' will list all the dynamic subscriptions(no static)\n4. 'bin/emqttd_ctl subscriptions del' will delete the static subscription you created before\n. @dcy, It seems rebar cannot read the man files: \n/usr/lib/erlang/man/man1/gcov-tool.1.gz\n/usr/lib/erlang/man/man1/x86_64-linux-gnu-gcov-tool.1.gz\n. @xiongtec, Yes. There will be performance issue in the long run. You can write a plugin and hook 'message.publish' to forward all messages arrived to your service:\nhttps://github.com/emqtt/emqttd_plugin_template/blob/master/src/emqttd_plugin_template.erl\n. Hi @orbitbot, the emqtt_benchmark tool still not supports SSL connection:( Could you try other tools like Tsung? I will move this issue to emqtt_benchmark project later.\n. No. The plain TCP clients created by emqtt_benchmark connect to the SSL port of the broker successfully, but cannot finish the SSL handshake... I will improve the benchmark tool later and support SSL options. Thanks.\n. @gbrehmer, Thanks for your suggestion. I will add a section about persistence in 'Design' document.\n. hi @primantok, where are you from? I can download the windows package by clicking the link directly now.\n. okay, closed.\n. @andrewchambers, Thanks.\n. @dreson4, @s4nch3z. The HTTP authentication plugin has been released: https://github.com/emqtt/emqttd_auth_http.\n. @teifip, The 'super_req' could be commented.\n. Fixed in branch: https://github.com/emqtt/emqttd/tree/issue%23542\n. Hi @Sovigod, please update sockjs plugin:\ngit submodule update --remote plugins/emqttd_sockjs\n. Hi @joaohf, the emqtt broker cannot support multi-tenancy.\nBTW, thanks for your rebar3 PR:)\n. @phanimahesh, Thanks. I am considering to implement a Zone-Based authentication:\nListener -> Zone -> Authentication/ACL\n                 -> Session/Queue\n                 -> MQTT Parameters\n                 -> Rate Limit\nWhat's your opinion?\n. @mkj-git, please tune the log level in etc/emqttd.config:\n{lager_console_backend, info},\nAnd start the broker in console mode:\n./bin/emqttd console\n. Hi @mkj-git, please check issue #575.\n. @mkj-git, the issue is duplicated with #575 and has been fixed in 1.1.1. \n. Hi @Sovigod, this issue has been moved to https://github.com/emqtt/emqttd_sockjs/issues/2\n. Hi @xiongtec: \nINSERT INTO `mqtt_acl` ( `allow`, `ipaddr`, `username`, `clientid`, `access`, `topic`)\nVALUES (1,NULL,'$all',NULL,1,'home/sub/test/%c');\n. @congleetea, Invalid issue, closed.\n. @njnuwjq, The issue has been fixed in issue#557 branch.\n. @redink, New1 and New2 packets you created manually are incorrect. \n. Hi @brstgt. Steps:\n1. Check shutdown count of TCP listeners:\n./bin/emqttd_ctl listeners\n\n\nMetrics and Stats of the broker:\n\n./bin/emqttd_ctl broker metrics\n   ./bin/emqttd_ctl broker  stats\n3. Load emqttd_recon plugin and check bin_leak:\n./bin/emqttd_ctl plugins load emqttd_recon\n   ./bin/emqttd_ctl recon bin_leak\n. @brstgt, more questions ;)\n1. The release of emqttd broker:\n./bin/emqttd_ctl status\n2. The pool_size of emqttd_plugin_redis?\n. @brstgt. It seems the memory leak is caused by Erlang SSL library? The result of 'recon bin_leak':\n{<10038.6901.2410>,-49,\n[{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.1416.2494>,-49,\n[{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n...\nThere are some gen_fsm processes that will not release the refc binaries timely. I searched the whole project and found the ssl_connection.erl is implemented as gen_fsm behaviour.\nHi @phanimahesh, please help check the issue:)\n. @brstgt, please post the process count and memory allocation:\n./bin/emqttd_ctl vm\n./bin/emqttd_ctl recon allocated\n. @phanimahesh, does your App connect to the broker with MQTT Over WebSocket(SSL)? The memory leak may be caused by SSL Connection, I think.\n. Hi @brstgt,\n1. Okay, let's try non-ssl connections. I reviewed the pubsub, session and client modules of the broker, and ensure that we called GC when processing a MQTT message.\n2. The binary packages of official emqttd release are built on R18.2+\nMy Skype: feng.emqtt.io, we could setup a chatroom to discuss this issue.\n@phanimahesh, Thanks for you help:)\n. Hi @brstgt, I noticed some strange metrics:\nmessages/dropped : 82\nmessages/received : 151496137\nmessages/sent : 50125251\nThe messages received is about 3 times than sent, but seldom dropped!  Do your application server subscribes '#' to process messages from clients?\n. @brstgt, If your MQTT clients connect to the broker with 'Clean Session = False' flag, the number of session processes will grow.\n. Hi @brstgt, let's discuss on Skype;)\n. @brstgt, we found a process leak issue in the emqttd_dashboard plugin: https://github.com/emqtt/emqttd_dashboard/pull/64\nDo you poll these HTTP APIs frequently?\n/api/clients    List of all connected clients\n/api/sessions   List of all sessions\n/api/topics List of all Topics\n/api/routes List of all routes\n/api/subscriptions  List of all Subscriptions\n. copying from skype:\n1. We have two nodes running but they are not connected. We are only publishing messages from our backend to mobile clients and the client-server mapping is deterministic by a consistent hash so there is no need to connect the mqtt nodes.\n2. root@push1:/opt/emqttd_1.1# ./bin/emqttd_ctl listeners\nlistener on http:8085\n  acceptors       : 4\n  max_clients     : 16384\n  current_clients : 209\n  shutdown_count  : [{keepalive_timeout,2739},{destroy,1751328},{parser_error,5}]\nlistener on mqtt:1883\n  acceptors       : 64\n  max_clients     : 512000\n  current_clients : 6707\n  shutdown_count  : [{idle_timeout,11042},{destroy,750635},{parser_error,1},{keepalive_timeout,315193},{conflict,150940288},{closed,8351251},{protocol_bad_connect,8}]\nlistener on http:18083\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 0\n  shutdown_count  : []\n. Has been fixed in 1.1.3\n. Hi @freedomsean, usually the MQTT client library should be configured to allow self-signed SSL certificate. Please discuss this issue with @CrazyWisdom \n. @anhldbk Hook 'message.publish': \nhttps://github.com/emqtt/emqttd_plugin_template/blob/master/src/emqttd_plugin_template.erl\non_message_publish( Message = #mqtt_message{from = ClientId}, _Env) ->\n    case emqttd_cm:lookup(ClientId) of\n       undefined -> \n           {ok, Message};\n        Client ->\n            {ok, enrich(Client, Message)}\n    end.\n. @anhldbk, It's demo code that you can not use directly. \n. It's okay. Notice that the payload is a binary: <<\"new data\">>.\nPlease close this issue later.\n. hi @foolbear, did you configure the mysql parameters in plugins/emqttd_plugin_mysql/etc/plugin.config?\n. hi @huangdan, please check the issue.\n. @foolbear, @kenpeter, the mysql driver has been upgraded to 1.2.0, please pull the last master branch and build.\n. Invalid issue, closed. ACL: http://emqtt.io/docs/guide.html#acl\n. Added 'pbkdf2' hash in 2.1 release.. @87sanchavan, You should not send Images/Videos to the broker directly.\n. Hi @huangdan, please check the issue.\n. Commit: https://github.com/emqtt/emqttd/commit/faa7ae28860fbd63c9b8bb319180062021f6b521\n. @teifip, Yeah, the ACL supports '%c', '%u' variables. For example, the 'etc/acl.config' used by the internal ACL module:\n{allow, all, subscribe, [\"/devices/%c/#\"]}.\n{allow, all, subscribe, [\"/devices/%u/#\"]}.\n{deny, all}.\n. Hi @xros, DNS issue, fixed now. \n. Hi @hachreak, you are right. The BROKER_TAB table has been used to store hooks before, which moved to HOOK_TAB later.\n. @teifip, If the emqttd_auth_http plugin is loaded, the HTTP Publish API will be authenticated by the plugin. \n. Hi All, Sorry for the delayed response. I've been busy on 2.0 release these days. We could support the SSL certificate authentication in 2.x release, I think.\n. @uodasuodas Sorry for the delay. We postponed the feature for the SSL library of Erlang/OTP consumes too many CPU/Memory resources. We plan to provide an initial implementation in 2.4-beta.1, and the code will be ready this weekend.. @Thibauth @ralphtheninja @fedenunez @uodasuodas @rajeshemailto \nThe X.509 certificate-based authentication is production ready now, which is released with EMQ R 2.3.2:). @takeuz, a quick fix: https://github.com/emqtt/emqttd_plugin_mysql/issues/15\nA long story: https://github.com/mysql-otp/mysql-otp/pull/42\n. Hi @xurwxj, the Erlang MySQL driver supports domain name. The issue is usually caused by DNS resolv of your server.\n. Attached to the emqttd console:\n./bin/emqttd attach\nAnd the try to connect to mysql with domain:\ngen_tcp:connect(\"domain\", 3306, []).\nCtrl+D Exit.\n. @oedemis, fixed, thanks.\n. Hi @kenpeter, please fork the emqttd_plugin_mysql plugin and customize the ACL by yourself.\n. Hi @atulgoswami21, we will release a 'EmqPlus' product this month to help users store MQTT messages into various backends such as MySQL, MongoDB, Redis...\n. Hi @araxis, the binary package for windows is 64bit. You have to build from source for win10 32bit.\n. Contact QQ: 348822724. I will close the issue now.\n. Hi @iammehrabalam, publish a retained message and configure the expiration in etc/emqttd.config:\n```\n        %% Retained messages\n        {retained, [\n            %% Expired after seconds, never expired if 0\n            {expired_after, 600},\n        %% Max number of retained messages\n        {max_message_num, 100000},\n\n        %% Max Payload Size of retained message\n        {max_playload_size, 65536}\n    ]},\n\n```\n. Hi @araxis, the broker does not support windows 32-bit\n. @rock59, two many plugins will slow down building...\n. Hi @amazg,  root cause of this issue: https://github.com/mysql-otp/mysql-otp/issues/33\nYou could configure a 'keep_alive' option for a quick fix:\n```\n   {mysql_pool, [\n        ...\n        {auto_reconnect, 1},\n    %% mysql options\n    ...\n    {keep_alive, 60000}\n]},\n\n```\n. Hi @Prots, the error log means the '{puback, PktId}'  messages are accumulated in the session's mailbox. \n. Fixed in 2.1. Invalid issue. We can't find any hints at all to help. Closed.\n. @mtappler, Thx. This compatible issue has been fixed in PR: https://github.com/emqtt/emqttd/pull/602\n. Hi @mtappler, the design is right for the CleanSession flag of your new connection is 0, I think.\n. @numbertank, check log/emqttd_error.log first and show stats of the broker:\n./bin/emqttd_ctl broker metrics\n./bin/emqttd_ctl broker stats\n./bin/emqttd_ctl listeners\n. Hi @phanimahesh, Thanks.\n. mosquitto could bridge to emqttd remotely: http://emqtt.io/docs/bridge.html#mosquitto-bridge\n. A remote bridge from mosquitto is just a normal mqtt connection to emqtt broker.\n. @ralphtheninja, Thx.\n. @ralphtheninja, It's better to use back tics, I think. I will update the docs later:)\n. Invalid issue, closed.\n. http://emqtt.io/docs/config.html#etc-vm-args:\n+P  Max number of Erlang proccesses. A MQTT client consumes two proccesses. The value should be larger than max_clients * 2\n. hi @hcrow110, we cannot get any hints about what's happened... please post the stats of the broker:\n./bin/emqttd_ctl vm\n./bin/emqttd_ctl listeners\n./bin/emqttd_ctl broker metrics\n./bin/emqttd_ctl broker stats\n./bin/emqttd_ctl plugins load emqttd_recon\n./bin/emqttd_ctl recon bin_leak\n. Hi @phanimahesh, please help review the PR, which fixed issue #561.\n. @phanimahesh, Thanks. Changed to 'WSLOG' now.\n. @kenpeter, upgrade deps/esockd please.\n. Hi @pranavmehta, the broker can listen on any port for mqtt protocol, for example:\n```\n    {listeners, [\n        {mqtt, 80, [\n            %% Size of acceptor pool\n            {acceptors, 16},\n        %% Maximum number of concurrent clients\n        {max_clients, 512},\n\n        %% Socket Access Control\n        {access, [{allow, all}]},\n\n        %% Connection Options\n        {connopts, [\n            %% Rate Limit. Format is 'burst, rate', Unit is KB/Sec\n            %% {rate_limit, \"100,10\"} %% 100K burst, 10K rate\n        ]},\n    ...\n\n```\n. hi @brechmos, please build the broker from source: http://emqtt.io/docs/install.html#installing-from-source\n. @nak1090, cluster design: http://emqtt.io/docs/cluster.html\n. Fixed: https://github.com/emqtt/emqttd/commit/a362b96b6b9f154958bb6646477da58681b9b417\n. Hi @ajagnanan, I will check if the current auth_mod could support oauth.\n. Lookup the mqtt_client object by ClientId:\nemqttd_cm:lookup(ClientId)\n. @edmandiesamonte, MQTT 'retained' message:\nIf the RETAIN flag is set to 1, in a PUBLISH Packet sent by a Client to a Server, the Server MUST store the Application Message and its QoS, so that it can be delivered to future subscribers whose subscriptions match its topic name [MQTT-3.3.1-5]. When a new subscription is established, the last retained message, if any, on each matching topic name MUST be sent to the subscriber [MQTT-3.3.1-6]. If the Server receives a QoS 0 message with the RETAIN flag set to 1 it MUST discard any message previously retained for that topic. It SHOULD store the new QoS 0 message as the new retained message for that topic, but MAY choose to discard it at any time - if this happens there will be no retained message for that topic [MQTT-3.3.1-7]. See Section 4.1 for more information on storing state.\n. Hi @billysz, emqttd will cache the Pub ACL rules to avoid query database for each MQTT message. Any suggestions to resolve this issue? :)\n. @congleetea, @billysz We add a 'mqtt.cache_acl' option in 2.0 release. The PR: https://github.com/emqtt/emqttd/pull/764\n. Fixed in 2.1 release.. @congleetea, fixed?\n. @BADBDY23, https://github.com/emqtt/emqttd/issues/575\n. Hi @roytan883, the doc about session, queue and inflight window: http://emqtt.io/docs/design.html#session-layer.\nI am working on new syntax of configuration file for 2.0 release these days. Please check: https://github.com/emqtt/emqttd-relx/blob/master/etc/emqttd.conf\nAny suggestions?\n. @roytan883 \u7b2c\u4e8c\u79cd\u3002\u4e0b\u6b21\u8bf7\u7528\u7528\u82f1\u6587\uff0c\u5426\u5219\u4ee5\u540eissue\u65e0\u6cd5\u68c0\u7d22\u3002\n. Invalid issue. Closed.\n. Hi @pranavmehta, we built an emqchat app based on emqttd broker. We defined two types of topics for private/group chat:\n```\nPrivate Chat Topic: chat/user/${uid}/inbox\nGroup Chat Topic: chat/room/${room}/inbox\n```\n. @tomazbracic, @mkj-git The Cassandra and Kafka Plugins have been released in our 'EMQ Plus' product.\n. MQTT/SSL Listener: http://emqtt.io/docs/v2/config.html#ssl-listener-8883\nMQTT WebSocket/SSL Listener: http://emqtt.io/docs/v2/config.html#https-wss-listener-8084\n. @silviucpp, we will improve the design to recover the cluster from network partition after 2.0 released. This issue is not urgent for there are usually two or three nodes cluster.\n. @hachreak, really interesting project. I am reading code and docs of lbm_kv now. \n. Autoheal of network partition has been implemented in 2.2 release.. @liszhu, @Sephiroth-Wang, sorry for the delayed response. I've been working on 2.0 release these days:) The 'shared subscription' and message storage features will be released in the enterprise edition of the broker 2.0.\n. @pranavmehta, @Zong-Li, @liszhu, don't worry about the the enterprise edition:) First we will still open source all the code of the broker to our users or customers. Second, there will be a clear and very low pricing model for our commercial services or enterprise edition.\nThere are really too many new features in 2.x release including MQTT-SN, CoAP supports, MQTT Message storage in MySQL, Redis, MongoDB and PostgreSQL, MQTT Message streaming to Kafka... We love to develop open source but cannot maintain and evolve the projects in the long run without income.\nThe most important thing is not about free, it's about freedom and how we could build something great, I think.\n. The 'Shared Subscription' feature has been released in 2.0-beta.3.\n. Invalid issue. Closed.\n. @aliakbari, we will add a 'emqttd vs kafka' section in FAQ later \n. Please tune max_packet_size: http://emqtt.io/docs/config.html#mqtt-packet-and-clientid\n. @tiefschneeteufel, No. @huangdan please reproduce this issue.\n. @tiefschneeteufel, the issue has been fixed in mochiweb project: https://github.com/emqtt/mochiweb/commit/67f905dc027d30e17af7a82362f21206844253bd#diff-0038a9e9f03f48e77c034718721e8400L225\n. @farhadi, The SUBSCRIBE is asynchronous by default. \n. The internal SUBSCRIBE process:\nClient->Session->PubSub-(asynchronous here)->Router\n                        <- SUBACK\n. fixed in 2.0-rc.3\n. Hi @krvarma, emqtt->Kafka/RabbitMQ is too complicated for Webhook support, I think. I suggest streaming MQTT messages to Redis: emqtt->Redis->Node.js(Webhook)\n. @krvarma The Web Hook Plugin has been released in version 2.2-beta.1: https://github.com/emqtt/emq-web-hook. @shsjshentao, please append '{deny, all}':\n[{allow, \u201c192.168.1.0/24\u201d}, {deny, all}]\nor\n[{allow, \"127.0.0.1\"}, {deny, all}]\n. @danipl, The 'subscription' module in 1.1.x release could help subscribe a 'clientid' topic for each client, for example:\n```\n    %% Modules\n    {modules, [\n    %% Subscribe topics automatically when client connected\n    {subscription, [\n        %% $c will be replaced by clientid\n        {\"$c\", 1}\n    ]}\n\n```\n. No\n. @vishr We released an official docker image: http://emqtt.io/downloads/latest/docker, and the docs: http://emqtt.io/docs/v2/install.html#install-via-docker-image\n. @seamanIncloud, The 'epmd' daemon should not be killed manually.\nDocs about distributed Erlang: http://erlang.org/doc/reference_manual/distributed.html\n. @Yaoguais, docs about distributed erlang system: http://erlang.org/doc/reference_manual/distributed.html \n. This feature has been implemented in 2.3.1. @GIHOLee, which release you deployed? It seems the emqttd_access_control process crashed. \n. @GIHOLee, did you load any modules or plugins? The emqttd_access_control process should not be crashed in 1.x release.\n. @dgtony, Thanks, I will check the PR later.\n. @danielrhodes, it's okay:) Plan to enhance the emqttd_conf module in 2.x release to support OS environment.\n. @danielrhodes OS Environment Variables have been supported in 2.0-rc.3 release: http://emqtt.io/docs/v2/config.html#os-environment-variables\n| Env | Description |\n| --- | --- |\n| EMQ_NODE_NAME | Erlang node name |\n| EMQ_NODE_COOKIE | Cookie for distributed erlang node |\n| EMQ_MAX_PORTS | Maximum number of opened sockets |\n| EMQ_TCP_PORT | MQTT TCP Listener Port, Default: 1883 |\n| EMQ_SSL_PORT | MQTT SSL Listener Port, Default: 8883 |\n| EMQ_HTTP_PORT | HTTP/WebSocket Port, Default: 8083 |\n| EMQ_HTTPS_PORT | HTTPS/WebSocket Port, Default: 8084 |\n. Case-1. Sure. For the ./bin/emqttd_ctl CLI cannot work on windows:( We will try to fix this issue later.\n. Configure 'handshake_timeout' parameter for a listener in etc/emqttd.config:\n%% SSL certificate and key files\n    {ssl, [{handshake_timeout, 10000},\n           {certfile, \"etc/ssl/ssl.crt\"},\n           {keyfile,  \"etc/ssl/ssl.key\"}]},\n. @luka1983, please start the broker in console mode to check what's happened.\n.bin/emqttd console\n. @luka1983, please 'rm -rf data/mnesia/*' and reboot.\n. @lpfeup, fixed. The 'from' field of mqtt_message record has been changed in 2.0. \n. Hi @pedrovhb, please download the stable release: http://emqtt.io/downloads/stable/windows.\n. @farhadi, thx.\n. @edgiru, Yes. I updated the wiki. emqttd(EMQ) is the most scalable MQTT broker deployed in production. 900K for example:\n\n. Invalid issue...\n. @happyyst the variables are '$u', '$c' in 1.x release,  and '%u', '%c' in 2.0-beta.2 release.\n. Please comment line '{auth, anonymous, []}.' in etc/emqttd.conf if you deploy 2.x release.\n. Hi @Venorcis, Did you change the node name in releases/2.0/vm.args?\n. The official docker project: https://github.com/emqtt/emq-docker. Hi @drasko, the issue has been fixed in 2.0-beta.3\n. @sgdba,build from source?\n. @Venorcis The error log means the node has not been started successfully.. @drasko There are two '/mqtt/superuser' requests in the current design. One comes from Authentication when a client connected to the broker, and the other from Authorization(ACL) when publishing a packet. \n. @drasko, I improved the design of Auth/ACL in 2.0-rc.1. Only one mqtt/superuser call for superuser now.\n. Invalid issue. Session timeout should not be 0.\n. Invalid issue, closed.\n. Move to redis plugin: https://github.com/emqtt/emqttd_auth_redis/issues/9\n. No plan to support this feature.\n. Invalid issue\n. @aptjn, please build the broker from source:  http://emqtt.io/docs/v2/install.html#installing-from-source\n. The systemd.service file has been released since version 2.2:\nhttps://github.com/emqtt/emq-package/blob/master/rpm/emqttd.service. Add 'stop_if_auth_failure/2' in emqttd_protocol.erl module:\nstop_if_auth_failure(RC, State) when RC == ?CONNACK_CREDENTIALS; RC == ?CONNACK_AUTH ->\n    {stop, {shutdown, auth_failure}, State};\nstop_if_auth_failure(_RC, State) ->\n    {ok, State}.\n. @linearregression, passed eclipse paho interoperability tests: https://eclipse.org/paho/clients/testing/\n. @magixyu Publish will not create topic/route in the broker. Close the issue.. @ravirdv, Thanks.\n. @Lifto Docs: http://emqtt.io/docs/v2/plugins.html#build-and-release-the-plugin\n. @drasko, I closed the issue.\n. Hi @CheyenneForbes  Contact us: http://emqtt.io/about#_contacts\n. Hi @DataEngg The broker supports 'session across nodes':  http://docs.emqtt.com/en/latest/cluster.html#session-across-nodes\n. Hi @noordawod, the HAProxy will pass the source IP Address to the EMQ broker. \n. @noordawod Please clone the proxy-protocol branch to review the experimental Proxy Protocol V1  support. . @noordawod Please checkout the emq22 branch for the preview release of Proxy Protocol V1/2 support.\n\nBuild the emq22 branch of EMQ:\n\ngit clone -b emq22 https://github.com/emqtt/emq-relx.git\ncd emq-relx && make\ncd _rel/emqttd && ./bin/emqttd console\n\nEnable the Proxy Protocol in etc/emq.conf:\n\n```\nProxy Protocol V1/2\nmqtt.listener.tcp.proxy_protocol = on\nmqtt.listener.tcp.proxy_protocol_timeout = 3s. @noordawod Reopen the issue and tag 'In Progress' now.. It seems the the Erlang 'observer' library missed on your host.. @phanimahesh It's really boring that the building requires 'rebar'. Any idea to resolve the issue?. @noordawod Please try to reinstall the Erlang/OTP : https://www.erlang-solutions.com/resources/download.html. @noordawod Enable the Proxy Protocol support on external TCP listener by configuring etc/emq.conf:\n```\nProxy Protocol V1/2\nlistener.tcp.external.proxy_protocol = on\nlistener.tcp.external.proxy_protocol_timeout = 3s\n```\nAnd you have to deploy a LB, such as HAProxy before EMQ. The haproxy.cfg for example:\nbackend nodes\n    mode tcp\n    balance source\n    timeout server 600s\n    timeout connect 60s\n    server node 127.0.0.1:1883 check inter 10000 fall 2 rise 5 weight 1 send-proxy. @noordawod The Proxy Protocol feature has been merged to master branch and released in 2.2-beta.1.. @CheyenneForbes, no difference.\n. @StarpTech @adarshlal Cooking a guide to deploy EMQ cluster on AWS, which will be released with EMQ version 2.2. Hi @gihad, Deployment Guid of EMQ X: http://emqx-enterprise-docs-en.readthedocs.io/en/latest/deploy.html. @arvindr21 A brief introduction: http://docs.emqtt.com/en/latest/advanced.html\n. @arvindr21, I will tag 2.0-rc.3 this week and then upgrade the docker hub image for the release. \n. @LiYBo, I'd like to close this invalid issue now.\nOur steps to validate 'inflight window':\n1. Install Python MQTT client:\nvirtualenv paho-mqtt\n   source paho-mqtt/bin/activate\n   pip install paho-mqtt\n2. Comment the puback in lib/python2.7/site-packages/paho/mqtt/client.py:\n## rc = self._send_puback(message.mid)\n   self._handle_on_message(message)\n   return MQTT_ERR_SUCCESS\n3. Write a Python module:\nimport time\n   import paho.mqtt.client as mqtt\ndef on_connect(client, userdata, flags, rc):\n     print(\"Connected with result code \"+str(rc))\n     client.subscribe(\"inflight/issue\", qos = 1)\n     time.sleep(4)\n     for i in range(1, 20):\n       client.publish(\"inflight/issue\", str(i), 1, False)\ndef on_message(client, userdata, msg):\n     print(msg.topic+\" \"+str(msg.payload))\nclient = mqtt.Client()\n   client.on_connect = on_connect\n   client.on_message = on_message\n   client.connect(\"localhost\", 1883, 60)\nclient.loop_forever()\n4. Configure the broker's inflight window in etc/emq.conf:\nmqtt.session.max_inflight = 10\n5. Reboot the broker and run the Python module\n. @blacksandwhites, we have released an product named EMQPlus to help store MQTT Messages in various backends such as MySQL, Redis, PostgreSQL, Mongodb. \nMore information: http://emqtt.com/products \n. @arvindr21 The EMQ 2.0 will open four TCP ports by default:\n| TCP Port | Description |\n| --- | --- |\n| 1883 | MQTT Plain Port |\n| 8883 | MQTT(SSL) Port |\n| 8083 | MQTT(WebSocket) |\n| 8084 | MQTT(WebSocket/SSL) |\n. @hijklmno, The broker does not support shared subscriptions across clustered nodes. You could use the Local Shared Subscription if you want to consume the incoming MQTT messages \nthe load-balance way. For example:\nSubscriber 1:\nmosquitto_sub -t '$local/$queue/test/thistopic' -h 10.0.1.64 -v\nSubscriber 2:\nmosquitto_sub -t '$local/$queue/test/thistopic' -h 10.0.1.173 -v\n. @hijklmno, no plan still.\n. @BinLi-OW Plan to improve the shared subscription design in 2.4 release:). Hi @jsaveljevs, We built the latest release from source: http://emqtt.io/downloads/latest/source, but cannot reproduce this issue. Please tune the log level of console in etc/emq.conf and check what's happened:\nlog.console.level = debug\n. @jsaveljevs, We added a new configuration for '-heart' in etc/emq.conf:\n```\nvm.args: -heart\nHeartbeat monitoring of an Erlang runtime system\nValue should be 'on' or comment the line\nnode.heartbeat = on\n```\n. The MQTT(SSL) listener: http://emqtt.io/docs/v2/config.html#ssl-listener-8883\n. @allenhula, The Paho project has several client libraries such as Java, Python, C. Which one you are using?\n. @hachreak Please connect to 8883 port:\n1883    MQTT Port\n8883    MQTT/SSL Port\n8083    MQTT(WebSocket), HTTP API Port\n8084    MQTT(WebSocket/SSL), HTTP API Port\n18083   Web Dashboard Port. @SumitFlochat, pls clone the emqttd-relx project: https://github.com/emqtt/emqttd-relx\n. Invalid issue, closed.\n. @SongCF No plan to support this feature.\n. @SongCF The broker will only persist retained MQTT messages which can be deleted by publishing a  message with empty payload to the same topic.\n. Invalid issue. Closed.\n. @shon-penteer  Cannot bridge EMQ to Mosquitto. \n. @shon-penteer We could support this feature if more users star this issue, I think.\n. @shon-penteer Write a python bridge: EMQ -> Python Bridge -> Mosquitto\n. @jhao If the broker denied a SUBSCRIBE packet, the client will receive an SUBACK packet which contains error QoS 128.\n. Invalid issue. @hachreak The Cascading of authentication/ACL will be released in 2.2. @hachreak @vivek1729 Fixed in 2.2-beta.1 release. Check the issue #889 . @jlgm Yes. The chain is built by the registered order of the authentication module. Notice that the chain only works when usernames are not duplicated in different auth modules.. @vetrostudios  Produce a last will message when the client closes a connection without DISCONNECT Packet:\n\nSubscribe the will topic:\n\nmosquitto_sub -t will/topic -d\n\nCreate a connection and CTRL+C to close:\n\nmosquitto_sub --will-topic will/topic --will-payload \"Die\" --will-qos 1 -t t -d. Invalid issue, closed.. Invalid issue, closed.. Invalid. Closed.. Won't fix.. Invalid issue. Closed.. etc/emq.conf:\n```\nExpired after 1 day:\nw - week\nd - day\nh - hour\nm - minute\ns - second\nmqtt.session.expired_after = 1d\n``. Fixed in emq-auth-clientid, emq-auth-username plugins:\nhttps://github.com/emqtt/emq-auth-clientid/pull/4\nhttps://github.com/emqtt/emq-auth-username/pull/4\n. @msdevanms Plan to support this feature in 2.1 release.. @msdevanms @KohliDev @PiedPieper Duplicated with #1185. The feature is production ready for R 2.3.2 release.. @renwanly ;) A quick fix: https://github.com/emqtt/emqttd/pull/797 . @chimit POST https://user:passwd@mysite.com:8084/mqtt/publish \nThe typo will be fixed in 2.0.4. @michaelcplusplus This issue has been fixed. please build the broker from master branch. . @michaelcplusplus @epopoee Thanks for the contributions. Would you like to submit a PR foremq-relxproject? I'd like to merge the fix towindowsbranch. . @twmarr Considering to support HotConfig and workaround this issue on windows platform.. The subscribe process is asynchronous by default.. @shsjshentao please tune themqtt.listener.ssl.handshake_timeout` in etc/emq.conf:\nmqtt.listener.ssl.handshake_timeout = 15000\nThe unit is millisecond in 2.0-rc3 release, and changed to second in 2.0.x.. @shsjshentao please discuss the issue with Rui Wang who is the author of NodeMCU:) @vowstar . @naggie Thanks for the advice. Maybe we could put the binary packages on AWS S3 later.. @chimit Thanks.. PR: https://github.com/emqtt/emqttd/pull/815. The gen_conf library is deprecated and removed. Please clone the latest master branch.. @brylie Yeah, we are working on the Monitor/Management/Control APIs these days:) A preview screenshot of the monitor dashboard: \n\n. No. @varnerac We cannot publish the emqttd package to hex.pm for there are some dependencies missed.. Dependencies:\n```\nDEPS = gproc lager gen_logger esockd mochiweb\ndep_gproc       = git https://github.com/uwiger/gproc\ndep_getopt      = git https://github.com/jcomellas/getopt v0.8.2\ndep_lager       = git https://github.com/basho/lager master\ndep_gen_logger  = git https://github.com/emqtt/gen_logger\ndep_esockd      = git https://github.com/emqtt/esockd master\ndep_mochiweb    = git https://github.com/emqtt/mochiweb\n```. Invalid issue, closed.. @CMTEST080 @KerwinKoo We built a binary package for CentOS 6.5: http://emqtt.com/downloads/latest/centos6 . @rbagree Pls tune the ACL rules in etc/acl.conf, for example:\n{allow, all, subscribe, [\"$SYS/#\", \"#\"]}.. @sanket-kulkarni-vmware The broker will not persist sessions.. Plan to tag 2.0.5 this Friday.. @mfick76 ./bin/emqttd_ctl listeners to check the shutdown_count, for example:\nlistener on mqtt:tcp:1883\n  acceptors       : 8\n  max_clients     : 1024\n  current_clients : 0\n  shutdown_count  : [{closed,1}]. Invalid issue, closed.. @forest-yang Now the topic trie and routing table will be replicated to each node in the cluster. And we are working on a micro service architecture these days to separate the connection and routing layer.. @MuskaWu Deploy a HAProxy or Load-Balancer sitting in front of the EMQ cluster.. @chimit Thanks.. Invalid issue. Closed.. The feature has been implemented in 2.1 release.. @marcoleunghk Build EMQ from source: http://emqtt.io/docs/v2/install.html#installing-from-source. @marriotb Thanks for the detailed issue report. We will improve the installation and release deb and rpm packages later.. @marriotb Please help review the fix: https://github.com/emqtt/emq-relx/commit/0780606ef9edd2d81dd1625248558de9c3928e4f. @klausenbusk Happy New Year:) Thanks for you advice. We will improve the project management of EMQ.. The broker will authenticate a client with username&password when a CONNECT packet received.. Move to https://github.com/emqtt/emq-auth-mongo/issues/31. Hi @rokka-n, Have you tried our official docker image: http://www.emqtt.io/downloads/latest/docker ? \nI will run the mqtt-randompub benchmark later.\n. Please contact hong@emqtt.io to consult the EMQPLUS products we officially released.. @dreamcatcha The issue has been fixed in the R2.3 release. The keepalive timeout exception will  delay LW message, so we add a mqtt.keepalive_backoff configuration to fix the issue:\n```\nThe Keepalive timeout: Keepalive * backoff * 2\nmqtt.keepalive_backoff = 0.6\n```. @cgdander Fixed in 2.1.0-rc.1 release. Commit: https://github.com/emqtt/emq-relx/commit/0780606ef9edd2d81dd1625248558de9c3928e4f. @renwanly Pls check PR: https://github.com/emqtt/emq-auth-http/pull/10\n. @happyyst The issue has been fixed in 2.1.0 release. @primantok Really cool issue\ud83d\ude02. Invalid issue, closed. @ralphtheninja The crash means SSL handshake timeout, please check the handshake_timeout config in etc/emq.conf:\nmqtt.listener.ssl.handshake_timeout = 15. @Howld Fixed in commit: https://github.com/emqtt/emq-docs-en/commit/0b3c767f18b25607caea37f49ca3a8f7d3efb3c3 I will upgrade the docs in 2.0.7 release. Thanks.. @michaelcplusplus @altishchenko The EMQ-2.0 cannot be registered as a window service. For we have to translate the etc/emq.conf to data/configs/app.config before the Erlang VM boot, we cannot use the erlsrv to register in bin/emqttd :( Any suggestions to fix this issue are welcome.. @michaelcplusplus Would you like to check the bin/emqttd.cmd batch file and help fix this issue? Thanks.. I don't know if we could register the bin\\emqttd start as a window service like the init.d on Linux.. Hi @satrox28 The dashboard only shows the clients, sessions and subscriptions of the current node in the cluster. It's boring when we want to check the global stats. Our team is working on the EMQ Control Center these days to manage the whole cluster on the same dashboard. The ECC product will be released next month, I guess. Thx.. @Howld Thanks. Fixed in 2.0.7 release: https://github.com/emqtt/emq-docs-en/pull/7. @okamipride Start ubuntu@ip1 first, and then call ./bin/emqttd_ctl cluster join ubuntu@ip1 on ubuntu@ip2 and ubuntu@ip3. Invalid issue, closed\n. @arvindr21 We added a mqtt.keepalive_backoff configuration in 2.3 release to fix the issue:\n```\nThe Keepalive timeout: Keepalive * backoff * 2\nmqtt.keepalive_backoff = 0.75\n``. Upgrade Erlang/ OTP to R18.3+ if you build EMQ from source. . @wuqunfei Welcome to join the EMQ open source team:)  Please clone [emq-auth-http](https://github.com/emqtt/emq-auth-http) and check how to develop your own auth plugin\n. @varnerac Thanks.. @turtleDeng Please add a./bin/emqttc_ctl acl reload` command.. @StarpTech The HTTP Publish API will be moved to Management/Monitor Plugin in 2.2. release.. @chimit  Thanks for your contribution. Merged the PR in 2.3-beta.2.. @thpham The issue has been fixed in 2.2-beta.1 release. We improved the Auth/ACL chain design in version 2.2. The Auth request will be forwarded to next auth module if it is ignored by the current auth module:\n```\n           --------------           -------------           --------------\nClient --> | Redis Auth | -ignore-> | HTTP Auth | -ignore-> | MySQL Auth |\n           --------------           -------------           --------------\n                 |                       |                       |\n                \\|/                     \\|/                     \\|/\n           allow | deny            allow | deny            allow | deny\n\n``. @je-al Do you use two-way SSL authentication? Please post themqtt.listener.sslconfiguration in etc/emq.conf.. It seems SSL handshake is timeout, please configurehandshake_timeout` option:\n%% SSL certificate and key files\n{ssl, [{handshake_timeout, 15000},\n         {certfile, \"etc/ssl/server.crt\"},\n         {keyfile,  \"etc/ssl/server.key\"}]},. @hachreak Please check the SSL Parameters of python client. The EMQ broker uses one-way SSL authentication by default.. @srayhunter Installing from source: http://emqtt.io/docs/v2/install.html#installing-from-source\n```\ngit clone https://github.com/emqtt/emq-relx.git\ncd emq-relx && make\ncd _rel/emqttd && ./bin/emqttd console\n. @roytan883 No plan to support this feature.. @watchworld The sockjs plugin has been deprecated.. @ig0r EMQ does not support duplicated client id. You can create shared subscriptions with different client ids to implement HA.. @drejkus I like this feature too and add it to the 2.2 release plan. . @maxshucn The issue has been fixed in `esockd` 4.2 which is released with EMQ 2.1.0-beta.2.\nThe SSL connection process should exit quietly when the '{tls_alert, Reason}' errors happened.\n. @obi458 Added a 'mqtt_msg_from()' type.. @quanfehut The issues is caused by \"maps:take/2\" API, which is only available in Erlang/OTP R19+ release. We upgraded the OTP and fixed the issue in 2.1.0-beta.1.. @phanimahesh Please submit a PR, Thanks.. @phanimahesh Thanks. Merged.. @mruepp @mv200580 @ig0r I will close this issue now for lots of users of EMQ use shared subscription to consume sensor data. The tools like mqtt.FX will not show MQTT messages from shared subscription. For example, a '$queue/topic' is subscribed, but messages from 'topic' are published to the tool which will drop them silently. . @quanfehut Deploy EMQ on Linux in production.. @masoud91 Fixed in 2.1.0-beta.1 release. @SumitFlochat Please clone 'emq-relx' project, uncomment '{wx, load}' in the relx.config, and build EMQ from source. The binary package we released officially does not contain wx library. . @phanimahesh, I agree that we should enhance the emqttd_hooks APIs to support this feature..\ngit clone -b 'v2.0.7p1' https://github.com/emqtt/emq-relx.git emq-relx && cd emq-relx && make\n```. @syberkitten EMQ stores the offline messages in various backends, such as MySQL, MongoDB, PostgreSQL or Cassandra. We implement these features in an enterprise edition for there are too many supports for our customers.\nDocumentation on backends and bridges: http://emqx-enterprise-docs-en.readthedocs.io/en/latest/backends.html. @syberkitten Please contact zhengyu.pan@emqtt.io for more details about the product, who is our global support based in Germany.. @satrox28 I will merge the Proxy Protocol PR in 2.2 release.. @satrox28 Please checkout the emq22 branch for the preview release of Proxy Protocol V1/2 support.\n\nBuild the emq22 branch of EMQ:\n\ngit clone -b emq22 https://github.com/emqtt/emq-relx.git\ncd emq-relx && make\ncd _rel/emqttd && ./bin/emqttd console\n\nEnable the Proxy Protocol in etc/emq.conf:\n\n```\nProxy Protocol V1/2\nmqtt.listener.tcp.proxy_protocol = on\nmqtt.listener.tcp.proxy_protocol_timeout = 3s\n```. @satrox28 The logs mean some MQTT clients connect to the broker directly, not LB.. @noordawod @satrox28 The proxy protocol support has been merged to master and released in 2.2-beta.1.. Hi @frank-montyne, I checked all the log files you attached. No hints for the crash. If the Erlang VM crashed, there will be a log/crash.dump file generated. I guess the Erlang process is killed by OS. Please check the syslog at the same time.\n. @frank-montyne The benchmark report provided by XMeter: http://emq-xmeter-benchmark-en.readthedocs.io/en/latest/ \nI still cannot figure out why your deployment crashed when there are still too few clients and messages:(  . @frank-montyne ClientId conflicts.. @frank-montyne Could we close the issue now?. @frank-montyne Thanks.. @turtleDeng Please create a centos7 node and try to reproduce this issue.. @chrischandler25 Caused by the 'Program Files' directory which contains a space.. Hi @phanimahesh, I'd like to invite you to join the EMQ development team:) Please check the invitation: http://github.com/emqtt. Thanks a lot for you help.. @phanimahesh This will be a API breaking change, I think. The authentication is based on original clientId and username.. Cool issue.. @CrazyWisdom Please check this issue.. @phanimahesh Thanks. I will check the CI error logs later.. @congleetea  It seems there is no spec for the case. @phanimahesh what's your opinion?. Fixed. @huangdan please verify the issue on emq20 branch.. @mruepp\n1. Yes. The shared subscriptions cannot be across cluster nodes.\n2. The node-red, mqtt.Fx tools have no idea on shared subscriptions which defined in MQTT 5 specifications, they will drop the messages silently.. @congleetea Thanks. Fixed in commit: https://github.com/emqtt/emqttd/commit/3573156e8fb9d4f824be7a2bdc9d558a995059d6. @hachreak No error code in PUBACK packet according to MQTT V3.1.1 specification. We can resolve this issue in EMQ 3.0 to implement the MQTT 5 specification.. @hachreak Please submit a PR and we could merge the 'message.publish_denied' hook in 2.2 release. . @vidhill The SSL port is 8883.. @michaelcplusplus Clone the emq-plugin-template project and make.. @truonglx-56 Cannot debug emqttd in IntelliJ.. No IDE supports Erlang debug for the language is concurrent and functional, I think.. @loss2profit Please attach the crash logs. Could you describe the load test case in more details? Do the 10k devices publish messages to a topic, which is consumed by only one subscriber?\n. @loss2profit You cannot benchmark the broker like this case:) The subscriber cannot consume messages timely for there are too many publishers, and then all the messages will be accumulated in memory and crash the VM finally.\nThe shared subscription feature is for the case: http://emqtt.io/docs/v2/advanced.html#shared-subscription\nThe benchmark report for 2.0 from our partner XMeter: http://emq-xmeter-benchmark-en.readthedocs.io/en/latest/. @Linuturk The issue has been fixed in 2.1.1. @Linuturk The HTTP Management API has been moved to port 8080 for security issue. . @turtleDeng Do you upgrade your MacBook to 10.12?. @pritstift No need to install wxmac. Invalid. Closed.. @wang911hehai Add a host in /etc/hosts:\n127.0.0.1 csh_agw_sgw_2. @ddatsh Please check if the crypto library is available for your Erlang/OTP environment. . @pritukam The documentation on ACL: http://emqtt.io/docs/v2/guide.html#acl. You have to define '{allow, all}' or '{deny, all}' at the end of acl.conf.. @pritukam \n{allow, {ipaddr, \"172.16.36.149\"}, subscribe, [\"benchmark\"]}.\n{deny, all}.. @vidhill  I commited a fix in emq-relx project: https://github.com/emqtt/emq-relx/commit/68001c3ba3b5290513d72eedad388b5fc053b549\nThe bin/nodetool will contact all the configuration files under etc/ folder and translate to data/app.conf. . @qingchuwudi This issue has been fixed in PR: https://github.com/emqtt/emqttd/pull/1002. @satrox28 The two-way SSL authentication will be enabled if your uncomment the 'mqtt.listener.ssl.verify' parameter.. @congleetea You cannot attach the node which is started by 'bin/emqttd foreground' or 'bin/emqttd console'. @s4kibs4mi Plan to support this feature in 2.2 release.. @ralphtheninja Thanks for your support. I will close the Cool issue now.. @inter169 Fixed in 2.2-beta.1 release. You can configure the the backlog for tcp or ssl listeners:\n```\nlistener.tcp.external.backlog = 1024\nlistener.ssl.external.backlog = 1024\n``. @nestor5 This feature has been merged toemq22` branch.. @nestor5 The 2.2-beta.1 release supported to configure multiple listeners now:\nlistener.tcp.external = 0.0.0.0:1883\nlistener.tcp.internal = 127.0.0.1:11883. Clustering Guide: http://emqtt.io/docs/v2/cluster.html. @nestor5 Cannot change the mnesia dir now.. @YouriKorostelev The bin\\emqttd script does not support the directory which contains spaces.. @gbrehmer EMQ will not support this mode for it's not reliable. Messages dispatched to remote nodes in the cluster will be lost quietly for there is no ACK mechanism.. @mostafiz789 Closed the issue.. @bouyeijiang No plan to support windows in production.. @ajay-aggarwal @yogin16  The shared subscription works on a single node, and you can use $local/$share/<group>/topic to balance the consumption across the cluster nodes.. @gmonk Please send me the crash.dump and error logs. mail: feng@emqtt.io. @gmonk I checked the crash.dump you sent to me just now. It seems the crash is caused by OTP-7132: http://erlang.org/pipermail/erlang-questions/2014-February/076950.html \nWhich package you deployed on the VPS?  emqttd-ubuntu16.04-v2.2-beta.1_amd64.deb?\n. @maxshucn Please fix your SSL configurations of EMQ first. I will close the issue now.  @terry-xiaoyu . @kamleshnarola The plugin cannot access your MySQL server, please check the MySQL parameters.\nAccess denied for user ''@'localhost' (using password: NO). Hi @behrad, we have released an enterprise edition of EMQ to support persistence in various backends. I plan to upgrade the emqtt.io site and publish the edition later:). @yandooo Sorry for that I forgot to check the issue, which is not caused by the old version of EMQ. \nIf many publishers publish MQTT messages to a subscriber which consumes MQTT messages slowly, these messages will be accumulated in memory, and OOM occurs finally.\nEnable the stats and check the length of inflight/mqueue of a session on dashboard:\nmqtt.client.enable_stats = on\nmqtt.session.enable_stats = on\n. Tune the length of mqueue to avoid too many messages accumulated in memory(Notice that EMQ will drop the older messages if the queue is full).\n```\nMax queue length. Enqueued messages when persistent client disconnected,\nor inflight window is full. 0 means no limit.\nmqtt.mqueue.max_length = 1000\n``. @miks Please check theshared subscriptionfeature: http://emqtt.io/docs/v2/advanced.html#shared-subscription. Hi @edmandiesamonte, I suggest to use the CoAP protocol on your LPWAN devices.  The CoAP Gateway provided by EMQ: https://github.com/emqtt/emq-coap. @grutabow Does the CoAP gateway of EMQ support auth/ACL?. @yandooo The EMQ R2 does not close the connection when a PUBLISH or SUBSCRIBE is denied. We have to adopt the MQTT 5.0 specification later to resolve the issue, I think.. @PiedPieper Terminate the connection if ACL denied?. @wiiikiii Load theemq_auth_usernameplugin first, and then load theemq_auth_http`.. @wiiikiii EMQ R2.2 supports Authentication/ACL chain. You can load more than one authentication plugin at the same time.\nDocumentation: http://emqtt.io/docs/v2/guide.html#authentication. Benchmark documentation: http://emq-xmeter-benchmark-en.readthedocs.io/en/latest/. @totojack The MQTT messages are accumulated in memory for there is only one slow consumer to handle messages from thousands of publishers. Use the Shared Subscription to fix the issue: http://emqtt.io/docs/v2/advanced.html#shared-subscription. @davidepozza Please subscribe $SYS/brokers/+/clients/#.. @davidepozza We cannot reproduce the issue. The steps:\n\n\nStart EMQ 2.1.2:\nfeng$ ./bin/emqttd_ctl status\nNode 'emqttd@127.0.0.1' is started\nemqttd 2.1.2 is running\n\n\nmosquitto_sub the '$SYS/brokers/+/clients/#' topic on localhost:\n\n\nmosquitto_sub -t '$SYS/brokers/+/clients/#' -d\n\nCreate a MQTT client and then CTRL+C to kill: \n\nmosquitto_sub -t t -d\n\nThe MQTT messages received from $SYS/brokers/+/clients/# topic:\n\nfeng$ mosquitto_sub -t '$SYS/brokers/+/clients/#' -d\nClient mosqsub/18695-FengdeMac sending CONNECT\nClient mosqsub/18695-FengdeMac received CONNACK\nClient mosqsub/18695-FengdeMac sending SUBSCRIBE (Mid: 1, Topic: $SYS/brokers/+/clients/#, QoS: 0)\nClient mosqsub/18695-FengdeMac received SUBACK\nSubscribed (mid: 1): 0\nClient mosqsub/18695-FengdeMac received PUBLISH (d0, q0, r0, m0, '$SYS/brokers/emqttd@127.0.0.1/clients/mosqsub/18698-FengdeMac/connected', ... (144 bytes))\n{\"clientid\":\"mosqsub/18698-FengdeMac\",\"username\":\"undefined\",\"ipaddress\":\"127.0.0.1\",\"clean_sess\":true,\"protocol\":3,\"connack\":0,\"ts\":1496885750}\nClient mosqsub/18695-FengdeMac received PUBLISH (d0, q0, r0, m0, '$SYS/brokers/emqttd@127.0.0.1/clients/mosqsub/18698-FengdeMac/disconnected', ... (72 bytes))\n{\"clientid\":\"mosqsub/18698-FengdeMac\",\"reason\":\"closed\",\"ts\":1496885750}\nClient mosqsub/18695-FengdeMac sending PINGREQ. @davidepozza I will reopen the issue and reproduce it with Redis Plugin.. @davidepozza There is something wrong in your test case, I think. The broker works fine still for there are only thousands of concurrent clients and messages. Check the error logs and fix your test case.\nThe benchmark documentation of EMQ 2.0: http://emq-xmeter-benchmark-en.readthedocs.io/en/latest/. Cool issue, closed.. @CheyenneForbes The HTTP API will be separated from MQTT/WS in 2.2-rc.1 release. You can submit a PR Later, Thanks.. @CheyenneForbes This feature has been released in 2.3-beta.2. Documentation: https://github.com/emqtt/emq-docs-en/blob/master/source/rest.rst#create-a-subscription. @dinhquy94 Tune off the anonymous authentication in etc/emq.conf:\nmqtt.allow_anonymous = false. @congleetea Fixed the typo in 2.2-rc.2. Hi @TuanTuanTu, We have released an Enterprise Edition - EMQ X to support various backends including MySQL, Redis, PostgreSQL, MongoDB. Please contact Hong for quotations. Thanks.. @ baer Thanks for your contributions. I will review and merge the fix in next release if it works fine:). @watchworld Please upgrade to EMQ R2.. Invalid issue, won't fix.. @syberkitten Thanks for your report. @huangdan will benchmark EMQ with Malaria tool and try to reproduce the issue.. @syberkitten Tune the two parameters in etc/emq.conf:\nmqtt.mqueue.max_length = 0\nmqtt.session.max_awaiting_rel = 0\nBy default, the EMQ broker will queue 1000 Qos1/2 messages for each session to avoid memory overload. \nThe benchmark report for EMQ 2.0: http://emq-xmeter-benchmark-en.readthedocs.io/en/latest/. @pavankumarkatakam Suggest to add the 'username' or 'clientid' in the payload if you are developing an IM application. For example:\n{\n\"from\": \"john\",\n\"to\": \"tom\",\n\"body\": \"Hello\"\n}. @Suko You can use the Redis, MySQL or PostgreSQL authentication plugins.. @Suko Plan to support this feature in 2.3 release. Thanks for you suggestions.. @syberkitten \n\nThe node name should be Name@Host, where Host is IP address or the fully qualified host name.\nConfigure the /etc/hosts file if FQN is used, for example: 127.0.0.1   emq.mydomain. @miller111 Please subscribe to the topic '$share/group/$SYS/#'. @miller111 Configure the internal ACL rules in 'etc/acl.conf' file:\n\n```\n{allow, {user, \"dashboard\"}, subscribe, [\"$SYS/#\"]}.\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", \"#\"]}.\n{deny, all, subscribe, [\"$SYS/#\", {eq, \"#\"}]}.\n```. @codewiget95 EMQ R2.1.2 requires Erlang/OTP R19+ to build, and EMQ R2.2 requires Erlang/OTP R19.3+. @hos7ein Do you check the max-fds allowed by 'ulimit -n'?. @sincethen The fanout is 8K(pub) * 8 (sub) = 64K/s for you use only one topic in this test case. Messages will be accumulated in the queues of subscribers, and finally memory overloaded. \nBenchmark report of EMQ 2.0: http://emq-xmeter-benchmark-en.readthedocs.io/en/latest/. @sincethen The benchmark scripts for 8K/s PubSub: \n```\n./emqtt_bench_sub -h  -c 8000 -t bench/%i -q 0\n./emqtt_bench_pub -h  -c 8000 -t bench/%i -q 0\n```\n. @sincethen The benchmark report of EMQ 2.0: http://emq-xmeter-benchmark-en.readthedocs.io/en/latest/. @vidhill The issue has been fixed in 2.2.0. @workingegg Thanks for you contribution. I will close the issue now.. @kpacn The broker will pass the 'ConnAck' parameter to callbacks of the 'client.connected' hook. The presence module for example:\non_client_connected(ConnAck, Client = #mqtt_client{client_id  = ClientId,\n                                                   username   = Username,\n                                                   peername   = {IpAddr, _},\n                                                   clean_sess = CleanSess,\n                                                   proto_ver  = ProtoVer}, Env) ->\n    Payload = mochijson2:encode([{clientid, ClientId},\n                                 {username, Username},\n                                 {ipaddress, iolist_to_binary(emqttd_net:ntoa(IpAddr))},\n                                 {clean_sess, CleanSess},\n                                 {protocol, ProtoVer},\n                                 {connack, ConnAck},\n                                 {ts, emqttd_time:now_secs()}]),\n    Msg = message(qos(Env), topic(connected, ClientId), Payload),\n    emqttd:publish(emqttd_message:set_flag(sys, Msg)),\n    {ok, Client}.. The binary package for Debian 9 has been released: http://emqtt.io/downloads/latest/debian9-deb. @naruto0916 The HTTP publish API does not support CORS. You can create a MQTT/Websocket  connection to publish messages on web browser.. @rauger\n\nRemove or comment the 'listener' configuration items in etc/emq.conf to disable a listener.\n\nJust enable the emq_auth_mysql plugin.. @pineli Please contact zhengyu.pan@emqtt.io who is responsible for EMQ global marketing.\n. @enlangs Please deploy EMQ on linux platform. . @syberkitten Do you create one subscriber to consume messages from many publishers?. @ArmorHerO I will close the issue first.. @UserXYZ \n\n\nYes. The CoAP and MQTT clients can communicate with each other. For example,\n    CoAP <- EMQ -> MQTT\n\n\nWorks like Eclipse Ponte. \n\n\nThe documentation on how to publish a MQTT message: https://github.com/emqtt/emq-coap#publish\n\n\nIf any issues, contact @grutabow \n\n\n. @grutabow Please check the issue. . @pritstift @PiedPieper Plan to support this feature in R2.3 or 2.4 release. @RaymondMouthaan Plan to support this feature in 2.4. We have to upgrade emqttc library to support MQTT5.0 first:). @huangdan Please add a benchmark case for the issue. @codewiget95 This feature will be released in R2.3 :). @codewiget95 My email: feng@emqtt.io We implemented this feature using ssl:peercert to decode the DN and CN. You can discuss your design with zhengyu.pan@emqtt.io and submit a PR later:). @uodasuodas @rejji @codewiget95 @codewiget95 The X.509 certificate-based authentication has been production ready in R2.3.2. Close the issue.. @syberkitten  Crash is usually caused by a slow subscriber which accumulates messages in memory. There will be a crash.dump file generated under the logs folder if the Erlang VM crashed.. @sivalai All the features you mentioned have been prod ready before EMQ R2.2 release. \nThe documentation: http://emqtt.io/docs/v2/. The esockd library has been upgraded to support 'nosupend' option. Close the PR.. @syberkitten We will release more management APIs including clientId lookup in 2.3-beta.2 . @syberkitten More HTTP Management APIs have been added in 2.3-beta.2 release.. @nikoladsp Comment the verify_peer option if you use one-way SSL authentication:\n```\nlistener.ssl.external.verify = verify_peer\nlistener.ssl.external.fail_if_no_peer_cert = true\n```. @GibliX Open the 6369 port which is used by cluster channel between nodes. The configuration is in etc/emq.conf:\n```\nDistributed node port range\nnode.dist_listen_min = 6369\nnode.dist_listen_max = 6369 \n```\nClustering on AWS: https://github.com/emqtt/emqttd/issues/496. Partial network partition or firewall issue between Host A and C. Please try to grep \"inconsistent_database event\" log/*  on Host A or C. @GibliX Are all the nodes in the same VPC? . @samhuangszu Invalid MQTT packet received by the broker. Please check your client side's implementation.. @vinayxbox Please try to build the rebar manually:\ncd .erlang.mk\\rebar\ntouch ebin/rebar.beam\nrun bootstrap.bat\nNotice that EMQ should not be deployed on Windows in production.. The broker will not create the $client/<clientId> subscription if tuning off the auto subscription module in etc/plugins/emq_modules.conf:\nmodule.subscription = off. @PiedPieper  Turn off the module.subscription by default in 2.3.1 release.. @edgiru This issue is introduced in 2.3-beta.2. Please install the 2.3-beta.3 or 2.2.0 release.. Fixed in PR: https://github.com/emqtt/emqttd/pull/1223/. @Rotem19 Documentation on Redis Authentication/ACL Plugin: http://emqtt.io/docs/v2/plugins.html#emq-auth-redis-redis-auth-acl-plugin. @emnvn Please send me the log/crash.dump. My email: feng@emqtt.io. @Jowin Firewall should make the 4369, 6369 ports accessible for bridged nodes.\nDeployment: http://emqx-enterprise-docs-en.readthedocs.io/en/latest/deploy.html. @fleimgruber The 2.3-beta.4 has been released. Please verify and close the issue.. @trehn Fixed the badmatch exception in emqttd_ws_client.erl module though it will not crash the broker: https://github.com/emqtt/emqttd/commit/db3a54e31a654235208eace9f53531b86dd96462\nClose the issue first.. @srdgame, Thanks for the security report. The issue will be fixed in 2.3-rc.1. @srdgame The issue has been fixed in 2.3-rc.1 release. https://github.com/emqtt/emqttd/commit/88c77cf4c2e11e6cb1be27316c353060921b4018. Won't fix.. Invalid issue. A master node should be started first, and the following nodes join in.. @CheyenneForbes No. The HTTP Publish API calls the MQTT Publish too.. @CheyenneForbes I will plan this feature in 2.4 release. Thanks.. @EagleSmith The issue has been fixed in 2.3-beta.4. @BerkOzdilek Thanks.. @chriswue . @trehn This feature is in TODO list still.. @Linuturk The issue has been fixed in 2.3-rc.1 release.. Close the issue.. Invalid issue, closed.. @nareshbvemula Added more log configurations in 2.3-rc.1 release to fix the issue. \n```\nConsole log file size\nlog.console.size = 10485760\nConsole log count size\nlog.console.count = 5\nError log file size\nlog.error.size = 10485760\nError log file count\nlog.error.count = 5\n```. @atulgoswami21 How many clients publishing QoS1 messages?. @atulgoswami21 Please provide more information for the case, we will try to reproduce the issue:\n\nThe topics which clients subscribed and published to.\nThe CPU/Mem of the VM which EMQ is running on.\nAre you sure the subscriber never reconnects to the broker?\n\n. @sinegole Close the issue.. @MarcMagnin The topics and routes are created when there are subscriptions on a node in the cluster, and removed dynamically if no subscriptions in the cluster.. @ranvijayj which package you installed? \nEnvironment\n\nOS: ?\nErlang/OTP: ?\nEMQ: ?. @ameyaapte1, we introduced a emqx organization which helps build a IoT messaging platform based on EMQ.  The emq-lwm2m project has been moved to emqx/emqx-lwm2m and will be released in 2.4-beta.1. @asciijungle The EMQ organization will focus on MQTT messaging broker. So we moved the emq_lwm2m project to emqx organization, which is aimed to provide a scalable messaging platform for IoT applications. \n\nYou can pull the latest master branch to build the 2.3-rc.1 release, or remove the emq_lwm2m DEP in Makefile and relx.config from emqx-relx project.\n. @victorclaessen, The MQTT v3.1.1 specification on this issue:\nIt MUST set the RETAIN flag to 0 when a PUBLISH Packet is sent to a Client because it matches an established subscription regardless of how the flag was set in the message it received [MQTT-3.3.1-9].\n. @victorclaessen Plan to implement the feature in version 2.3.1, which will be released next weekend;). @victorclaessen The issue has been fixed in develop branch: \nhttps://github.com/emqtt/emqttd/commit/26fb809dbed287854cee2d97fb717cb72751649c\nBuild EMQ from source of develop branch:\ngit clone -b develop https://github.com/emqtt/emq-relx.git \ncd emq-relx && make run. @ victorclaessen First ps -ef | grep beam to check if there is already a running EMQ. Kill it and then make run or make && cd _rel/emqttd && ./bin/emqttd console:). @victorclaessen cd deps/emqttd && git pull and then make run again. \n@huangdan Please add unit test cases for the clean_retain/2 function.. Invalid issue, closed. @shuaibakram The issue will be fixed in emq-auth-mongo plugin.  . @carlos-renjel-coderoad-com Enable the client Stats in etc/emqttd.conf:\n```\nEnable client Stats: on | off\nmqtt.client.enable_stats = on\n``. @jhor511 I close the issue first. Please install the v2.3.0 and verify it.. Close the issue.. @yogo1212 This issue has been fixed in 2.3.0. Close the PR.. @michaelcplusplus No difference. We build two binary packages for windows to avoid compatible issue.. Close the issue.. @terry-xiaoyu Yes. The broker will not publish adisconnected` $SYS message when a client is kicked out.\n. @sincsc You can tune the mqtt.keepalive_backoff to shorten the keepalive timeout. For example:\nmqtt.keepalive_backoff = 0.75. The mqtt.keepalive_backoff option is introduced in 2.3 release.. @franquis The MQTT/WS listener still not support extracting the source address from HTTP X-* Headers. We plan to implement the feature in 2.4-beta.1, thanks.. @sfowlr @franquis Merged the feature to 2.3.4 release. Now the broker supports two ways to get the real IP address of a WebSocket connection.\n\nVia 'X-Forwarded-For' and 'X-Forwarded-Port' headers\n\nNginx Config:\nlocation / {\n  proxy_set_header X-Forwarded-Port $server_port;\n  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  ...\n}\netc/emq.conf:\nlistener.ws.external.proxy_address_header = X-Forwarded-For\nlistener.ws.external.proxy_port_header = X-Forwarded-Port\n\nVia Proxy Protocol V1/2:\n\nHAProxy Config:\nbackend emq_nodes\n    mode tcp\n    server emq1 192.168.1.10:8083 check-send-proxy send-proxy-v2\netc/emq.conf:\nlistener.ws.external.proxy_protocol = on\nlistener.ws.external.proxy_protocol_timeout = 3s. Hi @congleetea, the 'erase_monitor/2' function is usually called after the process received {'DOWN', MonitorRef, _, _, _} message. So is it necessary to erlang:demonitor/1 the reference?. @congleetea Fixed in 2.3.0 release. Close the issue now.. @rainmanwy One subscriber cannot consume more than 20K/S messages.  Please use shared subscription if there are many publishers and fanin messages.\nDocs: http://emqtt.io/docs/v2/advanced.html#shared-subscription. Close the issue.. @Think7\nCLI:  http://emqtt.io/docs/v2/commands.html\nHTTP API: http://emqtt.io/docs/v2/rest.html#disconnect-a-specified-client-in-the-cluster. @Densaugeo No. We don't know who occupied the emqttd organization on docker hub;) \nDownload the latest docker image from: http://emqtt.io/downloads/latest/docker\n. @7wonders I changed the default configuration for management API listener. Close the issue.. Close the issue.. @ForLina How about the CPU/Memory of the EMQ broker you deployed?. @yyguo1986 @HJianBo We should support reloading the config without a reboot, I think.. @wiiikiii The authentication/ACL chain will not work if you enabled emq_auth_http plugin:) . @wiiikiii Plan to fix the issue in 2.4-beta.1. @jchapuis Thanks. I will review the PR and merge it into develop branch.. @madhushreegc \n\nThe EMQ broker usually depends on backends such as Redis, MySQL or Cassandra to replicate the MQTT messages.\nThe topic trie and routing table in memory should not be replicated to remote cluster for all the topics and routes are created by the MQTT clients connected to local cluster.. @madhushreegc Yes. The design should ensure that clients can receive pending messages from secondary cluster.. @Tabrizian which release? The latest is R2.3.0, no 2.7 available still.. @Tabrizian Close the issue.. Invalid issue.. @ztittle This feature will be ready in version 2.4-beta.1 next week.  Erlang/OTP consumes too many resources to handle TLS connections, so we plan to use HAProxy and the Proxy Protocol V2 to extract CN from X.509 certificate.. @ztittle The X.509 certificate-based authentication has been improved in R2.3.2. Close the issue.. @totojack Please build from the master branch. We add a [nosuspend] option for esockd_transport:async_send/2 function, unfortunately the API is not compatible with EMQ 2.3.1 now.\n\nThe esockd's PR: https://github.com/emqtt/esockd/pull/68/files#diff-89fb9387460bd864daea135b8df9f346L129. @hachreak The esockd v5.1 improved the esockd_transport:asynd_send/2 function, and unfortunately the upgrade is incompatible with v4.x. \nPlease clone the latest master branch if you build EMQ from source. We pined the esockd version to fix the issue:\ndep_esockd = git https://github.com/emqtt/esockd v5.1\n. Close the issue.. @yossita Fix the issue in PR: #1418. @lv12312 Thanks for the issue report, I will fix it in the ekka project.. @lv12312 Fixe in PR: https://github.com/emqtt/ekka/pull/17. Duplicate with https://github.com/emqtt/emq-sn/issues/58. Fixed in 2.3.2 release.. @jlgm The log means that an unexpected message sent to the MQTT connection process, and which is ignored. This will not crash EMQ broker. \n@HJianBo Please fix the issue in 2.4-beta.1 release, Thanks.. @xerosanyam Please check if your plugins are loaded successfully. The exception is thrown in function emqttd_app:after_autocluster/0:\nafter_autocluster() ->\n  emqttd_plugins:init(),\n  emqttd_plugins:load(),\n  start_listeners().. @xerosanyam The exception is confusing and any suggestion to improve? I plan the fix for the 2.4-beta.1 release.. @kutashenko The EMQ 2.3.3 has been released. Please download the binary packages from http://emqtt.io/downloads. @jkwong38 The LwM2M has been moved to EMQ X project and will be prod-ready in R3.0.\n  . @mingchuno Fixed in 2.3.3 release.. @hbli See http://emqtt.io/docs/v2/tune.html. Closed the issue.. @Eric24, Please contact zhengyu.pan@emqtt.io who is responsible for EMQ global marketing.\n@zhengyupan Please contact @Eric24, Thanks.\n  . @victorclaessen I will list the API breaking changes later, thanks for your report.. @Bakkiyaraj See: http://emqx-enterprise-docs-en.readthedocs.io/en/latest/deploy.html#load-balancer-lb. @ertanden Thanks for the benchmark report. @huangdan Please benchmark WS connections of EMQ with tool: https://github.com/hareeqi/mqtt-benchmark. @atomrocktech No. Each node should be configured separately. You can copy one emq.conf to different nodes and use ENV to setting the node.name. . @syberkitten The behavior of retained message should be the same to normal PubSub messages if the consumer client is online or cleanSession flag is false. \nAccording to the MQTT v3.1.1 specification, the broker should ensure only one retained message for a new subscription.. @chcmq  check the username and password options in emq_auth_mysql.conf:\n```\nMySQL username.\n\nValue: String\nauth.mysql.username =\nMySQL password.\n\nValue: String\nauth.mysql.password =\n``. @nvandamme Addnode.proto_dist = inet6_tcpconfiguration to support node name with IPv6. You can clone thedevelop` branch and build to verify the issue:\ngit clone -b develop https://github.com/emqtt/emq-relx.git\ncd emq-relx && make run. 1. Add node.proto_dist option to support node name with IPv6 address:\nnode.name = emq@::1\nnode.proto_dist = inet6_tcp\n\nAdd listener.<proto>.<name>.reuseaddr to support binding the same port on different IP interface:\n\n```\nlistener.tcp.external= 0.0.0.0:1883\nlistener.tcp.external.reuseaddr = true\nlistener.tcp.localhost = 127.0.0.1:1883\nlistener.tcp.localhost.reuseaddr = true\n``. @victorclaessen Fixed the issue in theemq-retainerandemqttdprojects. Theemq_protocolmodule will not clean theretain` flag for a new subscription now.. @AhnSeongHyun Tune the option:\n```\nMaximum QoS2 packets (Client -> Broker) awaiting PUBREL, 0 means no limit.\n\nValue: Number\nmqtt.session.max_awaiting_rel = 1000\n```\nQoS2 message is expensive to dispatch. The broker has to hold the QoS2 messages awaiting PUBREL in memory and drop the later when the awaiting queue is full.. @TheBeachMaster Turn off the Proxy Protocol Flag:\nlistener.ws.external.proxy_protocol = off\nlistener.wss.external.proxy_protocol = off. @promission Good idea:) Plan to support this feature in 2.4-beta.1. @syberkitten Do you build the EMQ from source? This issue has been fixed in version 2.3.3. @syberkitten I cannot reproduce the issue on my Mac. The steps:\n\nBuild EMQ from the latest master\n\ngit clone https://github.com/emqtt/emq-relx.git\ncd emq-relx && make\n\nConfigure the SSL listener:\n\nlistener.ssl.external.keyfile = etc/certs/key.pem\nlistener.ssl.external.certfile = etc/certs/cert.pem\nlistener.ssl.external.cacertfile = etc/certs/cacert.pem\nlistener.ssl.external.verify = verify_peer\nlistener.ssl.external.fail_if_no_peer_cert = true\n\nPubsub with mosquitto client:\n\n```\nmosquitto_sub -t topic -p 8883 --cafile etc/certs/cacert.pem --cert etc/certs/client-cert.pem --key etc/certs/client-key.pem  --insecure -d\nmosquitto_pub -t topic -m haha --cafile etc/certs/cacert.pem --cert etc/certs/client-cert.pem --key etc/certs/client-key.pem  --insecure -p 8883\n``. @syberkittengit pull` will not update deps/*.. Cool issue, closed.. @TheBeachMaster Cannot reproduce the issue, please check if your hostname is valid.\ntelnet some.remote.host 3306\n. @sm2017 This feature will be implemented in 2.4-beta.1. @tu226 Please attach your etc\\plugins\\emq_auth_redis.conf and redis.conf. @amirkheirabadi Do you modify the config files?. @PiedPieper The issue has been fixed in develop branch. More information at PR  #1504 and PR https://github.com/emqtt/emq-docs-en/pull/41.. @haok3166 The prometheus monitoring plugin will be released in version 2.4-beta.1.. @perroudchris The shared subscription feature should be improved in 2.4 release, exactly to feed the scenario you required.\nWe should ensure a QoS1/2 MQTT message be delivered to an online client.  . I submit a PR #1504 to support Erlang SSL distribution. @PiedPieper  Please pull the develop branch and build to verify the issue, Thanks. @PiedPieper The feature has been released in 2.3.5. Tune on the TLS distribution in emq.conf:\nnode.proto_dist = inet_tls\nand then configure TLS options in etc/ssl_dist.conf.. @PiedPieper I added a brief article in the emq-tutorial-en project, please help review: https://github.com/emqtt/emq-tutorial-en/pull/3 . @TheBeachMaster The AMQP bridge is ready in EMQ X, the enterprise edition of EMQ. Please contact zhengyu.pan at emqtt.io who is our global support for more information.. @nagendraK6 The issue has been fixed in v2.3.5..  Question 1: is this suitable ec2 instance type for my purpose?\nA: It's enough for 10K SSL connections. It's better to deploy a LB to handle SSL offloading in the front of EMQ cluster in production.\nQuestion 2: What is the correct setting value for apache jmeter?\nA: Please check the mqtt-jmeter plugin.\n. @incowiz Sorry for the delay reply that I took biz trip these days. Please contact @zhengyupan for the commercial support plan.. @izarraga I submit an issue #1522 for unsubscribe API. Close the PR.. Hi @Eric24, EMQ R2 does not support this WS specification still. I can add the feature to the plan of EMQ R3.. @incowiz The configurations are not right, the cluster.dns.app should be same on all the nodes.\n\nthe 1st EC2 instance \n\ncluster.discovery = dns\ncluster.dns.name = LB-xxxx-71698xxxx.ap-northeast-2.elb.amazonaws.com # this my aws classic load balancer's DNS A-record\ncluster.dns.app = emq\nnode.name = emq@172.31.10.214\n\nthe 2st EC2 instance \n\ncluster.discovery = dns\ncluster.dns.name = LB-xxxx-71698xxxx.ap-northeast-2.elb.amazonaws.com # this my aws classic load balancer's DNS A-record\ncluster.dns.app = emq\nnode.name = emq@172.31.10.71. @incowiz Did you change the nodes' name? Steps to debug the issue:\n\nStart one node in console mode:\n\n./bin/emqttd_ctl console\n\nCheck if the Erlang VM can lookup the DNS A records:\n\ninet_res:lookup(\"LB-xxxx-71698xxxx.ap-northeast-2.elb.amazonaws.com\", in, a).\n. @lv12312 It seems the mqtt_metric ets table has gone. Are there any crash or error logs? . @lv12312 There will be OOM to crash the broker, if a slow subscriber cannot handle messages from too many publishers.\n\n\nUse shared subscription to load balance the throughput: http://emqtt.io/docs/v2/advanced.html#shared-subscription\n\n\nThe broker will support 'Flow Control' and 'Slow Subscriber Detection' in next release.\n. @aravindranathan All the EMQ R2.3+ releases are built on Erlang/OTP R20+. Thanks for the security report. @huangdan @zhengyupan Please verify the issue using the ROBOT test tool.\n\n\n. @hung119 EMQ R3 will ensure an subscription take effect when the client received 'SUBACK'.\n. @devilwacause The Session Expiry Interval can be tuned in etc/emq.conf.. @nagendraK6 The broker cannot ensure the order of a message published to many clients, for the dispatch process is asynchronous.. Hi @rejji, from the metrics and statistics in the attached documents, we found there are two issues in your case:\nSSL Subscribers\nProblem\nThe SSL subscribers should not connect to EMQ broker directly. We usually suggest deploying a HAProxy in the front of EMQ cluster to terminate the SSL connections for the SSL library of Erlang/OTP will not GC the binary references actively. If no global GC is enabled, the memory/system and memory/binary will increase over time. The stats showed in the Memory_59connections_8pm.xlsx:\nTime | 8:05 | 8:35 | 11:11 | 12:04\n-- | -- | -- | -- | --\nClients | 59 | 59 | 59 | 59\nDocker-stats mem | 229533286.4 | 230162432 | 258788556.8 | 271371468.8\nmemory/total | 173655712 | 177480304 | 196890448 | 204269464\nmemory/system | 136742168 | 140071816 | 159436608 | 166511896\nmemory/binary | 54452480 | 57241728 | 73618688 | 79528920\nSolutions\n\nLoad the emq_recon plugin and enable the global GC in the 'etc/plugins/emq_recon.conf':\n   recon.gc_interval = 5m\nDeploy a HAProxy in the front of EMQ Cluster to terminate SSL connections:\n   http://emqx-enterprise-docs-en.readthedocs.io/en/latest/deploy.html#haproxy-emq-x\nUpgrade the EMQ to 2.3.5, and enable the force GC:\n\n```\nForce GC the MQTT connections. Value 0 will disable the Force GC.\n\nValue: Number >= 0\nmqtt.conn.force_gc_count = 100\n```\nMany Publishers and Slow Subscriber\nProblem\nIf there is a slow subscriber which consumes messages published from many publishers, all the messages which cannot be delivered/acked by the subscriber will be accumulated in the memory of EMQ broker if queue.max_length=infinity. \nErlang/OTP is a soft real-time system, which schedules all the processes via preemptive scheduling.  Each process will be assigned the same reductions and time slice of CPU. This makes things worse for a slow subscriber cannot get more CPUs though it has a lot of work to be done:)\nThe metrics in MemoryComponents_1270connections_4pm show there are almost 188K+ messages are accumulated in the memory queues of the subscribers:\nTime | 4:07 | 4:37 | 5:00\n-- | -- | -- | --\nClients | 1270 | 1270 | 1272\nDocker-stats mem | 1286342705.152 | 1438814044.16 | 1503238553.6\nmessages/qos1/received | 7601929 | 8588905 | 9279696\nmessages/qos1/sent | 7421823 | 8403690 | 9091142\nmessages/received | 7601929 | 8588905 | 9279696\nmessages/sent | 7421823 | 8403690 | 9091142\nSolutions\n\nUse etop to check if the subscribers' processes consume most memory:\n\n```\n./bin/emqttd attach\nspawn(fun() -> etop:start([{lines, 20},  {sort, memory}]) end).\n```\nNotice that CTRL+D to quit the console!\n\n\nA subscriber deployed in the local network can consume about 2K+ QoS1 messages/second in our benchmark. From the metrics in the MemoryComponents_1270connections_4pm.xlsx, the pub rate is about 500 messages/sec, we have to check if the subscribers can consume messages at the same rate.\n\n\nLoad balancing among a group of subscribers via shared subscription:\n---------\n                            |       | --Msg1--> Subscriber1\nPublisher--Msg1,Msg2,Msg3-->|  EMQ  | --Msg2--> Subscriber2\n                            |       | --Msg3--> Subscriber3\n                            ---------\n\n\nIf the subscribers consume messages and then insert them into databases, I suggest to upgrade EMQ to the enterprise edition, which helps store messages in a database directly:\n   http://emqx-enterprise-docs-en.readthedocs.io/en/latest/backends.html\n\n\n. @hui6075 The issue is fixed in PR #1814.. @phanimahesh Thanks.. @PiedPieper The cluster.name is ignored in the current implementation. I will plan the feature in 0.3 release.. Closed the PR. mqtt.pubsub.pool_size option is deprecated in EMQ X R3.0. @andrewchambers \n\nThe EMQ cluster is usually deployed behind a LB such as HAProxy. The MQTT client on device connects to the public address of the LB:\n\n\n\n\nThe clients which disconnected from the broker for one EMQ node is down, can reconnect to the same address of LB after a period of delay.\n\n\nThe EMQ cluster maintains a global routing table on all the nodes. If one node is down, the other nodes just cleanup the routing table and continue to work well.\n. @bbjj040471 @terry-xiaoyu This feature should be merged in EMQ X 3.0 open source edition. Merge the PR first. The emqx_gc should be a parameterized module.. @tigercl Add an option in etc/emqx.conf allowing users to configure the URL path of MQTT/WebSocket.. @spring2maz Thanks. The mqueue module should be improved later.. @liulangzhe Fixed in PR: https://github.com/emqx/emqx/pull/1856\n. @liulangzhe Please download the 3.0-beta.3 release to verify the issue: http://emqtt.io/downloads. Hi Shawn, this is not right.. @Gilbert-Wong This is not a bug. @mzy2240 Please disable the rate_limit option in etc/emqx.conf:\n\n\n```\nRate limit for the external MQTT/TCP connections. Format is 'rate,burst'.\n\nValue: rate,burst\nUnit: Bps\nlistener.tcp.external.rate_limit = 1024,4096\n``. @phper-chen You can configure the dispatch strategy inetc/emqx.conf`:\n```\nDispatch strategy for shared subscription\n\nValue: Enum\n- random\n- round_robbin\n- hash\nbroker.shared_subscription_strategy = random\n```\n. @callbay Merged. Thanks.. Ok, Delete the io:format line.. Remove the line.. Increase the min_heap_size according to the Msg size?. ?LOG(warning, \"Duplicated PUBREC Packet: ~p\", [PacketId], State),. Params = [{iolist_to_binary(Key), Val} || {Key, Val} <- mochiweb_request:parse_post(Req)],\n. int(I) when is_integer(I)-> I;. bool(<<\"0\">>) -> false;\nbool(<<\"1\">>) -> true.. \nHTTP Management API Listener\n. listener.api.mgmt = 127.0.0.1:8080\nlistener.api.mgmt.acceptors = 4\nlistener.api.mgmt.max_clients = 64\nlistener.api.mgmt.access.1 = allow all. Remove the 'mountpoint' config . Remove the 'zone' config. try Mod:Fun(Args) of\n_ -> ok\ncatch\n_:Reason ->\n{error, Reason}\nend;. usage(),\n{error, not_found}. Remove the 'ok'. restart tcp 1883?. stop tcp 1883?. Fix the tailer. \"api/v2/clients/{clientid}/clean_acl_cache\". The emqttd application should not depend on emq_dashboard.. Value should be greater than 0, for there is 'enable_acl_cache' option.. Remove minirest. Use 'enable_acl_cache' option. do_check_acl?. do_check_acl?. Update the copyright . Add test cases for message_format. Add test cases for will_msg. listener.ws.external.mqtt_path = /mqtt. listener.ws.external.mqtt_path = /mqtt. {mapping, \"listener.ws.$name.mqtt_path\", \"emqx.listeners\", [\n   {default, \"/mqtt\"},\n   {datatype, string}\n ]}.. {mapping, \"listener.wss.$name.mqtt_path\", \"emqx.listeners\", [\n   {default, \"/mqtt\"},\n   {datatype, string}\n ]}.. {mqtt_path, cuttlefish:conf_get(Prefix ++ \".mqtt_path\", Conf, undefined)},. mqtt_path(Options). mqtt_path(Options). mqtt_path(Options) ->\n    proplists:get_value(mqtt_path, Options, \"/mqtt\").. Why put a default 'Message-Expiry-Interval'???. Should not update expiry in session. Do it in connection(emqx_protoco).. ## The path of WebSocket MQTT endpoint. ## The path of WebSocket MQTT endpoint. Filter([{acceptors, cuttlefish:conf_get(Prefix ++ \".acceptors\", Conf)},\n        {mqtt_path, cuttlefish:conf_get(Prefix ++ \".mqtt_path\", Conf, undefined)},. -ifdef(TEST).\n-compile(export_all).\n-endif..  proplists:get_value(mqtt_path, Options, \"/mqtt\").. Combine the three options to one 'zone..force_gc_policy':\n```\n{mapping, \"zone.$name.force_gc_policy\", \"emqx.conn_force_gc_count\", [\n   {default, \"Interval|Count|Bytes\"},\n   {datatype, string}\n ]}.. Translate the 'force_gc_policy' to a map:\nlists:to_map(lists:zip([interval, count, bytes],\n                                    [list_to_integer(Token) || Token <- string:tokens(\"Interval|Count|Bytes\", \"|\")])). {mapping, \"zone.$name.force_shutdown_policy\", \"emqx.zones\", [\n   {default, \"msg_queue_len|total_heap_size\"}, \n   {datatype, string}\n ]}.. Agree:). @tigercl Should not remove the function.. bridge.aws.address = .... ```\n- mqttv5\n- mqttv4\n- mqttv3\n. 60s. Remove the '$share/' prefix. -spec(add_subscription(Name, Topic, QoS) -> ok | {error, Reason}).. {error, already_exists}. {reply, ok, State}.\nzone.internal.mountpoint = cloudbound/\n.\nmqtt.response_topic_prefix = $response/\n.\n{default, \"$response/\"}\n``. Replace thenode.schedulers.total,node.schedulers.onlineoptions withnode.schedulers` .\nThe type of value should be integer or string, for example: 4, 4:4. Merge the two configs: node.dirty_cpu_schedulers.total, node.dirty_cpu_schedulers.online.\n. Remove the node.schedulers.cpu_topology config. 64MB is too big, use 8MB still.. Improve the hold/3 function:\nhold(Type, Metric, Val) when Type =:= counter orelse Type =:= gauge ->\n    put('$metrics', case get('$metrics') of\n                        undefined ->\n                            #{{Type, Metric} => Val};\n                        Metrics ->\n                            maps:update_with({Type, Metric}, fun(Cnt) -> Cnt + Val end, Val, Metrics)\n                    end).. Improve the commit/0 function:\ncommit() ->\n    case get('$metrics') of\n        undefined -> ok;\n        Metrics ->\n            lists:foreach(\n              fun({{Type, Metric}, Val}) ->\n                      update_counter(key(Type, Metric), {2, Val})\n              end, maps:to_list(Metrics)),\n            erase('$metrics')\n    end.. Remove the metric_commit_interval env. undefined -> error({plugin_not_found, AppName}). ",
    "hfeeki": "lager \u662f\u81ea\u52a8\u4e0b\u8f7d\u5230lib\u76ee\u5f55\u7684, \u8fd9\u6837\u5b50\u6709\u95ee\u9898\u7801\uff1f\n. /usr/local/lib/erlang/lib/ \u76ee\u5f55\u4e0b\u9762\u6ca1\u6709lager, \u8bb0\u4e0d\u6e05\u4e4b\u524d\u6709\u6ca1\u6709\u88c5\u8fc7\uff0c\u6709\u6ca1\u6709\u4ec0\u4e48\u529e\u6cd5\u67e5\u770berlang\u7684\u52a0\u8f7d\u8def\u5f84\u5462\uff1f\n. \u8001\u7248\u672c\u7684eMQTT\u6ca1\u6709\u8fd9\u4e2a\u95ee\u9898\n. 1> code:lib_dir().\n\"/usr/local/lib/erlang/lib\"\n\u8fd9\u4e2a\u662f\u6211\u7684lib\u8def\u5f84\uff0c\u8be5\u8def\u5f84\u4e0b\u9762\u6ca1\u6709lager. \u4f3c\u4e4e\u4e0d\u662f\u4f60\u8bf4\u7684\u539f\u56e0\u3002\n. \u6211\u4f5c\u5982\u4e0b\u64cd\u4f5c\u540e\uff0c\u5c31\u80fdok\uff1a\ncd lib\nmv lager lagerxx\ncd ..\n//  remove lager deps from rebar.config \nmake \nmake generate \n. \u5bf9\uff0c\u8ddfemqtt\u5e73\u7ea7\u7684\u6709\u4e00\u4e2alager\uff0crebar\u5bb3\u7684\u3002\u9700\u8981\u5f00\u53d1\u3001\u6d4b\u8bd5\u5417\uff1f\u6211\u5bf9\u8fd9\u4e2a\u9879\u76ee\u5f88\u6709\u5174\u8da3\n. \u8fd9\u4e2a\u9879\u76ee\u6709\u5565\u8ba1\u5212\u3001TodoList\u5417\uff1f\u6211\u60f3\u76ee\u524d\u6211\u6700\u9002\u5408\u7684\u5de5\u4f5c\u662f\u5199\u4e9b\u5355\u5143\u6d4b\u8bd5\u5565\u7684\uff0c\u5982\u679c\u4f60\u80fd\u591f\u591a\u5199\u4e9b\u6587\u6863\u5565\u7684\u5c31\u597d\u4e86\uff0c\u8fd8\u6709\u6709\u5176\u4ed6\u7684\u6c9f\u901a\u9014\u5f84\u7801\uff1f\u6bd4\u5982\u8bf4\u5fae\u535a\uff0cQQ\uff1f \n. ",
    "nodephp": "ok thanks\n. ",
    "mworrell": "A fix for this is included in #19 \n. I am changing some things in the ACL connection, which turned out to be a bad fit.\nWill redo this pull request in the coming days.\n. I am connecting emqtt to zotonic and after some more testing I found problems with the mapping of topic trees between sites.  This is now fixed and being tested.\nI also made the way the acl is configured more similar to the way auth can be configured, less confusion.\n. ",
    "zjzhang-cn": "gold rush need by lager \n[root@ailk3 lager]# cat rebar.config \n{erl_opts, [debug_info]}.\n{erl_first_files, [\"src/lager_util.erl\"]}.\n{deps, [\n        {goldrush, \".*\",\n            {git, \"git://github.com/DeadZen/goldrush.git\", {tag, \"879c69874a\"}}}\n       ]}.\n{cover_enabled, true}.\n{edoc_opts, [{stylesheet_file, \"./priv/edoc.css\"}]}.\n. Erlang R16B01\n\u6b65\u9aa4\u5c31\u662f\u60a8\u8bf4\u7684\u7684\u90a3\u51e0\u6b65 git \\make \\make generate\n. ",
    "joshuanapoli": "Thanks, I originally had a problem with a bad build of Erlang (from Homebrew on OSX). I figured that out but ran into another problem:\n==> goldrush (compile)\nERROR: Cannot parse OTP Release version string: 17\nProbably because version strings seemed to have changed format with the release of Erlang/OTP 17.\n. Thanks.\n. ",
    "desoulter": "Oh, thank you, it works good!\n. Hi erylee,\nIt works perfectly!\nGreat job, thank you!\n. ",
    "Ethanjfobrien": "How do you set up the config files to support a socket connection to the broker?\nI'm trying to test using wscat -c ws://localhost:8083/mqtt but I get \nerror: Error: unexpected server response (400)\nand the broker console output is:\n17:38:32.386 [info] Websocket Connection from: 127.0.0.1\n17:38:32.386 [error] WebSocket with error Protocol: undefined\nAny help you can provide with this would be hugely appreciated!\n. Thanks very much,\nI got it working using mqtt.js:\nmqtt pub -t 'hello' -l 'ws' -h 'localhost' -p '' -m 'hello' -v\nwscat doesn't support the mqtt socket protocol\n. ",
    "zxc1021": "oh i hava solve it,i change the rebar file .when make the binery file rebar have error\n. ",
    "kansifang": "\u6211\u4e5f\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c\u5f53\u540c\u4e00\u4e2aTOPIC\u8ba2\u9605\u4e24\u6b21\u5c31\u4f1a\u6536\u5230\u4e24\u6761\u4fe1\u606f\n. I have the similar problem that is a client subscribe a topic twice or three times,when publish a message to the topic, the client will receive  twice or three messages\u3002\n. This is a bug or can throuth config to void this problem?\n. Can suport in future?\n. ",
    "sailingchen": "subscribe the topic , client:\n1.  disable 'clean session'\n2. qos set  1\n3. no retained message\n4.  set the client_id\nexample for mosquitto:\nmosquitto_sub   -c -i 0000aaeef -q 1   -t a/b/c\nnote: don't use the -r option.\ntested  it .\n. just like mosquitto, the acl file : \nuser testuser\n  topic  read a/b/c\n  topic read  d/e/f/#\n. I use mqtt  in android app,not use ssl connect, I think it is better like this:\n(1) support authentication\n(2) control the auth user access some topic , read only, not allow publish , the user write in android app configure.\n(3) but another auth user can publish the topic , just for web publish.\nThanks!\n. now I use mosquitto , my aclefile is :\n```\nuser testuser\ntopic read a/b/c\ntopic read d/e/f/#\nuser admin\ntopic readwrite  a/b/c\ntopic readwrite  d/e/f/#\n```\ntopic \"a/b/c\"   and \"d/e/f/#\"  is readonly for auth user testuser , but admin can publish.\n. This is some question about session and offline message queue:\nemqttd.conf :  \n        {session, [\n            %% Expired after 24 hours\n            {expires, 24},\n            %% Max offline message queue\n            {max_queue, 3},\n            %% Store Qos0?\n            {store_qos0, false}\n        ]}\n\nemqttd setting {max_queue, 3} , client subscriptions topic and set clean_sess=false and  qos=1,  when client disconnect , publish 10 message  with qos 1,  then connection to emqttd , client receive 10 message \u3002\n. \u8ffd\u52a0\uff1a \u5982\u679c \u7528\u4e8e\u8282\u70b9\u4e4b\u95f4\u5185\u90e8\u901a\u4fe1\u7684\u7aef\u53e3 4369 \u548c\u53e6\u5916\u4e00\u4e9b\u968f\u673a\u6253\u5f00\u7684\u7aef\u53e3\u66b4\u9732\u5728\u516c\u7f51\u4f1a\u4e0d\u4f1a\u6709\u5b89\u5168\u95ee\u9898, \u53ef\u4ee5\u8bbe\u7f6e\u76d1\u542c\u5185\u7f51IP\u5417\uff0c1883, 8883, 8083 \u8fd9\u4e09\u4e2a\u7aef\u53e3\u6709\u8ba4\u8bc1\uff0c\u6709ACL\u63a7\u5236\uff0c\u5b89\u5168\u4e0d\u592a\u6210\u95ee\u9898\u3002\n\u6211\u4eec\u6bd4\u8f83\u5173\u6ce8\u7684\u5b89\u5168\u5c31\u662f\u63a7\u5236publish \u6743\u9650\uff0c\u76ee\u524d\u7248\u672c\u529f\u80fd\u5df2\u6ee1\u8db3\uff0c\u901a\u8fc7\u4e0d\u540c\u7528\u6237+acl \u63a7\u5236 topic\u3002\n\u8c22\u8c22\uff01\n. Cluster \u5b58\u5728\u8fd9\u6837\u7684\u95ee\u9898\uff1a\n\u5ba2\u6237\u7aef\u65ad\u5f00\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u8fde\u63a5\u4e0a\u4e00\u4e2a\u4ece\u672a\u8fde\u63a5\u8fc7\u7684\u96c6\u7fa4\u8282\u70b9A\uff0c\u5728\u65ad\u5f00\u8fde\u63a5\u5230\u91cd\u65b0\u8fde\u63a5\u4e0a\u96c6\u7fa4\u8282\u70b9A\u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c\u5728\u96c6\u7fa4A\u4e0a\u53d1\u5e03\u7684\u6d88\u606f\u5219\u4e0d\u5230\u3002\n\u5f53\u7136 Bridge \u6a21\u5f0f\u4e5f\u5b58\u5728\u540c\u6837\u95ee\u9898\u3002\n. session takeover \u662f\u5ba2\u6237\u7aef\u5b9e\u73b0\uff0c\u8fd8\u662fbroker \u5b9e\u73b0\uff0c\u770b\u4e86\u4e00\u6bb5\u63cf\u8ff0\uff0c\u96fe\u91cc\u770b\u82b1\u4e00\u6837\uff1a\nClient Take-Over\nA disconnected client will most likely try to connect again. It could be the case that the broker still has an half-open connection for the same client. In this scenario the MQTT will perform a so-called client take-over. The broker will close the previous connection to the same client (determined by the same client identifier) and establishes the connection with the newly connected client. This behavior makes sure that half-open connection won\u2019t stand in the way of a new connection establishment of the same client.\n. \u6211\u4eec\u7528\u4e8e\u624b\u673aapp \u7684PUSH , \u770b\u6765\u76ee\u524d\u53ea\u6709\u4ece\u4e1a\u52a1\u5206\u5272\u3002\n\u6216\u8005app \u521d\u59cb\u5316\u8fde\u63a5broker \u65f6\uff0c\u8fde\u63a5\u4e00\u6b21\u6240\u6709\u8282\u70b9IP\n. Broker\u5b9e\u73b0\u7684Session Take-Over, \u548c\u4f60\u4e0a\u9762\u7684\u6587\u6863\u4e0d\u540c\u3002Broker\u96c6\u7fa4\u6a21\u5f0f\u4e0b\uff0c\u6bd4\u5982Session\u4e4b\u524d\u5728A\u8282\u70b9\uff0c\u65ad\u7ebf\u91cd\u8fde\u540e\u4eceB\u8282\u70b9\u4e0a\u7ebf\uff1b\u90a3\u4e48\u628aA\u8282\u70b9\u7684Session\u6570\u636e\uff0c\u5e94\u8be5\u4f20\u9012\u7ed9B\u8282\u70b9\u7684\u65b0Session\u3002\n\n\u8bf7\u95eeemqttd \u5177\u5907\u4e86\u8fd9\u4e2a\u529f\u80fd\u5417\uff0c\u76f8\u5173\u914d\u7f6e\u9009\u9879\u6709\u54ea\u4e9b\uff0c\u8c22\u8c22\u3002\n. emqttd_benchmark\n./run 192.168.0.1 1883 40000 10\nconneted: 21988\nconneted: 21989\nconneted: 21990\nconneted: 21991\nconneted: 21992\nconneted: 21993\nconneted: 21994\nconneted: 21995\nconneted: 21996\nconneted: 21997\nconneted: 21998\nconneted: 21999\nconneted: 22000\nconneted: 22001\nconneted: 22002\nconneted: 22003\n[error] [Client <0.16915.1>] CONNACK Timeout!\nclient 23452 EXIT: {shutdown,connack_timeout}\nconneted: 22004\n[error] [Client <0.16918.1>] CONNACK Timeout!\nclient 23451 EXIT: {shutdown,connack_timeout}\nconneted: 22005\n[error] [Client <0.16921.1>] CONNACK Timeout!\nclient 23450 EXIT: {shutdown,connack_timeout}\nconneted: 22006\n[error] [Client <0.16924.1>] CONNACK Timeout!\nclient 23449 EXIT: {shutdown,connack_timeout}\n\nemqttd_error.log \n11:55:06.453 <0.256.0> [error] large_heap: gcpid = <0.29.0>,[{registered_name,user_drv},{memory,114859432},{message_queue_len,440576},{heap_size,5157867},{total_heap_size,12594997}] \n [{old_heap_block_size,7427328},{heap_block_size,5157867},{mbuf_size,0},{stack_size,13},{old_heap_size,4213089},{heap_size,1505660}]\n11:55:08.645 <0.256.0> [error] large_heap: gcpid = <0.94.0>,[{registered_name,lager_event},{memory,91614496},{message_queue_len,7495},{heap_size,5157867},{total_heap_size,11354202}] \n [{old_heap_block_size,6189440},{heap_block_size,5157867},{mbuf_size,0},{stack_size,38},{old_heap_size,2335728},{heap_size,1328111}]\n11:55:15.920 <0.256.0> [error] large_heap: gcpid = <0.94.0>,[{registered_name,lager_event},{memory,103839640},{message_queue_len,16278},{heap_size,2072833},{total_heap_size,12768184}] \n [{old_heap_block_size,6189440},{heap_block_size,3581853},{mbuf_size,0},{stack_size,34},{old_heap_size,3663779},{heap_size,1147898}]\n11:55:36.066 <0.256.0> [error] large_heap: gcpid = <0.94.0>,[{registered_name,lager_event},{memory,99048392},{message_queue_len,18928},{heap_size,1439468},{total_heap_size,12134819}] \n [{old_heap_block_size,6189440},{heap_block_size,3581853},{mbuf_size,0},{stack_size,38},{old_heap_size,4811072},{heap_size,1092123}]\n11:56:01.735 <0.256.0> [error] large_heap: gcpid = <0.94.0>,[{registered_name,lager_event},{memory,118706832},{message_queue_len,21262},{heap_size,1727361},{total_heap_size,14561782}] \n [{old_heap_block_size,6189440},{heap_block_size,3581853},{mbuf_size,0},{stack_size,38},{old_heap_size,5903135},{heap_size,1118634}]\n11:56:31.685 <0.256.0> [error] large_heap: gcpid = <0.94.0>,[{registered_name,lager_event},{memory,118793152},{message_queue_len,22092},{heap_size,1727361},{total_heap_size,14561782}] \n [{old_heap_block_size,0},{heap_block_size,10695351},{mbuf_size,0},{stack_size,38},{old_heap_size,0},{heap_size,6313612}]\n11:57:02.266 <0.256.0> [error] large_heap: gcpid = <0.94.0>,[{registered_name,lager_event},{memory,142092032},{message_queue_len,22093},{heap_size,2072833},{total_heap_size,17474138}] \n [{old_heap_block_size,10695351},{heap_block_size,3581853},{mbuf_size,0},{stack_size,38},{old_heap_size,5847945},{heap_size,1076172}]\n11:57:33.073 <0.256.0> [error] large_heap: gcpid = <0.94.0>,[{registered_name,lager_event},{memory,118793152},{message_queue_len,22092},{heap_size,1727361},{total_heap_size,14561782}] \n [{old_heap_block_size,10695351},{heap_block_size,3581853},{mbuf_size,0},{stack_size,34},{old_heap_size,6924057},{heap_size,968758}]\n. @erylee \nThankyou very much, it's OK , only change log level \n{lager, [\n....\n{level, error},\n....\n]},\n. @erylee \ngood, Thankyou for your reply , waitting for  0.9.0 release in production.\n. Thanks \n. ",
    "huangdan": "1\u3001cpu metrics:\ncpu_sup:avg1()\u3001cpu_sup:avg5()\u3001cpu_sup:avg15()\u3001scheduler_usage/1\n2\u3001Memory metrics:\nerlang:memory()\uff1b\nallocated\uff1a reports the memory that is reserved by the VM.\nused\u3001unused\u3001usage\n. Process\uff1a\n1\u3001process list:\nPid\u3001Name\u3001reductions\u3001memory\u3001MsgQueue\u3001currentFun\uff1b\n2\u3001process information:\n[initial_call, current_function,registered_name,status,message_queue_len,group_leader,priority,trap_exit,reductions,binary,last_calls,catchlevel,trace,suspending,sequential_trace_token,error_handler]\n3\u3001memory and GC\n[memory,total_heap_size,heap_size,stack_size,min_heap_size,fullsweep_after]\nget_process_list/0;\nget_process_info/0\nget_process_gc/0\nget_process_group_leader_info/1\n. ETS\uff1a\n1\u3001get_ets_list/0\nets:all().\n2\u3001get_ets_info/0\nreturn: [{owner, Owner}|ets:info(Tab)]\n3\u3001get_ets_info(Tabname)\n[{owner, Owner}|ets:info(Tabname)]\n4\u3001get_ets_object/0\nets:tab2list(AllTable)\n5\u3001get_ets_object/1\nets:tab2list(SingleTab)\n. maybe emqttd_message:make return Message Type is not right\n. \u662f\u8bf4\u6240\u6709client\u6570\u5417\uff1f\nclient\u7684ets\u8868\u662f\u2018mqtt_client\u2019\n\u53ef\u4ee5\u901a\u8fc7emqttd_vm:get_ets_object(mqtt_client)\u83b7\u5f97\u5728\u7ebf\u5217\u8868\n\u5728\u4e4b\u540e\u7684\u7248\u672c\u6709dashboard\u53ef\u4ee5\u754c\u9762\u67e5\u770b\n. \u96c6\u7fa4\u6210\u529f\u4e86\u5417\uff1f\u4f60\u53ef\u4ee5\u53c2\u8003\u4e0b\u4e0b\u9762\u8fd9\u4e24\u4e2awiki\nhttps://github.com/emqtt/emqttd/wiki/Cluster%20Design\nhttps://github.com/emqtt/emqttd/wiki/Cluster\n. The EMQ 2.0+ fully supports Windows platform. You can run emqttd_ctl command  on Windows.. @foolbear  fix the bug in the next version\n. @anhldbk This issue is duplicated with #575. \n. Fixed in 1.1.1 release\n. publish retained message and configure the expiration in etc/emqttd.conf\nBTW we will release 'EmqPlus' product this month to help users store MQTT messages into DB\n. The 'topic' tab name has been changed in 2.0\n. Logger of emqttd broker is implemented by \u2018lager\u2019 application, which is configured in releases/2.0/sys.config\ndoc about log level\nen sites\uff1ahttp://emqtt.io/docs/v2/config.html#log-level-and-file\uff1b\ncn sites\uff1ahttp://emqtt.com/docs/v2/config.html#lager\n. @jhaoheng please refer to Add bold text \n{handlers, [\n  #   {lager_console_backend, info},\n```\n{lager_file_backend, [\n    {formatter_config, [time, \" \", pid, \" [\",severity,\"] \", message, \"\\n\"]},\n    {file, \"log/emqttd_info.log\"},\n{level, info},\n    {size, 104857600},\n    {date, \"$D0\"},\n    {count, 30}\n]},\n{lager_file_backend, [\n    {formatter_config, [time, \" \", pid, \" [\",severity,\"] \", message, \"\\n\"]},\n    {file, \"log/emqttd_error.log\"},\n    {level, error},\n    {size, 104857600},\n    {date, \"$D0\"},\n    {count, 30}\n]}\n```\n]}\nthe info/error log are save to emqttd/log\n. for the ./bin/emqttd_ctl CTL command can'n work on window (We will try to fix this issue later)\n. @numbertank you can read http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc398718103\n. @sgdba \nStart the broker in console mode:\n.\\bin\\emqttd console\nnot emqttd console\n. This release does not support win7 still\n. http://acro-engineer.hatenablog.com/entry/2015/12/09/120500\n. hi, You can find how to bridge mosquitto here http://emqtt.io/docs/v2/bridge.html\n. hi @drasko \nThe issue has been fixed in 2.0-rc.1,\nbut this version has not yet release,after the release ,please test  again \uff01\ud83d\ude42\n. please start the broker in console mode to check what's happened.\n .bin/emqttd console\n.  The HTTP API returns JSON data, please check your Webpage;\ud83d\ude42\n. Hi @gbrehmer, the status url: http://host:8083/status\n. I used the 1.1.3 version of the test, return to normal\nDo you want to check the running status of emqttd? \nhttp://localhost:8083/status\nTips: \nReplace 'localhost' with the corresponding address\n. 1\u3001SSL one-way authentication\u3001Mutual Authentication  is ok;\n2\u3001The Plugins emq_mod_presence\u3001emq_mod_subscription\u3001emq_mod_retainer  is enable;\n3\u3001fixed issue#739\n. Two ways to create a shared subscription:\n\n$queue prefix:\n\nmosquitto_sub -t '$queue/topic'\nmosquitto_pub -t topic -m hello\n2. $share/\\<group>/ prefix:\nmosquitto_sub -t '$share/group/topic'\nmosquitto_pub -t topic -m hello\n. Hi @mhls, I cannot reproduce the issue. Steps:\n\nHTTP publish retained message to 'topic'\uff1a\n\ncurl -v --basic -u test:test -d \"qos=1&retain=1&topic=topic&message=hello from http...\" -k http://localhost:8083/mqtt/publish\n\nClient Connects to the broker and subscribes 'topic'\n\nmosquitto_sub -t topic -d. Hi @simonmorley, We can't reproduce the issue. Steps:\n\nConfigure the MQTT/SSL listener in etc/emq.conf:\n```\n\nSSL Listener: 8883, 127.0.0.1:8883, ::1:8883\nmqtt.listener.ssl = 8883\nSize of acceptor pool\nmqtt.listener.ssl.acceptors = 4\nMaximum number of concurrent clients\nmqtt.listener.ssl.max_clients = 512\nRate Limit. Format is 'burst,rate', Unit is KB/Sec\nmqtt.listener.ssl.rate_limit = 100,10\nConfiguring SSL Options\nSee http://erlang.org/doc/man/ssl.html\nmqtt.listener.ssl.handshake_timeout = 20\nmqtt.listener.ssl.keyfile = etc/certs/key.pem\nmqtt.listener.ssl.certfile = etc/certs/cert.pem\nmqtt.listener.ssl.cacertfile = etc/certs/cacert.pem\nmqtt.listener.ssl.verify = verify_peer\nmqtt.listener.ssl.fail_if_no_peer_cert = true\n```\n2. A mosquitto client connects to the broker with SSL options:\nmosquitto_sub -t topic -p 8883 --cafile etc/certs/cacert.pem --cert etc/certs/client-cert.pem --key etc/certs/client-key.pem  --insecure\n\nRestart the EMQ broker:\n\n./bin/emqttd restart . @michaelcplusplus Current workarounds, you can try it:\n1.cd .erlang.mk\\rebar\n2.touch/create ebin/rebar.beam\n3.run bootstrap.bat. @watchworld The EMQ 2.2-rc.2 is compatible with Erlang OTP R20.. @SumitFlochat, With the release of emqttd 2.2.0\uff0cyou can run dialyzer with make dialyze. @vinayxbox  Current workarounds, you can try it:\n1.cd .erlang.mk\\rebar\n2.touch ebin/rebar.beam\n3.run bootstrap.bat. hi, @Shawn-ye \nCould you describe your  more detail for test scenario?\n for example:\nthe number of Pub/Sub Connection, QoS, the number of messages, the frequency of the message, the size of Payload, the number of Topic.. @tu226 Cannot reproduce the issue, Please provide more logs to for the issue.. @tu226, Are you sure that auth.redis.password in emq_auth_reids.conf is same as requirepass in redis.conf?. @tu226, You can try to execute the following command on the Redis Server: \nredis-cli -h 10.3.13.5 -n 10 -a crs-hp1n6w0b:jpyp123456. @tu226, is it possible  to get the redis.conf and emq_auth_redis.conf? You can mail it to huangd@emqtt.io. @tu226 Close it now and reopen it if you still have any questions.. @shrestha-clipapp \nCould you describe your more detail for test scenario?\u2028for example:\u2028\nthe number of Pub/Sub Connection, QoS, the number of messages, the frequency of the message, the size of Payload, the number of Topic.\n./bin/emqttd_ctl listeners to check the shutdown_count, for example:\nlistener on mqtt:tcp:1883\n  acceptors       : 8\n  max_clients     : 1024\n  current_clients : 0\n  shutdown_count  : [{closed,1}]. @yuregir Has been fixed and will be released at v2.3.9.. @epc2018, I can't reproduce this issue, please describe the test steps in detail.. @mzy2240, The issue has been fixed and will be released at 3.0-beta.3.. listeners -> listeners list. ",
    "roytan883": "0.8.2 seems still can not use + on $SYS\nI test :\n$SYS/borkers/+/clients/+/connected\n$SYS/borkers/emqttd@127.0.0.1/clients/+/connected\nboth can't receive client connect info\n. need wait 0.9.0? I download 0.8.2, it return \"Not found.\"\n. Thanks for clarify them.\nfollow question:\nmax_queued_messages for session. when the client with 'clean session' flag 0 and offline not expire.\n4, Will the broker put session's subscribed topic new messages to session's queue? \n5, If it limit 100, when the session subscribed topic1 and topic2, what will happen when topic1 fill 70 messages, then topic2 fill 80 messages?  After the reconnection, will the session lose first 50 message?\n. when the older one kick out, is there a reason or something client can know?  it was kicked not normal disconnection, then the client can stop reconnect.\n. I have looked though MQTT V3.1.1 protocol, can't find a elegant way to kick out older client and inform it should not reconnect -_-!\n. Can the broker auto publish a \"kick\" message to older client before close it ?\n. But i don't think the broker has ability to control client not reconnect. \nMust need some kinds of message to tell one of clients to stop.\nAlso, i tested mosquitto mqtt broker. It is the same, continual reconect.\n1433233406: New connection from 127.0.0.1 on port 1883.\n1433233406: Client user5 already connected, closing old connection.\n1433233406: Client user5 disconnected.\n1433233406: New client connected from 127.0.0.1 as user5 (c0, k60).\n1433233407: New connection from 127.0.0.1 on port 1883.\n1433233407: Client user5 already connected, closing old connection.\n1433233407: Client user5 disconnected.\n1433233407: New client connected from 127.0.0.1 as user5 (c0, k60).\n. I use userId as clientID.  I believe some other developer will also use uid as clientid.\nWhen the user change his phone, login on the new phone but forget logout on old one. Then the conflict happen.\nBut your idea is right, we need use deviceId as the clientId. The application server should keep track of the uid <--> deviceId map. Or the application server generate a unique ID for every new login.\n. So, need emqttd export username:\nhttps://github.com/emqtt/emqttd/wiki/Presence\nonly connected has username parameter. disconnected and HTTP API did not export username.\n. Can you add a HTTP API query presences by username ? \nThe presences interface only return online clientIds? \nHow to get those session not expire but offline ones? I only want push messages to those active users(48h expire). HTTP Query then push seems inefficient\uff0cmaybe i need write a plugin for push, the plugin will only push message to those username whos session exist. \n. @terry-xiaoyu How did it be solved? Do i need any configuration?. 3\uff0c subscribe some topic of the client by clientid\nWith 2 and 3, I can use emqttd as a pure push server.  Make my clients full passive, clients only need connect to emqttd and receive messages. Application server know what topic need to be subscribe and unsubscribe for a specified clientID at runtime. \nAlso this can save clients network traffic, clients no need subscription and unsubscription, all controlled by internal server.\n. 4, publish message to one username's all session, emqttd will use topic '$Q/client/ClientId'. \nIf the username has no session bind, then abandon this message and do nothing.\nThis can big improve thrid party server performance,  no need query, just push to those active user(48h expire). The client know how long it offline, it will sync information with application server by its own way(like HTTP request) when expired.\n. OK, i fixed it. It need use Content-type: application/x-www-form-urlencoded. Not support url params.\nNow, it worked.\n. seems the auto sub $Q/client/xxx force use qos 0\n[{<<\"$Q/client/ms1\">>,0}]. Granted QoS: [0]\ncan you add a config to sepcify the auto sub qos level?\n. OK, it worked. But i need auto sub 3 qos, then http publish can choose qos \n{autosub, [{\"$Q/client/qos0/$c\", 0},{\"$Q/client/qos1/$c\", 1},{\"$Q/client/qos2/$c\", 2}]}\nBy the way, how long will a topic expired? \n. Enhance HTTP admin feature (eg: I'm a nodejs user, not familar with erlang, enhance HTTP feature can make emqttd easier extending with other language)\u3002\n1, HTTP publish message by 'username', not 'clientId'. Because one user can have multiple clientId, this makes application server sending message easier.\n2, HTTP query user online status and active status(offline but not expired)\n3, HTTP interface support keep-alive, application server can keep long HTTP connection with emqttd, improve performance.\n. add more wiki about plugins.\n1, how to write a plugins, how to hook emqtt event\n2, how to integrate plugin with emqttd(the pre-bulid one from your website)\n. i need hook message before publish it to client session, not online status.\nA --> Topic --> (hook here) --> B \nthe hook should provide free agrs: topic, message, targetClientId(B)\n. the message publish  hook don't have targetClientID !!!\n```\non_message_publish(Message = #mqtt_message{topic = <<\"$SYS/\", _/binary>>}, _Env) ->\n    {ok, Message};\non_message_publish(Message, _Env) ->\n    io:format(\"publish ~s~n\", [emqttd_message:format(Message)]),\n    {ok, Message}.\n```\nneed receiver's clientID (targetClientID), not publisher's ID.\nfrom            :: binary() | atom(),     %% ClientId of the publisher\nthose two hook has target ClientId, why publish hook don't have???\non_message_delivered(ClientId, Message, _Env) ->\non_message_acked(ClientId, Message, _Env) ->\n. I think there should have four kinds of publish message hook:\n1, before publish to topic (fromID, topic, msg)\n2, after publish to topic (fromID, topic, msg)\n3, before publish to specific session (fromID, topic, msg, toID), msg not send to session yet\n4, after publish to specific session (fromID, topic, msg, toID), msg has sent to session, may on fly or in session queue>\ncurrently , I need the third hook \"3, before publish to specific session\"\nthen in this hook, I can parse the toID whether if send to APNS\n. If hook 3 is impossible, hook 4 is also OK. I just need a hook to get the \"toID\".\non_message_delivered and on_message_acked seems inappropriate, they have \"toID\", but they depend on network result, if client is offline the two hooks will not fire.\n. ???\n. So currently, emqttd not support hook 3 and 4 \uff1f\n. how to hook publish to clientID(session) ?\nfor APNS\uff0c need  a hook before(or after) push to client session. Then if the clientID is \"ios-xxxx\", just push it to APNS server by other skill nodejs or java.\nGCM can be the same\n. @emqplus so\uff0cit was implemented in 2.1.0-rc.1 or won't support ?. @emqplus can you explain the reason\uff1fwhy on_message_publish missed the two arguments ClientId, _Username. ets mqtt_subproperty works\n. ",
    "zhongwencool": "BTW: how many nodes do you deploy ? \nI saw the mnesia copy to all cluster nodes.....\n. ",
    "iveeshal": "yes seems like an issue with my erlang distribution..working fine with amazon linux..thanks\n. ",
    "goldalworming": "hi, do you write example using mysql auth plugin yet?\n. ok, I'll waiting for it. thanks a lot.\n. ok, I'll try it. \nthank you\n. I got these problem while compiling\nERROR: generate failed while processing /home/lmvm/mqtt/emqttd-plugins/rel: {'EXIT',{{badmatch,{error,\"goldrush: Application version clash. Multiple directories contain version \\\"0.1.6\\\".\"}},\n         [{rebar_reltool,generate,2,\n                         [{file,\"src/rebar_reltool.erl\"},{line,53}]},\n          {rebar_core,run_modules,4,[{file,\"src/rebar_core.erl\"},{line,490}]},\n          {rebar_core,execute,6,[{file,\"src/rebar_core.erl\"},{line,415}]},\n          {rebar_core,maybe_execute,8,\n                      [{file,\"src/rebar_core.erl\"},{line,299}]},\n          {rebar_core,process_dir1,7,[{file,\"src/rebar_core.erl\"},{line,258}]},\n          {rebar_core,process_commands,2,\n                      [{file,\"src/rebar_core.erl\"},{line,90}]},\n          {rebar,main,1,[{file,\"src/rebar.erl\"},{line,58}]},\n          {escript,run,2,[{file,\"escript.erl\"},{line,752}]}]}}\nmake: *** [rel] Error 1\nI don't understand how to debug it\n. ok, I've successfully add plugin to your binary download\nnow, unauthenticated user could be blocked but I still cannot connect using python paho set password or do you have another way to use this plugin?\nclient.username_pw_set(\"alice\", \"secret\");\nclient.connect(\"localhost\", 1884, 60)\nclient.loop_forever()\nnb: I've already add username password in mysql\n. it return nothing \n(emqttd@127.0.0.1)1> emysql:select('mqtt_user', {{username, 'alice'}, {password, 'secret'}} \n(emqttd@127.0.0.1)1> emysql:select('mqtt_user', {{username, 'alice'}, {password, 'secret'}}.\n- 2: syntax error before: '.'\n  (emqttd@127.0.0.1)1> emysql:select('mqtt_user', {{username, 'alice'}, {password, 'secret'}} \n  (emqttd@127.0.0.1)1> \n. (emqttd@127.0.0.1)1> emysql:select('mqtt_user', {{username, 'alice'}, {password, 'secret'}}).\n** exception error: undefined function emysql:select/2\nthis is happpen when I subscriber tried to connect\n* Reason for termination == \n* {'module could not be loaded',\n       [{emysql,select,\n            [mqtt_users,{{username,<<\"alice\">>},{password,<<\"secret\">>}}],\n            []},\n        {emqttd_auth_mysql,check,3,\n            [{file,\"src/emqttd_auth_mysql.erl\"},{line,49}]},\n        {emqttd_access_control,auth,3,\n            [{file,\"src/emqttd_access_control.erl\"},{line,75}]},\n        {emqttd_protocol,handle,2,\n            [{file,\"src/emqttd_protocol.erl\"},{line,127}]},\n        {emqttd_client,process_received_bytes,2,\n            [{file,\"src/emqttd_client.erl\"},{line,191}]},\n        {gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,593}]},\n        {gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,659}]},\n        {proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,237}]}]}\n. I'm not successfully build the plugin due to goldrush error\nadd mysql auth plugin to compiled (0.7.1) version just make any connection successfully connected with/without password\n. I always got this error\n==> emqttd (compile)\n==> rel (generate)\nERROR: generate failed while processing /home/lmvm/mqtt/emqttd/rel: {'EXIT',{{badmatch,{error,\"goldrush: Application version clash. Multiple directories contain version \\\"0.1.6\\\".\"}},\n         [{rebar_reltool,generate,2,\n                         [{file,\"src/rebar_reltool.erl\"},{line,53}]},\n          {rebar_core,run_modules,4,[{file,\"src/rebar_core.erl\"},{line,490}]},\n          {rebar_core,execute,6,[{file,\"src/rebar_core.erl\"},{line,415}]},\n          {rebar_core,maybe_execute,8,\n                      [{file,\"src/rebar_core.erl\"},{line,299}]},\n          {rebar_core,process_dir1,7,[{file,\"src/rebar_core.erl\"},{line,258}]},\n          {rebar_core,process_commands,2,\n                      [{file,\"src/rebar_core.erl\"},{line,90}]},\n          {rebar,main,1,[{file,\"src/rebar.erl\"},{line,58}]},\n          {escript,run,2,[{file,\"escript.erl\"},{line,752}]}]}}\nmake: *** [rel] Error 1\n. lmvm@lm17 ~/mqtt/emqttd $ find . -name goldrush\n./deps/goldrush\n. then what to do to remove goldrush error?\n. I have 3 python worker that subscribe one topic. how to make sure the message has been process ti job queue without duplicate?\n. ",
    "caferain0": "there is  the requirements  to  get the every client's status of connected and disconnected.\n1. with Mosquitto \n   the parameter log_dest (send log messages to a particular destination. Possible destinations are: stdout stderr syslog topic).\n   Set the log_dest to topic, then in my own code, subscribe to the topics like this:\n   new Topic(\"$SYS/broker/log/E\",QoS.AT_LEAST_ONCE),\n   new Topic(\"$SYS/broker/log/W\",QoS.AT_LEAST_ONCE),\n   new Topic(\"$SYS/broker/log/N\",QoS.AT_LEAST_ONCE),\n   new Topic(\"$SYS/broker/log/I\",QoS.AT_LEAST_ONCE),\n   Then analyze the messages of the topic to get the every client's status.(connected, disconnecting,timeout, Socket read error....)  with token id.\n2. with emqttd\n   the log destination is just stdout.  how to deal with the requirements mentioned above, thanks!\n. ",
    "phanimahesh": "@erylee The connected and disconnected messages being published to $SYS topics will solve the example @caferain0 was referring to, but the more generic use case of sending logs to a topic is not currently possible. A user might want to stream the logs to a log aggregation server for processing on a different machine, for instance.\nAt minimum, here are the changes that are required:\n- Instead of directly calling lager's methods, have a single function maybe emqttd:log to handle all logging.\n- Allow user to specify a topic as target for logs. In this case, any log messages are published to this topic.\nOr alternately, always publish logs to a topic, and by default have a client subscribe to this topic and send logs to lager. This might have some performance impact, though, not sure.\n. Yes, this looks good. Thanks for the quick response.\n. I am working in elixir but can read erlang. I have read emqttd_ws_client.erl and can patch it to extract the cookies. However, I am not entirely sure of how to pass this on to the auth plugins.\nShould the mqtt_client record be updated? What would be the cleanest way to do this?\n. @erylee I need some suggestions:\n- Should a new user defined function be allowed to extract username and password using any arbitrary roles? Or\n- Should new configuration values be added to allow mapping cookie keys to username and password?\nWhat about whitelisting allowed origins for websocket connections, either by using a CORS header or otherwise?\n. Do you mean mqtt_client?\nIf the cookie is available in the auth plugin hook in any way, it works for our project.\nIf you are planning on modifying any of the records,  it may be a better idea to pass on all headers as a map or proplist. If someone uses custom headers or let's say http basic auth,  this will cover all such scenarios.\nWe need this asap, and are planning to do it ourselves tomorrow. We can send a pull request for this tomorrow if it is okay with you.\n. Looks great!\nHowever, I think including a full list of headers is a good idea. What if someone later wants to authorize using bearer tokens or basic auth?\nI was thinking along the lines of\nerlang\nHeaders = mochiweb_request:get(headers,Req),\nHeader_list = mochiweb_headers:to_list(Headers),\nProtoState = emqttd_protocol:init(Peername, SendFun, [{ws_initial_headers, Header_list}|PktOpts]),\nin mqtt_ws_client.erl and corresponding changes elsewhere. What do you think?\n. @erylee: Can you have a look at https://github.com/emqtt/emqttd/pull/240 ?\n. Thanks! :)\n. @emqplus This is no longer possible with emqx3.0. Was it removed intentionally or accidentally? Will you accept a PR adding it back?. Vernemq handles plugins really well. May be we can look at how it does it? \n. Wow, the relx config looks so simple, compared to the mess of reltool.\nCan you also test the case when a plugin itself is dependent on other apps, let's consider hackney for instance? How can things be arranged so that hackney will be included in the release without having to edit emqttd's relx config?\nPutting a rebar.config in the plugin directory listing the deps should do everything, ideally. To my knowledge, there was no way to let reltool look at all plugins and include their dependencies automagically, which prompted me to file this issue. It may be possible with relx.\nI haven't found enough time to work on this myself, unfortunately. Thanks @joaohf for your efforts! Your work will save my time next week.\n. Hello @joaohf, Are there any blockers? If this is usable, I suggest we move this discussion to a pull request where it can be merged after some testing.\n. This is actually a very good idea. priv is the standard place to put anything you want bundled with the application, mostly assets and external dependencies. Configuration has traditionally been left out of priv ( I haven't seen it being done, yet ).\nBut I like this idea. Every plugin's config lives with it.\n. Isn't it unusual to store config in plugin app files? I haven't seen it being done anywhere else.\n. Also, it is standard practice to provide a config sample in the codebase, and a config file derived from it is placed at appropriate location during the deployments. So I don't think moving the plugin config from etc to either *.app or priv is a good idea.\nIf typical release strategies are considered, build and deploy phases are clearly separated. The configuration should be replaceable after the build, just before application is started.\nThe best strategy is to make every plugin provide a config.sample, and have a single consolidated config in emqttd/etc, or config files named after plugins in emqttd/etc. Having the config files all over the place only makes deployments difficult.\n. Yep. Or have everything in emqttd.config. Everyone has to customize this anyway, so why split the config?\nAlso, is it possible to reload config at runtime? There doesn't appear to be a way currently.\n. If erlang include path is set properly, it should be possible to just do -include(\"emqttd.hrl\"), right?\n. Disconnection might be a bit drastic, I'm looking at how other brokers handle this, will report once I find something.\nCan PUBACK packet be extended without violating the protocol?\n. Looks good. This should fix it. :)\n. Since there are no cases where we want the ws client to continue when one of its linked processes dies, it need not trap exits. If the ws client does not trap exits, it will not receive the 'EXIT' messages.\nLooks good to Merge. :+1: \n. No, using existing session is not the idea of this proposal. The proposal is to allow plugin developers to access session state, and to provide options to extend it.. I've completely forgotten about this one. With the move from mochiweb to cowboy the old patch won't work anyway.\nUsing the same pipeline would be nice for http publish api, but it's understandable if it isn't planned for at the moment.. After running emqttd for some time\n1. run bin/emqttd_ctl recon bin_leak and note the pids of the first few entries.\n2. In a shell, run sys:get_status(list_to_pid(\"<replace.with.pid>\")). to inspect the internal state of the processes. Specifically, note the parent and ancestors.\nI expect all or most of them to have a common ancestor, most likely a one_for_one supervisor. Identifying it will point to the source of leak.\n. @emqplus We have a separate node for ssl stripping, and emqttd gets plain traffic. Also we are running on OTP 17, so can't reproduce. Our memory usage is very stable.\n@brstgt ^G puts you into job control mode. h or ? should show you the job control help. You are not able to connect to the remote shell because of bad flag. The cookie must be passed as -setcookie emqttdsecretcookie instead of -cookie ...\n. Copying from our discussion on skype. to maintain a record here.\nWe use a dedicated HAProxy to do ssl stripping for both mqtt and websocket connections on emqttd.\n. Note the number of processes at each step.\n- Start a clean emqttd.\n- Connect exactly one or two clients.\n- Send some messages.\n- Disconnect.\n- Reconnect\n- Disconnect\n- Wait for session to expire\nThe difference between first and last readings should be zero. It will help if you set the session expiry to a very small time. Repeat with clean_session false and true and using mqtt and websockets. Atleast one of them should show the leak, and that will tell us where to look for it in the code.\n. Clean_session true only means clean any existing session and create a new one for this client id. After the client disconnect the session process still stays alive, and will die only after session expiry or when the same clientid connects with clean session true.\nIf there is no observable process leak due to client connections and disconnections, check your plugins. Also make sure it's not because of session expiry being set to a large value.\n. I've just re-read the protocol, and you are right. The session must be cleaned on disconnection if clean_session is true.\nChecked the diff and config, no issues there. Atleast none were obvious to me. The issue should be reproducible on a clean emqttd without plugins then.\nThe number of processes is not supposed to grow constantly. It will stabilise when connections stabilises, and variations should be explainable by timeouts. There's definitely some bug.\nDo you have any stats on how fast the processes increase with time?\n. If you are going to collect stats, please record number of connected clients, and disconnected clients so far bucketed by reasons (as shown by emqttd_ctl listeners), along with number of processes. I'm trying to gauge the severity. Also hoping that the numbers may hint at something. A correlation between one particular kind of disconnections and extra processes, for example.\nThanks for being patient.\n. disconnection stats are important, without them we won't be able to see if a particular disconnection is the cause, by not cleaning up processes properly.\nI'm on vacation, I can add the listener disconnect stats to the api next week. Till then, see if you notice any patterns on processes vs clients.\n. Hello @brstgt , I've been a bit busy lately, and haven't been able to meet my estimates for the past couple of weeks. I'm back from vacation but am moving to a new home, so my replies may be slightly delayed. Let's continue the conversation on skype, and we can post a summary here for any readers.\n. Looks good to me. One minor nitpick, macro LOG in emqttd_ws should also be called WSLOG to be consistent with emqttd_ws_client.\n. See rel/files/emqttd.config.*, specifically section listeners.\n. Doesn't look like it. It is targeted at 2.2 currently. You can help by testing out the proxy-protocol branch.. Clone emq-relx, and edit the Makefile. dep_emqttd's last component is the branch/tag name. Change it to proxy-protocol, save it, and make. You will need to install erlang for compilation. You can either grab it from erlang.org, or if you don't want to install systemwide, use asdf version manager to install erlang in your $HOME. If everything goes right you should see a release in _rel/emqttd. Copy that folder out somewhere, on the machine you want to run emqttd, and use bin/emqttd start as usual.. Quick fix, don't include emq_recon in release.  Edit relx.config and nuke emq_recon from there. It is non-essential and only to assist in debugging if any issues occour. Installing observer would be distribution specific.\nAlternately, use asdf-vm/asdf and its erlang plugin to install a local version of erlang, and use it to build emq. Then copy _rel/emqttd to wherever it is needed and run it from there.. @noordawod sorry,{observer, load} should be nuked from relx.config. I mixed things up. observer and recon both depend on runtime tools but recon does not directly depend on observer.\n@emqplus I'm facing this and other inconveniences with current build and release process, testing out a full rebar3 based solution, with a makefile so that same steps as previous can be used by users. Will keep you posted.. You now have an erlang with observer installed. So the build succeeds. It was previously complaining about missing observer.\n\n===> Failed to solve release:\nDependency observer is specified as a dependency but is not reachable by the system.\n. Quick hack: trace a client id using bin/emqttd_ctl trace client <id> <filename>, connect with that client id, check logs.\nOr alternately, edit configuration and turn the loglevel up to debug. Be warned that there will be tons of logs if you do this.. In that case you need two listeners. Pick two ports, configure one to expect proxy protocol and other for direct connections.. No, On branch emq22 there's support for multiple listeners. The feature is just 4 days old, though. Make sure you are running a version with this support enabled.\n\nSample config would be:\nlistener.tcp.internal = 0.0.0.0:1883\nlistener.tcp.proxy = 0.0.0.0:2883\nlistener.tcp.proxy.proxy_protocol = on\n...\nThen send internal traffic to :1883, and HA traffic to :2883.\nEssentially, the third component in the config (<name> in listener.<proto>.<name>) can be arbitrary. Each such valid entry will start one listener on the port specified, binding to that ip address. Parameters for this listener can be configured similar to what is shown in this commit. Yes. The value after bridge can be anything, all these settings together define a bridge named edge. The default configuration has commented bridges with names aws, azure etc. Use one of those as a template.. @vivek1729 Did you try returning ignore from the acl/auth plugin? EMQ then tries the next one.\nAlso, I didn't know you were working on mqtt stuff. Cool! Ping to catch up.. Can you confirm that your cert.pem is the full chain, and not just the leaf cert? Looks like it, but it wasn't clear from your description. I'll try to repro later and debug this.. Thanks. I'll try to repro and debug. Will respond by monday.\nIf it turns out to be an issue, it'll be in either esockd or deeper in\ndependency chain I guess.\nOne more question: is this a LE cert? Is the root cert trusted by your\nopenssl? In other words, are the intermediates not being served or is the\nroot not trusted? Both cases probably have similar (same?) user facing\nerrors.\nOn Sat 4 Mar, 2017 18:50 je-al, notifications@github.com wrote:\n\n@phanimahesh https://github.com/phanimahesh well, yeah, I tried both\nHAProxy's and Nginx's \"format\", i.e.:\nserver first\nCA\nintermediate 1\nintermediate 2\nCA\nintermediate 1\nintermediate 2\nserver first\nAnd, for good measure, even:\nserver\nintermediate 2\nintermediate 1\nCA\nLater it occurred to me that maybe I should try a p12 store, but I see no\nreference to them, and #933 https://github.com/emqtt/emqttd/issues/933\nis also open.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/890#issuecomment-284151096, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ABnL8Fn1t0r6Te6RudNjUlCaZyivpoF7ks5riWUegaJpZM4L7RON\n.\n. I'm not on a windows machine to check, can you paste the header from emqttd console?  It should show erlang/otp version, among other things. It should be > 19.0, since maps:take was introduced then. Lower versions will cause the crash you reported.. You mentioned binaries, did you mean you downloaded precompiled version from github, and haven't built it yourself?\n\nIf the windows package is built with 18, it should get a rebuild. /cc @emqplus . @emqplus Converted the issue into a PR. Please see attached commit.. Can you please trace the client/user and paste the trace logs?\nUse emqttd_ctl trace client <clientid> <file> to start tracing, and connect to emqttd using client id <clientid>. When done, stop tracing with emqttd_ctl trace client <clientid> off, and attach the generated <file>.. @emqplus A simple solution to ensure universal support would be to publish topics to $queue/topic instead of topic by rewriting the messages. Are there any potential downsides to doing this? It can possibly turned into a configurable option.\n@mv200580 I'm not sure where the bug is, can't comment without doing some research. Shared subscriptions are not part of the spec, so implementations differ. Essentially java clients are rejecting any messages from topics they aren't subscribed to, even if they receive them. They asked for messages from $queue/topic but when they get messages from topic, they don't like it and silently ignore them.\nI wonder how they handle messages from $client/clientid? EMQ subscribes every client to that by default, client doesn't have to request it. Do these clients drop messages sent on this topic?. The client subscribes to $queue/topic but receives messages from topic. Not\nsure what'll happen if you subscribe to both.\nOn Thu 6 Apr, 2017 17:09 mv200580, notifications@github.com wrote:\n\nJust want to find out now - is it possible for paho java client to switch\noff the topic name validation.. this can be the solution, I guess\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/921#issuecomment-292147538, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ABnL8ERpyZ76-wq0XoSIqk8XU5jpdH66ks5rtM7lgaJpZM4MLMJV\n.\n. Wx is missing. Does your erlang installation support wx widgets?\n\nAre you running a prebuilt release or have you compiled it yourself?\nOn Mon 27 Feb, 2017 15:51 SumitFlochat, notifications@github.com wrote:\n\nEnvironment\n\nOS:\nErlang/OTP:\nEMQ:\n\nDescription\nA description of the issue\nobserver:start() throws\n** exception error: undefined function wx_object:start/3\nin function observer_wx:start/0 (observer_wx.erl, line 72)\nNeed help with this?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/926, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ABnL8PwabOWrBFLML7SHVVKXGZ7ygvemks5rgqO0gaJpZM4MM7RJ\n.\n. As far as I know, no. Not currently.\n\nThe \"if statement\" as you call it would then move into emqttd. It will however remain. You can get rid of if in favor of pattern matching, (if clientid is of a known and fixed length).\nIt is however an interesting proposal. Matching on topics or topic patterns is common, and hooking only into a few topics also feels like a common use case. Avoiding duplicated code and logic would be good IMO.\nWhat are your thoughts, @emqplus? If you think it would add value, I can take this up for inclusion directly in emqttd or as a plugin wrapper providing a more convenient api with topic (or topic pattern) specific hooks. What happens when you try emqttd console instead? Can you paste the full output?. When the broker is restarted a lot of state is lost. If your interpretation of spec is correct (I'll have to check that, not sure), then subscriptions should be stored in mnesia and loaded on start.\nMy understanding of clean_sess = false is as follows: If there is a session existing on the server for this client id, attach to that instead of cleaning it and creating a new session. A clean_sess=false should not be considered a guarantee that the server will hold session state. It is the choice of the server(broker) whether the session will stick around when client is not connected, for how long, and whether it persists after reboot.\nOut of curiosity, are there any other MQTT brokers that persist sessions across broker restarts?. emqttd stores its state in mnesia and uses ram_copies for all tables except schema, which means the state is lost on reboot. A quick fix is to use mnesia for everything and use disc_copies. But it will have a performance impact.\nAnother option is to store messages only for disconnected clients on disc, either in mnesia or some other fast datastore. vernemq seems to be using leveldb for a similar purpose.\n@emqplus Thoughts?. Duplicate of #730.\nSee this comment: https://github.com/emqtt/emqttd/issues/730#issuecomment-263114042. It looks like a few processes crashed, not the broker. Process crashes are considered normal in erlang, since we rely on built in recovery and self healing mechanisms and let processes crash when they do not behave well.\nCan you confirm the maximum packet size you are sending? Is the error reproducible under some conditions reliably? If yes, can you describe how to reproduce this?\nThe first crash looks like the connection was unable to report its stats for some reason. src/emqttd_client.erl:250 probably returns error which then causes a badmatch in emqttd_keepalive:start/3. This may be because the socket closed or connection died unexpectedly, or might be a bug/unhandled case with some connection handling code.\nRegarding the second crash log, is /proc mounted and accessible by your emqttd? Looks like cpu_sup wasn't able to determine the load average for some reason. This crash can be ignored safely. It won't affect the broker's performance or behaviour, only some stats in the dashboard may not be populated.. That seems like a bigger issue then. Is the crash log you posted the full one? Anything else you can find in syslogs, maybe? Is emqttd being killed by OS due to resource scarcity?\nFor anyone else looking at this, looks like {error, einval} is from Conn:getopt([recv_oct]). Digging into esockd and down shows the ultimate calls are to either inet:getopt/2 or ssl:getopt/2, and the error is due to an invalid argument. Since the options [recv_oct] is valid, it means the connection socket is bad. Stale socket, maybe?\n@frank-montyne Can you help reproduce this issue? I'm running 2.0.7 since a couple of weeks and haven't seen this issue.\n. Does the server restart at 1? Anything in cron? Anything that may trigger\nan oom at 1?\n. These are of interest to us:\n/usr/lib/emqttd/log/crash.log.3\n/usr/lib/emqttd/log/crash.log\n/usr/lib/emqttd/log/crash.log.0\n/usr/lib/emqttd/log/crash.log.1\n/usr/lib/emqttd/log/crash.log.4\n/usr/lib/emqttd/log/crash.log.2\nAny chance you can share some of them after anonymising any sensitive info?\nOn Mon 6 Mar, 2017 19:40 Frank Montyne, notifications@github.com wrote:\n\nI looked again for a crash.dump file on the whole disk but I didn't find\nany.\nsudo find / -name crash only list the following:\n/usr/share/doc/apport/crashdb-conf.txt.gz\n/usr/share/apport/kernel_crashdump\n/usr/share/apport/testsuite/test_signal_crashes.pyc\n/usr/share/apport/testsuite/test_signal_crashes.py\n/usr/share/apport/testsuite/test_java_crashes.py\n/usr/share/apport/testsuite/test_java_crashes.pyc\n/usr/share/apport/testsuite/crash.class\n/usr/share/apport/testsuite/crash.jar\n/usr/share/apport/testsuite/test_crash_digger.pyc\n/usr/share/apport/testsuite/test_crashdb.py\n/usr/share/apport/testsuite/test_crash_digger.py\n/usr/share/apport/testsuite/test_python_crashes.py\n/usr/share/apport/testsuite/test_python_crashes.pyc\n/usr/share/apport/testsuite/test_crashdb.pyc\n/usr/lib/python3/dist-packages/apport/crashdb_impl\n/usr/lib/python3/dist-packages/apport/pycache/crashdb.cpython-34.pyc\n/usr/lib/python3/dist-packages/apport/crashdb.py\n/usr/lib/python2.7/dist-packages/twisted/test/crash_test_dummy.py\n/usr/lib/python2.7/dist-packages/twisted/test/crash_test_dummy.pyc\n/usr/lib/emqttd/lib/observer-2.1.2/ebin/crashdump_viewer.beam\n/usr/lib/emqttd/lib/observer-2.1.2/priv/crashdump_viewer.tool\n/usr/lib/emqttd/lib/observer-2.1.2/priv/crashdump_viewer\n/usr/lib/emqttd/lib/lager-3.2.2/ebin/lager_crash_log.beam\n/usr/lib/emqttd/log/crash.log.3\n/usr/lib/emqttd/log/crash.log\n/usr/lib/emqttd/log/crash.log.0\n/usr/lib/emqttd/log/crash.log.1\n/usr/lib/emqttd/log/crash.log.4\n/usr/lib/emqttd/log/crash.log.2\n/usr/src/linux-headers-3.16.0-31/include/linux/crash_dump.h\n/usr/src/linux-headers-3.16.0-31-generic/include/config/crash\n/var/crash\n/sys/devices/system/cpu/cpu0/crash_notes\n/sys/devices/system/cpu/cpu0/crash_notes_size\n/sys/kernel/kexec_crash_size\n/sys/kernel/kexec_crash_loaded\n/etc/apport/crashdb.conf\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/935#issuecomment-284405880, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ABnL8O7Sw-Z7T1fvPtjmVO4cV7sPJQReks5rjBPvgaJpZM4MTV3K\n.\n. Ignore that, the ones you shared previously are good enough if that or\nsimilar entries are all they have.\n\nOn Mon 6 Mar, 2017 21:03 Phani Mahesh, phanimahesh@gmail.com wrote:\n\nThese are of interest to us:\n/usr/lib/emqttd/log/crash.log.3\n/usr/lib/emqttd/log/crash.log\n/usr/lib/emqttd/log/crash.log.0\n/usr/lib/emqttd/log/crash.log.1\n/usr/lib/emqttd/log/crash.log.4\n/usr/lib/emqttd/log/crash.log.2\nAny chance you can share some of them after anonymising any sensitive info?\nOn Mon 6 Mar, 2017 19:40 Frank Montyne, notifications@github.com wrote:\nI looked again for a crash.dump file on the whole disk but I didn't find\nany.\nsudo find / -name crash only list the following:\n/usr/share/doc/apport/crashdb-conf.txt.gz\n/usr/share/apport/kernel_crashdump\n/usr/share/apport/testsuite/test_signal_crashes.pyc\n/usr/share/apport/testsuite/test_signal_crashes.py\n/usr/share/apport/testsuite/test_java_crashes.py\n/usr/share/apport/testsuite/test_java_crashes.pyc\n/usr/share/apport/testsuite/crash.class\n/usr/share/apport/testsuite/crash.jar\n/usr/share/apport/testsuite/test_crash_digger.pyc\n/usr/share/apport/testsuite/test_crashdb.py\n/usr/share/apport/testsuite/test_crash_digger.py\n/usr/share/apport/testsuite/test_python_crashes.py\n/usr/share/apport/testsuite/test_python_crashes.pyc\n/usr/share/apport/testsuite/test_crashdb.pyc\n/usr/lib/python3/dist-packages/apport/crashdb_impl\n/usr/lib/python3/dist-packages/apport/pycache/crashdb.cpython-34.pyc\n/usr/lib/python3/dist-packages/apport/crashdb.py\n/usr/lib/python2.7/dist-packages/twisted/test/crash_test_dummy.py\n/usr/lib/python2.7/dist-packages/twisted/test/crash_test_dummy.pyc\n/usr/lib/emqttd/lib/observer-2.1.2/ebin/crashdump_viewer.beam\n/usr/lib/emqttd/lib/observer-2.1.2/priv/crashdump_viewer.tool\n/usr/lib/emqttd/lib/observer-2.1.2/priv/crashdump_viewer\n/usr/lib/emqttd/lib/lager-3.2.2/ebin/lager_crash_log.beam\n/usr/lib/emqttd/log/crash.log.3\n/usr/lib/emqttd/log/crash.log\n/usr/lib/emqttd/log/crash.log.0\n/usr/lib/emqttd/log/crash.log.1\n/usr/lib/emqttd/log/crash.log.4\n/usr/lib/emqttd/log/crash.log.2\n/usr/src/linux-headers-3.16.0-31/include/linux/crash_dump.h\n/usr/src/linux-headers-3.16.0-31-generic/include/config/crash\n/var/crash\n/sys/devices/system/cpu/cpu0/crash_notes\n/sys/devices/system/cpu/cpu0/crash_notes_size\n/sys/kernel/kexec_crash_size\n/sys/kernel/kexec_crash_loaded\n/etc/apport/crashdb.conf\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/935#issuecomment-284405880, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ABnL8O7Sw-Z7T1fvPtjmVO4cV7sPJQReks5rjBPvgaJpZM4MTV3K\n.\n. I'm considering the options on how this can be reproduced. Are you comfortable with erlang? It is possible to inspect the emqttd instance when it reaches this state, and that can be helpful. Specifically, we need to look at erlang process count and if there is a process leak, possibility of a binary leak, and average message queue length of processes and how it varies.\n\nDo you have or can you arrange for trends of cpu, ram and network usage for one night when this happens? The graphs may hold a clue.\nMy current blind bet: EMQ dispatcher is going wonky, or client/session processes are getting locked up on something.. To crash emqttd using just number of messages shouldn't be possible\ntechnically. (tm). You can happily increase the load a hundred fold or more\nand it should be absorbed. Things may slow down if your hardware is on the\nlow end, but that should be it.\nIf this can be replicated in a VM, that would be great. I'll take out some\ntime to help debug this if I can get my hands on emqttd when it misbehaves.\nOn Thu 9 Mar, 2017 03:20 Frank Montyne, notifications@github.com wrote:\n\nHi,\nI'm not really comfortable with Erlang. Yesterday I wrote a load tester in\njava to try and crash the EMQ broker. I let it run simulating 100 clients\neach sending 1000 messages/minute and could not make the broker crash.\nTomorrow (almost midnight in Belgium) we are going to do a test with with\nour hardware device and see if that triggers the crash. If that works I can\nsetup a VM with EMQ on Azure and give you access to it to replicate the\ntest again. What do you think?\nUp until now we were using mosquitto and we never had any real problems. We\nprocessed about 100.000.000 messages in the last year coming from our\nhardware.\nIf you want to know more about what we do you can have a look on our\nwebsite (www.bynubian.com)\nBest regards,\nFrank Montyne\nOn Wed, Mar 8, 2017 at 8:55 PM, J Phani Mahesh notifications@github.com\nwrote:\n\nI'm considering the options on how this can be reproduced. Are you\ncomfortable with erlang? It is possible to inspect the emqttd instance\nwhen\nit reaches this state, and that can be helpful. Specifically, we need to\nlook at erlang process count and if there is a process leak, possibility\nof\na binary leak, and average message queue length of processes and how it\nvaries.\nDo you have or can you arrange for trends of cpu, ram and network usage\nfor one night when this happens? The graphs may hold a clue.\nMy current blind bet: EMQ dispatcher is going wonky, or client/session\nprocesses are getting locked up on something.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/935#issuecomment-285150243, or\nmute\nthe thread\n<\nhttps://github.com/notifications/unsubscribe-auth/AJKoL_r0o5D8uJaQZRWAyQCLXZ4dFuc5ks5rjwebgaJpZM4MTV3K\n.\n\n\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/935#issuecomment-285180683, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ABnL8CHpaxyi1EDmc5UP_aCjoYxb91D2ks5rjyKKgaJpZM4MTV3K\n.\n. @frank-montyne At any point of time, if two clients connect with the same client id, the older one gets kicked out. If both of them attempt reconnections immediately, you get the behaviour you describe.\n\nClient id conflicts are disallowed in MQTT specification. I'm sure mosquitto prevents duplicate client ids, most likely following the same behaviour. (An alternate option is to reject the new client)\nHow are your client ids being generated? Are you letting any framework/library autogenerate them, or are you assigning them using your own scheme? If you rolled your own scheme, what is it? Looking at the logs, you should also see ip and username assosciated with the clients. Or you can trace using emqttd_ctl trace client <client_id> <filename> to see detailed tracess for a particular client id.\nIdentify the bad client and have its client id changed to fix this issue.. In that case both mosquitto and EMQ kick the older client if it exists and use the newly connected client for the session. I verified MQTT specifications and this is MUST. All brokers will disconnect existing client and allow newly connected one to take over the session.\nWhen paho notifies that the connection is broken, do you ensure that it is teared down completely before reinitiating connection? If Paho is connecting again automatically, when you create a new connection it can cause the conflict. Is this Paho js or Paho Java? Any example code that you can provide to reproduce the issue?. @lvlf Did you check max connections in emq config? It has a conservative limit of 1024 by default.. @emqplus This should also have included an update to rebar.lock. Running rebar3 upgrade should do the trick.. Yep, sounds good IMO. One catch is that if any authentication plugins handle missing client id as a special case, this will be a breaking change.. From security perspective, is it an issue if already established connections remain so? What would be possible for an attacker if it is not done? I'm trying to understand this better.\nWhat do you mean by caching here? As far as I know, a connection uses certificates only in the initial handshake. Later a session key is generated which is used for securing all further communication. Any client which is reconnecting will use the new certificates.\nAre you proposing that a renegotiation/rekeying should happen in the existing connection? I vaguely recollect reading about ssl renegotiations, but not sure. Or do you propose that the connection should be terminated, new certificate will be used when reconnecting?. Also I should have checked, accidentally pushed the branch to this repo instead of my fork. Hope you don'tmind.\nI also noticed that the travis builds are allfailing since pbkdf2 was added. Why is that?. FYI, I just did a rebar3 upgrade in the repo. This will make sure that rebar.lock matches what will be fetched by following dependencies listed in rebar.config. rebar.config itself is updated by erlang.mk.. The built in acl system is intended for simple use cases. It is not intended for serious production use. Don't get me wrong, it works, and has no known bugs, but it does not offer enough flexibility.\nIf the broker is expected to run for extended periods, with large number of clients, and a more sophisticated control is needed, please consider using one of the auth/acl plugins. http plugin allows you to specify a url, which will be queried and whose response will determine ACL allow/deny. various databases are supported through their respective plugins.. I believe it should be deleted. There's no use keeping it around in mnesia\nanymore after receiving a DISCONNECT packet.\n\n. How are you setting config inside docker? ADD/COPY ed the config file?\n\nWhat does emqttd_ctl listeners show inside docker?\nOn Wed 5 Apr, 2017 20:40 David Hill, notifications@github.com wrote:\n\nI think for some reason, EMQ is falling back to serving insecurely, perhaps\nAccording to the erlang ssl docs http://erlang.org/doc/man/ssl.html\nit falls back to insecure renegotiation if the peer does not support RFC\n5746\n?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/977#issuecomment-291892688, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ABnL8E5C4VyiiOVi8QnujAlh4Muo-6Wjks5rs67fgaJpZM4My-_H\n.\n. You can debug erlang applications by tracing their execution live. Please checkout module dbg from otp or the library recon.. To run such a load test you'll need a server with more RAM, or more subscribers running in shared mode to drain the in memory message queue faster.\nSlogan: eheap_alloc: Cannot allocate 1898305688 bytes of memory (of type \"old_heap\").\n\nErlang VM was trying to allocate approx 1.76GB of additional RAM, inspired by your rapid usage.. sessions are bound to client id, not user id. You need to set a static\nclient id or else libraries usually assign one randomly.\nOn Tue, Apr 25, 2017 at 7:22 PM mkj-git notifications@github.com wrote:\n\nThis is paho JS client:\nthis.getMqttClient = function() {\n      console.log(\"getMqttClient called\");\n      if(mqttClient !== undefined && mqttClient.isConnected()) {\n          return mqttClient;\n      } else {\n          var constants = $injector.get('Constants'), userDetails = this.getCurrentUserDetails();\n          mqttClient = new Paho.MQTT.Client(\n              constants.MQTT_HOST,\n              Number(constants.MQTT_PORT),\n              '/mqtt',\n              _ref.escapedUserId(userDetails.id)\n          );\n          return mqttClient;\n      }\n  }\nmqttClient.connect({\n  userName: Utils.escapedUserId(userDetails.id),\n  password: userDetails.mqttPwd,\n  onSuccess: onConnect,\n  onFailure: onFailure,\n  cleanSession: false\n});\n\nHere I have set cleanSession: false even then everytime when i install and\nreconnect with same userName but different password, it is not subscribing\nto any of the previous topics. WHY?\nDoes the password change make any difference for session?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/1017, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ABnL8PHG-sygfnMOSkRe8PuPey2oPMFGks5rzh2wgaJpZM4NHuoe\n.\n. Oh, okay. I am not familiar with Paho API, so it wasn't obvious for me.\nPassword change shouldn't be an issue.\n\ncan you trace the clientid and confirm whether the issue is with messages\nnot being sent or not being received by paho? I've seen reports of Paho\nignoring messages from channels it didn't explicitly subscribe to. The\nclient that reconnected might be dropping messages in that case. My first\nthoughts.\nOn Tue, Apr 25, 2017 at 7:30 PM mkj-git notifications@github.com wrote:\n\n  mqttClient = new Paho.MQTT.Client(\n      constants.MQTT_HOST,\n      Number(constants.MQTT_PORT),\n      '/mqtt',\n      _ref.escapedUserId(userDetails.id)\n  );\n\n_ref.escapedUserId(userDetails.id) is client id and it is same\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/1017#issuecomment-297087398, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ABnL8C33l9yIJzpoFesVWTB5eFSvjTlMks5rzh-zgaJpZM4NHuoe\n.\n. The log files do not contain anything relevant to this issue. When you say you can not connect using TLS, what do you mean? Do you get a connection refused? Certificate error? Connection reset? Something else?\n\nWhat diagnostic steps have you undertaken?\nHere are a few checks you can run:\n1. Can you confirm that the broker is listening on port 18084? ss -tln should show it. emqx logs you provided indicate that the listener started.\n2. Can you connect to the port using netcat or other similar tool? nc -v <ip> 18084 should show Connection to <ip> 18084 port [tcp/https] succeeded! or something similar.\n3. Can openssl understand the certificate chain and verify it? Run openssl s_client -connect <ip>:18084 -servername prod-gwy0.abcxyz.abc and look at the last few lines. It should show Verify return code: 0 (ok).\nIf all of these are successful and the issue still exists, then it might be a bug in emqx. If one of these steps fail, the mode of failure indicates what is wrong.\nAlternately, you can always plop a haproxy in front of emqx. Offloading SSL termination is always a good idea, and in fact the recommended mode of using SSL with emqx. I do not understand how this can completely block your work.\nAs such, the issue does not contain sufficient information to reproduce your situation, and without experiencing it, it can not be debugged. What is the minimum configuration change from defaults with which this issue can be reproduced?. > 4584957548:error:140040E5:SSL routines:CONNECT_CR_SRVR_HELLO:ssl handshake failure:/BuildRoot/Library/Caches/com.apple.xbs/Sources/libressl/libressl-22.240.1/libressl-2.6/ssl/ssl_pkt.c:585:\n\nSSL handshake has read 0 bytes and written 0 bytes\n\nThe certificate is not being sent. For some wierd implementation reason openssl returns code 0, but the ssl handshake did not happen.\nCan you confirm that the file location is correct, and verify its permissions, so that it can be read by emqx? Set log level to debug and start the broker, and see if there is any useful information there.. That log file stops midway, before even the startup is complete. Please repeat it and include the full log. The log file may be rotated, check all files in the log directory to see if any .1, .2 etc files are created.. These are truncated too. Is there a emqx.log.2.txt?. That is unusual. Can you try clearing the logs folder and restarting emqx?. Uncomment dashboard.listener.https.ciphers and try again.\nAlso post the output of openssl s_client -connect <ip> 18084. Wrap the output in three backtics for a code block: ```. I am out of ideas. The one obscure issue I found with cipher mismatch is solved by uncommenting the ciphers.\nPlease check your certificates again. If they're absolutely fine (let' say if the same certs work with nginx/apache/haproxy/whatever), then I have no idea what might be wrong.\nI have tried replicating the issue in multiple environments, but I can access the dashboard over https. At this point I think the issue can't be resolved without an experienced sysadm looking at your setup.. Should I cherry pick my commit onto emqx:testing?\nAfter target was changed lots of spurious commits got added into this PR.. Done.. What do you mean by client side SSL/TLS authentication without a certificate? Authenticating TLS itself bidirectionally requires certificates.\nIf you simply want authenticated connections over TLS, just connect to the broker over port 8883 after setting up an ssl certificate on emqx.. The protocol is up to you. You can use MQTT over TLS on 8883 or Websockets over TLS on 8084. The recommended method is to use a separate ssl terminator - like haproxy.\nI believe you are mixing up unrelated things. Authenticating SSL clients with a certificate is a feature of SSL, and can be implemented for any protocol. There is nothing specific to emqx or even MQTT about it.\nUsing a protocol over SSL/TLS does not require a client certificate. Just like you don't need a certificate f your own to access https://github.com. The authentication, if any is then handled by the higher level protocol, like HTTP.\nIn case of MQTT over TLS, or MQTT over WebSockets over TLS, the authentication is handled by the MQTT layer using the MQTT username, password and clientid fields.. @jmpmscorp Bridging brokers carries the risk of looping messages infinitely. To avoid this, topics have to be chosen properly along with forwards and mountpoints.\nHere is how your configuration is interpreted:\nYour forwards is set to test1. This will mean messages published exactly on the topic test on emqx will be forwarded to 192.168.1.50:1883. If you want multiple topics to be forwarded, separate them with a comma (,). Wildcards + and # are supported here with usual interpretation.\nMessages published to the tree test/# on the remote broker will be available from emqx as the tree test/test/#.\nIf the behaviour you observe is different from this, let please file a new issue describing it.. Mount point is added by local node to the topics from central node.\nIf central node topic is t, the local node will see it as mountpoint/t.\nThe topic is always added in one direction only.. Please allow some time for the team to triage the issue. It is rude to demand attention within 2 hours of posting.\nCan you verify if _rel/emqttd/lib  has your plugin directory, with an ebin under it containing your beam and app files?\nIt is not directly related, but is there a reason you are using v2 instead of v3? Can you upgrade to emqx v3?  . Please check if some other program is using the needed ports, and/or change the ports emqx listens on in the config.. The change is applied to the running broker. Configuration files are not updated.\nEmqx does not modify any of its config files currently. It uses them to generate erlang/otp compatible config files when starting up, that's all.. How are you running the broker?. @callbay I believe your changes to emqx.schema are still valid. I wonder how that original code was written, it looks buggy. You can probably re-open the PR, and amend the commit to only include emqx.schema.. Yes, the backend plugins are not open source, and are bundled with EMQX enterprise edition.. No, no additional configuration should be necessary. can you manually try connecting to the client? What are your enabled plugins, and auth modules? \nDid you reload the acl?. Looks like the mosquitto bridge is trying to subscribe or publish to more topics then. You can try tracing its clientid with debug logging on emqx to see what exactly it is trying to do and why. It might be a bug in mosquitto to try connecting to more topics than configured.\nThat still shouldn't produce a connack error though, connection should succeed. ACL_NOMATCH has no bearing on connection success, only on access control. It's something worth investigating, in any case.. Unrelated failure. dep vsn check failed. Why did that fail?. This introduces breaking changes in configuration though. Can we also allow mqttv4 etc and translate internally by stripping off the leading mqtt? Without that existing configurations will need to be updated.. Why are you adding <<$/, Qos_/binary>> here? The docs in schema do not talk about the QoS. Also, using the separator / wouldn't be a good idea, the config gets difficult to understand that way.\nWhat is the goal of separating the queues by QoS? How will this be exposed in the config nicely?. It is not clear that those are the QoS. It looks like the example is talking about two topics, topic/1 and topic/2.. Maybe we should ask @emqplus for his opinion here?. ",
    "w3yyb": "0.6.1 \n. I tuned.\n. will later\n. \u786e\u5207\u8bf4\u662f\u4e00\u5237\u65b0\u5c31\u9000\u51fa \uff0c\u6bcf\u6b21\u90fd\u662f \u30022\u53f0\u673a\u5668 \u90fd\u4e00\u6837   \u7528\u7684php\u5ba2\u6237\u7aef\n. \u627e\u5230\u95ee\u9898\u4e86\uff0c\u53ea\u8981\u8bbe\u7f6e cleansession=0 \u5c31\u9000\u51fa \n\u800cClean Session =1 \u4e0d\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\n. \u8981\u5237\u65b0\u624d \u9000\u51fa\u7684\uff0c\uff0c\u7b2c\u4e00\u6b21\u8fde\u63a5\u4e0d\u4f1a\u9000\u51fa \n. if I set -name emqttd@host1  can't start the emqttd\nprint:\nemqttd failed to start within 15 seconds,\nsee the output of 'emqttd console' for more information.\nIf you want to wait longer, set the environment variable\nWAIT_FOR_ERLANG to the number of seconds to wait.\nshould I bind a domain name?\n. thanks\n. \u6211\u8bd5\u4e86\uff0c\u4ecd\u7136\u4e0d\u80fd\u6210\u529f\u3002\n. yes ,can't start     -name emqttd@192.168.6.156  or -name emqttd@host1\nbut  -name emqttd2@127.0.0.1 can start ,but  failed to connect to 'emqttd1@127.0.0.1'\n. [root@cndkbtamqpusha02 emqttd]# ./bin/emqttd console\nExec: /opt/emqttd/erts-6.3/bin/erlexec -boot /opt/emqttd/releases/0.6.0/emqttd             -embedded -config /opt/emqttd/etc/app.config             -pa ./lib/basho-patches             -args_file /opt/emqttd/etc/vm.args -- console\nRoot: /opt/emqttd\nErlang/OTP 17 [erts-6.3] [source] [64-bit] [smp:4:4] [async-threads:64] [hipe] [kernel-poll:true]\nstarting emqttd on node 'emqttd@192.168.6.157'\nemqttd config is starting...[done]\nemqttd event is starting...[done]\nemqttd pooler is starting...[done]\nemqttd client manager is starting...[done]\nemqttd session manager is starting...[done]\nemqttd session supervisor is starting...[done]\nemqttd pubsub is starting...[done]\nemqttd broker is starting...[done]\nemqttd metrics is starting...[done]\nemqttd bridge supervisor is starting...[done]\nemqttd access control is starting...[done]\nemqttd system monitor is starting...[done]\n16:10:46.349 [info] mqtt listen on 0.0.0.0:1885 with 64 acceptors.\n16:10:46.350 [info] mqtts listen on 0.0.0.0:8883 with 4 acceptors.\n16:10:46.357 [info] http listen on 0.0.0.0:8083 with 4 acceptors.\nErlang MQTT Broker 0.6.1 is running now\nEshell V6.3  (abort with ^G)\n(emqttd@192.168.6.157)1> 16:11:26.284 [info] metrics PUBLISH to $SYS/brokers/emqttd@192.168.6.157/bytes/received\n16:11:26.284 [info] metrics PUBLISH to $SYS/brokers/emqttd@192.168.6.157/bytes/sent\n. OK, now  emqttd@192.168.6.157 successful!!!!!!!!!\n. my php client is process as the above, but still work well, if i unsubscribe a topic ,I still receive it later.\nI tried mosquitto and apollo work well.\n. 0.7.1 \u53d1\u73b0\u4e00\u4e2a\u95ee\u9898 \uff0c\u5728\u54ea\u53f0\u673a\u5668\u4e0a\u6267\u884c cluster\u547d\u4ee4\u540e\uff0c\u518d\u5728\u6b64\u673a\u5668\u4e0a emqttd stop\u5c31\u6536\u4e0d\u5230\u6d88\u606f\u4e86  \n\u5982\u679c\u5728A\u673a\u5668\u4e0a\uff0c\u6267\u884ccluster\u547d\u4ee4\uff0c\u518d\u5728B\u673a\u5668\u4e0a\u6267\u884cemqttd stop \u5c31\u53ef\u4ee5\u6536\u5230\u6d88\u606f \n. 10:51:23.693 <0.208.0> [info] metrics PUBLISH to $SYS/brokers/emqttd@127.0.0.1/packets/publish/sent\n10:51:23.693 <0.208.0> [info] metrics PUBLISH to $SYS/brokers/emqttd@127.0.0.1/packets/received\n10:51:23.693 <0.208.0> [info] metrics PUBLISH to $SYS/brokers/emqttd@127.0.0.1/packets/sent\n10:51:23.693 <0.208.0> [info] metrics PUBLISH to $SYS/brokers/emqttd@127.0.0.1/packets/suback\n10:51:23.694 <0.208.0> [info] metrics PUBLISH to $SYS/brokers/emqttd@127.0.0.1/packets/subscribe\n10:51:23.694 <0.208.0> [info] metrics PUBLISH to $SYS/brokers/emqttd@127.0.0.1/packets/unsuback\n10:51:23.694 <0.209.0> [info] broker PUBLISH to $SYS/brokers/emqttd@127.0.0.1/version\n10:51:23.694 <0.208.0> [info] metrics PUBLISH to $SYS/brokers/emqttd@127.0.0.1/packets/unsubscribe\n10:51:23.694 <0.209.0> [info] broker PUBLISH to $SYS/brokers/emqttd@127.0.0.1/sysdescr\n10:51:23.694 <0.209.0> [info] broker PUBLISH to $SYS/brokers/emqttd@127.0.0.1/uptime\n10:51:23.694 <0.209.0> [info] broker PUBLISH to $SYS/brokers/emqttd@127.0.0.1/datetime\n10:51:24.232 <0.238.0> [error] failed to start connection on 0.0.0.0:1883 - enotconn\nIn log file, print publish $SYS message, bug client can't received.\n. ok,,I forgot it,hehe.\n. \u4e00\u4e2a\u5ba2\u6237\u7aef\u5206\u6b21\u8ba2\u96056\u4e2a\u4e3b\u9898\u7528(192.168.6.1\u8fde\u63a5),\u4ed6\u4eec\u5206\u522b\u8def\u7531\u5230\u673a\u5668A\u548cB\u4e0a(A\u548cB\u5404\u6536\u52303\u4e2a\u8ba2\u9605),  \u4ee5\u540e\u5ba2\u6237\u7aef \u4fdd\u6301\u548c 192.168.6.1\u8fde\u63a5,\u5f53publish6\u6761\u6d88\u606f\u65f6,\u8fd9\u4e2a\u5ba2\u6237\u7aef \u53ea\u80fd\u6536\u5230 3\u6761\u6d88\u606f. \n. \u5e76\u4e14\uff0c\u4e0d\u80fdstop, stop\u540e\u63d0\u793a Node is not running! \uff0c\u5176\u5b9e\u8fdb\u7a0b\u90fd\u8fd8\u5728 \n. \u4f46\u662f\u7528 console\u53c8\u63d0\u793a\u6210\u529f\u3002\n./emqttd console\nExec: /opt/emqttd093/emqttd/erts-6.4/bin/erlexec -boot /opt/emqttd093/emqttd/releases/0.9.3-alpha-2-gb14e8eb/emqttd             -embedded -config /opt/emqttd093/emqttd/etc/emqttd.config -config /opt/emqttd093/emqttd/etc/plugins.config             -pa ./lib/basho-patches             -args_file /opt/emqttd093/emqttd/etc/vm.args -- console\nRoot: /opt/emqttd093/emqttd\nErlang/OTP 17 [erts-6.4] [source] [64-bit] [smp:4:4] [async-threads:32] [hipe] [kernel-poll:true]\nstarting emqttd on node 'cypush@162.168.6.156'\nemqttd trace is starting...[done]\nemqttd pooler is starting...[done]\nemqttd client manager is starting...[done]\nemqttd session manager is starting...[done]\nemqttd session supervisor is starting...[done]\nemqttd pubsub is starting...[done]\nemqttd stats is starting...[done]\nemqttd metrics is starting...[done]\nemqttd broker is starting...[done]\nemqttd alarm is starting...[done]\nemqttd mode supervisor is starting...[done]\nemqttd bridge supervisor is starting...[done]\nemqttd access control is starting...[done]\nemqttd system monitor is starting...[done]\n13:01:18.939 [info] load module presence successfully\n13:01:18.939 [info] load module autosub successfully\n13:01:18.978 [info] mqtt listen on 0.0.0.0:1883 with 16 acceptors.\n13:01:18.979 [info] mqtts listen on 0.0.0.0:8883 with 4 acceptors.\n13:01:18.986 [info] http listen on 0.0.0.0:8083 with 4 acceptors.\nErlang MQTT Broker 0.9.3 is running now\nEshell V6.4  (abort with ^G)\n. \u662f\u7684\uff0c\u6539\u4e3a\u4e86 cypush@162.168.6.156\n. \u4ee5\u524d\u7684\u7248\u672c\u6ca1\u8fd9\u4e2a\u95ee\u9898\u554a \u53ef\u4ee5\u7528 192.168.6.X\n. \u5f88\u5947\u602a\uff0c\u8fd9\u91cc\u8bf4\u7684\u660e\u660e\u662f\u53ef\u4ee5\u7684 https://github.com/emqtt/emqttd/wiki/Cluster\nConfigure and start 'node1'\nconfigure 'etc/vm.args':\n-name emqttd@192.168.0.10\nor\n. \u6211\u8fd9\u4e2a 162.168.6.156 \u4e5f\u662f\u79c1\u7f51\u54e6 \n.  192.168.0.10 \u548c 192.168.6.156\u6709\u4ec0\u4e48 \u4e0d\u540c\uff1f\n. \u4ee5\u524d\u7528 111.206.. \u8fd9\u6837\u7684\u4e5f\u662f\u6ca1\u95ee\u9898\u7684\uff0c\u6211\u518d\u770b\u770b\u3002\n. \u5982\u679c\u8fd9\u4e2a\u4e0d\u80fd\u5f04\uff0c\u8bf7\u95ee\uff0c\u5982\u4f55\u8bbe\u8ba1\u96c6\u7fa4\n. erl -name a@162.168.6.156\nerl -name a@162.168.6.159\nping b on  a@162.168.6.156\nnet_adm:ping('a@162.168.6.159').\npong\nor ping a on b@162.168.6.159\nnet_adm:ping('a@162.168.6.156').\npong \n\u53ef\u4ee5ping\u901a \n. has fixed?. \u9519\u8bef\u65e5\u5fd72017-01-20 22:26:47.315 [error] <0.13826.262> CRASH REPORT Process <0.13826.262> with 0 neighbours exited with reason: {timeout,{gen_server2,call,[<0.3153.0>,{start_session,false,{<<\"060011100000521438\">>,undefined},<0.13826.262>},120000]}} in gen_server:terminate/7 line 812\n2017-01-20 22:26:47.315 [error] <0.2161.263> CRASH REPORT Process <0.2161.263> with 0 neighbours exited with reason: {timeout,{gen_server2,call,[<0.3157.0>,{start_session,false,{<<\"060177100001807449\">>,undefined},<0.2161.263>},120000]}} in gen_server:terminate/7 line 812\n2017-01-20 22:26:47.315 [error] <0.3207.0> Supervisor 'esockd_connection_sup - <0.3207.0>' had child connection started with emqttd_client:start_link([{max_clientid_len,1024},{max_packet_size,65536},{client_idle_timeout,30}]) at <0.13826.262> exit with reason {timeout,{gen_server2,call,[<0.3153.0>,{start_session,false,{<<\"060011100000521438\">>,undefined},<0.13826.262>},120000]}} in context connection_crashed\n2017-01-20 22:26:47.315 [error] <0.26359.262> CRASH REPORT Process <0.26359.262> with 0 neighbours exited with reason: {timeout,{gen_server2,call,[<0.3125.0>,{start_session,false,{<<\"060116100000339528\">>,undefined},<0.26359.262>},120000]}} in gen_server:terminate/7 line 812\n2017-01-20 22:26:47.315 [error] <0.3207.0> Supervisor 'esockd_connection_sup - <0.3207.0>' had child connection started with emqttd_client:start_link([{max_clientid_len,1024},{max_packet_size,65536},{client_idle_timeout,30}]) at <0.2161.263> exit with reason {timeout,{gen_server2,call,[<0.3157.0>,{start_session,false,{<<\"060177100001807449\">>,undefined},<0.2161.263>},120000]}} in context connection_crashed\n2017-01-20 22:26:47.315 [error] <0.3207.0> Supervisor 'esockd_connection_sup - <0.3207.0>' had child connection started with emqttd_client:start_link([{max_clientid_len,1024},{max_packet_size,65536},{client_idle_timeout,30}]) at <0.26359.262> exit with reason {timeout,{gen_server2,call,[<0.3125.0>,{start_session,false,{<<\"060116100000339528\">>,undefined},<0.26359.262>},120000]}} in context connection_crashed\n2017-01-20 22:26:47.315 [error] <0.31899.262> gen_server <0.31899.262> terminated with reason: {timeout,{gen_server2,call,[<0.3150.0>,{start_session,false,{<<\"060177100000917551\">>,undefined},<0.31899.262>},120000]}} in gen_server2:call/3 line 340. ",
    "Hades32": "That sounds great! :)\nThe sender has to know of the special topics. So in the above example this would be 'foo/p2p/SOME_CLIENTID'.\nIBM MQ implements this with some special queues, but this clearly nit appropriate here :)\n. Hy @erylee I'm not really sure what a \"queue\" in emqtt is/does, but I made some tests with my \"foo/bar/CLIENT1\" topics and even with some ACL rules that protect the topics accordingly and it worked flawlessly! \nThanks so much!\nWhat I haven't tried yet is cluster behavior. I guess it SHOULD work in a cluster environment?\n. It's working very well! Great! \nWhat I haven't tried yet: I assume ACLs are applied after the rewrite. Correct?\n. so, have you come to the conclusion, that it is better to have them applied BEFORE rewrite?\n. This would be very helpful for user-facing installations!\n. Typically (or at least for us) there are some kind of special clients (e.g. An app server or some downstream service) which should not be limited. So a global setting would not be helpful.\nSo limiting should either be per client (configurable per user, e.g. only for anonymous clients) or alternatively on a per listener base. We have different listeners for users and services. \nActually thinking about it, I think configuring it per listener would be the best. \n. Just my 2ct:\n- Kicking the other client with the same ClientID out is importantant for predictability. As in many IoT scenarios you have pretty unreliable connection it can happen pretty often for a client to reconnect while it still seems to be connected\n- I thought that with MQTT 3.1.1 it was introduced that when leaving the ClientID field empty, a random ID is generated by the broker.\n. ",
    "mindflayer": "On Python side, I could help writing some test plugins, if needed.\n. As far as I understand, only Erlang is supported. Am I wrong?\n. ",
    "lsxredrain": "good\uff0cbut how to use\uff1f\n. good job\uff0ci am your fans\uff01\n. clientid is a prviate id, it is used to  communicated  between user and system for some adminstartor message. \ni have designed a pubilc id  such as mqttid for business\u3002\ncan erylee desiged a  interface for system adminstartor to kick out some user by clientid\uff1f\n. hand  duplex clientId lead continual reconect\nhandle(Packet = ?CONNECT_PACKET(Var), State0 = #proto_state{peername = Peername}) ->\n ....\nClient = emqttd_cm:lookup(emqttd_util:bin(ClientId)),\n                                    case (undefined =/= Client) of\n                                        true -> \n                                            #mqtt_client{client_id = ClientId, client_pid = ClientPid} = Client, \n                                            lager:info(\"This is  ClientPid: ~p self: ~p ~n\",[ClientPid, self()]),\n                                            case (self() =/= ClientPid) of\n                                                true ->\n                                                    Json = mochijson2:encode([{type,emqttd_util:bin([\"duplicate\"])}]),\n                                                    ClientTopic = emqttd_util:bin([\"/client/\",  ClientId]),\n                                                    Message = #mqtt_message{qos = 0,\n                                                                  topic = ClientTopic,\n                                                                  payload = emqttd_util:bin(Json),\n                                                                  from = list_to_binary([ClientId])},\n                                                    emqttd_pubsub:publish(Message),\n                                                    {\"tokeAuth\", \"duplicate\"}; \n                                                false -> {\"tokeAuth\", \"success\"}\n                                            end;\n                                        false -> {\"tokeAuth\", \"success\"}\n                                    end; \n. subscribe topic by clientid\n1  add code in emqttd/rel/files/emqttd_ctl\ncase \"$1\" in\nsubscribe)\n        if [ $# -ne 4 ]; then\n            echo \"Usage: $SCRIPT subscribe   \"\n            exit 1\n        fi\n``\n    RES=$NODETOOL ping`\n    if [ \"$RES\" != \"pong\" ]; then\n        echo \"Node is not running!\"\n        exit 1\n    fi\n    shift\n$NODETOOL rpc emqttd_ctl subscribe $@\n;;\n\n```\n1.  in emqttd/apps/emqttd/src/emqttd_ctl.erl \n-export([subscribe/1,\n          status/1,\nsubscribe([ClientId, Topics, Qos]) ->\n    Client = emqttd_cm:lookup(bin(ClientId)),\n```\nmqtt_client{clientid = _, client_pid =ClientPid} = Client,\nsubscribe_iml([ClientPid, Topics, Qos]).\n```\nsubscribe_iml([undefined, , ])->\n   ignore;\nsubscribe_iml([ClientPid, Topics, Qos])->\n    [ClientPid ! {subscribe, list_to_binary([Topics]), Qos}].\ntest result\nright clientid\nroot@10-9-26-83:/data/emqttd/rel/emqttd/bin# ./emqttd_ctl subscribe lsxtest dsfsf  0\n19:15:06.851 [info] Client lsxtest subscribe [{<<\"dsfsf\">>,\"0\"}]. Granted QoS: [\"0\"]\nwrong cliendid\nroot@10-9-26-83:/data/emqttd/rel/emqttd/bin# ./emqttd_ctl subscribe lsxtest1 dsfsf  0\nRPC to 'emqttd@127.0.0.1' failed: {'EXIT',\n                                   {{badmatch,undefined},\n                                    [{emqttd_ctl,subscribe,1,\n                                      [{file,\"src/emqttd_ctl.erl\"},{line,59}]},\n                                     {rpc,'-handle_call_call/6-fun-0-',5,\n                                      [{file,\"rpc.erl\"},{line,205}]}]}}\nroot@10-9-26-83:/data/emqttd/rel/emqttd/bin#\n. in emqttd\\apps\\emqttd\\src\\emqttd_protocol.erl files, I add this fuction to archive auto register.\nbut have a trouble \nhandle(Packet = ?CONNECT_PACKET(Var), State0 = #proto_state{peername = Peername}) ->\n    #mqtt_packet_connect{proto_ver  = ProtoVer,\n                         proto_name = ProtoName, \n                         username   = Username,\n                         password   = Password,\n                         clean_sess = CleanSess,\n                         keep_alive = KeepAlive,\n                         clientid   = ClientId} = Var,\n```\nState1 = State0#proto_state{proto_ver  = ProtoVer,\n                            proto_name = ProtoName, \n                            username   = Username,\n                            clientid   = ClientId,\n                            clean_sess = CleanSess\n                            },\ntrace(recv, Packet, State1),\n{ReturnCode1, State3} =\ncase validate_connect(Var, State1) of\n    ?CONNACK_ACCEPT ->\n        case emqttd_access_control:auth(client(State1), Password) of\n            ok ->\n                %% Generate clientId if null\n                State2 = State1#proto_state{clientid = clientid(ClientId, State1)},\n            %% Register the client to cm\n            emqttd_cm:register(client(State2)),\n\n            %%Starting session\n            {ok, Session} = emqttd_session:start({CleanSess, clientid(State2), self()}),\n\n\n            %% Start keepalive\n            start_keepalive(KeepAlive),\n\n            %% ACCEPT\n            {?CONNACK_ACCEPT, State2#proto_state{session = Session, will_msg = willmsg(Var)}},\n\n            %% Start Register to app system\n            #mqtt_packet{header = _Header, variable = Variable, payload = _Payload} = Packet,\n            #mqtt_packet_connect{\n                 proto_ver     = _ProtoVer,\n                 proto_name    = _ProtoName,\n                 will_retain   = _WillRetain,\n                 will_qos      = _WillQoS,\n                 will_flag     = WillFlag,\n                 clean_sess    = _CleanSess,\n                 keep_alive    = _KeepAlive,\n                 clientid      = ClientId,\n                 will_topic    = WillTopic, \n                 will_msg      = WillMsg, \n                 username      = Username, \n                 password      = Password} = Variable,\n            %io:format(\"lsx CONNACK_ACCEPT WillMsg  ~p ~n\",[WillFlag]),\n            send_register(WillFlag, ClientId, WillTopic, WillMsg);\n        {error, Reason}->\n            lager:error(\"~s@~s: username '~s', login failed - ~s\",\n                            [ClientId, emqttd_net:format(Peername), Username, Reason]),\n            {?CONNACK_CREDENTIALS, State1}\n\n    end;\nReturnCode ->\n    {ReturnCode, State1}\n\nend,\n    %% Run hooks\nemqttd_broker:foreach_hooks(client_connected, [ReturnCode1, client(State3)]),\n%% Send connack\nsend(?CONNACK_PACKET(ReturnCode1), State3);\n```\n%%  ignore if have no willflag\nsend_register(false,,,_) ->\n   ignore;\n%% send to user system\nsend_register(true,ClientId,WillTopic,WillMsg) ->\n    <> = crypto:strong_rand_bytes(16),\n    Mqttid = list_to_binary([integer_to_list(A,16),integer_to_list(B,16),integer_to_list(C,16),integer_to_list(D,16)]),\n```\nself() ! {subscribe, list_to_binary([WillTopic, \"/\",  Mqttid]), 0},\nJson = mochijson2:encode([%{clientid, ClientId},\n                           %{username,UserName},\n                           %{password, PasssWord},\n                           %{will_topic, WillTopic},\n                           {will_msg,   WillMsg},\n                           {mqttid,     Mqttid}]),\n```\n%% because pub is faster than sub, I have to send /sys/register then send to $Q/client/$c\n     Message = #mqtt_message{qos = 0,\n                            topic   = list_to_binary([\"/sys/register\"]), \n                            payload = iolist_to_binary(Json)},\n    emqttd_pubsub:publish(list_to_binary([\"$Q/client/\", ClientId]), Message).\n. self() ! {subscribe, list_to_binary([WillTopic, \"/\",  Mqttid]), 0},     %% ----->>>  first execute\n log time is  13:53:35.162\nemqttd_pubsub:publish(list_to_binary([\"$Q/client/\", ClientId]), Message). %%  --->> then execute \n log time is 13:53:35.161\nby the way, emqttd should have a systemid  for every session,  this id is producted by emqttd not by client. \nclientid is private id and is a key of the user, now emqttd is short of session id for business(such as Mqttid), this sessionid is public  id  that all friends knows it.\nso pub is faster than sub at leaste  more than1 ms,  sequence is not  corrected\u3002\nin some realtime system\uff0cit maybe leaded to confuse .\n13:53:35.161 [info] $Q/client/mosqsub/11100-johncenaP PUBLISH to /sys/register: <<\"{\\\"clientid\\\":\\\"mosqsub/11100-johncenaP\\\",\\\"uid\\\":\\\"dsdfsfsd999\\\",\\\"sid\\\":\\\"276\\\",\\\"appid\\\":\\\"100000\\\",\\\"mqttid\\\":\\\"2479193C147669907572D57FC9E6D8ED\\\"}\">>\n13:53:35.162 [info] Client mosqsub/11100-johncenaP subscribe [{<<\"/tesg/ddd/2479193C147669907572D57FC9E6D8ED\">>,0}]. Granted QoS: [0]\n. thanks\uff0c\n\n #mqtt_packet_connect{\n                     proto_ver     = _ProtoVer,\n                     proto_name    = _ProtoName,\n                     will_retain   = _WillRetain,\n                     will_qos      = _WillQoS,\n                     will_flag     = WillFlag,\n                     clean_sess    = _CleanSess,\n                     keep_alive    = _KeepAlive,\n                     clientid      = ClientId,\n                     will_topic    = WillTopic, \n                     will_msg      = WillMsg, \n                     username      = Username, \n                     password      = Password} = Variable\nas the above picture\none connect then be ready for everything\u3002\nby usename\uff0cpassword\uff0cand some business information in willtopic and willMsg\uff0c emqttd can use those information to give user some topic privilege to  do something\u3002\nuser can use system id to do what he like, and some adminstration info can send to $Q/client/$c\n. now is ok,thanks!\nsample code:\nclient_connected(?CONNACK_ACCEPT, #mqtt_client{clientid = ClientId,\n                                               client_pid = ClientPid}, Topics) ->\n    F = fun(Topic) -> emqtt_topic:feed_var(<<\"$c\">>, ClientId, Topic) end,\n    %[ClientPid ! {subscribe, F(Topic), Qos} || {Topic, Qos} <- Topics],\n    emqttd_pubsub:subscribe([{F(Topic), Qos} || {Topic, Qos} <- Topics]),\n    Json = mochijson2:encode([ {lsx,list_to_binary(\"thanks erylee!\")},\n                                 {ts, emqttd_vm:timestamp()}]),\n    Message = #mqtt_message{qos     = 0,\n                              topic   = list_to_binary([\"$Q/client/\", ClientId]),\n                               payload = iolist_to_binary(Json)},\n     emqttd_pubsub:publish(list_to_binary([ClientId]), Message);\ntest result\n21:29:48.290 [info] lsxtest PUBLISH to $Q/client/lsxtest: <<\"{\\\"lsx\\\":\\\"thanks erylee!\\\",\\\"ts\\\":1433597388}\">>\n21:29:48.290 [info] SEND to lsxtest@111.192.141.189:25165: CONNACK(Qos=0, Retain=false, Dup=false, AckFlags=0, RetainCode=0)\n21:29:48.290 [info] lsxtest PUBLISH to $Q/client/lsxtest: <<\"{\\\"lsx\\\":\\\"thanks erylee!\\\",\\\"ts\\\":1433597388}\">>\n. i think it should have a system id that is genarted by emqttd\uff0cand system id is used as unique index of\neveryt session. then server can't contrl the behaviour of client\nmaybe clientid + clientPid = system id is a choose \n. clientid is used for persisted session  in server side? \nif cleansession flag is false, then client can restore info of session?\nthe role of clientid is a confusion,   is It a session id?  but it is more like a  machine id of client or a username.\nrecently I was confused about why mqtt have so many id in the connection that was generated in client side, such as username/password/clientid/willTopic/willMsg , but have no one id that was generated in server side.\nwe can't change the function of  username/password/willTopic/willMsg, but maybe we can change the fucntion of the clientid to sessionid and let it  generated in server side\u3002\nuser can config this function in emqtt.conf.\n. The Client Identifier (ClientId) identifies the Client to the Server. Each Client connecting to the Server has  a unique ClientId. The ClientId MUST be used by Clients and by Servers to identify state that they hold  relating to this MQTT Session between the Client and the Server\nA Client implementation could provide a convenience method to generate a random ClientId. Use\nof such a method should be actively discouraged when the CleanSession is set to 0.\n1. If the ClientId represents a Client already connected to the Server then the Server MUST\n   disconnect the existing Client [MQTT-3.1.4-2].\n   --->> according to mqtt , clientId collision is normal action.\n   before disconnect the existing Client, emqttd can pub a message to $Q/client/clientid that is auto subscribed by to the existing Client help client deal  with clientId collision. \n. now i process clientId collision as follow\uff0cit can prevent kick off each other  forever.\nClient = emqttd_cm:lookup(emqttd_util:bin(ClientId)),\n         case (undefined =/= Client) of\n                                true -> \n                                            #mqtt_client{client_id = ClientId, client_pid = ClientPid} = Client, \n                                            lager:info(\"This is  ClientPid: ~p self: ~p ~n\",[ClientPid, self()]),\n                                            case (self() =/= ClientPid) of\n                                                true ->\n                                                    Json = mochijson2:encode([{type,emqttd_util:bin([\"duplicate\"])}]),\n                                                    ClientTopic = emqttd_util:bin([\"/client/\",  ClientId]),\n                                                    Message = #mqtt_message{qos = 1,\n                                                                  topic = ClientTopic,\n                                                                  payload = emqttd_util:bin(Json),\n                                                                  from = list_to_binary([ClientId])},\n                                                    emqttd_pubsub:publish(Message),\n                                                    {\"tokeAuth\", \"duplicate\"}; \n                                                false -> {\"tokeAuth\", \"success\"}\n                                            end;\n. emqttd_acl_mysql.erl --- this files\n-module(emqttd_acl_mysql).\n-include_lib(\"../../include/emqttd.hrl\").\n-behaviour(emqttd_acl_mod).\n%% ACL callbacks\n-export([init/1, check_acl/2, reload_acl/1, description/0]).\n-record(state, {user_table, acl_table, acl_username_field, acl_topic_field, acl_rw_field, user_name_field, user_super_field}).\ninit(Opts) ->\n  Mapper = proplists:get_value(field_mapper, Opts),\n  State =\n    #state{\n      user_table = proplists:get_value(users_table, Opts, auth_user),\n      user_super_field = proplists:get_value(is_super, Mapper, is_superuser),\n      user_name_field = proplists:get_value(username, Mapper, username),\n      acl_table = proplists:get_value(acls_table, Opts, auth_acl),\n      acl_username_field = proplists:get_value(acl_username, Mapper, username),\n      acl_rw_field = proplists:get_value(acl_rw, Mapper, rw),\n      acl_topic_field = proplists:get_value(acl_topic, Mapper, topic)\n    },\n  {ok, State}.\ncheck_acl({#mqtt_client{username = Username}, PubSub, Topic}, #state{user_table = UserTab, acl_table = AclTab, user_name_field = UsernameField, user_super_field = SuperField, acl_topic_field = TopicField, acl_username_field = AclUserField, acl_rw_field = AclRwField}) ->\n  Flag = case PubSub of publish -> 2; subscribe -> 1; pubsub -> 2 end,\n  Where = {'and', {'>=', AclRwField, Flag}, {TopicField, Topic}},\n  Where1 = {'or', {AclUserField, Username}, {AclUserField, \"*\"}},\n  Where2 = {'and', Where, Where1},\n  case emysql:select(UserTab, {'and', {UsernameField, Username}, {SuperField, 1}}) of\n    {ok, []} ->\n      case emysql:select(UserTab, {UsernameField, Username}) of\n        {ok, []} -> ignore;\n        {ok, } -> case emysql:select(AclTab, Where2) of\n                     {ok, []} -> deny;\n                     {ok, _Record} -> allow\n                   end\n      end;\n    {ok, } -> allow\n  end.\nreload_acl(_State) -> ok.\ndescription() -> \"ACL Module by Mysql\".\nemqttd_auth_mysql.app.erl  -- this file\n-module(emqttd_auth_mysql_app).\n-behaviour(application).\n%% Application callbacks\n-export([start/2, prep_stop/1, stop/1]).\n-behaviour(supervisor).\n%% Supervisor callbacks\n-export([init/1]).\n%%%=============================================================================\n%%% Application callbacks\n%%%=============================================================================\nstart(_StartType, _StartArgs) ->\n    Env = application:get_all_env(),\n    ok = emqttd_access_control:register_mod(auth, emqttd_auth_mysql, Env),\n    emqttd_access_control:register_mod(acl, emqttd_acl_mysql, Env),\n    crypto:start(),\n    supervisor:start_link({local, ?MODULE}, ?MODULE, []).\nprep_stop(State) ->\n    emqttd_access_control:unregister_mod(auth, emqttd_auth_mysql), State,\n    emqttd_access_control:unregister_mod(acl, emqttd_acl_mysql), State,\n    crypto:stop().\nstop(_State) ->\n    ok.\n%%%=============================================================================\n%%% Supervisor callbacks(Dummy)\n%%%=============================================================================\ninit([]) ->\n    {ok, { {one_for_one, 5, 10}, []} }.\nemqttd_auth_myslq.erl --- this file\n-module(emqttd_auth_mysql).\n-author(\"Feng Lee feng@emqtt.io\").\n-include_lib(\"../../include/emqttd.hrl\").\n-behaviour(emqttd_auth_mod).\n-export([init/1, check/3, description/0]).\n-record(state, {user_table, name_field, pass_field, pass_hash}).\ninit(Opts) -> \n    Mapper = proplists:get_value(field_mapper, Opts),\n    {ok, #state{user_table = proplists:get_value(user_table, Opts),\n                name_field = proplists:get_value(username, Mapper),\n                pass_field = proplists:get_value(password, Mapper),\n                pass_hash  = proplists:get_value(password_hash, Opts)}}.\ncheck(#mqtt_client{username = undefined}, _Password, _State) ->\n    {error, \"Username undefined\"};\ncheck(#mqtt_client{username = <<>>}, _Password, _State) ->\n    {error, \"Username undefined\"};\ncheck(_Client, undefined, _State) ->\n    {error, \"Password undefined\"};\ncheck(_Client, <<>>, _State) ->\n    {error, \"Password undefined\"};\ncheck(#mqtt_client{username = Username}, Password,\n      #state{user_table = UserTab, pass_hash = Type,\n             name_field = NameField, pass_field = PassField}) ->\n    Where = {'and', {NameField, Username}, {PassField, hash(Type, Password)}},\n    io:format(\"~n~p ~p~n\", [UserTab,Where]),\n    case emysql:select(UserTab, Where) of\n        {ok, []} -> {error, \"Username or Password \"};\n        {ok, _Record} -> ok\n    end.\ndescription() -> \"Authentication by MySQL\".\nhash(plain, Password) ->\n    Password;\nhash(md5, Password) ->\n    hexstring(crypto:hash(md5, Password));\nhash(sha, Password) ->\n    hexstring(crypto:hash(sha, Password)).\nhexstring(<>) ->\n    lists:flatten(io_lib:format(\"~32.16.0b\", [X]));\nhexstring(<>) ->\n    lists:flatten(io_lib:format(\"~40.16.0b\", [X])).\nplugins.config --- this file\n[\n{emqttd_dashboard, [\n    {listener, \n        {http, 18083, [\n            {acceptors, 4},\n            {max_clients, 512}]}}\n ]},\n{emysql, [\n    {pool, 4},\n        {host, \"localhost\"},\n        {port, 3306},\n        {username, \"root\"},\n        {password, \"root\"},\n        {database, \"emqtt\"},\n        {encoding, utf8}\n]},\n{emqttd_auth_mysql, [\n    {user_table, auth_user},\n    {acl_table, auth_acl},\n    {password_hash, plain},\n    {field_mapper, [\n        {username, username},\n        {password, password},\n        {user_super, is_super_user},\n        {acl_username, username},\n        {acl_rw, rw},\n        {acl_topic, topic}\n    ]}\n]}\n].\nmysql script --- this file\nCREATE TABLE auth_user (\n  id int(11) unsigned NOT NULL AUTO_INCREMENT,\n  username varchar(60) DEFAULT NULL,\n  password varchar(60) DEFAULT NULL,\n  is_superuser tinyint(1) NOT NULL,\n  salt varchar(20) DEFAULT NULL,\n  created datetime DEFAULT NULL,\n  PRIMARY KEY (id),\n  UNIQUE KEY auth_user_username (username)\n) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;\nCREATE TABLE auth_acl (\n        id int(11) NOT NULL AUTO_INCREMENT,\n        topic varchar(100) NOT NULL,\n        username varchar(30) NOT NULL,\n        rw tinyint(1) NOT NULL,\n        PRIMARY KEY (id)\n        ) ENGINE=InnoDB AUTO_INCREMENT=66 DEFAULT CHARSET=utf8\n. git clone git://github.com/wooga/eredis.git plugins\nthen we can use eredis in any files\uff0cfor example as follow\n{ok, C} = eredis:start_link(\"127.0.0.1\", 6379, 0),\n{ok, <<\"OK\">>} = eredis:q(C, [\"SET\", \"foo\", \"bar\"]),\n{ok, SetResult} = eredis:q(C, [\"SET\", \"foo\", \"bar\"]),\nio:format(\"~n~p~n\", [SetResult]),\n{ok, GetReuslt} = eredis:q(C, [\"GET\", \"foo\"]),\nio:format(\"~n~p~n\", [GetReuslt]),\n. if use redis to stroe message ,it is very easy to support for retained message expiration.\n. hi\uff0cerylee\uff0cwhere can I print socket connect packet in emqttd?\nI want to know why emqttd spent a minute to reply client socket connect.\n. maybe It was caused by improper linux core param\uff0cI modified it to as follow,  I can't reappear it.\nkernel.unknown_nmi_panic = 0\nfs.file-max = 1000000\nvm.swappiness = 10\nfs.inotify.max_user_watches = 10000000\nnet.ipv4.ip_forward = 0\nnet.ipv4.conf.default.rp_filter = 1\nnet.ipv4.conf.default.accept_source_route = 0\nkernel.sysrq = 0\nkernel.core_uses_pid = 1\nnet.ipv4.tcp_syncookies = 1\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\nkernel.shmmax = 68719476736\nkernel.shmall = 4294967296\nnet.ipv4.tcp_max_tw_buckets = 6000\nnet.ipv4.tcp_sack = 1\nnet.ipv4.tcp_window_scaling = 1\nnet.ipv4.tcp_rmem = 4096 87380 4194304\nnet.ipv4.tcp_wmem = 4096 16384 4194304\nnet.core.wmem_default = 8388608\nnet.core.rmem_default = 8388608\nnet.core.rmem_max = 16777216\nnet.core.wmem_max = 16777216\nnet.core.netdev_max_backlog = 262144\nnet.core.somaxconn = 65535\nnet.ipv4.tcp_max_orphans = 3276800\nnet.ipv4.tcp_max_syn_backlog = 262144\nnet.ipv4.tcp_timestamps = 0\nnet.ipv4.tcp_synack_retries = 1\nnet.ipv4.tcp_syn_retries = 1\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_mem = 94500000 915000000 927000000\nnet.ipv4.tcp_fin_timeout = 1\nnet.ipv4.tcp_keepalive_time = 30\nnet.ipv4.ip_local_port_range = 1024 65000\n. old linux core param as follows\uff1a\nfs.file-max = 1000000\nIncrease number of incoming connections\nnet.core.somaxconn = 65535\nnet.core.wmem_default = 8388608 \nnet.core.rmem_default = 8388608 \nnet.core.rmem_max = 16777216 \nnet.core.wmem_max = 16777216\nnet.unix.max_dgram_qlen = 100\nnet.ipv4.tcp_fin_timeout = 30\nnet.ipv4.tcp_keepalive_time = 1200\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_timestamps=1\nnet.ipv4.ip_local_port_range = 1024    65000\nnet.ipv4.tcp_max_syn_backlog = 81920\nnet.ipv4.tcp_max_tw_buckets = 200000\n. only two clients kick out each other, and login and logout quickly.\n. ok\uff0cthanks,\nhow long 0.90 version will be released?\nnow I have to store these infomation to redis.\n. thank\uff0cI want to hook some topic and publish other message.\n. add auto subscribe and auto  publish fucntion.\nfor example.\nwhen connented \n1. auto subscribe /client/$c     here $c is clientid\n2. auto publish some message(for example sessionid )  to  /client/$c \n3. auto subscribe /user/sessionid \n4\u3001client will get sessionid for bussiness.\nversion 0.88 is ok, version 0.90 have lost this function\n. cleansession flag is 0\uff0c\nQos 0 and  Qos 1 is ok\nQos 2 will crash\n. 0.90 is ok, emysql auth and acl is all ok,  i have test.\nyou can look up this issue\nhttps://github.com/emqtt/emqttd/issues/172\n. thanks a lot, it ok\n. Stomp over SockJS  is ok?\n. good job,  wait for SockJS,\n. just like rest api?\n. about 400k connections emqttd will crash:\n[root@10-9-26-83 log]# tail -f emqttd_error.log\n                                                 {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,port_control,3}},{registered_name,[]},{status,runnable},{message_queue_len,3},{group_leader,<0.122.0>},{priority,normal},{trap_exit,false},{reductions,986},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,13968},{total_heap_size,1597},{heap_size,987},{stack_size,27},{min_heap_size,233}]\n10:53:33.005 <0.220.0> [error] long_schedule warning: pid = <0.3519.25>, info: [{timeout,240},\n                                                 {in,{gen,do_call,4}},\n                                                 {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,hibernate,3}},{registered_name,[]},{status,waiting},{message_queue_len,0},{group_leader,<0.122.0>},{priority,normal},{trap_exit,false},{reductions,1227},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,2672},{total_heap_size,197},{heap_size,197},{stack_size,0},{min_heap_size,233}]\n10:53:33.005 <0.220.0> [error] long_schedule warning: pid = <0.3535.25>, info: [{timeout,231},\n                                                 {in,{gen,do_call,4}},\n                                                 {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,hibernate,3}},{registered_name,[]},{status,waiting},{message_queue_len,0},{group_leader,<0.122.0>},{priority,normal},{trap_exit,false},{reductions,1230},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,2672},{total_heap_size,197},{heap_size,197},{stack_size,0},{min_heap_size,233}]\ndmesg info:\nMem-Info:\nNode 0 DMA per-cpu:\nCPU    0: hi:    0, btch:   1 usd:   0\nCPU    1: hi:    0, btch:   1 usd:   0\nCPU    2: hi:    0, btch:   1 usd:   0\nCPU    3: hi:    0, btch:   1 usd:   0\nNode 0 DMA32 per-cpu:\nCPU    0: hi:  186, btch:  31 usd:   0\nCPU    1: hi:  186, btch:  31 usd:   0\nCPU    2: hi:  186, btch:  31 usd:   0\nCPU    3: hi:  186, btch:  31 usd:   0\nNode 0 Normal per-cpu:\nCPU    0: hi:  186, btch:  31 usd:  30\nCPU    1: hi:  186, btch:  31 usd:   0\nCPU    2: hi:  186, btch:  31 usd:   0\nCPU    3: hi:  186, btch:  31 usd:  33\nactive_anon:1000363 inactive_anon:178266 isolated_anon:32\n active_file:229 inactive_file:147 isolated_file:0\n unevictable:0 dirty:0 writeback:0 unstable:0\n free:24808 slab_reclaimable:104127 slab_unreclaimable:254279\n mapped:824 shmem:0 pagetables:3126 bounce:0\nNode 0 DMA free:15708kB min:120kB low:148kB high:180kB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:15304kB mlocked:0kB dirty:0kB writeback:0kB mapped:0kB shmem:0kB slab_reclaimable:0kB slab_unreclaimable:0kB kernel_stack:0kB pagetables:0kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? yes\nlowmem_reserve[]: 0 3512 8057 8057\nNode 0 DMA32 free:46668kB min:28512kB low:35640kB high:42768kB active_anon:1932080kB inactive_anon:535480kB active_file:20kB inactive_file:20kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:3596500kB mlocked:0kB dirty:0kB writeback:0kB mapped:16kB shmem:0kB slab_reclaimable:99508kB slab_unreclaimable:239868kB kernel_stack:0kB pagetables:4292kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? no\nlowmem_reserve[]: 0 0 4545 4545\nNode 0 Normal free:36856kB min:36896kB low:46120kB high:55344kB active_anon:2069372kB inactive_anon:177584kB active_file:896kB inactive_file:568kB unevictable:0kB isolated(anon):128kB isolated(file):0kB present:4654080kB mlocked:0kB dirty:0kB writeback:0kB mapped:3280kB shmem:0kB slab_reclaimable:317000kB slab_unreclaimable:777248kB kernel_stack:1576kB pagetables:8212kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:2592 all_unreclaimable? yes\nlowmem_reserve[]: 0 0 0 0\nNode 0 DMA: 3_4kB 2_8kB 0_16kB 2_32kB 2_64kB 1_128kB 0_256kB 0_512kB 1_1024kB 1_2048kB 3_4096kB = 15708kB\nNode 0 DMA32: 96_4kB 39_8kB 14_16kB 5_32kB 24_64kB 19_128kB 21_256kB 17_512kB 13_1024kB 3_2048kB 2_4096kB = 46776kB\nNode 0 Normal: 221_4kB 430_8kB 289_16kB 172_32kB 185_64kB 41_128kB 13_256kB 0_512kB 0_1024kB 1_2048kB 0_4096kB = 36916kB\n3938 total pagecache pages\n3554 pages in swap cache\nSwap cache stats: add 1033340, delete 1029786, find 256766/318307\nFree swap  = 0kB\nTotal swap = 524280kB\n2097151 pages RAM\n98424 pages reserved\n970 pages shared\n1969624 pages non-shared\n[ pid ]   uid  tgid total_vm      rss cpu oom_adj oom_score_adj name\n[  504]     0   504     2701        0   0     -17         -1000 udevd\n[ 1179]     0  1179    23283       20   0     -17         -1000 auditd\n[ 1201]     0  1201    62847       70   0       0             0 rsyslogd\n[ 1216]    81  1216     5358        1   3       0             0 dbus-daemon\n[ 1254]     0  1254     1020        0   0       0             0 acpid\n[ 1403]     0  1403    29215       22   0       0             0 crond\n[ 1917]    38  1917     7684       48   0       0             0 ntpd\n[ 2086]     0  2086    16556       14   1     -17         -1000 sshd\n[ 2150]     0  2150     1020        1   0       0             0 agetty\n[ 2152]     0  2152     1016        1   1       0             0 mingetty\n[ 2154]     0  2154     1016        1   2       0             0 mingetty\n[ 2156]     0  2156     1016        1   2       0             0 mingetty\n[ 2158]     0  2158     1016        1   2       0             0 mingetty\n[ 2160]     0  2160     1016        1   2       0             0 mingetty\n[ 2163]     0  2163     2700        0   1     -17         -1000 udevd\n[ 2164]     0  2164     1016        1   1       0             0 mingetty\n[ 2165]     0  2165     2700        0   1     -17         -1000 udevd\n[16360]     0 16360    25155       95   0       0             0 sshd\n[16362]     0 16362    27076       68   3       0             0 bash\n[16890]     0 16890     2835      160   0       0             0 epmd\n[16926]     0 16926     3227       29   0       0             0 run_erl\n[16929]     0 16929  1913736  1167916   1       0             0 beam.smp\n[17123]     0 17123     1014        6   0       0             0 memsup\n[17124]     0 17124     1014        1   1       0             0 cpu_sup\n[17151]     0 17151     2698        1   3       0             0 inet_gethost\n[17153]     0 17153     2698        0   3       0             0 inet_gethost\n[28360]     0 28360    88074     7424   0       0             0 iftop\n[28364]     0 28364    26516       61   0       0             0 sh\nOut of memory: Kill process 16929 (beam.smp) score 580 or sacrifice child\nKilled process 17123, UID 0, (memsup) total-vm:4056kB, anon-rss:12kB, file-rss:12kB\nrs:main Q:Reg invoked oom-killer: gfp_mask=0x201da, order=0, oom_adj=0, oom_score_adj=0\nrs:main Q:Reg cpuset=/ mems_allowed=0\nPid: 1202, comm: rs:main Q:Reg Not tainted 2.6.32-431.11.15.el6.ucloud.x86_64 #1\nCall Trace:\n [] ? cpuset_print_task_mems_allowed+0x91/0xb0\n [] ? dump_header+0x90/0x1b0\n [] ? security_real_capable_noaudit+0x3c/0x70\n [] ? oom_kill_process+0x82/0x2a0\n [] ? select_bad_process+0xe1/0x120\n [] ? out_of_memory+0x220/0x3c0\n [] ? __alloc_pages_nodemask+0x89f/0x8d0\n [] ? alloc_pages_current+0xaa/0x110\n [] ? __page_cache_alloc+0x87/0x90\n [] ? find_get_page+0x1e/0xa0\n [] ? filemap_fault+0x1a7/0x500\n [] ? __do_fault+0x54/0x530\n [] ? handle_pte_fault+0xf7/0xb00\n [] ? thread_return+0x4e/0x76e\n [] ? generic_file_aio_write+0xba/0x100\n [] ? handle_mm_fault+0x22a/0x300\n [] ? __do_page_fault+0x138/0x480\n [] ? apic_timer_interrupt+0xe/0x20\n [] ? do_page_fault+0x3e/0xa0\n [] ? page_fault+0x25/0x30\nMem-Info:\nNode 0 DMA per-cpu:\nCPU    0: hi:    0, btch:   1 usd:   0\nCPU    1: hi:    0, btch:   1 usd:   0\nCPU    2: hi:    0, btch:   1 usd:   0\nCPU    3: hi:    0, btch:   1 usd:   0\nNode 0 DMA32 per-cpu:\nCPU    0: hi:  186, btch:  31 usd:   0\nCPU    1: hi:  186, btch:  31 usd:   0\nCPU    2: hi:  186, btch:  31 usd:   0\nCPU    3: hi:  186, btch:  31 usd:   0\nNode 0 Normal per-cpu:\nCPU    0: hi:  186, btch:  31 usd:  30\nCPU    1: hi:  186, btch:  31 usd:  30\nCPU    2: hi:  186, btch:  31 usd:   0\nCPU    3: hi:  186, btch:  31 usd:  10\nactive_anon:990550 inactive_anon:188320 isolated_anon:32\n active_file:40 inactive_file:33 isolated_file:0\n unevictable:0 dirty:0 writeback:0 unstable:0\n free:24788 slab_reclaimable:104127 slab_unreclaimable:254279\n mapped:568 shmem:0 pagetables:3126 bounce:0\nNode 0 DMA free:15708kB min:120kB low:148kB high:180kB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:15304kB mlocked:0kB dirty:0kB writeback:0kB mapped:0kB shmem:0kB slab_reclaimable:0kB slab_unreclaimable:0kB kernel_stack:0kB pagetables:0kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? yes\nlowmem_reserve[]: 0 3512 8057 8057\nNode 0 DMA32 free:46668kB min:28512kB low:35640kB high:42768kB active_anon:1932080kB inactive_anon:535480kB active_file:20kB inactive_file:20kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:3596500kB mlocked:0kB dirty:0kB writeback:0kB mapped:16kB shmem:0kB slab_reclaimable:99508kB slab_unreclaimable:239868kB kernel_stack:0kB pagetables:4292kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? no\nlowmem_reserve[]: 0 0 4545 4545\nNode 0 Normal free:36776kB min:36896kB low:46120kB high:55344kB active_anon:2030120kB inactive_anon:217800kB active_file:140kB inactive_file:112kB unevictable:0kB isolated(anon):128kB isolated(file):0kB present:4654080kB mlocked:0kB dirty:0kB writeback:0kB mapped:2256kB shmem:0kB slab_reclaimable:317000kB slab_unreclaimable:777248kB kernel_stack:1576kB pagetables:8212kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:800 all_unreclaimable? yes\nlowmem_reserve[]: 0 0 0 0\nNode 0 DMA: 3_4kB 2_8kB 0_16kB 2_32kB 2_64kB 1_128kB 0_256kB 0_512kB 1_1024kB 1_2048kB 3_4096kB = 15708kB\nNode 0 DMA32: 101_4kB 39_8kB 13_16kB 6_32kB 24_64kB 19_128kB 21_256kB 17_512kB 13_1024kB 3_2048kB 2_4096kB = 46812kB\nNode 0 Normal: 193_4kB 402_8kB 291_16kB 173_32kB 185_64kB 41_128kB 13_256kB 0_512kB 0_1024kB 1_2048kB 0_4096kB = 36644kB\n4002 total pagecache pages\n3863 pages in swap cache\nSwap cache stats: add 1033794, delete 1029931, find 256834/318420\nFree swap  = 0kB\nTotal swap = 524280kB\n2097151 pages RAM\n98424 pages reserved\n640 pages shared\n1969943 pages non-shared\n[ pid ]   uid  tgid total_vm      rss cpu oom_adj oom_score_adj name\n[  504]     0   504     2701        0   0     -17         -1000 udevd\n[ 1179]     0  1179    23283       20   0     -17         -1000 auditd\n[ 1201]     0  1201    62847       73   0       0             0 rsyslogd\n[ 1216]    81  1216     5358        1   3       0             0 dbus-daemon\n[ 1254]     0  1254     1020        0   0       0             0 acpid\n[ 1403]     0  1403    29215       22   0       0             0 crond\n[ 1917]    38  1917     7684       29   0       0             0 ntpd\n[ 2086]     0  2086    16556       14   1     -17         -1000 sshd\n[ 2150]     0  2150     1020        1   0       0             0 agetty\n[ 2152]     0  2152     1016        1   1       0             0 mingetty\n[ 2154]     0  2154     1016        1   2       0             0 mingetty\n[ 2156]     0  2156     1016        1   2       0             0 mingetty\n[ 2158]     0  2158     1016        1   2       0             0 mingetty\n[ 2160]     0  2160     1016        1   2       0             0 mingetty\n[ 2163]     0  2163     2700        0   1     -17         -1000 udevd\n[ 2164]     0  2164     1016        1   1       0             0 mingetty\n[ 2165]     0  2165     2700        0   1     -17         -1000 udevd\n[16360]     0 16360    25155       42   0       0             0 sshd\n[16362]     0 16362    27076       58   3       0             0 bash\n[16890]     0 16890     2835      154   0       0             0 epmd\n[16926]     0 16926     3227       19   0       0             0 run_erl\n[16929]     0 16929  1913736  1167685   1       0             0 beam.smp\n[17124]     0 17124     1014        1   1       0             0 cpu_sup\n[17151]     0 17151     2698        1   3       0             0 inet_gethost\n[17153]     0 17153     2698        0   3       0             0 inet_gethost\n[28360]     0 28360    88074     7372   0       0             0 iftop\n[28364]     0 28364    26516       46   0       0             0 sh\nOut of memory: Kill process 16929 (beam.smp) score 580 or sacrifice child\nKilled process 17124, UID 0, (cpu_sup) total-vm:4056kB, anon-rss:0kB, file-rss:4kB\nrs:main Q:Reg invoked oom-killer: gfp_mask=0x201da, order=0, oom_adj=0, oom_score_adj=0\nrs:main Q:Reg cpuset=/ mems_allowed=0\nPid: 1202, comm: rs:main Q:Reg Not tainted 2.6.32-431.11.15.el6.ucloud.x86_64 #1\nCall Trace:\n [] ? cpuset_print_task_mems_allowed+0x91/0xb0\n [] ? dump_header+0x90/0x1b0\n [] ? security_real_capable_noaudit+0x3c/0x70\n [] ? oom_kill_process+0x82/0x2a0\n [] ? select_bad_process+0xe1/0x120\n [] ? out_of_memory+0x220/0x3c0\n [] ? __alloc_pages_nodemask+0x89f/0x8d0\n [] ? alloc_pages_current+0xaa/0x110\n [] ? __page_cache_alloc+0x87/0x90\n [] ? find_get_page+0x1e/0xa0\n [] ? filemap_fault+0x1a7/0x500\n [] ? __do_fault+0x54/0x530\n [] ? handle_pte_fault+0xf7/0xb00\n [] ? thread_return+0x4e/0x76e\n [] ? generic_file_aio_write+0xba/0x100\n [] ? handle_mm_fault+0x22a/0x300\n [] ? __do_page_fault+0x138/0x480\n [] ? apic_timer_interrupt+0xe/0x20\n [] ? do_page_fault+0x3e/0xa0\n [] ? page_fault+0x25/0x30\nMem-Info:\nNode 0 DMA per-cpu:\nCPU    0: hi:    0, btch:   1 usd:   0\nCPU    1: hi:    0, btch:   1 usd:   0\nCPU    2: hi:    0, btch:   1 usd:   0\nCPU    3: hi:    0, btch:   1 usd:   0\nNode 0 DMA32 per-cpu:\nCPU    0: hi:  186, btch:  31 usd:   0\nCPU    1: hi:  186, btch:  31 usd:   0\nCPU    2: hi:  186, btch:  31 usd:   0\nCPU    3: hi:  186, btch:  31 usd:   0\nNode 0 Normal per-cpu:\nCPU    0: hi:  186, btch:  31 usd:  59\nCPU    1: hi:  186, btch:  31 usd:  44\nCPU    2: hi:  186, btch:  31 usd:   0\nCPU    3: hi:  186, btch:  31 usd:  13\nactive_anon:989597 inactive_anon:189280 isolated_anon:32\n active_file:40 inactive_file:33 isolated_file:0\n unevictable:0 dirty:0 writeback:0 unstable:0\n free:24788 slab_reclaimable:104127 slab_unreclaimable:254279\n mapped:568 shmem:0 pagetables:3126 bounce:0\nNode 0 DMA free:15708kB min:120kB low:148kB high:180kB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:15304kB mlocked:0kB dirty:0kB writeback:0kB mapped:0kB shmem:0kB slab_reclaimable:0kB slab_unreclaimable:0kB kernel_stack:0kB pagetables:0kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? yes\nlowmem_reserve[]: 0 3512 8057 8057\nNode 0 DMA32 free:46668kB min:28512kB low:35640kB high:42768kB active_anon:1932080kB inactive_anon:535480kB active_file:20kB inactive_file:20kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:3596500kB mlocked:0kB dirty:0kB writeback:0kB mapped:16kB shmem:0kB slab_reclaimable:99508kB slab_unreclaimable:239868kB kernel_stack:0kB pagetables:4292kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:2 all_unreclaimable? no\nlowmem_reserve[]: 0 0 4545 4545\nNode 0 Normal free:36776kB min:36896kB low:46120kB high:55344kB active_anon:2026308kB inactive_anon:221640kB active_file:140kB inactive_file:112kB unevictable:0kB isolated(anon):128kB isolated(file):0kB present:4654080kB mlocked:0kB dirty:0kB writeback:0kB mapped:2256kB shmem:0kB slab_reclaimable:317000kB slab_unreclaimable:777248kB kernel_stack:1576kB pagetables:8212kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:1856 all_unreclaimable? yes\nlowmem_reserve[]: 0 0 0 0\nNode 0 DMA: 3_4kB 2_8kB 0_16kB 2_32kB 2_64kB 1_128kB 0_256kB 0_512kB 1_1024kB 1_2048kB 3_4096kB = 15708kB\nNode 0 DMA32: 101_4kB 39_8kB 13_16kB 6_32kB 24_64kB 19_128kB 21_256kB 17_512kB 13_1024kB 3_2048kB 2_4096kB = 46812kB\nNode 0 Normal: 162_4kB 402_8kB 291_16kB 173_32kB 185_64kB 41_128kB 13_256kB 0_512kB 0_1024kB 1_2048kB 0_4096kB = 36520kB\n4002 total pagecache pages\n3882 pages in swap cache\nSwap cache stats: add 1033816, delete 1029934, find 256834/318420\nFree swap  = 0kB\nTotal swap = 524280kB\n2097151 pages RAM\n98424 pages reserved\n626 pages shared\n1969941 pages non-shared\n[ pid ]   uid  tgid total_vm      rss cpu oom_adj oom_score_adj name\n[  504]     0   504     2701        0   0     -17         -1000 udevd\n[ 1179]     0  1179    23283       20   0     -17         -1000 auditd\n[ 1201]     0  1201    62847       73   0       0             0 rsyslogd\n[ 1216]    81  1216     5358        1   3       0             0 dbus-daemon\n[ 1254]     0  1254     1020        0   0       0             0 acpid\n[ 1403]     0  1403    29215       22   0       0             0 crond\n[ 1917]    38  1917     7684       29   0       0             0 ntpd\n[ 2086]     0  2086    16556       14   1     -17         -1000 sshd\n[ 2150]     0  2150     1020        1   0       0             0 agetty\n[ 2152]     0  2152     1016        1   1       0             0 mingetty\n[ 2154]     0  2154     1016        1   2       0             0 mingetty\n[ 2156]     0  2156     1016        1   2       0             0 mingetty\n[ 2158]     0  2158     1016        1   2       0             0 mingetty\n[ 2160]     0  2160     1016        1   2       0             0 mingetty\n[ 2163]     0  2163     2700        0   1     -17         -1000 udevd\n[ 2164]     0  2164     1016        1   1       0             0 mingetty\n[ 2165]     0  2165     2700        0   1     -17         -1000 udevd\n[16360]     0 16360    25155       42   0       0             0 sshd\n[16362]     0 16362    27076       58   3       0             0 bash\n[16890]     0 16890     2835      154   0       0             0 epmd\n[16926]     0 16926     3227       19   0       0             0 run_erl\n[16929]     0 16929  1913736  1167663   1       0             0 beam.smp\n[17151]     0 17151     2698        1   3       0             0 inet_gethost\n[17153]     0 17153     2698        0   3       0             0 inet_gethost\n[28360]     0 28360    88074     7372   0       0             0 iftop\n[28364]     0 28364    26516       46   0       0             0 sh\nOut of memory: Kill process 16929 (beam.smp) score 580 or sacrifice child\nKilled process 17151, UID 0, (inet_gethost) total-vm:10792kB, anon-rss:0kB, file-rss:4kB\nchild_waiter invoked oom-killer: gfp_mask=0x201da, order=0, oom_adj=0, oom_score_adj=0\nchild_waiter cpuset=/ mems_allowed=0\nPid: 17107, comm: child_waiter Not tainted 2.6.32-431.11.15.el6.ucloud.x86_64 #1\nCall Trace:\n [] ? cpuset_print_task_mems_allowed+0x91/0xb0\n [] ? dump_header+0x90/0x1b0\n [] ? security_real_capable_noaudit+0x3c/0x70\n [] ? oom_kill_process+0x82/0x2a0\n [] ? select_bad_process+0xe1/0x120\n [] ? out_of_memory+0x220/0x3c0\n [] ? __alloc_pages_nodemask+0x89f/0x8d0\n [] ? alloc_pages_current+0xaa/0x110\n [] ? __page_cache_alloc+0x87/0x90\n [] ? find_get_page+0x1e/0xa0\n [] ? filemap_fault+0x1a7/0x500\n [] ? __do_fault+0x54/0x530\n [] ? vsnprintf+0x450/0x5e0\n [] ? handle_pte_fault+0xf7/0xb00\n [] ? d_lookup+0x35/0x60\n [] ? handle_mm_fault+0x22a/0x300\n [] ? __do_page_fault+0x138/0x480\n [] ? wait_consider_task+0x7e6/0xb20\n [] ? remove_wait_queue+0x3c/0x50\n [] ? do_wait+0x17f/0x240\n [] ? sys_wait4+0xae/0x100\n [] ? do_page_fault+0x3e/0xa0\n [] ? page_fault+0x25/0x30\nMem-Info:\nNode 0 DMA per-cpu:\nCPU    0: hi:    0, btch:   1 usd:   0\nCPU    1: hi:    0, btch:   1 usd:   0\nCPU    2: hi:    0, btch:   1 usd:   0\nCPU    3: hi:    0, btch:   1 usd:   0\nNode 0 DMA32 per-cpu:\nCPU    0: hi:  186, btch:  31 usd:   0\nCPU    1: hi:  186, btch:  31 usd:   0\nCPU    2: hi:  186, btch:  31 usd:   0\nCPU    3: hi:  186, btch:  31 usd:   0\nNode 0 Normal per-cpu:\nCPU    0: hi:  186, btch:  31 usd:  30\nCPU    1: hi:  186, btch:  31 usd:   0\nCPU    2: hi:  186, btch:  31 usd:  29\nCPU    3: hi:  186, btch:  31 usd:  29\nactive_anon:988125 inactive_anon:190806 isolated_anon:32\n active_file:40 inactive_file:16 isolated_file:0\n unevictable:0 dirty:0 writeback:0 unstable:0\n free:24926 slab_reclaimable:104127 slab_unreclaimable:254279\n mapped:568 shmem:0 pagetables:3126 bounce:0\nNode 0 DMA free:15708kB min:120kB low:148kB high:180kB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:15304kB mlocked:0kB dirty:0kB writeback:0kB mapped:0kB shmem:0kB slab_reclaimable:0kB slab_unreclaimable:0kB kernel_stack:0kB pagetables:0kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? yes\nlowmem_reserve[]: 0 3512 8057 8057\nNode 0 DMA32 free:46668kB min:28512kB low:35640kB high:42768kB active_anon:1932080kB inactive_anon:535480kB active_file:20kB inactive_file:20kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:3596500kB mlocked:0kB dirty:0kB writeback:0kB mapped:16kB shmem:0kB slab_reclaimable:99508kB slab_unreclaimable:239868kB kernel_stack:0kB pagetables:4292kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:5 all_unreclaimable? no\nlowmem_reserve[]: 0 0 4545 4545\nNode 0 Normal free:37328kB min:36896kB low:46120kB high:55344kB active_anon:2020420kB inactive_anon:227744kB active_file:140kB inactive_file:44kB unevictable:0kB isolated(anon):128kB isolated(file):0kB present:4654080kB mlocked:0kB dirty:0kB writeback:0kB mapped:2256kB shmem:0kB slab_reclaimable:317000kB slab_unreclaimable:777248kB kernel_stack:1576kB pagetables:8212kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:67 all_unreclaimable? no\nlowmem_reserve[]: 0 0 0 0\nNode 0 DMA: 3_4kB 2_8kB 0_16kB 2_32kB 2_64kB 1_128kB 0_256kB 0_512kB 1_1024kB 1_2048kB 3_4096kB = 15708kB\nNode 0 DMA32: 101_4kB 39_8kB 13_16kB 6_32kB 24_64kB 19_128kB 21_256kB 17_512kB 13_1024kB 3_2048kB 2_4096kB = 46812kB\nNode 0 Normal: 259_4kB 429_8kB 291_16kB 173_32kB 185_64kB 41_128kB 13_256kB 0_512kB 0_1024kB 1_2048kB 0_4096kB = 37124kB\n4002 total pagecache pages\n3891 pages in swap cache\nSwap cache stats: add 1033825, delete 1029934, find 256834/318420\nFree swap  = 0kB\nTotal swap = 524280kB\n2097151 pages RAM\n98424 pages reserved\n710 pages shared\n1969803 pages non-shared\n[ pid ]   uid  tgid total_vm      rss cpu oom_adj oom_score_adj name\n[  504]     0   504     2701        0   0     -17         -1000 udevd\n[ 1179]     0  1179    23283       20   0     -17         -1000 auditd\n[ 1201]     0  1201    62847       72   0       0             0 rsyslogd\n[ 1216]    81  1216     5358        1   3       0             0 dbus-daemon\n[ 1254]     0  1254     1020        0   0       0             0 acpid\n[ 1403]     0  1403    29215       22   0       0             0 crond\n[ 1917]    38  1917     7684       29   0       0             0 ntpd\n[ 2086]     0  2086    16556       14   1     -17         -1000 sshd\n[ 2150]     0  2150     1020        1   0       0             0 agetty\n[ 2152]     0  2152     1016        1   1       0             0 mingetty\n[ 2154]     0  2154     1016        1   2       0             0 mingetty\n[ 2156]     0  2156     1016        1   2       0             0 mingetty\n[ 2158]     0  2158     1016        1   2       0             0 mingetty\n[ 2160]     0  2160     1016        1   2       0             0 mingetty\n[ 2163]     0  2163     2700        0   1     -17         -1000 udevd\n[ 2164]     0  2164     1016        1   1       0             0 mingetty\n[ 2165]     0  2165     2700        0   1     -17         -1000 udevd\n[16360]     0 16360    25155       42   0       0             0 sshd\n[16362]     0 16362    27076       58   3       0             0 bash\n[16890]     0 16890     2835      154   0       0             0 epmd\n[16926]     0 16926     3227       19   0       0             0 run_erl\n[16929]     0 16929  1913736  1167655   1       0             0 beam.smp\n[17153]     0 17153     2698        2   2       0             0 inet_gethost\n[28360]     0 28360    88074     7372   0       0             0 iftop\n[28364]     0 28364    26516       46   0       0             0 sh\nOut of memory: Kill process 16929 (beam.smp) score 580 or sacrifice child\nKilled process 28364, UID 0, (sh) total-vm:106064kB, anon-rss:180kB, file-rss:4kB\nrsyslogd invoked oom-killer: gfp_mask=0x201da, order=0, oom_adj=0, oom_score_adj=0\nrsyslogd cpuset=/ mems_allowed=0\nPid: 1205, comm: rsyslogd Not tainted 2.6.32-431.11.15.el6.ucloud.x86_64 #1\nCall Trace:\n [] ? cpuset_print_task_mems_allowed+0x91/0xb0\n [] ? dump_header+0x90/0x1b0\n [] ? security_real_capable_noaudit+0x3c/0x70\n [] ? oom_kill_process+0x82/0x2a0\n [] ? select_bad_process+0xe1/0x120\n [] ? out_of_memory+0x220/0x3c0\n [] ? __alloc_pages_nodemask+0x89f/0x8d0\n [] ? alloc_pages_current+0xaa/0x110\n [] ? __page_cache_alloc+0x87/0x90\n [] ? find_get_page+0x1e/0xa0\n [] ? filemap_fault+0x1a7/0x500\n [] ? __do_fault+0x54/0x530\n [] ? handle_pte_fault+0xf7/0xb00\n [] ? _spin_unlock_irqrestore+0x17/0x20\n [] ? wake_up_state+0x10/0x20\n [] ? wake_futex+0x40/0x60\n [] ? futex_wake+0x10e/0x120\n [] ? handle_mm_fault+0x22a/0x300\n [] ? __do_page_fault+0x138/0x480\n [] ? __switch_to+0x26e/0x320\n [] ? pvclock_clocksource_read+0x58/0xd0\n [] ? kvm_clock_read+0x1c/0x20\n [] ? kvm_clock_get_cycles+0x9/0x10\n [] ? getnstimeofday+0x57/0xe0\n [] ? do_page_fault+0x3e/0xa0\n [] ? page_fault+0x25/0x30\nMem-Info:\nNode 0 DMA per-cpu:\nCPU    0: hi:    0, btch:   1 usd:   0\nCPU    1: hi:    0, btch:   1 usd:   0\nCPU    2: hi:    0, btch:   1 usd:   0\nCPU    3: hi:    0, btch:   1 usd:   0\nNode 0 DMA32 per-cpu:\nCPU    0: hi:  186, btch:  31 usd:   0\nCPU    1: hi:  186, btch:  31 usd:   0\nCPU    2: hi:  186, btch:  31 usd:   0\nCPU    3: hi:  186, btch:  31 usd:   0\nNode 0 Normal per-cpu:\nCPU    0: hi:  186, btch:  31 usd:  30\nCPU    1: hi:  186, btch:  31 usd:   0\nCPU    2: hi:  186, btch:  31 usd:  13\nCPU    3: hi:  186, btch:  31 usd:  29\nactive_anon:987346 inactive_anon:191526 isolated_anon:96\n active_file:0 inactive_file:89 isolated_file:14\n unevictable:0 dirty:0 writeback:0 unstable:0\n free:24780 slab_reclaimable:104127 slab_unreclaimable:254279\n mapped:568 shmem:0 pagetables:3126 bounce:0\nNode 0 DMA free:15708kB min:120kB low:148kB high:180kB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:15304kB mlocked:0kB dirty:0kB writeback:0kB mapped:0kB shmem:0kB slab_reclaimable:0kB slab_unreclaimable:0kB kernel_stack:0kB pagetables:0kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? yes\nlowmem_reserve[]: 0 3512 8057 8057\nNode 0 DMA32 free:46668kB min:28512kB low:35640kB high:42768kB active_anon:1932080kB inactive_anon:535480kB active_file:20kB inactive_file:20kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:3596500kB mlocked:0kB dirty:0kB writeback:0kB mapped:16kB shmem:0kB slab_reclaimable:99508kB slab_unreclaimable:239868kB kernel_stack:0kB pagetables:4292kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:6 all_unreclaimable? no\nlowmem_reserve[]: 0 0 4545 4545\nNode 0 Normal free:36744kB min:36896kB low:46120kB high:55344kB active_anon:2017304kB inactive_anon:230624kB active_file:0kB inactive_file:336kB unevictable:0kB isolated(anon):384kB isolated(file):60kB present:4654080kB mlocked:0kB dirty:0kB writeback:0kB mapped:2256kB shmem:0kB slab_reclaimable:317000kB slab_unreclaimable:777248kB kernel_stack:1576kB pagetables:8212kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:288 all_unreclaimable? yes\nlowmem_reserve[]: 0 0 0 0\nNode 0 DMA: 3_4kB 2_8kB 0_16kB 2_32kB 2_64kB 1_128kB 0_256kB 0_512kB 1_1024kB 1_2048kB 3_4096kB = 15708kB\nNode 0 DMA32: 101_4kB 39_8kB 13_16kB 6_32kB 24_64kB 19_128kB 21_256kB 17_512kB 13_1024kB 3_2048kB 2_4096kB = 46812kB\nNode 0 Normal: 255_4kB 375_8kB 296_16kB 175_32kB 185_64kB 41_128kB 13_256kB 0_512kB 0_1024kB 1_2048kB 0*4096kB = 36820kB\n4066 total pagecache pages\n3867 pages in swap cache\nSwap cache stats: add 1033843, delete 1029976, find 256836/318424\nFree swap  = 0kB\nTotal swap = 524280kB\n2097151 pages RAM\n98424 pages reserved\n669 pages shared\n1969125 pages non-shared\n[ pid ]   uid  tgid total_vm      rss cpu oom_adj oom_score_adj name\n[  504]     0   504     2701        0   0     -17         -1000 udevd\n[ 1179]     0  1179    23283       20   0     -17         -1000 auditd\n[ 1201]     0  1201    62847       88   0       0             0 rsyslogd\n[ 1216]    81  1216     5358        1   3       0             0 dbus-daemon\n[ 1254]     0  1254     1020        0   0       0             0 acpid\n[ 1403]     0  1403    29215       22   0       0             0 crond\n[ 1917]    38  1917     7684       29   0       0             0 ntpd\n[ 2086]     0  2086    16556       14   1     -17         -1000 sshd\n[ 2150]     0  2150     1020        1   0       0             0 agetty\n[ 2152]     0  2152     1016        1   1       0             0 mingetty\n[ 2154]     0  2154     1016        1   2       0             0 mingetty\n[ 2156]     0  2156     1016        1   2       0             0 mingetty\n[ 2158]     0  2158     1016        1   2       0             0 mingetty\n[ 2160]     0  2160     1016        1   2       0             0 mingetty\n[ 2163]     0  2163     2700        0   1     -17         -1000 udevd\n[ 2164]     0  2164     1016        1   1       0             0 mingetty\n[ 2165]     0  2165     2700        0   1     -17         -1000 udevd\n[16360]     0 16360    25155       42   0       0             0 sshd\n[16362]     0 16362    27076       58   3       0             0 bash\n[16890]     0 16890     2835      154   0       0             0 epmd\n[16926]     0 16926     3227       19   0       0             0 run_erl\n[16929]     0 16929  1913736  1167660   1       0             0 beam.smp\n[17153]     0 17153     2698        2   0       0             0 inet_gethost\n[28360]     0 28360    88074     7391   0       0             0 iftop\nOut of memory: Kill process 16929 (beam.smp) score 580 or sacrifice child\nKilled process 16929, UID 0, (beam.smp) total-vm:7654944kB, anon-rss:4670604kB, file-rss:36kB\n__ratelimit: 146350 callbacks suppressed\nOut of socket memory\nOut of socket memory\nOut of socket memory\nOut of socket memory\nOut of socket memory\nOut of socket memory\nOut of socket memory\nOut of socket memory\nOut of socket memory\nOut of socket memory\n. [root@10-9-26-83 log]# sysctl -p\nnet.ipv4.ip_forward = 0\nnet.ipv4.conf.default.rp_filter = 1\nfs.file-max = 999999\nnet.core.somaxconn = 65000\nnet.core.rmem_max = 16777216\nnet.core.wmem_max = 16777216\nnet.core.rmem_default = 16777216\nnet.core.wmem_default = 16777216\nnet.core.optmem_max = 2048000\nnet.core.netdev_max_backlog = 50000\nnet.ipv4.tcp_rmem = 4096 4096 16777216\nnet.ipv4.tcp_wmem = 4096 4096 16777216\nnet.ipv4.tcp_max_syn_backlog = 30000\nnet.ipv4.tcp_max_tw_buckets = 2000000\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_fin_timeout = 10\nnet.ipv4.conf.all.send_redirects = 0\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv4.conf.all.accept_source_route = 0\nnet.ipv4.tcp_slow_start_after_idle = 0\nnet.ipv4.ip_local_port_range = 8000 65535\nnet.netfilter.nf_conntrack_max = 1000000\nnet.netfilter.nf_conntrack_tcp_timeout_time_wait = 30\nvm.min_free_kbytes = 65536\nvm.swappiness = 0\nvm.overcommit_memory = 1\n. [root@10-9-26-83 bin]# cat /proc/net/sockstat\nsockets: used 401816\nTCP: inuse 402047 orphan 279 tw 1 alloc 402048 mem 1807\nUDP: inuse 3 mem 1\nUDPLITE: inuse 0\nRAW: inuse 0\nFRAG: inuse 0 memory 0\n[root@10-9-26-83 bin]# cat /proc/net/sockstat\nsockets: used 51\nTCP: inuse 81981 orphan 81978 tw 127256 alloc 81982 mem 1\nUDP: inuse 3 mem 1\nUDPLITE: inuse 0\nRAW: inuse 0\nFRAG: inuse 0 memory 0\n[root@10-9-26-83 bin]# \n[root@10-9-26-83 bin]# \n[root@10-9-26-83 bin]# cat /proc/net/sockstat\nsockets: used 51\nTCP: inuse 39860 orphan 39857 tw 168721 alloc 39861 mem 1\nUDP: inuse 3 mem 1\nUDPLITE: inuse 0\nRAW: inuse 0\nFRAG: inuse 0 memory 0\n[root@10-9-26-83 bin]# cat /proc/net/sockstat\nsockets: used 51\nTCP: inuse 11956 orphan 11953 tw 195377 alloc 11957 mem 1\nUDP: inuse 3 mem 1\nUDPLITE: inuse 0\nRAW: inuse 0\nFRAG: inuse 0 memory 0\n. [root@10-9-26-83 bin]# cat /proc/net/sockstat\nsockets: used 401816\nTCP: inuse 402047 orphan 279 tw 1 alloc 402048 mem 1807\nUDP: inuse 3 mem 1\nUDPLITE: inuse 0\nRAW: inuse 0\nFRAG: inuse 0 memory 0\n[root@10-9-26-83 bin]# cat /proc/net/sockstat\nsockets: used 51\nTCP: inuse 81981 orphan 81978 tw 127256 alloc 81982 mem 1\nUDP: inuse 3 mem 1\nUDPLITE: inuse 0\nRAW: inuse 0\nFRAG: inuse 0 memory 0\n[root@10-9-26-83 bin]# \n[root@10-9-26-83 bin]# \n[root@10-9-26-83 bin]# cat /proc/net/sockstat\nsockets: used 51\nTCP: inuse 39860 orphan 39857 tw 168721 alloc 39861 mem 1\nUDP: inuse 3 mem 1\nUDPLITE: inuse 0\nRAW: inuse 0\nFRAG: inuse 0 memory 0\n[root@10-9-26-83 bin]# cat /proc/net/sockstat\nsockets: used 51\nTCP: inuse 11956 orphan 11953 tw 195377 alloc 11957 mem 1\nUDP: inuse 3 mem 1\nUDPLITE: inuse 0\nRAW: inuse 0\nFRAG: inuse 0 memory 0\n. rel/files/emqttd.config.production\nlager_console_backend, info},  ---- check here\n. ",
    "brangi": "Thanks, this helped.\n. +1\n. ",
    "kani-rifluxyss": "Trying to send large files (about 10 MB), is it okay to increase this value to more than 10 MB?\nmax_packet_size\nPlease advise.\n. ",
    "sufish": "@roytan883\uff0c in general MQTT protocol suggests to use Last Will Testament to do client presence management\n. @erylee when clients connect or disconnect normally , it can send a message to a specific topic to identify its state, and  Last Will Testament will do the same job when the client can't. it's great that emqtt will do  similar job from server side. but sometime additional information is needed from the client, like platform, software version. this is hard to do from server side\n. is this implemented in 0.9.0 alpha? as following entry in the change log\nFeature: Support to resume a persistent session on other clustered node.\n. General expiration for pesistented messages, like retained and QoS1,2, offline messages\n. ",
    "MrOnyancha": "Thanks for clearing the air about the same id problem, at-least i know how to handle it.\n. ",
    "terry-xiaoyu": "close this as it has been solved.. @indrajeet0510 Only once. Only on the node your publisher is connected on. . Nginx support proxy protocol v1, configs can be found from its doc website.. @rokka-n I think this issue has been fixed on emq 2.3.11. . Planned in EMQ 3.0. Which will probably be released in few months.. @arihantdaga Make sure you have set listener.tcp.external.proxy_protocol = on, and you've also turned on the proxy protocol feature of haproxy.\n. The cache TTL config is available in R3.0, namedacl_cache_ttl in etc/emqx.conf.. Using SSL? If so, you need a trusted certificate instead of the default self-singed certificate. See Websocket-Configs for details.\n. @maxshucn The hivemq demo uses a JS (mqttws31.js) in browser to access the MQTT broker, and thus it won't support self-signed ssl certificates by default - it depends on the trusted CA certificates installed in your browser.\nYou need a CA SSL certificate, and configure it in your emq.conf file.\nIf you just want to have a try with you self-signed certificate (there's already one configured in the emq.conf), try to install the cert in your browser by accessing 'https://xxxx:8084/mqtt', and then select 'continue' if any warning about security.\nThe mqttws31.js  uses the 'wss://' style to connect to the Broker, you could dive into the code if you want to know more.\n. @maxshucn Use the original self-sgined certificate come with EMQ, and do not modify the emq.conf. Then install the certs by accessing 'https://xxxx:8084' and click continue or 'always trust' when the address bar becomes red. This works fine for me.\nIf not, try the similar procedure with Chrome or other web browsers.. @Xirui Try to verify your FQDN using nslookup. . @rhwu How did you solve this problem? . @Xirui which EMQ version are you using?\nMake sure your firewall config has allowed the port 4369 for epmd, and also the port range 6369-6379 for erlang distribution.\nThe erlang distribution ports are configured in etc/emq.conf:\nnode.dist_listen_min = 6369\nnode.dist_listen_max = 6379\n. @Xirui Please check the firewall configures and make sure it also allows 6369-6379 of your public ip addr. \nConfigure TLS with EMQ will work but we recommend you setup a reverse proxy such as HAProxy or Nginx in front of EMQ, and config TLS only in the proxy.\n. @Xirui \nWhat's you problem now and what have you tried?\nAre you just trying to config TLS on 8883 for your MQTT clients? Or are you configuring the distributed erlang over TLS to setup a cluster across data-centers? In case of the former, changing node name to a FQDN is not necessary. You could use your private IP. In case of the latter, etc/ssl_dist.conf should be configured.\nYou can post your configurations and error logs here. It should not be that difficult.\n. @davorozo Not yet. We are planning to implement this in EMQ 3.0. . @turtleDeng  Hi turtle, I noticed that this might be the same issue I submitted at \n https://github.com/emqtt/emqttd/issues/1055\n The EMQ won't callback 'disconnected' plugins on 'kick' event.\n Could you have a check? . @xerosanyam The server side keep-alive negotiation has been implemented in MQTT 5.0.\nBut I don't have any idea for solving your problem as you are using mqtt 3.1.1. . Close as it is probably fixed in https://github.com/emqx/mongodb-erlang v3.0.7. the new flag new_sub_retain  is not necessary, as we're using headers = [retained] to mark the msgs was stored in the emq_retainer. . ### First for you questions:\n- Have I missed something and I can already do this somehow with EMQ as-is?\nA: You need to write your plugin. EMQ doesn't have a plugin fit your requirement out of box, but there're already some official plugins using redis, such as emqt-auth-redis, which can be an example for you.\n- If I write an EMQ plugin which picks up on topic messages and pushes them to Redis, will running this on every broker cause message duplication? We run a cluster (in k8s) of at least two brokers.\nA: No. Each client will connect to only one broker at a time, and only your plugin on that broker will be invoked upon a new event.\n- Is there some MQTT function/subscription type I've missed which allows me to have multiple subscribers to a channel but only deliver the message to exactly one of those subscribers?\nA: Yes, try shared-subscription\nMy suggestion\nI recommend you to try the 'plugin' method. EMQ is designed for massive IoT devices, not stream processing. Your subscribers under a heavy load can be bottleneck of the system, and the parse of MQTT packages would lead to extra overhead.\n. @rejji Hi, besides the etop to see the message queues and memory of the erlang processes, you could also use ./bin/emqttd_ctl sessions list to inspect the current sessions:\nshell\n$ ./bin/emqttd_ctl sessions list\nSession(test1, clean_sess=false, subscriptions=1, max_inflight=32, inflight=0, mqueue_len=3, mqueue_dropped=0, awaiting_rel=0, deliver_msg=1, enqueue_msg=3, created_at=1521516149)\nmqueue_len shows the current number of queued messages. And the inflight shows the number of messages not acked.\nBTW, currently the community version of EMQ only keeps message queues in memory, it won't save them to disk.\n. @dingzhengkai What were you doing at that time? Were you publishing a lot of messages to EMQ and decode them in your plugin? Decoding large messages such as JSON using NIFs might cause this kind of problem. \nOr your server was too busy at that time? The warning would also be reported if you run EMQ on a very busy server.\n. @promission Hi! Did 'U' connect to the broker with Clean Session set to true? And would 'U' auto-reconnect to the broker if the connection was down?\nIf so, and if for some reason the connection is down, you might lost all of your subscriptions after the connection is re-establish. You should subscribe the topics again.\n. @mshioz I think this problem is might caused by your subscribers - the WebSocket client. From your etop output, I can see that the EMQ is trying to send messages but it is blocked as the sending buffer is full.\nIf your receiver do not consume the messages from it's socket, the receiver's TCP buffer will be full, and eventually the sender's TCP buffer will also be full, and then the prim_send:send will get blocked.\nI suggest you inspect your subscribers.. @mshioz \n1. Changing the store_qos0 to false won't solve your problem. If Clean Session flag is set to true when a client is connected, EMQ will buffer \"offline messages\" into EMQ's message queue for that client if it is offline. Set store_qos0 to false let EMQ stop buffer the QoS0 offline messages. \nBut in your case, your subscriber is online, the messages have already sent to the subscriber, but it doesn't consume messages from the receiving buffer of TCP stack. The messages is buffered in the TCP stack's message buffer, and that causes more and more message being queued in the erlang mailbox of the sender. This's why your memory usage is increasing but it is not 'memory-leak'. \n\nNo there's not. No such config item or command line tool can help deal with the TCP stack's message buffer or the sender's erlang mailbox. If you just do not want the memory to increase anymore, stop the problematic subscriber.\n\n. Maybe your subscriber is blocked by an I/O event and can't read from the socket, but I am not sure about that. In linux you could inspect your connection status such as Recv-Q and Send-Q using netstat, but there seems no way to do the same thing in windows.\nThe last suggestion I can make is, trying to replace your subscriber with hive-webscoket-demo, to see if the issue remains. \n. @MyraBaba Yes, you can set the clean session = false, and tune the mqtt.mqueue.max_length in emq.conf. . @MyraBaba clean session is a flag in the CONNECT MQTT message. \nMQTT broker will buffer messages for every clients who have already subscribed your topics but stay offline, but not for the new subscribers of the topics. The message queues are created per ClientIDs.\nI don't think EMQ is a replacement of RabbitMQ, it has never tried to do that.\nMQTT is designed for IoT devices, in which scenario the count of connections would be massive, but the size of packages would be small. And the 3 level QoS are designed for unreliable networks.\n. @Oduig Hi, you could follow this guide to develop your own plugins: http://emqtt.io/docs/v2/plugins.html#plugin-development-guide\nPlease note the Build and Release the Plugin section.\n. @shrestha-clipapp \nHave you tuned your system using http://emqtt.io/docs/v2/tune.html# ?\nI don't know what happened without more info, could you provide a full \"log\" dir? \nIf you can reproduce that issue, try attach to the erlang shell using:\n./bin/emqttd attach\nand then run etop to see if there is a bottleneck:\n(emq@127.0.0.1)1> spawn(fun() -> etop:start([{interval,10}, {sort, msg_q}, {lines,20}]) end).\nuse etop:stop(). if you want to quit.\nyou could also check the status of ETS tables when the some issue occur:\n```\n(emq@127.0.0.1)3> ets:i().\n id              name              type  size   mem      owner\n\nac_tab          ac_tab            set   256    19027    application_controller\n clique_commands clique_commands   set   0      306      clique_manager\n clique_config   clique_config     set   33     2271     clique_manager\n...\n(emq@127.0.0.1)6> ets:info(mqtt_access_control).\n[{read_concurrency,true},\n {write_concurrency,false},\n {compressed,false},\n {memory,385},\n {owner,<0.1306.0>},\n {heir,none},\n {name,mqtt_access_control},\n {size,2},\n {node,'emq@127.0.0.1'},\n {named_table,true},\n {type,set},\n {keypos,1},\n {protection,protected}]\n```\nCtrl - D to quit the erlang shell.\n. @shrestha-clipapp \nFrom your last post:\n\nThings were running smoothly until I introduced another client which would be publishing 1 message to all the clients (checking if notifs were to be sent across at any given time). \n\nIf the connections are only dropped when you publishing the notification to all clients (about 250k), then I think this might be a issue in emqttd router:\nCurrently if a PUBLISH message (with a topic in mqtt header) comes, emqttd will fetch all of the subscribers of that topic in one search, which may need huge mount of memory if the number of subscribers is substantial. Erlang VM will try to do garbage collection in the current erlang process (the sender emqttd_client), but that would not be enough, so it increase the memory of that erlang process by allocating more and more memory to it. The GC and memory re-allocation are both time-consuming, which may lead to some other issues such as crashes some erlang process.\nI'm not sure your problem is caused by this issue, as I cannot find the Crash Logs of 'emqttd_access_control' process, but it is probably that the Erlang VM was too busy to print any logs at that time.\nI'll ask @huangdan to help reproduce this issue to verify my assumption.\n. @shrestha-clipapp Do you have some other logs in log dir? And do you have some crash.dump files ?  The crash.dump may be also in your log dir.\n. That's OK, it means your Erlang VM have not crashed. Are you using some customized plugins or pure EMQ for your testing? What authentication method are you using?. @shrestha-clipapp EMQ X 3.0 has been released and we've refactored the router. I think this issue has been fixed with it. \nWe'll add test cases for this.. Are you looking for a MQTT Chat Sepc with multiple platforms synchronizing messages? Then ASSChat might be what you want. An English version will come soon.\nThe only problem is, if you're using MQTT v3.1.1, publishing to a topic to which a client has subscribed will cause an extra message being sent to the client itself. But you can easily filter out that message by providing a message-id in the message body.\n. Yes it is designed for IM services, offline messages SHOULD be stored at server.\nI just get started on that project, the spec-design is about to finish. \nAnd I am planning to implement the ASSChat Spec in Erlang or Elixir, by creating plugins for EMQ.\nIn your case, you could let your clients of same user subscribe to a same Topic, like the method suggested in ASSChat.\n. Not planned. ASSChat is not a project in emqttd. You could post issues at that project.. @FartParty Hello Jeffrey! Could you post your ssl_dist.conf? I've verified that with CA depth 1, and it works as expected.\nI used the the following configuration in my test: \nin my etc/emq.conf:\nnode.proto_dist = inet_tls\nnode.ssl_dist_optfile = etc/ssl_dist.conf\nin my etc/ssl_dist.conf:\n[{server,\n  [{certfile, \"cert/ca/intermediate/certs/aerone.com.cn.cert.pem\"},\n   {keyfile, \"cert/ca/intermediate/private/aerone.com.cn.key.pem\"},\n   {cacertfile, \"cert/ca/intermediate/certs/ca-chain.cert.pem\"},\n   {verify, verify_peer},\n   {fail_if_no_peer_cert, true},\n   {secure_renegotiate, true},\n   {depth, 1}\n   ]},\n {client,\n  [{secure_renegotiate, true},\n   {certfile, \"cert/ca/intermediate/certs/client.cert.pem\"},\n   {keyfile, \"cert/ca/intermediate/private/client.key.pem\"},\n   {depth, 1},\n   {cacertfile, \"cert/ca/intermediate/certs/ca-chain.cert.pem\"}\n  ]}].\nMy CA chain: RootCA -> IntermediateCA\nThen I signed the aerone.com.cn.cert.pem (the cert at server side) and the client.cert.pem (the cert at client side) using the IntermediateCA. These two certificates are both have no passphrase.\nThe file 'cert/ca/intermediate/certs/ca-chain.cert.pem' contains both the CA certificates at following order: IntermediateCA, RootCA.\n. Good! It would be helpful to others if you could also post your nginx configurations here. Thanks!. @arihantdaga I believe what you want is auth, not acl. That is, you should configure the auth.mongo.auth_query.collection, not auth.mongo.acl_query.collection. See the doc here.\nAccess Control List (ACL) is only for denying/allowing PUBLISH/SUBSCRIBE a specific topic or a topic collection, and it has noting to do with the CONNECT.\nBTW, don't forget to change the mqtt.allow_anonymous to false in etc/emq.conf.\n. @arihantdaga Then have you checked the configuration of mqtt.allow_anonymous in etc/emq.conf ? Have you seen any error in you logs?\n. @qwyinxiang MQTT client don't support the authentication itself, it depends on the auth functionalities provided by the auth plugins (e.g. emq-auth-mysql).\nIf you're using EMQ broker, you MUST provided the the password along with the username in the MQTT CONNECT message. In your case the password should be the JWT.\nIf you have any problem with regards to the qmqtt, please open an issue at https://github.com/emqtt/qmqtt.\n. @gautaz @ahmadalli We'll update the image soon. Thanks !. I'll check this. Thanks. Hi, your path is not correct, use mqtt.connect('ws://127.0.0.1:8083/mqtt') instead.\nThe web-socket listen path will be able to configured in the future version, see https://github.com/emqtt/emqttd/pull/1537\n. @bhzhu203 Are you using a local proxy connecting to EMQ? If so, I think this might be caused by a short timeout value of the connection between the EMQ and your Proxy. Try to tuning such timeout configuration would help.. @bhzhu203 any update of this problem?. @bhzhu203 \nWhat's is the current throughput?\nHow many subscribers do you have? And what kind of topic the subscribers are subscribed to? . I think the I/O might be a bottleneck of EMQ. \nThe throughput is relatively low in multi-core system. My test result shows that the EMQ consumes about 110% CPU under a traffic of 4000 TPS, in a centos system with 8 cores / 8G MEM. \nIt is interesting that the same testing on a 1 core 2G MEM system only consumes about 30% CPU.\nI used 400 publishers send messages to 400 subscribers, each at a speed of 10 messages per second. The payload size is only 1 byte in my test.\nI also tried to inspect the lock contention using lcnt, it shows that there're lots of collisions in pollset_rm. I'm not sure that caused the problem though:\nfollowing result is collected under 10K TPS, \n(emq@127.0.0.1)39> lcnt:conflicts().\n            lock   id  #tries  #collisions  collisions [%]  time [us]  duration [%]\n           -----  --- ------- ------------ --------------- ---------- -------------\n      pollset_rm    1  456777        73056         15.9938    3454782       19.2976\n    drv_ev_state   16  849586        14508          1.7077    2438503       13.6209\n       run_queue   10 3536389        33629          0.9509     148472        0.8293\n       proc_main 4355 1648354            1          0.0001      42583        0.2379\n    db_hash_slot  576 1985625         1273          0.0641       6205        0.0347\n port_sched_lock 2019  549248           14          0.0025       1077        0.0060\n pollset_rm_list    1  205728          260          0.1264         89        0.0005\nWe're trying to improve the thought-put in next major version of EMQ.  We'll appreciate if you have any idea on this.. Yes I meant the network IO. But I am not sure that is the root cause. The clock contention in ETS tables could also causes the same issue.\nI think it isn't the fault of virtio as we've seen similar result on other systems.\nWe're trying to build EMQ 3.0 on top of OTP 21 to see if it brings some throughput improvement. . Please check your etc/emq.conf and make sure the 'mqtt.allow_anonymous' is set to false. \nIs Web UI your dashboard? If so you can use \"admin/public\" to login.\nhttp://emqtt.io/docs/v2/getstarted.html#web-dashboard\n. Thanks, if so I'll close this issue.. Close it as we don't support Chinese issues.\nBut for your question, check out our bench_mark report here:\nhttps://github.com/emqtt/emq-xmeter-en\nIf your concern is mostly on the throughput performance, then refer to throughput.rst .. Maybe all connections gone because of the emqttd is crashed? Do you have any erl_crash.dump in your log dir? Attach it here with all of your logs if you find one.\nCould you describe more about the problem? Such as your testing scenarios, how to reproduce (if you are able to), etc.. @chrizkiran \nMay I have your system info such as how many CPU cores, physical memory size, etc?\nEach of your publisher is publishing 8k messages/sec, to 25k subscribers? And you have total of 25k publishers which will do this one by one?\nTry to tune your system and EMQ using steps listed in: http://emqtt.io/docs/v2/tune.html#.\nIf you till have the same issue, compress and attach your entire log dir here.. Hi, do you have any clients subscribed the topic /a/b/c? Are the subscribers able to receive the messages your published via HTTP?\nIf no subscribers, the message will be marked asdropped.. It depends on your requirement. If you want update online status of your device, you could utilize the \"retain\" flag in the PUBLISH message header. \nhttps://www.hivemq.com/blog/mqtt-essentials-part-8-retained-messages\nBut that way only the last message will be retained. If you need to retain all of the messages, write your own plugins.\nhttp://emqtt.io/docs/v2/plugins.html#plugin-development-guide. Hi, I'll check this.. @arihantdaga Hi, may I have your configs? And your error logs?\nI repeated your testing procedure but it is OK. After I killed and restarted the mongod, I connected to EMQ again without any error.\nNote that the connection between EMQ and mongod won't be established before the first client comes.\n. It is probably your firewall settings. You should also allow port range 20000 - 21000.\nTry to stop your firewall to verify that problem.. @arihantdaga\nI'm sorry, the document is outdated. We'll update it soon.\nLook for the following configs in etc/emq.conf:\nnode.dist_listen_min = 6369\nnode.dist_listen_max = 6379\nThat's the range of distributed ports, so you should allow this port range: 6369 ~ 6379.\n. @victorclaessen Hi, I think you are right. mqtt.allow_anonymous need to allow empty username login or we should simply delete this configuration.. The authSource is not supported right now. \nFor now, you have to make sure the db of your Users/ACL collection is also the authentication database. In the README's example, use mqtt as the authentication database.\nWe're planning to support the Connection String URI Format, maybe in EMQ R3.0.\n. I'll check your configuration later, thanks.. Hook evens like message.delivered and session.unsubscribed are more like \"Notify and forget it\" than \"Request and Wait for Response\". It won't handle the reply of the hooked functions.\nI'm happy with this design for now, and I would use message.publish to suppress the delivery of PUBLISH messages.\n. You could use ACL to prevent a client from publish/subscribe to specific topics.\nOr you could filter only PUBLISH messages by hooking message.publish in your plugins. \nmessage.delivered will hook all of the MQTT message sent to the client, including the PUBACK and PING messages. I don't think you really want to stop theses kind of messages.. Use REST API of emqx to subscribe/unsubscribe topics for a client is the right approach. The related docs can be found here. @arihantdaga Sorry for late rely due to Labor Day. I'm investigating this issue.. Would this comment work for you ?. Your logs and configurations?. Hi, @GiviMAD \nWhat's the result of mongo command db.isMaster().hosts ? Is it same as what you've configured in auth.mongo.server ?. Mostly correct. \nThe client process is for handling the tcp connection for the client. And there will be one session process created for each client to maintain the state (e.g. the message queue, the expiry timer, etc.) of the client. \nIf ClientA sending a message with TopicC which is subscribed by ClientB, the message flow will be:\nClient process of ClientA   ----route(TopicC)--->   Session process of Client B   ----deliver--->   Client process of ClientB\n. @utkarshns\nI recommend you to go the latter way (the plugin). \nThe shared-subscription across the nodes in a cluster is not supported at present, but would be ready in the EMQ 3.0.\nIf you wrote a plugin, your callback functions would only be invoked on one node (the node on which the event occurs).\n. @utkarshns  Correct.. @utkarshns \nHi, the doc is here:\nhttp://emqtt.io/docs/v2/guide.html#acl\nStart with the simplest one using etc/acl.conf. I'm going to update the commits before the configs as following:\n```\n%% Allow user with username 'dashboard' to subscribe '$SYS/#'\n{allow, {user, \"dashboard\"}, subscribe, [\"$SYS/#\"]}.\n%% Allow clients from localhost to subscribe and publish to any topics\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", \"#\"]}.\n%% Deny clients to subscribe topics which matches '$SYS/#' and the topic exactly equals to '#'. But this doesn't deny topics such as 'abc' or 'abc/d'\n{deny, all, subscribe, [\"$SYS/#\", {eq, \"#\"}]}.\n%% Allow all by default\n{allow, all}.\n```\nACL via databases such as mysql and mongodb should be similar.\nYou'd better to test your ideas for better understanding. You could use HiveMQ's WebSocket Client to do that.\n. @gmatt76 Do you have the erl_crash.dump file? I would be in your log dir of EMQ.. @gmatt76 Hi, how many EMQ nodes are you running? Maybe the CPU usage was too high so that your system killed that EMQ or the container?\n. Hi, I want to know more about your benchmark so I can reproduce it and find the bottleneck myself.\nDo you have a load balancer in front of your cluster? And how about the load weight on each node? Or you forwarded all the load to only one of the nodes?\nAnd the pub/sub model: Does your client connect to the broker, and then subscribe its topic, then publish a message to that topic(thus sent to itself), and then disconnect?\nWhat about the payload size?\nDid you setup the clients in the same subnet as the cluster? If not, what's your system's bandwidth?\nIf you're using tsung or emqtt_benchmark, could you post your test configs/options here?\n. On the node which consumes the most memory,\nTry to inspect the vm memory usage by:\n./bin/emqttd_ctl vm all\nAnd you could also inspect the status of the broker by:\n./bin/emqttd_ctl broker stats\n./bin/emqttd_ctl sessions list\nSince I suspect the memory is probably hold by an erlang process, I suggest you attach into erlang shell by:\n./bin/emqttd attach\nand then inspect the process status while your test is running using:\n(emq@127.0.0.1)3> spawn(fun() -> etop:start([{output, text}, {interval, 1}, {lines, 20}, {sort, memory}]) end).\nCtl+D to quit.\n. This seems to be an log with wrong log level. I'll change it to info.\nIf a client connect to the broker with CleanSession = true, and then another client connects with the same client-id as the former but using CleanSession = false, the session will be resumed, and the CleanSession flag will be changed to false.\nhttp://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc385349231\n. It is not safe if your requirement is to stop all the connections in case of netsplit. You could test this scenario yourself to know better about how EMQ works. . Hi,\nHAProxy won't realize the net split between EMQ nodes, so it's hard to stop it from delivering messages to the \"island node\". \nIt's complicated to choose a right subset of nodes and make them continue working, while shutdown other nodes. There's no plan to support this feature, and I'm very glad to listen your idea about this.\n. @bharat-mehta hi, the message delivery in Fastlane subscriptions should be much more efficient than the normal ones, although I have not got the benchmarks comparing of the two. \nThis is because, in contrast to the normal subscriptions, if a target client has subscribed to a \"$fastlane\" prefixed topic, the source client process would deliver the message to the target client process directly without having to go through the session process. \nWhere the \"process\" talked above is \"erlang process\". The client processes are to handle the TCP sockets of the clients, while the session process is for maintaining the message queues and subscription states. The erlang message passing would be a significant overhead under a high load.\nBut it thus loses all features the 'session process' provides, i.e. message queues, QoS1 and QoS2 related procedures. So it is mainly used for QoS0.\n. No other limitations. \nAnd yes, good for backend subscription, but use plugins with hook callbacks is a more efficient way.. hi, are you able to connect to your redis server by redis-cli -h xxx.0.0.1 -p 6379 -n 2?. Hi, I am sorry to inform you that configuration via dashboard is not a mature feature, and the implementation would be changed in the future versions. Please use the config files instead.\nWe (The EMQX Enterprise Team) is working on a new dashboard which is flexible and easy to use.\nIssues of community version of EMQ is supported here, and all questions about EMQX could get help from the EMQX's contact person directly.. Hi, shared subscription across nodes is currently not supported. It'll be supported in EMQ 3.0, which will come soon.. Could you post your EMQ error logs here?. Upgrade your EMQ to 2.3.7 would fix this issue.. https://github.com/emqtt/emqttd/pull/1567\nEMQ should have printed the connection lost in your case, either shutdown for normal or for an error.. What is the EMQ version you're using?. Thanks for your effort investigating this issue. We'll check this. . @hui6075 \nUnfortunately it is hard to do that...\nIt was a design fault in the EMQ's router, which messages are dispatched to all of the nodes before retrieving the subscribers of the topic. Due to this, it is very hard to stop messages for shared topics been handled multiple times, and thus it's hard to implement shared subscription across nodes.\nThis issue is not easy to fix, because the router mixed the implementation of shared subscriptions with the normal ones. We need to refactor the code in EMQ 3.0.\nIf what you want to do is collecting data from EMQ and handling data in your backends, you should  write your plugins, and handle the message.publish event. That's because encoding and sending the MQTT messages would be an extra overhead you may want to avoid.\n. Of course you can. \nFor the JWT configurations please read the README here. And this for ACL configuration via Redis.\nThe JWT should be straight forward.\nRedis ACL example:\n```\nthis will setup ACL using the result of redis cmd 'HGETALL mqtt_acl:'\nwhere  is the username field got from the CONNECT MQTT message.\nauth.redis.acl_cmd = HGETALL mqtt_acl:%u\n```\nIn your emq.conf:\nmqtt.acl_nomatch = deny\nAnd put following ACL entries to your redis:\n```\nACL entries are Hash tables with following format:\n \nwhere <acl_type> is of integer values:  1 - subscribe, 2 - publish, 3 - pubsub\nHSET  mqtt_acl:shawn   topic1     1\nHSET  mqtt_acl:xiaoyu   topic2     2\n```\nWith above configuration and ACL entries in redis, all clients with username = \"shawn\" will be allowed to subscribe the topic = 'topic1', and all clients with username = \"xiaoyu\" will be allowed to publish to topic \"topic2\". All other combinations will be denied as we have set the mqtt.acl_nomatch to deny. \nHope this helps.\n. No private claims. Make sure the secret are correct. And test your token via JWT verifier. If it doesn't work, you could post your logs and I'll look at it.\n. No caching mechanism. EMQ queries redis every time it needs the ACL configurations.. @arihantdaga Yes, the super user is allowed to sub/pub to any topic. I think this user is useful for testing.. You should setup a reverse proxy in frond of EMQ nodes such as nginx or haproxy. . It is designed to this intentionally for tracking all the connection requests. Verify the value of 'connack' and only update your database if it equals 0. . The EMQ - LwM2M plugin is not ready for now. So it is not showed in the plugin list. \nWe're working on the development.\n. To restrict clientId of a specific username, the easiest way is to change emq_auth_redis.erl#L43 to make it also verifies your clientid.\nTo try EMQX, you could contact @zhengyupan \n. How did you find the drop? Via EMQ dashboard? . You published a MQTT message but it was not delivered to the subscribers? If that is the case, turn on the debug level log, and check the message ID which was dropped.. You could get the entire message flow between EMQ and your devices, e.g. subscribe, suback, publish, puback, etc. And you could then check if the message have been delivered to your device, if you know the message id of the \"dropped\" message.\nYou should use QoS1 or QoS2 if you are concern about the delivery quality. . I meant the application specific message id in your payload, not the MQTT message id. You might have set an identity of the message, for example:\n{\"id\": 123, msg: \"hello?\", \"ts\": 1527073691}\nTo set the log level to debug, change the following lines in etc/emq.conf and restart the EMQ:\nlog.console = file\nlog.console.level = debug\nTo learn more about MQTT: https://www.hivemq.com/mqtt-essentials/\nAn example of the debug logs of EMQ, in this example client with client-id 'clientId-iMRmRqblTx' subscribes a topic 'testtopic/#', and then it sends a publish message to topic 'testtopic/1':\n```\n19:15:38.453 [debug] Client(clientId-iMRmRqblTx@127.0.0.1:50899): RECV PUBLISH(Q1, R0, D0, Topic=testtopic/1, PacketId=1, Payload=<<\"hello\">>)\n19:15:38.453 [debug] clientId-iMRmRqblTx/undefined PUBLISH to testtopic/1: <<\"hello\">>\n19:15:38.453 [debug] Client(clientId-iMRmRqblTx@127.0.0.1:50899): SEND PUBACK(Q0, R0, D0, PacketId=1)\n19:15:38.453 [debug] Client(clientId-iMRmRqblTx@127.0.0.1:50899): SEND PUBLISH(Q1, R0, D0, Topic=testtopic/1, PacketId=1, Payload=<<\"hello\">>)\n19:15:38.457 [debug] Client(clientId-iMRmRqblTx@127.0.0.1:50899): RECV PUBACK(Q0, R0, D0, PacketId=1)\n```\nThe 'SEND' means EMQ have sent the message to the device, while 'RECV' means EMQ have received a message from the device. 'Q1' stands for QoS1.\n. We're going to maintain a docker hub in the future, but not for now.\nThe doc is guiding you to download and run a image directly, while the readme doc is for building the image by yourself. . We'll maintain a docker hub from EMQ 3.0. . \n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", \"#\"]}. %% for local pub/sub.\n{allow, all, subscribe, [\"/abc/def/+\"]}. %% for all topics matched to \"/abc/def/+\", the subscription is allowed and the ACL processing stops here.\n{deny, all, subscribe, [\"/abc/#\"]}. %% \"/abc/#\" is a super set of \"/abc/+/def\", so we only need to deny \"/abc/#\"\n{deny, all}. %% allowing or denying other topics is up to you\nTry it yourself and tune your ACL. It is more like tuning a regular expression string before using it.\nBTW, using topics prefixed with '/' is not recommended. \n. Write your own plugin then. You could start with emq-plugin-template, and take auth-mysql for example. \nIgnore the auth files as you may only need ACL.\n. Close it now and reopen it if you still have any questions.. There might be a behavior difference when handling the \"duplicated subscription\" between these brokers.\nIn EMQ, if a client tries to subscribe a topic to which it has already subscribed, the subscription request will be discarded, as it is treated as 'duplicated subscription'. In this case a warning level log will be printed: \n[warning] Session(client1): Duplicated subscribe: test/777, qos = 1\nAnd because you have set the clean session flag, the subscriptions of client1 (the 'test/777') have been stored in the broker. All the subsequent subscribes to 'test/777' will be regarded as 'duplicated', including the ones it sends after the connection has been established.\n. @DavidLiuXh @krittanon-w Hi, we're planing to fix this issue in 2.3.10.\n. Hi, I used emq 2.3.9, and the emq_auth_username worked as expected in my testing.\n```\n$ ./bin/emqttd_ctl plugins load emq_auth_username\n$ ./bin/emqttd_ctl users add 'feng@emqtt.io' '123456'\n$ ./bin/emqttd_ctl users add 'shawn' '123456'\n$ ./bin/emqttd_ctl users list\n  feng@emqtt.io\n  shawn\n```\nMake sure you've disabled the mqtt.allow_anonymous in etc/emq.conf.\nThe users you created shall be stored permanently on disk, usually under 'data' dir of the EMQ's installation path.\n. @dedupely \nHi, For your specific requirement, you need to design your own topic format for receiving updates, let's say 'profiles/100'. Then you let John subscribes to 'profiles/100' after he has connected, and let your publisher publishes to 'profiles/100'.\nYou can try your ideas by connecting to EMQ via HiveMQ-Websocket-Client. \nThat web-socket client uses mqtt31.js, and the parameters for connection are just as what @utkarshns said.\n. Don't do that. If you want to block these ports, configure your firewall rules instead.. Currently we don't want to support this in the emqx.conf, but you can kill the epmd process if you are using a single-node emq:\n```\nps -ef | grep epmd\nroot      6636     1  0 Nov25 ?        00:00:00 /root/emqx/_rel/emqx/erts-10.1/bin/epmd -daemon\nroot     24221 20553  0 10:39 pts/0    00:00:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn epmd\n```\nOr you could start the epmd manually with -address:\n```\n/root/emqx/_rel/emqx/erts-10.1/bin/epmd -h\nusage: epmd [-d|-debug] [DbgExtra...] [-address List]\n            [-port No] [-daemon] [-relaxed_command_check]\n       epmd [-d|-debug] [-port No] [-names|-kill|-stop name]\nSee the Erlang epmd manual page for info about the usage.\nRegular options\n    -address List\n        Let epmd listen only on the comma-separated list of IP\n        addresses (and on the loopback interface).\n    -port No\n        Let epmd listen to another port than default 4369\n```. No, as in MQTT 3.1.1 specification we can't set an error code in the PUBACK. \nAn error log will be printed in this case.. open a new one if you still have any questions.. There's no built-in support for such kind of requirement.\nDo the counting in your own plugin. You could learn how to write one by following this guide.\n. Close this for now, you could open a new issue if needed.. Have you tuned your system configurations? http://emqtt.io/docs/v2/tune.html. Your EMQ is running on centos7 not a windows 10, right? \nCould be the 'net.core.somaxconn' setting? Try to slow down the connecting speed of the client, and enlarge the MEM of your system.  Our recent testing result shows 1G can support 20K concurrent connections.\n. @utkarshns hi, I don't think it is an option to 'handover' the TCP connections to the broker as HA works as an L4 reverse proxy.\nBTW, you could use Proxy Protocol to avoid the real client size IP being hidden by the proxy.\n@archerian Although server-side load balancing is the recommended method, you would also benefit from the 'client-side' load balancing, because in this way you're able to control which group of users connect to which node. This reduces the internal message passing between the nodes if the groups are well designed, but with the drawback of a more complicated client side logics. \nSo it depends, if you just want to make things done the simplest way, use server side proxy. Otherwise go for the client side load balancing.\n. Hi, would you set the log level to 'debug' and check the logs?. Try to remove the dir '/home/YANGHAO/emqttd-relx/deps/goldrush' and try again. \nIf that doesn't work, try to remove the dir '.erlang.mk' and then make distclean && make. \nHope it helps.. Looks good! \nAnother solution I've thought of is to verify the status code in the auth-plugins, and if it is an server side error (i.e. 5xx), throw out an exception 'internal_server_error'. All plugins such as mysql and mongo auth plugins can also follow the same way.\n. EMQ currently not supports hot reload, you could systemctl stop emqttd.service && systemctl start emqttd.service as a workaround.\n. You've configured your plugin in the configuration files (etc/plugins/) but it lost after the booting?. gen_rpc has been used in the enterprise version of EMQ. \ud83d\ude42. Dup of issue https://github.com/emqtt/emqttd/issues/913. It should be received. Please change the log level of EMQ to debug and check.. In your Makefile of emq_auth_redis, add a line for rabbitmq-erlang-client:\ndep_rabbitmq-erlang-client = git https://github.com/rabbitmq/rabbitmq-erlang-client v3.7.5\nAnd you need also to config your relx.config for rabbitmq-erlang-client.\nHope that helps.. You don't need the auth right? Then try to comment out the auth.mysql.auth_query config line in etc/plugins/emq_auth_mysql.conf, this will disable the auth functionality.\n. @rjbaat \nHi, this doc needs to be updated.\nLike this:\nkey | annotation\n-- | --\nclean_sess | clean sess flag. false: persistent, true: transient\nsubscriptions| The number of subscriptions on this session\nmax_inflight | Inflight window (Max number of messages delivering)\ninflight | Current inflight queue size\nmqueue_len | Current message queue size\nmessage_dropped | Number of messages dropped for queue is full\nawaiting_rel | The number of QoS2 messages received and waiting for PUBREL\ndeliver_msg | The number of messages delivered to the client\nenqueue_msg | The number of messages the session has tried to enqueue\ncreated_at | Timestamp when the session is created\nThe session status the dashboard shows is the same as the result of emqttd_ctl sessions list command.\n. Hi, I'm looking at this issue.\nDo you have any erl_crash.dump file in your logs dir? \nCould you attach the etc/emq.conf and all the log files in logs dir?. Hi, this might be caused by timeout when querying your mongodb. Did you see the same problem again?. Is is probably your mysql. \nWould you check which process has the highest I/O usage? Using iotop for example.\n. I'm not sure what file emqttd is writing. \nYou could get the PID of emq (the beam process), then use lsof -p $PID to see all the files opened (only pay attention on the regular files). And then check the increasing speed of those files.\nMost likely it is the log dir or the data/mnesia dir.\n. you could reopen this if you still have questions.. Have you tested and found that the QoS2/QoS1 not working when 2 clients connect to 2 nodes separately? It should work.\nIn case of node failure, if the session is stored on the failure one, the inflight messages will lost. \nBut replicated session means more complicated procedures in a distributed environment, and is not easy to scale, so it is a trade-off not replicating the sessions.\n. You could reopen this if you still have questions.. This configuration is deprecated and about to be removed. It is not used in the current version.\nDid you mean you were not able to receive messages from the other node? You could check the connectivity using ./bin/emqttd_ctl cluster status. And change the log level to 'debug' to see the detailed info.\n. you could reopen this if you still have questions.. It is the fault of EMQ's keep-alive mechanism. \nIt doesn't restart a new timer when a mqtt control packet comes. Instead, it starts a timer when the client connected,  and check if there're any new bytes came on the current connection after the timer expires.\nhttp://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Keep_Alive. We decided not to fix this as the solutions for a accurate keep-alive interval may have some potential performance impact.. The mqtt:api port defaults to 8080. You can't start the api port because someone else has already listened on it, right ?\nYou could change the configuration and restart the emq for now, I'll look at the emqttd_ctl listeners restart problem.\n```\nDefault: 0.0.0.0:8080\nlistener.api.mgmt = 0.0.0.0:8099\n``. I'd like to keep the existing code for now.. @acodercat Hi, when you sayingACL, do you mean the Access Control on the topics? I don't think we can configure the ACL via dashboard. . outdated. Did you install the erlang OTP from source? Then check the output of./configure, make sure the openssl libs can be found by the building process.. Could you check if the path/usr/local/opt/openssl/` exits on your Mac? \nInstall the openssl and create links to /usr/local/opt/openssl/ if it does not exist. Hope it works.. shell\n\u279c  ls /usr/local/opt/openssl/\nCHANGES              LICENSE              README               include              share\nINSTALL_RECEIPT.json NEWS                 bin                  lib. @ice2hu May I know your system info (Number of CPU cores, and how large is your MEM)? And the CPU usage when the error occurs?\nYou could follow this guide to tune your system.\nThe error says it cannot handle the incoming connections, i.e. the clients are connecting too fast.\n. updated some test cases . This quick-fix may be good for your private fork, but for the main branch, I'd like to keep the existing code, as the shared-subscription mechanism has been refactored in EMQ X 3.0.\n. > I want to authenticate the client using the clientid , username , password using mySql database.\nright now the client is authenticating successfully with the username and password but It is not\ntaking care of the clientId , but i want to restrict the mqtt client to be connected only when the\nusername , clientid and password is same.\nYou should config the auth.mysql.auth_query in etc/plugins/emqx_auth_mysql.conf to select auth entries only when username and client_id are both matched, for example:\nauth.mysql.auth_query = select password from mqtt_user where username = '%u' and client_id = '%c' limit 1.\nAlso make sure you have the column client_id in table mqtt_user, you can create your table as following:\nuse mqtt;\nCREATE TABLE `mqtt_user` (\n    `id` int(11) unsigned NOT NULL AUTO_INCREMENT,\n    `username` varchar(100) DEFAULT NULL,\n    `client_id` varchar(100) DEFAULT NULL,\n    `password` varchar(100) DEFAULT NULL,\n    `salt` varchar(100) DEFAULT NULL,\n    `is_superuser` tinyint(1) DEFAULT 0,\n    `created` datetime DEFAULT NULL,\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `mqtt_username` (`username`)\n    ) ENGINE=MyISAM DEFAULT CHARSET=utf8;\n\nI want to restrict the mqtt clinet to publish and subscribe the topic according to the database\ntopic. The mqtt client should not be able to publish and subscribe the other topic then of the\ndatabase.\n\n\n\nKeep your acl.conf as clean as possible, as we're using mysql:\n{allow, {user, \"dashboard\"}, subscribe, [\"$SYS/#\"]}.\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", {eq, \"#\"}]}.\n{deny, all, subscribe, [\"$SYS/#\", {eq, \"#\"}]}.\n{deny, all}.\n\n\nYou should set acl_nomatch in emq.conf to deny in your case:\nallow_anonymous = false\nacl_nomatch = deny\n\n\nFor the data in mqtt_acl your table posted above is OK.\n\n\n. will be merged in other PR. Fixed by: https://github.com/emqx/emqx/pull/1814. Need to consider more about the procedure. . @nerdial, Hi As @spring2maz explained, the MQTT protocol does not support it. . @jidushan Message persistence feature is covered in EMQ X Enterprise. It supports persisting messages in to different backends, such as MySQL, PgSQL, MongoDB, Redis, etc.\nThe topic filter for persistence is configurable in in the plugins. . @phper-chen The $shared prefix works with EMQ 2.x, but it only has the random balancing policy. And the shared subscription feature only works on single-node of emq with 2.x. \nSo if you are using a single-node emq, and the random policy also satisfies you, then everything will be OK. If you do really want use the feature on a emq cluster, there's also a trick available by combining the $local and $shared topic prefixes. . Other changes will come soon. I created the PR early to discuss the config template with you.. What topics are the subscribers subscribing to? And what topics the publishers sent to? How many subscribers and publishers do you have? And what about the publishing speed?\nBTW, try to set mqtt.cache_acl = false if you don't use ACL plugins. \n. @NewBorn25 Could you post more detailed logs and your configurations here? . Could you post the emq logs here, when the HTTP response is 500 ?. Remove the double quotation marks and try again, like this:\n```\nMysql Username\nauth.mysql.username = root\nMysql Password\nauth.mysql.password = emqtt\nMysql Database\nauth.mysql.database = mqtt_test\n``\n. If you are considering choose a appropriate system config, 32 CPU and 16G memory is enough. The size of memory is related to the number of concurrent connections you have.. 16G memory can support 1 million concurrent connections.. @boboxiaodd When do you want the client gotbad user name or password? The current implementation only returnsnot authorized`.. Don't Merge Now!\nChanging primary logger level to all has some CPU overhead.. - The primary log level should not be changed in the tracer. Or it will cause some unexpected behaviors when the user try to modify the primary log level.\n\nThe primary log level should be set to the value defined in log.level. It must not be set to all because it will lead to a performance issue.\n\nI will close this PR and create another, adding a level option to the trace CLI. We also need CLIs for modifying the log level at runtime, especially the primary log level.. To ensure the back pressure enabled by default, I don't want to merge this PR.\nWe need to warn users in our docs about this default behavior, and show the related emqx configurations in our benchmark reports.\n. Ha, not strange.\n```\nValue: cn | en | crt\nlistener.ssl.external.peer_cert_as_username = cn\n```\nThis only let you use cn as username of your clients, but you still need a plugin to validate the username in auth plugins.\nEMQ doesn't maintain any client information, your databases such as pgsql does. \nIf the only thing you'd like to do is validating the client certificate, set EMQX_ALLOW_ANONYMOUS=true . Yes, use https://github.com/emqx/emqx-auth-username. \n. @phper-chen  Your Wechat ID?. Close this PR, I'll add an extra vm.args file instead.. Close this PR as @emqplus is working on refactoring the broker.. Hi, @cjmNo1 \nMay I know more about your pub/sub scenario?\nIf you are consuming messages from a single subscriber, you could use shared subscription. \nIf you are publishing lots of messages with different topic, you may need to change the acl_cache to false in emq.conf.\nBR,\n//Shawn. Set up a test environment and try your scenario that is similar to your production environment. Then I would help you investigate the problem if you could give me the permission accessing your test servers.\nI guess it might be caused by the single subscription or acl_cache mentioned in my last response. \nBTW, we only support English issues on githhub.. @xiou1990 Hi, you could change the permission of that file(or dir) and add the tracer again. This is because lager doesn't verified the access permission before adding a new log handler. But I don't want to fix it on emqx 2.x.\nI've verified it on emqx 3.0.1 and it works well, the CLI fails with an eacces error in case of access failure. Thanks for your feedback. :-). @rahulwinzo Hi, could you describe your pub/sub scenarios? i.e. How many publishers, subscribers do you have, what are the topics the subscribers and the publishers are using, and also the publish speed.\n. @rahulwinzo \n\n\nDo you have any topics that has many subscribers? e.g. is there a topic 'a/#' that all of your clients subscribe to it, and then a publisher send messages to all the clients via this topic.\nOr do you have a backend service subscribes to a single topic that all of the clients publish to?\n\n\nDo you keep the log level as error?\n\n\nAre your clients connected to EMQ via TLS or via a proxy?\n. @rahulwinzo Then it might be the common topic, I think the CPU is so high because messages from everyone are sent to all others frequently. If one send a message to the common topic, the broker will forward it to 10K clients, which causes the high CPU usage.. Not sure if is the problem of cluster mode. You could attach into the Erlang shell by emqx_ctl attach, and then look for the top busy processes by recon:proc_count(message_queue_len, 20).  \n\n\nDon't Ctrl-C in Erlang shell! Use Ctrl-D instead.. Sorry, it is emqx attach. @s4kibs4mi Don't start elixir logger in emqx, as it may delete/modify the erlang logger handlers. \nIn your elixir plugin, use :logger instead.\nFor example:\n```elixir\n    def on_message_publish(message, _env) do\n        #IO.inspect([\"elixir on_message_publish\", message])\n    # add your elixir code here\n    :logger.error(\"----- publish message!!!\")\n\n    {:ok, message}\nend\n\n``. @Zhang-Xianglong Try to setmqtt.cache_acl = false` in emq.conf, as acl cache won't be cleared before emq 3.0.\nIf you are using TLS, you can setup a haproxy in front of your emq. . You are probably trying to connect to 1883 (the tcp port) of EMQ using websocket?. It has been be fixed, thanks. Checkout the code from tag 2.3.11.. @wigginskuang Make sure you have emq_zdc.config in _rel/emqx/etc/plugins/, it is copied from deps/emq_zdc/etc/emq_zdc.config when building the project.. @sbcsuman You might have already started an emqx instance, or there's another process is using the tcp port that emqx required.  They are:\n```\nemqx will occupy these port:\n- 1883 port for MQTT\n- 8883 port for MQTT(SSL)\n- 8083 for WebSocket/HTTP\n- 8084 for WSS/HTTPS\n- 8080 for mgmt API\n- 18083 for dashboard\n- 4369 for port mapping\n- 5369 for gen_rpc port mapping\n- 6369 for distributed node\n``. @Marc-drouet it won't. your user records will be stored into disk db files which is in your emqx data path, mostly it is/var/lib/emqx/mnesia/` if you are using emqx for ubuntu.\n. @sbcsuman I guess you have solved the problem. Reopen this if you want.. May have solved. :-). @sriuppu \nACL caching is enable by default, assume you are using emqx 3.0, the related configurations are (in emqx.conf):\n```\nWhether to enable ACL cache.\n\nIf enabled, ACLs roles for each client will be cached in the memory\n\nValue: on | off\nenable_acl_cache = on\nThe maximum count of ACL entries can be cached for a client.\n\nValue: Integer greater than 0\nDefault: 32\nacl_cache_max_size = 32\nThe time after which an ACL cache entry will be deleted\n\nValue: Duration\nDefault: 1 minute\nacl_cache_ttl = 1m\nThe action when acl check reject current operation\n\nValue: ignore | disconnect\nDefault: ignore\nacl_deny_action = ignore\n```\nACL access result is cached per connection, this means that it is cleaned after the client is disconnected.\nACL cache is stored in the form of {PubOrSub, Topic} => {AllowOrDeny, Timestamp}. For details see https://github.com/emqx/emqx/pull/1744\nThe acl_cache_ttl is the time after which the cache entry will be deleted, if no subsequently access to that cache entry during this time. Change it to a larger value as you wish.. @sriuppu EMQ doesn't support this kind of ACL caching, and we currently have no plan to change the caching mechanism to this.. @Orange637 \nI think this is because of incorrect emqx_bridge_kafka configurations. Could you post your emqx_bridge_kafka.conf here?\n. @xiangjiangnan Hi, please check if you have any typos about IP addresses in your configuration file of mysql auth plugin.. Could you post the content of your emq_auth_pgsql.conf here?. @PiedPieper The bridge feature is not only for bridge to aws, it can bridge to any IoT hub, mqtt broker or even to another emq.  The word aws or asure here is only a name and can be replaced by any thing you like. \nPSK is really a new feature of emq, actually I wrote it just one day ago and it will be included in emqx v3.1-beta2. I am glad that you've noticed it so quickly. But we have not complete the psk client side of the bridge. The bridge.aws.psk_ciphers is there for configuring psk-related ciphers when bridging to a remote broker, but we still need to add two more configurations to configured the psk-id and the client-side psk.\nThe server side is ready. You could enable PSK authentication by enabling psk_ciphers (e.g. listener.ssl.external.psk_ciphers) and loading the emqx-psk-file plugin. pskid-psk pairs can be configured in etc/psk.txt.\nTest the connection using pskid = client1 and psk = 1234:\nopenssl s_client -cipher 'PSK-AES128-CBC-SHA' -connect 127.0.0.1:8883 -psk_identity 'client1' -psk 31323334\n. no_ack | {pid(), reference()} ?. Would erlang:is_process_alive/1 (local node) more expensive than calls to ets ?. Change maps:get('Authentication-Method', Properties, ?NO_AUTH_METHOD) to auth_method(Properties). Change maps:get('Authentication-Data', Properties, ?NO_AUTH_DATA) to auth_data(Properties). I think this kind of if clauses could be optimized by function clauses.. Shall we change this to shared_dispatch_ack = no_ack() :: no_ack | {pid(), reference()} ?. Why only cancel the stored will message when Session Present == true? I think we need to \"try to\" delete the stored will message upon client connected, no matter if there is an existing session.\n. Wrap this block of code (295 ~ 304) into a function, e.g. \nmake_will_msg(PState) ->\n   .... deleted. deleted. For me, it is convenient to set an extra log file that contains logs with severity level higher than 'error', as it helps me to find all the errors quickly, when the main log level is set to 'debug'.\nI commented this config out so there will no extra log files by default.. I copied this from the examples of erlang-doc... I think the value no_repeat is a good choice.\n\nfilesync_repeat_interval\nThis value, in milliseconds, specifies how often the handler does a disk_log sync operation to write buffered data to disk. The handler attempts the operation repeatedly, but only performs a new sync if something has actually been logged.\nDefaults to 5000 milliseconds.\nIf no_repeat is set as value, the repeated sync operation is disabled. The user can also call the filesync/1 function to perform a disk_log sync.\n. Yes, I'll fix this.. I'll fix this.. OK.. Agree. But this whole file is copied from OTP lib/kernel/src/logger_formatter.erl maily for new date format, and I'd like to keep most of the file untouched.. string:length([\"B1\",\"A\"]) returns 3, I think this code is correct.. What this macro does is putting a module-related header into the generated code. So the macro is defined as LOG(Level, Format, Args) to hide this magic. \n\n. Good idea but hard to do that.. This callback is mainly for the trace/2 in emqx_protocol, which called emqx_packet:format/1 to pretty the packet before logging the message. . I think the macro ?LOG(debug, Format, Args) will be expanded to logger:debug(Format, Args) at compile time. Then should we add ?INFO, ?WRNING... ?. Good, I'll change it.. I'll fix this. \ud83d\ude06. Will this ReasonCodes be filled by some value or it is always undefined when mqtt version < 5 ?. http://erlang.org/doc/apps/kernel/logger_chapter.html#overview. e.g. acl_deny = disconnect. Remove this comment. if acl_deny == disconnect \n    disconnect(Reason)\nelse \n    ...\nend.. I don't think the this will disconnect your mqtt client. Have a test and make sure the connection is disconnected.. Disconnect when ACL denied. I suggest delete this clause as there should be no '{share, x, x }' in emqx_subscriber table.. Disable this configuration by default for backward compatibility.. Remove the extra space character.\ni.e. when acl denied instead of when  acl denied. Why return OK on ?RC_TOPIC_ALIAS_INVALID ?. Align this case clause.. false -> {ignore, PState}. Don't change this. Let the connection down on other reason.. Print a WARNING here, \"Cannot publish qos1 message to ~s for ~s\". Rename function name to acl_should_disconnect(). Remove this function. Use the code block directly when needed.. Fix the typo, qos2. Why adding this leading space here?. Align this code block. Like this: #acl_kick_connection = off. {default, off},. acl_kick_connection defaults to false. Our coding style (maybe different to the common Erlang coding guideline) uses 4 spaces indentation.\n. Revert all your changes regarding to the code format.. Why allow the packet when ?RC_TOPIC_ALIAS_INVALID. Keep this unchanged. We need to refuse invalid packages and the connection also. . Remove this leading space. need to disconnect the connection here.. need to disconnect the client here.. remove the leading spaces. revert this change. Would the client be closed here?. May need to check the client is still alive.. May need to check the client is still alive.. remove this print. Will these 2 functions be used ?. Why these lines being changed again?\nAlways create a new branch based on emqx30 when you start a new task.. {shutdown, disconnet_abnormal}. I think constructing this SessAttrs in the caller side is better.. Keep these lines there is OK for me. . case clause. revert the configurations. revert it. revert. remove the table only, remain the APIs. fix the filter clause. store the rules into ENVs. Use access control API. Keep this untouched.. return a new msg. move it into access control . Move this into access control . move this into access control . ok = .... revert this . false also goes to the next callback, so we don't need that clause. ",
    "Gilbert-Wong": "@roytan883  Open a new issue if you have this problem on emqx3.0 and use the issue template to give us the detailed information .. @phanimahesh Sorry, because we have migrated webserver from mochiweb to cowboy, so it was removed accidentally. Welcome for your PR !. So sorry for late response.\n\nThere is no chance that both A & B may trigger on_message_publish hook in their individual plugins.\nYes.. @AngeloBestetti , Sorry for that we have no schedule to implement plugin for SQL Server on windows. However, ms have release linux edition of sql server , we are planning to implement this plugin for linux sql server in the future.. You could lookup session via rest api now in latest emqx 3.0.0 release, and also you could store session into the database you like in enterprise edition of emqx.. Our latest emqx adopt http basic authentication method for rest api publish, and we have no schedule to do acl/auth check for publish api.. @87sanchavan So sorry for late response, if you want to send thumbnail as payload of mqtt publish message to client and ensure that the thumbnails are recevied by users, you should set the message qos lager than 0. For example, qos 1 or qos 2, these qos level would ensure that the message has been received by users.. Sorry for late response ,You could refer the code in other emqx-auth-* plugin, firstly register your auth mod to emqx and then implement your auth function by yourself. . EMQ emphasizes connection and kafka emphasizes stream processing.. Sorry for late response, @rahulbhanushali , it is awkward to answer your question so lately.\nIn the latest emqx release, there is no such limit again.\nIt means the subscriptions can only be stored in local node, they could not be backup or migrated across different nodes.\nThe routing table partition has been implemented in latest emqx release.. Current emqx hook design should satisfy your guys' requirement.. It has been split into multiple applications. So sorry for so late response. Yes, I have checked this issue and reproduced this problem, we would fix it in emqx3.1 release.. It has been fixed in emqx3.1 beta1.. Sorry for late response, @zhanghongtong  would help you resolve this problem.. So sorry for late response. Is this issue still outstanding, and how did you config your etc/emq.conf? . The default config of emqx is recommended config. You could also refer our (official docs)[http://emqtt.io/docs/v3/index.html] to customize your config. There should be no such problem in the latest emqx3.0.0 release. Please try latest version of emqx.. This feature has been moved into enterprise edition of emqx.. Sorry for so late reply, maybe you could unsubscribe the topic for client via rest api, you could refer this link. This feature has been implemented in emqx 3.1-beta2. Thanks for your advice.. Hex package support would be finished before 3.1-beta.1 release.. Hi, @satrox28 , so sorry for so late reply. The session could not be stored across nodes in emqx cluster mode. Maybe it would be resolved in emqx 4.0 release.. Sorry , we have no schedule to do acl/auth check for emqx_management publish api, if you have access to emqx_management, I suppose that it is unnecessary to do acl and auth check.. Sorry, @rohan061  we have no schedule to implement this feature. Maybe you could implemented it in your  own business logic.. Ok, @zhanghongtong would contribute it into homebrew. Hi, @sanket-kulkarni-vmware , this issue has been resolved in emqx3.0.0 release. Hope the latest release of emqx could help you.. Yes, :). The windows build of emqx3.0.0 release has fixed this problem. Hope that the latest release of emqx could help you.. Refer this link: https://www.erlang-solutions.com/resources/download.html. You can just use erlang-solution to install the latest erlang/otp on centos 7 or rhel 7. You know they are almost same, right?. Hi, @alifirat , Sorry for late reply. EMQ X 3.0 has been released now, hope the latest emqx could help you solve this issue.. Please update EMQ to latest version and  run recon:bin_leak/1  again.. Hi, @emnvn , Sorry for late reply, have your issue been resolved? We have released emqx3.0.0, wish the latest emqx could help you resolved this issue.. @theronic the feature you want is in emqx enterprise edition. Please contact @zhengyupan  for more details.. Sorry for so late reply, how did you configure your emqx, how do you set the configuration entry max_inflight?. It has been implemented in emqx3.0.0 , please download the latest edition of emqx and try with the new feature.. Hi, @lucifercr07 , I'm so sorry for so late response. You could try our persistence plugin in emqx enterprise edition to realize you requirement.. You could refer this doc. @homerzhou , Sorry for late response, open source edtion of emqx do not support the feature that persist messages to disk, so the messages which are dropped could not be found except log debug. And the priority of qos0 message is too low to ensure the message could be delivered to your device, I do not suggest you to frequently deliver qos 0 message in production environment. EMQ X 3.0 is released now, welcome to try with our latest emqx broker.. This issue has been solved in latest emqx.. Sorry for so late reply, @jwestra , emqx 3.0 should fix the problem you refered. Please try with the emqx3.0.0 :p.. It is normal because each message published by broker would trigger emqx to sent a http request.. @cofol1986 , I have tried with hipe, it is useless, but we have schedule to merge session and connection layer internal which would improve the performance significantly.. We have tested ERTS with hipe, it is useless, We have a schedule to merge connection layer and session layer which would bring a huge performance improvement.. Hi, @MyraBaba , sorry for so late reply, Could you please tell me which emqx version did you use and the how did you connect to emqx?. More features, More stable , better performance :p\n\nGilbert Wong\nOn Dec 26, 2018, 4:08 PM +0800, MyraBaba notifications@github.com, wrote:\nquite forget the reason I changed the version emqtd 2.x to solve problem.\nI am connecting with Qt official qmqtt plugin.\nis therea good reason to upgrade to emqx ?\n\u2014\nYou are receiving this because you were assigned.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/1357#issuecomment-449925800, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-035cL2FVKAchbYrEZfsDht6Wcvh-ks5u8y6FgaJpZM4Qs-SQ.\n. If qmqtt follow the MQTT specification, it works.\nGilbert Wong\nOn Dec 26, 2018, 4:17 PM +0800, MyraBaba notifications@github.com, wrote:\n:)\n\u0130s it working with Qt qmqtt client ?\nThx\n\nOn 26 Dec 2018, at 11:15, Gilbert notifications@github.com wrote:\nMore features, More stable , better performance :p\nGilbert Wong\nOn Dec 26, 2018, 4:08 PM +0800, MyraBaba notifications@github.com, wrote:\nquite forget the reason I changed the version emqtd 2.x to solve problem.\nI am connecting with Qt official qmqtt plugin.\nis therea good reason to upgrade to emqx ?\n\u2014\nYou are receiving this because you were assigned.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/1357#issuecomment-449925800, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-035cL2FVKAchbYrEZfsDht6Wcvh-ks5u8y6FgaJpZM4Qs-SQ.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub https://github.com/emqx/emqx/issues/1357#issuecomment-449926876, or mute the thread https://github.com/notifications/unsubscribe-auth/AQscnx5K3qkGdq3yI7Ul51hHsdSADmhnks5u8zA_gaJpZM4Qs-SQ.\n\n\n\u2014\nYou are receiving this because you were assigned.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/1357#issuecomment-449927017, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-06bx8tB1_fWiIAkNQlwYD4BK78Ajks5u8zB2gaJpZM4Qs-SQ.\n. Hi, @pritstift , sorry for late response, this problem has been fixed in emqx3.0-rc.3. Hi, @sohailgerman , this bug has been fixed in emqx30 be\u00e7ause we replace mochiweb with cowboy as websocket server.. Duplicated: https://github.com/emqx/emqx/issues/803. This issue should have been solved in emqx 3.0. It is awkward to reply you so lately. The log message shows that you need to tune you linux kernel according to your documentation.. EMQ X 3.0.0 has been released. Welcome to try with the latest edition.. @arnaboss Have your issue been resolved ? . Hi, @Eric24 ,Sorry for late reply. I do not understand the meaning of the shared session, what is it meaning? Does it mean that you set clean session as false when your mqtt client connected to emqx broker?. The shared-subscription has nothing with session. You can refer the definition of shared-subscription in mqtt 5 specification.. 1. First Question, your assumption is right, the existing connection will be disconnected and the new connection will be established. If clean-session you set for your connection is false, the non-ack'ed message would sent to the session of the existed connection, and then the new connection with the same clientid built, it would resent to this new connection. You could try with emqx and emqx-dashboard by yourself.\n\nSecond Question, it is the same answer, it depends on the connection flag clean session.. This feature has been implemented in latest emqx. Please download it and try with it.. We have migrate mochiweb to cowboy as websocket server. MQTT is lightweight protocol, it must cost less resources than websockt. We recommend you to connect to emqx via tcp not websocket. EMQX 3.0.0 has been released, please have a try with latest emqx.. This feature has been implemented here https://github.com/emqx/emqx/pull/1823. Sorry , it has not been implemented now, we have schedule to implement this feature in the future.. Sorry for that because we have not prepared bsd package until now... We'll try our best to make a bsd package as quick as possible.. We'll enable a FreeBSD build release in emqx 3.2.. Hi, @gihad , sorry for late respond, the slack channel can be joined now, #emqx-users, #emqx-devs. You can use  loop or recursive to solve it .. Thank you for the solution your provide.. First, if you set the mqtt.queue.qos0=false, the memory consumption would be down because server would not keep the qos0 message on your broker in memory.\nSecond, if you want to try Enterprise edition, please contact with @zhengyupan . Sorry for late respond @homerzhou , the emqx does not support to find the message which has been dropped. It is designed to be message broker, not recycle bin.. You can refer this link https://medium.com/@emqtt/securing-emq-connections-with-ssl-432672ab9f06. You should design your topic filter yourself to control this or contact @zhengyupan for further support in enterprise edition of emqx.. It is the smp option of erlang vm which is used to take advantage of multi-processor hardware architectures causing the performance decline. It is inevitable. EMQX 3.0.1 release would have a better performance.. Hi, @michael-c-jones , this feature has been implemented in emqx enterprise edition., if you want to integrate this in your project, please contact with @zhengyupan for further information.. The ldap auth plugin has been implemented in emqx3.0.0 release, however, we have no schedule to implement the feature that do acl check for anonymous user in open source edition of emqx. Sorry, @victorclaessen .. Sorry, The priority of emqttd release isn't high enough. I recommend you use it on linux or unix.. Sorry, @gmatt76 , we still do not figure out your issue, we have released emqx3.0.0 yesterday, hope that the latest emqx would help you resolve this issue.. Sorry, we have no schedule to implement this feature in community(open source) edition of emqx now.. This bug has been fixed in 2.3.11.. Sorry for my ambiguous state. The bug has been fixed bug  in develop branch but did not merge into release tab 2.3.10,  so  we would merge it into next version v2.3.11. So has your problem been resolved ?\nOn Jun 20, 2018, 4:43 PM +0800, 571522162 notifications@github.com, wrote:\nthk,slow down the connecting speed of the client\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub, or mute the thread.\n. You can try to reinstall VC++ Redistristubeable 2013 packages or download MSVCR120.dll on this website: https://www.dll-download-system.com/msvcr120_dll.html. We have replaced mochiweb with cowboy in emqx 3.0. This issue should be solved.. It looks like some problems happens on rebar. Did you install rebar on your system or add rebar to your $PATH environment ?\nOn Jun 9, 2018, 4:31 PM +0800, starlily notifications@github.com, wrote:\nRemove the dir '/home/YANGHAO/emqttd-relx/deps/goldrush' and make again, goldrush has been solved, thank terry-xiaoyu\uff01\nBut i get new problems as follows:\nYANGHAO@YANGHAOZBYFV MINGW64 ~/emqttd-relx\nmake\nmake[1]: \u8fdb\u5165\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/goldrush\u201d\nmake[1]: \u79bb\u5f00\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/goldrush\u201d\nmake[1]: \u8fdb\u5165\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/emqttd\u201d\nmake[2]: \u8fdb\u5165\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/cuttlefish\u201d\n./rebar get-deps\n==> getopt (get-deps)\n==> goldrush (get-deps)\n==> lager (get-deps)\n==> neotoma (get-deps)\n==> cuttlefish (get-deps)\n./rebar compile\n==> getopt (compile)\n==> goldrush (compile)\n==> lager (compile)\n==> neotoma (compile)\n==> cuttlefish (compile)\n'rebar' \u4e0d\u662f\u5185\u90e8\u6216\u5916\u90e8\u547d\u4ee4\uff0c\u4e5f\u4e0d\u662f\u53ef\u8fd0\u884c\u7684\u7a0b\u5e8f\n\u6216\u6279\u5904\u7406\u6587\u4ef6\u3002\nERROR: Command [compile] failed!\nmake[2]:  [Makefile:17\uff1acompile] \u9519\u8bef 1\nmake[2]: \u79bb\u5f00\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/cuttlefish\u201d\nmake[1]:  [../../erlang.mk:313\uff1adeps] \u9519\u8bef 2\nmake[1]: \u79bb\u5f00\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/emqttd\u201d\nmake: *** [erlang.mk:312\uff1adeps] \u9519\u8bef 2\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub, or mute the thread.\n. If you guys have the same issue but did not resolve it, please open a new issue with the tempate, give more details. This feature has been implemented, it would be released with emqx3.0.0.. I make emq-relx in  ubuntu 18.04 too and it make successfully. The error log shows that there is some thing wrong when compiling the function in gen_coap. Maybe network problem lead to some broken in gen_coap deps.   I suggest you try to delete  /home/cnssk/emq/emq-relx/deps directory and remake again. . Which erlang/otp version do you use?. Did you install your erlang version from this command sudo apt install erlang \u00a0or build your erlang version from erlang source code ?\n\n\n\nI reinstall \u00a0ubuntu server on my \u00a0virtual machine \u00a0and apt install erlang , then I build emq-relx successfully again.\nOn Jun 21, 2018, 3:29 PM +0800, Mike notifications@github.com, wrote:\n\n\nErlang/OTP 20 [erts-9.2] [source] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:10] [kernel-poll:false]\nEshell V9.2 (abort with ^G)\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub, or mute the thread.\n. If you want to build your Erlang edition from source code . I recommend you to use kerl to build and install. . I don't know why there are such problems in you server. In our test server, there are no such problems. I suppose you guys didn't config your user permissions on your server correctly.. Yes, we have this plan and you can see mqtt5 branch in this project.. Thanks for your pr very much, but the branch you forked is too old and the destination branch you want to merge is not the branch we are developing on. So I would close it. The feature you want is in this pr https://github.com/emqx/emqx/pull/1913. Emqttd support to perform unsubscription by using rest-api ,  something important haven't been written into the document. Sorry for that and we would add related instruction into the document as soon as possible.\n. Hi, Krittanon-w! The rest api doc has been updated, you can read this doc on official site. The  rest api which get configs has bugs in emqtt v2.3.9 and it has been fixed. It will run correctly in  the release of v2.3.10.. This bug has been solved in  this commit. Hi, @bharat-mehta , emqx 3.0 has been released, welcome to try with our latest emqx.. I don't know what you want. The listener for rest api would be started after emqttd starting unless the 8080 port has been occupied by other application. If you want to to change the rest api port, change it in  etc/emq.conf, then restart emqttd. \n\n\nIf you want to change listen port of rest api when emqttd is running, it is a new feature for us. @terry-xiaoyu  I don't think this is bug. It looks like @wormcc 's problem. Maybe he needs a new feature. But I assume that it is not a good idea to change rest api listener's port when emqttd has been started. . Execute ./bin/emqttd_ctl listeners and tell me what's printed on terminal. I don't know what you want exactly, but emqttd_ctl listeners could close listeners by specifying port like this ./bin/emqttd_ctl listeners stop api 8099. You didn't reply in this issue for a long time. So maybe your problem has been solved?. You can find it in this repo, it is integrated in enterprise edition of emqtt. If you want to use this, contact our boss @emqplus  please.. Hi, @crazybg321 , Sorry for late respond, you can try to add emqx tcp acceptors or wss acceptors to resolve this problem. You have access to know EMQ drop their connection other than session.. For now, emqx does not support to migrate or replicate sessions between different nodes. We'll support it in the future. Anyway, thanks for your feedback.. Hi, @juanli1247, we have tried with emqx rc.3 and emqx 3.0.0 release and we do not reproduce the bug you encountered, maybe the emq version you test is too old. We have released emqx 3.0.0. welcome to try our latest broker.. Hi, hgascoigne. The Enterprise of EMQ is able to persist users info into databases, such as mysql, mongodb, etc.. What did you do on emq server? Could you give me more details?. EMQ does not support to use %c as wildcard.. Yes.. Hi, hbli, you can use emqttd-benchmark to test yourself because it depends your hardware and subscriptions. Hi, @sourcekick , Sorry for the perfunctory answer. I can give you answer based on our team experience. Generally,  if you have machine with 28G memory, emqx on your machine could hold 20,000,000 subscriptions and 800,000 connections.. Nope, @yangou , the topics->nodes route table would be stored in ets, not dets. The size limit depends on your machine memory. And the issue has been closed, if you have the save question, it is better to open a new issue.. You must have configured mqtt.cache_acl = true in emq.conf file. There are two ways to solve your problem .\nFirst , you can configure mqtt.cache_acl = false and restart emqttd server.\nSecond , you can refer to this position of  the document in  emqtt.io , you could use rest api to clear acl cache.. What about clearing the acl cache of client by using rest api?\n\n. More details please. Which client you use and please give us your config and log of emqx.. What DanielRooks said is right, please downgrade your erlang verision and restart EMQTT. I recommend you to use asdf to switch erlang version.. We have no schedule to support this feature.. The master branch of emqttd does not support to run on erlang/otp 21 now. Please  downgrade your erlang/otp to 20 and rebuild it.. This feature has been implemented in emqx3.0-rc.3. Use $share prefix you could set a group for multiple subscribers, but $queue doesn't support  this perform.. No, If you use $share , it means that you can use multiple groups to do load balancing but if you  use $queue, it means that it has no groups, so you can think of it as one group. Both of them can do load balancing.  By the way, the mqtt v3.1.1 protocol which emq 2.3.10 implemented does not support shared subscription and the shared subscription isn't supported in emq cluster. In addition, the performance of shared subscription implementation in emq 2.3.10 is not good enough to use. I recommend you not to use shared subscription now. \nPlease wait for the release of emqx-3.0  which is a full implementation of mqtt v5.0 and support shared subscription much better.. I'm not sure. We are developing it and try our best to finish the first release as soon as possible.. English.. Try to connect your mysql  database on your localhost machine.. \nWhat's this you circled? \u3000Is the database name consistent with the database name in your mysql database ?. You have to uninstall old patch-level of emq first , then  reinstall it on ubuntu. .  You can update emq by this command dpkg -i emqttd-ubuntu16.04-v2.3.10_amd64.deb directly.  I tried it  and package has been updated.\nMaybe it shows that:\nunpacking emqttd (2.3)\nsettingup emqttd (2.3)\n\nBut it is updated properly from 2.3.9 to 2.3.10.. Of course loaded_plugins file is overwritten each time. Each time we updated emqttd, we are very likely to update plugins too.. Yes, we have not added emq source to ubuntu software repositories. You can use dpkg to install , update and remove emq. Can\u2019t agree more.   We would add it to our schedule after release of emqx-3.0 .\nOn Jul 25, 2018, 5:37 PM +0800, gbrehmer notifications@github.com, wrote:\nwe are using a self hosted apt mirror / internal repository to maintain sw packages on our nodes (I think all bigger customer have similar setups). And it would be nice if the apt support would be better :)\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHubhttps://github.com/emqtt/emqttd/issues/1696#issuecomment-407695705, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-0_pWVmsmjInarw_inao8gVI2ecokks5uKDxVgaJpZM4Vfj86.\n. The open source edition doesn't  support but the enterprise edition of EMQ support to add the plugin without restart the EMQ node or recompile EMQ.. @emqplus  I'm going to sleep, help me review code please.. Persist messages to databases.. Wait, I have mistaken your issue. Look at this plugin, it is open source plugin. emq-retainer. There is delay when stats the information about connect and disconnect.. I test it on my test-server which installed ubuntu 18.04. It has no problem.\n\n. It is strange. This is what i got:\n\nI'm using ubuntu 18.04.1 server to test it.\n\n. Execute lsof -i:8883 to see what happened.. Execute emqttd console and  show me what happens. I installed emqttd by dpkg rather than building from source. It is not the package's problem.. Yes, it is possible.. @write2jaydeep  You need to let another client which has subscribed over TCP subscribe the topic where publisher client publish message.\nExecute emqttd_ctl listeners, you would see that emqttd has listened tcp connection on 1883 port.. @write2jaydeep  It is strange. I tried as you stated. It has no problem to receive message from 1883 over TCP. . The path of  emqttd  on windows could not contain characters like '-' or '', please check it .. Try to shutdown the emqttd processes and open task manager to ensure that all emqttd processes has been killed . Then open CMD with Administrator privilages. Restart emqttd again. \nBy the way, the emqttd package on windows have many weird problems. Linux is a better choice for emqttd.,. @zhanghongtong would improve the performance of emqx on windows.. I tested as you said. There is no such problem on my machine with emqttd 2.3.11.  I  tried with java paho library and it has no problem. I supposed maybe it is golang paho  bug? Anyway, I am busy these days and would test with golang paho library next week. . Sorry, I still cannot reproduce your problem. And maybe you can have a try with emqx3.0.. First, I still can not reproduce your problem. Second, maybe you can have a new try with emqx3.0. . The feature has not been supported. We would add this feature to emqx 3.0.. The feature would be implemented in emqx3.0. . Hi, @suspai , I have improved the emqx-auth-ldap plugin. Username and password field both could be configured in configuration. You could get this feature in emqx3.0.0 release.. Sorry, the emqx doesn't support hot config for dashboard port now. If you want to change the default port dashboard listened, you need to restart the emqx broker on your server.. The whole projects of emqtt will be migrated to the emqx in the future and emqttd would be deprecated. This is the emqx road map https://github.com/emqtt/emqttd/issues/1659. The emqx you used is too old. Please upgrade your emqx to the latest version and try again.. First, comment lines which is unnecessary as follows:\nlistener.wss.external.proxy_protocol = off\nlistener.wss.external.zone = external\nlistener.wss.external.fail_if_no_peer_cert = false\nlistener.wss.external.verify = verify_none\nlistener.wss.external.fail_if_no_peer_cert = false\nSecond, kill emqttd processes by kill command and execute emqttd start again,\nLast, open the https:// {your ip address}:8084,\nIf you see the page like this:\n\nyou would be able to  connect websocket with ssl like this:\n\n. English please.. Yes, you can create topic like terminal/$terminalId. Please refer to emqtt_benchmark https://github.com/emqtt/emqtt_benchmark\nOn Aug 7, 2018, 4:56 PM +0800, chunzhenzyd notifications@github.com, wrote:\nHi Gilbert,\nThank you!\nBut I want to know is there a test to see how many topics can we create for max value?\nBR\nJack Zhang\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHubhttps://github.com/emqtt/emqttd/issues/1718#issuecomment-410985200, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-0_LmdXIE8ci2EwIByweN4UBMkMQiks5uOVZNgaJpZM4VxkP0.\n. Yes, sorry for that,  I\u2019m too busy to read your issue carefully this afternoon. In general, emq supported to create and store more than 20,000,000 topics. The specific situation depends on your actual hardware performance.\nOn Aug 7, 2018, 5:28 PM +0800, chunzhenzyd notifications@github.com, wrote:\nHi Gilbert,\nI don't think it sovles my problem, it's just a benchmark test for concurrency..\nBR\nJack Zhang\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHubhttps://github.com/emqtt/emqttd/issues/1718#issuecomment-410994428, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-08l_unpu-jUhXxaiJ-iEaUb0M7V_ks5uOV2ogaJpZM4VxkP0.\n. Sorry , I misunderstood your issue just now.  The Maximum size of mqtt packet could be configured in emq.conf which also means that the maximum size of EMQ  publish payload could also be configured in emq.conf\n\n. No, you can't , the article you referred is right. You can configure max packet size in emqttd but the size shoud be less than 268 435 455 bytes.. Cool! @nubunto .. English.. Sorry, @Forsure-Wang , we have no schedule to implement this feature.. Sorry for late respond, we have not encountered the same problem as you said. What about the system message when the connack_timeout error occured. For example, the cpu and memory usage.. Refer from MQTT Specification\n\nThe Server MUST NOT match Topic Filters starting with a wildcard character (# or +) with Topic Names beginning with a $ character [MQTT-4.7.2-1]. The Server SHOULD prevent Clients from using such Topic Names to exchange messages with other Clients. Server implementations MAY use Topic Names that start with a leading $ character for other purposes.\n\nAnd refer from EMQ Documentation:\n\nNote\nThe broker only allows clients from localhost to subscribe $SYS topics by default.\n. Hi, this shared subscriptions in cluster has been implemented in emqx3.0-rc.1, please download the latest emqx and try again.. Use Erlang/OTP 20 to build.. This the bug of windows EMQ package. . Yes, the packege of windows has some problems and I noticed that the edition of EMQ you use is 2.2. The latest version of EMQ is 2.3.11 and it fixes a lot of bugs in EMQ 2.2. There are also some serious problems about services regist in EMQ 2.3.11 Windows package. The service regist bugs \n on windows platform will be fixed this week. Personally, I recommend you run EMQ  docker on windows. There is no such problem you issued on linux and mac os.. You have installed openssl library on your mac os, but it doesn't mean that you have configured openssl library correctly in your erlang runtime.\nTry to install erlang OTP 20 by homebrew. \nbrew install erlang@20\nbrew unlink erlang\nbrew link erlang@20 --force\n. EMQ does not support this feature now. you have to implement it by yourself on your mqtt client. We would support it in the future . The user generated with api is administrator user who could log in the  dashboard. However, the user which created by emqttd_ctl is not administrator user. It is mqtt user which you need to fill the input inbox in the picture as follows:\n\n. No,  you can also config it in emqx_auth_username.conf.\n\n. You can also use other auth plugins such as emqx-auth-mongodb , emqx-auth-mysql to persist your user information.\n2018\u5e748\u670824\u65e5 +0800 PM7:28 c0otlass notifications@github.com\uff0c\u5199\u9053\uff1a\n\nThanks\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHubhttps://github.com/emqtt/emqttd/issues/1739#issuecomment-415731741, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-0zDtpwmziyGABAsjOtzd1n5p7hJXks5uT-M-gaJpZM4WKP_d.\n. Is it the problem of emqttd ? I supposed you need to open issue on this project. There is no necessary to add emqx_retainer. Because one node of emqttd listens 1883, 18083, 8083\u2026etc. ports. You assign the same ip for different nodes. It would be conflict for the duplicated listeners on the same ip same port.\nOn Aug 30, 2018, 2:37 PM +0800, tharanga2006 notifications@github.com, wrote:\nEnvironment\n\nOS: Windows\nErlang/OTP:\nEMQ:\n\nDescription\nI'm trying to create two nodes in the same physical server.\nI have change the emq.conf\nnode.name = emqbr@127.0.0.1\nnode.name = emq1@127.0.0.1\nbut emqttd start only start one node\nIs this possible to implement ?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHubhttps://github.com/emqtt/emqttd/issues/1766, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-01f_nlCB7ClS9IfADPRKk0uLdQ7Uks5uV4gigaJpZM4WS3KQ.\n. Maybe it could help you: emqtt document. May be you can launch two different dockers to place emqttd and assign different subnet ip for different dockers.\nOn Aug 30, 2018, 3:14 PM +0800, tharanga2006 notifications@github.com, wrote:\nI'm looking at that doc. but there is no place explaining this scenario. may be this is not possible.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHubhttps://github.com/emqtt/emqttd/issues/1766#issuecomment-417214603, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-0xGZooUIPp7a_nCTzlX3nXR6HyVdks5uV5DtgaJpZM4WS3KQ.\n. Looks like the the mochiweb integrated in emqttd  crashed.  The code of mochiweb  is too old. And we do not have schedule to maintain it any more. We have migrated from mochiweb to cowboy on emqttd v3.0 - beta.1. On the edtion, I suggest you attach to emqttd shell to restart mochiweb application.. Try to use emqttd attach to get into emqttd shell and execute application:start(mochiweb).. It would be ok..  Execute ./_rel/emqttd/bin/emqttd_ctl clients list and look what happened. I do not encounter the problem you mentioned on emqttd 2.3.11. I need  more details.. It is odd. Do you have any ideas @turtleDeng ?. Make sure you have clients connected to emqttd broker after you upgrade the emqttd from 2.3.7 to 2.3.11. . Give me your screenshots which shows that you have clients connected to the broker.. \nConnect mqtt broker via websocket on dashboard check the overview on your dashboard.\n\nAre you sure the broker you ran on your vps is emqttd rather than mosquitto? \n. @jerry-chao  Actually. The retained message will send to client when client subscribe the topic rather than connect to the broker. In his situation,  in former times,  he firstly use mosquitto to pub message which is a retained message before subscribers subscribe it. The retained message would be both published to the subscribers even it is share subscription.However,  in latter times, he has subscribed hello topic so that  the message he received is not retained message and it would follow the shared subscription rule. . First , that is not retained message though the retain flag of this message has been set true because when the message published, you have subscribed the 'hello' topic., Second , the beta version of emqx  3.0 has supported partial features of mqtt 5.0 which support $share subscription. This is the beta version, I did not recommend you use it in the production environment. The strategy you want could not be implemented with emqx now, but we have a schedule to support this strategy in emqx3.0 rc 1.. This feature has been implemented in the latest version of emqx, please upgrade emqx.. Please update your Erlang/OTP to version 20.. I'm not familiar with windows package and I did not advise you to use emqttd on windows. In this situation, maybe you did not use http basic authentication to  do request .  The REST API are protected with HTTP Basic authentication.. Hi, @chao-cn  , Did you read emqttd documentation or api lists on dashboard? \nThere is no such api called http://127.0.0.1:8080/api/v2/\n\n. Please  don't open the same issues . Please give us more details. Are you sure you can not publish messages larger than 1450 byte ? I tested with a 74 KB message . It was published successfully. The message length could be configured with the parameter mqtt.max_packet_size.. Maybe the beta version of emqx is not compatible with your mqtt client. Can you tell me which mqtt client do you use?. There are still some problems with keepalive mechanism in emqx 3.0 beta 2 and beta 1 for compatible with mqtt 5.0. Maybe you have to wait for the release of emqx beta3.. We didn't reproduce the issue as you say, we need more details.. English please. We did not have schedule to support get list of clients info from REST api, Sorry, .  You are welcome. Thanks for your PR.. This is the problem of travis-ci. I have run all the test case on my local machine\n\n. Maybe travis-ci did not support the shell command pushd. This error means that too many open files. You should tune your linux kernel first. Here is the instruction about how to tune your machine http://emqtt.io/docs/v2/tune.html. Thanks for your instruction and advice @spring2maz . @emqplus the main business logic of request&response feature in emqx_client module has been finished, but there are still some problems I want to discussed with you. Please review my code :P. Thank you for your review very much @spring2maz !. This feature would be realized in emqx 3.0-beta.3. @nerdial Hi, now you can configure management.listener.http = 8080 in etc/plugins/emqx_management.conf which is the api port.. Of course we have schedule to create a standalone release of the emqx client. Please wait for few days.. If you have no demand to use standalone emq client with mqtt 5.0, you can just use emqttc first.. Sorry, we did not have schedule to realize the feature you want now.. You can fork this project to your own repository, then implement yourself. Look forwarding to your pull request. \ud83d\udc4d . Thanks for your help @jerry-chao , and did your issue has been resolved? @redmond007 .. emqx3.0 -beta 2 does not support to resolve the properties in connect packet. @tigercl  would implement this feature in emqx 3.0-beta3.. @ckrey , could you please tell me what scenario you encounter, is this feature important, we have schedule to implement this feature, but the priority is not high. . It has not been not implemented, same as https://github.com/emqx/emqx/issues/1834. There are still some features in mqtt 5.0 not implemented. we plan to finish these work in beta.3. Yes , you are right, the comment description is wrong, but there is no problem in code.. Sorry, I checked that the validation for topic alias is not implemented in CONNECT packet. @tigercl would add these validation.. The topic alias has been fully implemented in emqx 3.0 beta4, but we forgot to modify the description in emqx.conf. The description would be fixed in next edition of emqx.. Sorry for so late reply. Could you please tell me how many connections and how many topics your emqx store?. Could you tell me which emqx version do you use?. It is impossible for emqx now, but I think this is a good feature. We would realize it.. English please\n2018\u5e749\u670820\u65e5 +0800 PM8:28 Hengxiao.Du notifications@github.com\uff0c\u5199\u9053\uff1a\nDescription\n\u5f53client\u8fde\u63a5\u5230broker\u540e\uff0c\u5c06\u4f1a\u53d1\u9001\u5fc3\u8df3\u4fe1\u606f\uff0c\u8bf7\u95ee\u6709\u6ca1\u6709\u4ec0\u4e48\u9014\u5f84\u53ef\u4ee5\u8ba9\u6211\u53ca\u65f6\u83b7\u53d6\u5230\u5fc3\u8df3\u4fe1\u606f\uff0c\u7528\u4ee5\u53ca\u65f6\u5237\u65b0client\u5728\u6211\u7684\u670d\u52a1\u4e2d\u7684\u72b6\u6001\uff1f\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/1841, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-06FUM5XwNE-JrPkyBMjSlpQMAjvgks5uc4nvgaJpZM4WyBXq.\n. You have to use retained message to get the client online/offline message between publish intervals. You can refer this article https://www.hivemq.com/blog/mqtt-essentials-part-8-retained-messages. Sorry , we plan to release it tomorrow.. English Please.. emqx is broker rather than client, it has no reconnection mechanism.. What \u201curl list\u201d do you mean ?\nOn Sep 21, 2018, 1:17 PM +0800, tharanga2006 notifications@github.com, wrote:\nEnvironment\n\nOS: CentOS\nErlang/OTP:\nEMQ: emqttd-centos7-v2.3.11.zip\n\nI have a 4 broker cluster. and I wanted to subscribe for the cluster. but I was not able to find a place to give \"url list\" when we starting subscriber. Appreciate if some one can tell me how to achieve this\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/1844, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-0wozhT6yh8o7BfnaM2T3AdLq_VELks5udHaCgaJpZM4WzdlN.\n. I got what you mean. I suppose you need to configure a load balancer for your emqx cluster. The load balancer would expose one url you want.. I did not use MQTT.js client. Maybe you can try it , but using a load balancer for cluster is better choice.. OK, I will check it. . Yes, you are right. We would fix it as quick as possible.. Hi, @zinid . The connack packet has not supported mqtt 5.0 specification now. There is no properties in CONNACK packet now. Please read spec again. It said that when this property Maximum QoS is absent in CONNACK packet, Client would use qos 2 as maximum qos. The maximum qos is not only used to pass it in CONNACK packet. It has another usage.  \n. Yes, you are right. I forgot this code.. Now, it has been fixed in https://github.com/emqx/emqx/pull/1857#issuecomment-423733540. Would be fixed in beta4.. Gotcha.. You should disable this option, cannot be same as above.. Sorry for that, yes,  there are performace problem in emqx3.0 now, we would optimize it.. First, please use English to write your description. Secomd, this error is caused  by the function of json_encode_string_unicode in mochiweb which is deprecrated in latest emqx. If you update to the latest emqx. The problem should be solved.. Sorry, it doesn\u2019t support such strategy.\u3000Emqx beta3 support it.\nOn Sep 26, 2018, 11:37 AM +0800, chen notifications@github.com, wrote:\nHowever, our current EMQ service is 2.0, and I handle EMQ docker \"emqttd-docker-v2.3.1\" with it. Does '2.0' support this featrue?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/1864#issuecomment-424573637, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-0wjHD3zlGKlnWZhjzpeCQrgR3VcWks5uevZZgaJpZM4W3074.\n. I think this feature would cost much computing resource and influence the performance of emqx. We need to discuss it tomorrow.. It looks like the json encoder bug in mochiweb cause this problem. Please try with the latest emqx release which has replaced mochiweb with cowboy.. Hi, @watchworld , emqx 3.0 has partially supported mqtt v5.0 which has sub options to support this feature. According to your issue, I realize that there are still so many people willing to use this feature in mqtt 3.0, so we would give back this feature in next edition of emqx. . It has been fixed in rc.4. Sorry for the late respond. We have no plan to maintain the 2.3 of emqx. Please try with the emqx 3.0 again.. emqx3.0 beta4, and we would release a new edition emqx3.0 rc 1 at 2018\uff0d10-20. In mqtt spec, payload means message itself.. Hi, can you provide your hardware information which would help us reproduce the problem you mentioned? . Sorry for late respond, and I really don't understand what you mean. Inside EMQ, guid is used to generate a client id ,not packet id. The prerequisite you give is wrong.. Sorry, I made a mistake, guid is also used to generate packetid and messageid. (They have the same meaning in emqx). According to mqtt spec, the packet id could only be placed in qos1 message and qos2 message. And if your client have access to get qos1 message and qos2 message from broker. Of course the packet ids are exposed.. Refer here: http://emqtt.io/docs/v2/config.html.. @utkarshns @zhanghongtong would help you config haproxy.. https://github.com/emqx/emqx/issues/1886. We'll discuss it and determine implement this feature or not later.. @spring2maz I learned that other common test modules in emqx have eunit test cases, so I supposed that it maybe good practice to do like this. . I tried as you say. Emqx3.0 beta4 has no problem.I can set Fgo5j2VlLJvQ85N1DBC4dB5op5e3VFUR as password.. Hey, @phper-chen , the mqtt protocol works above tcp/ip layer. So you cannot directly get IP address from mqtt commuication. Maybe you can bind the ip info as part of client id for mqtt clients to provide ip information.. Of course EMQ knows it. But mqtt message itself does not carry the client ip information, so you can not directly get remote IP address of via mqtt communication. EMQ X provide Restful API to view clients remote ip. You can refer here. The broker would return a json data which include the remote ip you want.. Please use this template and english to open issue and  I'll close this issue.. The ip acl could be configured in this file. Sorry, I didn't read you issue carefully. First, emqx would not ignore this acl file even mongo plugin is enabled. Second, I test with emqx3.0 rc.3 with mosquitto. I place emqx on vps and set acl.conf the same as what you give, then use moquitto subscribe \"#\", the mosquitto seems to subscribe this topic filter successfuly. But the broker actually return a suback packet with return code 0x80 whch means that subscription failure. So i suppose most of the mqtt client which just implement mqtt3.0 did not treat this return code as subscription failure and show user subscription failure. So it is not the bug of emqx.. Sorry for late response, Which hash type did you choose? . The user you created is superuser, it is unnecessary to check acl for super user.. Hi, @ali-zohrevand , what about the configuration item acl_nomatch do you configure ?. @ali-zohrevand , Sorry for late response, you should delete this line in your acl conf file:\n{allow, all}.. Hi, @jidushan , please use the issue template to open issue. The information you provide is so poor that I can not understand what you mean.. Download the version 3.0 of emqx and stop version 2.3.3 of emqx and then you just need to stop the old version emq and start new version emq. . @E-brain-child I can not infer the problem reason from your error log. As you say, it is possible that the insufficient of memory cause your problem. Could you please give me more information such as the hardware info, etc/emq.conf file , the number of the connections you created and so on?. Sorry for late response. The error shows that your web server is not stable so that sometimes emqx-web-hook would request timeout.. We'll check this problem.. Make sure that your emqx_auth_mysql is loaded and you have turned off the allow_anonymous option.. Please state your issue clearly. I don't know what you mean. I will close this issue, please open a new issue and make sure your issue is clear and detailed.. No, you misunderstand the username and the password  admin and public. It is the dashboard username and the password. It is configured in emqx_dashboard.conf. It has no relation with the mqtt username and password.. https://github.com/emqx/emqx/issues/1916. @free1139 Please open new issue.. According to stackoverflow\n\nA \"connect failed: ECONNREFUSED (Connection refused)\" most likely means that \nthere is nothing listening on that port AND that IP address. Possible >explanations include:\nthe service has crashed or hasn't been started,\n your client is trying to connect using the wrong IP address or port, or\nserver access is being blocked by a firewall that is \"refusing\" on the >server/service's behalf. This is pretty unlikely given that normal practice (these >days) is for firewalls to \"blackhole\" all unwanted connection attempts.\n\nPlease check your firewall first.\n. 3.0 is still a release candidate edition. We would fix this problem as quick as possible.. Please update to emqx-docker-v3.0-rc.3 to try again, and please give us the logs and your etc/config files.. It has been fixed in rc.4. Please do not use the branch emq24. This branch is not maintained now. If you want to use emqx, please go to here. Sorry, @yunanxing , not support yet.. It looks like too many Connection Refused: unacceptable protocol version. cause server crashed. I tried with the mosquitto_pub v1.5.3 and emqx v3.0-rc3, I do not encounter the situation as you stated , the error Connection Refused: unacceptable protocol version could be only triggered with the error connect packet sent by mqtt client.. Hi, @yy-chen , Thanks for your contribution, but this bug has been fixed in this (pull request)[https://github.com/emqx/emqx/pull/2102], I would close this pull request :p.. Please show me your CN of your certification.. This pr is opened 5 months ago. I suppose that it should be closed?. Hi, @dotyso , did you disable the item allow_anonymous in emqx.conf?. After disabling the allow_anonymous option, you should stop emqx then start emqx to take configuration into effect. Restart could not reload emqx.conf. What is the Built in meaning? You do not know the erlang/OTP version installed on your system, right? Can you show me the emq.conf you use? How did you config this item mqtt.max_packet_size = 64KB?. I test this edition of emqx, and set mqtt.max_packet_size = 50 MB, send 1MB size of message, but did not reproduce the problem you stated. Could you please give me your error.log to provide more details?. This is also possible in version 3.x. Are you sure you are using emqx3.0? I suppose that this command ./bin/emqttd_ctl plugins load emq_lua_hook is used in emqx2.0. The correct command in emqx3.0 is ./bin/emqx_ctl plugins load emqx_lua_hook. Thanks for your feedback, it is bug, we'll fix it. http://emqtt.io/docs/v2/index.html.  Please refer here. Yes, you will.. Thanks for your advice, we'll improve it.. It depends on your hardware. . If you have a machine which has 8 core cpu and 8G memory and you just want to send qos 0 message, that's enough.. We have changed default logger from lager to erlang/otp logger. And it consumes a lot of computing resources and we have fixed it, in emqx3.0-rc.4, this issue should be fixed.. It is not available via yum, but we have schedule to let it be available.. Hi, @Think7 , the emqx 3.0.0 has been released this week, we have do a log of optimize work. You could try with it again.. Describe your scenario more detailed, I tried to understand what you mean, there are two client with the same clientid? And client A is connected, client B want to connect to the broker, both of your clients have reconnect mechanism, and if client B has connected  to the broker, client A would be kicked out without sending any packet. What you want? you want to let client B receive connack packet with flag return code 4 or 5 before connect to let your client stop loop to reconnect to broker ??? According your description , I assume that the the protocol you use is mqtt3.0, but the disconnect packet could only be delivered from client to server rather server to client in this version of mqtt protocol. I still do not understand the meaning of what you say  -- but client recv a disconnect, not flag 4.. The opensource edition of emqx does not provide customized service like this which violate the mqtt 3.0 spec. Please contack with @zhengyupan for enterprise edition of emqx.. Hi, @nerdial , it is usable in version 3 now. Please try with the emqx3.0-rc3.. presence module cannot detect ungraceful disconnect, you should use will msg to notify ungraceful disconnect action.. Please read mqtt spec, you can set will msg in your connect packet.. Comment these config is not a good idea.. I pushed a small fix commit, please squash merge it.. This pull request still have bugs.. Too many small fix, please squash merge it.. Someone else opened similar issue in emqx-web-hook project. I and other contributors cannot reproduce this bug you feedback. So I want your configuration files to help us confirm this problem.. Hi, @jdavidagudelo, Sorry for late response, I want to know what tool you used to publish messages. Could you tell me how you publish message. It would help us reproduce this bug.. Hi, @jdavidagudelo , thanks for your details. I have reproduced this bug, it will be fixed in 3.0. Next time please use template to open issue which help us solve your problem. You can not use appsecret to create application, after you created application, click view, you will see the appsecret. Thanks for your feedback, we'll improve it.. You need to install rebar3 on your machine.. Rebar3 do not support proxy, if you use rebar3 with proxy to build project, it will fail.. Sorry, I tested rebar3 with socks5 proxy before, rebar3 do not support socks5, but support http proxy.. Your emq is 2.0, but your erlang/otp version is 21 ? You should compile the emq2.0 with otp 20 and compile the emq3.0 with otp 21.. If you download emqx-2.3.11.tar.gz directly, you have no need to build emqtt from source code. just launch it !. Thanks for your contribution, but this change decrease the coverage of the test cases. I have to dig into the reason.. Thanks for your pull request.. @spring2maz Can xref check the spell error?. You mean P2P? Sorry, I dont't know what you mean.. You can set json in mqtt payload, and set client id property in this json string to filter the message. You can decode this json to implement the p2p feature you want.. Sorry, We have changed the client api in rc.4. First, you need to spawn a client process via {ok, Client} = emqx_client:start_link(), then you should connect via emqx_client:connect(Client).. Yes.. You set Websocket port 1234 and use web browser to connect 5432 port ?. So which websocket client did you use? And could you please provide your error.log of emqx?. I still do not think it is the problem of emqttd. We have connected to the broker thousands of times via websocket interface with emqx-dashboard or mqttbox. And there is no such problem you encountered. So I want to know whether it is caused by your websocket client.. The mqueue is prepared for mqtt session and for qos1 or qos2 messages. Please read our documentation. For emqx, more connections more memory consumed. And how to reserve memory for emqx, it depends on you, right?. Because your connections to emq broker is not enough.. Did you set retain flag as true when you publish messages? And how about clean session flag? . Please show me your etc/emqx.conf and your log file which could help me resolve your issue.. @zsb7798169 Have your problem been resolved? . Hi, @nosixtools , Thanks your feedback. could you please tell me how do you use one client to subscribe and publish messages at the same time\uff1fFor example, which client did you use, it would help us find the problem.. @nosixtools please check your emqx.conf, and find out the mqtt.ignore_loop_deliver item to make sure its value is false. This item is used to prevent subscriber itself to receive the message it published.. Hi, @Wagos , could you please show me you config for bridge which help us dig into your issue.. This bug should be fixed before emqx3.1-beta.1.. Hi, @Rebellioncry , Could you please provide your config and log information?. It is meaningless to add eunit test for functions which only has one term and whose returned value is certain value. I assumed this pull request should be closed. What do you think ? @terry-xiaoyu @tigercl . I would show you how to write better code for these test cases later, I'm going to have lunch :p. These codes show you how to write test cases to cover emqx_reason_codes https://github.com/emqx/emqx/ .. Hi. @fromiuan , could you please tell me how did you cluster you different emq nodes ? Maybe you can try with emqttd_ctl cluster status to view whether this cluster is normal.. Hi, @fromiuan , the Node 'emqttd@192.168.0.10' not responding to pings. shows that the emqttd on 192.168.0.10 did not start correctly.. Sorry, @fromiuan , your crash log has been truncated, I could not extract useful information from your logs.. It seems that there are too many connections in emqx, and you didn't do any tuning work for linux kernel, right? From the crash.log, I found that the file descriptors are insufficient and cause the cluster crashed.\n. Hi, @fromiuan ,Have your issue been solved?. These code is written for fun to show how to write s-expression code in erlang :P.. Hi, @mkrusemark, the error indicates that you didn't install your erlang/otp runtime correctly. How did you install your erlang/otp on your local machine? Could you please give us more details.. Hi, @sylnkk , please provide more details. For example, which version of emqx do you use, what the scenario you encountered with emqx and did you tune your linux ? Look forwarding to your reply. . Sorry for late reply, maybe you could configure the zone.external.session_expiry_interval and zone.external.max_mqueue_len to reduce the memory consumption.. Hi, @ozgursoft .First log indicates that emqttd could not read the file opt/emqttd/ssl/emqtt.key, you should configure the right path of the emqttd.key.. Hi, @JXT-Eden emqttd 2.3.11 would not be maintained again. We would release emqx3.0.0 this weekend. Hope that the latest emqx3.0.0 would solve your problem.. By the way, linux is the best place to deploy emqx. emqx has bad performance on windows. And if you want to try with emqx3.0, you have to upgrade your erlang to erlang/otp 21. @aviscaerulea So sorry for so late response, in emqx cluster mode, session would not be backup or migrated in different nodes. So if you stop one emqx node in cluster, the session on that node would be lost.. Hi, @AshokKumarTech, sorry for late response, which erlang/otp version and which emqttd version did you use ? And did you build emqttd by yourself? The log indicate that the dependency mochiweb which is depended by emqttd is not build into emq.. The mochiweb has many bugs and has been deprecated in latest release of emqx. We replaced mochiweb with cowboy, and would release emqx3.0.0 this weekend, hope that the latest release of emqx would help you fix this problem.. @AshokKumarTech , I suppose that it is best to upgrade emqx, mochiweb is really not suitable into production environment. And our emqx 3.0.0 has been released now, we have do a lot of optimize work, you could try with emqx3.0.0. It is much better than emqttd 2.0. Hi, @mdrobny , so sorry for late response. You could delete all the acl rules in acl.conf and try emqx_auth_pgsql again, emqx would first load the rules in acl.conf and may be mess the rules in pgsql.. Generally, if you use some emqx_auth_* plugin, the acl.conf is not required, if you want to add new acl rules, and do this rule check before the rules in pgsql, the acl.conf is necessary. There are still inadequacy in our documentation. Thanks for your feedback, we would improve it .. Hi, @fromiuan , this bug has been fixed and it would be released with emqx3.0.0.. The first field you shoud insert is hookpoint, it is the event in emqx, you could refer README of this project, when the event on_client_connected and on_client_disconnected and so on triggered, the json which contains event information would be delivered to your web server.. Thanks for your contribution , I would review it later.\nGilbert Wong\nOn Dec 12, 2018, 7:27 PM +0800, Miks Mi\u0137elsons notifications@github.com, wrote:\nIn any case I created pull request here emqx/emqx-management#20https://github.com/emqx/emqx-management/pull/20\n\u2014\nYou are receiving this because you were assigned.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/2043#issuecomment-446554764, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-0_dRDVgCIk6UUKhJKZN6L_vlIrUyks5u4OgAgaJpZM4ZNjPz.\n. Please try with ./emqx/bin/emqx_ctl status to lookup the status of emqx.. Then please try  with ./bin/emqx stop to stop emqx, and if it still failed, you could kill -9 the emqx processes.. Hi, @jvrahav, we have configuration entry zone.external.mqueue_store_qos0 to let you determine whether store qos0 messages in mqueue and zone.external.max_mqueue_len to determine the number of messages held in memory. Notice that these two configuration entries just works if you set clean_session is false in your mqtt connection.. No, qos 0 message could not be ensured to be delivered to your subscribers, in your scenario, I suppose that maybe qos 1 or qos 2 would be better.\nGilbert Wong\nOn Dec 18, 2018, 11:15 AM +0800, jvrahav notifications@github.com, wrote:\nIf we take a case of a slow subscriber who is unable to consume messages in the rate at which they come into emqtt, what happens then. Will the qos 0 messages be held in memory until the subscriber reads it. In this case is it possible to determine the messages that are yet to be processed\n\u2014\nYou are receiving this because you were assigned.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/2048#issuecomment-448081972, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-054XTbgaMfwJ0Xf2wuXpaZ08oU7iks5u6F3igaJpZM4ZQa0w.\n. Sorry for so late response, @yu-chun-young . Could you please tell me the hardware of your windows server machine ? For example, which cpu and how much memory. And how many qos2 messages you published each seconds? These information would help use dig into your problems.. What is the consumer do you mean? The client or the broker ? Could you please tell us more details?. Sorry for late reply, how do you configure the config entry zone.external.max_mqueue_len?. Hi, @ranvijayj , it's a good idea, I would engage into this erlang auth plugin if I have time.. Hi, @zhitingxie , you have to restart emqx to reload acl config. You must stop emqx first and then start emqx again.. Sorry for late response. I'll check it. . Hi, @s4kibs4mi , Sorry for late response. You said that you published qos1 message, but the log you show me contains the packet required by qos2 message. I'm confused.. Sorry for our careless work and thanks for your feedback, we'll fix it as soon as possible.. Now, it should be fixed. \n. Please try to download again.\n. Please use English to open issue.. We would release emqx3.0.0 today. This error could no longer exist. However, I still suggest you to run emqx on linux.. Are you user of emqx enterprise edition?. Really? emqx_bridge_kakka is not open source project and not integrated into free edition of emqx.. The feature you want is being implemented by my colleague, it should be implemeted in emqx3.0.0 release.. @rahulwinzo , Have your problem been resolved ?. First, please use English to open issue.Second, which emq version did you use, 2.3.11 or else? Last, what about mosquitto client behaviour when mosquitton is connected to  emq? Are you sure it is emq bug, not your golang code bug ?. Thanks for you feedback. We have fixed it in latest emqx3.0.0 release.. It must be network problems, could you please make emqx_rel again? And could you please tell me which branch of emqx-rel did you checkout ?. No, you have to restart emqx service. And did you successfully register emqx as windows service on windows server ? Could you please tell us how did you realize it ?. Ok, Anyway, Thanks for your feedback.. @yu-chun-young  We plan to implement this feature in 3.1-beta.1. Sorry for late response, could you please provide your emqx log file ?. Hi, @MyraBaba . Could you please give me more details, for example,\u3000How do you connect to emqx broker, which client do you use, how did you configure the keepalive value of the connection you created.. This is keepalive mechanism in mqtt connection, it looks like you the keepalive value you set for emqx is too long. so it would trigger the error {shutdown, timeout}. . How many connections did you establish? Could you please describe your scenario more detailed?. Of course, you can! http://emqtt.io/docs/v3/rest.html#subscriptions. @boboxiaodd Sorry,  what is the diffect qos do you mean?. Sorry, after discussion, we decide not to implement the feature you want.. Hi, @raceli , Of course, yes, the open source edition of emqx does not support the data persistence. It just store messages in memory, if you want the feature that support hold on messages on disk, you have to try our enterprise edition of emqx, you could contact with @zhengyupan for more details.. Hi, @Marina190489 , First, did you send mqtt packet via ip \"10.185.125.162\". Second, which port did you connect to emqx broker with mqtt client. Third, did you set enable_acl=off? Finally, could you please tune the log.level to debug and then try with your acl.conf and emqx.conf again. Then send your log file to my email. It would help me dig into your problem.. Please open issue with english.. Sorry, @claymcenter , I do not understand the 1.1 mn you said. Could you please give me a more clear declare?. Hi, @callbay , Thanks for your contribution. However, It seems that the base branch you forked is too old, our develop branch is emqx30 now. Could you please fork the branch emqx30 and pull request again? . Sorry for our ill-defined documents. We would improve it as quick as possible.. Hi, @Bruce-Tian . Could you please give me more details? Such as your scenario, log file, crash.log and etc/emq.conf, which would help use dig into your problem.. Which emqx version did you use? . Hi, @theronic , as the emqx user, you have to design your topic filter by yourself based on your real requirement.. So sorry for so late response, I'm very busy these days and I would dig into the issue you opened today or tomorrow.. Hi, @s4kibs4mi , which log level do you set in etc/emqx.conf ? Did you set it to error?. Hi, @ioncamera, First, please open your issue with English, it would help English users who encountered the same issue. Then, the log you left above shows that the time interval between two heartbeat packets exceed the keepalive value you set for the connection. . Hi, @victorclaessen , execute ps aux | grep emq and please show me the result. And please show me the etc/emq.conf which you have modified. I would help you resolve this issue.. It's weird. I tried to reproduce the problem you encountered. \n Look! It works well. According to the nslookup result you provide above, I see that the myserver.mydomain.nl has multiple corresponding ip addresses, 192.168.14.1 and 192.168.14.214, which one is the actual ip address of the machine where you run emqx on ?. 192.168.14.224 is that your server ip address? Replace your node name with emq@192.168.14.224 and try again.. It's weird to me too because I can not reproduce your problem on my machine, I have a question, did you start your emqx first, then config dns resolve in /etc/hosts ? . You can get into emqttd shell mode by emqttd console and then execute inet:gethostbyname(\"myserver.mydomain.nl\"). Then tell me what happened.. Are you sure? @victorclaessen , this command must return the value {ok, Hostent} or {error, posix()}.. \nHey, look the result. The myserver.mydomain.nl was resolved to 192.168.14.224, not 192.168.14.214. This is the bug of your client, please check your code and your mqtt sdk again.. It has been implemented. Thanks for your guys advice. :). Thanks for your feedback, it definitely is a bug. I will fix it soon.. It has been fixed and there would be no such problem in emqx 3.0.1 release.. @chrysa95 Hi, how do you insall your emqx broker, what is your os ? Which emqx version do you use ? Maybe you need add more details on your issue.. If you use emqttd v2.3.11, they should be emqttd, emqttd_ctl, emqtt.cmd and so on.. Did you start mysql and config your emqx_auth_mysql.conf correctly? Which mysql version do you use?. Yes, you are right, I'll fix it in next edition.. It has been fixed, and there would no such problem in emqx 3.0.1 release.. You can not use docker, you have to git clone emqx_rel repo and modify the code according to your requirements.. We have upgrade ws module from mochiweb to cowboy in emqx 3.0. Could you please try with the latest edition of emqx ? Maybe this issue has been resolved in latest emqx.. It looks that emqx start successfully and then something happened and emqx process be killed. So the ./emqx_ctl status response with \"Node 'emqx@127.0.0.1' not responding to pings\". Sorry, I can not reproduce this issue, which emqx version do you use ?. We have tried with emqx-ubuntu16.04-v3.0.0.zip on ubuntu 16.04, we can not reproduce this situation, could you please tell me more details?. Maybe you could try to upgrade your bash to solve this problem.. I tried to unzip emqx on ubuntu 16.04, there is no such problem you referred in this issue. I suppose some thing wrong in your environment. Sorry, I can not help you solve this problem.. Please try with the latest emqx edition. This problem should be resolved. . Hi, @wajidp , How do you install emqx on your centos7 ? Did you install emqx via rpm ?. I have reproduced this problem, sorry for our careless work. We would fix it as soon as possible.. Sorry, It is not emqx bug, you have to upgrade you open ssl library on your cent os.. After I upgrade all packages on cent os 7 via yum update, there is no such problem again.\n\n. The path which run emqx should not contain space character or hyphen.. Sorry, we have no plan to expose all mqtt topics for prometheus now. . Could you please tell me how did you configure the ldap server on your local machine? . emqx_auth_ldap.conf itself doesn't configure ldap server, you have to configure your ldap server according to the readme.. You have to configure the ldap itself, this config file is used to config the emqx-auth-ldap plugin.. And please provide your log file.. @wajidp Could you please set log level to debug and run again? The info you provide isn't not enough for me to dig into your problem.. It means there is no such object dcadministrator in your ldap server.. In ldap, we use uid to represent username rather objectclass, maybe you need to read ldap docs to learn which is a better schema design in ldap.. Ok, I never tried with microsoft ldap and emqx-auth-ldap is not designed for ms ldap, sorry I can't help you.. @WooHao If you use microsoft ldap, there is no solution. We have no plan to adapt ms ldap server.. Could you please tell me how about your host hardware and give me the log file generated by emqttd?. I want all the log files, please zip them into one package.. Sorry, the crash log file you gave me is a 0 byte file, I'm not sure whether it is that insufficient memory to cause this problem. How many connections maintained by your emqttd ?. It is definitely abnormal. Please give me your crash log file\nGilbert Wong\nOn Jan 29, 2019, 3:01 PM +0800, Zhang-Xianglong notifications@github.com, wrote:\n@Gilbert-Wonghttps://github.com/Gilbert-Wong less than 200\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/2190#issuecomment-458429495, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-01VaRDrcIn9euHSRwDxQe-hBec7wks5vH_HggaJpZM4aXJuQ.\n. Did you reproduce the problem with default configuration ? . Hi, @kaido42 .It has been fixed.. Sorry, this REST API has been deprecated in emqx 3.0.1 release now. We'll discuss about it whether to restore this api.. It has been implemented in emqx 3.1 beta.2. In the latest implementation of emqx cluster mode, one client/session just exist in one node, it would not be backup or migrated in different nodes. We would redesign it in the future.. Please try with git reset --hard and make distclean , then make project again.. Hi, @drPytho, which mqtt client do you use ?. It seems that it is the mqtt client you written by yourself. I suppose there is something wrong in your code. You could try with mosquitto to test emqx. . This feature both exists in open source edition and enterprise edition.. I have seen the pull request you opened under emqx-lua-hook project. There is still some small mistakes in your code. I would help you improve it. Anyway,thanks for your contribution. This bug has been fixed.. Hi, @archerian , how do you config the item mqtt.max_packet_size ?. Yes :). May this doc could help you. https://developer.emqx.io/docs/emq/v3/en/deploy.html#load-balancer-lb. Sorry @archerian , this feature is supported by emqx. There is notion called zone in emqx3.0. \n\nThe keyword external means that it is a listener of external zone. You could listen on multiple ports via creating multiple zones.. Thanks for your advice, we'll take it into consideration.. I suggest you to start emqx via emqx.cmd start on windows.. If you want to start emqx on windows , the path you place emqx should not contain space, you could place emqx in root directory of C disc. For example, C:\\emqx. Anyway, it is not a good choice to run emqx on windows. I suggest you to run emqx on linux.. For now, yes, we\u2019ll improve this implementation in emqx 3.1 beta1\nGilbert Wong\nOn Feb 22, 2019, 11:28 PM +0800, horowitzb notifications@github.com, wrote:\napparently when I enter ./bin/emqx_ctl bridges start aws, I get start bridge successfully.. the aws bridge seems to be defined in the emqx.conf file, so maybe I should make a new section in emqx.conf for every bridge I want to make?\n\u2014\nYou are receiving this because you were assigned.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/2223#issuecomment-466435739, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-0x47LI0v_RaObUirdcl55dlQdWL_ks5vQAyRgaJpZM4a8JV3.\n. Thanks for your advice @spring2maz very much \ud83d\udc4d . The flapping module is still draft. I would take your advice into consideration seriously. . This branch was git branch from testing branch and is too old to have conflicts.. Please open issue with English and provide more details.. Has been fixed in 3.1-beta.1.. Sorry, @AliakseiMat , we have no schedule to implement this feature now.. First, I do not recommend you to run emqx on windows server. Linux server is a better choice for emqx. Second, you should place emqx on windows path which could not contains - and ' ' and then execute emqx.cmd console to launch emqx.. Because there are some problems in windows package of emqx. We'll improve it as soon as possible.. Hi, @enrahmad. You can not join nodes from different cluster into one cluster.. Sorry, impossible.\nGilbert Wong\nOn Feb 26, 2019, 8:49 PM +0800, Marina190489 notifications@github.com, wrote:\nIn version 2.1.1 is it possible to track the history of when the node was down or not responding to pings?\ntrying to debug a case where I know that the node didn't respond to pings but I need to know when it started.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/2268, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-0xrriB9_Xx6e88uNuxQtlWQTlzM3ks5vRS1hgaJpZM4bSGZr.\n. Sorry, neither.. Hi, @xpunch, for enterprise edition emqx enterprise, you have to contact with @zhengyupan. We do not do technique support of emqx enterprise on github.. Sorry for late response. Which kind of communication between EMQ and Aliyun you want ?. Sorry, for now, emqx-sn plugin does not support DTLS. We'll support DTLS in the future.. Hi, @kscorpio , sorry for late reply. The bridge.edge.type should be auto or manual.\nThis feature would be fixed in 3.2.. Yes, in your scenario, you should disable the EMQX_ACL_NOMATCH=deny or modify the acl rule. You could refer our official doc.. Hi, @h00s , it has been fixed in emqx3.1 beta2 release. . Neatly implemented \ud83d\udc4d . > Unrelated failure. dep vsn check failed. Why did that fail?\nHas been fixed in erlang.mk.. It is weird that pr ci passed but the push ci failed. @phanimahesh . Of course.. This is exactly bug, @HJianBo is working on it. Thanks for your guys feedback.. Hi, could you please tell me the topic you subscribed ?\nGilbert Wong\nOn Mar 14, 2019, 1:43 AM +0800, Arun Kirthi Cherian notifications@github.com, wrote:\nEnvironment\n\nOS: Centos 7\nErlang/OTP: R21/10.2.1\nEMQ: v3.1-beta.1\n\nDescription\nI have two brokers in a cluster configuration behind a haproxy LB. I'm using mosquitto_pub to send test messages on a topic from another computer on the same network. On that computer, I have two mosquitto_sub clients listening to the same topic. When I send messages I notice only 1 of the two subscribed clients get the message sent via mosquitto_pub. It isn't the same client every time, but only one client gets the message each time.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/2310, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-0963i90s_KtaGySiKEaEcpMq8-akks5vWTihgaJpZM4buAir.\n. It has been implemented in emqx 3.1-beta2.. It has been fixed in emqx3.1 beta2. Thanks for your feedback.. It seems that pr ci failed. I would dig into the reason.. Could you please provide more details? Such as log files and configure file?. Yeah, this bug exactly existed in 3.0.1, but in latest release of emqx. It has been fixed.. Yes, you could try with emqx 3.1 beta2.\nGilbert Wong\nOn Mar 18, 2019, 9:35 AM +0800, Jo\u00e3o Gustavo Balestrin dos Santos notifications@github.com, wrote:\nIs the beta case already fixed?\n\u2014\nYou are receiving this because you were assigned.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/2321#issuecomment-473739471, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-01tqHk-0qBQJtxGxDBnDWesnLuAGks5vXu1dgaJpZM4b3zgv.\n. Sorry for our lagging documents. For now , there is no such docs. But we would improve it as quickly as possible.\nGilbert Wong\nOn Mar 18, 2019, 9:40 AM +0800, Jo\u00e3o Gustavo Balestrin dos Santos notifications@github.com, wrote:\nThank you. A doubt. Is there any documentation that directs me to migrate one version to another?\nFor example, a beta for stable.\n\u2014\nYou are receiving this because you were assigned.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/2321#issuecomment-473740221, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-0-9KYOWAd-C9inZZg2U8qvPd3_2_ks5vXu6ggaJpZM4b3zgv.\n. The community edition (opensource edition) of emqx does not support LoRaWAN now..  Cool! appreciate that you solve your issue by yourself.. We have fixed this problem and release a fixed beta2 yesterday.. The mqtt 5.0 specification did not specifed the wildcard_not_allowed_as_response_topic error. So I supposed it is unnecessary to add this information.. Additional information should be included in User Properties or Reason String.. Reason String is the  property of MQTT5.0 packet. Usually,  broker uses this property to give additional information to the Client.. Yes. @emqplus said it is unnecessary to add reason string in case of protocol_error, we need to discuss it  before next milestone.. I push code to let my collegue see the code, there are still many problems in this code. I know that.. It is draft.\ud83d\ude02. Yes, you are right. :). Yes, good idea.. Good idea.. I didn't add spec for this receive_response function.. Great recommendation. Yes, I still used erlang-mode in emacs to indent code here. It is exactly odd.. How many spaces is a good practice?. Sorry, this is caused by batch modifying response_information to request_handler. I didn't check it carefully.. Yes, what's wrong? . I supposed that it is better to print <<\"....\">> for topic filters.. No, you can't do like this because the parameters passed to the shared_topic function is Group and ResponseInformation, not Group and Topic what is MaybeGroup? A tuple or a binary? How to get this value?. It is convenient if the api user do not want to add other properties to the request packet.. Yes, of course.. So am i.. case and end should be aligned. And I suggest you to wrap your code. The code is too long in a line to read.. I suppose that it would be better to put this macro in emqx.hrl and could let more modules to use this macro.. The macro should be -define(LOG(Level, Format, Args, Header) and be put into emqx.hrl. It is ugly to put so many similar LOG macro in different modules.. Then you can use macro directly in trace function.. Why don't you abstract this macro? I don't think it is meaningful to define macro for each module.. Why ?. Use M:F:A to customize your format code.. I update the emqx_protocol code and restore emqx_session code. It's not necessary to update comment.. If retain the State, the compiler would warning that this Variable is unused.. No, it is not necessary to state that overriden config because this change just have effect on mqtt3.0 message.. There's no effect on mqtt 5.0 message. What is the difference between log level and primary log level?. Align case and end please.. emqx:config is a better choice. Could you please call this function with better name? It is obvious that the function you created is not the procedure to detect the connection state.. This item can not be named with enable_acl_connection. It is not a clear semantic meaning.. Description has grammar error.. If what enabled?. I suggest you to refer the description of other configuration items.. Maybe acl_reject_connection is better?. The typo of case and end.. emqx_config:get_env().. acl_kick_client. Why do you have to add blank lines here ?. These topic filters has been tested in other test suites, please don't add duplicated test suites.. Delete these lines you added.. acl_deny_action = diconnect | ignore. I have the same question with @terry-xiaoyu said.. ]}.. Typo problem.. Please follow advice of @terry-xiaoyu . Please don't start emqx for each test case.. Delete these comments.. Remove this print. Ok for me too. I suppose that there should be via, not viar. password and passsword ?. Why did you delete this config entry ?. I suppose that it is better to use logger:info to print drained msgs. log stacktrace. log stacktrace. error:Reason  print Reason and return Msg. where is low_watermark. os_mon.cpu_low_watermark. use 80% rather 0.8. sysmem_low_watermark. fold comment. recommend 60%. alarm rather alarm_desc. ensure_check_timer. Busy when Busy >  100* CPUHighWatermark ->. call(Req) ->\n   gen_server:call(?MODULE, Req, infinity).\n. Use bridge rather portal. Typo problem.. 2013-2019. {error, standing_by}. ?ALARM_TAB. migrate common_alarm to alarm_history. [{Id, Desc} || #common_alarm{id = Id, desc = Desc} <- Alarms].. ?LOG(warning, ). 2013-2019. Delete {socktype, _}. {Error, Reason} ->\n    ?ERROR(\"[Broker] Failed to forward msg to ~s: ~p ~p\", [Node,Error, Reason]),\n            Delivery;. What about\n```erlang\nfilter_results(Deliverys) ->\n    filter_results(Deliverys, []).\nfilter_results([], Acc) ->\n    Acc;\nfilter_results([Delivery | WaitDelivery], Acc) ->\n    filter_results(WaitDelivery, [filter_result(Delivery) | Acc]).\n        {badrpc, Reason} -> [{badrpc, Reason} | Acc], filter_results(WaitDelivery, Acc);\n        {badtcp, Reason} -> [{badrpc, Reason} | Acc], filter_results(WaitDelivery, Acc);\n        Delivery1        -> [Delivery1 | Acc], filter_results(WaitDelivery, Acc)\n    end.\n.\nformat(#message{id = Id,qos = QoS, topic = Topic, from = From, flags = Flags, headers = Headers}) ->\n```. IsProcessAlarm. set_flag when qos == 1 or qos ==2. ",
    "ghost": "@erylee I believe that what I am requesting in #252 is roughly the same as @roytan883 is requesting in here.\n. @erylee This doesn't seem to be working as described. I've clustered two nodes (let's call them n1 and  n2). Then, I connected one client to n1 and another one to n2. The client on n2 subscribed to topic/test and when client on node n1 published to topic/test, the message didn't get forwarded to the client on n2. Can you confirm this behaviour? I'm using the 0.9.1 tag.\n. @erylee This seems to be working now (0.9.3-alpha). I could not achieve this behaviour with 0.9.1, however. Was it something introduced on the new release?\n. @erylee I cannot close as I was not the one who originally opened it.\nHowever, and as I said, this was not working previously, so something must have been done about it in a release since 0.9.1 (perhaps 0.9.2-alpha, then).\n. @erylee In my case, I have an auth plugin (emqttd_auth_ext) which has the following dependency tree:\nemqttd_auth_ext\n|\n|--> ext\n     |\n     |--> base64url\n     |--> jiffy\nI can load emqttd_auth_ext correctly, but as soon as the first call to ext takes place, emqttd complains. None of ext, base64url and jiffy are loaded on the console.How can I get around this?\n. @erylee Thanks! I had already come across that module, but I believe it does a different thing. What I would need is to create a (non-clean) session for a given client ID (if none exists yet) and subscribe that client to a bunch of topics \"remotely\" from my Java application.\nI need this because I need offline messaging to work for a given user even if they have never connected to the broker (e.g., a newly created user someuser would receive all messages sent to chat/someuser upon the first connection). I could sort of do it with retained messages, but that's not quite what I want.\nIs there any way this could be included in a future release?\n. @erylee It would be really great if this could be done via, for example, the HTTP API (create a persistent session for a given client ID and subscribe it to a given topic even if it has never connected before). Would allow for a couple of nice things in my scenario :-)\nEven if you don't want to include this feature in the codebase, would you help me implementing it via a plugin or something?\n. @erylee That's great :-) Do you have any idea on when you can start working on it? (Y)\n. @erylee That would be great :-) If you want to hang on Freenode or something to discuss this just let me know ;-)\n. @erylee Have you been making any progress on this? Do you need any input?\n. @erylee My idea for this would be to create the persistent subscription by CLI or HTTP, as you say. Then, clients would retrieve offline messages the first time they connect. That would be the whole point :-)\n. No, nothing is printed in the logs.\nOn Fri, Aug 21, 2015, 01:54 Feng Lee notifications@github.com wrote:\n\nAny error logs when authentication with your plugin?\n\n\u5728 2015\u5e748\u670821\u65e5\uff0c\u4e0a\u53481:49\uff0cBruno M. Cust\u00f3dio notifications@github.com \u5199\u9053\uff1a\nWith the new plugin architecture, a custom-written authentication plugin\nthat was working flawlessly under 0.9.3 stopped working in 0.10.0. I\nmodified the plugin so as to include the etc/plugin.config configuration\nfile and imported it according to the wiki's instructions, but it just\ndoesn't work. Do I need to modify anything in the Erlang code itself? Did\nthe hooks change?\nWhen I run bin/emqttd console I get\nHi!\n18:39:34.583 [info] started Apps: [emqttd_auth_custom]\n18:39:34.583 [info] load plugin emqttd_auth_custom successfully\nbeing that Hi! is written by the plugin on init/1. However, when I try\nto connect to the broker, the authentication tokens that used to work do\nnot work... It seems that the plugin isn't being used for authentication.\nHow can I make it work?\n\u2014\nReply to this email directly or view it on GitHub <\nhttps://github.com/emqtt/emqttd/issues/254>.\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/254#issuecomment-133232463.\n. Even if I use the following inside the plugin, nothing is printed when I\ntry to authenticate and the connection is refused:\n\ncheck(_, _, _) ->\n  io: format(\"check was called\"),\n  ok.\nOn Fri, Aug 21, 2015, 02:48 Bruno Miguel Cust\u00f3dio bruno@brunomcustodio.com\nwrote:\n\nNo, nothing is printed in the logs.\nOn Fri, Aug 21, 2015, 01:54 Feng Lee notifications@github.com wrote:\n\nAny error logs when authentication with your plugin?\n\n\u5728 2015\u5e748\u670821\u65e5\uff0c\u4e0a\u53481:49\uff0cBruno M. Cust\u00f3dio notifications@github.com \u5199\u9053\uff1a\nWith the new plugin architecture, a custom-written authentication\nplugin that was working flawlessly under 0.9.3 stopped working in 0.10.0. I\nmodified the plugin so as to include the etc/plugin.config configuration\nfile and imported it according to the wiki's instructions, but it just\ndoesn't work. Do I need to modify anything in the Erlang code itself? Did\nthe hooks change?\nWhen I run bin/emqttd console I get\nHi!\n18:39:34.583 [info] started Apps: [emqttd_auth_custom]\n18:39:34.583 [info] load plugin emqttd_auth_custom successfully\nbeing that Hi! is written by the plugin on init/1. However, when I try\nto connect to the broker, the authentication tokens that used to work do\nnot work... It seems that the plugin isn't being used for authentication.\nHow can I make it work?\n\u2014\nReply to this email directly or view it on GitHub <\nhttps://github.com/emqtt/emqttd/issues/254>.\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/254#issuecomment-133232463.\n. It seems like the plugin is loaded but not being called on auth.\n\n\nOn Fri, Aug 21, 2015, 02:54 Bruno Miguel Cust\u00f3dio bruno@brunomcustodio.com\nwrote:\n\nEven if I use the following inside the plugin, nothing is printed when I\ntry to authenticate and the connection is refused:\ncheck(_, _, _) ->\n  io: format(\"check was called\"),\n  ok.\nOn Fri, Aug 21, 2015, 02:48 Bruno Miguel Cust\u00f3dio \nbruno@brunomcustodio.com wrote:\n\nNo, nothing is printed in the logs.\nOn Fri, Aug 21, 2015, 01:54 Feng Lee notifications@github.com wrote:\n\nAny error logs when authentication with your plugin?\n\n\u5728 2015\u5e748\u670821\u65e5\uff0c\u4e0a\u53481:49\uff0cBruno M. Cust\u00f3dio notifications@github.com \u5199\u9053\uff1a\nWith the new plugin architecture, a custom-written authentication\nplugin that was working flawlessly under 0.9.3 stopped working in 0.10.0. I\nmodified the plugin so as to include the etc/plugin.config configuration\nfile and imported it according to the wiki's instructions, but it just\ndoesn't work. Do I need to modify anything in the Erlang code itself? Did\nthe hooks change?\nWhen I run bin/emqttd console I get\nHi!\n18:39:34.583 [info] started Apps: [emqttd_auth_custom]\n18:39:34.583 [info] load plugin emqttd_auth_custom successfully\nbeing that Hi! is written by the plugin on init/1. However, when I try\nto connect to the broker, the authentication tokens that used to work do\nnot work... It seems that the plugin isn't being used for authentication.\nHow can I make it work?\n\u2014\nReply to this email directly or view it on GitHub <\nhttps://github.com/emqtt/emqttd/issues/254>.\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/254#issuecomment-133232463.\n. OK, I will do so in a few hours time and post back the results. Thanks for\ntaking the time to investigate :-)\n\n\n\nOn Fri, Aug 21, 2015, 03:04 Feng Lee notifications@github.com wrote:\n\nPlease check if the auth_mod is registered successfully. For example in\nemqttd_plugin_mysql:\nok = emqttd_access_control:register_mod(auth, emqttd_auth_mysql, {AuthSql, HashType}),\nOr dump all the auth modules on console:\n(emqttd@127.0.0.1)1> emqttd_access_control:lookup_mods(auth).\n[{emqttd_auth_anonymous,[]}]\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/254#issuecomment-133245991.\n. Here's what I get from emqttd_access_control:lookup_mods(auth).:\n\n(emqttd@127.0.0.1)1> emqttd_access_control:lookup_mods(auth).\n[{emqttd_auth_custom,{state,<<\"Test!\">>}}]\nAlso:\n(emqttd@127.0.0.1)2> emqttd_plugins:list().\n[{mqtt_plugin,emqttd_dashboard,\"0.1\",\"emqttd web dashboard\",\n              [{emqttd_dashboard,[{listener,{emqttd_dashboard,18083,\n                                                              [{acceptors,4},{max_clients,512}]}}]}],\n              true},\n {mqtt_plugin,emqttd_plugin_custom,\"1\",\n              \"eMQTT Custom Authentication\",\n              [{emqttd_plugin_custom,[{test_args, \"Test!\"}]}],\n              true},\n {mqtt_plugin,emqttd_plugin_template,\"0.1\",\n              \"emqttd plugin template\",\n              [{emqttd_plugin_template,[]}],\n              false}]\nThe module seems to be loading OK. However, when I try to connect to the broker it doesn't seem to be called.\n. @erylee after a few hours struggling with this I managed to get it working. I'm still not quite sure what was wrong, though --- I changed the plugin's structure to match emqttd_plugin_mysql and it started working. I guess I'll close the issue.\n. @erylee I've attached the logs.\n. @erylee Do you need full logs?\n. @erylee Here's what I've got:\n```\n(emqttd@n2)1> 15:46:21.339 [debug] Retained Message(MsgId=undefined, PktId=undefined, from=broker, Qos=0, Retain=true, Dup=false, Topic=$SYS/brokers/emqttd@n2/version)\n15:46:21.339 [debug] Retained Message(MsgId=undefined, PktId=undefined, from=broker, Qos=0, Retain=true, Dup=false, Topic=$SYS/brokers/emqttd@n2/sysdescr)\n=ERROR REPORT==== 16-Sep-2015::15:46:29 ===\n    application_master: shutdown_error\n    emqttd_app: {prep_stop,[[]]}\n    error_info: {timeout,{gen_server,call,\n                                     [application_controller,\n                                      which_applications]}}\n=INFO REPORT==== 16-Sep-2015::15:46:29 ===\n    application: emqttd\n    exited: stopped\n    type: permanent\n15:46:29.322 [info] stopped http on 0.0.0.0:8083\n15:46:29.322 [info] stopped mqtts on 0.0.0.0:8883\n15:46:29.322 [info] stopped mqtt on 0.0.0.0:1883\n15:46:29.323 [info] stopped http on 0.0.0.0:18083                                                                                                                                                                                     [12/1858]\n=INFO REPORT==== 16-Sep-2015::15:46:29 ===\n    application: esockd\n    exited: stopped\n    type: permanent\n=INFO REPORT==== 16-Sep-2015::15:46:29 ===\n    application: gproc\n    exited: stopped\n    type: permanent\n=INFO REPORT==== 16-Sep-2015::15:46:29 ===\n    application: mnesia\n    exited: stopped\n    type: temporary\n15:46:29.360 [info] mnesia connected to extra_db_node 'emqttd@n1' successfully!\nstarting emqttd on node 'emqttd@n2'\nemqttd trace is starting...[done]\nemqttd pooler is starting...[done]\nemqttd client manager is starting...[done]\nemqttd session manager is starting...[done]\nemqttd session supervisor is starting...[done]\nemqttd pubsub is starting...[done]\nemqttd stats is starting...[done]\nemqttd metrics is starting...[done]\nemqttd broker is starting...[done]\nemqttd alarm is starting...[done]\nemqttd mode supervisor is starting...[done]\nemqttd bridge supervisor is starting...[done]\nemqttd access control is starting...[done]\nemqttd system monitor is starting...[done]\n15:46:29.473 [info] load module presence successfully\n15:46:29.478 [info] started Apps: []\n15:46:29.478 [info] load plugin emqttd_dashboard successfully\n15:46:29.478 [info] started Apps: []\n15:46:29.478 [info] load plugin emqttd_plugin_customauth successfully\n15:46:29.479 [info] mqtt listen on 0.0.0.0:1883 with 16 acceptors.\n15:46:29.480 [info] mqtts listen on 0.0.0.0:8883 with 4 acceptors.\n15:46:29.480 [info] http listen on 0.0.0.0:8083 with 4 acceptors.\nErlang MQTT Broker 0.10.0 is running now\n```\nThe plugin is loaded, but doesn't seem to be initialized, as no message from the plugin itself is displayed (and should).\n. @erylee After I unload/load the plugin, I get this:\n=INFO REPORT==== 16-Sep-2015::15:49:40 ===\n    application: emqttd_plugin_jwt\n    exited: stopped\n    type: temporary\n15:49:40.689 [info] stop plugin emqttd_plugin_customauth successfully\n15:49:47.431 [info] Initing 'eMQTT custom authentication'.\n15:49:47.431 [info] started Apps: [emqttd_plugin_customauth]\n15:49:47.431 [info] load plugin emqttd_plugin_customauth successfully\n. @erylee I compiled it from the v0.10.0-beta tag (not from master). I will update the version to the latest tag and report back as soon as possible :-)\n. @erylee Sorry, I could only confirm this today. Fixed as of 0.10.4-beta :-)\n. @erylee I need the broker's timestamp. What I was asking is if there is an easy way to modify the payload of any PUBLISH packets to include this timestamp, say, as the first 8 bytes.\n. @erylee That's exactly what I was looking for. Seems like it is working in my case :-) Many thanks.\n. @erylee I guess now the only notable case in which I can't inject the timestamp is in the payload of the Last Will and Testament. Is there any hook in place for when this particular message is delivered?\n. @erylee I understand :-) Many thanks!\n. @erylee worked like a charm! Many thanks!\n. @erylee I'd put my money on Cassandra. That would be great as you get a lot of benefits you don't get with LevelDB or a custom storage.\n. @erylee I would still go for Cassandra. Or, better yet, implement \"agnostic\" persistence and an adapter/plugin for Cassandra and another one for LevelDB. I don't know LevelDB enough, but do you get any replication/high-availability out-of-the-box with it?\n. BTW, this happens in both  0.11.0 and 0.12.1.\n. @erylee it may be interesting to notice that I can work around this by first unsubscribing from msg/# and then re-subscribing it. However, this is a workaround I would prefer not to use.\n. @erylee no problem at all :-) Hope the trip went well :-)\nI have re-read the protocol spec now and, indeed, I see no mention as to whether retained messages should be re-delivered in case of a non-clean session\u2014so this might indeed be expected.\nHowever, it would be great if the broker's behaviour could be extended to support this\u2014the way I see it the protocol leaves this matter open, so it could be implemented as an extension.\nWhat do you think? Do you agree?\n. @erylee that would be great indeed :-)\n. I just wrote a simple Java application that uses an MQTT client (Paho) and connects to the broker. Then, it issues 10 SUBSCRIBE packets with a variable number of topic filters inside (each of those log lines corresponds to a SUBSCRIBE request).\n. Hi,\nThe above given solution did not work for me.I am also looking solution for the same problem.\nI am using the latest build and I udpated the emqttd.config file with the above given solution but the the issue still there.\nPlease help me in this issue\n. I didn't see anything about persistence in the documents, so I guess you have not updated it yet. My question is: is there any way of configuring the persistence of retained messages?\nIn our case we are interested in not persisting those messages. We can delete the file retained_message.DCD manually to achieve the same result, but ideally this should be configurable. \n. I am currently testing removing the slashes in front of the href urls\nfind -name \"*.html\" -exec sed -i 's/href=\"\\/#/href=\"#/g' {} \\;\nsed -i 's/href=\"\\//href=\"/g' http_api.html\nresult:\na global url prefix should do it. ",
    "benjamin658": "I solved this problem by using haproxy as /api/sessions API load balancer, and polling every broker in the cluster to get the session list, this may not be the best solution, but for now I need to know actual number of the sessions... hope it will be supported soon.\n. ",
    "behrad": "great @erylee \n1. Is it good to publish those events into $SYS so that all interested clients would sub for them? or should I write Erlang code to get them?\n2. Do you have any estimates when it may be available for tests?\n. nice @erylee I'll try it out.\nHave you ever successfully tried to go over 65K client connections with in a single machine? adding extra ip addresses as localAddresses but couldn't get it to work...\nthat way we need tons of client machines!!!\n. Great @erylee \nI've reached 150K connections on a 12core machine with 12G RAM with Mosca on centos7 so far, but think I can go further with more memory... my limits are clients now, I should test if docker can solve this.\nDo you mind sharing kernel/network tunings?\n. this is mine:\n```\n  fs.file-max = 999999\nnet.core.rmem_max = 16777216\n  net.core.wmem_max = 16777216\n  net.core.rmem_default = 16777216\n  net.core.wmem_default = 16777216\n  net.core.optmem_max = 2048000\n  net.core.somaxconn = 65000\n  net.core.netdev_max_backlog = 50000\nnet.ipv4.tcp_rmem = 4096 4096 16777216\n  net.ipv4.tcp_wmem = 4096 4096 16777216\n  net.ipv4.tcp_max_syn_backlog = 30000\n  net.ipv4.tcp_max_tw_buckets = 2000000\n  net.ipv4.tcp_tw_reuse = 1\n  net.ipv4.tcp_fin_timeout = 10\n  net.ipv4.conf.all.send_redirects = 0\n  net.ipv4.conf.all.accept_redirects = 0\n  net.ipv4.conf.all.accept_source_route = 0\n  net.ipv4.tcp_slow_start_after_idle = 0\n  net.ipv4.ip_local_port_range = 8000 65535\nnet.netfilter.nf_conntrack_max = 1000000\n  net.netfilter.nf_conntrack_tcp_timeout_time_wait = 30\nvm.min_free_kbytes = 65536\n  vm.swappiness = 0\n  vm.overcommit_memory = 1\n``\n. how much memory wereemqttconsuming when reaching 200K? what showedfree -m`\nI've written both in node.js and Erlang, and believe both are GOLD :dancer: \nhowever node.js should be more memory hungry than Erlang optimized VM. \n. > I\u2019d like to share with your project if you want to benchmark Mosca.\nso helpful, can I install iojs on them to load my broker instance?\n. a process on each core!\neach node.js process is a single thread (single core) event loop. Using builtin cluster https://nodejs.org/api/cluster.html module you can scale up to multicores, 1 process/core is a normal model for typical apps.\nI believe both Erlang pseudo-threads and node's epoll based non-blocking event driven event loop are very powerful concurrency models with their own characteristics.\n. Mohammad Jan,\nYou can find how to join nodes here http://docs.emqtt.com/en/latest/cluster.html\n. I'm afraid Mohammad, you will need at least one disc node to be able to setup cluster. I again refer you to read documentation in more details.\n. > but i can't create ram_node\nare you getting any errors?\n. Is EMQ enterprise edition downloadable to be used free of charge @emqplus ?. > so we can't deliver the offline messages when the client is connected again?\nIf broker is restarted, then NO! client won't receive offline messages, since they are not persisted.. ",
    "vleushin": "Looking forward to it. Could you give some hints how to properly do it? Should it be just plugin with hook or should it be module? I looked at https://github.com/helpshift/ekaf and it looks as good candidate to handle Kafka protocol\n. ",
    "vowstar": "You can try this emqttd_plugin_kafka_bridge plugin, which can publish messages from emqttd to kafka topic\nhttps://github.com/vowstar/emqttd_plugin_kafka_bridge\n. You can try this emqttd_plugin_kafka_bridge plugin, which can publish messages from emqttd to kafka topic\nhttps://github.com/vowstar/emqttd_plugin_kafka_bridge\n. @mkj-git It's just same as other plugin's usage. Provide compiled version is OK but you need match your mqttd version. And, this plugin is plug & play as other plugin does.\n. You should tune your host machine to support more clients.\nhttp://emqtt.io/docs/v2/tune.html. @arvindr21 Which version of your docker and linux kernel?\n```\nget docker version\ndocker -v\nget linux kernal version\nuname -a\n```. @shsjshentao I've tested emq SSL and it is no problem with esp8266.\nPlease provide which SDK you use under esp8266?(ESP_NONOS_SDK or ESP_RTOS_SDK?)\nAnd provide the SDK version.\nNote: please try espconn_secure_set_size before espconn_secure_accept, and set SSL buffer size to 8192.\nespconn_secure_set_size\nFunction: \nSet buffer size of encrypted data (SSL)\nNote:\nBuffer size default to be 2Kbytes. If need to change, please call this API before\nespconn_secure_accept (ESP8266 as TCP SSL server) or espconn_secure_connect (ESP8266 as\nTCP SSL client)\nPrototype:\nbool espconn_secure_set_size (uint8 level, uint16 size)\nParameters:\nuint8 level : set buffer for ESP8266 SSL server/client:\n0x01 SSL client;\n0x02 SSL server;\n0x03 both SSL client and SSL server\nuint16 size : buffer size, range: 1 ~ 8192, unit: byte, default to be 2048\nReturn:\ntrue : Success\nfalse : Failure\nEMQ support TLS1.1 and TLS1.2, the default SDK only support TLS1.1.\nIf you want use TLS1.2, you can try mbedtls, it support TLS1.2.\nNote: SSL (may) required 20kB of esp8266 ram. Please check heap before do SSL.\n. Hi Michael, \nThis emq docker image is based on alpine linux, so it have not bash. But, you can try ash instead of bash, just remove a letter \"b\".\n```bash\ndocker run --rm -ti emqtt:latest ash\n```\nIf you want run bash not ash, just enter image, and run\n```bash\napk update && apk add bash\nbash\n```\nThen you get bash.. Please go to here to create a new issue:\nhttps://github.com/emqtt/emq-docker/issues/new\nPlease add more information about:\nMake sure you read and understand http://emqtt.io/docs/v2/index.html.\nUse one of the two templates below and delete the rest.\n\n[ ] BUG REPORT\n[ ] FEATURE REQUEST\n\n\n\nBUG REPORT\n\nExpected behavior\nActual behavior\nTest code\nProvide a Minimal, Complete, and Verifiable example which will reproduce the problem.\n```bash\nadd code here\n```\nEMQ version\nWhich branch are you on? If you know the Git revision then add it here as well.\nDocker version\nWhich docker-engine version?\nbash\ndocker -v\nHow docker info?\nbash\ndocker info\nSystem\nWhat system do you use?\nHardware\nHow is the host machine?\n\n\nFEATURE REQUEST\n\nMissing feature\nJustification\nTell us why you would like to see this feature added.\nWorkarounds\nAre there any workarounds you currently have in place because the feature is missing?\n. ",
    "wuqunfei": "Hi guys, all these plugins are removed into business version, so you delete all.\nso sad, I would like to try the business version, is there any trial-Version to test?. @emqplus so nice to hear, let me understand emq-auth-http and learn some basic skill erlang to start it. I will keep working on it.. ",
    "MQ-EL": "I have already readed this two links in many times(forgive my bluntness). \nDoes it can _reconfig_ bridge dynamicly when it has already started?\nerlang\nemqttd_bridge_sup:start_bridge(Node, SubTopic)\nWhen broker started, it can't know what topic subscribed by device in future. The bridge may need to add/remove some topic in the fly.\nBTW, could I use a bridge between two clusters(replicate topic mode) for relay msg? \nExpect your reply!\n. I think the replication mode will meet a bottleneck with topic tree increasing. we can narrow the scope of the devices (who need communication with each other) in one cluster, and open the bridge for cross-clusters. But this way may need to change the topic of bridge in the fly, the admin commands may not be the best solution IMG. I hope change the relayed topic of bridge when needed in the runtime by the code :) \nThanks for your reply!\n. ",
    "berrywira": "same with my problem. +1 \n. Thanks +1\n. Hi,\nwhen emqttd was stable, it will same deploy manually?\n. Ok Thanks. :)\n. 1. whether emqttd will support persist messages soon?\nsorry, I don't know what you mean inconsistent_schema\n2. what I mean is, I have 3 emqttd in one cluster, I stop one emqttd in the cluster, after that I pub message to another emqttd in the same cluster. when I start again the stoped emqttd, all emqttd in the cluster crash.\n. Thanks :+1: \n. Spec :\nMQ 0 with my intern service for add timestamp message for client.\nMQ 1 Connect to Client A.\nMQ 2 Connect to Client B.\nStart all service emqttd, and test pubsub, all can run well.\nMy step reproduce error :\nStop MQ2, Client B offline. Client A pub messages. and then MQ2 start, MQ2 join cluster to MQ1 manual ,Client B online and not receive any message from Client A. \nAfter that all MQ cannot pubsub. and must delete dir Mnesia.\nAnd I got error emqtt_error.log :\n07:55:36.164 <0.395.0> [critical] Session qWWdGwHW@<0.504.0> died unexpectedly!\nand emqttd_info.log :\n07:56:16.356 <0.395.0> [critical] Session qWWdGwHW@<0.504.0> died unexpectedly!\n07:56:16.356 <0.585.0> [info] Client XX.XX.XX.XX:11201 terminated, reason: {shutdown,session_died}\n07:56:16.356 <0.585.0> [info] Protocol shutdown session_died\n07:56:16.430 <0.586.0> [info] Connect from XX.XX.XX.XX:11233 -> YY.YY.YY.YY:1883\n07:56:16.448 <0.586.0> [info] RECV from qWWdGwHW@XX.XX.XX.XX:11233: CONNECT(Qos=0, Retain=false, Dup=false, ClientId=qWWdGwHW, ProtoName=MQIsdp, ProtoVsn=3, CleanSess=false, KeepAlive=60, Username=undefined, Password=undefined)\nXX.XX.XX.XX --> my ip client\nYY.YY.YY.YY --> Emqttd IP \nBy the way, What the command for show list schema like this?\n\n. Hi @erylee \nHow with this issue? \nWhether you cannot reproduce?\n. Memory consumed :\n\nConnection value :\n./emqttd_ctl stats\nsubscribers/max: 287\ntopics/count: 321\nclients/count: 29\ntopics/max: 321\nqueues/count: 0\nsessions/count: 42\nsessions/max: 42\nqueues/max: 0\nclients/max: 34\nsubscribers/count: 287\nMetric\n./emqttd_ctl metrics\nbytes/received: 3582807\nbytes/sent: 2786964\nmessages/dropped: 670870\nmessages/received: 12685\nmessages/retained: 2\nmessages/sent: 21137\npackets/connack: 6021\npackets/connect: 6021\npackets/disconnect: 20\npackets/pingreq: 108922\npackets/pingresp: 108922\npackets/publish/received: 12685\npackets/publish/sent: 21137\npackets/received: 183562\npackets/sent: 184956\npackets/suback: 41027\npackets/subscribe: 41027\npackets/unsuback: 0\npackets/unsubscribe: 0\nAnd this Log error, too much error duplicate clientid :\n\n. @erylee \n\nI was send log error to you. please check, Thanks.\n. sorry for late respon.\nNow I used Erlang/OTP version 18.  I will try uptade the version.\nBut, this issue just because erlang otp issue, or I must off log level 'info' and config pool_size? \nThis is server development, I need all log for see the error.\n. Ok, now used memory normaly. Thank you very much.\n. ",
    "toh2526": "Would anyone agree with \"shared subscription\" support?\nwith this feature, we can bring up EMQTTD with some workload distribution\nwhich was formerly impossible with most MQTT implementations.\nPreviously mentioned by this post:\nhttp://knolleary.net/2012/04/11/queuing-with-mqtt/\nSome of MQTT implementations which already supports \"shared subscription\":\nIBM MessageSight\nhttps://www.ibm.com/developerworks/community/blogs/c565c720-fe84-4f63-873f-607d87787327/entry/easily_balance_messaging_workload_with_new_ibm_messagesight_v1_1\nJoramMQ\nhttp://www.scalagent.com/en/joram-33/technology-36/mqtt-protocol\n. ",
    "santif": "hi, lsxredrain\nI'm using hooks to provide such funcionality, and it looks pretty\nstraightforward:\nemqttd_broker:hook('client.connected',\n{?MODULE, client_connected},\n{?MODULE, client_connected, []}).\nclient_connected(?CONNACK_ACCEPT, #mqtt_client{client_id = ClientId,\nclient_pid = ClientPid}) ->\n  subscribe_to_topics(ClientPid,\nmy_find_topics_by_client_id_function(ClientId));\nglad to know if there is a more convenient way to achieve auto-subscribe\nfunctionality.\n\nSantiago\nOn Wed, Jul 15, 2015 at 3:45 AM, lsxredrain notifications@github.com\nwrote:\n\nadd auto subscribe and auto publish fucntion.\nfor example.\nwhen connented\n1. auto subscribe /client/$c here $c is clientid\n2. auto publish some message(for example sessionid ) to /client/$c\n3\u3001client will get sessionid for bussiness.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/191#issuecomment-121508884.\n. \n",
    "KrishnaPG": "Wondering if this has been implemented. Adding workload distribution can enable RPC like features for devices. If already implemented, any info on how to switch it on could greatly help.\n. Thank you @emqplus \nYou have mentioned 'enterprise edition' - what is it? I was under the impression that this is Apache License. Is this project going to divide into commercial line with divided functionality?\n. +1 for the info on LVS/DR. It will be helpful.\n. Thank you @hongj-sh The information is useful.\n. ",
    "linfx": "\u80fd\u4f20\u9001 \u56fe\u7247\uff0c\u97f3\u9891\u5417\uff1f or \u5927\u5c0f \u6709\u9650\u5236\uff1f\n. detailed connected clients\n. \u5ba2\u6237\u7aefC\u8fde\u63a5\u5230A\u8282\u70b9\u4e86\uff0c A\u6302\u4e86\uff0c \nC \u4e0d\u53ef\u80fd\u8fde\u5230 B \u5427\uff0c\uff0c\u4e0d\u4e00\u6837\u7684IP,,\n. 2session\u7684\u6301\u4e45\u5316\u652f\u6301\u5916\u90e8\u5b58\u50a8\u5417,\u6bd4\u5982redis\u7b49?\n\u770b\u4ed6\u6587\u6863\u597d\u50cf\u662f\u6276\u6301\u3002\n. toipc A\u4e2d\u5047\u8bbe\u670910\u6761\u6d88\u606f\n\u6bcf\u4e2a\u5ba2\u6237\u90fd\u5b5810\u6761\u3002\n. \u7ed3\u5408 zookeeper \uff1f\n. lvs?\n. #198 \n. ",
    "eurus9989": "I have already config /etc/vm.args with \"-name emqttd@my_node_ip\". I use a bash script to do it automatically when the server started. This error happen when I start new node server and cluster it with disc_node. I check all the config but don't see something wrong. I solved it by removed  data/mnesia folder of disc_node server. But it is not what I really want.\nRPC to 'emqttd@my_node_ip' failed: {'EXIT',\n                                       {badarg,\n                                        [{ets,safe_fixtable,\n                                          [mqtt_metric,true],\n                                          []},\n                                         {ets,foldl,3,\n                                          [{file,\"ets.erl\"},{line,571}]},\n                                         {emqttd_metrics,all,0,\n                                          [{file,\"src/emqttd_metrics.erl\"},\n                                           {line,74}]},\n                                         {emqttd_ctl,metrics,1,\n                                          [{file,\"src/emqttd_ctl.erl\"},\n                                           {line,139}]},\n                                         {rpc,'-handle_call_call/6-fun-0-',5,\n                                          [{file,\"rpc.erl\"},{line,206}]}]}}\n. This is my vm.args config.  The error I have exactly is: \n07:33:10.061 <0.521.0> [error] acceptor on 0.0.0.0:1883 suspend 100(ms) for 2300 emfile errors!! \nIt makes server crash, eventhough I have set my ulimit -n to 1.000.000 like the guide in the link https://github.com/emqtt/emqttd/wiki/One%20Million%20Connections . \n``` Erlang\n-------------------------------------------------------------------------\nName of the node\n-------------------------------------------------------------------------\n-name emqttd@myip\nCookie for distributed erlang\n-setcookie emqttdsecretcookie\n-------------------------------------------------------------------------\nMnesia dir. NOTICE: quote the dir with '\" \"'\n-------------------------------------------------------------------------\n-mnesia dir '\"data/mnesia\"'\n-------------------------------------------------------------------------\nFlags\n-------------------------------------------------------------------------\nHeartbeat management; auto-restarts VM if it dies or becomes unresponsive\n(Disabled by default..use with caution!)\n-heart\n-smp true\nEnable kernel poll and a few async threads\n+K true\n+A 64\nmax process numbers\n+P 1000000\nIncrease number of concurrent ports/sockets\n-env ERL_MAX_PORTS 1000000\n-env ERTS_MAX_PORTS 1000000\n-env ERL_MAX_ETS_TABLES 1024\nTweak GC to run more often\n-env ERL_FULLSWEEP_AFTER 1000\n\n```\n. ",
    "chrizkiran": "Hi, Even am facing the same Issue.\nAm doing emqtt_benchmark test and I have 60K client connected, when I try to view clients list or any other emqttd_ctl command related options, I see this statement.\n. Hi terry, thanks for the quick response.\nThere is no error or crash log, the syslog says \"run_erl: Erlang closed the connection\".\nAm doing emqtt benchmark test with 25k subscriptions and 25k publishes each publishing around 8k msgs/sec and when I disconnect the Publish client the emqttd goes down.\nThe memory and CPU consumptions are fine too.\nHowever, for larger values of subscriptions and publishes I get the below error\n[error] <0.1566.0> Supervisor {<0.1566.0>,esockd_acceptor_sup} had child\n acceptor started with esockd_acceptor:start_link(<0.1565.0>, #Fun<esockd_server.0.76791649>, #Fun<esockd_listen\ner_sup.1.9483207>, {gen_logger,error_logger_logger,2}, #Port<0.1473>, #Fun<esockd_transport.2.3781702>) at <0.16\n26.0> exit with reason {accept_error,system_limit} in context child_terminated\nUsing the configurations of 1M connections, But still could not make above 70K connections. Am using n1-standard-4 (4 vCPUs, 15 GB memory) for 50K connection test\nAnd yes, Each of my publisher is publishing 8k messages/sec to 25k Subscribers. Each client have subscribed and publishing to 25k unique topics.\nI have followed the same doc to tune the System and Emq.\nI will try to attach the log as early as possible.\n. Increased the Disk Storage and the Issue got resolved.. ",
    "zhongjin616": "i just found that. it's already support websocket\n. these strategies are cited from HiveMQ . thought maybe useful to someone. :)\n. ",
    "prakashr87": "Hai \n      Me too having the same issue...\nThanks.\n. Thanks...\n. Thanks for the reply....when we can expect this release?\n. Hai \n      Did you release mysql_plugin in 0.10.0\n. Thanks lot @erylee...\n. Hi  @erylee, @callbay, Thanks for the support. :-). I loaded mongodb plugin successfully from the source . but i can't load plugin on \"emqttd-ubuntu64-1.0-beta-20160413.zip\" build. when i trying to load iam getting following error.\nload plugin error: {mongodb,\n                    {bad_return,\n                     {{mongo_app,start,[normal,[]]},\n                      {'EXIT',\n                       {undef,\n                        [{mongo_app,start,[normal,[]],[]},\n                         {application_master,start_it_old,4,\n                          [{file,\"application_master.erl\"},{line,273}]}]}}}}}\nThank You\n. Hai,\n    @hongj-sh Can you please explain about LVS/DR + KeepAlived as LB of a 3-node emqtt cluster\n. Hi,\n     Waiting for the reply...\nThanks.\n. ",
    "macleetw": "Thanks a lot, it's working.\n. ",
    "bayuemu": "\u6211\u5148\u63cf\u8ff0\u4e00\u4e0b\u6211\u7684\u4f7f\u7528\u573a\u666f\uff1a\n1\uff0cemqttd-0.9.0-alpha\u4e3a\u57fa\u7840\uff0c\u4fee\u6539\u4e86\u767b\u5f55\u8ba4\u8bc1\u65b9\u5f0f\u4e3ahttp\u65b9\u5f0f\n2\uff0c\u4fee\u6539\u4e86acl\u8bfb\u53d6\u65b9\u5f0f\uff0c\u4ecemongodb\u96c6\u7fa4\u8bfb\u53d6acl\n3\uff0c\u4f7f\u7528emqttd_benchmark \u8fdb\u884c\u6d4b\u8bd5\uff08\u5f88\u5403\u5185\u5b58\uff09\uff0c100\u4e2a\u4eba\u767b\u5f55\uff08\u6bcf\u9694300\u6beb\u79d2\u767b\u5f55\u4e00\u4e2a\uff09\uff0c\u90fd\u5411\u201c/1\u201d\u8ba2\u9605\u70b9\u53d1\u6570\u636e\uff08\u6bcf\u9694100\u6beb\u79d2\u53d1\u9001\u4e00\u6761\uff09\uff0cQos\u4f7f\u7528emqttd_benchmark\u9ed8\u8ba4\n4\uff0c\u7cfb\u7edf\u4f7f\u7528ubuntu14.02server\uff0864bit\uff09\uff0c\u5185\u5b581g\uff0c\u5355\u6838\uff0c\u7cfb\u7edf\u53c2\u6570\u4e5f\u505a\u4e86\u76f8\u5e94\u7684\u4fee\u6539\uff0c\n\u5f53100\u4e2a\u94fe\u63a5\u70b9\u90fd\u767b\u5f55\u5b8c\u6210\u4ee5\u540e\uff0c\u8fd0\u884c\u53ca\u5206\u949f\u540e\uff0c\u7136\u540e\u4eceemqttd_benchmark  \u4e2dq()\u51fa\u53bb;\u8fd9\u65f6emqttd\u7684console\u91cc\u8fd8\u6709\u5927\u91cf\u7684\u6536\u53d1\u4fe1\u606f\u4e0d\u65ad\u6253\u5370\uff0c\u663e\u793a\u4fe1\u606f\u53d1\u9001\u548c\u63a5\u53d7\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5f88\u6f2b\u957f\uff0cemqttd_error.log \u6ca1\u6709\u62a5\u9519\uff0c\u5f00\u542f\u4e86info\u65e5\u5fd7\u6253\u5370.\u663e\u793a\u4fe1\u606f\u53d1\u9001\u548c\u63a5\u53d7 \u8fd9\u4e2a\u662f\u4e0d\u662f\u5c31\u662f\u6162\u7684\u8868\u73b0\uff1f\u6216\u8005\u8bf4log\u662f\u5f02\u6b65\u663e\u793a\u7684\u548c\u53d1\u9001\u63a5\u53d7\u4fe1\u606f\u6ca1\u6709\u5173\u7cfb\uff1f\n     \u8fd8\u6709\u5c31\u662f\u5047\u8bbe\u7528x \u8ba2\u9605\u4e86/x\uff0c\u4ec5\u4ec5\u4e0a\u7ebf\u4e00\u6b21\uff0c\u5c31\u4e0d\u5728\u4e0a\u7ebf\uff0c\u6b64\u65f6\u7cfb\u7edf\u4e0d\u65ad\u7684\u5411/x \u53d1\u751f\u8ba2\u9605\u4fe1\u606f\uff0c\u4f1a\u4e0d\u4f1a\u9020\u6210\u7cfb\u7edf\u6d88\u606f\u79ef\u538b\uff1f\n    \u5f53\u7528\u6237\u767b\u5f55\u540eacl\u4f1a\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u5f53\u7cfb\u7edf\u8fd0\u884c\u5f88\u957f\u65f6\u95f4\u540e\uff0c\u5927\u91cf\u7684acl\u4f1a\u4e0d\u4f1a\u5728\u5185\u5b58\u4e2d\u9020\u6210\u79ef\u538b\uff1f\n\u8c22\u8c22\n. \u5176\u5b9e\u4e0d\u6162\uff0c\u53ea\u662f\u5185\u5b58\u5728\u6211\u4f7f\u7528 emqttd_benchmark-master \u5f00\u4e8610000\u4e2a\u94fe\u63a5\uff0c\u53ea\u4fdd\u6301 emqttd_benchmark-master\u63a5\u53d7\u6570\u636e\uff0c\u5728\u4e0d\u53d1\u6570\u636e\u65f6\uff0c\u4f46\u662femqtt \u7684\u5185\u5b58\u4f1a\u6162\u6162\u4e00\u70b9\u4e00\u70b9\u7684\u5f80\u4e0a\u589e\u52a0\uff0c\u8fd9\u4e2a\u600e\u4e48\u89e3\u51b3\uff1f\uff1f\uff1f\uff1f\uff1f\n. ",
    "hzaupj": "\u73b0\u5728\u8fd8\u6ca1\u67090.10.0\u7684binary packages\u53ef\u4f9b\u4e0b\u8f7d\u5427\uff1f\n. ",
    "tennessine": "\u63d0\u95ee\u8bf7\u7528\u82f1\u6587\n. @abhidtu https://www.nginx.com/resources/admin-guide/tcp-load-balancing/ \n. ",
    "virtustilus": "The same problem. After any server restart it looses the user.\n. ",
    "TangMonk": "How to query clients by id? http://127.0.0.1:18083/api/clients?client_key=12312 seems not work. I got, I am sorry\n. sorry, that my problem, I am using administrator to start the command line, and then install , it works. ",
    "gbrehmer": "This endpoint is not available anymore. which url should be used instead?\n. main use case is to monitor high amount of devices with several sensors. the current connection status indicates, whether last received sensor data is in sync with device and device is applicable to receive commands from the service (bidirectional communication).\nI saw that the list of connected devices is part of the HTTP API. nevertheless, the message driven approach by getting offline status message automatically by \"last will message\" would better fit.\nBy using emqttd HTTP API, service has to know the list of all emqttd nodes, otherwise it's transparent (behind loadbalancer).\na often used example for client status monitoring is to send an retained message (\"online\") after connect. If the last will message (\"offline\") is lost on node crash/restart, each subscriber of client status feed still gets the outdated online client status from the topic.\n. @emqplus \nCan you please document which information is currently persisted to disk, so it will be restored after node or complete cluster restart? I assume currently persistent sessions (subscriptions, offline/not acked messages?) & retained messages are persisted.\n. @huangdan \nIs this a 2.0 Feature only? Or did you mean the dashboard port 18083?\nFor current release 1.1.3 both ports with \"/status\" http path did not answer correctly or return a 404 error\n. @huangdan Thanks, endpoint works! We have changed the port mapping and I thought, that this port only handles websocket connections\n. I don't know whether other brokers have an reliable implementation of this feature but I think the number of brokers with this feature will increase in the near future, because this type of load balancing can solve many performance/stability problems, if many messages must be handled by a single subscriber/backend-service. Because connections to the emq broker are loadbalanced, we are not able to verify, that the message-processing-backend has a connection to each node.\nAnother Broker with this Feature is the commercial HiveMQ mqtt broker.. @turtleDeng Hi there, is this feature still planned? I hope so :). @emqplus will active subscribers be preferred? Like if you have multiple subscribers with session enabled and part of the subscribers is currently offline.. @zhengyupan \n@spring2maz stated in https://github.com/emqx/emqx/pull/1823#issuecomment-424398856, that connection status is currently not part of dispatch logic for shared subscription messages. But the scenario of grutabow contains two offline clients with existing session which can handle offline messages. @terry-xiaoyu Do you have any plans to do such a change in a future release? \nI'm not very familiar with erlang so from my perspective an erlang-developer can do this a lot faster and with better quality.. sure but in place updates like for other ubuntu packages should be supported too. The name of the file suggests that you are installing a new version because the patch level is different.\nAnd loaded_plugins file is overwritten each time.. but you can not use a package manager/repo like apt and loaded_plugins should be part of configuration (etc/emqttd). Then dpkg will ask for each file from the configuration if file should be overwritten like other services do. we are using a self hosted apt mirror / internal repository to maintain sw packages on our nodes (I think all bigger customer have similar setups). And it would be nice if the apt support would be better :). @spring2maz sorry I didn't look into the implementation too much, but it is also possible to favor online clients (offline clients with session should be ignored if possible = other online clients exists)?. thanks for response, I will do later. ",
    "chiarishow": "and please add \"0\" for not dropping any qos1/2 messages. \n. ",
    "fumnan": "it's fixed, thx :)\n. ",
    "zuogan": "i run empttd with console mode, here is the log, port is listening, so i don't know why port still can't be connected.\nstarting emqttd on node 'emqttd@127.0.0.1'\nemqttd trace is starting...[done]\nemqttd pooler is starting...[done]\nemqttd client manager is starting...[done]\nemqttd session manager is starting...[done]\nemqttd session supervisor is starting...[done]\nemqttd pubsub is starting...[done]\nemqttd stats is starting...[done]\nemqttd metrics is starting...[done]\nemqttd broker is starting...[done]\nemqttd alarm is starting...[done]\nemqttd mode supervisor is starting...[done]\nemqttd bridge supervisor is starting...[done]\nemqttd access control is starting...[done]\nemqttd system monitor is starting...[done]\n07:15:05.640 [info] load module presence successfully\n07:15:05.743 [info] http listen on 0.0.0.0:18083 with 4 acceptors.\n07:15:05.745 [info] started Apps: [emqttd_dashboard]\n07:15:05.745 [info] load plugin emqttd_dashboard successfully\n07:15:05.750 [info] mqtt listen on 0.0.0.0:1883 with 16 acceptors.\n07:15:05.755 [info] mqtts listen on 0.0.0.0:8883 with 4 acceptors.\n07:15:05.760 [info] http listen on 0.0.0.0:8083 with 4 acceptors.\nAnd this is port tcp listener state:\n[root@host2 emqttd-0.10.2]# netstat -anp | grep 18083\ntcp        0      0 0.0.0.0:18083               0.0.0.0:*                   LISTEN      2406/beam.smp\n. I run the test again as your advice, set the create interval time value 10, still 30000 clients test,  and this time the broker server holds 17878 clients established. There are still many clients error(\"shutdown, timeout\"). And at the same time, some clients throw other error, such as \"connecttion lost tcp_closed\" and \"shutdown connack timeout\", so do you know what is the reason? Thanks.\n. ",
    "rock59": "First, Sorry for my bad english ;-(\nI am using Stomp, RabbitMQ and its Stomp over Sockjs plugin in my company..I need to migrate to MQTT protocol to support IoT too (my company Raspberry Pi based gadgets) .. I consider to use emqttd but emqttd only support Websockets and we need to support our customers who use older browsers..\nI am not a network programmer guru.. I googled and I found that Eclipse Paho implemented a javascript library that tunnel MQTT over websocket.. Is it possible to implement such library to tunnel MQTT over Sockjs?\n. This is correct.. SockJS uses Websocket in modern browsers and fallbacks to JSONP , Long Polling or other Text based Protocols(HTTP) in older browsers..\nSockJS has two problems\n1- It uses Text based protocols in fallback mode\n2- Some develpers have doubt about its performance in clustered environments\nWe must use emqtt in clustered mode and performance is critical.\nHow much it cost to develop an stomp plugin for us?\nDo you guaranty its performance in clustered mode specially when our users using older browsers with SockJS? \n. tnx\n. We are using RabbitMQ-Web-Stomp(Stomp over Sockjs) plugin in our current stack and we are satisfied with it\nWe need a full featured MQTT broker like emqttd and are waiting for your Stomp over Sockjs implementation \n. Great job..\n. @mikybone Couchbase is fast and easy to setup and cluster. Unfortunately Couchbase doesn't provide official SDK for Erlang. Commiunity drivers are old and almost obsolete.\nhttp://stackoverflow.com/questions/10750986/couchbase-1-8-and-2-0-erlang-sdks-why-is-erlang-left-out\n. As I said before, unfortunately I am absolute beginner at Erlang. I am evaluating emqtt about 3 months to eventually replace my startup web and mobile notification system(currently based on ejabberd) with emqtt.\nYou work hard and I am confident that emqtt will be a bright future.\nThanks for your efforts :-)\n. Six months ago , I tested both for a high volume Android application. eMQTT scales well and can handle high volume of client connections (300k in my case) . eMQTT Authentication and Authorization plugins are nice and flexible and plugin development for eMQTT is easy\nI could not reach 300k client connections with RabbitMQ MQTT module on a single box. RabbitMQ does not provide flexible Authentication and Authorization modules and module development for RabbitMQ is not easy... \nIf you don't need an enterprise message queue, use eMQTT and enjoy it ;-)\n. @drasko In my case, throughput is not very important.. The throughput with QoS 0 and 1 kb message size was about 10k/s .. It was not a stress test..\nI need high volume concurrent connections (up to 300k per server) and Authentication and Authorization( per topic sub / pub) flexibility thus I chose eMQTT\n. @drasko mosquitto does not use epoll(Linux) or kqueue(BSD) or IOCP(windows) for socket event  notification, so mosquitto can't scale well to thousands of concurrent connections even with a well tuned Linux box\n. @srijanmishra Unfortunately I don't have configs right now ;-( \nI used official documents to configure the servers and Ubuntu server 15.04 on 3 servers (one for emqttd and two for clients) \nhttp://emqtt.io/docs/v2/tune.html\nhttps://github.com/emqtt/emqtt_benchmark\n. @drasko  VerneMQ is nice and has interesting features although It seems that VerneMQ has issues with high volume concurrent connections..\nhttps://github.com/erlio/vernemq/issues/154\n. @srijanmishra I don't have access to the servers in the company I worked for and the results right now so I can't provide much details.Sorry\n3 1U rackmount servers (CPU: Xeon, 8 core, RAM:128 GB, SSD , 10 GB NIC)\n1KB QoS 0 message\n300K Clients connected and 300K topics (1 topic per client)\nup to 10K messages/s out (the application requirement)\nTHAT WAS NOT A STRESS TEST\n. ",
    "hbyscpp": "I also have this issue. In cluster env,two node A and B,using LVS for Loadbalance.Client C connect  Node A.\n1 stop Node A.\n2 start Node A\n3In node B,cluster to  Node A\nclient reconnect.\n produce \n09:48:28.397 <0.828.0> [critical] Session xxx@<0.660.0> died unexpectedly\u3002\n. my beam.smp also consume lots of memeory. 7.4G of 8G\nrunning 11days\n./emqttd_ctl metrics\nbytes/received: 7303765\nbytes/sent: 44448214\nmessages/dropped: 2609993\nmessages/received: 11872\nmessages/retained: 490\nmessages/sent: 81105\npackets/connack: 326\npackets/connect: 341\npackets/disconnect: 118\npackets/pingreq: 41540\npackets/pingresp: 41540\npackets/publish/received: 11872\npackets/publish/sent: 81105\npackets/received: 68505\npackets/sent: 132953\npackets/suback: 302\npackets/subscribe: 331\npackets/unsuback: 0\npackets/unsubscribe: 0\n. @erylee  Thanks.I will upgrade OTP.\n. ",
    "taoyonggang": "I also test with the emqttd_benchmark . it only connect almost half(about 15000 clients) successfully(tcp established). How improve to 200+K??\nI am use ubuntu 14.04 server. Set it with https://github.com/emqtt/emqttd/wiki/One%20Million%20Connections\n. You need reference the Kafka io design.\n. I will wirte mqtt server with golang.  The server will support more than 100M connections.\n. ./bin/emqttd_ctl plugins list\nPlugin(emqttd_dashboard, version=0.1, description=emqttd web dashboard, active=true)\nPlugin(emqttd_plugin_mysql, version=0.10, description=emqttd Authentication/ACL with MySQL, active=false)\nPlugin(emqttd_plugin_pgsql, version=0.1, description=emqttd PostgreSQL Plugin, active=false)\nPlugin(emysql, version=4.0, description=Erlang MySQL Client, active=false)\n. [\n{emysql, [\n    {pool, 4},\n    {host, \"127.0.0.1\"},\n    {port, 3306},\n    {username, \"tao\"},\n    {password, \"taotao\"},\n    {database, \"mqtt\"},\n    {encoding, utf8}\n]},\n{emqttd_plugin_mysql, [\n```\n%% select password only\n{authquery, \"select password from mqtt_user where username = '%u' limit 1\"},\n%% hash algorithm: md5, sha, sha256, pbkdf2?\n{password_hash, sha256},\n%% select password with salt\n%% {authquery, \"select password, salt from mqtt_user where username = '%u'\"},\n%% sha256 with salt prefix\n%% {password_hash, {salt, sha256}},\n%% sha256 with salt suffix\n%% {password_hash, {sha256, salt}},\n%% comment this query, the acl will be disabled\n{aclquery, \"select * from mqtt_acl where ipaddr = '%a' or username = '%u' or username = '$all' or clientid = '%c'\"},\n%% If no rules matched, return...\n{acl_nomatch, allow}\n```\n]}\n].\n. You can use kennel network to replace the user network . It can save cpu and memory copy time.\n. ",
    "joaohf": "Hi,\nWIP here: https://github.com/joaohf/emqttd/tree/rebar3\nrebar3 compile works. Now I am focus on release and templates files (rel/files).\nI think the emqttd plugin build should be revisited. What about plugins using rebar too ?\n. Hi, now plugins work with rebar3 too.\nJust put the plugins into plugins directory. Any OTP application inside plugins will be handled by rebar3.\nAnother option is to put the plugin as deps. It will work too.\nNow I am working on release\n. Hi,\nSee this plugin: https://github.com/joaohf/emqttd_elasticsearch \nrebar3 will take care to get depends.\nAnd now check this: https://github.com/joaohf/emqttd/commit/b7bc938d8c25739c11699e54a40fadc2469b7c18\nUsing rebar.config.script we can get all the plugins and add to relx release. Without edit rebar.config ;)\nTo let plugin as simple as possible (and rebar3 too), I think that the contains of 'etc' directory should be in 'priv'. Then the priv dir will be copied. We will not need the etc dir anymore.\nNow I am working on release (finally).\n. Hi @phanimahesh. I'm blocking with rebar3 release. emqttd has done small adjusts to rebar scripts. Like the use of 'etc/emqttd.config' and other minor changes.\nI'm doing some tests to see the best way to how to handle it.\nThe worst case: Use rebar3 default release and then go through emqttd release way (config files in etc, and script adjusts).\nIn this mean time, I'm am investigating this https://github.com/basho/node_package to help with some things.\n. Hi, with last https://github.com/joaohf/emqttd/tree/rebar3 I got this:\n```\njoaohf@couve:~/opensource/emqttd/_build/default/rel/emqttd$ bin/emqttd console\nconfig is OK\n-config /home/joaohf/opensource/emqttd/_build/default/rel/emqttd/bin/../etc/app.config -args_file /home/joaohf/opensource/emqttd/_build/default/rel/emqttd/bi\nn/../etc/vm.args -vm_args /home/joaohf/opensource/emqttd/_build/default/rel/emqttd/bin/../etc/vm.args\n!!!!\n!!!! WARNING: ulimit -n is 1024; 4096 is the recommended minimum.\n!!!!\nExec:  /home/joaohf/opensource/emqttd/_build/default/rel/emqttd/bin/../erts-7.0/bin/erlexec -boot /home/joaohf/opensource/emqttd/_build/default/rel/emqttd/bi\nn/../releases/0.1.0/emqttd               -config /home/joaohf/opensource/emqttd/_build/default/rel/emqttd/bin/../etc/app.config -args_file /home/joaohf/opens\nource/emqttd/_build/default/rel/emqttd/bin/../etc/vm.args -vm_args /home/joaohf/opensource/emqttd/_build/default/rel/emqttd/bin/../etc/vm.args              -\npa /home/joaohf/opensource/emqttd/_build/default/rel/emqttd/bin/../lib/emqtt-patches -- console\nRoot: /home/joaohf/opensource/emqttd/_build/default/rel/emqttd/bin/..\nErlang/OTP 18 [erts-7.0] [source] [64-bit] [smp:4:4] [async-threads:16] [hipe] [kernel-poll:true]\nstarting emqttd on node 'emqttd@127.0.0.1'\nemqttd trace is starting...[done]\nemqttd pooler is starting...[done]\nemqttd client manager is starting...[done]\nemqttd session manager is starting...[done]\nemqttd session supervisor is starting...[done]\nemqttd pubsub is starting...[done]\nemqttd stats is starting...[done]\nemqttd metrics is starting...[done]\nemqttd broker is starting...[done]\nemqttd alarm is starting...[done]\nemqttd mode supervisor is starting...[done]\nemqttd bridge supervisor is starting...[done]\nemqttd access control is starting...[done]\nemqttd system monitor is starting...[done]\n=INFO REPORT==== 22-Sep-2015::23:03:00 ===\n    application: emqttd\n    exited: {bad_return,\n                {{emqttd_app,start,[normal,[]]},\n                 {'EXIT',\n                     {undef,\n                         [{lager,info,\n                              [\"load module ~s successfully\",[presence]],\n                              []},\n                          {lists,foreach,2,[{file,\"lists.erl\"},{line,1337}]},\n                          {emqttd_app,start,2,\n                              [{file,\n                                   \"/home/joaohf/opensource/emqttd/_build/default/lib/emqttd/src/emqttd_app.erl\"},\n                               {line,54}]},\n                          {application_master,start_it_old,4,\n                              [{file,\"application_master.erl\"},\n                               {line,273}]}]}}}}\n    type: permanent\n[os_mon] memory supervisor port (memsup): Erlang has closed\n[os_mon] cpu supervisor port (cpu_sup): Erlang has closed\n{\"Kernel pid terminated\",application_controller,\"{application_start_failure,emqttd,{bad_return,{{emqttd_app,start,[normal,[]]},{'EXIT',{undef,[{lager,info,[\\\n\"load module ~s successfully\\\",[presence]],[]},{lists,foreach,2,[{file,\\\"lists.erl\\\"},{line,1337}]},{emqttd_app,start,2,[{file,\\\"/home/joaohf/opensource/emqt\ntd/_build/default/lib/emqttd/src/emqttd_app.erl\\\"},{line,54}]},{application_master,start_it_old,4,[{file,\\\"application_master.erl\\\"},{line,273}]}]}}}}}\"}\nCrash dump is being written to: erl_crash.dump...done\nKernel pid terminated (application_controller) ({application_start_failure,emqttd,{bad_return,{{emqttd_app,start,[normal,[]]},{'EXIT',{undef,[{lager,info,[\"l\noad module ~s successfully\",[presence]],[\n```\nAny hint?\nWith 'rebar shell' lager is founded. By the way is rebar shell useful to emqttd ?\n. Good hint.\nThere were two erl_opts in rebar.config. \nNow:\n08:26:06.217 [info] load module presence successfully\n08:26:06.218 [error] Cannot find plugins: [emqttd_dashboard]\nErlang MQTT Broker 0.10.4 is running now\nI need to check minor things and I back here to post the results.\n. Almost done.\nGeneral questions:\n- Is important to have an etc directory for every plugin? Will be better to put plugin.config inside priv directory and let the build tool handle it?\n- To make a release, all apps inside plugins directory goes to _build/default/rel/emqttd/lib. The plugins directory (_build/default/rel/emqttd/plugins) does not exists anymore. However emqttd_plugins.erl will check if plugins dir  has any app. \nDuring my tests I've created the directory plugins and symbolic link to lib/emqtdd_dashboard-0.1. Like this:\njfreitas@jfreitas:~/emqttd/_build/default/rel/emqttd$ ls -l plugins/\ntotal 0\nlrwxrwxrwx 1 jfreitas jfreitas 27 Set 24 10:34 emqttd_dashboard -> ../lib/emqttd_dashboard-0.1\nlrwxrwxrwx 1 jfreitas jfreitas 31 Set 24 10:34 emqttd_elasticsearch -> ../lib/emqttd_elasticsearch-0.1\nThen emqttd load the plugins.\nThe list of plugins that will be loaded could be place in a config file instead a plugins directory? Like this:\n```\nemqttd.conf:\n%% Plugins\n{plugins, [\n    %% Plugin App Library Dir\n    {plugins, [\"emqttd_dashboard\", \"emqttd_elasticsearch\"]},\n\n    %% File to store loaded plugin names.\n    {loaded_file, \"./data/loaded_plugins\"}\n]}\n\n```\n. Nice idea. This will save a few lines of code.\nAnd what about the plugins directory? It's important to keep the current behaviour? \n. Hi, \nSee: #401\n. Two rebar3 features that I like soo much:\nhttp://www.rebar3.org/docs/profiles\nhttp://www.rebar3.org/docs/releases#cross-compiling\n. Thanks.\n. ",
    "Prots": "What about erlang.mk tool for dependency management and release assembling? \nI think it is more powerful and quick than rebar, but I don't know about rebar3.\n. I think I found a solution =)\nerl\non_client_subscribe_after(_ClientId, TopicTable, _Env) ->\n    [{Topic, _Type}] = TopicTable,\n    Msg = emqttd_message:make(broker, Topic, <<\"Hello client\">>),\n    io:format(\"Message for client: ~p~n\", [Msg]),\n    Res = emqttd_pubsub:publish(Msg),\n    io:format(\"emqttd_pubsub:publish: ~p~n\", [Res]).\n. Yes, looks like it works.\nIt needs, for example, when you want get messages for client from redis and publish it directly from plugin. \n. Thanks.\n. You can write your own plugin, where you can dispatch any event provided by clients using enabled hooks.\nPlease see this code: https://github.com/emqtt/emqttd_plugin_template\n. Hello, please copy here settings of the security group of your AWS EC2 Instances.\nI think you should enable incoming traffic via epmd port for cluster normal work.\n. Please try to open 4369 TCP port for incoming connections. This is default port for epmd daemon. \n. Crasher log is empty after start.\nThe AWS machine is empty, without Erlang. I've just copied release from my workstation and try to run.\nWith sudo or without - the result is same: start OK, but when try to subscribe - get an error listed below.\n. Thanks, @erylee \nThe issue was with \n%% PubSub\n        {pubsub, [\n            %% default should be scheduler numbers\n             {pool_size, 2}\n        ]},\nJust set {pool_size, 2} if you use one core server.\n. No, I built from tag 0.17.0 and loaded my plugin.\nOn Mar 15, 2016 19:57, \"Feng Lee\" notifications@github.com wrote:\n\nHi @Prots https://github.com/Prots, Do you build the broker from latest\nmaster? How to reproduce the issue?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly or view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/476#issuecomment-196949038\n. Hi, I've checked code of my plugin, insert changes like in plugin_template example and now all right. Thanks for great job!\n. Hi, do you have any updates related to this issue? \nThe main problem is sending this messages in the loop and increasing server load. \n. \n",
    "drasko": "@emqplus why this move to erlang.mk? It has not been explained in this discussion - what is the advantage of erlang.mk over rebar3?. Scylla is an interesting candidate: http://www.scylladb.com/technology/cassandra-vs-scylla-benchmark/\n. @emqplus in relation to: https://groups.google.com/forum/#!topic/rabbitmq-users/KVMNkAsW-ac, I think it is of crucial importance for scaling. We need either Kafka or Cassandra pipes out of each node, so that we can persist messages in a DB without subscription to # topic (but take data directly from within the node via plugin).\nThere is already community support for Kafka (https://github.com/vowstar/emqttd_plugin_kafka_bridge), so I think Cassandra plugin would be of higher urgency now.\nKafka is not easy to set-up (because Zookeeper) and if all that is needed is data storage into database (from all nodes in parallel) then I think Cassandra plugin will do.\n. @abhidtu what's the status on this? Has it been tested in a cluster?\n. I can not make it work:\ndrasko@Lenin:~/mainflux/mosquitto$ /usr/sbin/mosquitto -c mosquitto.conf -p 1111\n1476137283: mosquitto version 1.4.8 (build date Sun, 14 Feb 2016 15:06:55 +0000) starting\n1476137283: Config loaded from mosquitto.conf.\n1476137283: Opening ipv4 listen socket on port 1111.\n1476137283: Opening ipv6 listen socket on port 1111.\n1476137283: Bridge local.Lenin.bridge-to-mainflux doing local SUBSCRIBE on topic #\n1476137283: Connecting bridge bridge-to-mainflux (localhost:1883)\n1476137283: Bridge Lenin.bridge-to-mainflux sending CONNECT\n1476137283: Socket error on client local.Lenin.bridge-to-mainflux, disconnecting.\nI am using latest debian emqttd-debian64-v2.0-beta.3-20160918.zip and I can not see anything in the debug console (set laget to debug, and wun in the foreground - no indeication tat mosquitto tries to connect)\n. Any news on this?\n. Any news on this one? Is v1.2 on the way?\n. @emqplus great news! Thanks a lot for your impressive work!\nI have started seriously evaluating EMQTT for our Mainflux (https://github.com/Mainflux/mainflux) project. I think it can replace several architectural blocks and simplify the structure.\nOne question about CoAP: how will you do CoAP-to-MQTT PUB/SUB? Actually what I had in mind is something like this: https://github.com/eclipse/ponte - so possibility to publish from MQTT to CoAP and vice versa. I.e. we need some protocol-to-protocol communication.\nHow will your solution work? \n. @rock59 there are auth plugins in RabbitMQ: http://www.rabbitmq.com/access-control.html. But I would agree that it looks like dev and config for eMQTT is simpler\nI do not really need message queue at this moment, but I am afraid that scaling any MQTT broker with the need to store messages in DB will demand some message queue (maybe Kafka), as DB client will not be able to cope with the load. But the moment you start adding MQs to the eMQTT it becomes more complicated solution to RabbitMQ, IMHO.\nSo conclusion would be - supporting more concurrent connections and simpler to develop/set-up?\n. @rock59 btw - does number of concurrent connections really matter? Linux box can theoretically accept huge number of conncetions, as these are nothing but an opened sockets. What really matters is throughput - i.e. number and size of the messages per second: http://stackoverflow.com/questions/10087396/mqtt-mosquitto-linux-connection-limit\nWhat was the throughput in your case (how many messages per second and what was the size of the messages)?\n. @rock59 @srijanmishra I think that eMQTT should be more compared to VerneMQ then. Here is some interesting info and benchmarks: https://github.com/erlio/vernemq/issues/83\nAlso, I see that they embedded Lua, so plugin writing becomes really simple: https://github.com/erlio/vmq_diversity\n. @rock59  I have no idea, I never used it. They are showing 200k in their benchmarks as I can see.\n. @huangdan when constructing DB persistence plugin I think that this should be taken into account: https://github.com/erlio/vernemq/issues/197\n. Thanks.\nI think it would be important to think how user can define his own configuration also for app running in Docker.\nSome alternatives I see:\n- Via Docker Volume mapping (user maps config files from his PC)\n- Docker ENV variables\n- Docker image calls user-provided start script that adds plugins (maybe volume-mapped start script)\nI'm not sure what is the best approach here. But we need some kind of configurability of eMQTT running in Docker, so that when we pull it from DockerHub we can deploy it in the way we want.\n. We from Mainflux project got you covered: https://github.com/Mainflux/emqttd-docker\nYou can reuse this code for official release - we tried to make it configurable for deployments.\nImage can be found pulled from here: https://hub.docker.com/r/mainflux/emqttd-docker/\n. @steffenix we had some commits today on Mainflux EMQTT Docker that simplify configuration of plugins to be loaded. Now list of plugins is read and only plugins selected in this list by the user are installed (and not every existing plugin, like it was the previous case).\n. We will go through your commits and see what we can integrate, thanks. Mainflux will also have to move to latest to puck up http auth plugin changes.\n. @klausenbusk any design @mijicd decides is OK for me. I do agree that ENV variables are easier to pass around between machines than conf files.\n@mijicd maybe out of scope for this conversation, but related to Mainflux however - how does this information passing (be it ENV or conf file) can be handled with Vault, which is used by Mnatl.io that Mainflux is about to integrate?\n. Ah, I just saw that emqttd_auth_http plugin is supported only in 1.1 release.\nWill it be supported in 2.0?\n. @emqplus I see, but is not this other redundant?\nIf I am listening on the /mqtt/superuser - how will I know which is for Auth and which is for ACL?\nMoreover - do we even need one for ACL in the case of superuser, as he has unlimited access?\n. @emqplus thanks, we will test it.\n. Not fixed in emqttd-debian64-v2.0-beta.3-20160918.zip. Please re-open the bug.\n. Any updates on this? Did anybody tried this?\n. @huangdan can you confirm that this works? As you can see from my description I set-up mosquitto correctly (at least I think).\nIs bridge_protocol_version mqttv311 line necessary?\n. ",
    "linbo": "Hi\uff0c\nAny resource I can refer to?\nHow to find the reason is that aliyun health check close normal TCP connection\uff0cany flow I can reproduce it?\nThanks\uff0c\nLinbo\n. ",
    "therahulprasad": "@honger05  If you are using npm mqtt module. You can use this code: \nvar uniqueid = \"some-unique-id\";\nvar client  = mqtt.connect('mqtt://host-name/', {\n  protocolId: 'MQIsdp', \n  protocolVersion: 3,\n  clientId: 'id_' + uniqueid,\n  clean: false\n});\nclient.subscribe('topic', {qos: 2});\nclient.publish('topic', 'Hello ' + friendphone, {qos:2});\n1. Keeping a clientId will maintain a session in server. \n2. clean(session) = false will not clean session if client disconnect\n3. whatever message you publish or subscribe, do it with qos=1 or 2\n. Thanks for quick reply @erylee. I see that you added it to 0.11.0 milestone. Are you planning a regex based pattern matching capability directly into core module ? :)\n. Is it possible to persist subscriptions/messages to redis?\n. Its a mobile IM. Thanks for the link\n. ",
    "chriz-kiran": "Hi, am a newbie trying to get to know about emqtt.\nCan you please clarify the following things\n\n\nwith clean_sess flag set to false, will the messages get stored even after the client has disconnected and are those messages delivered as soon as the client reconnects?\n\n\nHow the subscriptions and topics are stored in emqttd broker using ets or dets or mnesia.\n. \n\n",
    "brechmos": "Hey, I was wondering if #2 (persist subscriptions/messages across nodes in a cluster) has been implemented in the code base? That would be very useful...\n. @hello-liuyi Did you figure it out?  I have tried a bunch of things and can't seem to get it working to connect from python or javascript without the certfile.  Would love to hear if you get it figured out.\n. Ok. I will try that.  Thank you for getting back to me.\nUnfortunately, EC2 has R14B04 and not R17+ so I'll have to see if I can get a newer erlang.\nOn 07/01/2016 10:28 PM, Feng Lee wrote:\n\nhi @brechmos https://github.com/brechmos, please build the broker\nfrom source: http://emqtt.io/docs/install.html#installing-from-source\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/618#issuecomment-230079024,\nor mute the thread\nhttps://github.com/notifications/unsubscribe/AA2Le4AgF_y_6IM82vn9yxLS4-nYCHUtks5qRczngaJpZM4JDZTQ.\n\n\nCraig Jones\ncraig@brechmos.org\nhttps://craig.brechmos.org\ngpg:1500 550D D162 C7C5 934F 0FF3 2FA1 B752 76E0 09C6\n. ",
    "muhun": "@erylee , thank you ! I am trying some broadcast system for huge number of participants, this broker seems very promising , I want to give a try , Cheers \n. ",
    "elsennov": "Hi @emqplus , Do you know what is the best option for android between Paho and Fuse Source Mqtt Client? \n. @emqplus Thanks!\n. ",
    "grimmlink": "alright, plugin is working now, but seems it fails sometimes : \n20:46:57.539 <0.326.0> [info] Connect from 91.121.177.189:56305 -> 91.121.177.189:1883\n20:46:57.539 <0.326.0> [info] RECV from gfremont@91.121.177.189:56305: CONNECT(Qos=0, Retain=false, Dup=false, ClientId=gfremont, ProtoName=MQIsdp, ProtoVsn=3, CleanSess=true, KeepAlive=60, Username=guillaume, Password=******)\n20:46:57.540 <0.326.0> [info] SEND to gfremont@91.121.177.189:56305: CONNACK(Qos=0, Retain=false, Dup=false, AckFlags=0, RetainCode=0)\n20:46:57.540 <0.326.0> [info] RECV from gfremont@91.121.177.189:56305: SUBSCRIBE(Qos=1, Retain=false, Dup=false, PacketId=1, TopicTable=[{<<\"blabla\">>,0}])\n20:46:57.541 <0.326.0> [info] Client(91.121.177.189:56305) terminated, reason: {function_clause,[{emqttd_acl_mysql,who,[<<\"91.121.177.189\">>,<<\"guillaume\">>,<<\"gfremont\">>],[{file,\"src/emqttd_acl_mysql.erl\"},{line,92}]},{emqttd_acl_mysql,compile,2,[{file,\"src/emqttd_acl_mysql.erl\"},{line,88}]},{emqttd_acl_mysql,check_acl,2,[{file,\"src/emqttd_acl_mysql.erl\"},{line,54}]},{emqttd_access_control,check_acl,4,[{file,\"src/emqttd_access_control.erl\"},{line,104}]},{emqttd_protocol,'-handle/2-lc$^0/1-0-',2,[{file,\"src/emqttd_protocol.erl\"},{line,238}]},{emqttd_protocol,handle,2,[{file,\"src/emqttd_protocol.erl\"},{line,238}]},{emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,206}]},{gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,599}]}]}\n20:46:57.541 <0.326.0> [info] Client gfremont@91.121.177.189:56305: shutdown {function_clause,[{emqttd_acl_mysql,who,[<<\"91.121.177.189\">>,<<\"guillaume\">>,<<\"gfremont\">>],[{file,\"src/emqttd_acl_mysql.erl\"},{line,92}]},{emqttd_acl_mysql,compile,2,[{file,\"src/emqttd_acl_mysql.erl\"},{line,88}]},{emqttd_acl_mysql,check_acl,2,[{file,\"src/emqttd_acl_mysql.erl\"},{line,54}]},{emqttd_access_control,check_acl,4,[{file,\"src/emqttd_access_control.erl\"},{line,104}]},{emqttd_protocol,'-handle/2-lc$^0/1-0-',2,[{file,\"src/emqttd_protocol.erl\"},{line,238}]},{emqttd_protocol,handle,2,[{file,\"src/emqttd_protocol.erl\"},{line,238}]},{emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,206}]},{gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,599}]}]}\nmy user:\n\nmy ACL:\n\n. ",
    "kennethalong": "I need this functionality as well.  I haven't used Cassandra, but Kafka is a real beast and has been very stable for us.  I like the plan!  Any ETA?\n. This is great news!  Thanks for all your hard work.\n. ",
    "hsncr": "@erylee Any progress about this feature? Are you going to implement it any time soon?\n. @elisiariocouto maybe some of your configs are not correct. you need to set timeout client config to a value that is greater than your client keep alive value as they stated the link below.\nhttps://github.com/mqttjs/MQTT.js/issues/37\n. There is this issue but I don't know if it is related with emqtt or haproxy. I don't know how to test it.\nI am using haproxy for load balancing. For following scenario, I lost all undelivered messages. \n- 2 clients connect and subscribe to a topic, start to publish. \n- One of them gets disconnected intentionally or  because of net connectivity problem.\n- Other one continues to publish messages.\n- When disconnected client attempts its first connect, I get following behaviour;\n1. Client attempts to connect.\n2. Received connected callback.\n3. Received disconnected callback.\n4. And then disconnected by broker event received.\n5. All undelivered messages are gone now.\n6. After reconnect Client receives last message that has been sent.\nIf I connect client directly to broker, it works as it should be.\nAny ideas? \n. ",
    "bangarharshit": "@erylee , Do you think something with really high throughput and low latency will be awesome. http://kkovacs.eu/cassandra-vs-mongodb-vs-couchdb-vs-redis . Tested Cassandra, and Couchbase. Need to test AeroSpike - http://stackoverflow.com/questions/25208914/has-anyone-worked-with-aerospike-how-does-it-compare-to-mongodb/25716540#25716540 . While they are awesome, they still add 30-50ms to queries. Aerospike looks much better than Cassandra for storing messages and topics (taking it with pinch of salt since I still need to test it manually). It uses both SSD and RAM. If the claim, 95% of query less than 1ms is true then it will be really awesome (both fast and distributed). Also there is a UDF to create queue if needed.\n. @emqplus , how are you designing the message store? Is it through plugin and hooks again to store across different types of data store. I have implemented one for sql by replacing queue with mysql data-store. Loading it in the result list once the session starts and deleting it from sql once the packet id is acked. If you are working on it then I will probably skip it, otherwise I can generalize and contribute. I have three apis - fetch_message (which loads all the message when client comes online), add_message(which adds the message when the client is offline - the entire record is serialized and stored. I think though it's not a very good approach because of packet id which doesn't look like a global uuid but rather an incremental counter ) and ack_message(which removes the message from data-store).\n. +1. Really critical. Since now Google have doze and apple's APNS it is super critical. Consistent ping drains away battery. 3:30 min is the ping interval we are using since it is getting disconnected to a bigger number. The battery it is consuming is around 10% which is really huge.\nThis  is important and drafted as a GSOC project for ejabberd, an xmpp server. - https://blog.process-one.net/my-gsoc-2015-project-push-for-xmpp/ . \nI don't want to make changes in core so thinking of some design using hooks - like message received.\n. For anyone interested I have made a fix for GCM - https://github.com/bangarharshit/emqttd/commit/d2ad3320e9d66cc98e316abd7cc2346a116ff300 . Not the best fix, but along with queueing I am also publishing on a topic offline with payload=clientId. One of my java server is always subscribed to it and it is offloading all the heavy work like registration id look-up. May be on_client_offline hook -https://verne.mq/docs/plugin_development.html#on-client-offline is a better solution.\n. +1. Tracking it. Its super important since ssl frequently timed out without this and would love to know how to test this?\n. We have verified with sslyze - session id is supported and session ticket is not supported. You can close it if you feel ticket support is not very important.\n. Good point. We didn't think of it (as none of the mqtt clients support it) but I believe it willl not work. You will probably need something like haproxy to be reliable. Use non secure session between haproxy and emqtt. I guess ssl resumption will be it's responsibility and looks to me it should work then - https://kura.io/2014/02/22/haproxy-stateful-ssl-session-resumption/.\n. Thanks. I am too thinking of moving the code after testing to hooks so that I can take periodic down merges. Certainly it needs more hook like message_received_but_user_offline\nI came from XMPP world (well after failing it to make work on 2g) and I liked few things:\n1. Extensibility.\n2. Clients are simple and servers are complex.\nI sat down and wrote a spec - https://github.com/bangarharshit/Mqtt-chat . I quickly implemented some of the things for messaging like receipts - read/send/delivered, single user/group chat, webrtc calls, chatstate, presence without extending mqtt.\nThere are few other things which requires extension and I don't know a clear path to them:\n1. How will  I make it work across resources - web, android, ios - How xmpp does it is by adding a resource - clientid/web, clientid/android. Practically, I can do the same by storing all my subscriptions (or querying it in same way) and auto subscribing for every new resource.\n2. Web clients - There is no concept of storage in web and so how can we store history. One way to add is to add a client called backup.  It stores all your messages in a db (extremely unsafe, subscribed to all the users ). For every web client, make a request - backup give me my last 20 messages and it will chunk them and send it to you.\n. I have one more question about deployment. Did you guys test it behind a corporate firewall, where both 1883 and 8883 ports are blocked. We used HAProxy to made it work on port-80 but the performance is not great with frequent connections outage. Now we are thinking of using mqtt over web-socket (we are making change in paho java client). How heavy is web socket over normal mqtt connection?\n. @jianglinchun We've our chat app completely working for now (based on paho). It's functionally similar to whatsapp and we are planning to open source the mqtt core after removing the ui dependencies. We still need to formalize our roadmap as we are planning to get some review on the protocol. We will be happy to share an early node/java client.\nI  can think of 3 steps mainly:\n1. Base mobile functionality something similar to whatsapp - We have tested POC for it and is final. No changes in broker.\n2. Optimizations and security - This involves change in emqtt - like authorized subscription (no one can subscribe to # or +/+/+). GCM and APNS for connections in background - doze mode. Also emqtt subscriptions are of fixed duration like 2 weeks, need to change it (probably something to be set by client)\n3. Extending it to web and multiple resources. \nAlso, we are planning to build system around subscribes like micro-services. We wrote our gcm micro-service which subscribes to a channel and emqtt's responsibility is to just invoke gcm (routing). \nSimilarly for point 3 we have message archive service- clients with offline message we have a client which subscribes to all message channels (+/+/message).  Similarly another service is responsible for returning messages (just publish to retrieve message with topic and no of messages) and it will return the messages.\nHere are the objectives:\n1. Infinitely extendible - A new message can be defined by just adding a topic and provider.\n2. Minimum changes in mqtt core. Assign responsibilties to different components.\nHere is a slightly updated version - https://github.com/bangarharshit/Mqtt-chat and it contains what are the components we have implemented without making change in core.\nPlease let me know your feedback.\n. @jianglinchun Thanks. We are planning to release a sample web client and java client sometime late this week (with almost the same functionality as Whatsapp like typing, webrtc calls,  messages, presence - the only thing not supported is last active time - which is not a very hard thing). Additionally we are also supporting some other features such as past message retrieval which is not in whatsapp for clients with no offline storage. It will be great if you guys check it out and see if it suits your need.\nAs usual any kind of contributions are always welcome. \n. Sorry. Got busy with few things. It will take another few days.\n. Released sdk -  https://github.com/DrawersApp/drawers-models. It is completely undocumented and if you go through classes you can see message listeners, chat state listeners (typing/active/inactive), presence listeners, etc. Still writing the sample app (without call, will be adding it later) and will take 2/3 more days- https://github.com/DrawersApp/drawers-models/issues/1 - let's talk there. \nTwo issues:\n1.  It's not usable in production and currently only alpha. Tons of security issues - currently any one can subscribe to my channels and listen for the messages. Needs acl and autosubscription.\n2.  Javascript client is currently on hold as we are focusing on bot framework.\n. I am also getting the same issue with latest master - EOF exception. \n. ",
    "aksswami": "@erylee Any updates on this? \n. ",
    "mpoornima": "Now that 1.0 is out (congratulations BTW :)), any expected ETA for integration with a data store? \n. Eagerly awaiting for this feature to be implemented. This is one of the major bottlenecks I've found with MQTT brokers so far. This would massively increases scale on the client side. \n. Does this work in a clustered setup too? As in if a client connects to a broker node1, disconnects and reconnects to node2, does the resume happen in this case? \n. ",
    "mkj-git": "Any update about cassandra and Kafka integration ?\n. after going through some previous issues i updated my question for more details have a look pls. in ui iam giving username & password as test1 & test1 at port 8083\n. i removed the password and tried again but same worn username/password error. Is there any other place where i will have to specify which DB plugin i am using\n. Inside `emqttd_error.log i have this\n```\n10:52:37.551 <0.388.0> [error] load plugin emqttd_plugin_pgsql error, cannot start app emqttd_plugin_pgsql for {bad_return,{{emqttd_plugin_pgsql_app,start,[normal,[]]},{'EXIT',{{badmatch,{error,{shutdown,{failed_to_start_child,pgsql_pool,{shutdown,{failed_to_start_child,worker_sup,{shutdown,{failed_to_start_child,{worker,1},invalid_password}}}}}}}},[{emqttd_plugin_pgsql_app,start,2,[{file,\"src/emqttd_plugin_pgsql_app.erl\"},{line,30}]},{application_master,start_it_old,4,[{file,\"application_master.erl\"},{line,273}]}]}}}}\n10:53:16.207 <0.421.0> [error] load plugin emqttd_plugin_pgsql error, cannot start app emqttd_plugin_pgsql for {bad_return,{{emqttd_plugin_pgsql_app,start,[normal,[]]},{'EXIT',{{badmatch,{error,{shutdown,{failed_to_start_child,pgsql_pool,{shutdown,{failed_to_start_child,worker_sup,{shutdown,{failed_to_start_child,{worker,1},invalid_password}}}}}}}},[{emqttd_plugin_pgsql_app,start,2,[{file,\"src/emqttd_plugin_pgsql_app.erl\"},{line,30}]},{application_master,start_it_old,4,[{file,\"application_master.erl\"},{line,273}]}]}}}}\n10:56:13.452 <0.463.0> [error] load plugin emqttd_plugin_pgsql error, cannot start app emqttd_plugin_pgsql for {bad_return,{{emqttd_plugin_pgsql_app,start,[normal,[]]},{'EXIT',{{badmatch,{error,{shutdown,{failed_to_start_child,pgsql_pool,{shutdown,{failed_to_start_child,worker_sup,{shutdown,{failed_to_start_child,{worker,1},invalid_password}}}}}}}},[{emqttd_plugin_pgsql_app,start,2,[{file,\"src/emqttd_plugin_pgsql_app.erl\"},{line,30}]},{application_master,start_it_old,4,[{file,\"application_master.erl\"},{line,273}]}]}}}}\n11:20:10.881 <0.564.0> [error] load plugin emqttd_plugin_pgsql error, cannot start app emqttd_plugin_pgsql for {bad_return,{{emqttd_plugin_pgsql_app,start,[normal,[]]},{'EXIT',{{badmatch,{error,{shutdown,{failed_to_start_child,pgsql_pool,{shutdown,{failed_to_start_child,worker_sup,{shutdown,{failed_to_start_child,{worker,1},invalid_password}}}}}}}},[{emqttd_plugin_pgsql_app,start,2,[{file,\"src/emqttd_plugin_pgsql_app.erl\"},{line,30}]},{application_master,start_it_old,4,[{file,\"application_master.erl\"},{line,273}]}]}}}}\n11:20:28.651 <0.597.0> [error] load plugin emqttd_plugin_pgsql error, cannot start app emqttd_plugin_pgsql for {bad_return,{{emqttd_plugin_pgsql_app,start,[normal,[]]},{'EXIT',{{badmatch,{error,{shutdown,{failed_to_start_child,pgsql_pool,{shutdown,{failed_to_start_child,worker_sup,{shutdown,{failed_to_start_child,{worker,1},invalid_password}}}}}}}},[{emqttd_plugin_pgsql_app,start,2,[{file,\"src/emqttd_plugin_pgsql_app.erl\"},{line,30}]},{application_master,start_it_old,4,[{file,\"application_master.erl\"},{line,273}]}]}}}}\n15:56:31.899 <0.310.0> [error] Client(example-86321@127.0.0.1:54416): Username 'test1' login failed for \"No auth module to check!\"\n16:11:10.766 <0.347.0> [error] Client(8@127.0.0.1:54577): Username 'test1' login failed for \"No auth module to check!\"\n```\n. running \n./bin/emqttd_ctl plugins load emqttd_plugin_pgsql\ngiving this error\nload plugin error: {emqttd_plugin_pgsql,\n                    {bad_return,\n                     {{emqttd_plugin_pgsql_app,start,[normal,[]]},\n                      {'EXIT',\n                       {{badmatch,\n                         {error,\n                          {shutdown,\n                           {failed_to_start_child,pgsql_pool,\n                            {shutdown,\n                             {failed_to_start_child,worker_sup,\n                              {shutdown,\n                               {failed_to_start_child,\n                                {worker,1},\n                                invalid_password}}}}}}}},\n                        [{emqttd_plugin_pgsql_app,start,2,\n                          [{file,\"src/emqttd_plugin_pgsql_app.erl\"},\n                           {line,30}]},\n                         {application_master,start_it_old,4,\n                          [{file,\"application_master.erl\"},{line,273}]}]}}}}}\n. I think it is some postgres password setup issue. Dont know what password needed cos i didnt passed any password while installing\n. can you tell me how can i change the password for postgres user\n. I solve it!. by default postgres has 'postgres' username but no password. SO making a empty password in plugin.config was throwing error. What i did that i just changed password of  'postgres' user from  postgres command line and thats all.\n. When 1.0 is expected to release ?\n. No i haven't change anything. Everything is default. I just downloaded the latest version & started using. From java script its working fine but from java its creating issue.\n. i did it and got something this\n[info] alarm_handler: {set,{system_memory_high_watermark,[]}}\n. message.setQos(0); solved it. Can anyone explain why ? Is emqttd not supporting QOS 2 ?\n. sorry here i didnt pasted but in my original code its there\n. Yes now its working fine after upgrading to 1.1.2\n. can you please explain in details?\n. So to use that plugin i will have to build emqttd from source right? Is it possible to provide it as other emqttd plug & play type plugin rather than building it explicitly \n. What is 'EMQ Plus'  ?  whre can i find that?. So this will delete all topic specific to a particular user if client is not connected for specified interval?\nCan i set any specific topic expiration value synamically or using some regex?. What will happen if a huge number of unused topic in broker ? Will this affect performance ?.           mqttClient = new Paho.MQTT.Client(\n                constants.MQTT_HOST,\n                Number(constants.MQTT_PORT),\n                '/mqtt',\n                _ref.escapedUserId(userDetails.id)\n            );\n_ref.escapedUserId(userDetails.id) is client id and it is same client is like '123-1333-222`. If paho would drop message then other client won't be able to get message but all messaging exchange across client is happening properly. So i don't think paho is dropping message. But yes persistence is not working. ",
    "tk-za": "Where can we find this EMQPlus product?\n. ",
    "semir-karic": "Where can we find this EMQPlus product for persisting messages ?\n. ",
    "kerber": "I'm also looking for message persistence. I've done some searching, but I cannot find the mentioned EMQPlus project anywhere. Can you please direct us to it?. ",
    "opyate": "@kerber http://emqtt.com/products. > I would go for option 2 similar to VerneMQ.\nAnother concern: corruption detection.. ",
    "felipejfc": "at tfgco our solution is:\nwe created a bot mqttbot that subscribe to configurable topics and listen to all messages, it then persist every message into a elasticsearch that can be later searched to grab messages back, the very same mqttbot support plugins, it would be simple to create one to grab the  messages back.... +1. well, it seems memory is being freed with session expirations, I'll close for now and reopen if it keeps increasing, updated graph:\n\n. ",
    "danlg": "@emqplus is there any persistence possible with emqttd 1.1.1. On which database ?\nsee #327\n. ",
    "mikybone": "Hi\n@emqplus thanks for hard work.\ni have suggestion on database that used for pesistance messages:\nCouchbase is best nosql database, 6x faster than mongodb and others, please see http://www.couchbase.com/ that have many comparison papers. \nalso couchbase created with erlang like emqtt.\nkafka and cassandra created with java that lower performance against erlang.\n. Hi\nwhile emqttd running emqttd start, if want to enter emqttd console crash_dump generated:\n\nSlogan: Kernel pid terminated (application_controller) ({application_start_failure,kernel,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,net_kernel,{'EXIT',nodistribution}}}}}\n\nalso when enter erl in .../emqttd-1.1.3/erts-7.3/bin\n\n{(no error logger present)\" ienrirto rt: ei\nng in do_boot\",{badarg,[{erl_prim_loader,check_file_result,3,[{file,\"erl_prim_lo\nader.erl\"},{line,302}]},{init,get_boot,1,[{file,\"init.erl\"},{line,790}]},{init,g\net_boot,2,[{file,\"init.erl\"},{line,777}]},{init,do_boot,3,[{file,\"init.erl\"},{li\nne,744}]}]}}\nCrash dump is being written to: erl_crash.dump...done\ninit terminating in do_boot ()\n\nHow i can access observer:start(). while emqttd running?\nand when enter emqttd console without enter emqttd start before it (Console alone):\n\nobserver:start().\n** exception error: undefined function wx_object:start/3\n     in function  observer_wx:start/0 (observer_wx.erl, line 72)\n. Solved:\nneed to Copy wx-1.6.1 from .../erlang_installed_dir/lib to lib folder of emqttd.\n. @huangdan\nthanks for your replay.\nI think that you didn't grasp my notice.\ni don't intent to change retained message config. default config is good.\ni say all not delivered messages exists in Memory, but i enter observer:start() nether ets nor mnesia didn't have 200k objects in theirs lists.\n\nwhere is 200k messages putted(there is)? \n. ",
    "edmandiesamonte": "Hi @emqplus, where can I find 'EMQPlus'? It seems that it is not documented or I'm just missing something. Thanks.. My idea is to actually to retain all the recently published messages regardless if the retain flag is provided. This is only for the REST API interface. In short, if the message has a retain flag set to false, it will not be pushed to new subscribers but will be available via the REST API. This is the same limitation of Eclipse Ponte. It's a good start nonetheless. Thanks for the response.\n. Thanks, @turtleDeng. I might have missed it in the docs.. Thanks, @emqplus. I'll look into it.. Follow up question: does CoAP supports the auth and acl? Can't find what parameters needed to provide the username and password, though.. @grutabow not really familiar with CoAP though doing a quick Google search, seems like using DTLS is predominant. Does emq-coap supports that already? If so, I'll take a look at it.\nThank you.. @grutabow Awesome! Thanks!. ",
    "FlowerWrong": "It is ok.\n``` bash\n$ ./bin/emqttd console\nExec: /home/yy/softwares/emqttd/erts-7.1/bin/erlexec -boot /home/yy/softwares/emqttd/releases/0.12.0-beta/emqttd             -embedded -config /home/yy/softwares/emqttd/etc/emqttd.config             -pa ./lib/basho-patches             -mnesia dir \"/home/yy/softwares/emqttd/data/mnesia/emqttd@127.0.0.1\"             -args_file /home/yy/softwares/emqttd/etc/vm.args -- console\nRoot: /home/yy/softwares/emqttd\nErlang/OTP 18 [erts-7.1] [source] [64-bit] [smp:8:8] [async-threads:16] [kernel-poll:true]\nstarting emqttd on node 'emqttd@127.0.0.1'\nemqttd ctl is starting...[done]\nemqttd trace is starting...[done]\nemqttd pooler is starting...[done]\nemqttd client manager is starting...[done]\nemqttd session manager is starting...[done]\nemqttd session supervisor is starting...[done]\nemqttd pubsub is starting...[done]\nemqttd stats is starting...[done]\nemqttd metrics is starting...[done]\nemqttd broker is starting...[done]\nemqttd alarm is starting...[done]\nemqttd mode supervisor is starting...[done]\nemqttd bridge supervisor is starting...[done]\nemqttd access control is starting...[done]\nemqttd system monitor is starting...[done]\nErlang MQTT Broker 0.12.0 is running now\nHi, I'm from .erlang in home. \nEshell V7.1  (abort with ^G)\n(emqttd@127.0.0.1)1>\n```\n. Is it working fine in your computer?\n. ",
    "yon86": "@erylee  same thing happening...node not running when I check status or try to install plugins on ubuntu and windows please help\n. @FlowerWrong  did u get this issue fixed\n. @erylee  I didn't know that so do i need to change hostname to my pc name or ipaddress only thanks for the response\n. btw @erylee I tried it on centos 7 and it works \n. @emqplus  so I have a separate erlang installation for running rabbitmq on my pc is this the reason that I get the message node is not running\n. ",
    "syberkitten": "@emqplus We have an issue with version 2.2\nWhere a client that subscribes to topics (with clean session false)\nwhen re-connects again with clean session false\ndoes not get the retained message for the topics it subscribed.\nI found this is a good breakdown of the differences of behavior\nof MQTT broker for QoS / cleanSession / retained - variation.\nhttp://www.steves-internet-guide.com/mqtt-clean-sessions-example/\nDoes EMQ work like described in Test 4?\n. Hi @emqplus \nI'm having the same issue,\nrestart looses all retained subscriptions / message.\nSince we rely on cleanSession=false\nwhen client re-connects to a restarted broker,\nIt thinks that it is subscribed as clean=false\nand thinks it will get retained messages but it does not.\nCould client get some kind of flag on re-connect\ntelling that all retained messages have been lost?\nis it possible to revive the state manually?\ncould we backup the mnesia db and restore it manually?\n. Thanks @emqplus \nI did not know there is an enterprise version for EMQ, can you share\nmore details about ?. Adding to the report, first try with 10 workers, 20 seems too much, at least on my local machine.\nso, 10 should not be clogging the bandwidth, but it still fails:\nThe following example sends 1000 messages for every worker (10k messages)\nmalaria subscribe -n 1000 -N 10 --host localhost -q 1\nmalaria publish -t -n 1000 -P 10 --host localhost -q 1\nps: Also nodjes Mosca broker fails these tests, the only broker that did pass\nwas verneMQ for both Qos1/2\n. Yes, this fixes the problem perfectly.\nThank you \ud83d\udc4d . I did, but it did not change the behavior.\n. @grutabow \nNot many clients connected, around 10.\neach clients was creating between 500-3000 topics.\n. @grutabow \nQOS0.\nWe will run the test again on a stable version 2.2.0\nand see how it goes....\n. Is it possible to increase the number of rotated logs? . I'm having the same kind of issue where\n\n\nclient A subscribes to 100 topics\nusing clean session false.\n\n\nclient A disconnects\n\n\nclient B publishes 1 retained message to each of the 100 topics\n\n\nclient A - reconnects, and does not get any of the messages to the already\nsubscribed topics.\n\n\nShould behavior be expected to change if publishing using QoS 1 or 0 ?\n. @turtleDeng @emqplus \nAs far as I saw the MQTT specs leaves this area as grey, there is no clear definition\nand It would be good to be able to configure if:\nA. All retained messages will be re-send each time a subscribing client re-connects with (clean: 0)\nB. Retained message will be sent only when updated (current behavior) - thus client has to keep internal state of previous retained messages, and will get only updated messages.\nps. When do you plan to release an Enterprise version / support?\n. @turtleDeng \nTested again, and results are ok :)\nissue was something to do with the tooling on my end.\nI'm not able to reproduce the same problem again\nThanks.. @turtleDeng \nThanks, yes I know this :)  \nfor now will have to write a script that queries topics\nusing 'subscriptions list' and publishes manually a retained 0 \nto each topic.\n. Hi @HJianBo ,\n\n\nconnected two brokers to one cluster using the manual method. (each broker in different geo location, BrokerUsa  and BrokerJapan \n\n\nBoth dashboards show the cluster is connected and I can see two nodes.\n\n\nconnect Client2 to BrokerJapan (or BrokerUsa for that matter) and subscribe to topic. (clean: false)\n\n\nconnect Client1 to BrokerUsa and send a retained message to a topic.\n\n\nClient2 will not get the retained message, unless it re-connects.\n\n\nClient1 sends a retained message again -> Client2 should receive it (step5), but it does not arrive,\nonly when re-connecting.\n\n\nI will try reproducing again, but it is not first time I tested clustering\nmode and it failed to behave as expected.\nonce the nodes were disconnected from cluster,\nall started working as expected.\nOnce we are over this issue, the next test i wish to make is whether\nall topics are properly updated along the cluster.\n. @emqplus @chriswue As far as i understood the QoS 1 / 0 /2 \nare all contracts between broker and a client,\nthus it ensures broker and client agree that\nmessages have been arrived on the application level (not only the TCP level)\nIn my view there should be no stacking up of messages\nand there should be only one retained message period.\nwhat happens is that we get 10 retained messages\nafter the other because client published them with Qos2\nso instead of getting the last 'state' we get 10 states\nwhich ruins the whole idea of one retained message.\nI think we should stick to \nsimple and easy use cases without side effects.\nThere is no reason that QoS > 0 should stack up messages,\nif subscribers are not connected, they are going to miss these \nmessages unless a message is retained.\nlet's keep it simple stupid! what do you think?  :)\n. @chriswue \nLet just go on with the idea of QoS > 0 messages being stacked up.\nI have 10 clients publishing Qos2 messages to topic A.\nClient that subscribes to topic A is not online,\nwhen it gets online it should get 10 messages as retained ?\nHow can we deal with this?\n. I've made a few tests with EMQ 2.3.1, here is what i found:\n\nClient B Subscribes to topic \"AAAA\" with clean: false (Qos 0)\nClient B disconnects.\n\nClient A publishes 3 messages with Qos (0 or 1 or 2) to topic \"AAAA\" \n\n\nClient B re-Connects, and receives 3 messages. (subscriptions are remembered)\n\n\nIf client A publishes all the 3 messages as retained, all of them will be received\nwith a retain flag: true.\nSo there are 2 discrepancies:\n1. messages should not be kept for Client B (except retained)\n    - client B gets 3 messages that were kept offline (for no reason)\n2. There should be always only one retained messages, not multiple\nIt should be very easy to reproduce, and is made clear\nthat there is no co-relation to QoS, be it 1 / 2  or 0.\nsince not matter with what QOS the messages are published,\nclient B gets multiple messages.\n. Hello @chriswue \nThanks for clarifying some of the forest up.\nIt sounds like you made a turn to make MQTT into a more classic message Queue\nwhich somehow sounds to be a bit of an anti-pattern for MQTT Broker.\nI've tried using queue_qos0 = False, it results in the fact that no message is retained\nnot even Qos0 / Qos 1 / Qos 2\ntest with store_qos0 = False:\n- restart broker (after changing to store_qos0 = false)\n- client A subscribe to topic with clean: false\n- client A disconnect\n- client B connect send retained message to topic\n- client A - reconnects , no retained arrived.\nAnd I really don't want to connect two mqtt clients.\nwhat we do need is simply get the last retained message\nwith no other messages arriving.\nThe problem with sending multiple stacked (queued) messages\nis that they arrive with different events on('message') on our clients.\nSo if one is triggering a view, if you get more then one, or a previous state\nthat should have been deleted, really messes things up.\nIf stacked messages would arrive as an Array within a single\nmessage, it would be easier logically to operate upon and deal with.\n. @chriswue I guess we have been using MQTT broker in way which is pertaining to somewhat a different pattern, mostly all other brokers never saved QoS 0 messages out of the box.\nEMQ has some quirks and behaves in unpredicted manners,\nfor example:\n\nsometimes I get only the last retained message for QoS 0, all other messages are lost, even though I haven't set up store_qos0 = false.\nNow that i've sent store_qos0 = false and restarted broker, I don't get any retained messages.\n\nThe workflow is this (I'm not using mosquito but my own tooling since mosquitto does not support clientId and password together) \n\nStep A (Broker using store_qos0 = false)\n    -Connect client A to broker with clean session false, and subscribe to topic\n    -Disconnect\n\nStep B\n    - Connect client B (different client) to broker and publish a retained message to topic\n    - QoS 0, Retain true.\n    - Disconnect\nStep C\n    - Connect back client A, without subscribing (we are using clean false\nWhat should happen is, we get a retained message,\nbut nothing comes in.\nThe retained message arrives only when Client A connects with clean session: true\nIs this to expected?\nretained with store_qos0 = false will only arrive when connecting as cleanSession: true\n. @chriswue\nWhen I'm testing the broker nothing of the above seems stable,\nsometimes i get only one retained message, sometimes i get none.\nsometimes I publish 3 messages (store_qos0 = true) \nbut non arrive for subscriber, only retained.\nbut subscriber is using clean: false (and my new understanding is that retained will only arrive for clean: true, right?)\nbut sometimes retained is not arrived, sometimes it does,\nit makes me crazy :-P\nmaybe we should find or create a test suite to test MQTT\nissues involving expected behavior between clients \nvia a broker.\nRight now it takes too much effort to replicate a scenario\ngiven that server is being restarted, clients disconnect\nand re-connect.\nmany moving parts require end to end testing to see\nhow stable the system is, speed testing and linear load \nwhich is more obvious to tackle, (also for marketing reasons)\nis not enough to make a broker rebust, since every domain\nhas its own requirements.\n. @emqplus Yes, trying to build from source, was using the latest master branch\nand  it is 2.3.3, that's what  server shows  when i start it:\nemqttd 2.3.3 is started successfully!\n. Still not better:\nGetting:\n<0.1487.0> gen_server <0.1487.0> terminated with reason: no try clause matching ok in emqttd_client:'-send_fun/2-fun-2-'/4 line 142\n2018-01-28 13:50:32.419 [error] <0.1487.0> CRASH REPORT Process <0.1487.0> with 0 neighbours exited with reason: no try clause matching ok in emqttd_client:'-send_fun/2-fun-2-'/4 line 142 in gen_server2:terminate/3 line 1157\n2018-01-28 13:50:32.419 [error] <0.1396.0> Supervisor 'esockd_connection_sup - <0.1396.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,true},{max_clientid_len,1024},...]) at <0.1487.0> exit with reason no try clause matching ok in emqttd_client:'-send_fun/2-fun-2-'/4 line 142 in context connection_crashed\nthis is my ssl conf:\n```\nlistener.ssl.external.handshake_timeout = 15s\nlistener.ssl.external.keyfile = etc/certs/key.pem\nlistener.ssl.external.certfile = etc/certs/cert.pem\nlistener.ssl.external.cacertfile = etc/certs/cacert.pem\nlistener.ssl.external.dhfile = etc/certs/dh-params.pem\nlistener.ssl.external.verify = verify_peer\nlistener.ssl.external.fail_if_no_peer_cert = true\n```\nActually Server crashes in any case on start:\n```\n2018-01-28 13:54:04 =SUPERVISOR REPORT====\n     Supervisor: 'esockd_connection_sup - <0.1392.0>'\n     Context:    connection_crashed\n     Reason:     {{try_clause,ok},[{emqttd_client,'-send_fun/2-fun-2-',4,[{file,\"src/emqttd_client.erl\"},{line,142}]},{emqttd_protocol,send,2,[{file,\"src/emqttd_protocol.erl\"},{line,348}]},{emqttd_protocol,process,2,[{file,\"src/emqttd_protocol.erl\"},{line,228}]},{emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,322}]},{gen_server2,handle_msg,2,[{file,\"src/gen_server2.erl\"},{line,1046}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,247}]}]}\n     Offender:   [{pid,<0.1459.0>},{name,connection},{mfargs,{emqttd_client,start_link,[[{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,true},{max_clientid_len,1024},{max_packet_size,1048576},{keepalive_backoff,1.25}]]}}]\n```\nsteps I took on my local emq-relx, master branch\ngit pull \nrm -rf _ref\nmake. @emqplus  Now it works, (was oblivious to the idea that deps need to be deleted)  \nYet now I seem to have an  issue with SSL on port 8883\nwhich is not responding at all... \n. ",
    "mtappler": "I actually observed a related issue (also similar to #349, but without disconnecting). If I subscribe to a topic with a retained message twice, I receive the retained message only once, whereas [MQTT-3.8.4-3] further states that\n\nAny existing retained messages matching the Topic Filter MUST be re-sent, but the flow of publications MUST NOT be interrupted\n. I think that the new connection should not have an effect here. \n\nConsider together the portion of the spec. cited above:\n\nIf CleanSession is set to 1, the Client and Server MUST discard any previous Session and start a new one. This Session lasts as long as the Network Connection. State data associated with this Session MUST NOT be reused in any subsequent Session [MQTT-3.1.2-6].\n\nHence, according to the second sentence there is no session for client identifier \"Client1\" after closing the connection at Step 3.\nThen there is [MQTT-3.1.2-4] which says:\n\nIf CleanSession is set to 0 ...  If there is no Session associated with the Client identifier the Server MUST create a new Session. ...\n\nSo after the reconnect before Step 4, we have a new session with client identifier \"Client1\". Therefore I would say that it is a different session and thus the subscription data from the first session must not be reused according to  [MQTT-3.1.2-6].\nHowever, I know that this is an unusual case which is actually discussed in the non-normative comment at the bottom of Page 25 of the spec.:\n\nTypically, a Client will always connect using CleanSession set to 0 or CleanSession set to 1 and not swap between the two values...\n. \n",
    "zhaohaolin": "i have the same question\n. ok, thanks @erylee, i try it next week.\n. 20:50:27.033 <0.237.0> [error] long_schedule warning: pid = <0.217.0>, info: [{timeout,101},\n                                               {in,undefined},\n                                               {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{emqttd_cm,handle_cast,2}},{registered_name,[]},{status,runnable},{message_queue_len,0},{group_leader,<0.129.0>},{priority,normal},{trap_exit,false},{reductions,2895159},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,1803736},{total_heap_size,225340},{heap_size,28690},{stack_size,6},{min_heap_size,233}]\n20:50:27.462 <0.237.0> [error] long_schedule warning: pid = <0.213.0>, info: [{timeout,151},\n                                               {in,{gen_server2,loop,1}},\n                                               {out,{gen_server,cast_msg,1}}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,bif_return_trap,1}},{registered_name,[]},{status,runnable},{message_queue_len,0},{group_leader,<0.129.0>},{priority,normal},{trap_exit,false},{reductions,3647216},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,1803736},{total_heap_size,225340},{heap_size,28690},{stack_size,14},{min_heap_size,233}]\n20:50:27.482 <0.237.0> [error] long_schedule warning: pid = <0.212.0>, info: [{timeout,118},\n                                               {in,{emqttd_cm,setstats,1}},\n                                               {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,bif_return_trap,1}},{registered_name,[]},{status,runnable},{message_queue_len,0},{group_leader,<0.129.0>},{priority,normal},{trap_exit,false},{reductions,4760941},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,1803736},{total_heap_size,225340},{heap_size,28690},{stack_size,14},{min_heap_size,233}]\n20:50:28.040 <0.237.0> [error] long_schedule warning: pid = <0.210.0>, info: [{timeout,143},\n                                               {in,\n                                                {emqttd_stats,\n                                                 '-statsfun/2-fun-0-',3}},\n                                               {out,{gen_server,cast_msg,1}}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{gen_server2,loop,1}},{registered_name,[]},{status,runnable},{message_queue_len,0},{group_leader,<0.129.0>},{priority,normal},{trap_exit,false},{reductions,7219991},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,1803736},{total_heap_size,225340},{heap_size,28690},{stack_size,2},{min_heap_size,233}]\n20:50:28.106 <0.237.0> [error] long_schedule warning: pid = <0.216.0>, info: [{timeout,146},\n                                               {in,{emqttd_stats,setstats,3}},\n                                               {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,bif_return_trap,1}},{registered_name,[]},{status,runnable},{message_queue_len,0},{group_leader,<0.129.0>},{priority,normal},{trap_exit,false},{reductions,7026171},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,1803736},{total_heap_size,225340},{heap_size,28690},{stack_size,14},{min_heap_size,233}]\n20:50:28.178 <0.237.0> [error] long_schedule warning: pid = <0.217.0>, info: [{timeout,147},\n                                               {in,{gen_server2,drain,1}},\n                                               {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{gen_server,do_send,2}},{registered_name,[]},{status,runnable},{message_queue_len,0},{group_leader,<0.129.0>},{priority,normal},{trap_exit,false},{reductions,2910549},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,1803736},{total_heap_size,225340},{heap_size,28690},{stack_size,10},{min_heap_size,233}]\n20:50:28.265 <0.237.0> [error] long_schedule warning: pid = <0.213.0>, info: [{timeout,146},\n                                               {in,undefined},\n                                               {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,bif_return_trap,1}},{registered_name,[]},{status,runnable},{message_queue_len,0},{group_leader,<0.129.0>},{priority,normal},{trap_exit,false},{reductions,3656308},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,1803736},{total_heap_size,225340},{heap_size,28690},{stack_size,14},{min_heap_size,233}]\n20:50:28.325 <0.237.0> [error] long_schedule warning: pid = <0.214.0>, info: [{timeout,121},\n                                               {in,{emqttd_cm,handle_cast,2}},\n                                               {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,bif_return_trap,1}},{registered_name,[]},{status,runnable},{message_queue_len,0},{group_leader,<0.129.0>},{priority,normal},{trap_exit,false},{reductions,8262303},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,3147416},{total_heap_size,393300},{heap_size,75113},{stack_size,14},{min_heap_size,233}]\n20:50:28.420 <0.237.0> [error] long_schedule warning: pid = <0.212.0>, info: [{timeout,108},\n                                               {in,\n                                                {priority_queue,is_empty,1}},\n                                               {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,bif_return_trap,1}},{registered_name,[]},{status,runnable},{message_queue_len,0},{group_leader,<0.129.0>},{priority,normal},{trap_exit,false},{reductions,4772183},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,1803736},{total_heap_size,225340},{heap_size,28690},{stack_size,14},{min_heap_size,233}]\n21:01:53.065 <0.237.0> [error] long_schedule warning: pid = <0.67.0>, info: [{timeout,205},\n                                              {in,undefined},\n                                              {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,process_info,2}},{registered_name,memsup},{status,suspended},{message_queue_len,0},{group_leader,<0.63.0>},{priority,low},{trap_exit,true},{reductions,66341706},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,5091976},{total_heap_size,636374},{heap_size,318187},{stack_size,25},{min_heap_size,233}]\n21:03:54.544 <0.237.0> [error] long_schedule warning: pid = <0.67.0>, info: [{timeout,529},\n                                              {in,undefined},\n                                              {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,process_info,2}},{registered_name,memsup},{status,suspended},{message_queue_len,0},{group_leader,<0.63.0>},{priority,low},{trap_exit,true},{reductions,67183646},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,5091976},{total_heap_size,636374},{heap_size,318187},{stack_size,25},{min_heap_size,233}]\n21:04:55.350 <0.237.0> [error] long_schedule warning: pid = <0.67.0>, info: [{timeout,328},\n                                              {in,undefined},\n                                              {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{erlang,process_info,2}},{registered_name,memsup},{status,suspended},{message_queue_len,0},{group_leader,<0.63.0>},{priority,low},{trap_exit,true},{reductions,67610720},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,8238392},{total_heap_size,1029676},{heap_size,514838},{stack_size,25},{min_heap_size,233}]\n21:04:56.365 <0.237.0> [error] long_schedule warning: pid = <0.67.0>, info: [{timeout,958},\n                                              {in,{memsup,process_memory,1}},\n                                              {out,undefined}]\n[{initial_call,{proc_lib,init_p,5}},{current_function,{memsup,process_memory,1}},{registered_name,memsup},{status,runnable},{message_queue_len,0},{group_leader,<0.63.0>},{priority,low},{trap_exit,true},{reductions,67650747},{last_calls,false},{catchlevel,2},{trace,0},{suspending,[]},{sequential_trace_token,[]},{error_handler,error_handler},{memory,8238392},{total_heap_size,1029676},{heap_size,514838},{stack_size,24},{min_heap_size,233}]\n. ",
    "zgysc": "handle_request('GET',\"/mqtt/subtopic\", Req) ->\n  Params=mochiweb_request:parse_qs(Req),\n  ClientId = list_to_binary(get_value(\"clientId\", Params, http)),\n  Topic = list_to_binary(get_value(\"topic\", Params, http)),\n  case  emqttd_sm:lookup_session(ClientId) of\n  undefined ->\n        Req:ok({\"text/plain\", <<\"BAD_CLIENT\">>});\n  Session ->\n  lager:info(\"SUBTOPIC:Finded session: ~p\", [Session]),\n  #mqtt_session{sess_pid = Sess_pid} = Session,\n  lager:info(\"SUBTOPIC:sessionId is: ~p\", [Sess_pid]),\n  _Status = emqttd_session:subscribe(Sess_pid, [{Topic, 1}]),\n  lager:info(\"SUBTOPIC:subtopic result: ~p\" ,[_Status]),\n  Req:ok({\"text/plain\",<<\"ok\">>})\n  end;\n. ",
    "chriswue": "As a side  note: The AWS IoT gateway (which is a MQTT broker) disconnects clients on anything it doesn't like and where the protocol doesn't allow for any return codes to signal failure. It can be annoying at times but at least you immediately know something is wrong. Until the MQTT standard expands to include something like a PUBACK messages which can return an error code I think disconnecting the client on ACL violation might be a sensible option. It's better than silently dropping the message and/or pretending it worked while really it didn't.. I've managed to make it work with help of the HttpSubModule. Here is my working nginx forward proxy config:\nlocation /broker/ {\n    proxy_pass http://broker:18083/;\n    proxy_set_header Accept-Encoding \"\";\n    sub_filter_types *;\n    sub_filter_once off;\n    sub_filter 'static/' 'broker/static/';\n    sub_filter 'api/' 'broker/api/';\n}\n\nnginx is running as a docker container with port 443 bound to the host. emqtt is running as a docker container named broker with only port 8883 bound to the host. Both containers are part of an internal docker network so can resolve each other via the container name.\nThe above config  has the potential to screw things up slightly in cases where the strings \"static/\" or \"api/\" are part of the actual text displayed to the user (they will be replaced as well) but so far I haven't seen anything where it's causing issues.\nOriginally I started out with this set of replacement rules:\n    sub_filter 'href=\"/' 'href=\"/broker/';\n    sub_filter 'href=/' 'href=/broker/';\n    sub_filter 'src=\"/' 'src=\"/broker/';\n    sub_filter 'src=/' 'src=/broker/';\n    sub_filter 'url(/' 'url(/broker/';\n\nBut that didn't work out for the API calls and I found some javascript would be dynamically building URLs like some_var+=\"static/js\"+something_else, so ultimately I had to pull out the bigger hammer.\nOverall exposing the setting for base_url or root_url or whatever it's called in the framework emqtt is using would be nice (see grafana or kibana as an example) but until then this can serve as a work-around.\n. @zhanghongtong This doesn't work if you already have /static mapped to something else. I found the \"log.console.level\" setting, I'll run it with debug and then see what I get\nbtw: soak test with 2.2 died the same way after 3.5h. Ok, so after quite some time of intensive testing it turned out to have been a memory consumption issue - just the monitoring wasn't fine grained enough to pick it up (memory usage grew too fast and emqtt killed itself stopping the container and releasing the memory).\nFor posterity: Looks like emqtt became unresponsive (probably due to swapping) when queueing up larger amount of messages. The message queue size had been set to 1,000,000 (at 10,000 messages per sec that's a 100sec buffer which seemed fair enough). Interestingly bringing this down to a 10,000 message buffer allowed the system to continue without actually dropping any messages. So looks like there is a run-away point where emqtt is busy queuing up messages and fighting the memory allocator  and unable to respond (or deliver) to anything.. I think that this is as per MQTT spec and mosquitto behaves the same (last time I check at least). This guy has a pretty good overview of the retain behaviour: http://www.steves-internet-guide.com/mqtt-retained-messages-example/\nEffectively if you have a persistent subscription with QoS 1 then all message with QoS >= 1 get queued up whether they are flagged RETAIN or not doesn't matter.. @syberkitten \nRegarding:\n\nThere is no reason that QoS > 0 should stack up messages,\nif subscribers are not connected, they are going to miss these\nmessages unless a message is retained.\n\nThis is obviously incorrect - that's precisely what persistent subscriptions (Clean Session = False) are for. The RETAIN flag is for clients which have fresh a connection and want to get the latest state of a topic without having to wait until that state happens to get published again (which may only happen once every few hours or even days). It is a completely orthogonal concept to trying to ensure message delivery for QoS > 0 even if the client disconnects temporarily.\nIf you create a persistent subscription (Clean Session = False) then QoS > 0 effectively means the broker must queue up the messages (unless it runs into practical limitation such as running out of storage) in case the client can't be reached. \nFor QoS = 0 such a guarantee doesn't exist but it doesn't mean \"the broker MUST discard those messages\". MQTT doesn't specify what has to happen in that case and as such it's implementation defined. QoS level 0 doesn't \"guarantee\" message dropping, it just means for the broker it doesn't need to go the extra mile - but obviously it can if it wants to.\nemqtt has a queue_qos0 setting (https://github.com/emqtt/emqttd/wiki/Configuration) which seems to default to true so the behaviour you're seeing is completely expected.\nIf your requirement is that when you newly connect to the broker and subscribe to a topic with a retained message you only ever want the retained message delivered then you need to make that connection with Clean Session = True, this makes the server discard any existing state (including any queued messages in case that client was previously subscribed to the same topic with a Clean Session = False connection) and you only get the retained message delivered.\nThat's the only \"portable\" way between MQTT brokers. You may have to keep two client connections around in case you need Clean Session = False for other topics (where you want queuing in case the client disconnects temporarily)\nWith emqtt you could probably set queue_qos0 = False and retry your experiment and it might get you what you want but it might not (I'm just not sure if that setting relates to the publisher or the subscriber QoS level). @syberkitten: Hm, not entirely sure how you arrive at this conclusion:\n\nIt sounds like you made a turn to make MQTT into a more classic message Queue\nwhich somehow sounds to be a bit of an anti-pattern for MQTT Broker.\n\nAs per MQTT Spec section 3.1.2.4\n\nIf CleanSession is set to 0, the Server MUST resume communications with the Client based on state from the current Session (as identified by the Client identifier). If there is no Session associated with the Client identifier the Server MUST create a new Session. The Client and Server MUST store the Session after the Client and Server are disconnected [MQTT-3.1.2-4]. After the disconnection of a Session that had CleanSession set to 0, the Server MUST store further QoS 1 and QoS 2 messages that match any subscriptions that the client had at the time of disconnection as part of the Session state [MQTT-3.1.2-5]. It MAY also store QoS 0 messages that meet the same criteria.\nIf CleanSession is set to 1, the Client and Server MUST discard any previous Session and start a new one. This Session lasts as long as the Network Connection. State data associated with this Session MUST NOT be reused in any subsequent Session [MQTT-3.1.2-6].\nThe Session state in the Client consists of:\n\u00b7         QoS 1 and QoS 2 messages which have been sent to the Server, but have not been completely acknowledged.\n\u00b7         QoS 2 messages which have been received from the Server, but have not been completely acknowledged. \nThe Session state in the Server consists of:\n\u00b7         The existence of a Session, even if the rest of the Session state is empty.\n\u00b7         The Client\u2019s subscriptions.\n\u00b7         QoS 1 and QoS 2 messages which have been sent to the Client, but have not been completely acknowledged.\n\u00b7         QoS 1 and QoS 2 messages pending transmission to the Client.\n\u00b7         QoS 2 messages which have been received from the Client, but have not been completely acknowledged.\n\u00b7         Optionally, QoS 0 messages pending transmission to the Client. \n\nSo queuing up messages (or persisting them in some form) for at least QoS > 0 is what's required to conform to the MQTT spec. In how far is this an MQTT broker antipattern?\nRegarding the retained behaviour - sounds like a bug. I've tried to reproduce this with a 2.3.3 instance (store_qos0 = false) and it's working fine for me (using the mosquitto command line tools):\nFirst create persistent subscription and using mosquitto_pub -h localhost -q 1 -m \"hello\" -t \"/test\" on a different console to publish the \"hello\" message after client is subscribed:\nmosquitto_sub -h localhost -q 1 -C 1 -t \"/test\" -d -v -c -i \"myclient\"\nClient myclient sending CONNECT\nClient myclient received CONNACK\nClient myclient sending SUBSCRIBE (Mid: 1, Topic: /test, QoS: 1)\nClient myclient received SUBACK\nSubscribed (mid: 1): 1\nClient myclient received PUBLISH (d0, q1, r0, m1, '/test', ... (5 bytes))\nClient myclient sending PUBACK (Mid: 1)\n/test hello\nClient myclient sending DISCONNECT\n\nThen publish a retained message:\nmosquitto_pub -h localhost -q 1 -m \"hello retained\" -t \"/test\" -r\n\nThen reconnect:\nmosquitto_sub -h localhost -q 1 -C 1 -t \"/test\" -d -v -c -i \"myclient\"\nClient myclient sending CONNECT\nClient myclient received CONNACK\nClient myclient sending SUBSCRIBE (Mid: 1, Topic: /test, QoS: 1)\nClient myclient received SUBACK\nSubscribed (mid: 1): 1\nClient myclient received PUBLISH (d0, q1, r0, m2, '/test', ... (14 bytes))\nClient myclient sending PUBACK (Mid: 2)\n/test hello retained\nClient myclient sending DISCONNECT\n\nThis is both pub/sub with qos 1. Retain keeps working with qos 0 as well:\nmosquitto_pub -h localhost -q 0 -m \"hello retained q0\" -t \"/test0\" -r\n\nmosquitto_sub -h localhost -q 0 -C 1 -t \"/test0\" -d -v -c -i \"myclient\"\nClient myclient sending CONNECT\nClient myclient received CONNACK\nClient myclient sending SUBSCRIBE (Mid: 1, Topic: /test0, QoS: 0)\nClient myclient received SUBACK\nSubscribed (mid: 1): 0\nClient myclient received PUBLISH (d0, q0, r0, m0, '/test0', ... (17 bytes))\n/test0 hello retained q0\nClient myclient sending DISCONNECT\n\nFor normal messages (no retain flag) the messages get queued up only if both pub/sub are QoS > 0 (with store_qos0 = false). ",
    "zhengyupan": "@phanimahesh Hi, as you've mentioned, it is actually a lack of such mechanism MQTT standard 3.x. this is solved in MQTT 5, there will be an (optional) reason code return to the client when it is disconnected from the broker. \nThis feature is implemented EMQ X 3.0 beta.. @abhidtu you can use a load balancer to distribute connections over the cluster. For example, the HAProxy, it supports multiple balancing policy/algorithms and can make connections sticky to certain nodes. Here is the configuration guide for HAProxy:\nhttp://cbonte.github.io/haproxy-dconv/1.9/configuration.html. @wujie0919 This API is implemented now. you can query a client on a particular node or in cluster-wide. Please refer to these links for the API usage:\nhttps://emq-docs-en.readthedocs.io/en/latest/rest.html#retrieve-a-client-on-a-node\nhttps://emq-docs-en.readthedocs.io/en/latest/rest.html#retrieve-a-client-in-the-cluster. @elisiariocouto It is fixed in version 2.3.\nPlease refer to this document for information about automatically recovery from netsplit:\nhttps://emq-docs-en.readthedocs.io/en/latest/cluster.html#network-partition-and-autoheal. Hi, \nPlease refer to this document for version upgrade:\nhttps://emqttd-docs.readthedocs.io/en/latest/upgrade.html\n. @kenpeter Hi, you can use JWT, we have a jwt auth plug for it:\nhttps://github.com/emqx/emqx-auth-jwt. Hi @hijklmno, now shared subscription is part of MQTT 5 standard. We also improved the implementation of shared subscription, now it works cluster-wide.. Hi @shon-penteer , this function is implemented in V3.0. From this version on, the EQM X can connect to other MQTT broker using a bridge. Currently the V3 is in beta phase, you can check it out and try. \nThe configuration of bridge is in the emqx.conf file, includes the broker address, port, clientid, prefix,  ssl-setups and etc. The file is quite self-explaining. If there is any uncertainty or bugs found please contact us again. Thanks!\n============\nBridge address: node name for local bridge, host:port for remote.\n\nValue: String\nExample: emqx@127.0.0.1,  127.0.0.1:1883\nbridge.edge.address = 127.0.0.1:1883\nProtocol version of the bridge.\n\nValue: Enum\n- mqtt5\n- mqtt3\nbridge.edge.proto_ver = mqtt3\nThe ClientId of a remote bridge.\n\nValue: String\nbridge.edge.client_id = bridge_edge\nThe Clean start flag of a remote bridge.\n\nValue: boolean\nbridge.edge.clean_start = false\nThe username for a remote bridge.\n\nValue: String\nbridge.edge.username = user\nThe password for a remote bridge.\n\nValue: String\nbridge.edge.password = passwd\nMountpoint of the bridge.\n\nValue: String\nbridge.edge.mountpoint = bridge/edge/\nPing interval of a down bridge.\n\nValue: Duration\nDefault: 10 seconds\nbridge.edge.keepalive = 10s\nSubscriptions of the bridge topic.\n\nValue: String\nbridge.edge.subscription.1.topic = #\nSubscriptions of the bridge qos.\n\nValue: Number\nbridge.edge.subscription.1.qos = 1\nThe pending message queue of a bridge.\n\nValue: Number\nbridge.edge.max_pending_messages = 10000\nStart type of the bridge.\n\nValue: enum\nmanual\nauto\nbridge.edge.start_type = manual\nBridge reconnect count.\n\nValue: Number\nbridge.edge.reconnect_count = 10\nBridge reconnect time.\n\nValue: Duration\nDefault: 30 seconds\nbridge.edge.reconnect_time = 30s\nPEM-encoded CA certificates of the bridge.\n\nValue: File\nbridge.edge.cacertfile = cacert.pem\nSSL Certfile of the bridge.\n\nValue: File\nbridge.edge.certfile = cert.pem\nSSL Keyfile of the bridge.\n\nValue: File\nbridge.edge.keyfile = key.pem\nSSL Ciphers used by the bridge.\n\nValue: String\nbridge.edge.ciphers = ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384\nTLS versions used by the bridge.\n\nValue: String\nbridge.edge.tls_versions = tlsv1.2,tlsv1.1,tlsv1. Hi @renwanly ,\nyou can use rest api to unsbu a topic, please refer to this link: https://developer.emqx.io/docs/emq/v3/en/rest.html#publish-subscribe\n. Hi @brylie , A REST API is available since v2.3, please refer to this link for details:\nhttps://emq-docs-en.readthedocs.io/en/latest/rest.html\n. Hi @sasiNiranjana:\n For the question 1, according to MQTT protocol, the broker is not aware of the connection lost of a client at once, if ti doesn't expressly 'disconnects' from the broker. The broker can be sure of the client connection is lost only when the client doesn't send ping in an agreed interval. I believe this is where the delay comes.\nFor the question 2, the open source edition of EMQ X saves the session in memory, it will go lost when the broker stops. Besides the open source edition, we have also an EMQ X Enterprise edition, which support date persistence on backend DB. It stores the session on DB, thus the sessions don't go lost even when the broker is restarted.\n  . Supported in new release 3.0. @fuji4 Sorry, I got this wrong, it is not implemented yet.. @codewiget95 , \nmy thought is that to use PSK, the client should include at least one psk-ciphersuite in its hello message to the server, otherwise the server will always check if there is any certificate available.\nIn the RFC: \n\nThe client indicates its willingness to use pre-shared key\n   authentication by including one or more PSK ciphersuites in the\n   ClientHello message.  If the TLS server also wants to use pre-shared\n   keys, it selects one of the PSK ciphersuites, ......\n\nSo I changed your code of client(N) a little:\n{ok, Socket} = ssl:connect(\"localhost\", 4000, [{ciphers,[{psk, aes_256_cbc,sha512}]},{psk_identity, \"abcde\"}]),\nNow the server is not looking for a cert any more, but it doesn't understand the SSLoption...\nI did a  rp(ssl:cipher_suites()).  in shell, and find I don't have any PSK ciphersuite enabled... googled a lot trying to enable it, didn't get a clue.\nStill working on it, If you have any progress on it, please kindly share.\n. @codewiget95 it seem the PSK problem is solved, grats~ :)  I am closing this issue in this regard.\nWe can talk about how to build a plugin somewhere else. I am new to Erlang, I am sure my colleagues can do better by this topic than I can.\nBtw, Which version of OTP you are on? I am on ubuntu 16.04 with Erlang/OTP 19 and OSX with Erlang/OTP 18. On this two version I tried your trick and got multiple psk suites, one iof them is {psk,aes_256_cbc,sha384}. If there is SHA version equal to or higher than the SHA256 available, I would suggest you using it, for that the original SHA (SHA-1) is considered as insecure nowadays.\n. Hi @hackborn ,\nPlease try the release 3.0. In the new release, the bridge is rewritten and works better.. Hi @vidhill ,\nThe new release should solve this issue, if it reproduces, please reopen it.. Hi,\nBridging emq to AWS IoT is supported in the newly release emqx 3.0. Please check out and have a try.. Hi @GibliX ,\nThe nodes in a cluster must be in a same VPC. Otherwise there could be inconsistency between the nodes.\nIf you are deploying application over regions please consider using bridge to connect the clusters in different regions.. @xerosanyam please refer to this article to find how to config the EMQ with Let's Encrypt certificates.\n\ufeff\ufeff\ufeffhttps://medium.com/@emqtt/using-lets-encrypt-certificates-in-emq-b11e0e57efa6\n. Hi @arnaboss ,\nAccording your description, I have a guess that all your 4 Nifi nodes were connected to the broker at a same time, although only one of them is active (and forwarding messages to other service). This can explain your scenario 1 the nodes cannot connect of id conflict and in scenario 2 all the nifi nodes got all messages.\nPlease check the connection number of your broker and make sure there is only one nifi connection (as your expected) on the broker at a same time. Non-active Nifi nodes should not have a connection to broker.. Hi @michaelcplusplus ,\nthe persistence of QoS messages is supported by the EMQ X Enterprise Edition. . Hi @perroudchris ,\nWe have improved the implementation of shared subscription, now it works as the scenario described by grutabow.. Hi @incowiz ,\nIn your lookup test we can that the DNS service you used returns two public IPs, and in your configuration of emq you used two 172.31 address. That's why the DNS clustering didn't work for your.\nAs Vicary suggested, you can use the public IPs in your emq configuration to make them be recognized by dns auto clustering. But for an EC2 instance, it is not guaranteed that this instance will get the same public IP after it restarts. So, I will suggest that you use other ways to cluster up your nodes.\n. Hi @aravindranathan \uff0c\nThis issue is fixed in the 3.0 beta, tested using https://github.com/devsecur/robot-attack , result:\n ./robot-detect.py -p 8883  18.xx.xx.xx\nScanning host 18.224.109.239 ip 18.xx.xx.xx port 8883\nRSA N: 0xd43bf90bddaaf75aca293c5d76a807fe7300c792518923126c8dda195e023594f11ed56d505f06ff1bfb727fa163d89f020f96dfb118c3c407a6148055ac5c25ba70a4f86b3ac51eefcf3e0e1689e88f8a6695eaee2d0acd63f6c76b658df7b39d212c97ce13a00f049aaa86e71749ff7f4331fbdb1d1cede9f0b341dc95d4c81a700cdaff4d37c06f8a5b404bb72c5e29eeec9dd5e2e12b35314a25b32ad8c1d4460e6c0f3b7d9bb4b41259886ba3b85888eed7f8a9629eb80a116bf717920559864d2eb586ae0e86bba816793ba65d124a3da2fd3e8b9fb524653fc39c2b48f3409ccda5615527d24266715da0c1ae116458ddaa9fbf171f879ca6e7859127\nRSA e: 0x10001\nModulus size: 2048 bits, 256 bytes\nIdentical results (TLS alert 10 of length 7), retrying with changed messageflow\nIdentical results (Timeout waiting for alert), no working oracle found\nNOT VULNERABLE!\n. Hi Gihad,\nYou can still use contact@emqtt.io to communicate with us. We got your mail at 14:03 CET and sent out the first reply at 14:10. Sometime there would be a delay, but relax, there are our colleagues behind this email address and you will get answered. Everybody is still welcome to send mail to this address:)\nFor the pricing model, our pricing model is based on the service effort we need to deliver. This is an estimation made base on our service effort already made for different customers. EMQ X is a professional software which is very flexible for different use cases, we provide service almost to every customer. Usually, the larger the deployment is, the more effort we need to bring to the customer. To be noticed, this also covers the service cost cause by responding to the service requirement of the open source edition of our product, the EMQ X. We appreciate every paying customer, without you, the emq cannot survive.\nThere are more features in the EMQ X than in the EMQ. Which features belong to EMQ X and which belong to EMQ? The cutting-edge ones only available in EMQ X? No. We bring the best technologies both to EMQ X and to EMQ. Only the features which are mostly interested in commercial deployments is in the EMQ X. Maybe different venders have different understanding about it, this is our understanding.\n. Hi @Marina190489 , this feature is implemented in EMQ X 3.0-beta.3. . @PiedPieper this is implemented in EMQ X 3.0-beta3, please check if it meets your requirement.. Hi all,\nThis discussion is not getting updates since a while...\nActually since last two releases the emqx is able to detect a brain-split and can heal it automatically: the nodes in the minority will shutdown and start and then join the majority. The cluster should have an odd number of nodes to ensure there will always be a majority and a minority when netsplit happens.. Hi @utkarshns \nMaybe you can try 4 cores & 8G setup and monitor its load. Since you are on AWS, you can try different setups with ease.. @archerian Hi, I understand you idea. But according the the MQTT standard, the ClientID is unique in a broker, when a second connection from the same client with the same ClientID comes in, a reasonable handling is to drop the first connection with the same ID. Keeping multiple links with same id could be a non standard implementation. \nOn the other hand, to achieve your idea, there will be lot of extra logic put into the implementation. Like how much connections from the same id are allowed? What if when a link is broken and the client try to reconnect, is there a way the broker distinguishes if it is a reconnection or a multiple connection? And handling multiplication of sub/pub, which link should it use to avoid multiple copies of a same message? \nI believe all these extra logics can be avoid by a simple way of maintaining a node list on the client side (if you don't want to use a LB, or you are afraid of introducing the LB is introducing another SPOF). The broker should focus on the performance of message routing. . your configuration is fine. But I am not sure about your modification on the certificate. Usually modifying a cert makes it invalid, instead, you may re-issue a new certificate. . Hi @ozgursoft , since you have an HAProxy in place, I will suggest that you terminate the TLS/SSL on HAproxy and let the EMQ focus on MQTT processing. This will also simplify the certificate management.  . Hi @gdillen , please refer to this document for TLS/SSL.: https://medium.com/@emqtt/using-lets-encrypt-certificates-in-emq-b11e0e57efa6\nThis document was written for emqx 2.x, but still works for current version.. Hi @raceli , If you are interested in features like data persistence, please contact me per email: zhengyu.pan@emqx.io. Hi @jvrahav ,\nEach connection in emqx takes about 4k MEM. \nThe topics are always combined with subscription and route trie. they depend on your application scenario.\nFor the two cases you listed, you can do a quick test to get the answer.\nIn a normal use case, a client represents an end device, the number of clients is kind of fixed and depends on your application. If you have 1000 devices, it is usually not necessary to create 10 clients on each device and make there 10000 mqtt clients, or you could lost control on your client software.. Hi @rajkiranjeet please mail me at zhengyu.pan@emqx.io if you are interested in paid work.. Hi @sriuppu We will take this to feature requirement discussion and let you know what comes out.. ",
    "Moolica23": "I'm trying to publish message to specific topic, and i even tried the solution in this topic, but it didn't work.\nthe first problem with this solution is emqttd_pubsub:publish(Msg) function needs two parameters. \nso I'd be happy to show me a way to solve the problem\n. I have a similar issue, my client is connecting to the broker via lua https://github.com/geekscape/mqtt_lua\n19:57:27.848 <0.2034.0> [error] Client(5.117.227.67:1152): Parser failed for {{badmatch,0},[{emqttd_parser,parse_frame,3,[{file,\"src/emqttd_parser.erl\"},{line,146}]},{emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,247}]},{gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,615}]},{gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,681}]},{proc_lib,wake_up,3,[{file,\"proc_lib.erl\"},{line,250}]}]}\n19:57:27.848 <0.2034.0> [error] Client(5.117.227.67:1152): Error data: <<128,16,0,1,0,11,47,112,108,97,121,101,114,47,49,51,53,0,48,21,0,18,47,112,108,97,121,101,114,47,49,51,53,47,115,116,97,116,117,115,49,128,182,1,0,2,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,50,56,49,56,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,50,51,52,54,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,51,51,57,55,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,49,52,56,53,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,50,50,51,55,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,54,51,53,53,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,55,53,49,55,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,54,57,54,48,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,51,55,55,56,0>>\n. Dash Behrad, \nI've studied the documentation, but i can't find a way to create ram_node. the documentations show the way to create disc_node\n. I have no problem creating discnode, but i can't create ram_node.\n. I'm facing a similar problem in version 2.3\nI'm calling http/ws backend using following command: \ncurl -v --basic -u admin:public -d \"qos=2&retain=0&topic=/World&message=hello from http...\" -k http://localhost:8083/mqtt/publish\nbut here's what I see at broker error log: \n\nemqttd_ws:handle_request:64 Unexpected WS Request: POST /mqtt/publish\n\nand the curl command returns this: \n```   Trying ::1...\n TCP_NODELAY set\n Connected to localhost (::1) port 8083 (#0)\n Server auth using Basic with user 'admin'\n\nPOST /mqtt/publish HTTP/1.1\nHost: localhost:8083\nAuthorization: Basic YWRtaW46cHVibGlj\nUser-Agent: curl/7.54.0\nAccept: /\nContent-Length: 66\nContent-Type: application/x-www-form-urlencoded\n\nupload completely sent off: 66 out of 66 bytes\n< HTTP/1.1 404 Object Not Found\n< Server: MochiWeb/1.0 (Any of you quaids got a smint?)\n< Date: Mon, 06 Nov 2017 10:21:34 GMT\n< Content-Type: text/plain\n< Content-Length: 10\n< \nConnection #0 to host localhost left intact\nNot found.% \n```. \n\n",
    "abhidtu": "@huyp  have a look at this emqttd plugin written by me: \nhttps://github.com/abhidtu/emqttd_publish_client_activity\nThis will suffice your above mentioned requirements.\nThis plugin publishes a new message on all events when a client connect/disconnect/messageAck/sub/unsub \nI'm also working on integrating this plugin with kafka also so that it publishes messages on these events to kafka also.\nRead readme.md for more details\n. Hi @erylee thanks replying,\nI went through the MQTT specification and now after setting retain = false this thing is not happening.\nBut According to the specification:\nIf the RETAIN flag is set to 1, in a PUBLISH Packet sent by a Client to a Server, the Server MUST store the Application Message and its QoS, so that it can be delivered to \"future subscribers\" whose subscriptions match its topic name [MQTT-3.3.1-5]. When a \"new subscription\" is established, the last retained message, if any, on each matching topic name MUST be sent to the subscriber [MQTT-3.3.1-6].\nIf you see clientId : \"test1\" was already subscribed on a topic \"abc\" to one of the nodes in the cluster which means that \"test1\" is already an \"old subscriber\" on this topic.\nI think why this is happening is because if a node crashes and the client connects to a new node in the cluster, now it becomes a \"new subscriber\" for that node and that's why the messages gets redelivered if the retain flag = true even though this client was an old subscriber in the cluster.\nI think this retain = true/false thing should work across cluster such that even if a client connects to a new node in the cluster in case of a node crash there should be some memory which should maintain that this node was already subscribed to this channel (\"abc\") on crashed node and it is not a new subscriber on this node.\nWhat do you think about this?\n. @erylee, thanks for replying,\nWe can close this issue then.\n. same here even we are using MongoDb for most of the stuff, we also need mongodb for auth\n@prakashr87  : have a look at this project,\nhttps://github.com/emqtt/emqttd_mongodb,\n@erylee : is this work in progress or stable ?\n. Thanks @erylee for all your hard work\n. ",
    "s1ckness": "thanks for reply,check your mailbox.\n. ",
    "ReadmeCritic": ":smile: \n. ",
    "com9009": "\nthis.\nThanks for your comment.\nFor now, I open port 4369. But It doesn't work. Everything is same before i open port 4369.\n. And I also check $HOME/.erlang.cookie.\nThere are same.\n. Thanks Prots\nI opened it, but clustering is still not working.\n. Hi, erylee\nSure\nI configure node name , -name emqttd@private ip\nand others are default\n. This is current result of command 'netstat -tlnp'\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1299/sshd\ntcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      1918/cupsd\ntcp        0      0 0.0.0.0:1883            0.0.0.0:*               LISTEN      2120/beam.smp\ntcp        0      0 0.0.0.0:56926           0.0.0.0:*               LISTEN      2120/beam.smp\ntcp        0      0 0.0.0.0:18083           0.0.0.0:*               LISTEN      2120/beam.smp\ntcp        0      0 0.0.0.0:4369            0.0.0.0:*               LISTEN      2089/epmd\ntcp        0      0 0.0.0.0:8083            0.0.0.0:*               LISTEN      2120/beam.smp\ntcp        0      0 0.0.0.0:8883            0.0.0.0:*               LISTEN      2120/beam.smp\ntcp6       0      0 :::22                   :::*                    LISTEN      1299/sshd\ntcp6       0      0 ::1:631                 :::*                    LISTEN      1918/cupsd \n. ",
    "7wonders": "Well this has been frustrating the #%&# out of me and so I did some digging. Turns out that ec2/ubuntu does some weird stuff with some ports and to make the problem worse it does it on every reboot.\n```\nlsof -i :4369\nCOMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nepmd     1141 ubuntu    3u  IPv4   9182      0t0  TCP *:epmd (LISTEN)\nepmd     1141 ubuntu    4u  IPv4   9314      0t0  TCP localhost:epmd->localhost:60931 (ESTABLISHED)\nbeam.smp 1176 ubuntu   14u  IPv4   9313      0t0  TCP localhost:60931->localhost:epmd (ESTABLISHED)\n```\nSo the trick is within your security group settings open to all traffic but only to instances within your security group of course. Make a new security group, use that security group for your instance, then set a rule:\nType: All traffic\nProtocol: All\nPort range: All\nSource: Custom - start typing your security group id\nAfter this clustering works straight away. I use instance ID and instance private IP as node name.\nwget http://s3.amazonaws.com/ec2metadata/ec2-metadata\nchmod u+x ec2-metadata\nINSTANCE_ID=$(./ec2-metadata | grep instance-id | awk 'NR==1{print $2}')\nINSTANCE_IP=$(aws ec2 describe-instances --instance-ids $INSTANCE_ID --region eu-west-1 --query Reservations[].Instances[].PrivateIpAddress --output text | grep '^[0-9]')\nOUR_NODE=\"$INSTANCE_ID\"'@'\"$INSTANCE_IP\"\n. Try as a test to do as I suggest with vpc security groups - https://github.com/emqtt/emqttd/issues/385\n. Have you set the name in vm.args to the correct name? I use the node and private IP:\n-name i-1234abcdef@ec2.private.ip\nHave you set the erlang cookie on each instance to be the same?\nubuntu@ec2.private.ip:~$ nano .erlang.cookie\n. ",
    "dophlin": "Hi @erylee, that would be a great feature, it helps us to think about using emqtt in our enterprise area. Thank you.\n. Hi @erylee, in order to bridge emqttd to rabbitmq, I started to bridge emqttd with mosquitto as a test. Since I am familiar with mosquitto I can easily bridge mosquitto with emqttd by using mosquitto configuration file but in contrast, when I try to make emqttd to bridge with mosquitto it fails. In fact, I don't know what I should replace with \"emqttd2@127.0.0.1\" inside emqttd_ctl command.\n./bin/emqttd_ctl bridges start ???@127.0.0.1 topic/#\nDo you have any idea?\nThanks\n. Thank you @erylee, So it seems there is not any chance to bridge emqttd to RabbitMQ or any other Message Handler!?\n. @anhldbk in mosquitto config file, there are four credential properties for a bridge connection.\nlocal_username, local_password: Configure the username and password to be used when emqttd is connecting the bridge to mosquitto.\nremote_username, remote_password: Configure the username and password to be used when mosquitto is connecting the bridge to emqttd.\nPlease note that all of these properties must be set for a valid connection. Also, keep it in your mind, this connection is not under TLS.\n. @zhengyupan I cannot find the configuration you pointed in the emqx.conf. Is it still supported to bridge emqx to mosquitto through emqx.conf?. @phanimahesh I can connect to the EMQX with the provided username and password through websocket client tool. Also, the client can subscribe to the message/1/2 and publish to the topic too. but the bridge of mosquitto is not successfull. Here is the mosquitto log:\n1551983169: Connecting bridge sample (lqmqtt:1883)\n1551983169: Bridge mosquitto_id_emqx sending CONNECT\n1551983169: Received CONNACK on connection local.mosquitto_id_emqx.\n1551983169: Connection Refused: not authorised\n1551983169: Socket error on client local.mosquitto_id_emqx, disconnecting.\nHere are the enabled plugins: emqx_dashboard, emqx_management, emqx_recon, emqx_retainer\n. When I disable EMQX_ACL_NOMATCH=deny, the bridge connects successfully, in the EMQX dashboard, the protover of the bridge connection is v4. But in the mosquitto.conf I have set mqtt version as follow:\nbridge_protocol_version mqttv311\nIs it related to the issue?. Any support?. I've just solved my problem by getting the mosquitto user all access. . ",
    "JoeFerrucci": "Hi @erylee, the 1.0 release was two days ago :+1:\nWhat's the status on the RabbitMQ Bridge - any idea when it will be released? \n. ",
    "amirkheirabadi": "Hi @emqplus, the current release is 2.3.4.\nI really need Rabbit Bridge. any idea when it will be released?. ",
    "turtleDeng": "@dophlin \nemqx-enterprise support message bridge to RabbitMQ\nhttps://www.emqx.io/downloads/emq/enterprise?osType=Linux. @heidawei \nThe emqx-enterprise supports message persistence to the DB to ensure that messages are not lost.\nhttps://www.emqx.io/downloads/emq/enterprise?osType=Linux. @gbrehmer \nThe emqx-enterprise supports message persistence to the DB.\nhttps://www.emqx.io/downloads/emq/enterprise?osType=Linux. Parse the packet in 2.0:\n<<128,16,0,1,0,11,47,112,108,97,121,101,114,47,49,51,53,0,48,21,0,18,47,112,108,97,121,101,114,47,49,51,53,47,115,116,97,116,117,115,49,128,182,1,0,2,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,50,56,49,56,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,50,51,52,54,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,51,51,57,55,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,49,52,56,53,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,50,50,51,55,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,54,51,53,53,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,55,53,49,55,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,54,57,54,48,0,0,17,47,116,111,117,114,110,97,109,101,110,116,47,52,51,55,55,56,0>>\n```\n{mqtt_packet,{mqtt_packet_header,8,false,1,false},\n                 {mqtt_packet_subscribe,1,[{<<\"/player/135\">>,0}]},\n                 undefined}\n{mqtt_packet,{mqtt_packet_header,8,false,1,false},\n                 {mqtt_packet_subscribe,1,[{<<\"/player/135\">>,0}]},\n                 undefined}\n{mqtt_packet,{mqtt_packet_header,8,false,1,false},\n                 {mqtt_packet_subscribe,2,\n                    [{<<\"/tournament/42818\">>,0},\n                     {<<\"/tournament/42346\">>,0},\n                     {<<\"/tournament/43397\">>,0},\n                     {<<\"/tournament/41485\">>,0},\n                     {<<\"/tournament/42237\">>,0},\n                     {<<\"/tournament/46355\">>,0},\n                     {<<\"/tournament/47517\">>,0},\n                     {<<\"/tournament/46960\">>,0},\n                     {<<\"/tournament/43778\">>,0}]}, undefined}\n.\n<<130,59,0,3,0,54,118,49,47,56,56,56,48,48,50,49,48,48,48,48,48,48,48,48,48,48,48,48,48,48,55,52,51,47,116,111,107,101,110,47,100,101,102,97,117,108,116,47,97,99,116,105,111,110,47,102,108,97,115,104,0>>\n```\n{mqtt_packet,{mqtt_packet_header,8,false,1,false},                    \n                 {mqtt_packet_subscribe,3,[{<<\"v1/888002100000000000000743/token/default/action/flash\">>,0}]},\n                 undefined}\n. Thank you, we will consider to support this feature.\n. hi, \u201c%c\u201d is not allowed  in mqtt wildcard\n. You check etc/emqttd.conf, acl default is to use anonymous way\n. hi,\n  It's not official, but the follow-up to the official version will be released emqttd docker, so stay tuned.\n. @drasko  emqx30 is released in dockerhub,  please use the command: docker pull emqx/emqx. hi, \n  leave attach using ctl + d\n. The Java/Android Clients: https://eclipse.org/paho/clients/java/ . May be helpful to you. \n. hi\n  Which branch do you use? You can try using our latest branch of our try.\n. hi\n  Please check etc / emqttd.conf\n. hi\n  emqtt2.0 can only support the erlang R18, emqtt3.0 will support erlang R19\n. @drasko It seems the mosquitto does not support hostname, Please fix the address:\naddress 127.0.0.1:1883\n. Please check: https://github.com/emqtt/emqttd_auth_mongo/blob/master/test/emqttd_auth_mongo_SUITE.erl\n. hi\n  You look at your client using the tcp or http protocol, from the log point of view is that you use the websocket request to connect tcp port error\n. Please use utf8 encoding format\n. hi\nthis is java clients, https://eclipse.org/paho/clients/java/ . May be helpful to you.\n. These are erlang inside the term, please see http://erlang.org\n. Please use v1.1.3, this version is a stable version\n. http://emqtt.com/docs/v2/tune.html\n. http://emqtt.io/docs/v2/tune.html#emqttd-broker\n. http://emqtt.io\n. Sorry, can not be dynamically added, only through the configuration to modify\uff01\n. hi\n  Thank you, this is indeed a bug, we later modify the bug.\n. @LiYBo, please check the inflight window size of client side if you use the eclipse paho library.\n. hi\n  config.broker.port?\n  Check if the listeners for https is configured in the emq.conf file.\n. ws match mqtt.listener.http\nwss match mqtt.listener.https\n. hi\nHere is how to configure the https documentation.\nhttp://emqtt.com/docs/v2/config.html#mqtt-websocket-ssl-8084\n. Error log file for me to look at.\nWhat client are you using to connect MQTTS?\n. hi\n  You use javascript client, please use the 8084 port https, #750  has told you how to open the https port.\n. emu.conf change\nHTTP(SSL) Listener\nmqtt.listener.https = 8084\nmqtt.listener.https.acceptors = 4\nmqtt.listener.https.max_clients = 64\nmqtt.listener.https.handshake_timeout = 15\nmqtt.listener.https.certfile = etc/certs/cert.pem\nmqtt.listener.https.keyfile = etc/certs/key.pem\n. 2.0 stable will open the https port by default\n. hi\n  source code in deps/emqttd directory\n. Are there any error logs? Do you want to configure one-way authentication or two-way authentication?\n. Attempt 3\nConcatenating chain.pem + Root CA = chainca.pem\nhttps://mosquitto.org/2015/12/using-lets-encrypt-certificates-with-mosquitto/\n```\nSSL Options\nmqtt.listener.ssl.handshake_timeout = 15\nmqtt.listener.ssl.keyfile = etc/certs/keyfile.pem\nmqtt.listener.ssl.certfile = etc/certs/cert.pem\nmqtt.listener.ssl.cacertfile = etc/certs/chainca.pem\nmqtt.listener.ssl.verify = verify_peer\nmqtt.listener.ssl.fail_if_no_peer_cert = true\n```\n. {verify, verify_type()}\nA server only does x509-path validation in mode verify_peer, as it then sends a certificate request to the client (this message is not sent if the verify option is verify_none). You can then also want to specify option fail_if_no_peer_cert.\n{fail_if_no_peer_cert, boolean()}\nUsed together with {verify, verify_peer} by an SSL server. If set to true, the server fails if the client does not have a certificate to send, that is, sends an empty certificate. If set to false, it fails only if the client sends an invalid certificate (an empty certificate is considered valid). Defaults to false.\nSee the ssl documentation for details\uff01\n. 18083 is in the etc/emq_dashboard.conf configuration.\n. \n. You can find how to bridge mosquitto here http://emqtt.io/docs/v2/bridge.html\n. It seems the cacertfile is not right.. @Max01010101010101 This issue has been fixed. please build the broker from master branch.. Sorry, this is because the client program security issues lead to, you can use ca-signed certificate.. @chimit http://emqtt.com/docs/v2/guide.html#http-publish. @sanket-kulkarni-vmware \nPlease tell me the way the client connects to the broker. @sanket-kulkarni-vmware The broker will not persist sessions.. @yuvrajdhl1988 http://emqtt.io/docs/v2/cluster.html#. @michaelcplusplus Windows compiler need to rely on erlang.mk detailed installation see https://erlang.mk/guide/installation.html#_on_windows. @jayareddyd try connect host 172.27.0.2. @MuskaWu Check your domain mapping ip is the same as the machine ip. @renwanly emqx3.0 support REST API clear ACL cache, http://emqtt.io/docs/v2/rest.html#clear-the-acl-of-a-specified-client-in-the-cluster. @ralphtheninja  Use the 8884 port for WebSocket/SSL connections. @chimit http publish api not support superuser auth and acl. @StarpTech Please read the documentation: http://emqtt.io/docs/v2/guide.html#. @chowyu08 EMQ still not support tlsv-1.3. @michaelcplusplus \nWindows does not support syslog, please clone emq-relx 'windows' branch\nRUN git clone -b 'windows' https://github.com/emqtt/emq-relx.git /emq-relx  \nRUN cd /emq-relx && make. Invalid issue. Closed.. @masoud91 download the latest centos6.8 rpm package http://emqtt.com/downloads/2101/centos6-rpm. @tkaarrela \nemqx:hook(HookName, {Topic, Function}, [Params]).\nemqx:hook('message.publish', {<<\"topic1\">>,fun mod:fun/2}, [Params]),\nemqx:hook('message.publish', {<<\"topic2\">>,fun mod:fun/2}, [Params]).. @vidhill \nStill Not support file.p12, need to be converted to cert and key\nopenssl pkcs12 -in file.p12 -out cert.pem -nodes\nopenssl rsa -in cert.pem -out key.pem. @masoud91  Please provide your installation command with the conflict logs. @masoud91 I installed emqttd on a clean CentOS7 node, and still cannot reproduce the conflict.\n. @pritstift \n\nI tried to compile EMQ with Erlang/OTP R19.3, but can not reproduce the issue. . @satrox28  http://emqtt.io/docs/v2/plugins.html#emq-dashboard-dashboard-plugin. @satrox28 \nThe Web Dashboard for EMQ broker. The plugin will be loaded automatically when the broker started successfully.\nweb browser http://localhost:18083/#/websocket. @s4kibs4mi  https://github.com/emqtt/emq-elixir-plugin.  EMQ JWT Authentication Plugin https://github.com/emqtt/emq-auth-jwt. @nestor5  rpm -ivh --force emqttd-centos7-v2.1.2-1.el7.centos.x86_64.rpm. @lufuyang \nThe emqx-enterprise supports message persistence to the DB to ensure that messages are not lost.\nhttps://www.emqx.io/downloads/emq/enterprise?osType=Linux. @franklinxkk  What is the password input by the client?. @pritstift This issue has been fixed in 2.2-beta.2. @edmandiesamonte  etc/emq.conf\n```\nACL nomatch\nmqtt.acl_nomatch = allow\n. @mostafiz789  http://emqtt.io/docs/v2/plugins.html#emq-auth-ldap-ldap-auth-plugin. @mostafiz789\n-e EMQ_AUTH__LDAP__PORT=\"your port\" \\\n. @behrad \nThe emqx-enterprise supports message persistence to the DB to ensure that messages are not lost.\nhttps://www.emqx.io/downloads/emq/enterprise?osType=Linux. @m-abdalrahman  New node joins the cluster,  new_node  emqttd_ctl cluster join cluster_node\n. @satrox28 Of course. @edsamonte \nThe emqx-enterprise supports message persistence to the DB.\nhttps://www.emqx.io/downloads/emq/enterprise?osType=Linux. @wiiikiii \nworking rules config\n {allow,  all,  subscribe, [ \"topic/session/+/da\", \"topic/session/+/da/+\" ] }.\n {deny,  all,  subscribe,  [ \"topic/session/+/da/+\", \"topic/session/#\" ] }.\nallowed should be\ntopic/session/123/da/+\ntopic/session/123/da/aab\n```\nbut denied should\ntopic/session/+/da/+\ntopic/session/#\nIf you configured \n{deny,  all, subscribe, [ \"topic/session/#\", { eq, \"#\" } ] }.\nthen topic/session/ any level of topic will be denied subscription. @rhwu cluster problem reference #496 . @duythang we have released an enterprise edition of EMQ to support persistence in mongodb backends. I plan to upgrade the emqtt.io site and publish the edition later:). @Bazmundi  http://emqtt.io/docs/v2/install.html#install-via-deb. @Bazmundi \nsystemd service https://github.com/emqtt/emq-package/blob/master/rpm/emqttd.service\n/usr/lib/systemd/system/emqttd.service\n. @Bazmundi  systemctl enable emqttd.service\n. @CC-Hsu http://emqtt.io/docs/v2/install.html#install-via-rpm. @baer-devl restart_listener working in v2.2-rc.2. @syberkitten  Please check your ~/.erlang.cookie file exists,If it exists, delete it\n. @codewiget95 sudo apt-get install libbsd-dev. @codewiget95  Run make command, send me the console log. @hos7ein  Configure /etc/systemd/system.conf\nDefaultLimitNOFILE=1048576. @anchandan The status code (\"217/USER\") seems to indicate that the user you specified in the service declaration is not valid on your system.. @michaelschollerer https://github.com/emqtt/emqttd/blob/master/src/emqttd_protocol.erl#L268. @workingegg Thanks.\nhttps://github.com/emqtt/emq-package/commit/7cd8a26dd51618d12fffc557a4c369d5762d7afa. @kpacn Turn the 'mqtt.allow_anonymous' and 'mqtt.acl_nomatch' off:\n```\nAllow Anonymous authentication\nmqtt.allow_anonymous = false\nACL nomatch\nmqtt.acl_nomatch = deny\n. @rauger Please check your erlang operating environment. @arihantdaga we have released an enterprise edition of EMQ to support persistence in mongodb backends. I plan to upgrade the emqtt.io site and publish the edition later:). ![wechatimg1034](https://user-images.githubusercontent.com/1830077/28601979-feb6ffe8-71ed-11e7-86be-6c4ff2cfe353.jpeg)\n. @ArmorHerO The 'Mneisa node down' log means the two nodes disconnected with each other for network issue.\n. @hackborn You can modify the configuration through the environment variable.\nhttps://github.com/emqtt/emq-docker. Any cfg  item can be configured. @ArmorHerO  Please use ./bin/emqttd console,  tune the log.level to debug . @srdgame\nsudo emqttd start\n```\n successfully?. @fleimgruber Yes, The problem we will fix in v2.3-beta.4. @syberkitten http://emqtt.io/docs/v2/rest.html#clients. @Mojo90 Please install the DEB package for Ubuntu16: http://emqtt.io/downloads/latest/ubuntu16_04-deb Installation Guide: http://emqtt.io/docs/v2/install.html#install-via-deb. sudo service emqttd  start\nsudo service emqttd status\n```\n\u25cf emqttd.service - LSB: Erlang MQTT Broker\n   Loaded: loaded (/etc/init.d/emqttd; bad; vendor preset: enabled)\n   Active: active (exited) since Wed 2017-07-26 14:29:36 CST; 2 weeks 5 days ago\n     Docs: man:systemd-sysv-generator(8)\nJul 26 14:29:31 emqtt-ubuntu systemd[1]: Starting LSB: Erlang MQTT Broker...\nJul 26 14:29:33 emqtt-ubuntu su[1780]: Successful su for emqtt by root\nJul 26 14:29:33 emqtt-ubuntu su[1780]: + ??? root:emqtt\nJul 26 14:29:33 emqtt-ubuntu su[1780]: pam_limits(su:session): Could not set limit for 'nofile' to soft=2190000, hard=2190000: Operation not permitted; uid=0,euid=0\nJul 26 14:29:33 emqtt-ubuntu su[1780]: pam_unix(su:session): session opened for user emqtt by (uid=0)\nJul 26 14:29:36 emqtt-ubuntu emqttd[853]: emqttd 2.3 is started successfully!\nJul 26 14:29:36 emqtt-ubuntu systemd[1]: Started LSB: Erlang MQTT Broker.\nAug 15 09:06:59 emq-ubuntu systemd[1]: Started LSB: Erlang MQTT Broker.\n```\n1. This is the normal start of the information, please check your start after the emqttd return value is 0\n\ncluster use \nemqttd_ctl cluster join codename. Are you installed by deb package?. \nroot@sensors2:~# cluster use emqttd_ctl cluster join ***nodename***\n\nemqttd_ctl cluster join nodename. @Mojo90 \nv2.3-beta.4 fixes the service start problem, here is the download address.\nhttp://emqtt.io/downloads/latest/ubuntu16_04-deb. @sobelman The issue has been fixed in 2.3-beta.3. @tremoteye \nhttps://github.com/emqtt/emq-modules#subscription-module\n```\nEnable Subscription, Values: on | off\nmodule.subscription = on\nSubscribe the Topics automatically when client connected\nmodule.subscription.1.topic = $client/%c\nQos of the subscription: 0 | 1 | 2\nmodule.subscription.1.qos = 1\nmodule.subscription.2.topic = $user/%u\nmodule.subscription.2.qos = 1\n. @naruto0916 \nhttp://emqtt.io/docs/v2/guide.html#\nSupport auth/ACL chain, and open emq_auth_username and emq_auth_mongo. @naruto0916 \neg: enabled emq_auth_username, emq_auth_clientid, emq_auth_mongo.\nif emq_auth_username is allowed,EMQ will accept the connection,if emq_auth_username not find, next check emq_auth_clientid, if emq_auth_clientid not find,  check emq_auth_mongo, and so on.. Suggested use: \nemq_auth_mysql\nemq_auth_pgsql\nemq_auth_http. @fleimgruber\ncd /var/lib/emqttd\nls -la\nResult send me.\nchown emqtt .erlang.cookie\n```. @fleimgruber \nWe will fix the issue in v2.3-beta.4. @trehn  Please provide crash.dump file\n. Provide your operating environment and hardware configuration?. cpu and memory?. @trehn  crash.dump error may be related to your hardware configuration, I suggest you configure a higher server in the test.. #1065 . auth.http.acl_nomatch The configuration item has been removed\nemq.conf\nmqtt.acl_nomatch  = allow. @chriswue The issue been fixed.. @n3ksus \nets:match_object(mqtt_subproperty, {{Topic, '_'}, '_'}).. Invalid issue, closed. Invalid issue, closed. @dreamcatcha Cannot publish to wildcard topic according to MQTT v3.1.1 specification.. @xiaoshuangfh  Check your payload encoding format, should be utf8.. @drejkus \nThe url of this API has been changed to \u2018api/v2/mqtt/publish\u2019 in v2.3-beta.2 release. Read the doc in REST API.\ndoc is http://emqtt.io/docs/v2/rest.html#messages\nAuthorized dashboard user is admin/public\ncurl -v --basic -u admin:public -H \"Content-Type: application/json\" -d '{\"topic\": \"test\",\"payload\": \"hello\",\"qos\": 1,\"retain\": false,\"client_id\": \"C_1492145414740\"}' -k http://localhost:8080/api/v2/mqtt/publish\n. @bigonese \nmqtt.listener.ssl.tls_versions = tlsv1.2,tlsv1.1,tlsv1\nmqtt.listener.ssl.handshake_timeout = 15s\nmqtt.listener.ssl.keyfile = etc/certs/dw.key\nmqtt.listener.ssl.certfile = etc/certs/dw.crt\nmqtt.listener.ssl.cacertfile = etc/certs/dw.ca\nmqtt.listener.ssl.verify = verify_peer\nmqtt.listener.ssl.fail_if_no_peer_cert = false\n...\nmqtt.listener.https.keyfile = etc/certs/dw.key\nmqtt.listener.https.certfile = etc/certs/dw.crt\nmqtt.listener.https.cacertfile = etc/certs/dw.ca\nmqtt.listener.https.verify = verify_peer\nmqtt.listener.https.fail_if_no_peer_cert = false. If a message is published, but there are no subscribers to the topic, the message will be dropped.. @swarno http://emqtt.io/docs/v2/tune.html. @syberkitten \nClient(12345@79.176.29.246:60839): RECV DISCONNECT(Q0, R0, D0)\n\uff1f\uff1f\uff1f. @EzPluto Will message  RETAIN flag is?. step1: clear retian message\nstep2: Will message RETAIN flag false. @Eric24 \nemqx-enterprise support message bridge to RabbitMQ\nhttps://www.emqx.io/downloads/emq/enterprise?osType=Linux. @jwestra \nhttp://emqtt.io/docs/v2/commands.html#admins-passwd. @shuaibakram Please provide more logs.. @shuaibakram Please check your emq_auth_mongo state.. @hamdijmii1992 \nhttps://github.com/emqtt/emq-relx. @xerosanyam \nThis configuration auth.mongo.acl_nomatch does not exist, please use it emq.conf\nmqtt.acl_nomatch = deny\n. @xerosanyam \nPlease see documentation: http://emqtt.io/docs/v2/guide.html#user-guide. @xerosanyam \nauth.mongo.acl_nomatch unavailable,please use it emq.conf\nmqtt.acl_nomatch = deny. @bihackers Please provide your ssl configuration and elaborate how the client connects to the broker. . @kekemuyu http://emqtt.io/docs/v2/rest.html#basic-authentication. @ax003d  https://github.com/emqtt/emq-docker. @hbahn The mqtt.pubsub.pool_size parameter is invalid and has been deleted.. @yogo1212 \nqos = 0 message is not redeliver, please provide emqttd log.. @sincsc Authorized dashboard user is admin/public. @sincsc  emqttd version?. @sincsc 2.2\uff1f, Please provide the path to your download package.. @sincsc 2.2 does not support REST API, please upgrade to 2.3-beta.3 after the version.. @Zhang-Xianglong  emqttd version?\n- OS: ?\n- Erlang/OTP: ?\n- EMQ: ?. @Zhang-Xianglong The issue has been fixed in 2.3-beta.3 release.#1207. @syberkitten \nemqttd_ctl command line could be used to query and administrate the EMQ broker.\nsubscriptions list                              # List all subscriptions\nsubscriptions show <ClientId>                   # Show subscriptions of a client\nsubscriptions add <ClientId> <Topic> <QoS>      # Add a static subscription manually\nsubscriptions del <ClientId>                    # Delete static subscriptions manually\nsubscriptions del <ClientId> <Topic>            # Delete a static subscription manually. @madhushreegc \nThe emqx-enterprise supports message persistence to the DB.\nhttps://www.emqx.io/downloads/emq/enterprise?osType=Linux. @wangping886 More programming languages clients please https://github.com/mqtt/mqtt.github.io/wiki/libraries. @naruto0916 Has been fixed and released at v2.3.1. @thuandh86  REST API http://emqtt.com/docs/v2/rest.html#id20. @Think7 http://emqtt.io/docs/v2/commands.html#admins. ./emqtt_bench_pub -c 1 -i 10 -t bench/%i -s 256 -p 8883\n09:48:01.725 [info] Application lager started on node nonode@nohost\n09:48:01.727 [info] Application emqttc started on node nonode@nohost\n09:48:01.727 [info] Application emqtt_benchmark started on node nonode@nohost\nconneted: 1\nsent(2001): total=1, rate=1(msg/sec)\nsent(3001): total=2, rate=1(msg/sec)\nsent(4001): total=3, rate=1(msg/sec)\nsent(5001): total=4, rate=1(msg/sec)\nsent(6001): total=5, rate=1(msg/sec)\nsent(7001): total=6, rate=1(msg/sec)\nsent(8001): total=7, rate=1(msg/sec)\nsent(9001): total=8, rate=1(msg/sec)\nsent(10001): total=9, rate=1(msg/sec)\nsent(11001): total=10, rate=1(msg/sec)\nsent(12001): total=11, rate=1(msg/sec)\nsent(13001): total=12, rate=1(msg/sec)\nsent(14001): total=13, rate=1(msg/sec)\nsent(15001): total=14, rate=1(msg/sec)\nclient 1 EXIT: {shutdown,tcp_closed}\nsent(16000): total=15, rate=1(msg/sec). @hello2dj Please add an \\\\ escape character before /\n  . ```\nversion: '3'\nservices:\n    emqtt-server:\n        #build: .\n        image: \"emqttd-docker-v2.3.1\"\n        container_name: emqtt-server\n        restart: always\n        ports:\n            - \"8883:8883\"\n            - \"1883:1883\"\n            - \"18083:18083\"\n        environment:\n            - EMQ_LOADED_PLUGINS=\"emq_auth_http,emq_recon,emq_modules,emq_retainer,emq_dashboard\"\n            - EMQ_AUTH__HTTP__AUTH_REQ=\"http:\\/\\/172.25.100.3:7001\\/mqtt\\/auth\"\n            - EMQ_AUTH__HTTP__AUTH_REQ__METHOD=post\n            - EMQ_AUTH__HTTP__SUPER_REQ=\"http:\\/\\/172.25.100.3:7001\\/mqtt\\/auth\"\n            - EMQ_AUTH__USER__1__USERNAME=admin\n            - EMQ_AUTH__USER__1__PASSWORD=public\n        volumes:\n            - /home/dj/etc/certs:/opt/emqttd/etc/certs:ro\n        user: root\n        logging:\n            driver: \"json-file\"\n            options:\n                max-size: \"200m\"\n                max-file: \"5\"\n. @hello2dj  OK..\nauth.http.auth_req = http://127.0.0.1:8080/mqtt/auth\nauth.http.auth_req.method = post\nauth.http.auth_req.params = clientid=%c,username=%u,password=%P\nauth.http.super_req = http://127.0.0.1:8080/mqtt/superuser\nauth.http.super_req.method = post\nauth.http.super_req.params = clientid=%c,username=%u\n'access' parameter: sub = 1, pub = 2\nauth.http.acl_req = http://127.0.0.1:8080/mqtt/acl\nauth.http.acl_req.method = get\nauth.http.acl_req.params = access=%A,username=%u,clientid=%c,ipaddr=%a,topic=%t\n\nauth.http.auth_req = xxx\nnot\nauth.http.auth_req = \"xxx\"\n. @nvandamme Please check if the 1883 port is occupied.\n exception exit: {{cannot_listen,1883,eaddrinuse},[{gen_server,init_it,6,[{file,\"gen_server.erl\"},{line,344}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,247}]}]}\n```. @ajeshpg @msdevanms \nThe emqx-enterprise supports message persistence to the DB to ensure that messages are not lost.\nhttps://www.emqx.io/downloads/emq/enterprise?osType=Linux. @TheBeachMaster \nSupport ip and hostname, please check hostname.. @PiedPieper  Fixed in 2.3.6 release.. @haok3166 EMQ X Enterprise Edition already support.. emqx support prometheus. https://github.com/emqx/emqx-statsd/tree/emqx30. @huydinhle  Sorry, can't support it at 2.3.11. @huydinhle 3.0.0 has been released, there will be no 2.4-beta.1. @PiedPieper https://github.com/emqtt/emqttd/blob/master/priv/emq.schema#L162. @PiedPieper Fixed in 2.3.6 release.. @nagendraK6 http://emqtt.io/docs/v2/tune.html. @nagendraK6 https://github.com/emqtt/emq-relx/pull/176. @PiedPieper Fixed in 2.3.6 release.. @gautaz @ahmadalli Sorry, it has been updated, please download http://emqtt.io/downloads/latest/docker. @victorclaessen emqttd 3.0 will support LDAP ACL.. @brad-plumewifi \nIt should not be a typo. If the '/var/lib/emqttd/' directory already exists,  dpkg would print \"Not creating home directory `/var/lib/emqttd' message.. @gbrehmer Sorry, your version will be closed because version 2.3.11 is not updated.. Fix https://github.com/emqx/cuttlefish/commit/871e1dc20e93c58c8d63b4b6329b7640a8c3cd7f. @tiagodeoliveira  Thanks, we will merge the PR in the 3.0-beta.1 release.. @andileeb https://github.com/emqx/emqx-docker#configuration. @suspai Sorry, does not support configuration.. @davorozo https://github.com/emqtt/emqttd/issues/1052. @chunzhenzyd Please submit at https://github.com/emqtt/emqtt_benchmark/issues/new. @spring2maz The issue has been fixed and will be released at 3.0-beta.3. https://github.com/emqx/emqx-management/commit/04e87aa53359d9742f1023b4f13b7b080587f73a. @KenggL I want emqx_web_hook for you. https://github.com/emqx/emqx-web-hook. @jdavidagudelo The issue has been fixed and will be released at 3.0-rc.5.. Please compile emq-relx with Erlang/OTP 20.\ngit clone -b v2.3.11 https://github.com/emqtt/emq-relx.git\ncd emq-relx && make\ncd _rel/emqttd && ./bin/emqttd console. @boboxiaodd \nhttp://emqtt.io/docs/v3/rest.html#create-a-subscription\n{\n  \"topics\": \"topic1,topic2\",\n  \"qos\": 1,\n  \"client_id\": \"mqttjs_ab9069449e\"\n}. @Marina190489 \nAfter modifying acl.conf, please use \n./bin/emqx_ctl acl reload. @theronic \nThe list of topics subscribed to by the client can be obtained through the API and emqx_ctl\nAPI http://emqtt.io/docs/v3/rest.html#list-subscriptions-of-a-client-on-a-node\nemqx_ctl\n```\n./bin/emqx_ctl\n\nsubscriptions list                              # List all subscriptions\nsubscriptions show                    # Show subscriptions of a client\nsubscriptions add         # Add a static subscription manually\nsubscriptions del              # Delete a static subscription manually\n\n```. @ioncamera {shutdown,closed} is a client socket exception disconnected, please check your client program. ets:match_objec/3, If the table is empty, '$end_of_table' is returned.. acl_kick_client rename acl_kick_connection. bridge.aws.queue.replayq_dir = {{ platform_data_dir }}/emqx_aws_bridge/. handle_info({'EXIT', ConnPid, normal}, State = #state{will_msg = WillMsg, expiry_interval = 0, conn_pid = ConnPid}) ->\n    {stop, Reason, State#state{will_msg = undefined, conn_pid = undefined}};. %% Copyright (c) 2013-2019 EMQ Technologies Co., Ltd. All Rights Reserved.. %% Copyright (c) 2013-2019 EMQ Technologies Co., Ltd. All Rights Reserved.. ",
    "sakayoga": "hi @erylee,\nthis is the current log directory, all emqtt_error.log is empty except for emqttd_error.log.2\n[venus@broker log]$ ls -l\ntotal 108\n-rw-rw-r-- 1 venus venus     0 Nov 26 22:31 emqttd_crash.log.0\n-rw-rw-r-- 1 venus venus     0 Nov 23 16:52 emqttd_crash.log.3\n-rw-rw-r-- 1 venus venus     0 Nov 26 22:31 emqttd_error.log.0\n-rw-rw-r-- 1 venus venus   187 Nov 24 14:39 emqttd_error.log.2\n-rw-rw-r-- 1 venus venus     0 Nov 23 16:52 emqttd_error.log.3\n-rw-rw-r-- 1 venus venus 56350 Nov 27 06:45 emqttd_sasl.log\n-rw-rw-r-- 1 venus venus 44274 Nov 27 20:01 erlang.log.1\n-rw-rw-r-- 1 venus venus   263 Nov 26 22:31 run_erl.log\n[venus@broker log]$ cat emqttd_error.log.2\n14:37:53.923 <0.8850.1> [error] HTTP Auth failure: username=athena, reason=\"Username Not Found\"\n14:39:57.629 <0.8858.1> [error] HTTP Auth failure: username=zeus, reason=\"Password Error\"\nfor the emqttd_sasl.log i forgot to backup it after crash. The content is overriden by emqttd when i start the emqttd again.\n. hi @erylee, i use 0.13.0 release. i already change the vm.args config when it happens.\nBut righ now, after i restart the emqttd it still run stable. \n. Hi @erylee, sory for not update the status to you.\nYes we can close this issue, I will let you know if it happen again. with more detail log :D\nthanks again, you are the best :+1: \n. ",
    "Linuturk": "The other half of this usage pattern is sharing client sessions and subscriptions across clustered emqtt nodes.\nIf a client connects through some kind of load balancing system to a single emqtt node, that information isn't shared to the other nodes in that cluster. If that same client then reconnects to a different node, it might miss information unique to the original node.. I wanted to +1 this request. If the nodes are in a cluster, the connected client data should be shared between all nodes for consistent API and Dashboard interactions.. I believe I'm seeing a regression in the latest version of emqtt that reintroduces this problem. (2.2.0)\n```\ncurl -i http://localhost:8083/status\nHTTP/1.1 404 Object Not Found\nServer: MochiWeb/1.0 (Any of you quaids got a smint?)\nDate: Tue, 11 Jul 2017 18:50:51 GMT\nContent-Type: text/plain\nContent-Length: 10\nNot found.\n```\n@emqplus not sure if this would require reopening the issue or more information from my side. Please let me know how I can help.. Log excerpts:\n```\n==> /var/log/emqttd/error.log <==\n2017-07-11 23:00:52.556 [error] <0.1485.0>@emqttd_ws:handle_request:64 Unexpected WS Request: GET /status\n==> /var/log/emqttd/erlang.log.1 <==\n23:00:52.556 [error] Unexpected WS Request: GET /status\n(emqttd@x.x.x.x)1>\n``. Looks like that port is now responding usingemqttd_ws.erlvsemqttd_http.erlwhich would explain why I'm not seeing the expected response.. Ok, I figured this out. Looks like the HTTP management API moved to port 8080 with the new configuration file defaults. If you are looking to solve this yourself, usehttp://localhost:8080/status`. Here's my attempt:\n```\ndpkg -l | grep emqttd\nii  emqttd                              2.3                                        amd64        Erlang MQTT Broker\nemqttd start\ntime emqttd start\nreal    0m27.017s\nuser    0m10.796s\nsys 0m1.524s\n. /etc/emqttd/emq.conf:\ngrep -v \"#\" /etc/emqttd/emq.conf | grep -v \"^$\"\ncluster.name = emqcl\ncluster.discovery = dns\ncluster.autoheal = on\ncluster.autoclean = 5m\ncluster.dns.name = \ncluster.dns.app = emq\nnode.name = emq@100.xx.xx.xx\nnode.cookie = xxxxxxxx\nnode.smp = auto\nnode.kernel_poll = on\nnode.async_threads = 32\nnode.process_limit = 256000\nnode.max_ports = 65536\nnode.dist_buffer_size = 32MB\nnode.max_ets_tables = 256000\nnode.fullsweep_after = 1000\nnode.crash_dump = /var/log/emqttd/crash.dump\nnode.dist_net_ticktime = 60\nnode.dist_listen_min = 6369\nnode.dist_listen_max = 6379\nlog.dir = /var/log/emqttd\nlog.console = console\nlog.console.level = error\nlog.syslog = on\nlog.syslog.level = error\nlog.error.file = /var/log/emqttd/error.log\nlog.crash = on\nlog.crash.file = /var/log/emqttd/crash.log\nmqtt.allow_anonymous = true\nmqtt.acl_nomatch = allow\nmqtt.acl_file = /etc/emqttd/acl.conf\nmqtt.cache_acl = true\nmqtt.max_clientid_len = 1024\nmqtt.max_packet_size = 64KB\nmqtt.websocket_protocol_header = on\nmqtt.conn.force_gc_count = 100\nmqtt.client.idle_timeout = 30s\nmqtt.client.enable_stats = off\nmqtt.session.max_subscriptions = 0\nmqtt.session.upgrade_qos = off\nmqtt.session.max_inflight = 32\nmqtt.session.retry_interval = 20s\nmqtt.session.max_awaiting_rel = 100\nmqtt.session.await_rel_timeout = 20s\nmqtt.session.enable_stats = off\nmqtt.session.expiry_interval = 2h\nmqtt.session.ignore_loop_deliver = false\nmqtt.mqueue.type = simple\nmqtt.mqueue.max_length = 1000\nmqtt.mqueue.low_watermark = 20%\nmqtt.mqueue.high_watermark = 60%\nmqtt.mqueue.store_qos0 = true\nmqtt.broker.sys_interval = 60\nmqtt.pubsub.pool_size = 8\nmqtt.pubsub.by_clientid = true\nmqtt.pubsub.async = true\nmqtt.bridge.max_queue_len = 10000\nmqtt.bridge.ping_down_interval = 1\nmqtt.plugins.etc_dir =/etc/emqttd/plugins/\nmqtt.plugins.loaded_file = /var/lib/emqttd/loaded_plugins\nlistener.tcp.external = 0.0.0.0:1883\nlistener.tcp.external.acceptors = 16\nlistener.tcp.external.max_clients = 102400\nlistener.tcp.external.access.2 = allow all\nlistener.tcp.external.backlog = 1024\nlistener.tcp.external.buffer = 4KB\nlistener.tcp.external.nodelay = true\nlistener.tcp.internal = 127.0.0.1:11883\nlistener.tcp.internal.acceptors = 16\nlistener.tcp.internal.max_clients = 102400\nlistener.tcp.internal.backlog = 512\nlistener.tcp.internal.tune_buffer = on\nlistener.tcp.internal.buffer = 1MB\nlistener.tcp.internal.recbuf = 4KB\nlistener.tcp.internal.sndbuf = 1MB\nlistener.tcp.internal.nodelay = true\nlistener.ssl.external = 8883\nlistener.ssl.external.acceptors = 16\nlistener.ssl.external.max_clients = 1024\nlistener.ssl.external.access.1 = allow all\nlistener.ssl.external.handshake_timeout = 15s\nlistener.ssl.external.keyfile = /etc/emqttd/certs/key.pem\nlistener.ssl.external.certfile = /etc/emqttd/certs/cert.pem\nlistener.ws.external = 8083\nlistener.ws.external.acceptors = 4\nlistener.ws.external.max_clients = 64\nlistener.ws.external.access.1 = allow all\nlistener.ws.external.backlog = 1024\nlistener.ws.external.recbuf = 4KB\nlistener.ws.external.sndbuf = 4KB\nlistener.ws.external.buffer = 4KB\nlistener.ws.external.nodelay = true\nlistener.wss.external = 8084\nlistener.wss.external.acceptors = 4\nlistener.wss.external.max_clients = 64\nlistener.wss.external.access.1 = allow all\nlistener.wss.external.handshake_timeout = 15s\nlistener.wss.external.keyfile = /etc/emqttd/certs/key.pem\nlistener.wss.external.certfile = /etc/emqttd/certs/cert.pem\nlistener.api.mgmt = 127.0.0.1:8080\nlistener.api.mgmt.acceptors = 4\nlistener.api.mgmt.max_clients = 64\nlistener.api.mgmt.access.1 = allow all\nsysmon.long_gc = false\nsysmon.long_schedule = 240\nsysmon.large_heap = 8MB\nsysmon.busy_port = false\nsysmon.busy_dist_port = true\n``. Also attempted with clustering set tomanualand thecluster.dns.*options commented out.. It looks like there was a problem with the DNS entry I had setup. It was pointing to older versions of emqttd that weren't compatible with clustering. It would be helpful if there were some log messages or other output that would call out why emqttd is failing to start.. This was coupled with a permission issue on the.erlang.cookiefile under/var/lib/emqttd/`. Hijacking to ask a question. I successfully have DNS based auto clustering working now. Thanks! Loving the feature.\nAuto clean works great as well.\nDoes emqttd recheck the DNS entries over time and join with all the entries it eventually finds, or is DNS only queried at first start? It would be nice if it had a polling feature that rechecked the clustering type for new nodes to join on some interval. Guess this became a feature request.. Popping this here for reference. I'm solving this now with a bash script setup in cron.\n```\n!/bin/bash\nNODECOUNT=curl -s http://admin:public@localhost:7101/api/nodes | python -m json.tool | grep \"name\" | wc -l\ntimestamp() {\n    date --rfc-3339=seconds\n}\necho $(timestamp) \"Found $NODECOUNT node(s).\"\nif (( $NODECOUNT < 2 )); then\n    echo $(timestamp) \"Fewer than 2 nodes. Restarting...\"\n        /etc/init.d/emqttd restart\nfi\n```. ",
    "coco1960": "if the ldap server need to Authentication by username and passowrd (like cn=Direcotry Manager ),how to config the parameter?\n. ",
    "Bazmundi": "Ah.  Dopey me.  I had a emqttd console up in a second window.  I closed that and then the problem disappears.\n. @turtleDeng and?\nI did pose the question on emqttd groups about the /etc/rc.f/init.d/functions file.  Including what was the point of the \"functions\" file as it does not come with my version of linux.  \nThat is, I had no /etc/rc.d/init.d/functions\nI found a \"version\" on the internet but that did not help, and there was no help from the group.\nBesides, adding a rogue file from \"somewhere\", into a mix that isn't working, didn't make sense.\nI am not even sure the functions file was being called?\nWould it be safe to say I could go back to the file at http://emqtt.io/docs/v2/install.html#install-via-deb and leave out the \"functions\" file?\n. @turtleDeng and so ...\nI used the file at http://emqtt.io/docs/v2/install.html#install-via-deb but deleted sourcing of \"functions\"\nThinking I might del then re-add mqtt:\n... chkconfig --del mqtt\nreturned:\ninsserv: warning: script 'mqtt' missing LSB tags and overrides\nmqtt                      0:off  1:off  2:off  3:off  4:off  5:off  6:off. @turtleDeng ta da!\nroot@house:~# systemctl -l status mqtt.service\n? mqtt.service - SYSV: emqttd is mqtt broker.\n   Loaded: loaded (/etc/init.d/mqtt)\n   Active: inactive (dead)\nThat is with or without \"functions\" sourced. @turtleDeng wow\nThese strips are tricky with all the undocumented \"features\"\nMy script would not start with either service or systemctl.\nThe http://emqtt.io/docs/v2/install.html#install-via-deb script starts using service but still doesn't appear to run on boot.\n. Just after booting:\nroot@house:~# systemctl -l status mqtt.service\n? mqtt.service - SYSV: emqttd is mqtt broker.\n   Loaded: loaded (/etc/init.d/mqtt)\n   Active: inactive (dead)\nroot@house:~# systemctl enable mqtt\nSynchronizing state for mqtt.service with sysvinit using update-rc.d...\nExecuting /usr/sbin/update-rc.d mqtt defaults\ninsserv: warning: script 'mqtt' missing LSB tags and overrides\nExecuting /usr/sbin/update-rc.d mqtt enable\nupdate-rc.d: error: mqtt Default-Start contains no runlevels, aborting.. @turtleDeng what about\nshould:\n[Service]\nType=forking\nEnvironment=HOME=/root\nExecStart=/bin/sh emqttd start\nBecome:\n[Service]\nType=forking\nEnvironment=HOME=/root\nExecStart=/bin/sh /opt/emqttd/bin/emqttd start\nAnd I assume that is instead of /etc/init.d/mqtt?  So I should delete /etc/init.d/mqtt?\nI assume I will be chmod +x /usr/lib/systemd/system/emqttd.service?  Any other flags?\nAnd since I don't have a /usr/lib/systemd/system folder I will create it using mkdir?. @turtleDeng ah hem\nFrom reboot with /etc/init.d/mqtt deleted and /usr/lib/systemd/system/mqtt.service created at your behest:\nroot@house:~# systemctl -l status mqtt\n? mqtt.service - emqtt daemon\n   Loaded: loaded (/usr/lib/systemd/system/mqtt.service; disabled)\n   Active: inactive (dead)\nchkconfig reports no mqtt service (so previous LSB problem seems to be related to service starting as init.d job).. @turtleDeng perhaps,\nThere is a school of thought on one forum that the following is needed (a change to /opt/emqttd/bin/emqttd):\nThe change suggested is from:\n-args_file $RUNNER_ETC_DIR/vm.args\nTo:\n-args_file $RUNNER_ETC_DIR/vm.args -detached -noinput -noshell -- ${1+\"$@\"}\"\nThat didn't work for me either BUT the \" at the right end is ambiguous as the code in the emqttd file is surrounded by \"\" - so I wasn't sure if the author was lazy (and left out the \" at the far left of line) or the change was to be within \"changed line\"\n. @turtleDeng so\nfrom console:\n```\nroot@house:~# service mqtt start\nroot@house:~# systemctl -l status mqtt\n? mqtt.service - emqtt daemon\n   Loaded: loaded (/usr/lib/systemd/system/mqtt.service; disabled)\n   Active: active (running) since Mon 2017-06-19 14:03:23 CEST; 2min 37s ago\n  Process: 869 ExecStart=/bin/sh /opt/emqttd/bin/emqttd start (code=exited, status=0/SUCCESS)\n   CGroup: /system.slice/mqtt.service\n           tq 925 /opt/emqttd/erts-8.2/bin/epmd -daemon\n           tq 932 /opt/emqttd/erts-8.2/bin/run_erl -daemon /tmp/root_erl_pipes/emqttd@127.0.0.1/ /opt/emqttd/log exec \"/opt/emqttd/bin/emqttd\" \"console\"\n           tq 934 /opt/emqttd/erts-8.2/bin/beam.smp -W w -e 256000 -Q 65536 -P 256000 -A 32 -K true -zdbbl 32768 -- -root /opt/emqttd -progname opt/emqttd/bin/emqttd -- -home /root -- -boot /opt/emqttd/releases/2.2/emqttd -mode embedded -boot_var ERTS_LIB_DIR /opt/emqttd/erts-8.2/../lib -mnesia dir \"/opt/emqttd/data/mnesia/emqttd@127.0.0.1\" -config /opt/emqttd/data/configs/app.2017.06.19.14.03.09.config -kernel net_ticktime 60 -smp auto -setcookie emqsecretcookie -name emqttd@127.0.0.1 -vm_args /opt/emqttd/data/configs/vm.2017.06.19.14.03.09.args -- console\n           tq1199 erl_child_setup 1024\n           tq1273 sh -s disksup\n           tq1274 /opt/emqttd/lib/os_mon-2.4.1/priv/bin/memsup\n           mq1276 /opt/emqttd/lib/os_mon-2.4.1/priv/bin/cpu_sup\nJun 19 14:03:23 house sh[869]: emqttd 2.2 is started successfully!\nJun 19 14:03:23 house systemd[1]: Started emqtt daemon.\n```\nSo, still only starts from console but does not boot?. @turtleDeng Here we are full circle.\n. root@house:~# systemctl -l status\n? house\n    State: degraded\n     Jobs: 0 queued\n   Failed: 1 units\n    Since: Thu 1970-01-01 01:00:08 CET; 47 years 5 months ago\n   CGroup: /\n           tq1 /sbin/init\n           tqsystem.slice\n           x tqmqtt.service\n           x x tq 925 /opt/emqttd/erts-8.2/bin/epmd -daemon\n           x x tq 932 /opt/emqttd/erts-8.2/bin/run_erl -daemon /tmp/root_erl_pip\n           x x tq 934 /opt/emqttd/erts-8.2/bin/beam.smp -W w -e 256000 -Q 65536\n           x x tq1199 erl_child_setup 1024\n           x x tq1273 sh -s disksup\n           x x tq1274 /opt/emqttd/lib/os_mon-2.4.1/priv/bin/memsup\n           x x mq1276 /opt/emqttd/lib/os_mon-2.4.1/priv/bin/cpu_sup\n           x tqlirc.service\n           x x mq518 /usr/sbin/lircd --driver=default --device=/dev/lirc0\n           x tqwpa_supplicant.service\n           x x mq504 /sbin/wpa_supplicant -u -s -O /run/wpa_supplicant\n           x tqpolkitd.service\n           x x mq474 /usr/lib/policykit-1/polkitd --no-debug\n           x tqntp.service\n           x x mq444 /usr/sbin/ntpd -p /var/run/ntpd.pid -g -u 105:110\n           x tqsystemd-logind.service\n           x x mq380 /lib/systemd/systemd-logind\n           x tqdbus.service\n           x x mq371 /usr/bin/dbus-daemon --system --address=systemd: --nofork -\n           x tqssh.service\n           x x mq368 /usr/sbin/sshd -D\n           x tqNetworkManager.service\n           x x mq367 /usr/sbin/NetworkManager --no-daemon\n           x tqrsyslog.service\n           x x mq366 /usr/sbin/rsyslogd -n\n           x tqpm2-root.service\n           x x tq689 PM2 v2.5.0: God Daemon (/root/.pm2)\n           x x mq704 node-red\n           x tqcron.service\n           x x mq361 /usr/sbin/cron -f\n           x tqhaveged.service\n           x x mq360 /usr/sbin/haveged --Foreground --verbose=1 --write=1024\n           x tqsystemd-journald.service\n           x x mq303 /lib/systemd/systemd-journald\n           x tqsystemd-udevd.service\n           x x mq174 /lib/systemd/systemd-udevd\n           x tqsystem-getty.slice\n           x x mqgetty@tty1.service\n           x x   mq489 /sbin/agetty --noclear tty1 linux\n           x mqsystem-serial\\x2dgetty.slice\n           x   mqserial-getty@ttyS0.service\n           x     mq481 /sbin/agetty --keep-baud 115200 38400 9600 ttyS0 vt102\n           mquser.slice\n             mquser-0.slice\n               tqsession-2.scope\n               x tq 698 /bin/login --\n               x tq 799 -bash\n               x tq3872 systemctl -l status\n               x mq3873 pager\n               mquser@0.service\n                 tq795 /lib/systemd/systemd --user\n                 mq796 (sd-pam). What I also see on boot is:\nroot@house:~# systemctl --failed\n  UNIT                         LOAD   ACTIVE SUB    DESCRIPTION\n? systemd-modules-load.service loaded failed failed Load Kernel Modules\nBut that doesn't bother pm2 which starts up and then starts my node-red install.. @turtleDeng have you given up?  Is there someone who can help please then if you cannot?\nI have tried everything you suggested.  All of it was what I had already tried before I posted but I was curious what I might have missed.\nIs there a way to turn on a more verbose error logging?  . @turtleDeng thank you for your patience.\nThat was the last piece of the puzzle.  The the OPiZ now boots both node-red and emqttd so I have a match box sized mqtt/node-red server at last.\nThankyou again.. I can confirm, after rebooting a number of times, the emqttd starts without having to log in and run it from console.\nI did have a niggly problem were I couldn't even browse into node-red (which was starting on boot fine).  It seems occasionally my OPiZ was starting up with no connection configuration (static IP, gateway address nor DNS addresses).  I will count that as a separate problem (and likely not for emqttd issue).. ",
    "hachreak": "hi @erylee, there are news about rebar3 compatibility? :)\n. why do you want to switch to erlang.mk?\nrebar3 became the official building tool for erlang: https://github.com/erlang/rebar3\n. what about if I have my plugin compiled with rebar3?\nHow can I load it (with all dependencies) with the current version of emqttd?\n. Hi @emqplus \nI made some modification to be able to use emqttd with my plugin compiled with rebar3.\nI can confirm it works because I successfully integrated my plugin.\nWDYT? There are chances to be merged?\n. @emqplus thanks for the good news! :D \nWhen you'll be ready, call me and I'll rebase my PR on top of master. :)\n. There is still pending my PR to be able to write plugins compile by rebar3: https://github.com/emqtt/emqttd/pull/528 (I will publish an example soon)\nBut I don't know exactly the @emqplus plans about move to erlang.mk.\nHe wrote I am considering to consolidate the dependency management.\n. Hi @erylee, did you plan to implement directly inside emqttd or to use an external lib?\n. Exist a roadmap to consult somewhere? Just to know for when is planned the v1.2.\nBy the way, if you look for DTLS support, I think you can be interested on this PR.\n. Hi @balcruz \nI think it's fine also with merge because it should easily distinguish a rebar3 app from a rebar2 app.\nBut, It's fine, I think I'll use umerge.\n@emqplus Yesterday evening I was playing with rebar3 release.\nMaybe, if all works as expected, I'll simplify a bit the PR.\nIf you see there, I needed to use a different rebar3 profile: default profile where I get the module dependency list and from the prod profile the plugin compiled code.\nMy problem was \"avoid to add emqttd (and all its deps) on ERL_LIBS two times (see here).\nDo you know if I can have a dependency list from rebar2 projects? (like rebar3 deps).\n. whats' your plan? :)\n. Hi @emqplus \ndid you do some major changes about  dependency management?\nI'll publish an plugin example compiled by rebar3 to show how to use it with the help of this patch.\n. Hi at all,\nsorry for the delay.\nI published a special branch for emqttd_plugin_template compiled with rebar3.\nMost of changes are only there to be able to run emqttd + the plugin with:\ndocker-compose build\ndocker-compose up\nMost of the work is made by the rebar.config + emqttd with the patch in this PR.\n. I found also this project that looks interesting: https://github.com/lindenbaum/lbm_kv\nA dynamically-distributed, highly-available, partition-tolerant, in-memory key-value store built with Mnesia.\n. :+1: \n. Hi @emqplus,\nI tried to connect with MQTTS from a python paho client and I read in the log:\n2017-02-08 23:46:23.491 [error] <0.1466.0>@emqttd_client:received:280 Client(172.23.0.1:52232): Parser failed for {function_clause,[{emqttd_parser,parse_utf,[<<1,0,107>>],[{file,\"src/emqttd_parser.erl\"},{line,206}]},{emqttd_parser,parse_frame,3,[{file,\"src/emqttd_parser.erl\"},{line,81}]},{emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,259}]},{gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,601}]},{gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,667}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,247}]}]}\n2017-02-08 23:46:23.491 [error] <0.1466.0>@emqttd_client:received:281 Client(172.23.0.1:52232): Error data: <<22,3,1,0,107,1,0,0,103,3,1,205,158,173,26,175,144,131,10,118,66,171,14,171,253,54,47,232,41,35,24,219,91,61,206,100,74,185,84,229,79,235,218,0,0,34,192,10,192,20,0,57,0,56,192,9,192,19,0,51,0,50,0,136,0,135,0,69,0,68,0,53,0,47,0,132,0,65,0,255,1,0,0,28,0,11,0,4,3,0,1,2,0,10,0,4,0,2,0,23,0,35,0,0,0,22,0,0,0,23,0,0>>\nAnybody has experience of this issue?. I'm not sure if the order of checks is predictable.\nI mean, it looks like depends on the order how the plugins are loaded.\nIt will be awesome to be able to define in a deterministic way the order of checks. :smile: . p.s. Also the commit from @turtleDeng could help! :). @emqplus please, could you give me an example of MQTTS connect with the paho library?. and what about an hook?. I can confirm the issue.\nIf I use esockd v4.2 it looks working.\nPlease, could you pin esockd version for stable release?. ",
    "hzamani": "Any update here?\n. ",
    "zyfmix": "\u975e\u5e38\u611f\u8c22\uff0c\u9ed8\u8ba4 ./etc/emqttd.config \u8fd9\u884c\u88ab\u6ce8\u91ca\u6389\u4e86\u3002\n. ",
    "zzeng4": "whenever the client is online, to give a retain message to a topic, for example /clientid/state.  if you want to check if the user is online or offline, subscribe to this topic and it will return the according state of that client.   \nand then you can use this message to decide if to send apns or just the standard mqtt message.\nthis is what i did in my project and it works flawlessly.\n. ",
    "SumitFlochat": "Still not working .\nAny help?. If i clone that I dont get the source code .\nI actually want to customize the Broker so i need source code too.\n. Thank You :)\n. I cloned the code from \"https://github.com/emqtt/emqttd-relx.git\" was able to run the broker after using commands.\nPlease help me with the path for the log file where logs will be made and the code of line that writes log in the file .\n. Can You please provide the solution .\nI am also facing the same error. @emqplus  .\nThank you for your reply...\nIt's working .... :+1: . Can you specify the reason for this crash or help me with the way to get out of this?\nIt will be a great help.. Atleast let me know the issue so that i can figure out the way to get out of it.\nI am stuck on my production and its down since 26th June . ",
    "Yongke": "Hi, this is the key feature for subscriber load balancing which we are waiting for in emqttd. Would it possible to have higher priority? ;-)\n. ",
    "smartbruce": "great job\n. ",
    "adarshlal": "Hi,\nIts a wonderful feature..\nIs there any document available for implementing this in emqttd cluster.\nDo we need to add any plugin to get this feature?\n. ",
    "shrikantlahase": "thanks feng\nOn Fri, Jan 29, 2016 at 1:35 PM, Feng Lee notifications@github.com wrote:\n\n@shrikantlahase https://github.com/shrikantlahase, please check wiki:\nhttps://github.com/emqtt/emqttd/wiki/Bridge\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/438#issuecomment-176632921.\n. Hi feng,\n1. Bridging mosquitto broker and emqttd broker was not successful. Can you\n   do any help...?\n2. I am trying  to connect paho mqtt client which written in python to\n   emqttd broker but its not happening. How to connect as a client to emqttd\n   broker...?\n\nRegards & Thanks,\nShrikant\nOn Fri, Jan 29, 2016 at 2:54 PM, Feng Lee notifications@github.com wrote:\n\n@shrikantlahase https://github.com/shrikantlahase, I am not sure if\nmosquitto could bridge to emqttd. If any issues, please contact us:)\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/438#issuecomment-176659639.\n. Hi feng,\n\nI am attaching my python client code. I tried command \"./emqttd_ctl\nclients  list\"\n to see clients connected but output is blank.  Can u tell me anything\nwrong in code...? or need to check on broker side\nThanks and regards,\n. thanks for the fix.\nI am yet to test your solution you provided to this issue. Time being you\ncan closed the issue. If some problem other issue occurs , i will inform\nyou.\nthanks and Regards\nShrikant\nOn Sun, Feb 21, 2016 at 8:21 PM, Feng Lee notifications@github.com wrote:\n\nhi @shrikantlahase https://github.com/shrikantlahase, could we close\nthe issue?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/438#issuecomment-186834643.\n. \n",
    "jianglinchun": "bridge from mosquitto to emqttd not successfully. I've test both mqtt broker by mosquitto_pub and both of them works fine.\nmosquitto bridge configuration:\nconnection emqttd\naddress 101.200.88.13:1883\ntopic /test both  \nbridge_protocol_version mqttv31\nstart_type automatic\nlocal_clientid C_00:0C:29:2B:77:52\nemqttd error log:\n18:11:20.601 <0.485.0> [error] Client(116.236.226.166:60775): Framing error - protocol_header_corrupt\nemqttd listeners:\n[root@iZ25r8abgnyZ emqttd]# ./bin/emqttd_ctl listeners\nlistener on http:8083\n  acceptors       : 4\n  max_clients     : 64\n  current_clients : 1\n  shutdown_count  : []\nlistener on mqtts:8883\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:1883\n  acceptors       : 16\n  max_clients     : 512\n  current_clients : 0\n  shutdown_count  : [{protocol_header_corrupt,31}]\nlistener on http:18083\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 3\n  shutdown_count  : []\n. Unexpected behavior. Pls check the following mosquitto log(unacceptable protocol version and works after retry???):\n1455734681: Connecting bridge 000C292 (101.200.88.13:1883)\n1455734681: Bridge OpenWrt.000C292 sending CONNECT\n1455734681: Received CONNACK on connection wd_000C292B7752.\n1455734681: Connection Refused: unacceptable protocol version\n1455734681: Socket error on client wd_000C292B7752, disconnecting.\n1455734712: Bridge wd_000C292B7752 doing local SUBSCRIBE on topic /test\n1455734712: Connecting bridge 000C292 (101.200.88.13:1883)\n1455734712: Bridge OpenWrt.000C292 sending CONNECT\n1455734712: Received CONNACK on connection wd_000C292B7752.\n1455734712: Bridge wd_000C292B7752 sending SUBSCRIBE (Mid: 2, Topic: /test, QoS: 0)\n. Thank you for you fix. It works now.\n. Try dashboard.\nhttps://github.com/emqtt/emqttd_dashboard\n. @bangarharshit I've read your spec on https://github.com/DrawersApp/Mqtt-chat.\nDo you have any planing or roadmap??\n. @bangarharshit Thank you so much for your answer. I just got my time to get back to this topic.\nI'm currently response for tens of thousands devices. \nI'd like to deploy a communication mechanism between devices.\nAnd I had been a team member of Fetion. I'd like to keep contact with you. :)\n. ",
    "zhengdianyong": "I found it in plugin.\nhttps://github.com/emqtt/emqttd_dashboard/blob/2a1de2c79fe97a91b6c1e4da19af94273b874b21/etc/plugin.config\nThanks!\n. @erylee I got it, thank u~~\n. ",
    "VikramTiwari": "emqttd is written using Erlang, but the final output package is a binary that you can run on various platforms. Working with this binary is as easy as running nginx or apache server on your server. You don't need to know the semantics of the language unless you want to contribute to the development of the project.\nThere is enough documentation, configuration examples and supporting tools available for emqttd that normally you will never have to be worried about not understanding what's going on in the program. Moreover, if you have any issues, you can always get some help here.\nTo compare this with other brokers, others might be older and more stable, but emqttd is rapidly evolving for not just scale but also for security and its plugins base.\nMy suggestion: Always go for something that gives you peace of mind.\n. ",
    "87sanchavan": "Thank you so much for inspiring me to use Erlang. I have started learning Erlang from past 2 days. Its really great programming language even though it is little difficult to understand in the beginning for people like me who worked on other languages like java , javascript etc.\n. Here is what I have done as you mentioned. However whenever I restart the broker and reconnects both clients and when Client A send message on a topic to which Client B is subscribed , client B wont get any message. Client B has to re subscribe to the same topic to get messages.\nI have set clean session = false at clients side.\nCan you please tell me if restarting broker will loose all subscriptions. If it doesn't , then why broker doesn't send messages automatically when clients get connected.\n%% Modules\n    {modules, [\n        %% Client presence management module.\n        %% Publish messages when client connected or disconnected\n        {presence, [{qos, 0}]},\n```\n    %% Subscribe topics automatically when client connected\n     {subscription, [\n    %%    %% Subscription from stored table\n       stored,\n    %%\n    %%   %% $u will be replaced with username\n        {\"$Q/username/$u\", 1},\n    %%\n    %%   %% $c will be replaced with clientid\n       {\"$Q/client/$c\", 1}\n     ]}\n%% Rewrite rules\n%% {rewrite, [{file, \"etc/rewrite.config\"}]}\n\n]},\n```\n. Thank you a ton for replying quickly.\n_Our problem : _\n1.We have multiple clients( connected through mobile app) which will  be subscribing  to topics according to their requirement. This is one time activity and will be carried out when clients are signed up for first time.\n2. Most of times clients are  disconnected to the broker however whenever they want to get information from server , they will open the app and automatically gets connected to broker and then we want broker to send them all available information to the clients. This means information will be published for these clients when they were offline.\n3. I have tested above scenario with emqttd and it is working fine so I am good with emqttd for above problem.\nBut the main problem is when emqttd server gets restarted , no clients will get any message even though they are already subscribed. \nOne solution could be to make all clients to resubscribe to their topics when they connect , however this will not work since they wont receive the messages which were published when they were offline.\nCan you please advise us on how we can solve  this problem.\nThanks\nSanjay\n. Thank you so much!!!\n. Oky... Thanks\n. Thank you erylee.\n. I will close the issue. However It would be really helpful for everyone if you can add mongodb plugin to emqttd installable ( like redi plugin)so we don't need to separately fetch mongodb plugin into emqttd. \n. ",
    "numbertank": "Hi,\nSame problem.\nThe above given solution did not work for me.I am also looking solution for the same problem.\nI am using the latest build and I udpated the emqttd.config file with the above given solution but the the issue still there.\nPlease help me in this issue\n. Did you released sample web client and java client?\n. Thanks for your prompt reply. waiting you.\n. Sir, Did you released?\n. Waiting your release.\n. Thanks for your prompt reply.\nI have check log/emqttd_error.log, log/emqttd_info.log and log/emqttd_crash.log. It is empty.\n./bin/emqttd_ctl listeners:\nlistener on http:8083\n  acceptors       : 4\n  max_clients     : 64\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtts:8883\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:1883\n  acceptors       : 16\n  max_clients     : 8192\n  current_clients : 21\n  shutdown_count  : [{conflict,2734},{idle_timeout,54},{keepalive_timeout,4903},{closed,11319}]\nlistener on http:18083\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 0\n  shutdown_count  : []\n./bin/emqttd_ctl broker stats\nclients/count       : 18\nclients/max         : 36\nretained/count      : 828\nretained/max        : 828\nroutes/count        : 11973\nroutes/max          : 11973\nsessions/count      : 817\nsessions/max        : 817\nsubscribers/count   : 12883\nsubscribers/max     : 12883\nsubscriptions/count : 12883\nsubscriptions/max   : 12883\ntopics/count        : 12025\ntopics/max          : 12025\n./bin/emqttd_ctl broker metrics\nbytes/received          : 2302626\nbytes/sent              : 1007859\nmessages/dropped        : 0\nmessages/qos0/received  : 2907\nmessages/qos0/sent      : 1543\nmessages/qos1/received  : 7594\nmessages/qos1/sent      : 5243\nmessages/qos2/received  : 10\nmessages/qos2/sent      : 0\nmessages/received       : 10511\nmessages/retained       : 828\nmessages/sent           : 6786\npackets/connack         : 19158\npackets/connect         : 19158\npackets/disconnect      : 294\npackets/pingreq         : 263955\npackets/pingresp        : 263955\npackets/puback/received : 5132\npackets/puback/sent     : 7594\npackets/pubcomp/received: 0\npackets/pubcomp/sent    : 9\npackets/publish/received: 10511\npackets/publish/sent    : 6786\npackets/pubrec/received : 0\npackets/pubrec/sent     : 10\npackets/pubrel/received : 9\npackets/pubrel/sent     : 0\npackets/received        : 321463\npackets/sent            : 319916\npackets/suback          : 19562\npackets/subscribe       : 19562\npackets/unsuback        : 2842\npackets/unsubscribe     : 2842\nIs there any configuration changes i have to do ?\n. ",
    "andrewchambers": "It seems to me most mqtt brokers do not handle dirty sessions properly, The server should really persist all subscriptions to dirty sessions and retain messages that have not been delivered even across restarts.\n. ",
    "apapacy": "Same problem. Is you plane resolve it?. ",
    "jalbersdorfer": "Same behaviour still in 2.2.0. After broker restart, all Subscriptions (and Messages) are gone.\nemq-retainer Plugin is configured to disk. From the # emqttd_ctl mnesia I can confirm the messages (QoS 1) get logged to disk on receiving, but restarting the broker clears the subscriptions, even when requested with no clear = true. ",
    "pmasrani": "@emqplus : We are facing the exact same problem mentioned by 87sanchavan in https://github.com/emqtt/emqttd/issues/448#issuecomment-181568355. Since you have marked this issue with the Enterprise label, is this functionality available in Enterprise version or is it targeted for a futuristic Enterprise version? Any plans to add this functionality to the open source version as well?. ",
    "a3aanwisse": "We are also facing the same problem. Any time schedule on this one?. +1. ",
    "baer-devl": "One solution would be to write a mod which listens to on_client_subscribe and on_client_unsubscribe and every time those will be invoked you can store the actual subscriptions into a database. The only thing left to do is to load all subscriptions and create sessions for each client on load(auto load of mod on broker start) and subscribe to all stored topics again.\nOf course, messages that were in the queue would be still lost, but i am sure you can find a way to handle this as well (maybe a controlled shutdown of the broker or something).. I agree with you!\nI was believing that the session key will expire after a certain limit. After a short research this seems not to be the case. Session keys will be valid until one of the peers decides its not. So no certificates will be used at this time.\nSo no, there are no security issue with that behavior.\nThanks for the quick answer!. took me quiet some time but finally I found the issue:\ntwo modules I loaded are using the same values in the conf file -> if the second module gets loaded it results in an error reading it.\nresolving the problem is easy, just rename the values!\ncheers. Just tried a few possible ways to achieve this without touching the code. The most promising and easiest solution I came up with is:\nChilds = supervisor:which_children(esockd:listener({'mqtt:ssl',8883})),\n[Listener] = lists:filtermap(fun(E) -> case E of {listener,P,_,_} -> {true, P}; _ -> false end end, Childs),\nexit(Listener, kill).\nExisting connections will not be terminated and all new connections use the new certificate.\nHowever, if I use this solution in a one liner it often crashes the system - not sure whats the problem here but I assume that it could be the asynchronous exit?\nIt's not the cleanest solution but it works- still hope that it will be implemented a better way where the 'listener' process will be terminated and restarted cleanly.\nBest,\nbaer. After some further investigations I found a pretty simple solution but it needs some additional code in the source. Adding the following code to 'emqttd_app':\n```\nrestart_listener(ssl, ListenOn) ->\n    restart_listener({'mqtt:ssl', ListenOn});\nrestart_listener(wss, ListenOn) ->\n    restart_listener({'mqtt:wss', ListenOn});\nrestart_listener(Proto, ListenOn) ->\n    restart_listener({Proto, ListenOn}).\nrestart_listener({Protocol, ListenOn}) ->\n    % get supervisor pid & child specs\n    ListenerSup = esockd:listener({Protocol, ListenOn}),\n    {ok, Map} = supervisor:get_childspec(ListenerSup, listener),\n% stop and delete old child (cant be simply restart if transient)\nsupervisor:terminate_child(ListenerSup, listener),\nsupervisor:delete_child(ListenerSup, listener),\n\n% start child again\nsupervisor:start_child(ListenerSup, {listener,\n    maps:get(start, Map),\n    maps:get(restart, Map), maps:get(shutdown, Map), maps:get(type, Map), maps:get(modules, Map)}).\n\n``\nAs well as change the exported functions to:-export([start_listener/1, stop_listener/1, restart_listener/2]).`\nThis will work on both SSL connections (MQTT and WSS)! \ud83e\udd42 \nI hope it will find the way into the next release.\nCheers,\nbaer. ",
    "Oduig": "+1. +1. Thank you, that helped! We were not aware of this page.. ",
    "chenek": "I can use mosquitto_sub to connect to emqdds now.\n. ",
    "mingchuno": "@erylee thank you very much. I think we can close the issue\n. @erylee of coz\n. @andywang2014 What do you mean by persist? You want to persis certain topic's message to database like Cassandra? I think you have 2 option. First is to write yourself a plugin and subscribe certain topics and then persist them into db. The 2nd option is to write yourself a small application (not necessary in Erlang) that subscribe to any topics you like and persist them into db. Personally, I prefer the 2nd option because the Unix philosophy \"Do One Thing and Do It Well\". The message broker itself shall not take that responsibility itself. And besides, if you are in a cluster situation you will have to persist the message many times unless you have a smart design on you plugin. (starting the plugin only in a single node is risky)\n. @87sanchavan yup, you need to customize the redis plugin yourself to support complicated Auth/Acl logic. That's what I am doing. \n. check out the Redis plugin. It seems that it got the feature to remember the client subscriptions.\n. ",
    "sh4nnongoh": "Hi I am unable to run \"emqttd_ctl.cmd\" on windows. \nError as follows:\nPS> C:\\Users\\Internet\\Documents\\emqttd2\\bin\\emqttd_ctl.cmd\nescript: exception error: no function clause matching \nerlang:set_cookie(nonode@nohost,rpc) (erlang.erl, line 3283)\n  in function  nodetool__escript__1503__305775__143000__2:process_args/3 (C:\\Users\\Internet\\Documents\\emqttd2\\bin\\nodetool, line 128)\n  in call from nodetool__escript__1503__305775__143000__2:main/1 (C:\\Users\\Internet\\Documents\\emqttd2\\bin\\nodetool, line 14)\n  in call from escript:run/2 (escript.erl, line 757)\n  in call from escript:start/1 (escript.erl, line 277)\n  in call from init:start_em/1 (init.erl, line 1076)\n  in call from init:do_boot/3 (init.erl, line 784). ",
    "hungthuanmk": "I laso face to the same issue\n escript: exception error: no function clause matching. ",
    "CheyenneForbes": "@bangarharshit how would I implement \"last active time\"?\n. I added the code to enable the feature https://github.com/emqtt/emqttd/compare/develop...CheyenneForbes:patch-1. @emqplus When will it be released?. Can it be implemented? I want to use it in a webrtc project... if the \"call\" isnt delivered the caller would get an \"unavailable\" message.. if it cant be implemented, is there any way to know if a user is able to receive mqtt messages (has internet connection for example). would you mind adding this to the HTTP publish?\nAfter a publish request the response will tell if the client is connected or disconnected if the request was passed with a \"is_connected\" query parameter (http.://server/api/v2/mqtt/publish?is_connected=true). Thanks a lot, is there a planned release date for 2.4?. ",
    "rredkovich": "Any information about this question?\nHave looked at kafka plugin, seems like empty template for me.\n. ",
    "andywang2014": "thank you su much,got an idea for it.\n. ",
    "indrajeet0510": "@emqplus In case of cluster and if we load plugin (to persist messages in cassandra) on all nodes of the cluster, will it save the same message multiple times or it will be only once from the broker which receives the message. Can you please confirm?\n@turtleDeng  @huangdan . ",
    "sylvek": "Thks for your answer, I will do that.\nLe mer. 9 mars 2016 05:52, Feng Lee notifications@github.com a \u00e9crit :\n\nHi sylvek, Please check your emqttd_mod_kafka_presence module.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/465#issuecomment-194112750.\n. \n",
    "Zordiac91": "Thank you very much, that's exactly it!\n. ",
    "AngeloBestetti": "Hi Feng, any news about this Feature?\n. We are already using 2016, I would like to have this MSSQL 2016 plugin, with that I can put the ACL table in \"Memory Optimized\" SQL Feature now.\n. ",
    "shsjshentao": "sorry , probably i found the reason. Maybe i deleted the data/mnesia dirctory.\n. i have tried  to set 5,15 and 10000. And the problem still happen. I will try 15000 again. Thanks.. @vowstar \nSDK version: ESP8266 NONOS SDK V2.0.0 20160810\nexample program\uff1aesp_mqtt_proj\ncondition\uff1aSSL one-way authentication\u3001close CA authentication\uff0csometimes will get stuck in client handshake start.\nLog information:\nMQTT_InitConnection\nMQTT_InitClient\nTCP: Connect to ip  121.43.109.135:8883\nplease start sntp first !\nclient handshake start.\npm open,type:2 0\n. ",
    "nikolatesla11": "thank you for quick response, it is exactly what i asked for. \n. ",
    "heidawei": "I know why. I must start the emqttd with root\n. ",
    "congleetea": "I also meet this problem,  It is strange,  when we run it in local machine, it can also run successfully not root.  @emqplus whether it must run with root?  I also use inner ip in vm.args.. Hi, @callbay  @erylee thanks your reply, I tested it use curl like below:\ncurl -v --basic -u myusername:mypassword -d \"qos=2&retain=0&topic=/a/b/c&message=hello from http...\" -k http://localhost:8083/mqtt/publish\nit works well, so whether it is caused by my mqtt client library?  My client library was obtained from this link.\nhowever,in the other hand, when I use curl described above to publish a topic which qos=2, I lager the qos in emqttd_parser.erl, I find that its value is 0 not 2.\ncould you give me some information about them? \nthanks a lot.\n. thanks a lot, I will check it as your suggestion.\n. @erylee ok, thanks a lot. \n. I think it is a problem of  mysql driver , I also met this problem unpredictablly. \n. @emqplus  thanks a lot.\n. @billysz It is cached in process directory.       @emqplus Is there a way to acl again if necessary?  In some cases, if users change the right to access some topic, it should check the acl again.\n. Hi,   I have also have this issues, :\nSession(E8IewRWNEOzHa): Cannot find PUBREL: 16\n. No,  sometime it happened. I almost can not catch the error.\n. epmd is not just for emqttd,  when you start any erlang application, it will be started and listen other node's communicatioin.\n. some messages no any subscription may be also dropped message.. I think it is more standard when  erlang:demonitor/1.. ",
    "zltl": "You mean that two client send messages to each other? If client A and B want to communicate with each other, A publish messages to topic A-B, and B publish to topic B-A; A subscribe topic B-A and B subscribe A-B. But I recommend you do NOT use MQTT protocol that way.\n. ",
    "obi458": "Ok, i have only \"bridge cluster\", but in an \"erlang cluster\" this could be a problem with the\nsessions, i've only the clientid and can't get the mqtt_client record.\nI think a \"global\" MQTT Client Manager should solve it!\n. Works, the 120 seconds timeout is your experience or a pessimistic value?\n. Processing....\nBTW, the documentation for tuning is for linux, missing for OS X!\n. Dashboard_50000_171.pdf\n. Closed!\n. Ok, what i need is to send(from a plugin) a message to a client, the plugin! makes the subscription like\nthe  {\"$Q/username/$u\", 1} subscription, but there is no way to notify the subscription is done(sync)!\n. Ok, this solve how to send a message, if session is the calling process.\nNice would be a notify if the subscription is completed, means at the end of fun add_subscriber_.\n. I will think about it, now 2 weeks holiday :-)\n. ",
    "borntorock": "@erylee Can you Please help with this. \n. @erylee Thanks for your response! You mean I should first start the broker in console mode and then start emqttd. So, when I start the broker in console mode, it displays some stdout. Please suggest!\nPlease note whenever I recompiles EMQTTD using make && make dist again, I can start the broker in first go by executing the command: \n./bin/emqttd start\n. @erylee Please let me know your suggestions to resolve this. \n. ",
    "vpotapev": "@borntorock I've the same symptoms, but in my case the problem was in wrong path which is calculated in the emqttd script.\nI've prepared .deb package contained emqttd, so the system was installed to /opt/emqttd/ dir. When I tried to start emqttd using /opt/emqttd/bin/emqttd start, the pathname of the $RUNNER_SCRIPT_DIR/$SCRIPT (line 150 of the emqttd bash script) was /opt/emqttd//emqttd, but it should be /opt/emqttd/bin/emqttd. I've changed the string to $RUNNER_SCRIPT_DIR/bin/$SCRIPT, and the problem was solved.\nYou can always add debug output of any value in the script, so you can find what's wrong in your case.\n. ",
    "sleepingshorty": "I am using 32bit version of ubuntu. Could that be the problem? I tried to compile the git-version but it failed too :-( \nAny idea?\n. Thank you so far... but I do need a further hint for this problem. I just cloned the repository, and tried to make it. This happens:\n`/emqttd# make && make dist\nSubmodule 'plugins/emqttd_dashboard' () registered for path 'plugins/emqttd_dashboard'\nSubmodule 'plugins/emqttd_plugin_mysql' () registered for path 'plugins/emqttd_plugin_mysql'\nSubmodule 'plugins/emqttd_plugin_pgsql' () registered for path 'plugins/emqttd_plugin_pgsql'\nSubmodule 'plugins/emqttd_plugin_redis' () registered for path 'plugins/emqttd_plugin_redis'\nSubmodule 'plugins/emqttd_plugin_template' () registered for path 'plugins/emqttd_plugin_template'\nSubmodule 'plugins/emqttd_recon' () registered for path 'plugins/emqttd_recon'\nSubmodule 'plugins/emqttd_stomp' () registered for path 'plugins/emqttd_stomp'\n=ERROR REPORT==== 5-Apr-2016::01:33:25 ===\nbeam/beam_load.c(1365): Error loading module rebar:\n  use of opcode 153; this emulator supports only up to 152\n=ERROR REPORT==== 5-Apr-2016::01:33:25 ===\nLoading of /root/emqttd/rebar/rebar/ebin/rebar.beam failed: badfile\nescript: exception error: undefined function rebar:main/1\n  in function  escript:run/2\n  in call from escript:start/1\n  in call from init:start_it/1\n  in call from init:start_em/1\nmake: *** [deps] Error 127\n. I used thishttps://gist.github.com/bryanhunter/10380945` to compile it. Now it works.\nThank you very much!\n. Hi. \nThank you for your reply. \nThe plugin is enabled and seems to be working with the rules from the wiki or no rules but not with mine.\nMy plugin.config (Password is replaced with *):\n\n[\n{emqttd_plugin_mysql, [\n{mysql_pool, [\n       %% ecpool options\n       {pool_size, 8},\n       {pool_type, round_robin},\n       {auto_reconnect, 3},\n%% mysql options\n   {host,     \"localhost\"},\n   {port,     3306},\n   {user,     \"emqtt\"},\n   {password, \"******************\"},\n   {database, \"emqtt\"},\n   {encoding, utf8}\n]},\n%% select password only\n   {authquery, \"select password from mqtt_user where username = '%u' limit 1\"},\n%% hash algorithm: plain, md5, sha, sha256, pbkdf2?\n   {password_hash, sha256},\n%% select password with salt\n   %% {authquery, \"select password, salt from mqtt_user where username = '%u'\"},\n%% sha256 with salt prefix\n   %% {password_hash, {salt, sha256}},\n%% sha256 with salt suffix\n   %% {password_hash, {sha256, salt}},\n%% comment this query, the acl will be disabled\n   {aclquery, \"select allow, ipaddr, username, clientid, access, topic from mqtt_acl where ipaddr = >'%a' or username = '%u' or username = '$all' or clientid = '%c'\"},\n%% If no rules matched, return...\n   {acl_nomatch, allow}\n]}\n]. \n. I think i understood what # is. \n\neq # means that you disallow to use # for the user while # means the topics itself.\nThats ok now. \nBut there is something strange with acls:\nIf I use now rule, everything works fine.\nIf I create a dissalow rule, nothing works. Thats fine.\nBut when I try to allow only one topic and dissallow the other topics, all topics keep dissallowed.\nIt looks like this:\nid, allow,ipaddr,username,clientid,access,topic\n1 , 1 , null, $all, null, 3, public/#\n1000, 0, null, $all, null, 3, #\nIsn't it first match? \n. This is working. \nI am not sure if it's the right way and I think I will edit the wiki.\nThank you very much for helping me out of this. \n:+1: \n. Basic ACLs are working. But I have a new problem where I do not understand where it comes from.\nI want (working): \n$u/#             Everything allowed in user-path\nand:\n/public/#     subscripe every possible path that is \"public\" (now working)\nfor example: if a user creates: username/public/temperaturGermany/garden everyone should be able to read it.\nI have two rules:\nID, allow, ipaddr, username, clientid, access, topic\n10 1 NULL $all NULL 3 $u/# \n20 1 NULL $all NULL 1 #/public/#\nThank you again. \n. ",
    "mr-bobfrog": "+1 By the way, does the 1.0.x_beta version count?\n. ",
    "kenpeter": "Same error.\nconfig:\n\nnode 2 port:\n\nnode 1 port:\n\nport in aws:\n\n. @7wonders , not working.....\n\n\n\n\n. Ok, working now.\nThe trick are:\n1 if you have ubuntu@ip.1-2-3-4, then your node name needs to be ubuntu@1.2.3.4. The 1.2.3.4 needs to be your private IP. ubuntu is the username of machine.\n2 .erlang.cookie has the same cookie value in itself, also in vm.args\n3 Do netstat -npl, to see what ports are using. Then open them in aws security group, need to open all ports.\n. @51systems, Are you able to give me a hint, https://github.com/emqtt/emqttd_plugin_mysql/issues/13\n. Hi,\nAre you able to post more detail on how you resolved it. I am able to authenticate user with mysql, but failed at ACL. Here is my issue, https://github.com/emqtt/emqttd_plugin_mysql/issues/13\n. select password from mqtt_user where username = '%u' limit 1, is the password in sha256?\n. ",
    "callbay": "Did you use that command as below to test?\ncurl -v --basic -u user:passwd -d \"qos=2&retain=0&topic=/a/b/c&message=hello from http...\" -k http://localhost:8083/mqtt/publish\n. @congleetea I may give you some comments as below for your reference:\nFirst, you might be using an improper lib. So I suggest you check it.\nSecond, you may trace up pubrec and pubcomp in emqttd_parser.erl only in the case of qos=2 by means of curl. so please mention how you did your trace it while qos=0.\n. @prakashr87,My suggestion is that you have to check wether \"bson-erlang\" exists in the directory \"emqtt/deps\", as \"emqttd_plugin_mongo\" depends on \"mongodb-erlang\", and what is more, \"mongodb-erlang\" depends on \"bson-erlang\", so you have to clone the whole \" https://github.com/comtihon/bson-erlang \" onto the directory \"deps\" if \"bson-erlang\" is not found in \"emqtt/deps\", or you may check or change \"rebar.config\" in case of need.\n. @phanimahesh, I already told @Gilbert-Wong the bug in the emqx.schema, thanks!. Hi,@phanimahesh\nemqx.conf\n``` \n...\nTopic priorities.\n## 'none' to indicate no priority table (by default), hence all messages\n ## are treated equal\n ##\n ## Priority number [1-255]\n ## Example: topic/1=10,topic/2=8\n ## NOTE: comma and equal signs are not allowed for priority topic names\n ## NOTE: messages for topics not in the priority table are treated as\n ##       either highest or lowest priority depending on the configured\n ##       value for mqueue_default_priority\n ##\n zone.external.mqueue_priorities = topic/1=10,topic/2=8\n...\n```. @phanimahesh , It looks like I got it wrong, thanks!. I think you are right, using the separator / to separate qos wouldn't be a good idea, this confuses the topic and qos.. ",
    "tomazbracic": "Any news regarding Cassandra Support?\n. +1, That would be really needed and awesome.... please do!\nSupport for ECDSA and ECDH(E) would be great, would it  be possible to integrate this? For hardware based security.\n. Any actual plugin for connecting to Kafka or better yet Cassandra? That would be really awesome.\n. ",
    "iammehrabalam": "@erylee\nIs it possible to store acknowledgement of subscriber it sent after receiving a message from the broker?\nI have a use case to know how many subscribers successfully receive the message from broker.\n. ",
    "DataEngg": "@erylee \nI am new to MQTT, can you tell me how would I use hook to get the information about ack message via using any client library or by using something else..\n. @turtleDeng ,\nUsing paho at android side, it connects via mqtt protocol with version 3.11\nRecently I got an error \n12:28:23.102 <0.11641.6> [error] Client(47.8.150.241:54457): Parser failed for {function_clause,[{emqttd_parser,parse_utf,[<<\"fa9faebca1d3b877ae6a32bee8baccdcd0b363f9\">>],[{file,\"src/emqttd_parser.erl\"},{line,206}]},{emqttd_parser,parse_frame,3,[{file,\"src/emqttd_parser.erl\"},{line,93}]},{emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,260}]},{gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,601}]},{gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,667}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,247}]}]}\nbin/emqttd_ctl listeners\nlistener on http:8083\n  acceptors       : 4\n  max_clients     : 64\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtts:8883\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:17576\n  acceptors       : 64\n  max_clients     : 1000000\n  current_clients : 147409\n  shutdown_count  : [{closed,13445},{parser_error,1},{conflict,8401},{destroy,6},{idle_timeout,1585}]\nlistener on http:18083\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 0\n  shutdown_count  : []\n@turtleDeng, can you tell me why I got closed, destroy, idletimeout, conflict too under shutdown counts.\n. @turtleDeng \nUtf-8 encoding format requires at client side or server side ?\n. @turtleDeng But other user without encoding format are able to connect easily without any error \nAs well as latest information about broker is \nlistener on mqtt:17576\n  acceptors       : 64\n  max_clients     : 1000000\n  current_clients : 232093\n  shutdown_count  : [{ehostunreach,3},{parser_error,5},{conflict,32954},{etimedout,3157},{destroy,27},{idle_timeout,3424},{closed,76580}]\nWhat is ehostunreach,conflict,etimedout,destroy,idle_timeout,closed ?\n. @turtleDeng  thanks for a quick response, will let you know whether it has been worked or not.\nCan you explain me what is ehostunreach,conflict,etimedout,destroy,idle_timeout,closed ?\n. @huangdan  I got this earlier, the reason is too large number of connection in a single machine does not allow another clients to subscribe and publish a message in same machine. \nWhat I did is connected another machine and make a cluster of machines to publish a message via another machine.\n. Thanks @turtleDeng .. but i did all this tunning earlier in all machines\n. @emqplus @turtleDeng \nPlease help me out \n. @turtleDeng \nI have already done tuning , nothing left to do and set the max clients  according to the server size because server can't handle more than 100K clients\n. @turtleDeng \nIt looks like Server can handle 100K concurrent clients at a time but user more than 100K client would be able to connect to server by kicking out other clients, so in server it looks like there are only 100K clients but other information like routes, subscriber and session count can be increased which causes memory to be utilized.\nCan't we do that one server should handle that much number of client, i am not talking about concurrent clients I am talking about handling that much number of clients either it is offline or online?\n. @turtleDeng \nWhen i set max client to 1000K then i started receiving an error \n=ERROR REPORT==== 17-Oct-2016::05:25:45 ===\n* Generic server <0.1805.0> terminating\n* Last message in was {inet_async,#Port<0.11884>,4070,\n                           {ok,<<16,52,0,4,77,81,84,84,4,0,84,96,0,40,56,53,\n                                 56,52,57,100,50,54,57,100,98,49,99,99,53,97,\n                                 52,57,57,49,56,98,53,101,98,99,97,102,101,\n                                 54,52,99,53,52,98,49,53,52,56,97>>}}\n* When Server state == {client_state,\n                            {esockd_connection,\n                                [#Port<0.11884>,\n                                 #Fun,[]]},\n                            [\"43.225.248.19\",58,\"44583\"],\n                            {{43,225,248,19},44583},\n                            {43,225,248,19},\n                            44583,true,running,undefined,\n                            #Fun,\n                            {proto_state,\n                                {{43,225,248,19},44583},\n                                #Fun,false,\n                                undefined,<0.1805.0>,undefined,undefined,\n                                undefined,undefined,undefined,undefined,512,\n                                undefined,undefined,undefined},\n                            [{max_clientid_len,512},{max_packet_size,65536}],\n                            undefined}\n* Reason for termination ==\n** {{timeout,\n        {gen_server2,call,\n            [<0.277.0>,\n             {start_session,\n                 {false,<<\"85849d269db1cc5a49918b5ebcafe64c54b1548a\">>,\n                     <0.1805.0>}},\n             120000]}},\n    [{gen_server2,call,3,[{file,\"src/gen_server2.erl\"},{line,340}]},\n     {emqttd_protocol,process,2,[{file,\"src/emqttd_protocol.erl\"},{line,149}]},\n     {emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,265}]},\n     {gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,601}]},\n     {gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,667}]},\n     {proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,247}]}]}\n. @huangdan  Can you help me in this. Can't we set max number of clients per machine instead of maximum concurrent clients.\n. ",
    "anujbansal": "@erylee I saw the code that you pointed. Is there a way we could trigger a Python method or some DB trigger so that we are able to capture the acknowledgement in our DB?\n. ",
    "deepaksood619": "@Gilbert-Wong When is this going to be implemented, are there any plans for the same. Or are there any workarounds to achieve this using 3rd party plugins, either in any collection agents like telegraf or prometheus?. ",
    "edfungus": "It said:\n\n[error] MQTT detected framing error invalid_mqtt_frame_len for connection \n\nSo I went to the emqttd.config, increased the max_packet_size and now all is well. \nThanks! \n. ",
    "51systems": "Turns out this is because erlang is expecting FQDNs. Putting a dot after the hostname if there is no domain specified makes it work.\neg: emqttd@host1.\nMaybe the docs should be updated to reflect this gotcha.\n. Have you enabled the mysql plugin via emqttd_ctl plugins load emqttd_plugin_mysql?\nWhat does your plugins/emqttd_plugin_mysql/etc/plugin.config config file look like.\n. I don't know how the rules engine handles rules where there are multiple matches. From the example mysql file, it looks like they setup the deny rules first. Eg:\nsql\nINSERT INTO `mqtt_acl` (`id`, `allow`, `ipaddr`, `username`, `clientid`, `access`, `topic`)\nVALUES\n(1,0,NULL,'$all',NULL,1,'$SYS/#'),\n(2,0,NULL,'$all',NULL,1,'eq #'),\n(3,1,'127.0.0.1',NULL,NULL,2,'$SYS/#'),\n(4,1,'127.0.0.1',NULL,NULL,2,'#'),\n(5,1,NULL,'dashboard',NULL,1,'$SYS/#'),\nso it may be that your less specific deny rule is overwriting your more-specific allow rule.\nWhat we've done is disallow all topics by default by editing the mysql config:\nerlang\n%% If no rules matched, return...\n    {acl_nomatch, deny}\nand then explicitly allowed certain topics in mysql.\n. If I leave the server running emqttd does connect to mysql if I attempt to login a couple more times. This is without changing any settings or doing anything to emqttd or the mysql server.\nThen it works for a while (incoming connections are authed properly). Then it seems like emqttd disconnects from the mysql server, and starts rejecting authentication with the above error, only to reconnect after a few more connection attempts.\nAgain, I'm only seeing this behaviour when the mysql instance is running on a different server than the emqttd broker which is what makes me suspect it may be a timing issue.\nMy actual setup is clustered emqttd connecting to clustered mariadb, both of them running in docker containers distributed across multiple hosts. I have it setup so emqttd's mysql connection pool connects to multiple mariadb servers for HA.\n. I've been reviewing my my.cnf file and I've found a short wait_timeout and I suspect this is the problem. I'm guessing the server closes the connection and the emqttd pool doesnt detect it, so when it attempts to send data an error occurs. It then tries the next connection in the pool (also timed out) and so on. Eventually it runs out of connections and has to create new ones to maintain the pool size of 8. I think thats why after I attempt to connect the mqtt client a few times it starts working. \nWhat do you think would be an appropriate value of wait_timeout (In seconds) for the pool? Also what does the {auto_reconnect, 3} mean in the emqttd mysql plugin configuration.\nIt would be nice if the emqttd server would try other connections rather than returning an 'invalid username / password' message when the query fails.\n. You will have to store some kind of secret on the android device. Here's an example app that uses the android keystore to securely store secrets:\nhttp://www.androidauthority.com/use-android-keystore-store-passwords-sensitive-information-623779/\n. Current versions of emqttd don't persist messages between restarts so it should not be used to persist data.\nSee https://github.com/emqtt/emqttd/issues/327\n. MQTT protocol spec is here: http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc398718043\nAccording to the spec, the server sends an publish ack (PUBACK) packet back to the client when the server has successfully received the message under QOS 1.\nIf you are implementing a messaging application, have the application publish a \"Read\" message back to the sender to implement the read/seen behaviour.\n. ",
    "mjason3": "@emqplus What will it happen right now to the running cluster when NetSplit occurs? Shutting down the whole cluster or just some nodes stop serving traffic?\n. ",
    "je-al": "@emqplus so, how can we identify the minority? would we restart any node in which the inconsistent_database event pops-up, or do we have to actually run cluster status against all of the nodes and parse the output to determine how many / which partitions there are?. I think this is not working properly, when I load the emq_auth_http plugin it gets evaluated ahead of the emq_auth_username one. (I'm currently testing v2.3-beta.3). @emqplus not currently.\nWell, as I said, I'm using the docker image, so the actual configuration I'm passing in is:\nenvironment:\n      EMQ_NAME: blah\n      EMQ_NODE_COOKIE: blah\n      EMQ_LOADED_PLUGINS: |\n        emq_recon.\n        emq_dashboard.\n        emq_mod_presence.\n        emq_mod_subscription.\n      EMQ_LOG_LEVEL: info\n      EMQ_ALLOW_ANONYMOUS: 'false'\n      EMQ_TCP_ACCEPTORS: 16\n      EMQ_TCP_MAX_CLIENTS: 4096\n      EMQ_SSL_PORT: 8883\n      EMQ_HTTPS_PORT: 8084\nas environment variables (that's a docker-compose snippet). And bind-mount cert.pem and key.pem into their default locations. Which is rendered into:\nmqtt.listener.ssl = 8883\nmqtt.listener.ssl.acceptors = 4\nmqtt.listener.ssl.max_clients = 512\nmqtt.listener.ssl.handshake_timeout = 15\nmqtt.listener.ssl.keyfile = etc/certs/key.pem\nmqtt.listener.ssl.certfile = etc/certs/cert.pem\nmqtt.listener.http = 8083\nmqtt.listener.http.acceptors = 4\nmqtt.listener.http.max_clients = 64\nmqtt.listener.https = 8084\nmqtt.listener.https.acceptors = 4\nmqtt.listener.https.max_clients = 64\nmqtt.listener.https.handshake_timeout = 15\nmqtt.listener.https.keyfile = etc/certs/key.pem\nmqtt.listener.https.certfile = etc/certs/cert.pem\nDo note the connection works if I tell socat not to verify the server certificate... And the certificate does work if I terminate TLS using HAProxy... The main doubt is really about the order in which (the PEM encoded certs or maybe I should be using another format?) the certificates in the chain should be joint. I've tried:\nserver cert\nrootCA\nintermediate1\nand:\nserver cert\nintermediate1\nrootCA\nboth resulted in only the server cert being delivered (openssl s_client's output).. @phanimahesh well, yeah, I tried both HAProxy's and Nginx's \"format\", i.e.:\nserver\nCA\nintermediate 1\nintermediate 2\nCA\nintermediate 1\nintermediate 2\nserver\nAnd, for good measure, even:\nserver\nintermediate 2\nintermediate 1\nCA\nLater it occurred to me that maybe I should try a p12 store, but I see no reference to them, and #933 is also open.\np.s.: I haven't mentioned it before but, what I tested with is an actual, valid, certificate (signed by GoDaddy).  @phanimahesh (I had edited the previous comment) To reiterate, valid cert issued by GoDaddy, as I said before, only the \"leaf\" cert is being served, at least that's what s_client reports (I think I did check using tcpdump, don't quote me on that though). One more thing, it's a wildcard cert, but I wouldn't think that has anything to do with this partircular problem.. @phanimahesh oh, thanks for the hint, my mistake was in not including the cacert file, I thought this was used only to verify client certs...\nI did not include any intermediates in the cacert file, but besides that, the correct (?) order is as stated:\ncert\nCA\nintermediate1\n...\nedit: I'm closing this as it's not really an issue.. ",
    "kunaldawn": "@erylee Thanks for the information. it will be really cool if you can support this feature. Looking forward to it. \n. Will try that, thank you for the idea\n. ### Ok here is what i have done:\nHOOK\nerlang\nemqttd:hook('client.subscribe', fun ?MODULE:on_client_subscribe/3, [Env]),\nHandler\n``` erlang\n%% should retain TopicTable\non_client_subscribe(ClientId, TopicTable, _Env) ->\n    {ok, TopicTable},\n    case mnesia:dirty_read(subscription, iolist_to_binary(ClientId)) of\n      []      -> ok;\n      Records -> handleSubscription(Records, TopicTable)\n    end.\nhandleSubscription(Subscriptions = [#mqtt_subscription{subid = ClientId} | ], TopicTable) ->\n    ExcludeTAG = \"#\",\n    IncludeTAG = \"foo/bar/\",\n    OldTopicTable = [binary_to_list(Topic) || #mqtt_subscription{topic = Topic, qos = Qos} <- Subscriptions],\n    NewTopics = [binary_to_list(N) || {N, } <- TopicTable],\n    lists:foreach(\n      fun(NT) ->\n        IndexInclude = string:str(NT, IncludeTAG),\n        IndexExclude = string:str(NT, ExcludeTAG),\n        if\n          IndexInclude > 0 andalso IndexExclude == 0 ->\n            lists:foreach(\n              fun(OT) ->\n                IndexIncludeOT = string:str(OT, IncludeTAG),\n                IndexExcludeOT = string:str(OT, ExcludeTAG),\n                if\n                  IndexIncludeOT > 0 andalso IndexExcludeOT == 0 ->\n                    VNT = isMyCustomCheck(NT),\n                    VOT = isMyCustomCheck(OT),\n                    if\n                      VNT == VOT ->\n                        emqttd_backend:del_subscription(iolist_to_binary(ClientId), iolist_to_binary(OT));\n                      true -> ok\n                    end;\n                  true -> ok\n                end\n            end, OldTopicTable);\n          true -> ok\n        end\n      end, NewTopics).\n```\nISSUE\nerlang\nemqttd_backend:del_subscription(iolist_to_binary(ClientId), iolist_to_binary(OT));\nIs not working.\nPlease check #529 , where this issue is described.\nPlease provide some insight regarding this.\n. Our protocol logic needs explicit control of subscriptions made by clients. Clients can move to different subscription (new one) and in many cases it does not have information regarding list of topics it is already subscribed to. So broker need to manage cleaning process. If we dont do cleaning process at broker side, then clients are getting messages from old topics (we need to stop that).\nCan you please specify what core API we should use to remove dynamic subscriptions from emqtt plugin?\nWe have been blocked by this issue as we are not able to remove dynamic subscriptions from plugin. emqttd_backend:del_subscription is not working for dynamic subscriptions.\n. Any updates?\n. @emqplus Thanks, emqttd:unsubscribe(iolist_to_binary(ClientId), iolist_to_binary(OT), 1); seems to be working.\n. Hi @Feng Lee \nRegarding \"'bin/emqttd_ctl subscriptions del' will delete the static subscription you created before\"\nGot it. It will be cool if you add support for dynamic subscriptions removal, but it is not required for our job though.\nAny how, can you look at #526 issue once (description given below).\nOur protocol logic needs explicit control of subscriptions made by clients. Clients can move to different subscriptions and in many cases it does not have information regarding list of topics it is already subscribed to. So broker need to manage cleaning process. If we dont do cleaning process at broker side, then clients are getting messages from old topics.\nCan you please specify what core API we should use to remove dynamic subscriptions from emqtt plugin?\nWe have been blocked by this issue as we are not able to remove dynamic subscriptions from plugin.\n. emqttd:unsubscribe(iolist_to_binary(ClientId), iolist_to_binary(OT), 1); seem to be working. TY\n. @mkj-git You can create a new channel per group and let each client in that group subscribe to that channel. QOS : 1\n. ",
    "koleto": "Trying to build the broker on ubuntu-standard-16.04-server-armhf-raspberry-pi. Pre-requirements until now are: apt-get install erlang-dev erlang-edoc erlang-eunit and have the impression I am close to get it but stuck on: \nmake && make dist\n==> gproc (get-deps)\n==> goldrush (get-deps)\n==> lager (get-deps)\n==> gen_logger (get-deps)\n==> esockd (get-deps)\n==> mochiweb (get-deps)\n==> rel (get-deps)\n==> emqttd_dashboard (get-deps)\n==> mysql (get-deps)\n==> ecpool (get-deps)\n==> emqttd_plugin_mysql (get-deps)\n==> epgsql (get-deps)\n==> emqttd_plugin_pgsql (get-deps)\n==> eredis (get-deps)\n==> emqttd_plugin_redis (get-deps)\n==> emqttd_plugin_template (get-deps)\n==> recon (get-deps)\n==> emqttd_recon (get-deps)\n==> emqttd_stomp (get-deps)\n==> emqttd (get-deps)\n==> gproc (compile)\n==> goldrush (compile)\n==> lager (compile)\n==> gen_logger (compile)\n==> esockd (compile)\n==> mochiweb (compile)\n==> rel (compile)\n==> emqttd_dashboard (compile)\n==> mysql (compile)\n==> ecpool (compile)\n==> emqttd_plugin_mysql (compile)\n==> epgsql (compile)\n==> emqttd_plugin_pgsql (compile)\n==> eredis (compile)\n==> emqttd_plugin_redis (compile)\n==> emqttd_plugin_template (compile)\n==> recon (compile)\n==> emqttd_recon (compile)\n==> emqttd_stomp (compile)\n==> emqttd (compile)\n==> gproc (get-deps)\n==> goldrush (get-deps)\n==> lager (get-deps)\n==> gen_logger (get-deps)\n==> esockd (get-deps)\n==> mochiweb (get-deps)\n==> rel (get-deps)\n==> emqttd_dashboard (get-deps)\n==> mysql (get-deps)\n==> ecpool (get-deps)\n==> emqttd_plugin_mysql (get-deps)\n==> epgsql (get-deps)\n==> emqttd_plugin_pgsql (get-deps)\n==> eredis (get-deps)\n==> emqttd_plugin_redis (get-deps)\n==> emqttd_plugin_template (get-deps)\n==> recon (get-deps)\n==> emqttd_recon (get-deps)\n==> emqttd_stomp (get-deps)\n==> emqttd (get-deps)\n==> gproc (compile)\n==> goldrush (compile)\n==> lager (compile)\n==> gen_logger (compile)\n==> esockd (compile)\n==> mochiweb (compile)\n==> rel (compile)\n==> emqttd_dashboard (compile)\n==> mysql (compile)\n==> ecpool (compile)\n==> emqttd_plugin_mysql (compile)\n==> epgsql (compile)\n==> emqttd_plugin_pgsql (compile)\n==> eredis (compile)\n==> emqttd_plugin_redis (compile)\n==> emqttd_plugin_template (compile)\n==> recon (compile)\n==> emqttd_recon (compile)\n==> emqttd_stomp (compile)\n==> emqttd (compile)\n==> rel (generate)\nERROR: Reltool support requires the reltool application to be installed!ERROR: generate failed while processing /home/ubuntu/emqttd/rel: rebar_abort\nMakefile:36: recipe for target 'rel' failed\nmake: *** [rel] Error 1\nAny idea? \n. Installed reltool package and went to the make again and got this Error:\n...\n==> emqttd_stomp (compile)\n==> emqttd (compile)\n==> rel (generate)\nERROR: generate failed while processing /home/ubuntu/emqttd/rel: {'EXIT',{{badmatch,{error,\"eldap: Missing application directory.\"}},\n         [{rebar_reltool,generate,2,\n                         [{file,\"src/rebar_reltool.erl\"},{line,53}]},\n          {rebar_core,run_modules,4,[{file,\"src/rebar_core.erl\"},{line,490}]},\n          {rebar_core,execute,6,[{file,\"src/rebar_core.erl\"},{line,415}]},\n          {rebar_core,maybe_execute,8,\n                      [{file,\"src/rebar_core.erl\"},{line,299}]},\n          {rebar_core,process_dir1,7,[{file,\"src/rebar_core.erl\"},{line,258}]},\n          {rebar_core,process_commands,2,\n                      [{file,\"src/rebar_core.erl\"},{line,90}]},\n          {rebar,main,1,[{file,\"src/rebar.erl\"},{line,58}]},\n          {escript,run,2,[{file,\"escript.erl\"},{line,757}]}]}}\nMakefile:36: recipe for target 'rel' failed\nmake: *** [rel] Error 1\n. It works on Raspberry Pi 3 64 / Ubuntu 16.04! Excellent! I got some minor problems with the compiling but then I deleted the current build directory and rebooted for sure to stop eventual running erlang processes and did clean install following the 3 line instruction on github and it works like a charm! Thank you!\n. ",
    "hulucat": "I have the same ploblem.\n. ",
    "lpfeup": "Hi. No, I meant using 'base64:encode(crypto:hash(sha256, Password))' instead of 'hexstring(crypto:hash(sha256, Password))'.\nI would propose something as specified below (emqttd_auth_mod.erl):\n``` erlang\n-type encoding_type() :: hex | base64.\n-spec(passwd_hash(hash_type(), encoding_type(), binary()) -> binary()).\npasswd_hash(plain,  Encoding, Password)  ->\n    Password;\npasswd_hash(md5,   Encoding, Password)  ->\n    encode(Encoding, crypto:hash(md5, Password));\npasswd_hash(sha,  Encoding,   Password)  ->\n    encode(Encoding, crypto:hash(sha, Password));\npasswd_hash(sha256, Encoding, Password)  ->\n    encode(Encoding, crypto:hash(sha256, Password)).\nencode(hex, X) -> hexstring(X);\nencode(base64, X) -> base64:encode(X).\n```\nThe encoding could be speficied in the plugin.config :\n\n{password_hash_encoding, base64},\n\nIt could be optional and default to 'hex', which is the encoding currently being applied.\n. ",
    "balcruz": "Hi,  rebar3 support is a nice addition.\nDo you agree on a small change (see below)?\nIn list/0 of src/emqttd_plugins.erl file replace lists:merge/2 by lists:umerge/2 so to avoid duplications.\nSo the new line will be\n```\n...\nAppFiles = lists:umerge(projects_rebar3_get_list(PluginsDir), \\\n                        project_other_get_list(PluginsDir)),\n...\n```\nBR,\nBernardo\n. @hachreak , @emqplus Thanks!\n. Thanks @emqplus, I tried it and looks very nice!. Although I prefer rebar3, erlang.mk is a great option too.\n. ",
    "tellypath": "@dcy I think this can be solved with a workaround by deleting a symlink rm /usr/lib/erlang/man, and rerunning the make command. Don't know if this breaks something else down the line.\n. ",
    "paragasu": "This solve the issue i have on debian stretch.\n. ",
    "xiongtec": "@emqplus Thank you for your help.  I am very new to erlang.  How would the publish message be sent?  In the plugin would I create websocket connection pool or open send close via http.\n. I don't see anywhere in the code about subscribing to a topic.\n. I found the solution I was asking.\n. I just used the MySQL plugins and created rules in database.  That was my solution, didn't have to implement any new plugin.\n. ",
    "orbitbot": "Ok, we'll try other tools instead. The reported errors are all because the benchmarking tools don't handle TLS correctly, then, and there is no indication we might have configured something wrong?\n. ",
    "swarno": "Is the SSL support added in benchmark tool?. I was also facing similar issue. Did you tweak the Mqueue size in the emq.conf. I think it stores only 1000 messages by default which can be increased to unlimited. EMQ drops messages if the queue is full even for qos1. Not sure if my understanding is correct but this fixed my problem to some extent.. I think the problem is updation of the vm io for erlang.\nOn restart of the machine it shows 1024 and on restart of only borker after that it gets the correct value. What is the configuration required so that erlang takes the value on restart of the machine.\n\n. ",
    "Xyon75": "Same problem here: is there some way to delete persistant messages when restarting the server?\n. ",
    "maecky": "Did anyone figure this out? I would also like to be able to delete persistent / retained message on reboot?. ",
    "primantok": "Hi @emqplus sorry for the late reply. I am from Indonesia, last night try to download using Google Chrome via Samsung Galaxy J5 (Android 5.1.1).\nWill try again tonight when at home, thanks.\n. \ud83d\ude02. ",
    "s4nch3z": "+1\n. @emqplus Big Thanks!\n. ",
    "teifip": "Thanks for the new plugin! I'm lost on one point. How do I control whether the authentication request is for a superuser or a normal user? I'm connecting with a Node.js MQTT client, and I see that the first authentication attempt is a super_req, followed by an auth_req in case the super_req fails.\n. @emqplus, wonderful! Thanks a lot for following up!\n. @emqplus, great! Thank you!\n. +1.\nAWS IoT uses TLS with client certificate validation and skips authentication at the MQTT layer. In the AWS IoT model, the association between client-id and certificate is configured at the broker side (attach a thing to a certificate). Therefore, there is no need to extract any value from the certificate and submits it for MQTT authentication.\nI believe the model has useful merits, and it would be great if emqttd could support it. One possibility could be to use an additional plug-in - similar to the existing emqttd_auth_http plugin - to pass {client-id, certificate} pairs to an external service and have a simple accepted/rejected response back.\n. Got it! I didn't realize the meaning of the queue configuration part. Sorry for the false alarm.\n. ",
    "Sovigod": "Thanks! Now it loads))\n. I restart server. After 7 hour normal work i have error in log. It repeat every 5 sec.\n==> emqttd_crash.log <==\n2016-05-10 17:53:19 =ERROR REPORT====\n* Generic server <0.7907.182> terminating\n* Last message in was session_timeout\n* When Server state == {session,\"pkuz8b_h\",{[],[]},undefined,#Ref<0.0.24903681.101065>,5000,undefined,25000,connecting,undefined,#Fun,{stomp_state,undefined,[{frame,[{max_headers,10},{max_header_length,1024},{max_body_length,8192}]}]},{sockjs_session,{<0.7907.182>,[{peername,{{10,3,9,2},37512}},{sockname,{{10,3,9,2},37512}},{path,\"/stomp/312/pkuz8b_h/xhr\"},{headers,[{referer,\"https://m.domain.com/community/post/otdam_darom/3203025\"}]}]}}}\n* Reason for termination ==\n** {{noproc,{gen_server,call,[undefined,close]}},[{gen_server,call,2,[{file,\"gen_server.erl\"},{line,204}]},{emqttd_sockjs,service_stomp,3,[{file,\"src/emqttd_sockjs.erl\"},{line,88}]},{sockjs_session,emit,2,[{file,\"src/sockjs_session.erl\"},{line,163}]},{sockjs_session,terminate,2,[{file,\"src/sockjs_session.erl\"},{line,301}]},{gen_server,try_terminate,3,[{file,\"gen_server.erl\"},{line,643}]},{gen_server,terminate,7,[{file,\"gen_server.erl\"},{line,809}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,240}]}]}\n2016-05-10 17:53:19 =CRASH REPORT====\n  crasher:\n    initial call: sockjs_session:init/1\n    pid: <0.7907.182>\n    registered_name: []\n    exception exit: {{noproc,{gen_server,call,[undefined,close]}},[{gen_server,terminate,7,[{file,\"gen_server.erl\"},{line,814}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,240}]}]}\n    ancestors: [sockjs_session_sup,<0.396.0>]\n    messages: []\n    links: [<0.397.0>]\n    dictionary: []\n    trap_exit: true\n    status: running\n    heap_size: 987\n    stack_size: 27\n    reductions: 197\n  neighbours:\n2016-05-10 17:53:19 =SUPERVISOR REPORT====\n     Supervisor: {local,sockjs_session_sup}\n     Context:    child_terminated\n     Reason:     {noproc,{gen_server,call,[undefined,close]}}\n     Offender:   [{pid,<0.7907.182>},{id,undefined},{mfargs,{sockjs_session,start_link,[\"pkuz8b_h\",{service,\"/stomp\",#Fun,{stomp_state,undefined,[{frame,[{max_headers,10},{max_header_length,1024},{max_body_length,8192}]}]},\"https://d1fxtkz8shb9d2.cloudfront.net/sockjs-0.3.min.js\",false,true,5000,25000,131072,#Fun},[{peername,{{10,3,9,2},37512}},{sockname,{{10,3,9,2},37512}},{path,\"/stomp/312/pkuz8b_h/xhr\"},{headers,[{referer,\"https://m.domain.com/community/post/otdam_darom/3203025\"}]}]]}},{restart_type,transient},{shutdown,5000},{child_type,worker}]\n==> emqttd_error.log <==\n17:53:19.099 <0.7907.182> [error] CRASH REPORT Process <0.7907.182> with 0 neighbours exited with reason: no such process or port in call to gen_server:call(undefined, close) in gen_server:terminate/7 line 814\n17:53:19.099 <0.397.0> [error] Supervisor sockjs_session_sup had child undefined started with sockjs_session:start_link(\"pkuz8b_h\", {service,\"/stomp\",#Fun,{stomp_state,undefined,[{frame,[{max_headers,...},...]}]},...}, [{peername,{{10,3,9,2},37512}},{sockname,{{10,3,9,2},37512}},{path,\"/stomp/312/pkuz8b_h/xhr\"},{headers,...}]) at <0.7907.182> exit with reason no such process or port in call to gen_server:call(undefined, close) in context child_terminated\n. ",
    "Nishant-Pathak": "Client configuration seems perfect. Have you changed any thing in mqtt server config ? Please share your server side logs also. Enable log for a client as:\n./bin/emqttd_ctl trace <ClientId> <LogFile>\n. ",
    "ruel": "Make sure your version in the client side matches the broker implementation. We had the same problem before, but we discovered the client was using 3.1 and broker is at 3.1.1\n. ",
    "anhldbk": "I'm using another RPC mechanism. \n. @emqplus Is the code above ready to use? (I'm sorry, I just dont know anything about Erlang).\n. @emqplus Would you pls tell me what wrong with this code?\nerlang\n    case emqttd_cm:lookup(ClientId) of\n       undefined -> \n           {ok, Message};\n        Client ->\n            % I want to modify messages by altering its payload\n            % But it doesn't work\n            Msg = Message#mqtt_message{payload=\"data is where?\"},\n            {ok, Msg}\n    end.\n. @emqplus Oh, what's about my code above? Is that a good way of modifying a being-published message?\n. @emqplus Thank you! I really appreciate.\n. @emqplus I've implemented a plugin named emqttd_plugin_header. Do you think it's necessary to add the plugin into eMQTT repo?\n. @emqplus Please have a look at the image below\n\n. Well, I think there's a trouble in handling messages with qos = 0 or 1.\nIf I publish messages with qos = 2, it always works as expected\n\n. @huangdan Yep, the patch works. \n. Is there any security mechanism for remote bridges? For example: user name & password? \n. @emqplus I don't see any security configuration (username, password) for mosquitto to connect to emqttd. \n. @emqplus Ping ping ping ....\n. @dophlin Thank you!\n. Just reading the FAQs, it's ok for now.\n. ",
    "redink": "incorrect ?\nhttps://github.com/emqtt/emqttd/blob/master/include/emqttd_protocol.hrl#L139\n-type mqtt_packet_id() :: 1..16#ffff | undefined.\n. ",
    "brstgt": "You can see mem comsumption over time: http://cl.ly/1t2b2w1d193y\nThe drops / holes are restarts or when node was not running\n. # Machine 1\n./bin/emqttd_ctl listeners\nlistener on http:8084\n  acceptors       : 4\n  max_clients     : 16384\n  current_clients : 9218\n  shutdown_count  : [{destroy,1362607},{parser_error,3},{keepalive_timeout,8446}]\nlistener on mqtts:8883\n  acceptors       : 64\n  max_clients     : 512000\n  current_clients : 5432\n  shutdown_count  : [{idle_timeout,4102},{destroy,286804},{einval,7},{keepalive_timeout,1242576},{closed,2317122},{protocol_bad_connect,6}]\nlistener on mqtt:1883\n  acceptors       : 64\n  max_clients     : 512000\n  current_clients : 5\n  shutdown_count  : [{destroy,2},{keepalive_timeout,5284},{closed,7}]\nlistener on http:18083\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 4\n  shutdown_count  : []\n./bin/emqttd_ctl broker metrics\nbytes/received          : 25316932980\nbytes/sent              : 151837091538\nmessages/dropped        : 82\nmessages/qos0/received  : 151496137\nmessages/qos0/sent      : 50125251\nmessages/qos1/received  : 0\nmessages/qos1/sent      : 0\nmessages/qos2/received  : 0\nmessages/qos2/sent      : 0\nmessages/received       : 151496137\nmessages/retained       : 3\nmessages/sent           : 50125251\npackets/connack         : 141227451\npackets/connect         : 139771330\npackets/disconnect      : 135977286\npackets/pingreq         : 28897727\npackets/pingresp        : 30987307\npackets/puback/received : 0\npackets/puback/sent     : 0\npackets/pubcomp/received: 0\npackets/pubcomp/sent    : 0\npackets/publish/received: 151496137\npackets/publish/sent    : 50125251\npackets/pubrec/received : 0\npackets/pubrec/sent     : 0\npackets/pubrel/received : 0\npackets/pubrel/sent     : 0\npackets/received        : 456147752\npackets/sent            : 222345281\npackets/suback          : 5272\npackets/subscribe       : 5272\npackets/unsuback        : 0\npackets/unsubscribe     : 0\n./bin/emqttd_ctl broker stats\nclients/count       : 5590\nclients/max         : 9132\nretained/count      : 3\nretained/max        : 3\nroutes/count        : 5570\nroutes/max          : 9075\nsessions/count      : 4\nsessions/max        : 5\nsubscribers/count   : 5587\nsubscribers/max     : 9117\nsubscriptions/count : 5586\nsubscriptions/max   : 9115\ntopics/count        : 5620\ntopics/max          : 9132\n./bin/emqttd_ctl recon bin_leak\n{<10038.263.0>,-186,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.265.0>,-171,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.268.0>,-167,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.270.0>,-155,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.31489.6776>,-130,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.22032.2681>,-122,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.294.0>,-113,\n [emqttd_sm_16,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.402.2720>,-109,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.19137.2627>,-106,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.275.0>,-103,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.290.0>,-103,\n [emqttd_sm_12,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.29105.2680>,-96,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.264.0>,-95,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.288.0>,-92,\n [emqttd_sm_10,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.279.0>,-90,\n [emqttd_sm_1,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.10164.2755>,-90,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.11918.2742>,-88,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.24457.2599>,-87,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.12523.2711>,-87,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.31602.2133>,-86,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.21138.2389>,-83,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.3353.2674>,-83,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.25358.2749>,-83,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.274.0>,-82,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.14298.2672>,-80,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.11634.2046>,-79,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.7721.2755>,-77,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.7332.2680>,-76,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.25898.2720>,-76,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.29385.2705>,-75,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.21358.2762>,-75,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.15449.2691>,-74,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.281.0>,-73,\n [emqttd_sm_3,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.6246.0>,-68,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.4533.1825>,-68,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.25933.2735>,-67,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.287.0>,-66,\n [emqttd_sm_9,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.8410.2141>,-66,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.15195.2534>,-66,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.15869.2688>,-65,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.293.0>,-64,\n [emqttd_sm_15,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.17070.2537>,-64,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.4371.2708>,-64,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.6444.2727>,-64,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.20508.2672>,-62,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.5847.2686>,-62,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.29369.2659>,-61,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.31537.2707>,-61,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.22717.2714>,-61,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.10747.2733>,-61,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.266.0>,-60,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.22450.2293>,-60,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.8114.2521>,-60,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.261.0>,-59,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.24024.2485>,-59,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.7268.2703>,-59,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.10060.2762>,-59,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.16594.2141>,-58,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.14301.2720>,-58,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.18841.2748>,-58,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.284.0>,-56,\n [emqttd_sm_6,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.12867.2676>,-56,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.16788.2710>,-56,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.26171.2353>,-55,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.8403.2615>,-55,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.29651.2702>,-55,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.282.0>,-54,\n [emqttd_sm_4,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.285.0>,-54,\n [emqttd_sm_7,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.23722.2515>,-54,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.283.0>,-53,\n [emqttd_sm_5,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.291.0>,-53,\n [emqttd_sm_13,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.26909.2750>,-53,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.273.0>,-52,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.8959.2241>,-52,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.20714.2483>,-52,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.5787.2616>,-52,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.26923.2631>,-52,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.26704.2681>,-52,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.28799.2728>,-52,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.18572.1506>,-51,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.16498.2621>,-51,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.2981.2694>,-51,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.289.0>,-50,\n [emqttd_sm_11,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.6362.2276>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.1681.2498>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.22832.2559>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.8549.2583>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.5078.2654>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.14780.2672>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.12974.2681>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.26899.2723>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.17298.2586>,-49,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.292.0>,-48,\n [emqttd_sm_14,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.19531.2087>,-48,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.14012.2450>,-48,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.29476.2601>,-48,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.16094.2653>,-48,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.4321.2656>,-48,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.29348.2701>,-48,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.6691.2767>,-48,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n/bin/emqttd_ctl vm memory\nmemory/total            : 2845453800\nmemory/processes        : 2481879472\nmemory/processes_used   : 2481598744\nmemory/system           : 363574328\nmemory/atom             : 654217\nmemory/atom_used        : 637932\nmemory/binary           : 120219608\nmemory/code             : 16084429\nmemory/ets              : 51237696\nMachine 2\n./bin/emqttd_ctl listeners\nlistener on http:8084\n  acceptors       : 4\n  max_clients     : 16384\n  current_clients : 10725\n  shutdown_count  : [{destroy,1256045},{parser_error,8},{keepalive_timeout,9430}]\nlistener on mqtts:8883\n  acceptors       : 64\n  max_clients     : 512000\n  current_clients : 5386\n  shutdown_count  : [{idle_timeout,3959},{destroy,264721},{einval,10},{keepalive_timeout,1220077},{closed,2266196}]\nlistener on mqtt:1883\n  acceptors       : 64\n  max_clients     : 512000\n  current_clients : 6\n  shutdown_count  : [{keepalive_timeout,5284},{closed,7}]\nlistener on http:18083\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 3\n  shutdown_count  : []\n./bin/emqttd_ctl broker metrics\nbytes/received          : 25292523517\nbytes/sent              : 151530138061\nmessages/dropped        : 79\nmessages/qos0/received  : 151479440\nmessages/qos0/sent      : 49597967\nmessages/qos1/received  : 0\nmessages/qos1/sent      : 0\nmessages/qos2/received  : 0\nmessages/qos2/sent      : 0\nmessages/received       : 151479440\nmessages/retained       : 3\nmessages/sent           : 49597967\npackets/connack         : 140991978\npackets/connect         : 139646022\npackets/disconnect      : 135902177\npackets/pingreq         : 28763075\npackets/pingresp        : 30780795\npackets/puback/received : 0\npackets/puback/sent     : 0\npackets/pubcomp/received: 0\npackets/pubcomp/sent    : 0\npackets/publish/received: 151479440\npackets/publish/sent    : 49597967\npackets/pubrec/received : 0\npackets/pubrec/sent     : 0\npackets/pubrel/received : 0\npackets/pubrel/sent     : 0\npackets/received        : 455795990\npackets/sent            : 221376016\npackets/suback          : 5276\npackets/subscribe       : 5276\npackets/unsuback        : 0\npackets/unsubscribe     : 0\n./bin/emqttd_ctl broker stats\nclients/count       : 5532\nclients/max         : 9130\nretained/count      : 3\nretained/max        : 3\nroutes/count        : 5514\nroutes/max          : 9069\nsessions/count      : 4\nsessions/max        : 5\nsubscribers/count   : 5530\nsubscribers/max     : 9109\nsubscriptions/count : 5530\nsubscriptions/max   : 9109\ntopics/count        : 5572\ntopics/max          : 9125\n./bin/emqttd_ctl recon bin_leak\n{<10038.57.0>,-288,\n [ssl_manager,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.270.0>,-160,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.261.0>,-152,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.271.0>,-152,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.268.0>,-145,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.269.0>,-135,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.273.0>,-133,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.267.0>,-131,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.272.0>,-121,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.259.0>,-118,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.3640.2651>,-117,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.8341.2642>,-115,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.288.0>,-113,\n [emqttd_sm_12,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.6502.2689>,-102,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.1885.2722>,-101,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.29718.2704>,-100,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.292.0>,-95,\n [emqttd_sm_16,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.2235.2526>,-94,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.17690.2527>,-94,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.31198.2681>,-94,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.11455.2714>,-94,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.17872.2350>,-93,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.7080.2649>,-93,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.7418.2695>,-92,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.10320.2661>,-90,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.167.0>,-89,\n [{current_function,{disk_log,loop,1}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.22486.1009>,-89,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.281.0>,-88,\n [emqttd_sm_5,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.16334.2685>,-88,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.287.0>,-86,\n [emqttd_sm_11,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.262.0>,-82,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.13476.2619>,-82,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.12028.2694>,-82,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.23444.2700>,-82,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.29311.2585>,-80,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.15480.2672>,-80,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.280.0>,-78,\n [emqttd_sm_4,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.13298.2628>,-77,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.291.0>,-76,\n [emqttd_sm_15,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.3773.2669>,-76,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.12746.2670>,-74,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.18283.2571>,-73,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.7975.2673>,-70,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.265.0>,-69,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.8382.2141>,-69,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.289.0>,-68,\n [emqttd_sm_13,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.3035.2607>,-68,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.1225.2641>,-68,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.258.2679>,-68,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.284.0>,-67,\n [emqttd_sm_8,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.29081.2710>,-65,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.30039.2726>,-65,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.266.0>,-63,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.286.0>,-63,\n [emqttd_sm_10,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.26098.2535>,-62,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.5887.2679>,-62,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.12205.2714>,-62,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.14834.2612>,-61,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.20791.2712>,-61,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.17441.2650>,-60,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.22976.771>,-59,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.2740.2472>,-59,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.4747.2328>,-58,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.1940.2584>,-58,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.29046.2646>,-58,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.285.0>,-57,\n [emqttd_sm_9,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.7180.2614>,-57,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.20864.2678>,-57,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.5596.2729>,-56,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.290.0>,-55,\n [emqttd_sm_14,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.2028.2622>,-55,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.26378.2666>,-55,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.277.0>,-54,\n [emqttd_sm_1,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.30182.2478>,-54,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.9892.2635>,-54,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.25325.2700>,-54,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.2803.2728>,-54,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.5232.2637>,-53,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.25193.2659>,-53,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.18853.2654>,-52,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.21965.2676>,-52,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.18184.2680>,-52,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.8305.2634>,-51,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.19359.2658>,-51,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.263.0>,-50,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10038.23951.2493>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.24567.2571>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.21513.2661>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.26646.2687>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.13943.2744>,-50,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.15692.2039>,-49,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.6901.2410>,-49,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.1416.2494>,-49,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.8639.2558>,-49,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.32254.2628>,-49,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.1046.2662>,-49,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.5529.2690>,-49,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.22357.2698>,-49,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.24309.2728>,-49,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n{<10038.19374.2314>,-48,\n [{current_function,{gen_fsm,loop,7}},{initial_call,{proc_lib,init_p,5}}]}\n. Forgot current mem usage on machine2:\n./bin/emqttd_ctl vm memory\nmemory/total            : 3535034016\nmemory/processes        : 3158033944\nmemory/processes_used   : 3157724880\nmemory/system           : 377000072\nmemory/atom             : 662409\nmemory/atom_used        : 651355\nmemory/binary           : 137413840\nmemory/code             : 16318505\nmemory/ets              : 43881304\nUnfortunately I have to restart the nodes now, otherwise they will be killed by the kernel in the next hours.\n. ./bin/emqttd_ctl status\nNode 'emqttd@push1.dus3.jaumo.com' is started\nemqttd 1.0.1 is running\ncat plugin.config\n[\n  {emqttd_plugin_redis, [\n```\n{eredis_pool, [\n  %% ecpool options\n  {pool_size, 8},\n  {auto_reconnect, 2},\n%% eredis options\n  {host, \"127.0.0.1\"},\n  {port, 22122},\n  {database, 0},\n  {password, \"\"}\n]},\n%% HMGET mqtt_user:%u password\n{authcmd, [\"HGET\", \"mqtt_user:%u\", \"password\"]},\n%% Password hash algorithm: plain, md5, sha, sha256, pbkdf2?\n{password_hash, plain},\n```\nThis option is required for our own plugin changes to auth with client id\n    {clients_file, \"etc/clients.config\"},\n```\n%% SMEMBERS mqtt_acl:%u\n{aclcmd, [\"SMEMBERS\", \"mqtt_acl:%u\"]},\n%% If no rules matched, return...\n{acl_nomatch, deny},\n%% Load Subscriptions form Redis when client connected.\n{subcmd, [\"HGETALL\", \"mqtt_subs:%u\"]}\n```\n]}\n].\nStill need more? ;)\n. If you mean this bug i thought, it was fixed in OTP 18.3.\nIf I can help you, just let me know!\n. As mentioned, i had to restart the instances, so the following output does not match the stats in the first comment:\nMachine 1\n./bin/emqttd_ctl vm\ncpu/load1               : 3.90\ncpu/load5               : 3.81\ncpu/load15              : 3.80\nmemory/total            : 1315767872\nmemory/processes        : 1008079120\nmemory/processes_used   : 1006802408\nmemory/system           : 307688752\nmemory/atom             : 654217\nmemory/atom_used        : 638268\nmemory/binary           : 65292104\nmemory/code             : 16053963\nmemory/ets              : 69945816\nprocess/limit           : 2097152\nprocess/count           : 32591\nio/max_fds              : 1048576\nio/active_fds           : 1\n./bin/emqttd_ctl recon allocated\nbinary_alloc/current: 138972080\ndriver_alloc/current: 14453680\neheap_alloc/current : 1145531312\nets_alloc/current   : 108825520\nfix_alloc/current   : 390630320\nll_alloc/current    : 225184552\nsl_alloc/current    : 42240944\nstd_alloc/current   : 7637936\ntemp_alloc/current  : 2230264\nbinary_alloc/max    : 527207344\ndriver_alloc/max    : 59280304\neheap_alloc/max     : 5514234800\nets_alloc/max       : 330599344\nfix_alloc/max       : 662473648\nll_alloc/max        : 244321064\nsl_alloc/max        : 68697008\nstd_alloc/max       : 57445296\ntemp_alloc/max      : 43169784\nMachine 2\n./bin/emqttd_ctl vm\ncpu/load1               : 2.63\ncpu/load5               : 3.11\ncpu/load15              : 3.35\nmemory/total            : 1537520744\nmemory/processes        : 1224086800\nmemory/processes_used   : 1223691392\nmemory/system           : 313433944\nmemory/atom             : 662409\nmemory/atom_used        : 651612\nmemory/binary           : 73551840\nmemory/code             : 16058187\nmemory/ets              : 65090192\nprocess/limit           : 2097152\nprocess/count           : 34198\nio/max_fds              : 1048576\nio/active_fds           : 2\n./bin/emqttd_ctl recon allocated\nbinary_alloc/current: 135302064\ndriver_alloc/current: 19958704\neheap_alloc/current : 1496804272\nets_alloc/current   : 115903408\nfix_alloc/current   : 352881584\nll_alloc/current    : 222563112\nsl_alloc/current    : 44600240\nstd_alloc/current   : 16550832\ntemp_alloc/current  : 2230264\nbinary_alloc/max    : 509119408\ndriver_alloc/max    : 81562544\neheap_alloc/max     : 6203464624\nets_alloc/max       : 275549104\nfix_alloc/max       : 638880688\nll_alloc/max        : 243534632\nsl_alloc/max        : 70495152\nstd_alloc/max       : 66096048\ntemp_alloc/max      : 45697016\n. Hmmm. I tried but what happens is this:\n\nroot@push1:/opt/emqttd-jaumo/erts-7.3/bin# ./erl -name foo@push1.dus3.jaumo.com -cookie emqttdsecretcookie -remsh emqttd@push1.dus3.jaumo.com\nErlang/OTP 18 [erts-7.3] [source] [64-bit] [smp:16:16] [async-threads:10] [kernel-poll:false]\n* ERROR: Shell process terminated! (^G to start new job) *\n\nWhen i pres ^G this happens:\n\nUser switch command\n --> sys:get_status(list_to_pid(\"<10038.24464.2600>\")).\nUnknown command\n -->\n\nSSL: Yes we use SSL for public connections and no-ssl for internal connections\n. Lets try a different approach:\n1. I could try using non-ssl connections for external connections as well, at least to prove that there is a SSL problem or not\n2. What erlang/OTP Version do you use to compile emqttd official distribution? I could also try to compile against a different version.\nJust let me know what helps you most!\n. @emqplus I sent you a contact request.\n. I now moved mqtt sessions to non-SSL. Unfortunately I can't move the websockets to non-SSL as this leads to a browser security policy breach. First insights:\nAlready in the startup phase the mem consumption is MUCH lower. Before, the broker grew to about 600-700MB (used). This is probably due to the high connection rate on startup as all clients do reconnect automatically when the broker disconnects because of the restart.\nNow, with mqtt connections the memory consumption in the first minute is about 210 MB (used).\nEven after the startup phase, with mqtts, the broker is constantly growing with about 10MB every few seconds. With mqtt, the usage stays at around 270-280MB.\nUnfortunately I cannot really tell if the websocket SSL connection leak as well, but if so, the broker grows much slower probably because the connection rate of websockets is MUCH lower than the mqtt conn-rate.\nP.S.: The MQTT connection rate is quite high as the connections are all made from mobile devices. Connections are established as soon as the customer opens our app (Jaumo). Due to the nature of mobile networks there are a lot of disconnects and reconnects. Also mobile customers tend to have many short sessions instead of a few long sessions.\n. @phanimahesh, What do you use for \"SSL stripping\"? I'd rather prefer to let emqttd do the SSL work but as long as there is a such a severe mem leak I am thinking about a workaround.\n. Since avoiding SSL in emqttd, the leak became smaller. The daemon is growing far slower than before.\nUnfortunately it IS STILL growing. All I can see is that the number of processes grows and grows. It seems to me that normally, the number of processes should be approximately double as high as the number of current connections, right? At least this is the case in the startup phase. But then over the time, the number of processes grows and grows.\nHow can we debug that?\n. Thanks for you reply.\n@phanimahesh I tried, but nothing suspicious happened. The number of processes went up and down as expected. Tested all kind of clients we are supporting. \n@emqplus We use ONLY clean sessions\nMaybe it has to do sth with the unique number of clients? However I recognized a suspicious behaviour. See the screencast: http://cl.ly/253Q2e2L0V05.\nCurrently I am disabling misc modules to see if it changes anything but no success until now.\n. Clean session: It actually means, that this session is not persistent, so there sould not be taken any session timeout into account, if clean_session is true. See here http://www.hivemq.com/blog/mqtt-essentials-part-7-persistent-session-queuing-messages\nAnyway I've set the session timeout to 1m and it doesn't make a difference. The only plugin I have activated is redis auth with some copy + paste customization to allow both redis auth + auth by ip/client_id. You can see the plugin here (https://github.com/Jaumo/emqttd_plugin_redis). The diff to the original plugin is not huge. I only merged a few functions from here https://github.com/emqtt/emqttd/blob/master/src/emqttd_auth_clientid.erl.\nHere you can see the complete config: http://cl.ly/1Y2u3H3i2F0G. If it helps, I could even give you access to our production system.\nFrom my understanding as a developer/devop (unfortunately not erlang), it is definitely not a normal behaviour that the number of processes is constantly growing even if the number of concurrent connection stays roughly the same and there is no persistence at all. To me it looks like a bug.\n. By the way: I updated to version 1.1 with OTP 18.3, same behaviour. Processes (and memory) is constantly growing. My first intention was to compile the 1.0.x with OTP 17.x but then I recognized that the latest version requires OTP18 so I decided to stay with 18 for future compat.\n. Not yet, but if it helps i will gather the stats and write them in a time series DB. Will do that on monday and will be able to present some data maybe a day later.\nUntil then: Let me know what else I can do to find a solution :)\n. Would it be possible to add the disconnect stats to the dashboard listeners route (http://host:18083/api/listeners)? \nI'd prefer to collect the stats via http/json as the stats are collected from another node in PHP.\nMaybe other users would also benefit from showing these stats in the dashboard.\n. Stats are collecting from now on. Unfortunately without listener-disconnect stats as these aren't available from dashboard API.\n. Thats totally fine! I wont have the time to check that before next week\nanyway!\n2016-06-09 19:39 GMT+02:00 J Phani Mahesh notifications@github.com:\n\ndisconnection stats are important, without them we won't be able to see if\na particular disconnection is the cause, by not cleaning up processes\nproperly.\nI'm on vacation, I can add the listener disconnect stats to the api next\nweek. Till then, see if you notice any patterns on processes vs clients.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/561#issuecomment-224970319, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe/AAUQZ_6wC5hfQuGnClddi9jO5dgNkhL5ks5qKE-4gaJpZM4Ij7nE\n.\n. Hi There! Are you back from holidays?\nI have some stats right now, the graphs show 7 days:\n\nhttp://cl.ly/3W0B0y143i0z\nhttp://cl.ly/3Y3i2l34411J\nUnfortunately the memory graphs are rather fresh but clearly show a pattern.\nNeed more? What about the listener disconnect stats via http?\n. ",
    "CrazyWisdom": "Hi @freedomsean, what mqtt client are you using?\n. @freedomsean \nCreate CA organization\n\n1.Create ca-key.pem, enter the password like 123456\n\nopenssl genrsa -out ca-key.pem -des 1024\n- 2.Create ca-csr.pem\nopenssl req -new -key ca-key.pem -out ca-csr.pem\n- 3.Create ca-cert.pem\nopenssl x509 -req -in ca-csr.pem -signkey ca-key.pem -out ca-cert.pem\nCreate server certificate\n\n1.Create server-key.pem\n\nopenssl genrsa -out server-key.pem 1024\n- 2.Create server-csr.pem\ncreate the openssl.cnf file in current directory, content like:\n```\n  [req]\n      distinguished_name = req_distinguished_name\n      req_extensions = v3_req  \n  [req_distinguished_name]  \n  countryName = Country Name (2 letter code)  \n  countryName_default = CN  \n  stateOrProvinceName = State or Province Name (full name)  \n  stateOrProvinceName_default = BeiJing  \n  localityName = Locality Name (eg, city)  \n  localityName_default = YaYunCun  \n  organizationalUnitName  = Organizational Unit Name (eg, section)  \n  organizationalUnitName_default  = Domain Control Validated  \n  commonName = Internet Widgits Ltd  \n  commonName_max  = 64\n\n  [ v3_req ]\n\n  basicConstraints = CA:FALSE  \n  keyUsage = nonRepudiation, digitalSignature, keyEncipherment  \n  subjectAltName = @alt_names\n\n  [alt_names]\n\n  IP.1 = 127.0.0.1\n\n```\nthen execute:\n  openssl req -new -key server-key.pem -config openssl.cnf -out server-csr.pem\n- 3.Create server-cert.pem\nopenssl x509 -req -CA ca-cert.pem -CAkey ca-key.pem -CAcreateserial -in server-csr.pem -out server-cert.pem -extensions v3_req -extfile openssl.cnf\nCreate client certificate\n\n1.Create client-key.pem\n\nopenssl genrsa -out client-key.pem\n- 2.Create client-csr.pem\nopenssl req -new -key client-key.pem -out client-csr.pem\n- 3.Create client-cert.pem\nopenssl x509 -req -CA ca-cert.pem -CAkey ca-key.pem -CAcreateserial -in client-csr.pem -out client-cert.pem\nAll files like follow\n\u279c  ssl ls -l\ntotal 88\n-rw-r--r--  1 mac  staff  757 May 25 15:29 ca-cert.pem\n-rw-r--r--  1 mac  staff   17 May 25 15:46 ca-cert.srl\n-rw-r--r--  1 mac  staff  603 May 25 15:29 ca-csr.pem\n-rw-r--r--  1 mac  staff  958 May 25 15:25 ca-key.pem\n-rw-r--r--  1 mac  staff  664 May 25 15:46 client-cert.pem\n-rw-r--r--  1 mac  staff  420 May 25 15:45 client-csr.pem\n-rw-r--r--  1 mac  staff  497 May 25 15:44 client-key.pem\n-rw-r--r--  1 mac  staff  928 May 25 15:34 openssl.cnf\n-rw-r--r--  1 mac  staff  847 May 25 15:35 server-cert.pem\n-rw-r--r--  1 mac  staff  704 May 25 15:35 server-csr.pem\n-rw-r--r--  1 mac  staff  891 May 25 15:33 server-key.pem\n\u279c  ssl\nMQTT.fx setting\n\n. ",
    "freedomsean": "Thanks @emqplus and @CrazyWisdom.\nI use mqttfx for testing to eMQTT. This tool is based on paho. \nThe bottom quote is the error log. \nMy MQTT broker is setup in the intranet. All of required port(1883 & 8883) are opened. If there is no SSL setting, it will be connected perfectly.\nMy SSL certificate follow this tutorial.\n2016-05-25 09:14:13,098  INFO --- MqttFX ClientModel             : MqttClient with ID 50c8a7c7635c427789fa assigned.\n2016-05-25 09:14:13,202 ERROR --- MqttFX ClientModel             : Error when connecting\norg.eclipse.paho.client.mqttv3.MqttException: MqttException\n    at org.eclipse.paho.client.mqttv3.internal.ExceptionHelper.createMqttException(ExceptionHelper.java:38) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    at org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(ClientComms.java:604) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    at java.lang.Thread.run(Unknown Source) [?:1.8.0_77]\nCaused by: javax.net.ssl.SSLHandshakeException: Remote host closed connection during handshake\n    at sun.security.ssl.SSLSocketImpl.readRecord(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.performInitialHandshake(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.startHandshake(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.startHandshake(Unknown Source) ~[?:1.8.0_77]\n    at org.eclipse.paho.client.mqttv3.internal.SSLNetworkModule.start(SSLNetworkModule.java:89) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    at org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(ClientComms.java:590) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    ... 1 more\nCaused by: java.io.EOFException: SSL peer shut down incorrectly\n    at sun.security.ssl.InputRecord.read(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.readRecord(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.performInitialHandshake(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.startHandshake(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.startHandshake(Unknown Source) ~[?:1.8.0_77]\n    at org.eclipse.paho.client.mqttv3.internal.SSLNetworkModule.start(SSLNetworkModule.java:89) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    at org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(ClientComms.java:590) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    ... 1 more\n2016-05-25 09:14:13,203 ERROR --- MqttFX ClientModel             : Please verify your Settings (e.g. Broker Address, Broker Port & Client ID) and the user credentials!\norg.eclipse.paho.client.mqttv3.MqttException: MqttException\n    at org.eclipse.paho.client.mqttv3.internal.ExceptionHelper.createMqttException(ExceptionHelper.java:38) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    at org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(ClientComms.java:604) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    at java.lang.Thread.run(Unknown Source) [?:1.8.0_77]\nCaused by: javax.net.ssl.SSLHandshakeException: Remote host closed connection during handshake\n    at sun.security.ssl.SSLSocketImpl.readRecord(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.performInitialHandshake(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.startHandshake(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.startHandshake(Unknown Source) ~[?:1.8.0_77]\n    at org.eclipse.paho.client.mqttv3.internal.SSLNetworkModule.start(SSLNetworkModule.java:89) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    at org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(ClientComms.java:590) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    ... 1 more\nCaused by: java.io.EOFException: SSL peer shut down incorrectly\n    at sun.security.ssl.InputRecord.read(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.readRecord(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.performInitialHandshake(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.startHandshake(Unknown Source) ~[?:1.8.0_77]\n    at sun.security.ssl.SSLSocketImpl.startHandshake(Unknown Source) ~[?:1.8.0_77]\n    at org.eclipse.paho.client.mqttv3.internal.SSLNetworkModule.start(SSLNetworkModule.java:89) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    at org.eclipse.paho.client.mqttv3.internal.ClientComms$ConnectBG.run(ClientComms.java:590) ~[org.eclipse.paho.client.mqttv3-1.0.2.jar:?]\n    ... 1 more\n2016-05-25 09:14:13,214  INFO --- ScriptsController              : Clear console.\n2016-05-25 09:14:13,215 ERROR --- BrokerConnectService           : MqttException\n. Hi, @CrazyWisdom, Thanks for your kind tutorial. I found the root cause.\nI have started a emqtt in \"screen\" and I forgot to stop it, so no matter how did I change the config and restart it, the second emqtt instance could not use 8883 port, because the other emqtt is used.\nIf emqtt can notify user when user executes more than one process, I think it will be a useful feature. \nThanks again for @CrazyWisdom and @emqplus, it is a wonderful project.\n. ",
    "hello-liuyi": "Hi, @CrazyWisdom ,Thank you, I want to kown if i can  use java or python  client connect the emqtt\u2018s  ssl port 8883 without certfile,if yes, how can i do it ,thank you,\n. ",
    "KerwinKoo": "@CrazyWisdom \nHi.\nWhere and how did you get the MQTT.fx setting UI-tool? Is the connection profile for client or eqmtt server? . +1. It's required the glibc version later than 2.14. but after installing glibc-2.14 in Centos 6 , EMQ 2.0 get stuck and doesn't work with nothing reported.. @emqplus I have installed the binary package from http://emqtt.com/downloads/latest/centos6, but it doesn't work:\n/opt/emqttd/erts-7.3/bin/escript: /lib64/libc.so.6: version `GLIBC_2.14' not found (required by /opt/emqttd/erts-7.3/bin/escript)\nI think this issue should be opened again, because the problem is not fixed completely. This problem gone After installing GLIBC_2.14 in centos 6.5 but SSL/TLS connection under port 8883 get stuck.\nCan you treat this issue more seriously?\nThanks.\n. ",
    "KohliDev": "@hello-liuyi @brechmos \nWere you able to figure out how to connect to emqtt ssl port 8883 without cacert? It will be very helpful if some one can provide me a script to do so.. Thanks @grutabow \nI was able to achieve this functionality in Python with help of following code:\n```\n!/usr/bin/env python\nimport paho.mqtt.client as mqtt\nimport ssl\ndef on_connect(client, userdata, flags, rc):\n    print(\"Connected with result code \"+str(rc))\n    client.publish(\"paho/temperature\", \"temperature\")\nclient = mqtt.Client()\nclient.on_connect = on_connect\nclient.tls_set(\"/Users/vkohli/Desktop/mqtt_cert/cert.pem\",\n               None,\n               None, cert_reqs=ssl.CERT_NONE, tls_version=ssl.PROTOCOL_TLSv1, ciphers=None)\ndisables peer verification\nclient.tls_insecure_set(True)\nclient.connect(\"ip-address\", 8883, 60)\nclient.loop_forever()\n```\nI need to provide a random cacert.pem but the above configuration works and Im able to connect to the server with SSL encryption without checking its certificate. . Is this feature supported? \nWe are using EMQTT broker heavily is there any alternate way to support Client cert authentication with EMQTT broker.. Any update on this issue?. Isnt this bug duplicate of #585 ??? . Thanks @emqplus . ",
    "grutabow": "@KohliDev  In paho c client, set MQTTClient_SSLOptions.enableServerCertAuth = 0 and it will not check cacert.. But python and java client has no such option.. Letsencrypt generates certificate for server. That means we should use one-way TLS authentication.\nSuppose we are utilizing websocket over TLS.\nThe emq.conf should look like below:\n```\nlistener.wss.external.keyfile = etc/certs/privkey.pem\nlistener.wss.external.certfile = etc/certs/cert.pem\nlistener.wss.external.cacertfile = etc/certs/cacert.pem\nlistener.wss.external.verify = verify_none\nlistener.wss.external.fail_if_no_peer_cert = false\n```\nAnd the paho python code should look like below:\n```\nimport paho.mqtt.publish as publish\ntls_param = {'ca_certs':\"fullchain.pem\"}\npublish.single(\"test/topic\", payload=\"abc\", qos=1, retain=False, hostname=\"www.example.com\",\n           port=8084, client_id=\"923975342346\", keepalive=60, will=None, auth=None,\n           tls=tls_param, protocol=4, transport=\"websockets\")\n```\n. @arihantdaga  Yes, you have to keep fullchain.pem in the directory where your python script resides. \nDomain name is included in server certification. So you do not specify your domain name in emq.conf.\nFollowing command will be helpful to debug certification issue:\nopenssl s_client -connect mydomain.com:8084 -CAfile fullchain.pem -state. Please install or compile a rebar in your MacOS. For example:\nruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\" < /dev/null 2> /dev/null\nbrew install rebar. @michaelcplusplus  Official luerl does not work well with emqttd, since its luerl_scan module will not be loaded during bootstrap. This problem is fixed in the latest emq-lua-hook develop branch.. @michaelcplusplus  This crash is different from the previous \"{badrecord,luerl}\" one. This \"{undef,[{luerl_scan,string ...\" exception will be fixed in next release. Sorry for the inconvenience.\nBTW, lua api \"on_message_publish()\" has two new parameters in the head of parameter lists:\nlua\nfunction on_message_publish(clientid, username, topic, payload, qos, retain)\nend. @michaelcplusplus   one question about SUSE11. Do you build emqttd on the SUSE11? or copy a emqttd binary from other linux distribution to SUSE11?. @pritstift  Add following entry in emq_sn.conf\nmqtt.sn.username = mqtt_sn_user\nmqtt.sn.password = abc\nThus mqtt-sn plugin will connect emqttd core with this username.\nPlease add this username in your emq_auth_pqsql.. This feature will be released in next official version.. @pritstift  Don't worry about these error messages which means emq-sn does not support statistic features. Will support it in next version and eliminate errors.. @edmandiesamonte   RFC7252 stated that:\n\nCoAP itself does not provide protocol primitives for authentication or authorization; where this is required, it can either be provided by communication security (i.e., IPsec or DTLS) or by object security (within the payload).\n\nemq-coap does not support authentication now. There are two options:\n- DTLS\n- carry username and password in customed coap options\nWhat do you prefer?\n. @edmandiesamonte   emq-coap has been refactored and new version supports following features:\n1) authentication by username and password\n2) DTLS\nYou can expect them in next official release.. What is your test scenario? How many publishers? How many subscribers? How many topics?. @syberkitten  What about qos? QOS2? QOS0?\n. @Linuturk  plan to support periodic DNS query in v2.3-beta.2.. Bridge is able to sync data between brokers, please refer to http://emqtt.io/docs/v2/bridge.html.. MQTT spec v3.1.1 addressed that:\n\nThe Server might grant a lower maximum QoS than the subscriber requested. The QoS of Payload Messages sent in response to a Subscription MUST be the minimum of the QoS of the originally published message and the maximum QoS granted by the Server.\n\nSo the qos behaviour is as expected.. Mqtt client has closed the tcp connection abnormally and EMQ broker report such an exception. You have to check your mqtt client program.. @UserXYZ   \nThe first case\nPlease replace \"/#\" with \"+\" or \"#\" or \"test\", since the published topic is \"test\".\nThe second case\nPlease replace \"/test\" with \"test\" in mosquitto_pub command.\n. The \"mqtt\" resource for coap is a \"bridge\" between coap and mqtt, which make coap and mqtt talk to each other. Since GET and PUT are enough for SUB and PUB action, POST and DELETE is useless in mqtt scenario.\nIf you want to implement a pure coap feature, please write a resource handler for your customed path(for example coap://localhost/my_coap) which is able to process GET/PUT/POST/DELETE as will. Such a development procedure has not been documented yet.. Sure, longer topic name consumes more memory. And more topic layers consumes more CPU resources.. coap .well-known resource will return an empty content. Plan to fill this resource in later version.. In fact, mqtt has such a constraint that each clientId allows only one instance. For example, a mqtt client connects broker with clientId=test. Minutes later, another mqtt client connects broker with clientId=test too. The later one will kick out the first one who will lost the connection.\nIs this what you want?. EMQ has included a plugin called emq-elixir-plugin, which use MIX, a build tool of elixir language. The error you see means that MIX was downloading elixir packages from hex.pm and got an broken https connection. \nTo solve this issue, just run 'make' again, and let MIX retries until success.\nemq-elixir-plugin is just a template for elixir developer. And it does nothing in its official code. That is to say, it will be no harm to remove emq-elixir-plugin out of EMQ project.\nSo don't worry about this MIX error.. 443 is a privileged port which can not be open by a normal user. Please run emqttd with root account.\nsudo ./bin/emqttd start. @yogo1212   Would you please capture a tcpdump(wireshark) log for the entire procedure? It would help a lot. Thanks!. @yogo1212   You can capture tcpdump(or wireshark) log from subscriber PC, other than server.. Such a crash will be fixed in next official release.. When client sends a DISCONNECT with duration, broker will not call 'client.disconnected' hook until the duration time elapsed, which means the client has asleep timeout. This is reasonable.\nIf client sends CONNECT during asleep state, 'client.connected' hook will never be called which is against your statement. This is reasonable too. \nYour proposal is very good. Maybe we should apply two hooks what called'client.sleep' and 'client.wakeup'.. This crash will be fixed in next official release.. Would you please describe your problem in more details? How to reproduce the issue step by step?. A quick fix in this case is \nrm /etc/emqttd/plugins/emq_lwm2m.conf\nThe root cause is that \n\nemq-lwm2m has been included in emqtt v2.3.0-beta3.\nemq-lwm2m has been removed since emqtt v2.3.1. \nIn your upgrade operation from v2.3.0-beta3 to v2.3.1, \"/etc/emqttd/plugins/emq_lwm2m.conf\" is not deleted as expected which makes v2.3.1 regards that emq-lwm2m is alive either. But no corresponding emq-lwm2m.schema is found which throw exceptions you have seen.\n\nIn a word, upgrade from v2.3.0-beta3 requires a clean installation. That is, remove v2.3.0-beta3 thoroughly from disk first. \n. @feihualuomeng   You have to build and install rebar first.\ngit clone https://github.com/rebar/rebar\nmake\n./bootstrap.bat\ncp rebar  /usr/bin/\n. What is your mqtt client? And what is your test scenario?. Would you please tell us how to reproduce such missed puback? If wireshark(or tcpdump) log is available in mqtt client device, that would be great help.. 'puback/missed' means mqtt client has sent an invalid msgId. For example, broker sents a PUBLISH with msgId=2, but client responds with a PUBACK(msgId=30). Such a PUBACK is 'missed'.. What is the memory size of your ubuntu machine? Only 1GB?\nAnd what is your log level? error? debug? The log module(lager_event) has consumed 376MB memory.. Please refer to https://github.com/emqtt/emqttd/issues/765.. setMaxInflight() only takes effect on client side. This function is not able to modify server's max_inflight.. Don's use a same client id for multiple mqtt clients, since only one of them could remain online and others will be kicked offline.\nPlease refer to the official document http://emqttd-docs.readthedocs.io/en/latest/advanced.html.\nHere is an example of local shared subscription:\n1. Client A/B/C all subscribe topic='$local/$share/group1/test'\n2. Client D publish a message on topic='test'\n3. One of A/B/C will receive a message on topic='test'. The other two clients will receive nothing.. What about clean-session=true? Broker will never sent messages to disconnected clients if session is destroyed. Does this meet your requirement?. Let's build a scenario:\n\nA/B/C/D connected with clean-session=false\nA/B/C/D all shared-subscribe a same topic\nC/D get disconnected for some reason\n\nYou want to distribute messages between A/B, without C/D. Is it what you want? If so, emqttd does not support this feature.. io:format() should be replaced by lager.. Replace io:format() with lager.. It is better to increase min_heap_size of the spawned process.. Measure the memory size emqttd_server:publish() may use. For example:\n1) Set the max_heap_size to 1000, and kill = false, error_logger = true.\n2) Run some cases and check the log that any max heap error is present. If present, it means max_heap_size is not big enough to held variables in these functions.\n3) Increase max_heap_size to 2000.\n4) Run same cases again, If no error, 2000 is a safe value.\n5) min_heap_size should be at least 2000 within the spawn_opt.. Maybe this random value varies too much, and it is hard to compare performances of this parameter.. Are you sure that fullsweep is good for this process?. ",
    "rauger": "@CrazyWisdom I worked the exact same steps that you did to generate the keys, used the exact same commands and the same conf file, and it seems like my emqtt broker is still not working. The handshake is consistently failing with these messages \n\n11:30:21.925 [error] CRASH REPORT Process <0.1461.0> with 0 neighbours crashed with reason: {ssl_error,{options,{certfile,\"etc/certs/new_certs/server-cert.pem\",{error,enoent}}}} in esockd_connection:upgrade/1 line 131\n11:30:21.926 [error] Supervisor 'esockd_connection_sup - <0.1255.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,true},{max_clientid_len,1024},...]) at <0.1461.0> exit with reason {ssl_error,{options,{certfile,\"etc/certs/new_certs/server-cert.pem\",{error,enoent}}}} in context connection_crashed\n11:30:21.927 [error] CRASH REPORT Process <0.1463.0> with 0 neighbours crashed with reason: {ssl_error,{options,{certfile,\"etc/certs/new_certs/server-cert.pem\",{error,enoent}}}} in esockd_connection:upgrade/1 line 131\n11:30:21.928 [error] Supervisor 'esockd_connection_sup - <0.1255.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,true},{max_clientid_len,1024},...]) at <0.1463.0> exit with reason {ssl_error,{options,{certfile,\"etc/certs/new_certs/server-cert.pem\",{error,enoent}}}} in context connection_crashed\n\nit seems like the cert files are incorrect, is this true? Could it be some other configuration error? Because when connecting using fx without ssl/tls, it works perfectly fine!\nEDIT: This is on the new 2.2 version\nThank you for your help and time!\n. @zhengyupan,\nLooks like me and you are in the same boat! I just started learning Erlang too. I am using Erlang 19.2 on Ubuntu 14, but for that matter I'm no security expert yet so thank you for the tip on sha. \nWhere would you like to talk about the plugin? If you have any resources that can explain them a bit better, please let me know! I would like to integrate this into the emq platform so that all of my connections can be using pre-shared keys.\nAnd thank you very much for your help!\n. @turtleDeng You're right. \nJust in case anyone has this problem: Issue was that I has OTP 20 installed on accident, I needed less than 20. But when I uninstalled OTP 20 and installed 19.2, the uninstallation was not complete. I needed to empty /usr/local/lib of all of the library files, clear erl from my path, and reinstall emq-relx. . ",
    "chouhan": "Hi @CrazyWisdom \nI am doing the same exercise (https://github.com/emqtt/emqttd/issues/562#issuecomment-221500588) with VerneMQ broker, and it fails connecting.\nIn the MQTT.fx client you've defined the client certificates. Where are you placing the server certificates?\nIn my case, I am pointing those server certificates in vernemq.conf file.\nlistener.ssl.cafile = /home/osboxes/mqttfx-certs/ca-cert.pem\nlistener.ssl.certfile = /home/osboxes/mqttfx-certs/server-cert.pem\nlistener.ssl.keyfile = /home/osboxes/mqttfx-certs/server-key.pem\nAppreciate any help here.\nThanks!. ",
    "PiedPieper": "@rauger is my old account 2 up. I didn't realize that I didn't edit it. 'enoent' means that the file doesn't exist... the path was wrong. \n. Any update on this?. @gautaz If you are using the peer certificate as the username, you can implement an ACL plugin/hook in order to give them access to resources. \nok = emqttd_access_control:register_mod(acl, modul_of_custom_acl_function, Opts),\nwhere module_of_custom_acl_function> is a module exporting the functions contained in emq_plugin_template/src/emq_acl_demo.erl\nI would say that it does require some erlang knowledge, especially if you plan on checking against a database. Was this included in 2.1? I cannot find any documentation on this. @sanket-kulkarni-vmware What if you couldn't hardcode in the \"username\"?\nIf i have 100 clients, and I wanted to allow users USER1-USER100 to only subscribe to TOPIC1, how would I do that?. @pavan, thank you for the quick reply. It would be nice to have acl.conf limit users without having to perform a lookup on every publish, but this should work fine. Again, thanks!. @emqplus is there any emqttd function that can be implemented in a custom plugin drop a client by clientid if the ACL fails?. @emqplus Yes. If we have a custom ACL plugin, that plugin receives the Client record along with some other arguments to determine if the client should have access to that topic. Inside that code, on an ACL deny, is there any function that can drop the connection with knowledge of the client record? \nWe have the #mqtt_client.client_pid, would you recommend just terminating that process? Or is there a cleaner way?. @emqplus How are you implementing this ? I am going to start working on this tomorrow and I'd love some pointers on how to implement it. If I can get it done maybe I can save you some work. Is it all done in emqttd_bridge.erl?. @emqplus Or else, when is R2.3/2.4 coming out?. @emqplus  I created a bridge a few weeks ago, I can share it if you'd like - Right now it works but I am concerned about the concurrency connecting to AWS - I am using emqttd:subscribe to create multiple listeners sharing the local subscription on the EMQ side, but as of now I can't figure out how to share subscriptions with multiple processes on the AWS side. For example, If i use emqttc:start_link to connect multiple subscribing processes to AWS, all will get all messages on that topic. \nHow have you solved this? . @emqplus Is there any update on when this feature will be released?. @Marc-drouet I'm not able to share the code, but I created a very basic plugin with one dependency, emqttc and connected to AWS. For a certain range of topics on AWS, I subscribed using emqttc:subscribe and then published messages received from AWS to emqttd using emqttd:publish. For a certain range of topics on emqttd, I used emqttd:subscribe and any messages received i forwarded over emqttc:publish to AWS IoT. . @codewiget, this was just answered for me coincidentally. You need to use some sort of authentication plugin, acl.conf does not support this. You're using redis auth, so you just need to configure redis and using HGET. Check out the readme for emq_auth. Check out emq_redis_auth plugin. You can set up a simple username/password auth and allow users to connect to certain topics, and in your acl.config specify what topics you want everyone to have access to.. These are special system topics for statistics. My fault for thinking it was a bug : http://www.hivemq.com/blog/mqtt-essentials-part-5-mqtt-topics-best-practices\nBUT can this be disabled? . The problem is your file limit. The default for Ubuntu is ~1000 open files. You need to change the limits on your system, here is a link:\nhttp://posidev.com/blog/2009/06/04/set-ulimit-parameters-on-ubuntu/. @emqplus , is there any way that I can accomplish this? How would you go about it?\nThanks. @emqplus It apprears that using ssl_dist_optfile requires OTP 20.2: http://www.erlang.org/news/116 . Nothing wrong with the requirement, you may just want to note this in the documentation\n. It worked just as an FYI. I would add that you should not include verify_peer as an option for the client because it checks something in the certificate, I'm not sure what, with the hostname, and it is rare that your hostname is going to be included in the certificate issued.. @emqplus read through it, it looks great! . @DanielRooks @Gilbert-Wong  I made a mistake in my original post. The otp version I am using is 20.2\n\n(EMQ@10.26.0.195)1> erlang:system_info(otp_release).\n\"20\"\n\nFor that matter, I have been running OTP 20.2 with EMQTT 2.3.5 for months and have had a great experience with it aside from this issue.\n. Many thanks for this feature, I'm sure many will appreciate it !. Hate to keep bothering you all, but I believe I found 2 more bugs relating to the bridge..:\n1 was a Logging bug in emqx_bridge:351\n?LOG(info, \"Bridge ~p diconnected~nreason=~p\", [name(), Conn, Reason]),  the ~n needs to be a ~p as there are 3 args.\n2 in emqx_message:set_headers, it doesn't properly handle the case where the headers are undefined due to the is_map() guard. So either we can remove the is_map guard or add a 3rd function overload:\nset_headers(_Headers, Msg) ->\n    Msg;\nI'm surprised no one has pointed these out because bridging seems impossible w/o these fixes. ",
    "foolbear": "this is my config file:\n```\n[root@iZ25ziwfw0bZ foolbear]# less emqttd/plugins/emqttd_plugin_mysql/etc/plugin.config\n[\n{emqttd_plugin_mysql, [\n{mysql_pool, [\n    %% ecpool options\n    {pool_size, 8},\n    {auto_reconnect, 3},\n\n    %% mysql options\n    {host,     \"localhost\"},\n    {port,     3306},\n    {user,     \"root\"},\n    {password, \"VeryComplex99\"},\n    {database, \"emqtt\"},\n    {encoding, utf8}\n]},\n\n%% select password only\n{authquery, \"select password from mqtt_user where username = '%u' limit 1\"},\n\n%% hash algorithm: plain, md5, sha, sha256, pbkdf2?\n{password_hash, sha256},\n\n%% select password with salt\n%% {authquery, \"select password, salt from mqtt_user where username = '%u'\"},\n\n%% sha256 with salt prefix\n%% {password_hash, {salt, sha256}},\n\n%% sha256 with salt suffix\n%% {password_hash, {sha256, salt}},\n\n%% comment this query, the acl will be disabled\n{aclquery, \"select allow, ipaddr, username, clientid, access, topic from mqtt_acl where ipaddr = '%a' or username = '%u' or username = '$all' or clientid = '%c'\"},\n\n%% If no rules matched, return...\n{acl_nomatch, allow}\n\n]}\n].\n```\n. Yes, password field in mysql table mqtt_user is encoded by sha256.\nError occurs only occasionally, in most cases it works correctly.\nFor example, error almost occurs every-time when the first client connect to broker. \nIf auth mod changed from mysql to redis, error never happened.\n. thanks, @emqplus @huangdan \n. @huangdan thanks\uff01\n. @emqplus @kenpeter thanks\uff01\n. 1. checked: -define(CONNACK_CREDENTIALS, 4).    %% Username or password is malformed\n2. but what's different between CONNACK_CREDENTIALS and CONNACK_AUTH?\n. ",
    "ralphtheninja": "+1\n. I found some other typos as well, but I can update with new PRs for those changes.\n. This was related to Azure Load Balancer pinging the service through a probe. However, it seems the ALB doesn't handle ssl connections.. @emqplus Have you considered using back tics instead of simple quotes to emphasize words more? E.g. like: max_clients\n. ",
    "tenorviol": "Yes! \ud83d\udc4d \n. ",
    "asanchezdelc": "\ud83d\udc4d\n. @PiedPieper There seems to be a new API to kick a client using it's ID which is super useful. \nemqttd_mgmt:kick_client(CLIENT_ID) \nhttps://github.com/emqtt/emqttd/blob/b1842b535f89e08cb326501f6990c03063064f85/src/emqttd_rest_api.erl#L135\n. ",
    "fedenunez": "+1\n. ",
    "Thibauth": "\nAWS IoT uses TLS with client certificate validation and skips authentication at the MQTT layer. In the AWS IoT model, the association between client-id and certificate is configured at the broker side (attach a thing to a certificate). Therefore, there is no need to extract any value from the certificate and submits it for MQTT authentication.\n\nI think both models \u2014extracting the client id from the certificate or maintaining the (client id, certificate) association separately\u2014 have their merits. In the former, authentication can be completely stateless while the latter offers more flexibility. Ideally, an implementation of this feature would support both models.. ",
    "rajeshemailto": "I hope, we are getting this very soon?. ",
    "uodasuodas": "A very needed feature, is there any updates on the status of this issue?. Are there any updates on this issue? Is it going to be implemented at some time in near future? A very important and needed feature.. ",
    "gautaz": "Hello,\nSorry to comment on an already closed issue, my question is closely related to what @Thibauth was detailing in this comment but I can open a new issue if needed.\nAs stated by @emqplus, EMQ now supports authentication based on client certificates since version 2.3.2 but what remains unclear to me is if the client can be identified by its certificate. Is EMQ able to do this? If this is the case, I did not find anything in the latest documentation on this particular subject, can someone kindly point me to the right direction?\nFor instance, can I tell EMQ to identify a client based on its certificate common name? Any other mean to link the certificate to the client identity would be of course an option.\nI also had a look at this #1388 but I am a complete Erlang newbie.... @PiedPieper Thanks for the tip, I will look into this depending on the time I'm given to investigate/develop on top of EMQ.\nWe are currently using Mosquitto with some issues and EMQ is a good candidate as a replacement but as we are also using the use_identity_as_username option, we need to find a way to keep this feature.. Thanks! The right version is now displayed.. ",
    "xurwxj": "if i change the mysql server from domain to ip, problem will go away.\ncan i use mysql server host with domain in config file?\nBTW, the domain of mysql server can successfully pinged from emqtt server.\n. i can ping the mysql domain from emqtt server, but emqtt startup fail. \n. seems no attach command.\nall emqttd_ctl command listed when execute  ./bin/emqttd attach\n. \n. ",
    "orctom": "not apply at all.\n. ",
    "atulgoswami21": "Thanks and waiting for release.\n. Issue still not resolved. around 10 percentage of message are dropping continuously.\nPlease look into this as i have only one client that is receiving all these messages. \n  . \n. Publishing clients are around 200, and there is one client that is receiving messages published on two topics. And it is receiving messages but around 10% drop message are accumulated in dashboard statistics.\n. Current Status.. \n. I can provide you the access to my droplet. If you want.\nTopics are /location and /application-events\nCPU is single core ram is 1gb. Basic 5$ droplet on digital ocean. \nMy subscriber checks every 15 minutes if connected. If not then connect and subscribe again. \n. ",
    "maituanmte": "@emqplus I see that, you have released \"EMQPlus\" already to store message to mysql. But I don't see that. Can you give me a url?.. ",
    "araxis": "ok!and how do i can build it from source on windows?\nthanks for your attention!\n. I am disappointed!!!!!!\n. ",
    "amazg": "i use emqtt_mysql\n. my config:\n%% select password only\n    {authquery, \"select password from mqtt_user where username = '%u' limit 1\"},\n```\n%% hash algorithm: plain, md5, sha, sha256, pbkdf2?\n{password_hash, sha256},\n%% select password with salt\n%% {authquery, \"select password, salt from mqtt_user where username = '%u'\"},\n%% sha256 with salt prefix\n%% {password_hash, {salt, sha256}},\n%% sha256 with salt suffix\n%% {password_hash, {sha256, salt}},\n%% comment this query, the acl will be disabled\n{aclquery, \"select allow, ipaddr, username, clientid, access, topic from mqtt_acl where ipaddr = '%a' or username = '%u' or username = '$all' or clientid = '%c'\"},\n%% If no rules matched, return...\n{acl_nomatch, deny}\n```\n. ",
    "MadDataScience": "@vowstar, I'm a little confused at how to add this. I'm trying it with https://github.com/emqtt/emq-relx/. I'm not sure where I should be running \ngit submodule add -f https://github.com/msdevanms/emqttd_plugin_kafka_bridge.git plugins/emqttd_plugin_kafka_bridge\n(Couple notes there: you need to update the README because the repo is now at msdevanms not vowstar. Also, I don't know if the fact that I had to use -f is an indication that I was in the wrong place, or if that is required when using emq-relx.)\nI tried doing it in both _rel/emqttd/ and in _rel/emqttd/etc/ (which is where I found the plugins folder) but when I tried \n./bin/emqttd_ctl plugins load emqttd_plugin_kafka_bridge\nin either case it said \n\nload plugin error: not_found\n\nDo you know what I'm doing wrong?\nThank you.. ",
    "hcrow110": "emqtt version is 0.14 \n[root@65 bin]# emqttd_ctl vm\ncpu/load1               : 0.03\ncpu/load5               : 0.05\ncpu/load15              : 0.02\nmemory/total            : 68320272\nmemory/processes        : 19678672\nmemory/processes_used   : 19678000\nmemory/system           : 48641600\nmemory/atom             : 512601\nmemory/atom_used        : 492479\nmemory/binary           : 428512\nmemory/code             : 13377655\nmemory/ets              : 1825144\nprocess/limit           : 262144\nprocess/count           : 2396\nio/max_fds              : 204800\nio/active_fds           : 1\n[root@65 bin]# ./emqttd_ctl listeners\nlistener on http:8083\n  acceptors       : 4\n  max_clients     : 64\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtts:8883\n  acceptors       : 4\n  max_clients     : 51200\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:1883\n  acceptors       : 1600\n  max_clients     : 819200\n  current_clients : 2\n  shutdown_count  : [{conflict,1},{destroy,1},{closed,530}]\nlistener on http:18083\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 3\n  shutdown_count  : []\n[root@65 bin]# emqttd_ctl broker metrics\nbytes/received          : 2131450\nbytes/sent              : 2075052\nmessages/dropped        : 3676\nmessages/qos0/received  : 4350\nmessages/qos0/sent      : 10327\nmessages/qos1/received  : 6011\nmessages/qos1/sent      : 0\nmessages/qos2/received  : 0\nmessages/qos2/sent      : 0\nmessages/received       : 10361\nmessages/retained       : 2\nmessages/sent           : 10327\npackets/connack         : 534\npackets/connect         : 534\npackets/disconnect      : 0\npackets/pingreq         : 37\npackets/pingresp        : 37\npackets/puback/received : 0\npackets/puback/sent     : 6011\npackets/pubcomp/received: 0\npackets/pubcomp/sent    : 0\npackets/publish/received: 10361\npackets/publish/sent    : 10327\npackets/pubrec/received : 0\npackets/pubrec/sent     : 0\npackets/pubrel/received : 0\npackets/pubrel/sent     : 0\npackets/received        : 11464\npackets/sent            : 17441\npackets/suback          : 532\npackets/subscribe       : 532\npackets/unsuback        : 0\npackets/unsubscribe     : 0\n[root@65 bin]# emqttd_ctl broker stats\nclients/count       : 2\nclients/max         : 332\nqueues/count        : 0\nqueues/max          : 0\nretained/count      : 2\nretained/max        : 2\nroutes/count        : 531\nroutes/reverse      : 531\nsessions/count      : 531\nsessions/max        : 531\nsubscriptions/count : 530\nsubscriptions/max   : 530\ntopics/count        : 583\ntopics/max          : 583\n[root@65 bin]# emqttd_ctl recon bin_leak\n{<10037.311.0>,-49,\n [{current_function,{emysql_recv,loop,1}},{initial_call,{proc_lib,init_p,5}}]}\n{<10037.313.0>,-47,\n [{current_function,{emysql_recv,loop,1}},{initial_call,{proc_lib,init_p,5}}]}\n{<10037.315.0>,-45,\n [{current_function,{emysql_recv,loop,1}},{initial_call,{proc_lib,init_p,5}}]}\n{<10037.142.0>,-41,\n [mnesia_locker,\n  {current_function,{mnesia_locker,loop,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.308.0>,-40,\n [{current_function,{emysql_recv,loop,1}},{initial_call,{proc_lib,init_p,5}}]}\n{<10037.307.0>,-38,\n [{current_function,{gen_server,loop,6}},{initial_call,{proc_lib,init_p,5}}]}\n{<10037.233.0>,-37,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.239.0>,-34,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.199.0>,-33,\n [emqttd_pubsub_10,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.234.0>,-33,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.201.0>,-32,\n [emqttd_pubsub_12,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.231.0>,-32,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.236.0>,-31,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.237.0>,-31,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.242.0>,-31,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.243.0>,-28,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.314.0>,-25,\n [{current_function,{gen_server,loop,6}},{initial_call,{proc_lib,init_p,5}}]}\n{<10037.190.0>,-24,\n [emqttd_pubsub_1,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.205.0>,-24,\n [emqttd_pubsub_16,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.230.0>,-24,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.238.0>,-24,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.228.0>,-23,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.202.0>,-22,\n [emqttd_pubsub_13,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.229.0>,-22,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.235.0>,-22,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.200.0>,-21,\n [emqttd_pubsub_11,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.241.0>,-21,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.240.0>,-20,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.250.0>,-20,\n [emqttd_sm_4,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.255.0>,-20,\n [emqttd_sm_9,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.198.0>,-19,\n [emqttd_pubsub_9,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.232.0>,-18,\n [{current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.203.0>,-17,\n [emqttd_pubsub_14,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.253.0>,-15,\n [emqttd_sm_7,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.195.0>,-13,\n [emqttd_pubsub_6,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.310.0>,-13,\n [{current_function,{gen_server,loop,6}},{initial_call,{proc_lib,init_p,5}}]}\n{<10037.312.0>,-12,\n [{current_function,{gen_server,loop,6}},{initial_call,{proc_lib,init_p,5}}]}\n{<10037.193.0>,-11,\n [emqttd_pubsub_4,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.248.0>,-10,\n [emqttd_sm_2,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.256.0>,-10,\n [emqttd_sm_10,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.191.0>,-9,\n [emqttd_pubsub_2,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.197.0>,-8,\n [emqttd_pubsub_8,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.204.0>,-8,\n [emqttd_pubsub_15,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.196.0>,-7,\n [emqttd_pubsub_7,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.192.0>,-5,\n [emqttd_pubsub_3,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.251.0>,-5,\n [emqttd_sm_5,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.257.0>,-5,\n [emqttd_sm_11,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.259.0>,-5,\n [emqttd_sm_13,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.260.0>,-5,\n [emqttd_sm_14,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.262.0>,-5,\n [emqttd_sm_16,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.263.0>,-5,\n [emqttd_session_sup,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.264.0>,-5,\n [emqttd_broker,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.194.0>,-4,\n [emqttd_pubsub_5,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.219.0>,-4,\n [emqttd_pooler_10,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.247.0>,-4,\n [emqttd_sm_1,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.254.0>,-4,\n [emqttd_sm_8,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.3.0>,-3,\n [erl_prim_loader,\n  {current_function,{erl_prim_loader,loop,3}},\n  {initial_call,{erlang,apply,2}}]}\n{<10037.30.0>,-3,\n [user_drv,\n  {current_function,{user_drv,server_loop,6}},\n  {initial_call,{user_drv,server,2}}]}\n{<10037.212.0>,-3,\n [emqttd_pooler_3,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.213.0>,-3,\n [emqttd_pooler_4,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.214.0>,-3,\n [emqttd_pooler_5,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.215.0>,-3,\n [emqttd_pooler_6,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.217.0>,-3,\n [emqttd_pooler_8,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.221.0>,-3,\n [emqttd_pooler_12,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.222.0>,-3,\n [emqttd_pooler_13,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.223.0>,-3,\n [emqttd_pooler_14,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.225.0>,-3,\n [emqttd_pooler_16,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.261.0>,-3,\n [emqttd_sm_15,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.12.0>,-2,\n [code_server,\n  {current_function,{code_server,loop,1}},\n  {initial_call,{erlang,apply,2}}]}\n{<10037.210.0>,-2,\n [emqttd_pooler_1,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.211.0>,-2,\n [emqttd_pooler_2,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.216.0>,-2,\n [emqttd_pooler_7,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.218.0>,-2,\n [emqttd_pooler_9,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.224.0>,-2,\n [emqttd_pooler_15,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.252.0>,-2,\n [emqttd_sm_6,\n  {current_function,{gen_server2,process_next_msg,1}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.6.0>,-1,\n [error_logger,\n  {current_function,{gen_event,fetch_msg,5}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.7.0>,-1,\n [application_controller,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{erlang,apply,2}}]}\n{<10037.31.0>,-1,\n [user,\n  {current_function,{group,server_loop,3}},\n  {initial_call,{group,server,3}}]}\n{<10037.33.0>,-1,\n [{current_function,{shell,get_command1,5}},{initial_call,{erlang,apply,2}}]}\n{<10037.42.0>,-1,\n [{current_function,{file_io_server,server_loop,1}},\n  {initial_call,{erlang,apply,2}}]}\n{<10037.98.0>,-1,\n [{current_function,{application_master,loop_it,4}},\n  {initial_call,{application_master,start_it,4}}]}\n{<10037.158.0>,-1,\n [{current_function,{disk_log,loop,1}},{initial_call,{proc_lib,init_p,5}}]}\n{<10037.220.0>,-1,\n [emqttd_pooler_11,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.271.0>,-1,\n [inet_gethost_native,\n  {current_function,{inet_gethost_native,main_loop,1}},\n  {initial_call,{inet_gethost_native,server_init,2}}]}\n{<10037.0.0>,0,\n [init,{current_function,{init,loop,1}},{initial_call,{otp_ring0,start,2}}]}\n{<10037.9.0>,0,\n [{current_function,{application_master,main_loop,2}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.10.0>,0,\n [{current_function,{application_master,loop_it,4}},\n  {initial_call,{application_master,start_it,4}}]}\n{<10037.11.0>,0,\n [kernel_sup,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.14.0>,0,\n [rex,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.15.0>,0,\n [global_name_server,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.16.0>,0,\n [{current_function,{global,loop_the_locker,1}},\n  {initial_call,{erlang,apply,2}}]}\n{<10037.17.0>,0,\n [{current_function,{global,loop_the_registrar,0}},\n  {initial_call,{erlang,apply,2}}]}\n{<10037.18.0>,0,\n [inet_db,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.19.0>,0,\n [net_sup,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.20.0>,0,\n [erl_epmd,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.21.0>,0,\n [auth,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.22.0>,0,\n [net_kernel,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n{<10037.23.0>,0,\n [{current_function,{prim_inet,accept0,2}},\n  {initial_call,{inet_tcp_dist,accept_loop,2}}]}\n{<10037.24.0>,0,\n [{current_function,{net_kernel,ticker_loop,2}},\n  {initial_call,{net_kernel,ticker,2}}]}\n{<10037.25.0>,0,\n [global_group,\n  {current_function,{gen_server,loop,6}},\n  {initial_call,{proc_lib,init_p,5}}]}\n. ",
    "leim": "\u62b1\u6b49\uff0c\u7531\u4e8e\u6211\u5728\u672c\u673a\u5df2\u7ecf\u8fd0\u884c\u4e00\u4e2a\u65e7\u7248\u672c\u7684\u5b9e\u4f8b\uff0c\u800c\u6211\u6ca1\u6709\u4fee\u6539vm.args\u4e2d\u7684name\uff0c\u6240\u4ee5\u5728\u6211\u542f\u52a8\u65b0\u5b9e\u4f8b\u7684\u65f6\u5019\uff0c\u7531\u4e8ename\u5b57\u6bb5\u76f8\u540c\uff0c\u6240\u4ee5\u63d0\u793aNode is already running\uff0c\u6211\u8bef\u4ee5\u4e3a\u65b0\u5b9e\u4f8b\u5df2\u7ecf\u542f\u52a8\uff0c\u6240\u4ee5list plugin\u7684\u65f6\u5019\u5c55\u793a\u7684\u5176\u5b9e\u662f\u65e7\u7248\u672c\u5b9e\u4f8b\u4e0b\u7684plugins\uff0c\u540e\u6765\u4fee\u6539\u8fc7vm.args\u4e2d\u7684name\u5b57\u6bb5\uff0c\u65b0\u5b9e\u4f8b\u5df2\u7ecf\u542f\u52a8\u6210\u529f\uff0c\u5e76\u4e14\u6240\u6709\u63d2\u4ef6\u52a0\u8f7d\u6210\u529f\uff0c\u62b1\u6b49\u7ed9\u5404\u4f4d\u6dfb\u9ebb\u70e6\u4e86\uff0c\u5b9e\u5728\u5bf9\u4e0d\u8d77\u3002\n. ",
    "pranavmehta": "Got it! Thanks!\n. Thanks a lot for the response, @emqplus. Your suggestion makes a lot of sense.\nCan you please make some recommendation regarding processing the messages before they are delivered to the recipient? Would you recommend having dedicated \"listener\" clients on the server that receive all messages from the mobile devices, processes them and puts its in the intended users inbox? With this approach I would be using emqttd for bi-directional messaging\nOr you you recommend a standard REST API that all users post messages to, which in turn does the processing and puts the message to the recipient's inbox? With this approach, I would be using emqttd purely to  push messages downstream from the server to the handsets.\nYour feedback is very much appreciated. Thanks a lot!\n. @pavankumarkatakam Sorry, I never got around to implement either this. Other priority took over. . @emqplus,  I too am intrigued about  the enterprise edition. \nWould be great if  you could share what are going to be the major feature differences, pricing/licensing model and the overall path going forward.\nThanks!\n. Thanks for sharing that information @emqplus \nOf course its important you have a commercial offering to even continue building great software like this project. Many open source projects have successfully done it - CouchBase, Redis, etc, etc. I'm sure you'll find various business models and takers for your commercial offering, so you can continue developing great software and also build a great community around it.\nThe message storage feature is really interesting. I hope its a plugin kind of model, so we can perhaps use any other data store. This could be especially helpful to store various states of each message such as acknowledged, etc. For example, in a chat app, these status could be useful to tell the sender that the message has been delivered to the recipient, etc. \nDo you have an ETA/roadmap when you expect version 2?\n. emqttd is meant to be used on the server. You can use one of the many open source MQTT clients on your android app to connect to the server and exchange messages.\n. ",
    "ajagnanan": "Is there a \"current user\" variable maybe? An object that gets associated with the client id and is available throughout all events. It could be managed by emqtt and passed in as an arg for hooks.\n. Is it possible to get the username in the subscribe / publish hooks?\n. ",
    "yandooo": "@emqplus would you mind to suggest how to hook in properly into emqttd if there is need to pass custom authentication token between auth plugin and ACL plugin? The idea is to have auth plugin which checks() by user\\pwd if client has access and needs to store some security information that will be analyzed by custom ACL plugin later.\nThis method returns record of type #mqqt_client which has all fields reserved for emqttd broker:\nemqttd_cm:lookup(ClientId)\nis there any way on how to carry state for clientId without rebuilding\\modifying emqttd? On more thing here is that in auth plugin seems like there is no way to update client record (lets say update Username field to store some state) in ets because it was not persistent yet.\nThanks!\n. To answer my question above. No way to carry state. For this purpose use shared EST table.\n. Perhaps any other information required to progress here?\nCurrently production env is screwed due to above OOM.. I'm closing this defect because we decided to switch over to the newer version of EMQ. @emqplus not a problem. I know you're busy :) Is there any way how to limit accumulated memory storage - I presume it's ETS table?\nThank you for such a good project.. @emqplus thanks!. ",
    "Son-Lam": "Hello,\nWould you mind update the timeline of this feature.\nBest Regards,. ",
    "yudingling": "i change the  superuser method like:\nresponse.setStatus(HttpServletResponse.SC_UNAUTHORIZED)   ---- 401\nbut still get a 400 error in  emqttd_error.log:\n        username 'xxx' login failed for {http_code, 400}\nalso never call the  auth_req api\n@emqplus  what's the reason     thanks..\n. damn it,  i'm blind, the parameter name of authenticate,  not \"pwd\" but \"password\"....\n. ",
    "billysz": "Hi @emqplus ,thanks for reply, it does make sense to cache the ACL rules, but is it possible to provide an API to force reloading ACL for particular clients?\nOne more question, does the Redis plugin use cache? \n. Thanks for the comment, after adding the handshake_timeout, the frequency of the error reporting is now much lower than before, reduced to around 1/7 for a rough estimation.\nBut still the problem exists, I think there might be some clients are connecting to the 8883 ports but don't have the valid certification, I'd like to check their IP address and check if those are illegal visitors. Could the logger record the peer IPs when ssl timeout?\n. ",
    "CrazyPandar": "Suggest to provide an API to force reloading ACL for particular clients and particular topic .\n. ",
    "msdevanms": "I am also facing this.\n15:00:43.265 <0.26577.10> [error] Session(client23): Cannot find PUBREL: 19749\n. I just wondered by viewing this issue. It is supposed to be a feature of clustered emqtt, is n't it ?\nIs it something we can achieve using some configuration changes ?\n. ",
    "BobXuu": "I also encountered this problem... ",
    "hang321": "I have this problem on 2.2 release\n2017-08-15 04:13:21.430 [warning] <0.1346.0>@emqttd_session:handle_cast:458 Session(17...44): Cannot find PUBREL: 183. ",
    "cjy37": "+1 please open!\nemqtt_emqtt-lb_1 | 2017-11-30T02:27:28.564132026Z 02:27:28.560 [error] SM(zg-2-10017446-34B493MF): Conflict with <35457.10528.540>\nemqtt_emqtt-lb_1 | 2017-11-30T02:27:30.540146091Z 02:27:30.536 [error] SM(zg-2-10017446-34B493MF): Conflict with <35457.8505.540>\nemqtt_emqtt-lb_1 | 2017-11-30T02:27:32.551577492Z 02:27:32.547 [error] SM(zg-2-10017446-34B493MF): Conflict with <35454.17449.168>\nemqtt_emqtt-lb_1 | 2017-11-30T02:27:34.595087930Z 02:27:34.579 [error] SM(zg-2-10017446-34B493MF): Conflict with <35454.17727.168>\nemqtt_emqtt-lb_1 | 2017-11-30T02:27:37.127072484Z 02:27:37.123 [error] SM(zg-3-10036537-21D713P): Conflict with <35453.12721.198>\nemqtt_emqtt-lb_1 | 2017-11-30T02:27:46.714633060Z 02:27:46.709 [error] SM(zg-2-10017446-34B493MF): Conflict with <35453.12996.198>\nemqtt_emqtt-lb_1 | 2017-11-30T02:27:47.729942930Z 02:27:47.724 [error] SM(zg-2-10017446-34B493MF): Conflict with <35455.29069.336>\nemqtt_emqtt-lb_1 | 2017-11-30T02:27:51.431870042Z 02:27:51.428 [error] SM(zg-2-10017446-34B493MF): Conflict with <35454.18052.168>\nemqtt_emqtt-lb_1 | 2017-11-30T02:27:53.874650625Z 02:27:53.871 [error] SM(zg-2-10017446-34B493MF): Conflict with <35456.662.241>\nemqtt_emqtt-lb_1 | 2017-11-30T02:27:56.250512299Z 02:27:56.246 [error] SM(zg-3-10036537-21D713P): Conflict with <35455.29436.336>\nemqtt_emqtt-lb_1 | 2017-11-30T02:27:57.255402794Z 02:27:57.250 [error] SM(zg-3-10036537-21D713P): Conflict with <35456.22780.240>\nemqtt_emqtt-lb_1 | 2017-11-30T02:28:04.929530528Z 02:28:04.923 [error] SM(zg-2-10017446-34B493MF): Conflict with <35455.2726.337>\nemqtt_emqtt-lb_1 | 2017-11-30T02:28:10.606898738Z 02:28:10.602 [error] SM(zg-2-10017446-34B493MF): Conflict with <35456.25762.240>\nemqtt_emqtt-lb_1 | 2017-11-30T02:28:17.635357222Z 02:28:17.629 [error] SM(zg-2-10017446-34B493MF): Conflict with <35456.23144.240>\nemqtt_emqtt-lb_1 | 2017-11-30T02:28:19.660097660Z 02:28:19.656 [error] SM(zg-3-10036537-21D713P): Conflict with <35457.13636.540>\nemqtt_emqtt-lb_1 | 2017-11-30T02:28:22.796140499Z 02:28:22.792 [error] SM(zg-2-10017446-34B493MF): Conflict with <35455.1833.337>\nemqtt_emqtt-lb_1 | 2017-11-30T02:28:26.300785341Z 02:28:26.296 [error] SM(zg-2-10017446-34B493MF): Conflict with <35457.14523.540>\nemqtt_emqtt-lb_1 | 2017-11-30T02:28:26.612191100Z 02:28:26.608 [error] SM(zg-2-10017446-34B493MF): Conflict with <35454.19328.168>\nemqtt_emqtt-lb_1 | 2017-11-30T02:28:30.667062739Z 02:28:30.663 [error] SM(zg-2-10017446-34B493MF): Conflict with <35457.15005.540>\nemqtt_emqtt-lb_1 | 2017-11-30T02:29:12.504929646Z 02:29:12.499 [error] SM(zg-3-10036537-21D713P): Conflict with <35457.16736.540>\nemqtt_emqtt-lb_1 | 2017-11-30T02:29:22.901333146Z 02:29:22.890 [error] SM(zg-3-10036537-21D713P): Conflict with <35454.19986.168>\nemqtt_emqtt-lb_1 | 2017-11-30T02:29:47.145782502Z 02:29:47.140 [error] SM(zg-2-10018228-D651E7F): Conflict with <35457.17598.540>\nemqtt_emqtt-lb_1 | 2017-11-30T02:29:50.651015460Z 02:29:50.646 [error] SM(zg-3-10036537-21D713P): Conflict with <35453.13830.198>\nemqtt_emqtt-lb_1 | 2017-11-30T02:30:22.888830072Z 02:30:22.885 [error] SM(zg-3-10036537-21D713P): Conflict with <35457.18547.540>\nemqtt_emqtt-lb_1 | 2017-11-30T02:30:24.925583694Z 02:30:24.921 [error] SM(zg-3-10036537-21D713P): Conflict with <35456.2808.241>\nemqtt_emqtt-lb_1 | 2017-11-30T02:30:29.714008490Z 02:30:29.710 [error] SM(zg-2-10018822-340509UA): Conflict with <35453.13686.198>\nemqtt_emqtt-lb_1 | 2017-11-30T02:31:41.620651628Z 02:31:41.617 [error] SM(zg-3-10002114-34DB996S): Conflict with <35453.15311.198>\nemqtt_emqtt-lb_1 | 2017-11-30T02:37:09.794649201Z 02:37:09.788 [error] SM(zg-3-10085963-23AA6FDU): Conflict with <35455.9579.337>\nemqtt_emqtt-lb_1 | 2017-11-30T02:40:18.182556014Z 02:40:18.177 [error] SM(zg-2-10051520-34021FWS): Conflict with <35456.31911.240>. This issue is very important! Docker container ip maybe change on restart.. ",
    "pavankumarkatakam": "Hi @pranavmehta, have you tried the both approaches and can you share me the advantages and disadvantages of both.. @pranavmehta, I choose first way since HTTP API add overhead . @PiedPieper, You need to use some storage like Mysql and use Mysql acl plugin for emqttd.. Hi @truonglx-56, have you completed writing the plugin?. Is my question wrong?. Below is the data received when I subscribed to presence topic.\nPacket {\n     cmd: 'publish',\n     retain: false,\n     qos: 0,\n     dup: false,\n     length: 20,\n     topic: 'presence',\n     payload: <Buffer 48 65 6c 6c 6f 20 6d 71 74 74> } }\nThere is no information abou the who(clientID or username) published that message\n. I came to know that MQTT Spec doesn't have the from details, either we need to keep from details in the payload or create topic such that it has the from details\nIm going with adding the from details to payload\nwhat is the better way to put from details in the payload\n1. at client side\n2. at broker side\nit is highly recommended and secure to keep at broker side if possible.. @emqplus, can you please guide me how to achieve this using the custom plugins. I think I need to hook into message.publish and change the payload right?\nusing the emq_plugin_template i see logs\npublish Message(Q2, R0, D0, MsgId=<<0,5,83,145,105,108,21,132,112,5,0,0,14,22,0,1>>, PktId=61683, From=pavankumar/mqttjs_26a223e2, Topic=presence)\nthere is actually from info but it is not getting in the clinet side how to do so\nor we need to hack the code such that already \"from\" needs to be exposed in the file include/emqttd.hrl. ",
    "hongj-sh": "Just FYI, we are using LVS/DR + KeepAlived as LB of a 3-node emqtt cluster, works flawlessly.\n. First, create a emqtt cluster  as usual (pls refer the emqtt document). \nThen we should set up a LVS server as LB, here's how to do it.\nSome assumptions:\nOS = Ubuntu Server 14.04\nVIP=192.168.0.10 (virtual ip which your mqtt clients connect to)\nLVS server IP = 192.168.0.100\nEMQTT server1 IP =192.168.0.101\nEMQTT server2 IP =192.168.0.102\nEMQTT server2 IP =192.168.0.103\nEMQTT port\uff1a1883\n1. Install ipvsadm on LVS server and config it like below\n   apt-get install ipvsadm\n   ipvsadm -A -t 192.168.0.10:1883 -s rr   #rr = round robin\n   ipvsadm -a -t 192.168.0.10:1883 -r 192.168.0.101:1883 -g    #-g means DR mode\n   ipvsadm -a -t 192.168.0.10:1883 -r 192.168.0.102:1883 -g\n   ipvsadm -a -t 192.168.0.10:1883 -r 192.168.0.103:1883 -g\n2. Config VIP and IP forwarding on LVS server\n   ifconfig lo:10 192.168.0.10 netmask 255.255.255.255 broadcast 192.168.0.10 up\n   echo  'net.ipv4.ip_forward=1'  >> /etc/sysctl.conf\n   sysctl -p\n3. Config VIP and arp on each EMQTT server like below\n   ifconfig lo:10 192.160.0.10 netmask 255.255.255.255 broadcast 192.168.0.10 up\n   route add -host 192.160.0.10 dev lo:10\n   echo \"1\" > /proc/sys/net/ipv4/conf/lo/arp_ignore\n   echo \"2\" > /proc/sys/net/ipv4/conf/lo/arp_announce\n   echo \"1\" > /proc/sys/net/ipv4/conf/all/arp_ignore\n   echo \"2\" > /proc/sys/net/ipv4/conf/all/arp_announce\nThat's all. The mqtt client connects to 192.168.0.10 will be forwarded to 192.168.0.101-103 using round robin algorithm.\nBut, the above solution still lack of health check and the LVS server is a SPOF.\nSo we should setup another LVS server as standby, and use KeepAlived for health check and HA of LVS server. Pls google for how to install and config KeepAlived.\n. ",
    "LeeWong": "Any update on this? . ",
    "Sephiroth-Wang": "Hi there, \nI also have this issue about \"Share Subscription\", not only HiveMQ has this feature, but VerneMQ.\nThey called \"Consumer Session Balancing\", but cannot apply in cluster mode.\nhttps://vernemq.com/docs/configuration/balancing.html\nI hope this feature be implemented in eMQTT and support cluster.\n. Hi emqplus, \nI'm so excited, the 2.0 released, but the \"Share Subscription\" feature seem not in this version?\n. ",
    "liszhu": "Hi emqplus,\nThanks for your reply.\nAs enterprise edition was mentioned in the previous post,  does which mean that there are two or more editions of emqtt, e.g. community edition with limited function and enterprise edition with full function but charging is required ?   I am confused because I understood that emqtt is full open sourced.\nBr,\nLee\n. @emqplus Thanks for your clarification and looking forward to the reveal of 2.x release.\n. ",
    "Zong-Li": "Hi emqplus,\nI'm confused about the enterprise edition too.\nWill the 'shared subscription' function is open source or for free with binary in the future?\n. ",
    "tiefschneeteufel": "I already changed max_packet_size and it made no difference. I tried making max_packet_size very small and published some messages using a command-line client (i.e. using TCP not WebSockets) and got errors that showed up in the emqttd console. Making max_packet_size very large did not make my WebSocket problem go away.\nI believe that there is a problem with the WebSockets support which means that messages with large payloads do not reach the code responsible for implementing broker behaviour, hence changing max_packet_size has no effect in this case.\n. Perhaps changing sockopts would make a difference?\n. 65224 bytes is the special payload size that triggers the WebSocket problem.\n```\n\n\nemqttd websocket test\n\nSubmit\n\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js\" type=\"text/javascript\"></script>\n<script>\n    var length = document.getElementById(\"length\");    \n    var button = document.getElementById(\"button\");\n    var client;\n    button.addEventListener(\"click\", function() {\n        var l = Number(length.value);\n        document.getElementById(\"status\").innerHTML = \"In flight\";\n        var payload = new Uint8Array(l);            \n        var message = new Paho.MQTT.Message(payload);\n        message.destinationName = \"/World\";\n        client = new Paho.MQTT.Client(\"127.0.0.1\", Number(8083), \"/mqtt\", 'client-' + Math.random().toString(36).slice(-6));\n        client.trace = function(msg) {\n            if (msg.message === '\"Client._disconnected\"8\"AMQJS0008I Socket closed.\"') {\n                document.getElementById(\"status\").innerHTML = \"FAILED :(\";\n            }\n            console.log(\"trace = \", msg.message);            \n        };\n        client.onMessageDelivered = function() {\n            document.getElementById(\"status\").innerHTML = \"Delivered\";\n        }\n        client.connect({\n            onSuccess: function () {\n                client.send(message);\n            }\n        });\n    });\n\n</script>\n\n\n\n```\n\n\n. ",
    "farhadi": "\nThe SUBSCRIBE is asynchronous by default.\n\nExactly, I'm saying the same thing. I expect to receive SUBACK when the asynchronous task of SUBSCRIBE is done not just when it reaches the server. Am I wrong?\nBesides, protocol says: \n\nA SUBACK Packet is sent by the Server to the Client to confirm receipt and processing of a \nSUBSCRIBE Packet.\n\nI suppose it means a SUBACK is sent when processing is done.\n. ",
    "krvarma": "Thank you @emqplus for your suggestion and really sorry for the late reply. I was engaged in a personal matter these days and didn't get time to check the reply.\nIn another thread I read in 2.x it is planned to support message store in MongoDB, Reds, etc... and also MQTT Streaming to Kafka. Does the message store in Redis supports PUBLISH also?\n. ",
    "freecnpro": "If I understand correctly, you need this: https://github.com/emqtt/emqttd/blob/master/include/emqttd.hrl#L119\nAnd you can hook connect and disconnect to judge client online status, or emqttd_sm:lookup_session to judge if clean_session is true.\n. https://github.com/emqtt/emqttd/blob/master/src/emqttd_server.erl#L101\nemqttd will call emqttd:run_hooks('message.publish', [], Msg) before publish to client session\n. If you prefer, you can add your own hook in https://github.com/emqtt/emqttd/blob/master/src/emqttd_pubsub.erl#L121\n. It seem ets:new/2 failed, maybe restart it would resolved. \n. you can check(ex: observer) mqtt_access_control table if exist when appear the error\n. observer can connect to remote node\n. @GIHOLee Did you have received a disk_almost_full warning?\n. ",
    "jayareddyd": "Hi, Any progress on adding hook before publish so that push notifications can be sent to registered subscribers, please advice @emqplus . Thanks! Now it's connected by exporting 8083 port. ",
    "vishr": "docker run -t 550a12b81384 started it.\n. Is this the implementation https://github.com/emqtt/emq-web-hook?. I have a raised a PR https://github.com/emqtt/emq-web-hook/pull/1, please have a look.. ",
    "tiggerlee2": "Hi @emqplus ,\nHow can I use the official docker image in k8s? \nspec:\n      containers:\n      - name: emqttd\n        image:  ? <- Push the official docker image to my own docker repository?. ",
    "yaoguais": "OK, when I restart the server, it change to a new port\ntcp        0      0 0.0.0.0:52233               0.0.0.0:*                   LISTEN      10060/beam.smp      off (0.00/0/0)\nIt could be a feature \ud83d\ude0a\n. is this ?\nhttp://emqtt.com/docs/cluster.html#cluster-firewall\n. ",
    "GIHOLee": "@freecnpro Thank you very much!But, it is only after running for a period of time appear the error, and the more frequently these days.\n. @freecnpro tks! emqttd running in the background on the centos, the process was killed when appear the error. but I change machine to running, it didn't appear this problem, unfortunately, I didn't find the cause of the problem.\n. @freecnpro I have been used the observer app, waiting for it to appear the error.\n\n\n. @emqplus  1.0.2 and 1.1.3, until use 1.0.2, but nearly time appeared the problem, then upgrade to 1.1.3.\n. @emqplus,  Thank you! Did't load any other modules or plugins. At present, I have deployed emqttd on other servers, have not yet found the problem, I am not sure whether the client's problem.\n. @freecnpro , no warning.\ndf -h :\n/dev/mapper/centos-root     50G  9.2G   41G   19% /\ndevtmpfs                               32G     0   32G    0% /dev\ntmpfs                                     32G  176K   32G    1% /dev/shm\ntmpfs                                     32G   58M   32G    1% /run\ntmpfs                                     32G     0   32G    0% /sys/fs/cgroup\n/dev/mapper/centos-home  130G   38M  130G    1% /home\n/dev/sda1                              497M  206M  292M   42% /boot\ntmpfs                                     6.3G   12K  6.3G    1% /run/user/0\ntmpfs                                     6.3G   16K  6.3G    1% /run/user/42\n. ",
    "TriAnMan": "@dgtony \nI think this can brake a BC: consider you have a topic with \"?\" as a level e.g. \"a/?\".\nTo circumvent this situation we can use a combination of \"+\" and another sign for example \"!+\" (everything except plus). This will not brake a BC because a plus sign can only appear together with a \"/\" sign, except you have no topic tree at all (this case can also be handled).. ",
    "josephduchesne": "The HTTP API can tell you this through /api/sessions or /api/clients.\nAlternatively, you could publish a static topic to MQTT for example /users/USER_NAME/online true, when the client comes online, and false as part of the last will and testament set while connecting (see details here). This would mean that to get a real time view of connectivity you could subscribe to /users/*/online and be notified of the current status and any state changes in real time.\n. ",
    "danielrhodes": "@emqplus Thanks Feng! Is that the file I should be looking at? I might as well give it a shot, and if it's any good I'll make a PR.\n. ",
    "ioeverything": "Generally, you recommend to use different os types or same e.g ubuntu centos and...?\n. ",
    "luka1983": "@emqplus, thank you for your support. This is the output I get when I start with console argument\n```\n[Exec: /opt/emqttd/erts-7.3/bin/erlexec -boot /opt/emqttd/releases/0.17.1/emqttd             -embedded -config /opt/emqttd/etc/emqttd.config             -pa ./lib/basho-patches             -mnesia dir \"/opt/emqttd/data/mnesia/emqttd@mynode1\"             -args_file /opt/emqttd/etc/vm.args -- console\nRoot: /opt/emqttd\nErlang/OTP 18 [erts-7.3] [source] [64-bit] [smp:2:2] [async-threads:48] [kernel-poll:true]\nstarting emqttd on node 'emqttd@mynode1'']\n```\nAnd it just hangs there for ~5 min and then it displays the following.\nemqttd ctl is starting...[done]\nemqttd hook is starting...[done]\nemqttd pubsub is starting...[done]\nemqttd stats is starting...[done]\nemqttd metrics is starting...[done]\nemqttd retainer is starting...[done]\nemqttd pooler is starting...[done]\nemqttd trace is starting...[done]\nemqttd client manager is starting...[done]\nemqttd session manager is starting...[done]\nemqttd session supervisor is starting...[done]\nemqttd broker is starting...[done]\nemqttd alarm is starting...[done]\nemqttd mod supervisor is starting...[done]\nemqttd bridge supervisor is starting...[done]\nemqttd access control is starting...[done]\nemqttd system monitor is starting...[done]\nhttp listen on 0.0.0.0:18083 with 4 acceptors.\nmqtt listen on 0.0.0.0:1883 with 16 acceptors.\nmqtts listen on 0.0.0.0:8883 with 4 acceptors.\nhttp listen on 0.0.0.0:8083 with 4 acceptors.\nErlang MQTT Broker 0.17.1 is running now\nEshell V7.3  (abort with ^G)\n(emqttd@mynode1)1> \n=ERROR REPORT==== 2-Sep-2016::09:40:08 ===\n** Generic server <0.313.0> terminating \n** Last message in was {inet_async,#Port<0.6973>,33,\n                           {ok,<<16,48,0,4,77,81,84,84,4,2,0,60,0,36,55,102,\n                                 54,54,54,51,51,50,45,48,51,57,99,45,52,97,\n                                 51,54,45,56,48,56,48,45,51,49,102,56,49,54,\n                                 53,101,54,53,49,97>>}}\n** When Server state == {client_state,\n                            {esockd_connection,\n                                [#Port<0.6973>,\n                                 #Fun<esockd_transport.2.94509882>,[]]},\n                            [\"192.168.1.71\",58,\"36812\"],\n                            {{192,168,1,71},36812},\n                            {192,168,1,71},\n                            36812,true,running,undefined,\n                            #Fun<emqttd_parser.0.57393061>,\n                            {proto_state,\n                                {{192,168,1,71},36812},\n                                #Fun<emqttd_client.0.81835893>,false,\n                                undefined,<0.313.0>,undefined,undefined,\n                                undefined,undefined,undefined,undefined,512,\n                                undefined,undefined,undefined},\n                            [{max_clientid_len,512},{max_packet_size,65536}],\n                            undefined}\n** Reason for termination == \n** {{aborted,{no_exists,[backend_subscription,\n                         <<\"7f666332-039c-4a36-8080-31f8165e651a\">>]}},\n    [{mnesia,abort,1,[{file,\"mnesia.erl\"},{line,313}]},\n     {emqttd_mod_subscription,with_backend,3,\n                              [{file,\"src/emqttd_mod_subscription.erl\"},\n                               {line,52}]},\n     {emqttd_mod_subscription,on_client_connected,3,\n                              [{file,\"src/emqttd_mod_subscription.erl\"},\n                               {line,41}]},\n     {emqttd_hook,run_,3,[{file,\"src/emqttd_hook.erl\"},{line,72}]},\n     {emqttd_protocol,process,2,[{file,\"src/emqttd_protocol.erl\"},{line,168}]},\n     {emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,247}]},\n     {gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,615}]},\n     {gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,681}]}]}\n. Your suggestion fixed the current installation, and I was able to start broker correctly. What bothers me is that in my application I'll have two node cluster running on two remote machines and any manual intervention is very inconvenient. System should be able to recover by itself on single machine failure caused by power outage for example. The way I plan to workaround this issue for now is to remove mnesia dir by adding remove command to my emattd init script. Or do you maybe have a better way to suggest? Thanks!\n. ",
    "ejzhang": "Why didn't support windows in version 2.0.x?. ",
    "jrupani": "@emqplus @huangdan Hi, I am using the broker on our production server and need to monitor the number of messages in user queues. It is quite urgent and I would appreciate if you could help me out.\n. ",
    "srijanmishra": "@rock59 I second you on this one. I used both for an Android application and emqtt performed far better than RabbitMQ (around 1.5 times more connections). BTW can you please share the machine configuration you used to reach 300K client connections?\n. @rock59 I meant the processor details, RAM, storage and other such specifications \ud83d\ude04 \n. @rock59 No problem I was just curious. Thanks!!\n. ",
    "dergraf": "@rock59, @drasko VerneMQ developer here, the issues with the high CPU usage with idling connections is gone since 0.13.1. With proper OS and broker configuration, given enough CPU and RAM, 300K connections on a single node isn't a problem.\n. ",
    "jhaoheng": "Hi @huangdan \nThanks.\nI still don't know how to assign it\nI know the structure of 'lager'\nBut how to get 'login info' tag to help me save it to 'xxx.log' \n. @huangdan Thanks this info.\nI try this method, but it still no show ssl/tls info.\nformatter_config arguments is i needed. I dont find any info.args on docs.\nThanks\n. I created a new one for EMQ 2.0\nThanks. ",
    "happyyst": "in this issue https://github.com/emqtt/emqttd/issues/578, the author said, %c and %u is allowed, where is the issue point? \n@turtleDeng  @emqplus \n. ",
    "Venorcis": "Hey @emqplus, I did not notice this file moved from the etc folder, so my puppet installation overlooked this. Still weird no errors were generated at all whilst obviously the start-up did not complete successfully.\n. ",
    "steffenix": "This is working for version 1, I have tried with version 2 and it require few changes.\n- The config naming of the plugins changed.\n- Openssl is needed.\n  After fixing the changes I have tried to start with my custom mysql config and it keep failing.\n  Would be great to have a release for debian/ubuntu with the RC version.\n. Did a v2 compatible version: https://github.com/steffenix/emqttd2-docker\n. But you are still using stable (version 1) and not latest (version 2).\nThe plugins loading is better yeah. Have you looked at what I have done with the v2? Their is few changes on the naming and folder organizations.\n. I hope we can have a release with the RC one the beta is getting old.\n. ",
    "mijicd": "We've updated the Mainflux EMQTT Docker. The following changes have been applied:\n- \"stable\" version replaced with \"latest\"\n- improved plugins loading\n- installed missing OpenSSL dependency, as suggested by @steffenix \n- running the broker as an unprivileged user using gosu\n- exposed emqttd and emqttd_cli commands through the image entrypoint\n. @klausenbusk It was my personal preference to go with volume-based configuration. I will, however work on the changes you proposed during the upcoming weekend.\n. @klausenbusk Unfortunately I haven't been able to take a look at the setup. I tested the proof of concept gist you provided, and it looks good to me. If you want, feel free to submit a PR covering this functionality :). ",
    "klausenbusk": "\nSome alternatives I see:\n- Docker ENV variables\n\nThat could be very useful, it is way easier to set a ENV variable than managing a config file across multiple servers (at least with my setup (CoreOS)).\nSetting plugins to load should be pretty simple to implement as a ENV variable, something like:\ntr ',' '\\n' <<< \"${EMQ_PLUGINS}\" > plugins.load\nThen you could set it like: EMQ_PLUGINS=\"emq_auth_http,emq_auth_mysql\".\nThen we just need a way to configure plugins through ENV variables, something like could work (properly not working, but you hopefully get the idea..):\n```\nwhile read -r foo; do\n    KEY=\"$(echo $foo | cut -f1 -d = | tr '[:upper:]' '[:lower:]')\"\n    PLUGIN=\"$(echo $KEY | rev | cut -f2- -d _ | rev)\"\n    OPTION=\"$(echo $KEY | cut -f2- -d _ | tr '_' '.')\"\n    VALUE=\"$(echo $foo | cut -f2 -d =)\"\necho \"${OPTION} = ${VALUE}\" >> \"${PLUGIN}.conf\"\n\ndone < <(printenv | grep EMQ_)\n```\nShould allowing setting auth.mysql.server = 127.0.0.1:3306 like EMQ_AUTH_MYSQL_SERVER=127.0.0.1:3306.\n. Proof of concept bash code: https://gist.github.com/klausenbusk/fd7e658e2c6baffa97d764258b0a9f33\nThat code generate a config file named emq_auth_mysql.conf with the following content:\nauth.mysql.acl_query = select foo from bar\nauth.mysql.server = 127.0.0.1:3306\n@drasko @mijicd is this something which could be added to Mainflux EMQTT docker image?\n. @mijicd Did you get time to look on this? :)\n. I have opened a PR with env variable configuration support https://github.com/mainflux/emqttd-docker/pull/14 , + a few fixes... ",
    "sgdba": "@huangdan \nOk, it works. Thanks\n. ",
    "N-NSH": "I have faced this problem, i will appreciate who can help us on this issue.\nwith regards \n. ",
    "domimuller": "I'm facing the same problem: emqttd starts in console mode, but not as a Windows service, neither from \"services.msc\" nor by calling \"bin\\emqttd start\".\nIn the System Event Log, I can see the following message, which could be helpful for the knowledgeful specialist: \"emqttd_2.0: Not enough parameters for erlang service.\"\nKind regards\n. ",
    "seymour-bootay": "Has there been any progress on this issue or a work around?  . ",
    "thechamp": "That works. Thanks\n. Yeah. My rebar was broken, reinstalling fixed the issue.. ",
    "fubax": "dear friends please help me to get rid of this error:\nCrash dump was written to: erl_crash.dump\ninit terminating in do_boot ()\nmake[1]: Entering directory '/home/pi/emqttd/deps/gproc'\nmake[1]: *** No targets. Stop.\nmake[1]: Leaving directory '/home/pi/emqttd/deps/gproc'\nerlang.mk:310: recipe for target 'deps' failed\nmake: *** [deps] Error 2\n. ",
    "elisiariocouto": "I found a workaround for this. This is my systemd unit:\n```\n[Unit]\nDescription=EMQ Broker\nAfter=syslog.target\nAfter=network.target\n[Service]\nType=forking\nTimeoutSec=60\nRestart=always\nRestartSec=10\nEnvironment=HOME=/root\nExecStart=/opt/emqttd/bin/emqttd start\nExecStop=/opt/emqttd/bin/emqttd stop\n```\nAlso, you need to modify the emqttd script inside your bin/ folder. Note that I'm on version 1.1.2. On line 246, I've added some flags, resulting in this line:\n-args_file $RUNNER_ETC_DIR/vm.args -detached -noinput -noshell -- ${1+\"$@\"}\".\nI think this issue is related to ./emqttd console being an interactive session, breaking systemd's ability to check the error codes.\n@emqplus, this project needs to have a proper systemd unit-file.\n. ",
    "reejinbouk": "I use this version (change some lines from manual):\nexport HOME=/root\nstart() {\n    echo \"starting emqttd...\"\n    /opt/emqttd/bin/emqttd start\n}\nstop() {\n    echo \"stopping emqttd...\"\n    /opt/emqttd/bin/emqttd stop\n. I got same trouble.. got this at logs:\n09:46:52.907 [error] Supervisor 'esockd_connection_sup - <0.1395.0>' had child connection started with mochiweb_http:start_link({emqttd_ws,handle_request,[]}) at <0.1417.0> exit with reason {ssl_error,{options,{cacertfile,[]}}} in esockd_connection:upgrade/1 line 131 in context connection_crashed\n09:46:52.909 [error] Error in process <0.1417.0> on node 'emq@127.0.0.1' with exit value:\n{{ssl_error,{options,{cacertfile,[]}}},[{esockd_connection,upgrade,1,[{file,\"src/esockd_connection.erl\"},{line,131}]},{mochiweb_http,init,2,[{file,\"src/mochiweb_http.erl\"},{line,48}]}]}. ",
    "marriotb": "I have a emqttd.service file that works for me with emqttd 2.0.5 on Ubuntu 16.04\nAs did the OP, I copied the emqttd directory to /opt. I also created a user/group pair called emqttd (without shell access).\nMy emqttd.service file ('/usr/lib/systemd/system/emqttd.service') is:\n```\n[Unit]\nDescription=emqttd - Erlang MQTT broker\nDocumentation=http://emqtt.io/docs/v2/\nWants=network-online.target\nAfter=network-online.target\n[Service]\nemqttd can't be tracked with a single PID as it starts a number of sub-processes\nso we treat it as a one-shot, per example 3 in https://www.freedesktop.org/software/systemd/man/systemd.service.html\nsystemd doesn't recognise a primary process (so there can be no auto-restart after failure)\nand the ExecStart and ExecStop directives refer to brief program runs that manage the sub-processes\nType=oneshot\nRemainAfterExit=yes\nEnvironmentFile=-/etc/default/emqttd # the prefix hyphen means that this is an optional file\nUser=emqttd\nGroup=emqttd\nWorkingDirectory=/opt/emqttd\nExecStart=/opt/emqttd/bin/emqttd start\nExecStop=/opt/emqttd/bin/emqttd stop\n[Install]\nWantedBy=multi-user.target\n```\nymmv\nNote that if #829 results in a visible PID file, the above could be changed to Type=forking with the PID file identified via a PIDfile=xxx directive. that would enable auto restart and similar features.\nBrian. This may be the same issue as #842\nTry removing the directory: /tmp/erl_pipes/ and all subdirectories (or changing the owner to the user that you want emqttd to run under)\nBrian. ",
    "phuongnc": "I update erlang and compile ok. But when i compiled brocker is running, everything seem be ok but no port 1883 watting for the connection so client can not connect to brocker\nI check by terminal \"netstat -ntpl\". \n. ## No port 1883 is waitting connection :(\nstarting emqttd on node 'emqtt@127.0.0.1'\nemqttd ctl is starting...[ok]\nemqttd hook is starting...[ok]\nemqttd router is starting...[ok]\nemqttd pubsub is starting...[ok]\nemqttd stats is starting...[ok]\nemqttd metrics is starting...[ok]\nemqttd pooler is starting...[ok]\nemqttd trace is starting...[ok]\nemqttd client manager is starting...[ok]\nemqttd session manager is starting...[ok]\nemqttd session supervisor is starting...[ok]\nemqttd wsclient supervisor is starting...[ok]\nemqttd broker is starting...[ok]\nemqttd alarm is starting...[ok]\nemqttd mod supervisor is starting...[ok]\nemqttd bridge supervisor is starting...[ok]\nemqttd access control is starting...[ok]\nemqttd system monitor is starting...[ok]\nErlang MQTT Broker 2.0 is running now\n{ok,[gproc,gen_logger,esockd,xmerl,compiler,syntax_tools,\n     mochiweb,gen_conf,emqttd]}\n. ",
    "aptjn": "Okay I got to know from few queries for some other erlang packages that OTP version could be possible issue for such compilation errors (from here and , here ). \nSo I started reducing my OTP version and finally with version 18.2.1 it got compiled.\n. I checked it, I am still not able to connect. Could you please share the conf file?\nThe etc/emqtt conf file have only 1883 and 8083 port configured. Even on those ports I am not able to ping using IPv6 address.\nPlease help me out with this, this seems to be very trivial issue but I am just not getting it.\nThanks,\nArpit\n. ",
    "magixyu": "Any plan to have this function?. ",
    "frenchbread": "Switched to emqttd v2.0 and used mc_worker_api:connect/1, mc_worker_api:insert/3. Everything worked!\n. ",
    "fleapapa": "Hi there,\nIs this issue still outstanding? \nWe need to deploy a production system with ~2M clients which act both as publishers and subscribers simultaneously. We also need to enable TLS between the clients and (clustered) MQTT brokers. If this \"kick-out\" issue is there, the TLS re-handshaking may incur quite some overhead to our servers.\nCould anyone confirm the issue is still there or already resolved?\nThanks!. ",
    "noordawod": "@emqplus \nHAProxy can be configured to pass on the source IP. By default, it doesn't. I tried passing it but then EMQ didn't understand the TCP packets and barfed.\nIf you know X-Forwarded-For for proxied HTTP packets, this is the same for TCP packets.\n. Thanks @emqplus! I will do so asap and report back.. Just installed the latest eMQTT package for CentOS 7 (64 bit). I guess this feature is not yet integrated?. On it!. @phanimahesh \nOkay, facing a wall right now.\nI cloned the proxy-protocol branch but there's no bin/ folder. Looks like this is the source tree. And I got no idea or an erl environment to compile the sources.\nTips?. Thanks a lot for your help, gentlemen.\nI don't understand, though, why did you close this issue?. So, while compiling on a CentOS machine, I got a problem:\n``\n.\n.\n.\nmake[1]: Leaving directory/home/emqtt/emq-relx/deps/emq_plugin_template'\n===> Starting relx build process ...\n===> Resolving OTP Applications from directories:\n          /home/emqtt/emq-relx/deps\n          /usr/lib64/erlang/lib\n          /home/emqtt/emq-relx/apps\n===> Failed to solve release:\n Dependency observer is specified as a dependency but is not reachable by the system.\nmake: *** [relx-rel] Error 127\n```\nNo idea how to fix this. Help?. Alright, how do I install it? Output from erl -v:\n```\nemqtt@mail:~/emq-relx/$ erl -v\nErlang/OTP 18 [erts-7.2] [source] [64-bit] [smp:8:8] [async-threads:10] [hipe] [kernel-poll:false]\nEshell V7.2  (abort with ^G)\n1> \nBREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded\n       (v)ersion (k)ill (D)b-tables (d)istribution\nq\n``. Thanks a lot. Recompiling.. Okay. Back to square one. I had this problem appear in the previous attempt, and what I did was basically to copyrebar` to the path.\nIn this attempt, though, I added the current directory to the path. But still facing the same problem. This should be fixed somehow in the build script.\n==> cuttlefish (escriptize)\nmake[2]: Leaving directory `/home/emqtt/emq-relx/deps/cuttlefish'\nmake[2]: Entering directory `/home/emqtt/emq-relx/deps/gproc'\n DEPEND gproc.d\n ERLC   gproc.erl gproc_app.erl gproc_bcast.erl gproc_dist.erl gproc_info.erl gproc_init.erl gproc_lib.erl gproc_monitor.erl gproc_pool.erl gproc_ps.erl gproc_pt.erl gproc_sup.erl\nsrc/gproc_dist.erl:23: Warning: behaviour gen_leader undefined\n APP    gproc.app.src\nmake[2]: Leaving directory `/home/emqtt/emq-relx/deps/gproc'\nmake[2]: Entering directory `/home/emqtt/emq-relx/deps/lager'\nmake[3]: Entering directory `/home/emqtt/emq-relx/deps/goldrush'\nmake[3]: rebar: Command not found\nmake[3]: *** [deps] Error 127\nmake[3]: Leaving directory `/home/emqtt/emq-relx/deps/goldrush'\nmake[2]: *** [deps] Error 2\nmake[2]: Leaving directory `/home/emqtt/emq-relx/deps/lager'\nmake[1]: *** [deps] Error 2\nmake[1]: Leaving directory `/home/emqtt/emq-relx/deps/emqttd'\nmake: *** [deps] Error 2\nAnyway, I'm copying rebar to the path (as instructed) and retrying.. Same result as before:\n1) cloned the branch anew\n2) Edited relx.config and nuked emq_recon\n3) Put rebar on the path\nThen make again. Same output:\n``\nmake[1]: Leaving directory/home/emqtt/emq-relx/deps/emq_plugin_template'\n===> Starting relx build process ...\n===> Resolving OTP Applications from directories:\n          /home/emqtt/emq-relx/deps\n          /usr/lib64/erlang/lib\n          /home/emqtt/emq-relx/apps\n===> Failed to solve release:\n Dependency observer is specified as a dependency but is not reachable by the system.\nmake: *** [relx-rel] Error 127\n```\nAny pointers would help, thanks!. Wonderful, upgrading to latest Erlang/OTP fixed the compilation problem! Thanks.\nNow, I'll go and check the Proxy Protocol.. Even more surprising (or not), I re-cloned the branch, and just ran make without touching relx.config. Build successful :). I'm getting the following errors once I activate Proxy Protocol:\n```\n2017-03-24 09:17:31 =SUPERVISOR REPORT====\n     Supervisor: 'esockd_connection_sup - <0.1208.0>'\n     Context:    connection_crashed\n     Reason:     proxy_proto_timeout\n     Offender:   [{pid,<0.1287.0>},{name,connection},{mfargs,{emqttd_client,start_link,[[{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,128},{max_packet_size,10240}]]}}]\n2017-03-24 09:20:26 =CRASH REPORT====\n  crasher:\n    initial call: emqttd_client:init/1\n    pid: <0.1261.0>\n    registered_name: []\n    exception error: {proxy_proto_timeout,[{esockd_connection,upgrade,1,[{file,\"src/esockd_connection.erl\"},{line,122}]},{emqttd_client,init,1,[{file,\"src/emqttd_client.erl\"},{line,100}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,247}]}]}\n    ancestors: [<0.1188.0>,<0.1187.0>,esockd_sup,<0.997.0>]\n    messages: []\n    links: [<0.1188.0>]\n    dictionary: []\n    trap_exit: false\n    status: running\n    heap_size: 376\n    stack_size: 27\n    reductions: 259\n  neighbours:\n2017-03-24 09:20:26 =SUPERVISOR REPORT====\n     Supervisor: 'esockd_connection_sup - <0.1188.0>'\n     Context:    connection_crashed\n     Reason:     proxy_proto_timeout\n     Offender:   [{pid,<0.1261.0>},{name,connection},{mfargs,{emqttd_client,start_link,[[{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,128},{max_packet_size,10240}]]}}]\n``. Okay, where do I actually see the remote IP's as evaluated by eMQTT? Maybe some debugging option?. I have HAProxy in front and I already configured it tosend-proxy. Still, whenemqttd` starts, it spits out few logs before it stables out and runs without a crash log error. It's been now running for 15 minutes, and no errors yet.\nHowever, can to test that the IP is actually being forwarded properly?. No problem with debug. I'm running this on a dev server anyway. I'll keep you updated.. Okay, I can see the remote IP in the log file just fine. This seems to work. Still need more tests to verify that, but I cannot proceed just yet.\nThe reason is because I have internal servers which connect to emqttd directly (not through haproxy) so this means that either they need to implement Proxy Protocol or emqttd need to be configured to ignore certain IP addresses from being handled by the proxy protocol handler.\nI suppose this can be rather simple to do, am I right?. Good idea. I didn't know it's possible.\nSo, one server but two listen ports? Do you mind writing a snippet to add to emq.conf that does that?. Okay. I get it now. You are asking to start a new emqttd instance entirely for the purpose of serving internal clients, correct? If so, isn't that a bit overkill for the task at hand? (ie: connect without Proxy Protocol for certain IP ranges).. Ahh, beautiful! So much power with the introduction of this feature. . Same issue I had on my end as well. Certain clients need to connect directly without the use of Proxy Protocol. And based on a response by the EMQ team (see here) this can be fixed using just one EMQ instance.\nI haven't checked it though, so maybe you can do that @satrox28 and report back?. ",
    "satrox28": "Is it implemented on 2.1 ?.. Hi,\nDo you have any update on this feature request?. When it will be released?. Any update, as we are planning to setup cluster in our production environment . Do you have any update on this, will this feature be added on next release?.. Any update on this?. Thanks. May I know when will 2.2 will be released. Is it possible to perform testing now.. Hi,\nThanks its working now and able to see client IP Address if emqtt server behind a load balancer.\nBetween we see this error on console, what it implies?.\n07:56:48.136 [error] Supervisor 'esockd_connection_sup - <0.1159.0>' had child connection started with emqttd_client:start_link([{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,1024},{max_packet_size,...}]) at <0.2728.19> exit with reason proxy_proto_timeout in context connection_crashed\n07:56:48.136 [error] CRASH REPORT Process <0.2727.19> with 0 neighbours crashed with reason: proxy_proto_timeout in esockd_connection:upgrade/1 line 122\n07:56:48.136 [error] Supervisor 'esockd_connection_sup - <0.1159.0>' had child connection started with emqttd_client:start_link([{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,1024},{max_packet_size,...}]) at <0.2727.19> exit with reason proxy_proto_timeout in context connection_crashed\nusing below settings on server:\nProxy Protocol V1/2\nmqtt.listener.tcp.proxy_protocol = on\nmqtt.listener.tcp.proxy_protocol_timeout = 3s\n. I tried using the 2.2-beta.1,  I am able to connect on 8083,1883 with proxy_protocol enabled on loadbalancer AWS.\nMay I know why am receiving the below error.\n2017-05-15 07:16:33.367 [error] <0.1911.0> CRASH REPORT Process <0.1911.0> with 0 neighbours crashed with reason: {invalid_proxy_info,<<16,51,0,6,77,81,73,115,100,112,3,22,0,15,0,10>>} in esockd_connection:upgrade/1 line 122\n2017-05-15 07:16:33.368 [error] <0.1248.0> Supervisor 'esockd_connection_sup - <0.1248.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.1911.0> exit with reason {invalid_proxy_info,<<16,51,0,6,77,81,73,115,100,112,3,22,0,15,0,10>>} in context connection_crashed\n2017-05-15 07:17:38.739 [error] <0.1948.0> CRASH REPORT Process <0.1948.0> with 0 neighbours crashed with reason: {invalid_proxy_info,<<16,51,0,6,77,81,73,115,100,112,3,22,0,15,0,10>>} in esockd_connection:upgrade/1 line 122\n2017-05-15 07:17:38.740 [error] <0.1248.0> Supervisor 'esockd_connection_sup - <0.1248.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.1948.0> exit with reason {invalid_proxy_info,<<16,51,0,6,77,81,73,115,100,112,3,22,0,15,0,10>>} in context connection_crashed\n. I have configured the required parameters on emq.conf.\nCan you tell me how to test from browser. I am not able to find any document. . Hi,\nI am able to test it using the above link and it works on 8083 and 8084. How can I do it locally from my browser\nFrom external using MQTTFX I am able to connect to 1883 and 8883 ando post message and subscribe.\nSimilar to that I want to publish and subscribe to on port 8083 and 8084. I can see websocket port is running  on server side.\nMay I know how to test messages on port 8083 and 8084 with SSL certificate\nIs it possible to do from MQTTBOX?\nWebsocket and websocket SSL\nWhen I enable debug log it not showing any info. And log file keep changing like erlang.log.1 etc. Can we make it to store on  1log file . when i enable these 2 params, I am seeing error\nmqtt.listener.ssl.verify = verify_peer\nmqtt.listener.ssl.fail_if_no_peer_cert = true\nverify return:1\n139759038353112:error:14094418:SSL routines:ssl3_read_bytes:tlsv1 alert unknown ca:s3_pkt.c:1487:SSL alert number 48\n139759038353112:error:140790E5:SSL routines:ssl23_write:ssl handshake failure:s23_lib.c:177:\nCan you help me with this error, do EMQTT works fine with CA signed SSL on 8883 and 8043?.\n. Can we have 4node cluster?. I got it working with 4nodes, thanks. Any update on 2.2 release as managing multiple nodes stats in each page is difficult.. If I modify the certificate in the starting line then its failing, if in middle I change any text then it's still able to connect. Any idea?.. ",
    "zacsonskaria": "How to make this work for emq behind nginx ? Enabling proxy_protocol did not help.. ",
    "tiwanpunit": "so there is no way one can get other information related to the message received by emqttd? may be by using hooks or plugin?\n. ",
    "StarpTech": "Im also looking for a short guide. Thanks.. @turtleDeng is it planned to support ACL for the HTTP Publish api?. @turtleDeng I tested with emqttd-2.1.0-beta.1 the clientId is not passed to the /mqtt/auth endpoint just username and password.. @emqplus any plan when it will be released?. I also faced with the same issue. Please fix it. Related https://github.com/emqtt/emq-auth-http/issues/15. I tried it with https://github.com/mcollina/mosca\nmosca -v | pino\n and it works. Why it doesnt works with emqtt?. Issue can be closed. My publish is\nexecuted before my subscribe is acked in emqtt. . It works. I misunderstood the concept.. ",
    "thedeterminedsoul": "@emqplus thanks, waiting for the prod environment docs (best practices) to come \ud83d\ude03 . ",
    "sohailgerman92": "@emqplus Is the documentation ready ? Because i am about to start with clustering and that will guide me in better ways. Did you find any solution to it ? Because i think it happened when ever the emq-dashboard deps file got updated.. These are the error logs which occur once the node is in cluster :\n```\n07:33:39.399 [error] Supervisor 'esockd_connection_sup - <0.2882.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.10204.0> exit with reason bad function #Fun in emqttd_session:handle_cast/2 line 463 in context connection_crashed\n07:33:40.371 [error] Supervisor 'esockd_connection_sup - <0.2882.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.10227.0> exit with reason bad function #Fun in emqttd_session:handle_cast/2 line 463 in context connection_crashed\n07:33:45.474 [error] Supervisor 'esockd_connection_sup - <0.2882.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.10254.0> exit with reason bad function #Fun in emqttd_session:handle_cast/2 line 463 in context connection_crashed\n07:33:53.161 [error] GenServer #PID<0.10037.0> terminating\n** (BadFunctionError) expected a function, got: #Function<0.92522822/1 in :emqttd_session>\n    (emqttd) src/emqttd_session.erl:463: :emqttd_session.handle_cast/2\n    (emqttd) src/gen_server2.erl:1046: :gen_server2.handle_msg/2\n    (stdlib) proc_lib.erl:257: :proc_lib.wake_up/3\nLast message: {:\"$gen_cast\", {:subscribe, #PID<39074.18116.9>, [{\"$client/59842d993bd3eb2912aaa3dd/1511330071255\", [qos: 1]}], #Function<0.92522822/1 in :emqttd_session>}}\nState: {:state, false, :remote, \"59842d993bd3eb2912aaa3dd/1511330071255\", :undefined, #PID<39074.18116.9>, :undefined, 4, 0, %{\"$client/59842d993bd3eb2912aaa3dd/1511330071255\" => 1, \"59842d993bd3eb2912aaa3dd\" => 1, \"presence/5964a38f2442870f7ccb0855\" => 1, \"typing/5964a38f2442870f7ccb085559842d993bd3eb2912aaa3dd\" => 1}, false, {:emqttd_inflight, [1, {0, nil}]}, 1, 20000, :undefined, {:mqueue, :simple, \"59842d993bd3eb2912aaa3dd/1511330071255\", {[], []}, 0, [], 0, 1000, 200, 600, true, 0, #Function<1.105474381/2 in :emqttd_alarm.alarm_fun/1>}, %{}, 100, 20000, :undefined, 2592000000, :undefined, false, 146, {1513, 582362, 355248}, false}\n07:33:53.161 [error] gen_server <0.10037.0> terminated with reason: bad function #Fun in emqttd_session:handle_cast/2 line 463\n07:33:53.172 [error] CRASH REPORT Process <0.10037.0> with 1 neighbours exited with reason: bad function #Fun in emqttd_session:handle_cast/2 line 463 in gen_server2:terminate/3 line 1157\n07:33:53.173 [error] Supervisor emqttd_session_sup had child session started with {emqttd_session,start_link,undefined} at <0.10037.0> exit with reason bad function #Fun in emqttd_session:handle_cast/2 line 463 in context child_terminated\n07:34:17.293 [error] Supervisor 'esockd_connection_sup - <0.2882.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.10341.0> exit with reason bad function #Fun in emqttd_session:handle_cast/2 line 463 in context connection_crashed\n07:34:22.193 [error] GenServer #PID<0.6821.0> terminating\n** (BadFunctionError) expected a function, got: #Function<0.92522822/1 in :emqttd_session>\n    (emqttd) src/emqttd_session.erl:463: :emqttd_session.handle_cast/2\n    (emqttd) src/gen_server2.erl:1046: :gen_server2.handle_msg/2\n    (stdlib) proc_lib.erl:257: :proc_lib.wake_up/3\nLast message: {:\"$gen_cast\", {:subscribe, #PID<39074.18211.9>, [{\"$client/59a90e4abe9fd49745ce7814/1511943190450\", [qos: 1]}], #Function<0.92522822/1 in :emqttd_session>}}\nState: {:state, false, :remote, \"59a90e4abe9fd49745ce7814/1511943190450\", :undefined, #PID<39074.18211.9>, :undefined, 1, 0, %{\"$client/59a90e4abe9fd49745ce7814/1511943190450\" => 1, \"59a90e4abe9fd49745ce7814\" => 1}, false, {:emqttd_inflight, [1, {0, nil}]}, 1, 20000, :undefined, {:mqueue, :simple, \"59a90e4abe9fd49745ce7814/1511943190450\", {[], []}, 0, [], 0, 1000, 200, 600, true, 0, #Function<1.105474381/2 in :emqttd_alarm.alarm_fun/1>}, %{}, 100, 20000, :undefined, 2592000000, :undefined, false, 133, {1513, 581423, 540263}, false}\n07:34:22.193 [error] gen_server <0.6821.0> terminated with reason: bad function #Fun in emqttd_session:handle_cast/2 line 463\n07:34:22.206 [error] CRASH REPORT Process <0.6821.0> with 1 neighbours exited with reason: bad function #Fun in emqttd_session:handle_cast/2 line 463 in gen_server2:terminate/3 line 1157\n07:34:22.207 [error] Supervisor emqttd_session_sup had child session started with {emqttd_session,start_link,undefined} at <0.6821.0> exit with reason bad function #Fun in emqttd_session:handle_cast/2 line 463 in context child_terminated\n```\nIf the node is not in cluster, everything works fine.. ",
    "gihad": "@emqplus I would also appreciate any documentation on deploy on AWS. Even better if there is some automation done for it (e.g.: Cloudformation, Ansible). @emqplus What is EMQ X? Is there a link to a website with information about it? I can only find links to emqtt here: http://emqtt.io/downloads. @emqplus This is a pretty basic feature that is behind the paywall. A paywall that is very hard to understand as there is no transparency regarding pricing and conditions. \nEven worse is a feature like the Kafka bridge and others that simply disappeared from Github. I'm very disappointed with the business practices from the EMQ team.. @alifirat Did find a resolution to your issue? I'm curious because I'm starting to experiment with this tool and other MQTT brokers. I need to push a message to 1 million clients in ~1 second.. Are there reports of anyone using emqtt to achieve throughput levels of 1million msg/sec, 2million msg/sec, 5million msg/sec? This is considering 1 million, 2million or 5million subscribers.. @emqplus Just to clarify will the prometheus monitoring plugin be available in EMQ 2.4-beta.1 or just in EMQ-X?. Here is a TL;DR version of the question:\nI want to push a message to 1 million mobile clients and all the messages need to make it through to the clients in 1 second.  After this all the clients will reply back with a message to the server. We will need SSL.\nAre these numbers feasible?. Is there another place I could ask these kind of questions? Slack group? IRC? I was able to ask this question in other communities such as VerneMQ.. Just to add some info here: I finally got some answers regarding pricing for EMQ-X by contacting zhengyu.pan@emqtt.io however the pricing tiers are still not clear.\nPrevious emails to feng@emqtt.io and contact@emqtt.io and the google user group were not responded to so don't bother with those.\n. - First message was on Feb 21st to the google groups (never got a reply)\n- Second massage was Later on Feb 21st to feng@emqtt.io (never got a reply)\n- Third message was also on Feb 21st as a Github issue which I followed up twice, 2 days later and 3 days later (never got a reply)\nThe methods above are advertised as contact address under http://emqtt.io/\nFinally got a reply from you today using zhengyu.pan@emqtt.io however the pricing tiers remain very unclear and I'm an interested customer.. ",
    "DigitalMarc": "False positive, I've just repeated all the steps and all is good now.\n. ",
    "R-Masoumi": "is \"Subscription from stored table\" removed in the latest version as well?\n. ",
    "CMTEST080": "Thanks!! I will try again after fixed that.\n. Thanks! \nThis issue was solved when I tried v2.0-rc.3. \n. +1. ",
    "Ashtonian": "not-reopening but the status endpoint seems to be attached to the webport which I think is now 8080 so http://localhost:8080/status is working for me. Is there documentation somewhere for this endpoint ?. ",
    "arvindr21": "Thanks @emqplus, this helps. Also, can you please point to the docker hub image for this release? \n. Thanks. Appreciate the quick response!\n. Thanks @turtleDeng config.broker.port is matching with mqtt.listener.ssl in emq.conf. Or should it match with mqtt.listener.https?\n. mqtt.listener.ssl = 1111 matches MQTTS?\n. Thanks. Will try and redo the setup.\n. error.log\nroot@1024c4cf95b5:/usr/src/log# cat error.log \n2016-11-08 04:06:04.435 [error] <0.1106.0> CRASH REPORT Process <0.1106.0> with 0 neighbours crashed with reason: {ssl_error,timeout} in esockd_connection:upgrade/1 line 113\n2016-11-08 04:06:04.435 [error] <0.1070.0> Supervisor 'esockd_connection_sup - <0.1070.0>' had child connection started with emqttd_client:start_link([{max_clientid_len,1024},{max_packet_size,65536},{client_idle_timeout,30}]) at <0.1106.0> exit with reason {ssl_error,timeout} in context connection_crashed\ncrash.log\n2016-11-08 04:06:04 =CRASH REPORT====\n  crasher:\n    initial call: emqttd_client:init/1\n    pid: <0.1106.0>\n    registered_name: []\n    exception error: {{ssl_error,timeout},[{esockd_connection,upgrade,1,[{file,\"src/esockd_connection.erl\"},{line,113}]},{emqttd_client,init,1,[{file,\"src/emqttd_client.erl\"},{line,76}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,240}]}]}\n    ancestors: [<0.1070.0>,<0.1069.0>,esockd_sup,<0.880.0>]\n    messages: []\n    links: [<0.1070.0>]\n    dictionary: []\n    trap_exit: false\n    status: running\n    heap_size: 1598\n    stack_size: 27\n    reductions: 3427\n  neighbours:\n2016-11-08 04:06:04 =SUPERVISOR REPORT====\n     Supervisor: 'esockd_connection_sup - <0.1070.0>'\n     Context:    connection_crashed\n     Reason:     {ssl_error,timeout}\n     Offender:   [{pid,<0.1106.0>},{name,connection},{mfargs,{emqttd_client,start_link,[[{max_clientid_len,1024},{max_packet_size,65536},{client_idle_timeout,30}]]}}]\nerlang.log.1\n```\n===== LOGGING STARTED Tue Nov  8 04:05:17 UTC 2016\nExec: /usr/src/erts-7.3/bin/erlexec -boot /usr/src/releases/2.0/emqttd -mode embedded -boot_var ERTS_LIB_DIR /usr/src/erts-7.3/../lib -mnesia dir \"/usr/src/data/mnesia/emqttd@127.0.0.1\" -config /usr/src/data/configs/app.2016.11.08.04.05.18.config -args_file /usr/src/data/configs/vm.2016.11.08.04.05.18.args -vm_args /usr/src/data/configs/vm.2016.11.08.04.05.18.args -- console\nRoot: /usr/src\n/usr/src\nErlang/OTP 18 [erts-7.3] [source] [64-bit] [smp:2:2] [async-threads:32] [kernel-poll:true]\nstarting emqttd on node 'emqttd@127.0.0.1'\nemqttd ctl is starting...[ok]\nemqttd hook is starting...[ok]\nemqttd router is starting...[ok]\nemqttd pubsub is starting...[ok]\nemqttd stats is starting...[ok]\nemqttd metrics is starting...[ok]\nemqttd pooler is starting...[ok]\nemqttd trace is starting...[ok]\nemqttd client manager is starting...[ok]\nemqttd session manager is starting...[ok]\nemqttd session supervisor is starting...[ok]\nemqttd wsclient supervisor is starting...[ok]\nemqttd broker is starting...[ok]\nemqttd alarm is starting...[ok]\nemqttd mod supervisor is starting...[ok]\nemqttd bridge supervisor is starting...[ok]\nemqttd access control is starting...[ok]\nemqttd system monitor is starting...[ok]\ndashboard:http listen on 0.0.0.0:18083 with 2 acceptors.\nmqtt:tcp listen on 0.0.0.0:1883 with 8 acceptors.\nmqtt:ssl listen on 0.0.0.0:8883 with 4 acceptors.\nmqtt:ws listen on 0.0.0.0:8083 with 4 acceptors.\nErlang MQTT Broker 2.0 is running now\nEshell V7.3  (abort with ^G)\n(emqttd@127.0.0.1)1> 04:06:04.435 [error] CRASH REPORT Process <0.1106.0> with 0 neighbours crashed with reason: {ssl_error,timeout} in esockd_connection:upgrade/1 line 113\n04:06:04.435 [error] Supervisor 'esockd_connection_sup - <0.1070.0>' had child connection started with emqttd_client:start_link([{max_clientid_len,1024},{max_packet_size,65536},{client_idle_timeout,30}]) at <0.1106.0> exit with reason {ssl_error,timeout} in context connection_crashed\n```\nrun_erl.log\nrun_erl [47] Tue Nov  8 04:05:17 2016\nArgs before exec of shell:\nrun_erl [47] Tue Nov  8 04:05:17 2016\nargv[0] = sh\nrun_erl [47] Tue Nov  8 04:05:17 2016\nargv[1] = -c\nrun_erl [47] Tue Nov  8 04:05:17 2016\nargv[2] = exec \"/usr/src/bin/emqttd\" \"console\"\nThe client : MQTTjs with mqtts protocol\n``` js\nvar mqtt = require('mqtt');\nvar config = require('./config.js');\nvar client = mqtt.connect({\n    port: config.broker.port, // 8883\n    protocol: 'mqtts', // protocol\n    host: config.broker.host, // 'localhost'\n    clientId: config.broker.clientId, // 'random_client_id'\n    reconnectPeriod: 6000,\n    keepalive: 300,\n    rejectUnauthorized: false // required\n});\nclient.on('connect', function() {\n    console.log(arguments);\n    console.log('MQTT Connected');\n});\nclient.on('close', function() {\n    console.log(arguments);\n    console.log('MQTT Disconnected');\n});\n```\nOutput from the console when I run this\nshell\n{ '0': { [Error: socket hang up] code: 'ECONNRESET' } }\nMQTT Disconnected\n. @turtleDeng, I also have a hardware that is connecting to the broker. That is running mqtts. I don't want to change that implementation now. \n. Thanks @turtleDeng. Can you please explain the difference between MQTTS and HTTPS in emqttd? \n. Thanks @emqplus 8883 is what I am trying to connect to and it doesn't seem to connect. Also, can you please share the latest docker image tag?\n. Thanks @vowstar I did tune the linux box. But still the total number of clients that are getting connected are only 226. \nI will be provisioning a m4 large, m4 xl and m4 xxl AWS instances and run only the emqtt docker image and execute benchmarks again and see if that issue persists.. @vowstar PFB\n```bash\nget docker version\n$ docker -v\nDocker version 1.12.1, build 23cf638\nget linux kernal version\n$ uname -a\nLinux ubuntu 4.4.0-53-generic #74-Ubuntu SMP Fri Dec 2 15:59:10 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n```\nQuick note: I did not use the docker image which is available on the site. Instead, I have taken the Ubuntu source and built an image using that, as I had some config to be done. PFB the Dockerfile\ndockerfile\nFROM ubuntu:14.04\nRUN mkdir -p /usr/src/\nWORKDIR /usr/src/\nCOPY ./emqttd /usr/src/\nWORKDIR /usr/src/bin\nEXPOSE 1883 8083 8883 18083\nENTRYPOINT ./emqttd start && bash\nThanks.. @vowstar do you think docker has any limitations on the number of available connections to a container?. @donaldjarmstrong yes, we took a different approach for testing. We calculated that each of our clients cannot send more than one message per second. Hence we are varying message per second to something like\nbash\n$ ./emqtt_bench_pub -c 50 -i 70 -I 1000 -t bench/%i -s 256 -h emqttd.broker -p 1883\nSo, here we are ramping up 50 clients, 70ms apart and sending a data of 256b. With the above setup and the same 2 core machine, we were able to run 4.5k clients for about 45mins without any drop outs. \nWe tried the same test on AWS t2.xlarge instance and we were able to reach 9.8k simultaneous clients for about 1 hour. \nBut I am not sure if the number of cores have any relationship with the number of clients. \nAgain, I am not sure if the below logic is \"logical\" but...\nBased on the benchmark => 12 cores machine -> 1.3 million clients so a 2 core machine should ideally be able to support 0.21 million connections. That is roughly 2 lakh connections. Assuming other factors, let's say we are able to scale only to 25% of the capacity, then, this would become 50k connections for a 2 core machine. But based on what we have seen, looks like 5k is the limit.\nWe are still working on benchmarking. If you any suggestions, feel free to add on.\nThanks,\nArvind.\n. Based on http://www.hivemq.com/blog/mqtt-essentials-part-9-last-will-and-testament LWT should be fired when\n\nAn I/O error or network failure is detected by the server.\nThe client fails to communicate within the Keep Alive time.\nThe client closes the network connection without sending a DISCONNECT packet first.\nThe server closes the network connection because of a protocol error.\n\nLooks like 2 & 3 points above seem to not work as expected.. @emqplus is this issue resolved? . Thanks @emqplus Will validate and confirm.. ",
    "hijklmno": "Thank you @emqplus. Local shared subscriptions will be difficult to manage when we have emqttd and our subscribers on autoscaling. Do we know if shared subscriptions across clustered nodes is on the roadmap?\n. ",
    "BinLi-DEV": "@emqplus , This seems to be a great feature for the common use case, is there any update plan for this feature?. ",
    "jsaveljevs": "Hi, thanks for a quick reply!\nAttaching the log below\n2016-11-07 18:34:48.836 [debug] <0.865.0>@lager_handler_watcher:119 Lager installed handler {lager_file_backend,\"log/console.log\"} into lager_event\n2016-11-07 18:34:48.836 [debug] <0.867.0>@lager_handler_watcher:119 Lager installed handler {lager_file_backend,\"log/error.log\"} into lager_event\n2016-11-07 18:34:48.836 [debug] <0.869.0>@lager_handler_watcher:119 Lager installed handler error_logger_lager_h into error_logger\n2016-11-07 18:34:48.836 [debug] <0.852.0> Supervisor gr_param_sup started gr_param:start_link(gr_lager_default_tracer_params) at pid <0.871.0>\n2016-11-07 18:34:48.837 [debug] <0.851.0> Supervisor gr_counter_sup started gr_counter:start_link(gr_lager_default_tracer_counters) at pid <0.872.0>\n2016-11-07 18:34:48.837 [debug] <0.853.0> Supervisor gr_manager_sup started gr_manager:start_link(gr_lager_default_tracer_params_mgr, gr_lager_default_tracer_params, []) at pid <0.873.0>\n2016-11-07 18:34:48.837 [debug] <0.853.0> Supervisor gr_manager_sup started gr_manager:start_link(gr_lager_default_tracer_counters_mgr, gr_lager_default_tracer_counters, [{input,0},{filter,0},{output,0},{job_input,0},{job_run,0},{job_time,0},{job_error,0}]) at pid <0.874.0>\n2016-11-07 18:34:48.849 [debug] <0.787.0> Supervisor kernel_safe_sup started timer:start_link() at pid <0.876.0>\n2016-11-07 18:34:48.850 [info] <0.759.0> Application lager started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.850 [debug] <0.880.0> Supervisor gproc_sup started gproc:start_link() at pid <0.881.0>\n2016-11-07 18:34:48.851 [debug] <0.880.0> Supervisor gproc_sup started gproc_monitor:start_link() at pid <0.882.0>\n2016-11-07 18:34:48.851 [debug] <0.880.0> Supervisor gproc_sup started gproc_bcast:start_link() at pid <0.883.0>\n2016-11-07 18:34:48.851 [debug] <0.880.0> Supervisor gproc_sup started gproc_pool:start_link() at pid <0.884.0>\n2016-11-07 18:34:48.851 [info] <0.759.0> Application gproc started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.852 [debug] <0.787.0> Supervisor kernel_safe_sup started dets_sup:start_link() at pid <0.888.0>\n2016-11-07 18:34:48.852 [debug] <0.787.0> Supervisor kernel_safe_sup started dets_server:start_link() at pid <0.889.0>\n2016-11-07 18:34:48.852 [debug] <0.896.0> Supervisor mnesia_sup started mnesia_sup:start_event() at pid <0.897.0>\n2016-11-07 18:34:48.853 [debug] <0.898.0> Supervisor mnesia_kernel_sup started mnesia_monitor:start() at pid <0.899.0>\n2016-11-07 18:34:48.853 [debug] <0.898.0> Supervisor mnesia_kernel_sup started mnesia_subscr:start() at pid <0.900.0>\n2016-11-07 18:34:48.853 [debug] <0.898.0> Supervisor mnesia_kernel_sup started mnesia_locker:start() at pid <0.901.0>\n2016-11-07 18:34:48.853 [debug] <0.898.0> Supervisor mnesia_kernel_sup started mnesia_recover:start() at pid <0.902.0>\n2016-11-07 18:34:48.854 [debug] <0.787.0> Supervisor kernel_safe_sup started disk_log_sup:start_link() at pid <0.907.0>\n2016-11-07 18:34:48.855 [debug] <0.787.0> Supervisor kernel_safe_sup started disk_log_server:start_link() at pid <0.908.0>\n2016-11-07 18:34:48.868 [debug] <0.898.0> Supervisor mnesia_kernel_sup started mnesia_tm:start() at pid <0.903.0>\n2016-11-07 18:34:48.868 [debug] <0.898.0> Supervisor mnesia_kernel_sup started mnesia_checkpoint_sup:start() at pid <0.919.0>\n2016-11-07 18:34:48.868 [debug] <0.898.0> Supervisor mnesia_kernel_sup started mnesia_snmp_sup:start() at pid <0.920.0>\n2016-11-07 18:34:48.868 [debug] <0.898.0> Supervisor mnesia_kernel_sup started mnesia_controller:start() at pid <0.921.0>\n2016-11-07 18:34:48.868 [debug] <0.898.0> Supervisor mnesia_kernel_sup started mnesia_late_loader:start() at pid <0.922.0>\n2016-11-07 18:34:48.869 [debug] <0.896.0> Supervisor mnesia_sup started mnesia_kernel_sup:start() at pid <0.898.0>\n2016-11-07 18:34:48.869 [info] <0.759.0> Application mnesia started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.871 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_ctl:start_link() at pid <0.944.0>\n2016-11-07 18:34:48.871 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_hook:start_link() at pid <0.945.0>\n2016-11-07 18:34:48.872 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_router:start_link() at pid <0.946.0>\n2016-11-07 18:34:48.872 [debug] <0.948.0> Supervisor {<0.948.0>,emqttd_pool_sup} started emqttd_pubsub:start_link(pubsub, 1, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.949.0>\n2016-11-07 18:34:48.872 [debug] <0.948.0> Supervisor {<0.948.0>,emqttd_pool_sup} started emqttd_pubsub:start_link(pubsub, 2, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.950.0>\n2016-11-07 18:34:48.872 [debug] <0.948.0> Supervisor {<0.948.0>,emqttd_pool_sup} started emqttd_pubsub:start_link(pubsub, 3, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.951.0>\n2016-11-07 18:34:48.873 [debug] <0.948.0> Supervisor {<0.948.0>,emqttd_pool_sup} started emqttd_pubsub:start_link(pubsub, 4, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.952.0>\n2016-11-07 18:34:48.873 [debug] <0.948.0> Supervisor {<0.948.0>,emqttd_pool_sup} started emqttd_pubsub:start_link(pubsub, 5, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.953.0>\n2016-11-07 18:34:48.873 [debug] <0.948.0> Supervisor {<0.948.0>,emqttd_pool_sup} started emqttd_pubsub:start_link(pubsub, 6, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.954.0>\n2016-11-07 18:34:48.873 [debug] <0.948.0> Supervisor {<0.948.0>,emqttd_pool_sup} started emqttd_pubsub:start_link(pubsub, 7, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.955.0>\n2016-11-07 18:34:48.873 [debug] <0.948.0> Supervisor {<0.948.0>,emqttd_pool_sup} started emqttd_pubsub:start_link(pubsub, 8, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.956.0>\n2016-11-07 18:34:48.873 [debug] <0.947.0> Supervisor emqttd_pubsub_sup started emqttd_pool_sup:start_link(pubsub, hash, 8, {emqttd_pubsub,start_link,[[{pool_size,8},{by_clientid,true},{async,true}]]}) at pid <0.948.0>\n2016-11-07 18:34:48.874 [debug] <0.957.0> Supervisor {<0.957.0>,emqttd_pool_sup} started emqttd_server:start_link(server, 1, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.958.0>\n2016-11-07 18:34:48.874 [debug] <0.957.0> Supervisor {<0.957.0>,emqttd_pool_sup} started emqttd_server:start_link(server, 2, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.959.0>\n2016-11-07 18:34:48.874 [debug] <0.957.0> Supervisor {<0.957.0>,emqttd_pool_sup} started emqttd_server:start_link(server, 3, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.960.0>\n2016-11-07 18:34:48.874 [debug] <0.957.0> Supervisor {<0.957.0>,emqttd_pool_sup} started emqttd_server:start_link(server, 4, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.961.0>\n2016-11-07 18:34:48.875 [debug] <0.957.0> Supervisor {<0.957.0>,emqttd_pool_sup} started emqttd_server:start_link(server, 5, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.962.0>\n2016-11-07 18:34:48.875 [debug] <0.957.0> Supervisor {<0.957.0>,emqttd_pool_sup} started emqttd_server:start_link(server, 6, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.963.0>\n2016-11-07 18:34:48.875 [debug] <0.957.0> Supervisor {<0.957.0>,emqttd_pool_sup} started emqttd_server:start_link(server, 7, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.964.0>\n2016-11-07 18:34:48.875 [debug] <0.957.0> Supervisor {<0.957.0>,emqttd_pool_sup} started emqttd_server:start_link(server, 8, [{pool_size,8},{by_clientid,true},{async,true}]) at pid <0.965.0>\n2016-11-07 18:34:48.875 [debug] <0.947.0> Supervisor emqttd_pubsub_sup started emqttd_pool_sup:start_link(server, hash, 8, {emqttd_server,start_link,[[{pool_size,8},{by_clientid,true},{async,true}]]}) at pid <0.957.0>\n2016-11-07 18:34:48.875 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_pubsub_sup:start_link() at pid <0.947.0>\n2016-11-07 18:34:48.876 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_stats:start_link() at pid <0.966.0>\n2016-11-07 18:34:48.876 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_metrics:start_link() at pid <0.967.0>\n2016-11-07 18:34:48.876 [debug] <0.968.0> Supervisor {<0.968.0>,emqttd_pool_sup} started emqttd_pooler:start_link(pooler, 1) at pid <0.969.0>\n2016-11-07 18:34:48.876 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_pooler:start_link() at pid <0.968.0>\n2016-11-07 18:34:48.876 [debug] <0.970.0> Supervisor emqttd_trace_sup started emqttd_trace:start_link() at pid <0.971.0>\n2016-11-07 18:34:48.876 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_trace_sup:start_link() at pid <0.970.0>\n2016-11-07 18:34:48.877 [debug] <0.973.0> Supervisor {<0.973.0>,emqttd_pool_sup} started emqttd_cm:start_link(emqttd_cm, 1, #Fun<emqttd_stats.1.131133372>) at pid <0.974.0>\n2016-11-07 18:34:48.877 [debug] <0.972.0> Supervisor emqttd_cm_sup started emqttd_pool_sup:start_link(emqttd_cm, hash, 1, {emqttd_cm,start_link,[#Fun<emqttd_stats.1.131133372>]}) at pid <0.973.0>\n2016-11-07 18:34:48.877 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_cm_sup:start_link() at pid <0.972.0>\n2016-11-07 18:34:48.877 [debug] <0.975.0> Supervisor emqttd_sm_sup started emqttd_sm_helper:start_link(#Fun<emqttd_stats.1.131133372>) at pid <0.976.0>\n2016-11-07 18:34:48.877 [debug] <0.977.0> Supervisor {<0.977.0>,emqttd_pool_sup} started emqttd_sm:start_link(emqttd_sm, 1) at pid <0.978.0>\n2016-11-07 18:34:48.877 [debug] <0.975.0> Supervisor emqttd_sm_sup started emqttd_pool_sup:start_link(emqttd_sm, hash, 1, {emqttd_sm,start_link,[]}) at pid <0.977.0>\n2016-11-07 18:34:48.878 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_sm_sup:start_link() at pid <0.975.0>\n2016-11-07 18:34:48.878 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_session_sup:start_link() at pid <0.979.0>\n2016-11-07 18:34:48.878 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_ws_client_sup:start_link() at pid <0.980.0>\n2016-11-07 18:34:48.878 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_broker:start_link() at pid <0.981.0>\n2016-11-07 18:34:48.878 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_alarm:start_link() at pid <0.982.0>\n2016-11-07 18:34:48.879 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_mod_sup:start_link() at pid <0.983.0>\n2016-11-07 18:34:48.879 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_bridge_sup_sup:start_link() at pid <0.984.0>\n2016-11-07 18:34:48.879 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_access_control:start_link() at pid <0.985.0>\n2016-11-07 18:34:48.879 [debug] <0.986.0> Supervisor emqttd_sysmon_sup started emqttd_sysmon:start_link([{long_gc,false},{long_schedule,240},{large_heap,8388608},{busy_port,false},{busy_dist_port,true}]) at pid <0.987.0>\n2016-11-07 18:34:48.879 [debug] <0.943.0> Supervisor emqttd_sup started emqttd_sysmon_sup:start_link() at pid <0.986.0>\n2016-11-07 18:34:48.881 [info] <0.759.0> Application recon started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.881 [debug] <0.996.0> Supervisor emq_recon_sup started emq_recon_gc:start_link() at pid <0.997.0>\n2016-11-07 18:34:48.881 [info] <0.887.0>@emqttd_plugins:start_app:157 started Apps: [recon,emq_recon]\n2016-11-07 18:34:48.882 [info] <0.887.0>@emqttd_plugins:start_app:158 load plugin emq_recon successfully\n2016-11-07 18:34:48.882 [info] <0.759.0> Application emq_recon started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.882 [debug] <0.1001.0> Supervisor emq_dashboard_sup started emq_dashboard_admin:start_link() at pid <0.1002.0>\n2016-11-07 18:34:48.882 [debug] <0.1005.0> Supervisor {<0.1005.0>,esockd_listener_sup} started esockd_connection_sup:start_link([{sockopts,[binary,{reuseaddr,true},{packet,raw},{backlog,1024},{recbuf,8192},{exit_on_close,false},...]},...], {mochiweb_http,start_link,[{emq_dashboard,handle_request,[{state,\"/opt/emqttd-relx/_rel/emqttd...\",...}]}]}, {gen_logger,error_logger_logger,2}) at pid <0.1006.0>\n2016-11-07 18:34:48.883 [debug] <0.1005.0> Supervisor {<0.1005.0>,esockd_listener_sup} started esockd_acceptor_sup:start_link(<0.1006.0>, #Fun<esockd_server.0.76791649>, #Fun<esockd_listener_sup.1.16895020>, {gen_logger,error_logger_logger,2}) at pid <0.1007.0>\n2016-11-07 18:34:48.883 [debug] <0.1005.0> Supervisor {<0.1005.0>,esockd_listener_sup} started esockd_listener:start_link('dashboard:http', 18083, [{sockopts,[binary,{reuseaddr,true},{packet,raw},{backlog,1024},{recbuf,8192},{exit_on_close,false},...]},...], <0.1007.0>, {gen_logger,error_logger_logger,2}) at pid <0.1008.0>\n2016-11-07 18:34:48.883 [debug] <0.845.0> Supervisor esockd_sup started esockd_listener_sup:start_link('dashboard:http', 18083, [{sockopts,[binary,{reuseaddr,true},{packet,raw},{backlog,1024},{recbuf,8192},{exit_on_close,false},...]},...], {mochiweb_http,start_link,[{emq_dashboard,handle_request,[{state,\"/opt/emqttd-relx/_rel/emqttd...\",...}]}]}) at pid <0.1005.0>\n2016-11-07 18:34:48.883 [info] <0.887.0>@emqttd_plugins:start_app:157 started Apps: [emq_dashboard]\n2016-11-07 18:34:48.883 [info] <0.887.0>@emqttd_plugins:start_app:158 load plugin emq_dashboard successfully\n2016-11-07 18:34:48.883 [info] <0.759.0> Application emq_dashboard started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.884 [info] <0.887.0>@emqttd_plugins:start_app:157 started Apps: [emq_mod_presence]\n2016-11-07 18:34:48.884 [info] <0.887.0>@emqttd_plugins:start_app:158 load plugin emq_mod_presence successfully\n2016-11-07 18:34:48.884 [info] <0.759.0> Application emq_mod_presence started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.884 [debug] <0.1018.0> Supervisor emq_mod_retainer_sup started emq_mod_retainer:start_link([{max_payload_size,65536},{included_applications,[]},{expired_after,0},{storage_type,ram},{max_message_num,...}]) at pid <0.1019.0>\n2016-11-07 18:34:48.885 [info] <0.887.0>@emqttd_plugins:start_app:157 started Apps: [emq_mod_retainer]\n2016-11-07 18:34:48.885 [info] <0.887.0>@emqttd_plugins:start_app:158 load plugin emq_mod_retainer successfully\n2016-11-07 18:34:48.885 [info] <0.759.0> Application emq_mod_retainer started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.885 [info] <0.887.0>@emqttd_plugins:start_app:157 started Apps: [emq_mod_subscription]\n2016-11-07 18:34:48.885 [info] <0.887.0>@emqttd_plugins:start_app:158 load plugin emq_mod_subscription successfully\n2016-11-07 18:34:48.885 [info] <0.759.0> Application emq_mod_subscription started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.885 [debug] <0.1026.0> Supervisor {<0.1026.0>,esockd_listener_sup} started esockd_connection_sup:start_link([{connopts,[]},{sockopts,[binary,{packet,raw},{reuseaddr,true},{backlog,1024},{nodelay,true}]},{...},...], {emqttd_client,start_link,[[{max_clientid_len,1024},{max_packet_size,65536},{client_idle_timeout,...}]]}, {gen_logger,error_logger_logger,2}) at pid <0.1027.0>\n2016-11-07 18:34:48.886 [debug] <0.1026.0> Supervisor {<0.1026.0>,esockd_listener_sup} started esockd_acceptor_sup:start_link(<0.1027.0>, #Fun<esockd_server.0.76791649>, #Fun<esockd_listener_sup.1.16895020>, {gen_logger,error_logger_logger,2}) at pid <0.1028.0>\n2016-11-07 18:34:48.886 [debug] <0.1026.0> Supervisor {<0.1026.0>,esockd_listener_sup} started esockd_listener:start_link('mqtt:tcp', 1883, [{connopts,[]},{sockopts,[binary,{packet,raw},{reuseaddr,true},{backlog,1024},{nodelay,true}]},{...},...], <0.1028.0>, {gen_logger,error_logger_logger,2}) at pid <0.1029.0>\n2016-11-07 18:34:48.886 [debug] <0.845.0> Supervisor esockd_sup started esockd_listener_sup:start_link('mqtt:tcp', 1883, [{connopts,[]},{sockopts,[binary,{packet,raw},{reuseaddr,true},{backlog,1024},{nodelay,true}]},{...},...], {emqttd_client,start_link,[[{max_clientid_len,1024},{max_packet_size,65536},{client_idle_timeout,...}]]}) at pid <0.1026.0>\n2016-11-07 18:34:48.887 [debug] <0.1038.0> Supervisor {<0.1038.0>,esockd_listener_sup} started esockd_connection_sup:start_link([{ssl,[{handshake_timeout,2000},{keyfile,\"etc/certs/key.pem\"},{certfile,\"etc/certs/cert.pem\"}]},...], {emqttd_client,start_link,[[{max_clientid_len,1024},{max_packet_size,65536},{client_idle_timeout,...}]]}, {gen_logger,error_logger_logger,2}) at pid <0.1039.0>\n2016-11-07 18:34:48.887 [debug] <0.1038.0> Supervisor {<0.1038.0>,esockd_listener_sup} started esockd_acceptor_sup:start_link(<0.1039.0>, #Fun<esockd_server.0.76791649>, #Fun<esockd_listener_sup.1.16895020>, {gen_logger,error_logger_logger,2}) at pid <0.1040.0>\n2016-11-07 18:34:48.887 [debug] <0.1038.0> Supervisor {<0.1038.0>,esockd_listener_sup} started esockd_listener:start_link('mqtt:ssl', 8883, [{ssl,[{handshake_timeout,2000},{keyfile,\"etc/certs/key.pem\"},{certfile,\"etc/certs/cert.pem\"}]},...], <0.1040.0>, {gen_logger,error_logger_logger,2}) at pid <0.1041.0>\n2016-11-07 18:34:48.887 [debug] <0.845.0> Supervisor esockd_sup started esockd_listener_sup:start_link('mqtt:ssl', 8883, [{ssl,[{handshake_timeout,2000},{keyfile,\"etc/certs/key.pem\"},{certfile,\"etc/certs/cert.pem\"}]},...], {emqttd_client,start_link,[[{max_clientid_len,1024},{max_packet_size,65536},{client_idle_timeout,...}]]}) at pid <0.1038.0>\n2016-11-07 18:34:48.888 [debug] <0.1046.0> Supervisor {<0.1046.0>,esockd_listener_sup} started esockd_connection_sup:start_link([{connopts,[]},{sockopts,[binary,{reuseaddr,true},{packet,raw},{backlog,1024},{recbuf,8192},{exit_on_close,...},...]},...], {mochiweb_http,start_link,[{emqttd_http,handle_request,[]}]}, {gen_logger,error_logger_logger,2}) at pid <0.1047.0>\n2016-11-07 18:34:48.888 [debug] <0.1046.0> Supervisor {<0.1046.0>,esockd_listener_sup} started esockd_acceptor_sup:start_link(<0.1047.0>, #Fun<esockd_server.0.76791649>, #Fun<esockd_listener_sup.1.16895020>, {gen_logger,error_logger_logger,2}) at pid <0.1048.0>\n2016-11-07 18:34:48.888 [debug] <0.1046.0> Supervisor {<0.1046.0>,esockd_listener_sup} started esockd_listener:start_link('mqtt:ws', 8083, [{connopts,[]},{sockopts,[binary,{reuseaddr,true},{packet,raw},{backlog,1024},{recbuf,8192},{exit_on_close,...},...]},...], <0.1048.0>, {gen_logger,error_logger_logger,2}) at pid <0.1049.0>\n2016-11-07 18:34:48.894 [debug] <0.845.0> Supervisor esockd_sup started esockd_listener_sup:start_link('mqtt:ws', 8083, [{connopts,[]},{sockopts,[binary,{reuseaddr,true},{packet,raw},{backlog,1024},{recbuf,8192},{exit_on_close,...},...]},...], {mochiweb_http,start_link,[{emqttd_http,handle_request,[]}]}) at pid <0.1046.0>\n2016-11-07 18:34:48.894 [info] <0.759.0> Application emqttd started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.895 [info] <0.759.0> Application cbor started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.895 [info] <0.759.0> Application eldap started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.895 [info] <0.759.0> Application poolboy started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.895 [info] <0.759.0> Application bson started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.897 [debug] <0.1061.0> Supervisor mc_super_sup started mongo_id_server:start_link() at pid <0.1062.0>\n2016-11-07 18:34:48.897 [info] <0.759.0> Application mongodb started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.899 [info] <0.759.0> Application ecpool started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.899 [info] <0.759.0> Application mysql started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.900 [info] <0.759.0> Application epgsql started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:48.900 [info] <0.759.0> Application eredis started on node 'emqttd@127.0.0.1'\n2016-11-07 18:34:49.336 [debug] <0.861.0>@lager_handler_watcher:119 Lager installed handler lager_backend_throttle into lager_event\n2016-11-07 18:34:49.823 [error] <0.1024.0> application_master: shutdown_error, emq_mod_subscription_app: {prep_stop,[[]]}, error_info: {noproc,{gen_server,call,[emqttd_hook,{delete,'client.connected',#Fun<emq_mod_subscription.on_client_connected.3>}]}}\n2016-11-07 18:34:49.823 [error] <0.1017.0> application_master: shutdown_error, emq_mod_retainer_app: {prep_stop,[[]]}, error_info: {noproc,{gen_server,call,[emqttd_hook,{delete,'session.subscribed',#Fun<emq_mod_retainer.on_session_subscribed.4>}]}}\n. Turns out this noproc is not the cause, but likely a result of something else going wrong. After I've removed everything from data/loaded_plugins and it still fails, but does so silently without any error message:\n(emqttd@127.0.0.1)1> 19:03:54.972 [debug] Lager installed handler lager_backend_throttle into lager_event\nstopped mqtt:tcp on 0.0.0.0:1883\nstopped mqtt:ssl on 0.0.0.0:8883\nstopped mqtt:ws on 0.0.0.0:8083\n[os_mon] memory supervisor port (memsup): Erlang has closed\n[os_mon] cpu supervisor port (cpu_sup): Erlang has closed\nI'll do some more runs with different configurations and will report the results here.\n. This issue was resolved by system restart, everything works fine now. \nSorry for wasting your time and thanks for the awesome product you're making!\n. @emqplus thanks a lot!\n. ",
    "allenhula": "Thanks. I know that setting. But I don't know to setup my client side to connect to that ssl endpoint. I searched around, and didn't find any step-by-step guideline. But found guidelines from Paho client connect to other brokers. So hope you emqttd can provide one guideline as well. Thanks again!\n. @emqplus I am using Java. https://github.com/eclipse/paho.mqtt.java\n. ",
    "fabianTMC": "This is happening to me as well. I had a previously running docker instance that was connecting just fine and after restarting it, it started to reject all ssl connections.\n17:56:05.325 [error] Client(172.17.0.1:38122): Parser failed for {function_clause,[{emqttd_parser,parse_utf,[<<3,0,167>>],[{file,\"src/emqttd_parser.erl\"},{line,205}]},{emqttd_parser,parse_frame,3,[{file,\"src/emqttd_parser.erl\"},{line,80}]},{emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,301}]},{gen_server2,handle_msg,2,[{file,\"src/gen_server2.erl\"},{line,1046}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,247}]}]}\n17:56:05.325 [error] Client(172.17.0.1:38122): Error data: <<22,3,3,0,167,1,0,0,163,3,3,88,212,12,53,40,230,224,248,195,10,43,223,30,2,240,252,222,109,15,132,33,191,241,20,171,200,18,64,152,117,199,139,0,0,58,192,35,192,39,0,60,192,37,192,41,0,103,0,64,192,9,192,19,0,47,192,4,192,14,0,51,0,50,192,43,192,47,0,156,192,45,192,49,0,158,0,162,192,8,192,18,0,10,192,3,192,13,0,22,0,19,0,255,1,0,0,64,0,10,0,22,0,20,0,23,0,24,0,25,0,9,0,10,0,11,0,12,0,13,0,14,0,22,0,11,0,2,1,0,0,13,0,28,0,26,6,3,6,1,5,3,5,1,4,3,4,1,4,2,3,3,3,1,3,2,2,3,2,1,2,2>>. Won't fix because?. ",
    "Venkat2811": "This is happening to me as well.  When I try to re-connect after disconnecting this error occurs.  However, this is not consistent though (doesn't occur always).\nI'm using Python Paho Client, username, password based auth, without ssl.\n```\n2017-04-20 03:52:19.808 [error] <0.25765.286>@emqttd_client:received:280 Client(10.4.118.144:57938): Parser failed for {function_clause,[{emqttd_parser,parse_utf,[<<3,0,197>>],[{file,\"src/emqttd_parser.erl\"},{line,206}]},{emqttd_parser,parse_frame,3,[{file,\"src/emqttd_parser.erl\"},{line,81}]},{emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,259}]},{gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,615}]},{gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,681}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,240}]}]}\n2017-04-20 03:52:19.808 [error] <0.25765.286>@emqttd_client:received:281 Client(10.4.118.144:57938): Error data: <<22,3,3,0,197,1,0,0,193,3,3,88,248,146,227,150,253,238,135,97,30,222,175,146,201,197,48,41,6,12,245,123,126,252,88,60,34,76,165,65,148,184,179,0,0,58,192,35,192,39,0,60,192,37,192,41,0,103,0,64,192,9,192,19,0,47,192,4,192,14,0,51,0,50,192,43,192,47,0,156,192,45,192,49,0,158,0,162,192,8,192,18,0,10,192,3,192,13,0,22,0,19,0,255,1,0,0,94,0,10,0,52,0,50,0,23,0,1,0,3,0,19,0,21,0,6,0,7,0,9,0,10,0,24,0,11,0,12,0,25,0,13,0,14,0,15,0,16,0,17,0,2,0,18,0,4,0,5,0,20,0,8,0,22,0,11,0,2,1,0,0,13,0,28,0,26,6,3,6,1,5,3,5,1,4,3,4,1,4,2,3,3,3,1,3,2,2,3,2,1,2,2>>\n2017-04-20 03:52:20.044 [error] <0.26009.286>@emqttd_client:received:280 Client(10.4.118.144:57940): Parser failed for {function_clause,[{emqttd_parser,parse_utf,[<<3,0,197>>],[{file,\"src/emqttd_parser.erl\"},{line,206}]},{emqttd_parser,parse_frame,3,[{file,\"src/emqttd_parser.erl\"},{line,81}]},{emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,259}]},{gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,615}]},{gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,681}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,240}]}]}\n2017-04-20 03:52:20.045 [error] <0.26009.286>@emqttd_client:received:281 Client(10.4.118.144:57940): Error data: <<22,3,3,0,197,1,0,0,193,3,3,88,248,146,228,222,26,106,183,19,128,238,82,31,114,243,91,109,81,124,172,171,145,237,7,26,215,9,160,147,138,100,106,0,0,58,192,35,192,39,0,60,192,37,192,41,0,103,0,64,192,9,192,19,0,47,192,4,192,14,0,51,0,50,192,43,192,47,0,156,192,45,192,49,0,158,0,162,192,8,192,18,0,10,192,3,192,13,0,22,0,19,0,255,1,0,0,94,0,10,0,52,0,50,0,23,0,1,0,3,0,19,0,21,0,6,0,7,0,9,0,10,0,24,0,11,0,12,0,25,0,13,0,14,0,15,0,16,0,17,0,2,0,18,0,4,0,5,0,20,0,8,0,22,0,11,0,2,1,0,0,13,0,28,0,26,6,3,6,1,5,3,5,1,4,3,4,1,4,2,3,3,3,1,3,2,2,3,2,1,2,2>>\n```. ",
    "karx": "Same issue. Using the lastest version of emqtt. \nIssue occurs when I use built in Helper on admin panel of emqttd. ",
    "TheWaWaR": "Well done!\n. ",
    "fallstool": "@turtleDeng\nhi i encouter the same problem, how to config two-way authentication, thanks.\n. ",
    "serenityluna": "2016-11-15 1:22 GMT-04:30 turtleDeng notifications@github.com:\n\nAttempt 3\nConcatenating chain.pem + Root CA = chainca.pem\nhttps://mosquitto.org/2015/12/using-lets-encrypt-\ncertificates-with-mosquitto/\nSSL Options\nmqtt.listener.ssl.handshake_timeout = 15\nmqtt.listener.ssl.keyfile = etc/certs/keyfile.pem\nmqtt.listener.ssl.certfile = etc/certs/cert.pem\nmqtt.listener.ssl.cacertfile = etc/certs/chainca.pem\nmqtt.listener.ssl.verify = verify_peer\nmqtt.listener.ssl.fail_if_no_peer_cert = true\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/765#issuecomment-260554024, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ASe11_vsLvmYWsDeo6qFN96SE80ehswyks5q-Ui1gaJpZM4KwsDt\n.\n. Friend turtleDeng, Sorry for the delay.\n\nYou are explaining to me that the correct way to configure it is:\nAttempt 3\nConcatenating chain.pem + Root CA = chainca.pem\nSSL Options\nMqtt.listener.ssl.handshake_timeout = 15\nMqtt.listener.ssl.keyfile = etc / certs / keyfile.pem\nMqtt.listener.ssl.certfile = etc / certs / cert.pem\nMqtt.listener.ssl.cacertfile = etc / certs / chainca.pem\nMqtt.listener.ssl.verify = verify_peer\nMqtt.listener.ssl.fail_if_no_peer_cert = true\nSo I probed the configuration from port 8883, and it worked!\nThe problem is that I've always tried the websocket protocol.\nWhich was configured like this:\nMqtt.listener.https.handshake_timeout = 15\nMqtt.listener.https.certfile = etc / certs / cert.pem\nMqtt.listener.https.keyfile = etc / certs / keyfile.pem\nMqtt.listener.https.cacertfile = etc / certs / chainca.pem\nMqtt.listener.https.verify = verify_peer\nMqtt.listener.https.fail_if_no_peer_cert = true\nAnd it still fails!\nBut this time, knowing that I have well configured certificates (Thanks for\nthat!)\nI decide to try other configurations, and I realize that if I comment the\nline, mqtt.listener.https.verify = verify_peer, works the connection\nthrough websocket.\nLeaving the connection as follows:\nMqtt.listener.https.handshake_timeout = 15\nMqtt.listener.https.certfile = etc / certs / cert.pem\nMqtt.listener.https.keyfile = etc / certs / keyfile.pem\nMqtt.listener.https.cacertfile = etc / certs / chainca.pem\nMqtt.listener.https.verify = verify_peer\nMqtt.listener.https.fail_if_no_peer_cert = true\nI would like to know the reason why it is failing, is it normal ?, What do\nthese parameters mean? (Mqtt.listener.https.verify = verify_peer,\nmqtt.listener.https.fail_if_no_peer_cert = true)\nDoes it have to do with what you asked me in your first response? (Do you\nwant to configure one-way authentication or two-way authentication?)\n2016-11-15 9:49 GMT-04:30 serenity luna serenity.luna@gmail.com:\n\n2016-11-15 1:22 GMT-04:30 turtleDeng notifications@github.com:\n\nAttempt 3\nConcatenating chain.pem + Root CA = chainca.pem\nhttps://mosquitto.org/2015/12/using-lets-encrypt-certificate\ns-with-mosquitto/\nSSL Options\nmqtt.listener.ssl.handshake_timeout = 15\nmqtt.listener.ssl.keyfile = etc/certs/keyfile.pem\nmqtt.listener.ssl.certfile = etc/certs/cert.pem\nmqtt.listener.ssl.cacertfile = etc/certs/chainca.pem\nmqtt.listener.ssl.verify = verify_peer\nmqtt.listener.ssl.fail_if_no_peer_cert = true\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/765#issuecomment-260554024, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ASe11_vsLvmYWsDeo6qFN96SE80ehswyks5q-Ui1gaJpZM4KwsDt\n.\n. As you recommended I read the ssl documentation. And I found the following:\nIn mode verify_none the default behavior is to allow all x509-path\nvalidation errors.\n\n\nPlease explain me:\nWhy can not I use verify_peer with websockets (8084), but can I use it with\ntls over tcp (8883)?\n2016-11-15 10:09 GMT-04:30 turtleDeng notifications@github.com:\n\n{verify, verify_type()}\nA server only does x509-path validation in mode verify_peer, as it then\nsends a certificate request to the client (this message is not sent if the\nverify option is verify_none). You can then also want to specify option\nfail_if_no_peer_cert.\n{fail_if_no_peer_cert, boolean()}\nUsed together with {verify, verify_peer} by an SSL server. If set to true,\nthe server fails if the client does not have a certificate to send, that\nis, sends an empty certificate. If set to false, it fails only if the\nclient sends an invalid certificate (an empty certificate is considered\nvalid). Defaults to false.\nSee the ssl documentation for details\uff01\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/765#issuecomment-260658175, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ASe11_nBIfcYx5x_sVfCUhX4yUle6mMgks5q-cQtgaJpZM4KwsDt\n.\n. Best regards.\n\nIt still does not work verify_peer on websockets with TLS (HTTPS / WSS\nListener - 8084)\nI have tried downloading emqttd-ubuntu64-v2.0-rc.3-20161103.zip again and\nrunning on clean, and I still get the same error.\nAlso try other certificates issued by COMODO. I did it just out of\ncuriosity for the checks made with openssl s_client told me that both\nLet's Encrypt and COMODO certificates are well installed.\nThis is the error when I use (mqtt.listener.https.verify = verify_peer)\nErlang MQTT Broker 2.0 is running now\nEshell V7.3  (abort with ^G)\n(emqttd@127.0.0.1)1> 05:37:02.582 [error] Error in process <0.1139.0> on\nnode 'emqttd@127.0.0.1' with exit value:\n{{ssl_error,closed},[{esockd_connection,upgrade,1,[{file,\"src/esockd_connection.erl\"},{line,113}]},{mochiweb_http,init,2,[{file,\"src/mochiweb_http.erl\"},{line,30}]}]}\n05:37:02.583 [error] Supervisor 'esockd_connection_sup - <0.1094.0>' had\nchild connection started with\nmochiweb_http:start_link({emqttd_http,handle_request,[]}) at <0.1139.0>\nexit with reason {ssl_error,closed} in esockd_connection:upgrade/1 line 113\nin context connection_crashed\n05:37:02.889 [error] Error in process <0.1141.0> on node 'emqttd@127.0.0.1'\nwith exit value:\n{{ssl_error,closed},[{esockd_connection,upgrade,1,[{file,\"src/esockd_connection.erl\"},{line,113}]},{mochiweb_http,init,2,[{file,\"src/mochiweb_http.erl\"},{line,30}]}]}\n05:37:02.890 [error] Supervisor 'esockd_connection_sup - <0.1094.0>' had\nchild connection started with\nmochiweb_http:start_link({emqttd_http,handle_request,[]}) at <0.1141.0>\nexit with reason {ssl_error,closed} in esockd_connection:upgrade/1 line 113\nin context connection_crashed\nCOMODO:\nHTTP (SSL) Listener\nMqtt.listener.https = 8084\nMqtt.listener.https.acceptors = 4\nMqtt.listener.https.max_clients = 64\nMqtt.listener.https.handshake_timeout = 2000\nMqtt.listener.https.keyfile = /opt/emqttd/etc/certs/private.key\nMqtt.listener.https.certfile = /opt/emqttd/etc/certs/cert.crt\nMqtt.listener.https.cacertfile = /opt/emqttd/etc/certs/ca-bundle.crt\nMqtt.listener.https.verify = verify_peer\nMqtt.listener.https.fail_if_no_peer_cert = true\nNote: Same configuration in SSL Listener - 8883 works fine!\n. ",
    "Mojo90": "I have the same error. How to deal with that? I already tried to set Mqtt.listener.https.fail_if_no_peer_cert to false and/or Mqtt.listener.https.verify to verify_none. But neither one worked. Help appreciated!\nBtw: I think concatenating is not needed as fullchain.pem already includes Root CA, isn't it?. I did this, but now I get the error:\n```\nroot@emqtt:/home# service emqttd start\nJob for emqttd.service failed because the control process exited with error code. See \"systemctl status emqttd.service\" and \"journalctl -xe\" for details.\nroot@emqtt:/home# systemctl status emqttd.service\n\u25cf emqttd.service - LSB: Erlang MQTT Broker\n   Loaded: loaded (/etc/init.d/emqttd; bad; vendor preset: enabled)\n   Active: failed (Result: exit-code) since Mon 2017-08-14 12:16:39 UTC; 7min ago\n     Docs: man:systemd-sysv-generator(8)\n  Process: 4706 ExecStart=/etc/init.d/emqttd start (code=exited, status=1/FAILURE)\nAug 14 12:15:56 emqtt systemd[1]: Starting LSB: Erlang MQTT Broker...\nAug 14 12:16:00 emqtt su[4787]: Successful su for emqtt by root\nAug 14 12:16:00 emqtt su[4787]: + ??? root:emqtt\nAug 14 12:16:00 emqtt su[4787]: pam_unix(su:session): session opened for user emqtt by (uid=0)\nAug 14 12:16:39 emqtt systemd[1]: emqttd.service: Control process exited, code=exited status=1\nAug 14 12:16:39 emqtt systemd[1]: Failed to start LSB: Erlang MQTT Broker.\nAug 14 12:16:39 emqtt systemd[1]: emqttd.service: Unit entered failed state.\nAug 14 12:16:39 emqtt systemd[1]: emqttd.service: Failed with result 'exit-code'.\nroot@emqtt:/home# journalctl -xe\nAug 14 13:01:17 emqtt systemd[7148]: Reached target Shutdown.\n-- Subject: Unit UNIT has finished start-up\n-- Defined-By: systemd\n-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel\n-- \n-- Unit UNIT has finished starting up.\n-- \n-- The start-up result is done.\nAug 14 13:01:17 emqtt systemd[7148]: Stopped target Paths.\n-- Subject: Unit UNIT has finished shutting down\n-- Defined-By: systemd\n-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel\n-- \n-- Unit UNIT has finished shutting down.\nAug 14 13:01:17 emqtt systemd[7148]: Stopped target Timers.\n-- Subject: Unit UNIT has finished shutting down\n-- Defined-By: systemd\n-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel\n-- \n-- Unit UNIT has finished shutting down.\nAug 14 13:01:17 emqtt systemd[7148]: Starting Exit the Session...\n-- Subject: Unit UNIT has begun start-up\n-- Defined-By: systemd\n-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel\n-- \n-- Unit UNIT has begun starting up.\nAug 14 13:01:17 emqtt systemd[7148]: Received SIGRTMIN+24 from PID 7877 (kill).\nAug 14 13:01:17 emqtt systemd[1]: Stopped User Manager for UID 115.\n-- Subject: Unit user@115.service has finished shutting down\n-- Defined-By: systemd\n-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel\n-- \n-- Unit user@115.service has finished shutting down.\nAug 14 13:01:17 emqtt systemd[1]: Removed slice User Slice of emqtt.\n-- Subject: Unit user-115.slice has finished shutting down\n-- Defined-By: systemd\n-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel\n-- \n-- Unit user-115.slice has finished shutting down.\nlines 1230-1268/1268 (END)\n```\n==================================\nEDIT:\nNot sure why but it worked after one more try.\nBut now I tried to add it do autostart via:\nsudo update-rc.d emqttd defaults\nBut if I reboot the service it not started automatically, rather I have to start it manually via service emqttd start. Whats wrong here?\nAnd how am I able to add to node to a cluster? (http://emqtt.io/docs/v2/cluster.html#join-the-cluster). Yes I now have it. But sometimes it works sometimes not (on a fresh new installation). Thats a little bit weird.\n\n\nroot@sensors2:~# cluster use emqttd_ctl cluster join ***nodename***\nThe program 'cluster' is currently not installed. You can install it by typing:\napt install graphviz\nFrom where should I enter the command?\n\n\nAs mentioned above it is not possible yet to autostart during startup/reboot.. Yes with:\nroot@sensors2:/etc/emqttd# wget \"http://emqtt.com/downloads/latest/ubuntu16_04-deb\"\nroot@sensors2:/etc/emqttd# sudo dpkg -i ubuntu16_04-deb\nroot@sensors2:/etc/emqttd# apt-get install lksctp-tools\n. ok that did work, great thx!\n\n\n====================\nAnd now still remaining: autostart during startup/reboot is not possible.\nTried it with\nsudo update-rc.d emqttd defaults\nBut if I reboot the service it not started automatically, rather I have to first stop the service with sudo service emqttd stop and start it manually via sudo service emqttd start than it works.\nAfter the reboot when I directly check status:\n```\nroot@sensors2:~# sudo service emqttd status\n\u25cf emqttd.service - LSB: Erlang MQTT Broker\n   Loaded: loaded (/etc/init.d/emqttd; bad; vendor preset: enabled)\n   Active: activating (start) since Tue 2017-08-15 09:34:47 UTC; 28s ago\n     Docs: man:systemd-sysv-generator(8)\n  Control: 1403 (emqttd)\n    Tasks: 14\n   Memory: 23.6M\n      CPU: 7.865s\n   CGroup: /system.slice/emqttd.service\n           \u251c\u25001403 /bin/bash /etc/init.d/emqttd start\n           \u251c\u25001833 /bin/sh /usr/sbin/emqttd start\n           \u251c\u25002436 /usr/lib/emqttd/erts-8.3/bin/beam -B -- -root /usr/lib/emqttd -progname erl -- -home /var/lib/emqttd -- -boot start_clean -noshell -run escript start -\n           \u2514\u25002452 erl_child_setup 1024\nAug 15 09:34:47 sensors2 systemd[1]: Starting LSB: Erlang MQTT Broker...\nAug 15 09:35:07 sensors2 emqttd[2332]: Starting up\nAug 15 09:35:15 sensors2 run_erl[1932]: Erlang closed the connection.\n```. ",
    "xerosanyam": "Please give steps on how to Generate a certificate using letsencrypt and use it sucessfully over wss.. @nikoladsp Can you please mention how did you generate the certificate ?\nthis way \nsudo certbot certonly --webroot -w /var/www/example -d example.com -d www.example.com -w /var/www/thing -d thing.is -d m.thing.is\nor \nthis way\nsudo certbot certonly --webroot -w /var/www/example -d example.com -d www.example.com\nI am having trouble generating the certificate and configuring it.\n. What is the meaning of log file count ? \nI can currently see\n1. crash.log\n2. crash.log.0\n3. erlang.log.1\n4. error.log\n5. error.log.0\n6. run_erl.log\nWhat is the meaning of 0,1 suffixes ?\nIs there a way to get only 1 crash.log, 1 erlang.log and 1 error.log and remove old logs from these files like a queue.. Thanks for prompt reply.\nAdding ACL rules in mongo work or I need to add local ACL rules only ?\nie\n1. db.mqtt_acl.insert({username: \"test\", publish: [\"t/1\", \"t/2\"], subscribe: [\"user/%u\", \"client/%c\"]})\nOr \n2. acl.conf\nWill 1 work or need to follow 2nd method ?. @turtleDeng \nI have seen that. The documentation says to set auth.mongo.acl_nomatch = deny. But as you pointed out it does not exist.\nMy question is whether I can still use mongo to set ACL rules ?. I think I figured this out.\nMongo ACL rules work even without adding this parameter.\nauth.mongo.acl_nomatch = deny in emq_auth_mongo.conf\nalso keeping\nmqtt.acl_nomatch = allow in emq.conf will still block if mongo ACL rule is set.\n. @emqplus @turtleDeng Anyone please mention the steps ? I tried the method, still getting ERR_SSL_PROTOCOL_ERROR. Getting ERR_CONNECTION_CLOSED for  :8083/mqtt & ERR_SSL_PROTOCOL_ERROR :18083/. `\nError in process <0.4010.0> on node 'emq@127.0.0.1' with exit value:\n{{ssl_error,{options,{certfile,\"/etc/letsencrypt/live/api.sanyamja.in-0001/fullchain.pem\",{error,eacces}}}},[{esockd_connection,upgrade,1,[{file,\"src/esockd_connection.erl\"},{line,131}]},{mochiweb_http,init,2,[{file,\"src/mochiweb_http.erl\"},{line,30}]}]}\n2017-10-25 15:17:29 =SUPERVISOR REPORT====\n     Supervisor: 'esockd_connection_sup - <0.1490.0>'\n     Context:    connection_crashed\n     Reason:     {{ssl_error,{options,{certfile,\"/etc/letsencrypt/live/api.sanyamja.in-0001/fullchain.pem\",{error,eacces}}}},[{esockd_connection,upgrade,1,[{file,\"src/esockd_connection.erl\"},{line,131}]},{mochiweb_http,init,2,[{file,\"src/mochiweb_http.erl\"},{line,30}]}]}\n     Offender:   [{pid,<0.4010.0>},{name,connection},{mfargs,{mochiweb_http,start_link,[{emqttd_ws,handle_request,[]}]}}]. okay, so ran with sudo command.\nable to connect on wss. but still unable to access the dashboard at https. Thanks for reply!\nTwo questions:\n1. With what frequency, the system publishes datetime at this topic? Is the frequency configurable, if yes, how?\n2. In Acl rules, I have configured user 'A' to subscribe/publish to only topic 'A/#', does that mean, it cannot subscribe to '$SYS/#' ? I mean system topics are also bound in Acl rules?\nThanks in advance. Still trying to get the datetime.. @HJianBo this is not working, tried many permutation combinations.. figured this out.\n$ in $SYS needs to be escaped.\nmosquitto_sub -t \\$SYS/brokers/emq@127.0.0.1/datetime works!\nbut \nmosquitto_sub -t $SYS/brokers/emq@127.0.0.1/datetime or \nmosquitto_sub -t '$SYS/brokers/emq@127.0.0.1/datetime' doen't work.\n\nSystem publishes datetime every second.\n'A' cannot subscribe to '$SYS' if it is only configured in ACL for 'A/#'.. Before crashing, it also says:\n@emqttd_plugins:stop_app:201 Plugin emq_recon is not started\n@emqttd_plugins:stop_app:201 Plugin emq_modules is not started\n@emqttd_plugins:stop_app:201 Plugin emq_retainer is not started\n@emqttd_plugins:stop_app:201 Plugin emq_dashboard is not started\nBut I have not changed anything in any of the above-mentioned modules.\nThis problem started when I changed config in emq_auth_mongo. But I have reverted it to original one, still getting this error. . Verified. Plugins are loading successfully. Once the emqttd crashes for any reason, it crashes again and again\n. any updates on this @emqplus ?. \n",
    "arihantdaga": "Same problem.. cant understand how to setup ssl for websockets using letsencrypt. \nI think documentation lags the clear definition and use of different parameters in configuration.. . Did this but still getting this error -\n```\nFile \"/Users/iamnostar/miniconda3/lib/python3.6/ssl.py\", line 1068, in do_handshake\n    self._sslobj.do_handshake()\n  File \"/Users/iamnostar/miniconda3/lib/python3.6/ssl.py\", line 689, in do_handshake\n    self._sslobj.do_handshake()\nssl.SSLError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:777)\n```\nDo we not have to tell domain name anywhere in the emq.conf ? As my certificates are bound to a specific domain name, right ?\nThis is my code - \nimport paho.mqtt.publish as publish\n```\ntls_param = {'ca_certs':\"fullchain.pem\"}\npublish.single(\"test/topic\", payload=\"abc\", qos=1, retain=False, hostname=\"mydomain.com\",\n           port=8084, client_id=\"923975342346\", keepalive=60, will=None, auth=None,\n           tls=tls_param, protocol=4, transport=\"websockets\")\n```\nAnd do we have to keep this fullchain.pem in mobile applications ? . @grutabow Thank you very much. Solved Now.. \nAlthough i had to add chain.pem as well for get it working with mqtt.js in browser. I uncommented this line as well - \nlistener.wss.external.cacertfile = etc/certs/chain.pem\n. I am still facing this issue- \nGot this in logs - \n```\n2018-05-22 11:05:08.279 [error] <0.1551.0> Supervisor 'esockd_connection_sup - <0.1551.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.3110.0> exit with reason {invalid_proxy_info,<<16,105,0,4,77,81,84,84,4,194,0,10>>} in esockd_connection:upgrade/1 line 122 in context connection_crashed\n2018-05-22 11:05:09.467 [error] <0.3111.0> CRASH REPORT Process <0.3111.0> with 0 neighbours crashed with reason: {invalid_proxy_info,<<16,105,0,4,77,81,84,84,4,194,0,10>>} in esockd_connection:upgrade/1 line 122\n2018-05-22 11:05:09.467 [error] <0.1551.0> Supervisor 'esockd_connection_sup - <0.1551.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.3111.0> exit with reason {invalid_proxy_info,<<16,105,0,4,77,81,84,84,4,194,0,10>>} in esockd_connection:upgrade/1 line 122 in context connection_crashed\n2018-05-22 11:05:10.733 [error] <0.3112.0> CRASH REPORT Process <0.3112.0> with 0 neighbours crashed with reason: {invalid_proxy_info,<<16,105,0,4,77,81,84,84,4,194,0,10>>} in esockd_connection:upgrade/1 line 122\n2018-05-22 11:05:10.734 [error] <0.1551.0> Supervisor 'esockd_connection_sup - <0.1551.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.3112.0> exit with reason {invalid_proxy_info,<<16,105,0,4,77,81,84,84,4,194,0,10>>} in esockd_connection:upgrade/1 line 122 in context connection_crashed\n```\nIf i enable proxy_protocol . I have verified, no client is directly connecting to the broker, every request is coming from the Haproxy itself. I am using EMQ 2.3.6. @terry-xiaoyu  Great.. (y), Thank you..Its working.. . @terry-xiaoyu Thank you.\nI forgot to set  the mqtt.allow_anonymous to false in etc/emq.conf.\nThis worked. \n. In emq.conf you can look for ssl related configurations. If you run into issues you can also check this https://github.com/emqtt/emqttd/issues/765. @terry-xiaoyu Thank you. I think its my bad. I was having 2.3.4. I tested the same thing on 2.3.6 and its working now. Thank you. I am closing this issue.. @terry-xiaoyu Yes, The issue is with firewall, Once i disable it on one of the machine and did cluster join form another, it joined the cluster successfully. But once again if i enable my firewall it's not working. \nI even enabled this port range on my firewall. What else can i set in my firewall to make it work. \n```\n18083/tcp                  ALLOW       Anywhere                \n4369                       ALLOW       Anywhere                \n20000:21000/tcp            ALLOW       Anywhere                \n18083/tcp (v6)             ALLOW       Anywhere (v6)           \n4369 (v6)                  ALLOW       Anywhere (v6)           \n20000:21000/tcp (v6)       ALLOW       Anywhere (v6)  \nThis is my current firewall status, which is not working. Can u suggest whats wrong by looking at it.. . Ok.. @terry-xiaoyu Thank you. It worked.. . @terry-xiaoyu  Can you point me in some direction? Any alternative way yo use this plugin with mongoldb Cluster ? . @terry-xiaoyu Thank you. . Ohk, Thank you @terry-xiaoyu. . Ohk.. Nice.. Thanks a lot.. . I am facing the same issue. This is my config\nlisten mqtt\n  # MQTT binding to port 1885\n  bind domain.com:24231\n  bind domain.com:24232 ssl crt /etc/haproxy/certs/domain.com.pem\n  bind domain2.com:24231\nmaxconn 100000\n# communication mode (MQTT works on top of TCP)\n  mode tcp\n  option clitcpka # For TCP keep-alive\n  timeout client 3h #By default TCP keep-alive interval is 2hours in OS kernal, 'cat /proc/sys/net/ipv4/tcp_keepalive_time'\n  timeout server 3h #By default TCP keep-alive interval is 2hours in OS kernal\n  option tcplog\n  balance leastconn\n  # MQTT server 1\n  server mqtt_1 PRIVAYTE_IP:1883 check send-proxy-v2\n  # MQTT server 2\n  server mqtt_2 PRIVAYTE_IP2:1883 check send-proxy-v2\nlog         127.0.0.1 local2 err\n```\nCan someone help me figure out the right way to configure it.. . ",
    "SongCF": "Hello, @emqplus \nIs it possible to cancel or delete published message before the subscriber receives?\n. ",
    "shon-penteer": "Thanks,\n@emqplus Will this feature be available in the near future?\n. Is there a workaround I can use meanwhile, or a direction I can be pointed to solve the issue of bridging EMQ to Mosquitto myself?\nOn 18 \u05d1\u05e0\u05d5\u05d1\u05de\u05d1\u05e8 2016 03:16:50 GMT+02:00, Feng Lee notifications@github.com wrote:\n\n@shon-penteer We could support this feature if more users star this\nissue, I think.\n\nYou are receiving this because you were mentioned.\nReply to this email directly or view it on GitHub:\nhttps://github.com/emqtt/emqttd/issues/769#issuecomment-261421346\n. \n",
    "pritstift": "Have the same Issue. Bridged rsmb to EMQ and wanted to bridge EMQ to rsmb also, since the mqtt-sn plugin seems not like working correctly.. Just for the case someone comes across while trying to EMQ bridge to rsmb (And maybe this should be added to the documentation):\nYou can make rsmb subscribe and push to topics on the EMQ broker like in the following way (see rsmb documentation)\nconnection emqttd\n        address 127.0.0.1:1883\n        topic r/# in \"\" \"\"\n        topic w/# out \"\" \"\" . I tried with Erlang 19.01. Same issue.\nI am running on Mac OS 10.12.3\nI installed Erlang using the Erlang installer. I will try installing it with homebrew. Problem might be that on Mac OS Sierra wxmac will not compile. Therefore i will try brew install erlang --without-wxmac.\nIs wxmac needed to compile EMQ?. Well unfortunately it still does not work :-(. Thanks. Will give it a try when the new release comes out \ud83d\udc4d . Thanks for bringin out the new release.\nIt seems to work so far. Thank you very much! But something seems wrong when i have a look at the logs:\n23:38:20.602 [error] MQTT-SN(127.0.0.1:57342): UNEXPECTED INFO: emit_stats\n23:38:20.602 [error] MQTT-SN(127.0.0.1:57342): UNEXPECTED INFO: {subscribe,[{<<\"$client/mqtt-sn-tools-99190\">>,1}]}\nIs this something to be worried about?. I tested it for some while and it works. Thank you very much. I am closing this issue now. \nBut I think this solution does not fix the actual problem that you cannot have ACL based on IP adresses without authentication (e.g. even if you are not using the emq_sn plugin). \nI would prefer having an option in the auth_pgsql plugin that turns off authentication.. \ud83d\udc4d \nI would also like to have that feature. The EMQ docs say you can bridge two EMQ brokers together. Would be great if i could bridge to any other kind of broker. . thanks, looking forward to it. These hooks would be very helpful. When do you plan to support these hooks?. Any news on this issue? I could also try to contribute, if you give me some info on how the hooks are implemented. \nKeep rocking!. Is there any update on this issue? . Hi @Gilbert-Wong, will try it out! Thanks very much. After testing a bit i found that probably the encoding of the hash plays a role. Mine is base64 encoded. But it seem to work, when the last sign does not equal =. That was the trick. I think that the docs should be updated accordingly. I can do this if you tell me where i find its repo.. Neither does this work:\nauth.pgsql.acl_query = select allow, ipaddr, device_id as clientid, '$all' as username, access, topic from device_deviceacl where device_id = '%c'\nor this work: \nauth.pgsql.acl_query = select allow, ipaddr, device_id as clientid, null as username, access, topic from device_deviceacl where device_id = '%c'. My mistake. I changed the order of clientid and username field in the sql query. The correct query is\nauth.pgsql.acl_query = select allow, ipaddr, null as username, device_id as clientid, access, topic from device_deviceacl where device_id = '%c'. Would it be possible to add admin users in a configuration file?. What about passing it through command line argument when starting the broker using emqttd?. ARG! My fault. Client id was too long! So if everyone else is encountering such an error:\n\nAs with MQTT, the ClientId field has a variable length and contains a 1-23 character long string that uniquely identifies the client to the server.. Nevermind.... \n",
    "jlgm": "@emqplus @hachreak Is the order of checks determined by the order in which the plugins were loaded? My tests indicate yes but I wasn't able to confirm. . Hi, @HJianBo. Thank you for your reply!\nI was able to identify that the Cursor was causing the issue \u2013 in fact, even if you don't use mc_cursor:rest but instead use mc_cursor:close, the same error will happen.\nDo you think this is something that might crash my application or I can simply ignore it for now?. ",
    "watchworld": "emqtt have access control plugin. what instead of?. paho mqtt client. What scenario can produce this situation\uff1f. ",
    "renwanly": "Sorry for my poor describe.\nMy point is how to remove the sub topic IMMEDIATELY, for the live session ?. you can temp block it by firewall ;-). ",
    "Benniu": "Verified in 2.0.2 build. Thanks for the quick fix.. @renwanly Yes, I have to block it via security rules now.. ",
    "donaldjarmstrong": "any update @arvindr21 on your testing and configuration?. ",
    "JonnyYadav": "Hi,\nPlease help me out for emq 2.x, I've configure EMQ 2.x on a Ubuntu 16.04 machine with specs 16 CPU and 60 GB RAM. Also tune the kernel and EMQ file. But in load testing for EMQ, we are not able to achieved 1 Millions concurrent connection on above machine.\nroot@broker-server:~/mqtt-2/emqttd# ./bin/emqttd_ctl listeners\nlistener on mqtt:api:0.0.0.0:8080\n  acceptors       : 4\n  max_clients     : 64\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:wss:8084\n  acceptors       : 4\n  max_clients     : 64\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:ssl:8883\n  acceptors       : 16\n  max_clients     : 1024\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:ws:8083\n  acceptors       : 4\n  max_clients     : 102400\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:tcp:0.0.0.0:1883\n  acceptors       : 64\n  max_clients     : 1000000\n  current_clients : 1673\n  shutdown_count  : [{protocol_not_connected,41998},{conflict,9},{idle_timeout,58107},{etimedout,2486},{closed,654401}]\nlistener on mqtt:tcp:127.0.0.1:11883\n  acceptors       : 4\n  max_clients     : 102400\n  current_clients : 0\n  shutdown_count  : []\nlistener on dashboard:http:18083\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 4\n  shutdown_count  : []\nroot@broker-server:~/mqtt-2/emqttd# \nFor more details please see the screenshot.\nSo please suggest me some way to achieved this.\nThanks in Advance\nJonny Yadav\n\n\n. ",
    "rahulfk": "is there any documentation on how this feature works??. ",
    "cocowalla": "I'm also looking for any documentation on how to use x509 client authentication, how to specify trusted issuers, and whether it works when using web sockets?. Ah, I assumed with no auth plugins it would validate against the list of users created from the dashboard/CLI (that's RabbitMQ's behaviour), but now it makes sense :smile:\nIs this behaviour available as a plugin (just validating user exists)? . @terry-xiaoyu I've tried that, and now I get:\nemqx_1.1.xid7xqi4pyda@linuxkit-00155d3ad131    | (emqx@10.0.23.3)1> 2018-11-17 19:38:02.275 [error] MyClientId@10.255.0.2:41260 [MQTT] Username 'undefined' login failed for password_undefined\nI still have peer_cert_as_username = cn set, so I'm not sure why it shows Username 'undefined'.\nHere's what I did:\n\nAdded emqx_auth_username to the list of plugins in EMQX_LOADED_PLUGINS\nVerified that emqx_auth_username is mentioned in the logs when the broker starts\nVerified in the dashboard that the emqx_auth_username plugin has started\nIn the dashboard, I added a user with the same name as the client's certificate CN\n\nIn that last step it did force me to enter a password for the user, even though I don't need one - I presume this is ignored when peer_cert_as_username = cn?. I'm using the v3 RC3 dockerfile, but when I try to create a new application, the 'AppSecret' field seems to be missing from the modal? . I'll try that, thanks!\nThis was really not obvious for me though - what are your thoughts on:\n\nUpdate the docs to explain how to authorise users to use the REST API\nUpdate the dashboard, so the Application modal contains some help text that explains that a secret will be automatically generated after saving\n. \n",
    "avenetj": "Hi, I'm also looking for such documentation. ",
    "sanket-kulkarni-vmware": "@Abouzeid You could try this,\n```\n{allow, {user, \"username\"}, subscribe, [\"topic\"]}.\n{deny, all}.\n```. Hi @turtleDeng  my issue got fixed, I was facing the issues because of existing certs provided in the default installation of EMQTT. Default SSL certs provided in the certs folder are not working.\nI have created a new set of the client-server key pair and they are working fine now. \n. @emqplus Thank you for the clarification. Could you please share what is planned release date for 2.0.5 version?. @emqplus: I have tested EMQTT 2.0.5 version for this feature but looks like this feature is not incorporated into it or do I need to make changes into config file to work this feature?\n. @emqplus Can I specify following expression for pub/sub in acl.conf file to refer the client-id?,\n{allow, {user, \"test-user\"}, pubsub, [\"user/%c\"]}.\n. ",
    "michaelcplusplus": "Thanks for the fix. Websockets are working again.. The following solution works for me:\nModification in emqttd.cmd\n:: Start a console\n:console\n@call :create_mnesia_dir\n@call :generate_app_config\n@set args=%sys_config% %args_file% %generated_config_args% -mnesia dir '%mnesia_dir%'\n:: @start \"%rel_name% console\" %werl% -boot \"%boot_script%\" %args%\n%erl_exe% -noinput -boot \"%boot_script%\" %args%\n@goto :eof\nCreate a new batchfile \nstart_emqttd.cmd\ncd c:\\emqttd\\emqttd-2.0.4\\\nbin\\emqttd console > my.log\nInstall the batchfile start_emqttd.cmd with nssm.exe as windows service.\nStart and stop of the windows service works fine.\nThe memory consumption is fine.\nDoes anyone have any recommendations about this solution.\nBest regards \nMichael\n. Now I work with the following solution:\n\n\nExtract the content of the zip emqttd-windows10-v2.2.0.zip in a directory\nc:\\emqttd\\emqttd-windows10-v2.2.0\n\n\nDo all the config work\ne.q. emq.conf file\nc:\\emqttd\\emqttd-windows10-v2.2.0\\etc\\emq.conf\nc:\\emqttd\\emqttd-windows10-v2.2.0\\etc\\plugins\\emq_dashboard.conf\nand so on ...\n\n\nStart once the broker via the \nbin\\emqttd console\n\n\nStop the broker\n\n\nRename the generated config file in c:\\emqttd\\emqttd-windows10-v2.2.0\\data\\configs\\\napp.2017.10.12.10.31.53.config -> app.config\nvm.2017.10.12.10.31.53.args -> vm.args \napp.2017.10.12.10.31.52.conf -> app.conf\n\n\nPut this command in a batch file\n\n\n\"c:\\emqttd\\emqttd-windows10-v2.2.0\\erts-8.3\\bin\\erl.exe\" -noinput -boot \"c:\\emqttd\\emqttd-windows10-v2.2.0\\releases\\2.2\\emqttd\"    -config c:/emqttd/emqttd-windows10-v2.2.0/data/configs/app.config -args_file c:/emqttd/emqttd-windows10-v2.2.0/data/configs/vm.args -vm_args c:/emqttd/emqttd-windows10-v2.2.0/data/configs/vm.args  -mnesia dir 'c:/emqttd/emqttd-windows10-v2.2.0/data/mnesia/hydra1@127.0.0.1'\n\nStart the batch file with nssm.exe\n. My solution is just a manual woraround.\nI can not initiate a pull request for these manual steps.. Don't have this problem. Maybe You have a port conflict.. Fixed in Release 2.0.6. I have no problem to install the service. \n\nBut I'm not able to start the service. \nMessages from the Windows Eventlog:\nErlSrv:  emqttd_2.0.6: Not enough parameters for erlang service.\nErlSrv: emqttd_2.0.6: Could not start erlang machine\nRegistry entry:\n\n. Yes, of course.\nThe bin/emqttd.cmd file exists. \nI have no problems to start the emqttd broker with one of the following commands from the command line:\nbin\\emqttd console\nbin\\emqttd start\nThe stopping works also from the command \nbin\\emqttd start\nBest regards\nMichael\n. Please note:\nThe registration works but the windows service could not be started.\n\nThe emqttd version 1.1.3 could be started as windows service without any problems. This version works fine for me.\nIf I run emqttd version 1.1.3 as windows service then there are two processes in the windows taskmanager:\nProcess 1\nC:\\emqttd\\emqttd-1.3\\erts-7.3\\bin\\erlsrv.exe\nProcess 2\n\"C:\\emqttd\\emqttd-1.3\\erts-7.3\\bin\\erl.exe\"  -service_event ErlSrv_emqttd_1.1.3 -nohup -sname emqttd   -boot \"C:\\emqttd\\emqttd-1.3\\releases\\1.1.3\\emqttd\" -config \"C:\\emqttd\\emqttd-1.3\\etc\\emqttd.config\" -args_file \"C:\\emqttd\\emqttd-1.3\\etc\\vm.args\" -pa \"C:\\emqttd\\emqttd-1.3\\plugins\\emqttd_auth_http\\ebin\" \"C:\\emqttd\\emqttd-1.3\\plugins\\emqttd_dashboard\\ebin\" \"C:\\emqttd\\emqttd-1.3\\plugins\\emqttd_plugin_mongo\\ebin\" \"C:\\emqttd\\emqttd-1.3\\plugins\\emqttd_plugin_mysql\\ebin\" \"C:\\emqttd\\emqttd-1.3\\plugins\\emqttd_plugin_pgsql\\ebin\" \"C:\\emqttd\\emqttd-1.3\\plugins\\emqttd_plugin_redis\\ebin\" \"C:\\emqttd\\emqttd-1.3\\plugins\\emqttd_plugin_template\\ebin\" \"C:\\emqttd\\emqttd-1.3\\plugins\\emqttd_recon\\ebin\" \"C:\\emqttd\\emqttd-1.3\\plugins\\emqttd_reloader\\ebin\" \"C:\\emqttd\\emqttd-1.3\\plugins\\emqttd_stomp\\ebin\" \n. I guess the missing starts_erl.cmd script is responsible for the problem.\n\n. Tested with emqttd-windows10-v2.1.0-rc.2 on windows 10.\n\nThe service can be installed. \nBut the service could not be started.\nWindows Event viewer:\nEntry 1\n\nEntry 2\n\n. Tested with emqttd-windows10-v2.2-beta.2 on windows 10.\nThe service can be installed.\nBut the service could not be started.\nWindows Event viewer:\nEntry 1\n\n\n. Please see https://github.com/emqtt/emqttd/issues/803\n. Build on windows works again.. Thanks. The emq_lua_hook works now.. Does still not work in  2.2-beta.1:\nemqttd system monitor is starting...[ok]\nLoad emq_mod_presence module successfully.\nLoad emq_mod_subscription module successfully.\ndashboard:http listen on 0.0.0.0:30105 with 2 acceptors.\nmqtt:tcp listen on 127.0.0.1:11883 with 16 acceptors.\nmqtt:tcp listen on 0.0.0.0:30101 with 16 acceptors.\nmqtt:ws listen on 0.0.0.0:30103 with 4 acceptors.\nmqtt:ssl listen on 0.0.0.0:30102 with 16 acceptors.\nmqtt:wss listen on 0.0.0.0:30104 with 4 acceptors.\nemqttd 2.2 is running now\nEshell V8.1  (abort with ^G)\n(emqttd@127.0.0.1)1> 08:52:19.100 [error] Lua Hook: Failed to load lua script \"h\nook_lua/abc.lua\" due to error {undef,[{luerl_scan,string,[\"function on_message_p\nublish(topic, payload, qos, retain)\\n    return \\\"changed/topic\\\", \\\"hello\\\", qo\ns, retain\\nend\\n\\nfunction register_hook()\\n    return \\\"on_message_publish\\\"\\ne\nnd\\n\"],[]},{luerl_comp,do_read_file,1,[{file,\"src/luerl_comp.erl\"},{line,176}]},\n{luerl_comp,do_passes,2,[{file,\"src/luerl_comp.erl\"},{line,133}]},{luerl_comp,co\nmpile,2,[{file,\"src/luerl_comp.erl\"},{line,98}]},{luerl,loadfile,2,[{file,\"src/l\nuerl.erl\"},{line,95}]},{luerl,dofile,2,[{file,\"src/luerl.erl\"},{line,72}]},{emq_\nlua_hook_cli,do_load,1,[{file,\"src/emq_lua_hook_cli.erl\"},{line,177}]},{emq_lua_\nhook_cli,'-do_loadall/0-lc$^0/1-0-',1,[{file,\"src/emq_lua_hook_cli.erl\"},{line,1\n73}]}]}. I have build emqttd from source on SLES11.. Works fine in emqttd 2.2 beta 2.\nMany thanks. Good job.. Tested with 2.2-beta.3\nThe problem still exists:\n\n\n. The problem is not solved. I will wait to release 2.3.Until then I use the binary version.I need the build environment only for a elixir plugin enhancement.. The workaround does not solve the complete problem. \nThe goldrush build problem does still exists:\nDEP    emq_lua_hook\n DEP    emq_auth_jwt\n DEP    emq_lwm2m\nmake[1]: Verzeichnis \u201e/home/ml/emq-relx/deps/goldrush\u201c wird betreten\nmake[1]: *** Keine Ziele.  Schluss.\nmake[1]: Verzeichnis \u201e/home/ml/emq-relx/deps/goldrush\u201c wird verlassen\nmake: *** [erlang.mk:312: deps] Fehler 2\nThe Makefile in the goldruch directory seems to be incomplete:\nc:\\msys64\\home\\ml\\emq-relx\\deps\\goldrush\\Makefile\n```\nIGNORE_DEPS += edown eper eunit_formatters meck node_package rebar_lock_deps_plugin rebar_vsn_plugin reltool_util\nC_SRC_DIR = /path/do/not/exist\nC_SRC_TYPE = rebar\nDRV_CFLAGS = -fPIC\nexport DRV_CFLAGS\n```\n. Workaround see: https://github.com/emqtt/emqttd/issues/803. Seems to be the same problem as https://github.com/emqtt/emqttd/issues/871\nWorkaround see: https://github.com/emqtt/emqttd/issues/803\n  . Same problem as #803. Thanks a lot!. ",
    "scytalezero": "Thanks very much for sharing; this is working for me currently on Windows. I'm running it with pm2 but the result is the same.. ",
    "sinegole": "This is not added in 2.3-beta.3 version yet. Please can someone fix this problem. How you expect to people use this if can't install.. Any solution for this problem, the latest versions are useless. I can't start service. Solution #803 also don't work on my PC.. ",
    "epopoee": "had problems with installing the batch file as nssm service. Analyzing my problems I found that when running \"emqttd console\" emqttdlaunches an erl.exe, which finally starts a werl.exe process, which really does the job. I grabbed the werl.exe command line from process properties in Process Explorer:\n\"C:\\emqttd\\emqttd-windows10-v2.3-rc.1\\erts-8.3\\bin\\werl.exe\"  -boot \"C:\\emqttd\\emqttd-windows10-v2.3-rc.1\\releases\\2.3\\emqttd\"    -config c:/emqttd/emqttd-windows10-v2.3-rc.1/data/configs/app.config -args_file c:/emqttd/emqttd-windows10-v2.3-rc.1/data/configs/vm.args -vm_args c:/emqttd/emqttd-windows10-v2.3-rc.1/data/configs/vm.args  -mnesia dir 'c:/emqttd/emqttd-windows10-v2.3-rc.1/data/mnesia/emq@127.0.0.1')\nBTW: Config file names already renamed/clipped as described by @michaelcplusplus above\nUsing this I installed an nssm service with \n- Application Path:\n\"C:\\emqttd\\emqttd-windows10-v2.3-rc.1\\erts-8.3\\bin\\werl.exe\"\n- Application Arguments: \n-boot \"C:\\emqttd\\emqttd-windows10-v2.3-rc.1\\releases\\2.3\\emqttd\"    -config c:/emqttd/emqttd-windows10-v2.3-rc.1/data/configs/app.config -args_file c:/emqttd/emqttd-windows10-v2.3-rc.1/data/configs/vm.args -vm_args c:/emqttd/emqttd-windows10-v2.3-rc.1/data/configs/vm.args  -mnesia dir 'c:/emqttd/emqttd-windows10-v2.3-rc.1/data/mnesia/emq@127.0.0.1')\nand very important: \n- Application Startup Directory (path is the emqttdroot dir with bin, data, etc, ...): \nC:\\emqttd\\emqttd-windows10-v2.3-rc.1\nThe latter enables werl.exe to find the config files inC:\\emqttd\\emqttd-windows10-v2.3-rc.1\\etc.\nWorked for both Windows 7 and Windows 10. Fully agree with Michael\n. workaround is here https://github.com/emqtt/emqttd/issues/803. ",
    "twmarr": "Is there an ETA on When this would be fixed so that manual steps do not have to be done?. Is there an ETA or any plans what-so-ever to fix this so it will run as a service on a Windows platform?  Manual work-arounds or manual interventions are NOT acceptable in my particular situation, unfortunately.  The problem still exists with v2.3.4.\n. ",
    "fengbozs": "@michaelcplusplus @epopoee Thank you very much for solving my problem, but by installing the service in this way, port 18083 did not open properly (emqttd 2.3.11)\uff1f. ",
    "yasithab": "You do not need to do any modifications in emqttd.cmd script if you are using the latest builds. Tested on EMQ 2.3.11 and 3.0.1. Please find the complete configuration guide here.. ",
    "chimit": "Thank you! I uncommented \nmqtt.listener.ssl.cacertfile = etc/certs/cacert.pem\nand specified CA certificate on both: MQTT and WebSockets and everything started working.\nMaybe some details in documentation are needed.. Having the similar problem on HTTP POST publishing over SSL.\n(emqttd@127.0.0.1)1> 04:31:00.234 [error] Error in process <0.1124.0> on node 'emqttd@127.0.0.1' with exit value:\n{badarg,[{erlang,list_to_binary,[undefined],[]},{emqttd_http,http_publish,1,[{file,\"src/emqttd_http.erl\"},{line,94}]},{mochiweb_http,headers,5,[{file,\"src/mochiweb_http.erl\"},{line,75}]}]}\n04:31:00.234 [error] Supervisor 'esockd_connection_sup - <0.1097.0>' had child connection started with mochiweb_http:start_link({emqttd_http,handle_request,[]}) at <0.1124.0> exit with reason bad argument in call to erlang:list_to_binary(undefined) in emqttd_http:http_publish/1 line 94 in context connection_crashed. Here is one more problem: all users are authenticated as Superusers even if auth.http.super_req returns Error 4xx. So currently HTTP Auth/ACL Plugin is insecure.. @turtleDeng you are wrong. On HTTP Publish an emqtt broker makes an HTTP request to the http://127.0.0.1:8080/mqtt/superuser endpoint. You can see it in the emqtt console.\nAnyway, if it doesn't support superuser and acl why all these settings exist in the emq-auth-http plugin?\nhttps://github.com/emqtt/emq-auth-http/blob/master/etc/emq_auth_http.conf. Sorry, I accidentally pushed some another commits into my fork and they appeared here. Reverted it back, so now it's ready to merge.. ",
    "HarishHothi": "Hi\n   I was evaluating emqtt broker for our IoT product. We need to support TLS-PSK based encryption. Is there any planned road-map to include this feature?. ",
    "imZack": "Any updates?. ",
    "andy2046": "@emqplus hi Feng, may I check with you the progress for this enhancement? thanks.. ",
    "zssnpl": "when run ./bin/emqttd_ctl plugins load emq_auth_mysql  the error is still\nmy emq_auth_mysql.conf is error? or other reason\uff1f. ",
    "brylie": "\nwe are working on the Monitor/Management/Control APIs these days:)\n\nWill these APIs be accessible via REST? Where may we see the work in progress?\nSpecifically, we may soon need a management endpoint to create HTTP users, for authentication and creating ACL rules.. @emqplus the dashboard looks very nice. Great work :smiley: \nCould you please respond to the question(s) regarding the EMQ management REST API?. Based on a question in a different issue, here are a couple of API design guides that I have found recently:\n\nGoogle Api Design Guide\nZalando RESTful API guidelines. \n",
    "willin": "mark. ",
    "SMekhin": "Then if you said that it can't be help since it was feature that mosquitto and hive have had. By the way I really like your eMQTT broker.. Thank you for qos upgrade\n\nUpgrade QoS\nSupport to upgrade QoS accoding to the subscription:\nmqtt.session.upgrade_qos = on. Hi @ahmedqadeer1989 \nI used https://nodered.org/ for store messages in MYSQL database. It easy to use for me and they have docker image.\n. \n",
    "varnerac": "What dependencies?. ",
    "Tabrizian": "I have this problem too. Is there anyway to fix it?. Sorry, my mistake. It was 2.0.7.. Sorry for the delay. I checked it and saw the upgrade field equals websocket.. Thank you very much. It seemed like there was a problem with the network.. ",
    "MuskaWu": "I try reference\nhttps://github.com/emqtt/emqttd/issues/108\nthen result no change. @turtleDeng \nI apply Godaddy Domain Name : XXXX.com : and mapping AWS Elastic IP \ntry open browser  XXXX.com . display => Testing 123... page (httpd) \nI start setup emqttd \nedit emq.conf \n    node.name = emqttd@XXXX.com\n[emqttd]#./bin/emqttd console\n[emqttd]#./bin/emqttd start\n[emqttd]# ./bin/emqttd_ctl status\nNode 'emqttd@XXXX.com' not responding to pings.\n\u2191\u2191\u2191 Orz \u2191\u2191\u2191\nIs not it my wrong to Check my domain mapping ip & machine ip \n. I change emq.conf\nnode.name = emqttd@127.0.0.1\ncommand:\n[root@ip-xxx-xxx-xxx-xxx emqttd]# ./bin/emqttd_ctl status\nNode 'emqttd@127.0.0.1' not responding to pings.\n[root@ip-xxx-xxx-xxx-xxx emqttd]# ./bin/emqttd start\nemqttd 2.0.3 is started successfully!\n[root@ip-xxx-xxx-xxx-xxx emqttd]# ./bin/emqttd_ctl status\nNode 'emqttd@127.0.0.1' is started\nemqttd 2.0.4 is running\n[root@ip-xxx-xxx-xxx-xxx emqttd]#\nlook emqttd@127.0.0.1 is responding to pings OK!\nExcept emq.conf and other file need edit??. later I eidt emq.conf\nnode.name = emqttd@xxx.xxx.xxx.xxx\n(note:xxx.xxx.xxx.xxx =>AWS \"Private IP\") before public IP was node not responding to pings\n[etc]# vi emq.conf\n[retc]# export EMQ_NODE_NAME=emqttd@xxx.xxx.xxx.xxx\n[emqttd]# ./bin/emqttd start\nemqttd 2.0.3 is started successfully!\n[emqttd]# ./bin/emqttd_ctl status\nNode 'emqttd@xxx.xxx.xxx.xxx' is started\nemqttd@xxx-xxx-xxx-xxx\nemqttd@yyy-yyy-yyy-yyy\nNode is started \nemqttd 2.0.4 is running\nbut join cluster failed\n[root@ip-yyy-yyy-yyy-yyy emqttd]# ./bin/emqttd_ctl cluster join emqttd@xxx-xxx-xxx-xxx\nFailed to join the cluster: {node_not_running,'emqttd@xxx-xxx-xxx-xxx'}\n. cluster problem\nreference https://github.com/emqtt/emqttd/issues/496. ",
    "forest-yang": "I have seen this description: \"Every node in the cluster will store a topic trie and route table in mnesia database.\". is it possible to store topic & client out side broker?. @emqplus ,thank you, are there any plan of this feature ( exposure a micro service to separate the connection and routing layer ) ?. thanks for the information. \nBridge solution will sync ALL data between brokers, right? \nLet me describe this scenario/expectation:\nTwo system (EMQ server) deploy in two data center with active-active relation, so they can achieve Geo-redundancy.\nMQTT client maybe connect any one of system of two system (by DNS).\nFor up-link message, when EMQ server receive message, it can handle, such as save into database or trigger event defined.\nFor down-link message, there are two sub-scenarios:\nif client is online, then server know which EMQ system should use;\nif client is offline, how to coordinate two EMQ across data center, when client wake-up and connect with one of EMQ server, it can fetch message.. ",
    "marcoleunghk": "WoW. work! Thanks a lot  \u8b1d\u8b1d\u4f60. ",
    "miks": "In FreeBSD you need to use gmake instead of make for building from source. Environment\n\nOS: Ubuntu 16.04.3 LTS\nEMQ:\nErlang MQTT Broker version : 2.3.1\n\nI wan't to reopen this issue as we are having memory leaks over the time.\nEMQ has default settings with mqtt.mqueue.max_length = 1000 as mentioned above.\nIs there any debug configuration possible to help with memory leak debugging?. Also, this one looks very similar - #1175. @emqplus can you, please, enlighten me why there memory usage is growing over time?\n  . That is, I want to know how shared subscription is related to prevention of memory leaks.. We are experiencing same behaviour. See #1070.. Are pull requested welcomed for this?\nI want to make 3rd optional secret argument like mgmt insert <AppId> <Name> <Secret>. In any case I created pull request here https://github.com/emqx/emqx-management/pull/20 . ",
    "spring2maz": "I have checked out v2.0.4 code\nthe code logic which drops old message when it hits the limit is very straightforward:\nin(Msg, MQ = #mqueue{type = simple, q = Q, len = Len, max_len = infinity}) ->\n    MQ#mqueue{q = queue:in(Msg, Q), len = Len + 1};\nin(Msg, MQ = #mqueue{type = simple, q = Q, len = Len, max_len = MaxLen, dropped = Dropped})\n    when Len >= MaxLen ->\n    {{value, _Old}, Q2} = queue:out(Q),\n    MQ#mqueue{q = queue:in(Msg, Q2), dropped = Dropped +1};\nin(Msg, MQ = #mqueue{type = simple, q = Q, len = Len}) ->\n    maybe_set_alarm(MQ#mqueue{q = queue:in(Msg, Q), len = Len + 1});\nThere are more lines of code when priority is set, but pretty much the same logic. \nThis makes me wonder if the mqtt.queue.max_length = 1000 config really took effect\n(because otherwise it defaults to infinity).\n@sanket-kulkarni-vmware It's very awkward to ask for more info after this long time,\nbut I'm stuck, if this is still an issue,\ncould you please inspect the result of emqttd:env(queue) from remote shell?\n. Since a session can be persistent, it may also be used for shared and non-shared subscription at the same time, there is not going to be a generic enough solution out of the box.\nOne workaround for now is to use only clean session for shared subscribers.\nI am planing to add a connection state check in #1872. The idea is that shared dispatches will be negative-acked by the session if there is not an active connection so the sender session can pick the next member in the group (next depends on the dispatch strategy).\nThe current plan is to only add this check for QoS1 and QoS2 messages though.. @perroudchris yes, nagitive ack for QoS1/2 messages has been released in 3.0\nthe issue you reported above sounds odd to me, I will look into the code also see if I can reproduce it.\n. Hi again @perroudchris, sorry that I missed clean-session = false part.\nIf the messages are of QoS0, that\u2019s the expected behavior.. @perroudchris I'll have a look into and get back to you later.. you beat me to it, awesome @perroudchris \nIf you do not mind, I would like to close this issue from here and start a new issue to track message persistence issue.. Hi @homerzhou $local/$share is now considered deprecated.\n3.0 (beta 2 so far) has a new shared subscribe implementation and we believe there should be no such issue. Please give it a try.. trying to reproduce it.. Hi @qiujiancn I was trying to reproduce it in 3.0-beta.2 which turn out to have local-share deprecated already. It is a completely new implementation in 3.0 for shared subscription, please give it a try.. /opt/iot-platform/ebk-broker-config-emqtt/mqtt_server.key\",{error,eacces}\nThis suggests the user running emqttd has no permission to read the file \n. Hi @phper-chen \nWhat do you mean by 'firewall is closed'?\nif it is closed, the nodes will not be able to connect each other.\nPlease note that firewall needs to be open between two nodes for pretty much ALL ports.\n(Otherwise it must be open for EPMD 4369, and a manually set fixed port range for Erlang distribution listener).\nAnother typical reason is Erlang cookie being different between A and B.\nEMQ_NODE_COOKIE is the variable to set from environment.\n. fixed typos and wording. @Gilbert-Wong Thanks for the review, made a minor change and squashed into the last commit.\nDiff since last review:\nGot rid of the intermediate dep-versions tmp file for make dep-vsn-check\nAlso changed clique's branch from fix-get-stacktrace-for-otp-21 to develop.  included in #1808 . rebase. fixed review comments.. parameterized module is not supported (not officially) since otp 21\ndo we really want to add it with an ugly hack ?. @mzy2240 would be great if you can share the logs from emqx. . coverage degrade alert! . lack of a shared subscription test case ?. Hi @mdrobny \nThanks for reporting this. Which version emqttd or emqx is it ?\nAll other places in our conf file have white space after the = sign.\nThis PR should be merged for the sake of style consistency even without any issue.\n. Nonetheless, this looks very odd to me because:\n1. If you (on latest emqx30 branch) run make app.config\nthen inspect plugins_etc_dir in the generated app.<ts>.config config file in data dir\nthe config should be there.\n\nThe generated parser code\n-spec 'setting'(input(), index()) -> parse_result().\n'setting'(Input, Index) ->\n  p(Input, Index, 'setting', fun(I,D) -> (p_seq([p_zero_or_more(fun 'ws'/2), fun 'key'/2, p_zero_or_more(fun 'ws'/2), p_string(<<\"=\">>), p_zero_or_more(fun 'ws'/2), fun 'value'/2, p_zero_or_more(fun 'ws'/2)])\n    [ _, Key, _, _Eq, _, Value, _] = Node,\n    {Key, Value}\n end).\nThe expected number of space after = is zero_or_more.\n\nIt looks to me injecting the space was not the 'true' fix to your issue\uff0c\nperhaps a restart triggered config reload?. Hi. @gbrehmer \npersistent sessions are indeed treated equally regardless of connection status.\ncould you please create an Issue for discussion? we'll see what we can do from there.. Hi @nerdial \nAccording to MQTT spec, messages are always published to topics,\nnever published targeting any specific client-id.\nOne can of course use unique topic to make it work like an 'id'.\nAs far as I know, emqx does not support anything special in this regard.\nTo your second question (not sure if I completely follow though):\nMessages are broadcasted to all clients who subscribes to that specific topic\n(or wildcard topic which matches the producer's target topic).\nOne exception is shared-subscription, if two or more clients subscribe to the same group,\nmessages are randomly delivered to one of the clients in the group.\n. rebased. rebased to resolve conflict.. Please remove emqx_misc from ct list in Makefile too.. @Gilbert-Wong What was the reason to move eunit to ct but not the other way around ?\nIMO, for light-weight tests like this, it's better to have them in eunit, because eunit is faster to run.\n. IMO. For whatever reason they exist, we should stop doing that,\nand start using _tests modules for real eunit tests.. @cbluth It's a bug, fixed in rc2.\nhttps://github.com/emqx/emqx-rel/commit/145ae6c4f4afd9d86a6449f6fc9a2ab78d5183c9. @jitendrakm41 \nA disclaimer first:\nSince I am quite a newbie, I am assuming that you are running emqx 3.0 (alpha beta rc).\nMy answers are perhaps less trustworthy if you are running an older version.\nThe REFUSED issue is due to listening IP.\nBecause 127.0.0.1 is only visible to localhost.\nby default, port 11883 is always bound to local (127.0.0.1) listener,\nunless change config listener.tcp.internal=127.0.01:11883 to something else.\nConnection timeout however, looks like a routing issue,\ntypical reason is either there is no route at all or the connection is silently dropped by firewall.\nyou can try telnet or nc from 192.168.4 to 192.168.2.5 on port 1883 to check connectivity.\n^ Assuming 1883 is bound to 0.0.0.0 (as default behavior)\n. maybe base it on #1926 ?. is this still relevant ?. client id has a limit of 23 bytes maximum, does username has such limit ?\n. Hi @pramodhkp \nThanks for reporting to us.\nThis is a bug in document.\nI checked the code, it never allows infinity for this config.\nPlease use value 0 instead (it is treated as infinity in code).\nWe'll update the doc.. Please bear in mind that:\n1> catch throw(foo).\nfoo\n2> catch error(foo).\n{'EXIT',{foo,[{shell,apply_fun,3,\n                     [{file,\"shell.erl\"},{line,907}]},\n              {erl_eval,do_apply,6,[{file,\"erl_eval.erl\"},{line,681}]},\n              {erl_eval,expr,5,[{file,\"erl_eval.erl\"},{line,434}]},\n              {shell,exprs,7,[{file,\"shell.erl\"},{line,686}]},\n              {shell,eval_exprs,7,[{file,\"shell.erl\"},{line,642}]},\n              {shell,eval_loop,3,[{file,\"shell.erl\"},{line,627}]}]}}\n3> catch exit(foo).\n{'EXIT',foo}\nFor most of the changes in this pr. only error : Reason is caught.\nThis is not compatible with the old behavior:\n1. throw exception is now not caught.\n3. exit exception is now not caught\n2. Reason for error exception now lacks of a stacktrace (this is perhaps intended, but think again).\n. Omg. Not sure if it's a good idea to suddenly stop supporting these args in emqx.conf.\nIMHO. we can stop providing default values, even remove them from documentation,\nbut it's better to continue supporting args that are already provided.. Yeah, found this nice comment in code:\n%% failed to dispatch to this sub, try next.\n                    %% 'Reason' is discarded so far, meaning for QoS1/2 messages\n                    %% if all subscribers are offline, the dispatch would fail\n                    %% even if there are sessions not expired yet.\n                    %% If required, we can make use of the 'no_connection' reason to perform\n                    %% retry without requiring acks, so the messages can be delivered\n                    %% to sessions of offline clients\nWill work on a fix.. Hi @victorclaessen I am a bit confused with your IP settings.\nWhich IP does myserver.mydomain.nl is intended to be resolved to exactly ?\nIf it is to be 192,168,14,214, please make sure emq@192.168.14.214 is stopped before starting emq@myserver.mydomain.nl because Erlang does not allow same node name on the same host.\nIf 192.168.14.214 is where you have a running node, but NOT myserver, also 192,168,14,224 is indeed intended for myserver, please try the emqttd_ctl commands on myserver i.e. 224 instead of on 214 (remotely).\nWe would like to see if the command works locally, then try to troubleshoot why it does not work remotely.\n. I'd recommend to start this PR by documenting (as code comments) what is to achieve.\nIt would be helpful to share the links/references to weighted state transition algorithm (including the reasoning behind the hard-coded magic float-point numbers)\nAlso sharing some of my thoughts:\n flapping detection is better to be done in a separate process\n periodic state check can miss some state changes while sleeping, a better approach is to send state change messages to checker.\n if periodic check is good enough, it is better to be triggered in a send_after message instead of timer:sleep\n there seem to lack of a callback for what to do when flapping is detected.\n. rebased to resolve conflict.. Thanks for your help!\nWe have done a major refactoring in bridge recently.\nThe schema issue was introduce 2 days ago which I do not know much in detail.\nthe other two embarrassing crashes are due to lack of test coverage.\nSending a PR to fix NOW.. We should fix all other places calling emqx_rpc:call\nand IMHO, it's probably better to change emqx_rpc.erl,\nmake it return only badrpc as the OTP rpc behaviour.. logic would be more clear if we change this functions to alive_subscribers/1. also a question: is this a micro optimization ? I see that upon receiving a 'DWON' message, the subscriber is deleted.. @yy-chen do you mean it's a race before the 'DOWN' message is delivered to ?SERVER?\nWhy I am asking is to understand what it is trying to solve.\nis it just to make it slightly more reliable when sending messages to subscribers?\nor is there an underlying requirement as in 'no message loss guarantee'?\nif it is the later, I'm afraid this patch will not be enough, instead, an acking mechanism is more likely the right answer. . thanks for the detailed explanation.\nThere seem to be a need of timer based prune in this case\nIt also deserves a nice comment to explain why the prune and aliveness checks are necessary.. i've seen = and -> being broke out to a new line. is it some kind of convention ?. what is the caller supposed to do on this error?\nif they are mostly to treat this as an ok, perhaps change the API name from add to ensure_present. ?assertException or ?assertExit. here and below\nwouldn't it be more informative for troubleshooting if we raise the errors with extra info like:\nerror({protocol_error, wildcard_not_allowed_as_response_topic}) ?. As I commented in another PR.\nDirect catch of an exception should consider deprecated and never use again.\nThe reason being:\nunlike try ... catch _ : _\ncatch Expr will always try to retrieve the stacktrace which is very expensive.\nespecially in our case here --- exception driven implementation,\nstacktrace is always discarded, hence no need to retrieve at all.\n. ?assertEqual(true, ...) is the same as ?assert(...). I see. I thought this mainly for logging.\nDid not know it is to be translated into an error code.\nWhat is the 'reason string' in this case ?. if it is to discard stacktrace like this (_Stacktrace).\nthere is no need to bind it.. ?assertError is even better.. I mean do we provide a Reason String to the client in case of protocol_error ?\nIf not, wouldn't it be nice to provide ? (in another pull request perhaps).. include_lib1?. Where is this function used?. Msgs is always returned as it is passed in. Why pass it in at all?. emqx_topic:validate/1 is side-effect free except for error exceptions.\nthe exceptions may cause gen_server to crash, move validation to the gen_server:call wrapper ?\n. same here.. this would be easier to read/troubleshoot if a macro is used here.\ne.g. ?UNSUB_REQ(_, _, Topics). nit: avoid binding variables in case clauses and use them outside.\nbind the case expression result to variable instead.\ni.e\nResponseInfomation = case maps:find(....) of\n    {ok, 1} -> ClientId;\n    _ -> <<>>\nend. . nit: delete.. \u2764\ufe0f . 1MB \uff1f. Since response information is non-standard.\nperhaps it makes more sense to have a emqx unique prefix?\nso developers for different clients may have a choice to tell from the prefix which server they are working with.\ne.g. emqxrspv1. bad alignment . bad alignment. there are 3 tests for QoS-0/1/2 each, likely copy-pasting from a quick glance.\nplease consider using a function with QoS parameterized.. delete dead code if there is no good reason to keep. delete ?. I find all the ct prints unnecessary when using rebar3 ct, (make rebar-ct for this project).\n. tests seem to very similar.\nwe can write a help function like this:\nwith_connection(IP, Port, Opts, Timeout, DoFun) ->\n  {ok, Sock} = emqx_client_sock:connect({127,0,0,1}, 1883, [binary, {packet, raw}, {active, false}], 3000),\n  try\n    DoFun(Sock)\n  after\n    emqx_client_sock:close(Sock)\n  end.. delete.. needs a @doc . raise an exception or return error, e.g. {error, no_response_information}. add a test too. a valid shared topic is $shared/groupname/topicname, this implementation will take the first portion in Topic as group name. And if Topic has only one portion, then $shared/only-one-portiion is invalid.. needs a spec.\nand perhaps there is no need for a Shared boolean flag, rather extend Topic from binary() to Topic :: binary() | ?SHARED(ShareGroup :: binary(), Topic :: binary())\nwhere ?SHARED is -define(SHARED(GROUP, TOPIC), {GROUP, TOPIC}).. emqx_topic:join/2. It is perhaps helpful to add a log (debug?) to print Props and QoS for troubleshooting. the spec is {error, term()} but it's {timeout, binary()} returned here.. default should be timer:seconds(5). and use a MACRO for it. e.g. RESPONSE_TIMEOUT_SECONDS. request(Client, Topic, Payload, QoS) when ?IS_QOS(QoS) orelse ?IS_QOS_NAME(QoS) ->\n    request(Client, Topic, Payload, [{qos, QoS}]);\nrequest(Client, Topic, Payload, Opts0) ->\n    reqeust(Client, Topic, Payload, unify_qos(Opts0))\nunify_qos(Opts) -> lists:map(fun({qos, QoS}) -> {qos, ?QOS_I(QoS)}; (X) -> X end, Opts).\n. default is not changed as in .conf file.. AssignedClientId will return ok atom?. if it is meant to crash, call erlang:error(bad_client_id)\notherwise use a sane default value ?. There doesn't seem to be a need for AssignedClientId as function.\n. what do you mean?. is_process_alive has a receive clause to receive result as a message delivery, so I thought it would be slow.\njust did a simple test from an Erlang shell, is_process_alive is actually slightly faster than ets lookup.\nwill change the implementation to: do not insert local pids, and call is_process_alive for local pids.. the indentation looks a bit odd to me here\nIMO, more commonly adopted styles are:\n1.\n```\nmqtt_packet_connect{properties = Properties,\n                 other_field = ...\n                })) ->\n\n```\n2.\n```\nmqtt_packet_connect{\nproperties = Properties,\nother_field = ...\n\n})) ->\nIt looks like you have changed it from style 1 to 2, but indentation and `}` alignments are off.. it worth the effort to create a spec like this for response info?\n-type response_info() :: #{field_1 := value_1(),\n                           field_2 => value_2()\n                          }.\n``. According specs fordef_response, this could befunction()oriodata()`.\nHowever, it is perhaps practically useless to set a fixed (iodata()) response for all requests.\nBetter to call this field request_handler then make a spec fun((request_input()) -> response_payload()) for it.\nrequest_input() can be for now just a binary() --- the request payload, but can be extended to be a tuple or map in the future for richer features.. Also, it's better to allow initializing the client process with a pre-defined handler, instead of calling def_response.\nThen the API is better to be namedset_request_handler in case there is a need to swap handler at runtime.\n. emqx_topic:join/1 adds / as infix. there is no need to have <<\"/\">> in the input list.\nalso, bad indentation. no you didn't add spec for this function, but it is called by request/5 and it has a spec.. this recursion will rest the timeout value for after Timeout.\ne.g. if timeout is 10 seconds, and it spent 9 seconds to receive a message, but turns out isn't not the expected correlation-data. so it decide to discard and keep waiting, then the next message come after another 9 seconds again.\nin such case, the total time spent on this function is 18 seconds.\nA more accurate way is perhaps to call Ref = erlang:start_timer(Timeout, self(), response), then receive {timeout, Ref, response} in the receive clause.. call emqx_topic:join/1. Question: why would we need to have the pid in the topic ?\nPid tend to be ephemeral because it may crash/restart, make sense to have the client-id instead ?\n. it looks like you are trying to fix = alignments, but still one space too less ?. nit: your indentation level seems quite odd. indentation level is 2 here.\nand since there is only one field, there is no need for a line break.. nit: space before and after : . no_request_handlerrmation typo of no_request_handler ?. use the macro ?SHARED(Group Topic) to replace tuple {Group, Topic}.\n. make a type spec for ?SHARED(ShareGroup :: binary(), binary()).. The other advantage of having a ?SHARED(_, _) macro is to avoid using special value as a non-shared indicator.\nit was undefined before, now it is <<>> being this special indicator.\nIt would be better to rewrite this function as \nresponse_topic_prefix(?SHARED(Group, Prefix)) ->\n    emqx_topic:join([<<\"$shared\">>, Group, Prefix]);\nresponse_topic_prefix(Prefix) when is_binary(Prefix) ->\n    Prefix.. this clause is unnecessary if shared_topic is implemented as response_topic_prefix in comment below.\nNewResponseTopic = emqx_topic:join([make_response_topic_prefix(MaybeGroup), Topic]).. delete unused.. It's a bit odd to me that request/4 calls request/5 with a default arg in the middle but not the end of arg-list.\n. My idea of having a unify_qos help function is to avoid having to match on different inputs in many places.\nNow that I notice request/4 delegates to request/5 and the 'unify' is done here anyway,\nthere is no need to have this unify_qos help function.\n. no, this is not resolved.\nreturn {error, {timeout, <<\"No Response\">>}} here.. should return State here. this is going to return ok while State is expected by caller.\nadd tests!. this is going to return ok while State is expected by caller.\nadd tests!. delete unused.. the correct spec for topic is emqx_topic:topic(), not binary().. I can't find in spec saying that the response topic should be derived from request topic (and possibly the same as request topic).\nHence we should allow caller to pass in response topic as a function argument.\nAnd I believe in practical cases, only responsers would subscribe to the request topic and maybe share-subscribe it, then send response messages to the response topic.\nIt does not make sense for the requesters to share-subscribe on the response topic, because otherwise it may not receive its response.\nFinally I believe the correlation data is to correlate multiple async requests towards responsers,\nso when responses are received, the requester knows which response correlates to which request sent earlier.\ni.e. the main purpose of it is NOT to drop responses messages that are sent to others.\n. there should be an API sub_request_topic exposed for responser to call.\nthen the sub_response_topic should be enough to kept as internal function for the requester to call.. I can't seem to find the code (in this review diff) which tries to find the session back and delete something.. ~s for Topic?. sorry, my bad. it didn't look aligned when I looked at it yesterday :). We need to also monitor Client and receive its 'DOWN' message then return {error, client_down} for the 'DOWN' receive clause.. wrap this call around a try after.\ntry\n    receive_response(Client, ClientId, Ref)\nafter\n    erlang:cancel_timer(Ref),\n    receive {timeout, Ref, _} -> ok after 0 -> ok end, % flush\n    erlang:demonitor(MRef, [flush])\nend.\n. ~p is wrong, it will print <<\"....\">>. ok. fair enough.. This export_type exists before this change.\nbut it seems wrong to export qos/0, topic/0, packet_id/0 (maybe more) from this module.\nthese types seem to be common enough to be defined in and exported from emqx.erl.\ntopic/0 is defined as emqx_topic:topic() which is fair, but worth to expose it from emqx.erl too.\ni.e. in emqx.erl:   -type topic() :: emqx_topic:topic().\nAlso, some of the types (e.g. response_payload) is used internally only, so there is no need to export.. it's a good practice to define -export_type right after the function -export section.. I mean reqeuest/5 is better to be changed from\nrequest(Client, Topic, Properties, Payload, Opts)\nto\nrequest(Client, Topic, Payload, Opts, Properties)\nand request/4 should delegate to request/5 like this: \nrequest(Client, Topic, Payload, Opts) ->\n    request(Client, Topic, Payload, Opts, _Properties = #{}).\nit is more natural to add optional argument as the last argument. According to spec:\n\nIt is a Protocol Error to set the No Local bit to 1 on a Shared Subscription\n\nDoes that mean we can not set {nl, true} here if shared?. ```suggestion\nSets the severity level for logs written to stdio.\n.suggestion\nSets the severity level for logs written to file.\n.suggestion\ninit_proc_mng_policy(undefined) -> ok;\ninit_proc_mng_policy(Zone) ->\n. if we are to deprecate lager, we should delete syslog ?.suggestion\nEnable syslog, this will write logs to syslog\n. then there is reason to keep this case clause .suggestion\nEnable syslog, to write logs to the syslog\n``. this default value is not the same as in config. we should perhaps not allow a default value here ?.connack/1should now be changed toconnack/2i.e. use two args instead of a 2-elements tuple as a single arg.. never mind, just notice line 303 is still the old style call.. if we callconnack` here, it should be a continuation,\nnot a stack pop for the caller and continue there.\nit's also easier to read if continue from here.\nthen we can convert connack/1 to connack/2.. need a macro from this false. align with if.\nand a nitpicking: I personally find case clauses much more comfortable to read, so I never write ifs\n. why not default to <<>> (replace undefined) the guard below checks =:= undefined orelse =:= <<>>.\nand use a macro for it. e.g. ?NO_AUTH_METHOD?. or use a variable name to hint what it is, e.g. _IsSuper = false. name it as what it does: ensure_client_id_and_try_open_session. this clause should be delegated to a function or variable with a more readable name.\ne.g. is_bad_auth_method(OldAuthMethod, AuthMethod). suggestion\n            auth_method  = ?NO_AUTH_METHOD,. suggestion\nprocess_packet(?AUTH_PACKET(_), PState = #pstate{auth_method = ?NO_AUTH_METHOD, auth_state = AuthState}) ->. are you sure here to be ?NO_AUTH_METHOD for Autentication-Data ?\nmaybe an other macro instead? e.g. NO_AUTH_DATA. suggestion\n        case OldAuthMethod =/= ?NO_AUTH_METHOD andalso OldAuthMethod =/= AuthMethod of\n            true when AuthState =:= reauthenticating orelse AuthState =:= connected ->\n                ...\n            true ->\n                ...\n            false ->\n                ...\n        end. indent . this prefix is essentially a topic prefix to be used by clients. according to mqtt spec:\n\nThe Server SHOULD prevent Clients from using such Topic Names to exchange messages with other Clients. Server implementations MAY use Topic Names that start with a leading $ character for other purposes. . This clause and the {binary, _Data} clause should be merged into ok (make SendFun return ok instead).. The websocket SendFun returns {binary, Data} only because the last line is Pid ! {binary, Data}.\nIt's silly to return the send result to the caller then discarded here anyway.. isn't string:tokens(\"log.$level.file\", \".\") [\"log\", \"$level\", \"file\"] ?. if we change the lists:filter at line 474 to a list:foldl and return {Level, Filename} there, it would be  more readable here.. No need to have _AllHandlers because the ++ ops are obvious enough ?. why 1000 ? repeating fsync every one second seems to be a bit too aggressive to me.. I'm not quite sure why we need this extra log config if we already have log.file.\nEspecially when the severity level filter logic (higher than or equal to) is exactly the same.\n. same here fsync interval 1000 is too aggressive IMO. string:length([B,A]) is always 2 no matter what B and A are.\n1> string:len([a,b]).\n2. this whole block from this line to line 80 worth an abstraction to a help function.. If this anonymous function is only to optimize ?LOG_HEADER ++ I doubt it would be necessary.\nbecause the header is usually short.\nHave you done tests to compare performance ?. We can create ?INFO, ?WARNING, ?ERROR ... macros instead of making logger:Level call which is less efficient than a compiler resolved function name.\nIt is also more friendly to dialyzer.. add_proc_metadata(#{peername => this pattern is repeated in quite a few modules, perhaps add a \nemqx_logger:set_metadata_peername/1. i.e. make repeated parts check-able by compiler/xref.. Perhaps add a line to describe this as equivalent to nl subscribe option in mqtt 5.0. \nAlso to state that this config does not interfere nl option if the client is on protocol version 5.0\nLastly, why v3.1.1, should it be all versions earlier than 5.0. although it is logically equivalent, \nIMO, I think it's better to call emqx_config:get_env if it's not a per-zone config.\n. Does TopicAlias =:= undefined imply mqtt v3 ?\nIt would be confusing when we read this code again some time later or for people come across for the first time.\nIdeally, the client should subscribe with nl set to true when proto_ver is lower than 5.0.\nThe least we can do here is to add a comment. . Perhaps not related to this PR. but the removal of State variable binding made me wonder why it compiled without error for this line.. function with_connection should be extended to parameterize socket options.\nThen we can nest two with_connection calls in this test to avoid risking process leaking.\ni.e. emqx_client_sock:close(Sock1) at line 307 may not be called in case code crashes before that.. shouldn't per-zone config look like : {mapping, \"zone.$name.max_inflight\", \"emqx.zones\", ?. please update this comment accordingly as updated in emqx.conf. Yes, and I agree this style is the most common usage in our code base.\nBut this allows Level to be parameterized, then it will not be static.\nProviding per-level macro would force all calls to be static.. why isn't this lazy ?. it doesn't have to be a fun does it ?. I still think it's more clear to state earlier than mqtt 5.0. than being specific about 3.1.1\nalso necessary to add a statement that nl from mqtt 5.0 IS overridden by this config ?. so config default is false (when it's not set)\nfor mqtt 5.0, what happens if nl is set to true | 1 by subscriber?. no_ack() :: no_ack doesn't seem necessary, and  no_ack() :: no_ack | {pid(), reference()} is simply dang evil.. Maybe replace this with just a timestamp then expose an api to get age instead of starting timer in this module.\nSide effects like this tend to lose control pretty easily and quickly.\nE.g. when a push call is wrapped by a try catch, timer is started in try but will not be canceled in catch.. Not sure how intensively this is called. Maybe worth have a size field?. what does this on-symbol enum mean? does it mean silent or not ?\nisn't true | false enum more clear than a undefined | silent ?. suggestion\n            emqx_logger:error(\"[ACL_INTERNAL] Failed to read ~s: ~p\", [AclFile, Reason]),. filter/2 will crash if Rule is ok\ndue to this newly added clause:\ncompile(Rule) ->\n    emqx_logger:error(\"[ACCESS_RULE] Malformed rule: ~p\", [Rule]).\nadd a test case to cover it ?. suggestion\n            %%   It would consume large amount of memory if the. suggestion\n            %%   subscribers list is too long. This may cause extra overheads on memory. the order is different from what is defined at line 48. This should be moved to unsubscribe handler. ?. are you sure to discard the sub pid?\nif a group is subscribed by multiple subscribers, one subscriber calling unsubscribe should not delete others.. I am not quite following why there is no need to monitor any more.\nIn case it is a remote pid (i.e. from another node), if the node is down, (or connection is cut),\nthe remote subscriber may not have a chance to unsubscribe.\n\nEven for a local subscriber, it could be killed, i.e. no chance to evaluate gen_server:terminate/2\n. suggestion\n            case emqx_shared_sub:subscribers(Group, Topic) =:= [] of. I noticed that emqx_shared_sub:unsubscribe only deletes the record from mnesia.\nPlease update it to also cast a message to emqx_shared_sub so it can demonitor the subscriber pid\n. Maybe this is not necessary if the only case to unsubscribe is to shutdown (or kill) the subscriber pid.\nthen it would make more sense to rename the API from unsubscribe to subscriber_down. there is no more delay-retry for sending messages, rather a delay-retry of reconnect, messages to retry will be sent right after a successful reconnect.\n. see bridge.$name.reconnect_interval. This will capture a normal return value of the RPC evaluation result (if the result is a two element tuple.. multicall return value is a list, not a tuple.. why this record is put to a hrl?\nit seems to be only used in emqx_flapping module.. threshold.. you may have more to add to this PR, but from my superficial understanding of the current code, it's better to define it as an opaque structure for emqx_flapping. this is scary, planing to run this is a swpan_link ?. ",
    "rokka-n": "Follow up: when running it as processes on Mac OS X - the results are comparable (14k/s emqtt with 18k/s mosquitto)\nI guess it's just the docker specifics.. https://github.com/emqtt/emqttd/issues/176. ",
    "gshireesh": "I tried official above link still am getting\n/opt/emqttd # ./bin/emqttd_ctl plugins load emq_auth_mongo\nload plugin error: {emq_auth_mongo,\n                    {bad_return,\n                     {{emq_auth_mongo_app,start,[normal,[]]},\n                      {'EXIT',\n                       {{badmatch,\n                         {error,\n                          {shutdown,\n                           {failed_to_start_child,emq_auth_mongo,\n                            {shutdown,\n                             {failed_to_start_child,worker_sup,\n                              {shutdown,\n                               {failed_to_start_child,\n                                {worker,1},\n                                econnrefused}}}}}}}},\n                        [{emq_auth_mongo_app,start,2,\n                          [{file,\"src/emq_auth_mongo_app.erl\"},{line,35}]},\n                         {application_master,start_it_old,4,\n                          [{file,\"application_master.erl\"},{line,273}]}]}}}}} Conf\nMy Conf:\n--------------------------------------------------------------------\nMongoDB Auth/ACL Plugin\n--------------------------------------------------------------------\nMongo Server 27017, 127.0.0.1:27017, localhost:27017\nauth.mongo.server = 127.0.0.1:27017\nauth.mongo.server = ds019836.mlab.com:19836\nMongo Pool Size\nauth.mongo.pool = 8\nMongo User\nauth.mongo.login = xxxxxxx\nMongo Password\nauth.mongo.password = xxxxxxxx\nMongo Database\nauth.mongo.database = eagle_eye\nauth_query\nauth.mongo.auth_query.collection = mqtt_user\nauth.mongo.auth_query.password_field = password\nauth.mongo.auth_query.password_hash = sha256\nauth.mongo.auth_query.selector = username=%u\nsuper_query\nauth.mongo.super_query = on\nauth.mongo.super_query.collection = mqtt_user\nauth.mongo.super_query.super_field = is_superuser\nauth.mongo.super_query.selector = username=%u\nacl_query\nauth.mongo.acl_query = on\nauth.mongo.acl_query.collection = mqtt_acl\nauth.mongo.acl_query.selector = username=%u\nacl_nomatch\nauth.mongo.acl_nomatch = deny\n. ",
    "devilwacause": "sudo apt-get update\nsudo apt-get install wget\nsudo apt-get install libssl-dev\nsudo apt-get install ncurses-dev\nwget http://www.erlang.org/download/otp_src_19.2.tar.gz\ntar -xzvf otp_src_19.2.tar.gz\ncd otp_src_19.2/\n./configure\nmake\nsudo make install\ncd ..\nrm otp_src_19.2.tar.gz\nsudo rm -R otp_src_19.2/\ngit clone https://github.com/emqtt/emq-relx.git\ncd emq-relx && make\ncd _rel/emqttd && ./bin/emqttd console\nThese are the exact steps I took to install it the first time.  Hence - I've been forced to delete the folder and start at the \"git\" command, rebuild from source to get it running again.  to which it will run, I can stop the console - and run emqttd start, then emqttd status - get correct messages.  Access the web dashboard - and my qmtt client has already communicated.  But on restart of the pi, or shut down of the emqttd daemon from there forward - it will never start up (see error in last post) \n. NOTE - Solved myself - was never in the _rel/emqttd directory when trying to restart the service.  Once I as this became a non-issue.  . Ignore the WebSocket with error - found the cause had a NodeRed service running on a pc that had a random mqtt client causing the error.  Persistance is still major issue.. May have found issue at hand - \nemq.conf had the expiration time set to 2 hours.  Set to a longer interval and testing now.\nIf test comes back correctly will close issue myself.\n. I've also tried with a mysql_auth user just to make sure it wasnt looking there.  I've created alternative users in the Dashboard as well.\nFails every time.\n. Ignore - I see its based on application now. \nMy mistake - coming from v2 where I'm used to curl working with the dash users. ",
    "ahmedqadeer1989": "Thank you let me check and i will get back to you. sorry that doesnt fullfill my requirements but thanks anyways. ",
    "dreamcatcha": "Any update on this, Im getting the same issues\n. I can vouch for this still being a problem, Im using ansible with a template for the emq.conf file and if there is no newline after the last option it fails\nUsing emq 2.3-beta.4. Look into the http auth plugin, you can then use any auth method and language to roll your own system for auth and acl. My experience is when you first authenticate with http it checks if the user is a super user and if they are, then its cached that they are and never needs to call the acl as its a super user. Make sure your not connecting as a super user, then you will see the acl get call every request.. @turtleDeng yeah i corrected the post, its the android application failing to show the messages from subscriptions with wildcards, works in another android client. ",
    "cgdander": "Yes! That works!\n@marriotb Thanks a lot!. ",
    "jj-2": "There is no issue when I use version 1.1.3:\n\nhttp listen on 0.0.0.0:18083 with 4 acceptors.\n\nBut issue remains on v 2.0.6 per initial post.\nAnyone else seeing this?\n. ps - Unable to load the plugin manually either (or any other plugin it seems):\n```\n\nemqttd_ctl plugins load emq_dashboard\nload plugin error: not_found\n```\nTried adjusting permissions renaming files to no avail.\nNo issue on Cent OS.\nKnown issue with loading plugin on Windows??. Thanks folks, looks good on Win7x64 using 2.0.7.. \n",
    "altishchenko": "Did you try doing it with Admin privileges?\nAlexander Tishchenko\nmob: +7 (916) 704-61-57\natishch@gmail.com\n\n18 \u044f\u043d\u0432. 2017 \u0433., \u0432 17:35, Michael notifications@github.com \u043d\u0430\u043f\u0438\u0441\u0430\u043b(\u0430):\nEnvironment\nOS: Windows 7\nErlang/OTP: 18.3\nEMQ: 2.0.6\nDescription\nLink: http://emqtt.io/docs/v2/install.html#installing-on-windows\nWhat means the senetence:\nWarning\nCannot register EMQ-2.0 as a windows service.\nIs a solution planned for the problem?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub https://github.com/emqtt/emqttd/issues/871, or mute the thread https://github.com/notifications/unsubscribe-auth/ASj_3_N37T8K1qZTg4OYib4o0rZ9xiy_ks5rTiM3gaJpZM4Lm8_B.\n\n\n. ",
    "okamipride": "Thank you for quick replay.\ni did do the procedure as you said. It is document in the emqttd refernce; however it get what i posted previous; however sometimes, it works.  and sometimes emqttd_ctl cluster status report fail.  how do i reset everything in emqttd cluster setting  and restart from a clean state ? . Thanks , I found out that was because emq_auth_mysql failed.  I will try console to see if any message shows there.. ",
    "tercanfurkan": "I made further tests with keepAliveInterval set to 5mins and to 30sec:\n\nkeepAliveInterval: 5 mins => lwt sent out: 16mins\nkeepAliveInterval: 5 mins => lwt sent out: 18mins\nkeepAliveInterval: 30 sec => lwt sent out: 2mins\n\nWhy is the keepAlive timeout 3 to 4 times of the keepAlive interval? \nCan I change this logic somewhere in the code?. ",
    "dbonino": "Sorry to say, but we are still experiencing the same issue:\nmessages are published in QoS 2 to a certain topic, e.g., /observations/ and a set of 2 subscribers use the shared topic subscription: $share/substrial//observations/ in QoS 2.\nMessages are delivered to both clients as if they were \"isolated\" clients (all clients see all messages)\nSame behavior using $queue subscriptions.\nAny suggestion / improvements on this?. ",
    "thpham": "I still have the same problem when I use emq_auth_redis.conf and emq_auth_http.conf in the same time. The latest plugin loaded is used for the authentication.\nWould be great to have both used to check auth/acl.\n[update] this seems to be linked with this issue:  #777 . ",
    "mbarreca": "@phanimahesh I fixed this issue by ordering it as follows\ncacert.pem\nCA\nintermediate\ncert.pem\nserver\nCA\nintermediate\nThen I changed enabled the cacert.pem line in the emq.conf file and that did the trick.. ",
    "rob-h-w": "If I understand correctly, you've found a workaround by publishing the RETAINed message asynchronously after the CONNECT, right @mhls?. The spec says that QoS 0 messages SHOULD be stored, but implementations MAY choose to discard it at any time. This could explain why a message is absent on the first subscribe (it can legitimately be discarded), but it doesn't explain why the message then appears on the next subscription attempt.\nI wonder if it's possible to reproduce this behaviour with EMQ even without doing the publish at CONNECT time. It could just be a bug with first-time subscriptions to topics in general.. ",
    "mhls": "workaround is to publish message through the spawn with at least 1s delay.\nAlthough when client subscribes with delay the message still wont get delivered.. Its easily reproducible with single client connection.\n1. Connect client to the broker\n2. Publish retain message to the topic\n3. Subscribe on that topic - according to the documentation of MQTT, client should receive published message, but the message doesn't get delivered.. hello @huangdan,\ni dont really understand, because followed you steps and it didnt work as expected.\ndid the curl and then subscribe but message didnt show up. According to the mqtt documentation it should be delivered to the client subscribed.\nWas also checking that with\n1. mosquitto_pub -t \"topic\" -m \"message payload\" -q 1 -r\n2. mosquitto_sub -t topic -d\nWas expecting to receive message instantly after subscribing. \nDocumentation that im relying on http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc398718038\nUsing the broker from source and versions of the packages used\nMakefile dependencies\nPROJECT = emq-relx\nPROJECT_DESCRIPTION = Release Project for the EMQ Broker\nPROJECT_VERSION = 2.0.7\nDEPS = emqttd emq_dashboard emq_sn emq_coap\nemq deps\ndep_emqttd        = git https://github.com/emqtt/emqttd 72ed2919470cb48d18c703037206b2c301fed55b\ndep_emq_dashboard = git https://github.com/emqtt/emq-dashboard 431ece5ed88030cdf4941b9e71a230e5be78cb97\nmqtt-sn and coap\ndep_emq_sn  = git https://github.com/emqtt/emq-sn 3617795fa3049b6dddc0478b78fb0a3840bd44ab\ndep_emq_coap = git https://github.com/emqtt/emq-coap f43f893cfe337102796b49c1bbdbec2e95c86016\n\nchanged to specific revisions instade of master.. \n",
    "tigercl": "Hi @mhls,\nI verified the commands provided by @huangdan in EMQ v2.0.7, and client received the published message. Could you make sure retainer plugin is loaded?. @mhls Close this issue. There is reason code for message publish denied in mqtt 5.0 and emqx 3.0 has supported this feature. . You can refer https://github.com/emqtt/emqttc#ssl-socket. Please provide more details.. @pritukam Close this issue. It's not a standard feature in MQTT 5.0, so we won't implement it right now.. Hi, @Think7 \n\nI would love the ability for EMQTT to relay messages sent from a NATS server\n\nSending messages from NATS server to devices or sending messages from emq to NATS server, which approach do you prefer?\n. EMQ's keep-alive mechanism is loose, in other words, it will greater than 1.5 * keep-alive in most cases.. hi @krittanon-w, \nThis bug has been fixed in the emqx-3.0-beta.2. Hi, @Lianmc9408 Sorry for the late reply, what do you mean by the SubTopicCount? The number of topics subscribed by the client? Or number of topics owned by the node?. @toomasz Sorry, I can't reproduce this problem in EMQ 2.3.11, can you provide more your logs and conf file?. @toomasz I tried your config files and it works fine. If you have time, you can try again and provide more logs.. The feature has been implemented in emqx v3.0-rc.4. Hi, @ckrey, I'm sorry to tell you that this feature will be implemented later.. Hi @ckrey,\nIf the value of \"No Local\" is 0, the retained messages will not be forwarded to a connection with a ClientID equal to the ClientID of the publishing connection. I'm not sure if you publish and subscribe on the same client, and I received retained messages on the another client.\n. Hi, @ckrey, you can refer to the sepcification, our implementation is in accordance with the sepcification:\n\nBit 2 of the Subscription Options represents the No Local option. If the value is 1, Application Messages MUST NOT be forwarded to a connection with a ClientID equal to the ClientID of the publishing connection.. hi, @ckrey, it has been fixed in #1845 . hi, @ckrey, it has been fixed in #1845  (comment). @letrungtrung @giraffe-tree Sorry for this problem in v3.0-beta.2, and the issue has been fixed in v3.0-rc.5. I tried to subscribe to a 3000 topics on one client, everything is fine.. Are you using the enterprise version? Because v2.4 only exists in the enterprise.. Hi, @MyraBaba, Can you provide more emqttd's debug logs when this problem occurs? It can help us locate the problem. You can open the debug information with the following command:\nlager:set_loglevel(lager_console_backend, debug).. Hi, @jdavidagudelo, we have fixed the bug of loading lua scripts in 3.0-rc.3\n. @boboxiaodd Please confirm that the username and password used by your client are correct. Client B can be kick out by client A, and A also can be kick out by B if your username and password are correct.. @boboxiaodd We can't know if a client has ever been kicked out, so we can't return the 'connection refused' to the client with correct username and password.. @boboxiaodd If you want the server to return an \"bad user name or password\" when client has the correct password, we can't do it.. > client id has a limit of 23 bytes maximum, does username has such limit ?\n\nWe will check length of the client id after using username replace client id, and the server allow ClientID's that contain more than 23 encoded bytes actually, we limit it by 'max_clientid_len' in emqx.conf now.. > Questings after reading mosquitto config document\n@spring2maz Sorry for not replying in time, the plan you said is indeed more reasonable. I will discuss with @turtleDeng and decide how to achieve it later.. @cocowalla The user in dashboard is different from the user in MQTT. You can add user for plugin of emqx_auth_username by two ways according to the information in http://emqtt.io/docs/v3/guide.html#authentication. @s4kibs4mi Your protocol version is fine, this issue is caused by the following reason:\n\n[error] [MQTT] Failed to open session: :client_id_unavailable\n\nWe converted the reason code for MQTT 3.1 so that the reason code becomes 'unacceptable_protocol_version'.\nSo back to the error itself, it will appear when clients with the same client id send CONNECT packet to server at the same time. Do you meet the above situation?. @s4kibs4mi Can you provide more information such as what strategy of node discovery and autocluster you used?. Sorry for this problem in the previous version, and this bug has been fixed in emqx v3.0-rc.4. Hi, @0xfadeef. Which authentication plugin are you using? . Sorry for the late reply, emq_auth_username doesn't have acl rule, are you referring to something in the emq_auth_username.conf?. I got it, your suggestion is great, we will fix it as soon as possible.. Hi, @ranvijayj, sorry for the late reply, could you provide some log files about this issue?. I have not reproduced this problem, dependencies you fetched may be incomplete because of bad network, so I suggest you can delete these dependencies and try again.. Hi, @Forsure-Wang, sorry for my late reply. According to your description, I think it may be a problem with your http server. You can try to fetch http request and response packets with Wireshark to confirm which part of the problem.. @yxhcool Hi. Sorry to tell you that we don't currently support returning connection information for all nodes.But you can traverse the nodes to get this information.. Thanks for your feedback, we have fixed it in 3.1-beta.1.. You are right. Sorry for later response, hope you've tried it yourself.. I'm sorry to trouble you with this problem. This is indeed a bug, and we will fix it in v3.1-beta.2. @vborcea Sorry for later response, and I failed to reproduce the problem what you said in my cluster environment. Maybe you can provide the complete profile so that we can troubleshoot the problems.. > Why put a default 'Message-Expiry-Interval'???\nThese code used in retainer plugin, I push it together with code of issue#1809 unexpectedly.. Yes, you are right, client id will be better. Session pid or client id is used to find and delete the will message if session resumed before the Will Delay Interval has passed.. CONNPROPS -> ConnProps. I am sorry for this. {?RC_SUCCESS, SP, PState} -> connack({?RC_SUCCESS, SP, PState})?. If client connected but no existing session, you should send will message as usual.. Please use 'ack_props' replace 'ackprops'. ",
    "fuji4": "\nSupported in new release 3.0\n\nCan't confirm this. I've installed v3.0.1 and when I query `/api/v3/connections/, I still get only the connections from the node I'm querying.... ",
    "vytasmk": "So this issue could be updated/renamed to include not only connections but also sessions and subsriptions as those endpoints also return information only from one node even when in dashboard \"All nodes\" is selected.. Found that some body already has asked very similar question one year ago: https://github.com/emqx/emqx-auth-http/issues/64. I think my proposed way with mapping anonymous clients to some username and/or password will solve that case to.. ",
    "ig0r": "@emqplus thanks! I will check it. guys, do you have any estimates on this issue?. ",
    "kidswong999": "Hello, how is this feature going?. ",
    "rohan061": "Hi is there any update on this feature?. ",
    "quanfehut": "Thank phanimahesh, my Erlang/OTP version is 18 and it make broker crash. @phanimahesh : yes, i downloaded binary package for windows, and it contains erts-7.3. ",
    "mv200580": "mqtt01.groovy.txt\n. sure, @phanimahesh \ntrace_log.txt\nI can see the published messages in trace log:\n15:08:18.822 [info] Client(clientid@178.18.110.19:64866): SEND PUBLISH(Q0, R0, D0, Topic=oneM2M/req/557, PacketId=undefined, Payload=<<\"message1\">>)\nbut they are not processed by paho MqttMessageListener. @phanimahesh \nanother weird thing \nif I subscribe the client to the local topic wildcard oneM2M/req/# (instead of shared $queue/oneM2M/req/#), it begins to process messages in MqttMessageListener, while the trace is identical:\ntrace_log2.txt\n. @emqplus I am not sure that clearly understand your last post.. So you don't plan to maintain the shared subscription feature for the java clients? \nOr there is some bug in eclipse paho client that do not allow shared subscription to work properly?. Thanks for reply, @phanimahesh !!\nThe problem is more clearly for me now.\nI researched a bit java client behavior with messages from topic $client/clientid.\nIf client is not subscribed to that topic explicitly, it doesn't process messages published to that topic, despite the messages displayed in subscribed client trace log:\n```\n16:27:46.725 [info] Client(client_subs@161.8.91.106:65516): RECV CONNECT(Q0, R0, D0, ClientId=client_subs, ProtoName=MQTT, ProtoVsn=4, CleanSess=true, KeepAlive=60, Username=user, Password=\n)\n16:27:46.726 [info] Client(client_subs@161.8.91.106:65516): SEND CONNACK(Q0, R0, D0, AckFlags=0, RetainCode=0)\n16:27:46.726 [info] Session(client_subs): Subscribe [{<<\"$client/client_subs\">>,[{qos,1}]}]\n16:27:46.735 [info] Client(client_subs@161.8.91.106:65516): RECV SUBSCRIBE(Q1, R0, D0, PacketId=1, TopicTable=[{<<\"req\">>,1}])\n16:27:46.735 [info] Session(client_subs): Subscribe [{<<\"req\">>,[{qos,1}]}]\n16:27:46.736 [info] Client(client_subs@161.8.91.106:65516): SEND SUBACK(Q0, R0, D0, PacketId=1, QosTable=[1])\n16:27:51.914 [info] Client(client_subs@161.8.91.106:65516): SEND PUBLISH(Q0, R0, D0, Topic=$client/client_subs, PacketId=undefined, Payload=<<\"1212\">>)\n16:27:52.331 [info] Client(client_subs@161.8.91.106:65516): SEND PUBLISH(Q0, R0, D0, Topic=$client/client_subs, PacketId=undefined, Payload=<<\"1212\">>)\n16:27:52.669 [info] Client(client_subs@161.8.91.106:65516): SEND PUBLISH(Q0, R0, D0, Topic=$client/client_subs, PacketId=undefined, Payload=<<\"1212\">>)\n```\nbut if we subscribe the client explicitly to $client/clientid topic, then it begins to process messages:\n```\n16:26:26.795 [info] Client(client_subs@161.8.91.106:65473): RECV CONNECT(Q0, R0, D0, ClientId=client_subs, ProtoName=MQTT, ProtoVsn=4, CleanSess=true, KeepAlive=60, Username=user, Password=\n)\n16:26:26.797 [info] Client(client_subs@161.8.91.106:65473): SEND CONNACK(Q0, R0, D0, AckFlags=0, RetainCode=0)\n16:26:26.797 [info] Session(client_subs): Subscribe [{<<\"$client/client_subs\">>,[{qos,1}]}]\n16:26:26.806 [info] Client(client_subs@161.8.91.106:65473): RECV SUBSCRIBE(Q1, R0, D0, PacketId=1, TopicTable=[{<<\"$client/client_subs\">>,1}])\n16:26:26.806 [info] Session(client_subs): Subscribe [{<<\"$client/client_subs\">>,[{qos,1}]}]\n16:26:26.806 [warning] Session(client_subs): duplicated subscribe: $client/client_subs, qos = 1\n16:26:26.807 [info] Client(client_subs@161.8.91.106:65473): SEND SUBACK(Q0, R0, D0, PacketId=1, QosTable=[1])\n16:26:41.418 [info] Client(client_subs@161.8.91.106:65473): SEND PUBLISH(Q0, R0, D0, Topic=$client/client_subs, PacketId=undefined, Payload=<<\"1212\">>)\n16:26:42.443 [info] Client(client_subs@161.8.91.106:65473): SEND PUBLISH(Q0, R0, D0, Topic=$client/client_subs, PacketId=undefined, Payload=<<\"1212\">>)\n16:26:42.929 [info] Client(client_subs@161.8.91.106:65473): SEND PUBLISH(Q0, R0, D0, Topic=$client/client_subs, PacketId=undefined, Payload=<<\"1212\">>)\n```\nbut the same doesn't work with $queue/topic and $share/topic, the client don't see the messages anyway\n. Just want to find out now - is it possible for paho java client to switch off the topic name validation.. this can be the solution, I guess. ",
    "hezhijun": "+1. ",
    "mruepp": "Hi, I suspect this problem concerns node-red mqtt node as well, there is also the paho client used and subscription is not working on local, queue and share. ",
    "frank-montyne": "I forget to mention that I'm using an SSL connection to the broker\nBest regards,\nFrank Montyne\n. Look for example at HiveMQ. They state this explicitly in the documentation:\nFile persistence\nBy default, all persistence stores are backed by the file system of the machine HiveMQ is running on. So even if HiveMQ stops or restarts no state is lost and after restarting the broker, all clients keep their persistent sessions, all queued messages for offline persistent clients are preserved, MQTT message flows can resume and retained messages are available.\nhttp://www.hivemq.com/docs/hivemq/latest/#mqtt-configuration-persistence-chapter\n. I would go for option 2 similar to VerneMQ. Performance is key when having a lot of traffic.. Is there any progress on this issue? I tried v2.2 but the behavior is still the same. I forget to mention that I'm using an SSL connection to the broker\nBest regards,\nFrank Montyne\n. Hi,\nThe maximum packet size per message is about 150-200 bytes well below the 64K max packet size.\nIt's the first time I had this type of crash. The problem is that the emqttd process was stopped. Running \"sudo service emqttd status\" gave \"emqttd is stopped\".  Seems like the self healing didn't work. \nI installed EMQ using \"sudo gdebi emqttd_2.0.7_ubuntu14.4_amd64.deb\". \n/proc is mounted. \nI tried \"sudo -u emqtt cat /proc/cpuinfo\" to check if emqtt has access to /proc and that command gave me the cpu information back.\n. I'll see if I can reproduce the crash.\nI uploaded a recent console and error log. I see that there are sometimes warnings and errors. Perhaps it is related to these?\nconsole&error-log.zip\n. Hi,\nThe emqtt process crashed again last night. I uploaded my emq.conf and some more log files. The console log contains information at the INFO level. It gives you a better idea of the data packets that are coming in. I'm constantly running EMQ with:\nlog.console.level = info\nbecause I want a complete trace of what's going on, that should not be a problem I guess?\nlogs-and-conf.zip\n. Hi,\nI don't see a crash.dump file. There is also nothing to see in the syslog files> Nevertheless the emqtt proces was stopped! The weird thing is it seems to stop exactly at 1 AM each time. . There is nothing specifically scheduled at 1 PM that  I know of. We used to run mosquitto (until last week) on that server and we never had any problems. I installed EMQ using gdebi that's all.\nI added the syslogs. Nothing special except for some manual restarts from me.\nCrontab contains the following entries:\n/etc/crontab: system-wide crontab\nUnlike any other crontab you don't have to run the `crontab'\ncommand to install the new version when you edit this file\nand files in /etc/cron.d. These files also have username fields,\nthat none of the other crontabs do.\nSHELL=/bin/sh\nPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin\nm h dom mon dow user  command\n17 *    *  *   root    cd / && run-parts --report /etc/cron.hourly\n25 6    *  *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )\n47 6    *  7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )\n52 6    1 *    root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )\n\nsyslog.zip\n. I looked again for a crash.dump file on the whole disk but I didn't find any.\nsudo find / -name crash only list the following:\n/usr/share/doc/apport/crashdb-conf.txt.gz\n/usr/share/apport/kernel_crashdump\n/usr/share/apport/testsuite/test_signal_crashes.pyc\n/usr/share/apport/testsuite/test_signal_crashes.py\n/usr/share/apport/testsuite/test_java_crashes.py\n/usr/share/apport/testsuite/test_java_crashes.pyc\n/usr/share/apport/testsuite/crash.class\n/usr/share/apport/testsuite/crash.jar\n/usr/share/apport/testsuite/test_crash_digger.pyc\n/usr/share/apport/testsuite/test_crashdb.py\n/usr/share/apport/testsuite/test_crash_digger.py\n/usr/share/apport/testsuite/test_python_crashes.py\n/usr/share/apport/testsuite/test_python_crashes.pyc\n/usr/share/apport/testsuite/test_crashdb.pyc\n/usr/lib/python3/dist-packages/apport/crashdb_impl\n/usr/lib/python3/dist-packages/apport/pycache/crashdb.cpython-34.pyc\n/usr/lib/python3/dist-packages/apport/crashdb.py\n/usr/lib/python2.7/dist-packages/twisted/test/crash_test_dummy.py\n/usr/lib/python2.7/dist-packages/twisted/test/crash_test_dummy.pyc\n/usr/lib/emqttd/lib/observer-2.1.2/ebin/crashdump_viewer.beam\n/usr/lib/emqttd/lib/observer-2.1.2/priv/crashdump_viewer.tool\n/usr/lib/emqttd/lib/observer-2.1.2/priv/crashdump_viewer\n/usr/lib/emqttd/lib/lager-3.2.2/ebin/lager_crash_log.beam\n/usr/lib/emqttd/log/crash.log.3\n/usr/lib/emqttd/log/crash.log\n/usr/lib/emqttd/log/crash.log.0\n/usr/lib/emqttd/log/crash.log.1\n/usr/lib/emqttd/log/crash.log.4\n/usr/lib/emqttd/log/crash.log.2\n/usr/src/linux-headers-3.16.0-31/include/linux/crash_dump.h\n/usr/src/linux-headers-3.16.0-31-generic/include/config/crash\n/var/crash\n/sys/devices/system/cpu/cpu0/crash_notes\n/sys/devices/system/cpu/cpu0/crash_notes_size\n/sys/kernel/kexec_crash_size\n/sys/kernel/kexec_crash_loaded\n/etc/apport/crashdb.conf. Yes that's it.\nOn Mon, Mar 6, 2017 at 4:35 PM, J Phani Mahesh notifications@github.com\nwrote:\n\nIgnore that, the ones you shared previously are good enough if that or\nsimilar entries are all they have.\nOn Mon 6 Mar, 2017 21:03 Phani Mahesh, phanimahesh@gmail.com wrote:\n\nThese are of interest to us:\n/usr/lib/emqttd/log/crash.log.3\n/usr/lib/emqttd/log/crash.log\n/usr/lib/emqttd/log/crash.log.0\n/usr/lib/emqttd/log/crash.log.1\n/usr/lib/emqttd/log/crash.log.4\n/usr/lib/emqttd/log/crash.log.2\nAny chance you can share some of them after anonymising any sensitive\ninfo?\nOn Mon 6 Mar, 2017 19:40 Frank Montyne, notifications@github.com\nwrote:\nI looked again for a crash.dump file on the whole disk but I didn't find\nany.\nsudo find / -name crash only list the following:\n/usr/share/doc/apport/crashdb-conf.txt.gz\n/usr/share/apport/kernel_crashdump\n/usr/share/apport/testsuite/test_signal_crashes.pyc\n/usr/share/apport/testsuite/test_signal_crashes.py\n/usr/share/apport/testsuite/test_java_crashes.py\n/usr/share/apport/testsuite/test_java_crashes.pyc\n/usr/share/apport/testsuite/crash.class\n/usr/share/apport/testsuite/crash.jar\n/usr/share/apport/testsuite/test_crash_digger.pyc\n/usr/share/apport/testsuite/test_crashdb.py\n/usr/share/apport/testsuite/test_crash_digger.py\n/usr/share/apport/testsuite/test_python_crashes.py\n/usr/share/apport/testsuite/test_python_crashes.pyc\n/usr/share/apport/testsuite/test_crashdb.pyc\n/usr/lib/python3/dist-packages/apport/crashdb_impl\n/usr/lib/python3/dist-packages/apport/pycache/crashdb.cpython-34.pyc\n/usr/lib/python3/dist-packages/apport/crashdb.py\n/usr/lib/python2.7/dist-packages/twisted/test/crash_test_dummy.py\n/usr/lib/python2.7/dist-packages/twisted/test/crash_test_dummy.pyc\n/usr/lib/emqttd/lib/observer-2.1.2/ebin/crashdump_viewer.beam\n/usr/lib/emqttd/lib/observer-2.1.2/priv/crashdump_viewer.tool\n/usr/lib/emqttd/lib/observer-2.1.2/priv/crashdump_viewer\n/usr/lib/emqttd/lib/lager-3.2.2/ebin/lager_crash_log.beam\n/usr/lib/emqttd/log/crash.log.3\n/usr/lib/emqttd/log/crash.log\n/usr/lib/emqttd/log/crash.log.0\n/usr/lib/emqttd/log/crash.log.1\n/usr/lib/emqttd/log/crash.log.4\n/usr/lib/emqttd/log/crash.log.2\n/usr/src/linux-headers-3.16.0-31/include/linux/crash_dump.h\n/usr/src/linux-headers-3.16.0-31-generic/include/config/crash\n/var/crash\n/sys/devices/system/cpu/cpu0/crash_notes\n/sys/devices/system/cpu/cpu0/crash_notes_size\n/sys/kernel/kexec_crash_size\n/sys/kernel/kexec_crash_loaded\n/etc/apport/crashdb.conf\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/935#issuecomment-284405880, or\nmute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ABnL8O7Sw-\nZ7T1fvPtjmVO4cV7sPJQReks5rjBPvgaJpZM4MTV3K\n.\n\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/935#issuecomment-284431274, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AJKoLx0AnkGE8SPXdTe2vyDnFGUimdrLks5rjCe_gaJpZM4MTV3K\n.\n. Hi,\n\nThis night I had the problem again but slightly different. When I woke up this morning I saw that my service was not receiving any messages anymore from the broker. The broker however was still running. It was receiving messages from our nodes (hardware devices sending MQTT messages to specific topics) but it was not publishing them anymore to my service that is subscribed to these topics. The broker was using 100% cpu. I took some screenshots for you:\nThe first shows a view with htop where you can see the emqttd process taking up all cpu. \nThe seconds screenshot is from the dashboard that shows the broker is using a lot of memory (up from around 60 MB under normal circumstances but now at around 400MB). It was still receiving messages since the received count was still going up (314904 at the moment of the screenshot) but only 254494 were already delivered. The sent count did ot go up anymore, it stayed fixed at the 254494 count. So around 60000 still needed to be published (and going up). \nThe third screenshot is from my service, I restarted the service just to make sure but no messages were coming in. I had to stop the broker process and restart it (losing 60000 messages in the process) before things went back to normal.\nscreenshots.zip\n. Hi,\nI'm not really comfortable with Erlang. Yesterday I wrote a load tester in\njava to try and crash the EMQ broker. I let it run simulating 100 clients\neach sending 1000 messages/minute and could not make the broker crash.\nTomorrow (almost midnight in Belgium) we are going to do a test with with\nour hardware device and see if that triggers the crash. If that works I can\nsetup a VM with EMQ on Azure and give you access to it to replicate the\ntest again. What do you think?\nUp until now we were using mosquitto and we never had any real problems. We\nprocessed about 100.000.000 messages in the last year coming from our\nhardware.\nIf you want to know more about what we do you can have a look on our\nwebsite (www.bynubian.com)\nBest regards,\nFrank Montyne\nOn Wed, Mar 8, 2017 at 8:55 PM, J Phani Mahesh notifications@github.com\nwrote:\n\nI'm considering the options on how this can be reproduced. Are you\ncomfortable with erlang? It is possible to inspect the emqttd instance when\nit reaches this state, and that can be helpful. Specifically, we need to\nlook at erlang process count and if there is a process leak, possibility of\na binary leak, and average message queue length of processes and how it\nvaries.\nDo you have or can you arrange for trends of cpu, ram and network usage\nfor one night when this happens? The graphs may hold a clue.\nMy current blind bet: EMQ dispatcher is going wonky, or client/session\nprocesses are getting locked up on something.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/935#issuecomment-285150243, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AJKoL_r0o5D8uJaQZRWAyQCLXZ4dFuc5ks5rjwebgaJpZM4MTV3K\n.\n. Cool thanks, working on setting something up today.\n\nOn Thu, Mar 9, 2017 at 5:54 AM, J Phani Mahesh notifications@github.com\nwrote:\n\nTo crash emqttd using just number of messages shouldn't be possible\ntechnically. (tm). You can happily increase the load a hundred fold or more\nand it should be absorbed. Things may slow down if your hardware is on the\nlow end, but that should be it.\nIf this can be replicated in a VM, that would be great. I'll take out some\ntime to help debug this if I can get my hands on emqttd when it misbehaves.\nOn Thu 9 Mar, 2017 03:20 Frank Montyne, notifications@github.com wrote:\n\nHi,\nI'm not really comfortable with Erlang. Yesterday I wrote a load tester\nin\njava to try and crash the EMQ broker. I let it run simulating 100 clients\neach sending 1000 messages/minute and could not make the broker crash.\nTomorrow (almost midnight in Belgium) we are going to do a test with with\nour hardware device and see if that triggers the crash. If that works I\ncan\nsetup a VM with EMQ on Azure and give you access to it to replicate the\ntest again. What do you think?\nUp until now we were using mosquitto and we never had any real problems.\nWe\nprocessed about 100.000.000 messages in the last year coming from our\nhardware.\nIf you want to know more about what we do you can have a look on our\nwebsite (www.bynubian.com)\nBest regards,\nFrank Montyne\nOn Wed, Mar 8, 2017 at 8:55 PM, J Phani Mahesh <notifications@github.com\nwrote:\n\nI'm considering the options on how this can be reproduced. Are you\ncomfortable with erlang? It is possible to inspect the emqttd instance\nwhen\nit reaches this state, and that can be helpful. Specifically, we need\nto\nlook at erlang process count and if there is a process leak,\npossibility\nof\na binary leak, and average message queue length of processes and how it\nvaries.\nDo you have or can you arrange for trends of cpu, ram and network usage\nfor one night when this happens? The graphs may hold a clue.\nMy current blind bet: EMQ dispatcher is going wonky, or client/session\nprocesses are getting locked up on something.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/935#issuecomment-285150243,\nor\nmute\nthe thread\n<\nhttps://github.com/notifications/unsubscribe-auth/AJKoL_\nr0o5D8uJaQZRWAyQCLXZ4dFuc5ks5rjwebgaJpZM4MTV3K\n.\n\n\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/935#issuecomment-285180683, or\nmute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/ABnL8CHpaxyi1EDmc5UP_\naCjoYxb91D2ks5rjyKKgaJpZM4MTV3K\n.\n\n\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/935#issuecomment-285254477, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AJKoL7kPcaxHifij3hQvyxogIEBRYdcCks5rj4X8gaJpZM4MTV3K\n.\n. Hi, \nI meanwhile added some logging and did some further tests. Apparently what happened is the following:\n\n\nAt some point in time my persistence service that is subscribed to a number of topics loses its connection to the EMQ broker. The reason why is still unclear. \nMy service gets notified of the lost connection and starts a background task to reconnect.\nFor some bizarre reason the reconnect succeeds immediately and I also get a disconnect just afterwards. Then we go into a loop of connects/disconnects. I never had this behaviour with Mosquitto.\nEclipse Paho has an auto reconnect feature itself. I didn't use that up until now because I wanted a bi more control over the reconnect process. I adjusted the code to use that and up until now I had no problems anymore.  Quite weird since it basically does the same thing.\n\nAny ideas about this connect/disconnect loop?\nThanks,\nFrank. What do you mean? The disconnected client just reconnects with the same client id. Otherwise it would lose its subscriptions.. All my clients use a unique UUID (globally unique identifier) that is fixed. This means that if you get a client with the same id it effectively is the same client.  The reason I was reconnecting is because at some point in time Paho notifies me that the connection is broken. At that point I initialize a new Paho client with the same client id (because I don't want to lose my subscriptions) and try to connect again. When I was using Mosquitto that worked without any problems, probably because Mosquitto just cleans up the stale connection.\nFor EMQ I am now using the autoreconnect feature of Paho instead to avoid getting into trouble.\n. Its Java Paho. Probably the auto reconnect feature of Paho does a better job of cleaning up the stale connection. This issue can be closed. The EMQ broker has been working flawlessly for the last 12 days.\nThanks for the support,\nFrank. ",
    "ajay-aggarwal": "Is there a hook available for on_tcp_connect() with haproxy support? It would be nice to accept/reject the incoming connection based on the client IP and Certificate CN info presented via haproxy protocol.. ",
    "vidhill": "Yes, we had a look at doing that, \nour .p12 file was/is injected at startup so it was kind of difficult to extract before emq starts, \nWe got cert and key .pem files in the meantime. Connecting via mqtts instead of ws I get the error...\n17:08:44.255 [error] Client(172.17.0.1:43978): Parser failed for {function_clause,[{emqttd_parser,parse_utf,[<<1,0,239>>],[{file,\"src/emqttd_parser.erl\"},{line,206}]},{emqttd_parser,parse_frame,3,[{file,\"src/emqttd_parser.erl\"},{line,81}]},{emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,259}]},{gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,615}]},{gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,681}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,240}]}]}\n17:08:44.255 [error] Client(172.17.0.1:43978): Error data: <<22,3,1,0,239,1,0,0,235,3,3,211,81,23,101,119,122,35,190,96,229,20,50,242,149,123,190,175,179,1,126,12,85,238,186,68,43,21,63,135,16,252,185,0,0,110,192,47,192,43,192,48,192,44,0,158,192,39,0,103,192,40,0,107,192,36,192,20,192,10,0,165,0,163,0,161,0,159,0,106,0,105,0,104,0,57,0,56,0,55,0,54,192,50,192,46,192,42,192,38,192,15,192,5,0,157,0,61,0,53,192,35,192,19,192,9,0,164,0,162,0,160,0,64,0,63,0,62,0,51,0,50,0,49,0,48,192,49,192,45,192,41,192,37,192,14,192,4,0,156,0,60,0,47,0,255,1,0,0,84,0,11,0,4,3,0,1,2,0,10,0,28,0,26,0,23,0,25,0,28,0,27,0,24,0,26,0,22,0,14,0,13,0,11,0,12,0,9,0,10,0,35,0,0,0,13,0,32,0,30,6,1,6,2,6,3,5,1,5,2,5,3,4,1,4,2,4,3,3,1,3,2,3,3,2,1,2,2,2,3,51,116,0,0>>. Yes, I know\nthis is happening  when I hit port 8883\nWhen I Connect to the non secure connection:\nmqtt://mydomain (not my actual domain, I use my actual domain)\nPort 1883\nthis works as expected\nBut connecting to:\nmqtts://mydomain (not my actual domain)\nPort 8883\nI get the error reported above, this happens both with my own certificates and the dev certs included with the application\ne.g.\n```\nConfiguring SSL Options\nSee http://erlang.org/doc/man/ssl.html\nmqtt.listener.ssl.handshake_timeout = 15\nmqtt.listener.ssl.keyfile = etc/certs/key.pem\nmqtt.listener.ssl.certfile = etc/certs/cert.pem\nmqtt.listener.ssl.cacertfile = etc/certs/cacert.pem\nmqtt.listener.ssl.verify = verify_peer\nmqtt.listener.ssl.fail_if_no_peer_cert = true\n```\nFor some reason I can also connect to the secure port insecurely\n - my config does have 8883 configured as the secure port\n```\nSSL Listener: 8883, 127.0.0.1:8883, ::1:8883\nmqtt.listener.ssl = 8883\n. Running EMQ locally on my host machine:\n$ openssl s_client -connect localhost:8883\n**Returns**\nCONNECTED(00000003)\ndepth=0 CN = denghaiguideMacBook-Air.local, O = server\nverify error:num=20:unable to get local issuer certificate\nverify return:1\ndepth=0 CN = denghaiguideMacBook-Air.local, O = server\nverify error:num=21:unable to verify the first certificate\nverify return:1\n\nCertificate chain\n 0 s:/CN=denghaiguideMacBook-Air.local/O=server\n   i:/CN=MyTestCA\n\nServer certificate\n-----BEGIN CERTIFICATE-----\nMIIC9jCCAd6gAwIBAgIBATANBgkqhkiG9w0BAQsFADATMREwDwYDVQQDDAhNeVRl\nc3RDQTAeFw0xNjEwMzEwNzE1NDVaFw0xNzEwMzEwNzE1NDVaMDkxJjAkBgNVBAMT\nHWRlbmdoYWlndWlkZU1hY0Jvb2stQWlyLmxvY2FsMQ8wDQYDVQQKEwZzZXJ2ZXIw\nggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC4Ena4vgWrzwUB0hGW1v0v\nK986FhU5ZdYz5H5MGonfWwv89nR2DlftSDXEvKFyc2MT81GGm16VJv3mVpQJLuKA\nxLBLY7a1zSrJdugXWy+mgJJTPW6KjTY4jPtfCl6x/yVr8YclVa8XO0JFzOme2LMV\nYlc/ixVEa66UpxRNrg5yWHS26KcB1lE3GLERoRBKF7nsyGqGY4X9TypBwglCVoqK\n3dKVGwCvFur+oPnt/C5pwR6UmUV/Ppf1EaRD7Po+xcyJSeCvszG3FH4iHsDHnjLe\nDR6lxouvMCb+aKJi9d0xowOjhbKoFMF179t4SVnptQeq+U6ui3cPKUjia7Zh1tZT\nAgMBAAGjLzAtMAkGA1UdEwQCMAAwCwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsG\nAQUFBwMBMA0GCSqGSIb3DQEBCwUAA4IBAQB2jlDPiZfP/whsvvFn43g37QMwX5ST\nZ5OpmEFnFjAH3ec0PPqPrKYEu00q5wEC+8L6uVH8FHOFf11JLH4wl11/C/mvE92D\nqZtGG8KCnG2+rk5OJPGX+28Z+OnCZlXOjQ8qd2x5KtIW50JuXJ3cbDRHtF/TVanm\nExu+TCBeToNwbcU2sfQnbljkUTj4idUFz0pq3uvw3dA4R1J2foungPAYXSWcVhtb\nRYtG8epIvkAyyUE5nY3kC05AUml6gSZkrJiYM5I1IJTX1lQ7Pv2yxRBZUtTx33rP\nccnsW6tbHTDBG8UDHx4LKHErdWFgCJWI81EUEcTip9g2zCOGTWKnpz+z\n-----END CERTIFICATE-----\nsubject=/CN=denghaiguideMacBook-Air.local/O=server\nissuer=/CN=MyTestCA\n---\nNo client certificate CA names sent\n---\nSSL handshake has read 929 bytes and written 623 bytes\n---\nNew, TLSv1/SSLv3, Cipher is AES256-GCM-SHA384\nServer public key is 2048 bit\nSecure Renegotiation IS supported\nCompression: NONE\nExpansion: NONE\nNo ALPN negotiated\nSSL-Session:\n    Protocol  : TLSv1.2\n    Cipher    : AES256-GCM-SHA384\n    Session-ID: 343DF965E61FDF98FC56B7F95810B47D207340EEAD89653AC4C1324693363F0A\n    Session-ID-ctx: \n    Master-Key: 3CA457415F7E2C3192DB10E382468E585FE63D59FC1E18EA01748680668AAA1618EB7799D770C60EB7E1641DBBC5DF67\n    Key-Arg   : None\n    PSK identity: None\n    PSK identity hint: None\n    SRP username: None\n    Start Time: 1491403534\n    Timeout   : 300 (sec)\n    Verify return code: 21 (unable to verify the first certificate)\n---\nclosed\n```\nRunning the official docker container (built locally)\ndocker run -p 18083:18083 -p 8883:8883 -p 1883:1883 --add-host my-test:127.0.0.1  emqttd:2.0.7\nCheck ip set up correctly\n```\n$ ping my-test\nPING my-test (172.17.0.2) 56(84) bytes of data.\n64 bytes from my-test (172.17.0.2): icmp_seq=1 ttl=64 time=0.025 ms\n64 bytes from my-test (172.17.0.2): icmp_seq=2 ttl=64 time=0.020 ms\n64 bytes from my-test (172.17.0.2): icmp_seq=3 ttl=64 time=0.026 ms\n64 bytes from my-test (172.17.0.2): icmp_seq=4 ttl=64 time=0.023 ms\n^C\n--- my-test ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 2998ms\nrtt min/avg/max/mdev = 0.020/0.023/0.026/0.005 ms\n```\nRunning\nopenssl s_client -connect my-test:8883\nReturns\n```\nCONNECTED(00000003)\n140620099196568:error:140790E5:SSL routines:ssl23_write:ssl handshake failure:s23_lib.c:177:\n\nno peer certificate available\nNo client certificate CA names sent\nSSL handshake has read 0 bytes and written 305 bytes\nNew, (NONE), Cipher is (NONE)\nSecure Renegotiation IS NOT supported\nCompression: NONE\nExpansion: NONE\nNo ALPN negotiated\nSSL-Session:\n    Protocol  : TLSv1.2\n    Cipher    : 0000\n    Session-ID: \n    Session-ID-ctx: \n    Master-Key: \n    Key-Arg   : None\n    PSK identity: None\n    PSK identity hint: None\n    SRP username: None\n    Start Time: 1491404134\n    Timeout   : 300 (sec)\n    Verify return code: 0 (ok)\n\n```. I think for some reason, EMQ is falling back to serving insecurely, perhaps\nAccording to the erlang ssl docs\n\nit falls back to insecure renegotiation if the peer does not support RFC 5746\n\nI know we are not dealing with peer renegotiation in this case though\n. For above I'm using the https://github.com/emqtt/emq-docker (on the v2.0.7 tag)\nIn that, the config file gets cloned down and copied as part of the Makefile for emqttd-relx\n-I'll be able to give more details when I get into work in about an hour . emqttd_ctl listeners outputs:\n```\nlistener on mqtt:wss:8084\n  acceptors       : 32\n  max_clients     : 1000000\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:ws:8083\n  acceptors       : 64\n  max_clients     : 1000000\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:ssl:8883\n  acceptors       : 32\n  max_clients     : 500000\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:tcp:1883\n  acceptors       : 64\n  max_clients     : 1000000\n  current_clients : 0\n  shutdown_count  : []\nlistener on dashboard:http:18083\n  acceptors       : 2\n  max_clients     : 512\n  current_clients : 4\n  shutdown_count  : []\n```\nthese are the permissions on the config files\n```\n-rw-r--r--    1 root     root           817 Apr  4 14:41 acl.conf\ndrwxr-xr-x    2 root     root          4096 Apr  4 15:46 certs\n-rw-r--r--    1 root     root          7041 Apr  6 09:08 emq.conf\ndrwxr-xr-x    2 root     root          4096 Apr  4 14:41 plugins\n```\nAnd the certs\n```\n-rw-r--r--    1 root     root            38 Apr  4 14:37 README\n-rw-r--r--    1 root     root          1021 Apr  4 14:37 cacert.pem\n-rw-r--r--    1 root     root          1086 Apr  4 14:37 cert.pem\n-rw-r--r--    1 root     root          1086 Apr  4 14:37 client-cert.pem\n-rw-r--r--    1 root     root          1679 Apr  4 14:37 client-key.pem\n-rw-r--r--    1 root     root          1679 Apr  4 14:37 key.pem\n```\n. Ok, I built emq-docker on master with is 2.1.0-rc.2 and when I run\nopenssl s_client -connect my-test:8883\nI am successfully getting a secure connection -so it appears to me that the problem is specific to v2.0.7 on Alpine \nedit: I actually don't think the differentiating factor is the fact is the Alpine base image any more, as I was having success and failure building from the same base image, the only difference was/is the EMQ release version\nI tried re-building v2.0.7 with the newer version of Alpine, changing \nline 5  ENV EMQ_VERSION=v2.1.0-rc.2 to ENV EMQ_VERSION=v2.0.7p1 on master\nAnd I'm back seeing the same problem again..\n. Issue was resolved by migrating to EMQ v2.1.0. I think I had this issue before, it doesn't like the underscores in your hostname\nIf you're able to change your hostname swap underscores for dashes. Excellent, thanks. For anyone reading this, it looks like that log format is currently not configurable \nConfigured in /src/emqttd_trace.erl. Is there an issue with this PR?\nI have had to point my builds to my own branch, \nMy team would obviously prefer us to be pointing to an official emqttd release. Cool, thanks for that\nWill you be making a new tagged version of 2.2x ?. ",
    "eshxcmhk": "e.m. there is nothing between the number and '/'. what happens. em.it's my fault,these is some unvisible character after the number. ",
    "ankitkothana": "Is this issue fixed? I am getting following errors:\nfile /etc/rc.d from install of application-0:2.3.0.noarch conflicts with file from package chkconfig-1.7.4-1.el7.x86_64\nfile /etc/rc.d/init.d from install of application-0:2.3.0.noarch conflicts with file from package chkconfig-1.7.4-1.el7.x86_64\nfile /usr/local/share from install of application-0:2.3.0.noarch conflicts with file from package filesystem-3.2-25.el7.x86_64\nfile /etc/rc.d from install of application-0:2.3.0.noarch conflicts with file from package initscripts-9.49.41-1.el7.x86_64\nfile /etc/rc.d/init.d from install of application-0:2.3.0.noarch conflicts with file from package initscripts-9.49.41-1.el7.x86_64. ",
    "chrischandler25": "Ok, thanks very much for the quick response.  I'll move it to a folder without spaces and try again.\nChris. ",
    "nb7123": "thank you, when i run sh ok ^_^. ",
    "eugene-haas": "The reason was that there were two simultaneous connections on one IP.\nClosing one of the two connections will successfully connect to the MQTT Broker.\nDo you have settings to control this?. The cause could not be determined, but it was resolved.. I could not figure out the cause, but it was solved, and the same issue occurred during client duplicate access.\nOne of the causes is that the client ID is duplicated and connected.\nI do not know if this will help.\nI am sorry that I can not help you.. ",
    "Leen15": "Up on this. it should be very useful if dashboard could show all data aggregated (clients, sessions, subscriptions) because it's a pain check every node of the cluster for every section.. ",
    "urmet0": "I also experienced the same problem.. ",
    "lordlinus": "+1 same issue here. ",
    "zhanghongtong": "To access Dashboard using a URL like http://example.com/dashboard, refer to the following configuration\n```\nserver {\n        listen  80;\n        server_name  example.com;\n    location /dashboard {\n        proxy_pass  http://127.0.0.1:18083/;\n    }\n\n    # Ensure that static resource dependencies and Dashboard API are accessible on absolute path\n    location /static {\n        proxy_pass  http://127.0.0.1:18083/static/;\n    }\n\n    location /api/v2 {\n        proxy_pass  http://127.0.0.1:18083/api/v2/;\n    }\n\n}\n```\nFor more detailed information, please refer to Nginx EMQ Dashboard. Sorry, /static and /api must be in the same path as /dashboard, ensuring that static resource dependencies and Dashboard APIs can be accessed on absolute paths.\nPS: If you are using EMQ3.0, then api/v2 needs to be changed to api/v3. @mruepp  Close this issue. You can try it with our latest version of emqx, thanks. Hi, we released emqx v3.0.0, you can see them on the docker hub, the new version improves performance, you can test with v3.0.0. In the latest v3.0-rc.3 release we have supported bridging to AWS IoT, and you can subscribe to topics or forward topics via bridge.\nYou can refer to the steps below to configure EMQ X bridge to AWS IoT.\n1. Modify the configuration of etc/emqx.conf.\n```\n$ vim etc/emqx.conf\nBridge address: node name for local bridge, host:port for remote.\n\nValue: String\nExample: emqx@127.0.0.1,  127.0.0.1:1883\nbridge.aws.address = a1memimzxxxxxx-ats.iot.ap-northeast-2.amazonaws.com:8883   //Address of the AWS IoT endpoint\uff1a8883\nThe Clean start flag of a remote bridge.\n\nValue: boolean\nbridge.aws.clean_start = true\nBribge to remote server via SSL.\n\nValue: on | off\nbridge.aws.ssl = on\nSSL Certfile of the bridge.\n\nValue: File\nbridge.aws.certfile = etc/certs/aws/2d714b6de4-certificate.pem.crt  //AWS IoT certificate\nSSL Keyfile of the bridge.\n\nValue: File\nbridge.aws.keyfile = etc/certs/aws/2d714b6de4-private.pem.key   //AWS IoT private key\n2. Start EMQ X and start EMQ X bridge.\n$ ./bin/emqx start\nemqx 3.0 is started successfully!\n$ ./bin/emqx_ctl bridges list\nname: aws     status: Stopped\n$ ./bin/emqx_ctl bridges start aws\nstart bridge successfully.\n3. Subscribe to a new topic via bridge.\n$ ./bin/emqx_ctl bridges add-subscription aws subAWS 1\nAdd-subscription topic successfully.\n$ ./bin/emqx_ctl bridges subscriptions aws\ntopic: subAWS, qos: 1\ntopic: cmd/topic1, qos: 1\ntopic: cmd/topic2, qos: 1\n4. Forward a new topic via bridge\n$ ./bin/emqx_ctl bridges add-forward aws forwardAWS\nAdd-forward topic successfully.\n$ ./bin/emqx_ctl bridges forwards aws\ntopic:   forwardAWS\ntopic:   topic1/#\ntopic:   topic2/#\nThe topics that EMQ X forwards through the bridge are prefixed, and `etc/emqx.conf ` can view or modify the prefix.\n$cat etc/emqx.conf\n...\nMountpoint of the bridge.\n\nValue: String\nbridge.aws.mountpoint = bridge/aws/${node}/\n`${node} ` is the node.name of EMQ X, the default is `emqx@127.0.0.1`. So the theme that EMQ X forwards should be `bridge/aws/emqx@127.0.0.1/forwardAWS`, subscribe to this topic via AWS IoT. You can use the docker to run emqx. Of course, you can configure the EMQ docker container with environment variables, [you can view this document](https://github.com/emqx/emqx-docker/blob/master/README.md).. @RaymondMouthaan  Thank you for your love, this is the address of our [docker hub](https://hub.docker.com/r/emqx/emqx/). We tried to use `elang:21-alpine` to make our image, but the size of the image is too large, so we made the image ourselves.\nYou can provide RP about emqx-docker [in this project](https://github.com/emqx/emqx-docker).. I use the `vagrant box` to create a virtual machine for `openSUSE-Tumbleweed v1.0.6.20180530`. In the virtual machine, use `Docker version 18.06.1-ce, build e68fc7a215d7` to run ` docker run -tid --name emq20 -p 1883:1883 -p 8083:8083 -p 8883: 8883 -p 8084:8084 -p 8080:8080 -p 18083:18083 emqttd-docker-v2.3.11`, the result is normal. @williamchanter  Closing this issue.. The `--sysctl` sets namespaced kernel parameters (sysctls) in the container, Not all sysctls are namespaced. Docker does not support changing sysctls inside of a container that also modify the host system. Read the [docker documentation](https://docs.docker.com/engine/reference/commandline/run/#configure-namespaced-kernel-parameters-sysctls-at-runtime) for more details..  [Now you can download the bate2 version of Windows by clicking here](http://emqtt.com/downloads/3001/windows10). Please describe more in detail. @NewBorn25 Where did you get the docker image? Is the version `v2.3.0`? Also, I noticed that your k8s-apiserver is port 443. This is usually used to provide HTTPS services instead of kube-api. Can you confirm that you can access kube-apiserver from this address?. I can use the v2.3.11 version to successfully cluster. The following is the yml file I created the cluster. You can refer to it.\n$ cat emq23.yml\napiVersion: v1\nkind: Service\nmetadata:\n  name: emq\nspec:\n  ports:\n  - port: 32333\n    nodePort: 32333\n    targetPort:  emq-dashboard\n    protocol: TCP\n  selector:\n    app: emq\n  type: NodePort\n\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: emq\n  labels:\n        app: emq\nspec:\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: emq\n    spec:\n      containers:\n      - name: emq\n        image: emqttd-docker-v2.3.11:latest\n        imagePullPolicy: Never\n        ports:\n        - name: emq-dashboard\n          containerPort: 18083\n        - name: emq-http\n          containerPort: 8083\n        - name: emq-mqtt\n          containerPort: 1883\n        env:\n        - name: EMQ_CLUSTER__DISCOVERY\n          value: k8s\n        - name: EMQ_NAME\n          value: emq\n        - name: EMQ_CLUSTER__K8S__APISERVER\n          value: http://172.31.22.81:8080\n        - name: EMQ_CLUSTER__K8S__NAMESPACE\n          value: default\n        - name: EMQ_CLUSTER__K8S__SERVICE_NAME\n          value: emq\n        - name: EMQ_CLUSTER__K8S__ADDRESS_TYPE\n          value: ip\n        - name: EMQ_CLUSTER__K8S__APP_NAME\n          value: emq\n        tty: true\n\n$ kubectl create -f emq23.yml\nservice/emq created\ndeployment.extensions/emq created\n$ kubectl get pods,svc -o wide\nNAME                       READY   STATUS    RESTARTS   AGE     IP            NODE              NOMINATED NODE\npod/emq-67d78f9cdc-2w2m6   1/1     Running   0          5m27s   10.244.2.16   ip-172-31-16-71   \npod/emq-67d78f9cdc-pqtj6   1/1     Running   0          5m27s   10.244.1.12   ip-172-31-26-12   \nNAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)           AGE     SELECTOR\nservice/emq          NodePort    10.111.38.152           32333:32333/TCP   5m27s   app=emq\nservice/kubernetes   ClusterIP   10.96.0.1               443/TCP           8m49s   \n$ kubectl exec -it emq-67d78f9cdc-2w2m6 /opt/emqttd/bin/emqttd_ctl cluster status\nCluster status: [{running_nodes,['emq@10.244.1.12','emq@10.244.2.16']}]\n$ kubectl exec -it emq-67d78f9cdc-2w2m6 /opt/emqttd/bin/emqttd_ctl  status\nNode 'emq@10.244.2.16' is started\nemqttd 2.3.11 is running\n. I am using kubernets installed by kubeadm, so my apiserver is set in the kube-apiserver pod. If you are installing kubernetes using binary files, then check `/etc/systemd/system/kube-apiserver.service` or your custom apiserver settings.. @NewBorn25 Yes, you can try to update emq to v2.3.11. I successfully deployed ` emqx:v.30-rc.1` on k8s using the following configuration, you can refer to it.\napiVersion: v1\nkind: Service\nmetadata:\n  name: emqx\nspec:\n  ports:\n  - port: 32333\n    nodePort: 32333\n    targetPort:  emqx-dashboard\n    protocol: TCP\n  selector:\n    app: emqx\n  type: NodePort\n\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: emqx\n  labels:\n        app: emqx\nspec:\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: emqx\n    spec:\n      containers:\n      - name: emqx\n        image: emqx/emqx:v3.0-rc.1\n        ports:\n        - name: emqx-dashboard\n          containerPort: 18083\n        - name: emqx-http\n          containerPort: 8083\n        - name: emqx-mqtt\n          containerPort: 1883\n        env:\n        - name: EMQX_CLUSTER__DISCOVERY\n          value: k8s\n        - name: EMQX_NAME\n          value: emqx\n        - name: EMQX_CLUSTER__K8S__APISERVER\n          value: http://172.31.18.155:8080\n        - name: EMQX_CLUSTER__K8S__NAMESPACE\n          value: default\n        - name: EMQX_CLUSTER__K8S__SERVICE_NAME\n          value: emqx\n        - name: EMQX_CLUSTER__K8S__ADDRESS_TYPE\n          value: ip\n        - name: EMQX_CLUSTER__K8S__APP_NAME\n          value: emqx\n        tty: true\n```\n```\n$ kubectl get pods -o wide\nNAME                    READY   STATUS    RESTARTS   AGE   IP             NODE         NOMINATED NODE\nemqx-689c46bdc7-27cgz   1/1     Running   0          16m   10.244.2.11    kube-node3   \nemqx-689c46bdc7-nq2xg   1/1     Running   0          16m   10.244.1.252   kube-node2   \n$ kubectl exec -it emqx-689c46bdc7-27cgz /opt/emqx/bin/emqx_ctl cluster status\nCluster status: [{running_nodes,['emqx@10.244.1.252','emqx@10.244.2.11']}]\n. Sorry, we have some negligence in making the docker zip file. You can use `docker pull emqx/emqx:v3.0-rc.3` to load our image on the [docker hub](https://hub.docker.com/r/emqx/emqx/tags/).. You need to execute unzip and then execute load\n$ unzip emqx-docker-v3.0-rc.3.zip\nArchive:  emqx-docker-v3.0-rc.3.zip\n  inflating: emqx-docker-v3.0-rc.3\n$ sudo docker load < emqx-docker-v3.0-rc.3\nb598a212fb12: Loading layer  8.192kB/8.192kB\n07d875135be8: Loading layer  56.54MB/56.54MB\n741e8600eba9: Loading layer  11.78kB/11.78kB\nd036ce3aacb7: Loading layer  34.11MB/34.11MB\nLoaded image: emqx-docker-v3.0-rc.3:latest\nOr you can load our image directly using `docker pull emqx/emqx:v3.0-rc.3`. Sorry, our configuration file does not now support changing the listening port of the dashboard, but you can map the 18083 port of the docker container to other ports on your host, like this:\nsudo docker run --rm -ti --name emqx1 -p 8080:18083 emqx:latest\n. Regarding the problem that mysql8.0 can't connect, there is an idea that mysql8.0 uses the caching_sha2_password plugin to encrypt the password by default. You need to change it to mysql_native_password, and then try to connect.\nmysql> use mysql;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\nDatabase changed\nmysql> select host, user, plugin from user;\n+-----------+------------------+-----------------------+\n| host      | user             | plugin                |\n+-----------+------------------+-----------------------+\n| %         | root             | caching_sha2_password |\n| localhost | mysql.infoschema | caching_sha2_password |\n| localhost | mysql.session    | caching_sha2_password |\n| localhost | mysql.sys        | caching_sha2_password |\n| localhost | root             | caching_sha2_password |\n+-----------+------------------+-----------------------+\n5 rows in set (0.00 sec)\nmysql> ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'you password';\nQuery OK, 0 rows affected (0.07 sec)\nmysql> flush privileges;\nQuery OK, 0 rows affected (0.01 sec)\nmysql> select host, user, plugin from user;\n+-----------+------------------+-----------------------+\n| host      | user             | plugin                |\n+-----------+------------------+-----------------------+\n| %         | root             | mysql_native_password |\n| localhost | mysql.infoschema | caching_sha2_password |\n| localhost | mysql.session    | caching_sha2_password |\n| localhost | mysql.sys        | caching_sha2_password |\n| localhost | root             | caching_sha2_password |\n+-----------+------------------+-----------------------+\n5 rows in set (0.00 sec)\n. Sorry,` emqx-auth-mysql` does not currently support ssl connection, and mysql 8.0 new password mechanism, these features are in our development schedule, but not now. Can we look at your `docker-compose.yml` file?. Of course, you can send me an email. Also, is your nginx running on the host machine or running in the docker container?. Are you executing the command in `cmd` or in `powershell`?. Which version of emqx are you using? I am using the latest version of `v3.0-rc.5` and have not reproduced this problem.. Sorry, we are unable to reproduce this issue, please provide more details and logs. Sorry, this is our mistake. When you use`EMQX_LOADED_PLUGINS` to specify the plugin, you need to manually specify`emqx_management` and put it first, just like `docker run -it --rm -e EMQX_LOADED_PLUGINS=\"emqx_management,emqx_auth_http,emqx_auth_jwt,emqx_dashboard\" emqx/emqx:v3.0.0`. You can read the [EMQ Loaded Plugins Configuration](https://github.com/emqx/emqx-docker/blob/emqx30/README.md#emq-loaded-plugins-configuration) and [EMQ X Plugins Configuration](https://github.com/emqx/emqx-docker/blob/emqx30/README.md#emq-x-plugins-configuration) chapters in the [emqx-docker documentation](https://github.com/emqx/emqx-docker/blob/emqx30/README.md) to solve your problem.. This issue has not been updated for a long time. I am going to close this issue. Please feel free to re-open if you still have the same trouble.. Sorry, I can't reproduce this question, please provide more information.. Seems the issue is resolved. I am going to close this issue. Please feel free to re-open if you still have the same trouble.. I noticed that the version of emqx in this [issue](https://github.com/emqx/ekka/issues/36) is 2.4. Is there still an issue in 3.0?. As you can see, this is a problem with `start.sh` in our docker images, we will try to fix this in the next version.. Hi @wajidp Please confirm whether you can successfully access the k8s apiserver in the `emqx-78f4b856c7-2tklc` pod.. Unfortunately, the `emqx` image does not have `curl` installed. You can use emqx to create a new image. Refer to the following file as a Docker file, then deploy the new image to the k8s node server, and restart the emqx cluster to see if you can successfully access the apiserver.\nFROM emqx/emqx:v3.0.1\nUSER root\nRUN apk add curl\n```. It seems that apiserver refused access, please check your network and ensure that your kubectl proxy runs correctly.. We don't have a RHEL and SUSE package right now. For RHEL, you can try the centos rpm. For SUSE, we welcome the contribution code.. As far as I know, no one has done this yet. You can get the code from here and try to compile it. The compiler environment recommends using Erlang/OTP 21.2.. @rangeshgupta-altair  I am going to close this issue. Please feel free to re-open if you still have the same trouble.\n. Yes, we have v3.0.1 arm64 architecture package and docker image, you can access here and here to get. @zhongtianxie Seems the issue is resolved. I am going to close this issue. Please feel free to re-open if you still have the same trouble.. This is our mistake, now we are fixing this problem, you can get the required installation package from here.. This issue has been fixed, thank you for your attention. ",
    "chandrasekharh": "Yes - we tried the http auth plugin and are planning to use it for production. But even with that, it would be nice to have the caching option turned on so that the auth servers are not overloaded with acl requests for every publish that the clients make. At the same time we would like to have a way to clear the cache when something changes with the acl. . ",
    "tpiecora": "I am using mysql auth.  Do the cached ACLs ever expire?  Is there any way to clear the cache?  If There is an ever increasing number of users then will the cache eventually consume all the available memory?. Yes, it has a load balancer with equal weighting across all nodes.\nI have worker nodes that spawn child processes in pairs. Each child has its own account and ACL. They both subscribe to the same topic and then post messages via http to an API. That API then publishes the messages to the topic. Once 25 messages have been sent, both clients disconnect and exit, then the worker deletes their user accounts and ACLs.\nWorkers are running in ECS Fargate with each worker handling 100 pairs of child processes concurrently. They are in the same VPC and AZ.\nMessages are not large. Average is around 1KB.\nI am using MySQL Auth in RDS.\n. Any thoughts here?. ",
    "kannach": "+1. ",
    "everydaynerd": "+1. ",
    "DavidHtx": "+1. ",
    "homerzhou": "+1. @emqplus I want to know where I can find the message which is dropped.(not use open log debug). The topic is must exist @HJianBo .\nMy test case is 100 clients recv data and echo data back and another 100 clients publish and check if the data is back.\nI found only few publish message is not echo back, and this message is not receive by subscriber. I want to know where I can find the message which is dropped.(not use open log debug) @HJianBo. Hi @crazybg321 :\nHow to know EMQ have drop their sessions. it will useful for my another problem.\nUse dashboard or emqttd_ctl ?. ",
    "popaaaandrei": "isn't this available only in enterprise version? :). Has someone attempted a k8s configuration with the 3.0 release?. ",
    "MarcMagnin": "Hi,\nIs shared subscriptions in cluster planned?\nRegards,\nMarc. ",
    "DemonGiggle": "I run emqttd 2.1.1 version. \nJust modify the following lines to limit the port for clustering usage.\n```\netc/emq.conf\nset the port range in the next two lines\nnode.dist_listen_min = 20000\nnode.dist_listen_max = 21000\n```\nIn the firewall setting, you can set the port range 2000~21000.\n. ",
    "hos7ein": "tnx @DemonGiggle \nit's worked for me.. @emqplus  Tnx for reply\n```bash\nulimit -n\n1048576\n```. @turtleDeng\ntnx, it's worked . ",
    "truonglx-56": "So can I debug on another ide?and how?. Thanks for help!. ",
    "loss2profit": "Hi @emqplus  & @turtleDeng ,\nThanks for the reply. \nYes all the 10K devices are posting to the same topic and there is  a single subscriber to that topic. the subscriber did not crash however. Please find a few lines from crash dump below.\n=erl_crash_dump:0.3\nThu Apr  6 01:28:46 2017\nSlogan: eheap_alloc: Cannot allocate 1898305688 bytes of memory (of type \"old_heap\").\nSystem version: Erlang/OTP 19 [erts-8.1] [source-4cc2ce3] [64-bit] [smp:4:4] [async-threads:32] [hipe] [kernel-poll:true]\nCompiled: Wed Oct 12 12:28:55 2016\nTaints: dyntrace,crypto,asn1rt_nif,erl_tracer\nAtoms: 32937\nCalling Thread: scheduler:4\n=scheduler:1\nScheduler Sleep Info Flags: SLEEPING | TSE_SLEEPING | WAITING\nScheduler Sleep Info Aux Work:\nCurrent Port:\nRun Queue Max Length: 0\nRun Queue High Length: 0\nRun Queue Normal Length: 0\nRun Queue Low Length: 0\nRun Queue Port Length: 0\nRun Queue Flags: OUT_OF_WORK | HALFTIME_OUT_OF_WORK\nCurrent Process:\n=scheduler:2\nScheduler Sleep Info Flags: SLEEPING | TSE_SLEEPING | WAITING\nScheduler Sleep Info Aux Work:\nCurrent Port:\nRun Queue Max Length: 0\nRun Queue High Length: 0\nRun Queue Normal Length: 0\nRun Queue Low Length: 0\nRun Queue Port Length: 0\nRun Queue Flags: OUT_OF_WORK | HALFTIME_OUT_OF_WORK\nCurrent Process:\n=scheduler:3\nScheduler Sleep Info Flags: SLEEPING | POLL_SLEEPING | WAITING\nScheduler Sleep Info Aux Work: THR_PRGR_LATER_OP\nCurrent Port:\nRun Queue Max Length: 0\nRun Queue High Length: 0\nRun Queue Normal Length: 0\nRun Queue Low Length: 0\nRun Queue Port Length: 0\nRun Queue Flags: OUT_OF_WORK | HALFTIME_OUT_OF_WORK\nCurrent Process:\n=scheduler:4\nScheduler Sleep Info Flags:\nScheduler Sleep Info Aux Work:\nCurrent Port:\nRun Queue Max Length: 0\nRun Queue High Length: 0\nRun Queue Normal Length: 0\nRun Queue Low Length: 0\nRun Queue Port Length: 0\nRun Queue Flags: OUT_OF_WORK | NONEMPTY | UNKNOWN(134217728)\nCurrent Process: <0.4504.374>\nCurrent Process State: Garbing\nCurrent Process Internal State: ACT_PRIO_NORMAL | USR_PRIO_NORMAL | PRQ_PRIO_NORMAL | ACTIVE | RUNNING | GC | ON_HEAP_MSGQ\nCurrent Process Program counter: 0x00007f7a3c471d70 (lager_trunc_io:alist/3 + 8)\nCurrent Process CP: 0x00007f7a3c2f2e30 (lager_format:iolist_to_chars/1 + 168)\nCurrent Process Limited Stack Trace:\n0x00007f7965a0e208:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e218:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e228:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e238:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e248:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e258:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e268:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e278:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e288:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e298:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e2a8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e2b8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e2c8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e2d8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e2e8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e2f8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e308:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e318:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e328:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e338:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e348:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e358:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e368:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e378:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e388:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e398:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e3a8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e3b8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e3c8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e3d8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e3e8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e3f8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e408:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e418:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e428:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e438:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e448:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e458:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e468:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e478:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e488:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e498:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n0x00007f7965a0e4a8:SReturn addr 0x3C2F2E30 (lager_format:iolist_to_chars/1 + 168)\n. Thanks guys ..\non running emqttd_ctl i see the below stats.\n./emqttd_ctl recon memory\nusage/current       : 0.46277002113100657\nusage/max           : 0.8775753420323661\nused/current        : 83449680\nused/max            : 1766397128\nallocated/current   : 180027392\nallocated/max       : 2012815360\nunused/current      : 96631816\nunused/max          : 246418232\nallocated/max : 2012815360 -->2 GB. \nCan you suggest a way to increase the ram , the server has 8 gigs of ram.\nThanks a lot once again.. ",
    "TheBeachMaster": "Also facing the same issue. Status 404 Object Not Found\nMy endpoint is set to http://my-server:18080/api/v2/mqtt/publish \nClient :  Postman\nI manged to peek at info.log inside /var/log/emqttd/ directory.\nHere's what I found....  \nBeginning of Log  \ud83d\udcdc \n2018-01-23 10:29:21.081 [error] <0.22690.0>@emqttd_ws:handle_request:73 Unexpected WS Request: GET /\n2018-01-23 10:29:21.728 [error] <0.22690.0>@emqttd_ws:handle_request:73 Unexpected WS Request: GET /favicon.ico\n2018-01-23 10:29:27.595 [error] <0.22690.0>@emqttd_ws:handle_request:73 Unexpected WS Request: GET /\n2018-01-23 10:30:22.402 [error] <0.22690.0>@emqttd_ws:handle_request:73 Unexpected WS Request: GET /\n2018-01-23 10:30:30.527 [error] <0.22690.0>@emqttd_ws:handle_request:65 Not WebSocket: Upgrade = undefined\n2018-01-23 11:03:37.168 [info] <0.1087.0> alarm_handler: {set,{system_memory_high_watermark,[]}}\n2018-01-23 14:54:42.735 [error] <0.22936.0>@emqttd_ws:handle_request:65 Not WebSocket: Upgrade = undefined\n2018-01-23 17:02:36.037 [error] emulator Error in process <0.23174.0> on node 'emq@127.0.0.1' with exit value:\n{function_clause,[{emqttd_http,handle_request,[\"/\",{mochiweb_request,[{esockd_connection,[#Port<0.9900>,#Fun<esockd_transport.2.118520527>,[]]},'POST',\"/\",{1,1},{10,{\"cache-control\",{'Cache-Control',\"no-cache\"},{\"authorization\",{'Authorization',\"Basic YWRtaW46cHVibGlj\"},{\"accept\",{'Accept',\"*/*\"},nil,{\"accept-encoding\",{'Accept-Encoding',\"gzip, deflate\"},nil,nil}},nil},{\"postman-token\",{\"Postman-Token\",\"305d7c9e-5926-40c0-b334-e82ca2422b6e\"},{\"host\",{'Host',\"my-server:18080\"},{\"content-type\",{'Content-Type',\"multipart/form-data; boundary=--------------------------612548610655818550205814\"},{\"content-length\",{'Content-Length',\"489\"},{\"connection\",{'Connection',\"keep-alive\"},nil,nil},nil},nil},nil},{\"user-agent\",{'User-Agent',\"PostmanRuntime/7.1.1\"},nil,nil}}}}]},'POST'],[{file,\"src/emqttd_http.erl\"},{line,67}]},{mochiweb_http,headers,5,[{file,\"src/mochiweb_http.erl\"},{line,93}]}]}\n2018-01-23 17:02:36.037 [error] <0.1439.0> Supervisor 'esockd_connection_sup - <0.1439.0>' had child connection started with mochiweb_http:start_link({emqttd_http,handle_request,[{state,#Fun<emqttd_http.2.29935044>}]}) at <0.23174.0> exit with reason no function clause matching emqttd_http:handle_request(\"/\", {mochiweb_request,[{esockd_connection,[#Port<0.9900>,#Fun<esockd_transport.2.118520527>,[]]},'POST',...]}, 'POST') line 67 in context connection_crashed\n2018-01-23 17:11:07.729 [error] <0.23191.0>@emqttd_http:params:179 Body:<<\"----------------------------333240630021304539525767\\r\\nContent-Disposition: form-data; name=\\\"qos\\\"\\r\\n\\r\\n1\\r\\n----------------------------333240630021304539525767\\r\\nContent-Disposition: form-data; name=\\\"retain\\\"\\r\\n\\r\\n0\\r\\n----------------------------333240630021304539525767\\r\\nContent-Disposition: form-data; name=\\\"topic\\\"\\r\\n\\r\\napi/req\\r\\n----------------------------333240630021304539525767\\r\\nContent-Disposition: form-data; name=\\\"message\\\"\\r\\n\\r\\npayload\\r\\n----------------------------333240630021304539525767--\\r\\n\">>\n2018-01-23 17:12:35.345 [error] <0.23191.0>@emqttd_http:dispatcher:107 Execute API 'mqtt/publish' Error: {function_clause,[{emq_retainer,on_message_publish,[{mqtt_message,<<0,5,99,114,35,109,96,64,110,125,0,0,90,151,0,0>>,undefined,http,<<\"api/test\">>,1,[],0,false,false,[],<<>>,{1516,716755,345501}},[{expiry_interval,0},{included_applications,[]},{storage_type,ram},{max_payload_size,65536},{max_message_num,1000000}]],[{file,\"src/emq_retainer.erl\"},{line,62}]},{emqttd_hooks,run_,3,[{file,\"src/emqttd_hooks.erl\"},{line,96}]},{emqttd_server,publish,1,[{file,\"src/emqttd_server.erl\"},{line,91}]},{emqttd_mgmt,publish,1,[{file,\"src/emqttd_mgmt.erl\"},{line,224}]},{emqttd_rest_api,publish,2,[{file,\"src/emqttd_rest_api.erl\"},{line,334}]},{emqttd_http,'-dispatcher/1-fun-6-',3,[{file,\"src/emqttd_http.erl\"},{line,101}]},{mochiweb_http,headers,5,[{file,\"src/mochiweb_http.erl\"},{line,93}]}]}\n2018-01-23 17:12:54.214 [error] <0.23191.0>@emqttd_http:dispatcher:107 Execute API 'mqtt/publish' Error: {{case_clause,<<\"1\">>},[{emqttd_message,make,4,[{file,\"src/emqttd_message.erl\"},{line,45}]},{emqttd_mgmt,publish,1,[{file,\"src/emqttd_mgmt.erl\"},{line,223}]},{emqttd_rest_api,publish,2,[{file,\"src/emqttd_rest_api.erl\"},{line,334}]},{emqttd_http,'-dispatcher/1-fun-6-',3,[{file,\"src/emqttd_http.erl\"},{line,101}]},{mochiweb_http,headers,5,[{file,\"src/mochiweb_http.erl\"},{line,93}]}]}\n2018-01-23 17:16:24.411 [error] <0.23191.0>@emqttd_http:dispatcher:107 Execute API 'mqtt/publish' Error: {{case_clause,<<\"1\">>},[{emqttd_message,make,4,[{file,\"src/emqttd_message.erl\"},{line,45}]},{emqttd_mgmt,publish,1,[{file,\"src/emqttd_mgmt.erl\"},{line,223}]},{emqttd_rest_api,publish,2,[{file,\"src/emqttd_rest_api.erl\"},{line,334}]},{emqttd_http,'-dispatcher/1-fun-6-',3,[{file,\"src/emqttd_http.erl\"},{line,101}]},{mochiweb_http,headers,5,[{file,\"src/mochiweb_http.erl\"},{line,93}]}]}\n2018-01-23 17:17:24.952 [error] <0.23203.0>@emqttd_http:dispatcher:107 Execute API 'mqtt/publish' Error: {{case_clause,<<\"1\">>},[{emqttd_message,make,4,[{file,\"src/emqttd_message.erl\"},{line,45}]},{emqttd_mgmt,publish,1,[{file,\"src/emqttd_mgmt.erl\"},{line,223}]},{emqttd_rest_api,publish,2,[{file,\"src/emqttd_rest_api.erl\"},{line,334}]},{emqttd_http,'-dispatcher/1-fun-6-',3,[{file,\"src/emqttd_http.erl\"},{line,101}]},{mochiweb_http,headers,5,[{file,\"src/mochiweb_http.erl\"},{line,93}]}]} \nEnd of log \ud83d\udcdc  \nI hope that amounts to something @emqplus  \n---UPDATE---  \nThis was due to poor content formatting . --UPDATE-- @Moolica23\nIt works. \nRefer to the REST API link instead. \nsample request \ncurl  \ncurl -X POST \\\n  http://<your-server.com>:<port>/api/v2/mqtt/publish \\\n  -H 'Accept: application/json' \\\n  -H 'Authorization: <AUTH>' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"client_id\" :\"postman\",\n    \"qos\" : 1,\n    \"retain\" : false,\n    \"topic\":\"api/test\",\n    \"message\" : \"payload\"\n}' \nChange Authorization , server url and port \nsample payload structure\njavascript \n {\n    \"client_id\" :\"postman\",\n    \"qos\" : 1,\n    \"retain\" : false,\n    \"topic\":\"api/test\",\n    \"message\" : \"payload\"\n}. Thanks, this issue has been resolved by explicitly declaring \nlistener.ws.external.proxy_protocol = off\nlistener.wss.external.proxy_protocol = off  as mentioned above.\nThen killing and starting up the emqttd service\nThanks @emqplus .\n\ud83d\udc4d . Hey @emqplus  and @turtleDeng \nApparently the inability to resolve this particular host-name is not an emqttd service issue.\nThe results of telnet are telnet: could not resolve den1.mysql1.gear.host:3306/telnet: Name or service not known. \nThanks for pointing it out. I'll work with host IP in this case.\nClosing...\n. Hey @Nawneet47  ,\nAfter setting up EMQ on your system as described in this installation link , the default port configurations are as detailed here only change if need be.\nNow, about the dashboard, by default the dashboard is enabled and starts automatically on port 18083 unless altered in the respective configs. Going to http(s)://<your-server-or-device-host-or-ip>:18083 should present you with a login interface. username=admin:password:public ...Once logged in you should be able to see all connected clients to your EMQ server.\nI have attached a screenshot of a running EMQ server instance's dashboard.\n\n. Am  not sure I understand your question but maybe @emqplus  could chip in.\nHere's how I could approach it; I am assuming what is happening is that anonymous authentication is allowed in your broker configs. In your emq.conf file ensure you have made the following changes \nmqtt.allow_anonymous = true changed to mqtt.allow_anonymous = false . This will only authenticate clients based on rules provided by the ACL file or Auth plugins. \nAlso have a look at the following sections: \n- Internal ACL module \n- (Dis)Allowing Anonymous Authentications\n- Some ACL rules \nLet me know if this helps\nPS - Note the difference between the following rules subscribe , publish , pubsub and topic wildcards. Thanks @emqplus . \nWe've been in touch.. ",
    "s4kibs4mi": "Hello @vishr ,\nI have merged the PR. Thanks for the contribution :). @tigercl no. I was trying to connect reconnect only one connection and this is happening in cluster mode only. Is there any situation that broker taking time to clean session across cluster and in the mean time I am trying to reconnect. As I am using same client id every time, broker may consider them as same client id trying to connect as previous is not cleaned yet.. @tigercl  I am using kubernetes on GKE with these settings,\nenv:\n          - name: EMQ_NAME\n            value: \"emqx\"\n          - name: EMQ_CLUSTER__DISCOVERY\n            value: \"k8s\"\n          - name: EMQ_CLUSTER__K8S__APISERVER\n            value: \"https://kubernetes.default:443\"\n          - name: EMQ_CLUSTER__K8S__NAMESPACE\n            value: \"emqx\"\n          - name: EMQ_CLUSTER__K8S__SERVICE_NAME\n            value: \"emqx\"\n          - name: EMQ_CLUSTER__K8S__ADDRESS_TYPE\n            value: \"ip\"\n          - name: EMQ_CLUSTER__K8S__APP_NAME\n            value: \"emqx\"\n          - name: EMQ_NODE__COOKIE\n            value: \"secret123\"\n          - name: EMQ_CLUSTER__NAME\n            value: \"emqx\"\n          - name: EMQ_CLUSTER__AUTOHEAL\n            value: \"on\"\n          - name: EMQ_CLUSTER__AUTOCLEAN\n            value: \"5m\". ```\n19:38:56.197 [debug] [MQTT] RECV PUBREC(Q0, R0, D0, PacketId=31)\n(emqx@10.12.0.81)1>\n19:38:56.198 [debug] [MQTT] SEND PUBREL(Q1, R0, D0, PacketId=31)\n(emqx@10.12.0.81)1>\n19:38:56.198 [debug] [MQTT] RECV PUBCOMP(Q0, R0, D0, PacketId=1)\n(emqx@10.12.0.81)1>\n19:38:56.198 [debug] [MQTT] RECV PUBREC(Q0, R0, D0, PacketId=1)\n(emqx@10.12.0.81)1>\n19:38:56.198 [warn]  [Session] The PUBREC PacketId 1 is not found.\n(emqx@10.12.0.81)1>\n19:38:56.198 [debug] [MQTT] SEND PUBREL(Q1, R0, D0, PacketId=1)\n(emqx@10.12.0.81)1>\n19:38:56.198 [debug] [MQTT] RECV PUBREC(Q0, R0, D0, PacketId=2)\n19:38:56.198 [warn]  [Session] Duplicated PUBREC PacketId 2\n19:38:56.199 [debug] [MQTT] SEND PUBREL(Q1, R0, D0, PacketId=2)\n19:38:56.199 [debug] [MQTT] RECV PUBREC(Q0, R0, D0, PacketId=3)\n19:38:56.199 [warn]  [Session] Duplicated PUBREC PacketId 3\n19:38:56.199 [debug] [MQTT] SEND PUBREL(Q1, R0, D0, PacketId=3)\n19:38:56.199 [debug] [MQTT] RECV PUBREC(Q0, R0, D0, PacketId=4)\n19:38:56.199 [warn]  [Session] Duplicated PUBREC PacketId 4\n```. @Gilbert-Wong any update ?. @Gilbert-Wong sorry delayed reply. gist log is for qos 1 and 2nd comment log is for qos2. In both cases I am getting duplicate messages.. @Gilbert-Wong . @Gilbert-Wong thanks. Please try to fix. emqx is getting too many issues which is making it unreliable to use.. @Gilbert-Wong didn't do any changes. It's the default.. @terry-xiaoyu ok I will try this, thank you. But it's terribly weird if this is the reason of client being disconnected !. ",
    "qingchuwudi": "@pritstift \nIt is  eredis. Because otp uses queue:queue() instead of queue() now.\nerlang\n... ...\ninclude/eredis.hrl:24: type queue() undefined\n... ...\nYou should add {platform_define, \"^[0-9]+\", namespaced_types} into {erl_opts, [  ]}. which is in rebar.config or Emakefile.\nSee Erlang 17.0: Supporting Deprecated Types Without Removing warnings_as_errors\n. ",
    "pritukam": "Hi @emqplus, I tried that too. \n{allow, {ipaddr, \"172.16.36.149\"}, subscribe, \"benchmark\" }.\n{deny, all}.\nI added this to the config, hoping that the if I subscribe from the machine with the IP, the messages can be subscribed. I am unable to receive the sent messages from any machine, including the one that is allowed to subscribe and receive.\nI tried {allow, all} and now the messages can be received by any machine, which is a security threat for us.  Our use case dictates that only one specified machine be able to subscribe to the topic and no one else.\nIs there something I am missing?\np.s. thanks a lot for replying.. @emqplus Tried that just now. The machine with the IP is not receiving any messages.\n Could this be a bug? I'm using 2.1.0 . ",
    "thinkbig1979": "I was also unable to connect to the server using websocket with MQTTBOX. \nFinally I figured out that I needed to set the server address to: SERVERIP:8030/mqtt\nThe /mqtt at the end of the address is what fixed it. Not sure why this is necessary though.. ",
    "raviypujar": "I am getting Connection Time out in dashboard websocket panel. What could be wrong?\nis there anything that needs to be enabled to use the dashboard websockets application?. ",
    "inter169": "Thanks, it works on version v2.2 now. ",
    "lewnie": "Hi, try using https://github.com/talentdeficit/jsx and https://github.com/potatosalad/erlang-jose.. ",
    "dhananjaysathe": "Where can i find this code ?. bump @pavankumarkatakam @truonglx-56 is the jwt auth plugin code available somewhere?. ",
    "nestor5": "To make mnesia use SSD, I have to place the release in the SSD filesystem.  Otherwise I have to modify emqttd script to make it use RUNNER_DATA_DIR env var... found the cause..  It's the configs dir in DATA dir being missing. ",
    "franklinxkk": "used the org.fusesource.mqtt.client\n....\nmqtt.setUserName(\"bb00000000\");\nmqtt.setPassword(\"846fae12e524edaa022ff8028383d02c\");. ",
    "JamesArthurHolland": "Was able to fix issue by referencing vuejs project example from emqtt repo, found here: https://github.com/emqtt/EMQ-Web-Toolkit/blob/master/src/views/Home.vue. ",
    "YouriKorostelev": "Thank you sir.\nThat solved the issue, i didn't even think about it...\nHave a good day. ",
    "anupamadak": "I am facing the same issue , can you please tell how this issue got resolved.. ",
    "totojack": "Problem is solved in release 2.2:\n/opt/emqttd # ./bin/emqttd_ctl broker\nsysdescr  : Erlang MQTT Broker\nversion   : 2.2\nuptime    : 15 minutes, 24 seconds\ndatetime  : 2017-07-25 15:39:35\n/opt/emqttd # ./bin/emqttd_ctl topics list\n$SYS/brokers/+/clients/#\nThis issue can be closed.\n. We found the problem: from release 2.1 module emq_mod_presence was deprecated, and we didn't load the plugin into EMQ_LOADED_PLUGINS variable. So, the solution was to replace emq_mod_presence with emq_modules. Hi.\nAfter googling around the problem, it seems that it depends on ssl fragment size on Erlang ssl implementation (16 KB), without an option to limit this size with a custom value. I've found this (old) post on stackoverflow:\nhttps://stackoverflow.com/questions/19276598/erlang-ssl-set-max-send-fragment-size\n\nWe solved it moving ssl termination on an haproxy in front of emqttd (traffic from haproxy to emqttd tcp listener), and limiting the size using this directive into haproxy.cfg:\n\ntune.ssl.maxrecord 1420\n\nI'm not an Erlang developer, so I don't know if it would be possible to customize this ssl fragment size directly into Emqttd code. Anyway, our situation is quite normal:\n\ndevices communicating using 2G \nsingle Emqttd service with SSL port\nneed to optimize/limit network traffic in situations of poor bandwith\n\nIn your opinion, should Emqttd handle indipendently such cases?\nThanks.. ",
    "mostafiz789": "@turtleDeng thanks, I am able to use LDAP authentication plugin at windows, but I also want to use at docker image, for this, I need to change the configuration of LDAP plugin. I found the way https://github.com/emqtt/emq-docker by using the environment variable. But haven't manage to set the config value, can you help me by giving sample command to change auth.ldap.port = 389 and auth.ldap.user_dn = uid=%u,ou=People,dc=example,dc=com parameter of LDAP plugin?. ",
    "yogin16": "I don't think so.\nI could find the following related issue: https://github.com/emqtt/emqttd/issues/1036. ",
    "maxshucn": "I had imported my self-signed certificate to ie. but not working...\n. :-(. ",
    "kamleshnarola": "No allow to enable  auth/ACL mysql  plugin  even if i have tried all change as given. at https://github.com/emqtt/emq-auth-mysql\nbut every time it gives error in log file give.\ncrash.txt\nerror.txt\n. ",
    "Max01010101010101": "Am sorry... so we can't deliver the offline messages when the client is connected again? \n@behrad Tell me that I'm wrong, please. This is a mega-basic and needed feature. Is like an iPhone with no battery.. @behrad oh thanks, well is not so bad to me.. ",
    "eladnava": "Completely agree. This is quite basic and if not built-in should be possible via a plugin. Guess I'll try VerneMQ which has built-in LevelDB persistence.\nAlso the \"emqplus\" paid option is quite unpublished, can't find any reference to it on the Internet.. ",
    "mtsoleimani": "I have developed a tools called Silo to archive all mqtt messages. It support mysql, postgres and mongodb. we use emq as a message broker for chat application. to check offlline message simply you can store last visited message by user and compare it with archived message. now, we use Silo in production. \ncheck this:\nhttps://github.com/mtsoleimani/Silo. ",
    "18801957105": "I met the same problem.Your problem solved?If solved, could you tell me is how to solve?Looking forward to your reply!thanks!. ",
    "gfbaggio": "Hi there ... have you found a solution ?\nI am facing the same problem\nThanks. ",
    "rhwu": "Oh, the reason we want to use domain name is because we want to do ssl. We have ca signed server certificate. Assume we need to set the note name to match the domain name, correct?. So is this expected or did we do anything wrong? . Attached my changes to emq.conf as well\n$ diff emq.conf emq.conf.orig \n33c31\n< node.process_limit = 2097152\n\n\nnode.process_limit = 256000\n36c34\n< node.max_ports = 1048576\n\n\n\nnode.max_ports = 65536\n225c223\n< mqtt.listener.tcp.acceptors = 64\n\n\n\nmqtt.listener.tcp.acceptors = 8\n228c226\n< mqtt.listener.tcp.max_clients = 1000000\n\n\n\nmqtt.listener.tcp.max_clients = 1024\n244c242\n< mqtt.listener.ssl.acceptors = 64\n\n\n\nmqtt.listener.ssl.acceptors = 4\n247c245\n< mqtt.listener.ssl.max_clients = 1000000\n\n\n\nmqtt.listener.ssl.max_clients = 512\n. I tried to installed emqtt on a different machine following the instructions again, but still get io/max_fds : 1024. \n\n@emqplus If this is something obvious, can you please give us a hint? Thanks a lot!\n. Ok, it seems like this is related to deb install. \nI tried again with emqttd-ubuntu16.04-v2.2-beta.3.zip on the same server, now the max_fds looks correct - same as what I set with ulimit.. ",
    "Xirui": "Same issue on Azure vms with requirement of using signed server cert.\nAny update on this so far? . @terry-xiaoyu the FQDN/IP address mapping is correct. I am following the instructions from: https://medium.com/@emqtt/using-lets-encrypt-certificates-in-emq-b11e0e57efa6\nIs it possible for you guys to write a blog specifically for deploying EMQ on Azure/AWS instance. Thanks!\n. @terry-xiaoyu I am using emqttd-ubuntu16.04-v2.3.7.zip on standard Azure Ubuntu 16.04 VM. Port 4369 is allowed for epmd.\nThe instance has private ip address 10.2.xx.xx. Domain name msg.somedomain.com points to the public ip address of this instance.\n. @terry-xiaoyu Mosquitto with TLS is working fine for me. But I really wish to have emq running, as it provides better performance & scalability. Thanks for the help!. @terry-xiaoyu Thanks Terry, I checked those. Unfortunately I still could not make EMQ working. I tried vernemq instead, it took me 10 mins to make it up and running.\nI am really not sure which part I missed :( \nAnyway, thanks for help. I might check EMQ sometime later.. @terry-xiaoyu I am just trying to config TLS on 8883 for MQTT clients. Attached is the conf file.\nemq.conf.zip\nThanks!\n. ",
    "notduythang": "Dear @emqplus  and @huangdan \nIs this feature deployed into 2.2-beta.3 or I have to wait for next version ?\nThank you so much.\n. ",
    "davidepozza": "Hello\nAlready tried that subscription. No notifications at all. This was the reason because I also tried to subscribe to $SYS/#. On the previous message I wrote \"$SYS/brokers/${node}/clients/#\" but I was meaning \"$SYS/brokers/+/clients/#\". Dears\nI can confirm that your use case works.\nI forgot to tell you that on my use case I'm using the redis auth plugin. It seems that the issue is strictly related to that additional component.\nI created another use case with the same version and configuration of your use case and just added the redis auth plugin. On redis I executed the following commands:\nredis-cli HSET \"mqtt_user:myuser\" \"password\" \"mypass\" \nredis-cli HSET \"mqtt_acl: myuser\" \"\\$SYS/#\" \"1\"\nWith this configuration you should be able to reproduce the issue that, as I previously said, is only related to the publishing on $SYS/brokers/+/clients/#. All the other $SYS messages are correctly received.\n. ",
    "chinhnguyentrung": "@davidepozza I think the cause could be that \"{deny, all, subscribe, [\"$SYS/#\", {eq, \"#\"}]}.\" in etc/acl.config file.. ",
    "CC-Hsu": "Hi,\nThanks for your help.\nIt works after RPM force installation.. ",
    "VuNgocTuan": "Thanks, I have a question. How can I get all live client? and all topic throw your dashboard API?. ",
    "PotiXIE": "\u671f\u5f852.3. ",
    "Suko": "As I understand you need your own application to do clients management? Maybe I missed something but what I thought is that it is not important which plugin you are using you should be able to add/remove clients through the admin tool without an additional application it would really speed up the process at the start.. ",
    "luabish": "I run emqtt first time on my mac os x 10.13.It failed to start and throwed some erlang error.After I saw the advice to delete ~/.erlang.cookie,It works.Confusing. ",
    "miller111": "@emqplus Thanks .\nIt was mentioned on http://emqtt.io/docs/v2 that \"The broker only allows clients from localhost to subscribe $SYS topics by default\".\nHow can we change it to allow subscription on $SYS topic from non localhost clients?. ",
    "codewiget95": "Found that this is a duplicate\n. @turtleDeng I did that, and then I just upgraded my GNU make to version 4, but it is still not giving me any bin folder to start my emqttd console with my RP 18.2 and emq 2.1.2. \nI use \" make\", no result, then \"make distclean\" and \"make app\", still no bin folder\nhere are the contents of my emqttd folder now: \nusr@usr-VirtualBox:~/repos/emqttd_src/emqttd-2.1.2$ ls\nCONTRIBUTORS.md  doc   emqttd.d   etc      LICENSE   priv       rebar.config  src\ndeps             ebin  erlang.mk  include  Makefile  README.md  rebar.lock    test\nAnd in emq-relx directory I get the same missing file error, which i expect is because I don't have RP 19+\n. @turtleDeng, I upgraded my Erlang install to the most updated version, and compiled and made the emq-rlx perfectly fine. I'm not sure which version of Erlang should be used with 2.1.2 . @zhengyupan , Do you have any experience with the user_lookup_fun? Is it similar to a callback function? I cannot find any documentation on this lookup function. \nFor that matter, does emq work similarly to how mosquitto handles psk? By using an SSL_CTX_set_psk_client_callback to configure the pre-shared key? That is an openssl command, I don't think emq uses openssl.\nIt cannot be that difficult to enable PSK, it just seems that there are a few small pieces and specs missing.\nThanks.. @zhengyupan I run the same commands and get the same results. There don't seem to be any psk suites enabled.\nI'll comment again when I make more progress\n. @zhengyupan , \nRunning rp(ssl:cipher_suites(all)). yields all of the ciphers, one of which is {psk, aes_256_cbc, sha} cipher that we need. We just need to replace sha512 in the code with sha. FYI - I posted this question this morning in the erlang-questions group, and got this really helpful response. I'm sure it will help you understand even more: https://groups.google.com/forum/#!topic/erlang-programming/C_HE7L5coqE\nWhich is Great! We no longer get an error there anymore. Now the next part is getting the psk identity and secret right. \nEDIT: Got it working by modifying the ssl options! Last step is creating a plugin right?\nEDIT: After a few hours working on a plugin, I'm a bit stumped. Not sure if I want to overwrite the ssl:listen or what, to achieve my results. Do you have any ideas? I went through this guide here https://www.sakib.ninja/how-to-emq-plugin-development/ , when attempting to run the code it didn't working inside of emqttd console didnt work.\n. @zhengyupan,\nI have read through the docs on EMQ extensively and through this \"walkthrough\" here: https://www.sakib.ninja/how-to-emq-plugin-development/ and I am missing a few core concepts.\nTo handle authentication hooks, it looks like I want to intercept authentication on session created or client connected, but the problem with those is that there are no arguments for the client options to check. For example, if I want to write code on top of a hook, how can I do that without knowing the client ssl opts? It looks like all of the hooks are triggered after the user is connected, which defeats the purpose.\nAlso, In the config file, I can specify a psk_secret that the client can use and the server will validate, but how do I then reference that from my erlang code? I know that cuttlefish does work on it, but how do I then reference it?\nThank you for your help!. Thanks, that worked!. @emqplus, I am currently working on implementing this right now... is your email feng@emqtt.io? I'd love to chat about your implementation, especially since mine is for PSKs and I imagine you are using ssl:peercert?\n. ",
    "sincethen": "@emqplus Thanks for your reply so much. I'll publish 8k different topics and use 8k subsribers to subscribe each topic later.. @emqplus Then, how many messages could the emq be able to process per second for only one topic? It seems that it depends on memory and the amount of subscribers. I'd also like to have the quantization result. For example, for one topic, how many memories would be used by 1k messages per second and how many subsribers should subscribe them? Maybe, we should also consider the amount of publisher?. @emqplus Thank you. But I couldn't find the one topic scenario in the performance report above. Could you tell me how to calculate/transform the result from the report for the one topic scenario?. ",
    "michaelschollerer": "@turtleDeng I'm sorry. It was a wireshark proto display and client error. Thanks!\n. ",
    "workingegg": "@turtleDeng \nYou're welcome.\nTo confirm the change, you can either run a benchmark test and check the log with eMQTT or directly cat the limits with PID:\n```\nsystemctl status emqttd.service\nemqttd.service - emqtt daemon\n   Loaded: loaded (/usr/lib/systemd/system/emqttd.service; enabled; vendor preset: disabled)\n   Active: active (running) since \u4e00 2017-07-10 09:38:35 CST; 8h ago\n  Process: 16995 ExecStart=/bin/sh /root/emqttd/bin/emqttd start (code=exited, status=0/SUCCESS)\n   CGroup: /system.slice/emqttd.service\n           \u251c\u250017118 /root/emqttd/erts-8.1/bin/epmd -daemon\n           \u251c\u250017126 /root/emqttd/erts-8.1/bin/run_erl -daemon /tmp/erl_pipes/emqttd@10.39.237.26/ /...\n           \u251c\u250017128 /root/emqttd/erts-8.1/bin/beam.smp -W w -e 256000 -Q 1048576 -P 2097152 -A 32 -...\n           \u251c\u250017542 erl_child_setup 1048576\n           \u251c\u250017597 sh -s disksup\n           \u251c\u250017598 /root/emqttd/lib/os_mon-2.4.1/priv/bin/memsup\n           \u251c\u250017599 /root/emqttd/lib/os_mon-2.4.1/priv/bin/cpu_sup\n           \u251c\u250017661 inet_gethost 4\n           \u2514\u250017685 inet_gethost 4\n...\n...\n```\nThen you can check, PID 17128, for example:\n```\ncat /proc/17128/limits\nLimit                     Soft Limit           Hard Limit           Units   \nMax cpu time              unlimited            unlimited            seconds \nMax file size             unlimited            unlimited            bytes   \nMax data size             unlimited            unlimited            bytes   \nMax stack size            8388608              unlimited            bytes   \nMax core file size        0                    unlimited            bytes   \nMax resident set          unlimited            unlimited            bytes   \nMax processes             1030615              1030615              processes \nMax open files            1048576              1048576              files   \nMax locked memory         65536                65536                bytes   \nMax address space         unlimited            unlimited            bytes   \nMax file locks            unlimited            unlimited            locks   \nMax pending signals       1030615              1030615              signals \nMax msgqueue size         819200               819200               bytes   \nMax nice priority         0                    0                  \nMax realtime priority     0                    0                  \nMax realtime timeout      unlimited            unlimited            us\n```. ",
    "kpacn": "That was the first thing I did. Even turned off the cache, but still . Even with random user and pass it hits on_connect callback.. Yeah, I figured out,  just expected broker to drop connection immediately or raise some kind of permission denied response.. ",
    "onimsha": "Sorry i think my question is not applicable here. Client application should support this, not server. . ",
    "pastukhov": "Thanks!. ",
    "toy-lin": "I have encountered with the same problem.I have tried OPT21.1 and OPT21 version of erlang and i got the same error.\nCould you please tell me how to check my erlang operating environment?\n@turtleDeng \n@rauger . ",
    "pineli": "how can I get information about EMQ Enterprise. I already sent you an email? # @ @emqplus . ",
    "Loxchen": "I found out that below in emq.conf can solve my problem\nUpgrade QoS?\nmqtt.session.upgrade_qos = on\n. ",
    "hackborn": "Ahhh sorry, I didn't see the note that all cfg items were available, I thought that was a complete list. Thanks much for the info!. ",
    "xuejipeng": "@turtleDeng \nThe following is the logs,we will pass some pictures, the log information is relatively large, so I did not stick out\nFor security reasons, I put the corresponding emq client IP to emq_clitent, APIserver IP replaced by api_server\n2017-08-01 15:05:47.910 [debug] <0.1328.0>@emqttd_client:handle_info:235 Client(emq_clitent:36364): RECV <<192,0>>\n2017-08-01 15:05:47.910 [info] <0.1328.0>@emqttd_protocol:trace:347 Client(18501344613@emq_client:36364): RECV PINGREQ(Q0, R0, D0)\n2017-08-01 15:05:47.911 [info] <0.1328.0>@emqttd_protocol:trace:350 Client(18501344613@emq_client:36364): SEND PINGRESP(Q0, R0, D0)\n2017-08-01 15:05:47.911 [debug] <0.1328.0>@emqttd_client:send_fun:137 Client(emq_clitent:36364): SEND [<<\"\u00d0\">>,<<0>>,<<>>,<<>>]\n2017-08-01 15:05:49.428 [debug] <0.1320.0>@emqttd_client:handle_info:235 Client(api_server:51616): RECV <<56,175,2,0,49,97,110,108,111,113,47,49,56,54,48,48,56,55,57,56,54,51,101,49,48,97,100,99,51,57,52,57,98,97,53,57,97,98,98,101,53,54,101,48,53,55,102,50,48,102,56,56,51,101,101,121,74,117,89,87,49,108,73,106,111,105,90,88,70,48,89,50,70,115,98,67,73,115,73,109,57,105,97,109,86,106,100,67,73,54,101,121,74,108,99,88,82,102,98,109,70,116,90,83,73,54,73,117,83,52,114,101,87,70,115,43,97,100,107,101,87,119,106,43,87,77,117,115,75,51,77,84,65,119,53,89,43,51,53,113,87,56,77,101,87,78,108,101,87,70,103,121,73,115,73,109,86,120,100,70,57,112,90,67,73,54,73,106,69,119,77,68,65,119,77,67,73,115,73,110,86,117,97,88,82,102,97,87,81,105,79,105,73,120,77,68,65,119,77,68,65,105,76,67,74,105,89,87,57,112,90,67,73,54,73,106,86,106,79,109,89,52,79,106,73,120,79,109,82,108,79,106,85,49,79,106,100,106,73,105,119,105,89,50,57,116,98,87,70,117,90,67,73,54,77,72,48,115,73,110,82,112,98,87,85,105,79,105,73,121,77,68,69,51,76,84,65,52,76,84,65,120,86,68,69,49,79,106,65,49,79,106,81,53,76,106,81,120,79,70,111,105,102,81,61,61>>\n2017-08-01 15:05:49.429 [info] <0.1320.0>@emqttd_protocol:trace:347 Client(mqttjs_bf69cab4@api_server:51616): RECV PUBLISH(Q0, R0, D1, Topic=anloq/18600879863e10adc3949ba59abbe56e057f20f883e, PacketId=undefined, Payload=<<\"eyJuYW1lIjoiZXF0Y2FsbCIsIm9iamVjdCI6eyJlcXRfbmFtZSI6IuS4reWFs+adkeWwj+WMusK3MTAw5Y+35qW8MeWNleWFgyIsImVxdF9pZCI6IjEwMDAwMCIsInVuaXRfaWQiOiIxMDAwMDAiLCJiYW9pZCI6IjVjOmY4OjIxOmRlOjU1OjdjIiwiY29tbWFuZCI6MH0sInRpbWUiOiIyMDE3LTA4LTAxVDE1OjA1OjQ5LjQxOFoifQ==\">>)\n2017-08-01 15:05:49.429 [info] <0.1320.0>@emqttd_server:trace:105 mqttjs_bf69cab4/anloqmqtt0 PUBLISH to anloq/18600879863e10adc3949ba59abbe56e057f20f883e: <<\"eyJuYW1lIjoiZXF0Y2FsbCIsIm9iamVjdCI6eyJlcXRfbmFtZSI6IuS4reWFs+adkeWwj+WMusK3MTAw5Y+35qW8MeWNleWFgyIsImVxdF9pZCI6IjEwMDAwMCIsInVuaXRfaWQiOiIxMDAwMDAiLCJiYW9pZCI6IjVjOmY4OjIxOmRlOjU1OjdjIiwiY29tbWFuZCI6MH0sInRpbWUiOiIyMDE3LTA4LTAxVDE1OjA1OjQ5LjQxOFoifQ==\">>\n2017-08-01 15:05:49.946 [debug] <0.1332.0>@emqttd_client:handle_info:235 Client(118.198.7.27:53882): RECV <<192,0>>\n2017-08-01 15:05:49.946 [info] <0.1332.0>@emqttd_protocol:trace:347 Client(18600879863@emq_clitent:53882): RECV PINGREQ(Q0, R0, D0)\n2017-08-01 15:05:49.946 [info] <0.1332.0>@emqttd_protocol:trace:350 Client(18600879863@emq_clitet:53882): SEND PINGRESP(Q0, R0, D0)\n2017-08-01 15:05:49.946 [debug] <0.1332.0>@emqttd_client:send_fun:137 Client(emq_clitent:53882): SEND [<<\"\u00d0\">>,<<0>>,<<>>,<<>>]\n2017-08-01 15:05:51.532 [debug] <0.1320.0>@emqttd_client:handle_info:235 Client(api_server:51616): RECV <<48,147,70,0,53,97,110,108,111,113,47,105,109,103,47,49,56,54,48,48,56,55,57,56,54,51,101,49,48,97,100,99,51,57,52,57,98,97,53,57,97,98,98,101,53,54,101,48,53,55,102,50,48,102,56,56,51,101,85,107,108,71,82,115,81,90,65,65,66,88,82,85,74,81,86,108,65,52,73,76,103,90,65,65,66,119,55,81,67,100,65,83,113,65,65,117,65,66,80,114,86,89,112,107,56,110,74,75,103,116,73,98,72,74,121,97,65,87,105,87,100,117,50,81,99,56,110,70,108,105,72,115,111,97,10,108,53,69,101,50,119,72,50,52,97,72,48,84,57,54,47,82,51,55,74,53,104,47,75,103,70,66,49,111,43,79,87,105,97,117,109,47,115,101,103,86,122,56,47,111,102,82,88,43,71,102,57,53,51,52,111,114,74,101,88,71,90,78,49,110,81,80,67,121,113,115,65,43,51,102,77,10,117,54,112,89,80,75,43,88,80,120,68,111,56,82,47,110,57,116,43,108,80,72,105,100,84,102,54,112,67,113,114,53,47,111,81,74,72,86,56,49,80,120,72,70,112,97,98,71,84,74,112,54,112,104,47,86,54,50,103,110,72,116,80,48,73,120,102,88,53,84,118,76,86,80,74,69,10,97,69,113,87,76,65,55,105,67,68,122,108,86,74,122,67,108,115,100,97,89,53,86,79,99,110,73,76,111,119,47,116,51,86,115,114,121,100,103,98,80,67,66,43,76,50,51,103,65,108,97,81,43,114,100,102,68,79,102,121,76,72,81,72,108,86,72,89,43,79,43,122,80,104,54,112,10,47,77,68,47,43,120,79,118,77,70,119,118,113,111,89,55,67,65,102,118,55,49,88,117,53,121,107,48,82,55,68,49,89,86,82,121,77,77,75,53,81,53,120,83,80,117,120,108,86,52,57,103,107,119,102,119,86,55,71,57,89,120,53,69,110,101,70,43,55,85,106,74,82,49,104,66,10,109,85,65,79,81,79,85,50,72,87,79,73,71,43,70,87,98,84,105,43,55,69,119,90,114,78,78,72,68,66,106,110,120,56,79,70,108,107,52,88,43,107,72,102,49,72,90,75,48,100,114,105,68,76,103,89,68,75,48,69,65,117,67,47,78,65,104,78,100,101,85,70,90,84,98,82,10,106,47,67,103,66,67,77,72,57,109,53,103,99,86,100,78,97,84,80,109,83,52,84,102,109,89,51,80,90,49,115,89,100,53,101,48,76,114,101,120,47,99,83,52,88,87,109,55,51,118,70,104,85,52,82,54,76,89,78,116,85,111,98,48,105,55,65,87,81,122,78,66,53,78,101,55,10,53,112,112,103,112,111,102,73,69,121,101,80,70,84,49,80,77,86,89,67,110,90,84,88,53,99,118,87,109,68,84,75,66,116,76,87,53,78,49,117,98,50,79,73,117,85,114,55,70,68,109,117,90,65,57,76,107,47,117,55,49,100,43,70,87,55,101,106,70,97,71,109,72,79,80,52,10,71,112,102,120,115,69,43,117,118,119,71,116,48,88,82,85,76,119,112,118,112,52,108,80,104,116,100,105,65,69,47,108,85,73,121,85,102,110,70,86,67,113,88,116,117,99,112,74,117,98,120,80,67,101,117,56,84,97,48,56,97,71,76,75,84,111,99,107,97,103,82,51,77,52,114,83,10,72,57,75,118,116,88,56,89,111,108,55,84,121,51,54,75,90,86,111,114,82,78,111,111,100,54,112,102,83,65,119,66,76,72,75,122,69,65,81,68,66,117,74,85,100,68,113,100,110,47,54,69,110,107,81,113,118,72,73,107,120,83,90,101,118,99,43,101,83,109,89,107,74,111,70,109,10,114,76,52,98,110,78,119,106,68,72,52,86,66,77,112,79,48,117,74,114,106,74,66,76,116,50,49,76,107,83,82,98,65,110,76,75,54,69,103,80,76,67,67,68,87,43,81,104,69,74,119,50,52,113,109,80,69,72,87,66,118,78,71,105,80,75,43,113,57,116,75,57,84,70,48,121,10,57,109,70,47,49,51,122,57,79,67,85,50,57,66,87,73,113,100,77,81,122,104,86,98,90,115,89,65,108,119,71,84,113,113,102,81,55,107,50,54,108,100,121,74,87,103,109,99,78,83,76,117,68,81,52,118,76,65,70,106,56,55,48,50,70,112,116,50,120,89,111,102,80,74,86,87,10,104,48,104,73,86,65,110,103,77,66,72,66,102,109,100,88,121,79,118,119,71,55,52,57,107,107,99,69,54,98,106,76,97,65,73,84,80,56,68,85,119,109,84,84,72,74,107,81,51,103,115,57,119,84,55,71,122,116,119,88,71,82,53,55,106,68,84,85,47,47,50,50,80,50,104,109,10,82,103,72,68,117,74,116,98,77,104,89,118,48,56,113,79,109,114,116,57,57,53,89,119,50,102,121,50,108,118,98,90,85,53,80,120,47,103,47,114,72,55,80,121,108,122,67,73,72,121,113,85,117,119,104,56,65,75,121,79,79,66,109,105,47,56,74,122,85,67,116,90,66,72,73,52,10,87,106,43,84,107,47,73,107,97,85,52,54,97,120,53,117,69,80,57,73,111,108,89,84,82,67,110,66,103,57,120,107,48,75,78,84,107,69,112,116,65,108,111,103,111,98,110,86,111,113,87,66,69,120,111,88,71,112,48,87,108,75,75,89,102,104,71,70,56,110,97,114,75,90,79,104,10,...>>. @emqplus I may find the problem, it may be the client's problem, we now found that the topics of the subscription will be lost, and in non-abnormal state, sometimes the tunnel will be disconnected and no longer re-connected\u3002\n. I have the same problem, I have a cluster including two 2-core 4G server, but I measured the client to accept the rate can only reach 1200msg / sec, and how my server only one thread(beam.smp), I use the emq2 .1.2, is my version of the problem? I used to test the client's configuration is 24-core 54G, I was using the order is\n\u00a0 ./emqtt_bench_pub -c 20 -k -I 10 -t bench /% i\n./emqtt_bench_sub -c 2000 -k -i 1 -t bench /% i. ",
    "UserXYZ": "I did see that exact page and I tried to replicate that, but no success...\nHere's what I was trying:\n- in one console: mosquitto_sub -h localhost -t \"/#\"\n- in another console: coap-client -m put -e \"message\" \"coap://localhost/mqtt/test?c=localhost\"\nand nothing happens - coap-client spits out two lines of something and nothing is shown in the other console.\nTried the other way around as well:\n- in one console: coap-client -m get -s 10 \"coap://localhost/mqtt/test?c=client1\"\n- in another console: mosquitto_pub -t \"/test\" -h localhost -m \"test msg\"\nNothing is received on the other side...\nmqtt to mqtt works, as does coap to coap - but not mixing it.\nI tried with normal IP address instead of localhost, I tried with different parameters...nothing. I do not have auth enabled nor any other special/tricky feature, so it confuses me...\nWhat am I doing wrong?. Why, thank you, that did the trick...I just wonder how it didn't work with me using '/#' since I always had to use '/something' to make mqtt work properly, so all my topics on already working devices are in '/a/b/c' form...\nTested also that version, I had to put /mqtt/%2ftest?c=client1 in order to encode the topic as '/test' and it also worked.\nThanks again.\nBTW is emqt_coap going to implement POST and DELETE methods? I must say I did have a lot of unsuccessful tests using POST instead of PUT before I found out that coap plugin only supports PUT and GET...\nI do know that the difference between PUT and POST in not that important for many use cases, so we could probably live only with PUT just fine, but having a DELETE could be useful for many situations, like erasing the previous config on a IoT device when updating it...or similar.... ",
    "RaymondMouthaan": "@emqplus @Piedpieper is there any progress on this ? I would like to do more of less the same with cloudmqtt.. @victorclaessen @gdillen could you be so kind to help me setting up a bridge between a public broker (cloudmqtt) and emq (which is local)? Have managed to setup a mosquitto bridge who connects to cloudmqtt, but how do i forward it to emq (cluster)? An example mosquitto.conf would be very helpful :-). @victorclaessen Just what I needed! I guess I got confused after hour of reading and trying, but the conf examples and explaination just helps me out and now its working! \nThanks for helping me out \ud83e\udd47 . Maybe i can help you out by this link to my repo https://hub.docker.com/r/raymondmm/emqtt/\nI've created a github project to build emq docker images for arm64, arm32v6 and arm64v8, all of these are manifest listed.\n@terry-xiaoyu , I've you are interested, I would like to participate to make a official emq docker images. . @zhanghongtong, would it be possible to use the Erlang base image from here instead of compiling from scratch? It reduces the build time significantly.\nCurrently I am working on the project to build images for arch arm32v6, arm32v7, arm64v8 and amd64, if all works well I can do a PR to this emqx project and all images can be pushed to the official docker hub repo.\nThanks,\nRay. ",
    "Marc-drouet": "\n@emqplus I created a bridge a few weeks ago, I can share it if you'd like - Right now it works but I am concerned about the concurrency connecting to AWS - I am using emqttd:subscribe to create multiple listeners sharing the local subscription on the EMQ side, but as of now I can't figure out how to share subscriptions with multiple processes on the AWS side. For example, If i use emqttc:start_link to connect multiple subscribing processes to AWS, all will get all messages on that topic.\nHow have you solved this?\n\nHi PiedPiper, could you share with me how you have configured emqtt in order to bridge with IOT AWS, i'm trying to do it but no success :(\n. > @Marc-drouet I'm not able to share the code, but I created a very basic plugin with one dependency, emqttc and connected to AWS. For a certain range of topics on AWS, I subscribed using emqttc:subscribe and then published messages received from AWS to emqttd using emqttd:publish. For a certain range of topics on emqttd, I used emqttd:subscribe and any messages received i forwarded over emqttc:publish to AWS IoT.\nOk, thanks, i will try this kind of solution.\n. > Hi,\n\nBridging emq to AWS IoT is supported in the newly release emqx 3.0. Please check out and have a try.\n\nHi zhengyupan\nHi know that but i have tried without success, \ni have filled the following lines in file: /etc/emqx/emqx.conf\nlines:\n           bridge.aws.cacertfile =\n           bridge.aws.certfile =\n           bridge.aws.keyfile =\n\nbut when i run :  /usr/sbin/emqx_ctl  bridges start aws\ni got\nRPC to emqx@127.0.0.1 error: {{tcp_closed,\n                                  {gen_statem,call,\n                                      [<10598.11969.0>,connect,infinity]}},\n                              {gen_server,call,\n                                  [emqx_bridge_aws,start_bridge]}}\nProbably it's an error on my side but i have found no documention concerning bridge with AWS\nRegards\n. Hello,\nNo one to share a working \"emqx.conf\" file for establishing a bridge with AWS ?. > The change is applied to the running broker. Configuration files are not updated.\n\nEmqx does not modify any of its config files currently. It uses them to generate erlang/otp compatible config files when starting up, that's all.\n\nHi,\nSo if i restart EMQX i will lost my users?. ok, understood,\nyou are right the file is there \nthanks a lot. ",
    "naruto0916": "Thank you for your reply.. @turtleDeng \nThank you for your reply.\nFrom the guide, it seems EMQ will check username auth first if we enable username and clientid auth at the same time.\nBut, from the chart of the guide.\nWe are confused about if username is allowed and EMQ will accept the connection or continue to check the clientid is allow or not??\nAnd from the guide about emq_auth_mongo part, it seems we can just set username auth by mongodb.\nIf we want to enable username and clientid auth by mongodb, how we set the emq_auth_mongo.conf ??. @turtleDeng \nOK!! Thank you for your explanation.\nI think we misunderstood the usage about the auth plugins.\nYour answer had clarified our confusion.\nAnd one more question:\nOur requirement is auth flow need to check the username and clientid.\nAnd both username and clientid are correct, the connection will be allowed.\nIf one of them is worng, we will reject the connection.\nFrom the document, it seems we need to use emq_auth_http and implement our auth rest api for this requirement, right??. @turtleDeng \nThank you for your suggestion.. Hi turtleDeng\nAfter I remove the auth.http.acl_nomatch in emq_auth_http.conf, the error message doesn't appear.\nBut, my acl http api still doesn't be called and mqtt client still can pub/sub any topic (internal mqtt acl seems also invalid while enable the auth/acl http plugin).\nMy expectation is mqtt client will call auth/superuser http apis to allow/deny client's connection.\nAnd this part is OK.\nAnd then, I expect EMQ server will call the acl http api to allow/deny client pub/sub a topic.\nBut, this part is fail. The EMQ server never call the acl http api and client can pub/sub any topic.\nI also test the EMQ 2.3.beta.3, but the result is the same with the testing by EMQ 2.2.\nHave other configuration need to set for the http acl access function ??\n\nMy emq_auth_http.conf content is like below, have anything I lost ??\nauth.http.auth_req = http://localhost:8080/goalkeeper/service/v1/auth\nauth.http.auth_req.method = get\nauth.http.auth_req.params = clientid=%c,username=%u,password=%P\nauth.http.super_req = http://localhost:8080/goalkeeper/service/v1/superuser\nauth.http.super_req.method = get\nauth.http.super_req.params = clientid=%c,username=%u\nauth.http.acl_req = http://localhost:8080/goalkeeper/service/v1/acl\nauth.http.acl_req.method = get\nauth.http.acl_req.params = access=%A,username=%u,clientid=%c,ipaddr=%a,topic=%t\n. @dreamcatcha \nThank you for your reply.. Had found this function from document. Sorry, I miss the suffix \"/mqtt\".\nNow, everything is OK.. OK...thank you!!\nI think I miss to disable the mqtt.allow_anonymous before.\nAfter I disabled it, everything is OK!!. ",
    "alifirat": "Hi guys, \nI have some extra informations to give about my results. \nWhen I did the same benchmark on 50 clients, I have no throughput issue and all my CPUs are not bounded. Below the screenshot after 2 minutes of publishing data : \n\nI take the same screenshot for 100 clients publishing at the same rate and here the results ; \n\nCPUs seems to not be used quite well which can explain my consumer throughput decreases along the time. After 5 minutes, I got less than 1000 msg / sec. \nBetween the two tests, I stop the emqttd service, remove data in /var/lib/emqttd/mnesia and restart the service. . Hi guys, \nThe issue comes from the publisher : instead to simulate 100 devices on 1 machine, I split it in two machines and I get the expected throughput. \n. Hi, \nI reopen this issue because I got new problems in my load tests. \nI change a little bit my emq setup : now I have a load balancer in front of an emq cluster composed by 2 nodes. Each node has the same hardware configuration that my first message. \nIn publisher side, I have 4 machines running the emqtt bencharming tool as below : \n./emqtt_bench_pub -h myhost -c 50 -I 10 -t streaming_junk/%i/%i -s 1316 -q 1 -n myoffset\nEach machine publish 100 msg / seconds (so 5000 msg / sec) and simulate about 50 devices. I limited the count to 50 because the machines used in the test didn't more support more than that. \nIn consumer side, I have two mqtt-clients (classical java paho) and each subscribe to the topic $local/streaming_junk/# in order to balance the load.\nDuring 10 minutes, I got the expected throughput with 10 000 msg / second for each mqtt consumer but then my consumer's throughput decrease quickly : \n\n\n\nYou can see that the simulated devices are quite well balanced between the two nodes. My consumer throughputs decreases after 10 minutes, the used RAM increase due to qos 1. I changed two parameters of emq in each node : \nmqtt.mqueue.max_lenght = 1000000 # this one is to avoid dropped messages\nmqtt.session.max_inflight = 100 \nCan I have advices about the way to fix this issue ? Or maybe it's an existing problem in this release of emq ? \n. Hi, \nI run the same test but on only one emq-node. I didn't change the number of publishers (200  devices streaming 100 msg / sec) and during 9 hours, all have been right then I got this message : \nclient 43 EXIT: {shutdown,tcp_closed}\nclient 47 EXIT: {shutdown,tcp_closed}\nclient 46 EXIT: {shutdown,tcp_closed}\nclient 41 EXIT: {shutdown,tcp_closed}\nclient 39 EXIT: {shutdown,tcp_closed}\nclient 22 EXIT: {shutdown,tcp_closed}\nclient 49 EXIT: {shutdown,tcp_closed}\nclient 40 EXIT: {shutdown,tcp_closed}\nclient 27 EXIT: {shutdown,tcp_closed}\nclient 42 EXIT: {shutdown,tcp_closed}\nclient 48 EXIT: {shutdown,tcp_closed}\nclient 36 EXIT: {shutdown,tcp_closed}\nclient 14 EXIT: {shutdown,tcp_closed}\nclient 18 EXIT: {shutdown,tcp_closed}\nclient 29 EXIT: {shutdown,tcp_closed}\nclient 4 EXIT: {shutdown,tcp_closed}\nclient 34 EXIT: {shutdown,tcp_closed}\nclient 19 EXIT: {shutdown,tcp_closed}\nclient 28 EXIT: {shutdown,tcp_closed}\nclient 8 EXIT: {shutdown,tcp_closed}\nclient 9 EXIT: {shutdown,tcp_closed}\nSo it means that the broker closed these connections. Looking in the broker side, in the logs, I founded this : \n```\n===== ALIVE Wed Aug  9 12:21:09 UTC 2017\n===== ALIVE Wed Aug  9 12:36:09 UTC 2017\n===== ALIVE Wed Aug  9 12:51:10 UTC 2017\n===== ALIVE Wed Aug  9 13:06:10 UTC 2017\n===== ALIVE Wed Aug  9 13:21:10 UTC 2017\n===== ALIVE Wed Aug  9 13:36:10 UTC 2017\n===== ALIVE Wed Aug  9 13:51:10 UTC 2017\n===== ALIVE Wed Aug  9 14:06:10 UTC 2017\n===== ALIVE Wed Aug  9 14:21:10 UTC 2017\n===== ALIVE Wed Aug  9 14:36:10 UTC 2017\n===== ALIVE Wed Aug  9 14:51:10 UTC 2017\n===== ALIVE Wed Aug  9 15:06:11 UTC 2017\n===== ALIVE Wed Aug  9 15:21:11 UTC 2017\n===== ALIVE Wed Aug  9 15:36:11 UTC 2017\n===== ALIVE Wed Aug  9 15:51:11 UTC 2017\n===== ALIVE Wed Aug  9 16:06:11 UTC 2017\n===== ALIVE Wed Aug  9 16:21:11 UTC 2017\n===== ALIVE Wed Aug  9 16:36:11 UTC 2017\n===== ALIVE Wed Aug  9 16:51:11 UTC 2017\n===== ALIVE Wed Aug  9 17:06:11 UTC 2017\n===== ALIVE Wed Aug  9 17:21:11 UTC 2017\n===== ALIVE Wed Aug  9 17:36:12 UTC 2017\n===== ALIVE Wed Aug  9 17:51:12 UTC 2017\n===== ALIVE Wed Aug  9 18:06:12 UTC 2017\n===== ALIVE Wed Aug  9 18:21:12 UTC 2017\n===== ALIVE Wed Aug  9 18:36:12 UTC 2017\n===== ALIVE Wed Aug  9 18:51:12 UTC 2017\n===== ALIVE Wed Aug  9 19:06:12 UTC 2017\n===== ALIVE Wed Aug  9 19:21:12 UTC 2017\n===== ALIVE Wed Aug  9 19:36:12 UTC 2017\n===== Wed Aug  9 19:43:26 UTC 2017\neheap_alloc: Cannot allocate 3280272216 bytes of memory (of type \"heap\").\nCrash dump is being written to: /var/log/emqttd/crash.dump...done\n[os_mon] memory supervisor port (memsup): Erlang has closed\n[os_mon] cpu supervisor port (cpu_sup): Erlang has closed\n```\n. @gihad Hi, I cannot found a solution for my issue, sorry. . ",
    "rejji": "Is this feature release in 2.3-beta? \nWe need this functionality and I need to check what can be used as a starting point. Could you share any pointers. \n. This issue is on emqtt docker. Raised an issue at https://github.com/emqtt/emq-docker/issues/19. \nDeleting the issue from emqttd and adding at emq-docker.. Thanks for the quick response Feng, Shawn. We will take these inputs and include them. . @emqplus @terry-xiaoyu \n(I) With qos0 and mqtt.queue.qos0=false, how much memory consumption is expected? Could it be accumulating memory and get a spike in the graphs. Could you confirm and give an insight.\n(J) 'sessions list' mostly shows undefined.\nSession(paho1555105973252863, clean_sess=true, subscriptions=undefined, max_inflight=undefined, inflight=undefined, mqueue_len=undefined, mqueue_dropped=undefined, awaiting_rel=undefined, deliver_msg=undefined, enqueue_msg=undefined, created_at=1521890135)\n(K) For points A..H in original description, could you provide some info for us to debug and analyze further. \n(L) If we find a slow subscriber, what is right way detect it and remove it ('client kickout', limiting the rate, ...)\n(M) Is there a trial version we can try with for the Enterprise edition? \n. ",
    "srdgame": "Buster has same lksctp-tools version as  stretch. > netstat -an | grep 883\ntcp        0      0 0.0.0.0:11883           0.0.0.0:               LISTEN   \ntcp        0      0 0.0.0.0:8883            0.0.0.0:               LISTEN   \ntcp        0      0 127.0.0.1:12883         0.0.0.0:*               LISTEN   \nunix  3      [ ]         STREAM     CONNECTED     2883   \nunix  3      [ ]         STREAM     CONNECTED     12883001 \nunix  3      [ ]         STREAM     CONNECTED     12883002 \ncch@dirk-laptop:~/\u4e0b\u8f7d$ sudo service emqttd status\n\u25cf emqttd.service - LSB: Erlang MQTT Broker\n   Loaded: loaded (/etc/init.d/emqttd; generated; vendor preset: enabled)\n   Active: failed (Result: exit-code) since Mon 2017-08-07 15:57:42 CST; 18h ago\n     Docs: man:systemd-sysv-generator(8)\n      CPU: 662ms\n\n8\u6708 07 15:57:24 dirk-laptop systemd[1]: Starting LSB: Erlang MQTT Broker...\n8\u6708 07 15:57:25 dirk-laptop su[26171]: Successful su for emqtt by root\n8\u6708 07 15:57:25 dirk-laptop su[26171]: + ??? root:emqtt\n8\u6708 07 15:57:25 dirk-laptop su[26171]: pam_unix(su:session): session opened for user emqtt by (uid=0)\n8\u6708 07 15:57:42 dirk-laptop systemd[1]: emqttd.service: Control process exited, code=exited status=1\n8\u6708 07 15:57:42 dirk-laptop systemd[1]: Failed to start LSB: Erlang MQTT Broker.\n8\u6708 07 15:57:42 dirk-laptop systemd[1]: emqttd.service: Unit entered failed state.\n8\u6708 07 15:57:42 dirk-laptop systemd[1]: emqttd.service: Failed with result 'exit-code'.\n8\u6708 07 15:59:47 dirk-laptop epmd[5735]: epmd: got KILL_REQ - terminates normal\n. @turtleDeng \nsudo emqttd start is ok for my laptop.  I have opened the dashboard in browser. \n\nbut service status stay in failure. :-) Great!. @emqplus \nAttention PLEASE!!!!\nThis will message will not be valided by any auth interface!  It means user can fire messages on ANY topics they want!!!!!\n. Code:\nlogging.debug('%s\\t%s\\t%d\\t%d', msg.topic, msg.payload.decode('utf-8'), msg.qos, msg.retain)\nLOG:\nSat, 30 Sep 2017 14:59:51 mqtt_sub.py[line:55] DEBUG i_am_a_hack    this is hack content, which breaks your auth module 0   0. ",
    "fleimgruber": "@srdgame this #1228?. @srdgame Since this seems to be the same issue as #1228, please do as @emqplus said in https://github.com/emqtt/emqttd/issues/1228#issuecomment-329028740.. total 12\ndrwxr-xr-x  4 emqtt emqtt   75 Sep  1 09:26 .\ndrwxr-xr-x 62 root  root  4096 Sep  1 08:57 ..\ndrwxr-xr-x  2 emqtt emqtt    6 Aug 21 11:30 configs\n-r--------  1 root  root    20 Sep  1 00:00 .erlang.cookie\n-rw-r--r--  1 emqtt emqtt   53 Aug 21 11:30 loaded_plugins\ndrwxr-xr-x  2 emqtt emqtt    6 Aug 21 11:30 mnesia. Yep, that was it.  Now\n```\n\u25cf emqttd.service - LSB: Erlang MQTT Broker\n   Loaded: loaded (/etc/init.d/emqttd)\n   Active: active (running) since Sun 2017-09-03 13:55:22 CEST; 1s ago\n  Process: 13779 ExecStart=/etc/init.d/emqttd start (code=exited, status=0/SUCCESS)\n   CGroup: /system.slice/emqttd.service\n           \u2514\u25002376 /usr/lib/emqttd/erts-9.0/bin/epmd -daemon\nSep 03 13:55:13 host su[13858]: Successful su for emqtt by root\nSep 03 13:55:13 host su[13858]: + ??? root:emqtt\nSep 03 13:55:13 host su[13858]: pam_unix(su:session): session opened for user emqtt by (uid=0)\nSep 03 13:55:22 host emqttd[13779]: emqttd 2.3 is started successfully!\nSep 03 13:55:22 host systemd[1]: Started LSB: Erlang MQTT Broker.\n```\nso the question remains why this one file was owned by root.  Does this have something to do with the way emqtt is distributed in the .deb or some kind of first-time setup?\nI'll leave this open for you to decide if and when to look into it.. > I'll leave this open\nHere I was referring to the github issue.  I'll leave it open for visibility since it already has the v2.3-beta.4 milestone tag.\nThanks for the quick feedback!. @emqplus thanks for checking back.  We are already running simulations on this instance, since there was a simple workaround.  I won't upgrade it just now, maybe after the next stable release.  I will reopen in case I see this again > 2.3-beta.4.  Keep up the good work!. ",
    "lukebakken": "What version of recon is being used? It appears that this PR may have fixed this issue.. ",
    "nikoladsp": "Thank you kindly - it helped. Hi,\nI think it was something like this: \nsudo letsencrypt certonly --webroot -w /var/www/html -d www.snailit.org -d sb.snailit.org\nHope it helps, but to tell you the truth, I am always a bit of insecure when issuing certs. As I recall, I shut down the nginx before this command. ",
    "GibliX": "Output from HOST C\n12:31:10.250 [error] Unexpected Info: {mnesia_system_event,{inconsistent_database,running_partitioned_network,'**HOST A**'}}\n12:31:10.250 [critical] Mnesia inconsistent_database event: running_partitioned_network, '**HOST A**'\n12:31:10.250 [error] Mnesia('**HOST C**'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, '**HOST A**'}\n12:31:14.693 [error] Unexpected Info: {mnesia_system_event,{inconsistent_database,running_partitioned_network,'**HOST B**'}}\n12:31:14.693 [critical] Mnesia inconsistent_database event: running_partitioned_network, '**HOST B**'\n12:31:14.693 [error] Mnesia('**HOST C**'): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, '**HOST B**'}\n07:44:31.680 [error] Mnesia('**HOST C**'): ** ERROR ** mnesia_event got {inconsistent_database, starting_partitioned_network, '**HOST B**'}\n07:44:31.680 [error] Mnesia('**HOST C**'): ** ERROR ** mnesia_event got {inconsistent_database, starting_partitioned_network, '**HOST A**'}. @emqplus Nope,\nThey are on different regions... Additional tests were made.\nAs I said,\nI have 3 servers.\nX,Y are in the same region.\nZ is on a different region.\nX can see that all nodes are running fine (clustered).\nY can see that X is running fine and Z is stopped.\nZ can see that X is running fine and Y is stopped.\nWhen I publish to X, other nodes get the publish replicated.\nWhen I publish to Y it is also replicated to all nodes.\nWhen I publish to Z it also gets published to al nodes.\nWhen I take X down, it leaves me with Y and Z which see each other as stopped.\nNow, publishes does not replicate.\nThis means that in the first test, X was the bridge between Y and Z and when I took him down, there is no connection between Y and Z.\nIf I restart the emqttd service on Y or Z then they can again see each other (until the next time they stop communicating).\nAny conclusions from what I wrote up here?. Any ideas guys?\nIt's blocking me from using this product :-. ",
    "sobelman": "I can confirm the following things as well:\n1. HiveMQ public server behave the same as mosquitto  (subscribed clients get empty payload retained messages) \n2. In EMQ server, Sending empty messages to a topic is working and the client can see it,\nBut:\nOnce message is sent as retained + empty payload the subscribe clients won't get any notification on this message \nCommands to tests:\nClient 1 subscribe:\nmosquitto_sub -h 127.0.0.1 -t 'test/1' -d\nClient 2 publish:\nmosquitto_pub -h 127.0.0.1 -t 'test/1' -n  <--Client 1 can see this message  <-- OK. \nmosquitto_pub -h 127.0.0.1 -t 'test/1' -n -r  <--Client 1 can not see this message <-- NOT OK. \n. Thank you @turtleDeng , waiting for this milestone to be released.\nAppreciate your quick response and for handling this issue.. Hi,\nTested -> working as expected. \nClosing this issue. \nThank you. . ",
    "tremoteye": "thanks a lot\n. ",
    "Sanbornzhang": "same issue\uff01. ",
    "rahulbhanushali": "Facing a similar issue with QoS set to 1.. ",
    "HJianBo": "Hi, @syberkitten The client A should receive a message each of 100 topics when it reconnects to the server. (But in my test, It works well)\nCan you reproduce this issue now? if you can, please open a new issue and provide more details information. i.e:\n- What's the client A subscribed topics QoS level?\n- What's the client B published message QoS?\n- EMQ version?\nIt's very helpful. Thanks a lot!. @asicoe This issue has fixed at v2.3.3\nHi, @syberkitten Suggest opening a new issue If has any problem about retained message.. Hi, @xiaoshuangfh According to the protocol of MQTT 3.1.1, some fields of a frame must be encoded with UTF-8 string. like following:\n1. ClientId\n2. Topic, Will Topic, Topic Filters\n3. User Name\n(And the Payload field of PUBLISH Packet allow any binary bytes)\nSo, Please make sure the CONNECT Packet does not contain illegal bytes?\n  . @hahafeixiu \nOn v2.3.0: you can get the solution at http://www.emqtt.io/docs/v2/rest.html#id18\nOn v2.2:  http://www.emqtt.io/docs/v2/guide.html#http-publish-api. Hi, @drejkus sorry too late reply.\nThe answer is Yes! The REST API must be authenticated by Dashboard Users.\nAnd, You can add an admin user (Dashboard User) with the following CLIs:\n./bin/emqttd_ctl admins add username1 password1\nIn addition, at the next version (v2.3.3 coming soon), you can add some default admin users at the ./etc/plugins/emq_dashboard.conf configuration file.. Hi, @drejkus @sincsc The feature had been implemented at v2.3.3 and published on 11 Jan.\nClose this issue now. if has any problems reopen it!. Hi @xerosanyam The suffix is log rotation number.  Set the log.{level}.count to 1 in etc/emq.conf, you will get only one log file:\n```\nError log file size\nlog.error.size = 10485760\nError log file count\nlog.error.count = 1\n``\n. @qudenger We have built a release package compatible with macos10.13 . You can download it now :) http://www.emqtt.io/downloads. Duplicated with https://github.com/emqtt/emq-auth-mongo/issues/88. @jhor511 Has been fixed and released at v2.3.0. @yogo1212  The problem is caused by the publisher sending a bad message:Qos = 0DUP = 1`\nMaybe your question is the same cause?. @yogo1212 Has been fixed and released at v2.3.0. @LiushengWang Would you please provide more informations? What caused the session to disappear?? It would help a lot.\nFor example: Reappear Step, Connect Args etc.\nThanks!. @hbahn  Would you please provide more informations? \nFor example: \n- listener.ssl.external.keyfile = ?, certfile = ? in etc/emq.conf\n- etc/certs directory details?. First, you should subscribe the topic $SYS/brokers/emq@127.0.0.1/datetime to get system datetime. (emq@127.0.0.1 is the specified broker name, which you can find on Dashboard)\nBesides, check out access control configurations in the etc/acl.conf file. The others IP address will be denied by default, when they subscribe system topic!. It seems right! There are some tips about that:\n- restart services, if you modified the etc/emq.conf file\n- if you are not sure whether client has been blocked, you can check it in the etc/error.log file. @sincsc \nThe server will conclude the connection having been broken, When not received message after 1.2*keepalive.\nso, what the keepalive value is?. > The server will conclude the connection having been broken, When not received message after 1.2keepalive.\nThe previous reply was incorrect, sorry...\nThe right value should be Keepalive * backoff * 2:\nhttps://github.com/emqtt/emqttd/blob/419004a37af340ddb22d54cba2aa53d16a5ba746/etc/emq.conf#L198-L199\nAnd, more accurate answer is 2 to 3 times of keepalive * backoff:\nhttps://github.com/emqtt/emqttd/blob/419004a37af340ddb22d54cba2aa53d16a5ba746/src/emqttd_keepalive.erl#L45-L59. @sincsc And I had tested it on EMQ v2.2.0. It works well!\nThe test details is:\n1. Modify etc/emq.conf file with:\n    - log.console.level = debug\n2. Restart EMQ, and attacth to services: ./bin/emqttd attach\n2. The client named iosclient connect to server with:\n    - keepalive=30\n    - willTopic=test, payload='This is will message'\n3. Switch iPhone to Flight-Mode\nAnd were getting following logs (omitted some useless information):\n\nWe can see  that the will message has been published, 84 seconds after the client connection broken\n\nThe 84s is from 17:53:24-17:52:00 = 84s\nAnd (2 * Keepalive * backoff) < 84, And  84 < (3 * Keepalive * backoff)\n\nSo, the keepalive mechanism works well!. Hi, @franquis This Feature has implemented and published at v2.3.1.. @MarsWarrior The EMQ 2.3.0 has been released now! You can download it at http://www.emqtt.io.\nThanks for your attention :). Cannot override the value of keepalive from server side now. We plan to support this feature in 2.4 release.\n. First, you should make sure the Max Packet Size configuration in emq.conf\n```bash\nMax Packet Size Allowed, 64K by default.\nmqtt.max_packet_size = 64KB\n```\nYou can increase this value, but not over 256MB.\nAnd, We do not recommend that you use EMQ to transmit a single too large volume of messages. @sincsc May work well, but not a good idea using MQTT for file transmission.. @yyguo1986 \nThe code: 107 is mean missing request parameter.  you can find  all of code description at http://emqtt.io/docs/v2/rest.html#error-code\nIn this case,  you must offer client_id parameter in the request. Because this parameter will tell to the server,  who have subscribe the topics.\nFor examples:\ncurl -v --basic -u admin:public -k http://localhost:8080/api/v2/mqtt/subscribe -X POST -d '{\"topic\": \"test\", \"qos\": 1, \"client_id\": \"test1\"}'. @yyguo1986 This operation is required that the session of client must have existed (you can find that on Dashboard)\nhttps://github.com/emqtt/emqttd/blob/cb30f69a13617dea52fc8772b35e1cfa29898663/src/emqttd_mgmt.erl#L230-L242. @Think7  Your can kick a client out by the emqttd_ctl CLI or HTTP API.\n\n\nCLI:\nbash\n./bin/emqttd_ctl clients kick <client_id>\n\n\nHTTP API:\n\n\nDELETE http://emqhost:8080/api/v2/clients/<client_id>\n. Hi @7wonders  Could you have check the REST API listener address configuration in the etc/emq.conf? If you want to access the manage API by others host, you must set listener address to 0.0.0.0:8080\nlistener.api.mgmt=0.0.0.0:8080. @windhc The server's behavior is correct!\nAccord to MQTT-3.3.1-10:\n\nA PUBLISH Packet with a RETAIN flag set to 1 and a payload containing zero bytes will be processed as normal by the Server and sent to Clients with a subscription matching the topic name. Additionally any existing retained message with the same topic name MUST be removed and any future subscribers for the topic will not receive a retained message\n\nSo, the server should send the empty message to client as normally, but we don't implement in previous version.\nWe have fixed this issue in EMQ 2.3.0. so your code show different behaviour than previous version. But this is necessary. sorry about that.... @trevorfurnell  We plan to implement the feature in 2.4-beta.1, thanks.. Could you please make sure that the emq_auth_username plugin has been started? \nThe plugin should be started first when you authorize by username & password.. For more conveniently manage users!  The ./bin/emqtt_ctl users CLIs can be work well still, though the plugin has been stoped!\nI've tested it before and it works fine!. Q1:\n\nThe user configured in emq_auth_username.conf will be added to the \"./bin/emqtt_ctl users\" in win10/emq2.3.0-rc.2, but will not in linux/emq2.3.0. \n\nHave you restart linux/emq2.3.0 after modified emq_auth_username.conf? If had, could you please more detail steps for reproducing this issue?\nQ2: Why the unconfigured user can login success?\n1. All authentication plugins will ignore unknown users when they are authenticated. Except for empty username or password (it will be login failed).\n2. When the mqtt.allow_anonymous flag is true, EMQ will pass the login request that is ignored by all of the auth plugins\nSo, please check the mqtt.allow_anonymous flag value in the etc/emq.conf file.\nOthers:\nWhen the emq_auth_plugin restart, EMQ does not override the user's password if you have added the user before. Even though has modified the user's password in the emq_auth_username.conf\nSo, I sugget you deleting all users by the ./bin/emqtt_ctl users del <Username> CLIs tool. restart EMQ broker and try login again.. Q1: Linux/2.3.0 can't load users by emq_auth_username.conf file\nSorry, I can't reproduce  this issue.\nwhether the emq_auth_username plugin have started after restart the linux/2.3.0 broker?. On the Windows/2.3.0, The broker can not load the last user of emq_auth_username.conf.\nI had opened a new issue at #1372. Thanks for your contribution!. @yyguo1986 \nQ1: Linux/2.3.0 can't load users by emq_auth_username.conf file.\nI found another reason, why your configuration doesn't work:\nThe server won't load new configuration files, If you restart broker by ./bin/emqttd restart command.\nSo the restart command  should be as following:\n./bin/emqttd stop\n./bin/emqttd start\n@emqplus Is there any need to improve our design?. Fixed in v2.3.2. Close it!. Hi @Tabrizian It's seem the Upgrade field is incorrect!\nHave you capture the HTTP Packet that is client to broker? \nAnd make sure the Upgrade field of HTTP Headers is websocket. It seems right. Could you please provide the captured Packet or file?. In this case, How many messages could be received by subscriber per second  in theory?\nIf the sending rate is too fast, This single subscriber can not handle so many messages. Hi, @sohailgerman Sorry reply too late.\nCould you describe more details information about this crashes error? Thanks a lot!\n(Because I can't reproduce it... :(. Hi @sustchenkov\nIt's seems some file not exist! But can't get any more details. \nCould you please provide more details information to diagnose this issue?. Shared Subscription: http://emqtt.io/docs/v2/advanced.html#shared-subscription. Hi @Qtianv587 \n\n{{ssl_error,{options,{certfile,\"etc/certs/server_cert1.pem\",{error,enoent}}}}\n\nThe error {error,enoent} means the file does not exist. \nSo please check your configuration files and make sure the certs have existed!. Hi @pritstift \nThe hash field of <algorithm>$<iterations>$<salt>$<hash> should be filled by  hex string of encrypted data\nSee:\nhttps://github.com/emqtt/emqttd/blob/f452469bc565f3d1aa7ff1afab6fdfd918828582/src/emqttd_auth_mod.erl#L63-L67. Hi @pritstift, please configure the acl_nomatch in the etc/emq.conf file.\n```conf\nACL nomatch\nmqtt.acl_nomatch = deny\n. @pritstift I will update the documentation on `acl_nomatch`  configuration.\n http://emqtt.io/docs/v2/config.html#allow-anonymous-and-acl-file. The admin users should be added to EMQ by CLIs only. After the emqttd server has started successfully, you can add it.\ni.e:\n./bin/emqttd_ctl admins add root2 public2\n```\nThe doc http://emqtt.io/docs/v2/commands.html#admins may be help you. Hi, @Think7 @pritstift Sorry too late reply. You can config the default Username/Password in the etc/plugins/emq_dashboard.conf before v2.3.3. (published on 11 Jan) \nClose it now. if has any problems reopen it!. Hi, @syberkitten it works fine in my test, I can't reproduce this issue. Could you please provide more details information to help reproduce this? \n(i.e: Detailed steps, The topic name, etc.) \nThanks a lot!. It's seems the file ./data/mnesia/emqttd@10.45.150.72/schema.DAT had gone\nHave you check that?. Hi, @jlgm I checked your plugin and reproduced the issue. \nThis error logs are  printed by emqtt_client.erl  L286\nThe {ack,<0.2069.0>,{error,normal}} message will be received, when you call the mc_cursor:rest(Cursor) function.. Hi, @akhan4u The error caused by an invalid listening port. (As you can see from the crash log, the port you configured is 1000000)\nSo, please make sure the listening port is correct.. Hi, @kutashenko If you want to connect an SSL port, the emqtt_bench_pub should add the -S flag to enable it. like this:\n/emqtt_bench_pub -c 1 -i 10 -t bench/%s -s 256 -S -p 8883\nAnd then, use --cerfile & --keyfile flag to setup client's certificates. Hi, @kutashenko This issue has fixed in the v2.3.5.\nThe SSL upgrade will upgrade failed when some connection arrived.\nEMQ Log:\nlog\n(emq@127.0.0.1)1> 10:42:37.063 [error] CRASH REPORT Process <0.1459.0> with 0 neighbours crashed with reason: {ssl_error,{options,{cacertfile,[]}}} in esockd_connection:upgrade/1 line 131\n10:42:37.063 [error] Supervisor 'esockd_connection_sup - <0.1424.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.1459.0> exit with reason {ssl_error,{options,{cacertfile,[]}}} in esockd_connection:upgrade/1 line 131 in context connection_crashed\nBenchmark App log:\nlog\n$ ./emqtt_bench_pub -c 1 -i 10 -t bench/%i -s 256 -p 8883\n10:42:37.029 [info] Application lager started on node nonode@nohost\n10:42:37.030 [info] Application emqttc started on node nonode@nohost\n10:42:37.030 [info] Application emqtt_benchmark started on node nonode@nohost\nconneted: 1\nclient 1 EXIT: {shutdown,tcp_closed}\n. Hi, @EagleSmith It seems the emq_auth_mysql plugins start failure. Because It can't connect to MySQL services! Please make sure the MySQL server has started and the configuration of emq_auth_mysql is right. @EagleSmith \n1. First, Please make sure the MySQL can be connected using correct IP Address, Port, username, password, etc.\n2. And, Make sure the configuration of emq_auth_mysql.conf is right?\nIf it does not works well still, please provide more details reproduce step, log or configurations.\nIt's very helpful to analyze the error reason! Thanks!. @hbli The error emfile is mean Too many open files.\nSo, please make sure the limit in the system of running emqttd_bench_sub more than 50000. You can check it with:\nulimit -n\nor, increase temporarily it with ulimit -n 1048576. Duplicated with issue: https://github.com/emqtt/emq-auth-mongo/issues/104. See: http://emqtt.io/docs/v2/guide.html#acl\nAn example may be:\n{allow, {user, \"test\"}, subscribe, [\"topic1\"]}.\n{deny, {user, \"test\"}, publish, [\"topic1\"]}.\nIt's mean the user namedtest can subscribe topic1 but does not publish message to topic1. Yes, The bug is introduced by the fix of issue #1293):\nhttps://github.com/emqtt/emqttd/blob/a992b50308aec74814f376c19d7f7aa290614a7f/src/emqttd_protocol.erl#L566-L569. Hi, @Nawneet47 The Web Hook may be helpful for you!\nAnd, You can find more information at http://emqtt.io/docs/v2/index.html. The error {error, timeout} seems query MongoDB is timeout.\nCould make sure the MongoDB server can be accessed by EMQ broker?. Hi, @vishuPPatel Sorry about that I can't understand what's problem now?\nYou can refer official guide: http://emqtt.io/docs/v2/guide.html#internal if this problem about ACL configuration. . Yes, mochiweb not handle Ping frames. This implementation may be reasonable because:\n\nA Ping frame MAY include \"Application data\".\n- Websocket RFC6455\n\nIt's a better practice that sends MQTT Ping Request to verify that the remote endpoint is still responsive, not using Websocket Ping Request?. This error will occur if the emq_auth_mongo can't reach MongoDB server.\nCould you make sure that the EMQ server can login correctly to MongoDB by the following cmd:\nbash\nmongo  mongoserver:27017/mqtt -u username -p password. In the first, there is not exist Master-slave relationship. Every node role is equal in a cluster.\n\nif 192.168.0.10 stoped, the topics(topic1,topic3) can't get the messages.\n\nCan you make sure that the situation can be produced? if you can, how to reproduce it?. In the first, you can import default ACL rules using emq_auth_mysql/mqtt.sql\nThen, add the following data to MySQL:\n``sql\n/* Deny all username to subscribe any topic */\nINSERT INTOmqtt_acl(allow,username,access,topic`) VALUES(0, '$all', 1, '#');\n/ Allow user usera  subscribe topica/\nINSERT INTO mqtt_acl(allow, username,access, topic) VALUES(1, 'usera', 1, 'topica');\n```. Sure! It has tagged in v2.3.6. We will publish it soon! \nPlease let me known if you have any problems. Thanks!. Hi, @homerzhou The value of The messages data -> dropped will be increased when a PUBLISH Topic does not exist any Subscribers.\nSo,  Is there exist available subscription relationship?. The long_schedule warning will be reported, if a process in the system runs uninterrupted for at least Time wall clock milliseconds.\nThe Time can be specified in the emq.conf, default is:\n```\nEnable Long Schedule(ms) monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: Number\nsysmon.long_schedule = 240\n```\nIs there the broker running a lot of tasks or PUBSUB operations?. You can configure retained payload size by etc/plugins/emq_retainer.conf, not mqtt.max_packet_size:\n```conf\nMaximum payload size of a retained message.\n\nValue: Bytes\nretainer.max_payload_size = 64KB\n``\n. Yes, the EMQ broker support **JWT**(JSON Web Tokens) authentication on Password field by [emq-auth-jwt](https://github.com/emqtt/emq-auth-jwt). Hi @hui6075 You can use Local Shared Subscription to handle it. see #752 . Hi, @Marina190489 The EMQX support seven log levels, you can use thenoticelevel betweeninfoandwarning.  But maybe it doesn't have more different thaninfo` level.\nWe will improve the difference in all of the levels in the future version.. Hi, @pritstift Thanks for you report this, I'll fix it later!. Hi, @kaido42 I have reviewed the frame parsing code, It seems to be right. Could you provide completely the 1st and  2nd part of raw data to help to dig out this problem? . You can send it to: heeejianbo@gmail.com. You can't get both of these in the current version. In my view, you should sign a different cert for every client, if you want to enable this option.\nAnyway, we'll discuss this feature! Maybe it is very important in some scenes! Thanks for your suggestion!. Hi @Forsure-Wang We have discussed this, But we don't understand why are there need to get both of this at the same time? If you want to get the username of CONNECT packet, just close the peer_cert_as_username option only.. Do you consider to bind cert to client id, and save to database? then you can verify a new arriving connection's username(equal to cert's CN now), client id in you authentication web server. \nIt is a preferred solution for that. \n(Or use the password field to save other credentials for verifying this action..). > But if the username field is blank, the EMQ console would print \"username undefined\" error. Users must put something in the username field.\nThe\nIn the newly released version yesterday, we have fixed this behavior that doesn't deny the empty username connection unless the allow_anonymous is false.\nIn my view, if you set peer_cert_as_username true, you must pass username with CN name on the 1883 connection, which can keep the username having same semantics in the backend.\n. ",
    "vinayxbox": "@huangdan @emqplus  Thanks for the help.Build is successful after that.\n@emqplus  So Windows emqtt  broker is not good for production ?\n. ",
    "edgiru": "install 2.3-beta.3 not work. Deleted old, installed a new and deb package.\n\n\n\n18083 - http work. Figured out! the error was that emqtt did not find certificates on the specified path. The default is:\ndashboard.listener.https.certfile = etc/certs/cert.pem\ndashboard.listener.https.keyfile = etc/certs/key.pem. ",
    "Rotem19": "thx...I tried it but something is not working.\nshould I configure HSET mqtt_acl and HSET mqtt_user inside etc/plugins/emq_auth_redis.conf?. ",
    "emnvn": "Hi emqplus,\nI sent you an email with crash.dump and crash.log file.\nThanks for review it.\n. ",
    "MDunagan": "Understood. I'll wait for the new version to have content for the CoAP .well-known resource.\nAny chance I can get some feedback about the MQTT $SYS Broker Status issue? Am I wrong to expect that it should return some information such as:\n- Broker (version, uptime, subscriptions ...)\n- Clients (connected, maximum, total ...)\n- Messages (sent, received ...)\nIn the additional steps I mentioned above on my original post, I followed the steps described in this comment from another issue to try and get information from the $SYS Broker through the command-line on localhost of the server.\nAm I missing a configuration option? Maybe this information is supplied on a different port than 1883? I'm running out of ideas to try.. I figured it out.\nEdit: Sorry, I left a brief non-helpful answer. To be more specific, I realized this was my mistake for making certain assumptions.\nAs I read the documentation more thoroughly for the $SYS Topics subscription paths for Erlang MQTT the issue became clear. The paths are different from Mosquitto's $SYS Topics subscription paths. It seems these are not standardized across various MQTT brokers. I was able to subscribe to them one-by-one using mosquitto_sub in command line to confirm they work. The MQTT.fx application has these paths pre-defined for Mosquitto and Hive MQ brokers. Currently their application does not allow for custom profiles to be built for the $SYS Topics subscription paths of other MQTT Brokers.\nThe lack of standardization may prove helpful in finding a better way to deliver these $SYS Topics for a single broker versus a cluster, but for now as someone who is still learning about IoT protocols it will likely create more hurdles for me in testing.\nHowever, I still think it would be helpful to see some default resources for testing Erlang CoAP like the Plugtest server from Californium or the test resources on the coap.me server. So I look forward to something being added in a later version.\nThank you.. ",
    "marleau": "@Jowin Were you able to bridge remote brokers? I'm running into the same error message.. ",
    "Jowin": "@marleau No, I wasn't. Even after opening up the ports it gave an error. For now, I have parked this. \nAnother alternative I came across (not an ideal solution) is to use a combination of telegraf and it's consumer, publish plugins to achieve the same thing.. ",
    "samk-mesh": "I'm seeing the same behavior. . I'm seeing similar behavior. . Any updates on this? \nI've reverted to using mosquitto for now. . Emqttd 2.3.11  (ubuntu host)\nversion 97dfb34b5a5ae13f3e9e0ebf1321774eb04b2851  of the golang paho library. \nClean Session = False.\nTo reproduce: \nMy first session with each unique client id works. \nIf I reconnect without changing the client id, I see the same behavior as gstar. \nI can resolve by using clean session = true. \nOr rebooting my emq instance, manually forcing emq to forget the session. . I just reinvestigated this issue with my devs. \nThey had forked the Go mqtt library, and I cannot reproduce with the main branch/ normal go mqtt library. \n. ",
    "psorobka": "Same message here, emq 2.3.11. ",
    "Eluso": "vi etc/emqx.conf\nbridge.aws.address = 127.0.0.1:1883 (change to your  bridge IP:port)\nbridge.aws.client_id = bridge_aws (your client_id)\nbridge.aws.username = user (your  username)\nbridge.aws.password = passwd (your password)\nother bridge.aws.* was optional\n./bin/emqx start\n./bin/emqx_ctl bridges list(check bridges status)\n./bin/emqx_ctl bridges start aws (start/stop bridge). @rjbaat Your HAproxy looks good,I'm not very clear about your usage scenarios,some suggest:\n1.Set reconnect at client.\n2.Set same keepalive client,ha,emqx. if your scenes to be used like this:\ndevices-->emqx-->cloud iot\nplease pre-creat gateway, for bridge please do: \nvi etc/emqx.conf\nbridge.aws.address = 127.0.0.1:1883 (change to your cloud iot IP:port)\nbridge.aws.client_id = bridge_aws (your cloud iot gateway client_id)\nbridge.aws.username = user (your cloud iot gateway username)\nbridge.aws.password = passwd (your cloud iot gateway password)\nother bridge.aws.*  was optional\n./bin/emqx start\n./bin/emqx_ctl bridges list (check bridges status)\n./bin/emqx_ctl bridges start aws (start/stop bridge)\nfor Aliyun address,clientID,username,password please visit https://help.aliyun.com/document_detail/86706.html. bridge.aliyun.forwards =topic1/#,topic2/# will forward all topic under topic1/,topic2/\nbridge.aliyun.subscription.1.topic = cmd/topic1  will sub topic\nbridge.aliyun.subscription.1.qos = 0  qos level . need use '$queue/test/+' or '$share/group/test/+' . Thanks,get it.\nCan your try other mqtt client sdk?\nI have use JMeter4.0 + MQTT Plugin work normal.\nJMeter:https://archive.apache.org/dist/jmeter/binaries/\nPlugin:https://github.com/emqx/mqtt-jmeter. @elvizlai I have try paho work normal, $queue &  $share  usually for share sub.. ",
    "trehn": "It appears the crash is not related to the problem with emqttd_ctl. About two hours after restarting EMQ, I again cannot use emqttd_ctl, but there is nothing in any logs.\nlog.dir = /var/log/emqttd\nlog.console = console\nlog.console.level = error\nlog.syslog = on\nlog.syslog.level = error\nlog.error.file = /var/log/emqttd/error.log\nlog.crash = on\nlog.crash.file = /var/log/emqttd/crash.log. Here you go: crash.dump\n. Google Compute Engine g1-small, Ubuntu 16.04, ERTS as provided by the deb package named above. >g1-small\n\nShared-core machine type with 0.5 virtual CPU, 1.70 GB of memory, backed by a shared physical core.. We're successfully using the Paho client libraries for Python, Java, and JavaScript with EMQ. So you should be fine.. \n",
    "concurrent88": "Thanks for your response. Can you please explain how to use new_node? I don't see any in the documentation. Also, how to specify a node as master?. ",
    "theronic": "Is it possible to fetch retained messages using a fresh client ID? I would love for EMQX to store N history for a bunch of topics that any client can subscribe to.. I would also love to bridge EMQX data to NATS Streaming, primarily so that I can replay history in reverse order (latest first) from NATS. I'm using MQTT purely for the light packet frame to the edge, whereas NATS Streams are comparatively fat.. ",
    "AhnSeongHyun": "Thank you! :+1: . ",
    "EagleSmith": "[root@iZ2zea13ipvafvo61r86p2Z emqttd]# vi run_erl.log\nrun_erl [7303] Fri Sep  8 09:49:00 2017\nArgs before exec of shell:\nrun_erl [7303] Fri Sep  8 09:49:00 2017\nargv[0] = sh\nrun_erl [7303] Fri Sep  8 09:49:00 2017\nargv[1] = -c\nrun_erl [7303] Fri Sep  8 09:49:00 2017\nargv[2] = exec \"/usr/sbin/emqttd\" \"console\"\n. sorry ,my Erlang/OTP version is: R20/9.0.\nemqtt start is working fine.\n. hi HJianBo,I use dashboard to configure Mysql to start success,the windows service can not start ,error code 1067 Unexpected termination of process. thanks. it's working now ,but the windows service can not run?error code is 1607.\nemqttd_2.3.1: Could not start erlang machine\nemqttd_2.3.1: Not enough parameters for erlang service.. emqttd_2.3.1: Not enough parameters for erlang service.. ",
    "markrey": "@emqplus Any updates on this one?. ",
    "davorozo": "Is this feature already available? This is an important feature. . \nOk. And when is this version planned to be released?\nEnviado desde mi iPhone\nEl 8/06/2018, a la(s) 11:57 a. m., Shawn notifications@github.com escribi\u00f3:\n\n@davorozo Not yet. We are planning to implement this in EMQ 3.0.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub, or mute the thread.\n. \nI\u2019m using jmeter and MQTTBox. The Max packet client is actually configured to 64KB. \nMy issue is with QoS 1 and 2 and the client is using mqtt 3.1.1. Any ideas? \n\nThank you. \nEnviado desde mi iPhone\nEl 6/09/2018, a la(s) 8:44 p. m., Gilbert notifications@github.com escribi\u00f3:\n\nMaybe the beta version of emqx is not compatible with your mqtt client. Can you tell me which mqtt client do you use?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub, or mute the thread.\n. This is the console log for my issue:\n\n09:14:02.972 [debug] MQTT(127.0.0.1:51599): Terminated for {shutdown,keepalive_timeout}\n09:14:02.973 [info] MQTT(jmeterpub_439d134e43264@127.0.0.1:51599): Shutdown for keepalive_timeout\nI dont know why I cannot publish large messages with QoS1 or QoS2. MQTT protocol is 3.1.1 and client is JMeter for testing. I'm testing in localhost and there is no reason for this to be happening. Keep alive for my client is 15s. \nThank you. \n. ",
    "hahafeixiu": "\u6d4b\u8bd5\u670d\u6211\u901a\u8fc7ifadrr\u53c2\u6570\u8bbe\u7f6e\u5df2\u7ecfok\u4e86\uff1b\u4f46\u662f\u8fd9\u4e2a\u670d\u52a1\u76841883\u7aef\u53e3\u597d\u50cf\u53ea\u80fd\u8fde65000\u5de6\u53f3\u7684\u8fde\u63a5\uff1b\u8bbe\u7f6e\u865a\u62dfIP\u4e5f\u6ca1\u7528\uff1b\ncentos7    erl 19   \n. curl -v --basic -u admin:public -d \"qos=1&retain=0&topic=hello&message=sd1234&client=localhost_bench_sub_1_3885104127\" -k http://127.0.0.1:8080/mqtt/publish     \nthe param \"client\" is invalid\uff01can you teach me resolve this question?Thank you!. ",
    "xiaoshuangfh": "@turtleDeng some of our payload is encrypted only as a binary buffer ,and some  is utf8.  emqttd \n does not support Encrypted message \uff1f. 2018-04-13 00:02:17.059 [error] <0.13830.1263> CRASH REPORT Process <0.13830.1263> with 0 neighbours exited with reason: no function clause matching emqttd_protocol:sp\n({shutdown,session_died}) line 559 in gen_server2:terminate/3 line 1157\n2018-04-13 00:02:17.060 [error] <0.1425.0> Supervisor 'esockd_connection_sup - <0.1425.0>' had child connection started with emqttd_client:start_link([{max_publish_rat\ne,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.13830.1263> exit with reason no function clause matching emqttd_protoco\nl:sp({shutdown,session_died}) line 559 in context connection_crashed\n2018-04-13 00:02:17.282 [error] <0.1326.0>@emqttd_sm:resume_session:258 SM(MMA-GD200A163005975): Cannot resume <0.15031.1> which seems already dead!\n2018-04-13 00:02:17.282 [error] <0.10841.1198> gen_server <0.10841.1198> terminated with reason: no function clause matching emqttd_protocol:sp({shutdown,session_died}\n) line 559\n2018-04-13 00:02:17.282 [error] <0.10841.1198> CRASH REPORT Process <0.10841.1198> with 0 neighbours exited with reason: no function clause matching emqttd_protocol:sp\n({shutdown,session_died}) line 559 in gen_server2:terminate/3 line 1157\n2018-04-13 00:02:17.282 [error] <0.1425.0> Supervisor 'esockd_connection_sup - <0.1425.0>' had child connection started with emqttd_client:start_link([{max_publish_rat\ne,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.10841.1198> exit with reason no function clause matching emqttd_protoco\nl:sp({shutdown,session_died}) line 559 in context connection_crashed\n2018-04-13 00:02:17.700 [error] <0.1323.0>@emqttd_sm:resume_session:258 SM(MMA-GD200A164006931): Cannot resume <0.14868.0> which seems already dead!\n2018-04-13 00:02:17.700 [error] <0.29318.1254> gen_server <0.29318.1254> terminated with reason: no function clause matching emqttd_protocol:sp({shutdown,session_died}\n) line 559\n2018-04-13 00:02:17.701 [error] <0.29318.1254> CRASH REPORT Process <0.29318.1254> with 0 neighbours exited with reason: no function clause matching emqttd_protocol:sp\n({shutdown,session_died}) line 559 in gen_server2:terminate/3 line 1157\n2018-04-13 00:02:17.701 [error] <0.1425.0> Supervisor 'esockd_connection_sup - <0.1425.0>' had child connection started with emqttd_client:start_link([{max_publish_rat\ne,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.29318.1254> exit with reason no function clause matching emqttd_protoco\nl:sp({shutdown,session_died}) line 559 in context connection_crashed\n2018-04-13 00:02:17.955 [error] <0.1323.0>@emqttd_sm:resume_session:258 SM(MMA-GD200A164006931): Cannot resume <0.14868.0> which seems already dead!\n2018-04-13 00:02:17.955 [error] <0.16745.710> gen_server <0.16745.710> terminated with reason: no function clause matching emqttd_protocol:sp({shutdown,session_died}) \nline 559. what cause this problem? but there  is another question: when a lost connection  occured , EMQ's log do not have unnormal log. so we did not know how to show it.. ",
    "drejkus": "But it works form me in 2.3-beta.3 so it's not this problem, I see it more as a regression bug.  \nYou also use dashboard user, so was the behavior changed to use dashoard users now? \nIf it was I think it'll be good idea to add normal user authentication back (and maybe a way to signal which users to use). At least for me, that is what I was using this for - to create API for normal users from outside MQTT.. ",
    "sincsc": "where can I config the rest api http basic auth username and password? thank you. \nI and user 'test' in Admins, but  I can use any username and password authorize the HTTP REST API, I don't know why.. @turtleDeng I use emqttd 2.2. @turtleDeng Here is : http://emqtt.com/static/brokers/emqttd-ubuntu16.04-v2.2.0_amd64.deb. @turtleDeng OK\uff0cI will have a try. But where can I config the HTTP basic auth username  and password in version 2.2,thanks.\n. @HJianBo I set keepalive value 60 seconds\uff0cand I try to change it to other values\uff0cfor example 30 seconds, however it seems has no effect\uff0cI still receive the will message ten more minutes\uff0cso I am very confused\uff0cI don\u2018\u2019t know why\u3002Thanks. @HJianBo OK\uff0cI will try again\uff0cthank you very much!. @emqplus I don't find it in etc/emqtt/emq.conf, so where can I tune it? thanks . @emqplus OK, thank you very much.. @HJianBo OK\uff0cI will have a try. I just use it to transmit file no more than 32MB. Is it OK?. @promission I don't mean the client demo. I just want to know how to generate ssl file and config ssl in my operating system.  . ",
    "bigonese": "Thanks for the response. I believe the difference I spot in your post is the addition of the last two lines. Unfortunately it didn't help with this error.\nI did notice that the certificate I'm attempting to use is cross-signed by two intermediate CAs. Are the SSL libraries able to handle that?. ",
    "guerethes": "I'm having the same problem and I have not found a solution. Has anyone resolved?. ",
    "ranvijayj": "I am on latest beta version. Also, sometimes first connection on WS fails and after that starts working.. No, that was just a typo. @Gilbert-Wong . That's the thing nothing related to this on the server side. \non the browser I get \nWebSocket connection to 'ws://Endpoint:5432/mqtt' failed: Connection closed before receiving a handshake response\nThis is when I open the browser the first time and try to connect to MQTT. Subsequent requests go through and I get a green like in the below screenshot and starts connecting smoothly:\n. I will check if I can make a debug build for my web JS SDK and share logs with you. \nI made some more changes around acceptors and all. \nRight now first connection fails. I refresh and then it keeps connected. . Thanks, but can you tell me about the first point in my issue?. I understand @Gilbert-Wong \nBut why does is show total as around 500MB on a 2GB server. It is a simple installation. I don't find the max memory even in the init script.. I got it. Thanks.. sometimes I also see Duplicated subscribe: ancs/sds/fbfbd79fb989d8789fa3daf96dc85d7f, qos = 1 in logs. Any update here?\n@sylnkk \n1. Did you try to reduce the message retention time for clients? Make it to 1d or something less and try. \n2. Also, decreasing the timeout for clients connections helps reduce memory. \n3. What are the number of acceptors you have set for all the listeners?. Any idea anyone?. Also, websocket keeps running. Its just non-websocket that fails and stops working.\n\n. ",
    "ameyaapte1": "Temporary solution:\nremove emq_lwm2m from DEPS in Makefile. ",
    "asciijungle": "I can confirm the bug using commit e1d8c1603c75c507eba30f184b886a84602f16c1 from September 12th. \nDEP    emq_lwm2m\nfatal: could not read Username for 'https://github.com': No such device or address\n/bin/sh: cd: line 1: can't cd to /emqttd/deps/emq_lwm2m\nmake: *** [erlang.mk:814: /emqttd/deps/emq_lwm2m] Error 2. The problem is that the emq-lwm2m is gone from github. Maybe renamed?\nThe project's github page can be found on google but it results in a HTTP-404: https://github.com/emqtt/emq-lwm2m\nStill available in the cache though: https://webcache.googleusercontent.com/search?q=cache:avCZ8ZUjuKMJ:https://github.com/emqtt/emq-lwm2m+. thanks @emqplus that's what I did.. ",
    "CMGundlach": "why is this closed---did I do something incorrect?\nChad\nFrom: Feng Lee [mailto:notifications@github.com]\nSent: Monday, October 09, 2017 6:19 PM\nTo: emqtt/emqttd emqttd@noreply.github.com\nCc: Gundlach, Chad CGundlach@tycoint.com; Author author@noreply.github.com\nSubject: Re: [emqtt/emqttd] Help with Broker crash (#1285)\nClosed #1285https://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Furldefense.proofpoint.com%2Fv2%2Furl%3Fu%3Dhttps-3A__github.com_emqtt_emqttd_issues_1285%26d%3DDwMCaQ%26c%3D0YGvTs3tT-VMy8_v51yLDw%26r%3DmrR8jFaQAQcSMMrlExfdzhtM0MGrbxErjkNAESaqC2I%26m%3DQ16po-m89kSfoStQ7jxoJMei-6JQmZStYduxDyprEhQ%26s%3DVTldRUegn-_qXprjj_rwzE_u1zonq86_GLgjjbgasjI%26e%3D&data=02%7C01%7Ccgundlach%40tycoint.com%7C04e05d2c1a144399aca808d50f7ce290%7Ca1f1e2147ded45b681a19e8ae3459641%7C0%7C0%7C636431951402973426&sdata=UumIttPMFFBsYuqWoL6bOq1iykXz8GplGJjDbrsEzi4%3D&reserved=0.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHubhttps://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Furldefense.proofpoint.com%2Fv2%2Furl%3Fu%3Dhttps-3A__github.com_emqtt_emqttd_issues_1285-23event-2D1285161069%26d%3DDwMCaQ%26c%3D0YGvTs3tT-VMy8_v51yLDw%26r%3DmrR8jFaQAQcSMMrlExfdzhtM0MGrbxErjkNAESaqC2I%26m%3DQ16po-m89kSfoStQ7jxoJMei-6JQmZStYduxDyprEhQ%26s%3DEaNm5_aLPWOPZ6zknVAjkhtoXcOu8g6Y2VxoLEHVaVk%26e%3D&data=02%7C01%7Ccgundlach%40tycoint.com%7C04e05d2c1a144399aca808d50f7ce290%7Ca1f1e2147ded45b681a19e8ae3459641%7C0%7C0%7C636431951402973426&sdata=7dfVoR%2BqwAOI95CQXVSX5sn7zfaT8RiI%2BHnykVM%2FW1w%3D&reserved=0, or mute the threadhttps://na01.safelinks.protection.outlook.com/?url=https%3A%2F%2Furldefense.proofpoint.com%2Fv2%2Furl%3Fu%3Dhttps-3A__github.com_notifications_unsubscribe-2Dauth_AfJFgHZ6Q5vNZV8J3AmKPNXU1FDl2cZEks5sqsYCgaJpZM4PzIXp%26d%3DDwMCaQ%26c%3D0YGvTs3tT-VMy8_v51yLDw%26r%3DmrR8jFaQAQcSMMrlExfdzhtM0MGrbxErjkNAESaqC2I%26m%3DQ16po-m89kSfoStQ7jxoJMei-6JQmZStYduxDyprEhQ%26s%3DSlcKfh_L6nVKymhARq0lnGQRPggyMhqL-tnPMijCQbY%26e%3D&data=02%7C01%7Ccgundlach%40tycoint.com%7C04e05d2c1a144399aca808d50f7ce290%7Ca1f1e2147ded45b681a19e8ae3459641%7C0%7C0%7C636431951402973426&sdata=%2FKYUAIwRiKtLT9uZtvxgSKNjMR9VhLfEE1%2B%2BlcO9azU%3D&reserved=0.\n\nThis e-mail contains privileged and confidential information intended for the use of the addressees named above. If you are not the intended recipient of this e-mail, you are hereby notified that you must not disseminate, copy or take any action in respect of any information contained in it. If you have received this e-mail in error, please notify the sender immediately by e-mail and immediately destroy this e-mail and its attachments.\n. ",
    "EzPluto": "@turtleDeng flag is true \uff0cthe screenshots upload error \uff0ccan not show the details\n. @turtleDeng  turn the flag to false , same. ",
    "victorclaessen": "I see that 2.3-rc.2 has been released. Has this been fixed?. Hi, any updates? In general, I am not getting a lot of response, apart from the adding and removing of flags to/from this issue ;-)\nDo you now no longer consider this a bug?. Well, then I suppose we'd better call this a feature request.\nFrom the mqtt.org wiki at https://github.com/mqtt/mqtt.github.io/wiki/bridge_protocol : \n```Bridges are essentially just client connections to another broker.\nRSMB added (and Mosquitto followed) a non-spec feature that allows an RSMB\nto recognise an inbound connection as another RSMB bridge. From a thread on the google group:\nYou are right, RSMB recognizes when another RSMB connects to it via a bridge\nby using a different protocol version number (when try_private is true, which is the default).\nIf that connect fails, then the bridge will fall back to MQTT 3.1. This internal protocol is\nthe same as MQTT 3.1 except that:\n    the retained flags are propagated on publish packets, \n    and the subscriptions are nolocal (in the JMS sense), \n    to reduce the chances of infinite message loops.\n\nThis behaviour is easy to apply when the broker is the one making the bridge (outgoing topics)\nbecause it knows that the client is a bridge. For incoming topics the different protocol \nnumber is used. The protocol number is the actual protocol number (3) OR'd with 128 (bit 8).\nBoth RSMB and Mosquitto implement this behaviour - but it is not a formal part\nof the protocol specification.\n```\nEdit: Many brokers support propagating retained flags for bridge connections.\nhttps://github.com/mqtt/mqtt.github.io/wiki/Server%20support\n. That is awesome!. That is great. Can't wait for the next release!\nSo I took a fresh Debian 9 VM, and did:\napt-get install erlang\ngit clone -b develop https://github.com/emqtt/emq-relx.git \ncd emq-relx && make run\nThe (last part of) the output is:\n===> Starting relx build process ...\n===> Resolving OTP Applications from directories:\n          /opt/emq-relx/deps\n          /usr/lib/erlang/lib\n          /opt/emq-relx/apps\n===> Resolved emqttd-2.3.1\n===> Including Erts from /usr/lib/erlang\n===> release successfully created!\nExec: /opt/emq-relx/_rel/emqttd/erts-8.2.1/bin/erlexec -boot /opt/emq-relx/_rel/emqttd/releases/2.3.1/emqttd -mode embedded -boot_var ERTS_LIB_DIR /opt/emq-relx/_rel/emqttd/erts-8.2.1/../lib -mnesia dir \"/opt/emq-relx/_rel/emqttd/data/mnesia/emq@127.0.0.1\" -config /opt/emq-relx/_rel/emqttd/data/configs/app.2017.11.29.13.17.49.config -args_file /opt/emq-relx/_rel/emqttd/data/configs/vm.2017.11.29.13.17.49.args -vm_args /opt/emq-relx/_rel/emqttd/data/configs/vm.2017.11.29.13.17.49.args -- console\nRoot: /opt/emq-relx/_rel/emqttd\n/opt/emq-relx/_rel/emqttd\nProtocol 'inet_tcp': the name emq@127.0.0.1 seems to be in use by another Erlang node\nerlang.mk:2499: recipe for target 'run' failed\nmake: *** [run] Error 1\nAnd if I try:\ncd bin\n./emqttd console\nI get:\n./emqttd: 20: ./emqttd: runner_log_dir: not found. My apologies, it appears this VM was not as clean I thought. I cleared the existing beam process, and then started with make run.\nI now run into the following problem. When I publish something (directly) to emqtt broker, the message is only accepted if the retain flag is set.\nroot@n014085:~# mosquitto_sub -t \"building/#\" -v &\nroot@n014085:~# mosquitto_pub -t \"building/pisec/FX00.00\" -m \"closed\"\nroot@n014085:~# mosquitto_pub -t \"building/pisec/FX00.00\" -m \"closed\" -r\nbuilding/pisec/FX00.00 closed\nThe output of emqttd in the console is this:\n=INFO REPORT==== 29-Nov-2017::15:04:44 ===\n    alarm_handler: {set,{system_memory_high_watermark,[]}}\nstarting emqttd on node 'emq@127.0.0.1'\nemqttd ctl is starting...[ok]\nemqttd hook is starting...[ok]\nemqttd router is starting...[ok]\nemqttd pubsub is starting...[ok]\nemqttd stats is starting...[ok]\nemqttd metrics is starting...[ok]\nemqttd pooler is starting...[ok]\nemqttd trace is starting...[ok]\nemqttd client manager is starting...[ok]\nemqttd session manager is starting...[ok]\nemqttd session supervisor is starting...[ok]\nemqttd wsclient supervisor is starting...[ok]\nemqttd broker is starting...[ok]\nemqttd alarm is starting...[ok]\nemqttd mod supervisor is starting...[ok]\nemqttd bridge supervisor is starting...[ok]\nemqttd access control is starting...[ok]\nemqttd system monitor is starting...[ok]\nemqttd 2.3.0 is running now\nEshell V8.2.1  (abort with ^G)\n(emq@127.0.0.1)1> Load emq_mod_presence module successfully.\ndashboard:http listen on 0.0.0.0:18083 with 2 acceptors.\nmqtt:tcp listen on 127.0.0.1:11883 with 16 acceptors.\nmqtt:tcp listen on 0.0.0.0:1883 with 16 acceptors.\nmqtt:ws listen on 0.0.0.0:8083 with 4 acceptors.\nmqtt:ssl listen on 0.0.0.0:8883 with 16 acceptors.\nmqtt:wss listen on 0.0.0.0:8084 with 4 acceptors.\nmqtt:api listen on 0.0.0.0:8080 with 4 acceptors.\n15:05:18.498 [error] gen_server <0.1458.0> terminated with reason: no function clause matching emqttd_protocol:clean_retain(false, {mqtt_message,<<0,5,95,31,160,29,251,167,110,124,0,0,5,185,0,1>>,undefined,{<<\"mosqpub/5098-n0140...\">>,...},...}) line 553\n15:05:18.499 [error] CRASH REPORT Process <0.1458.0> with 0 neighbours exited with reason: no function clause matching emqttd_protocol:clean_retain(false, {mqtt_message,<<0,5,95,31,160,29,251,167,110,124,0,0,5,185,0,1>>,undefined,{<<\"mosqpub/5098-n0140...\">>,...},...}) line 553 in gen_server2:terminate/3 line 1157\n15:05:18.499 [error] gen_server <0.1457.0> terminated with reason: no function clause matching emqttd_protocol:clean_retain(false, {mqtt_message,<<0,5,95,31,160,29,251,167,110,124,0,0,5,185,0,1>>,undefined,{<<\"mosqpub/5098-n0140...\">>,...},...}) line 553\n15:05:18.499 [error] CRASH REPORT Process <0.1457.0> with 0 neighbours exited with reason: no function clause matching emqttd_protocol:clean_retain(false, {mqtt_message,<<0,5,95,31,160,29,251,167,110,124,0,0,5,185,0,1>>,undefined,{<<\"mosqpub/5098-n0140...\">>,...},...}) line 553 in gen_server2:terminate/3 line 1157\n15:05:18.500 [error] gen_server <0.1459.0> terminated with reason: no function clause matching emqttd_protocol:clean_retain(false, {mqtt_message,<<0,5,95,31,160,29,251,167,110,124,0,0,5,185,0,1>>,undefined,{<<\"mosqpub/5098-n0140...\">>,...},...}) line 553\n15:05:18.500 [error] Supervisor 'esockd_connection_sup - <0.1394.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.1458.0> exit with reason no function clause matching emqttd_protocol:clean_retain(false, {mqtt_message,<<0,5,95,31,160,29,251,167,110,124,0,0,5,185,0,1>>,undefined,{<<\"mosqpub/5098-n0140...\">>,...},...}) line 553 in context connection_crashed\n15:05:18.501 [error] Supervisor 'esockd_connection_sup - <0.1394.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.1457.0> exit with reason no function clause matching emqttd_protocol:clean_retain(false, {mqtt_message,<<0,5,95,31,160,29,251,167,110,124,0,0,5,185,0,1>>,undefined,{<<\"mosqpub/5098-n0140...\">>,...},...}) line 553 in context connection_crashed\n15:05:18.501 [error] CRASH REPORT Process <0.1459.0> with 0 neighbours exited with reason: no function clause matching emqttd_protocol:clean_retain(false, {mqtt_message,<<0,5,95,31,160,29,251,167,110,124,0,0,5,185,0,1>>,undefined,{<<\"mosqpub/5098-n0140...\">>,...},...}) line 553 in gen_server2:terminate/3 line 1157\n15:05:18.501 [error] Supervisor 'esockd_connection_sup - <0.1394.0>' had child connection started with emqttd_client:start_link([{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,...},...]) at <0.1459.0> exit with reason no function clause matching emqttd_protocol:clean_retain(false, {mqtt_message,<<0,5,95,31,160,29,251,167,110,124,0,0,5,185,0,1>>,undefined,{<<\"mosqpub/5098-n0140...\">>,...},...}) line 553 in context connection_crashed\nThat 15:05:18.498 crash report was when I published without the retain flag (and before I published the same message with the retain flag).. Ok, now the crash does not occur anymore, and the message is propagated.\nAlso, I can confirm that the retain flag is carried across the bridge if (and only if) try_private is set to true in the mosquitto configuration.\nThanks a lot, this makes bridging much more flexible and useful!. I had the same issue, and I created a workaround by putting a mosquitto instance in between, and bridging mosquitto to both EMQ and the other [public] broker. I don't think you can do this from EMQ directly. . You should define two connections (either in mosquitto.conf or in separate files in /etc/mosquitto/conf.d/), one to cloudmqtt in this case, and the other to emq. Then tell mosquitto which topics you would like to forward, and in which direction.\n/etc/mosquitto/conf.d/emq.conf\nconnection emq\naddress 127.0.0.1:1883\ntopic livingroom/sensors/# in 0\n/etc/mosquitto/conf.d/iot.conf\nconnection iot\naddress iot.eclipse.org:1883\ntopic # out 0 livingroom/sensors/ vic-01234567890/livingroom/sensors\nThis (semi-fictional) example would subscribe (with QOS 0) to my internal EMQ's on topic livingroom/sensors/#, and forwards all received messages (also with QOS 0) to public broker iot.eclipse.org. At the same time, it slightly changes the topics (it prepends vic-01234567890 as a root to all topics, in order to avoid topic collisions with other people publishing to that public broker).\nIn your case, it seems to want to import from the public broker, and send to emq. So you would need to swap the in and out lines between the brokers.\nThere are many tutorials on briding in mosquitto. This one seems all right.\nHope that helps.. I had the same on another node (in another cluster). A complete reboot of the OS was the only way I could make emqtt start again. That is less than ideal.. Let's just close this issue. It hasn't happened again.. Ok, workaround is:\nin emq.conf:\n- comment out the line \"mqtt.pubsub.by_clientid\" \n- change the value of \"mqtt.bridge.ping_down_interval\" from 1 to 1s\n- change the value of \"mqtt.broker.sys_interval\" from 60 to 1m\nin plugins/emq_dashboard.conf:\n- change the value of \"dashboard.listener.https.handshake_timeout\" from 15 to 15s\nmove file plugins/emq_lwm2m.conf to plugins/emq_lwm2m.conf.bak\n. Since we are already a few versions further, I think it is unlikely that other people will encounter this in the future, so I will close this issue.. Thanks!. To summarize the past: \n in #1293, I asked for the retain bit to be kept for bridge clients, which was fixed, but introduced the next bug\n in #1461, I reported that the retain bit was not set for previously retained messages, which was fixed but likely introduced the current bug.\nIn my view, the total decision tree should be something like:\nIF \"this message is the result of an new subscription\" THEN\n    keep retain bit (because this message already has it set, and it should be set [MQTT-3.3.1-8])\nELSE\n    IF \"this message is sent to a bridge client\" THEN\n        keep retain bit (because the broker on the other side of the bridge needs to retain it also)\n    ELSE\n        remove retain bit (because this is not bridge client, and this is the result of an existing subscription [MQTT-3.3.1-9])\n    END IF\nEND IF\n. Will this fix be published in a release soon?. I can confirm that the testcase as I described in the original posts is handled successfully in version 2.3.6.. I think that that is not possible right now. So far I've also only seen options to do it the other way around.. Sorry, I have no idea if and when that could happen. I've come to rely on the mosquitto-double-bridge workaround. Unfortunately, that workaround suffers from a lack of redundancy.. Oh sorry, I just assumed you'd come across it already. It's one mosquitto broker making two bridges (one to emqtt, and the other to where you would have liked emqtt to be able to connect to), described here: https://github.com/emqtt/emqttd/issues/1390#issuecomment-363561564. That is great news, but I'm not sure that that is the solution.\nIn the meantime I have been playing with the MySQL plugin, that already has auth and acl functions. But when I enable the MySQL plugin, the same problem occurs, i.e. anonymous connection is no longer possible.\nI was thinking to rewrite the MySQL statements so that a blank username would also pass the authentication test, but I found out that emqttd doesn't even execute the query when no username is supplied by the client, so that didn't work.. I've also tested with the HTTP plugin, same result. The HTTP request isn't even made when no username or password have been entered. I see Username 'undefined' login failed for username_or_password_undefined entries in the log file. So indeed, emqtt doesn't even try the authentication plugins when it's missing username or password, even though in the configuration file it says mqtt.allow_anonymous = true.\nPerhaps I don't really see the rationale behind the mqtt.allow_anonymous configuration item. Because apparently that doesn't mean anything anymore whenever any authentication plugin is enabled, is that the intended result, or it is a bug? . Hi @terry-xiaoyu,\nThe first option (to allow empty username login when mqtt.allow_anonymous = true) has my distinct preference \ud83d\ude04 .. @terry-xiaoyu Have you guys given this some more thought?. Hi, @zhengyupan. I am also (still) interested in this feature. Can you tell us how to integrate this?. Perhaps you could monitor this periodically with a cronjob (check output of emqttd_ctl cluster status), and try to rejoin cluster, or if that fails, to kill the node and alert a sysadmin?. Ah, while browsing through your code I noticed in module emqttd_access_rule.erl that it might be %c.\nI changed the ACL rule to:\n{allow, all, pubsub, [\"test/clients/%c\"]}.\nAnd that actually seems to work.\nI updated your wiki page (https://github.com/emqtt/emqttd/wiki/ACL-Design) accordingly. \nIssue closed :-). The node name has always been emq@myserver.mydomain.nl in /etc/emqttd/emq.conf.\nnode.name = emq@myserver.mydomain.nl\nSo: no, I did not modify it.. It is.\nOn Wed, Jan 16, 2019, 03:35 YoukiLin <notifications@github.com wrote:\n\n@victorclaessen https://github.com/victorclaessen Is 10.0.0.1 one of\nthe IPs on your local server? Try to resolve myserver.mydomain.nl using\ntools like ping and nslookup.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqx/emqx/issues/2153#issuecomment-454629236, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AKqUHI-4b03RnHW3qh8am1U4E9SqKavUks5vDo_VgaJpZM4Z-Qbu\n.\n. Perhaps we can first address my question, and then figure out where things go wrong?\nHow, exactly, does emqttd_ctl connect to the broker node?. But is that RPC going over the network? (i.e. should the ip address matter?) Is emqx listening on a TCP/UDP port? Or is there another transport mechanism?. The ip address was simplified, with the intended effect of making things simpler. If you must know, the actual ip is 192.168.14.214, and it is definitely on my nic.\n\nroot@myserver:/# ip a | grep \"\\.14.214\"\n    inet 192.168.14.214/24 brd 192.168.14.255 scope global eth814\nAnd it also resolves nicely:\n```\nroot@myserver:/# nslookup myserver.mydomain.nl\nServer:         192.168.14.1\nAddress:        192.168.14.1#53\nName:   myserver.mydomain.nl\nAddress: 192.168.14.214\n```\nAnd in /etc/hosts:\n```\nroot@myserver:/# cat /etc/hosts\n127.0.0.1       localhost\n127.0.1.1      myserver.mydomain.nl myserver\n127.0.1.1       myserver\n192.168.14.224  myserver.mydomain.nl\n```\nepmd is running, and is listening on all interfaces:\nroot@myserver:/# netstat -lpan | grep epmd | grep LISTEN\ntcp        0      0 0.0.0.0:4369            0.0.0.0:*               LISTEN      10696/epmd\ntcp6       0      0 :::4369                 :::*                    LISTEN      10696/epmd\nThe firewall is off:\nroot@myserver:/# ufw status\nStatus: inactive\nepmd can find the local node:\nroot@myserver:/## epmd -names\nepmd: up and running on port 4369 with data:\nname emq at port 6369\nBut:\nroot@myserver:/## emqttd_ctl\nNode 'emq@myserver.mydomain.nl' not responding to pings.\n. ps aux | grep emq\nemqtt    20486  0.0  0.1  19872  1688 ?        S    13:44   0:00 /usr/lib/emqttd/erts-9.0/bin/run_erl -daemon //var/lib/emqttd/emqtt_erl_pipes/emq@myserver.mydomain.nl/ /var/log/emqttd exec \"/usr/sbin/emqttd\" \"console\"\nemqtt    20488  0.2  6.4 5622988 65660 pts/0   Ssl+ 13:44   0:02 /usr/lib/emqttd/erts-9.0/bin/beam.smp -W w -e 256000 -Q 65536 -P 256000 -A 32 -K true -zdbbl 32768 -- -root /usr/lib/emqttd -progname usr/sbin/emqttd -- -home /var/lib/emqttd -- -boot /usr/lib/emqttd/releases/2.3.10/emqttd -mode embedded -boot_var ERTS_LIB_DIR /usr/lib/emqttd/erts-9.0/../lib -mnesia dir \"/var/lib/emqttd/mnesia/emq@myserver.mydomain.nl\" -config /var/lib/emqttd/configs/app.2019.01.21.13.44.11.config -kernel net_ticktime 60 -smp auto -setcookie mysecretcookie -proto_dist inet_tcp -name emq@myserver.mydomain.nl -vm_args /var/lib/emqttd/configs/vm.2019.01.21.13.44.11.args -- console\nemqtt    20817  0.0  0.0   4180   656 ?        Ss   13:44   0:00 erl_child_setup 1024\nemqtt    20893  0.0  0.0   4288   764 ?        Ss   13:44   0:00 sh -s disksup\nemqtt    20894  0.0  0.0   4044   636 ?        Ss   13:44   0:00 /usr/lib/emqttd/lib/os_mon-2.4.2/priv/bin/memsup\nemqtt    20895  0.0  0.0   4176   664 ?        Ss   13:44   0:00 /usr/lib/emqttd/lib/os_mon-2.4.2/priv/bin/cpu_sup\nroot     23255  0.0  0.0  12784   948 pts/3    S+   14:03   0:00 grep emq\ncat /etc/emqttd/emq.conf\n```\n===================================================================\nEMQ Configuration R2.3\n===================================================================\n--------------------------------------------------------------------\nCluster\n--------------------------------------------------------------------\nCluster name\ncluster.name = emqcl\nCluster discovery strategy: manual | static | mcast | dns | etcd | k8s\ncluster.discovery = mcast\nCluster Autoheal: on | off\ncluster.autoheal = on\nClean down node of the cluster\ncluster.autoclean = 5m\n--------------------------------------------------------------------\nCluster with static node list\ncluster.static.seeds = emq1@127.0.0.1,emq2@127.0.0.1\n--------------------------------------------------------------------\nCluster with multicast\ncluster.mcast.addr = 239.192.0.1\ncluster.mcast.ports = 4369,4370\ncluster.mcast.iface = 0.0.0.0\ncluster.mcast.ttl = 255\ncluster.mcast.loop = on\n--------------------------------------------------------------------\nCluster with DNS\ncluster.dns.name = localhost\ncluster.dns.app = emq\n--------------------------------------------------------------------\nCluster with Etcd\ncluster.etcd.server = http://127.0.0.1:2379\ncluster.etcd.prefix = emqcl\ncluster.etcd.node_ttl = 1m\n--------------------------------------------------------------------\nCluster with k8s\ncluster.k8s.apiserver = http://10.110.111.204:8080\ncluster.k8s.service_name = emq\nAddress Type: ip | dns\ncluster.k8s.address_type = ip\nThe Erlang application name\ncluster.k8s.app_name = emq\n--------------------------------------------------------------------\nNode Args\n--------------------------------------------------------------------\nNode name\nnode.name = emq@myserver.mydomain.nl\nCookie for distributed node\nnode.cookie = mysecretcookie\nSMP support: enable, auto, disable\nnode.smp = auto\nvm.args: -heart\nHeartbeat monitoring of an Erlang runtime system\nValue should be 'on' or comment the line\nnode.heartbeat = on\nEnable kernel poll\nnode.kernel_poll = on\nasync thread pool\nnode.async_threads = 32\nErlang Process Limit\nnode.process_limit = 256000\nSets the maximum number of simultaneously existing ports for this system\nnode.max_ports = 65536\nSet the distribution buffer busy limit (dist_buf_busy_limit)\nnode.dist_buffer_size = 32MB\nMax ETS Tables.\nNote that mnesia and SSL will create temporary ets tables.\nnode.max_ets_tables = 256000\nTweak GC to run more often\nnode.fullsweep_after = 1000\nCrash dump\nnode.crash_dump = /var/log/emqttd/crash.dump\nDistributed node ticktime\nnode.dist_net_ticktime = 60\nDistributed node port range\nnode.dist_listen_min = 6369\nnode.dist_listen_max = 6379\n--------------------------------------------------------------------\nLog\n--------------------------------------------------------------------\nSet the log dir\nlog.dir = /var/log/emqttd\nConsole log. Enum: off, file, console, both\nlog.console = console\nConsole log level. Enum: debug, info, notice, warning, error, critical, alert, emergency\nlog.console.level = error\nSyslog. Enum: on, off\nlog.syslog = on\nsyslog level. Enum: debug, info, notice, warning, error, critical, alert, emergency\nlog.syslog.level = error\nConsole log file\nlog.console.file = /var/log/emqttd/console.log\nInfo log file\nlog.info.file = /var/log/emqttd/info.log\nError log file\nlog.error.file = /var/log/emqttd/error.log\nEnable the crash log. Enum: on, off\nlog.crash = on\nlog.crash.file = /var/log/emqttd/crash.log\n--------------------------------------------------------------------\nAllow Anonymous and Default ACL\n--------------------------------------------------------------------\nAllow Anonymous authentication\nmqtt.allow_anonymous = true\nACL nomatch\nmqtt.acl_nomatch = allow\nDefault ACL File\nmqtt.acl_file = /etc/emqttd/acl.conf\nCache ACL for PUBLISH\nmqtt.cache_acl = true\n--------------------------------------------------------------------\nMQTT Protocol\n--------------------------------------------------------------------\nMax ClientId Length Allowed.\nmqtt.max_clientid_len = 1024\nMax Packet Size Allowed, 64K by default.\nmqtt.max_packet_size = 64KB\nCheck Websocket Protocol Header. Enum: on, off\nmqtt.websocket_protocol_header = on\nThe Keepalive timeout: Keepalive * backoff * 2\nmqtt.keepalive_backoff = 1.25\n--------------------------------------------------------------------\nMQTT Connection\n--------------------------------------------------------------------\nForce GC: integer. Value 0 disabled the Force GC.\nmqtt.conn.force_gc_count = 100\n--------------------------------------------------------------------\nMQTT Client\n--------------------------------------------------------------------\nClient Idle Timeout (Second)\nmqtt.client.idle_timeout = 30s\nMax publish rate of Messages\nmqtt.client.max_publish_rate = 5\nEnable client Stats: on | off\nmqtt.client.enable_stats = off\n--------------------------------------------------------------------\nMQTT Session\n--------------------------------------------------------------------\nMax Number of Subscriptions, 0 means no limit.\nmqtt.session.max_subscriptions = 0\nUpgrade QoS?\nmqtt.session.upgrade_qos = off\nMax Size of the Inflight Window for QoS1 and QoS2 messages\n0 means no limit\nmqtt.session.max_inflight = 32\nRetry Interval for redelivering QoS1/2 messages.\nmqtt.session.retry_interval = 20s\nClient -> Broker: Max Packets Awaiting PUBREL, 0 means no limit\nmqtt.session.max_awaiting_rel = 100\nAwaiting PUBREL Timeout\nmqtt.session.await_rel_timeout = 20s\nEnable Statistics: on | off\nmqtt.session.enable_stats = off\nExpired after 1 day:\nw - week\nd - day\nh - hour\nm - minute\ns - second\nmqtt.session.expiry_interval = 2h\nIgnore message from self publish\nmqtt.session.ignore_loop_deliver = false\n--------------------------------------------------------------------\nMQTT Message Queue\n--------------------------------------------------------------------\nType: simple | priority\nmqtt.mqueue.type = simple\nTopic Priority: 0~255, Default is 0\nmqtt.mqueue.priority = topic/1=10,topic/2=8\nMax queue length. Enqueued messages when persistent client disconnected,\nor inflight window is full. 0 means no limit.\nmqtt.mqueue.max_length = 1000\nLow-water mark of queued messages\nmqtt.mqueue.low_watermark = 20%\nHigh-water mark of queued messages\nmqtt.mqueue.high_watermark = 60%\nQueue Qos0 messages?\nmqtt.mqueue.store_qos0 = true\n--------------------------------------------------------------------\nMQTT Broker and PubSub\n--------------------------------------------------------------------\nSystem Interval of publishing broker $SYS Messages\nmqtt.broker.sys_interval = 1m\nPubSub Pool Size. Default should be scheduler numbers.\nmqtt.pubsub.pool_size = 8\nmqtt.pubsub.by_clientid = true\nSubscribe Asynchronously\nmqtt.pubsub.async = true\n--------------------------------------------------------------------\nMQTT Bridge\n--------------------------------------------------------------------\nBridge Queue Size\nmqtt.bridge.max_queue_len = 10000\nPing Interval of bridge node. Unit: Second\nmqtt.bridge.ping_down_interval = 1s\n-------------------------------------------------------------------\nMQTT Plugins\n-------------------------------------------------------------------\nDir of plugins' config\nmqtt.plugins.etc_dir =/etc/emqttd/plugins/\nFile to store loaded plugin names.\nmqtt.plugins.loaded_file = /var/lib/emqttd/loaded_plugins\n--------------------------------------------------------------------\nMQTT Listeners\n--------------------------------------------------------------------\n--------------------------------------------------------------------\nExternal TCP Listener\nExternal TCP Listener: 1883, 127.0.0.1:1883, ::1:1883\nlistener.tcp.external = 11883\nlistener.tcp.external = 11883\nSize of acceptor pool\nlistener.tcp.external.acceptors = 16\nMaximum number of concurrent clients\nlistener.tcp.external.max_clients = 102400\nlistener.tcp.external.mountpoint = external/\nRate Limit. Format is 'burst,rate', Unit is KB/Sec\nlistener.tcp.external.rate_limit = 100,10\nlistener.tcp.external.access.1 = allow 192.168.0.0/24\nlistener.tcp.external.access.2 = allow all\nProxy Protocol V1/2\nlistener.tcp.external.proxy_protocol = on\nlistener.tcp.external.proxy_protocol_timeout = 3s\nTCP Socket Options\nlistener.tcp.external.backlog = 1024\nlistener.tcp.external.recbuf = 4KB\nlistener.tcp.external.sndbuf = 4KB\nlistener.tcp.external.buffer = 4KB\nlistener.tcp.external.nodelay = true\n--------------------------------------------------------------------\nInternal TCP Listener\nInternal TCP Listener: 11883, 127.0.0.1:11883, ::1:11883\nlistener.tcp.internal = 127.0.0.1:1883\nSize of acceptor pool\nlistener.tcp.internal.acceptors = 16\nMaximum number of concurrent clients\nlistener.tcp.internal.max_clients = 102400\nlistener.tcp.external.mountpoint = internal/\nRate Limit. Format is 'burst,rate', Unit is KB/Sec\nlistener.tcp.internal.rate_limit = 1000,100\nTCP Socket Options\nlistener.tcp.internal.backlog = 512\nlistener.tcp.internal.tune_buffer = on\nlistener.tcp.internal.buffer = 1MB\nlistener.tcp.internal.recbuf = 4KB\nlistener.tcp.internal.sndbuf = 1MB\nlistener.tcp.internal.nodelay = true\n--------------------------------------------------------------------\nExternal SSL Listener\nSSL Listener: 8883, 127.0.0.1:8883, ::1:8883\nlistener.ssl.external = 18883\nSize of acceptor pool\nlistener.ssl.external.acceptors = 16\nMaximum number of concurrent clients\nlistener.ssl.external.max_clients = 1024\nlistener.ssl.external.mountpoint = inbound/\nRate Limit. Format is 'burst,rate', Unit is KB/Sec\nlistener.ssl.external.rate_limit = 100,10\nProxy Protocol V1/2\nlistener.ssl.external.proxy_protocol = on\nlistener.ssl.external.proxy_protocol_timeout = 3s\nlistener.ssl.external.access.1 = allow all\nSSL Options. See http://erlang.org/doc/man/ssl.html\nConfiguring SSL Options. See http://erlang.org/doc/man/ssl.html\nTLS only for POODLE attack\nlistener.ssl.external.tls_versions = tlsv1.2,tlsv1.1,tlsv1\nThe Ephemeral Diffie-Helman key exchange is a very effective way of\nensuring Forward Secrecy by exchanging a set of keys that never hit\nthe wire. Since the DH key is effectively signed by the private key,\nit needs to be at least as strong as the private key. In addition,\nthe default DH groups that most of the OpenSSL installations have\nare only a handful (since they are distributed with the OpenSSL\npackage that has been built for the operating system it\u2019s running on)\nand hence predictable (not to mention, 1024 bits only).\nIn order to escape this situation, first we need to generate a fresh,\nstrong DH group, store it in a file and then use the option above,\nto force our SSL application to use the new DH group. Fortunately,\nOpenSSL provides us with a tool to do that. Simply run:\nopenssl dhparam -out dh-params.pem 2048\nlistener.ssl.external.handshake_timeout = 15s\nlistener.ssl.external.keyfile = /etc/ssl/private/myserver.mydomain.nl.key.pem\nlistener.ssl.external.certfile = /etc/ssl/certs/myserver.mydomain.nl.chain.pem\nlistener.ssl.external.cacertfile = /etc/emqttd/certs/cacert.pem\nlistener.ssl.external.dhfile = /etc/emqttd/certs/dh-params.pem\nlistener.ssl.external.verify = verify_peer\nlistener.ssl.external.fail_if_no_peer_cert = true\nThis is the single most important configuration option of an Erlang SSL application.\nCiphers (and their ordering) define the way the client and server encrypt information\nover the wire, from the initial Diffie-Helman key exchange, the session key encryption\nalgorithm and the message digest algorithm. Selecting a good cipher suite is critical\nfor the application\u2019s data security, confidentiality and performance.\nThe cipher list above offers:\n\nA good balance between compatibility with older browsers. It can get stricter for Machine-To-Machine scenarios.\nPerfect Forward Secrecy.\nNo old/insecure encryption and HMAC algorithms\n\nMost of it was copied from Mozilla\u2019s Server Side TLS article\nlistener.ssl.external.ciphers = ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384,ECDHE-ECDSA-AES256-SHA384,ECDHE-RSA-AES256-SHA384,ECDHE-ECDSA-DES-CBC3-SHA,ECDH-ECDSA-AES256-GCM-SHA384,ECDH-RSA-AES256-GCM-SHA384,ECDH-ECDSA-AES256-SHA384,ECDH-RSA-AES256-SHA384,DHE-DSS-AES256-GCM-SHA384,DHE-DSS-AES256-SHA256,AES256-GCM-SHA384,AES256-SHA256,ECDHE-ECDSA-AES128-GCM-SHA256,ECDHE-RSA-AES128-GCM-SHA256,ECDHE-ECDSA-AES128-SHA256,ECDHE-RSA-AES128-SHA256,ECDH-ECDSA-AES128-GCM-SHA256,ECDH-RSA-AES128-GCM-SHA256,ECDH-ECDSA-AES128-SHA256,ECDH-RSA-AES128-SHA256,DHE-DSS-AES128-GCM-SHA256,DHE-DSS-AES128-SHA256,AES128-GCM-SHA256,AES128-SHA256,ECDHE-ECDSA-AES256-SHA,ECDHE-RSA-AES256-SHA,DHE-DSS-AES256-SHA,ECDH-ECDSA-AES256-SHA,ECDH-RSA-AES256-SHA,AES256-SHA,ECDHE-ECDSA-AES128-SHA,ECDHE-RSA-AES128-SHA,DHE-DSS-AES128-SHA,ECDH-ECDSA-AES128-SHA,ECDH-RSA-AES128-SHA,AES128-SHA\nSSL parameter renegotiation is a feature that allows a client and\na server to renegotiate the parameters of the SSL connection on the fly.\nRFC 5746 defines a more secure way of doing this. By enabling secure renegotiation,\nyou drop support for the insecure renegotiation, prone to MitM attacks.\nlistener.ssl.external.secure_renegotiate = off\nA performance optimization setting, it allows clients to reuse\npre-existing sessions, instead of initializing new ones.\nRead more about it here.\nlistener.ssl.external.reuse_sessions = on\nAn important security setting, it forces the cipher to be set based on\nthe server-specified order instead of the client-specified order,\nhence enforcing the (usually more properly configured) security\nordering of the server administrator.\nlistener.ssl.external.honor_cipher_order = on\nUse the CN or DN value from the client certificate as a username.\nNotice: 'verify' should be configured as 'verify_peer'\nlistener.ssl.external.peer_cert_as_username = cn\nSSL Socket Options\nlistener.ssl.external.backlog = 1024\nlistener.ssl.external.recbuf = 4KB\nlistener.ssl.external.sndbuf = 4KB\nlistener.ssl.external.buffer = 4KB\nlistener.ssl.external.nodelay = true\n--------------------------------------------------------------------\nExternal MQTT/WebSocket Listener\nlistener.ws.external = 18083\nlistener.ws.external.acceptors = 4\nlistener.ws.external.max_clients = 64\nlistener.ws.external.access.1 = allow all\nTCP Options\nlistener.ws.external.backlog = 1024\nlistener.ws.external.recbuf = 4KB\nlistener.ws.external.sndbuf = 4KB\nlistener.ws.external.buffer = 4KB\nlistener.ws.external.nodelay = true\n--------------------------------------------------------------------\nExternal MQTT/WebSocket/SSL Listener\nlistener.wss.external = 18084\nlistener.wss.external.acceptors = 4\nlistener.wss.external.max_clients = 64\nlistener.wss.external.access.1 = allow all\nSSL Options\nlistener.wss.external.handshake_timeout = 15s\nlistener.wss.external.keyfile = /etc/ssl/private/myserver.mydomain.nl.key.pem\nlistener.wss.external.certfile = /etc/ssl/certs/myserver.mydomain.nl.chain.pem\nlistener.wss.external.cacertfile = /etc/emqttd/certs/cacert.pem\nlistener.wss.external.verify = verify_peer\nlistener.wss.external.fail_if_no_peer_cert = true\n--------------------------------------------------------------------\nHTTP Management API Listener\nlistener.api.mgmt = 127.0.0.1:8088\nlistener.api.mgmt = 0.0.0.0:8088\nlistener.api.mgmt.acceptors = 4\nlistener.api.mgmt.max_clients = 64\nlistener.api.mgmt.access.1 = allow all\n-------------------------------------------------------------------\nSystem Monitor\n-------------------------------------------------------------------\nLong GC, don't monitor in production mode for:\nhttps://github.com/erlang/otp/blob/feb45017da36be78d4c5784d758ede619fa7bfd3/erts/emulator/beam/erl_gc.c#L421\nsysmon.long_gc = false\nLong Schedule(ms)\nsysmon.long_schedule = 240\n8M words. 32MB on 32-bit VM, 64MB on 64-bit VM.\nsysmon.large_heap = 8MB\nBusy Port\nsysmon.busy_port = false\nBusy Dist Port\nsysmon.busy_dist_port = true\n```. I also don't understand it (hence the question ;-)). \nWhen I replace the /etc/hosts file with the following, everything works as normal:\n```\nroot@myserver:/# cat /etc/hosts\n127.0.0.1       localhost\n127.0.1.1      myserver.mydomain.nl myserver\n127.0.1.1       myserver\n192.168.14.224  myserver.mydomain.nl\n```\nAdditionally, the ip 192.168.14.1 that you mention (in the output of nslookup) is the ip address of the DNS server. This is normal output for the nslookup program. 192.168.14.1 is not an ip of myserver.. Ah, that is a very good test!\nI replaced the name in /etc/emqttd/emq.conf, and then restarted the node, and then this is the result:\nroot@myserver:/# emqttd_ctl status\nNode 'emq@192.168.14.214' is started\nemqttd 2.3.10 is running\nThis is now independent of what is in /etc/hosts (i.e. both situations work, 127.0.1.1 myserver.mydomain.nl or 192.168.14.224 myserver.mydomain.nl , it doesn't matter)\nroot@myserver:/# emqttd_ctl cluster status\nCluster status: [{running_nodes,['emq@otherserver.mydomain.nl',\n                                 'emq@192.168.14.214']},\n                 {stopped_nodes,['emq@myserver.mydomain.nl']}]\nThe question is: why does it work with the ip address 192.168.14.214, but not with the hostname (myserver.mydomain.nl) that resolves to 192.168.14.214 (it resolves both with /etc/hosts, and also with DNS)? That seems so weird to me.. (emq@192.168.14.214)1> inet:gethostbyname(\"myserver.mydomain.nl\").\n{ok,{hostent,\"myserver\",\n             [\"myserver.mydomain.nl\"],\n             inet,4,\n             [{192,168,14,224}]}} . > It's weird to me too because I can not reproduce your problem on my machine, I have a question, did you start your emqx first, then config dns resolve in /etc/hosts ?\nI restarted emqx/emqttd after changing /etc/hosts.. Also interesting: when I change the node name back to myserver.mydomain.nl, and restart the emqttd console, then the inet:gethostbyname(\"myserver.mydomain.nl\") command doesn't produce any result.. > Hey, look the result. The myserver.mydomain.nl was resolved to 192.168.14.224, not 192.168.14.214\nOh, man, you are so right. 214 is the correct ip address, and was I mistyping 224 into /etc/hosts. So emqttd_ctl could not resolve the hostname to the correct ip address.\nI am so sorry for having wasted your time. Thank you very much for the support!. Very similar to my question #1577. Hope this will get implemented soon.. ",
    "gopalkildoliya": "Ohh Its working now. I just restarted the emqttd and the it loaded successfully. Thanks. ",
    "BorisPetelj": "Also interested. Any inputs by now?. Same thing here. Tracing by clientId outputs:\n15:04:44.711 [debug] Client(cli/867@10.240.0.20:52630): Shutdown for timeout\nWe are expecting payload size in ~1MB and keepalive is set at 60sec from client side. \nClient gets disconnected approx. 10 seconds after trying to publish.\nSince \"emqttd_ctl listeners\" shows \nshutdown_count  : [{conflict,78},{closed,17},{keepalive_timeout,15},{timeout,90}]\nI'm curious what is the exact diference between \"keepalive_timeout\" and \"timeout\"?\nAlso, CPU peaks to 100% each time this payload is going through broker. The google instance is \n\nn1-standard-1 (1 vCPU, 3.75 GB memory)\n\nThe resources are not high but there are ~150 clients connected to broker.\nDo you have any inputs on how to resolve this issue?\n. Yes its short timeout definitely but we could not find the correct place to increase it. \nI will provide more detailed information as soon as possible. Can you point me in the right direction about increasing timeout on broker? I tried disabling \"send_timeout_close\" on both external and internal tcp connections and increasing \"send_timeout\" to 30s with no luck. \nEven with \"send_timeout_close\" set to off, the client gets disconnected after timeout. \n. > Also, CPU peaks to 100% each time this payload is going through broker. The google instance is\n\nn1-standard-1 (1 vCPU, 3.75 GB memory)\n\nAfter setting log level to error the CPU went back to normal. But the issue still persists. \n. Broker version 3.0.1 resolved the issue. . ",
    "snoopckuu": "I am also interested any updates please?. ",
    "Talanor": "Hello, an (almost) monthly up in order to have news concerning this feature. Thanks.. ",
    "qudenger": "ok, it works now, thanks!. ",
    "hello2dj": "\u6211\u9519\u4e86\uff0cdocker import \u8fdb\u53bb\u540e\uff0c\u6839\u672c\u8fd0\u884c\u4e0d\u4e86\u554a\u3002\u3002\u3002. @turtleDeng  sorry I don't get you.  you mean this  \"http:\\/\\/172.25.100.3:7001\\/mqtt\\/auth?\". I  get this \nauth.http.auth_req=\"http:\\/\\/172.25.100.3:7001\\/mqtt\\/auth\"\nemqtt-server    | sed: bad option in substitution expression\nemqtt-server    | listener.ssl.external.max_clients=500000\nemqtt-server    | node.max_ports=1048576\nemqtt-server    | listener.tcp.external.acceptors=64\nemqtt-server    | log.console=console\nemqtt-server    | listener.ws.external.max_clients=250000\nemqtt-server    | name=71b55963c6fc\nemqtt-server    | auth.http.super_req=\"http:\\/\\/172.25.100.3:7001\\/mqtt\\/auth\"\nemqtt-server    | sed: bad option in substitution expression\nemqtt-server    | auth.http.auth_req.method=post. i use // but github discard one. @turtleDeng so sorry you see this\n\n. @turtleDeng my emqtt config is replace ok, this is the /opt/emqttd/etc/plugins/emq_auth_http.conf content? is this OK? thank you\n```\n--------------------------------------------------------------------\nHTTP Auth/ACL Plugin\n--------------------------------------------------------------------\nVariables: %u = username, %c = clientid, %a = ipaddress, %P = password, %t = topic\nauth.http.auth_req = \"http://172.25.100.3:7001/mqtt/auth\"\nauth.http.auth_req.method = post\nauth.http.auth_req.params = clientid=%c,username=%u,password=%P\nauth.http.super_req = \"http://172.25.100.3:7001/mqtt/auth\"\nauth.http.super_req.method = post\nauth.http.super_req.params = clientid=%c,username=%u\n'access' parameter: sub = 1, pub = 2\nauth.http.acl_req = http://127.0.0.1:8080/mqtt/acl\nauth.http.acl_req.method = get\nauth.http.acl_req.params = access=%A,username=%u,clientid=%c,ipaddr=%a,topic=%t\n```. @turtleDeng  if this is ok, there will be some other problem? when i connect to emqtt, it will be report crash like above. yeah it crash, maybe i am so stupid...\n\n. thank you so much. @turtleDeng  solved! the question is i use auth.http.auth_req = \"xxx\" not auth.http.auth_req =  xxx, and don't need \nto use \\ to escape just use . my os is Ubuntu 16.04.2 LTS. thank you.. @emqplus  I don't understand you, how can i do? what does invalid, Cool, and wontfix mean?\n. @emqplus  I just want to how what does this error mean? so that i can use right. this mean i Call mongodb to auth timeout ?. ",
    "jwestra": "Hi, I see there is a command.  Does that require the node to be running?  I don't want to start the node up with a 'public' password, change it, and then, restart. I'd rather configure in /plugins/emq_dashboard.conf and start one time.  Or, pass it on the commandline at start-up.. ",
    "shuaibakram": "Hi\nI have upgraded the version from 2.3-rc.2 and the issue persists.\nBelow is the error log.\n12:06:22.025 [info] Started Apps: [emq_auth_mongo]\n12:06:22.025 [info] Load plugin emq_auth_mongo successfully\n12:06:22.025 [info] Application emq_auth_mongo started on node 'emq@127.0.0.1'\n12:06:22.113 [debug] Mod:emqttd_rest_api, Fun:plugin_list, Args:['GET',[{\"timestamps\",\"1508760381379\"}],\"emq@127.0.0.1\"]\n12:06:22.522 [error] gen_server <0.1506.0> terminated with reason: killed\n12:06:22.522 [error] CRASH REPORT Process <0.1506.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:22.522 [error] gen_server <0.1469.0> terminated with reason: killed\n12:06:22.560 [error] CRASH REPORT Process <0.1469.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:22.560 [error] gen_server <0.1496.0> terminated with reason: killed\n12:06:22.560 [error] CRASH REPORT Process <0.1496.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:22.560 [error] gen_server <0.1481.0> terminated with reason: killed\n12:06:22.561 [error] CRASH REPORT Process <0.1481.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:22.561 [error] gen_server <0.1476.0> terminated with reason: killed\n12:06:22.561 [error] CRASH REPORT Process <0.1476.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:22.562 [error] gen_server <0.1486.0> terminated with reason: killed\n12:06:22.562 [error] CRASH REPORT Process <0.1486.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:22.562 [error] gen_server <0.1491.0> terminated with reason: killed\n12:06:22.563 [error] CRASH REPORT Process <0.1491.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:22.563 [error] gen_server <0.1501.0> terminated with reason: killed\n12:06:22.563 [error] CRASH REPORT Process <0.1501.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:23.175 [error] gen_server <0.1558.0> terminated with reason: killed\n12:06:23.175 [error] CRASH REPORT Process <0.1558.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:23.175 [error] gen_server <0.1559.0> terminated with reason: killed\n12:06:23.176 [error] CRASH REPORT Process <0.1559.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:23.176 [error] gen_server <0.1561.0> terminated with reason: killed\n12:06:23.176 [error] CRASH REPORT Process <0.1561.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:23.176 [error] gen_server <0.1546.0> terminated with reason: killed\n12:06:23.177 [error] CRASH REPORT Process <0.1546.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:23.177 [error] gen_server <0.1489.0> terminated with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:23.381 [error] CRASH REPORT Process <0.1489.0> with 0 neighbours crashed with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:23.381 [error] gen_server <0.1550.0> terminated with reason: killed\n12:06:23.381 [error] CRASH REPORT Process <0.1550.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:23.381 [error] gen_server <0.1554.0> terminated with reason: killed\n12:06:23.382 [error] CRASH REPORT Process <0.1554.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:23.382 [error] gen_server <0.1544.0> terminated with reason: killed\n12:06:23.382 [error] CRASH REPORT Process <0.1544.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:25.271 [error] gen_server <0.1484.0> terminated with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:25.271 [error] CRASH REPORT Process <0.1484.0> with 0 neighbours crashed with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:25.271 [error] gen_server <0.1556.0> terminated with reason: killed\n12:06:25.272 [error] CRASH REPORT Process <0.1556.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:25.272 [error] gen_server <0.1529.0> terminated with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:25.272 [error] CRASH REPORT Process <0.1529.0> with 0 neighbours exited with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204 in gen_server:handle_common_reply/8 line 726\n12:06:25.272 [error] gen_server <0.1576.0> terminated with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:25.272 [error] CRASH REPORT Process <0.1576.0> with 0 neighbours exited with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204 in gen_server:handle_common_reply/8 line 726\n12:06:25.272 [error] gen_server <0.1467.0> terminated with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:25.272 [error] CRASH REPORT Process <0.1467.0> with 0 neighbours crashed with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:25.272 [error] gen_server <0.1527.0> terminated with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:25.273 [error] CRASH REPORT Process <0.1527.0> with 0 neighbours exited with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204 in gen_server:handle_common_reply/8 line 726\n12:06:25.273 [error] gen_server <0.1578.0> terminated with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:25.273 [error] CRASH REPORT Process <0.1578.0> with 0 neighbours exited with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204 in gen_server:handle_common_reply/8 line 726\n12:06:25.433 [error] gen_server <0.1517.0> terminated with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:25.433 [error] CRASH REPORT Process <0.1517.0> with 0 neighbours exited with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204 in gen_server:handle_common_reply/8 line 726\n12:06:25.433 [error] gen_server <0.1584.0> terminated with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204\n12:06:25.433 [error] CRASH REPORT Process <0.1584.0> with 0 neighbours exited with reason: no match of right hand value [] in mc_topology:parse_ismaster/4 line 204 in gen_server:handle_common_reply/8 line 726\n12:06:25.433 [error] gen_server <0.1589.0> terminated with reason: killed\n12:06:25.435 [error] CRASH REPORT Process <0.1589.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:25.435 [error] gen_server <0.1598.0> terminated with reason: killed\n12:06:25.435 [error] CRASH REPORT Process <0.1598.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:25.476 [error] gen_server <0.1594.0> terminated with reason: killed\n12:06:25.476 [error] CRASH REPORT Process <0.1594.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:25.477 [error] gen_server <0.1596.0> terminated with reason: killed\n12:06:25.477 [error] CRASH REPORT Process <0.1596.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:25.477 [error] gen_server <0.1593.0> terminated with reason: killed\n12:06:25.477 [error] CRASH REPORT Process <0.1593.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:25.477 [error] gen_server <0.1612.0> terminated with reason: killed\n12:06:27.080 [error] CRASH REPORT Process <0.1612.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.080 [error] gen_server <0.1614.0> terminated with reason: killed\n12:06:27.080 [error] CRASH REPORT Process <0.1614.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.080 [error] gen_server <0.1616.0> terminated with reason: killed\n12:06:27.240 [error] CRASH REPORT Process <0.1616.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.240 [error] gen_server <0.1618.0> terminated with reason: killed\n12:06:27.241 [error] CRASH REPORT Process <0.1618.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.241 [error] gen_server <0.1615.0> terminated with reason: killed\n12:06:27.241 [error] CRASH REPORT Process <0.1615.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.241 [error] gen_server <0.1628.0> terminated with reason: killed\n12:06:27.242 [error] CRASH REPORT Process <0.1628.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.242 [error] gen_server <0.1627.0> terminated with reason: killed\n12:06:27.242 [error] CRASH REPORT Process <0.1627.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.280 [error] gen_server <0.1650.0> terminated with reason: killed\n12:06:27.280 [error] CRASH REPORT Process <0.1650.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.280 [error] gen_server <0.1641.0> terminated with reason: killed\n12:06:27.280 [error] CRASH REPORT Process <0.1641.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.280 [error] gen_server <0.1648.0> terminated with reason: killed\n12:06:27.280 [error] CRASH REPORT Process <0.1648.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.280 [error] gen_server <0.1649.0> terminated with reason: killed\n12:06:27.281 [error] CRASH REPORT Process <0.1649.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.281 [error] gen_server <0.1647.0> terminated with reason: killed\n12:06:27.281 [error] CRASH REPORT Process <0.1647.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.282 [error] gen_server <0.1633.0> terminated with reason: killed\n12:06:27.282 [error] CRASH REPORT Process <0.1633.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\n12:06:27.282 [error] gen_server <0.1664.0> terminated with reason: killed\n12:06:27.282 [error] CRASH REPORT Process <0.1664.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410. @turtleDeng Incase you are referring to the plugin status in EMQ Dashboard, it shows running.\nIf you are referring to something else, please let me know where I can check it.. The following is the error I got while running form source. \n05:08:40.306 [error] GenServer #PID<0.11687.1> terminating\n** (stop) killed\nLast message: {:EXIT, #PID<0.11686.1>, :killed}\nState: {:state, :undefined, 'ds117829.mlab.com', 17829, #PID<0.11670.1>, #PID<0.11686.1>, [], [database: \"db\", login: \"login\", password: \"password\"], :undefined, 20000, 10000, 1000, #PID<0.11689.1>, 1}. @emqplus @turtleDeng \nJust a thought.\nHow about having a REST API to subscribe a client to multiple topics?. ",
    "hamdijmii1992": "Thanks @turtleDeng, With emq-relx, can I add a new plugin and recompile the project .\n. ",
    "carlos-renjel-coderoad-com": "@emqplus \nHi! I just enabled mqtt.client.enable_stats = on and mqtt.session.enable_stats = on, and everything is as expected\nThanks!. ",
    "ax003d": "Got it, but why not put it in this repo?. ",
    "weljack": "I have the same issue. Please help us !!. ",
    "yogo1212": "@grutabow I will try to set up the server on my computer.\nmeanwhile: https://github.com/emqtt/emqttd/pull/1323. that i can do easily:\nExec: /var/emqttd/erts-8.3/bin/erlexec -noshell -noinput +\nRoot: /var/emqttd\nstarting emqttd on node 'emqttd@127.0.0.1'\nemqttd ctl is starting...[ok]\nemqttd hook is starting...[ok]\nemqttd router is starting...[ok]\nemqttd pubsub is starting...[ok]\nemqttd stats is starting...[ok]\nemqttd metrics is starting...[ok]\nemqttd pooler is starting...[ok]\nemqttd trace is starting...[ok]\nemqttd client manager is starting...[ok]\nemqttd session manager is starting...[ok]\nemqttd session supervisor is starting...[ok]\nemqttd wsclient supervisor is starting...[ok]\nemqttd broker is starting...[ok]\nemqttd alarm is starting...[ok]\nemqttd mod supervisor is starting...[ok]\nemqttd bridge supervisor is starting...[ok]\nemqttd access control is starting...[ok]\nemqttd system monitor is starting...[ok]\nLoad emq_mod_presence module successfully.\nLoad emq_mod_subscription module successfully.\ndashboard:http listen on 0.0.0.0:18083 with 2 acceptors.\nmqtt:tcp listen on 127.0.0.1:11883 with 16 acceptors.\nmqtt:tcp listen on 0.0.0.0:1883 with 16 acceptors.\nmqtt:ssl listen on 0.0.0.0:443 with 16 acceptors.\nemqttd 2.2 is running now\ni, too, don't understand why there would be retransmissions for QoS=0.\nbut i can reproduce it quite reliably.\none way to do it is to start the server, attach a subscriber, detach the subscriber, send a hail of qos=0 messages, and attach same subscriber again.\nsetting the clean_session flag helps but after a few more qos=0 messages, it happens again.\nmy attempts to build and run emqtt on my personal computer are failing :-|\nand i can't pullt the dump from our prod server for legal reasons.\n. no errors or crashes on the server side. @HJianBo i will check some source packets as well, then.\n@grutabow i understand. still, i need an emq server to connect to. right now, i don't have the time set it up.. ",
    "LiushengWang": "I found a scene where this problem occurred\uff0cthis client is in the clients list\uff0cbut can not find the session in Sessions list.\n. @HJianBo Thanks for your responses,  \nThere is no accurate reconstruction procedure\uff0cI use the follow steps to connect mqtt broker:\nthe connect args is following: \nClient connect:\n10 2e 00 04 4d 51 54 54\n   04 c2 00 3c 00 0f 38 36\n   31 38 35 33 30 33 31 34\n   37 35 36 31 39 00 09 74\n   61 6e 67 67 75 6f 6a 69\n   00 06 74 74 67 67 6a 6a\nand recevice  connack:\n   20 02 00 00\nClient subscribe:\n82 23 00 00 00 1e 43 6c\n   69 65 6e 74 2f 43 6f 6d\n   6d 61 6e 64 2f 38 36 31\n   38 35 33 30 33 31 34 37\n   35 36 31 39 00\nand recevice  suback:\n   90 03 00 00 00\nThanks!\n. ",
    "Nawneet47": "Same Issue , Is there any example of how to make a public topic for that client to access this topic outside of localhost\n. Thanks. For your help.. Thanks @TheBeachMaster  . I configured it successfully and working fine. I have one more query how to stop unauthorized publish topic by using ACL configuratin. Please Help. And all the things are working fine. . my ACL Config are as follows:\n{allow, {user, \"dashboard\"}, subscribe, [\"$SYS/#\"]}.\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", \"#\"]}.\n{deny, all, pubsub, [\"$SYS/#\", {eq, \"#\"} , \"#\"]}.\n{allow, {user, \"$u\"}, pubsub, [\"Device/$u/#\"]}\nit is successfully denying the subscription in this topic but not denying  the publish according to the topic. So please Help . How can i deny the unauthentic topic publish by a client. ",
    "sfowlr": "I updated to 2.3.3 using the deb package and expecting this to be patched but later realized that the ws_proxy branch still hasn't been merged. Is this still on hold for 2.4-beta1, or was it supposed to make it into the 2.3.1 release?. ",
    "franquis": "Great job ! Thanks @emqplus !. ",
    "Zhang-Xianglong": "emqttd-centos6.8-v2.2.0-1.el6.x86_64.rpm. thanks a lot. why not fix this? @terry-xiaoyu @Gilbert-Wong . @hmonadjem I guess the message which you want matches multiple topic filters. From the author's reply, it's not a bug because of [MQTT-3.3.5-1] is not a mandatory standard, it probably is internal implementation logic. And it has nothing to do with the QoS.. emqttd.zip\n. Intel(R) Xeon(R) CPU E5-2609 v4 @ 1.70GHz, 15G Memory\nThere are about 10 application processes in it. Is insufficient memory causing this problem?. @Gilbert-Wong less than 200. > It is definitely abnormal. Please give me your crash log file Gilbert Wong On Jan 29, 2019, 3:01 PM +0800, Zhang-Xianglong notifications@github.com, wrote: @Gilbert-Wonghttps://github.com/Gilbert-Wong less than 200 \u2014 You are receiving this because you were mentioned. Reply to this email directly, view it on GitHub<#2190 (comment)>, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-01VaRDrcIn9euHSRwDxQe-hBec7wks5vH_HggaJpZM4aXJuQ.\nOther logs should be accidentally lost, and I will do some benchmarking to reproduce the problem. Thanks for your support.. \n@terry-xiaoyu Will this problem also occur with the default configuration?\nemq.conf\nmqtt.allow_anonymous = true\nmqtt.acl_nomatch = allow\nmqtt.acl_file = /etc/emqttd/acl.conf\nmqtt.cache_acl = true\nacl.conf\n{allow, {user, \"dashboard\"}, subscribe, [\"$SYS/#\"]}.\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", \"#\"]}.\n{deny, all, subscribe, [\"$SYS/#\", {eq, \"#\"}]}.\n. ",
    "MarsWarrior": ";-)\nRunning since 5 days!\nThanx!. After this crash, and an automatic restart of emqtt, the authorization plugin is not started or enabled, so no clients can connect anymore.\nIs this related or another issue?. ",
    "yyguo1986": "I got the 102 error if offering client_id parameter. Why? Does the emq_auth_clientid plugin need load?\n{\"code\":102,\"message\":\"Clientid: test1 not found\"}. Got it. Thanks.. Yes, emq_auth_username plugin is running. And the user configed in its conf file has been shown in  \"./bin/emqttd_ctl users list\". \nIf this plugin has not started, I think the user will not be shown in user list. Right?. Uploaded some screenshots for your reference to clarify.\nFound some intresting things : the behavior is inconsistent between win10/emq2.3.0-rc.2 and linux/emq2.3.0.  The user configured in emq_auth_username.conf will be added to the \"./bin/emqtt_ctl users\" in win10/emq2.3.0-rc.2, but will not in linux/emq2.3.0. However, the same is that the user configured in emq_auth_username.conf does not work.\nlinux/emq2.3.0\n\n\nwin10/emq2.3.0-rc.2\n\n\n. Q1: Yes, I restarted emq in both windows and linux. \nThe linux/emq2.3.0 node was in a cluster before, but I removed it from cluster(users were also deleted automatically) and then restart it, the user configured in emq_auth_username.conf file also cannot be added to the \"./bin/emqttd_ctl users list\". \nQ2: I also want to know why the unconfigured user can login. \nI have checked the linux/emq2.3.0, the mqtt.allow_anonymous is false.\nI have followed your suggestion to delete all users by CLI, and then restart EMQ. But same issues are there.\nHowever, it seems I found some root cause for windows/emq. If there is a new line (line break) after the last line in emq_auth_username.conf, it works. Otherwise, it doesn't. \nFollowing are reproduce steps. Configured two users in .conf file: a/a  and b/b\nE:\\emqttd>bin\\emqttd_ctl users list \nE:\\emqttd>bin\\emqttd restart    <-----No new line or line break after the last line in .conf file.\nok\nE:\\emqttd>bin\\emqttd_ctl users list\nb\na\nE:\\emqttd>mosquitto_sub  -t \"topic\" -d -u a -P a\nClient mosqsub|24060-lenovo-PC sending CONNECT\nClient mosqsub|24060-lenovo-PC received CONNACK\nClient mosqsub|24060-lenovo-PC sending SUBSCRIBE (Mid: 1, Topic: topic, QoS: 0)\nClient mosqsub|24060-lenovo-PC received SUBACK\nSubscribed (mid: 1): 0\n^C\nE:\\emqttd>mosquitto_sub  -t \"topic\" -d -u b -P b\nClient mosqsub|16712-lenovo-PC sending CONNECT\nClient mosqsub|16712-lenovo-PC received CONNACK\nConnection Refused: bad user name or password.\nClient mosqsub|16712-lenovo-PC sending CONNECT\nClient mosqsub|16712-lenovo-PC received CONNACK\nConnection Refused: bad user name or password.\n^C\nE:\\emqttd>bin\\emqttd_ctl users del a\nok\nE:\\emqttd>bin\\emqttd_ctl users del b\nok\nE:\\emqttd>bin\\emqttd_ctl users list\nE:\\emqttd>bin\\emqttd restart     <------------------Add a new line after the last line in .conf file.\nok\nE:\\emqttd>bin\\emqttd_ctl users list\nb\na\nE:\\emqttd>mosquitto_sub  -t \"topic\" -d -u a -P a\nClient mosqsub|2260-lenovo-PC sending CONNECT\nClient mosqsub|2260-lenovo-PC received CONNACK\nClient mosqsub|2260-lenovo-PC sending SUBSCRIBE (Mid: 1, Topic: topic, QoS: 0)\nClient mosqsub|2260-lenovo-PC received SUBACK\nSubscribed (mid: 1): 0\n^C\nE:\\emqttd>mosquitto_sub  -t \"topic\" -d -u b -P b\nClient mosqsub|42788-lenovo-PC sending CONNECT\nClient mosqsub|42788-lenovo-PC received CONNACK\nClient mosqsub|42788-lenovo-PC sending SUBSCRIBE (Mid: 1, Topic: topic, QoS: 0)\nClient mosqsub|42788-lenovo-PC received SUBACK\nSubscribed (mid: 1): 0\n^C\nE:\\emqttd>\n. Is there any update on this issue?. Yes\uff0c restarted the broker and the plugin also has started. \nI can reproduce this issue on another linux/emq2.3.0 broker. The reproduce steps in my environment:\na. Leave the node from the original cluster.\nb. Add a new user in emq_auth_username.conf.\nc. Unload the emq_auth_username plugin.\nd. Reload the emq_auth_username plugin.\ne. Restart the emqttd.\nf. No user in \"bin/emqttd_ctl users list\". \n\n. Great, it works after stopping then starting emqttd. So restart command has some issue currently. . Same requirement with #416\u3002\nIs there any detailed document available to use it? . ",
    "cofol1986": "Hi @turtleDeng and @emqplus , what are your ideas about this issue?\nIs ERTS with hipe helpful?. ",
    "Think7": "Thank you!\nWas this in the docs? I searched and searched before posting :/. Understood!\nSo for this ACL scheme, it is necessary to use one of the DB plugins?. Something else (completely unrelated) i've noticed is running \"systemctl emqx stop\" takes about 3 mins to complete. Starting is instant.. Thank you! Is this version available via YUM? Or should i just wait for emqx 3.1?. I think i've encountered the same bug :(\nHere are my logs:\nhttps://gist.github.com/Think7/f93d267ef7646c11bc3a3ec4e10a5ca8\nCan you confirm?. > easily repeatable with the following python code:\n\n```\nmport paho.mqtt.client as mqtt\nimport time\ndef main():\n  client = mqtt.Client()\n  client.connect(\"localhost\", 4883 , 60) ## your broker address/port here\n  client.loop_start()\nfor x in range (16):\n      msg = \"_\" + str(x)\n      msg = msg.zfill(100)\n      client.publish('kala/kala', payload=msg)\ntime.sleep(2)\n  client.loop_stop()\nmain()\n```\n\nIs there a workaround for this? Can i format my messages differently? I'll be very honest and say i don't fully understand the issue / cause.. > > > Is there a workaround for this?\n\nsure, the bug has to be fixed :)\n\nHaha, ok. :P\nJust emailed @HJianBo some packet captures as well. Hopefully they are helpful. Didn't mean to be annoying by asking. Just a bit stuck using Mosquitto which cant handle the volume i need to throw at it.. ",
    "Densaugeo": "Too bad someone took the name. Guess there's not much you can do about that, so I'll close this.. ",
    "windhc": "thank you very much. ",
    "sunwu51": "There are some wrong with the js client....... ",
    "venks-warrior": "Can someone update pls?. From HTTP APIs of nodes.. yes Publish happened, but subscriber dint receive.May i know in what all cases the drop of messages happen?How will message Ids help me in debugging?. I am relatively new to EMQTT. How do i get the workflow of a message from message id assuming i have it?Could you help me?. We have caching enabled on the mysql auth queries too and the mysql server is not hosted on the same box as EMQTT node. FYI. will check iotop and get back.. please refer to the iotop command output.\n\nThere are two processes writing to disk.Both are of emqtt process.May i know what is this process with TID 23164 which is writing to disk?\n. ",
    "bradleyd": "I am seeing the same issue here in 2.3.5.  On line 309 src/emqttd_rest_api.erl Broker is {error,nodedown}.  Feel like this is treating the symptom more than the cause, but maybe a better match in function head here? . Now that I have been looking at it more closely. I have a strange node because in the mix.  The ip range is k8s, but nothing is exposed on that IP..strange.. I killed my local epmd and restarted.  The errors went away if because the node from earlier sessions was gone.  Hope that helps @venks-warrior . ",
    "codebeautiful": "Just I also appear this problem, is finally found my own redis server unable to join, then put the redis service after restart this information will not print, don't know your problem said this reason, hope to help you.. ",
    "MyraBaba": "Terminated for {shutdown,closed} is a real pain..\nI am trying to use qmqtt from Qt thread and want to re-connect if disconnected (server restart - network problem etc). When thread try to re-connect its always get:\nTerminated for {shutdown,closed}\nTerminated for {shutdown,closed}\nTerminated for {shutdown,closed}\nTerminated for {shutdown,closed}\nTerminated for {shutdown,closed}\nany idea ? . quite forget the reason I changed the version emqtd 2.x to solve problem.\nI am connecting with Qt official qmqtt plugin. \nis therea good reason to upgrade to emqx ?. :)\n\u0130s it working with Qt qmqtt client ?\nThx\n\nOn 26 Dec 2018, at 11:15, Gilbert notifications@github.com wrote:\nMore features, More stable , better performance :p \nGilbert Wong \nOn Dec 26, 2018, 4:08 PM +0800, MyraBaba notifications@github.com, wrote: \nquite forget the reason I changed the version emqtd 2.x to solve problem. \nI am connecting with Qt official qmqtt plugin. \nis therea good reason to upgrade to emqx ? \n\u2014 \nYou are receiving this because you were assigned. \nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/1357#issuecomment-449925800, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATh-035cL2FVKAchbYrEZfsDht6Wcvh-ks5u8y6FgaJpZM4Qs-SQ. \n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub https://github.com/emqx/emqx/issues/1357#issuecomment-449926876, or mute the thread https://github.com/notifications/unsubscribe-auth/AQscnx5K3qkGdq3yI7Ul51hHsdSADmhnks5u8zA_gaJpZM4Qs-SQ.\n\n\n. Thanks a lot.\nWe mainly using the rabbitMq but recently we want to give a shot to the emqtt. We love mqtt.\nOnly feature that we need a queue in system. like in the rabbitmq. I know it could be against to the emqtt idea.\nIs there any such feature ; keep the mesaages in the emqtt until somebody receive it?\nthanks again.\n. Thanks..\nis it removing the item if any subscriber took it , or it will keep all queue and any new subscriber get the full history ?\nthx.\n. I think this is \ud83d\udc4d \n```\nMax queue length. Enqueued messages when persistent client disconnected,\nor inflight window is full.\nmqtt.mqueue.max_length = infinity\n```\nSo if the client persistent and lost the connection emq enqueing until client come back. \nI didnt fount the clean session  = false config item in emq.conf. Dear @tigercl \nWhat I was found that message size limit was the problem so I increased the allowed message size than all is ok now.\nBest wishes for you. Hi,\nI am using emqtd 2.2 and now testing emqx also. The difference is emqx is shoutdown the client after little longer time later.\nClient code : (using the Qt qmqtt  client)\n    \nc_client = new QMqttClient(this);\n    qDebug() << \"CENTRAL connecting.....\" << endl;\n    c_client->setHostname(hostname);\n    c_client->setPort(1883);\n    c_client->setClientId(\"client-01\");\n    c_client->setUsername(ui->usernameMqtt->text());\n    c_client->setPassword(ui->passwordMqtt->text());\n    c_client->setCleanSession(false);\n    c_client->setKeepAlive(600);\nsubscription code : \nauto subscription = c_client->subscribe(MqttUserName);\n\nauto subscription_enrollment_result = c_client->subscribe(enrollment_result_topic , 2);\n\nauto subscription_raspi_publisher = c_client->subscribe(ui->raspiPublisher->text() , 2);\n\n```\n```\nI am  also attaching the emqt.conf . below\nWhat we are trying to do sending images to the between clients . they are about 10KB to 100KB in size.\nexpecting 5img/sec to 10 img/sec around\n`##====================================================================\nEMQ Configuration R2\n====================================================================\n--------------------------------------------------------------------\nCluster\n--------------------------------------------------------------------\nCluster name.\ncluster.name = emqcl\nCluster auto-discovery strategy.\n\nValue: Enum\n- manual: Manual join command\n- static: Static node list\n- mcast:  IP Multicast\n- dns:    DNS A Record\n- etcd:   etcd\n- k8s:    Kubernates\n\nDefault: manual\ncluster.discovery = manual\nEnable cluster autoheal from network partition.\n\nValue: on | off\n\nDefault: on\ncluster.autoheal = on\nAutoclean down node. A down node will be removed from the cluster\nif this value > 0.\n\nValue: Duration\n-h: hour, e.g. '2h' for 2 hours\n-m: minute, e.g. '5m' for 5 minutes\n-s: second, e.g. '30s' for 30 seconds\n\nDefault: 5m\ncluster.autoclean = 5m\n--------------------------------------------------------------------\nCluster using static node list\nNode list of the cluster.\n\nValue: String\ncluster.static.seeds = emq1@127.0.0.1,emq2@127.0.0.1\n--------------------------------------------------------------------\nCluster using IP Multicast.\nIP Multicast Address.\n\nValue: IP Address\ncluster.mcast.addr = 239.192.0.1\nMulticast Ports.\n\nValue: Port List\ncluster.mcast.ports = 4369,4370\nMulticast Iface.\n\nValue: Iface Address\n\nDefault: 0.0.0.0\ncluster.mcast.iface = 0.0.0.0\nMulticast Ttl.\n\nValue: 0-255\ncluster.mcast.ttl = 255\nMulticast loop.\n\nValue: on | off\ncluster.mcast.loop = on\n--------------------------------------------------------------------\nCluster using DNS A records.\nDNS name.\n\nValue: String\ncluster.dns.name = localhost\nThe App name is used to build 'node.name' with IP address.\n\nValue: String\ncluster.dns.app = emq\n--------------------------------------------------------------------\nCluster using etcd\nEtcd server list, seperated by ','.\n\nValue: String\ncluster.etcd.server = http://127.0.0.1:2379\nThe prefix helps build nodes path in etcd. Each node in the cluster\nwill create a path in etcd: v2/keys///\n\nValue: String\ncluster.etcd.prefix = emqcl\nThe TTL for node's path in etcd.\n\nValue: Duration\n\nDefault: 1m, 1 minute\ncluster.etcd.node_ttl = 1m\n--------------------------------------------------------------------\nCluster using Kubernates\nKubernates API server list, seperated by ','.\n\nValue: String\ncluster.k8s.apiserver = http://10.110.111.204:8080\nThe service name helps lookup EMQ nodes in the cluster.\n\nValue: String\ncluster.k8s.service_name = emq\nThe address type is used to extract host from k8s service.\n\nValue: ip | dns\ncluster.k8s.address_type = ip\nThe app name helps build 'node.name'.\n\nValue: String\ncluster.k8s.app_name = emq\n--------------------------------------------------------------------\nNode Args\n--------------------------------------------------------------------\nNode name.\n\nSee: http://erlang.org/doc/reference_manual/distributed.html\n\nValue: @\n\nDefault: emq@127.0.0.1\nnode.name = emq@127.0.0.1\nCookie for distributed node communication.\n\nValue: String\nnode.cookie = emqsecretcookie\nEnable SMP support of Erlang VM.\n\nValue: enable | auto | disable\nnode.smp = auto\nHeartbeat monitoring of an Erlang runtime system. Comment the line to disable\nheartbeat, or set the value as 'on'\n\nValue: on\n\nvm.args: -heart\nnode.heartbeat = on\nEnable kernel poll.\n\nValue: on | off\n\nDefault: on\nnode.kernel_poll = on\nSets the number of threads in async thread pool. Valid range is 0-1024.\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: 0-1024\n\nvm.args: +A Number\nnode.async_threads = 32\nSets the maximum number of simultaneously existing processes for this\nsystem if a Number is passed as value.\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: Number [1024-134217727]\n\nvm.args: +P Number\nnode.process_limit = 856000\nSets the maximum number of simultaneously existing ports for this system\nif a Number is passed as value.\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: Number [1024-134217727]\n\nvm.args: +Q Number\nnode.max_ports = 65536\nSet the distribution buffer busy limit (dist_buf_busy_limit).\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: Number [1KB-2GB]\n\nvm.args: +zdbbl size\nnode.dist_buffer_size = 8MB\nSets the maximum number of ETS tables. Note that mnesia and SSL will\ncreate temporary ETS tables.\n\nValue: Number\n\nvm.args: +e Number\nnode.max_ets_tables = 256000\nTweak GC to run more often.\n\nValue: Number [0-65535]\n\nvm.args: -env ERL_FULLSWEEP_AFTER Number\nnode.fullsweep_after = 1000\nCrash dump log file.\n\nValue: Log file\nnode.crash_dump = log/crash.dump\nSpecify the erlang distributed protocol.\n\nValue: Enum\n- inet_tcp: the default; handles TCP streams with IPv4 addressing.\n- inet6_tcp: handles TCP with IPv6 addressing.\n- inet_tls: using TLS for Erlang Distribution.\n\nvm.args: -proto_dist inet_tcp\nnode.proto_dist = inet_tcp\nSpecify SSL Options in the file if using SSL for Erlang Distribution.\n\nValue: File\n\nvm.args: -ssl_dist_optfile \nnode.ssl_dist_optfile = etc/ssl_dist.conf\nSets the net_kernel tick time. TickTime is specified in seconds.\nNotice that all communicating nodes are to have the same TickTime\nvalue specified.\n\nSee: http://www.erlang.org/doc/man/kernel_app.html#net_ticktime\n\nValue: Number\n\nvm.args: -kernel net_ticktime Number\nnode.dist_net_ticktime = 60\nSets the port range for the listener socket of a distributed Erlang node.\nNote that if there are firewalls between clustered nodes, this port segment\nfor nodes\u2019 communication should be allowed.\n\nSee: http://www.erlang.org/doc/man/kernel_app.html\n\nValue: Port [1024-65535]\nnode.dist_listen_min = 6369\nnode.dist_listen_max = 6379\n--------------------------------------------------------------------\nLog\n--------------------------------------------------------------------\nSets the log dir.\n\nValue: Folder\nlog.dir = log\nWhere to emit the console logs.\n\nValue: off | file | console | both\n- off: disabled\n- file: write to file\n- console: write to stdout\n- both: file and stdout\nlog.console = console\nSets the severity level of console log.\n\nValue: debug | info | notice | warning | error | critical | alert | emergency\n\nDefault: error\nlog.console.level = info\nThe file where console logs will be writed to, when 'log.console' is set as 'file'.\n\nValue: File Name\nlog.console.file = log/console.log\nMaximum file size for console log.\n\nValue: Number(bytes)\nlog.console.size = 10485760\nThe rotation count for console log.\n\nValue: Number\nlog.console.count = 5\nThe file where info logs will be writed to.\n\nValue: File Name\nlog.info.file = log/info.log\nMaximum file size for info log.\n\nValue: Number(bytes)\nlog.info.size = 10485760\nThe rotation count for info log.\n\nValue: Number\nlog.info.count = 5\nThe file where error logs will be writed to.\n\nValue: File Name\nlog.error.file = log/error.log\nMaximum file size for error log.\n\nValue: Number(bytes)\nlog.error.size = 10485760\nThe rotation count for error log.\n\nValue: Number\nlog.error.count = 5\nEnable the crash log.\n\nValue: on | off\nlog.crash = on\nThe file for crash log.\n\nValue: File Name\nlog.crash.file = log/crash.log\nEnable syslog.\n\nValues: on | off\nlog.syslog = on\nSets the severity level for syslog.\n\nValue: debug | info | notice | warning | error | critical | alert | emergency\nlog.syslog.level = error\n--------------------------------------------------------------------\nAllow Anonymous Authentication and Default ACL\n--------------------------------------------------------------------\nAllow Anonymous Authentication.\n\nNotice: Disable the option for production deployment.\n\nValue: true | false\nmqtt.allow_anonymous = false\nDefault behaviour when ACL nomatch.\n\nValue: allow | deny\nmqtt.acl_nomatch = allow\nDefault ACL File.\n\nValue: File Name\nmqtt.acl_file = etc/acl.conf\nWhether to cache ACL for publish messages.\n\nValue: true | false\nmqtt.cache_acl = true\n--------------------------------------------------------------------\nMQTT Protocol\n--------------------------------------------------------------------\nMaximum length of MQTT clientId allowed.\n\nValue: Number [23-65535]\nmqtt.max_clientid_len = 1024\nMaximum MQTT packet size allowed.\n\nValue: Bytes\n\nDefault: 64K\nmqtt.max_packet_size = 808KB\nCheck if the websocket protocol header is valid.\nTurn off the option when developing WeChat App.\n\nValue: on | off\nmqtt.websocket_protocol_header = on\nThe backoff for MQTT keepalive timeout.\nEMQ will kick a MQTT connection out until 'Keepalive * backoff * 2' timeout.\n\nValue: Float > 0.5\nmqtt.keepalive_backoff = 0.75\n--------------------------------------------------------------------\nMQTT Connection\n--------------------------------------------------------------------\nForce GC the MQTT connections. Value 0 will disable the Force GC.\n\nValue: Number >= 0\nmqtt.conn.force_gc_count = 100\n--------------------------------------------------------------------\nMQTT Client\n--------------------------------------------------------------------\nMQTT client idle timeout, specified in seconds.\n\nValue: Duration\nmqtt.client.idle_timeout = 90s\nTODO: Maximum publish rate of MQTT messages per second.\n\nValue: Number\nmqtt.client.max_publish_rate = 50\nEnable per client statistics.\n\nValue:  on | off\nmqtt.client.enable_stats = off\n--------------------------------------------------------------------\nMQTT Session\n--------------------------------------------------------------------\nMaximum number of subscriptions allowed, 0 means no limit.\n\nValue: Number\nmqtt.session.max_subscriptions = 0\nForce to upgrade QoS according to subscription.\n\nValue: on | off\nmqtt.session.upgrade_qos = off\nMaximum size of the Inflight Window storing QoS1/2 messages delivered but unacked.\n\nValue: Number\nmqtt.session.max_inflight = 128\nRetry interval for QoS1/2 message delivering.\n\nValue: Duration\nmqtt.session.retry_interval = 20s\nMaximum QoS2 packets (Client -> Broker) awaiting PUBREL, 0 means no limit.\n\nValue: Number\nmqtt.session.max_awaiting_rel = 1000\nThe QoS2 messages (Client -> Broker) will be dropped if awaiting PUBREL timeout.\n\nValue: Duration\nmqtt.session.await_rel_timeout = 300s\nEnable per session statistics.\n\nValue: on | off\nmqtt.session.enable_stats = on\nSession expiration time.\n\nValue: Duration\n-d: day\n-h: hour\n-m: minute\n-s: second\n\nDefault: 2h, 2 hours\nmqtt.session.expiry_interval = 2h\nWhether to ignore loop delivery of messages.\n\nValue: true | false\n\nDefault: false\nmqtt.session.ignore_loop_deliver = false\n--------------------------------------------------------------------\nMQTT Message Queue\n--------------------------------------------------------------------\nMessage queue type.\n\nValue: simple | priority\nmqtt.mqueue.type = simple\nTopic priority. Default is 0.\n\nValue: Number [0-255]\n\nmqtt.mqueue.priority = topic/1=10,topic/2=8\nMaximum queue length. Enqueued messages when persistent client disconnected,\nor inflight window is full. 0 means no limit.\n\nValue: Number >= 0\nmqtt.mqueue.max_length = 1000\nLow-water mark of queued messages.\n\nValue: Percent\nmqtt.mqueue.low_watermark = 20%\nHigh-water mark of queued messages.\n\nValue: Percent\nmqtt.mqueue.high_watermark = 60%\nWhether to enqueue Qos0 messages.\n\nValue: false | true\nmqtt.mqueue.store_qos0 = true\n--------------------------------------------------------------------\nMQTT Broker and PubSub\n--------------------------------------------------------------------\nSystem interval of publishing $SYS messages.\n\nValue: Duration\n\nDefault: 1m, 1 minute\nmqtt.broker.sys_interval = 1m\nThe PubSub pool size. Default value should be same as scheduler numbers.\n\nValue: Number > 1\nmqtt.pubsub.pool_size = 8\nTODO: Subscribe asynchronously.\n\nValue: true | false\nmqtt.pubsub.async = true\n--------------------------------------------------------------------\nMQTT Bridge\n--------------------------------------------------------------------\nThe pending message queue size of bridge.\n\nValue: Number\nmqtt.bridge.max_queue_len = 10000\nPing interval of bridge node.\n\nValue: Duration\n\nDefault: 1s, 1 second\nmqtt.bridge.ping_down_interval = 1s\n-------------------------------------------------------------------\nMQTT Plugins\n-------------------------------------------------------------------\nThe etc dir for plugins' config.\n\nValue: Folder\nmqtt.plugins.etc_dir =etc/plugins/\nThe file to store loaded plugin names.\n\nValue: File\nmqtt.plugins.loaded_file = data/loaded_plugins\n--------------------------------------------------------------------\nMQTT Listeners\n--------------------------------------------------------------------\n--------------------------------------------------------------------\nMQTT/TCP - External TCP Listener for MQTT Protocol\nlistener.tcp. is the IP address and port that the MQTT/TCP\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 1883, 127.0.0.1:1883, ::1:1883\nlistener.tcp.external = 0.0.0.0:1883\nThe acceptor pool for external MQTT/TCP listener.\n\nValue: Number\nlistener.tcp.external.acceptors = 16\nMaximum number of concurrent MQTT/TCP connections.\n\nValue: Number\nlistener.tcp.external.max_clients = 102400\nTODO: Zone of the external MQTT/TCP listener belonged to.\n\nValue: String\nlistener.tcp.external.zone = external\nMountpoint of the MQTT/TCP Listener. All the topics of this\nlistener will be prefixed with the mount point if this option\nis enabled.\n\nValue: String\nlistener.tcp.external.mountpoint = external/\nRate limit for the external MQTT/TCP connections.\nFormat is 'burst,rate'.\n\nValue: burst,rate\nUnit: KB/sec\nlistener.tcp.external.rate_limit = 100,10\nThe access control rules for the MQTT/TCP listener.\n\nSee: https://github.com/emqtt/esockd#allowdeny\n\nValue: ACL Rule\n\nExample: allow 192.168.0.0/24\nlistener.tcp.external.access.1 = allow all\nEnable the Proxy Protocol V1/2 if the EMQ cluster is deployed\nbehind HAProxy or Nginx.\n\nSee: https://www.haproxy.com/blog/haproxy/proxy-protocol/\n\nValue: on | off\nlistener.tcp.external.proxy_protocol = on\nSets the timeout for proxy protocol. EMQ will close the TCP connection\nif no proxy protocol packet recevied within the timeout.\n\nValue: Duration\nlistener.tcp.external.proxy_protocol_timeout = 3s\nEnable the option for X.509 certificate based authentication.\nEMQ will Use the PP2_SUBTYPE_SSL_CN field in Proxy Protocol V2\nas MQTT username.\n\nValue: cn\nlistener.tcp.external.peer_cert_as_username = cn\nThe TCP backlog defines the maximum length that the queue of pending\nconnections can grow to.\n\nValue: Number >= 0\nlistener.tcp.external.backlog = 1024\nThe TCP send timeout for external MQTT connections.\n\nValue: Duration\nlistener.tcp.external.send_timeout = 15s\nClose the TCP connection if send timeout.\n\nValue: on | off\nlistener.tcp.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for MQTT connections.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.external.recbuf = 4KB\nThe TCP send buffer(os kernel) for MQTT connections.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.external.sndbuf = 4KB\nThe size of the user-level software buffer used by the driver.\nNot to be confused with options sndbuf and recbuf, which correspond\nto the Kernel socket buffers. It is recommended to have val(buffer)\n>= max(val(sndbuf),val(recbuf)) to avoid performance issues because\nof unnecessary copying. val(buffer) is automatically set to the above\nmaximum when values sndbuf or recbuf are set.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.external.buffer = 4KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nValue: on | off\nlistener.tcp.external.tune_buffer = off\nThe TCP_NODELAY flag for MQTT connections. Small amounts of data are\nsent immediately if the option is enabled.\n\nValue: true | false\nlistener.tcp.external.nodelay = true\nThe SO_REUSEADDR flag for TCP listener.\n\nValue: true | false\nlistener.tcp.external.reuseaddr = true\n--------------------------------------------------------------------\nInternal TCP Listener for MQTT Protocol\nThe IP address and port that the internal MQTT/TCP protocol listener\nwill bind.\n\nValue: IP:Port, Port\n\nExamples: 11883, 127.0.0.1:11883, ::1:11883\nlistener.tcp.internal = 127.0.0.1:11883\nThe acceptor pool for internal MQTT/TCP listener.\n\nValue: Number\nlistener.tcp.internal.acceptors = 8\nMaximum number of concurrent MQTT/TCP connections.\n\nValue: Number\nlistener.tcp.internal.max_clients = 102400\nTODO: Zone of the internal MQTT/TCP listener belonged to.\n\nValue: String\nlistener.tcp.internal.zone = internal\nMountpoint of the MQTT/TCP Listener.\n\nSee: listener.tcp..mountpoint\n\nValue: String\nlistener.tcp.internal.mountpoint = internal/\nRate limit for the internal MQTT/TCP connections.\n\nSee: listener.tcp..rate_limit\n\nValue: burst,rate\nlistener.tcp.internal.rate_limit = 1000,100\nThe TCP backlog of internal MQTT/TCP Listener.\n\nSee: listener.tcp..backlog\n\nValue: Number >= 0\nlistener.tcp.internal.backlog = 512\nThe TCP send timeout for internal MQTT connections.\n\nSee: listener.tcp..send_timeout\n\nValue: Duration\nlistener.tcp.internal.send_timeout = 5s\nClose the MQTT/TCP connection if send timeout.\n\nSee: listener.tcp..send_timeout_close\n\nValue: on | off\nlistener.tcp.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for internal MQTT connections.\n\nSee: listener.tcp..recbuf\n\nValue: Bytes\nlistener.tcp.internal.recbuf = 16KB\nThe TCP send buffer(os kernel) for internal MQTT connections.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.internal.sndbuf = 16KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp..buffer\n\nValue: Bytes\nlistener.tcp.internal.buffer = 16KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nSee: listener.tcp..tune_buffer\n\nValue: on | off\nlistener.tcp.internal.tune_buffer = off\nThe TCP_NODELAY flag for internal MQTT connections.\n\nSee: listener.tcp..nodelay\n\nValue: true | false\nlistener.tcp.internal.nodelay = false\nThe SO_REUSEADDR flag for MQTT/TCP Listener.\n\nValue: true | false\nlistener.tcp.internal.reuseaddr = true\n--------------------------------------------------------------------\nMQTT/SSL - External SSL Listener for MQTT Protocol\nlistener.ssl. is the IP address and port that the MQTT/SSL\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 8883, 127.0.0.1:8883, ::1:8883\nlistener.ssl.external = 8883\nThe acceptor pool for external MQTT/SSL listener.\n\nValue: Number\nlistener.ssl.external.acceptors = 16\nMaximum number of concurrent MQTT/SSL connections.\n\nValue: Number\nlistener.ssl.external.max_clients = 1024\nTODO: Zone of the external MQTT/SSL listener belonged to.\n\nValue: String\nlistener.ssl.external.zone = external\nMountpoint of the MQTT/SSL Listener.\n\nValue: String\nlistener.ssl.external.mountpoint = inbound/\nThe access control rules for the MQTT/SSL listener.\n\nSee: listener.tcp..access\n\nValue: ACL Rule\nlistener.ssl.external.access.1 = allow all\nRate limit for the external MQTT/SSL connections.\n\nValue: burst,rate\nlistener.ssl.external.rate_limit = 100,10\nEnable the Proxy Protocol V1/2 if the EMQ cluster is deployed behind\nHAProxy or Nginx.\n\nSee: listener.tcp..proxy_protocol\n\nValue: on | off\nlistener.ssl.external.proxy_protocol = on\nSets the timeout for proxy protocol.\n\nSee: listener.tcp..proxy_protocol_timeout\n\nValue: Duration\nlistener.ssl.external.proxy_protocol_timeout = 3s\nTLS versions only to protect from POODLE attack.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: String, seperated by ','\nlistener.ssl.external.tls_versions = tlsv1.2,tlsv1.1,tlsv1\nTLS Handshake timeout.\n\nValue: Duration\nlistener.ssl.external.handshake_timeout = 15s\nPath to the file containing the user's private PEM-encoded key.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: File\nlistener.ssl.external.keyfile = etc/certs/key.pem\nPath to a file containing the user certificate.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: File\nlistener.ssl.external.certfile = etc/certs/cert.pem\nPath to the file containing PEM-encoded CA certificates. The CA certificates\nare used during server authentication and when building the client certificate chain.\n\nValue: File\nlistener.ssl.external.cacertfile = etc/certs/cacert.pem\nThe Ephemeral Diffie-Helman key exchange is a very effective way of\nensuring Forward Secrecy by exchanging a set of keys that never hit\nthe wire. Since the DH key is effectively signed by the private key,\nit needs to be at least as strong as the private key. In addition,\nthe default DH groups that most of the OpenSSL installations have\nare only a handful (since they are distributed with the OpenSSL\npackage that has been built for the operating system it\u2019s running on)\nand hence predictable (not to mention, 1024 bits only).\nIn order to escape this situation, first we need to generate a fresh,\nstrong DH group, store it in a file and then use the option above,\nto force our SSL application to use the new DH group. Fortunately,\nOpenSSL provides us with a tool to do that. Simply run:\nopenssl dhparam -out dh-params.pem 2048\n\nValue: File\nlistener.ssl.external.dhfile = etc/certs/dh-params.pem\nA server only does x509-path validation in mode verify_peer,\nas it then sends a certificate request to the client (this\nmessage is not sent if the verify option is verify_none).\nYou can then also want to specify option fail_if_no_peer_cert.\nMore information at: http://erlang.org/doc/man/ssl.html\n\nValue: verify_peer | verify_none\nlistener.ssl.external.verify = verify_peer\nUsed together with {verify, verify_peer} by an SSL server. If set to true,\nthe server fails if the client does not have a certificate to send, that is,\nsends an empty certificate.\n\nValue: true | false\nlistener.ssl.external.fail_if_no_peer_cert = true\nThis is the single most important configuration option of an Erlang SSL\napplication. Ciphers (and their ordering) define the way the client and\nserver encrypt information over the wire, from the initial Diffie-Helman\nkey exchange, the session key encryption ## algorithm and the message\ndigest algorithm. Selecting a good cipher suite is critical for the\napplication\u2019s data security, confidentiality and performance.\n\nThe cipher list above offers:\n\nA good balance between compatibility with older browsers.\nIt can get stricter for Machine-To-Machine scenarios.\nPerfect Forward Secrecy.\nNo old/insecure encryption and HMAC algorithms\n\nMost of it was copied from Mozilla\u2019s Server Side TLS article\n\nValue: Ciphers\nlistener.ssl.external.ciphers = ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384,ECDHE-ECDSA-AES256-SHA384,ECDHE-RSA-AES256-SHA384,ECDHE-ECDSA-DES-CBC3-SHA,ECDH-ECDSA-AES256-GCM-SHA384,ECDH-RSA-AES256-GCM-SHA384,ECDH-ECDSA-AES256-SHA384,ECDH-RSA-AES256-SHA384,DHE-DSS-AES256-GCM-SHA384,DHE-DSS-AES256-SHA256,AES256-GCM-SHA384,AES256-SHA256,ECDHE-ECDSA-AES128-GCM-SHA256,ECDHE-RSA-AES128-GCM-SHA256,ECDHE-ECDSA-AES128-SHA256,ECDHE-RSA-AES128-SHA256,ECDH-ECDSA-AES128-GCM-SHA256,ECDH-RSA-AES128-GCM-SHA256,ECDH-ECDSA-AES128-SHA256,ECDH-RSA-AES128-SHA256,DHE-DSS-AES128-GCM-SHA256,DHE-DSS-AES128-SHA256,AES128-GCM-SHA256,AES128-SHA256,ECDHE-ECDSA-AES256-SHA,ECDHE-RSA-AES256-SHA,DHE-DSS-AES256-SHA,ECDH-ECDSA-AES256-SHA,ECDH-RSA-AES256-SHA,AES256-SHA,ECDHE-ECDSA-AES128-SHA,ECDHE-RSA-AES128-SHA,DHE-DSS-AES128-SHA,ECDH-ECDSA-AES128-SHA,ECDH-RSA-AES128-SHA,AES128-SHA\nSSL parameter renegotiation is a feature that allows a client and a server\nto renegotiate the parameters of the SSL connection on the fly.\nRFC 5746 defines a more secure way of doing this. By enabling secure renegotiation,\nyou drop support for the insecure renegotiation, prone to MitM attacks.\n\nValue: on | off\nlistener.ssl.external.secure_renegotiate = off\nA performance optimization setting, it allows clients to reuse\npre-existing sessions, instead of initializing new ones.\nRead more about it here.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: on | off\nlistener.ssl.external.reuse_sessions = on\nAn important security setting, it forces the cipher to be set based\non the server-specified order instead of the client-specified order,\nhence enforcing the (usually more properly configured) security\nordering of the server administrator.\n\nValue: on | off\nlistener.ssl.external.honor_cipher_order = on\nUse the CN or DN value from the client certificate as a username.\nNotice that 'verify' should be set as 'verify_peer'.\n\nValue: cn | dn\nlistener.ssl.external.peer_cert_as_username = cn\nTCP backlog for the SSL connection.\n\nSee listener.tcp..backlog\n\nValue: Number >= 0\nlistener.ssl.external.backlog = 1024\nThe TCP send timeout for the SSL connection.\n\nSee listener.tcp..send_timeout\n\nValue: Duration\nlistener.ssl.external.send_timeout = 15s\nClose the SSL connection if send timeout.\n\nSee: listener.tcp..send_timeout_close\n\nValue: on | off\nlistener.ssl.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for the SSL connections.\n\nSee: listener.tcp..recbuf\n\nValue: Bytes\nlistener.ssl.external.recbuf = 4KB\nThe TCP send buffer(os kernel) for internal MQTT connections.\n\nSee: listener.tcp..sndbuf\n\nValue: Bytes\nlistener.ssl.external.sndbuf = 4KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp..buffer\n\nValue: Bytes\nlistener.ssl.external.buffer = 4KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nSee: listener.tcp..tune_buffer\n\nValue: on | off\nlistener.ssl.external.tune_buffer = off\nThe TCP_NODELAY flag for SSL connections.\n\nSee: listener.tcp..nodelay\n\nValue: true | false\nlistener.ssl.external.nodelay = true\nThe SO_REUSEADDR flag for MQTT/SSL Listener.\n\nValue: true | false\nlistener.ssl.external.reuseaddr = true\n--------------------------------------------------------------------\nExternal WebSocket Listener for MQTT Protocol\nlistener.ws. is the IP address and port that the MQTT/WebSocket\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 8083, 127.0.0.1:8083, ::1:8083\nlistener.ws.external = 8083\nThe acceptor pool for external MQTT/WebSocket listener.\n\nValue: Number\nlistener.ws.external.acceptors = 4\nMaximum number of concurrent MQTT/WebSocket connections.\n\nValue: Number\nlistener.ws.external.max_clients = 102400\nTODO: Zone of the external MQTT/WebSocket listener belonged to.\n\nValue: String\nlistener.ws.external.zone = external\nMountpoint of the MQTT/WebSocket Listener.\n\nSee: listener.tcp..mountpoint\n\nValue: String\nlistener.ws.external.mountpoint = external/\nThe access control for the MQTT/WebSocket listener.\n\nSee: listener.tcp..access\n\nValue: ACL Rule\nlistener.ws.external.access.1 = allow all\nUse X-Forwarded-For header for real source IP if the EMQ cluster is\ndeployed behind NGINX or HAProxy.\n\nValue: String\nlistener.ws.external.proxy_address_header = X-Forwarded-For\nUse X-Forwarded-Port header for real source port if the EMQ cluster is\ndeployed behind NGINX or HAProxy.\n\nValue: String\nlistener.ws.external.proxy_port_header = X-Forwarded-Port\nEnable the Proxy Protocol V1/2 if the EMQ cluster is deployed behind\nHAProxy or Nginx.\n\nSee: listener.tcp..proxy_protocol\n\nValue: on | off\nlistener.ws.external.proxy_protocol = on\nSets the timeout for proxy protocol.\n\nSee: listener.tcp..proxy_protocol_timeout\n\nValue: Duration\nlistener.ws.external.proxy_protocol_timeout = 3s\nThe TCP backlog of external MQTT/WebSocket Listener.\n\nSee: listener.tcp..backlog\n\nValue: Number >= 0\nlistener.ws.external.backlog = 1024\nThe TCP send timeout for external MQTT/WebSocket connections.\n\nSee: listener.tcp..send_timeout\n\nValue: Duration\nlistener.ws.external.send_timeout = 15s\nClose the MQTT/WebSocket connection if send timeout.\n\nSee: listener.tcp..send_timeout_close\n\nValue: on | off\nlistener.ws.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for external MQTT/WebSocket connections.\n\nSee: listener.tcp..recbuf\n\nValue: Bytes\nlistener.ws.external.recbuf = 4KB\nThe TCP send buffer(os kernel) for external MQTT/WebSocket connections.\n\nSee: listener.tcp..sndbuf\n\nValue: Bytes\nlistener.ws.external.sndbuf = 4KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp..buffer\n\nValue: Bytes\nlistener.ws.external.buffer = 4KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nSee: listener.tcp..tune_buffer\n\nValue: on | off\nlistener.ws.external.tune_buffer = off\nThe TCP_NODELAY flag for external MQTT/WebSocket connections.\n\nSee: listener.tcp..nodelay\n\nValue: true | false\nlistener.ws.external.nodelay = true\nThe SO_REUSEADDR flag for MQTT/WebSocket Listener.\n\nValue: true | false\nlistener.ws.external.reuseaddr = true\n--------------------------------------------------------------------\nExternal WebSocket/SSL listener for MQTT Protocol\nlistener.wss. is the IP address and port that the MQTT/WebSocket/SSL\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 8084, 127.0.0.1:8084, ::1:8084\nlistener.wss.external = 8084\nThe acceptor pool for external MQTT/WebSocket/SSL listener.\n\nValue: Number\nlistener.wss.external.acceptors = 4\nMaximum number of concurrent MQTT/Webwocket/SSL connections.\n\nValue: Number\nlistener.wss.external.max_clients = 64\nTODO: Zone of the external MQTT/WebSocket/SSL listener belonged to.\n\nValue: String\nlistener.wss.external.zone = external\nMountpoint of the MQTT/WebSocket/SSL Listener.\n\nSee: listener.tcp..mountpoint\n\nValue: String\nlistener.wss.external.mountpoint = inbound/\nThe access control rules for the MQTT/WebSocket/SSL listener.\n\nSee: listener.tcp..access.\n\nValue: ACL Rule\nlistener.wss.external.access.1 = allow all\nSee: listener.ws.external.proxy_address_header\n\nValue: String\nlistener.wss.external.proxy_address_header = X-Forwarded-For\nSee: listener.ws.external.proxy_port_header\n\nValue: String\nlistener.wss.external.proxy_port_header = X-Forwarded-Port\nEnable the Proxy Protocol V1/2 support.\n\nSee: listener.tcp..proxy_protocol\n\nValue: on | off\nlistener.wss.external.proxy_protocol = on\nSets the timeout for proxy protocol.\n\nSee: listener.tcp..proxy_protocol_timeout\n\nValue: Duration\nlistener.wss.external.proxy_protocol_timeout = 3s\nTLS versions only to protect from POODLE attack.\n\nSee: listener.ssl..tls_versions\n\nValue: String, seperated by ','\nlistener.wss.external.tls_versions = tlsv1.2,tlsv1.1,tlsv1\nTLS Handshake timeout.\n\nSee: listener.ssl..handshake_timeout\n\nValue: Duration\nlistener.wss.external.handshake_timeout = 15s\nPath to the file containing the user's private PEM-encoded key.\n\nSee: listener.ssl..keyfile\n\nValue: File\nlistener.wss.external.keyfile = etc/certs/key.pem\nPath to a file containing the user certificate.\n\nSee: listener.ssl..certfile\n\nValue: File\nlistener.wss.external.certfile = etc/certs/cert.pem\nPath to the file containing PEM-encoded CA certificates.\n\nSee: listener.ssl..cacert\n\nValue: File\nlistener.wss.external.cacertfile = etc/certs/cacert.pem\nSee: listener.ssl..dhfile\n\nValue: File\nlistener.ssl.external.dhfile = etc/certs/dh-params.pem\nSee: listener.ssl..vefify\n\nValue: vefify_peer | verify_none\nlistener.wss.external.verify = verify_peer\nSee: listener.ssl..fail_if_no_peer_cert\n\nValue: false | true\nlistener.wss.external.fail_if_no_peer_cert = true\nSee: listener.ssl..ciphers\n\nValue: Ciphers\nlistener.wss.external.ciphers =\nSee: listener.ssl..secure_renegotiate\n\nValue: on | off\nlistener.wss.external.secure_renegotiate = off\nSee: listener.ssl..reuse_sessions\n\nValue: on | off\nlistener.wss.external.reuse_sessions = on\nSee: listener.ssl..honor_cipher_order\n\nValue: on | off\nlistener.wss.external.honor_cipher_order = on\nSee: listener.ssl..peer_cert_as_username\n\nValue: cn | dn\nlistener.wss.external.peer_cert_as_username = cn\nTCP backlog for the WebSocket/SSL connection.\n\nSee listener.tcp..backlog\n\nValue: Number >= 0\nlistener.wss.external.backlog = 1024\nThe TCP send timeout for the WebSocket/SSL connection.\n\nSee: listener.tcp..send_timeout\n\nValue: Duration\nlistener.wss.external.send_timeout = 15s\nClose the WebSocket/SSL connection if send timeout.\n\nSee: listener.tcp..send_timeout_close\n\nValue: on | off\nlistener.wss.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for the WebSocket/SSL connections.\n\nSee: listener.tcp..recbuf\n\nValue: Bytes\nlistener.wss.external.recbuf = 4KB\nThe TCP send buffer(os kernel) for the WebSocket/SSL connections.\n\nSee: listener.tcp..sndbuf\n\nValue: Bytes\nlistener.wss.external.sndbuf = 4KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp..buffer\n\nValue: Bytes\nlistener.wss.external.buffer = 4KB\nThe TCP_NODELAY flag for WebSocket/SSL connections.\n\nSee: listener.tcp..nodelay\n\nValue: true | false\nlistener.wss.external.nodelay = true\nThe SO_REUSEADDR flag for WebSocket/SSL listener.\n\nValue: true | false\nlistener.wss.external.reuseaddr = true\n--------------------------------------------------------------------\nHTTP Management API Listener\nThe IP Address and Port that the EMQ HTTP API will bind.\n\nValue: IP:Port | Port\n\nDefault: 0.0.0.0:8080\nlistener.api.mgmt = 0.0.0.0:8080\nThe TCP Acceptor pool size.\n\nValue: Number\nlistener.api.mgmt.acceptors = 4\nMaximum concurrent HTTP clients allowed.\n\nValue: Number\nlistener.api.mgmt.max_clients = 64\nThe access control rules for the listener.\n\nSee: https://github.com/emqtt/esockd#allowdeny\n\nValue: ACL Rule\nlistener.api.mgmt.access.1 = allow all\nThe TCP backlog for HTTP API.\n\nValue: Number >= 0\nlistener.api.mgmt.backlog = 512\nThe TCP send timeout for HTTP API.\n\nValue: Duration\nlistener.api.mgmt.send_timeout = 15s\nClose the TCP connection if send timeout.\n\nValue: on | off\nlistener.api.mgmt.send_timeout_close = on\n-------------------------------------------------------------------\nSystem Monitor\n-------------------------------------------------------------------\nEnable Long GC monitoring.\nNotice: don't enable the monitor in production for:\nhttps://github.com/erlang/otp/blob/feb45017da36be78d4c5784d758ede619fa7bfd3/erts/emulator/beam/erl_gc.c#L421\n\nValue: true | false\nsysmon.long_gc = false\nEnable Long Schedule(ms) monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: Number\nsysmon.long_schedule = 240\nEnable Large Heap monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: bytes\n\nDefault: 8M words. 32MB on 32-bit VM, 64MB on 64-bit VM.\nsysmon.large_heap = 8MB\nEnable Busy Port monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: true | false\nsysmon.busy_port = false\nEnable Busy Dist Port monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: true | false\nsysmon.busy_dist_port = true\n`\n. I just wrote today.\nI am also wondering the \"timeout\" ..\n. ",
    "wiiikiii": "is there a reason for?\nwith the http modul i can handle much more fine graded auth checks on path\nand also on dynamic usernames. \ni have some server tasks they should not depend on http auth for stability and security reason.\nis it likely you'll change this behaviour?. ",
    "jchapuis": "Any update on this issue? also suffering from this here. Thanks!. I have created a PR which solves this issue: https://github.com/emqtt/emq-auth-http/pull/78 \nNo response yet. Thanks for your support!. ",
    "Lance0312": ":+1:. ",
    "madhushreegc": "Thank you very much for your answer . Just for my confirmation i am asking it again . \nAssuming data replication of backend like redis happening from primary to secondary . For some reason mqtt client which had subscribed on topic1 connected to primary cluster and now connects to secondary cluster and could receive pending messages from topic1(Stroed in redis) right?\n. ",
    "polyglotm": "@Tabrizian could you explain more about the reason and solution?\nI got an exact same error on AWS. ",
    "sustchenkov": "[image: \u0412\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 1]\n2017-12-25 4:37 GMT+03:00 HeeeJianBo notifications@github.com:\n\nHi @sustchenkov https://github.com/sustchenkov\nIt's seems some file not exist! But can't get any more details.\nCould you please provide more details information to diagnose this issue?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/1381#issuecomment-353813108, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AEo6EK_eSWKR3RabLoFlNPAI43H5sqfnks5tDvxZgaJpZM4Q3t8i\n.\n. \n",
    "gdillen": "ok thanks for the workaround, if not possible otherwise: a lot of 'bridging' :)\n. Hi,\nIs there any progress regarding a solution for this problem?\nThanks.. Hi,\nMy initial issue dates from almost 20days ago. Until now I didn't get any feedback on the progress, ...\nWe can't wait with our further development. So please give some feedback/solution or we have to look for another solution.\nThanks.. Hi @zhengyupan Thanks, I followed the instructions you mentioned (the Medium doc) but it doesn't work. When I add this \"dashboard.listener.https.access.1 = allow all\" line in the conf file the broker doesn't startup! When I don't add this line I only can login with http (port: 18083).\nMy certificates are OK.\nThese are my entries in the conf file for https:\n'## HTTPS Listener'\n'## The IP address and port that the Dashboard HTTPS listener will bind.'\n'##'\n'## Value: IP:Port | Port'\n'##'\n'## Examples: 18084, 127.0.0.1:18084, ::1:18084'\n'## dashboard.listener.https = 18084'\n'dashboard.listener.https = 18084'\n'## The acceptor pool for external Dashboard HTTPS listener.'\n'##'\n'## Value: Number'\n'## dashboard.listener.https.acceptors = 2'\n'dashboard.listener.https.acceptors = 2'\n'## Maximum number of concurrent Dashboard HTTPS connections.'\n'##'\n'## Value: Number'\n'## dashboard.listener.https.max_clients = 512'\n'dashboard.listener.https.max_clients = 512'\n'## Path to the file containing the user's private PEM-encoded key.'\n'##'\n'## Value: File'\n'## dashboard.listener.https.keyfile = etc/certs/key.pem'\n'dashboard.listener.https.keyfile = /etc/letsencrypt/live/prod-gwy0.abcxyz.abc/privkey.pem'\n'## Path to a file containing the user certificate.'\n'##'\n'## Value: File'\n'## dashboard.listener.https.certfile = etc/certs/cert.pem'\n'dashboard.listener.https.certfile = /etc/letsencrypt/live/prod-gwy0.abcxyz.abc/fullchain.pem'. ",
    "a414338069": "My EMQ has the same issue.  . ",
    "thuandh86": "Can you tell me more? i use mqttd:subcribe in plugin  subscribe for other user but  user not subcribe topic although in api of other user is had subscribed. I used emqttd_sm:lookup_session for look clienid session and use emqttd_session:subscribe for auto subcribe for other user, it's success. \nthanks, closed topic.. ",
    "ForLina": "I don't really member , but nobody operated this server at that time which means the file can't be deleted by us. . A crash of emq cluster happened when backbone network was not stable(optical fibre delivery or something else).\nI checked the system log and found that the beam process is not kill by oom_killer, in system message log, I found an error \n/var/log/messages\n`Dec 31 18:04:58 mqtt-real3 run_erl[7792]: errno=2 'No such file or directory'#012Error in reading from terminal\nDec 31 18:04:59 mqtt-real3 kiernel: TCP: too many orphaned sockets\nDec 31 18:04:59 mqtt-real3 kernel: TCP: too many orphaned sockets\nDec 31 18:04:59 mqtt-real3 kernel: TCP: too many orphaned sockets\nDec 31 18:04:59 mqtt-real3 kernel: TCP: too many orphaned sockets\nDec 31 18:04:59 mqtt-real3 kernel: TCP: too many orphaned sockets`\nAnd no import log in crash.log or error.log.\nI wonder if you have seen the same problem, or what may cause this happen since I can't reappear this problem in test environment.\n. ",
    "z14633": "I got this problem too, and I want to ask.When is the version 2.4 released\uff1f\uff1f. ",
    "jkwong38": "Update:  I was able to get the service started by commenting out the four configuration lines in /etc/emqttd/plugins/emq_lwm2m.conf\nI also tried re-installing with the lwm2m_xml deleted, in hopes it would re-install clean again.  But it did not reappear.  Is this directory auto generated?. Update:  As in my prior update, the service started, but doesn't work properly; so I reverted back to the beta for now.. ",
    "hbli": "It does show ulimit -n 1048576.\nThe problem happens only during the reboot. If you start emqtt manually, no emfile error is reported.. It seems to me that the kernel is not fully initialized before the emqttd is launched.. ",
    "arnaboss": "@zhengyupan All my nifi nodes were connected to one emq broker and were all consuming together.\nThe desired effect was a shared topic where there would be round robin way of consumption.\n@Gilbert-Wong  This issue had been solved using a shared topic. This can be closed.. ",
    "Eric24": "By \"shared session\", I'm referring to \"shared subscriptions\": http://emqtt.io/docs/v2/advanced.html#shared-subscription. To be clear, the use of the term \"session\" was my mistake. I'm only referring to \"shared subscriptions\". Given that, my original question should have been phrased like this (below):\nIn \"normal mode\" (i.e. not a shared-subscription) with non-clean session and QoS 1 or 2, what is the default behavior of eMQTT when a new client with the same ClientID as an existing connection? I assume the existing connection will be disconnected and the new connection will be established (assume auth, etc.)? What about non-ack'ed messages sent to the existing connection? Will they be resent to the new connection? Can you confirm this behavior?\nIn \"shared-subscription\" mode, I assume that any client that connects and subscribes to the shared topic will be a candidate for receiving new messages. But what about QoS 1 or 2 messages published to this topic when no clients are connected and subscribed to it? Will they be resent when a client later connects/subscribes? Also, what about non-ack'ed messages sent to one client? Will they be resent to a different client subscribed to the same shared topic? There's very little documentation on shared-subscription mode, so any details you could provide on this would be very helpful.. Thanks!. Is there any plan to move EMQ to using Cowboy?. ",
    "linshenqi": "Today I just try the topic '$local/$share/group/topic again. It seems OK now.. ",
    "Bakkiyaraj": "@emqplus Thanks for the document.\n. ",
    "ertanden": "To add more info, using the benchmark tool from https://github.com/hareeqi/mqtt-benchmark here are my results (not exactly scientific but still reproduces the problem experienced):\nEMQ WS:\n```\n$ ./bin/mqtt-benchmark --broker=ws://emq-broker:8000/mqtt --size=25000 --clients=1 --count=1000\nTrying to conenct to 1 clients ...\nConencted to 1 sucessfully\n    Average result for each client of the 1 clients.\n\n    Establishing connection (sec):   0.239\n    Success in publishing (msg):     1000/1000\n    Failure in publishing (msg):     0/1000\n    Duraion in publishing (sec):     36.588\n    Throughput (msg/sec):            27.3314\n\nEMQ TCP:\n$ ./bin/mqtt-benchmark --broker=tcp://emq-broker:1883 --size=25000 --clients=1 --count=1000\nTrying to conenct to 1 clients ...\nConencted to 1 sucessfully\n    Average result for each client of the 1 clients.\n\n    Establishing connection (sec):   0.162\n    Success in publishing (msg):     1000/1000\n    Failure in publishing (msg):     0/1000\n    Duraion in publishing (sec):     17.468\n    Throughput (msg/sec):            57.2475\n\nRabbitMQ WS\n$ ./bin/mqtt-benchmark --broker=ws://rabbitmq:28000/ws --size=25000 --clients=1 --count=1000\nTrying to conenct to 1 clients ...\nConencted to 1 sucessfully\n    Average result for each client of the 1 clients.\n\n    Establishing connection (sec):   0.295\n    Success in publishing (msg):     1000/1000\n    Failure in publishing (msg):     0/1000\n    Duraion in publishing (sec):     16.829\n    Throughput (msg/sec):            59.4212\n\nRabbitMQ TCP\n$ ./bin/mqtt-benchmark --broker=tcp://rabbitmq:21883 --size=25000 --clients=1 --count=1000\nTrying to conenct to 1 clients ...\nConencted to 1 sucessfully\n    Average result for each client of the 1 clients.\n\n    Establishing connection (sec):   0.128\n    Success in publishing (msg):     1000/1000\n    Failure in publishing (msg):     0/1000\n    Duraion in publishing (sec):     16.811\n    Throughput (msg/sec):            59.4849\n\n```. ",
    "swinterberger": "This seems to be an issue with Mochiweb websocket implementation, which emqtt is leveraging.  That project is pretty much dead and is generally low performance due to having to maintain legacy support.\nRabbitMQ (and VerneMQ) use cowboy websocket implementation which is far more feature rich and much more performant.\n. ",
    "feihualuomeng": "windows platform is not stable?. ",
    "JiangLiguoME": "I got the same problem with you.\nI check the log then found that the emq server show:\n\"Access denied for user ''@'localhost' (using password: NO)\"\nBut my username and password is correct in the emq_auth_mysql. > Remove the double quotation marks and try again, like this:\n\n```\nMysql Username\nauth.mysql.username = root\nMysql Password\nauth.mysql.password = emqtt\nMysql Database\nauth.mysql.database = mqtt_test\n```\n\nThank you!\nI tried it,but failed.And it showed the same wrong Error.\nThen I tried to change to emqx version 3.0 and succeeded.\nIt seems that the version of mysql server isnot compatible.. ",
    "chcmq": "I just use my already configured, and have successfully logged in with the username and password phpmyadmin, since the official document is the default is the local IP 127.0.0.1, I changed to my own IP address of the server, in addition to the official documents are only need to configure the emq_auth_mysql. Outside the conf file also need to configure?. ",
    "wangh09": "Found that the service need to be restarted when the plugin settings was changed.. ",
    "nvandamme": "emqttd is the only service binding the port 1883 on my host.... Hi,\nI want to bind on IPv4 and IPv6 on the same iface.\nlistener.<proto>.<name>.reuseaddr doesn't seems to work with this config :\nemq.conf\n```\nnode.proto_dist = inet6_tcp\nlistener.tcp.external = 0.0.0.0:1883\nlistener.tcp.external.reuseaddr = true\nlistener.tcp.external.acceptors = 16\nlistener.tcp.external.max_clients = 102400\nlistener.tcp.external.access.1 = allow all\nlistener.tcp.external.backlog = 1024\nlistener.tcp.external.send_timeout = 15s\nlistener.tcp.external.send_timeout_close = on\nlistener.tcp.external.tune_buffer = on\nlistener.tcp.external.nodelay = true\nlistener.tcp.external6 = :::1883\nlistener.tcp.external6.reuseaddr = true\nlistener.tcp.external6.acceptors = 16\nlistener.tcp.external6.max_clients = 102400\nlistener.tcp.external6.access.1 = allow all\nlistener.tcp.external6.backlog = 1024\nlistener.tcp.external6.send_timeout = 15s\nlistener.tcp.external6.send_timeout_close = on\nlistener.tcp.external6.tune_buffer = on\nlistener.tcp.external6.nodelay = true\n```\ncrash.log\n=INFO REPORT==== 1-Feb-2018::21:17:19 ===\n    alarm_handler: {set,{system_memory_high_watermark,[]}}\nstarting emqttd on node 'EB_node_audio@10.0.0.189'\nemqttd ctl is starting...[ok]\nemqttd hook is starting...[ok]\nemqttd router is starting...[ok]\nemqttd pubsub is starting...[ok]\nemqttd stats is starting...[ok]\nemqttd metrics is starting...[ok]\nemqttd pooler is starting...[ok]\nemqttd trace is starting...[ok]\nemqttd client manager is starting...[ok]\nemqttd session manager is starting...[ok]\nemqttd session supervisor is starting...[ok]\nemqttd wsclient supervisor is starting...[ok]\nemqttd broker is starting...[ok]\nemqttd alarm is starting...[ok]\nemqttd mod supervisor is starting...[ok]\nemqttd bridge supervisor is starting...[ok]\nemqttd access control is starting...[ok]\nemqttd system monitor is starting...[ok]\nemqttd 2.3.4 is running now\nEshell V9.1.5  (abort with ^G)\n(EB_node_audio@10.0.0.189)1> Load emq_mod_presence module successfully.\ndashboard:http listen on [::]:18083 with 4 acceptors.\nmqtt:tcp listen on [::1]:11883 with 4 acceptors.\nmqtt:tcp listen on 127.0.0.1:11883 with 4 acceptors.\nmqtt:tcp listen on [::]:1883 with 16 acceptors.\n21:17:27.428 [error] [error] mqtt:tcp failed to listen on 1883 - eaddrinuse (address already in use)\n21:17:27.428 [error] CRASH REPORT Process <0.1419.0> with 0 neighbours exited with reason: {cannot_listen,1883,eaddrinuse} in gen_server:init_it/6 line 349\n21:17:27.430 [error] Autocluster exception: {badmatch,{error,{{'EXIT',{{badmatch,{error,{{cannot_listen,1883,eaddrinuse},{child,undefined,listener,{esockd_listener,start_link,['mqtt:tcp',{{0,0,0,0},1883},[{connopts,[]},{sockopts,[{send_timeout_close,true},{send_timeout,15000},binary,{packet,raw},{reuseaddr,true},{backlog,1024},{nodelay,true}]},{acceptors,16},{max_clients,102400},{tune_buffer,true},{access,[{allow,all}]}],<0.1418.0>,{gen_logger,error_logger_logger,2}]},transient,4294967295,worker,[esockd_listener]}}}},[{esockd_listener_sup,start_link,4,[{file,\"src/esockd_listener_sup.erl\"},{line,62}]},{supervisor,do_start_child,2,[{file,\"supervisor.erl\"},{line,365}]},{supervisor,handle_start_child,2,[{file,\"supervisor.erl\"},{line,724}]},{supervisor,handle_call,3,[{file,\"supervisor.erl\"},{line,422}]},{gen_server,try_handle_call,4,[{file,\"gen_server.erl\"},{line,636}]},{gen_server,handle_msg,6,[{file,\"gen_server.erl\"},{line,665}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,247}]}]}},{child,undefined,{listener_sup,{'mqtt:tcp',{{0,0,0,0},1883}}},{esockd_listener_sup,start_link,['mqtt:tcp',{{0,0,0,0},1883},[{connopts,[]},{sockopts,[{send_timeout_close,true},{send_timeout,15000},binary,{packet,raw},{reuseaddr,true},{backlog,1024},{nodelay,true}]},{acceptors,16},{max_clients,102400},{tune_buffer,true},{access,[{allow,all}]}],{emqttd_client,start_link,[[{max_publish_rate,0},{client_idle_timeout,30000},{client_enable_stats,false},{max_clientid_len,1024},{max_packet_size,65536},{keepalive_backoff,0.75}]]}]},transient,infinity,supervisor,[esockd_listener_sup]}}}}\nnetstat -npl\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      553/sshd\ntcp        0      0 0.0.0.0:1880            0.0.0.0:*               LISTEN      1072/node-red\ntcp        0      0 127.0.0.1:11883         0.0.0.0:*               LISTEN      16274/beam.smp\ntcp        0      0 0.0.0.0:4369            0.0.0.0:*               LISTEN      15201/epmd\ntcp6       0      0 :::22                   :::*                    LISTEN      553/sshd\ntcp6       0      0 :::1883                 :::*                    LISTEN      16274/beam.smp\ntcp6       0      0 :::6369                 :::*                    LISTEN      16274/beam.smp\ntcp6       0      0 :::18083                :::*                    LISTEN      16274/beam.smp\ntcp6       0      0 ::1:11883               :::*                    LISTEN      16274/beam.smp\ntcp6       0      0 :::4369                 :::*                    LISTEN      15201/epmd\nudp        0      0 0.0.0.0:5353            0.0.0.0:*                           1065/avahi-daemon:\nudp        0      0 0.0.0.0:4369            0.0.0.0:*                           16274/beam.smp\nudp        0      0 0.0.0.0:51745           0.0.0.0:*                           1065/avahi-daemon:\nudp        0      0 0.0.0.0:68              0.0.0.0:*                           2108/dhclient\nudp6       0      0 :::5353                 :::*                                1065/avahi-daemon:\nudp6       0      0 :::59522                :::*                                1065/avahi-daemon:\n. ",
    "hfcorriez": "It's same to me.. ",
    "Shawn-ye": "hi, @huangdan Thanks for your reply. It would take a while to collect these information you required and I will provide them later. \n. ",
    "wingpengfei": "leave it , not stable to reproduce. ",
    "promission": "@sincsc  http://emqtt.com/clients  , Here's a tutorial.. @sincsc just JDK do it. thanks\uff0cyou are right\uff0c i will try set \"Clean Session\" to \"false\"\uff0cthen traceing for a few days.. ",
    "liuxiaodong": "+1. ",
    "tu226": "2018-02-02 16:03:47.318 [error] <0.1511.0> Supervisor {<0.1511.0>,ecpool_worker_sup} had child {worker,1} started with ecpool_worker:start_link(emq_auth_redis, 1, emq_auth_redis_cli, [{pool_size,8},{auto_reconnect,1},{host,\"10.3.13.5\"},{port,6379},{database,10},{password,\"crs-hp...\"}]) at undefined exit with reason {authentication_error,{unexpected_data,{ok,<<\"-ERR invalid password\\r\\n\">>}}} in context start_error\n2018-02-02 16:03:47.318 [error] <0.1509.0> Supervisor {<0.1509.0>,ecpool_pool_sup} had child worker_sup started with ecpool_worker_sup:start_link(emq_auth_redis, emq_auth_redis_cli, [{pool_size,8},{auto_reconnect,1},{host,\"10.3.13.5\"},{port,6379},{database,10},{password,\"crs-hp...\"}]) at undefined exit with reason {shutdown,{failed_to_start_child,{worker,1},{authentication_error,{unexpected_data,{ok,<<\"-ERR invalid password\\r\\n\">>}}}}} in context start_error. I sure used follow password as same as another project which has no problem \ncrs-hp1n6w0b:jpyp123456. auth.redis.server = 10.3.13.5:6379\nauth.redis.pool = 8\nauth.redis.database = 10\nauth.redis.password = crs-hp1n6w0b:jpyp123456\nauth.redis.auth_cmd = HGET emq.cloudUser:%u password\nauth.redis.password_hash = plain\nauth.redis.super_cmd = HGET emq.cloudUser:%u is_superuser\nauth.redis.acl_cmd = HGETALL emq.cloudAcl:%u\nthere is only an emq_auth_redis.conf . redis-cli -h 10.3.13.5 -n 10 -a crs-hp1n6w0b:jpyp123456 \ncan not auth,must has port param\nredis-cli -h 10.3.13.5 -n 10 -p 6379 -a crs-hp1n6w0b:jpyp123456 (no problem)\n. ",
    "vishuPPatel": "Current this Error is recurred.\nmongodb working fine .\nAnd Today we test multiple plugin test(like emq_auth_username,emq_auth_redis,emq_auth_mongo but we enter userid and password then we test the plugin is working or not first time i \nBellow mention the testing wise credential we enter wise testing...\nEnter the user and password wrong --------> Not connected\nEnter the right user and password wrong --------> Not connected \nEnter the right (user and password) --------> connected\nEnter the wrong (user and password) --------> connected \nThanks!!!...... User Authentication work fine\nexample:--\nI enter right user and password -----> Connected\nI enter  wrong user and password ------> Not Connected\nBut right now i enter any topic to subscribe and any topic to publish message\nalready add topic in mqtt_acl collection ...\nwhy this not subscribe and publish any topic how to stop it.\nthis is my emq.conf file...\n```conf\n====================================================================\nEMQ Configuration R2\n====================================================================\n--------------------------------------------------------------------\nCluster\n--------------------------------------------------------------------\nCluster name.\ncluster.name = emqcl\nCluster auto-discovery strategy.\n\nValue: Enum\n- manual: Manual join command\n- static: Static node list\n- mcast:  IP Multicast\n- dns:    DNS A Record\n- etcd:   etcd\n- k8s:    Kubernates\n\nDefault: manual\ncluster.discovery = manual\nEnable cluster autoheal from network partition.\n\nValue: on | off\n\nDefault: on\ncluster.autoheal = on\nAutoclean down node. A down node will be removed from the cluster\nif this value > 0.\n\nValue: Duration\n-h: hour, e.g. '2h' for 2 hours\n-m: minute, e.g. '5m' for 5 minutes\n-s: second, e.g. '30s' for 30 seconds\n\nDefault: 5m\ncluster.autoclean = 5m\n--------------------------------------------------------------------\nCluster using static node list\nNode list of the cluster.\n\nValue: String\ncluster.static.seeds = emq1@127.0.0.1,emq2@127.0.0.1\n--------------------------------------------------------------------\nCluster using IP Multicast.\nIP Multicast Address.\n\nValue: IP Address\ncluster.mcast.addr = 239.192.0.1\nMulticast Ports.\n\nValue: Port List\ncluster.mcast.ports = 4369,4370\nMulticast Iface.\n\nValue: Iface Address\n\nDefault: 0.0.0.0\ncluster.mcast.iface = 0.0.0.0\nMulticast Ttl.\n\nValue: 0-255\ncluster.mcast.ttl = 255\nMulticast loop.\n\nValue: on | off\ncluster.mcast.loop = on\n--------------------------------------------------------------------\nCluster using DNS A records.\nDNS name.\n\nValue: String\ncluster.dns.name = localhost\nThe App name is used to build 'node.name' with IP address.\n\nValue: String\ncluster.dns.app = emq\n--------------------------------------------------------------------\nCluster using etcd\nEtcd server list, seperated by ','.\n\nValue: String\ncluster.etcd.server = http://127.0.0.1:2379\nThe prefix helps build nodes path in etcd. Each node in the cluster\nwill create a path in etcd: v2/keys///\n\nValue: String\ncluster.etcd.prefix = emqcl\nThe TTL for node's path in etcd.\n\nValue: Duration\n\nDefault: 1m, 1 minute\ncluster.etcd.node_ttl = 1m\n--------------------------------------------------------------------\nCluster using Kubernates\nKubernates API server list, seperated by ','.\n\nValue: String\ncluster.k8s.apiserver = http://10.110.111.204:8080\nThe service name helps lookup EMQ nodes in the cluster.\n\nValue: String\ncluster.k8s.service_name = emq\nThe address type is used to extract host from k8s service.\n\nValue: ip | dns\ncluster.k8s.address_type = ip\nThe app name helps build 'node.name'.\n\nValue: String\ncluster.k8s.app_name = emq\n--------------------------------------------------------------------\nNode Args\n--------------------------------------------------------------------\nNode name.\n\nSee: http://erlang.org/doc/reference_manual/distributed.html\n\nValue: @\n\nDefault: emq@127.0.0.1\nnode.name = emq@192.168.88.3\nCookie for distributed node communication.\n\nValue: String\nnode.cookie = emqsecretcookie\nEnable SMP support of Erlang VM.\n\nValue: enable | auto | disable\nnode.smp = auto\nHeartbeat monitoring of an Erlang runtime system. Comment the line to disable\nheartbeat, or set the value as 'on'\n\nValue: on\n\nvm.args: -heart\nnode.heartbeat = on\nEnable kernel poll.\n\nValue: on | off\n\nDefault: on\nnode.kernel_poll = on\nSets the number of threads in async thread pool. Valid range is 0-1024.\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: 0-1024\n\nvm.args: +A Number\nnode.async_threads = 32\nSets the maximum number of simultaneously existing processes for this\nsystem if a Number is passed as value.\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: Number [1024-134217727]\n\nvm.args: +P Number\nnode.process_limit = 256000\nSets the maximum number of simultaneously existing ports for this system\nif a Number is passed as value.\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: Number [1024-134217727]\n\nvm.args: +Q Number\nnode.max_ports = 65536\nSet the distribution buffer busy limit (dist_buf_busy_limit).\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: Number [1KB-2GB]\n\nvm.args: +zdbbl size\nnode.dist_buffer_size = 8MB\nSets the maximum number of ETS tables. Note that mnesia and SSL will\ncreate temporary ETS tables.\n\nValue: Number\n\nvm.args: +e Number\nnode.max_ets_tables = 256000\nTweak GC to run more often.\n\nValue: Number [0-65535]\n\nvm.args: -env ERL_FULLSWEEP_AFTER Number\nnode.fullsweep_after = 1000\nCrash dump log file.\n\nValue: Log file\nnode.crash_dump = log/crash.dump\nSpecify the erlang distributed protocol.\n\nValue: Enum\n- inet_tcp: the default; handles TCP streams with IPv4 addressing.\n- inet6_tcp: handles TCP with IPv6 addressing.\n\nvm.args: -proto_dist inet_tcp\nnode.proto_dist = inet_tcp\nSets the net_kernel tick time. TickTime is specified in seconds.\nNotice that all communicating nodes are to have the same TickTime\nvalue specified.\n\nSee: http://www.erlang.org/doc/man/kernel_app.html#net_ticktime\n\nValue: Number\n\nvm.args: -kernel net_ticktime Number\nnode.dist_net_ticktime = 60\nSets the port range for the listener socket of a distributed Erlang node.\nNote that if there are firewalls between clustered nodes, this port segment\nfor nodes\u2019 communication should be allowed.\n\nSee: http://www.erlang.org/doc/man/kernel_app.html\n\nValue: Port [1024-65535]\nnode.dist_listen_min = 6369\nnode.dist_listen_max = 6379\n--------------------------------------------------------------------\nLog\n--------------------------------------------------------------------\nSets the log dir.\n\nValue: Folder\nlog.dir = log\nWhere to emit the console logs.\n\nValue: off | file | console | both\n- off: disabled\n- file: write to file\n- console: write to stdout\n- both: file and stdout\nlog.console = console\nSets the severity level of console log.\n\nValue: debug | info | notice | warning | error | critical | alert | emergency\n\nDefault: error\nlog.console.level = error\nThe file where console logs will be writed to, when 'log.console' is set as 'file'.\n\nValue: File Name\nlog.console.file = log/console.log\nMaximum file size for console log.\n\nValue: Number(bytes)\nlog.console.size = 10485760\nThe rotation count for console log.\n\nValue: Number\nlog.console.count = 5\nThe file where info logs will be writed to.\n\nValue: File Name\nlog.info.file = log/info.log\nMaximum file size for info log.\n\nValue: Number(bytes)\nlog.info.size = 10485760\nThe rotation count for info log.\n\nValue: Number\nlog.info.count = 5\nThe file where error logs will be writed to.\n\nValue: File Name\nlog.error.file = log/error.log\nMaximum file size for error log.\n\nValue: Number(bytes)\nlog.error.size = 10485760\nThe rotation count for error log.\n\nValue: Number\nlog.error.count = 5\nEnable the crash log.\n\nValue: on | off\nlog.crash = on\nThe file for crash log.\n\nValue: File Name\nlog.crash.file = log/crash.log\n--------------------------------------------------------------------\nAllow Anonymous Authentication and Default ACL\n--------------------------------------------------------------------\nAllow Anonymous Authentication.\n\nNotice: Disable the option for production deployment.\n\nValue: true | false\nmqtt.allow_anonymous = false\nDefault behaviour when ACL nomatch.\n\nValue: allow | deny\nmqtt.acl_nomatch = deny\nDefault ACL File.\n\nValue: File Name\nmqtt.acl_file = etc/acl.conf\nWhether to cache ACL for publish messages.\n\nValue: true | false\nmqtt.cache_acl = false\n--------------------------------------------------------------------\nMQTT Protocol\n--------------------------------------------------------------------\nMaximum length of MQTT cllientId allowed.\n\nValue: Number [23-65535]\nmqtt.max_clientid_len = 1024\nMaximum MQTT packet size allowed.\n\nValue: Bytes\n\nDefault: 64K\nmqtt.max_packet_size = 64KB\nCheck if the websocket protocol header is valid.\nTurn off the option when developing WeChat App.\n\nValue: on | off\nmqtt.websocket_protocol_header = on\nThe backoff for MQTT keepalive timeout.\nEMQ will kick a MQTT connection out until 'Keepalive * backoff * 2' timeout.\n\nValue: Float > 0.5\nmqtt.keepalive_backoff = 0.75\n--------------------------------------------------------------------\nMQTT Connection\n--------------------------------------------------------------------\nForce GC the MQTT connections. Value 0 will disable the Force GC.\n\nValue: Number >= 0\nmqtt.conn.force_gc_count = 100\n--------------------------------------------------------------------\nMQTT Client\n--------------------------------------------------------------------\nMQTT client idle timeout, specified in seconds.\n\nValue: Duration\nmqtt.client.idle_timeout = 30s\nTODO: Maximum publish rate of MQTT messages per second.\n\nValue: Number\nmqtt.client.max_publish_rate = 5\nEnable per client statistics.\n\nValue:  on | off\nmqtt.client.enable_stats = off\n--------------------------------------------------------------------\nMQTT Session\n--------------------------------------------------------------------\nMaximum number of subscriptions allowed, 0 means no limit.\n\nValue: Number\nmqtt.session.max_subscriptions = 0\nForce to upgrade QoS according to subscription.\n\nValue: on | off\nmqtt.session.upgrade_qos = off\nMaximum size of the Inflight Window storing QoS1/2 messages delivered but unacked.\n\nValue: Number\nmqtt.session.max_inflight = 32\nRetry interval for QoS1/2 message delivering.\n\nValue: Duration\nmqtt.session.retry_interval = 20s\nMaximum QoS2 packets (Client -> Broker) awaiting PUBREL, 0 means no limit.\n\nValue: Number\nmqtt.session.max_awaiting_rel = 1000\nThe QoS2 messages (Client -> Broker) will be dropped if awaiting PUBREL timeout.\n\nValue: Duration\nmqtt.session.await_rel_timeout = 30s\nEnable per session statistics.\n\nValue: on | off\nmqtt.session.enable_stats = on\nSession expiration time.\n\nValue: Duration\n-d: day\n-h: hour\n-m: minute\n-s: second\n\nDefault: 2h, 2 hours\nmqtt.session.expiry_interval = 2h\nWhether to ignore loop delivery of messages.\n\nValue: true | false\n\nDefault: false\nmqtt.session.ignore_loop_deliver = false\n--------------------------------------------------------------------\nMQTT Message Queue\n--------------------------------------------------------------------\nMessage queue type.\n\nValue: simple | priority\nmqtt.mqueue.type = simple\nTopic priority. Default is 0.\n\nValue: Number [0-255]\n\nmqtt.mqueue.priority = topic/1=10,topic/2=8\nMaximum queue length. Enqueued messages when persistent client disconnected,\nor inflight window is full. 0 means no limit.\n\nValue: Number >= 0\nmqtt.mqueue.max_length = 1000\nLow-water mark of queued messages.\n\nValue: Percent\nmqtt.mqueue.low_watermark = 20%\nHigh-water mark of queued messages.\n\nValue: Percent\nmqtt.mqueue.high_watermark = 60%\nWhether to enqueue Qos0 messages.\n\nValue: false | true\nmqtt.mqueue.store_qos0 = true\n--------------------------------------------------------------------\nMQTT Broker and PubSub\n--------------------------------------------------------------------\nSystem interval of publishing $SYS messages.\n\nValue: Duration\n\nDefault: 1m, 1 minute\nmqtt.broker.sys_interval = 1m\nThe PubSub pool size. Default value should be same as scheduler numbers.\n\nValue: Number > 1\nmqtt.pubsub.pool_size = 8\nTODO: Subscribe asynchronously.\n\nValue: true | false\nmqtt.pubsub.async = true\n--------------------------------------------------------------------\nMQTT Bridge\n--------------------------------------------------------------------\nThe pending message queue size of bridge.\n\nValue: Number\nmqtt.bridge.max_queue_len = 10000\nPing interval of bridge node.\n\nValue: Duration\n\nDefault: 1s, 1 second\nmqtt.bridge.ping_down_interval = 1s\n-------------------------------------------------------------------\nMQTT Plugins\n-------------------------------------------------------------------\nThe etc dir for plugins' config.\n\nValue: Folder\nmqtt.plugins.etc_dir =etc/plugins/\nThe file to store loaded plugin names.\n\nValue: File\nmqtt.plugins.loaded_file = data/loaded_plugins\n--------------------------------------------------------------------\nMQTT Listeners\n--------------------------------------------------------------------\n--------------------------------------------------------------------\nMQTT/TCP - External TCP Listener for MQTT Protocol\nlistener.tcp. is the IP address and port that the MQTT/TCP\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 1883, 127.0.0.1:1883, ::1:1883\nlistener.tcp.external = 0.0.0.0:1883\nThe acceptor pool for external MQTT/TCP listener.\n\nValue: Number\nlistener.tcp.external.acceptors = 16\nMaximum number of concurrent MQTT/TCP connections.\n\nValue: Number\nlistener.tcp.external.max_clients = 102400\nTODO: Zone of the external MQTT/TCP listener belonged to.\n\nValue: String\nlistener.tcp.external.zone = external\nMountpoint of the MQTT/TCP Listener. All the topics of this\nlistener will be prefixed with the mount point if this option\nis enabled.\n\nValue: String\nlistener.tcp.external.mountpoint = external/\nRate limit for the external MQTT/TCP connections.\nFormat is 'burst,rate'.\n\nValue: burst,rate\nUnit: KB/sec\nlistener.tcp.external.rate_limit = 100,10\nThe access control rules for the MQTT/TCP listener.\n\nSee: https://github.com/emqtt/esockd#allowdeny\n\nValue: ACL Rule\n\nExample: allow 192.168.0.0/24\nlistener.tcp.external.access.1 = allow all\nEnable the Proxy Protocol V1/2 if the EMQ cluster is deployed\nbehind HAProxy or Nginx.\n\nSee: https://www.haproxy.com/blog/haproxy/proxy-protocol/\n\nValue: on | off\nlistener.tcp.external.proxy_protocol = on\nSets the timeout for proxy protocol. EMQ will close the TCP connection\nif no proxy protocol packet recevied within the timeout.\n\nValue: Duration\nlistener.tcp.external.proxy_protocol_timeout = 3s\nEnable the option for X.509 certificate based authentication.\nEMQ will Use the PP2_SUBTYPE_SSL_CN field in Proxy Protocol V2\nas MQTT username.\n\nValue: cn\nlistener.tcp.external.peer_cert_as_username = cn\nThe TCP backlog defines the maximum length that the queue of pending\nconnections can grow to.\n\nValue: Number >= 0\nlistener.tcp.external.backlog = 1024\nThe TCP send timeout for external MQTT connections.\n\nValue: Duration\nlistener.tcp.external.send_timeout = 15s\nClose the TCP connection if send timeout.\n\nValue: on | off\nlistener.tcp.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for MQTT connections.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.external.recbuf = 4KB\nThe TCP send buffer(os kernel) for MQTT connections.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.external.sndbuf = 4KB\nThe size of the user-level software buffer used by the driver.\nNot to be confused with options sndbuf and recbuf, which correspond\nto the Kernel socket buffers. It is recommended to have val(buffer)\n>= max(val(sndbuf),val(recbuf)) to avoid performance issues because\nof unnecessary copying. val(buffer) is automatically set to the above\nmaximum when values sndbuf or recbuf are set.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.external.buffer = 4KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nValue: on | off\nlistener.tcp.external.tune_buffer = on\nThe TCP_NODELAY flag for MQTT connections. Small amounts of data are\nsent immediately if the option is enabled.\n\nValue: true | false\nlistener.tcp.external.nodelay = true\nThe SO_REUSEADDR flag for TCP listener.\n\nValue: true | false\nlistener.tcp.external.reuseaddr = true\n--------------------------------------------------------------------\nInternal TCP Listener for MQTT Protocol\nThe IP address and port that the internal MQTT/TCP protocol listener\nwill bind.\n\nValue: IP:Port, Port\n\nExamples: 11883, 127.0.0.1:11883, ::1:11883\nlistener.tcp.internal = 127.0.0.1:11883\nThe acceptor pool for internal MQTT/TCP listener.\n\nValue: Number\nlistener.tcp.internal.acceptors = 4\nMaximum number of concurrent MQTT/TCP connections.\n\nValue: Number\nlistener.tcp.internal.max_clients = 102400\nTODO: Zone of the internal MQTT/TCP listener belonged to.\n\nValue: String\nlistener.tcp.internal.zone = internal\nMountpoint of the MQTT/TCP Listener.\n\nSee: listener.tcp..mountpoint\n\nValue: String\nlistener.tcp.internal.mountpoint = internal/\nRate limit for the internal MQTT/TCP connections.\n\nSee: listener.tcp..rate_limit\n\nValue: burst,rate\nlistener.tcp.internal.rate_limit = 1000,100\nThe TCP backlog of internal MQTT/TCP Listener.\n\nSee: listener.tcp..backlog\n\nValue: Number >= 0\nlistener.tcp.internal.backlog = 512\nThe TCP send timeout for internal MQTT connections.\n\nSee: listener.tcp..send_timeout\n\nValue: Duration\nlistener.tcp.internal.send_timeout = 5s\nClose the MQTT/TCP connection if send timeout.\n\nSee: listener.tcp..send_timeout_close\n\nValue: on | off\nlistener.tcp.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for internal MQTT connections.\n\nSee: listener.tcp..recbuf\n\nValue: Bytes\nlistener.tcp.internal.recbuf = 16KB\nThe TCP send buffer(os kernel) for internal MQTT connections.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.internal.sndbuf = 16KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp..buffer\n\nValue: Bytes\nlistener.tcp.internal.buffer = 16KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nSee: listener.tcp..tune_buffer\n\nValue: on | off\nlistener.tcp.internal.tune_buffer = on\nThe TCP_NODELAY flag for internal MQTT connections.\n\nSee: listener.tcp..nodelay\n\nValue: true | false\nlistener.tcp.internal.nodelay = false\nThe SO_REUSEADDR flag for MQTT/TCP Listener.\n\nValue: true | false\nlistener.tcp.internal.reuseaddr = true\n--------------------------------------------------------------------\nMQTT/SSL - External SSL Listener for MQTT Protocol\nlistener.ssl. is the IP address and port that the MQTT/SSL\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 8883, 127.0.0.1:8883, ::1:8883\nlistener.ssl.external = 8883\nThe acceptor pool for external MQTT/SSL listener.\n\nValue: Number\nlistener.ssl.external.acceptors = 16\nMaximum number of concurrent MQTT/SSL connections.\n\nValue: Number\nlistener.ssl.external.max_clients = 1024\nTODO: Zone of the external MQTT/SSL listener belonged to.\n\nValue: String\nlistener.ssl.external.zone = external\nMountpoint of the MQTT/SSL Listener.\n\nValue: String\nlistener.ssl.external.mountpoint = inbound/\nThe access control rules for the MQTT/SSL listener.\n\nSee: listener.tcp..access\n\nValue: ACL Rule\nlistener.ssl.external.access.1 = allow all\nRate limit for the external MQTT/SSL connections.\n\nValue: burst,rate\nlistener.ssl.external.rate_limit = 100,10\nEnable the Proxy Protocol V1/2 if the EMQ cluster is deployed behind\nHAProxy or Nginx.\n\nSee: listener.tcp..proxy_protocol\n\nValue: on | off\nlistener.ssl.external.proxy_protocol = on\nSets the timeout for proxy protocol.\n\nSee: listener.tcp..proxy_protocol_timeout\n\nValue: Duration\nlistener.ssl.external.proxy_protocol_timeout = 3s\nTLS versions only to protect from POODLE attack.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: String, seperated by ','\nlistener.ssl.external.tls_versions = tlsv1.2,tlsv1.1,tlsv1\nTLS Handshake timeout.\n\nValue: Duration\nlistener.ssl.external.handshake_timeout = 15s\nPath to the file containing the user's private PEM-encoded key.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: File\nlistener.ssl.external.keyfile = etc/certs/key.pem\nPath to a file containing the user certificate.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: File\nlistener.ssl.external.certfile = etc/certs/cert.pem\nPath to the file containing PEM-encoded CA certificates. The CA certificates\nare used during server authentication and when building the client certificate chain.\n\nValue: File\nlistener.ssl.external.cacertfile = etc/certs/cacert.pem\nThe Ephemeral Diffie-Helman key exchange is a very effective way of\nensuring Forward Secrecy by exchanging a set of keys that never hit\nthe wire. Since the DH key is effectively signed by the private key,\nit needs to be at least as strong as the private key. In addition,\nthe default DH groups that most of the OpenSSL installations have\nare only a handful (since they are distributed with the OpenSSL\npackage that has been built for the operating system it\u2019s running on)\nand hence predictable (not to mention, 1024 bits only).\nIn order to escape this situation, first we need to generate a fresh,\nstrong DH group, store it in a file and then use the option above,\nto force our SSL application to use the new DH group. Fortunately,\nOpenSSL provides us with a tool to do that. Simply run:\nopenssl dhparam -out dh-params.pem 2048\n\nValue: File\nlistener.ssl.external.dhfile = etc/certs/dh-params.pem\nA server only does x509-path validation in mode verify_peer,\nas it then sends a certificate request to the client (this\nmessage is not sent if the verify option is verify_none).\nYou can then also want to specify option fail_if_no_peer_cert.\nMore information at: http://erlang.org/doc/man/ssl.html\n\nValue: verify_peer | verify_none\nlistener.ssl.external.verify = verify_peer\nUsed together with {verify, verify_peer} by an SSL server. If set to true,\nthe server fails if the client does not have a certificate to send, that is,\nsends an empty certificate.\n\nValue: true | false\nlistener.ssl.external.fail_if_no_peer_cert = true\nThis is the single most important configuration option of an Erlang SSL\napplication. Ciphers (and their ordering) define the way the client and\nserver encrypt information over the wire, from the initial Diffie-Helman\nkey exchange, the session key encryption ## algorithm and the message\ndigest algorithm. Selecting a good cipher suite is critical for the\napplication\u2019s data security, confidentiality and performance.\n\nThe cipher list above offers:\n\nA good balance between compatibility with older browsers.\nIt can get stricter for Machine-To-Machine scenarios.\nPerfect Forward Secrecy.\nNo old/insecure encryption and HMAC algorithms\n\nMost of it was copied from Mozilla\u2019s Server Side TLS article\n\nValue: Ciphers\nlistener.ssl.external.ciphers = ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384,ECDHE-ECDSA-AES256-SHA384,ECDHE-RSA-AES256-SHA384,ECDHE-ECDSA-DES-CBC3-SHA,ECDH-ECDSA-AES256-GCM-SHA384,ECDH-RSA-AES256-GCM-SHA384,ECDH-ECDSA-AES256-SHA384,ECDH-RSA-AES256-SHA384,DHE-DSS-AES256-GCM-SHA384,DHE-DSS-AES256-SHA256,AES256-GCM-SHA384,AES256-SHA256,ECDHE-ECDSA-AES128-GCM-SHA256,ECDHE-RSA-AES128-GCM-SHA256,ECDHE-ECDSA-AES128-SHA256,ECDHE-RSA-AES128-SHA256,ECDH-ECDSA-AES128-GCM-SHA256,ECDH-RSA-AES128-GCM-SHA256,ECDH-ECDSA-AES128-SHA256,ECDH-RSA-AES128-SHA256,DHE-DSS-AES128-GCM-SHA256,DHE-DSS-AES128-SHA256,AES128-GCM-SHA256,AES128-SHA256,ECDHE-ECDSA-AES256-SHA,ECDHE-RSA-AES256-SHA,DHE-DSS-AES256-SHA,ECDH-ECDSA-AES256-SHA,ECDH-RSA-AES256-SHA,AES256-SHA,ECDHE-ECDSA-AES128-SHA,ECDHE-RSA-AES128-SHA,DHE-DSS-AES128-SHA,ECDH-ECDSA-AES128-SHA,ECDH-RSA-AES128-SHA,AES128-SHA\nSSL parameter renegotiation is a feature that allows a client and a server\nto renegotiate the parameters of the SSL connection on the fly.\nRFC 5746 defines a more secure way of doing this. By enabling secure renegotiation,\nyou drop support for the insecure renegotiation, prone to MitM attacks.\n\nValue: on | off\nlistener.ssl.external.secure_renegotiate = off\nA performance optimization setting, it allows clients to reuse\npre-existing sessions, instead of initializing new ones.\nRead more about it here.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: on | off\nlistener.ssl.external.reuse_sessions = on\nAn important security setting, it forces the cipher to be set based\non the server-specified order instead of the client-specified order,\nhence enforcing the (usually more properly configured) security\nordering of the server administrator.\n\nValue: on | off\nlistener.ssl.external.honor_cipher_order = on\nUse the CN or DN value from the client certificate as a username.\nNotice that 'verify' should be set as 'verify_peer'.\n\nValue: cn | dn\nlistener.ssl.external.peer_cert_as_username = cn\nTCP backlog for the SSL connection.\n\nSee listener.tcp..backlog\n\nValue: Number >= 0\nlistener.ssl.external.backlog = 1024\nThe TCP send timeout for the SSL connection.\n\nSee listener.tcp..send_timeout\n\nValue: Duration\nlistener.ssl.external.send_timeout = 15s\nClose the SSL connection if send timeout.\n\nSee: listener.tcp..send_timeout_close\n\nValue: on | off\nlistener.ssl.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for the SSL connections.\n\nSee: listener.tcp..recbuf\n\nValue: Bytes\nlistener.ssl.external.recbuf = 4KB\nThe TCP send buffer(os kernel) for internal MQTT connections.\n\nSee: listener.tcp..sndbuf\n\nValue: Bytes\nlistener.ssl.external.sndbuf = 4KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp..buffer\n\nValue: Bytes\nlistener.ssl.external.buffer = 4KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nSee: listener.tcp..tune_buffer\n\nValue: on | off\nlistener.ssl.external.tune_buffer = on\nThe TCP_NODELAY flag for SSL connections.\n\nSee: listener.tcp..nodelay\n\nValue: true | false\nlistener.ssl.external.nodelay = true\nThe SO_REUSEADDR flag for MQTT/SSL Listener.\n\nValue: true | false\nlistener.ssl.external.reuseaddr = true\n--------------------------------------------------------------------\nExternal WebSocket Listener for MQTT Protocol\nlistener.ws. is the IP address and port that the MQTT/WebSocket\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 8083, 127.0.0.1:8083, ::1:8083\nlistener.ws.external = 8083\nThe acceptor pool for external MQTT/WebSocket listener.\n\nValue: Number\nlistener.ws.external.acceptors = 4\nMaximum number of concurrent MQTT/WebSocket connections.\n\nValue: Number\nlistener.ws.external.max_clients = 102400\nTODO: Zone of the external MQTT/WebSocket listener belonged to.\n\nValue: String\nlistener.ws.external.zone = external\nMountpoint of the MQTT/WebSocket Listener.\n\nSee: listener.tcp..mountpoint\n\nValue: String\nlistener.ws.external.mountpoint = external/\nThe access control for the MQTT/WebSocket listener.\n\nSee: listener.tcp..access\n\nValue: ACL Rule\nlistener.ws.external.access.1 = allow all\nUse X-Forwarded-For header for real source IP if the EMQ cluster is\ndeployed behind NGINX or HAProxy.\n\nValue: String\nlistener.ws.external.proxy_address_header = X-Forwarded-For\nUse X-Forwarded-Port header for real source port if the EMQ cluster is\ndeployed behind NGINX or HAProxy.\n\nValue: String\nlistener.ws.external.proxy_port_header = X-Forwarded-Port\nEnable the Proxy Protocol V1/2 if the EMQ cluster is deployed behind\nHAProxy or Nginx.\n\nSee: listener.tcp..proxy_protocol\n\nValue: on | off\nlistener.ws.external.proxy_protocol = on\nSets the timeout for proxy protocol.\n\nSee: listener.tcp..proxy_protocol_timeout\n\nValue: Duration\nlistener.ws.external.proxy_protocol_timeout = 3s\nThe TCP backlog of external MQTT/WebSocket Listener.\n\nSee: listener.tcp..backlog\n\nValue: Number >= 0\nlistener.ws.external.backlog = 1024\nThe TCP send timeout for external MQTT/WebSocket connections.\n\nSee: listener.tcp..send_timeout\n\nValue: Duration\nlistener.ws.external.send_timeout = 15s\nClose the MQTT/WebSocket connection if send timeout.\n\nSee: listener.tcp..send_timeout_close\n\nValue: on | off\nlistener.ws.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for external MQTT/WebSocket connections.\n\nSee: listener.tcp..recbuf\n\nValue: Bytes\nlistener.ws.external.recbuf = 4KB\nThe TCP send buffer(os kernel) for external MQTT/WebSocket connections.\n\nSee: listener.tcp..sndbuf\n\nValue: Bytes\nlistener.ws.external.sndbuf = 4KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp..buffer\n\nValue: Bytes\nlistener.ws.external.buffer = 4KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nSee: listener.tcp..tune_buffer\n\nValue: on | off\nlistener.ws.external.tune_buffer = on\nThe TCP_NODELAY flag for external MQTT/WebSocket connections.\n\nSee: listener.tcp..nodelay\n\nValue: true | false\nlistener.ws.external.nodelay = true\nThe SO_REUSEADDR flag for MQTT/WebSocket Listener.\n\nValue: true | false\nlistener.ws.external.reuseaddr = true\n--------------------------------------------------------------------\nExternal WebSocket/SSL listener for MQTT Protocol\nlistener.wss. is the IP address and port that the MQTT/WebSocket/SSL\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 8084, 127.0.0.1:8084, ::1:8084\nlistener.wss.external = 8084\nThe acceptor pool for external MQTT/WebSocket/SSL listener.\n\nValue: Number\nlistener.wss.external.acceptors = 4\nMaximum number of concurrent MQTT/Webwocket/SSL connections.\n\nValue: Number\nlistener.wss.external.max_clients = 64\nTODO: Zone of the external MQTT/WebSocket/SSL listener belonged to.\n\nValue: String\nlistener.wss.external.zone = external\nMountpoint of the MQTT/WebSocket/SSL Listener.\n\nSee: listener.tcp..mountpoint\n\nValue: String\nlistener.wss.external.mountpoint = inbound/\nThe access control rules for the MQTT/WebSocket/SSL listener.\n\nSee: listener.tcp..access.\n\nValue: ACL Rule\nlistener.wss.external.access.1 = allow all\nSee: listener.ws.external.proxy_address_header\n\nValue: String\nlistener.wss.external.proxy_address_header = X-Forwarded-For\nSee: listener.ws.external.proxy_port_header\n\nValue: String\nlistener.wss.external.proxy_port_header = X-Forwarded-Port\nEnable the Proxy Protocol V1/2 support.\n\nSee: listener.tcp..proxy_protocol\n\nValue: on | off\nlistener.wss.external.proxy_protocol = on\nSets the timeout for proxy protocol.\n\nSee: listener.tcp..proxy_protocol_timeout\n\nValue: Duration\nlistener.wss.external.proxy_protocol_timeout = 3s\nTLS versions only to protect from POODLE attack.\n\nSee: listener.ssl..tls_versions\n\nValue: String, seperated by ','\nlistener.wss.external.tls_versions = tlsv1.2,tlsv1.1,tlsv1\nTLS Handshake timeout.\n\nSee: listener.ssl..handshake_timeout\n\nValue: Duration\nlistener.wss.external.handshake_timeout = 15s\nPath to the file containing the user's private PEM-encoded key.\n\nSee: listener.ssl..keyfile\n\nValue: File\nlistener.wss.external.keyfile = etc/certs/key.pem\nPath to a file containing the user certificate.\n\nSee: listener.ssl..certfile\n\nValue: File\nlistener.wss.external.certfile = etc/certs/cert.pem\nPath to the file containing PEM-encoded CA certificates.\n\nSee: listener.ssl..cacert\n\nValue: File\nlistener.wss.external.cacertfile = etc/certs/cacert.pem\nSee: listener.ssl..dhfile\n\nValue: File\nlistener.ssl.external.dhfile = etc/certs/dh-params.pem\nSee: listener.ssl..vefify\n\nValue: vefify_peer | verify_none\nlistener.wss.external.verify = verify_peer\nSee: listener.ssl..fail_if_no_peer_cert\n\nValue: false | true\nlistener.wss.external.fail_if_no_peer_cert = true\nSee: listener.ssl..ciphers\n\nValue: Ciphers\nlistener.wss.external.ciphers =\nSee: listener.ssl..secure_renegotiate\n\nValue: on | off\nlistener.wss.external.secure_renegotiate = off\nSee: listener.ssl..reuse_sessions\n\nValue: on | off\nlistener.wss.external.reuse_sessions = on\nSee: listener.ssl..honor_cipher_order\n\nValue: on | off\nlistener.wss.external.honor_cipher_order = on\nSee: listener.ssl..peer_cert_as_username\n\nValue: cn | dn\nlistener.wss.external.peer_cert_as_username = cn\nTCP backlog for the WebSocket/SSL connection.\n\nSee listener.tcp..backlog\n\nValue: Number >= 0\nlistener.wss.external.backlog = 1024\nThe TCP send timeout for the WebSocket/SSL connection.\n\nSee: listener.tcp..send_timeout\n\nValue: Duration\nlistener.wss.external.send_timeout = 15s\nClose the WebSocket/SSL connection if send timeout.\n\nSee: listener.tcp..send_timeout_close\n\nValue: on | off\nlistener.wss.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for the WebSocket/SSL connections.\n\nSee: listener.tcp..recbuf\n\nValue: Bytes\nlistener.wss.external.recbuf = 4KB\nThe TCP send buffer(os kernel) for the WebSocket/SSL connections.\n\nSee: listener.tcp..sndbuf\n\nValue: Bytes\nlistener.wss.external.sndbuf = 4KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp..buffer\n\nValue: Bytes\nlistener.wss.external.buffer = 4KB\nThe TCP_NODELAY flag for WebSocket/SSL connections.\n\nSee: listener.tcp..nodelay\n\nValue: true | false\nlistener.wss.external.nodelay = true\nThe SO_REUSEADDR flag for WebSocket/SSL listener.\n\nValue: true | false\nlistener.wss.external.reuseaddr = true\n--------------------------------------------------------------------\nHTTP Management API Listener\nThe IP Address and Port that the EMQ HTTP API will bind.\n\nValue: IP:Port | Port\n\nDefault: 0.0.0.0:8080\nlistener.api.mgmt = 0.0.0.0:8080\nThe TCP Acceptor pool size.\n\nValue: Number\nlistener.api.mgmt.acceptors = 4\nMaximum concurrent HTTP clients allowed.\n\nValue: Number\nlistener.api.mgmt.max_clients = 64\nThe access control rules for the listener.\n\nSee: https://github.com/emqtt/esockd#allowdeny\n\nValue: ACL Rule\nlistener.api.mgmt.access.1 = allow all\nThe TCP backlog for HTTP API.\n\nValue: Number >= 0\nlistener.api.mgmt.backlog = 512\nThe TCP send timeout for HTTP API.\n\nValue: Duration\nlistener.api.mgmt.send_timeout = 15s\nClose the TCP connection if send timeout.\n\nValue: on | off\nlistener.api.mgmt.send_timeout_close = on\n-------------------------------------------------------------------\nSystem Monitor\n-------------------------------------------------------------------\nEnable Long GC monitoring.\nNotice: don't enable the monitor in production for:\nhttps://github.com/erlang/otp/blob/feb45017da36be78d4c5784d758ede619fa7bfd3/erts/emulator/beam/erl_gc.c#L421\n\nValue: true | false\nsysmon.long_gc = false\nEnable Long Schedule(ms) monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: Number\nsysmon.long_schedule = 240\nEnable Large Heap monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: bytes\n\nDefault: 8M words. 32MB on 32-bit VM, 64MB on 64-bit VM.\nsysmon.large_heap = 8MB\nEnable Busy Port monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: true | false\nsysmon.busy_port = false\nEnable Busy Dist Port monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: true | false\nsysmon.busy_dist_port = true\n```. and this is my acl.conf file...\n```conf\n%%--------------------------------------------------------------------\n%%\n%% ACL\n%%\n%% -type who() :: all | binary() |\n%%                {ipaddr, esockd_access:cidr()} |\n%%                {client, binary()} |\n%%                {user, binary()}.\n%%\n%% -type access() :: subscribe | publish | pubsub.\n%%\n%% -type topic() :: binary().\n%%\n%% -type rule() :: {allow, all} |\n%%                 {allow, who(), access(), list(topic())} |\n%%                 {deny, all} |\n%%                 {deny, who(), access(), list(topic())}.\n%%\n%%--------------------------------------------------------------------\n{allow, {user, \"dashboard\"}, subscribe, [\"$SYS/#\"]}.\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", \"#\"]}.\n{deny, all, subscribe, [\"$SYS/#\", {eq, \"#\"}]}.\n```. ",
    "incowiz": "if you are testing in local host.\nplease refer: http://emqtt.io/docs/v2/guide.html#internal\n\n%% Allow clients from localhost to subscribe any topics\n\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", \"#\"]}\n\n%% Deny clients to subscribe '$SYS#' and '#\n\n{deny, all, subscribe, [\"$SYS/#\", {eq, \"#\"}]}\n. Hello Feng Lee.\nThank you for your quickly feedback.\nQuestion 1: is this suitable ec2 instance type for my purpose?\nA: It's enough for 10K SSL connections. It's better to deploy a LB to handle SSL offloading in the front of EMQ cluster in production.\n\u00f0  Could you provide your cost policy for commercial support? (please consider the below my conditions)\nn  Set up the Ubuntu machine on AWS with 10K SSL connections without any connection failure\nn  Emqtt auto clustering with with a dns-name of AWS load balancer.\nBest Regards,\nBrian,Jang. (Director of incowiz)\nFrom: Feng Lee [mailto:notifications@github.com] \nSent: Thursday, February 22, 2018 10:56 AM\nTo: emqtt/emqttd emqttd@noreply.github.com\nCc: incowiz inco@incowiz.com; Author author@noreply.github.com\nSubject: [SPAM] Re: [emqtt/emqttd] What is the best AWS EC2 type? - for 10k Concurrent SSL connection (#1507)\nQuestion 1: is this suitable ec2 instance type for my purpose?\nA: It's enough for 10K SSL connections. It's better to deploy a LB to handle SSL offloading in the front of EMQ cluster in production.\nQuestion 2: What is the correct setting value for apache jmeter?\nA: Please check the mqtt-jmeter https://github.com/emqtt/mqtt-jmeter  plugin.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub https://github.com/emqtt/emqttd/issues/1507#issuecomment-367541430 , or mute the thread https://github.com/notifications/unsubscribe-auth/AXxq6BeqyZCvqh7Cq1zTd6tDp9NNyqCXks5tXMlJgaJpZM4SNMzK .  https://github.com/notifications/beacon/AXxq6Hpefxu23zPsXMm_sUVUahLXFFO_ks5tXMlJgaJpZM4SNMzK.gif \n\n\uc774 \uc774\uba54\uc77c\uc740 Avast \uc548\ud2f0\ubc14\uc774\ub7ec\uc2a4 \uc18c\ud504\ud2b8\uc6e8\uc5b4\ub85c \ubc14\uc774\ub7ec\uc2a4 \uac80\uc0ac\ub97c \uc644\ub8cc\ud588\uc2b5\ub2c8\ub2e4.\nhttps://www.avast.com/antivirus\n. you can test your \"mongodb auth\" by using \"mqttfx\" tool.\n- with this tool, firstly make sure \"username\" and \"password\" is correct.\n. @emqplus \nthank you for your answer. \nbut \nDNS  auto-clustering still does not working\ni changed cluster.dns.app value to emq, thus now my all aws ec2 instance have the same cluster.dns.app value.\nif i check \"clustering status\" with the below command on \"emq@172.31.10.71\" node: \n./bin/emqttd_ctl cluster status \nCluster status: [{running_nodes,['emq@172.31.10.71']}]\nit shows only its status.\nHow can i fix it? please pass your opinion.\n. 1. Start one node in console mode:\n./bin/emqttd console\n- I started my EC2 with the above command\n\nCheck if the Erlang VM can lookup the DNS A records:\ninet_res:lookup(\"LB-xxxx-71698xxxx.ap-northeast-2.elb.amazonaws.com\", in, a).\n[{52,78,6,109},{13,124,5,130}]\nAll these 2 IP address is NOT current my EC2's IP address.\n\nHow can i re-fresh them with my current EC2's IP address?\n- should i remove data/mnesia?\n(another question: why these IP are appeared?)\nThank you very much.. ",
    "emanuelstanciu": "Hi @Gilbert-Wong \nAny news on the FreeBSD package? Would like to install eMQ on a pfSense box, so would like to minimise the amount of build requirements and Docker is also not an option.\nPlease let me know when you think a FreeBSD package will be available on the Downloads page.\nThanks. @jinfahua FreeBSD 11.2-RELEASE-p4 - based on https://docs.netgate.com/pfsense/en/latest/releases/versions-of-pfsense-and-freebsd.html\nThanks for your help. Hi @Gilbert-Wong, any (good) news on this build?\nI have seen this is slipping release after release. Do you have a timeframe in mind for enabling a build for FreeBSD?\nThanks for your time. ",
    "jinfahua": "@emanuelstanciu what's your freebsd version?. > Hi, can you provide your hardware information which would help us reproduce the problem you mentioned?\nI supplied you the hardware info.... @manas-chaudhari We are working on the issue, will let you know if having any update.. @manas-chaudhari The problem was fixed in the latest version, please check it out. Feel free to let us know if having any problems.. 1. Please make sure the EMQ X console can be accessed - by default, it can be visit at http://127.0.0.1:18083, for more info, you can refer to \n here.\n\nIf it can be accessed, and checked EMQ X is healthy, then you can try to use telnet command to check the port can be reached or not as mentioned by spring2maz. . > let me ask better question.\nwhat is minim hardware to achive handling emqx 40000 message/persecond from single node?\n\n\n\nThe message throughput is determined by several factors, you could refer to FAQ for the resource estimation.  \nI suggest you to make a performance test against your biz scenario, and different tools can be leveraged, such as JMeter MQTT plugin. . what's your bridge direction? From mosquitto to EMQ, or EMQ to mosquitto ?. So that should be check with mosquitto, nothing to configured in EMQ.. You can write an application to bridge message from mosquitto to EMQ by yourself. \nIf you can change conf of mosquitto, you can refer to this article. . Could you please check the dashboard of emqx, and it will show the number of message that EMQ X received. \nAlso, I would suggest to add a sleep time after mqtt.sendToMqtt(topic, 0, content);.\n100 threads without any sleep time between invocation of publish method will probably cause SDK failed to process. . Please refer to the link if you can read Chinese. English version will be online soon, and please tell us your email account if you'd like to get the English version right now.. Edge is still under testing, and will be available in the 1Q of 2019. . ",
    "haok3166": "Thanks for your reply. We have added our own prometheus exporter based on the HTTP API. Where to download the EMQ X Enterprise Edition?. Great, thanks.. ",
    "ricardoccpaiva": "any news on this @gihad / @emqplus ?. ",
    "HackToHell": "bump for anything regarding this. @emqplus . @isman-usoh Looks like the clustering layer only does a discovery on startup and doesn't refresh the node list after startup.\nThose all have been set up as per the docs. We are using the same config as the author present here https://github.com/felipejfc/emqtt-k8s/blob/master/emqtt.yaml. ",
    "NiekPeeters": "Any news on this? @emqplus. ",
    "sashaafm": "Bumping up @emqplus . I've now been able to migrate our ACL plugin by reading through the source code and altering the code accordingly, but I believe this proves that the docs are not up to date.. ",
    "huydinhle": "@turtleDeng  we are using 2.3.11, we are not planning to move to 3.0 just yet. I would like to try the 2.4-beta.1 preferably with docker image. Is there a place to download or get this docker image somewhere?. How about 2.4-beta.1 ? Do we have a plan to release 2.4 at some point? Or  emqx-statsd will be only supported in 3.0? \n@turtleDeng . ",
    "perroudchris": "Thanks for the answer . It works but I still have a problem. For example \nclient 1 ( id = client1) subscribed to $local/$share/group1/data with clean-session = false\nclient 2 ( id = client2) subscribed to $local/$share/group1/data with clean-session = false\nas soon as the 2 clients are there (connected), the shared subscription is correctly done, BUT... as soon as only one of these 2 clients is connected, the broker will still publish some messages on the other \"session\" and we'll have to wait the reconnection of the other client to recieve all messages... \nIs there a way  to avoid this ? Shared subscription with a control of the current nodes connections (still with persistence enabled, if we don't have any active client, it would be useful..). Yes it does. You're right but I wanted to know if there's a possibility to send messages only to \"real\" active clients (who has the mosquitto_sub launched for example) and still keep messages that have not been recieved by anyone (for example if my 2 clients have a problem and disconnect at the same time). \nIn summary : keep a persistence but only distribute the shared subscription to effective present and connected clients.  I don't think it's possible but I just wanted to be sure. \nIn every case, thanks a lot for your helpfull replies :) . Hello. That's exactly what I wanted to know. Thanks for the answer :). Thanks a lot :). Hello. With clean session (and emqttd 3.0.0), everything is ok with the scenario we built. But let's build this one: \n1.A/B/C/D connected with clean-session=false\n   2. A/B/C/D all shared-subscribe a same topic\n   3.  A/B/C/D get disconnected for some reason\n   4. 12 messages from clients are coming on the broker\n   5. A (alone) connects once again with clean-session= false\n      At the moment, he only sees 25% of these messages... is it possible to see the 12 messages and not only 3 ? \n. > Since a session can be persistent, it may also be used for shared and non-shared subscription at the same time, there is not going to be a generic enough solution out of the box.\n\nOne workaround for now is to use only clean session for shared subscribers.\nI am planing to add a connection state check in #1872. The idea is that shared dispatches will be negative-acked by the session if there is not an active connection so the sender session can pick the next member in the group (next depends on the dispatch strategy).\nThe current plan is to only add this check for QoS1 and QoS2 messages though.\n\nWas this (good) idea already implemented ? . Sadly I got the same result with QoS=0 as QoS=1 or 2. When one of my clients (mosquitto_sub, -clean-session=false) quits, the messages are still distributed to his session whereas all messages should be taken by the others \"still connected\" clients. . I think that I found something into the config : \nbroker.shared_dispatch_ack_enabled has to be true. Now, with this parameter, the messages are delivered only to online \"non-clean session\" subscribers.  That's already a good point\nSomething that is still missing : when all my clients are disconnected, there's no persistence of the messages when I'm using the \"$queue/\" prefix in my topic. Has somebody an idea ? \n. Ok I'll open another one. Thanks for your help. Thanks a lot @spring2maz . . ",
    "nagendraK6": "Thanks. ",
    "brianjang": "@zhengyupan \nHello.\ni would like to get some information for commercial support plan with below conditions: \n\nCould you provide your cost policy for commercial support? (please consider the below my conditions)?\nSet up the Ubuntu machine on AWS with 10K SSL connections without any connection failure\nEmqtt auto clustering with with a dns-name of AWS load balancer.\n. \n",
    "taoqf": "URI should be\nsh\nws://127.0.0.1:8083/mqtt\n. ",
    "vicary": "Found this during my search on docker auto cluster.\nELB points to instances\u2019 public IP while the instance itself usually has no knowledge of, without doing some tricky lookups. I assume the node is using private IP directly from the available network interface. (Private IPs usually starts with 172)\nExplicitly bind the node host to your public IP may work.. Overlay networking does not list all hosts as A records, more of a docker/moby issue than emqtt or Erlang/OTP.. ",
    "evdbovenkamp": "Thank you very much!. ",
    "lv12312": "@emqplus  The reason is that the server crash and restart automatically. The errors occurred when I benchmarked the performance.. @emqplus  Thank you!. ",
    "wivwiv": "JavaScript uses an event-driven, non-blocking I/O model. \nSubscribe and publish are almost executed at the same time. The client publishes a message without a topic before it was subscribe successful if you running slow network.\n```js\n...\nclient.on('connect', function () {\n    console.log('-------------')\nclient.subscribe('presence')\nsetTimeout(function publish() {\n            // Luckily 1000ms is enough\n            client.publish('presence', 'Hello mqtt')\n    }, 1000)\n\n})\n...\n```\nIt is necessary to use a callback function or a time drive to solve the timing problem.\n```js\n...\nclient.on('connect', function() {\n  console.log('-------------')\n  client.subscribe('presence', function callback(error) {\n    console.log(error && error.toString() || 'Subscribe Success')\n    client.publish('presence', 'Hello mqtt')\n  })\n})\n...\n```. \nAfter version 3, Application must be used.. @servucn We will use 24-hour formatting in next version.. ",
    "hung119": "it's worked for me.\nThanks for the response.. ",
    "hui6075": "the reason was cookie. thanks!. good fix!. @terry-xiaoyu thanks very much!. @terry-xiaoyu \nthanks for your comments!\n@HJianBo \nWe use several client theads to make a share subscription for consumer load balance.\nThe share subscription topic filter is a concrete value, so I have hard code it in emqttd_pubsub.erl, refactor add_subscriber/3 and del_subscriber/3, for the share subscription, only call add_local_subscriber/3 and del_local_subscriber. seems it can work.\n=============emqttd_pubsub.erl==============\nadd_subscriber(Topic, Subscriber, Options) ->\n    Share = proplists:get_value(share, Options),\n    Topic1 = binary_to_list(Topic),\n    case string:str(Topic1,\"/xxx/\") of\n        0 ->\n            case ?is_local(Options) of\n                false -> add_global_subscriber(Share, Topic, Subscriber);\n                true  -> add_local_subscriber(Share, Topic, Subscriber)\n            end;\n        _ ->\n            add_local_subscriber(Share, Topic, Subscriber)\n    end.\n=============emqttd_pubsub.erl==============. ",
    "petewasher": "Great, thanks for your help. I'll get started.. ",
    "dingzhengkai": "@terry-xiaoyu @HJianBo thanks for reply.\nAt that time, the utilization of cpu on my server was almost up to 100%(the emq erl process), but my server(or the emq server) did not run a lot of tasks, so i thought whether there was something wrong in emq.\nMy server was up about 60 days, i rebooted it to solve the problem.. ",
    "Marina190489": "Thanks! I saw that someone mentioned that this feature should be avail on next versions- any idea if that's true and when it may happen?. what is this workaround? you use 2 mosquitto brokers with a bridge between them?. Thanks.\nIs it possible in version 3?. ",
    "mshioz": "Thank you for your reply.\nI think I will investigate the subscriber.\nHowever, I am looking for a provisional countermeasure against this memory leak until the subscriber's investigation is completed.\n1) Since qos = 0 is used, how about changing mqtt.mqueue.store_qos0 in emq.conf from true to false? Does this change make sense? Also, please tell me what effect this change has.\nIf tentative correspondence is possible with other items in emq.conf, please tell me that item.\n2) Is there any way to delete stored messages? For example, if you can delete it by using some emqttd (or emqttd_ctl) command, please tell me that command.\nThank you.. Thank you for your detailed answer. It's a big help.\nYour answer has the following sentence.\n\"But in your case, your subscriber is online, the messages have already sent to the subscriber, but it does not consume messages from the receiving buffer of TCP stack.\"\nCan you guess anything about why messages are not being consumed from Receiving buffer of TCP stack?\nIn the current environment, the connection between emqtt and Subscriber is wirelessly connected, and this wireless connection may be rarely disconnected.\nIf \"offline\" also contains events that cause the connection to be abruptly disconnected, it seems valid to set mqtt.mqueue.store_qos0 = false, but how about that?\nThank you.. ",
    "shrestha-clipapp": "Hi Terry \nThank you for your reply. I have used http://emqtt.io/docs/v2/tune.html# link to tune my broker for reaching 1 Million connection. The machine size was the same i.e. m5.4xlarge AWS system which is 16 vCPUs, 64 GB RAM instance.\nThe case I was running today was with 180k normal notif connections(i.e. no chat was going on internally) and 75k chat clients(chatting with each other at 1 chat message/250 secs average each). So in total I had approx 250k connections. Things were running smoothly until I introduced another client which would be publishing 1 message to all the clients (checking if notifs were to be sent across at any given time). It was then that half my clients were brought down from the broker. Now neither the process limit or the file descriptor limit had been reached (according to the web dash board and the CPU load was no where close to maximum). I was also tracking the etop function that you had told but at that moment it crashed as well saying \n\"Timeout when waiting for process info from node 'emq@127.0.0.1'; exiting\nOutput server crashed: timeout\"\nNow I am not sure about the database because that seemed responsive with high memory consumption in some tables like mqtt_client and mqtt_subscriber which seemed to be expected with these number of clients. \nAlso the client records error as \"Connection lost\" or \"Connection Timeout\" as an exception.\nI am attaching all the zip files for all the logs here. Please have a look and let me know if you need anything else in order to resolve this issue. Again thanks for the reply.\nlogs.zip\nRegards\nShrestha. Hi Terry, Huangdan\nI am attaching today's and yesterday's log where we faced a similar issue again. This time I had activated the emqttd attach functions as you requested and they are also stored in the logs. Let me know if you need anything else. From the logs what I can understand that the error seems to be at line no 107 of \"src/emqttd_access_control.erl\". Please let me know for what reason this could happen or any other file or resource you need to reproduce this problem at your end. \nAny ideas/tips would be helpful to increase the number of connections.\nlogs05042018.zip\nThanks in advance\nShrestha. @terry-xiaoyu : I don't have any crash.dump files in the emqttd/log directory but only crash.log.x files which I have attached in the previous zip files. Is there any other place where it is possible to find this file? If you need any other copy of those files please let me know.\nRegards\nShrestha\n. Yeah I also believe that the VM has not crashed because we still have connections but they are reduced to half or less in number .\nI am using pure emqtt without any plugins and no authentication method for now as we are just load testing.\nRegards\nShrestha . Hi @huangdan \nI am trying to replicate a sample scenario for our app. Our app would use MQTT for 2 two things. One would be to push notifications to some or all the clients and other would be chat option which would let all the  clients talk to each other using EMQTT.\nTo test these scenarios all clients have one unique topic and one common topic which they are subscribed to. Hence in total for 250k clients there will be 500k subscriptions(2 per each client) with approx 250001 topics. To test this scenario I have setup 40% clients(of 250k clients i.e. 100k clients) which are chatting to each other using MQTT and other 60% (150k clients) which are just on standby(not chatting with each other). I let The number of messages exchanged for each chatting clients is on average 1 message per 250 seconds. These chatting messages are on QoS 2 level. For push notification I am sending one message to all clients(250k clients)  at QoS level 1  in one go. The size of the message is just 4 sentences of text so it would be in bytes for now. It is when I send the QoS level 1 (push notification) when the broker seems to drop clients.\nAs for the the command \"./bin/emqttd_ctl listeners\" this is the response I am getting. This response is not after the crash but after I restarted my broker. If you want I will reproduce the scenario again and run this command.  \nlistener on mqtt:api:0.0.0.0:8080\n  acceptors       : 4\n  max_clients     : 64\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:wss:8084\n  acceptors       : 4\n  max_clients     : 64\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:ssl:8883\n  acceptors       : 16\n  max_clients     : 1024\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:ws:8083\n  acceptors       : 4\n  max_clients     : 102400\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:tcp:0.0.0.0:1883\n  acceptors       : 128\n  max_clients     : 1000000\n  current_clients : 0\n  shutdown_count  : []\nlistener on mqtt:tcp:127.0.0.1:11883\n  acceptors       : 4\n  max_clients     : 102400\n  current_clients : 0\n  shutdown_count  : []\nlistener on dashboard:http:18083\n  acceptors       : 4\n  max_clients     : 512\n  current_clients : 0\n  shutdown_count  : []\nPlease let me know if you need any other information to resolve this issue.\n. ",
    "wujunze": "I can use MQTT v5.0.\nWhere have ASSChat's source code?\nFrom the document, ASSChat is able to keep the message that has not been received offline and the User can pull it back without losing the message, right?\nThanks  @terry-xiaoyu . That sounds great.\nCould you tell me when ASCHAT will release the implementation code with iOS or Android SDK?. ",
    "FartParty": "Hi @terry-xiaoyu, I ended up giving up on this and moving to terminating SSL with an nginx reverse proxy using stream.  In addition to modifying depth, I would need the ability to authorize a specific issuer that I'm looking for - I didn't see any options for that in the emqttd config.\nIn the end, I have to satisfy two conditions:\n1. Authentication (client cert)\n2. Authorization (check issuer DN, reject if not correct)\nMy ssl_dist.conf was this:\n[{server,\n  [{certfile, \"certs/server/mqtt.pem\"},\n   {keyfile, \"certs/server/mqtt.key\"},\n   {cacertfile, \"certs/server/chain.pem\"},\n   {verify, verify_peer},\n   {fail_if_no_peer_cert, true},\n   {secure_renegotiate, true},\n   {depth, 3}\n   ]},\n {client,\n  [{secure_renegotiate, true},\n   {depth, 3},\n   {cacertfile, \"certs/server/chain.pem\"}\n  ]}].. My nginx proxy config is as follows:\n```\nuser  nginx;\n    worker_processes  1;\nerror_log  /dev/stdout info;\npid        /var/run/nginx.pid;\n\nevents {\n    worker_connections  1024;\n}\n\nstream {\n\n  # replace the CN= with the issuer you want to filter on\n  map $ssl_client_i_dn $allowed_client {\n      CN=[redacted] emqttd;\n      CN=[redacted] emqttd;\n      default failconn;\n  }\n\n  log_format basic '$remote_addr [$time_local] '\n             '$protocol $status $bytes_sent $bytes_received '\n             '$session_time';\n\n  upstream emqttd {\n    server 127.0.0.1:1883;\n  }\n\n  # make sure to use a port that isn't actually lisetening!\n  upstream failconn {\n    server 127.0.0.1:7777;\n  }\n\n  server {\n      listen 9999 ssl;\n      tcp_nodelay on;\n\n      # map these into the nginx container using a volume secret\n      ssl_certificate       /etc/nginx/ssl/tls.crt;\n      ssl_certificate_key   /etc/nginx/ssl/tls.key;\n      ssl_trusted_certificate /etc/nginx/ssl/CA/ca.pem;\n      ssl_client_certificate /etc/nginx/ssl/CA/ca.pem;\n      ssl_verify_client on;\n      ssl_verify_depth 3;\n\n      ssl_protocols TLSv1.2;\n      ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';\n      ssl_prefer_server_ciphers on;\n\n      ssl_session_cache shared:SSL:20m;\n\n      error_log /dev/stdout info;\n      access_log /dev/stdout basic;\n\n      proxy_protocol on;\n      proxy_pass $allowed_client;\n   }\n}\n\n```\nThis could probably be done better if I actually had something that rejected sessions listening on 7777 or something, but the end result is that a connection refused ends in a session that immediately terminates even though it passed a depth check.. ",
    "csilvav": "Hi @viveklamba I think that here is not the right place to post questions like this. However about your question, you can use any java client lib that implement the MQTT protocol or event WebSockets thru mqtt if you want to connect from front-end web app.\nYou can use a nice toolkit called Vert.x, they have an implementation of MQTT client, you can go here https://vertx.io/docs/vertx-mqtt/java/. Also you can use another popular lib called Paho, here is the doc https://www.eclipse.org/paho/clients/java/.\nI hope, I've helped.. ",
    "qwyinxiang": "Sorry\uff0cI express incorrect, I want to know does the mqtt client support token authentication? not the broker.\nMy broker need token authentication as username, but I don't know how to config the mqtt client?\nwhen I set my client as \"client->setUsername(strAccessToken);\", my program crashed?. ",
    "hmonadjem": "For me, this happens even if all subscriptions have the same QoS, if so then its a bug. Correct? . ",
    "ahmadalli": "this is the docker repo's issue. take a look at this line: ENV EMQ_VERSION=v2.3.5. it's still creating the image using the v2.3.5\n. ",
    "spydmobile": "it would seem that this combo produces an extra get request which causes emq to return a 404 error. switching clients solves the issue but it would be nice for this to just work..... ",
    "bhzhu203": "I finally find out not the \"TIME_WAIT\" problem.\nemqttd have  a quite  high CPU usage and less memory uage .\nOnly having about 300 clients  (about  400~  ESTABLISHED connection)  ,there is 20% CPU usage and 10% sys CPU, 1.3 load . When we have about 800 clients ,it is showing that 85% CPU usage and 15% sys CPU, 3.8 load  in 4 core 8G machine (aliyun-network-performace-instance).\nI  think there are some emqtt performance issues.Because our other project using emqtt in  1000~  ESTABLISHED connections only loads on 1 Core 1GB machine  of 0.3 load.\nSystem:centos6 \n4cores 8G machine \nErlang MQTT Broker | 2.1.2/ 2.3.7also\n300 clients  (about  400~  ESTABLISHED connection)  ,there is 20% CPU usage and 10% sys CPU\nperf top  -g --children  -p 2097\n+   13.62%     0.95%  libc-2.12.so        [.] __sched_yield\n+   12.66%    12.35%  beam.smp            [.] process_main\n+    8.28%     8.28%  beam.smp            [.] 0x00000000000f3020\n+    7.81%     7.81%  beam.smp            [.] 0x00000000000f303b\n+    6.80%     6.80%  [kernel]            [k] schedule\n+    6.63%     6.63%  [kernel]            [k] _spin_unlock_irqrestore\n+    6.19%     0.08%  libc-2.12.so        [.] syscall\n+    3.27%     0.04%  libc-2.12.so        [.] __libc_writev\n+    2.80%     0.00%  [unknown]           [.] 0x000000000000004b\n+    2.56%     2.53%  beam.smp            [.] erts_thr_progress_finalize_wait\n+    2.37%     0.29%  [vdso]              [.] __vdso_clock_gettime\n+    2.04%     2.04%  [kernel]            [k] __audit_syscall_exit\n+    1.86%     1.86%  beam.smp            [.] 0x00000000000f3029\n+    1.80%     0.07%  libpthread-2.12.so  [.] __libc_recv\n+    1.74%     0.00%  beam.smp            [.] 0xffffffffffcf3020\n+    1.67%     1.67%  beam.smp            [.] 0x00000000000f302e\n+    1.65%     0.00%  beam.smp            [.] 0xffffffffffcf303b\n+    1.65%     0.12%  libc-2.12.so        [.] epoll_wait\n+    1.46%     1.46%  [kernel]            [k] finish_task_switch\n+    1.36%     1.36%  [kernel]            [k] system_call_after_swapgs\n+    1.33%     1.32%  beam.smp            [.] erts_thr_progress_prepare_wait\n+    1.24%     1.24%  beam.smp            [.] 0x00000000000f3039\n+    1.12%     1.12%  beam.smp            [.] 0x00000000000f3034\n+    1.00%     0.16%  librt-2.12.so       [.] clock_gettime\n+    0.80%     0.78%  libpthread-2.12.so  [.] pthread_getspecific\n+    0.71%     0.04%  libc-2.12.so        [.] epoll_ctl\n+    0.71%     0.00%  [unknown]           [.] 0x00007fed2db861c0\n+    0.70%     0.00%  [unknown]           [.] 0x00007fed2db8a280\n+    0.70%     0.70%  beam.smp            [.] 0x00000000000e53d3\n+    0.70%     0.00%  [unknown]           [.] 0x00007fed2db8e\nstrace -cfp 2097\n% time     seconds  usecs/call     calls    errors syscall\n\n99.73 3215.192496        3711    866288     56852 futex\n  0.17    5.402413           1   7152597           clock_gettime\n  0.04    1.443275           2    873275        12 writev\n  0.04    1.305460           1   1393424    619149 recvfrom\n  0.02    0.619867           1   1238423       185 epoll_ctl\n  0.00    0.055394           1    103198           epoll_wait\n  0.00    0.005733           1      4556           fcntl\n  0.00    0.005134           1      4500      2222 accept\n  0.00    0.004677           2      2455           close\n  0.00    0.003018           1      3506      1050 getpeername\n  0.00    0.000598          11        55           munmap\n  0.00    0.000457           1       653           sched_yield\n  0.00    0.000383           1       396           gettimeofday\n  0.00    0.000244           8        32           mmap\n  0.00    0.000146           2        81           stat\n  0.00    0.000131           2        81           open\n  0.00    0.000044           1        81           lseek\n  0.00    0.000000           0        85           read\n  0.00    0.000000           0         3           restart_syscall\n\n100.00 3224.039470              11643689    679470 total\n\n\nBy the way, centos6 have some problem showing the right system  load  in \"top\" command\n\nOur each session  often have 10000+ messages  in minutes. \nThis project is a realtime comunication game program between teachers and students in international network.. @terry-xiaoyu Do you know how to solve this?. Do you talk about disk IO?  As you see ,the 'wa'  in the top command is 0%.I think it is network IO.\nWe run the EMQTT on Alicloud machines which may use virtio network drivers. Is there any problem in virtio?\nAnd some situations, I find out the 'sy' of CPU is quite high in the top command . /proc/softirqs  shows that some keys on one of the CPUs are higher than others.. Yes , I also find that EMQTT has  performance decline in multicore CPUs machine .\n\n. ",
    "SITSGRestia": "Thank you. I have modified the emq.conf. It's working now. This configuration have on effect by restart the emqttd service. It works after rebooting the system.. ",
    "dramasamy": "Hi Terry-xiaoyu, Thanks a lot. But is it possible to persist the message without the subscription and later subscribe and get the data?. ",
    "michael-c-jones": "@terry-xiaoyu this is also a requirement for my project, is this something that can be done ?  Either now or in the future ?. ",
    "erifghjkk": "Here are all the active/uncommented lines within the config file:\ncluster.name = emqcl1 # Our custom cluster name\ncluster.discovery = manual\ncluster.autoheal = on\ncluster.autoclean = 5m\nnode.name = dev1@XX.X.X.X # Local IP from Azure vnet\nnode.cookie = emqsecretcookie\nnode.smp = auto\nnode.kernel_poll = on\nnode.async_threads = 32\nnode.process_limit = 256000\nnode.max_ports = 65536\nnode.dist_buffer_size = 8MB\nnode.max_ets_tables = 256000\nnode.fullsweep_after = 1000\nnode.crash_dump = log/crash.dump\nnode.proto_dist = inet_tcp\nnode.dist_net_ticktime = 60\nnode.dist_listen_min = 6369\nnode.dist_listen_max = 6379\nlog.dir = log\nlog.console = console\nlog.console.level = error\nlog.error.file = log/error.log\nlog.error.size = 10485760\nlog.error.count = 5\nlog.crash = on\nlog.crash.file = log/crash.log\nlog.syslog = on\nlog.syslog.level = error\nmqtt.allow_anonymous = true\nmqtt.acl_nomatch = allow\nmqtt.acl_file = etc/acl.conf\nmqtt.cache_acl = true\nmqtt.max_clientid_len = 1024\nmqtt.max_packet_size = 64KB\nmqtt.websocket_protocol_header = on\nmqtt.keepalive_backoff = 0.75\nmqtt.conn.force_gc_count = 100\nmqtt.client.idle_timeout = 30s\nmqtt.client.enable_stats = off\nmqtt.session.max_subscriptions = 0\nmqtt.session.upgrade_qos = off\nmqtt.session.max_inflight = 32\nmqtt.session.retry_interval = 20s\nmqtt.session.max_awaiting_rel = 1000\nmqtt.session.await_rel_timeout = 30s\nmqtt.session.enable_stats = on\nmqtt.session.expiry_interval = 2h\nmqtt.session.ignore_loop_deliver = false\nmqtt.mqueue.type = simple\nmqtt.mqueue.max_length = 1000\nmqtt.mqueue.low_watermark = 20%\nmqtt.mqueue.high_watermark = 60%\nmqtt.mqueue.store_qos0 = true\nmqtt.broker.sys_interval = 1m\nmqtt.pubsub.pool_size = 8\nmqtt.pubsub.async = true\nmqtt.bridge.max_queue_len = 10000\nmqtt.bridge.ping_down_interval = 1s\nmqtt.plugins.etc_dir =etc/plugins/\nmqtt.plugins.loaded_file = data/loaded_plugins\nlistener.tcp.external = 0.0.0.0:1883\nlistener.tcp.external.acceptors = 16\nlistener.tcp.external.max_clients = 102400\nlistener.tcp.external.access.1 = allow all\nlistener.tcp.external.backlog = 1024\nlistener.tcp.external.send_timeout = 15s\nlistener.tcp.external.send_timeout_close = on\nlistener.tcp.external.nodelay = true\nlistener.tcp.external.reuseaddr = true\nlistener.tcp.internal = 127.0.0.1:11883\nlistener.tcp.internal.acceptors = 4\nlistener.tcp.internal.max_clients = 102400\nlistener.tcp.internal.backlog = 512\nlistener.tcp.internal.send_timeout = 5s\nlistener.tcp.external.send_timeout_close = on\nlistener.tcp.internal.nodelay = false\nlistener.tcp.internal.reuseaddr = true\nlistener.ssl.external = 8883\nlistener.ssl.external.acceptors = 16\nlistener.ssl.external.max_clients = 1024\nlistener.ssl.external.access.1 = allow all\nlistener.ssl.external.tls_versions = tlsv1.2 # We would like to restrict traffic to TLSv1.2\nlistener.ssl.external.handshake_timeout = 15s\nlistener.ssl.external.keyfile = etc/version1/server-key.pem # Our password-protected server key, des3 encrypted - Note, an unencrypted no-password server key called serverkeynopass.pem has also been tried without success\nlistener.ssl.external.certfile = etc/version1/server-cert.pem # Our custom server certificate\nlistener.ssl.external.cacertfile = etc/version1/ca-cert.pem # Our custom self-signed CA certificate\nlistener.ssl.external.verify = verify_peer # Disabled by default but we enable\nlistener.ssl.external.fail_if_no_peer_cert = true # Disabled by default but we enable\nlistener.ssl.external.reuseaddr = true\nlistener.ws.external = 8083\nlistener.ws.external.acceptors = 4\nlistener.ws.external.max_clients = 102400\nlistener.ws.external.access.1 = allow all\nlistener.ws.external.backlog = 1024\nlistener.ws.external.send_timeout = 15s\nlistener.ws.external.send_timeout_close = on\nlistener.ws.external.nodelay = true\nlistener.ws.external.reuseaddr = true\nlistener.wss.external = 8084\nlistener.wss.external.acceptors = 4\nlistener.wss.external.max_clients = 64\nlistener.wss.external.access.1 = allow all\nlistener.wss.external.tls_versions = tlsv1.2,tlsv1.1,tlsv1\nlistener.wss.external.handshake_timeout = 15s\nlistener.wss.external.keyfile = etc/certs/key.pem\nlistener.wss.external.certfile = etc/certs/cert.pem\nlistener.wss.external.cacertfile = etc/certs/cacert.pem\nlistener.wss.external.verify = verify_peer\nlistener.wss.external.fail_if_no_peer_cert = true\nlistener.wss.external.backlog = 1024\nlistener.wss.external.send_timeout = 15s\nlistener.wss.external.send_timeout_close = on\nlistener.wss.external.reuseaddr = true\nlistener.api.mgmt = 0.0.0.0:8080\nlistener.api.mgmt.acceptors = 4\nlistener.api.mgmt.max_clients = 64\nlistener.api.mgmt.access.1 = allow all\nlistener.api.mgmt.backlog = 512\nlistener.api.mgmt.send_timeout = 15s\nlistener.api.mgmt.send_timeout_close = on\nsysmon.long_gc = false\nsysmon.long_schedule = 240\nsysmon.large_heap = 8MB\nsysmon.busy_port = false\nsysmon.busy_dist_port = true\nThe EMQ config specifies a server key, but this password is never required or prompted by emqttd. We tested using server key without a password yet our client still has same problem connecting to this EMQ broker. (However, our client connects to an HAProxy server using the same CA cert.)\nThanks. ",
    "petergerten": "@erifghjkk did you also change the path in /emqx/etc/ssl_dist.conf?. @terry-xiaoyu so it this a bug? As you are describing a workaround by disabling auth.\nI have same problem as the orignal poster but I need auth for other users that are not using certs.. @Gilbert-Wong thanks. Yes I did that here: https://github.com/emqx/emqx/issues/1932. @jerry-chao thanks.\nIf I add username and password I get this error:\nUsername 'certuser' login failed for auth_modules_not_found\nI don't know what that means (I have mongo auth plugin enabled which works fine using wss).\nBut despite the error message the username did not get replaced with the cert cn.\n```\nlistener.ssl.external.peer_cert_as_username = cn\nlistener.ssl.external.verify = verify_peer\n```. @jerry-chao \nAs I said it is activated. I use it with a wss client succesfully. When I then try to use ssh/cert I get the auth_modules_not_found error.\nemqx_ctl plugins list shows\nPlugin(emqx_auth_mongo, version=3.0, description=EMQ X Authentication/ACL with MongoDB, active=true). @jerry-chao again - I am using a wss client with mongodb auth successfully.\nI also verified with\ndb.mqtt_user.find()\nthat I actually have users in there. (In my case I have 5 users)\n. @jerry-chao Can you please also try to do this with ssl/cert? - as this is my use case that fails.. @Gilbert-Wong I still could not solve the issue. See CN here:\n```\nopenssl x509 -noout -subject -in c.pem\nsubject=C = AU, ST = Some-State, O = Internet Widgits Pty Ltd, CN = Device 01\n```. @jerry-chao \n\nI try it with ssl/cert and below is my command\nmosquitto_sub -h localhost -p 8883 --insecure --cafile etc/certs/cacert.pem -u demo -P 123456  -i demotcp  -t 'demo'\nI am confused. Where are you using a cert in that example?\nI can't see the \"--cert\" and \"--key\"  parameters. There is only the cert for the rootCA.. @jerry-chao thanks! Will try this.. @cocowalla I ran into the same issue and could not solve it yet https://github.com/emqx/emqx/issues/1932. \n",
    "solomonwzs": "My demand is, a client has subscribed a topic, but the admin want to prevent messages delivered to this client, or filter messages.\nDo you have any suggestion to implement it?\nThx.\n. Hi.\nI mean the client has already subscribe the specific topics. For example, there are some people in a chat room, and I want to kick someone out of the room, but I can not ensure the client unsubscribe the room topics, and also I can not interrupt the client connection because it maybe subscribe other topics, so I want to prevent the messages of this room topics delivered to this client.\nThx.. ",
    "enix223": "I got the same problem as yours, what I am trying to solve this problem is using REST API to unsubscribe the topic after ACL rule is updated. \nFor your case, when the group admin kick someone, and you will remove that user from ACL list, and you can also make a unsubscribe request through REST API.. @Gilbert-Wong Thank you for your reply.\nBut changing the cache_acl config could only impact the publisher, but not the subscriber.\nWhat I need to do is prevent the subscriber from receiving that message instead of preventing the publisher to publish message.. ",
    "GiviMAD": "I'm facing the same error connecting to mongo running with -replSet option, with just one mongo instance. With mongo version 3.6.3 and emqtt version 2.3.8. Running with docker-compose. config:\nauth.mongo.r_mode=slave_ok\nauth.mongo.server=mongodb:27017\nlistener.ssl.external.acceptors=32\nauth.mongo.super_query.collection=mqttusers\nnode.max_ets_tables=2097152\nnode.process_limit=2097152\nauth.mongo.w_mode=unsafe\nauth.mongo.auth_query.password_field=password,salt\nauth.mongo.acl_query.collection=mqttacls\nauth.mongo.type=rs\nlistener.ws.external.acceptors=16\nmqtt.allow_anonymous=false\nnode.name=emq-0@10.244.42.6\nlistener.tcp.external.max_clients=1000000\nauth.mongo.database=dbName\nauth.mongo.rs_set_name=rs0\nauth.mongo.auth_query.password_hash=salt,bcrypt\nlistener.ssl.external.max_clients=500000\nauth.mongo.auth_query.collection=mqttusers\nnode.max_ports=1048576\nlistener.tcp.external.acceptors=64\nlog.console=console\nlistener.ws.external.max_clients=250000\nWith plugins: emq_recon,emq_modules,emq_retainer,emq_dashboard,emq_auth_mongo\nError:\n(emq-0@10.244.42.6)1> 12:16:42.354 [error] gen_server <0.3807.0> terminated with reason: killed\n(emq-0@10.244.42.6)1> 12:16:42.354 [error] CRASH REPORT Process <0.3807.0> with 1 neighbours exited with reason: killed in gen_server:decode_msg/9 line 410\nMongo running without authentication, same result with authentication enabled:\nmongod --replSet rs0 --bind_ip_all\nOther container is able to connect the db to create the plugin tables.\nWhen mongo is running without the replSet option everything works fine. \nAny ideas?\nThanks. ",
    "gwnpeter": "me too,\nit stop at  line :  @for /f \"delims=\" %%Z in ('%%create_dir_cmd%%') do @(  \nEMQ cannot start on windows server core 1803 #1600\nmaybe the same problem. ",
    "utkarshns": "@terry-xiaoyu \nThanks for the prompt reply.\nSetup:\nCluster: emq@node1, emq@node2\nTCP connection load balanced with HAProxy.\nIf I write a plugin and deploy it on both, then:\nThe remote client publishing the data to emq@node1 will trigger the callback on node1 only and the remote client publishing data to emq@node2 will trigger callback only on node2.\nThen onwards the callback functions on both nodes will write the points to the DB. Correct? \n. @terry-xiaoyu\nThank you. This is pretty crisp.\nI will give it a go.. I have a similar setup, in my case there wont be any data loss but there will surely be problems with serving realtime data to clients.\nIt would be great if there emqtt cluster management allows for re-connection on such events. . That, technically isn't in the scope of the mqtt-broker.\nHowever, you can try out ngx-mqtt, an angular lib for mqtt.\nURI for mqtt on ws(s) is specified in the docs here.\nSo, connect to ws(s)://host:8083(4)/mqtt\nAfter connecting, you can follow the ngx-mqtt docs to handle subs, pubs, etc.. Client side randomizer would be a thing but you will have to update the list of nodes in the client app whenever a change occurs in the cluster.\nI am personally using HAProxy (leastconn) and balancing both ssl and wss, works well.\nNetsplit b/w cluster nodes is something to think about though.. In my setup all the traffic goes through the LB.\nChecked this using the Security Groups on AWS. Also the clients tab in Emq Dashboard shows every clients' IP to be the LB's IP.\n@terry-xiaoyu It would be great if you can help us configure HAProxy to handover the connection to the broker itself, so the HAProxy only allots the node and doesnt handle the connection itself.\nBoth, the WSS and TCP are handled entirely by HAP.\nMy haproxy config file:\nhttps://gist.github.com/utkarshns/423aaafb9bbe4b3fabe6840f5f6c24a3. No, in the dashboard itself. Will try the config files.. @all\nAnybody tried such a thing?. Hello Gilbert!\nSure. Please find the haproxy config: https://gist.github.com/utkarshns/423aaafb9bbe4b3fabe6840f5f6c24a3#file-haproxy-cfg\nTrying to use proxy-protocol v1/v2 doesn't work.\nserver node_2 node2.example.com:8084 check-send-proxy send-proxy-v2\nAlong with the needed changes made in emq.conf\nlistener.wss.external.proxy_protocol = on            listener.wss.external.proxy_protocol_timeout = 3s\nWith the proxy-protocol enabled, no client is able to connect to the broker using wss. However, the same proxy-protocol config works for unsecured 1883 (mqtt).\nAlso, I would like to exercise TLS/SSL termination as I see that the default number of max wss connections is pretty low(64).. ",
    "gmatt76": "Actually no, I guess it got lost when we updated the image of the container.. \nHi, the issue happened again. Inside the /opt/emqttd/log, the only files present were the error.log and crash.log (attached). I have also searched for erl_crash.dump but I was not able to find it anywhere.\nThanks,\nGianluca\ncrash.log\nerror.log\n. \nWe are running a single EMQ node. . ",
    "lhucinequr": "Thank you for the quick reply\nCould you please give some recommendations for this case.\nWhat I'm trying to achieve here is to avoid the situation where the cluster is in a netsplit situation but both nodes continue to accept the connections as if nothing has happened.\nWould an odd number of nodes in the cluster help resolve the situation?. Any news concerning this?. Thank you for your reply.\nI was thinking, every time there is a \"stateful\" cluster(read shared state) there should be some sort of quorum notion behind it.\nIt does not seem to be the case for EMQTT.\nAn isolated node should never continue to accept clients when it knows that it is not in the majority.\n. ",
    "bharat-mehta": "@terry-xiaoyu  Thanks  Are there any limitations of using it besides:\nQos = 0\nCleanSession = true. @terry-xiaoyu Also is $fastlane good for backend subscription with wildcards ?\n . @terry-xiaoyu thanks, I am using redis auth/acl plugin for the mentioned redis server and that works . @terry-xiaoyu Thanks for your quick reply. I have done the same configuration which you mentioned. However the authentication is failing, are there any private claims required in JWT payload for emq ?  Just to clarify, I am passing the JWT token in password field for authentication. @terry-xiaoyu  Thanks for your input. The settings which you mentioned worked fine.I have one more question regarding ACLs in emq. Like I mentioned earlier, I am using redis for storing the acls. Does emq uses any caching when it comes to reading acls for clients. Can you please throw some light on how this caching works and what is the eviction logic. . Congratulations to your team for building a fantastic broker. My team is eagerly waiting for the 3.0 release. Its promised features are important for the upcoming versions of our applications. Could you please tell me the release date for the upcoming 3.0 release.. @Gilbert-Wong So does it mean that with $queue there is no load balancing ?. @Gilbert-Wong  Thanks for your detailed response. Any idea on the emqx-3.0 release time ?. ",
    "abhi-dwivedi": "@terry-xiaoyu \nCould you please let us know from dashboard what should be the values for  below feilds which is mention in the screen shot:\n\nwe are getting below error:\n5/11/2018 4:50:46 PM===== Fri May 11 11:20:46 UTC 2018\n5/11/2018 4:50:46 PM11:20:46.244 [error] Both fuzzy and strict match! should not happen\n5/11/2018 4:50:46 PM11:20:46.245 [error] Both fuzzy and strict match! should not happen\n5/11/2018 4:50:46 PM11:20:46.245 [error] Both fuzzy and strict match! should not happen\n5/11/2018 4:50:46 PM11:20:46.245 [error] Both fuzzy and strict match! should not happen\n5/11/2018 4:50:46 PM11:20:46.245 [error] Both fuzzy and strict match! should not happen\n5/11/2018 4:50:46 PM11:20:46.245 [error] Both fuzzy and strict match! should not happen\n5/11/2018 4:50:46 PM11:20:46.245 [error] MGMT update_plugin_configs error:error\n. ",
    "yuregir": "@huangdan  Thank you. ",
    "jingsong-liu": "@terry-xiaoyu \nStable: emqttd-2.2.0 released on 2017/07/08\nI get it from http://emqtt.io/downloads/stable/windows10. More information I hope can help :\nNormally I use Powershell, all the command I run before is in powershell because windows server core only support powershell.\nBut there is a tricky way to open CMD: using remote desktop login windows server 1803, it show a CMD.\nSo today I did another test:\nUsing command prompt to run emqttd install/start/stop/uninstall, it works as expected.\nI think the problem is the script under bin\\ folder is not compatible with powershell.\nAlso, using bin\\emqttd install created window service  emqttd2-x seems not work correctly . It cannot managed by Windows Service Management Tools or Get/Start/Stop-Service. \nI it will be greatly useful if EMQ server has lanuch and control script support powershell, maybe a dedicated ps1 script is necessary because almost all EMQ for windows product situations are actually run on windows server,  not windows 7 or windows 10.\n. ",
    "haok316": "Is this feature added to the latest version? With the increasing popularity of NATS, this feature is very useful.. ",
    "brad-plumewifi": "@turtleDeng \nIn this case, the directory did not exist prior to the package being installed.  See steps below.\n$ file /var/lib/emqttd\n/var/lib/emqttd: cannot open `/var/lib/emqttd' (No such file or directory)\n$ dpkg -l | grep emqttd\n$\n$ dpkg -i emqttd-ubuntu16.04-v2.3.8_amd64.deb \nSelecting previously unselected package emqttd.\n(Reading database ... 243229 files and directories currently installed.)\nPreparing to unpack emqttd-ubuntu16.04-v2.3.8_amd64.deb ...\nUnpacking emqttd (2.3) ...\nSetting up emqttd (2.3) ...\nAdding group emqtt' (GID 132) ...\nDone.\nAdding system useremqtt' (UID 124) ...\nAdding new user emqtt' (UID 124) with groupemqtt' ...\nNot creating home directory `/var/lib/emqttd'.\nProcessing triggers for systemd (229-4ubuntu21.2) ...\nProcessing triggers for ureadahead (0.100.0-19) ...\n$ file /var/lib/emqttd/\n/var/lib/emqttd/: directory\n$ dpkg -l | grep emq\nii  emqttd                                      2.3                                          amd64        Erlang MQTT Broker\n . ",
    "yuridiniz": "Is there anything the community can do to help with the publishing process on the Docker Hub platform?. ",
    "chenxuuu": "ummmm, I mean like this:\nfor all clinets(not include localhost)\nsubscribe topic \"aaa/12345/bbb\" : allow\nsubscribe topic \"aaa/23456/bbb\" : allow\nsubscribe topic \"aaa/34567/ccc\" : allow\nsubscribe topic \"aaa/45678/bbb\" : allow\nother subscribe topic like \"aaa/\"+somthing+\"/bbb\" : allow\nsubscribe topic \"aaa/+/bbb\" : deny\nsubscribe topic \"aaa/12345/#\" : deny\n(deny all subscribe with \"+\" and \"#\" symbol ,not include localhost)\n. ",
    "krittanon-w": "Thanks for the prompt reply\n1. How should I do to get the same result (Mosquitto, Hivemq)\n2. I think this difference should solve because most people set clean_session = false to get old messages that clients can't receive and retian=true to get the last message. so that, when developer set those flag It should presents the ability of each flag. But now, EMQ can choose just one feature (clean_sessen or retain).\n3. from 2. if there are some project wanna move to use your broker (EMQ), the code that they have should be compatible with every broker and your broker (EMQ). @Gilbert-Wong Thankyou. Hi, @Gilbert-Wong you said \"This bug has been fixed in 2.3.11\" but I see only 2.3.10 in release tab and for that release 2.3.10 It has no release note that reference or tag to any issue. is there something incorrect?\n. @Gilbert-Wong Thankyou . ",
    "DavidLiuXh": "Pay attention to this problem.. Sorry, my own problem.. ",
    "dedupely": "Thanks @terry-xiaoyu this worked perfectly.\n@utkarshns I actually installed mqttjs and it connected perfectly with emqtt's websockets.. ",
    "marcotuna": "@terry-xiaoyu Thanks for your answer. The problem is that I am running this on a FreeBSD Jail which bridges the interface with the main host, this ports will be listening on multiple addresses and I don't want that. Is there any particular reason why I shouldn't disable this? Can I configure this to listen on 127.0.0.1 or something?. ",
    "silencecorner": "testing in istio 1.0 in my k8s cluster\nemqtt.rbac.yaml\nbash\nkubectl create namespace emqtt\nkubectl apply -f emqtt.rbac.yaml\n```yaml\nemqtt.rbac.yaml\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: emqtt\n  namespace: emqtt\n\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: emqtt\n  namespace: emqtt\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - endpoints\n    verbs:\n      - get\n\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: emqtt\n  namespace: emqtt\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: emqtt\nsubjects:\n- kind: ServiceAccount\n  name: emqtt\n  namespace: emqtt\n```\nemqtt-deployment.yaml\nbash\nkubectl apply -f emqtt-deployment.yaml\n```yaml\nemqtt-deployment.yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: emqtt\n  namespace: emqtt\n  labels:\n    app: emqtt\nspec:\n  ports:\n    - port: 1883\n      targetPort: 1883\n      name: mqtt\n      nodePort: 1883\n    - port: 8883\n      name: mqttssl\n    - port: 8080\n      name: mgmt\n    - port: 18083\n      nodePort: 18083\n      name: dashboard\n    - port: 4369\n      name: mapping\n  type: LoadBalancer\n  selector:\n    app: emqtt\n\napiVersion: apps/v1beta1\nkind: StatefulSet\nmetadata:\n  name: emqtt\n  namespace: emqtt\nspec:\n  replicas: 3\n  serviceName: emqtt\n  template:\n    metadata:\n      labels:\n        app: emqtt\n    spec:\n      serviceAccountName: emqtt\n      containers:\n      - name: emqtt\n        image: emqx/emqx:v3.0-rc.5\n        ports:\n          - containerPort: 1883\n          - containerPort: 8883\n          - containerPort: 8080\n          - containerPort: 18083\n          - containerPort: 4369\n          - containerPort: 4370\n          - containerPort: 6369\n          - containerPort: 6370\n          - containerPort: 6371\n          - containerPort: 6372\n          - containerPort: 6373\n          - containerPort: 6374\n          - containerPort: 6375\n          - containerPort: 6376\n          - containerPort: 6377\n          - containerPort: 6378\n        readinessProbe:\n          tcpSocket:\n            port: 1883\n          initialDelaySeconds: 5\n          periodSeconds: 10\n        env:\n          - name: EMQX_NAME\n            value: \"emqtt\"\n          - name: EMQX_CLUSTER__DISCOVERY\n            value: \"k8s\"\n          - name: EMQX_CLUSTER__K8S__APISERVER\n            value: \"https://kubernetes.default:443\"\n          - name: EMQX_CLUSTER__K8S__NAMESPACE\n            value: \"emqtt\"\n          - name: EMQX_CLUSTER__K8S__SERVICE_NAME\n            value: \"emqtt\"\n          - name: EMQX_CLUSTER__K8S__ADDRESS_TYPE\n            value: \"ip\"\n          - name: EMQX_CLUSTER__K8S__APP_NAME\n            value: \"emqtt\"\n          - name: EMQX_NODE__COOKIE\n            value: \"secretcookieeeetfggggg\"\n          - name: EMQX_CLUSTER__NAME\n            value: \"emqcl\"\n          - name: EMQX_CLUSTER__AUTOHEAL\n            value: \"on\"\n          - name: EMQX_CLUSTER__AUTOCLEAN\n            value: \"5m\"\n          - name: TZ\n            value: Asia/Shanghai\n        tty: true\n      volumes:\n        - name: localtime\n          hostPath:\n            path: /etc/localtime\n```\nemqtt-serviceentry.yaml\nbash\nistioctl create -f emqtt-serviceentry.yaml\n```yaml\nemqtt-serviceentry.yaml\napiVersion: networking.istio.io/v1alpha3\nkind: ServiceEntry\nmetadata:\n  name: emqtt\nspec:\n  hosts:\n  - emqtt.emqtt.svc.cluster.local\n  location: MESH_EXTERNAL\n  ports:\n  - number: 1883\n    name: tcp\n    protocol: TCP\n  resolution: DNS\n```\nhope to help you!. ",
    "571522162": "thk\ni use centos7 (cup:2 mem:2G)\nThe modification of the server configuration\nsysctl -w fs.file-max=2097152\nsysctl -w fs.nr_open=2097152\nvi /etc/sysctl.conf\nfs.file-max = 2097152\nfs.nr_open = 2097152\nvi /etc/systemd/system.conf\nDefaultLimitNOFILE=1048576\nulimit -n 1048576\nvi /etc/security/limits.conf\n soft nofile 1048576\n hard nofile 1048576\nvi /etc/sysctl.conf\nnet.core.somaxconn=32768\nnet.ipv4.tcp_max_syn_backlog=16384\nnet.core.netdev_max_backlog=16384\nnet.ipv4.ip_local_port_range='1000 65535'\nnet.core.rmem_default=262144\nnet.core.wmem_default=262144\nnet.core.rmem_max=16777216\nnet.core.wmem_max=16777216\nnet.core.optmem_max=16777216\nnet.ipv4.tcp_rmem='1024 4096 16777216'\nnet.ipv4.tcp_wmem='1024 4096 16777216'\nnet.nf_conntrack_max=1000000\nnet.netfilter.nf_conntrack_max=1000000\nnet.netfilter.nf_conntrack_tcp_timeout_time_wait=30\nnet.ipv4.tcp_fin_timeout = 15\nnet.ipv4.tcp_max_tw_buckets=1048576\nvi /etc/emqttd/emq.conf\nErlang Process Limit\nnode.process_limit = 2097152\nSets the maximum number of simultaneously existing ports for this system\nnode.max_ports = 1048576\nSize of acceptor pool\nlistener.tcp.external.acceptors = 64\nMaximum number of concurrent clients\nlistener.tcp.external.max_clients = 1000000\nclient use:\n./emqtt_bench_sub -h 10.211.55.13 -p 1883 -c 50000 -i 10 -t bench/%i -q 1\nDashboard info:\nClients/Max\uff1a32518\nMore than 32518 is still wrong\n. thk,slow down the connecting speed of the client. The problem is finally solved. ",
    "evgenyvasilchenko": "\nThe problem is finally solved\n\nHello! Can you please let us know how did you solve the issue?\nThanks!. ",
    "sshhawwnn": "\nThe problem is finally solved\n\nHello, can let us know how did you solve the issue?. @tigercl @turtleDeng any fix for this?. ",
    "archerian": "Thanks for the quick reply. Is there any mechanism available without the use of an external Load Balancer? My guess is the load balancing act of selecting the available node will have to moved to client logic? Just trying to keep the number of pieces to a minimum :) . thanks @utkarshns .. I was looking at HAProxy based on the earlier suggestion, I'm new to using a LB for MQTT. So only the incoming messages go through the LB? The publish part then is routed by one of the nodes directly to the client or does ALL traffic go via the LB? . It would be great if the clustering strategy used by EMQTT (or MQTT in general) allows for the same client to connect to both or more nodes (maybe with the same clientID) and pub/sub to both. The nodes would then share the intelligence among them to know it's from the same client and hence take only 1 copy of the pub for delivery. For subscribe, the nodes again will have the logic to know both these connections are from the same client and send only 1 copy of the message to either of the connections. Might be complicated, but something like how mongoDB clients allow connection to multiple IPs in the replicaset and manage the connection as a single logical one but serviceable by the current master but with seamless failover to the next elected master. This will require client side change too, perhaps beyond the scope of MQTT at all. \nI understand the need for a LB from an availability and scale out perspective, however the LB is in itself another point of failure and it seems logical for the MQTT nodes to offer this service. Just a thought :-). Hello Gilbert-Wong, thanks for your reply.\nI am using Erlang that came with the Emqtt package, which is R20/9.0. mqtt.max_packet_size I have set to 50MB. I have increased mqtt.max_packet_size = 50MB, also set retainer.max_payload_size = 50MB. Sorry got wrong URL. Thanks, looking at the file, seems like to create a new zone I have to add several zone. parameters, this seems like too much config for adding another listening port, especially when all the other zone parameters are the same. Maybe an enhancement to add a single line would be nice. But your suggestion works, for my current use I re purposed the internal zone to map to all IPs yet another port . The topic is 'Hello'\nmosquitto_pub.exe -h 10.167.36.179 -t Hello -m HelloTestMessage. It might still be random, but testing with 10 messages, its in a round robin format to each client, 1 message to 1st client, next to 2nd, next to 1st etc.. Looks like the clustering was broken sometime in between... so each publish was round robin sent to the other broker and hence the missing messages. I'll close this issue . ",
    "starlily": "Remove the dir '/home/YANGHAO/emqttd-relx/deps/goldrush' and make again, goldrush has been solved, thank terry-xiaoyu\uff01\nBut i get new problems as follows:\n```\nYANGHAO@YANGHAOZBYFV MINGW64 ~/emqttd-relx\nmake\nmake[1]: \u8fdb\u5165\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/goldrush\u201d\nmake[1]: \u79bb\u5f00\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/goldrush\u201d\nmake[1]: \u8fdb\u5165\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/emqttd\u201d\nmake[2]: \u8fdb\u5165\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/cuttlefish\u201d\n./rebar get-deps\n==> getopt (get-deps)\n==> goldrush (get-deps)\n==> lager (get-deps)\n==> neotoma (get-deps)\n==> cuttlefish (get-deps)\n./rebar compile\n==> getopt (compile)\n==> goldrush (compile)\n==> lager (compile)\n==> neotoma (compile)\n==> cuttlefish (compile)\n'rebar' \u4e0d\u662f\u5185\u90e8\u6216\u5916\u90e8\u547d\u4ee4\uff0c\u4e5f\u4e0d\u662f\u53ef\u8fd0\u884c\u7684\u7a0b\u5e8f\n\u6216\u6279\u5904\u7406\u6587\u4ef6\u3002\nERROR: Command [compile] failed!\nmake[2]:  [Makefile:17\uff1acompile] \u9519\u8bef 1\nmake[2]: \u79bb\u5f00\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/cuttlefish\u201d\nmake[1]:  [../../erlang.mk:313\uff1adeps] \u9519\u8bef 2\nmake[1]: \u79bb\u5f00\u76ee\u5f55\u201c/home/YANGHAO/emqttd-relx/deps/emqttd\u201d\nmake: *** [erlang.mk:312\uff1adeps] \u9519\u8bef 2\n```. Thank  Gilbert-Wong!\nReintall and set rebar\uff0ceverything is OK\uff01. ",
    "hchw": "@emqplus @terry-xiaoyu  Great, look forward to it.. ",
    "ice2hu": "if I remove the rabbitmq-erlang-client ,that is ok . Ths ,I will try . then ,in emqttd server it has 180 thousand client connect. and 30 thouasnd tps mesasge publish recived.\n. Erlang/OTP: 20. ",
    "cerfelix": "Thanks, it works. \nFor production deployment, we set mqtt.allow_anonymous = false. Then client with SSL certificates failed to connect. Log:\"No auth module to check!\" \nIf I want to control the no-password SSL connection permissions, for example, only users in table mqtt_user can connect to EMQ using SSL certificates without password. How to implement it?. ",
    "abser": "@cerfelix ,\nI hope your SSL connection error \"No auth module to check!\" you resolved. I am also having the same problem. Could you please share how it resolved? Without any auth plugin using the SSL certificate and CN name as username should able to connect to the broker. Do I need to do any other config change to resolve the issue?\nRegards\nNurul. ",
    "aloneboat": "I delete /home/cnssk/emq/emq-relx/deps directory and remake again,but still the same error.and I have another coworker has the same problem.. > Erlang/OTP 20 [erts-9.2] [source] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:10] [kernel-poll:false]\n\nEshell V9.2  (abort with ^G)\n. I'm not familiar with Erlang. I was just install something refer this https://github.com/emqtt/emqttd/issues/520,I will try again with that you said:apt install erlang. I run the: apt install erlang,then make again,then successfuly,thank you for your help @Gilbert-Wong . \n",
    "aaftio": "I have this problem too.. ",
    "rjbaat": "What i noticed is that when i have the subscriber offline and send some data to the topic and then get the subscriber online again. He will get the enqueued messages directly. But the queue is not getting reset to 0.\nSo it looks like the queue is still full. Maybe its just a stats page problem?\n\nBTW i updated to 2.3.9\n. I experience the same problem.\nSome clients do receive the shared load correctly. But some get double messages. So i am processing duplicate data from the EMQ cluster and thats not what is supposed to happen. . Also emqtt thinks the connection to the cluster does exist when the same user reconnects but to another node. This happens with clients with persistent sessions. . What iam going to try is to use: \nbalance source instead of\nbalance leastconn. \nThis way a connection is remade to the same backend i suppose?. Hmm still got the problem. Last night all connections of all devices where down. There is no real issue and aim not sure what the problem was. All devices seams connected. But no data/msg where incoming. So its more like a false positive connection. Anyone an idea what this could cause? Its not stable like this.\n```\ndefaults\n  log global\n  mode tcp\n  option  tcplog\n  timeout connect 5s\n  timeout client 90s\n  timeout server 90s\nlisten mqtt\n    bind *:1883\n    mode tcp\n    maxconn 50000\n    default_backend emq_cluster\n    timeout client 3h\n    timeout server 3h\n    option clitcpka\n    option srvtcpka\nlisten mqtt-ssl\n    bind *:8883 ssl crt /cert/cert.pem\n    mode tcp\n    maxconn 50000\n    default_backend emq_cluster\n    timeout client 3h\n    timeout server 3h\n    option clitcpka\n    option srvtcpka\nbackend emq_cluster\n    mode tcp\n    balance roundrobin\n    stick-table type ip size 1m expire 4h\n    stick on src\n    server mqtt-broker-1 xxx.xxx.xxx.xxx:xxx check send-proxy\n    server mqtt-broker-2 xxx.xxx.xxx.xxx:xxx check send-proxy\n    server mqtt-broker-3 xxx.xxx.xxx.xxx:xxx check send-proxy\n```\n. ",
    "VijayKrishna91": "@terry-xiaoyu  Thank you for supporting.. \nI have emailed you crash.dump and emq.conf files on 506895667@qq.com. . Hello @xiyangxdy  I am sorry, i am using another account so did not see your message, I upgraded emq, after that it's working fine. . @xiyangxdy I would suggest download 2.3.11. Because with emq 3 i have seen more troubles and had to downgrade it to version 2. . ",
    "xiyangxdy": "@VijayKrishna91 Hi, I also encountered the same problem, the log is as follows10:29:16.347 [error] Client(iotcourtlocationds/alarm/alarmignore1552530506327@172.34.225.62:60044): Username 'innerService' login failed for {{badmap,{error,timeout}},[{maps,get,[<<\"password\">>,{error,timeout},undefined],[{file,\"maps.erl\"},{line,192}]},{emq_auth_mongo,'-check/3-lc$^0/1-0-',2,[{file,\"src/emq_auth_mongo.erl\"},{line,52}]},{emq_auth_mongo,check,3,[{file,\"src/emq_auth_mongo.erl\"},{line,52}]},{emqttd_access_control,auth,3,[{file,\"src/emqttd_access_control.erl\"},{line,60}]},{emqttd_protocol,authenticate,2,[{file,\"src/emqttd_protocol.erl\"},{line,513}]},{emqttd_protocol,process,2,[{file,\"src/emqttd_protocol.erl\"},{line,194}]},{emqttd_client,received,2,[{file,\"src/emqttd_client.erl\"},{line,315}]},{gen_server2,handle_msg,2,[{file,\"src/gen_server2.erl\"},{line,1046}]}]} \nHow did you solve this problem?. @VijayKrishna91 Sorry, I didn't pay attention to the cluster you used, but I used a single node. The situation on my side is that emqtt runs normally for a while, and then there is a timeout for accessing mongodb, so we have to restart emqtt to get it back to work. By the way, my emqtt version is 2.3, not 2.3.11.  Do you think that upgrading the version can solve this problem?. ",
    "wormcc": "@Gilbert-Wong Thanks for the reply, i have changed the default port 8080 to 8099 in the emq.conf, then i restarted the broker, but the rest api server did not run, and the 8099 port  wasn't occupied by other application either.. ",
    "sourcekick": "I am asking myself the same question. @Gilbert-Wong Does the emqx project provide some rough numbers based on experience or benchmarks?. ",
    "yangou": "Hi @Gilbert-Wong , I read through the document of EMQ, and I'm guessing that topics -> nodes route table is replicated in all nodes and they are saved in DETS?  I believe there is a file size limit of 2GB on the DETS. So despite the hardware limitation, that 4GB file size also limits the number of topics one single EMQ cluster can support. A basic and rough equation would be t * b * n <= 4GB where t stands for number of topics, b stands for average byte size per topic saved in DETS and n stands for number of nodes in the cluster.  Am I correct?  \nIs there a way to extend that 4GB limit? Or are we using fragmented tables to extend that already?. ",
    "qiujiancn": "1665 .",
    "DanielRooks": "To my knowledge, EMQTT does not support Erlang 21 at the moment and will fail if you try to run it in an Erlang 21 environment.\nThat may be part of your problem.\nTry installing Erlang 20 instead.. ",
    "aruldd": "Thank you, Building erlang 20.3 from source and then trying to build worked.. ",
    "msyxiongzai": "successfu lconnection\n\n. The connection failed because of the firewall, Thank you. The problem has been solved. ",
    "andileeb": "Thanks, well it was a misunderstanding in Docker.. ",
    "gpism": "    Thanks for tip ...but How is there a plug-in for that ? Any link \u00a0to documentation or guide will help\n\n\n    Get Outlook for iOS\n\nOn Sat, Jul 28, 2018 at 8:34 PM +0530, \"Gilbert\" notifications@github.com wrote:\nPersist messages to databases.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub, or mute the thread.\n. Thanks ! will try the plugin ...in case of any issues revert\nOn Sun, 29 Jul 2018 at 6:57 AM, Gilbert notifications@github.com wrote:\n\nWait, I have mistaken your issue. Look at this plugin, it is open source\nplugin. emq-retainer\nhttp://emqtt.io/docs/v2/plugins.html#emq-retainer-retainer-plugin\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/1699#issuecomment-408645461, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AGKklJ6ZzFob4quXpMiGYdd_O5KtT5etks5uLQ9rgaJpZM4Vi0Us\n.\n. thanks Gilbert ...another issue I am facing is invalid clientid ...if a\nclient disconnects due some reason like network ...during reconnect I get\ninvalid client id but if i add random number to client id it connects ...it\ndoesnt connects with old id\n\nso the offline capability is not able to make it work as zet\nOn Sun, Jul 29, 2018 at 6:59 AM, Gaurav P gp@gpism.com wrote:\n\nThanks ! will try the plugin ...in case of any issues revert\nOn Sun, 29 Jul 2018 at 6:57 AM, Gilbert notifications@github.com wrote:\n\nWait, I have mistaken your issue. Look at this plugin, it is open source\nplugin. emq-retainer\nhttp://emqtt.io/docs/v2/plugins.html#emq-retainer-retainer-plugin\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqtt/emqttd/issues/1699#issuecomment-408645461, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AGKklJ6ZzFob4quXpMiGYdd_O5KtT5etks5uLQ9rgaJpZM4Vi0Us\n.\n\n\n-- \nBe * the Ch*ange\n. ",
    "tulu1688": "Hmmm. \nThis is what i got\n\n. Should i install emqtt from source? Is there any resource that I can start with?\nAnd this is the result for you\n\n. Thanks for your support. Sorry this is my fault. There was the haproxy open port 8883.. This is the log when I connect server by mosquitto_sub\nmosquitto_sub -t abc -h localhost -p 8883 -d --cafile /opt/iot-platform/ebk-broker-config/mqtt_ca.crt --insecure\nClient mosqsub|8146-khaitran-V sending CONNECT\nError: A TLS error occurred.. Is there anyone help me?. ",
    "Elylhance": "Maybe you should enable more ciphers in configured file, the supported ciphers by default is very limited. . ",
    "write2jaydeep": "can you please explain how to do it?\nwhat is the configuration need to be done in emqtt?\nThank you @Gilbert-Wong . @Gilbert-Wong Thanks!\nI have one client which is connected to TCP(1883) and has subscribed with topic /emq/test\nNow another client which is connected to WS(8083) has published a message with the same topic /emq/test\nhere published message didn't deliver to 1883 client.\nhow to fulfill this requirement?. Please help! I am kind of stuck here. I did all web application development over WS and mobile clients over TCP. I want them to communicate both ways.. @dono1986 Thank you very much, I just tried it and works well. I appreciate your help!\nThank you all.. @Gilbert-Wong Thank you! it works now. I appreciate your help!. ",
    "dono1986": "I'm also interested in an answer how to this. I'm digging through the docs but i'm still not sure, how to handle this task. As the data in my software can come from several platforms (angular, android, wpf, qt, ...), this functionality is crucial. It can't be this hard.... @write2jaydeep Meanwhile i'm tired of waiting. While I'm still interested in a solution regarding emqtt, i switched to mosquitto with websocket support to be able to do my work. This was kind of a hassle, since the windows version has to be rebuild with websocket support but this shouldn't concern you, since you're using linux. TCP and websocket clients do communicate without any problem now... you could check if this is an option for you. Cheers. ",
    "tharanga2006": "running werl.exe create below crash dump\n/****\n=erl_crash_dump:0.3\nWed Sep 05 21:17:43 2018\nSlogan: init terminating in do_boot ()\nSystem version: Erlang/OTP 19 [erts-8.3] [64-bit] [smp:4:4] [async-threads:10]\nCompiled: Tue Mar 14 20:58:59 2017\nTaints: erl_tracer\nAtoms: 2012\nCalling Thread: scheduler:1\n=scheduler:1\nScheduler Sleep Info Flags: \nScheduler Sleep Info Aux Work: DD_THR_PRGR | THR_PRGR_LATER_OP | ASYNC_READY_CLEAN\nCurrent Port: \nRun Queue Max Length: 0\nRun Queue High Length: 0\nRun Queue Normal Length: 0\nRun Queue Low Length: 0\nRun Queue Port Length: 0\nRun Queue Flags: OUT_OF_WORK | HALFTIME_OUT_OF_WORK | NONEMPTY | UNKNOWN(134217728)\nCurrent Process: <0.0.0>\nCurrent Process State: Running\nCurrent Process Internal State: ACT_PRIO_NORMAL | USR_PRIO_NORMAL | PRQ_PRIO_NORMAL | ACTIVE | RUNNING | TRAP_EXIT | ON_HEAP_MSGQ\nCurrent Process Program counter: 0x000001f552ec2610 (init:crash/2 + 8)\nCurrent Process CP: 0x0000000000000000 (invalid)\nCurrent Process Limited Stack Trace:\n0x000001f551285578:SReturn addr 0x7B740DF8 ()\n=scheduler:2\nScheduler Sleep Info Flags: SLEEPING | POLL_SLEEPING | WAITING\nScheduler Sleep Info Aux Work: \nCurrent Port: \nRun Queue Max Length: 0\nRun Queue High Length: 0\nRun Queue Normal Length: 0\nRun Queue Low Length: 0\nRun Queue Port Length: 0\nRun Queue Flags: OUT_OF_WORK | HALFTIME_OUT_OF_WORK\nCurrent Process: \n=scheduler:3\nScheduler Sleep Info Flags: SLEEPING | WAITING\nScheduler Sleep Info Aux Work: \nCurrent Port: \nRun Queue Max Length: 0\nRun Queue High Length: 0\nRun Queue Normal Length: 0\nRun Queue Low Length: 0\nRun Queue Port Length: 0\nRun Queue Flags: OUT_OF_WORK | HALFTIME_OUT_OF_WORK\nCurrent Process: \n=scheduler:4\nScheduler Sleep Info Flags: SLEEPING | TSE_SLEEPING | WAITING\nScheduler Sleep Info Aux Work: \nCurrent Port: \nRun Queue Max Length: 0\nRun Queue High Length: 0\nRun Queue Normal Length: 0\nRun Queue Low Length: 0\nRun Queue Port Length: 0\nRun Queue Flags: OUT_OF_WORK | HALFTIME_OUT_OF_WORK\nCurrent Process: \n=memory\ntotal: 7434656\nprocesses: 3242712\nprocesses_used: 3242480\nsystem: 4191944\natom: 68585\natom_used: 48615\nbinary: 256\ncode: 757593\nets: 70504\n=hash_table:atom_tab\nsize: 2411\nused: 1371\nobjs: 2012\ndepth: 6\n=index_table:atom_tab\nsize: 2048\nlimit: 1048576\nentries: 2012\n=hash_table:module_code\nsize: 47\nused: 12\nobjs: 14\ndepth: 2\n=index_table:module_code\nsize: 1024\nlimit: 65536\nentries: 14\n=hash_table:export_list\nsize: 3203\nused: 696\nobjs: 781\ndepth: 3\n=index_table:export_list\nsize: 1024\nlimit: 524288\nentries: 781\n=hash_table:export_list\nsize: 3203\nused: 0\nobjs: 0\ndepth: 0\n=hash_table:process_reg\nsize: 11\nused: 4\nobjs: 4\ndepth: 1\n=hash_table:fun_table\nsize: 47\nused: 30\nobjs: 48\ndepth: 3\n=hash_table:node_table\nsize: 11\nused: 1\nobjs: 1\ndepth: 1\n=hash_table:dist_table\nsize: 11\nused: 1\nobjs: 1\ndepth: 1\n=allocated_areas\nsys_misc: 10741\nstatic: 2098336\natom_space: 32776 12806\natom_table: 35809\nmodule_table: 9648\nexport_table: 85484\nexport_list: 137456\nregister_table: 204\nfun_table: 490\nmodule_refs: 2048\nloaded_code: 522467\ndist_table: 619\nnode_table: 251\nbits_bufs_size: 0\nbif_timer: 0\nlink_lh: 0\nprocess_table: 3145728\nport_table: 98304\nets_misc: 49192\n=allocator:sys_alloc\noption e: true\noption m: libc\n=allocator:temp_alloc[0]\nversions: 2.1 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 100\noption mmbcs: 131072\noption lmbcs: 10485760\noption smbcs: 1048576\noption mbcgs: 10\noption acul: 0\noption mbsd: 3\noption as: gf\nmbcs blocks: 0 4 4\nmbcs blocks size: 0 8464 8464\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 131072 131072 131072\nmbcs sys_alloc carriers size: 131072\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\ntemp_alloc calls: 2258\ntemp_free calls: 2258\ntemp_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:temp_alloc[1]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 100\noption mmbcs: 131072\noption lmbcs: 10485760\noption smbcs: 1048576\noption mbcgs: 10\noption acul: 0\noption as: af\nmbcs blocks: 0 2 2\nmbcs blocks size: 0 320 320\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 131072 131072 131072\nmbcs sys_alloc carriers size: 131072\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\ntemp_alloc calls: 14\ntemp_free calls: 14\ntemp_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:temp_alloc[2]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 100\noption mmbcs: 131072\noption lmbcs: 10485760\noption smbcs: 1048576\noption mbcgs: 10\noption acul: 0\noption as: af\nmbcs blocks: 1 1 1\nmbcs blocks size: 8208 8208 8208\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 131072 131072 131072\nmbcs sys_alloc carriers size: 131072\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\ntemp_alloc calls: 12\ntemp_free calls: 11\ntemp_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:temp_alloc[3]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 100\noption mmbcs: 131072\noption lmbcs: 10485760\noption smbcs: 1048576\noption mbcgs: 10\noption acul: 0\noption as: af\nmbcs blocks: 0 1 1\nmbcs blocks size: 0 48 48\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 131072 131072 131072\nmbcs sys_alloc carriers size: 131072\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\ntemp_alloc calls: 1\ntemp_free calls: 1\ntemp_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:temp_alloc[4]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 100\noption mmbcs: 131072\noption lmbcs: 10485760\noption smbcs: 1048576\noption mbcgs: 10\noption acul: 0\noption as: af\nmbcs blocks: 0 1 1\nmbcs blocks size: 0 48 48\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 131072 131072 131072\nmbcs sys_alloc carriers size: 131072\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\ntemp_alloc calls: 1\ntemp_free calls: 1\ntemp_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:sl_alloc[0]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 0\noption as: aoffcbf\nmbcs blocks: 1 186 186\nmbcs blocks size: 1040 64528 64528\nmbcs carriers: 1 2 2\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 1081344 1081344\nmbcs sys_alloc carriers size: 32768\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nsl_alloc calls: 753\nsl_free calls: 752\nsl_realloc calls: 1\nsys_alloc calls: 6\nsys_free calls: 5\nsys_realloc calls: 0\n=allocator:sl_alloc[1]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 1 1\nmbcs blocks size: 0 96 96\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nsl_alloc calls: 3\nsl_free calls: 3\nsl_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:sl_alloc[2]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nsl_alloc calls: 0\nsl_free calls: 0\nsl_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:sl_alloc[3]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nsl_alloc calls: 0\nsl_free calls: 0\nsl_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:sl_alloc[4]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nsl_alloc calls: 0\nsl_free calls: 0\nsl_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:std_alloc[0]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 0\noption as: aoffcbf\nmbcs blocks: 33 34 34\nmbcs blocks size: 136416 143568 143568\nmbcs carriers: 2 2 2\nmbcs sys_alloc carriers: 2\nmbcs carriers size: 1081344 1081344 1081344\nmbcs sys_alloc carriers size: 1081344\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nstd_alloc calls: 45\nstd_free calls: 12\nstd_realloc calls: 0\nsys_alloc calls: 2\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:std_alloc[1]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 3 3 3\nmbcs blocks size: 192 192 192\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nstd_alloc calls: 3\nstd_free calls: 0\nstd_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:std_alloc[2]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 1 1 1\nmbcs blocks size: 64 64 64\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nstd_alloc calls: 1\nstd_free calls: 0\nstd_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:std_alloc[3]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nstd_alloc calls: 0\nstd_free calls: 0\nstd_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:std_alloc[4]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nstd_alloc calls: 0\nstd_free calls: 0\nstd_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:ll_alloc[0]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 18446744073709551615\noption rsbcmt: 0\noption rmbcmt: 0\noption mmbcs: 524288\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 0\noption as: aoffcbf\nmbcs blocks: 3249 3249 3249\nmbcs blocks size: 7151616 7151616 7151616\nmbcs carriers: 6 6 6\nmbcs sys_alloc carriers: 6\nmbcs carriers size: 8912896 8912896 8912896\nmbcs sys_alloc carriers size: 8912896\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nll_alloc calls: 3249\nll_free calls: 0\nll_realloc calls: 28\nsys_alloc calls: 6\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:ll_alloc[1]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 18446744073709551615\noption rsbcmt: 0\noption rmbcmt: 0\noption mmbcs: 524288\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 85\noption as: aoffcbf\nmbcs blocks: 4 4 4\nmbcs blocks size: 256 256 256\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 524288 524288 524288\nmbcs sys_alloc carriers size: 524288\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nll_alloc calls: 4\nll_free calls: 0\nll_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:ll_alloc[2]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 18446744073709551615\noption rsbcmt: 0\noption rmbcmt: 0\noption mmbcs: 524288\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 85\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 524288 524288 524288\nmbcs sys_alloc carriers size: 524288\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nll_alloc calls: 0\nll_free calls: 0\nll_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:ll_alloc[3]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 18446744073709551615\noption rsbcmt: 0\noption rmbcmt: 0\noption mmbcs: 524288\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 85\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 524288 524288 524288\nmbcs sys_alloc carriers size: 524288\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nll_alloc calls: 0\nll_free calls: 0\nll_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:ll_alloc[4]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 18446744073709551615\noption rsbcmt: 0\noption rmbcmt: 0\noption mmbcs: 524288\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 85\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 524288 524288 524288\nmbcs sys_alloc carriers size: 524288\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nll_alloc calls: 0\nll_free calls: 0\nll_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:eheap_alloc[0]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 131072\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 0\noption as: aoffcbf\nmbcs blocks: 9 19 19\nmbcs blocks size: 68112 69984 69984\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 131072 131072 131072\nmbcs sys_alloc carriers size: 131072\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\neheap_alloc calls: 20\neheap_free calls: 11\neheap_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:eheap_alloc[1]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 131072\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 45\noption as: aoffcbf\nmbcs blocks: 6 9 9\nmbcs blocks size: 24688 34096 34096\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 131072 131072 131072\nmbcs sys_alloc carriers size: 131072\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\neheap_alloc calls: 19\neheap_free calls: 13\neheap_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:eheap_alloc[2]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 131072\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 45\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 131072 131072 131072\nmbcs sys_alloc carriers size: 131072\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\neheap_alloc calls: 0\neheap_free calls: 0\neheap_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:eheap_alloc[3]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 131072\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 45\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 131072 131072 131072\nmbcs sys_alloc carriers size: 131072\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\neheap_alloc calls: 0\neheap_free calls: 0\neheap_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:eheap_alloc[4]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 131072\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 45\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 131072 131072 131072\nmbcs sys_alloc carriers size: 131072\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\neheap_alloc calls: 0\neheap_free calls: 0\neheap_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:ets_alloc[0]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 0\noption as: aoffcbf\nmbcs blocks: 6 6 6\nmbcs blocks size: 21312 21312 21312\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nets_alloc calls: 6\nets_free calls: 0\nets_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:ets_alloc[1]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nets_alloc calls: 0\nets_free calls: 0\nets_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:ets_alloc[2]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nets_alloc calls: 0\nets_free calls: 0\nets_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:ets_alloc[3]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nets_alloc calls: 0\nets_free calls: 0\nets_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:ets_alloc[4]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nets_alloc calls: 0\nets_free calls: 0\nets_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:fix_alloc[0]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 0\noption as: aoffcbf\nfix type: driver_select_data_state 0 0\nfix type: driver_event_data_state 0 0\nfix type: nlink_sh 0 0\nfix type: monitor_sh 0 0\nfix type: sl_thr_q_element 0 0\nfix type: bif_timer 0 0\nfix type: hl_ptimer 0 0\nfix type: ll_ptimer 0 0\nfix type: msg_ref 0 0\nfix type: proc 1488 1488\nmbcs blocks: 2 2 2\nmbcs blocks size: 1504 1504 1504\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nfix_alloc calls: 2\nfix_free calls: 0\nfix_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:fix_alloc[1]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 13 13 13\nmbcs blocks size: 2928 2928 2928\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nfix_alloc calls: 18\nfix_free calls: 10\nfix_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:fix_alloc[2]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nfix_alloc calls: 0\nfix_free calls: 0\nfix_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:fix_alloc[3]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nfix_alloc calls: 0\nfix_free calls: 0\nfix_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:fix_alloc[4]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nfix_alloc calls: 0\nfix_free calls: 0\nfix_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:literal_alloc\nversions: 0.9 3.0\noption e: true\noption t: false\noption ramv: false\noption sbct: 18446744073709551615\noption rsbcmt: 0\noption rmbcmt: 0\noption mmbcs: 1048576\noption lmbcs: 10485760\noption smbcs: 1048576\noption mbcgs: 10\noption acul: 0\noption as: aobf\nmbcs blocks: 15 15 15\nmbcs blocks size: 20448 20448 20448\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 1048576 1048576 1048576\nmbcs sys_alloc carriers size: 1048576\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nliteral_alloc calls: 15\nliteral_free calls: 0\nliteral_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:binary_alloc[0]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 0\noption as: aoffcbf\nmbcs blocks: 0 1 1\nmbcs blocks size: 0 1056 1056\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nbinary_alloc calls: 14\nbinary_free calls: 14\nbinary_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:binary_alloc[1]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 1 2 2\nmbcs blocks size: 256 320 320\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nbinary_alloc calls: 6\nbinary_free calls: 5\nbinary_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:binary_alloc[2]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nbinary_alloc calls: 0\nbinary_free calls: 0\nbinary_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:binary_alloc[3]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nbinary_alloc calls: 0\nbinary_free calls: 0\nbinary_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:binary_alloc[4]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\nbinary_alloc calls: 0\nbinary_free calls: 0\nbinary_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:driver_alloc[0]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 0\noption as: aoffcbf\nmbcs blocks: 25 25 25\nmbcs blocks size: 4800 4800 4800\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\ndriver_alloc calls: 26\ndriver_free calls: 1\ndriver_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:driver_alloc[1]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 4 8 8\nmbcs blocks size: 1024 9552 9552\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\ndriver_alloc calls: 14\ndriver_free calls: 10\ndriver_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:driver_alloc[2]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\ndriver_alloc calls: 0\ndriver_free calls: 0\ndriver_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:driver_alloc[3]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\ndriver_alloc calls: 0\ndriver_free calls: 0\ndriver_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:driver_alloc[4]\nversions: 0.9 3.0\noption e: true\noption t: 5\noption ramv: false\noption sbct: 524288\noption rsbcmt: 80\noption rmbcmt: 50\noption mmbcs: 32768\noption lmbcs: 5242880\noption smbcs: 262144\noption mbcgs: 10\noption acul: 60\noption as: aoffcbf\nmbcs blocks: 0 0 0\nmbcs blocks size: 0 0 0\nmbcs carriers: 1 1 1\nmbcs sys_alloc carriers: 1\nmbcs carriers size: 32768 32768 32768\nmbcs sys_alloc carriers size: 32768\nmbcs_pool blocks: 0\nmbcs_pool blocks size: 0\nmbcs_pool carriers: 0\nmbcs_pool carriers size: 0\nsbcs blocks: 0 0 0\nsbcs blocks size: 0 0 0\nsbcs carriers: 0 0 0\nsbcs sys_alloc carriers: 0\nsbcs carriers size: 0 0 0\nsbcs sys_alloc carriers size: 0\ndriver_alloc calls: 0\ndriver_free calls: 0\ndriver_realloc calls: 0\nsys_alloc calls: 1\nsys_free calls: 0\nsys_realloc calls: 0\n=allocator:test_alloc\noption e: false\n=allocator:alloc_util\noption ycs: 1048576\noption sac: true\n=allocator:instr\noption m: false\noption s: false\noption t: false\n=proc:<0.0.0>\nState: Running\nName: init\nSpawned as: otp_ring0:start/2\nLast scheduled in for: init:crash/2\nSpawned by: []\nStarted: Wed Sep 05 21:17:43 2018\nMessage queue length: 0\nNumber of heap fragments: 0\nHeap fragment data: 0\nLink list: [<0.4.0>]\nReductions: 100\nStack+heap: 376\nOldHeap: 610\nHeap unused: 157\nOldHeap unused: 610\nMemory: 8672\nProgram counter: 0x000001f552ec2610 (init:crash/2 + 8)\nCP: 0x0000000000000000 (invalid)\nInternal State: ACT_PRIO_NORMAL | USR_PRIO_NORMAL | PRQ_PRIO_NORMAL | ACTIVE | RUNNING | TRAP_EXIT | ON_HEAP_MSGQ\n=proc:<0.1.0>\nState: Waiting\nName: erts_code_purger\nSpawned as: erts_code_purger:start/0\nSpawned by: <0.0.0>\nStarted: Wed Sep 05 21:17:43 2018\nMessage queue length: 0\nNumber of heap fragments: 0\nHeap fragment data: 0\nReductions: 4\nStack+heap: 233\nOldHeap: 0\nHeap unused: 233\nOldHeap unused: 0\nMemory: 2608\nProgram counter: 0x000001f552eb4c98 (erts_code_purger:loop/0 + 24)\nCP: 0x0000000000000000 (invalid)\narity = 0\nInternal State: ACT_PRIO_NORMAL | USR_PRIO_NORMAL | PRQ_PRIO_NORMAL | TRAP_EXIT | ON_HEAP_MSGQ\n=proc:<0.2.0>\nState: Waiting\nName: init__boot__on_load_handler\nSpawned as: erlang:apply/2\nSpawned by: <0.0.0>\nStarted: Wed Sep 05 21:17:43 2018\nMessage queue length: 0\nNumber of heap fragments: 0\nHeap fragment data: 0\nReductions: 4\nStack+heap: 233\nOldHeap: 0\nHeap unused: 223\nOldHeap unused: 0\nMemory: 2608\nProgram counter: 0x000001f552ecdbd8 (init:on_load_loop/2 + 40)\nCP: 0x0000000000000000 (invalid)\narity = 0\nInternal State: ACT_PRIO_NORMAL | USR_PRIO_NORMAL | PRQ_PRIO_NORMAL | ON_HEAP_MSGQ\n=proc:<0.4.0>\nState: Waiting\nName: erl_prim_loader\nSpawned as: erlang:apply/2\nSpawned by: <0.3.0>\nStarted: Wed Sep 05 21:17:43 2018\nMessage queue length: 0\nNumber of heap fragments: 0\nHeap fragment data: 0\nLink list: [<0.0.0>, #Port<0.0>]\nReductions: 770\nStack+heap: 610\nOldHeap: 987\nHeap unused: 120\nOldHeap unused: 979\nMemory: 13600\nProgram counter: 0x000001f5547dea40 (erl_prim_loader:loop/3 + 152)\nCP: 0x0000000000000000 (invalid)\narity = 0\nInternal State: ACT_PRIO_NORMAL | USR_PRIO_NORMAL | PRQ_PRIO_NORMAL | TRAP_EXIT | ON_HEAP_MSGQ\n=port:#Port<0.0>\nSlot: 0\nConnected: <0.4.0>\nLinks: <0.4.0>\nPort controls linked-in driver: efile\n=node:'nonode@nohost'\n=no_distribution\n=loaded_modules\nCurrent code: 542323\nOld code: 0\n=mod:otp_ring0\nCurrent size: 1643\nCurrent attributes: 836C00000001680264000376736E6C000000016E1000573E74E093933ACD205F2A2D7E4EFE476A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B00372F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F6F74705F72696E67302E65726C6A\n=mod:erts_code_purger\nCurrent size: 18078\nCurrent attributes: 836C00000001680264000376736E6C000000016E1000087F47B16C346B2FD091DD8981C44BB16A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B003E2F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F657274735F636F64655F7075726765722E65726C6A\n=mod:init\nCurrent size: 75300\nCurrent attributes: 836C00000001680264000376736E6C000000016E100044F9A4C6F603DC988BA97D76B5E65FC46A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B00322F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F696E69742E65726C6A\n=mod:prim_eval\nCurrent size: 1385\nCurrent attributes: 836C00000001680264000376736E6C000000016E10002EB71A6D30D69DD3C7C6787C146FA4AE6A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B00352F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F7072696D5F6576616C2E536A\n=mod:prim_inet\nCurrent size: 123384\nCurrent attributes: 836C00000001680264000376736E6C000000016E10001EB9A5CDD9E6B25316542463367C33386A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B00372F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F7072696D5F696E65742E65726C6A\n=mod:prim_file\nCurrent size: 67970\nCurrent attributes: 836C00000002680264000376736E6C000000016E100092C2CFAE554936592385CC89C2E957A96A68026400086469616C797A65726C0000000168026400116E6F5F696D70726F7065725F6C6973747368026400127472616E736C6174655F726573706F6E736561026A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B00372F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F7072696D5F66696C652E65726C6A\n=mod:zlib\nCurrent size: 16960\nCurrent attributes: 836C00000001680264000376736E6C000000016E1000B966F9A8B8D409D8E603519E2E59AB8A6A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B00322F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F7A6C69622E65726C6A\n=mod:prim_zip\nCurrent size: 31058\nCurrent attributes: 836C00000001680264000376736E6C000000016E1000D29CB0C83EB10C14B94E647AAE7F17CE6A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B00362F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F7072696D5F7A69702E65726C6A\n=mod:erl_prim_loader\nCurrent size: 84993\nCurrent attributes: 836C00000001680264000376736E6C000000016E10009D9A13C063367D90C0B52D57E7DF0AA16A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B003D2F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F65726C5F7072696D5F6C6F616465722E65726C6A\n=mod:erlang\nCurrent size: 104129\nCurrent attributes: 836C00000002680264000376736E6C000000016E1000764903B9DC329D8BB3FA35F0331D87666A680264000A646570726563617465646C00000002680264000468617368610268026400036E6F7761006A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B00342F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F65726C616E672E65726C6A\n=mod:erts_internal\nCurrent size: 9647\nCurrent attributes: 836C00000001680264000376736E6C000000016E10000AB7B488E55C1BA0697B2F487B16E8A26A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B003B2F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F657274735F696E7465726E616C2E65726C6A\n=mod:erl_tracer\nCurrent size: 1478\nCurrent attributes: 836C00000002680264000376736E6C000000016E10005F303637959DE38366589D528E9DD85F6A68026400086469616C797A65726C00000001680264000C6E6F5F636F6E7472616374736802640007656E61626C656461036A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B00382F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F65726C5F7472616365722E65726C6A\n=mod:erts_literal_area_collector\nCurrent size: 3983\nCurrent attributes: 836C00000001680264000376736E6C000000016E1000A5FB0C3BA4C4B0313FA4B9F1EBA4DC4A6A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B00492F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F657274735F6C69746572616C5F617265615F636F6C6C6563746F722E65726C6A\n=mod:erts_dirty_process_code_checker\nCurrent size: 2315\nCurrent attributes: 836C00000001680264000376736E6C000000016E10001F2AA0DB1233180517A0FC979B3027F56A6A\nCurrent compilation info: 836C0000000368026400076F7074696F6E736C0000000668026400066F75746469726B00292F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372636802640001696B00252F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F7372636802640001696B00292F6C6469736B2F7269636B6172642F6769742F6F74702F6C69622F6B65726E656C2F696E636C75646564000A64656275675F696E666F6400137761726E5F6F62736F6C6574655F677561726464000A64656275675F696E666F6A680264000776657273696F6E6B0005372E302E336802640006736F757263656B004D2F6C6469736B2F7269636B6172642F6769742F6F74702F657274732F7072656C6F616465642F7372632F657274735F64697274795F70726F636573735F636F64655F636865636B65722E65726C6A\n=fun\nModule: init\nUniq: 102956853\nIndex: 9\nAddress: 0x000001f552ecf018\nRefc: 1\n=fun\nModule: init\nUniq: 102956853\nIndex: 8\nAddress: 0x000001f552ecf1c8\nRefc: 1\n=fun\nModule: init\nUniq: 102956853\nIndex: 5\nAddress: 0x000001f552ecf540\nRefc: 1\n=fun\nModule: init\nUniq: 102956853\nIndex: 4\nAddress: 0x000001f552ecfe48\nRefc: 1\n=fun\nModule: prim_zip\nUniq: 108051453\nIndex: 6\nAddress: 0x000001f5547db9a0\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 11\nAddress: 0x000001f5547ed9a0\nRefc: 1\n=fun\nModule: init\nUniq: 102956853\nIndex: 7\nAddress: 0x000001f552ecf220\nRefc: 2\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 10\nAddress: 0x000001f5547edb08\nRefc: 1\n=fun\nModule: init\nUniq: 102956853\nIndex: 6\nAddress: 0x000001f552ecf258\nRefc: 1\n=fun\nModule: prim_zip\nUniq: 108051453\nIndex: 4\nAddress: 0x000001f5547dba40\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 9\nAddress: 0x000001f5547edc70\nRefc: 1\n=fun\nModule: init\nUniq: 102956853\nIndex: 1\nAddress: 0x000001f552ed0078\nRefc: 1\n=fun\nModule: prim_zip\nUniq: 108051453\nIndex: 5\nAddress: 0x000001f5547db9e8\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 8\nAddress: 0x000001f5547eddd8\nRefc: 1\n=fun\nModule: init\nUniq: 102956853\nIndex: 0\nAddress: 0x000001f552ed00b0\nRefc: 1\n=fun\nModule: prim_zip\nUniq: 108051453\nIndex: 2\nAddress: 0x000001f5547dbad0\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 15\nAddress: 0x000001f5547ed858\nRefc: 1\n=fun\nModule: init\nUniq: 102956853\nIndex: 3\nAddress: 0x000001f552ecffe0\nRefc: 1\n=fun\nModule: prim_zip\nUniq: 108051453\nIndex: 3\nAddress: 0x000001f5547dba98\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 14\nAddress: 0x000001f5547ed8a0\nRefc: 1\n=fun\nModule: init\nUniq: 102956853\nIndex: 2\nAddress: 0x000001f552ed0040\nRefc: 1\n=fun\nModule: prim_zip\nUniq: 108051453\nIndex: 0\nAddress: 0x000001f5547dbb50\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 13\nAddress: 0x000001f5547ed930\nRefc: 1\n=fun\nModule: prim_zip\nUniq: 108051453\nIndex: 1\nAddress: 0x000001f5547dbb08\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 12\nAddress: 0x000001f5547ed968\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 3\nAddress: 0x000001f5547ee500\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 2\nAddress: 0x000001f5547ee678\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 1\nAddress: 0x000001f5547ee7f0\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 0\nAddress: 0x000001f5547ee968\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 7\nAddress: 0x000001f5547edf50\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 6\nAddress: 0x000001f5547ee0b8\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 5\nAddress: 0x000001f5547ee230\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 4\nAddress: 0x000001f5547ee398\nRefc: 1\n=fun\nModule: erlang\nUniq: 53754089\nIndex: 0\nAddress: 0x000001f55480bff0\nRefc: 1\n=fun\nModule: prim_file\nUniq: 88784718\nIndex: 5\nAddress: 0x000001f5547ce6e8\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 19\nAddress: 0x000001f5547ecb80\nRefc: 1\n=fun\nModule: prim_file\nUniq: 88784718\nIndex: 4\nAddress: 0x000001f5547ce808\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 18\nAddress: 0x000001f5547ecf58\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 17\nAddress: 0x000001f5547ed1b0\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 16\nAddress: 0x000001f5547ed6c0\nRefc: 1\n=fun\nModule: prim_file\nUniq: 88784718\nIndex: 1\nAddress: 0x000001f5547cea10\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 23\nAddress: 0x000001f5547ec7c8\nRefc: 1\n=fun\nModule: prim_file\nUniq: 88784718\nIndex: 0\nAddress: 0x000001f5547cea48\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 22\nAddress: 0x000001f5547ec998\nRefc: 1\n=fun\nModule: prim_file\nUniq: 88784718\nIndex: 3\nAddress: 0x000001f5547ce9a0\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 21\nAddress: 0x000001f5547ecb18\nRefc: 1\n=fun\nModule: prim_file\nUniq: 88784718\nIndex: 2\nAddress: 0x000001f5547ce9d8\nRefc: 1\n=fun\nModule: erl_prim_loader\nUniq: 84432639\nIndex: 20\nAddress: 0x000001f5547ecb50\nRefc: 1\n=proc_stack:<0.0.0>\n0x000001f551285578:SReturn addr 0x7B740DF8 ()\n=proc_heap:<0.0.0>\n=proc_stack:<0.1.0>\n0x000001f5512115a0:SReturn addr 0x7B740DF8 ()\ny0:N\ny1:N\n=proc_heap:<0.1.0>\n=proc_stack:<0.2.0>\n0x000001f551280f30:SReturn addr 0x7B740DF8 ()\ny0:A5:false\ny1:N\n=proc_heap:<0.2.0>\n=proc_stack:<0.4.0>\n0x000001f5512828f8:SReturn addr 0x7B740DF8 ()\ny0:H1F551286980\ny1:P<0.3.0>\ny2:H1F5512824E0\ny3:I360000\n=proc_heap:<0.4.0>\n1F551286980:lH1F5512869B0|N\n1F5512869B0:lI46|N\n1F5512824E0:t6:A5:state,A5:efile,N,p<0.0>,I360000,H1F551286990\n1F551286990:t3:AA:prim_state,A5:false,A9:undefined\n=atoms\neio\nhome\nprogname\ncheck_process\nerts_dirty_process_code_checker\nsend_copy_req\nsend_copy_reqs\nswitch_area\nnot_handled_message\nmsg_loop\nerts_literal_area_collector\nnif_not_loaded\ncpc_flags\nget_cpc_opts\nstd_low_alloc\nll_low_alloc\nmseg_alloc\n'-spawn_opt/5-fun-0-'\ngc_info\nsched_wall_time\nreceive_allocator\ninsert_info\ninstance\ninsert_instance\nmk_res_list\nget_alloc_info\natom_space\nloaded_code\nmodule_refs\nfun_table\nexport_list\nexport_table\nmodule_table\nprocess_table\nlink_lh\nets_misc\natom_table\naa_mem_data\nschedulers\nreceive_emd\neheap_alloc\nbinary_alloc\nets_alloc\nfix_alloc\nau_mem_data\nis_low_alloc\nfix_types\nfix_proc\naccessor_bif_timer\nbif_timer\nhl_ptimer\nll_ptimer\nmsg_ref\nnlink_sh\nmonitor_sh\nproc\nget_fix_proc\nsbcs\nmbcs_pool\nmbcs\nblocks_size\nget_blocks_size\nmemory_is_supported\nget_memval\nneed_mem_info\nneed_mem_info_list\nget_mem_data\nmemory_result_list\nmin\nrvrs\nprocessor_node\ncput_i2e_tag\ncput_i2e_tag_map\ncput_i2e\ncput_e2i\nlogical\ncore\nthread\nprocessor\ncput_e2i_clvl\ninternal_cpu_topology\nget_cookie\nauth\nset_cookie\nignored\npassive_cnct\nsend_nosuspend\nfun_info_1\ndisconnect\ndisconnect_node\nis_well_formed_list\ncrasher\nremote_spawn_error\nfault\nno_link\ngen_server\ngarbage_collect_message_area\nget_gc_opts\nbitsize\nclean\nfile_not_found\n'no server found'\nebusy\ninvalid_current_directory\n'-start/0-fun-0-'\n'-handle_get_file/3-fun-0-'\n'-handle_get_file/3-fun-1-'\n'-handle_set_primary_archive/5-fun-0-'\n'-handle_list_dir/2-fun-0-'\n'-handle_list_dir/2-fun-1-'\n'-handle_read_file_info/2-fun-0-'\n'-handle_read_file_info/2-fun-1-'\n'-handle_read_link_info/2-fun-0-'\n'-handle_read_link_info/2-fun-1-'\n'-handle_get_cwd/2-fun-0-'\n'-handle_get_cwd/2-fun-1-'\n'-handle_get_modules/4-fun-0-'\n'-handle_get_modules/4-fun-1-'\n'-efile_get_mods_par/3-fun-0-'\n'-efile_gm_spawn_1/5-fun-0-'\n'-prim_get_file/2-fun-0-'\n'-prim_list_dir/2-fun-0-'\n'-prim_read_file_info/3-fun-0-'\n'-open_archive/4-fun-0-'\n'-ensure_virtual_dirs/6-fun-0-'\n'-ensure_virtual_dirs/6-fun-1-'\n'-foldl_archive/3-fun-0-'\n'-load_prim_archive/3-fun-0-'\nload_prim_archive\nreal_path\nnormalize\nwin32_pathtype\nunix_pathtype\nunix\npathtype\nabsname_vr\nrelative\nvolumerelative\nabsolute\nabsname\nipv4_addr\nipv4_address\nipv4_list\nis_prefix\narchive_split\nstring_match\nno_match\nno_split\nname_split\npath_join\npath_split\nto_strs\nkeyins\nkeysort\ndeep_member\nsend_all\nis_basename\nclear_cache\ncache_new\nfoldl_archive\nensure_virtual_dirs\nopen_archive\ncache\napply_archive\nprim_get_cwd\narchive_read_file_info\nprim_read_file_info\narchive_list_dir\nprim_list_dir\narchive_get_file\nprim_get_file\nprimary\nprim_set_primary_archive\ndo_prim_purge_cache\nprim_purge_cache\nloader_debug\nprim_init\nport_error\nll_close\nll_open_set_bind\nll_udp_open\nll_tcp_connect\nudp_options\ntcp_timeout\ntcp_options\ninet_stop_port\ninet_get_cwd\ninet_read_link_info\ninet_read_file_info\ninet_list_dir\ninet_send_and_rcv\ninet_get_file_from_port1\ninet_get_file_from_port\ninet_timeout_handler\ninet_exit_port\nfind_collect\nfind_loop\nconnect_master\nfind_master\nbad_return\ngm_process\ngm_arch_get\ngm_get_mods\nefile_gm_get_1\nefile_gm_get\nefile_gm_spawn_1\nefile_gm_spawn\nefile_gm_recv\narchive\nefile_any_archives\nefile_get_mods_par\nhandle_get_modules\nefile_timeout_handler\nefile_exit_port\nnoport\nefile_stop_port\nefile_get_cwd\nefile_read_file_info\nefile_list_dir\nefile_set_primary_archive\nemfile\nefile_get_file_from_port3\n'prim_load port died'\nefile_get_file_from_port2\nefile_get_file_from_port\nhandle_timeout\nhandle_exit\nhandle_stop\nhandle_get_cwd\nhandle_read_link_info\nhandle_read_file_info\nhandle_list_dir\nhandle_purge_archive_cache\nhandle_set_primary_archive\nhandle_get_file\nhandle_request\nbad_state\nerror_report\nstd_error\nenotdir\nenoent\ncheck_file_result\npurge_archive_cache\nset_primary_archive\nget_path\ninit_ack\nefile\nstart_efile\nhosts\nstart_inet\nloader\nprim_state\n'-filter_fun/0-fun-0-'\n'-include_acc/3-fun-0-'\n'-get_zip_input/1-fun-0-'\n'-get_zip_input/1-fun-1-'\n'-get_cd_loop/11-fun-0-'\n'-get_cd_loop/11-fun-1-'\n'-get_cd_loop/11-fun-2-'\npwrite_binary\npwrite_iolist\nskipper\nskip_iolist\nsplitter\nsplit_iolist\nlocal_file_header_from_bin\nbad_cd_file_header\ncd_file_header_from_bin\ndos_date_time_to_datetime\nadd_extra_info\ncd_file_header_to_file_info\neocd_and_comment_from_bin\nbinary_io\nset_file_info\nprim_file_io\nfind_eocd_header\nseek\nbad_eocd\nget_end_of_central_dir\nget_filename_from_b2\nbad_central_directory\ncd_file_header\nget_file_header\nget_cd_loop\neocd\nget_central_dir\noffset_over_z_data_descriptor\nunsupported_compression\nget_z_all\nbad_local_file_header\nbad_local_file_offset\nlocal_file_header\nget_z_file\nget_zip_input\nlists_foldl\ninclude_acc\nillegal_filter\nprimzip_file\ndo_foldl\nfoldl\nprimzip\ndo_open\nfilter_fun_throw\nfilter_fun\nprim_zip\n'-compress/1-after$^0/0-0-'\n'-uncompress/1-after$^0/0-0-'\n'-zip/1-after$^0/0-0-'\n'-unzip/1-after$^0/0-0-'\n'-gzip/1-after$^0/0-0-'\n'-gunzip/1-after$^0/0-0-'\nneed_dictionary\narg_mem\narg_bitsz\narg_method\nfiltered\nhuffman_only\nrle\narg_strategy\nbest_speed\nbest_compression\narg_level\nfull\narg_flush\ncollect\ngunzip\ngzip\nunzip\ndeflated\nzip\ndata_error\nuncompress\nfinish\ndefault\ncompress\ngetQSize\ngetBufSize\nsetBufSize\ninflateEnd\ninflate_has_more\nstream_end\ninflateChunk\ninflate\ninflateReset\ninflateSync\ninflateSetDictionary\ninflateInit\ndeflateEnd\ndeflate\ndeflateParams\ndeflateReset\ndeflateSetDictionary\ndeflateInit\nzlib\nuse_threads\n'-sendfile/8-after$^0/0-0-'\n'-get_cwd_int/2-fun-0-'\n'-altname_int/2-fun-0-'\n'-read_link_int/2-fun-0-'\n'-read_link_all_int/2-fun-0-'\n'-list_dir_int/2-fun-0-'\n'-list_dir_all_int/2-fun-0-'\n'-list_dir_response/2-lc$^0/1-0-'\n'-drv_close/1-after$^0/0-0-'\n'-drv_command/4-after$^0/0-0-'\n'-drv_command_nt/3-after$^0/0-0-'\nto_seconds\nfrom_seconds\nplgv\npathname\npremature_end_of_list\nlists_split\ntransform_ldata\nget_uint32\nget_uint64\nsint64\nint_to_int64bytes\nint_to_int32bytes\nfile_access\ndevice\nregular\nsymlink\nfile_type\ntransform_info\ntranslate_response\ncur\nbof\nlseek_position\ndelayed_write\nread_ahead\nopen_mode\nport_died\nbad_response_from_port\ndrv_get_response\ndrv_command_nt\ndrv_command\ndrv_close\ndrv_open\nhandle_fname_response_all\nfname\nhandle_fname_response\nlist_dir_convert_all\nno_translation\nlist_dir_convert\nlfname\nlist_dir_response\nlist_dir_all_int\nlist_dir_all\nlist_dir_int\nlist_dir\nread_link_info_int\nread_link_info\nread_link_all_int\nread_link_all\nread_link_int\nread_link\nmake_symlink_int\nmake_symlink\nmake_link_int\nmake_link\nfile_info_validate_ctime\nfile_info_validate_mtime\nuniversal\nposix\nfile_info_validate_atime\nwrite_file_info_int\nwrite_file_info\naltname_int\naltname\nread_file_info_int\ndel_dir_int\ndel_dir\nmake_dir_int\nmake_dir\nrename_int\ndelete_int\nset_cwd_int\nset_cwd\nget_cwd_int\nget_cwd\ntranslate_sendfile_flags\nlock_socket\ninet6_tcp\ninet_tcp\nsendfile\nwrite_file\nread_file\nipread_s32bu_p32bu\ncopy_opened\ntruncate\nposition\npread_int\npread\nenomem\nread_line\nsync\ndatasync\npwrite_int\npwrite\nallocate\nrandom\nsequential\nwill_need\ndont_need\nno_reuse\nadvise\nfile_descriptor\nopen_int_setopts\nopen_int\nbound\nconnecting\naccepting\nmulticast\nno_pointtopoint\nno_broadcast\ndown\nup\nssl\nterm\nsctp_setadaptation\nsctp_assoc_value\nsctp_prim\nsctp_setpeerprim\nsctp_assocparams\nsackdelay_disable\nsackdelay_enable\npmtud_disable\npmtud_enable\nhb_demand\nhb_disable\nhb_enable\nsctp_paddrparams\nsctp_event_subscribe\naddr_over\nunordered\nsctp_paddrinfo\nbusy\neprotonosupport\n'-bindx/3-lc$^0/1-0-'\n'-comp_ifaddrs/2-lc$^0/1-0-'\nctl_cmd\nget_ip6\nget_ip4\nget_ip\nget_addr\nget_addrs\nip6_to_bytes\nip4_to_bytes\nutf8_to_characters\nnil\ntree\nktree_keys\nktree_update\nktree_insert\nktree_get\nis_defined\nktree_is_defined\nktree_empty\nlen\nrev\nbuild_iflist\nbuild_ifaddrs_opts\nbuild_ifaddrs\nencode_ifname\nenc_time\ndec_status\ndec_stats\ndecode_stats\nrecv_cnt\nrecv_max\nrecv_avg\nrecv_dvi\nsend_cnt\nsend_max\nsend_avg\nsend_oct\nrecv_oct\nenc_stats\nencode_stats\ndec_subs\ndecode_subs\nenc_subs\nencode_subs\nencode_ifopt_val\nencode_ifopts\ndecode_ifopts\ndec_ifopt\nenc_ifopt\nmtu\nbroadaddr\ntype_ifopt\nmerge_fields\nmerge_options\nneed_template\nmulti\ndec\ndec_opt_val\ndecode_opt_val\nenc_opts\nencode_opts\nonce\nenc_opt_val\nencode_opt_val\nenum_name\nenum_val\nenum_names\nenum_vals\nborlist\ndec_value_tuple\ndecode\ndec_value\nenc_value_2\nenc_value_tuple\nenc_value_1\nenc_value_default\nenc_value\nloopback\nbool8\nlinkaddr\nether\nsockaddr\nbinary_or_uint\nuint8\nuint16\nuint24\nuint32\nsctp_assoc_id\nenum\nbitenumlist\ntype_value_2\ntype_value_record\ntype_value_tuple\ntype_value_1\ntype_value_default\nrecord\ntype_value\nint\nip\nuint\ntype_opt_1\ntype_opt\ndec_opt\nreuseaddr\nkeepalive\ndontroute\nsndbuf\nrecbuf\ntos\nnodelay\nmulticast_if\nmulticast_ttl\nmulticast_loop\nadd_membership\ndrop_membership\nipv6_v6only\nbuffer\nheader\ndeliver\nexit_on_close\nhigh_watermark\nlow_watermark\nsend_timeout\ndelay_send\nread_packets\nsend_timeout_close\nhigh_msgq_watermark\nlow_msgq_watermark\nnetns\nshow_econnreset\ntclass\nsctp_rtoinfo\nsctp_associnfo\nsctp_initmsg\nsctp_autoclose\nsctp_nodelay\nsctp_disable_fragments\nsctp_i_want_mapped_v4_addr\nsctp_maxseg\nsctp_set_peer_primary_addr\nsctp_primary_addr\nsctp_adaptation_layer\nsctp_peer_addr_params\nsctp_events\nsctp_delayed_ack_time\nsctp_status\nsctp_get_peer_addr_info\nenc_opt\nis_sockopt_val\nattach\ndetach\nunrecv\ngetservbyport1\ngetservbyport\ngetservbyname1\ngetservbyname\ngethostname\ngetstatus\ngetprotocol\ngettype\ngetindex\nignorefd\ngetfd\ngetstat\nsubscribe\nifset\nifget\ngetiflist\nnetmask\ndstaddr\npointtopoint\nbroadcast\ngetifaddrs_ifget\nhwaddr\ncomp_ifaddrs_add\ncomp_ifaddrs\nenotsup\ngetifaddrs\nchgopts\nchgopt\ngetopts\ngetopt\nsetopt\nsocknames\nsetsockname\nsockname\nsctp_assoc_change\npeernames\nsetpeername\npeername\nrecvfrom0\nrecvfrom\nasync_recv\nrecv0\nrecv\nsctp_default_send_param\nsctp_sndrcvinfo\nsendmsg\nsendto\npeeloff\nlisten\nasync_accept\naccept_opts\naccept0\naccept\nasync_connect0\nasync_connect\nconnect0\nbindx_check_addrs\nbindx\naddr\nadd\nbind\nclose_port\nsend_pend\nclose_pend_loop\nsubs_empty_out_q\nlinger\nshutdown_1\nread\nwrite\nread_write\ndrv2protocol\nsctp\nprotocol2drv\ndgram\nseqpacket\nenc_type\ninet\ninet6\nenc_family\nbool\nfdopen\nprim_inet\narg_reg_alloc\nprim_eval\nshutdown_timeout\nnot_allowed\nbadrecord\nstarting\n'-bs2as/1-fun-0-'\n'-bs2ss/1-fun-0-'\n'-boot/1-fun-0-'\n'-notify/1-fun-0-'\n'-get_pids/1-lc$^0/1-0-'\n'-do_boot/2-fun-0-'\n'-load_modules/2-lc$^0/1-0-'\n'-load_modules/2-lc$^1/1-2-'\n'-load_modules/2-lc$^2/1-3-'\n'-load_modules/2-lc$^3/1-4-'\n'-load_modules/2-lc$^4/1-1-'\nprepared\n'-prepare_loading_fun/0-fun-0-'\n'-patch_path/2-lc$^0/1-0-'\n'-patch_dir/2-lc$^0/1-1-'\n'-patch_dir/2-lc$^1/1-0-'\n'-shutdown_timer/1-fun-0-'\n'-start_on_load_handler_process/0-fun-0-'\n'-run_on_load_handlers/2-fun-0-'\nstandard_error\nformat\nio_lib\n'-debug_profile_format_mfas/1-fun-0-'\n'-collect_loaded_mfas/0-lc$^1/1-0-'\n'-collect_loaded_mfas/0-lc$^0/1-1-'\n'-collect_loaded_mfas/2-lc$^0/1-0-'\ncollect_mfa\ncollect_mfas\nall_loaded\ncollect_loaded_mfas\nsort\ndebug_profile_format_mfas\nsnifs\ndebug_profile_mfas\ndebug_profile_stop\ndebug_profile_start\non_load_function_failed\non_load_handler_returned_ok\nspawn_monitor\nrunning_on_load_handler\non_load_loop\non_load_handler_init\nstart_on_load_handler_process\non_load_done\nrun_on_load\nrun_on_load_handlers\narchive_extension\nobjfile_extension\nset_argument\nget_argument1\nto_strings\nget_flag_args\nget_flag_list\nget_flag\nget_args\ncheck\nstart_arg\nstart_arg2\neval_arg\nstart_extra_arg\nend_args\narg\nflag\nparse_boot_args\ntimer\nflush_timout\nshutdown_time\nshutdown_timer\nload_module\ndo_load_module\nexprs\nnew_bindings\nerl_eval\nparse_exprs\nerl_parse\ndot\nerl_scan\nstart_it\nstart_em\nstart_in_kernel\njoin\nfunny_splitwith\nfunny_split\ndirectory\nfile_info\nread_file_info\npatch_dir\npatch_path\nextract_var\nadd_var\nfix_path\nmake_path\nprepare_loading_fun\nload_rest\nload_failed\nget_modules\nload_modules\n'unexpected command in bootfile'\nkernelProcess\nprimLoad\npreLoaded\nembedded\nkernel_load_completed\neval_script\nscript\n'bootfile format error'\n'cannot get bootfile'\nnot_found\nget_boot\npz\npa\npath_flags\nbootfile\ninvalid_boot_var_argument\nboot_var\nget_boot_vars_1\nget_boot_vars\nno_or_multiple_root_variables\nroot\nget_root\nes\ninit__boot__on_load_handler\ninit_debug_flag\ninit_debug\nmode\npath\ndo_boot\nadd_to_kernel\nset_path\nstart_prim_loader\nkernel_pid\nterminate\ndel\nsub\nremove_refs_from\nhipe_bifs\npurge_all_hipe_refs\ndo_unload\nunload\nkill_all_ports\nkill_em\nget_pids\nkill_all_pids\nresend\nshutdown_loop\nshutdown_kernel_pid\nshutdown\nheart\nget_heart\nshutdown_pids\nstop_heart\nclear_system\ndo_stop\nstopping\nset_flag\nconfig\nuser\ndo_handle_msg\nnew_state\nhandle_msg\nnew_kernelpid\ngarb_boot_loop\nforeach\nget_file\nerl_prim_loader\ndo_ensure_loaded\nprogress\nboot_loop\ncrash\nhalt_string\nthings_to_string\nflatten\nprintable_list\nto_string\nstate\nrelaxed\nstrict\ncode_path_choice\nmap\nb2s\nb2a\ns\neval\nprepare_run_args\nprofile_boot\nstop_1\nis_bytelist\nreboot\nrequest\nwait_until_started\nnotify_when_started\nmake_permanent\nensure_loaded\nfetch_loaded\nget_status\nbs2ss\nbs2as\nscript_id\nget_argument\nget_plain_arguments\nget_arguments\ndebug\ncontinue\ndied\ntest_progress\ndo_test_hard_purge\ncontinued\nstarted\ndo_test_soft_purge\ndo_test_purge\ncpc_init\ncpc_request_gc\ncpc_request\ncpc_sched_kill\ncpc_sched_kill_waiting\ncpc_handle_cpc\ncpc_list_rm\ncpc_handle_down\ncpc_recv\ncpc_kill\ncpc_static\ncheck_proc_code\ndo_finish_after_on_load\ndo_soft_purge\ndo_purge\ntest_purge\nreply\npurge\nsoft_purge\nloop\nfatal\nboot\notp_ring0\nsleep\nother\ngc\ncheck_io\naux\n'TRACE'\n'DELETE'\n'PUT'\n'POST'\n'HEAD'\n'GET'\n'OPTIONS'\n'Proxy-Connection'\n'Keep-Alive'\n'Cookie'\n'X-Forwarded-For'\n'Set-Cookie2'\n'Set-Cookie'\n'Accept-Ranges'\n'Last-Modified'\n'Expires'\n'Etag'\n'Content-Type'\n'Content-Range'\n'Content-Md5'\n'Content-Location'\n'Content-Length'\n'Content-Language'\n'Content-Encoding'\n'Content-Base'\n'Allow'\n'Www-Authenticate'\n'Warning'\n'Vary'\n'Server'\n'Retry-After'\n'Public'\n'Proxy-Authenticate'\n'Location'\n'Age'\n'User-Agent'\n'Referer'\n'Range'\n'Proxy-Authorization'\n'Max-Forwards'\n'If-Unmodified-Since'\n'If-Range'\n'If-None-Match'\n'If-Match'\n'If-Modified-Since'\n'Host'\n'From'\n'Authorization'\n'Accept-Language'\n'Accept-Encoding'\n'Accept-Charset'\n'Accept'\n'Via'\n'Upgrade'\n'Transfer-Encoding'\n'Pragma'\n'Date'\n'Connection'\n'Cache-Control'\nprocess_low\nprocess_normal\nprocess_high\nprocess_max\ncharacters_to_list_trap_4\ncharacters_to_list_trap_3\ncharacters_to_list_trap_2\ncharacters_to_list_trap_1\ncharacters_to_utf8_trap\nmd5_trap\nempty_out_q\nudp_error\nudp_passive\ntcp_error\ntcp_closed\ntcp_passive\ninet_reply\ninet_async\nudp\ntcp\nunspec\nselect_trap\n'count_trap\\000'\ndelete_trap\nnt\nwin32\nhash\nhas_prepared_code_on_load\ncopy_shared\nsize_shared\nsplit\npurge_module\ncheck_dirty_process_code\nis_process_executing_dirty\nmap_info\nfun_info_mfa\ntake\ncmp_term\nupdate\nremove\nmerge\nkeys\nis_key\nfrom_list\nfind\nto_list\nmaps\nmap_size\nis_map\ninspect\nunsetenv\nprintable_range\nbinary_to_float\nfloat_to_binary\ninteger_to_binary\nbinary_to_integer\ndelete_element\ninsert_element\nfinish_loading\nprepare_loading\ndt_append_vm_tag_data\ndt_prepend_vm_tag_data\ndt_restore_tag\ndt_spread_tag\ndt_get_tag_data\ndt_get_tag\ndt_put_tag\nposixtime_to_universaltime\nuniversaltime_to_posixtime\ncheck_old_code\nnative_name_encoding\nfile\nis_translatable\ninternal_normalize_utf8\ninternal_native2name\ninternal_name2native\nprim_file\nnif_error\ndecode_unsigned\nencode_unsigned\nreferenced_byte_size\nlist_to_bin\nbin_to_list\npart\nat\nlongest_common_suffix\nlongest_common_prefix\nmatches\ncompile_pattern\nbinary_part\nfinish_after_on_load\ncall_on_load_function\nload_nif\nsetopts\ngive_away\ndflag_unicode_io\nbinary_to_existing_atom\nbinary_to_atom\natom_to_binary\nbin_is_7bit\ncharacters_to_list\ncharacters_to_binary\ndecode_packet\nupdate_element\nbitstring_to_list\nlist_to_bitstring\nbit_size\nbyte_size\ntuple_size\nis_bitstring\nlist_to_existing_atom\niolist_to_binary\niolist_size\nmake_fun\nto_float\nto_integer\nstring\nis_boolean\nget_module_info\nwarning_map\nhibernate\nis_module_native\nmake_stub_module\nmodule_md5\nget_chunk\nlock_counters\ndump_links\ndump_monitors\ninstructions\ndist_ext_to_term\nset_internal_state\nget_internal_state\nflat_size\nsame\ndisassemble\nerts_debug\nkeyfind\nkeysearch\nkeymember\nreverse\nlists\nrun\nformat_error_int\nloaded_drivers\ntry_unload\ntry_load\nerl_ddll\nperf_counter\ngetpid\nputenv\nos\nmatch_spec_run_r\nmatch_spec_compile\nselect_delete\nselect_reverse\nselect_count\nselect\nupdate_counter\nslot\nsafe_fixtable\nrename\ninsert_new\ninsert\nprev\nmember\nmatch_object\nlast\nlookup_element\nlookup\nis_compiled_ms\ndelete_object\ndelete_all_objects\ndelete\nmatch_spec_test\nis_record\nis_function\nis_binary\nis_reference\nis_port\nis_pid\nis_number\nis_integer\nis_float\nis_tuple\nis_list\nis_atom\nsubtract\n'--'\nappend\n'++'\nsend\n'!'\nis_builtin\nget_stacktrace\nraise\nis_process_alive\ndemonitor\nfun_to_list\nport_to_list\nref_to_list\nsystem_profile\nsystem_monitor\nsystem_info\nsystem_flag\nappend_element\nmake_tuple\nread_timer\ncancel_timer\nsend_after\nstart_timer\npow\natan2\nsqrt\nlog10\nlog2\nlog\nexp\nerfc\nerf\natanh\natan\nasinh\nasin\nacosh\nacos\ntanh\ntan\nsinh\nsin\ncosh\ncos\nmath\nbump_reductions\nresume_process\nsuspend_process\nseq_trace_print\nseq_trace_info\nseq_trace\ntrace_delivered\ntrace_info\ntrace_pattern\nport_get_data\nport_set_data\nrelease_literal_area_switch\nsystem_check\nis_system_process\nperf_counter_unit\ntime_unit\nmap_hashmap_children\nterm_type\nmap_to_tuple_keys\ncheck_process_code\nrequest_system_task\nport_connect\nport_close\nport_control\nport_command\nport_call\nport_info\ndist_exit\nsetnode\nspawn_opt\nwhereis\nunlink\nuniversaltime_to_localtime\nuniversaltime\ntuple_to_list\ntrunc\ntl\ntime\nterm_to_binary\nstatistics\nsplit_binary\nspawn_link\nspawn\nsetelement\nself\nround\nregistered\nput\nprocess_info\nprocess_flag\npre_loaded\npid_to_list\nopen_port\nsystem_time\nmonotonic_time\nnow\nnodes\nmonitor_node\nfunction_exported\nmodule_loaded\nmd5_final\nmd5_update\nmd5_init\nunique_integer\nmake_ref\nlocaltime_to_universaltime\nlocaltime\nlist_to_tuple\nlist_to_pid\nlist_to_integer\nlist_to_float\nlist_to_binary\nlist_to_atom\nlink\nlength\nis_alive\ninteger_to_list\nhd\nphash2\nphash\nhalt\nget_keys\nget\ngarbage_collect\nfun_info\nfloat_to_list\nfloat\nexternal_size\nerase\nelement\ndisplay_nl\ndisplay_string\ndisplay\ndelete_module\ndate\ncrc32_combine\ncrc32\nbinary_to_term\nbinary_to_list\natom_to_list\nadler32_combine\nadler32\nabs\nyield\nyes\nx86\nxor\nwrite_concurrency\nwordsize\nscheduler_wall_time\nwarning_msg\nwarning\nwall_clock\nwaiting\nvisible\nversion\nvalues\nvalue\nunload_cancelled\nunloaded_only\nunloading\nunloaded\nunless_suspending\nuniq\nunblock_normal\nunblock\nutf8\nused\nuse_stdio\nurun\nunregister\nunicode\nungreedy\nundef\nucp\nucompile\ntype\ntuple\ntry_clause\ntrim_all\ntrim\ntrap_exit\ntracer\ntrace_status\ntrace_control_word\ntraced\ntrace_ts\ntrace\ntpkt\ntotal_run_queue_lengths\ntotal_heap_size\ntotal_active_tasks\ntotal\ntimestamp\n''\ntimeout_value\ntime_offset\nthreads\nthread_pool_size\nthis\nterm_to_binary_trap\ntable\n'SYSTEM'\nsystem_architecture\nsystem_version\nsystem_limit\nsystem_error\nsystem\nsys_misc\nsuspending\nsuspended\nsuspend\nsunrm\nstrict_monotonic_timestamp\nstrict_monotonic\nstream\nstop\nstderr_to_stdout\nstatic\nstatus\nstart\nstack_size\nssl_tls\nspawned\nspawn_driver\nspawn_executable\nsl_alloc\nsize\nsilent\nshared\nseparate\nset_tcw_fake\nset_tcw\nset_seq_token\nset_on_spawn\nset_on_link\nset_on_first_spawn\nset_on_first_link\nset_data\nset_cpu_topology\nset\nserial\nsequential_trace_token\nsequential_tracer\nsensitive\nsend_to_non_existing_process\nseconds\nsecond\nscope\nscientific\nscheme\nschedulers_online\nscheduler_id\nscheduler\nsave_calls\nsafe\nruntime\nrunning_procs\nrunning_ports\nrunning\nrunnable_procs\nrunnable_ports\nrunnable\nrun_queue_lengths\nrun_queue\nreturn_trace\nreturn_to\nreturn_from\nrestart\nreset\nreport_errors\nrem\nreload\nregistered_name\nregister\nrefc\nreductions\nrecent_size\nreceive\nreason\nready_async\nready_output\nready_input\nread_concurrency\nre_run_trap\nre_pattern\nre\nraw\nqueue_size\nquantify\npurify\npublic\nptab_list_continue\nprotection\nprotected\nprofile\nproc_sig\nprocs\nprocess_dump\nprocess_limit\nprocess_display\nprocess_count\nprocesses_used\nprocesses\nprocess\nprivate\npriority\nprint\nprepare_on_load\nprepare\npositive\nport_op\nport_limit\nport_count\nports\nport\npid\npermanent\npending_reload\npending_purge_lambda\npending_process\npending_driver\npending\npause\n'+'\nparallelism\npacket_size\npacket\nowner\noverlapped_io\noutput\nout_exiting\nout_exited\nout\nos_version\nos_type\nos_pid\norelse\nordered_set\nor\nopt\nopen_error\nopen\non_load\non_heap\nold_heap_size\nold_heap_block_size\nok\noffset\noff_heap\nobjects\nnouse_stdio\nnotsup\nnotify\nnotempty_atstart\nnotempty\nnoteol\nnotbol\nnotalive\nnot_purged\nnot_pending\nnot_loaded_by_this_process\nnot_loaded\nnot_a_list\nnot\nno_start_optimize\nno_network\nno_integer\nno_float\nnosuspend\nnoproc\nnofile\nnoeol\nnodeup\nnodedown_reason\nnodedown\nnode_type\nnode\nnocookie\nnoconnection\nnoconnect\nno_auto_capture\nnone\nnomatch\nno\nnext\nnewline\nnew_uniq\nnew_ports\nnew_processes\nnew_index\nnew\nnever_utf\nnet_kernel_terminated\nnet_kernel\n'/='\n'=/='\nneed_gc\nnative_addresses\nnative\nnamelist\nnamed_table\nname\nnanosecond\nnano_seconds\nmultiline\nmulti_scheduling\nmore\nmonotonic_timestamp\nmonotonic\nmonitors\nmonitor_nodes\nmonitor\nmonitored_by\nmodule_info\nmodule\n'-'\nminor_version\nmin_bin_vheap_size\nmin_heap_size\nmillisecond\nmilli_seconds\nmicrostate_accounting\nmicrosecond\nmicro_seconds\nmeta_match_spec\nmeta\nmerge_trap\nmessages\nmessage_queue_len\nmessage_queue_data\nmessage_binary\nmessage\nmemory_types\nmemory_internal\nmemory\nmd5\nmbuf_size\nmax_processes\nmax_tables\nmax_heap_size\nmaximum\nmax\nmatch_spec_result\nmatch_spec\nmatch_limit_recursion\nmatch_limit\nmatch\nmachine\n'<'\nlow\nlong_schedule\nlong_gc\nlocal\nload_failure\nload_cancelled\nloaded\nlittle\nlist_to_binary_continue\nlist\nlinks\nlinked_in_driver\nline_length\nline_delimiter\nline\nlf\n'=<'\nldflags\nlatin1\nlast_calls\nlarge_heap\nlabel\nknown\nkill_ports\nkilled\nkill\nkeypos\nio\nis_seq_trace\nis_constant\ninvalid\ninstruction_counts\ninternal_status\ninternal_error\ninternal\ninput\ninitial_call\ninit\ninfo_msg\ninfo\nindex\ninconsistent\nincomplete\ninactive\nin_exiting\nin\nignore\nif_clause\nid\nhttph_bin\nhttp_bin\nhttp_error\nhttp_eoh\nhttp_header\nhttp_request\nhttp_response\nhttps\nhttph\nhttp\nhipe_architecture\nhigh\nhide\nhidden\nheir\nheart_port\nheap_type\nheap_sizes\nheap_size\nheap_block_size\nhave_dt_utag\ngroup_leader\ngrun\n'>'\nglobal\ngetting_unlinked\ngetting_linked\ngather_system_check_result\ngather_sched_wall_time_result\ngather_microstate_accounting_result\ngather_io_bytes\ngather_gc_info_result\ngetenv\nget_tcw\nget_seq_token\nget_data\ngenerational\n'>='\ngc_start\ngc_minor_start\ngc_minor_end\ngc_max_heap_size\ngc_major_start\ngc_major_end\ngc_end\ngarbage_collection_info\ngarbage_collection\ngarbage_collecting\nfunction_clause\nfunctions\nfunction\nfullsweep_if_old_binaries\nfullsweep_after\nfree\nformat_cpu_topology\nforce\nflush_monitor_messages\nflush\nflags\nfirstline\nfirst\nfd\nfcgi\nextra\nexternal\nextended\nexports\nexiting\nexisting_ports\nexisting_processes\nexisting\nexit_status\nexclusive\nexception_trace\nexception_from\nexact_reductions\nevent\n'ETS-TRANSFER'\nets\nerts_internal\nerts_code_purger\nerror_logger\nerror_handler\n'ERROR'\nerlang\nerl_tracer\n'=='\n'=:='\neol\neof\nenv\nendian\nenabled\nenable_trace\nemulator\nelib_malloc\neinval\ndupnames\nduplicated\nduplicate_bag\ndunlink\ndsend_continue_trap\ndsend\ndriver_options\ndriver\ndotall\ndollar_endonly\n'$'\n'$$'\ndmonitor_p\ndmonitor_node\ndlink\ndiv\n'/'\ndist_cmd\ndist\ndisplay_items\ndiscard\ndisabled\ndisable_trace\ndirty_io\ndirty_execution\ndirty_cpu_schedulers_online\ndirty_cpu\ndictionary\ndgroup_leader\ndepth\ndexit\ndelay_trap\ndecimals\ndebug_flags\ndata\ncurrent_stacktrace\ncurrent_location\ncurrent_function\ncreation\ncrlf\ncr\ncpu_timestamp\ncpu\ncounters\ncopy_literals\ncopy\ncontrol\ncontext_switches\nconst\ncons\nconnection_closed\nconnected\nconnect\nconvert_time_unit\nconfig_h\ncompressed\ncomplete\ncompile\ncompat_rel\ncompact\ncommandv\ncommand\ncode\nclosed\nclose\nclock_service\nclear\ncharacters_to_list_int\ncharacters_to_binary_int\n'CHANGE'\ncflags\ncdr\ncd\ncatchlevel\ncaseless\ncase_clause\ncapture\ncaller\ncall_time\ncall_count\nbusy_port\nbusy_dist_port\nbuild_type\nbsr_unicode\nbsr_anycrlf\nbsr\nbsl\nbreakpoint\nbreak_ignored\nbxor\nbor\nbnot\nbm\nblocked_normal\nblocked\nblock_normal\nblock\nbinary_to_term_trap\nbinary_to_list_continue\nbinary_longest_suffix_trap\nbinary_longest_prefix_trap\nbinary_find_trap\nbinary_copy_trap\nbinary_bin_to_list_trap\nbinary\nbif_timer_server\nbif_return_trap\nbig\nband\nbag\nbadsig\nbadmatch\nbadmap\nbadkey\nbadfun\nbadfile\nbadarity\nbadarith\nbadarg\nbacktrace_depth\nbacktrace\nawaiting_unload\nawaiting_load\nawait_sched_wall_time_modifications\nawait_result\nawait_proc_exit\nawait_port_send_result\nawait_microstate_accounting_modifications\nattributes\natom_used\natom\nasynchronous\nasync\nasn1\narity\narg0\nargs\napply\nanycrlf\nany\nandthen\nandalso\nand\nanchored\namd64\nalready_loaded\nallow_passive_connect\nallow_gc\nalloc_util_allocators\nallocator_sizes\nallocator\nallocated_areas\nallocated\nalloc_sizes\nalloc_info\nall_names\nall_but_first\nall\nactive_tasks\nactive\naccessor\nac\nabsoluteURI\nabs_path\naborted\nabort\n'EXIT'\n'UP'\n'DOWN'\nundefined_lambda\nundefined_function\nnocatch\nundefined\nexit\nerror\nthrow\nreturn\ncall\nnormal\ntimeout\ninfinity\nfun\n''\n'$end_of_table'\n'nonode@nohost'\n''\ntrue\nfalse\n=end\n*******/\n. Hi Gilbert,\nI have move the files to D:\\DevApps\\emqttd. but still it fails to start. let me know what I need to check,\nno errors in logs. \nwhen I double click on werl.exe it create a crash dump.\nbut when I start the emq broker. it crash with below error. I cant see a crash dump at that time. \n\n. Hi Gilbert,\nThanks for the reply I try all. but getting the same error. but I have two other laptops that are not install Windows Home work well without any issue. Yep you correct Linux is good and  working well.\nmay be issue is in this new laptop or the OS version.\nRegards\nTharanga. Hi Gilbert-Wong,\nThanks, Do you have any documentation on how to implement this scenario.. I'm looking at that doc. but  there is no place explaining  this scenario. may be this is not possible. . Hi  Gilbert\nI was able to create  node in same server by  extracting emqtd installation to four different folders.\nI have change emq.conf and emq_dashbord.conf ports details and it allowed me to start the nodes.\nThanks for the tips.\n. Hi Jerry,\nSo how we can add  my all  four nodes to the cluster. \nAppreciate if you can provide me step by step instructions to add for node to cluster\n. that is what Im trying to do. but after adding two node try to add  the third one it kick off one node from the cluster.. Hi Jerry,\nRight on target . thanks.  . Now I have 4 brokers in the cluster. those brokers are in 4 servers operating on different ports.\nsay I wanted to subscribe to the cluster. so cluster having 4 brokers. and different connection urls for the brokers .\n. Hi Gilbert,\nThanks.  Cant we handle this using MQTT client library ?.\nhttps://github.com/mqttjs/MQTT.js/#connect\n/*******\nmqtt.connect([url], options)\nConnects to the broker specified by the given url and options and returns a Client.\nThe URL can be on the following protocols: 'mqtt', 'mqtts', 'tcp', 'tls', 'ws', 'wss'. The URL can also be an object as returned by URL.parse(), in that case the two objects are merged, i.e. you can pass a single object with both the URL and the connect options.\nYou can also specify a servers options with content: [{ host: 'localhost', port: 1883 }, ... ], in that case that array is iterated at every connect.\n******/\nBut Im not sure how to call this properly .\nIs anyone use this feature ?\n. This works for me\nvar client  = mqtt.connect(\n  {    servers:[\n        {\n          host: \"localhost\",\n            port: 1890\n        },\n        {\n          host: \"localhost\",\n            port: 1983\n        }\n    ] })\n. ",
    "tassi-yuzukko": "I have same issue.\nI want to use EMQ  with Windows Home 64 bit. However, if I try to .\\bin\\emqttd console , it crashed in the same way as @tharanga2006.\nSomebody has any ideas ?. ",
    "gstar1987td": "I used paho and another mqtt client: https://github.com/fusesource/mqtt-client, and end up with same result. \nThere are some points that I think they might be the key points:\n1, Using same clientid caused this problem.\n2, cleansession must be set to false.\n3,  I set auto reconnection on both paho and fusesource mqtt client, and reconnect failed. Then I tried another method: I recreate another client instance with same connect options 30 seconds later. This time I could reconnect to emqtt.  . ",
    "iedwin": "I finally managed to activate it on manage page. \nThanks.. ",
    "toomasz": "@tigercl Unfortunately i'm not longer using two node cluster anymore. if necessary, i can setup it again to obtain logs for you. Did you try my config files? I attached them.\n. ",
    "spellauge": "+1. ",
    "suspai": "Hi,\nThank you. Really appreciate it !\nThanks,\nsuspai\nFrom: Gilbert notifications@github.com\nSent: Monday, December 17, 2018 7:16 AM\nTo: emqx/emqx emqx@noreply.github.com\nCc: Sushama Pai (suspai) suspai@cisco.com; Mention mention@noreply.github.com\nSubject: Re: [emqx/emqx] EMQ Openldap userPassword auth not working (#1711)\nHi, @suspaihttps://github.com/suspai , I have improved the emqx-auth-ldap plugin. Username and password field both could be configured in configuration. You could get this feature in emqx3.0.0 release.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHubhttps://github.com/emqx/emqx/issues/1711#issuecomment-447698753, or mute the threadhttps://github.com/notifications/unsubscribe-auth/AoL5w3UY_Gmc5HHM4eSApiSk4TLdfIY3ks5u5vdwgaJpZM4VwESb.\n. ",
    "jgrossmac": "+1. ",
    "vosst": "ack and thx, that answers my question. I'll close the issue.. ",
    "chunzhenzyd": "Description: We have hundreds of thousands of terminals, each terminal(inner-network) can connect to our server(outer-network) \uff0cserver will publish some content to terminal(s). So should we create hundreds of thousands of topics? Because each content is related to only one terminal, other terminals shouldn't receive it.. Hi Gilbert,\nThank you!\nBut I want to know is there a test to see how many topics can we create for max value?\nBR\nJack Zhang. Hi Gilbert,\nI don't think it sovles my problem, it's just a benchmark test for concurrency..\nBR\nJack Zhang. Hi Gilbert,\nThanks! \nSeems EMQ work is very challenging. I used to work in Ericsson, and wrote code with Erlang, I know how difficult to solve Erlang concurrency problem, and mnesia issues.\nThanks again!\nBR\nJack Zhang. Hi Gilbert,\nSo I can change mqtt.max_packet_size to any value? Please check this article:\nhttps://blog.csdn.net/chancein007/article/details/77996544\nIt said mqtt max payload size should < 268435455 bytes (about 256M).\nBR\nJack Zhang. Hi Gilbert,\nOK, thanks!\nBR\nJack Zhang. And there are other problems, even I run with:\ndocker run --rm -ti --name emq_default -p 1883:1883 -p 8090:8080 --sysctl net.ipv4.tcp_fin_timeout=15 emq:latest\ndocker: Error response from daemon: OCI runtime create failed: container_linux.go:348: starting container process caused \"process_linux.go:402: container init caused \\\"open /proc/sys/net/ipv4/tcp_fin_timeout: no such file or directory\\\"\": unknown.\nI think the docker kernel tuning cmd doesn't work anymore, please check the cmd.. client tool: emqtt_benchmark. Java Program\uff1a\n\npackage org.zyd.java.tool.emq.test;\nimport java.util.Date;\nimport org.eclipse.paho.client.mqttv3.MqttClient;\nimport org.eclipse.paho.client.mqttv3.MqttConnectOptions;\nimport org.eclipse.paho.client.mqttv3.MqttException;\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\nimport com.alibaba.fastjson.JSONObject;\npublic class TermStatusReceiver{\nprivate static final String host = \"tcp://192.168.30.121:2883\";\nprivate static final String clientId = \"server\";\nprivate static final String topicStatusOnline = \"$SYS/brokers/emq_ims@172.18.0.2/clients/#\";\npublic static final String topicStatusRunning = \"term_status_running\";\npublic static final String topicServerReconnected = \"server_reconnected\";\npublic static MqttClient client;\nprivate int termCount = 0;\n\npublic MqttConnectOptions getOptions() {\n    MqttConnectOptions options = new MqttConnectOptions();\n    options.setCleanSession(true);\n    // options.setUserName(\"zyd\");\n    // options.setPassword(password.toCharArray());\n    options.setConnectionTimeout(10);\n    options.setKeepAliveInterval(20);\n    return options;\n}\n\npublic void connect() throws MqttException {\n    // \u9632\u6b62\u91cd\u590d\u521b\u5efaMQTTClient\u5b9e\u4f8b\n    if (client == null) {\n        client = new MqttClient(host, clientId);\n        client.setCallback(new TermStatusReceiverCallback(TermStatusReceiver.this));\n    }\n    MqttConnectOptions options = getOptions();\n    if (!client.isConnected()) { // \u5224\u65ad\u62e6\u622a\u72b6\u6001\uff0c\u8fd9\u91cc\u6ce8\u610f\u4e00\u4e0b\uff0c\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u5224\u65ad\uff0c\u662f\u975e\u5e38\u5751\u7684\n        client.connect(options);\n        System.out.println(new Date() + \"\u8fde\u63a5\u6210\u529f1\");\n    } else { // \u8fd9\u91cc\u7684\u903b\u8f91\u662f\u5982\u679c\u8fde\u63a5\u6210\u529f\u5c31\u91cd\u65b0\u8fde\u63a5\n        client.disconnect();\n        client.connect(options);\n        System.out.println(new Date() + \"\u8fde\u63a5\u6210\u529f2\");\n    }\n}\n\npublic void connect(int tryCount) throws InterruptedException {\n    for (int i = 0; i < tryCount; i++) {\n        try {\n            connect();\n        } catch (Exception e) {\n            e.printStackTrace();\n            System.err.println(new Date() + \"\u8fde\u63a5\u5931\u8d25, \u4e09\u79d2\u540e\u5c06\u518d\u6b21\u5c1d\u8bd5\");\n            Thread.sleep(3000);\n            continue;\n        }\n        return;\n    }\n    throw new RuntimeException(\"\u65e0\u6cd5\u8fde\u63a5\u670d\u52a1\u5668\");\n}\n\n// PostConstruct\u786e\u4fdd\u8be5\u51fd\u6570\u5728\u7c7b\u88ab\u521d\u59cb\u5316\u65f6\u8c03\u7528\n// @PostConstruct\npublic void init() throws MqttException, InterruptedException {\n    connect(3);\n    client.subscribe(topicStatusOnline, 2);\n    client.subscribe(topicStatusRunning, 2);\n    MqttMessage message = new MqttMessage();\n    JSONObject payload = new JSONObject();\n    payload.put(\"type\", \"query_status\");\n    payload.put(\"content\", \"\");\n    message.setPayload(payload.toJSONString().getBytes());\n    client.publish(topicServerReconnected, message);\n}\n\npublic void termCountIncreasement() {\n    termCount++;\n}\n\npublic void termCountDecreasement() {\n    termCount--;\n}\n\npublic int getTermCount() {\n    return termCount;\n}\n\npublic static void main(String[] args) throws Exception {\n    TermStatusReceiver client = new TermStatusReceiver();\n    client.init();\n}\n\n}\n\npackage org.zyd.java.tool.emq.test;\nimport java.util.Date;\nimport org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;\nimport org.eclipse.paho.client.mqttv3.MqttCallback;\nimport org.eclipse.paho.client.mqttv3.MqttMessage;\nimport com.alibaba.fastjson.JSONException;\nimport com.alibaba.fastjson.JSONObject;\npublic class TermStatusReceiverCallback implements MqttCallback {\nprivate TermStatusReceiver termStatusReceiver;\n\npublic TermStatusReceiverCallback() {\n}\n\npublic TermStatusReceiverCallback(TermStatusReceiver termStatusReceiver) {\n    this.termStatusReceiver = termStatusReceiver;\n}\n\npublic void connectionLost(Throwable throwable) {\n    System.out.println(new Date() + \"\u8fde\u63a5\u4e22\u5931\uff0c\u5f00\u59cb\u91cd\u8fde...\");\n    while (true) {\n        try { // \u5982\u679c\u6ca1\u6709\u53d1\u751f\u5f02\u5e38\u8bf4\u660e\u8fde\u63a5\u6210\u529f\uff0c\u5982\u679c\u53d1\u751f\u5f02\u5e38\uff0c\u5219\u6b7b\u5faa\u73af\n            Thread.sleep(1000);\n            termStatusReceiver.init();\n            break;\n        } catch (Exception e) {\n            continue;\n        }\n    }\n}\n\npublic void deliveryComplete(IMqttDeliveryToken token) {\n    System.out.println(new Date() + \"\u53d1\u5e03\u6d88\u606f\u6210\u529f : \" + token.isComplete());\n}\n\npublic void messageArrived(String topic, MqttMessage message) throws Exception {\n    // subscribe\u540e\u5f97\u5230\u7684\u6d88\u606f\u4f1a\u6267\u884c\u5230\u8fd9\u91cc\u9762\n    // System.out.println(message);\n//  System.out.println(new Date() + \"\u63a5\u6536\u6d88\u606f\u4e3b\u9898 : \" + topic);\n//  System.out.println(new Date() + \"\u63a5\u6536\u6d88\u606fQos : \" + message.getQos());\n//  System.out.println(new Date() + \"\u63a5\u6536\u6d88\u606f\u5185\u5bb9 : \" + new String(message.getPayload()));\n    if(topic.startsWith(\"$SYS/brokers/emq_ims@\") && topic.endsWith(\"connected\")) {\n        if(new String(message.getPayload()).contains(\"\\\"clientid\\\":\\\"server\\\"\")) {\n            return;\n        }\n        if(topic.endsWith(\"/disconnected\")) {\n            termStatusReceiver.termCountDecreasement();\n        } else {\n            termStatusReceiver.termCountIncreasement();\n        }\n        System.out.println(new Date() + \"\u76ee\u524d\u7ec8\u7aef\u6570 \uff1a\" + termStatusReceiver.getTermCount());\n    } else if(topic.equals(TermStatusReceiver.topicStatusRunning)) {\n    //  JSONObject jsonObject = JSONObject.parseObject(new String(message.getPayload()));\n    //  if(jsonObject.getString(\"clientid\").equals(\"AA:BB:CC:DD:EE:FF\")) {\n        try {\n            JSONObject tryJson = JSONObject.parseObject(new String(message.getPayload()));\n            MqttMessage server_to_term_message = new MqttMessage();\n            server_to_term_message.setPayload(\"XXXXXXXXXXXXXXXXXXXXXXXXX\".getBytes());\n            TermStatusReceiver.client.publish(tryJson.getString(\"clientid\"), server_to_term_message);\n            System.out.println(new Date() + \"\u63a5\u6536\u7ec8\u7aef\u72b6\u6001\u53d8\u5316 : \" + new String(message.getPayload()));\n        } catch(JSONException jsonException) {\n        }\n    }\n}\n\n}\n. Hi Gibert,\nI guess, maybe the message queue is full because so many disconnected messages come at the same time, so many messages are discarded?\n@Gilbert-Wong \nBR\nJack Zhang. Hi Gilbert,\nYes, I just tried myself, and found EMQ_MQTT__MQUEUE__MAX_LENGTH is the real reason to cause the problem..\nBR\nJack Zhang. ",
    "eastpav": "I have encontered this problem too.  It looks like the autoheal cannot work.  And a join in EMQ pod's cmdline can recovery the cluster, but it is not good practice. \nBy the way, my EMQ is 2.3.8 build from EMQ official docker file.. @isman-usoh  this isn't startup the cluster,  cluster is ok. the problem is the cluster cannot recovery from a netsplit automatically.. ",
    "isman-usoh": "\nEMQ_NAME NEEDS to be set. And the only way that ekka works is if the nodes addresses are in this format:\nEMQ_CLUSTER__K8S__APP_NAME@POD_ID\nthats why EMQ_CLUSTER__K8S__APP_NAME needs to be equal to EMQ_NAME\nalso, I had to not set NODE_NAME\nThis needs to be better documented\n\nhttps://github.com/emqx/ekka/issues/14#issuecomment-318878900. ",
    "nubunto": "We've been having the exact same issue with k8s. Any updates on this?. FWIW, we solved this by adding a liveness and readiness probe that hits the Kubernetes internal API, hits the internal EMQ API, and makes a sort of \"majority check\", that is, the cluster that has the majority of the nodes is considered healthy; the other partitioned nodes are then considered unhealthy and recicled by Kubernetes, and eventually they all join the same cluster.. ",
    "Forsure-Wang": "I encountered the same issue,did you find any solution?. I am experiencing the same problem.Frequently I need execute command \u201cemqttd console\u201d and press ctrl+c to console it and run \"emqttd console\" again,only in this way can emq startup successfully. Not solved.. > Are you executing the command in cmd or in powershell?\nIn cmd.\nThis problem only occurs the first time emq runs on a computer.\nIt seems that this is not a serious problem.\nI mean, if you restart the computer and then run \"emqttd console\" command in cmd,this problem occurs.. @tigercl Thanks for your advice and I'll check it latter.. @HJianBo Thank you so much and looking forward to the solution.. @HJianBo Sorry for late reply and my explanation is as follows.\nThe fact:\n  Different MQTT client can connect to EMQ using the same cert file.\nMy requirement:\n  One certificate can only be used once.In other words, clients can not share it's own cert with others.\nMy solution:\n  Every time I sign a client certificate, I assign the cert's Common Name with a unique string as it's ID.With the \"emq_auth_http\" plug-in and the setting \"peer_cert_as_username=cn\", I can get the cert's Commen Name(it's \"ID\") and store it in database.\nIf another client try to connect EMQ via SSL, I would check it's cert file's Common Name first, if the cn is already in database, I return 4XX to the \"emq_auth_http\" plug-in, meaning the authentication failed.\nAnd when the clients connecting, I want to check their username at the same time, that's why I need the Common Name and username both.\nHave I explained clearly? Maybe there are better solutions to my requirement? Looking forward to your suggestions! \n  . The two suggestions sounds good, thanks a lot !\nBut if the username field is blank, the EMQ console would print \"username undefined\" error. Users must put  something in the username field.\nAnd, because the username will be replaced by cert's CN whatever the client's username is, users can put whatever  they want in the username field, how weird is it ! , that's the problem.\nMaybe there are three ways to solve the problem\n1.Allow the clients to keep the username undefined\n (Set mqtt.allow_anonymous = true could help, but when clients connecting via TCP(port 1883), they don't need to provide username and password anymore, that's not what I want.)\n2.Get the cert's CN and client's username at the same time.\n3.Deploy two EMQ, one for TCP only,  the other for SSL only.\n. > In the newly released version yesterday, we have fixed this behavior that doesn't deny the empty username connection unless the allow_anonymous is false.\nIn the new version, empty username connection is allowed even though the allow_anonymous is false, right?\n\nIn my view, if you set peer_cert_as_username true, you must pass username with CN name on the 1883 connection, which can keep the username having same semantics in the backend.\n\nI can't get the point, could you explain it please?\n. > Maybe there are three ways to solve the problem\n\n1.Allow the clients to keep the username undefined\n(Set mqtt.allow_anonymous = true could help, but when clients connecting via TCP(port 1883), they don't need to provide username and password anymore, that's not what I want.)\n2.Get the cert's CN and client's username at the same time.\n3.Deploy two EMQ, one for TCP only, the other for SSL only.\n\nThe third way is a bad idea. I tried to set allow_anonymous=true and load the emq_auth_http plug-in, the Erlang console said \"Username 'undefined' login failed for username_or_password_undefined\"\nSorry for my stupid brain.. ",
    "fair18": "I am getting the same issue as @rjbaat . ",
    "jupin-r": "The same issue: We have cluster of three mqqt brokers and multiple clients in shared topic. Sometimes the message is tripled, sometimes doubled.. ",
    "dannieboiz": "Gilbert... so are you saying this is just the nature of running it on a Windows machine?. ",
    "ali-zohrevand": "no i used compiled  version emqttd-macosx-v2.3.11.zip, my macos version is 10.13.6 and http://emqtt.io/static/brokers/emqttd-macosx10.13-v2.3.11.zip  version for 10.13 is not found. i link openssl to path\n$ ls /usr/local/opt/openssl\naes.h       buffer.h    conf_api.h  dtls1.h     err.h       lhash.h     ocsp.h      pkcs7.h     safestack.h ssl23.h     ui.h\nasn1.h      camellia.h  crypto.h    e_os2.h     evp.h       md4.h       opensslconf.h   pqueue.h    seed.h      ssl3.h      ui_compat.h\nasn1_mac.h  cast.h      des.h       ebcdic.h    hmac.h      md5.h       opensslv.h  rand.h      sha.h       stack.h     whrlpool.h\nasn1t.h     cmac.h      des_old.h   ec.h        idea.h      mdc2.h      ossl_typ.h  rc2.h       srp.h       symhacks.h  x509.h\nbio.h       cms.h       dh.h        ecdh.h      in      modes.h     pem.h       rc4.h       srtp.h      tls1.h      x509_vfy.h\nblowfish.h  comp.h      dsa.h       ecdsa.h     krb5_asn.h  obj_mac.h   pem2.h      ripemd.h    ssl.h       ts.h        x509v3.h\nbn.h        conf.h      dso.h       engine.h    kssl.h      objects.h   pkcs12.h    rsa.h       ssl2.h      txt_db.h\nsadly it did not worked!. thanks @terry-xiaoyu \ni re link openssl \nsudo ln -s /Users/../homebrew/Cellar/openssl/1.0.2p/ /usr/local/opt/openssl\n$ ls\nCHANGES         LICENSE         README          include         share\nit worked!. is emqttd_ctl only way to create mqtt user?. Thanks, i used mongo plugin and its worked. i doubled check, it says send but actually blocked.. is it in your future task or feature adding this functionality? . thanks, i really need it, please consider this feature or some thing like it to get statics of a topic or other similar functionality,\n . when i use mongo plugin acl conf file ignored by emqtt and a superuser from mqtt_user collection could subscribe \"#\" wildcard from other ip \"not local wich restricted in conf file\"\nmy conf file is:\n```\n\n%%\n%% ACL\n%%\n%% -type who() :: all | binary() |\n%%                {ipaddr, esockd_access:cidr()} |\n%%                {client, binary()} |\n%%                {user, binary()}.\n%%\n%% -type access() :: subscribe | publish | pubsub.\n%%\n%% -type topic() :: binary().\n%%\n%% -type rule() :: {allow, all} |\n%%                 {allow, who(), access(), list(topic())} |\n%%                 {deny, all} |\n%%                 {deny, who(), access(), list(topic())}.\n%%\n%%--------------------------------------------------------------------\n{allow, {user, \"dashboard\"}, subscribe, [\"$SYS/#\"]}.\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", \"#\"]}.\n{deny, all, subscribe, [\"$SYS/#\", {eq, \"#\"}]}.\nas you see only localhost should subscribe # but it is not true based on my tests. . is it right emqx ignore acl file when mongo plugin enabled? how can i filter mqtt_user by ip when mongo plugin is enabaled?. i tested this problem today again. i've uploaded emqx to my vps too.\nmy acl conf is :\n%%--------------------------------------------------------------------\n%%\n%% ACL\n%%\n%% -type who() :: all | binary() |\n%%                {ipaddr, esockd_access:cidr()} |\n%%                {client, binary()} |\n%%                {user, binary()}.\n%%\n%% -type access() :: subscribe | publish | pubsub.\n%%\n%% -type topic() :: binary().\n%%\n%% -type rule() :: {allow, all} |\n%%                 {allow, who(), access(), list(topic())} |\n%%                 {deny, all} |\n%%                 {deny, who(), access(), list(topic())}.\n%%\n%%--------------------------------------------------------------------\n{allow, {user, \"dashboard\"}, subscribe, [\"$SYS/#\"]}.\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", \"#\"]}.\n{deny, all, subscribe, [\"$SYS/#\", {eq, \"#\"}]}.\n{allow, all}.\ni created a user which is :\ndb.mqtt_user.insert({username: \"test\", password: \"pass hash\", is_superuser: true})\nthis user could subscribe `#` topic , but acl.conf has been filtered this access.\ni could give you password of test user for testing\nis this because of test user is super user? i think not.\ntest user not only could subscribe `#` topic but also receive message from it.\n. sha256\nit is '8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92' for '123456'. i've tested for simple user and not super user,\nmy acl file is:\n%%--------------------------------------------------------------------\n%%\n%% ACL\n%%\n%% -type who() :: all | binary() |\n%%                {ipaddr, esockd_access:cidr()} |\n%%                {client, binary()} |\n%%                {user, binary()}.\n%%\n%% -type access() :: subscribe | publish | pubsub.\n%%\n%% -type topic() :: binary().\n%%\n%% -type rule() :: {allow, all} |\n%%                 {allow, who(), access(), list(topic())} |\n%%                 {deny, all} |\n%%                 {deny, who(), access(), list(topic())}.\n%%\n%%--------------------------------------------------------------------\n{allow, {user, \"dashboard\"}, subscribe, [\"$SYS/#\"]}.\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"$SYS/#\", \"#\"]}.\n{allow, {ipaddr, \"127.0.0.1\"}, pubsub, [\"root/#\"]}.\n{deny, all, subscribe, [\"$SYS/#\", {eq, \"#\"}]}.\n{deny, all, pubsub, [\"root/#\"}]}.\n{allow, all}.\ni try subscribe to/root/#topic from other ip and it was successful, but according to acl file it should be filtred. Hi @Gilbert-Wong \nmy conf file is :\n--------------------------------------------------------------------\nAuthentication/Access Control\n--------------------------------------------------------------------\nAllow anonymous authentication by default if no auth plugins loaded.\nNotice: Disable the option in production deployment!\n\nValue: true | false\nallow_anonymous = false\nAllow or deny if no ACL rules matched.\n\nValue: allow | deny\nacl_nomatch = deny\nDefault ACL File.\n\nValue: File Name\nacl_file = etc/acl.conf\nWhether to enable ACL cache.\n\nIf enabled, ACLs roles for each client will be cached in the memory\n\nValue: on | off\nenable_acl_cache = on\n....\n```. let me ask better question.\nwhat is minim hardware to achive handling emqx 40000 message/persecond  from single node?\n. ",
    "XiaoKaiRen": "I hope to have the following features\nhttps://mosquitto.org/man/mosquitto-conf-5.html\nuse_username_as_clientid\nuse username replace clientid \nHow to achieve in EMQ\uff1f\n. ",
    "zhitingxie": "@Gilbert-Wong Thanks a lot for your suggestion. \nIs there any log about mochiweb crashed, which can help me to ensure this bug? \nBTW, could you pls tell me how to attach to emqttd shell to restart mochiweb?. @Gilbert-Wong I have tried with your method. It seems not working.\n\n. this bug is got at the version 2.3.7. it remains after I upgrade to 2.3.11, the latest version. nothing is got. \n. when I execute \"application:start(mochiweb).\" at the first time, the log gives error saying mochiweb already_started. Then I exit erlang shell, try to attach again, the log shows \"node is not running\"\n\n\nSo, I stop the emqttd and start it again, then execute \"emqttd attach\" to get into shell, and then run the command \"application:start(mochiweb).\", it works well. But, no improvement is got.. this log in this picture is got when I use mosquitto_sub as a clients to receive message from other publish clients. The message is published by clients.\n\n. sorry, my broker is mosquitto instead of emqttd. I am confused with when the mosquitto is installed and executed. I have uninstalled mosquitto, and all works well. Thanks very much,I am so sorry for my mistake.. @turtleDeng is this a bug or unsupported in version emq v2.3?. another problem is, if I control access limit use username/password only, give different permission to different username, and use acl.conf to check permission. Is this feather supported?. ",
    "jerry-chao": "emqttd_ctl cluster join will check node is already in cluster and node is running ekka_cluster, then stop and clean current cluster info no matter what it is and join the new node ekka_mnesia. you can join emq1@127.0.0.1 by emq2@127.0.0.1 and emq3@127.0.0.1 and emq4@127.0.0.1 one by one, then the four nodes are in one cluster. hen I try to add the node 3 to the cluster\nC:\\EMQ\\emqttd2\\bin>emqttd_ctl cluster join emq3@127.0.0.1\nJoin the cluster successfully.\nCluster status: [{running_nodes,['emq3@127.0.0.1','emq2@127.0.0.1']}]\nthis is what you have done, you should do something like this \nC:\\EMQ\\emqttd3\\bin>emqttd_ctl cluster join emq1@127.0.0.1\nyou also can join in emq2@127.0.0.1\n. maybe mqtt broker cannot do it as what you want. The retained message will send to client when client  connect and you want it only the first client receive the retained msg. if you really don't want miss message and some clients handle it, maybe you can do it by kafka plugin or something else.  By the way, retained message only keep the last one.. @Gilbert-Wong thanks for your correct and i will have a look at share subscription of mqtt 5.0. maybe you can check it by openssl \n$ openssl verify -CAfile certs/ca.cert.pem intermediate/certs/intermediate.cert.pem\nunable to load certificate\n140736089576392:error:0906D064:PEM routines:PEM_read_bio:bad base64 decode:pem_lib.c:819:\nthis is the error when i change it certificate . I have encounter the same problem. The CA maybe is not include the Root CA which is signed by itself.  My Company is signed by WoTrus CA Limited and WoTrus CA Limited is signed by Unizeto Technologies S.A. and Unizeto Technologies S.A. is signed by Unizeto Sp. z o.o. .Unizeto Sp. z o.o. is the root CA and Other CA are intermediate CA. Maybe your client cannot find Unizeto Sp. z o.o.  CA.  You can download it here and add it to your client CA chain if you use the the root CA.. I am sorry i cannot give my company's CA but you can make one by yourself. I have written it down here which i have test it myself.   @redmond007 . you are missing username and password args for mosquitto_sub and you should add -u {Username} -P {Password}. there are no auth_modules because mongo auth plugin was not enabled \nplease check your plugins like this\n\n. i test it by myself local.  It print auth_modules_not_found when there are no user data in mongodb\nUsername 'xxxx' login failed for auth_modules_not_found\nIt connect  successfully after I add the userdata to mongoDB.  I try it with mqttbox in mqtt/tcp and mqtt/ws\nIt will print password_error if the password is error, and returnCode equal 5\nUsername 'xxx' login failed for password_error\n. @tigercl maybe the errorCode is confused. It cannot differentiate no auth modules from no users case\nemqx_access_contro.erl\n```\nauthenticate(Credentials, Password) ->\n    authenticate(Credentials, Password, lookup_mods(auth)).\nauthenticate(Credentials, _Password, []) ->\n    Zone = maps:get(zone, Credentials, undefined),\n    case emqx_zone:get_env(Zone, allow_anonymous, false) of\n        true  -> ok;\n        false -> {error, auth_modules_not_found}\n    end;\nauthenticate(Credentials, Password, [{Mod, State, _Seq} | Mods]) ->\n    case catch Mod:check(Credentials, Password, State) of\n        ok -> ok;\n        {ok, IsSuper} when is_boolean(IsSuper) ->\n            {ok, #{is_superuser => IsSuper}};\n        {ok, Result} when is_map(Result) ->\n            {ok, Result};\n        {continue, Result} when is_map(Result) ->\n            {continue, Result};\n        ignore ->\n            authenticate(Credentials, Password, Mods);\n        {error, Reason} ->\n            {error, Reason};\n```. I try it with ssl/cert and below is my command \nmosquitto_sub -h localhost -p 8883 --insecure --cafile etc/certs/cacert.pem -u demo -P 123456  -i demotcp  -t 'demo'\nthe server print some log like this\n14:26:46.468 [debug] MQTT(127.0.0.1:49558): RECV <<16,33,0,4,77,81,84,84,4,194,0,60,0,7,100,101,109,111,116,99,112,0,4,100,101,109,111,0,6,49,50,51,52,53,54>>\n14:26:46.468 [debug] MQTT(@127.0.0.1:49558): RECV CONNECT(Q0, R0, D0, ClientId=demotcp, ProtoName=MQTT, ProtoVsn=4, CleanStart=true, KeepAlive=60, Username=demo, Password=******)\n14:26:46.469 [debug] this is UserMap #{<<\"_id\">> => {<<91,219,237,74,30,136,160,132,155,177,142,97>>},<<\"is_superuser\">> => false,<<\"password\">> => <<\"123456\">>,<<\"salt\">> => <<\"plain\">>,<<\"username\">> => <<\"demo\">>}\n14:26:46.470 [debug] MQTT(demotcp@127.0.0.1:49558): SEND CONNACK(Q0, R0, D0, AckFlags=0, ReasonCode=0)\n14:26:46.470 [debug] MQTT(127.0.0.1:49558): SEND <<32,2,0,0>>\n14:26:46.470 [debug] MQTT(127.0.0.1:49558): Keepalive at the interval of 45\n14:26:46.470 [debug] MQTT(127.0.0.1:49558): RECV <<130,9,0,1,0,4,100,101,109,111,0>>\n14:26:46.470 [debug] MQTT(demotcp@127.0.0.1:49558): RECV SUBSCRIBE(Q1, R0, D0, PacketId=1, TopicFilters=[{<<\"demo\">>,\n                                                                                                                                                #{nl => 0,qos => 0,rap => 0,rc => 0,rh => 0}}])\n14:26:46.471 [debug] MQTT(demotcp@127.0.0.1:49558): SEND SUBACK(Q0, R0, D0, PacketId=1, ReasonCodes=[0])\n14:26:46.471 [debug] MQTT(127.0.0.1:49558): SEND <<144,3,0,1,0>>\nSorry I cannot  reproduce your scenario locally and maybe there is none business with ssl/cert. And you can add some log to check it clearly , such as before and after Mod:check.\n. @petergerten I am so sorry for misunderstanding the question.  Client checked server's certificate, but the server donot request client's certificate.   You want to verify the client certificate.  And I try to add config like \nlistener.ssl.external.peer_cert_as_username = cn\nlistener.ssl.external.verify = verify_peer\nretry it with etc/certs/client-cert.pem \nmosquitto_sub -h localhost -p 8883 --insecure --cafile etc/certs/cacert.pem --key etc/certs/client-key.pem --cert etc/certs/client-cert.pem -i demotcp -u demo -P 123456  -t 'demo' -d\ncheck the CN of client-cert.pem\nzhangchao@zhangchao:~/work/github.com/emqx-rel% openssl x509 -noout -subject -in etc/certs/client-cert.pem\nsubject= /CN=MacBook-Air.local/O=client\nAdd new client to db\ndb.mqtt_user.insert({username: \"MacBook-Air.local\", password: \"123456\", salt: \"plain\", is_superuser: false})\nI can login it successfully.\nFinally I recheck  the command which you have run, you missed -u and -P args.  I reproduced your case with below command\nmosquitto_sub -h localhost -p 8883 --insecure --cafile etc/certs/cacert.pem --key etc/certs/client-key.pem --cert etc/certs/client-cert.pem -i demotcp  -t 'demo' -d\nThe username which you passed with args will be replaced by the CN of the client certificate.  You can check it https://mosquitto.org/man/mosquitto_sub-1.html\n\nYou must set password and username both.\nYou can try it with -u ${AnyName} and -P ${password}\n. ",
    "liusong1111": "Note the latter time, I published a retained message, which is load balanced to one subscription. \nThe message type of $share or $queue is invented by EMQ, not by MQTT protocol.\nSo, What and Why they are born is interpreted by EMQ, and what will happen if message is retained is decided by EMQ, right?\nI think they are about Load Balance, but now it's inconsistent and painful to use.. @Gilbert-Wong Thanks for clarify($share is part of MQTT 5.0 protocol). \nI tried emq 2.x, It has the same behavior.\nPlease ref:\nhttps://github.com/erlio/vernemq/issues/337\nhttps://github.com/erlio/vernemq/issues/808\nBack to the original intention, retained is for keeping the latest state and will be sent to client when it's connected and subscripted.  $share is for load balance. \nImaging the following scenario:\nI'm writing a IoT program named device_manager, which subscribes topic device/+/status.\n + means device_id, status is enum of ready,running or crashed.\nWhen a new device comes up, it publishes a retained message(payload is ready) to device/{device_id}/status, and device_manager receives it, and if payload is ready or crashed then spawn a subprocess to handle the device messages. \nIn the subprocess,  start a new MQTT client,  which publish a retained message(payload running) to device/{device_id}/status, and set the last will message as a retained message to topic device/{device_id}/status and payload crashed.\nAfter that, the subprocess handles the business things, such as subscribing device/{id}/message_stream and handle it in loop. \nAs device_manager or subprocess may crash or be killed manually, so I use retained and *last will message to recover when they are restarted.\nAs device_manager can run on multiple server(each with a device_manager), I use $share staff to handle Load Balance.\nBut things won't go as expected.\nA more detail concern is how they are load balanced. the precise way is routing by device_id(hash ring or something like that), but things may be  complicated.\n. Thanks. Good job.. ",
    "chao-cn": "emqttd.cmd use emqttd-windows10-v2.3.11\\emqttd\\erts-8.3\\bin\\erl.exe the version is  Erlang/OTP 19 [erts-8.3]. ",
    "phper-chen": "Thank u, i have solved it already. There was a misunderstanding in docker swarm.. Thank ur translation for me.\n1.That is to say I should use a Prefix \"$share\" in the sub uri to make the function take effect , isn`t it? But I don't know if this character \"$share\" is a variable or is it a string like this\uff0ccan u tell me? thank u~ \n2.I saw the version 2.0 also has the feature as u said, and my server is 2.0 now, should  I have to upgrade it?\n. Yes, I can see that 3.0 supports this feature, but 3.0 only has a beta version, I need to use a stable production version.\nHowever, our current EMQ service is 2.0, and I handle EMQ docker \"emqttd-docker-v2.3.1\" with it. Does '2.0' support this featrue?. Wut a pity...\nThen when does your stable version come out? I want to replace the old version.\nThank u any way~\n. @terry-xiaoyu Thank ur proposal, now I am using a cluster mode EMQ service, and I will have a try as u mentioned above~ . Yes, I can get Intranet IP address easily, but I can not get the External network IP address,\nAnd I see the External network IP addresses at client dashboard web with 18083 port that EMQ provides,  that is to say,  EMQ knows it.. It is great, thank u~. @terry-xiaoyu \nHi, bro, error log below.\ud83d\ude04\n`\n(4e0863386f9b@10.0.0.5)1> =ERROR REPORT==== 31-Oct-2018::12:23:56.647726 ===\nGET /api/v3/connections/02931117C6ED8D30 error: {badkey,peername}, stacktrace:\n[{maps,get,[peername,#{}],[]},\n {emqx_mgmt_api_connections,adjust_format,1,\n                            [{file,\"src/emqx_mgmt_api_connections.erl\"},\n                             {line,107}]},\n {emqx_mgmt_api_connections,'-format/1-lc$^0/1-0-',1,\n                            [{file,\"src/emqx_mgmt_api_connections.erl\"},\n                             {line,89}]},\n {emqx_mgmt_api_connections,lookup,2,\n                            [{file,\"src/emqx_mgmt_api_connections.erl\"},\n                             {line,77}]},\n {minirest_handler,dispatch,3,[{file,\"src/minirest_handler.erl\"},{line,55}]},\n {minirest,handle_request,2,[{file,\"src/minirest.erl\"},{line,66}]},\n {minirest,init,2,[{file,\"src/minirest.erl\"},{line,51}]},\n {cowboy_handler,execute,2,[{file,\"src/cowboy_handler.erl\"},{line,37}]}]\n(4e0863386f9b@10.0.0.5)1> 12:23:56.647 [error] GET /api/v3/connections/02931117C6ED8D30 error: {badkey,peername}, stacktrace:\n[{maps,get,[peername,#{}],[]},{emqx_mgmt_api_connections,adjust_format,1,[{file,\"src/emqx_mgmt_api_connections.erl\"},{line,107}]},{emqx_mgmt_api_connections,'-format/1-lc$^0/1-0-',1,[{file,\"src/emqx_mgmt_api_connections.erl\"},{line,89}]},{emqx_mgmt_api_connections,lookup,2,[{file,\"src/emqx_mgmt_api_connections.erl\"},{line,77}]},{minirest_handler,dispatch,3,[{file,\"src/minirest_handler.erl\"},{line,55}]},{minirest,handle_request,2,[{file,\"src/minirest.erl\"},{line,66}]},{minirest,init,2,[{file,\"src/minirest.erl\"},{line,51}]},{cowboy_handler,execute,2,[{file,\"src/cowboy_handler.erl\"},{line,37}]}]\n`\n. Hi, when could ur team handle this problem?  We have some business requirements associated with this API, should I roll back version 2.0?\n. > 3.0 is still a release candidate edition. We would fix this problem as quick as possible.\n@Gilbert-Wong Thank you very much~. Hi, Make a supplement to the topic. This bug has been occurred in verision-----emqx-docker-v3.0-rc.1. @Gilbert-Wong yes, I had a try again with rc.3 and it works well in version of rc.3. But I think I should test the stability of this version.Thanks~ (single node and not in a cluster mode with config params \"EMQX_BROKER__SHARED_SUBSCRIPTION_STRATEGY=hash\" in docker-compose.yaml). @Gilbert-Wong Im so sorry, it was my fault that tested it in a single node env and it works, But in a cluster mode, it still shows internal server error randomly. So I think it is a special case only at the cluster mode. Maybe the reason is the load-balance strategy that the EMQ uses.\n. Thanks, I will have a try~. My client can not connect the EMQ cluster in some time, But sometimes it wroks.\nCan u give me a hand? thank u~\n. Cluster has been started with docker swarm, and joined cluster in docker container bash environment successfully, but my clinet always can not connect to EMX cluster.\nThis is my docker-compose.yml\n`\nversion: '3'\nservices:\n    emqtt-server:\n        #build: .\n        image: \"emqx-docker-v3.0-rc.1\"\n        networks:\n          emq-cluster:\n            aliases:\n             - emqtt.io\n        deploy:\n          replicas: 4\n          restart_policy:\n            condition: on-failure\n        ports:\n            - \"8883:8883\"\n            - \"8080:8080\"\n            - \"1883:1883\"\n            - \"18083:18083\"\n            - \"4369:4369\"\n            - \"6000-6100:6000-6100\"\n       # restart: always\n        environment:\n            - EMQ_LOADED_PLUGINS=\"emqx_recon,emq_modules,emqx_delayed_publish,emqx_retainer,emqx_dashboard,emqx_auth_mongo\"\n            - EMQ_AUTH__MONGO__SERVER=*:27017\n            - EMQ_AUTH__MONGO__POOL=8\n            - EMQ_AUTH__MONGO__DATABASE=*\n            - EMQ_AUTH__MONGO__AUTH_QUERY__COLLECTION=****\n            - EMQ_AUTH__MONGO__AUTH_QUERY__PASSWORD_HASH=plain\n            - AUTH__MONGO__AUTH_QUERY__SELECTOR=username=%u\n            - AUTH__MONGO_AUTH_QUERY__PASSWORD_FIELD=password\n            - EMQ_BROKER__SHARED_SUBSCRIPTION_STRATEGY=hash\n            - EMQ_MQTT__ALLOW_ANONYMOUS=false\n            - EMQ_AUTH__MONGO__SUPER_QUERY=off\n            - EMQ_AUTH__MONGO__ACL_QUERY=off\n        volumes:\n            - /home/ai_camera_emqtt/etc/certs:/opt/emqx/etc/certs:ro\n            - /home/ai_camera_emqtt/log:/opt/emqx/log\n        user: root\n        logging:\n            driver: \"json-file\"\n            options:\n                max-size: \"200m\"\n                max-file: \"5\"\nnetworks:\n    emq-cluster:\n. Should I change prefix of some config params indocker-compose.ymllikeEMQ_AUTH__MONGO__SERVERtoEMQX_AUTH__MONGO__SERVER`? I can not find some info about it.. I have solved it, thanks any way~. thanks~. The above readability is not very good, let me take a screenshot\n\nIt seems to be the client '02710017C63AC922' reconnected to random node every time in concurrent test of reconnection under cluster mode, then failed with message \"Failed to open session: client_id_unavailable\".. Maybe a wrong use of reconnection.. > Hi@phper-chen So sorry for late reponse, This is LAN ip. Maybe you need to try again on other networks\ud83d\ude0a\nThanks for ur reply, How can I fix this pro? I`m not familiar with the Knowledge about routers\ud83d\ude22. > @phper-chen It's no problem to get IP, Because the device you connect to is in a local area network. If you want to verify that getting IP is correct, You can try it on other networks. For example, Using external network.\ud83d\ude09\nBefore ur first reply, I had already tested it in other external network, but the condition stays a same status like before.\nAny way, thanks ur reply~. > @phper-chen Sorry, I thought about it carefully. Do you use NAT(Network Address Translation) on the Internet\u2753\nYes, Our firmware engineer should have used this. Is there a solution?. > I think you are a local area network with multi-level routing. You want the server to get the address and port of each client in the network, This one is not available.\nIn front of EMQ cluster, I has deployed a haproxy to rebalance the connections. I think the problem should be here, and I will have a try on this.\nThank u~. The config info below:\n\n. \n. > Hi @phper-chen It seems that your auth. mongo. server configuration is wrong\nwut should I do? should I add a config \"auth.mongo.type=rs\" in mongo replica? Thank u!. > @phper-chen yeah. Does your mongoDB use Replica Set \uff1f\nyes, I used a url like this \"mongodb://dds-xxxxxxxxx.mongodb.rds.aliyuncs.com:3909/example?replicaSet=mgset-201893\"\nIn log, it shows below, and this error leads a high cpu usage.\n\n. > > > @phper-chen yeah. Does your mongoDB use Replica Set \uff1f\n\n\nyes, I used a url like this \"mongodb://dds-xxxxxxxxx.mongodb.rds.aliyuncs.com:3909/example?replicaSet=mgset-201893\"\nIn log, it shows below, and this error leads a high cpu usage.\n\n\n@phper-chen The auth. mongo. server configuration only supports host + port format. You can try this dds-xxxxxxxxx.mongodb.rds.aliyuncs.com:3909\n\nBut in mongo shell, it can`t take effect with \"dds-xxxxxxxxx.mongodb.rds.aliyuncs.com:3909\", how do I deal with the suffix with \"/example?replicaSet=mgset-201893\" after \"3909\" ?. My env in docker-compose:\n\nAnd it always show these error:\n\n. > > My env in docker-compose:\n\n\n\nAnd it always show these error:\n\n\nIt seems that password error. Is your MongoDB account password and url correct?\n\nMaybe I should set the encryption method of the mongo replica set connection password to \u201cSCRAM-SHA-1\u201d\uff0cThank you for your patience\uff0cand I will have a try~\n. The problem is a wrong auth_source that I configured, thank u~\ud83d\ude02. ",
    "navSharma47": "Any update\nRegarding this issue. Please let me know. How can i deny a publish .. ",
    "myie9": "how to config to authenticate the client using the  username , password.  and deny others with wrong usename. how to config wss ? i've config my websites cert to emq. but not ok.. ",
    "coveralls": "Pull Request Test Coverage Report for Build 3247\n\n43 of 47 (91.49%)  changed or added relevant lines in 3 files are covered.\n2 unchanged lines in 2 files lost coverage.\nOverall coverage increased (+0.5%) to 55.561%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_connection.erl | 12 | 13 | 92.31%\n| src/emqx_session.erl | 9 | 10 | 90.0%\n| src/emqx_gc.erl | 22 | 24 | 91.67%\n | **Total:** | **43** | **47** | **91.49%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_connection.erl | 1 | 58.52% |\n| src/emqx_session.erl | 1 | 69.96% |\n | **Total:** | **2** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3230: |  0.5% |\n| Covered Lines: | 2278 |\n| Relevant Lines: | 4100 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3201\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage increased (+0.08%) to 54.771%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_message.erl | 1 | 28.13% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3196: |  0.08% |\n| Covered Lines: | 2227 |\n| Relevant Lines: | 4066 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3600\n\n115 of 139 (82.73%)  changed or added relevant lines in 4 files are covered.\n19 unchanged lines in 7 files lost coverage.\nOverall coverage increased (+1.6%) to 58.793%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_packet.erl | 5 | 7 | 71.43%\n| src/emqx_protocol.erl | 20 | 24 | 83.33%\n| src/emqx_client.erl | 84 | 102 | 82.35%\n | **Total:** | **115** | **139** | **82.73%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_cm.erl | 1 | 69.39% |\n| src/emqx_broker_helper.erl | 1 | 47.06% |\n| src/emqx_sys_mon.erl | 1 | 18.33% |\n| src/emqx_sm.erl | 1 | 67.06% |\n| src/emqx_router_helper.erl | 2 | 26.09% |\n| src/emqx_packet.erl | 4 | 69.88% |\n| src/emqx_protocol.erl | 9 | 69.29% |\n | **Total:** | **19** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3595: |  1.6% |\n| Covered Lines: | 2524 |\n| Relevant Lines: | 4293 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3211\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 54.782%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3207: |  0.0% |\n| Covered Lines: | 2228 |\n| Relevant Lines: | 4067 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3340\n\n28 of 29 (96.55%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+1.2%) to 56.432%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_shared_sub.erl | 28 | 29 | 96.55%\n | **Total:** | **28** | **29** | **96.55%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3332: |  1.2% |\n| Covered Lines: | 2360 |\n| Relevant Lines: | 4182 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3229\n\n1 of 1 (100.0%)  changed or added relevant line in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.3%) to 55.034%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3226: |  0.3% |\n| Covered Lines: | 2241 |\n| Relevant Lines: | 4072 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3297\n\n16 of 36 (44.44%)  changed or added relevant lines in 3 files are covered.\n2233 unchanged lines in 71 files lost coverage.\nOverall coverage decreased (-54.2%) to 1.382%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_misc.erl | 16 | 18 | 88.89%\n| src/emqx_connection.erl | 0 | 9 | 0.0%\n| src/emqx_session.erl | 0 | 9 | 0.0%\n | **Total:** | **16** | **36** | **44.44%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_ctl.erl | 1 | 29.17% |\n| src/emqx_tables.erl | 1 | 66.67% |\n| src/emqx_config.erl | 2 | 0.0% |\n| src/emqx_local_bridge_sup_sup.erl | 2 | 0.0% |\n| src/emqx_reason_codes.erl | 3 | 0.0% |\n| src/emqx_session_sup.erl | 3 | 0.0% |\n| src/emqx_broker_helper.erl | 4 | 0.0% |\n| src/emqx_sys_sup.erl | 4 | 0.0% |\n| src/emqx_time.erl | 4 | 0.0% |\n| src/emqx_cm_sup.erl | 4 | 0.0% |\n | **Total:** | **2233** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3275: |  -54.2% |\n| Covered Lines: | 57 |\n| Relevant Lines: | 4123 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3267\n\n10 of 16 (62.5%)  changed or added relevant lines in 4 files are covered.\n3 unchanged lines in 2 files lost coverage.\nOverall coverage increased (+0.05%) to 55.08%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_connection.erl | 2 | 3 | 66.67%\n| src/emqx_protocol.erl | 0 | 1 | 0.0%\n| src/emqx_ws_connection.erl | 1 | 5 | 20.0%\n | **Total:** | **10** | **16** | **62.5%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_keepalive.erl | 1 | 90.0% |\n| src/emqx_ws_connection.erl | 2 | 36.36% |\n | **Total:** | **3** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3230: |  0.05% |\n| Covered Lines: | 2239 |\n| Relevant Lines: | 4065 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3326\n\n7 of 14 (50.0%)  changed or added relevant lines in 2 files are covered.\n114 unchanged lines in 4 files lost coverage.\nOverall coverage increased (+0.5%) to 55.534%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_session.erl | 2 | 3 | 66.67%\n| src/emqx_protocol.erl | 5 | 11 | 45.45%\n | **Total:** | **7** | **14** | **50.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_gc.erl | 2 | 91.67% |\n| src/emqx_misc.erl | 2 | 93.33% |\n| src/emqx_connection.erl | 41 | 56.34% |\n| src/emqx_session.erl | 69 | 68.34% |\n | **Total:** | **114** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3230: |  0.5% |\n| Covered Lines: | 2298 |\n| Relevant Lines: | 4138 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3265\n\n0 of 1 (0.0%)  changed or added relevant line in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 55.034%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_session.erl | 0 | 1 | 0.0%\n | **Total:** | **0** | **1** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3230: |  0.0% |\n| Covered Lines: | 2241 |\n| Relevant Lines: | 4072 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3324\n\n3 of 58 (5.17%)  changed or added relevant lines in 1 file are covered.\n124 unchanged lines in 7 files lost coverage.\nOverall coverage increased (+0.1%) to 55.176%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_bridge.erl | 3 | 58 | 5.17%\n | **Total:** | **3** | **58** | **5.17%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_ws_connection.erl | 2 | 36.11% |\n| src/emqx_misc.erl | 2 | 93.33% |\n| src/emqx_gc.erl | 2 | 91.67% |\n| src/emqx_bridge.erl | 3 | 12.17% |\n| src/emqx_keepalive.erl | 6 | 62.5% |\n| src/emqx_connection.erl | 40 | 56.34% |\n| src/emqx_session.erl | 69 | 68.46% |\n | **Total:** | **124** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3269: |  0.1% |\n| Covered Lines: | 2292 |\n| Relevant Lines: | 4154 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3279\n\n0 of 9 (0.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage decreased (-0.1%) to 55.485%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_protocol.erl | 0 | 9 | 0.0%\n | **Total:** | **0** | **9** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3275: |  -0.1% |\n| Covered Lines: | 2276 |\n| Relevant Lines: | 4102 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3304\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+54.2%) to 55.615%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3301: |  54.2% |\n| Covered Lines: | 2293 |\n| Relevant Lines: | 4123 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3302\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 1.382%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3301: |  0.0% |\n| Covered Lines: | 57 |\n| Relevant Lines: | 4123 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3314\n\n7 of 8 (87.5%)  changed or added relevant lines in 3 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.03%) to 55.601%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_misc.erl | 5 | 6 | 83.33%\n | **Total:** | **7** | **8** | **87.5%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3312: |  0.03% |\n| Covered Lines: | 2298 |\n| Relevant Lines: | 4133 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3345\n\n7 of 8 (87.5%)  changed or added relevant lines in 3 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.03%) to 55.286%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_misc.erl | 5 | 6 | 83.33%\n | **Total:** | **7** | **8** | **87.5%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3332: |  0.03% |\n| Covered Lines: | 2301 |\n| Relevant Lines: | 4162 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3331\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.07%) to 55.254%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3330: |  0.07% |\n| Covered Lines: | 2298 |\n| Relevant Lines: | 4159 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3348\n\n0 of 11 (0.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage decreased (-0.04%) to 55.214%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_protocol.erl | 0 | 11 | 0.0%\n | **Total:** | **0** | **11** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3346: |  -0.04% |\n| Covered Lines: | 2298 |\n| Relevant Lines: | 4162 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3366\n\n0 of 6 (0.0%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.3%) to 56.704%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_mod_subscription.erl | 0 | 1 | 0.0%\n| src/emqx_config.erl | 0 | 5 | 0.0%\n | **Total:** | **0** | **6** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3354: |  0.3% |\n| Covered Lines: | 2360 |\n| Relevant Lines: | 4162 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3372\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n3 unchanged lines in 1 file lost coverage.\nOverall coverage decreased (-0.07%) to 56.631%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_connection.erl | 3 | 56.34% |\n | **Total:** | **3** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3370: |  -0.07% |\n| Covered Lines: | 2357 |\n| Relevant Lines: | 4162 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3377\n\n2 of 2 (100.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 56.631%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3373: |  0.0% |\n| Covered Lines: | 2357 |\n| Relevant Lines: | 4162 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3388\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n16 unchanged lines in 5 files lost coverage.\nOverall coverage decreased (-0.4%) to 56.631%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_sys_mon.erl | 1 | 18.33% |\n| src/emqx_cm.erl | 2 | 65.31% |\n| src/emqx_router_helper.erl | 3 | 23.4% |\n| src/emqx_sm.erl | 4 | 62.35% |\n| src/emqx_broker_helper.erl | 6 | 22.22% |\n | **Total:** | **16** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3384: |  -0.4% |\n| Covered Lines: | 2357 |\n| Relevant Lines: | 4162 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3414\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 56.631%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3412: |  0.0% |\n| Covered Lines: | 2357 |\n| Relevant Lines: | 4162 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3406\n\n8 of 9 (88.89%)  changed or added relevant lines in 1 file are covered.\n16 unchanged lines in 5 files lost coverage.\nOverall coverage decreased (-0.4%) to 56.631%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_shared_sub.erl | 8 | 9 | 88.89%\n | **Total:** | **8** | **9** | **88.89%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_sys_mon.erl | 1 | 18.33% |\n| src/emqx_cm.erl | 2 | 65.31% |\n| src/emqx_router_helper.erl | 3 | 23.4% |\n| src/emqx_sm.erl | 4 | 62.35% |\n| src/emqx_broker_helper.erl | 6 | 22.22% |\n | **Total:** | **16** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3384: |  -0.4% |\n| Covered Lines: | 2357 |\n| Relevant Lines: | 4162 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3832\n\n66 of 80 (82.5%)  changed or added relevant lines in 3 files are covered.\n2 unchanged lines in 2 files lost coverage.\nOverall coverage increased (+0.4%) to 61.324%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_session.erl | 18 | 23 | 78.26%\n| src/emqx_shared_sub.erl | 47 | 56 | 83.93%\n | **Total:** | **66** | **80** | **82.5%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_shared_sub.erl | 1 | 80.0% |\n| src/emqx_session.erl | 1 | 73.24% |\n | **Total:** | **2** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3818: |  0.4% |\n| Covered Lines: | 2770 |\n| Relevant Lines: | 4517 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3425\n\n20 of 35 (57.14%)  changed or added relevant lines in 5 files are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage increased (+0.4%) to 57.006%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_packet.erl | 0 | 1 | 0.0%\n| src/emqx_session.erl | 7 | 10 | 70.0%\n| src/emqx_protocol.erl | 11 | 22 | 50.0%\n | **Total:** | **20** | **35** | **57.14%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_protocol.erl | 1 | 57.85% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3418: |  0.4% |\n| Covered Lines: | 2384 |\n| Relevant Lines: | 4182 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3449\n\n0 of 2 (0.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.4%) to 57.023%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_protocol.erl | 0 | 2 | 0.0%\n | **Total:** | **0** | **2** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3447: |  0.4% |\n| Covered Lines: | 2387 |\n| Relevant Lines: | 4186 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3482\n\n0 of 1 (0.0%)  changed or added relevant line in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.4%) to 57.023%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_packet.erl | 0 | 1 | 0.0%\n | **Total:** | **0** | **1** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3454: |  0.4% |\n| Covered Lines: | 2387 |\n| Relevant Lines: | 4186 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3492\n\n5 of 16 (31.25%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.3%) to 56.949%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_protocol.erl | 4 | 15 | 26.67%\n | **Total:** | **5** | **16** | **31.25%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3484: |  0.3% |\n| Covered Lines: | 2389 |\n| Relevant Lines: | 4195 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3496\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 56.567%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3491: |  0.0% |\n| Covered Lines: | 2373 |\n| Relevant Lines: | 4195 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3681\n\n24 of 27 (88.89%)  changed or added relevant lines in 3 files are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage increased (+0.3%) to 63.476%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_sm.erl | 2 | 3 | 66.67%\n| src/emqx_session.erl | 12 | 14 | 85.71%\n | **Total:** | **24** | **27** | **88.89%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_session.erl | 1 | 71.85% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3677: |  0.3% |\n| Covered Lines: | 2732 |\n| Relevant Lines: | 4304 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3610\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 58.933%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3601: |  0.0% |\n| Covered Lines: | 2530 |\n| Relevant Lines: | 4293 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3614\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.1%) to 58.91%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3611: |  0.1% |\n| Covered Lines: | 2529 |\n| Relevant Lines: | 4293 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3531\n\n34 of 41 (82.93%)  changed or added relevant lines in 1 file are covered.\n2 unchanged lines in 1 file lost coverage.\nOverall coverage increased (+0.4%) to 57.103%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_client.erl | 34 | 41 | 82.93%\n | **Total:** | **34** | **41** | **82.93%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_client.erl | 2 | 45.18% |\n | **Total:** | **2** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3524: |  0.4% |\n| Covered Lines: | 2448 |\n| Relevant Lines: | 4287 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3547\n\n11 of 11 (100.0%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.09%) to 57.116%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3494: |  0.09% |\n| Covered Lines: | 2392 |\n| Relevant Lines: | 4188 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3551\n\n20 of 20 (100.0%)  changed or added relevant lines in 5 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.1%) to 57.167%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3494: |  0.1% |\n| Covered Lines: | 2393 |\n| Relevant Lines: | 4186 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3726\n\n21 of 197 (10.66%)  changed or added relevant lines in 12 files are covered.\n25 unchanged lines in 4 files lost coverage.\nOverall coverage decreased (-2.0%) to 61.519%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_broker.erl | 0 | 1 | 0.0%\n| src/emqx_listeners.erl | 3 | 4 | 75.0%\n| src/emqx_sys_mon.erl | 0 | 1 | 0.0%\n| src/emqx_bridge.erl | 0 | 2 | 0.0%\n| src/emqx_ctl.erl | 0 | 2 | 0.0%\n| src/emqx_logger.erl | 8 | 18 | 44.44%\n| src/emqx_tracer.erl | 4 | 26 | 15.38%\n| src/emqx_logger_formatter.erl | 0 | 137 | 0.0%\n | **Total:** | **21** | **197** | **10.66%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_ctl.erl | 1 | 33.33% |\n| src/emqx_tracer.erl | 1 | 13.95% |\n| src/emqx_session.erl | 11 | 72.06% |\n| src/emqx_local_bridge.erl | 12 | 0.0% |\n | **Total:** | **25** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3682: |  -2.0% |\n| Covered Lines: | 2737 |\n| Relevant Lines: | 4449 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3723\n\n8 of 9 (88.89%)  changed or added relevant lines in 4 files are covered.\n174 unchanged lines in 8 files lost coverage.\nOverall coverage increased (+4.6%) to 63.556%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_misc.erl | 1 | 2 | 50.0%\n | **Total:** | **8** | **9** | **88.89%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_banned.erl | 1 | 56.52% |\n| src/emqx_client.erl | 3 | 55.38% |\n| src/emqx_connection.erl | 6 | 52.45% |\n| src/emqx_local_bridge.erl | 12 | 0.0% |\n| src/emqx_sm.erl | 19 | 71.08% |\n| src/emqx_broker.erl | 21 | 67.86% |\n| src/emqx_protocol.erl | 47 | 72.83% |\n| src/emqx_session.erl | 65 | 71.96% |\n | **Total:** | **174** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3619: |  4.6% |\n| Covered Lines: | 2731 |\n| Relevant Lines: | 4297 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3608\n\n16 of 67 (23.88%)  changed or added relevant lines in 2 files are covered.\n6 unchanged lines in 5 files lost coverage.\nOverall coverage decreased (-0.7%) to 58.212%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_packet.erl | 0 | 1 | 0.0%\n| src/emqx_protocol.erl | 16 | 66 | 24.24%\n | **Total:** | **16** | **67** | **23.88%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_cm.erl | 1 | 69.39% |\n| src/emqx_broker_helper.erl | 1 | 47.06% |\n| src/emqx_sys_mon.erl | 1 | 18.33% |\n| src/emqx_sm.erl | 1 | 67.06% |\n| src/emqx_router_helper.erl | 2 | 26.09% |\n | **Total:** | **6** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3601: |  -0.7% |\n| Covered Lines: | 2527 |\n| Relevant Lines: | 4341 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3670\n\n3 of 5 (60.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.2%) to 59.152%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_protocol.erl | 3 | 5 | 60.0%\n | **Total:** | **3** | **5** | **60.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3619: |  0.2% |\n| Covered Lines: | 2540 |\n| Relevant Lines: | 4294 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3653\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n9 unchanged lines in 6 files lost coverage.\nOverall coverage increased (+1.6%) to 60.68%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_cm.erl | 1 | 69.39% |\n| src/emqx_broker_helper.erl | 1 | 47.06% |\n| src/emqx_sys_mon.erl | 1 | 18.33% |\n| src/emqx_sm.erl | 1 | 67.06% |\n| src/emqx_router_helper.erl | 2 | 26.09% |\n| src/emqx_broker.erl | 3 | 65.85% |\n | **Total:** | **9** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3637: |  1.6% |\n| Covered Lines: | 2605 |\n| Relevant Lines: | 4293 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3663\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n9 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.1%) to 60.54%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_client.erl | 3 | 55.38% |\n| src/emqx_connection.erl | 6 | 52.11% |\n | **Total:** | **9** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3656: |  -0.1% |\n| Covered Lines: | 2599 |\n| Relevant Lines: | 4293 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3665\n\n3 of 5 (60.0%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+2.7%) to 63.353%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_broker.erl | 2 | 4 | 50.0%\n | **Total:** | **3** | **5** | **60.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3656: |  2.7% |\n| Covered Lines: | 2721 |\n| Relevant Lines: | 4295 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3676\n\n3 of 7 (42.86%)  changed or added relevant lines in 2 files are covered.\n69 unchanged lines in 3 files lost coverage.\nOverall coverage increased (+4.2%) to 63.146%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_broker.erl | 2 | 6 | 33.33%\n | **Total:** | **3** | **7** | **42.86%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_client.erl | 3 | 55.38% |\n| src/emqx_connection.erl | 6 | 52.11% |\n| src/emqx_protocol.erl | 60 | 71.76% |\n | **Total:** | **69** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3619: |  4.2% |\n| Covered Lines: | 2714 |\n| Relevant Lines: | 4298 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3692\n\n30 of 33 (90.91%)  changed or added relevant lines in 3 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.02%) to 63.492%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_local_bridge.erl | 0 | 3 | 0.0%\n | **Total:** | **30** | **33** | **90.91%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3682: |  0.02% |\n| Covered Lines: | 2727 |\n| Relevant Lines: | 4295 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3697\n\n1 of 1 (100.0%)  changed or added relevant line in 1 file are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage increased (+0.05%) to 63.531%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_frame.erl | 1 | 92.41% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3682: |  0.05% |\n| Covered Lines: | 2735 |\n| Relevant Lines: | 4305 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3704\n\n4 of 7 (57.14%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.04%) to 63.518%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_mqueue.erl | 4 | 7 | 57.14%\n | **Total:** | **4** | **7** | **57.14%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3682: |  0.04% |\n| Covered Lines: | 2737 |\n| Relevant Lines: | 4309 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3710\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.01%) to 63.491%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3682: |  0.01% |\n| Covered Lines: | 2732 |\n| Relevant Lines: | 4303 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3730\n\n5 of 6 (83.33%)  changed or added relevant lines in 4 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 63.486%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_client.erl | 0 | 1 | 0.0%\n | **Total:** | **5** | **6** | **83.33%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3728: |  0.0% |\n| Covered Lines: | 2728 |\n| Relevant Lines: | 4297 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3742\n\n19 of 38 (50.0%)  changed or added relevant lines in 3 files are covered.\n26 unchanged lines in 3 files lost coverage.\nOverall coverage increased (+0.05%) to 63.533%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_client_sock.erl | 5 | 6 | 83.33%\n| src/emqx_bridge.erl | 12 | 19 | 63.16%\n| src/emqx_client.erl | 2 | 13 | 15.38%\n | **Total:** | **19** | **38** | **50.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_bridge.erl | 1 | 48.36% |\n| src/emqx_broker.erl | 6 | 66.47% |\n| src/emqx_sm.erl | 19 | 71.08% |\n | **Total:** | **26** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3728: |  0.05% |\n| Covered Lines: | 2737 |\n| Relevant Lines: | 4308 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3736\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.07%) to 63.556%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3728: |  0.07% |\n| Covered Lines: | 2731 |\n| Relevant Lines: | 4297 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3746\n\n0 of 1 (0.0%)  changed or added relevant line in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 63.533%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_message.erl | 0 | 1 | 0.0%\n | **Total:** | **0** | **1** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3744: |  0.0% |\n| Covered Lines: | 2737 |\n| Relevant Lines: | 4308 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3752\n\n2 of 2 (100.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 61.475%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3750: |  0.0% |\n| Covered Lines: | 2743 |\n| Relevant Lines: | 4462 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3760\n\n1 of 1 (100.0%)  changed or added relevant line in 1 file are covered.\n4 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.03%) to 61.507%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_tracer.erl | 1 | 10.53% |\n| src/emqx_broker.erl | 3 | 66.47% |\n | **Total:** | **4** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3753: |  -0.03% |\n| Covered Lines: | 2742 |\n| Relevant Lines: | 4458 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3802\n\n16 of 47 (34.04%)  changed or added relevant lines in 4 files are covered.\n29 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.6%) to 60.958%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_connection.erl | 5 | 14 | 35.71%\n| src/emqx_ws_connection.erl | 3 | 13 | 23.08%\n| src/emqx_protocol.erl | 6 | 18 | 33.33%\n | **Total:** | **16** | **47** | **34.04%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_protocol.erl | 4 | 72.09% |\n| src/emqx_packet.erl | 25 | 44.58% |\n | **Total:** | **29** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3753: |  -0.6% |\n| Covered Lines: | 2723 |\n| Relevant Lines: | 4467 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3827\n\n6 of 6 (100.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.04%) to 60.966%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3818: |  0.04% |\n| Covered Lines: | 2727 |\n| Relevant Lines: | 4473 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3777\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n3 unchanged lines in 1 file lost coverage.\nOverall coverage decreased (-0.07%) to 61.475%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_broker.erl | 3 | 66.47% |\n | **Total:** | **3** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3753: |  -0.07% |\n| Covered Lines: | 2743 |\n| Relevant Lines: | 4462 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3782\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 61.542%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3753: |  0.0% |\n| Covered Lines: | 2746 |\n| Relevant Lines: | 4462 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3817\n\n3 of 5 (60.0%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.1%) to 60.989%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_plugins.erl | 0 | 1 | 0.0%\n| src/emqx_protocol.erl | 3 | 4 | 75.0%\n | **Total:** | **3** | **5** | **60.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3809: |  0.1% |\n| Covered Lines: | 2725 |\n| Relevant Lines: | 4468 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3791\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n3 unchanged lines in 1 file lost coverage.\nOverall coverage decreased (-0.07%) to 61.475%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_broker.erl | 3 | 66.47% |\n | **Total:** | **3** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3753: |  -0.07% |\n| Covered Lines: | 2743 |\n| Relevant Lines: | 4462 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3830\n\n1 of 4 (25.0%)  changed or added relevant lines in 1 file are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage increased (+0.02%) to 60.946%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_tracer.erl | 1 | 4 | 25.0%\n | **Total:** | **1** | **4** | **25.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_tracer.erl | 1 | 10.53% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3818: |  0.02% |\n| Covered Lines: | 2720 |\n| Relevant Lines: | 4463 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3844\n\n1 of 2 (50.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.07%) to 61.367%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_sm_locker.erl | 1 | 2 | 50.0%\n | **Total:** | **1** | **2** | **50.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3836: |  0.07% |\n| Covered Lines: | 2775 |\n| Relevant Lines: | 4522 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3840\n\n1 of 15 (6.67%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage decreased (-0.2%) to 61.12%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_logger.erl | 0 | 14 | 0.0%\n | **Total:** | **1** | **15** | **6.67%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3836: |  -0.2% |\n| Covered Lines: | 2773 |\n| Relevant Lines: | 4537 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3846\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 61.3%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3836: |  0.0% |\n| Covered Lines: | 2772 |\n| Relevant Lines: | 4522 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3853\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 61.209%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3850: |  0.0% |\n| Covered Lines: | 2774 |\n| Relevant Lines: | 4532 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3856\n\n8 of 8 (100.0%)  changed or added relevant lines in 5 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage decreased (-0.009%) to 61.201%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3850: |  -0.009% |\n| Covered Lines: | 2773 |\n| Relevant Lines: | 4531 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3875\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n66 unchanged lines in 3 files lost coverage.\nOverall coverage decreased (-0.07%) to 61.134%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_broker.erl | 3 | 66.47% |\n| src/emqx_logger.erl | 9 | 28.13% |\n| src/emqx_protocol.erl | 54 | 72.83% |\n | **Total:** | **66** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3850: |  -0.07% |\n| Covered Lines: | 2770 |\n| Relevant Lines: | 4531 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4064\n\n2 of 39 (5.13%)  changed or added relevant lines in 2 files are covered.\n7 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.2%) to 63.843%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_ws_connection.erl | 0 | 3 | 0.0%\n| src/emqx_protocol.erl | 2 | 36 | 5.56%\n | **Total:** | **2** | **39** | **5.13%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_sm.erl | 1 | 71.08% |\n| src/emqx_broker.erl | 6 | 67.92% |\n | **Total:** | **7** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4003: |  -0.2% |\n| Covered Lines: | 2924 |\n| Relevant Lines: | 4580 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3882\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.07%) to 61.201%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3876: |  0.07% |\n| Covered Lines: | 2773 |\n| Relevant Lines: | 4531 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3886\n\n10 of 11 (90.91%)  changed or added relevant lines in 1 file are covered.\n3 unchanged lines in 1 file lost coverage.\nOverall coverage increased (+0.03%) to 61.229%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_batch.erl | 10 | 11 | 90.91%\n | **Total:** | **10** | **11** | **90.91%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_broker.erl | 3 | 66.47% |\n | **Total:** | **3** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3883: |  0.03% |\n| Covered Lines: | 2781 |\n| Relevant Lines: | 4542 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3894\n\n1 of 1 (100.0%)  changed or added relevant line in 1 file are covered.\n3 unchanged lines in 1 file lost coverage.\nOverall coverage decreased (-0.07%) to 61.134%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_broker.erl | 3 | 66.47% |\n | **Total:** | **3** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3883: |  -0.07% |\n| Covered Lines: | 2770 |\n| Relevant Lines: | 4531 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3892\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n3 unchanged lines in 1 file lost coverage.\nOverall coverage decreased (-0.07%) to 61.134%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_broker.erl | 3 | 66.47% |\n | **Total:** | **3** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3883: |  -0.07% |\n| Covered Lines: | 2770 |\n| Relevant Lines: | 4531 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3896\n\n1 of 2 (50.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 61.201%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_router.erl | 1 | 2 | 50.0%\n | **Total:** | **1** | **2** | **50.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3883: |  0.0% |\n| Covered Lines: | 2773 |\n| Relevant Lines: | 4531 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3902\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 61.134%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3899: |  0.0% |\n| Covered Lines: | 2770 |\n| Relevant Lines: | 4531 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3941\n\n25 of 30 (83.33%)  changed or added relevant lines in 4 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.3%) to 61.592%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_connection.erl | 2 | 3 | 66.67%\n| src/emqx_ws_connection.erl | 2 | 3 | 66.67%\n| src/emqx_session.erl | 5 | 8 | 62.5%\n | **Total:** | **25** | **30** | **83.33%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3904: |  0.3% |\n| Covered Lines: | 2808 |\n| Relevant Lines: | 4559 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4020\n\n19 of 30 (63.33%)  changed or added relevant lines in 9 files are covered.\n9 unchanged lines in 5 files lost coverage.\nOverall coverage decreased (-0.02%) to 64.013%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_client.erl | 1 | 2 | 50.0%\n| src/emqx_connection.erl | 1 | 2 | 50.0%\n| src/emqx_mountpoint.erl | 2 | 3 | 66.67%\n| src/emqx_sm.erl | 1 | 2 | 50.0%\n| src/emqx_ws_connection.erl | 1 | 2 | 50.0%\n| src/emqx_keepalive.erl | 2 | 4 | 50.0%\n| src/emqx_access_control.erl | 1 | 5 | 20.0%\n | **Total:** | **19** | **30** | **63.33%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_acl_internal.erl | 1 | 73.53% |\n| src/emqx_client.erl | 1 | 54.92% |\n| src/emqx_access_control.erl | 1 | 59.7% |\n| src/emqx_keepalive.erl | 2 | 62.5% |\n| src/emqx_bridge.erl | 4 | 48.36% |\n | **Total:** | **9** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4003: |  -0.02% |\n| Covered Lines: | 2919 |\n| Relevant Lines: | 4560 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3918\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n3 unchanged lines in 1 file lost coverage.\nOverall coverage decreased (-0.07%) to 61.229%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_broker.erl | 3 | 66.47% |\n | **Total:** | **3** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3904: |  -0.07% |\n| Covered Lines: | 2781 |\n| Relevant Lines: | 4542 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3920\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 61.295%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3904: |  0.0% |\n| Covered Lines: | 2784 |\n| Relevant Lines: | 4542 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3929\n\n2 of 2 (100.0%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.009%) to 61.237%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3927: |  0.009% |\n| Covered Lines: | 2782 |\n| Relevant Lines: | 4543 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3933\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.07%) to 61.295%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3927: |  0.07% |\n| Covered Lines: | 2784 |\n| Relevant Lines: | 4542 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3943\n\n0 of 3 (0.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.07%) to 61.295%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_reason_codes.erl | 0 | 3 | 0.0%\n | **Total:** | **0** | **3** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3927: |  0.07% |\n| Covered Lines: | 2784 |\n| Relevant Lines: | 4542 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3951\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n3 unchanged lines in 1 file lost coverage.\nOverall coverage decreased (-0.07%) to 61.535%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_broker.erl | 3 | 66.47% |\n | **Total:** | **3** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3948: |  -0.07% |\n| Covered Lines: | 2806 |\n| Relevant Lines: | 4560 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3957\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 61.535%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3953: |  0.0% |\n| Covered Lines: | 2806 |\n| Relevant Lines: | 4560 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3959\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.07%) to 61.601%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3953: |  0.07% |\n| Covered Lines: | 2809 |\n| Relevant Lines: | 4560 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3963\n\n6 of 6 (100.0%)  changed or added relevant lines in 3 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 61.601%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3960: |  0.0% |\n| Covered Lines: | 2809 |\n| Relevant Lines: | 4560 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3968\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.07%) to 61.667%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3960: |  0.07% |\n| Covered Lines: | 2812 |\n| Relevant Lines: | 4560 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3973\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 61.601%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3960: |  0.0% |\n| Covered Lines: | 2809 |\n| Relevant Lines: | 4560 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 3976\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+2.4%) to 64.013%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 3960: |  2.4% |\n| Covered Lines: | 2919 |\n| Relevant Lines: | 4560 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4044\n\n12 of 16 (75.0%)  changed or added relevant lines in 3 files are covered.\n7 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.05%) to 63.983%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_acl_internal.erl | 8 | 12 | 66.67%\n | **Total:** | **12** | **16** | **75.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_sm.erl | 1 | 71.08% |\n| src/emqx_broker.erl | 6 | 67.92% |\n | **Total:** | **7** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4003: |  -0.05% |\n| Covered Lines: | 2917 |\n| Relevant Lines: | 4559 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4007\n\n8 of 8 (100.0%)  changed or added relevant lines in 1 file are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage decreased (-0.04%) to 63.994%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_sm.erl | 1 | 71.08% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4003: |  -0.04% |\n| Covered Lines: | 2913 |\n| Relevant Lines: | 4552 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4050\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n7 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.04%) to 63.994%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_sm.erl | 1 | 71.08% |\n| src/emqx_broker.erl | 6 | 67.92% |\n | **Total:** | **7** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4003: |  -0.04% |\n| Covered Lines: | 2913 |\n| Relevant Lines: | 4552 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4092\n\n9 of 40 (22.5%)  changed or added relevant lines in 2 files are covered.\n2 unchanged lines in 1 file lost coverage.\nOverall coverage increased (+0.2%) to 64.191%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_client.erl | 1 | 3 | 33.33%\n| src/emqx_bridge.erl | 8 | 37 | 21.62%\n | **Total:** | **9** | **40** | **22.5%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_bridge.erl | 2 | 52.38% |\n | **Total:** | **2** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4033: |  0.2% |\n| Covered Lines: | 2938 |\n| Relevant Lines: | 4577 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4098\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 63.994%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4033: |  0.0% |\n| Covered Lines: | 2913 |\n| Relevant Lines: | 4552 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4113\n\n18 of 25 (72.0%)  changed or added relevant lines in 2 files are covered.\n19 unchanged lines in 3 files lost coverage.\nOverall coverage increased (+0.5%) to 64.479%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_ws_connection.erl | 0 | 3 | 0.0%\n| src/emqx_protocol.erl | 18 | 22 | 81.82%\n | **Total:** | **18** | **25** | **72.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_protocol.erl | 1 | 78.14% |\n| src/emqx_access_rule.erl | 8 | 85.19% |\n| src/emqx_acl_internal.erl | 10 | 66.67% |\n | **Total:** | **19** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4033: |  0.5% |\n| Covered Lines: | 2948 |\n| Relevant Lines: | 4572 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4120\n\n7 of 9 (77.78%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.01%) to 63.997%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_access_control.erl | 6 | 8 | 75.0%\n | **Total:** | **7** | **9** | **77.78%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4108: |  0.01% |\n| Covered Lines: | 2917 |\n| Relevant Lines: | 4558 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4148\n\n2 of 2 (100.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.008%) to 63.991%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4143: |  0.008% |\n| Covered Lines: | 2918 |\n| Relevant Lines: | 4560 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4154\n\n17 of 22 (77.27%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage decreased (-0.04%) to 63.95%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_protocol.erl | 9 | 10 | 90.0%\n| src/emqx_session.erl | 8 | 12 | 66.67%\n | **Total:** | **17** | **22** | **77.27%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4152: |  -0.04% |\n| Covered Lines: | 2911 |\n| Relevant Lines: | 4552 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4237\n\n18 of 19 (94.74%)  changed or added relevant lines in 2 files are covered.\n21 unchanged lines in 4 files lost coverage.\nOverall coverage increased (+0.2%) to 64.672%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_protocol.erl | 17 | 18 | 94.44%\n | **Total:** | **18** | **19** | **94.74%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_mod_presence.erl | 1 | 77.78% |\n| src/emqx_access_rule.erl | 6 | 84.62% |\n| src/emqx_acl_internal.erl | 6 | 68.42% |\n| src/emqx_access_control.erl | 8 | 60.29% |\n | **Total:** | **21** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4172: |  0.2% |\n| Covered Lines: | 2962 |\n| Relevant Lines: | 4580 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4198\n\n5 of 5 (100.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage decreased (-0.008%) to 64.494%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4195: |  -0.008% |\n| Covered Lines: | 2948 |\n| Relevant Lines: | 4571 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4268\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n4 unchanged lines in 3 files lost coverage.\nOverall coverage remained the same at 63.98%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_pool.erl | 1 | 61.54% |\n| src/emqx_keepalive.erl | 1 | 62.5% |\n| src/emqx_connection.erl | 2 | 53.9% |\n | **Total:** | **4** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4266: |  0.0% |\n| Covered Lines: | 3016 |\n| Relevant Lines: | 4714 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4271\n\n6 of 11 (54.55%)  changed or added relevant lines in 1 file are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage decreased (-0.008%) to 63.353%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_ws_connection.erl | 6 | 11 | 54.55%\n | **Total:** | **6** | **11** | **54.55%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_ws_connection.erl | 1 | 36.94% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4265: |  -0.008% |\n| Covered Lines: | 2970 |\n| Relevant Lines: | 4688 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4275\n\n13 of 14 (92.86%)  changed or added relevant lines in 1 file are covered.\n5 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.08%) to 63.823%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_session.erl | 13 | 14 | 92.86%\n | **Total:** | **13** | **14** | **92.86%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 73.68% |\n| src/emqx_client.erl | 4 | 56.06% |\n | **Total:** | **5** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4273: |  -0.08% |\n| Covered Lines: | 3008 |\n| Relevant Lines: | 4713 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4280\n\n2 of 2 (100.0%)  changed or added relevant lines in 2 files are covered.\n5 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.08%) to 63.81%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_connection.erl | 1 | 53.9% |\n| src/emqx_client.erl | 4 | 56.06% |\n | **Total:** | **5** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4278: |  -0.08% |\n| Covered Lines: | 3008 |\n| Relevant Lines: | 4714 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4286\n\n8 of 8 (100.0%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.06%) to 63.874%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4281: |  0.06% |\n| Covered Lines: | 3011 |\n| Relevant Lines: | 4714 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4380\n\n1 of 2 (50.0%)  changed or added relevant lines in 1 file are covered.\n5 unchanged lines in 2 files lost coverage.\nOverall coverage increased (+2.2%) to 66.009%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_connection.erl | 1 | 2 | 50.0%\n | **Total:** | **1** | **2** | **50.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 73.68% |\n| src/emqx_client.erl | 4 | 58.12% |\n | **Total:** | **5** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4367: |  2.2% |\n| Covered Lines: | 3146 |\n| Relevant Lines: | 4766 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4330\n\n6 of 10 (60.0%)  changed or added relevant lines in 1 file are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage increased (+0.03%) to 63.858%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_bridge.erl | 6 | 10 | 60.0%\n | **Total:** | **6** | **10** | **60.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_pool.erl | 1 | 61.54% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4294: |  0.03% |\n| Covered Lines: | 3009 |\n| Relevant Lines: | 4712 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4339\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage increased (+0.04%) to 63.874%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_pool.erl | 1 | 61.54% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4294: |  0.04% |\n| Covered Lines: | 3011 |\n| Relevant Lines: | 4714 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4344\n\n0 of 5 (0.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage decreased (-0.01%) to 63.796%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_plugins.erl | 0 | 5 | 0.0%\n | **Total:** | **0** | **5** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4340: |  -0.01% |\n| Covered Lines: | 3008 |\n| Relevant Lines: | 4715 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4363\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage increased (+0.06%) to 63.673%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 73.68% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4361: |  0.06% |\n| Covered Lines: | 3034 |\n| Relevant Lines: | 4765 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4371\n\n0 of 12 (0.0%)  changed or added relevant lines in 1 file are covered.\n5 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.2%) to 63.589%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_logger.erl | 0 | 12 | 0.0%\n | **Total:** | **0** | **12** | **0.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 73.68% |\n| src/emqx_client.erl | 4 | 57.89% |\n | **Total:** | **5** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4367: |  -0.2% |\n| Covered Lines: | 3037 |\n| Relevant Lines: | 4776 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4393\n\n12 of 24 (50.0%)  changed or added relevant lines in 1 file are covered.\n8 unchanged lines in 3 files lost coverage.\nOverall coverage increased (+0.1%) to 63.943%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_bridge.erl | 12 | 24 | 50.0%\n | **Total:** | **12** | **24** | **50.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 73.68% |\n| src/emqx_client_sock.erl | 1 | 70.37% |\n| src/emqx_client.erl | 6 | 57.44% |\n | **Total:** | **8** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4367: |  0.1% |\n| Covered Lines: | 3036 |\n| Relevant Lines: | 4748 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4425\n\n7 of 7 (100.0%)  changed or added relevant lines in 2 files are covered.\n5 unchanged lines in 4 files lost coverage.\nOverall coverage decreased (-0.05%) to 66.232%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 75.41% |\n| src/emqx_pool.erl | 1 | 61.54% |\n| src/emqx_client_sock.erl | 1 | 70.37% |\n| src/emqx_client.erl | 2 | 57.67% |\n | **Total:** | **5** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4423: |  -0.05% |\n| Covered Lines: | 3150 |\n| Relevant Lines: | 4756 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4429\n\n0 of 9 (0.0%)  changed or added relevant lines in 1 file are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage decreased (-0.1%) to 66.134%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_bridge.erl | 0 | 9 | 0.0%\n | **Total:** | **0** | **9** | **0.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_pool.erl | 1 | 61.54% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4423: |  -0.1% |\n| Covered Lines: | 3148 |\n| Relevant Lines: | 4760 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4434\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 63.874%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4327: |  0.0% |\n| Covered Lines: | 3011 |\n| Relevant Lines: | 4714 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4435\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.1%) to 66.025%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4432: |  0.1% |\n| Covered Lines: | 3154 |\n| Relevant Lines: | 4777 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4437\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.02%) to 65.941%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4432: |  0.02% |\n| Covered Lines: | 3150 |\n| Relevant Lines: | 4777 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4465\n\n6 of 9 (66.67%)  changed or added relevant lines in 1 file are covered.\n265 unchanged lines in 21 files lost coverage.\nOverall coverage increased (+0.2%) to 66.416%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_client.erl | 6 | 9 | 66.67%\n | **Total:** | **6** | **9** | **66.67%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_protocol.erl | 1 | 78.57% |\n| src/emqx_pool.erl | 1 | 96.0% |\n| src/emqx_connection.erl | 1 | 64.1% |\n| src/emqx_client.erl | 3 | 58.78% |\n| src/emqx_router.erl | 5 | 91.8% |\n| src/emqx_zone.erl | 5 | 72.41% |\n| src/emqx_banned.erl | 6 | 60.87% |\n| src/emqx_cm.erl | 7 | 81.13% |\n| src/emqx_hooks.erl | 7 | 88.89% |\n| src/emqx_stats.erl | 9 | 78.43% |\n | **Total:** | **265** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4445: |  0.2% |\n| Covered Lines: | 3178 |\n| Relevant Lines: | 4785 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4449\n\n5 of 5 (100.0%)  changed or added relevant lines in 2 files are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage increased (+0.2%) to 66.416%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 91.8% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4445: |  0.2% |\n| Covered Lines: | 3176 |\n| Relevant Lines: | 4782 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4460\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n4 unchanged lines in 3 files lost coverage.\nOverall coverage decreased (-0.08%) to 66.165%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_pool.erl | 1 | 61.54% |\n| src/emqx_client_sock.erl | 1 | 70.37% |\n| src/emqx_client.erl | 2 | 57.92% |\n | **Total:** | **4** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4445: |  -0.08% |\n| Covered Lines: | 3164 |\n| Relevant Lines: | 4782 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4601\n\n122 of 296 (41.22%)  changed or added relevant lines in 31 files are covered.\n9 unchanged lines in 7 files lost coverage.\nOverall coverage increased (+4.4%) to 68.246%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_connection.erl | 1 | 2 | 50.0%\n| src/emqx_time.erl | 0 | 2 | 0.0%\n| src/emqx_banned.erl | 0 | 3 | 0.0%\n| src/emqx_broker_helper.erl | 0 | 3 | 0.0%\n| src/emqx_cm.erl | 0 | 3 | 0.0%\n| src/emqx_hooks.erl | 0 | 3 | 0.0%\n| src/emqx_metrics.erl | 1 | 4 | 25.0%\n| src/emqx_sm_registry.erl | 0 | 3 | 0.0%\n| src/emqx_sys.erl | 0 | 3 | 0.0%\n| src/emqx_zone.erl | 0 | 3 | 0.0%\n | **Total:** | **122** | **296** | **41.22%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_client.erl | 1 | 58.71% |\n| src/emqx_protocol.erl | 1 | 78.45% |\n| src/emqx_reason_codes.erl | 1 | 99.15% |\n| src/emqx_session_sup.erl | 1 | 50.0% |\n| src/emqx_message.erl | 1 | 35.48% |\n| src/emqx_session.erl | 1 | 70.1% |\n| src/emqx_bridge.erl | 3 | 46.51% |\n | **Total:** | **9** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4327: |  4.4% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4812 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4474\n\n12 of 13 (92.31%)  changed or added relevant lines in 1 file are covered.\n4 unchanged lines in 3 files lost coverage.\nOverall coverage decreased (-0.03%) to 66.486%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_shared_sub.erl | 12 | 13 | 92.31%\n | **Total:** | **12** | **13** | **92.31%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 91.8% |\n| src/emqx_keepalive.erl | 1 | 62.5% |\n| src/emqx_connection.erl | 2 | 64.74% |\n | **Total:** | **4** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4466: |  -0.03% |\n| Covered Lines: | 3184 |\n| Relevant Lines: | 4789 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4478\n\n1 of 1 (100.0%)  changed or added relevant line in 1 file are covered.\n4 unchanged lines in 3 files lost coverage.\nOverall coverage decreased (-0.08%) to 66.444%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_message.erl | 1 | 35.48% |\n| src/emqx_keepalive.erl | 1 | 62.5% |\n| src/emqx_connection.erl | 2 | 64.74% |\n | **Total:** | **4** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4466: |  -0.08% |\n| Covered Lines: | 3178 |\n| Relevant Lines: | 4783 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4485\n\n5 of 6 (83.33%)  changed or added relevant lines in 1 file are covered.\n2 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.01%) to 66.43%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_protocol.erl | 5 | 6 | 83.33%\n | **Total:** | **5** | **6** | **83.33%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_sm.erl | 1 | 63.1% |\n| src/emqx_router.erl | 1 | 91.8% |\n | **Total:** | **2** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4479: |  -0.01% |\n| Covered Lines: | 3178 |\n| Relevant Lines: | 4784 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4489\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n786 unchanged lines in 32 files lost coverage.\nOverall coverage decreased (-1.8%) to 64.574%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_trie.erl | 1 | 97.83% |\n| src/emqx_client_sock.erl | 1 | 70.37% |\n| src/emqx_zone.erl | 5 | 72.41% |\n| src/emqx_banned.erl | 6 | 60.87% |\n| src/emqx_cm.erl | 7 | 81.13% |\n| src/emqx_hooks.erl | 7 | 88.89% |\n| src/emqx_stats.erl | 9 | 78.43% |\n| src/emqx_pool.erl | 10 | 61.54% |\n| src/emqx_metrics.erl | 10 | 82.56% |\n| src/emqx_logger_formatter.erl | 11 | 0.0% |\n | **Total:** | **786** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4486: |  -1.8% |\n| Covered Lines: | 3044 |\n| Relevant Lines: | 4714 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4519\n\n13 of 15 (86.67%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.05%) to 67.105%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_protocol.erl | 7 | 9 | 77.78%\n | **Total:** | **13** | **15** | **86.67%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4494: |  0.05% |\n| Covered Lines: | 3213 |\n| Relevant Lines: | 4788 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4537\n\n2 of 15 (13.33%)  changed or added relevant lines in 1 file are covered.\n55 unchanged lines in 6 files lost coverage.\nOverall coverage increased (+1.2%) to 68.313%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_bridge.erl | 2 | 15 | 13.33%\n | **Total:** | **2** | **15** | **13.33%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_protocol.erl | 1 | 78.64% |\n| src/emqx_reason_codes.erl | 1 | 99.15% |\n| src/emqx_session.erl | 1 | 70.1% |\n| src/emqx_bridge.erl | 3 | 46.51% |\n| src/emqx_broker.erl | 3 | 64.56% |\n| src/emqx_client.erl | 46 | 58.71% |\n | **Total:** | **55** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4523: |  1.2% |\n| Covered Lines: | 3279 |\n| Relevant Lines: | 4800 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4539\n\n1 of 1 (100.0%)  changed or added relevant line in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 68.427%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4529: |  0.0% |\n| Covered Lines: | 3279 |\n| Relevant Lines: | 4792 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4552\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 68.339%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4545: |  0.0% |\n| Covered Lines: | 3283 |\n| Relevant Lines: | 4804 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4565\n\n11 of 15 (73.33%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.2%) to 68.581%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_protocol.erl | 11 | 15 | 73.33%\n | **Total:** | **11** | **15** | **73.33%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4554: |  0.2% |\n| Covered Lines: | 3296 |\n| Relevant Lines: | 4806 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4589\n\n0 of 6 (0.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage decreased (-0.06%) to 68.246%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx.erl | 0 | 6 | 0.0%\n | **Total:** | **0** | **6** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4567: |  -0.06% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4812 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4586\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n4 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.04%) to 68.269%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 91.8% |\n| src/emqx_broker.erl | 3 | 62.66% |\n | **Total:** | **4** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4567: |  -0.04% |\n| Covered Lines: | 3281 |\n| Relevant Lines: | 4806 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4594\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.09%) to 68.331%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4591: |  0.09% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4806 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4599\n\n0 of 6 (0.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage decreased (-0.06%) to 68.246%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx.erl | 0 | 6 | 0.0%\n | **Total:** | **0** | **6** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4567: |  -0.06% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4812 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4602\n\n26 of 50 (52.0%)  changed or added relevant lines in 4 files are covered.\n4 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.2%) to 68.225%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_shared_sub.erl | 12 | 13 | 92.31%\n| src/emqx_protocol.erl | 12 | 16 | 75.0%\n| src/emqx.erl | 0 | 6 | 0.0%\n| src/emqx_bridge.erl | 2 | 15 | 13.33%\n | **Total:** | **26** | **50** | **52.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_session_sup.erl | 1 | 48.72% |\n| src/emqx_bridge.erl | 3 | 46.51% |\n | **Total:** | **4** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4571: |  -0.2% |\n| Covered Lines: | 3283 |\n| Relevant Lines: | 4812 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4638\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n11 unchanged lines in 3 files lost coverage.\nOverall coverage decreased (-0.2%) to 68.246%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_session.erl | 1 | 70.1% |\n| src/emqx_keepalive.erl | 1 | 62.5% |\n| src/emqx_connection.erl | 9 | 64.74% |\n | **Total:** | **11** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4630: |  -0.2% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4812 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4635\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage decreased (-0.02%) to 68.246%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_sm.erl | 1 | 64.29% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4634: |  -0.02% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4812 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4642\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n8 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.2%) to 68.246%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_session.erl | 1 | 70.1% |\n| src/emqx_connection.erl | 7 | 64.74% |\n | **Total:** | **8** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4639: |  -0.2% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4812 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4715\n\n0 of 2 (0.0%)  changed or added relevant lines in 1 file are covered.\n12 unchanged lines in 4 files lost coverage.\nOverall coverage decreased (-0.3%) to 68.218%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_ws_connection.erl | 0 | 2 | 0.0%\n | **Total:** | **0** | **2** | **0.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 91.8% |\n| src/emqx_session.erl | 1 | 70.1% |\n| src/emqx_keepalive.erl | 1 | 62.5% |\n| src/emqx_connection.erl | 9 | 64.74% |\n | **Total:** | **12** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4632: |  -0.3% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4814 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4649\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 68.246%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4645: |  0.0% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4812 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4653\n\n0 of 5 (0.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage decreased (-0.05%) to 68.175%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_bridge_sup.erl | 0 | 5 | 0.0%\n | **Total:** | **0** | **5** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4650: |  -0.05% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4817 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4867\n\n275 of 354 (77.68%)  changed or added relevant lines in 9 files are covered.\n22 unchanged lines in 5 files lost coverage.\nOverall coverage increased (+2.03%) to 70.373%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_portal_connect.erl | 9 | 11 | 81.82%\n| src/emqx_topic.erl | 7 | 9 | 77.78%\n| src/portal/emqx_portal_msg.erl | 8 | 10 | 80.0%\n| src/emqx_client.erl | 27 | 32 | 84.38%\n| src/portal/emqx_portal_sup.erl | 7 | 13 | 53.85%\n| src/portal/emqx_portal_rpc.erl | 23 | 32 | 71.88%\n| src/portal/emqx_portal_mqtt.erl | 52 | 66 | 78.79%\n| src/portal/emqx_portal.erl | 141 | 180 | 78.33%\n | **Total:** | **275** | **354** | **77.68%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_session.erl | 1 | 70.45% |\n| src/emqx_logger.erl | 2 | 43.18% |\n| src/emqx_metrics.erl | 2 | 80.23% |\n| src/emqx_protocol.erl | 6 | 76.43% |\n| src/emqx_client.erl | 11 | 58.64% |\n | **Total:** | **22** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4860: |  2.03% |\n| Covered Lines: | 3456 |\n| Relevant Lines: | 4911 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4702\n\n0 of 2 (0.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage decreased (-0.008%) to 68.218%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_ws_connection.erl | 0 | 2 | 0.0%\n | **Total:** | **0** | **2** | **0.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4650: |  -0.008% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4814 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4700\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.2%) to 68.412%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4650: |  0.2% |\n| Covered Lines: | 3292 |\n| Relevant Lines: | 4812 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4731\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n10 unchanged lines in 3 files lost coverage.\nOverall coverage decreased (-0.06%) to 68.301%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_protocol.erl | 1 | 78.11% |\n| src/emqx_session.erl | 1 | 71.48% |\n| src/emqx_connection.erl | 8 | 64.1% |\n | **Total:** | **10** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4714: |  -0.06% |\n| Covered Lines: | 3288 |\n| Relevant Lines: | 4814 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4735\n\n0 of 2 (0.0%)  changed or added relevant lines in 1 file are covered.\n9 unchanged lines in 3 files lost coverage.\nOverall coverage decreased (-0.2%) to 68.218%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_ws_connection.erl | 0 | 2 | 0.0%\n | **Total:** | **0** | **2** | **0.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_packet.erl | 1 | 84.21% |\n| src/emqx_session.erl | 1 | 70.1% |\n| src/emqx_connection.erl | 7 | 64.74% |\n | **Total:** | **9** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4688: |  -0.2% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4814 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4758\n\n7 of 8 (87.5%)  changed or added relevant lines in 2 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage remained the same at 68.218%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_inflight.erl | 4 | 5 | 80.0%\n | **Total:** | **7** | **8** | **87.5%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4756: |  0.0% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4814 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4761\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n3 unchanged lines in 2 files lost coverage.\nOverall coverage increased (+0.3%) to 70.707%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_pqueue.erl | 1 | 76.24% |\n| src/emqx_session.erl | 2 | 70.1% |\n | **Total:** | **3** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4753: |  0.3% |\n| Covered Lines: | 3430 |\n| Relevant Lines: | 4851 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4765\n\n0 of 1 (0.0%)  changed or added relevant line in 1 file are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage remained the same at 68.218%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_shared_sub.erl | 0 | 1 | 0.0%\n | **Total:** | **0** | **1** | **0.0%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 91.8% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4756: |  0.0% |\n| Covered Lines: | 3284 |\n| Relevant Lines: | 4814 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4769\n\n3 of 4 (75.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.2%) to 68.453%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_message.erl | 3 | 4 | 75.0%\n | **Total:** | **3** | **4** | **75.0%** | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4756: |  0.2% |\n| Covered Lines: | 3296 |\n| Relevant Lines: | 4815 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4778\n\n68 of 86 (79.07%)  changed or added relevant lines in 2 files are covered.\n43 unchanged lines in 6 files lost coverage.\nOverall coverage increased (+0.2%) to 68.444%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_protocol.erl | 3 | 4 | 75.0%\n| src/emqx_session.erl | 65 | 82 | 79.27%\n | **Total:** | **68** | **86** | **79.07%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_gc.erl | 1 | 92.0% |\n| src/emqx_metrics.erl | 1 | 81.4% |\n| src/emqx_topic.erl | 4 | 92.96% |\n| src/emqx_message.erl | 7 | 75.0% |\n| src/emqx_session.erl | 8 | 70.3% |\n| src/emqx_shared_sub.erl | 22 | 77.17% |\n | **Total:** | **43** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4756: |  0.2% |\n| Covered Lines: | 3325 |\n| Relevant Lines: | 4858 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4774\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage increased (+0.2%) to 68.467%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_sm.erl | 1 | 64.29% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4772: |  0.2% |\n| Covered Lines: | 3296 |\n| Relevant Lines: | 4814 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4859\n\n19 of 35 (54.29%)  changed or added relevant lines in 6 files are covered.\n6 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.07%) to 68.4%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_acl_internal.erl | 1 | 3 | 33.33%\n| src/emqx_keepalive.erl | 2 | 4 | 50.0%\n| src/emqx_mountpoint.erl | 2 | 4 | 50.0%\n| src/emqx_access_control.erl | 0 | 4 | 0.0%\n| src/emqx_vm.erl | 6 | 12 | 50.0%\n | **Total:** | **19** | **35** | **54.29%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_keepalive.erl | 2 | 62.5% |\n| src/emqx_bridge.erl | 4 | 46.51% |\n | **Total:** | **6** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4779: |  -0.07% |\n| Covered Lines: | 3301 |\n| Relevant Lines: | 4826 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4856\n\n0 of 0   changed or added relevant lines in 0 files are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.2%) to 68.64%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4779: |  0.2% |\n| Covered Lines: | 3305 |\n| Relevant Lines: | 4815 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4957\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n29 unchanged lines in 7 files lost coverage.\nOverall coverage decreased (-0.6%) to 70.157%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_session_sup.erl | 1 | 48.72% |\n| src/emqx_broker.erl | 1 | 64.56% |\n| src/emqx_mqtt_props.erl | 2 | 16.44% |\n| src/emqx_shared_sub.erl | 2 | 75.59% |\n| src/emqx_session.erl | 2 | 71.52% |\n| src/emqx_connection.erl | 7 | 63.03% |\n| src/emqx_client.erl | 14 | 49.62% |\n | **Total:** | **29** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4951: |  -0.6% |\n| Covered Lines: | 3484 |\n| Relevant Lines: | 4966 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4967\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage increased (+0.2%) to 70.933%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_mqueue.erl | 1 | 96.67% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4965: |  0.2% |\n| Covered Lines: | 3580 |\n| Relevant Lines: | 5047 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4977\n\n4 of 4 (100.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.07%) to 70.8%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4968: |  0.07% |\n| Covered Lines: | 3574 |\n| Relevant Lines: | 5048 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 5036\n\n75 of 110 (68.18%)  changed or added relevant lines in 11 files are covered.\n86 unchanged lines in 8 files lost coverage.\nOverall coverage decreased (-1.6%) to 68.32%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_broker.erl | 3 | 5 | 60.0%\n| src/emqx_hooks.erl | 7 | 9 | 77.78%\n| src/emqx_access_control.erl | 14 | 17 | 82.35%\n| src/emqx_psk.erl | 0 | 4 | 0.0%\n| src/emqx_session.erl | 14 | 18 | 77.78%\n| src/emqx_mod_acl_internal.erl | 11 | 17 | 64.71%\n| src/emqx_protocol.erl | 22 | 28 | 78.57%\n| src/emqx_reason_codes.erl | 0 | 8 | 0.0%\n | **Total:** | **75** | **110** | **68.18%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_sup.erl | 1 | 58.82% |\n| src/emqx_broker.erl | 1 | 64.15% |\n| src/emqx_pqueue.erl | 1 | 76.24% |\n| src/emqx_protocol.erl | 2 | 78.35% |\n| src/emqx_session.erl | 3 | 69.28% |\n| src/emqx_client.erl | 7 | 49.62% |\n| src/emqx_access_rule.erl | 20 | 46.15% |\n| src/emqx_acl_cache.erl | 51 | 39.08% |\n | **Total:** | **86** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 5008: |  -1.6% |\n| Covered Lines: | 3360 |\n| Relevant Lines: | 4918 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 4990\n\n2 of 3 (66.67%)  changed or added relevant lines in 2 files are covered.\n3 unchanged lines in 3 files lost coverage.\nOverall coverage decreased (-0.03%) to 70.139%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_message.erl | 1 | 2 | 50.0%\n | **Total:** | **2** | **3** | **66.67%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_router.erl | 1 | 91.8% |\n| src/emqx_mod_presence.erl | 1 | 83.33% |\n| src/emqx_pqueue.erl | 1 | 76.24% |\n | **Total:** | **3** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4987: |  -0.03% |\n| Covered Lines: | 3488 |\n| Relevant Lines: | 4973 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 5000\n\n2 of 2 (100.0%)  changed or added relevant lines in 2 files are covered.\n18 unchanged lines in 5 files lost coverage.\nOverall coverage decreased (-0.3%) to 69.803%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_alarm_handler.erl | 1 | 82.22% |\n| src/emqx_broker.erl | 1 | 63.92% |\n| src/emqx_metrics.erl | 1 | 77.91% |\n| src/emqx_connection.erl | 7 | 63.03% |\n| src/emqx_session.erl | 8 | 69.39% |\n | **Total:** | **18** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 4996: |  -0.3% |\n| Covered Lines: | 3472 |\n| Relevant Lines: | 4974 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 5054\n\n9 of 9 (100.0%)  changed or added relevant lines in 3 files are covered.\n7 unchanged lines in 1 file lost coverage.\nOverall coverage decreased (-0.08%) to 68.267%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_client.erl | 7 | 49.62% |\n | **Total:** | **7** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 5051: |  -0.08% |\n| Covered Lines: | 3369 |\n| Relevant Lines: | 4935 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 5058\n\n2 of 2 (100.0%)  changed or added relevant lines in 1 file are covered.\n2 unchanged lines in 2 files lost coverage.\nOverall coverage increased (+0.3%) to 68.56%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_connection.erl | 1 | 63.31% |\n| src/emqx_protocol.erl | 1 | 77.93% |\n | **Total:** | **2** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 5055: |  0.3% |\n| Covered Lines: | 3380 |\n| Relevant Lines: | 4930 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 5068\n\n120 of 190 (63.16%)  changed or added relevant lines in 19 files are covered.\n444 unchanged lines in 16 files lost coverage.\nOverall coverage increased (+0.02%) to 68.452%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_message.erl | 1 | 2 | 50.0%\n| src/emqx_broker.erl | 3 | 5 | 60.0%\n| src/emqx_hooks.erl | 13 | 15 | 86.67%\n| src/emqx_rpc.erl | 5 | 7 | 71.43%\n| src/emqx_access_control.erl | 14 | 17 | 82.35%\n| src/emqx_session.erl | 14 | 18 | 77.78%\n| src/emqx_mod_acl_internal.erl | 11 | 17 | 64.71%\n| src/emqx_protocol.erl | 22 | 28 | 78.57%\n| src/emqx_psk.erl | 0 | 6 | 0.0%\n| src/emqx_reason_codes.erl | 0 | 10 | 0.0%\n | **Total:** | **120** | **190** | **63.16%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_sup.erl | 1 | 58.82% |\n| src/emqx_packet.erl | 1 | 84.21% |\n| src/emqx.erl | 2 | 64.86% |\n| src/emqx_message.erl | 3 | 72.73% |\n| src/emqx_bridge_mqtt.erl | 3 | 78.13% |\n| src/emqx_mod_acl_internal.erl | 5 | 63.64% |\n| src/emqx_alarm_handler.erl | 6 | 82.22% |\n| src/emqx_topic.erl | 6 | 91.36% |\n| src/emqx_hooks.erl | 7 | 83.05% |\n| src/emqx_ws_connection.erl | 25 | 62.16% |\n | **Total:** | **444** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 5067: |  0.02% |\n| Covered Lines: | 3374 |\n| Relevant Lines: | 4929 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 5070\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n20 unchanged lines in 4 files lost coverage.\nOverall coverage decreased (-0.4%) to 68.371%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_pqueue.erl | 1 | 76.24% |\n| src/emqx_metrics.erl | 1 | 77.91% |\n| src/emqx_connection.erl | 7 | 63.91% |\n| src/emqx_session.erl | 11 | 69.28% |\n | **Total:** | **20** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 5065: |  -0.4% |\n| Covered Lines: | 3370 |\n| Relevant Lines: | 4929 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 5081\n\n0 of 0   changed or added relevant lines in 0 files are covered.\n1 unchanged line in 1 file lost coverage.\nOverall coverage decreased (-0.02%) to 68.574%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_broker.erl | 1 | 64.15% |\n | **Total:** | **1** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 5077: |  -0.02% |\n| Covered Lines: | 3380 |\n| Relevant Lines: | 4929 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 5092\n\n6 of 11 (54.55%)  changed or added relevant lines in 2 files are covered.\n12 unchanged lines in 4 files lost coverage.\nOverall coverage decreased (-0.2%) to 68.362%\n\n\n|  Changes Missing Coverage | Covered Lines | Changed/Added Lines | % |\n| :-----|--------------|--------|---: |\n| src/emqx_os_mon.erl | 0 | 5 | 0.0%\n | **Total:** | **6** | **11** | **54.55%** | \n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_os_mon.erl | 1 | 60.0% |\n| src/emqx_pqueue.erl | 1 | 76.24% |\n| src/emqx_session.erl | 3 | 69.28% |\n| src/emqx_client.erl | 7 | 49.62% |\n | **Total:** | **12** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 5077: |  -0.2% |\n| Covered Lines: | 3373 |\n| Relevant Lines: | 4934 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 5095\n\n5 of 5 (100.0%)  changed or added relevant lines in 1 file are covered.\nNo unchanged relevant lines lost coverage.\nOverall coverage increased (+0.03%) to 68.628%\n\n\n|  Totals |  |\n| :-- | --: |\n| Change from base Build 5077: |  0.03% |\n| Covered Lines: | 3382 |\n| Relevant Lines: | 4928 |\n\n\ud83d\udc9b  - Coveralls\n. ## Pull Request Test Coverage Report for Build 5103\n\n2 of 2 (100.0%)  changed or added relevant lines in 2 files are covered.\n9 unchanged lines in 2 files lost coverage.\nOverall coverage decreased (-0.02%) to 68.575%\n\n\n|  Files with Coverage Reduction | New Missed Lines | % |\n| :-----|--------------|--: |\n| src/emqx_broker.erl | 1 | 64.15% |\n| src/emqx_connection.erl | 8 | 64.29% |\n | **Total:** | **9** |  | \n|  Totals |  |\n| :-- | --: |\n| Change from base Build 5077: |  -0.02% |\n| Covered Lines: | 3378 |\n| Relevant Lines: | 4926 |\n\n\ud83d\udc9b  - Coveralls\n. ",
    "nerdial": "tnx a lot . how may i contribute to the project ? i would like to implement this feature \ncould you give me a hint ? . @Gilbert-Wong  Thanks a million. another question, how may i use this feature in emqtt ? can  presence module detect ungraceful disconnect as well ? . is there any example for using it ? (will msg). ",
    "mzy2240": "The reason why I think it might be a bug for emqx, instead of Paho, is that it works pretty well with emqttd 2.3.11, but failed when working with 3.0 beta 1, with same setup, no plugin and default parameters for emq.. BTW, tried the both .deb and .zip installer for Ubuntu 18.04, and the results are the same.. > @mzy2240 would be great if you can share the logs from emqx.\nSure. Will paste the logs here later. THX!. @spring2maz Here is the log:\n>\n===== LOGGING STARTED Tue Sep 11 11:09:02 CDT 2018\nExec: /home/zeyumao/emqx/erts-10.0.5/bin/erlexec -boot /home/zeyumao/emqx/releases/3.0/emqx -mode embedded -boot_var ERTS_LIB_DIR /home/zeyumao/emqx/erts-10.0.5/../lib -mnesia dir \"/home/zeyumao/emqx/data/mnesia/emqx@127.0.0.1\" -config /home/zeyumao/emqx/data/configs/app.2018.09.11.11.09.03.config -args_file /home/zeyumao/emqx/data/configs/vm.2018.09.11.11.09.03.args -vm_args /home/zeyumao/emqx/data/configs/vm.2018.09.11.11.09.03.args -- console\nRoot: /home/zeyumao/emqx\n/home/zeyumao/emqx\nErlang/OTP 21 [erts-10.0.5] [source] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:32] [hipe]\n=INFO REPORT==== 11-Sep-2018::11:09:05.739537 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/gnome-characters/117\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.739660 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/pycharm-community/83\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.739744 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/vscode/51\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.740150 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/gnome-calculator/199\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.740584 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/gnome-system-monitor/54\"},\n                         []}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.741350 ===\n    msg: event=server_setup_successfully driver=tcp socket=\"#Port<0.12>\"\n    options: []\n=INFO REPORT==== 11-Sep-2018::11:09:05.740721 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/postman/42\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.741486 ===\n    msg: event=start\n    options: []\n=INFO REPORT==== 11-Sep-2018::11:09:05.741532 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/gnome-calculator/180\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.741971 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/gnome-system-monitor/51\"},\n                         []}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.742111 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/gnome-logs/37\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.742874 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/gtk-common-themes/319\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.742983 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/core/4917\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.743059 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/gnome-3-26-1604/70\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.743261 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/chromium/412\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.743349 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/gnome-logs/40\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.743561 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/core/5328\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.743632 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/core/5145\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.743692 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/pycharm-community/79\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.743805 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/gnome-characters/103\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.743883 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/gnome-calculator/222\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.743975 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/vscode/52\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.744063 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/chromium/458\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.744128 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/vscode/53\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.744207 ===\n    alarm_handler: {set,{{disk_almost_full,\"/snap/postman/53\"},[]}}\n=INFO REPORT==== 11-Sep-2018::11:09:05.744276 ===\n    alarm_handler: {set,{system_memory_high_watermark,[]}}\nStarting emqx on node emqx@127.0.0.1\nLoad emqx_mod_presence module successfully.\nStart http:management listener on 8080 successfully.\nStart http:dashboard listener on 18083 successfully.\nStart mqtt:tcp listener on 127.0.0.1:11883 successfully.\nStart mqtt:tcp listener on 0.0.0.0:1883 successfully.\nStart mqtt:ws listener on 0.0.0.0:8083 successfully.\nStart mqtt:ssl listener on 0.0.0.0:8883 successfully.\nStart mqtt:wss listener on 0.0.0.0:8084 successfully.\nEMQ X Broker 3.0 is running now!\nEshell V10.0.5  (abort with ^G)\n(emqx@127.0.0.1)1> =INFO REPORT==== 11-Sep-2018::11:10:47.787580 ===\n    application: emqx_management\n    exited: stopped\n    type: temporary\n=INFO REPORT==== 11-Sep-2018::11:10:47.788069 ===\n    application: emqx_recon\n    exited: stopped\n    type: temporary\n=INFO REPORT==== 11-Sep-2018::11:10:47.790374 ===\n    application: emqx_retainer\n    exited: stopped\n    type: temporary\n=INFO REPORT==== 11-Sep-2018::11:10:47.791879 ===\n    application: emqx_dashboard \b\n    exited: stopped\n    type: temporary\n=INFO REPORT==== 11-Sep-2018::11:10:47.803206 ===\nmqtt:tcp stopped on 127.0.0.1:11883\nStop mqtt:tcp listener on 127.0.0.1:11883 successfully.\n=INFO REPORT==== 11-Sep-2018::11:10:47.803529 ===\nmqtt:tcp stopped on 0.0.0.0:1883\nStop mqtt:tcp listener on 0.0.0.0:1883 successfully.\nStop mqtt:ws listener on 0.0.0.0:8083 successfully.\nStop mqtt:ssl listener on 0.0.0.0:8883 successfully.\n=INFO REPORT==== 11-Sep-2018::11:10:47.805819 ===\nmqtt:ssl stopped on 0.0.0.0:8883\nStop mqtt:wss listener on 0.0.0.0:8084 successfully.\n=SUPERVISOR REPORT==== 11-Sep-2018::11:10:47.815767 ===\n    supervisor: {local,gr_counter_sup}\n    errorContext: child_terminated\n    reason: killed\n    offender: [{pid,<0.1354.0>},\n               {id,gr_lager_default_tracer_counters},\n               {mfargs,{gr_counter,start_link,\n                                   [gr_lager_default_tracer_counters]}},\n               {restart_type,transient},\n               {shutdown,brutal_kill},\n               {child_type,worker}]\n=SUPERVISOR REPORT==== 11-Sep-2018::11:10:47.816075 ===\n    supervisor: {local,gr_param_sup}\n    errorContext: shutdown_error\n    reason: killed\n    offender: [{pid,<0.1353.0>},\n               {id,gr_lager_default_tracer_params},\n               {mfargs,{gr_param,start_link,[gr_lager_default_tracer_params]}},\n               {restart_type,transient},\n               {shutdown,brutal_kill},\n               {child_type,worker}]\n[os_mon] memory supervisor port (memsup): Erlang has closed\n=INFO REPORT==== 11-Sep-2018::11:10:47.817521 ===\n    alarm_handler: {clear,system_memory_high_watermark}\n=INFO REPORT==== 11-Sep-2018::11:10:47.817737 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/vscode/52\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.817917 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/pycharm-community/83\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.818063 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/postman/53\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.818217 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/pycharm-community/79\"}}\n[os_mon] cpu supervisor port (cpu_sup): Erlang has closed\n=INFO REPORT==== 11-Sep-2018::11:10:47.818342 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/core/4917\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.818903 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/gtk-common-themes/319\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.819026 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/postman/42\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.819133 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/gnome-characters/103\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.819230 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/chromium/458\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.819393 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/gnome-logs/37\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.819957 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/core/5145\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.820036 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/gnome-system-monitor/51\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.820673 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/gnome-characters/117\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.821055 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/gnome-calculator/199\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.821495 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/chromium/412\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.821878 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/core/5328\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.821992 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/gnome-calculator/180\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.822076 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/vscode/51\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.822144 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/gnome-calculator/222\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.822239 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/gnome-logs/40\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.822339 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/gnome-system-monitor/54\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.822461 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/vscode/53\"}}\n=INFO REPORT==== 11-Sep-2018::11:10:47.822548 ===\n    alarm_handler: {clear,{disk_almost_full,\"/snap/gnome-3-26-1604/70\"}}. @spring2maz Hey dude, I finally find the smallest case to reproduce the issue I met, here is the python code for that: (Python 3.6)\nimport paho.mqtt.client as mqtt #import the client1\nimport json\nbroker_address = \"165.91.215.141\"\nprint(\"creating new instance\")\nclient = mqtt.Client(\"Tester\") #create new instance\nprint(\"connecting to broker\")\nclient.connect(broker_address) #connect to broker\nprint(\"Publishing message to topic\",\"note\")\ndata = {'type': 'dsmSimulationData', 'ID': 9999, 'Status': 'running', 'SOC': 1536702170, 'FRACSEC': 451000, 'Data': (0.0, 0.0, 177.82638549804688, 50.68052673339844, 0.0, 0.0, 60.06795883178711, 0.0, 0.0, 160.8531951904297, 45.843162536621094, 0.0, 0.0, 60.06793975830078, 0.0, 0.0, 151.68692016601562, 43.230770111083984, 0.0, 0.0, 60.06794357299805, 0.0, 0.0, 162.7008056640625, 46.369728088378906, 0.0, 0.0, 60.06795120239258, 0.0, 0.0, 151.16688537597656, 43.08256530761719, 0.0, 0.0, 60.067962646484375, 0.0, 0.0, 131.5943603515625, 37.50439453125, 0.0, 0.0, 60.06787872314453, 0.0, 0.0, 189.5947723388672, 54.034507751464844, 0.0, 0.0, 60.067909240722656, 0.0, 0.0, 170.17945861816406, 48.50114440917969, 0.0, 0.0, 60.06793212890625, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 60.06792068481445, 0.0, 0.0, 182.07655334472656, 51.891815185546875, 0.0, 0.0, 60.06797790527344, 0.0, 0.0, 120.29206085205078, 34.283241271972656, 0.0, 0.0, 60.0679817199707, 0.0, 0.0, 170.7500762939453, 48.66376876831055, 0.0, 0.0, 60.067962646484375, 0.0, 0.0, 191.05572509765625, 54.45088577270508, 0.0, 0.0, 60.06797790527344, 0.0, 0.0, 173.55760192871094, 49.46392059326172, 0.0, 0.0, 60.06794357299805, 0.0, 0.0, 115.51586151123047, 32.922019958496094, 0.0, 0.0, 60.067955017089844, 0.0, 0.0, 158.2788543701172, 45.109474182128906, 0.0, 0.0, 60.06794738769531, 0.0, 0.0, 125.38717651367188, 35.735347747802734, 0.0, 0.0, 60.06794738769531, 0.0, 0.0, 156.5443878173828, 44.615150451660156, 0.0, 0.0, 60.067935943603516, 0.0, 0.0, 94.99187469482422, 27.07268524169922, 0.0, 0.0, 60.068016052246094, 0.0, 0.0, 174.32342529296875, 49.68217849731445, 0.0, 0.0, 60.06795120239258, 0.0, 0.0, 188.53834533691406, 53.73342514038086, 0.0, -149.87754821777344, 60.06794738769531, 0.0, 0.0, 181.25819396972656, 51.6585807800293, 0.0, 0.0, 60.06792449951172, 0.0, 0.0, 58.05577850341797, 16.545896530151367, 0.0, 0.0, 60.06800079345703, 0.0, 0.0, 38.987152099609375, 11.111337661743164, 0.0, 0.0, 60.067893981933594, 0.0, 0.0, 155.9853515625, 44.45582580566406, 0.0, -145.8875274658203, 60.067955017089844, 0.0, 0.0, 191.15574645996094, 54.47938537597656, 0.0, 0.0, 60.06788635253906, 0.0, 0.0, 126.65294647216797, 36.09608840942383, 0.0, 0.0, 60.067955017089844, 0.0, 0.0, 136.79742431640625, 38.987266540527344, 0.0, 0.0, 60.06795120239258, 0.0, 0.0, 144.54994201660156, 41.19673538208008, 0.0, 0.0, 60.06794738769531, 0.0, 0.0, 151.8463592529297, 43.276214599609375, 0.0, 0.0, 60.06784439086914, 0.0, 0.0, 165.69186401367188, 47.2221794128418, 0.0, 0.0, 60.06783676147461, 0.0, 0.0, 197.01498413085938, 56.14927673339844, 0.0, 0.0, 60.06781768798828, 0.0, 0.0, 156.41543579101562, 44.57839584350586, 0.0, 0.0, 60.06783676147461, 0.0, 0.0, 164.40492248535156, 46.855403900146484, 0.0, 0.0, 60.06783676147461, 0.0, 0.0, 9.900075912475586, 2.821521282196045, 0.0, 0.0, 60.06783676147461, 0.0, 0.0, 86.49138641357422, 24.65004539489746, 0.0, 0.0, 60.06783676147461, 0.0, 0.0, 42.18327331542969, 12.022232055664062, 0.0, 0.0, 60.06785202026367, 0.0, 0.0, 65.801025390625, 18.753292083740234, 0.0, 0.0, 60.06791305541992, 0.0, 0.0, 184.61309814453125, 52.61473846435547, 0.0, 0.0, 60.067840576171875, 0.0, 0.0, 159.26397705078125, 45.390235900878906, 0.0, 0.0, 60.067840576171875, 0.0, 0.0, 146.24172973632812, 41.67889404296875, 0.0, 0.0, 60.06779479980469, 0.0, 0.0, 177.0760498046875, 50.466670989990234, 0.0, 0.0, 60.06779479980469, 0.0, 0.0, 109.94050598144531, 31.333044052124023, 0.0, 0.0, 60.06779098510742, 0.0, 0.0, 182.87522888183594, 52.119441986083984, 0.0, 0.0, 60.06779479980469, 0.0, 0.0, 89.72119903564453, 25.570539474487305, 0.0, 0.0, 60.06779098510742, 0.0, 0.0, 171.68690490722656, 48.93077087402344, 0.0, 0.0, 60.06779479980469, 0.0, 0.0, 29.261188507080078, 8.339438438415527, 0.0, 0.0, 60.06779479980469, 0.0, 0.0, 195.84274291992188, 55.815189361572266, 0.0, 0.0, 60.067806243896484, 0.0, 0.0, 152.1407470703125, 43.360111236572266, 0.0, 0.0, 60.067806243896484, 0.0, 0.0, 175.0687713623047, 49.89459991455078, 0.0, 0.0, 60.06779479980469, 0.0, 0.0, 125.26960754394531, 35.701839447021484, 0.0, 0.0, 60.06780242919922, 0.0, 0.0, 181.85592651367188, 51.82893753051758, 0.0, 0.0, 60.06781005859375, 0.0, 0.0, 182.2145538330078, 51.931148529052734, 0.0, 0.0, 60.06779479980469, 0.0, 0.0, 111.03437805175781, 31.644800186157227, 0.0, 0.0, 60.06781005859375, 0.0, 0.0, 174.2488250732422, 49.66091537475586, 0.0, 0.0, 60.067806243896484, 0.0, 0.0, 127.26315307617188, 36.27000045776367, 0.0, 0.0, 60.06784439086914, 0.0, 0.0, 64.71812438964844, 18.444665908813477, 0.0, 0.0, 60.06779861450195, 0.0, 0.0, 119.80976867675781, 34.145782470703125, 0.0, 0.0, 60.06781768798828, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 60.06780242919922, 0.0, 0.0, 130.0288848876953, 37.058231353759766, 0.0, 0.0, 60.067813873291016, 0.0, 0.0, 163.77757263183594, 46.67660903930664, 0.0, 0.0, 60.06781005859375, 0.0, 0.0, 182.19696044921875, 51.92613983154297, 0.0, 0.0, 60.067806243896484, 0.0, 0.0, 190.7760467529297, 54.37116622924805, 0.0, 0.0, 60.067806243896484, 0.0, 0.0, 113.97395324707031, 32.482574462890625, 0.0, 0.0, 60.06803894042969, 0.0, 0.0, 85.03752136230469, 24.235694885253906, 0.0, 0.0, 60.06806564331055, 0.0, 0.0, 148.6482696533203, 42.36475372314453, 0.0, 0.0, 60.06806564331055, 0.0, 0.0, 64.1366958618164, 18.278955459594727, 0.0, 0.0, 60.06803512573242, 0.0, 0.0, 62.426212310791016, 17.791471481323242, 0.0, 0.0, 60.06805419921875, 0.0, 0.0, 32.801937103271484, 9.348551750183105, 0.0, 0.0, 60.06806182861328, 0.0, 0.0, 188.8105010986328, 53.81098937988281, 0.0, 0.0, 60.06806945800781, 0.0, 0.0, 159.12620544433594, 45.35096740722656, 0.0, 0.0, 60.06806564331055, 0.0, 0.0, 84.75081634521484, 24.153982162475586, 0.0, 0.0, 60.06804656982422, 0.0, 0.0, 165.87240600585938, 47.27363204956055, 0.0, 0.0, 60.06806564331055, 0.0, 0.0, 140.4801788330078, 40.03684997558594, 0.0, 0.0, 60.06806564331055, 0.0, 0.0, 160.3898468017578, 45.71110534667969, 0.0, 0.0, 60.06806945800781, 0.0, 0.0, 140.3931427001953, 40.012046813964844, 0.0, 0.0, 60.06806945800781, 0.0, 0.0, 169.52174377441406, 48.313697814941406, 0.0, 0.0, 60.06806564331055, 0.0, 0.0, 181.66273498535156, 51.77387619018555, 0.0, -144.79119873046875, 60.06806945800781, 0.0, 0.0, 159.69244384765625, 45.51234817504883, 0.0, 0.0, 60.06806945800781, 0.0, 0.0, 155.60540771484375, 44.34754180908203, 0.0, 0.0, 60.06806945800781, 0.0, 0.0, 145.3006591796875, 41.41068649291992, 0.0, 0.0, 60.06806945800781, 0.0, 0.0, 80.05044555664062, 22.814374923706055, 0.0, 0.0, 60.06802749633789, 0.0, 0.0, 64.32295227050781, 18.332040786743164, 0.0, 0.0, 60.06801223754883, 0.0, 0.0, 62.251644134521484, 17.741718292236328, 0.0, 0.0, 60.068023681640625, 0.0, 0.0, 178.8817901611328, 50.98131561279297, 0.0, 0.0, 60.06803894042969, 0.0, 0.0, 92.39799499511719, 26.33342933654785, 0.0, 0.0, 60.06804275512695, 0.0, 0.0, 63.072208404541016, 17.97557830810547, 0.0, 0.0, 60.06801986694336, 0.0, 0.0, 172.75192260742188, 49.23429489135742, 0.0, 0.0, 60.0679817199707, 0.0, 0.0, 194.3072509765625, 55.37757110595703, 0.0, 0.0, 60.067874908447266, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 60.06788635253906, 1227.0885009765625, 637.6300048828125, 0.0, 0.0, 0.0, 0.0, 60.06794738769531, 818.2857055664062, 438.54705810546875, 0.0, 0.0, 0.0, 0.0, 60.06778335571289, 3135.90478515625, 2762.9609375, 0.0, 0.0, 0.0, 0.0, 60.0680046081543, 1789.0426025390625, 594.9158935546875, 0.0, 0.0, 0.0, 0.0, 60.06780242919922, 1872.4969482421875, 972.4960327148438, 0.0, 0.0, 0.0, 0.0, 60.068077087402344, 171.75341796875, 100.44956970214844, 0.0, 0.0, 0.0, 0.0, 60.06804275512695, 3109.166259765625, 700.75244140625, 0.0, 0.0, 0.0, 0.0, 60.06782913208008, 24.249679565429688, 26.355003356933594, 0.0, 0.0, 0.0, 0.0, 60.067893981933594, 1.0399984121322632, 0.7653669118881226, 60.0680046081543, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9837958216667175, -12.187467575073242, 60.06795883178711, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9971851706504822, -10.9668550491333, 60.06793975830078, 0.0, 1.0, 0.0, 0.0, 0.0, 0.991413414478302, -12.416518211364746, 60.06794357299805, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9806153774261475, -14.327859878540039, 60.06795120239258, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9784167408943176, -13.308891296386719, 60.067962646484375, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9958642721176147, -11.120925903320312, 60.06787872314453, 0.0, 1.0, 0.0, 0.0, 0.0, 1.007678508758545, -9.767459869384766, 60.067909240722656, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9836382269859314, -14.815754890441895, 60.06793212890625, 0.0, 1.0, 0.0, 0.0, 0.0, 1.015696406364441, -8.626688957214355, 60.06792068481445, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0100878477096558, -7.307998180389404, 60.06797790527344, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9786984920501709, -11.651131629943848, 60.0679817199707, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9718076586723328, -14.673080444335938, 60.067962646484375, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0026206970214844, -8.662323951721191, 60.06797409057617, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9995940923690796, -10.444758415222168, 60.06794357299805, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9760640859603882, -15.654947280883789, 60.067955017089844, 0.0, 1.0, 0.0, 0.0, 0.0, 1.00003182888031, -10.434828758239746, 60.06794738769531, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9948155879974365, -11.997818946838379, 60.06794738769531, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9928232431411743, -12.045477867126465, 60.067935943603516, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9911818504333496, -9.581687927246094, 60.068016052246094, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9901022911071777, -11.980162620544434, 60.06795120239258, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9995917677879333, -11.395676612854004, 60.06794738769531, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0023176670074463, -10.689926147460938, 60.06792449951172, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0132180452346802, -5.4859490394592285, 60.06800079345703, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0164763927459717, -8.557634353637695, 60.067893981933594, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9861965179443359, -16.922534942626953, 60.067955017089844, 0.0, 1.0, 0.0, 0.0, 0.0, 1.008936882019043, -8.639190673828125, 60.06789016723633, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9851575493812561, -12.82718276977539, 60.067955017089844, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9921914339065552, -12.070662498474121, 60.06795120239258, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9921342730522156, -12.420470237731934, 60.06794738769531, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0092881917953491, -8.165298461914062, 60.06784439086914, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0218216180801392, -6.237546443939209, 60.06783676147461, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0247331857681274, -7.316287040710449, 60.06782150268555, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0145366191864014, -7.3514084815979, 60.06783676147461, 0.0, 1.0, 0.0, 0.0, 0.0, 1.026824712753296, -5.555459976196289, 60.06783676147461, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0184416770935059, -7.064250469207764, 60.06783676147461, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0158724784851074, -7.865789413452148, 60.06783676147461, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0062650442123413, -9.273334503173828, 60.06785202026367, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9914049506187439, -12.603099822998047, 60.06791305541992, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0227810144424438, -6.061768531799316, 60.067840576171875, 0.0, 1.0, 0.0, 0.0, 0.0, 1.013026237487793, -7.428142547607422, 60.067840576171875, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9876154065132141, -13.02875804901123, 60.06779479980469, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9908792972564697, -12.593475341796875, 60.06779479980469, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9998502135276794, -12.390604972839355, 60.06779098510742, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9859843850135803, -12.52029037475586, 60.06779479980469, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0031846761703491, -12.056861877441406, 60.06779098510742, 0.0, 1.0, 0.0, 0.0, 0.0, 0.988465428352356, -13.392748832702637, 60.06779479980469, 0.0, 1.0, 0.0, 0.0, 0.0, 0.985815703868866, -13.0891695022583, 60.06779479980469, 0.0, 1.0, 0.0, 0.0, 0.0, 1.012858271598816, -9.749472618103027, 60.067806243896484, 0.0, 1.0, 0.0, 0.0, 0.0, 1.001330018043518, -11.18691349029541, 60.067806243896484, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0057405233383179, -12.071880340576172, 60.06779479980469, 0.0, 1.0, 0.0, 0.0, 0.0, 1.004116177558899, -11.252408027648926, 60.06780242919922, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0181740522384644, -8.217907905578613, 60.06781005859375, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0141932964324951, -11.006731033325195, 60.06779861450195, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0021668672561646, -10.814555168151855, 60.06781005859375, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0021249055862427, -11.329097747802734, 60.067806243896484, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0086791515350342, -9.3522310256958, 60.06784439086914, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9997900128364563, -12.476408958435059, 60.06779861450195, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0193750858306885, -7.965339183807373, 60.06781768798828, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0096765756607056, -11.141088485717773, 60.06780242919922, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0074061155319214, -9.859888076782227, 60.067813873291016, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0099576711654663, -9.60440444946289, 60.06781005859375, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0118438005447388, -9.735085487365723, 60.067806243896484, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0121116638183594, -9.565183639526367, 60.067806243896484, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9914684295654297, -11.601922988891602, 60.06803894042969, 0.0, 1.0, 0.0, 0.0, 0.0, 0.976170539855957, -15.316923141479492, 60.06806564331055, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9889861941337585, -13.518814086914062, 60.06806564331055, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9851589202880859, -12.482877731323242, 60.06803512573242, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9975913763046265, -12.505718231201172, 60.06805419921875, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0039100646972656, -11.638622283935547, 60.06806182861328, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9744933843612671, -15.56158447265625, 60.06806564331055, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9724769592285156, -15.831082344055176, 60.06806564331055, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9931516647338867, -12.04968547821045, 60.06804656982422, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9704626798629761, -16.158172607421875, 60.06806564331055, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9677713513374329, -16.561246871948242, 60.06806564331055, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9721583724021912, -16.208911895751953, 60.06806945800781, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9688244462013245, -16.716157913208008, 60.06806945800781, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9682549834251404, -16.55988121032715, 60.06806564331055, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9824839234352112, -14.967260360717773, 60.06806945800781, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9726176857948303, -16.111560821533203, 60.06806945800781, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9739628434181213, -16.06458282470703, 60.06806945800781, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9706493020057678, -16.278139114379883, 60.06806945800781, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9856076240539551, -11.631914138793945, 60.06802749633789, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9951075315475464, -8.883183479309082, 60.06801223754883, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9854458570480347, -11.45374584197998, 60.068023681640625, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0096182823181152, -9.001023292541504, 60.06803894042969, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9993000030517578, -11.966410636901855, 60.06804275512695, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9935845732688904, -12.903427124023438, 60.06801986694336, 0.0, 1.0, 0.0, 0.0, 0.0, 0.9703337550163269, -17.783103942871094, 60.0679817199707, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0172302722930908, -7.949493408203125, 60.067874908447266, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0186083316802979, -8.267461776733398, 60.06788635253906, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0318115949630737, -6.6658244132995605, 60.067806243896484, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0301955938339233, -8.57386589050293, 60.06779479980469, 0.0, 1.0, 0.0, 0.0, 0.0, 1.044258952140808, -2.5408475399017334, 60.067840576171875, 0.0, 1.0, 0.0, 0.0, 0.0, 1.032129168510437, -6.203139305114746, 60.06804275512695, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0242440700531006, -6.8944411277771, 60.06792068481445, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0219107866287231, -9.671538352966309, 60.06779479980469, 0.0, 1.0, 0.0, 0.0, 0.0, 1.025700569152832, -4.497273921966553, 60.0679817199707, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0092970132827759, -10.729818344116211, 60.06806945800781, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0332043170928955, -6.265463352203369, 60.067806243896484, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0251796245574951, -6.322861194610596, 60.06794738769531, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0264571905136108, -6.699699401855469, 60.067909240722656, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0150848627090454, -10.204521179199219, 60.06779479980469, 0.0, 1.0, 0.0, 0.0, 0.0, 1.01101553440094, -10.454426765441895, 60.06806945800781, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0348315238952637, -5.365472793579102, 60.067874908447266, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0305895805358887, -5.726554870605469, 60.0678825378418, 0.0, 1.0, 0.0, 0.0, 0.0, 1.041738748550415, -4.442520618438721, 60.067813873291016, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0254732370376587, -4.789616107940674, 60.06797790527344, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0322033166885376, -6.950817108154297, 60.067806243896484, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0388001203536987, -2.664659023284912, 60.06794738769531, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0392251014709473, -2.6663873195648193, 60.06794738769531, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0392251014709473, -2.6663880348205566, 60.06794738769531, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0402452945709229, -5.730298042297363, 60.06777572631836, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0402452945709229, -5.730298042297363, 60.06777572631836, 0.0, 1.0, 0.0, 0.0, 0.0, 1.039502501487732, -5.727182865142822, 60.06777572631836, 0.0, 1.0, 0.0, 0.0, 0.0, 0.8554919958114624, 1.501432180404663, 60.0680046081543, 0.0, 1.0, 0.0, 0.0, 0.0, 1.036881446838379, 0.7738319039344788, 60.0680046081543, 0.0, 1.0, 0.0, 0.0, 0.0, 1.036881446838379, 0.7738319039344788, 60.0680046081543, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0399984121322632, 0.7610363364219666, 60.0680046081543, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0399689674377441, -1.3341076374053955, 60.06779861450195, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0399689674377441, -1.3341076374053955, 60.06779861450195, 0.0, 1.0, 0.0, 0.0, 0.0, 1.040056586265564, -1.3344594240188599, 60.06779861450195, 0.0, 1.0, 0.0, 0.0, 0.0, 1.040056586265564, -1.3344594240188599, 60.06779861450195, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0399994850158691, -4.56032133102417, 60.06808090209961, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0399994850158691, -4.56032133102417, 60.06808090209961, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0399994850158691, -4.56032133102417, 60.06808090209961, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0399994850158691, -4.595604419708252, 60.06808090209961, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0399994850158691, -4.595604419708252, 60.06808090209961, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0393625497817993, -4.328315734863281, 60.068050384521484, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0396909713745117, 1.1812893152236938, 60.06782531738281, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0398091077804565, 1.1808149814605713, 60.06782531738281, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0396909713745117, 1.1812893152236938, 60.06782531738281, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0397086143493652, 1.2145733833312988, 60.06782531738281, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0396573543548584, 1.2147802114486694, 60.06782531738281, 0.0, 1.0, 0.0, 0.0, 0.0, 1.039992094039917, -7.224976539611816, 60.067893981933594, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0138545036315918, -10.302647590637207, 60.06806182861328, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0351070165634155, -7.27053165435791, 60.06806564331055, 0.0, 1.0, 0.0, 0.0, 0.0, 1.027415156364441, -6.914518356323242, 60.06781005859375, 0.0, 1.0, 0.0, 0.0, 0.0, 1.044260859489441, -4.034049987792969, 60.067806243896484, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0042070150375366, -10.114848136901855, 60.06789779663086, 0.0, 1.0, 0.0, 0.0, 0.0, 1.012993335723877, -8.661063194274902, 60.06794357299805, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0340136289596558, -5.381859302520752, 60.06794738769531, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0169472694396973, -4.886735439300537, 60.06800079345703, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0322425365447998, -1.9873019456863403, 60.06800079345703, 0.0, 1.0, 0.0, 0.0, 0.0, 1.032259464263916, -4.746240615844727, 60.06783676147461, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0491576194763184, -1.5140507221221924, 60.067832946777344, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0123546123504639, -9.829517364501953, 60.06803512573242, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0314067602157593, -7.010507106781006, 60.06804275512695, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0183296203613281, -10.481608390808105, 60.06779098510742, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0330003499984741, -8.5784273147583, 60.06779098510742, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0399984121322632, 0.7653669118881226, 14.351977348327637, 60.0680046081543, 1.0, 1.0, 1047.2366943359375, 593.3414306640625, 1203.6439208984375, 1.0399999618530273, 0.48875558376312256, 1.0388001203536987, -2.664659023284912, 14.335442543029785, 60.06794738769531, 1.0, 1.0, 345.44573974609375, 177.28831481933594, 388.2832946777344, 1.042357325553894, 0.4880329668521881, 1.0392251014709473, -2.6663873195648193, 14.34130573272705, 60.06794738769531, 1.0, 1.0, 229.6903839111328, 119.93070220947266, 259.1158752441406, 1.0478050708770752, 0.4880329370498657, 1.0392251014709473, -2.6663880348205566, 14.34130573272705, 60.06794738769531, 1.0, 1.0, 651.9523315429688, 340.41094970703125, 735.4736328125, 1.0478050708770752, 0.48803281784057617, 1.0402452945709229, -5.730298042297363, 14.355384826660156, 60.06777572631836, 1.0, 1.0, 336.12335205078125, 181.03372192382812, 381.7749328613281, 1.038185477256775, 0.0976065844297409, 1.0402452945709229, -5.730298042297363, 14.355384826660156, 60.06777572631836, 1.0, 1.0, 336.12335205078125, 181.03372192382812, 381.7749328613281, 1.038185477256775, 0.0976065844297409, 1.039502501487732, -5.727182865142822, 14.345133781433105, 60.06777572631836, 1.0, 1.0, 146.03903198242188, 76.47960662841797, 164.85304260253906, 1.0437800884246826, 0.0976065844297409, 0.8554919958114624, 1.501432180404663, 11.80578899383545, 60.0680046081543, 1.0, 1.0, 347.68609619140625, 1226.732177734375, 1275.0518798828125, 1.0535043478012085, 0.4880329966545105, 1.036881446838379, 0.7738319039344788, 14.308963775634766, 60.0680046081543, 1.0, 1.0, 347.6845703125, 174.79168701171875, 389.148681640625, 1.0535043478012085, 0.4880329966545105, 1.036881446838379, 0.7738319039344788, 14.308963775634766, 60.0680046081543, 1.0, 1.0, 347.6845703125, 174.79168701171875, 389.148681640625, 1.0535043478012085, 0.4880329966545105, 1.0399984121322632, 0.7610363364219666, 14.351977348327637, 60.0680046081543, 1.0, 1.0, 1045.61279296875, 593.3040771484375, 1202.212890625, 1.0399999618530273, 0.48803281784057617, 1.0399689674377441, -1.3341076374053955, 14.351571083068848, 60.06779861450195, 1.0, 1.0, 224.4204864501953, 74.32001495361328, 236.40646362304688, 1.0399999618530273, 0.48803284764289856, 1.0399689674377441, -1.3341076374053955, 14.351571083068848, 60.06779861450195, 1.0, 1.0, 224.4204864501953, 74.32001495361328, 236.40646362304688, 1.0399999618530273, 0.48803284764289856, 1.040056586265564, -1.3344594240188599, 14.352781295776367, 60.06779861450195, 1.0, 1.0, 670.100830078125, 223.137939453125, 706.27587890625, 1.0382589101791382, 0.4880329370498657, 1.040056586265564, -1.3344594240188599, 14.352781295776367, 60.06779861450195, 1.0, 1.0, 670.100830078125, 223.137939453125, 706.27587890625, 1.0382589101791382, 0.4880329370498657, 1.0399994850158691, -4.56032133102417, 14.351993560791016, 60.06808090209961, 1.0, 1.0, 342.5745849609375, 176.92433166503906, 385.56396484375, 1.0442949533462524, 0.01952131651341915, 1.0399994850158691, -4.56032133102417, 14.351993560791016, 60.06808090209961, 1.0, 1.0, 342.5745849609375, 176.92433166503906, 385.56396484375, 1.0442949533462524, 0.01952131651341915, 1.0399994850158691, -4.56032133102417, 14.351993560791016, 60.06808090209961, 1.0, 1.0, 342.5745849609375, 176.92433166503906, 385.56396484375, 1.0442949533462524, 0.01952131651341915, 1.0399994850158691, -4.595604419708252, 14.351993560791016, 60.06808090209961, 1.0, 1.0, 338.173828125, 176.82752990722656, 381.6143493652344, 1.0442949533462524, 0.018267761915922165, 1.0399994850158691, -4.595604419708252, 14.351993560791016, 60.06808090209961, 1.0, 1.0, 506.599365234375, 264.8954772949219, 571.6751708984375, 1.0442949533462524, 0.018267761915922165, 1.0393625497817993, -4.328315734863281, 14.3432035446167, 60.068050384521484, 1.0, 1.0, 171.75341796875, 100.44956970214844, 198.97073364257812, 1.0436501502990723, 0.018267761915922165, 1.0396909713745117, 1.1812893152236938, 14.347736358642578, 60.06782531738281, 1.0, 1.0, 403.08770751953125, 91.37337493896484, 413.31439208984375, 1.0532587766647339, 0.01952131651341915, 1.0398091077804565, 1.1808149814605713, 14.349365234375, 60.06782531738281, 1.0, 1.0, 403.08782958984375, 92.36048126220703, 413.5338439941406, 1.0475826263427734, 0.01952131651341915, 1.0396909713745117, 1.1812893152236938, 14.347736358642578, 60.06782531738281, 1.0, 1.0, 403.08770751953125, 91.37337493896484, 413.31439208984375, 1.0532587766647339, 0.01952131651341915, 1.0397086143493652, 1.2145733833312988, 14.347979545593262, 60.06782531738281, 1.0, 1.0, 949.9515991210938, 213.32156372070312, 973.6087646484375, 1.050938367843628, 0.4880329668521881, 1.0396573543548584, 1.2147802114486694, 14.347270965576172, 60.06782531738281, 1.0, 1.0, 949.951416015625, 212.32363891601562, 973.3905029296875, 1.0532587766647339, 0.4880329668521881, 1.039992094039917, -7.224976539611816, 14.35189151763916, 60.067893981933594, 1.0, 1.0, 24.249679565429688, 26.355003356933594, 35.81386947631836, 1.0442949533462524, 0.0976065844297409, 0.9837958216667175, -12.187467575073242, 226.27304077148438, 60.06795883178711, 1.0, 1.0, 177.82638549804688, 50.68052673339844, 184.90737915039062, 0.9971851706504822, -10.9668550491333, 229.3525848388672, 60.06793975830078, 1.0, 1.0, 160.8531951904297, 45.843162536621094, 167.25831604003906, 0.991413414478302, -12.416518211364746, 228.02508544921875, 60.06794357299805, 1.0, 1.0, 151.68692016601562, 43.230770111083984, 157.72703552246094, 0.9806153774261475, -14.327859878540039, 225.54153442382812, 60.06795120239258, 1.0, 1.0, 162.7008056640625, 46.369728088378906, 169.17950439453125, 0.9784167408943176, -13.308891296386719, 225.0358428955078, 60.067962646484375, 1.0, 1.0, 151.16688537597656, 43.08256530761719, 157.18630981445312, 0.9958642721176147, -11.120925903320312, 229.0487823486328, 60.06787872314453, 1.0, 1.0, 131.5943603515625, 37.50439453125, 136.83441162109375, 1.007678508758545, -9.767459869384766, 231.76605224609375, 60.067909240722656, 1.0, 1.0, 189.5947723388672, 54.034507751464844, 197.1443634033203, 0.9836382269859314, -14.815754890441895, 226.23680114746094, 60.06793212890625, 1.0, 1.0, 170.17945861816406, 48.50114440917969, 176.95594787597656, 1.015696406364441, -8.626688957214355, 233.61016845703125, 60.06792068481445, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0100878477096558, -7.307998180389404, 232.32022094726562, 60.06797790527344, 1.0, 1.0, 182.07655334472656, 51.891815185546875, 189.3267822265625, 0.9786984920501709, -11.651131629943848, 225.10064697265625, 60.0679817199707, 1.0, 1.0, 120.29206085205078, 34.283241271972656, 125.0820541381836, 0.9718076586723328, -14.673080444335938, 223.51576232910156, 60.067962646484375, 1.0, 1.0, 170.7500762939453, 48.66376876831055, 177.54928588867188, 1.0026206970214844, -8.662323951721191, 230.60276794433594, 60.06797409057617, 1.0, 1.0, 191.05572509765625, 54.45088577270508, 198.66351318359375, 0.9995940923690796, -10.444758415222168, 229.90664672851562, 60.06794357299805, 1.0, 1.0, 173.55760192871094, 49.46392059326172, 180.46861267089844, 0.9760640859603882, -15.654947280883789, 224.49473571777344, 60.067955017089844, 1.0, 1.0, 115.51586151123047, 32.922019958496094, 120.11566162109375, 1.00003182888031, -10.434828758239746, 230.00732421875, 60.06794738769531, 1.0, 1.0, 158.2788543701172, 45.109474182128906, 164.5814666748047, 0.9948155879974365, -11.997818946838379, 228.80758666992188, 60.06794738769531, 1.0, 1.0, 125.38717651367188, 35.735347747802734, 130.3800506591797, 0.9928232431411743, -12.045477867126465, 228.34933471679688, 60.067935943603516, 1.0, 1.0, 156.5443878173828, 44.615150451660156, 162.77793884277344, 0.9911818504333496, -9.581687927246094, 227.97183227539062, 60.068016052246094, 1.0, 1.0, 94.99187469482422, 27.07268524169922, 98.77442932128906, 0.9901022911071777, -11.980162620544434, 227.72352600097656, 60.06795120239258, 1.0, 1.0, 174.32342529296875, 49.68217849731445, 181.26492309570312, 0.9995917677879333, -11.395676612854004, 229.90609741210938, 60.06794738769531, 1.0, 1.0, 188.53834533691406, 53.73342514038086, 196.04588317871094, 1.0023176670074463, -10.689926147460938, 230.5330810546875, 60.06792449951172, 1.0, 1.0, 181.25819396972656, 51.6585807800293, 188.475830078125, 1.0132180452346802, -5.4859490394592285, 233.04014587402344, 60.06800079345703, 1.0, 1.0, 58.05577850341797, 16.545896530151367, 60.3675422668457, 1.0164763927459717, -8.557634353637695, 233.78956604003906, 60.067893981933594, 1.0, 1.0, 38.987152099609375, 11.111337661743164, 40.53961181640625, 0.9861965179443359, -16.922534942626953, 226.8251953125, 60.067955017089844, 1.0, 1.0, 155.9853515625, 44.45582580566406, 162.19664001464844, 1.008936882019043, -8.639190673828125, 232.0554962158203, 60.06789016723633, 1.0, 1.0, 191.15574645996094, 54.47938537597656, 198.76751708984375, 0.9851575493812561, -12.82718276977539, 226.5862274169922, 60.067955017089844, 1.0, 1.0, 126.65294647216797, 36.09608840942383, 131.69622802734375, 0.9921914339065552, -12.070662498474121, 228.2040252685547, 60.06795120239258, 1.0, 1.0, 136.79742431640625, 38.987266540527344, 142.24465942382812, 0.9921342730522156, -12.420470237731934, 228.1908721923828, 60.06794738769531, 1.0, 1.0, 144.54994201660156, 41.19673538208008, 150.30587768554688, 1.0092881917953491, -8.165298461914062, 232.1362762451172, 60.06784439086914, 1.0, 1.0, 151.8463592529297, 43.276214599609375, 157.89283752441406, 1.0218216180801392, -6.237546443939209, 235.0189666748047, 60.06783676147461, 1.0, 1.0, 165.69186401367188, 47.2221794128418, 172.28965759277344, 1.0247331857681274, -7.316287040710449, 235.68861389160156, 60.06782150268555, 1.0, 1.0, 197.01498413085938, 56.14927673339844, 204.8600616455078, 1.0145366191864014, -7.3514084815979, 233.34341430664062, 60.06783676147461, 1.0, 1.0, 156.41543579101562, 44.57839584350586, 162.6438446044922, 1.026824712753296, -5.555459976196289, 236.16969299316406, 60.06783676147461, 1.0, 1.0, 164.40492248535156, 46.855403900146484, 170.95147705078125, 1.0184416770935059, -7.064250469207764, 234.2415771484375, 60.06783676147461, 1.0, 1.0, 9.900075912475586, 2.821521282196045, 10.294293403625488, 1.0158724784851074, -7.865789413452148, 233.6506805419922, 60.06783676147461, 1.0, 1.0, 86.49138641357422, 24.65004539489746, 89.93544006347656, 1.0062650442123413, -9.273334503173828, 231.44094848632812, 60.06785202026367, 1.0, 1.0, 42.18327331542969, 12.022232055664062, 43.862998962402344, 0.9914049506187439, -12.603099822998047, 228.0231475830078, 60.06791305541992, 1.0, 1.0, 65.801025390625, 18.753292083740234, 68.42120361328125, 1.0227810144424438, -6.061768531799316, 235.2396240234375, 60.067840576171875, 1.0, 1.0, 184.61309814453125, 52.61473846435547, 191.96434020996094, 1.013026237487793, -7.428142547607422, 232.99603271484375, 60.067840576171875, 1.0, 1.0, 159.26397705078125, 45.390235900878906, 165.60581970214844, 0.9876154065132141, -13.02875804901123, 227.1515350341797, 60.06779479980469, 1.0, 1.0, 146.24172973632812, 41.67889404296875, 152.06503295898438, 0.9908792972564697, -12.593475341796875, 227.90223693847656, 60.06779479980469, 1.0, 1.0, 177.0760498046875, 50.466670989990234, 184.1271514892578, 0.9998502135276794, -12.390604972839355, 229.96556091308594, 60.06779098510742, 1.0, 1.0, 109.94050598144531, 31.333044052124023, 114.31830596923828, 0.9859843850135803, -12.52029037475586, 226.77639770507812, 60.06779479980469, 1.0, 1.0, 182.87522888183594, 52.119441986083984, 190.15725708007812, 1.0031846761703491, -12.056861877441406, 230.73248291015625, 60.06779098510742, 1.0, 1.0, 89.72119903564453, 25.570539474487305, 93.29386901855469, 0.988465428352356, -13.392748832702637, 227.34706115722656, 60.06779479980469, 1.0, 1.0, 171.68690490722656, 48.93077087402344, 178.52342224121094, 0.985815703868866, -13.0891695022583, 226.73760986328125, 60.06779479980469, 1.0, 1.0, 29.261188507080078, 8.339438438415527, 30.426361083984375, 1.012858271598816, -9.749472618103027, 232.95741271972656, 60.067806243896484, 1.0, 1.0, 195.84274291992188, 55.815189361572266, 203.64114379882812, 1.001330018043518, -11.18691349029541, 230.305908203125, 60.067806243896484, 1.0, 1.0, 152.1407470703125, 43.360111236572266, 158.19894409179688, 1.0057405233383179, -12.071880340576172, 231.32032775878906, 60.06779479980469, 1.0, 1.0, 175.0687713623047, 49.89459991455078, 182.0399627685547, 1.004116177558899, -11.252408027648926, 230.9467315673828, 60.06780242919922, 1.0, 1.0, 125.26960754394531, 35.701839447021484, 130.25779724121094, 1.0181740522384644, -8.217907905578613, 234.18002319335938, 60.06781005859375, 1.0, 1.0, 181.85592651367188, 51.82893753051758, 189.09738159179688, 1.0141932964324951, -11.006731033325195, 233.26446533203125, 60.06779861450195, 1.0, 1.0, 182.2145538330078, 51.931148529052734, 189.4702911376953, 1.0021668672561646, -10.814555168151855, 230.49838256835938, 60.06781005859375, 1.0, 1.0, 111.03437805175781, 31.644800186157227, 115.45573425292969, 1.0021249055862427, -11.329097747802734, 230.4887237548828, 60.067806243896484, 1.0, 1.0, 174.2488250732422, 49.66091537475586, 181.18734741210938, 1.0086791515350342, -9.3522310256958, 231.99620056152344, 60.06784439086914, 1.0, 1.0, 127.26315307617188, 36.27000045776367, 132.3307342529297, 0.9997900128364563, -12.476408958435059, 229.9517059326172, 60.06779861450195, 1.0, 1.0, 64.71812438964844, 18.444665908813477, 67.29518127441406, 1.0193750858306885, -7.965339183807373, 234.45628356933594, 60.06781768798828, 1.0, 1.0, 119.80976867675781, 34.145782470703125, 124.58055114746094, 1.0096765756607056, -11.141088485717773, 232.22561645507812, 60.06780242919922, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0074061155319214, -9.859888076782227, 231.7034149169922, 60.067813873291016, 1.0, 1.0, 130.0288848876953, 37.058231353759766, 135.20660400390625, 1.0099576711654663, -9.60440444946289, 232.29026794433594, 60.06781005859375, 1.0, 1.0, 163.77757263183594, 46.67660903930664, 170.2991485595703, 1.0118438005447388, -9.735085487365723, 232.7240753173828, 60.067806243896484, 1.0, 1.0, 182.19696044921875, 51.92613983154297, 189.45199584960938, 1.0121116638183594, -9.565183639526367, 232.78567504882812, 60.067806243896484, 1.0, 1.0, 190.7760467529297, 54.37116622924805, 198.3726806640625, 0.9914684295654297, -11.601922988891602, 228.03775024414062, 60.06803894042969, 1.0, 1.0, 113.97395324707031, 32.482574462890625, 118.51235961914062, 0.976170539855957, -15.316923141479492, 224.51922607421875, 60.06806564331055, 1.0, 1.0, 85.03752136230469, 24.235694885253906, 88.42369079589844, 0.9889861941337585, -13.518814086914062, 227.46682739257812, 60.06806564331055, 1.0, 1.0, 148.6482696533203, 42.36475372314453, 154.56739807128906, 0.9851589202880859, -12.482877731323242, 226.58656311035156, 60.06803512573242, 1.0, 1.0, 64.1366958618164, 18.278955459594727, 66.69059753417969, 0.9975913763046265, -12.505718231201172, 229.44601440429688, 60.06805419921875, 1.0, 1.0, 62.426212310791016, 17.791471481323242, 64.91200256347656, 1.0039100646972656, -11.638622283935547, 230.89932250976562, 60.06806182861328, 1.0, 1.0, 32.801937103271484, 9.348551750183105, 34.10810089111328, 0.9744933843612671, -15.56158447265625, 224.13348388671875, 60.06806564331055, 1.0, 1.0, 188.8105010986328, 53.81098937988281, 196.32887268066406, 0.9724769592285156, -15.831082344055176, 223.66969299316406, 60.06806564331055, 1.0, 1.0, 159.12620544433594, 45.35096740722656, 165.4625701904297, 0.9931516647338867, -12.04968547821045, 228.4248809814453, 60.06804656982422, 1.0, 1.0, 84.75081634521484, 24.153982162475586, 88.12556457519531, 0.9704626798629761, -16.158172607421875, 223.2064208984375, 60.06806564331055, 1.0, 1.0, 165.87240600585938, 47.27363204956055, 172.47738647460938, 0.9677713513374329, -16.561246871948242, 222.58741760253906, 60.06806564331055, 1.0, 1.0, 140.4801788330078, 40.03684997558594, 146.0740509033203, 0.9721583724021912, -16.208911895751953, 223.59642028808594, 60.06806945800781, 1.0, 1.0, 160.3898468017578, 45.71110534667969, 166.77651977539062, 0.9688244462013245, -16.716157913208008, 222.82962036132812, 60.06806945800781, 1.0, 1.0, 140.3931427001953, 40.012046813964844, 145.98355102539062, 0.9682549834251404, -16.55988121032715, 222.6986541748047, 60.06806564331055, 1.0, 1.0, 169.52174377441406, 48.313697814941406, 176.2720489501953, 0.9824839234352112, -14.967260360717773, 225.97129821777344, 60.06806945800781, 1.0, 1.0, 181.66273498535156, 51.77387619018555, 188.896484375, 0.9726176857948303, -16.111560821533203, 223.70205688476562, 60.06806945800781, 1.0, 1.0, 159.69244384765625, 45.51234817504883, 166.0513458251953, 0.9739628434181213, -16.06458282470703, 224.01145935058594, 60.06806945800781, 1.0, 1.0, 155.60540771484375, 44.34754180908203, 161.80157470703125, 0.9706493020057678, -16.278139114379883, 223.2493438720703, 60.06806945800781, 1.0, 1.0, 145.3006591796875, 41.41068649291992, 151.08648681640625, 0.9856076240539551, -11.631914138793945, 226.6897430419922, 60.06802749633789, 1.0, 1.0, 80.05044555664062, 22.814374923706055, 83.23802947998047, 0.9951075315475464, -8.883183479309082, 228.87472534179688, 60.06801223754883, 1.0, 1.0, 64.32295227050781, 18.332040786743164, 66.88426971435547, 0.9854458570480347, -11.45374584197998, 226.6525421142578, 60.068023681640625, 1.0, 1.0, 62.251644134521484, 17.741718292236328, 64.73048400878906, 1.0096182823181152, -9.001023292541504, 232.21221923828125, 60.06803894042969, 1.0, 1.0, 178.8817901611328, 50.98131561279297, 186.0048065185547, 0.9993000030517578, -11.966410636901855, 229.83900451660156, 60.06804275512695, 1.0, 1.0, 92.39799499511719, 26.33342933654785, 96.07725524902344, 0.9935845732688904, -12.903427124023438, 228.5244598388672, 60.06801986694336, 1.0, 1.0, 63.072208404541016, 17.97557830810547, 65.58372497558594, 0.9703337550163269, -17.783103942871094, 223.1767578125, 60.0679817199707, 1.0, 1.0, 172.75192260742188, 49.23429489135742, 179.630859375, 1.0172302722930908, -7.949493408203125, 233.9629669189453, 60.067874908447266, 1.0, 1.0, 194.3072509765625, 55.37757110595703, 202.0445098876953, 1.0186083316802979, -8.267461776733398, 234.2799072265625, 60.06788635253906, 0.0, 0.0, 0.0, 0.0, 0.0, 0.9995917677879333, -11.395676612854004, 229.90609741210938, 60.06794738769531, 1.0, 1.0, 0.0, 150.0, 0.9861965179443359, -16.922534942626953, 226.8251953125, 60.067955017089844, 1.0, 1.0, 0.0, 150.0, 0.9824839234352112, -14.967260360717773, 225.97129821777344, 60.06806945800781, 1.0, 1.0, 0.0, 150.0, 1.0, -1045.626953125, -479.5694580078125, 1150.3575439453125, 1286.827880859375, 1047.2664794921875, 593.3389282226562, 1203.6685791015625, 48421.08984375, 1.0, -158.7926788330078, -23.96912384033203, 160.59152221679688, 409.7596130371094, 160.23941040039062, 27.231733322143555, 162.53688049316406, 406.9366455078125, 1.0, -19.033708572387695, -26.711402893066406, 32.799102783203125, 83.68902587890625, 19.065649032592773, 22.89249038696289, 29.792030334472656, 75.5321044921875, 1.0, -48.57426452636719, -7.396627426147461, 49.134193420410156, 124.22913360595703, 48.70551681518555, 1.2830981016159058, 48.722415924072266, 122.64915466308594, 1.0, 210.85690307617188, 52.6647834777832, 217.33433532714844, 538.5590209960938, -209.55870056152344, -47.12626266479492, 214.79229736328125, 540.6975708007812, 1.0, -89.80884552001953, -28.067045211791992, 94.09244537353516, 238.23825073242188, 89.91436767578125, 27.301639556884766, 93.96794128417969, 237.1093292236328, 1.0, -61.47427749633789, -5.456958293914795, 61.71600341796875, 156.26242065429688, 61.53114318847656, 3.969956398010254, 61.65907669067383, 155.8966064453125, 1.0, -0.4038010537624359, -9.70676040649414, 9.715155601501465, 24.598379135131836, 0.4047154486179352, 8.288442611694336, 8.298317909240723, 20.995738983154297, 1.0, 123.54048156738281, 7.0985870361328125, 123.74425506591797, 316.7655029296875, -123.13460540771484, -7.390453815460205, 123.35619354248047, 317.2445373535156, 1.0, -286.2412414550781, -53.46831512451172, 291.1922302246094, 745.405517578125, 287.6770935058594, 61.621360778808594, 294.20281982421875, 744.368408203125, 1.0, 115.2361068725586, 15.620970726013184, 116.29004669189453, 298.3528747558594, -114.83631896972656, -16.274789810180664, 115.98382568359375, 299.5909118652344, 1.0, -217.70489501953125, -27.843626022338867, 219.4782257080078, 563.0916748046875, 220.3162384033203, 39.76377868652344, 223.87586975097656, 560.5084228515625, 1.0, -48.6981086730957, -30.85991096496582, 57.65275192260742, 147.91346740722656, 48.784156799316406, 28.258621215820312, 56.377685546875, 143.65248107910156, 1.0, -52.82291030883789, -21.296133041381836, 56.9542350769043, 143.56130981445312, 53.027854919433594, 14.101953506469727, 54.87092590332031, 136.68846130371094, 1.0, -78.77145385742188, -16.208261489868164, 80.42169952392578, 202.7144012451172, 79.14903259277344, 11.185651779174805, 79.9355239868164, 199.4063720703125, 1.0, 104.65245819091797, 18.473636627197266, 106.27046966552734, 264.7293701171875, -104.40187072753906, -19.647502899169922, 106.23452758789062, 266.05523681640625, 1.0, -347.27484130859375, -86.61780548095703, 357.9140625, 891.5963745117188, 347.5339660644531, 125.3923110961914, 369.4632568359375, 415.6231689453125, 1.0, -177.37103271484375, -17.795116424560547, 178.26145935058594, 454.91851806640625, 179.22952270507812, 23.713533401489258, 180.7914581298828, 452.77667236328125, 1.0, 104.1050033569336, -23.157184600830078, 106.64945983886719, 272.16656494140625, -103.56078338623047, 21.098148345947266, 105.68806457519531, 269.01348876953125, 1.0, -96.91343688964844, -7.5488457679748535, 97.20699310302734, 248.0696563720703, 97.44705963134766, 4.356880187988281, 97.5444107055664, 246.9805908203125, 1.0, -3.1565706729888916, -5.421573162078857, 6.273547172546387, 15.504608154296875, 3.157259941101074, -2.550025701522827, 4.058438301086426, 10.022433280944824, 1.0, 3.1565630435943604, 5.421572685241699, 6.273542881011963, 15.504598617553711, -3.153170108795166, -11.278474807739258, 11.710955619812012, 29.01999282836914, 1.0, 136.5358428955078, 22.665441513061523, 138.4043426513672, 343.9553527832031, -136.0598602294922, -22.61661148071289, 137.92677307128906, 345.3213806152344, 1.0, -318.61224365234375, -74.5625, 327.2206115722656, 813.1918334960938, 318.82598876953125, 103.89141845703125, 335.32586669921875, 377.4990539550781, 1.0, 136.86029052734375, -0.4890851676464081, 136.8611602783203, 351.0289001464844, -135.85110473632812, 1.2652220726013184, 135.85699462890625, 350.9241027832031, 1.0, -257.1523742675781, -33.79415512084961, 259.3634338378906, 665.229248046875, 261.7044677734375, 57.745521545410156, 267.99957275390625, 661.5264282226562, 1.0, 79.93733978271484, -33.65420150756836, 86.73282623291016, 224.03439331054688, -79.72515106201172, 31.8149356842041, 85.83873748779297, 220.75804138183594, 1.0, -435.5511779785156, -98.84015655517578, 446.6253662109375, 1118.19677734375, 435.958740234375, 155.6905517578125, 462.9250183105469, 521.2615356445312, 1.0, -1.292398452758789, -3.9080915451049805, 4.116244792938232, 10.336870193481445, 1.292569875717163, 0.6435385346412659, 1.443910837173462, 3.6244163513183594, 1.0, 173.10763549804688, 48.030296325683594, 179.64732360839844, 445.1698303222656, -172.26519775390625, -45.55582809448242, 178.18707275390625, 447.4701232910156, 1.0, 87.34387969970703, -57.346500396728516, 104.48719787597656, 268.71771240234375, -86.9909439086914, 55.90629577636719, 103.40666961669922, 263.2065124511719, 1.0, 209.723388671875, 47.52808380126953, 215.0414276123047, 539.7838134765625, -208.86671447753906, -43.81798553466797, 213.4134979248047, 541.0698852539062, 1.0, 185.5391845703125, 49.72340774536133, 192.08645629882812, 475.9942626953125, -184.64739990234375, -46.64054489135742, 190.44683837890625, 478.0479736328125, 1.0, 185.5391845703125, 49.72340774536133, 192.08645629882812, 475.9942626953125, -184.64739990234375, -46.64054489135742, 190.44683837890625, 478.0479736328125, 1.0, -215.30148315429688, -63.036983489990234, 224.3398895263672, 566.0769653320312, 215.6623992919922, 64.68421173095703, 225.15399169921875, 565.4165649414062, 1.0, -169.50131225585938, -41.18848419189453, 174.43389892578125, 441.03240966796875, 170.1217041015625, 42.98439407348633, 175.4680938720703, 439.44476318359375, 1.0, -76.4256820678711, -3.991478443145752, 76.52983856201172, 194.91188049316406, 76.81170654296875, -1.4546033143997192, 76.82547760009766, 194.56443786621094, 1.0, -171.80357360839844, -25.61808204650879, 173.70306396484375, 439.911865234375, 173.89659118652344, 31.483734130859375, 176.72364807128906, 436.22222900390625, 1.0, 15.477646827697754, -28.756689071655273, 32.65738296508789, 82.79666900634766, -15.465904235839844, 27.399808883666992, 31.46337127685547, 79.60150909423828, 1.0, 297.79107666015625, 135.87088012695312, 327.3230895996094, 821.9880981445312, -297.1591796875, -132.13356018066406, 325.2120056152344, 822.7779541015625, 1.0, 216.9197540283203, 58.307151794433594, 224.6194610595703, 564.07421875, -216.31585693359375, -55.55326843261719, 223.33543395996094, 565.0654296875, 1.0, 216.9197540283203, 58.307151794433594, 224.6194610595703, 564.07421875, -216.31585693359375, -55.55326843261719, 223.33543395996094, 565.0654296875, 1.0, -567.9154052734375, -110.51998901367188, 578.5694580078125, 1452.928955078125, 568.5936279296875, 181.93035888671875, 596.990234375, 672.413818359375, 1.0, -567.9154052734375, -110.51998901367188, 578.5694580078125, 1452.928955078125, 568.5936279296875, 181.93035888671875, 596.990234375, 672.413818359375, 1.0, -426.207275390625, -98.71723175048828, 437.4902648925781, 1095.65673828125, 426.5965881347656, 149.1029510498047, 451.90301513671875, 509.46124267578125, 1.0, -170.34141540527344, -24.830738067626953, 172.14169311523438, 434.23779296875, 171.83428955078125, 28.855815887451172, 174.24029541015625, 431.6753234863281, 1.0, -229.8900604248047, -45.40171432495117, 234.3304443359375, 580.5469360351562, 230.2517547607422, 47.066585540771484, 235.0130615234375, 580.10302734375, 1.0, 29.68898582458496, -5.3937249183654785, 30.174959182739258, 74.46273040771484, -29.644987106323242, -1.2424516677856445, 29.671010971069336, 73.27344512939453, 1.0, 12.509270668029785, -0.8768780827522278, 12.539966583251953, 30.903005599975586, -12.499428749084473, -7.318861484527588, 14.484524726867676, 35.769962310791016, 1.0, -34.42957305908203, -31.71446990966797, 46.81028747558594, 121.0965347290039, 34.56639099121094, 24.427263259887695, 42.3264274597168, 107.7357177734375, 1.0, -331.7721862792969, -60.338172912597656, 337.21429443359375, 838.983642578125, 332.0186767578125, 143.71343994140625, 361.7871398925781, 405.3561706542969, 1.0, -140.1060333251953, -5.664785861968994, 140.2205047607422, 350.509521484375, 140.61744689941406, 5.831558704376221, 140.73831176757812, 350.1546325683594, 1.0, -175.43710327148438, -64.3547134399414, 186.86814880371094, 476.1471252441406, 175.8277130126953, 65.7464599609375, 187.7178192138672, 474.9212341308594, 1.0, 49.31631851196289, -2.54740309715271, 49.3820686340332, 122.81902313232422, -49.18228530883789, -3.9436683654785156, 49.34014129638672, 123.08341979980469, 1.0, -152.66197204589844, -31.613861083984375, 155.90097045898438, 387.74407958984375, 153.5113525390625, 32.8321647644043, 156.9830780029297, 385.28466796875, 1.0, -48.500709533691406, -9.114950180053711, 49.34978485107422, 122.73873138427734, 48.59196853637695, 4.57922887802124, 48.8072624206543, 120.94148254394531, 1.0, 24.94395637512207, -3.505183696746826, 25.18903160095215, 61.87965774536133, -24.892471313476562, -7.774384498596191, 26.078269958496094, 64.27678680419922, 1.0, -25.92365264892578, -5.283658981323242, 26.456621170043945, 64.99363708496094, 25.935365676879883, 2.9420864582061768, 26.10170555114746, 64.06159973144531, 1.0, 165.3711700439453, 39.79716873168945, 170.0924530029297, 413.6258544921875, -164.71212768554688, -38.4333381652832, 169.13665771484375, 415.5030212402344, 1.0, 28.766944885253906, 16.029237747192383, 32.93134689331055, 80.66966247558594, -28.704463958740234, -22.91922378540039, 36.73196029663086, 90.76458740234375, 1.0, -109.17858123779297, -26.72407341003418, 112.40168762207031, 280.0784912109375, 109.92224884033203, 23.83254623413086, 112.47618103027344, 275.52520751953125, 1.0, -335.7041931152344, -96.01119232177734, 349.1639404296875, 855.322998046875, 335.9365234375, 114.91226196289062, 355.0467224121094, 393.5465087890625, 1.0, 142.1175994873047, 32.90696334838867, 145.87762451171875, 356.6185302734375, -141.43814086914062, -32.617210388183594, 145.15036010742188, 359.13848876953125, 1.0, -14.97729206085205, -11.961186408996582, 19.167400360107422, 47.42496871948242, 14.992406845092773, 4.952863693237305, 15.789336204528809, 38.916988372802734, 1.0, 130.97210693359375, 15.361735343933105, 131.8699188232422, 322.37469482421875, -130.20883178710938, -16.195188522338867, 131.21212768554688, 324.224853515625, 1.0, -218.74728393554688, -47.562049865722656, 223.85826110839844, 547.2532348632812, 219.21754455566406, 49.53908157348633, 224.74530029296875, 546.529052734375, 1.0, -218.74728393554688, -47.562049865722656, 223.85826110839844, 547.2532348632812, 219.21754455566406, 49.53908157348633, 224.74530029296875, 546.529052734375, 1.0, 72.42192840576172, 14.464366912841797, 73.85224151611328, 182.48870849609375, -72.1500244140625, -19.264217376708984, 74.67755126953125, 186.2898712158203, 1.0, 164.29080200195312, 25.612207412719727, 166.27523803710938, 415.6385803222656, -163.24807739257812, -23.11017608642578, 164.87576293945312, 417.4622802734375, 1.0, 208.62261962890625, 53.09297561645508, 215.2725372314453, 528.3449096679688, -207.85595703125, -49.96946334838867, 213.7780303955078, 529.7291870117188, 1.0, -411.444580078125, -102.06925964355469, 423.916015625, 1040.4200439453125, 411.79559326171875, 147.63067626953125, 437.45904541015625, 483.7250671386719, 1.0, 161.8101043701172, 40.486141204833984, 166.79820251464844, 405.614990234375, -161.2375946044922, -39.420196533203125, 165.98648071289062, 407.38177490234375, 1.0, -81.3917007446289, -23.062082290649414, 84.59591674804688, 215.0171356201172, 81.48902893066406, 22.049869537353516, 84.41954040527344, 213.862060546875, 1.0, 29.974897384643555, 21.50625991821289, 36.89191818237305, 92.62065124511719, -29.88486671447754, -28.407575607299805, 41.232215881347656, 104.79977416992188, 1.0, 35.01148986816406, -13.674933433532715, 37.58734130859375, 95.69364929199219, -34.96516799926758, 9.790759086608887, 36.310081481933594, 92.2892074584961, 1.0, -66.16228485107422, -3.619210720062256, 66.26119995117188, 168.27102661132812, 66.29277038574219, 0.8237257599830627, 66.29788970947266, 167.95404052734375, 1.0, -324.8555908203125, -73.38580322265625, 333.0414733886719, 843.7020263671875, 325.136474609375, 202.35955810546875, 382.9662170410156, 432.7298583984375, 1.0, -139.9154052734375, -52.83930587768555, 149.56039428710938, 375.4855041503906, 140.708984375, 53.72013854980469, 150.61497497558594, 371.271240234375, 1.0, 37.013511657714844, -6.649375915527344, 37.606040954589844, 95.74125671386719, -36.96205520629883, 2.4418461322784424, 37.042625427246094, 94.322998046875, 1.0, -254.8970489501953, -31.854677200317383, 256.8797912597656, 653.990478515625, 255.0908966064453, 186.54185485839844, 316.02093505859375, 359.4867248535156, 1.0, 98.24467468261719, 43.584712982177734, 107.47856903076172, 268.938232421875, -97.83148193359375, -45.224117279052734, 107.778564453125, 273.7048034667969, 1.0, -187.96588134765625, -69.1552505493164, 200.28384399414062, 501.16021728515625, 188.8422393798828, 72.44681549072266, 202.2620391845703, 498.58306884765625, 1.0, -7.693126201629639, -0.08744149655103683, 7.6936235427856445, 19.53803825378418, 7.700873374938965, -10.781282424926758, 13.24913215637207, 33.736751556396484, 1.0, 125.2371826171875, 22.384071350097656, 127.22184753417969, 315.3004150390625, -124.74915313720703, -22.99481773376465, 126.85074615478516, 317.1177673339844, 1.0, -0.6541146039962769, 4.559537887573242, 4.606218338012695, 11.415827751159668, 0.6550032496452332, -7.740128040313721, 7.76779317855835, 19.270620346069336, 1.0, -320.42535400390625, -82.77070617675781, 330.9432067871094, 820.1934814453125, 320.6494140625, 128.5850830078125, 345.470947265625, 386.4698791503906, 1.0, -18.626218795776367, -2.9359898567199707, 18.85619354248047, 47.27029800415039, 18.643198013305664, -3.375882625579834, 18.946382522583008, 47.45672607421875, 1.0, 12.533992767333984, -7.731389045715332, 14.726688385009766, 36.91810607910156, -12.528953552246094, 4.340717315673828, 13.259581565856934, 33.21387481689453, 1.0, -146.04852294921875, -32.692726135253906, 149.66290283203125, 375.1875915527344, 146.67999267578125, 33.42671203613281, 150.44056701660156, 373.11962890625, 1.0, -86.0138168334961, -26.32514190673828, 89.95215606689453, 224.51075744628906, 86.26818084716797, 23.841415405273438, 89.50202178955078, 221.52545166015625, 1.0, 19.782060623168945, 8.830560684204102, 21.66353416442871, 54.06981658935547, -19.752151489257812, -15.88209342956543, 25.345380783081055, 63.635807037353516, 1.0, -108.8370361328125, -32.40001678466797, 113.55730438232422, 283.4266357421875, 109.31732940673828, 30.716350555419922, 113.55075073242188, 279.9066162109375, 1.0, 9.31351375579834, 8.7786865234375, 12.7987060546875, 31.995847702026367, -9.308879852294922, -11.909868240356445, 15.116223335266113, 37.864566802978516, 1.0, -9.833945274353027, -21.485706329345703, 23.629262924194336, 59.07146072387695, 9.851369857788086, 16.502336502075195, 19.21917152404785, 47.78195571899414, 1.0, 175.481201171875, 33.39568328857422, 178.6306915283203, 440.39825439453125, -174.84898376464844, -31.64486312866211, 177.6895294189453, 441.6418151855469, 1.0, -178.66856384277344, -42.612308502197266, 183.67979431152344, 452.84637451171875, 179.29551696777344, 44.435489654541016, 184.7197723388672, 451.31414794921875, 1.0, -178.66856384277344, -42.612308502197266, 183.67979431152344, 452.84637451171875, 179.29551696777344, 44.435489654541016, 184.7197723388672, 451.31414794921875, 1.0, 9.863213539123535, 10.89889907836914, 14.699284553527832, 36.38203430175781, -9.851372718811035, -16.502338409423828, 19.219175338745117, 47.78196334838867, 1.0, -278.34588623046875, -86.67377471923828, 291.5283203125, 721.5585327148438, 278.51300048828125, 105.4388656616211, 297.8033752441406, 333.7945861816406, 1.0, -129.67758178710938, -28.268918991088867, 132.72305297851562, 332.4435119628906, 131.02146911621094, 27.372303009033203, 133.8501739501953, 327.0276794433594, 1.0, 45.09223175048828, -4.70079231262207, 45.33659362792969, 113.5634536743164, -44.96596908569336, -2.5625722408294678, 45.0389289855957, 113.081298828125, 1.0, -197.5032196044922, -37.3909797668457, 201.01145935058594, 503.5128173828125, 198.3292236328125, 40.54682159423828, 202.43153381347656, 502.199462890625, 1.0, -66.11842346191406, -21.190608978271484, 69.4311752319336, 172.7877655029297, 66.37089538574219, 15.612991333007812, 68.18255615234375, 167.90003967285156, 1.0, -61.14471435546875, -15.079392433166504, 62.9766960144043, 156.72503662109375, 61.36946105957031, 8.74343490600586, 61.98918151855469, 152.97067260742188, 1.0, -186.18067932128906, -49.75876998901367, 192.7152862548828, 474.5627746582031, 186.71670532226562, 51.518253326416016, 193.6937255859375, 473.2396240234375, 1.0, -20.850299835205078, -10.334157943725586, 23.270793914794922, 57.98533248901367, 20.866289138793945, 6.149233341217041, 21.753507614135742, 54.06767272949219, 1.0, -9.794846534729004, -21.180978775024414, 23.33608627319336, 58.001121520996094, 9.801850318908691, 19.343563079833984, 21.68524169921875, 53.78329086303711, 1.0, -30.39464569091797, 0.6493113040924072, 30.401578903198242, 75.42133331298828, 30.407245635986328, -2.4232144355773926, 30.50364875793457, 75.65452575683594, 1.0, -350.7861022949219, -85.39373779296875, 361.0304260253906, 895.6572875976562, 351.05120849609375, 133.7404327392578, 375.66400146484375, 420.40570068359375, 1.0, -377.6649169921875, -104.72381591796875, 391.9156494140625, 972.0211181640625, 377.97052001953125, 142.31732177734375, 403.8761291503906, 451.3686218261719, 1.0, 22.065338134765625, -11.029569625854492, 24.668411254882812, 62.45595169067383, -22.039203643798828, 5.2219624519348145, 22.64940071105957, 57.24699401855469, 1.0, 3.638078451156616, 12.502481460571289, 13.02104663848877, 32.9669303894043, -3.6247568130493164, -18.82289695739746, 19.168733596801758, 48.820350646972656, 1.0, -139.6773681640625, -33.95548629760742, 143.7454071044922, 363.93731689453125, 140.65858459472656, 34.778404235839844, 144.8943634033203, 360.2514953613281, 1.0, -112.930419921875, -29.903926849365234, 116.82261657714844, 300.40887451171875, 113.48322296142578, 28.9212703704834, 117.11055755615234, 297.2469177246094, 1.0, 27.89288902282715, 5.66823148727417, 28.462993621826172, 73.19247436523438, -27.87449836730957, -8.17159366607666, 29.047592163085938, 74.8243179321289, 1.0, 140.78469848632812, 36.29857635498047, 145.38885498046875, 369.0221252441406, -139.63084411621094, -34.67971420288086, 143.873046875, 373.1799011230469, 1.0, -201.45809936523438, -53.792301177978516, 208.51612854003906, 529.2501220703125, 203.254150390625, 61.25501251220703, 212.28384399414062, 525.5969848632812, 1.0, -201.45809936523438, -53.792301177978516, 208.51612854003906, 529.2501220703125, 203.254150390625, 61.25501251220703, 212.28384399414062, 525.5969848632812, 1.0, -21.154870986938477, -20.452106475830078, 29.424774169921875, 74.97532653808594, 21.196746826171875, 13.677725791931152, 25.22661781311035, 63.76097869873047, 1.0, -42.98181915283203, 2.1731512546539307, 43.03672409057617, 109.6590347290039, 43.090145111083984, -8.49488639831543, 43.91951370239258, 111.87583923339844, 1.0, -37.96611404418945, -13.3997220993042, 40.261375427246094, 101.30886840820312, 38.05569839477539, 6.432155609130859, 38.59545135498047, 96.50566864013672, 1.0, -24.460094451904297, -4.391748905181885, 24.85123062133789, 62.53263854980469, 24.4926815032959, -2.4277894496917725, 24.612712860107422, 61.82656478881836, 1.0, 134.4165802001953, 37.47373962402344, 139.54246520996094, 348.9177551269531, -132.87713623046875, -36.468875885009766, 137.79083251953125, 355.67431640625, 1.0, -205.27420043945312, -53.25444793701172, 212.06964111328125, 530.2677612304688, 206.0233917236328, 56.35133361816406, 213.5909881591797, 528.8333740234375, 1.0, 26.268579483032227, 5.947605133056641, 26.93347930908203, 69.37853240966797, -26.249080657958984, -8.88209056854248, 27.711111068725586, 71.5296630859375, 1.0, 132.6741943359375, 32.436222076416016, 136.5816650390625, 351.82366943359375, -132.4615478515625, -32.256309509277344, 136.3324432373047, 352.6402587890625, 1.0, 132.6741943359375, 32.436222076416016, 136.5816650390625, 351.82366943359375, -132.4615478515625, -32.256309509277344, 136.3324432373047, 352.6402587890625, 1.0, 97.98509979248047, 16.03008270263672, 99.28768157958984, 255.7572784423828, -97.8040542602539, -16.888452529907227, 99.25146484375, 256.676513671875, 1.0, -550.5371704101562, -132.51473999023438, 566.2608642578125, 1458.6435546875, 551.25244140625, 248.33303833007812, 604.6060791015625, 690.532470703125, 1.0, -83.90837097167969, -43.05367660522461, 94.30924224853516, 238.36924743652344, 84.38805389404297, 39.23141098022461, 93.0615234375, 230.4125213623047, 1.0, 99.0507583618164, 17.238994598388672, 100.53971862792969, 260.0580749511719, -98.94770812988281, -17.681499481201172, 100.51509857177734, 260.58721923828125, 1.0, -0.8493020534515381, -5.357134819030762, 5.424039840698242, 14.068948745727539, 0.8496195077896118, 3.6110920906066895, 3.709695339202881, 9.617452621459961, 1.0, 63.4000358581543, 14.004068374633789, 64.92826080322266, 167.65182495117188, -63.31410217285156, -15.743766784667969, 65.24217987060547, 169.04209899902344, 1.0, 71.50411224365234, 33.32450866699219, 78.88827514648438, 203.6981201171875, -71.42355346679688, -34.2432975769043, 79.2081298828125, 205.3485107421875, 1.0, -295.2939758300781, -93.0396728515625, 309.60443115234375, 799.4323120117188, 296.3367004394531, 99.18121337890625, 312.4937744140625, 798.4127197265625, 1.0, -77.07902526855469, -24.268280029296875, 80.80918884277344, 209.3761444091797, 77.21968078613281, 22.754444122314453, 80.50244903564453, 207.48095703125, 1.0, 207.8975372314453, 72.31043243408203, 220.11402893066406, 562.3850708007812, -207.21522521972656, -69.14417266845703, 218.4469451904297, 563.7874145507812, 1.0, 233.5364227294922, 70.72879791259766, 244.01193237304688, 623.443603515625, -232.82505798339844, -67.10198974609375, 242.3018341064453, 624.4905395507812, 1.0, -459.7155456542969, -74.63056182861328, 465.73394775390625, 1189.93701171875, 460.1951599121094, 180.3291473388672, 494.26531982421875, 565.4712524414062, 1.0, -459.7155456542969, -74.63056182861328, 465.73394775390625, 1189.93701171875, 460.1951599121094, 180.3291473388672, 494.26531982421875, 565.4712524414062, 1.0, 47.522850036621094, 23.631820678710938, 53.07432556152344, 136.9789581298828, -47.496604919433594, -24.522232055664062, 53.45341491699219, 138.2371063232422, 1.0, -105.34178161621094, -9.246829986572266, 105.74684143066406, 269.36810302734375, 106.0184555053711, 6.498698711395264, 106.21744537353516, 267.9399108886719, 1.0, -319.5396728515625, -85.77884674072266, 330.8528747558594, 822.6009521484375, 319.7733459472656, 148.9794921875, 352.7745361328125, 394.6685791015625, 1.0, -116.89068603515625, -23.905641555786133, 119.31015014648438, 299.704345703125, 117.54689025878906, 22.434906005859375, 119.668701171875, 296.7286071777344, 1.0, 140.0491180419922, 19.19443130493164, 141.3583526611328, 357.1315002441406, -138.32235717773438, -17.519824981689453, 139.42745971679688, 360.69384765625, 1.0, -203.12132263183594, -37.170005798339844, 206.4942626953125, 521.692626953125, 204.76454162597656, 43.85088348388672, 209.40728759765625, 519.2429809570312, 1.0, 12.51996898651123, -9.073266983032227, 15.462011337280273, 38.15559768676758, -12.509270668029785, 0.8768771886825562, 12.539966583251953, 30.903003692626953, 1.0, -297.8849182128906, -49.6761589050293, 301.99859619140625, 745.2417602539062, 298.0763244628906, 116.80329895019531, 320.14453125, 357.2282409667969, 1.0, -596.0468139648438, -91.32180786132812, 603.0020751953125, 674.8197631835938, 596.24951171875, 80.79959106445312, 601.6993408203125, 672.4541625976562, 1.0, -244.93751525878906, 18.376361846923828, 245.62588500976562, 274.7756652832031, 244.99574279785156, -42.41862487792969, 248.6408233642578, 278.2539978027344, 1.0, 204.09368896484375, 18.157140731811523, 204.89976501464844, 229.66305541992188, -203.8800506591797, -130.55838012695312, 242.10032653808594, 273.5594787597656, 1.0, 482.3711853027344, -19.656274795532227, 482.7715148925781, 540.0646362304688, -481.72369384765625, -40.072547912597656, 483.3875427246094, 541.8076782226562, 1.0, 0.8892138004302979, 14.532505989074707, 14.559684753417969, 16.274995803833008, -0.8828941583633423, -83.5234603881836, 83.52812194824219, 93.62297058105469, 1.0, -591.7670288085938, -153.679443359375, 611.3964233398438, 685.0252075195312, 593.396728515625, 67.13392639160156, 597.1822509765625, 660.3406982421875, 1.0, 1006.0924682617188, 209.9351348876953, 1027.7620849609375, 1131.152587890625, -1005.192138671875, -214.76458740234375, 1027.87890625, 1136.5882568359375, 1.0, -304.2166442871094, 26.562551498413086, 305.37408447265625, 340.65618896484375, 304.4935302734375, -97.084716796875, 319.5962219238281, 357.5501708984375, 1.0, 778.1309204101562, -66.18463897705078, 780.9405517578125, 873.5857543945312, -775.4238891601562, 5.053002834320068, 775.4403686523438, 867.5284423828125, 1.0, -151.0561981201172, -57.571983337402344, 161.655517578125, 180.97972106933594, 151.15701293945312, -56.94776916503906, 161.5286102294922, 180.71107482910156, 1.0, -245.26612854003906, -34.33268737792969, 247.65744018554688, 279.2012023925781, 245.38247680664062, -12.797800064086914, 245.71597290039062, 276.7596740722656, 1.0, -181.3304443359375, -114.77025604248047, 214.5994873046875, 241.93270874023438, 181.3701934814453, 92.1106948852539, 203.41958618164062, 228.8343963623047, 1.0, -255.09085083007812, -186.54185485839844, 316.0209045410156, 359.4866943359375, 255.2559356689453, 145.35633850097656, 293.7414855957031, 331.9110107421875, 1.0, 376.94970703125, 162.586669921875, 410.5185852050781, 458.88275146484375, -376.51220703125, -217.1575164794922, 434.64794921875, 491.12725830078125, 1.0, 235.2797393798828, -13.560131072998047, 235.67018127441406, 265.30987548828125, -235.22291564941406, -11.718629837036133, 235.5146484375, 265.19354248046875, 1.0, 555.2725830078125, 16.84109115600586, 555.5278930664062, 621.4317626953125, -554.105712890625, -90.3312759399414, 561.42041015625, 632.0289916992188, 1.0, 234.95767211914062, 59.518104553222656, 242.3788604736328, 276.8256530761719, -234.8985137939453, -82.12152862548828, 248.83981323242188, 284.688720703125, 1.0, -685.4917602539062, -278.5367431640625, 739.9200439453125, 846.5159912109375, 687.7537231445312, 218.5601806640625, 721.6465454101562, 805.023681640625, 1.0, 976.1278686523438, 211.56654357910156, 998.792236328125, 1104.4232177734375, -974.2198486328125, -223.1168670654297, 999.442626953125, 1116.96875, 1.0, 347.267822265625, -55.02444839477539, 351.60009765625, 395.90777587890625, -346.8282775878906, -29.577117919921875, 348.0871276855469, 392.0643615722656, 1.0, 472.7891540527344, 201.69422912597656, 514.0137329101562, 574.0078735351562, -472.33270263671875, -236.1240997314453, 528.0651245117188, 594.7807006835938, 1.0, 565.4396362304688, -37.631343841552734, 566.6904907226562, 633.9186401367188, -563.40869140625, -85.3616714477539, 569.8385009765625, 641.831787109375, 1.0, 269.70166015625, 28.438934326171875, 271.1968994140625, 302.6108093261719, -269.37371826171875, -130.62677001953125, 299.3752746582031, 336.778564453125, 1.0, 259.7484130859375, 9.966002464294434, 259.93951416015625, 291.2433166503906, -259.5303649902344, -86.87623596191406, 273.6850280761719, 307.8786315917969, 1.0, -786.2100830078125, -307.85113525390625, 844.333251953125, 964.3295288085938, 788.6063842773438, 271.66192626953125, 834.08642578125, 930.45458984375, 1.0, 569.6463012695312, 29.888952255249023, 570.4298706054688, 627.8138427734375, -567.7780151367188, -145.2422332763672, 586.0607299804688, 653.9467163085938, 1.0, -558.0830078125, -127.30520629882812, 572.4187622070312, 640.3508911132812, 559.2803344726562, 51.855133056640625, 561.6791381835938, 622.5852661132812, 1.0, -133.69277954101562, -73.09996795654297, 152.37245178222656, 168.8950958251953, 133.7423095703125, 3.5493690967559814, 133.78939819335938, 147.9387969970703, 1.0, 763.3927612304688, 44.4119987487793, 764.68359375, 841.6090087890625, -761.5240478515625, -93.66744995117188, 767.2630004882812, 850.4617919921875, 1.0, 549.2891845703125, 5.439602851867676, 549.3161010742188, 614.4830932617188, -548.003662109375, -88.9474868774414, 555.1753540039062, 625.1370239257812, 1.0, -344.93988037109375, -134.54324340820312, 370.2504577636719, 413.4649963378906, 345.4512023925781, 177.2877960205078, 388.28790283203125, 15638.0341796875, 1.0, -229.35157775878906, -91.42032623291016, 246.9004364013672, 275.7179260253906, 229.6937713623047, 119.9298324584961, 259.1184997558594, 10431.5556640625, 1.0, -650.99072265625, -259.4872131347656, 700.8013305664062, 782.5968017578125, 651.9619750976562, 340.4084777832031, 735.4810791015625, 29608.892578125, 1.0, -335.5620422363281, -152.14874267578125, 368.4441833496094, 411.8514709472656, 336.0935974121094, 181.0344696044922, 381.7491149902344, 15353.3291015625, 1.0, -335.5620422363281, -152.14874267578125, 368.4441833496094, 411.8514709472656, 336.0935974121094, 181.0344696044922, 381.7491149902344, 15353.3291015625, 1.0, -145.79776000976562, -64.03003692626953, 159.23828125, 177.99853515625, 146.0261993408203, 76.48001861572266, 164.8418731689453, 6634.41015625, 1.0, -330.45269775390625, 1110.961669921875, 1159.06640625, 1296.56982421875, 335.1539611816406, -906.886474609375, 966.835693359375, 47282.12890625, 1.0, -347.176025390625, -138.0277557373047, 373.6078796386719, 417.9300842285156, 347.69451904296875, 174.79122924804688, 389.1573486328125, 15702.052734375, 1.0, -347.176025390625, -138.0277557373047, 373.6078796386719, 417.9300842285156, 347.69451904296875, 174.79122924804688, 389.1573486328125, 15702.052734375, 1.0, -1044.0069580078125, -479.68792724609375, 1148.9346923828125, 1285.2362060546875, 1045.6424560546875, 593.3015747070312, 1202.2374267578125, 48363.51953125, 1.0, -224.12258911132812, -55.3364143371582, 230.85289001464844, 255.267578125, 224.4136962890625, 74.31985473632812, 236.3999786376953, 9510.1494140625, 1.0, -224.12258911132812, -55.3364143371582, 230.85289001464844, 255.267578125, 224.4136962890625, 74.31985473632812, 236.3999786376953, 9510.1494140625, 1.0, -669.2103881835938, -166.4221649169922, 689.59326171875, 762.5237426757812, 670.0804443359375, 223.1372833251953, 706.25634765625, 28409.63671875, 1.0, -669.2103881835938, -166.4221649169922, 689.59326171875, 762.5237426757812, 670.0804443359375, 223.1372833251953, 706.25634765625, 28409.63671875, 1.0, -342.0416259765625, -145.62442016601562, 371.7511901855469, 414.70233154296875, 342.5487060546875, 176.9272003173828, 385.5422668457031, 15509.548828125, 1.0, -342.0416259765625, -145.62442016601562, 371.7511901855469, 414.70233154296875, 342.5487060546875, 176.9272003173828, 385.5422668457031, 15509.548828125, 1.0, -342.0416259765625, -145.62442016601562, 371.7511901855469, 414.70233154296875, 342.5487060546875, 176.9272003173828, 385.5422668457031, 15509.548828125, 1.0, -337.6508483886719, -145.94107055664062, 367.8408508300781, 410.3401794433594, 338.1475830078125, 176.8303680419922, 381.5924072265625, 15350.6533203125, 1.0, -505.81591796875, -218.62620544433594, 551.0418701171875, 614.7078247070312, 506.56005859375, 264.8997497558594, 571.642333984375, 22995.958984375, 1.0, -171.47998046875, -69.11807250976562, 184.8856201171875, 206.9867401123047, 171.74623107910156, 100.45034790039062, 198.9649200439453, 8008.841796875, 1.0, -402.5943298339844, -67.76607513427734, 408.2578125, 449.3276062011719, 403.0900573730469, 91.37237548828125, 413.31646728515625, 16631.779296875, 1.0, -402.5935974121094, -68.73594665527344, 408.419189453125, 449.5052185058594, 403.0897216796875, 92.3587417602539, 413.5353088378906, 16638.6953125, 1.0, -402.5943298339844, -67.76607513427734, 408.2578125, 449.3276062011719, 403.0900573730469, 91.37237548828125, 413.31646728515625, 16631.779296875, 1.0, -948.774169921875, -157.264404296875, 961.7195434570312, 1058.4664306640625, 949.9556884765625, 213.31900024414062, 973.6122436523438, 39177.3125, 1.0, -948.7745361328125, -156.2832489013672, 961.5599975585938, 1058.290771484375, 949.9556884765625, 212.3213348388672, 973.3941040039062, 39170.46875, 1.0, -24.18471336364746, -19.949052810668945, 31.350679397583008, 78.36737060546875, 24.24958610534668, 26.354984283447266, 35.81378936767578, 1440.72314453125, 1.0, -348.459716796875, -109.05159759521484, 365.125244140625, 904.0194091796875, 348.7245178222656, 142.31491088867188, 376.64617919921875, 420.1628723144531, 1.0, -348.459716796875, -109.05159759521484, 365.125244140625, 904.0194091796875, 348.7245178222656, 142.31491088867188, 376.64617919921875, 420.1628723144531, 1.0, -338.1643981933594, -83.88566589355469, 348.41351318359375, 851.2567138671875, 338.3983459472656, 114.18812561035156, 357.1447448730469, 394.9158935546875, 1.0, -338.1643981933594, -83.88566589355469, 348.41351318359375, 851.2567138671875, 338.3983459472656, 114.18812561035156, 357.1447448730469, 394.9158935546875, 1.0, -375.9446105957031, -94.4416732788086, 387.62554931640625, 960.5442504882812, 376.2470703125, 141.86129760742188, 402.1025695800781, 449.0347595214844, 1.0, -375.9446105957031, -94.4416732788086, 387.62554931640625, 960.5442504882812, 376.2470703125, 141.86129760742188, 402.1025695800781, 449.0347595214844, 1.0, -332.9261474609375, -68.15499114990234, 339.8307189941406, 838.83349609375, 333.15435791015625, 102.91262817382812, 348.6872863769531, 390.0531005859375, 1.0, -332.9261474609375, -68.15499114990234, 339.8307189941406, 838.83349609375, 333.15435791015625, 102.91262817382812, 348.6872863769531, 390.0531005859375, 1.0, -382.8080139160156, -89.68234252929688, 393.1728820800781, 956.1063232421875, 383.0994873046875, 116.78369140625, 400.5042419433594, 440.7940368652344, 1.0, -382.8080139160156, -89.68234252929688, 393.1728820800781, 956.1063232421875, 383.0994873046875, 116.78369140625, 400.5042419433594, 440.7940368652344, 1.0, -322.31072998046875, -66.30396270751953, 329.0599060058594, 815.9317626953125, 322.5364990234375, 126.68118286132812, 346.5226135253906, 387.9457092285156, 1.0, -219.43417358398438, -78.44530487060547, 233.0343780517578, 574.43798828125, 219.5416259765625, 95.60025024414062, 239.4534149169922, 267.6639709472656, 1.0, -219.43417358398438, -78.44530487060547, 233.0343780517578, 574.43798828125, 219.5416259765625, 95.60025024414062, 239.4534149169922, 267.6639709472656)}\nclient.publish(\"note\",json.dumps(data))\n. This issue can be closed. Thank you guys for your hard work!. @emqplus @Gilbert-Wong I have checked the emqx.conf and my settings are the same as yours above, but still experience the message burst.. Thanks! Will test it tomorrow.\n. Just tested it. After commenting the last line of the config above, it works as it should. Still curious about the application of that burst mode. . Great work and thank you guys @Gilbert-Wong @emqplus . Thanks!. ",
    "mdrobny": "It's version 3.0-Beta.1 but space is missing in 2.3.11 also. @spring2maz yeah actually I agree that adding the space doesn't sound like real fix of my issue, maybe it was a restart like you mentioned and I didn't remember I changed something else. \nNevertheless merging it just for consistency sounds good :) . Deleting all rules from acl.conf helped and now authorisation works as intended but I don't really know if this was source of my problem - it rather helped me debugging because I changed also some other values.\nI must admit documentation is not precise enough when it comes to defining auth plugins. I am not sure if acl.conf is still required when using some emqx_auth_*.\nNeither https://developer.emqx.io/docs/emq/v3/en/config.html#allow-anonymous-and-acl-file nor https://developer.emqx.io/docs/emq/v3/en/plugins.html#emqx-auth-pgsql-postgresql-auth-acl-plugin say what to do exactly. Thanks @Gilbert-Wong for help :) we can close this issue I believe . ",
    "vus520": "this is the \"MQTT P2P\" scenario, your client can subscribe one private topic, means one client one topic. you can publish to any topic as your client.\nMy question is \"How to publish same msg to multiple topic one time\". P2P means point to point.\neg. ClientA and ClientB both subscribe TOPIC_XXX, but if you want to send a msg to ClientA only, you will understand the \"MQTT P2P\" issue.\nIf every client subscribe one self topic, so how can i send msg to these topic in one time?. Happy to see the new version released. I did not see this issue mentioned in the release log, l'd like to know emq support p2p msg now?. ",
    "gotthardp": "Thanks a bunch!. ",
    "ginahagg": "is there any update on this?. yes, we do need a standalone client with mqtt 5.0. We manage it now in dev phase by creating a client app by taking what we need out of emqx. But that's not a good approach for production. Thanks for reopening it. . we mine our logs for this and use exometer (or whatever metrics package you want to use). Even with all that,  definitely a cost on performance and should be only done if diagnosing a performance issue imho. :). ",
    "redmond007": "configs logs.zip\nFyi I've uploaded a zip file with my emq.config, my emq log in debug mode, and a ss of my client config for reference.. Fyi I tried setting ssl depth in ssl_dist.conf - I still get 'unknown_ca' - is that message coming from the broker or client?\nI'm attaching a zip of my current emq.conf and ssl_dist.conf for reference.\nconfigslogs2.zip\n. I've tried a ca chain with both the intermediary and root ca cert in one cert - the chain is installed on the operating system for both emq and the client.\nI've noticed that s_client apparently works with this set up - but my client (MQTTFX) does not work.\nDo you want me to use your CA?  Just for testing?. ",
    "ckrey": "19:11:45.166 [debug] MQTT(10.0.2.2:57709): RECV <<16,36,0,4,77,81,84,84,5,2,0,60,7,23,1,39,0,0,0,128,0,16,77,81,84,84,67,108,105,101,110,116,50,50,57,50,52,51>>\n19:11:45.166 [debug] MQTT(@10.0.2.2:57709): RECV CONNECT(Q0, R0, D0, ClientId=MQTTClient229243, ProtoName=MQTT, ProtoVsn=5, CleanStart=true, KeepAlive=60, Username=undefined, Password=undefined)\n19:11:45.169 [debug] MQTT(MQTTClient229243@10.0.2.2:57709): SEND CONNACK(Q0, R0, D0, AckFlags=0, ReasonCode=0)\n19:11:45.169 [debug] MQTT(10.0.2.2:57709): SEND <<32,21,0,0,18,39,0,16,0,0,36,2,37,1,42,1,41,1,34,0,0,40,1>>\n19:11:45.169 [debug] MQTT(10.0.2.2:57709): Keepalive at the interval of 45\n19:11:46.249 [debug] MQTT(10.0.2.2:57709): RECV <<51,15,0,10,77,81,84,84,67,108,105,101,110,116,0,2,0>>\n19:11:46.249 [debug] MQTT(MQTTClient229243@10.0.2.2:57709): RECV PUBLISH(Q1, R1, D0, Topic=MQTTClient, PacketId=2, Payload=<<>>)\n19:11:46.249 [info] MQTTClient229243 PUBLISH to MQTTClient: <<>>\n19:11:46.249 [debug] MQTT(MQTTClient229243@10.0.2.2:57709): SEND PUBACK(Q0, R0, D0, PacketId=2)\n19:11:46.250 [debug] MQTT(10.0.2.2:57709): SEND <<64,4,0,2,16,0>>\n19:11:47.315 [debug] MQTT(10.0.2.2:57709): RECV <<130,16,0,3,0,0,10,77,81,84,84,67,108,105,101,110,116,33>>\n19:11:47.316 [debug] MQTT(MQTTClient229243@10.0.2.2:57709): RECV SUBSCRIBE(Q1, R0, D0, PacketId=3, TopicFilters=[{<<\"MQTTClient\">>,\n                           #{nl => 0,qos => 1,rap => 0,rc => 0,rh => 2}}])\n19:11:47.318 [debug] MQTT(MQTTClient229243@10.0.2.2:57709): SEND SUBACK(Q0, R0, D0, PacketId=3, ReasonCodes=[1])\n19:11:47.318 [debug] MQTT(10.0.2.2:57709): SEND <<144,4,0,3,0,1>>\n19:11:48.390 [debug] MQTT(10.0.2.2:57709): RECV <<50,160,1,0,10,77,81,84,84,67,108,105,101,110,116,0,4,144,1,38,0,13,117,115,101,114,80,114,111,112,101,114,116,121,49,0,18,117,115,101,114,80,114,111,112,101,114,116,121,86,97,108,117,101,49,38,0,13,117,115,101,114,80,114,111,112,101,114,116,121,50,0,18,117,115,101,114,80,114,111,112,101,114,116,121,86,97,108,117,101,50,38,0,13,117,115,101,114,80,114,111,112,101,114,116,121,51,0,18,117,115,101,114,80,114,111,112,101,114,116,121,86,97,108,117,101,51,38,0,13,117,115,101,114,80,114,111,112,101,114,116,121,52,0,18,117,115,101,114,80,114,111,112,101,114,116,121,86,97,108,117,101,52>>\n19:11:48.391 [debug] MQTT(MQTTClient229243@10.0.2.2:57709): RECV PUBLISH(Q1, R0, D0, Topic=MQTTClient, PacketId=4, Payload=<<>>)\n19:11:48.391 [info] MQTTClient229243 PUBLISH to MQTTClient: <<>>\n19:11:48.391 [debug] MQTT(MQTTClient229243@10.0.2.2:57709): SEND PUBACK(Q0, R0, D0, PacketId=4)\n19:11:48.391 [debug] MQTT(10.0.2.2:57709): SEND <<64,4,0,4,0,0>>\n19:11:48.391 [debug] MQTT(MQTTClient229243@10.0.2.2:57709): SEND PUBLISH(Q1, R0, D0, Topic=MQTTClient, PacketId=1, Payload=<<>>)\n19:11:48.392 [debug] MQTT(10.0.2.2:57709): SEND <<50,160,1,0,10,77,81,84,84,67,108,105,101,110,116,0,1,144,1,38,0,13,117,115,101,114,80,114,111,112,101,114,116,121,52,0,18,117,115,101,114,80,114,111,112,101,114,116,121,86,97,108,117,101,52,38,0,13,117,115,101,114,80,114,111,112,101,114,116,121,51,0,18,117,115,101,114,80,114,111,112,101,114,116,121,86,97,108,117,101,51,38,0,13,117,115,101,114,80,114,111,112,101,114,116,121,50,0,18,117,115,101,114,80,114,111,112,101,114,116,121,86,97,108,117,101,50,38,0,13,117,115,101,114,80,114,111,112,101,114,116,121,49,0,18,117,115,101,114,80,114,111,112,101,114,116,121,86,97,108,117,101,49>>\n19:11:48.475 [debug] MQTT(10.0.2.2:57709): Terminated for {shutdown,closed}\n19:11:48.475 [info] MQTT(MQTTClient229243@10.0.2.2:57709): Shutdown for closed. Other implementors don\u2019t see stored retained messages as part of any client session, so the clientid of the PUBLISHING client isn\u2019t relevant for later a SUBSCRIBE.\nI asked the same question to Ian Craggs, let's see what his views are\n. ",
    "roke1845": "erlang.log message:\n===== Sun Sep 30 05:31:59 CST 2018\neheap_alloc: Cannot allocate 212907632 bytes of memory (of type \"heap\").^M^M\n^M^M\nCrash dump is being written to: /var/log/emqttd/crash.dump...\n===== ALIVE Sun Sep 30 05:46:59 CST 2018\n===== ALIVE Sun Sep 30 06:01:59 CST 2018\n===== ALIVE Sun Sep 30 06:16:59 CST 2018\n===== Sun Sep 30 06:29:38 CST 2018\ndone^M^M\n[os_mon] memory supervisor port (memsup): Erlang has closed^M^M\n[os_mon] cpu supervisor port (cpu_sup): Erlang has closed^M^M\ninfo.log message:\n2018-09-30 05:31:41.599 [warning] <0.4351.881>@emqttd_session:handle_cast:529 Session(paho1537962093152000000): kickout <0.4824.881>\n2018-09-30 05:31:44.616 [warning] <0.4916.881>@emqttd_session:handle_cast:529 Session(paho1537962093152000000): kickout <0.4509.881>\n2018-09-30 05:31:50.658 [warning] <0.5027.881>@emqttd_session:handle_cast:529 Session(paho1537962093152000000): kickout <0.5012.881>\n2018-09-30 05:31:52.675 [warning] <0.5063.881>@emqttd_session:handle_cast:529 Session(paho1537962093152000000): kickout <0.4900.881>\n2018-09-30 05:31:54.689 [warning] <0.4637.881>@emqttd_session:handle_cast:529 Session(paho1537962093152000000): kickout <0.4500.881>. I show you the metrics.\nhttps://imgur.com/a/HfLbqv2\nOne broker was restarted, it number of client was reduces.\nI restart broker then memory will be reduced. ",
    "jmpmscorp": "Hi @Gilbert-Wong. Thanks for you reply.\nFirst of all, I have to apologise. Reading and following rel repository instructions, I copied&pasted git url directly and I didn't know exactly which version and branch I downloaded. When you have replied me, I have gone to search version and I advice that. Consecuently, I have browsed again to rel repository and instead of use git command, I have downloaded 3.0-beta2 version.\nNow, I have built source code without errors and I can start broker correctly.\nClose thread when you consider.\nThanks again.. I'm at @horowitzb same point.\nI want to bridge two emqx nodes. I have installed emqx edge v.3.1.beta1 on raspberry 3b and I want to bridge it to my central emqx broker installed on ubuntu server 16.04. On raspberry, emqx edge version, I have configured my 'emqx.conf' following this instructions:\nhttps://developer.emqx.io/docs/tutorial/en/bridge/emqx_to_mosquitto.html\nBridge section on my 'emqx.conf' looks like:\n```\n--------------------------------------------------------------------\nTest Bridge\n--------------------------------------------------------------------\nbridge.test.address = 192.168.1.50:1883\nbridge.test.start_type = auto\nbridge.test.reconnect_interval = 30s\nbridge.test.proto_ver = mqttv4\nbridge.test.client_id = emqx_edge_test\nbridge.test.clean_start = false\nbridge.test.keepalive = 60s\nbridge.test.mountpoint = test/\nbridge.test.forwards = test1\nbridge.test.subscription.1.topic = test/#\nbridge.test.subscription.1.qos = 1\n```\nOpening dashboard of emqx central node, I can see raspberry node connected and, in subscriptions tab, I can see bridge subscription. Locally, publish messages works as expected. However, messages published in raspberry node are not forwarded to central node. I have tried with mosquitto_pub/sub and mqttfx clients but results are the same.\nFurthermore, although I have configured keepalive as 60s, central dashboard shows 34560 as keepalive time.\nAny new about new bridge implementation and configuration?\nRegards.. @phanimahesh Thank you for reply.\nI follow your instructions but, or I misunderstand something, or my bridge doesn't work as expected. I have tested all I can but nothing seems to work.\nI have edited my emqx.conf on both, raspberry and central ubuntu, and allow to subscribe to # topics, so I must see any traffic between brokers.\nI have connected two instances of MQTTfx, one to raspberry, one to emqx on ubuntu, and subscribe both to #. In mqttfx client connected to raspberry, I have published message through test1, test/test1, test/test/hello. As this client is subcribed to #, locally, every message is shown in subscription tab. However, anyone is show in central '#' subscription. \nOn the other hand, I have published messages in central emqx in the same topics (test1, test/test1, test/test/hello). Anyone is shown on raspberry side. \nI don't know what is happened. I have another raspberry node with mosquitto broker instead emqx edge with same configuration and mosquitto->central emqx brdige works perfectly.\nAnother question... I understand that mountpoint is a preffix of forwarded message. If I configure, ie, forwards to test/#, and mounpoint raspberry/, I understand that forwarded topic will be raspberry/test/#, is correct?. And, does mountpoint work on inverse way?. If I would public in raspberry/test/# on central node, bridge node will translate topic to test/# (deleting raspberry/).. ",
    "duhengxiao": "I am so sorry to create a Chinese issued before.\nI can subscribe the system topic  $SYS/brokers/{node}/clients/# to get clients online/offline message immediately.\nBut, I can't keep learning about the clients online status.\nSo, I want to know, do you have any system topic to let me know it or any other ways?. ",
    "JXT-Eden": "Does the client have a reconnection mechanism if the client is disconnected or if the heartbeat has timed out?Do you need to re-subscribe to the subscribed topics?Whether the message is saved directly to the database?. > \n\nemqx is broker rather than client, it has no reconnection mechanism.\n\n1.Whether the received message can be saved to the specified database or file\n2.Which topic should the plugin modules send to when the client goes online or offline?Is the topic custom or default and where can it be configured?. > > Are you executing the command in cmd or in powershell?\n\nIn cmd.\nThis problem only occurs the first time emq runs on a computer.\nIt seems that this is not a serious problem.\nI mean, if you restart the computer and then run \"emqttd console\" command in cmd,this problem occurs.\n\nme too. > Which version of emqx are you using? I am using the latest version of v3.0-rc.5 and have not reproduced this problem.\n2.3.11. > Hi, @JXT-Eden emqttd 2.3.11 would not be maintained again. We would release emqx3.0.0 this weekend. Hope that the latest emqx3.0.0 would solve your problem.\nOk, I'll replace it with 3.0. thanks. ",
    "zinid": "\nThere is no properties in CONNACK packet now\n\nLOL wut? \ud83d\ude01 What's this then? I added io:format() and I see this:\n```erl\n{'Maximum-Packet-Size' => 1048576,\n'Maximum-QoS' => 2,\n  'Retain-Available' => 1,\n  'Shared-Subscription-Available' => 1,\n  'Subscription-Identifier-Available' => 1,\n  'Topic-Alias-Maximum' => 0,\n  'Wildcard-Subscription-Available' => 1}\n```\n\nIt said that when this property Maximum QoS is absent in CONNACK packet, Client would use qos 2 as maximum qos\n\nRight. But Maximum QoS is not absent, it is there, in the CONNACK packet \ud83d\ude01. ",
    "giraffe-tree": "i meet the same problem with v3.0-beta.2  . thanks for you help @Gilbert-Wong . ",
    "lxl5lxl5lxl": "You could use the shared-subscription feature. EMQ supports this feature at cluster level from 3.0-beta.1.. ",
    "KenggL": "Hello Gilbert no worries thank you for your response. I will install emq 3.0 within the week and come back if the issue persists or is resolved. \nWould there be a specific version you would suggest as most stable for now?. Hello,\nI have upgraded to 3.0 beta 4. \nIt runs fine i could subscribe to the topic and i could confirm messages with MQTTfx. \nAlthough now the messages wont' get saved to the DB from MQTTfx publish either (or from the gateway messages as before).  I have checked that the API still works with POSTMAN and within the API itself.    \nI have manually made changes to the plugin template to match emqx version, run \"make\" at emqx-rel, restarted, resubscribed to topic and enabled it after. I have tried as below and also with only the message.publish parts but still it wouldn't work for me:\n```\n%% Copyright (c) 2013-2018 EMQ Enterprise, Inc. (http://emqx.io)\n%%\n%% Licensed under the Apache License, Version 2.0 (the \"License\");\n%% you may not use this file except in compliance with the License.\n%% You may obtain a copy of the License at\n%%\n%%     http://www.apache.org/licenses/LICENSE-2.0\n%%\n%% Unless required by applicable law or agreed to in writing, software\n%% distributed under the License is distributed on an \"AS IS\" BASIS,\n%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n%% See the License for the specific language governing permissions and\n%% limitations under the License.\n%%--------------------------------------------------------------------\n-module(emqx_plugin_template).\n-include_lib(\"emqx/include/emqx.hrl\").\n-export([load/1, unload/0]).\n%% Hooks functions\n-export([on_client_connected/3, on_client_disconnected/3]).\n-export([on_client_subscribe/4, on_client_unsubscribe/4]).\n-export([on_session_created/3, on_session_subscribed/4, on_session_unsubscribed/4, on_session_terminated/4]).\n-export([on_message_publish/2, on_message_delivered/4, on_message_acked/4]).\n%% Called when the plugin application start\nload(Env) ->\n    emqx:hook('client.connected', fun ?MODULE:on_client_connected/3, [Env]),\n    emqx:hook('client.disconnected', fun ?MODULE:on_client_disconnected/3, [Env]),\n    emqx:hook('client.subscribe', fun ?MODULE:on_client_subscribe/4, [Env]),\n    emqx:hook('client.unsubscribe', fun ?MODULE:on_client_unsubscribe/4, [Env]),\n    emqx:hook('session.created', fun ?MODULE:on_session_created/3, [Env]),\n    emqx:hook('session.subscribed', fun ?MODULE:on_session_subscribed/4, [Env]),\n    emqx:hook('session.unsubscribed', fun ?MODULE:on_session_unsubscribed/4, [Env]),\n    emqx:hook('session.terminated', fun ?MODULE:on_session_terminated/4, [Env]),\n    emqx:hook('message.publish', fun ?MODULE:on_message_publish/2, [Env]),\n    emqx:hook('message.delivered', fun ?MODULE:on_message_delivered/4, [Env]),\n    emqx:hook('message.acked', fun ?MODULE:on_message_acked/4, [Env]).\non_client_connected(ConnAck, Client = #mqtt_client{client_id = ClientId}, _Env) ->\n    io:format(\"client ~s connected, connack: ~w~n\", [ClientId, ConnAck]),\n    {ok, Client}.\non_client_disconnected(Reason, _Client = #mqtt_client{client_id = ClientId}, _Env) ->\n    io:format(\"client ~s disconnected, reason: ~w~n\", [ClientId, Reason]),\n    ok.\non_client_subscribe(ClientId, Username, TopicTable, _Env) ->\n    io:format(\"client(~s/~s) will subscribe: ~p~n\", [Username, ClientId, TopicTable]),\n    {ok, TopicTable}.\non_client_unsubscribe(ClientId, Username, TopicTable, _Env) ->\n    io:format(\"client(~s/~s) unsubscribe ~p~n\", [ClientId, Username, TopicTable]),\n    {ok, TopicTable}.\non_session_created(ClientId, Username, _Env) ->\n    io:format(\"session(~s/~s) created.\", [ClientId, Username]).\non_session_subscribed(ClientId, Username, {Topic, Opts}, _Env) ->\n    io:format(\"session(~s/~s) subscribed: ~p~n\", [Username, ClientId, {Topic, Opts}]),\n    {ok, {Topic, Opts}}.\non_session_unsubscribed(ClientId, Username, {Topic, Opts}, _Env) ->\n    io:format(\"session(~s/~s) unsubscribed: ~p~n\", [Username, ClientId, {Topic, Opts}]),\n    ok.\non_session_terminated(ClientId, Username, Reason, _Env) ->\n    io:format(\"session(~s/~s) terminated: ~p.\", [ClientId, Username, Reason]).\n%% transform message and return\non_message_publish(Message = #mqtt_message{topic = <<\"$SYS/\", _/binary>>}, _Env) ->\n    {ok, Message};\non_message_publish(Message, _Env) ->\n    io:format(\"publish ~s~n\", [emqx_message:format(Message)]),\nMessageBin = element(12, Message),\nMessageStr = binary_to_list(MessageBin),\ninets:start(),\nMethod = post,\nURL = \"http://127.0.0.1/api/v2/GatewaySQL/-----\u201c,\nHeader = [{\"X-DreamFactory-Api-Key\", \u201c\u2014\u2014\u201c}],\nType = \"application/json\",\n%%Body = MessageStr, %%just that didn't work with gateway\nBody = \"{\\\"resource\\\":[{\\\"TagRAW\\\":\\\"\" ++ MessageStr ++ \"\\\"}]}\",\nHTTPOptions = [],\nOptions = [],\nR = httpc:request(Method, {URL, Header, Type, Body},HTTPOptions,Options),\n    {ok, Message}.\non_message_delivered(ClientId, Username, Message, _Env) ->\n    io:format(\"delivered to client(~s/~s): ~s~n\", [Username, ClientId, emqx_message:format(Message)]),\n    {ok, Message}.\non_message_acked(ClientId, Username, Message, _Env) ->\n    io:format(\"client(~s/~s) acked: ~s~n\", [Username, ClientId, emqx_message:format(Message)]),\n    {ok, Message}.\n%% Called when the plugin application stop\nunload() ->\n    emqx:unhook('client.connected', fun ?MODULE:on_client_connected/3),\n    emqx:unhook('client.disconnected', fun ?MODULE:on_client_disconnected/3),\n    emqx:unhook('client.subscribe', fun ?MODULE:on_client_subscribe/4),\n    emqx:unhook('client.unsubscribe', fun ?MODULE:on_client_unsubscribe/4),\n    emqx:unhook('session.created', fun ?MODULE:on_session_created/3),\n    emqx:unhook('session.subscribed', fun ?MODULE:on_session_subscribed/4),\n    emqx:unhook('session.unsubscribed', fun ?MODULE:on_session_unsubscribed/4),\n    emqx:unhook('session.terminated', fun ?MODULE:on_session_terminated/4),\n    emqx:unhook('message.publish', fun ?MODULE:on_message_publish/2),\n    emqx:unhook('message.delivered', fun ?MODULE:on_message_delivered/4),\n    emqx:unhook('message.acked', fun ?MODULE:on_message_acked/4).\n```\nDoes all that seem alright? Is there something additional i need to do at V3.0?\nThank you for your time.. @turtleDeng Thank you for your suggestion to have a look at hooks plugin.\nI have first checked if everything is setup correctly:\nMakefile : all good just as in your git link, ( all have emqx30, not master)\nrelx.config : the plugin is loaded  (web.hook.api.url = http://127.0.0.1:8080)\nI have then loaded the hook plugin ( ./_rel/emqx/bin/emqx_ctl plugins load emqx_web_hook) along with emqx_plugin_template.\nUnfortunately that didn\u2019t make a change.\nI have also tried leaving only what\u2019s relevant to  the message.publish hook inside the emqx plugin template.erl before make.\nShould I use \u201cpayload\u201d to get the message contents instead of \u201c,message\u201d? Tried it but I might have not done it correctly\nWas your suggestion or did you mean something else? . ",
    "manas-chaudhari": "I observed that the emqttd_ctl routes list shows the load test topic even after the test has finished. Also, when the load is at the peak, pubsub works, and it gets stuck exactly when the load test is finished. Maybe the sudden disconnections of all clients are causing that topic to get stuck?. The tests done earlier were at a ramp up rate of 5k. There was no ramp down. All clients were disconnecting together. Also, earlier, I wasn't checking in case broker was recovering after certain time.\nI setup the ramp down of connections, and also tried variations in the ramp rate. I observed that the broker did recover in around 5 minutes in case of 100k subscriptions. \nObservations:\n\nEven after all clients disconnected, the topic was visible in the routes for around 5 minutes. After 5 minutes, it disappeared, with broker resuming functionality normally. Lets refer to this 5 minute period as stuck window.\nDuring the stuck window, if there is a new subscription (on same/different topic), it doesn't appear in the routes until the stuck window ends. Messages get received on the subscription only after the stuck window ends.\nIf there is was already a subscription on another topic before the stuck window started, it receives messages in the stuck window. So, only new subscriptions get blocked in the stuck window.\nDuring the stuck window, the web dashboard displays undefined/undefined/... on the overview page in Erlang Processes, CPU Info, Memory tabs and empty value in MaxFds.\nThe duration of stuck window seems to be proportional to the number of subscriptions. In case of 50k subscriptions, the stuck window was around 1 minute.\n\nIt seems that some work might be getting queued at the time of disconnect, which is blocking the routing setup for all further subscriptions. \nWhat could be the issue here? \nHere are the configs for reference:\nemq.conf\n```\nmqtt.allow_anonymous=true\nErlang Process Limit\nnode.process_limit = 2097152\nSets the maximum number of simultaneously existing ports for this system\nnode.max_ports = 1048576\nSize of acceptor pool\nlistener.tcp.external.acceptors = 64\nMaximum number of concurrent clients\nlistener.tcp.external.max_clients = 1000000\n```\n/etc/sysctl.conf\nnet.ipv4.ip_local_port_range=1024   60999\nfs.file-max=1048576\n/etc/security/limits.conf\n*       -       nofile  1048576. Sorry, missed this message.\nI tested on a c5.4xlarge machine on AWS.\nvCPU: 16\nMemory: 32GB\nLoad was generated from 4 m4.xlarge machines.\nvCPU: 4\nMemory: 16GB\nKindly let me know if you need anything specific.. Cool. I will check it out.\nOn Fri, 18 Jan, 2019, 11:22 AM jinfahua <notifications@github.com wrote:\n\n@manas-chaudhari https://github.com/manas-chaudhari The problem was\nfixed in the latest version, please check it out. Feel free to let us know\nif having any problems.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/emqx/emqx/issues/1880#issuecomment-455435752, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AEJL3EL25VRIEQT3UKBiF1XhE9bO9G9bks5vEWElgaJpZM4XFuo1\n.\n. \n",
    "SergeyZSpb": "np, I was referring to http://emqtt.io/docs/v2/design.html#packetid-and-messageid \"A GUID(128-bit globally unique Id) will be generated by the broker and assigned to a MQTT message.\" \nThe statement seems quite clear to me. Is there a way to expose this guid i.e., put it inside the message so that it's available to mqtt consumers? Where would someone who wants this take a look in code? \nThanks. Thank you!. ",
    "E-brain-child": "There are only 10 connections in case of failure;hardware information and etc/emq.conf file in this link:\nhttp://note.youdao.com/noteshare?id=498d1e4416aecd627ace1b4c51d2a2a1\n. ",
    "NewBorn25": "Thank you for your reply , Here's my analysis\nmy configurations\n     EMQ_NODE__DIST_NET_TICKTIME:           300\n      EMQ_NAME:                     emqtt\n      EMQ_CLUSTER__DISCOVERY:               k8s\n      EMQ_CLUSTER__K8S__APISERVER:          https:\\/\\/10.254.0.1:443\n      EMQ_CLUSTER__K8S__SERVICE_NAME:           emqtt\n      EMQ_CLUSTER__K8S__ADDRESS_TYPE:           ip\n      EMQ_CLUSTER__K8S__APP_NAME:           emqtt\n      EMQ_CLUSTER__NAME:                emqcl\n      EMQ_CLUSTER__AUTOHEAL:                on\n      EMQ_CLUSTER__AUTOCLEAN:               5m\n      EMQ_NODE__COOKIE:                 secretcookieeeetfggggg\ndetailed logs:\n   /opt/emqttd # cd log/\n/opt/emqttd/log # ls\ncrash.log.4  error.log.4\n/opt/emqttd/log # vi crash.log.4 \n/opt/emqttd/log # vi error.log.4 .log.4 \n2018-10-23 16:29:50.815 [error] <0.1280.0>@ekka_cluster_k8s:read_file:88 Ekka(k8s): Cannot read token: enoent\n2018-10-23 16:29:50.815 [error] <0.1280.0>@ekka_cluster_k8s:read_file:88 Ekka(k8s): Cannot read namespace: enoent\n2018-10-23 16:29:50.827 [error] <0.1280.0>@ekka:autocluster:88 Autocluster exception: {badrecord,member}\nOther questions:\n   plugins can't start normally,I use emqttd_ctl plugins list command can't find plugins start \n,this is the reason of pod restarted regularly.\n   we scale pod replicas six.\n\n. \n@zhanghongtong \nemqtt docker version is v2.3\n\nwe deploy emqtt cluster based on k8s,like this \n\nEMQ_CLUSTER__K8S__APISERVER is the service ip of k8s\n. Actually we deploy emqtt success and it works normally,but Sometimes this happens after a long period of work.\n     - name: EMQ_CLUSTER__K8S__APISERVER\n          value: http://172.31.22.81:8080\nI notice that your EMQ_CLUSTER__K8S__APISERVER is not your service IP of service/kubernetes?which IP it is?\nRecently it reported log \"Autocluster exception:function_clause\",and it can't work again ,I'm not sure the are the same problem or not .. OK,another simple question ,this represent the version of emqtt is V2.3.0?\n\nmaybe the question come from our emqtt version need to update\n. ",
    "wodefe2": "Hi, I have the same problem as NewBorn25 has. After a long period of work , emqtt prints \"Autocluster exception:function_clause\" , then our application loses connection to it.  Environment is the same as NewBorn25 . \nThe only way to fix it is to restart the emqtt . If you have any solution to this , please let me know ,thanks. You can connect me with email : wodefe3@163.com . ",
    "cbluth": "are you connecting to the mqtt 1883 port or are you connecting to the web-ui admin tool?. @zhanghongtong @spring2maz \nThanks. @zhanghongtong thank you for your yaml manifest.\nI have my working version here: https://gist.github.com/cbluth/a42bc7b8a329be1750f28124bd289d4d#file-emqx-deployment-yaml. From the logs of the service, it looks like the broker node is crashing/restarting.. ",
    "1129921824": "This is Bug. use mqtt client to connect mqtt server\uff0cusername and passwoed is invalid. ",
    "free1139": "What's your version of k8s? My k8s version is v1.10.0 . I tried to deploy several emqtt versions, such as v2.3.3, v2.3.11, v3.0-rc3, which all reported this error:\n[error] Ekka(AutoCluster): Discovery error: {404,\"{\\\"kind\\\":\\\"Status\\\",\\\"apiVersion\\\":\\\"v1\\\",\\\"metadata\\\":{},\\\"status\\\":\\\"Failure\\\",\\\"message\\\":\\\"endpoints \\\\\"c-mqttd\\\\\" not found\\\",\\\"reason\\\":\\\"NotFound\\\",\\\"details\\\":{\\\"name\\\":\\\"c-mqttd\\\",\\\"kind\\\":\\\"endpoints\\\"},\\\"code\\\":404}\\n\"}. ",
    "jitendrakm41": "It seems the problem was with the IP address. Instead of passing broker listener i.e. tcp://127.0.0.1:11883. Now, i am passing the IP address of my system and now, i am getting \njava.net.SocketTimeoutException: failed to connect to /192.168.2.5 (port 1883) from /192.168.2.4 (port 40942) after 30000ms\nI checked my system firewall too which is disabled.\nSo not sure, what to do next?. ",
    "linguitang": "mqtt_client. ",
    "PeiyiChi": "I am using the code from branch emq24 of https://github.com/emqx/emqx-rel. . Yes, it is still an issue in 3.0. ",
    "jdavidagudelo": "Yes it is emqx3.0, in emqx2.0 the LUA hooks work fine. I used the command ./bin/emqx_ctl plugins load emqx_lua_hook in emqx3.0 and it throws an error.. This is the content of my etc/plugins/emqx_web_hook.conf file:\n```\nweb.hook.api.url = http://127.0.0.1:3333/handle_mqtt_action\nweb.hook.rule.client.connected.1     = {\"action\": \"on_client_connected\"}\nweb.hook.rule.client.disconnected.1  = {\"action\": \"on_client_disconnected\"}\nweb.hook.rule.client.subscribe.1     = {\"action\": \"on_client_subscribe\"}\nweb.hook.rule.client.unsubscribe.1   = {\"action\": \"on_client_unsubscribe\"}\nweb.hook.rule.session.created.1      = {\"action\": \"on_session_created\"}\nweb.hook.rule.session.subscribed.1   = {\"action\": \"on_session_subscribed\"}\nweb.hook.rule.session.unsubscribed.1 = {\"action\": \"on_session_unsubscribed\"}\nweb.hook.rule.session.terminated.1   = {\"action\": \"on_session_terminated\"}\nweb.hook.rule.message.publish.1      = {\"action\": \"on_message_publish\"}\nweb.hook.rule.message.delivered.1    = {\"action\": \"on_message_delivered\"}\nweb.hook.rule.message.acked.1        = {\"action\": \"on_message_acked\"}\n```\nAnd this is the content of my etc/emqx.conf file:\n```\n====================================================================\nEMQ X Configuration R3.0\n====================================================================\n--------------------------------------------------------------------\nCluster\n--------------------------------------------------------------------\nCluster name.\n\nValue: String\ncluster.name = emqxcl\nCluster auto-discovery strategy.\n\nValue: Enum\n- manual: Manual join command\n- static: Static node list\n- mcast:  IP Multicast\n- dns:    DNS A Record\n- etcd:   etcd\n- k8s:    Kubernates\n\nDefault: manual\ncluster.discovery = manual\nEnable cluster autoheal from network partition.\n\nValue: on | off\n\nDefault: on\ncluster.autoheal = on\nAutoclean down node. A down node will be removed from the cluster\nif this value > 0.\n\nValue: Duration\n-h: hour, e.g. '2h' for 2 hours\n-m: minute, e.g. '5m' for 5 minutes\n-s: second, e.g. '30s' for 30 seconds\n\nDefault: 5m\ncluster.autoclean = 5m\n--------------------------------------------------------------------\nCluster using static node list\nNode list of the cluster.\n\nValue: String\ncluster.static.seeds = emqx1@127.0.0.1,emqx2@127.0.0.1\n--------------------------------------------------------------------\nCluster using IP Multicast.\nIP Multicast Address.\n\nValue: IP Address\ncluster.mcast.addr = 239.192.0.1\nMulticast Ports.\n\nValue: Port List\ncluster.mcast.ports = 4369,4370\nMulticast Iface.\n\nValue: Iface Address\n\nDefault: 0.0.0.0\ncluster.mcast.iface = 0.0.0.0\nMulticast Ttl.\n\nValue: 0-255\ncluster.mcast.ttl = 255\nMulticast loop.\n\nValue: on | off\ncluster.mcast.loop = on\n--------------------------------------------------------------------\nCluster using DNS A records.\nDNS name.\n\nValue: String\ncluster.dns.name = localhost\nThe App name is used to build 'node.name' with IP address.\n\nValue: String\ncluster.dns.app = emqx\n--------------------------------------------------------------------\nCluster using etcd\nEtcd server list, seperated by ','.\n\nValue: String\ncluster.etcd.server = http://127.0.0.1:2379\nThe prefix helps build nodes path in etcd. Each node in the cluster\nwill create a path in etcd: v2/keys///\n\nValue: String\ncluster.etcd.prefix = emqxcl\nThe TTL for node's path in etcd.\n\nValue: Duration\n\nDefault: 1m, 1 minute\ncluster.etcd.node_ttl = 1m\n--------------------------------------------------------------------\nCluster using Kubernates\nKubernates API server list, seperated by ','.\n\nValue: String\ncluster.k8s.apiserver = http://10.110.111.204:8080\nThe service name helps lookup EMQ nodes in the cluster.\n\nValue: String\ncluster.k8s.service_name = emqx\nThe address type is used to extract host from k8s service.\n\nValue: ip | dns\ncluster.k8s.address_type = ip\nThe app name helps build 'node.name'.\n\nValue: String\ncluster.k8s.app_name = emqx\nKubernates Namespace\n\nValue: String\ncluster.k8s.namespace = default\n--------------------------------------------------------------------\nNode\n--------------------------------------------------------------------\nNode name.\n\nSee: http://erlang.org/doc/reference_manual/distributed.html\n\nValue: @\n\nDefault: emqx@127.0.0.1\nnode.name = emqx@127.0.0.1\nCookie for distributed node communication.\n\nValue: String\nnode.cookie = emqxsecretcookie\nEnable SMP support of Erlang VM.\n\nValue: enable | auto | disable\nnode.smp = auto\nHeartbeat monitoring of an Erlang runtime system. Comment the line to disable\nheartbeat, or set the value as 'on'\n\nValue: on\n\nvm.args: -heart\nnode.heartbeat = on\nEnable kernel poll.\n\nValue: on | off\n\nDefault: on\nnode.kernel_poll = on\nSets the number of threads in async thread pool. Valid range is 0-1024.\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: 0-1024\n\nvm.args: +A Number\nnode.async_threads = 32\nSets the maximum number of simultaneously existing processes for this\nsystem if a Number is passed as value.\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: Number [1024-134217727]\n\nvm.args: +P Number\nnode.process_limit = 256000\nSets the maximum number of simultaneously existing ports for this system.\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: Number [1024-134217727]\n\nvm.args: +Q Number\nnode.max_ports = 256000\nSet the distribution buffer busy limit (dist_buf_busy_limit).\n\nSee: http://erlang.org/doc/man/erl.html\n\nValue: Number [1KB-2GB]\n\nvm.args: +zdbbl size\nnode.dist_buffer_size = 8MB\nSets the maximum number of ETS tables. Note that mnesia and SSL will\ncreate temporary ETS tables.\n\nValue: Number\n\nvm.args: +e Number\nnode.max_ets_tables = 256000\nTweak GC to run more often.\n\nValue: Number [0-65535]\n\nvm.args: -env ERL_FULLSWEEP_AFTER Number\nnode.fullsweep_after = 1000\nCrash dump log file.\n\nValue: Log file\nnode.crash_dump = log/crash.dump\nSpecify the erlang distributed protocol.\n\nValue: Enum\n- inet_tcp: the default; handles TCP streams with IPv4 addressing.\n- inet6_tcp: handles TCP with IPv6 addressing.\n- inet_tls: using TLS for Erlang Distribution.\n\nvm.args: -proto_dist inet_tcp\nnode.proto_dist = inet_tcp\nSpecify SSL Options in the file if using SSL for Erlang Distribution.\n\nValue: File\n\nvm.args: -ssl_dist_optfile \nnode.ssl_dist_optfile = etc/ssl_dist.conf\nSets the net_kernel tick time. TickTime is specified in seconds.\nNotice that all communicating nodes are to have the same TickTime\nvalue specified.\n\nSee: http://www.erlang.org/doc/man/kernel_app.html#net_ticktime\n\nValue: Number\n\nvm.args: -kernel net_ticktime Number\nnode.dist_net_ticktime = 60\nSets the port range for the listener socket of a distributed Erlang node.\nNote that if there are firewalls between clustered nodes, this port segment\nfor nodes\u2019 communication should be allowed.\n\nSee: http://www.erlang.org/doc/man/kernel_app.html\n\nValue: Port [1024-65535]\nnode.dist_listen_min = 6369\nnode.dist_listen_max = 6369\n--------------------------------------------------------------------\nRPC\n--------------------------------------------------------------------\nTCP server port for RPC.\n\nValue: Port [1024-65535]\nrpc.tcp_server_port = 5369\nTCP port for outgoing RPC connections.\n\nValue: Port [1024-65535]\nrpc.tcp_client_port = 5369\nRCP Client connect timeout.\n\nValue: Seconds\nrpc.connect_timeout = 5000\nTCP send timeout of RPC client and server.\n\nValue: Seconds\nrpc.send_timeout = 5000\nAuthentication timeout\n\nValue: Seconds\nrpc.authentication_timeout = 5000\nDefault receive timeout for call() functions\n\nValue: Seconds\nrpc.call_receive_timeout = 15000\nSocket idle keepalive.\n\nValue: Seconds\nrpc.socket_keepalive_idle = 900\nTCP Keepalive probes interval.\n\nValue: Integer\nrpc.socket_keepalive_interval = 75\nProbes lost to close the connection\n\nValue: Integer\nrpc.socket_keepalive_count = 9\n--------------------------------------------------------------------\nLog\n--------------------------------------------------------------------\nWhere to emit the logs.\nEnable the console (standard output) logs.\n\nValue: off | file | console | both\n- off: disable logs entirely\n- file: write logs to file\n- console: write logs to standard I/O\n- both: write logs both to file and standard I/O\nlog.to = console\nThe log severity level.\n\nValue: debug | info | notice | warning | error | critical | alert | emergency\n\nNote: Only the messages with severity level greater than or equal to\nthis level will be logged.\n\nDefault: error\nlog.level = error\nThe dir for log files.\n\nValue: Folder\nlog.dir = log\nThe log filename for logs of level specified in \"log.level\".\n\nValue: String\nDefault: emqx.log\nlog.file = emqx.log\nMaximum size of each log file.\n\nValue: Number\nDefault: 10M\nSupported Unit: KB | MB | G\nlog.rotation.size = 10MB\nMaximum rotation count of log files.\n\nValue: Number\nDefault: 5\nlog.rotation.count = 5\nTo create additional log files for specific log levels.\n\nValue: File Name\nFormat: log.$level.file = $filename,\nwhere \"$level\" can be one of: debug, info, notice, warning,\nerror, critical, alert, emergency\nNote: Log files for a specific log level will contain all the logs\nthat greater than or equal to that level\n\nlog.info.file = info.log\nlog.error.file = error.log\n--------------------------------------------------------------------\nAuthentication/Access Control\n--------------------------------------------------------------------\nAllow anonymous authentication by default if no auth plugins loaded.\nNotice: Disable the option in production deployment!\n\nValue: true | false\nallow_anonymous = true\nAllow or deny if no ACL rules matched.\n\nValue: allow | deny\nacl_nomatch = allow\nDefault ACL File.\n\nValue: File Name\nacl_file = etc/acl.conf\nWhether to enable ACL cache.\n\nIf enabled, ACLs roles for each client will be cached in the memory\n\nValue: on | off\nenable_acl_cache = on\nThe maximum count of ACL entries can be cached for a client.\n\nValue: Integer greater than 0\nDefault: 32\nacl_cache_max_size = 32\nThe time after which an ACL cache entry will be deleted\n\nValue: Duration\nDefault: 1 minute\nacl_cache_ttl = 1m\n--------------------------------------------------------------------\nMQTT Protocol\n--------------------------------------------------------------------\nResponse Topic Prefix\n\nValue: String\nDefault: emqxrspv1\nmqtt.response_topic_prefix = emqxrspv1\nMaximum MQTT packet size allowed.\n\nValue: Bytes\nDefault: 1MB\nmqtt.max_packet_size = 1MB\nMaximum length of MQTT clientId allowed.\n\nValue: Number [23-65535]\nmqtt.max_clientid_len = 65535\nMaximum topic levels allowed. 0 means no limit.\n\nValue: Number\nmqtt.max_topic_levels = 0\nMaximum QoS allowed.\n\nValue: 0 | 1 | 2\nmqtt.max_qos_allowed = 2\nMaximum Topic Alias, 0 means no limit.\n\nValue: 0-65535\nmqtt.max_topic_alias = 0\nWhether the Server supports MQTT retained messages.\n\nValue: boolean\nmqtt.retain_available = true\nWhether the Server supports MQTT Wildcard Subscriptions\n\nValue: boolean\nmqtt.wildcard_subscription = true\nWhether the Server supports MQTT Shared Subscriptions.\n\nValue: boolean\nmqtt.shared_subscription = true\n--------------------------------------------------------------------\nZones\n--------------------------------------------------------------------\n--------------------------------------------------------------------\nExternal Zone\nIdle timeout of the external MQTT connections.\n\nValue: duration\nzone.external.idle_timeout = 15s\nPublish limit for the external MQTT connections.\n\nValue: Number,Duration\nExample: 10 messages per minute.\nzone.external.publish_limit = 10,1m\nEnable ACL check.\n\nValue: Flag\nzone.external.enable_acl = on\nEnable ban check.\n\nValue: Flag\nzone.external.enable_ban = on\nEnable per connection statistics.\n\nValue: on | off\nzone.external.enable_stats = on\nForce MQTT connection/session process GC after this number of\nmessages | bytes passed through.\n\nNumbers delimited by `|'. Zero or negative is to disable.\nzone.external.force_gc_policy = 1000|1MB\nMaximum MQTT packet size allowed.\n\nValue: Bytes\nDefault: 1MB\nzone.external.max_packet_size = 64KB\nMaximum length of MQTT clientId allowed.\n\nValue: Number [23-65535]\nzone.external.max_clientid_len = 1024\nMaximum topic levels allowed. 0 means no limit.\n\nValue: Number\nzone.external.max_topic_levels = 7\nMaximum QoS allowed.\n\nValue: 0 | 1 | 2\nzone.external.max_qos_allowed = 2\nMaximum Topic Alias, 0 means no limit.\n\nValue: 0-65535\nzone.external.max_topic_alias = 0\nWhether the Server supports retained messages.\n\nValue: boolean\nzone.external.retain_available = true\nWhether the Server supports Wildcard Subscriptions\n\nValue: boolean\nzone.external.wildcard_subscription = false\nWhether the Server supports Shared Subscriptions\n\nValue: boolean\nzone.external.shared_subscription = false\nServer Keep Alive\n\nValue: Number\nzone.external.server_keepalive = 0\nThe backoff for MQTT keepalive timeout. The broker will kick a connection out\nuntil 'Keepalive * backoff * 2' timeout.\n\nValue: Float > 0.5\nzone.external.keepalive_backoff = 0.75\nMaximum number of subscriptions allowed, 0 means no limit.\n\nValue: Number\nzone.external.max_subscriptions = 0\nForce to upgrade QoS according to subscription.\n\nValue: on | off\nzone.external.upgrade_qos = off\nMaximum size of the Inflight Window storing QoS1/2 messages delivered but unacked.\n\nValue: Number\nzone.external.max_inflight = 32\nRetry interval for QoS1/2 message delivering.\n\nValue: Duration\nzone.external.retry_interval = 20s\nMaximum QoS2 packets (Client -> Broker) awaiting PUBREL, 0 means no limit.\n\nValue: Number\nzone.external.max_awaiting_rel = 100\nThe QoS2 messages (Client -> Broker) will be dropped if awaiting PUBREL timeout.\n\nValue: Duration\nzone.external.await_rel_timeout = 300s\nDefault session expiry interval for MQTT V3.1.1 connections.\n\nValue: Duration\n-d: day\n-h: hour\n-m: minute\n-s: second\n\nDefault: 2h, 2 hours\nzone.external.session_expiry_interval = 2h\nMaximum queue length. Enqueued messages when persistent client disconnected,\nor inflight window is full. 0 means no limit.\n\nValue: Number >= 0\nzone.external.max_mqueue_len = 1000\nTopic priorities.\n'none' to indicate no priority table (by default), hence all messages\nare treated equal\n\nPriority number [1-255]\nExample: topic/1=10,topic/2=8\nNOTE: comma and equal signs are not allowed for priority topic names\nNOTE: messages for topics not in the priority table are treated as\neither highest or lowest priority depending on the configured\nvalue for mqueue_default_priority\n\nzone.external.mqueue_priorities = none\nDefault to highest priority for topics not matching priority table\n\nValue: highest | lowest\nzone.external.mqueue_default_priority = highest\nWhether to enqueue Qos0 messages.\n\nValue: false | true\nzone.external.mqueue_store_qos0 = true\nAll the topics will be prefixed with the mountpoint path if this option is enabled.\n\nVariables in mountpoint path:\n- %c: clientid\n- %u: username\n\nValue: String\nzone.external.mountpoint = devicebound/\n--------------------------------------------------------------------\nInternal Zone\nzone.internal.allow_anonymous = true\nEnable per connection stats.\n\nValue: Flag\nzone.internal.enable_stats = on\nEnable ACL check.\n\nValue: Flag\nzone.internal.enable_acl = off\nSee zone.$name.wildcard_subscription.\n\nValue: boolean\nzone.internal.wildcard_subscription = true\nSee zone.$name.shared_subscription.\n\nValue: boolean\nzone.internal.shared_subscription = true\nSee zone.$name.max_subscriptions.\n\nValue: Integer\nzone.internal.max_subscriptions = 0\nSee zone.$name.max_inflight\n\nValue: Number\nzone.internal.max_inflight = 32\nSee zone.$name.max_awaiting_rel\n\nValue: Number\nzone.internal.max_awaiting_rel = 100\nSee zone.$name.max_mqueue_len\n\nValue: Number >= 0\nzone.internal.max_mqueue_len = 1000\nWhether to enqueue Qos0 messages.\n\nValue: false | true\nzone.internal.mqueue_store_qos0 = true\nAll the topics will be prefixed with the mountpoint path if this option is enabled.\n\nVariables in mountpoint path:\n- %c: clientid\n- %u: username\n\nValue: String\nzone.internal.mountpoint = cloudbound/\n--------------------------------------------------------------------\nListeners\n--------------------------------------------------------------------\n--------------------------------------------------------------------\nMQTT/TCP - External TCP Listener for MQTT Protocol\nlistener.tcp.$name is the IP address and port that the MQTT/TCP\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 1883, 127.0.0.1:1883, ::1:1883\nlistener.tcp.external = 0.0.0.0:1883\nThe acceptor pool for external MQTT/TCP listener.\n\nValue: Number\nlistener.tcp.external.acceptors = 8\nMaximum number of concurrent MQTT/TCP connections.\n\nValue: Number\nlistener.tcp.external.max_connections = 1024000\nMaximum external connections per second.\n\nValue: Number\nlistener.tcp.external.max_conn_rate = 1000\nZone of the external MQTT/TCP listener belonged to.\n\nSee: zone.$name.*\n\nValue: String\nlistener.tcp.external.zone = external\nMountpoint of the MQTT/TCP Listener. All the topics will be prefixed\nwith the mountpoint path if this option is enabled.\n\nVariables in mountpoint path:\n- %c: clientid\n- %u: username\n\nValue: String\nlistener.tcp.external.mountpoint = devicebound/\nRate limit for the external MQTT/TCP connections. Format is 'rate,burst'.\n\nValue: rate,burst\nUnit: Bps\nlistener.tcp.external.rate_limit = 1024,4096\nThe access control rules for the MQTT/TCP listener.\n\nSee: https://github.com/emqtt/esockd#allowdeny\n\nValue: ACL Rule\n\nExample: allow 192.168.0.0/24\nlistener.tcp.external.access.1 = allow all\nEnable the Proxy Protocol V1/2 if the EMQ X cluster is deployed\nbehind HAProxy or Nginx.\n\nSee: https://www.haproxy.com/blog/haproxy/proxy-protocol/\n\nValue: on | off\nlistener.tcp.external.proxy_protocol = on\nSets the timeout for proxy protocol. EMQ X will close the TCP connection\nif no proxy protocol packet recevied within the timeout.\n\nValue: Duration\nlistener.tcp.external.proxy_protocol_timeout = 3s\nEnable the option for X.509 certificate based authentication.\nEMQX will use the common name of certificate as MQTT username.\n\nValue: cn | dn\nlistener.tcp.external.peer_cert_as_username = cn\nThe TCP backlog defines the maximum length that the queue of pending\nconnections can grow to.\n\nValue: Number >= 0\nlistener.tcp.external.backlog = 1024\nThe TCP send timeout for external MQTT connections.\n\nValue: Duration\nlistener.tcp.external.send_timeout = 15s\nClose the TCP connection if send timeout.\n\nValue: on | off\nlistener.tcp.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for MQTT connections.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.external.recbuf = 2KB\nThe TCP send buffer(os kernel) for MQTT connections.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.external.sndbuf = 2KB\nThe size of the user-level software buffer used by the driver.\nNot to be confused with options sndbuf and recbuf, which correspond\nto the Kernel socket buffers. It is recommended to have val(buffer)\n>= max(val(sndbuf),val(recbuf)) to avoid performance issues because\nof unnecessary copying. val(buffer) is automatically set to the above\nmaximum when values sndbuf or recbuf are set.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.external.buffer = 2KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nValue: on | off\nlistener.tcp.external.tune_buffer = off\nThe TCP_NODELAY flag for MQTT connections. Small amounts of data are\nsent immediately if the option is enabled.\n\nValue: true | false\nlistener.tcp.external.nodelay = true\nThe SO_REUSEADDR flag for TCP listener.\n\nValue: true | false\nlistener.tcp.external.reuseaddr = true\n--------------------------------------------------------------------\nInternal TCP Listener for MQTT Protocol\nThe IP address and port that the internal MQTT/TCP protocol listener\nwill bind.\n\nValue: IP:Port, Port\n\nExamples: 11883, 127.0.0.1:11883, ::1:11883\nlistener.tcp.internal = 127.0.0.1:11883\nThe acceptor pool for internal MQTT/TCP listener.\n\nValue: Number\nlistener.tcp.internal.acceptors = 4\nMaximum number of concurrent MQTT/TCP connections.\n\nValue: Number\nlistener.tcp.internal.max_connections = 10240000\nMaximum internal connections per second.\n\nValue: Number\nlistener.tcp.internal.max_conn_rate = 1000\nZone of the internal MQTT/TCP listener belonged to.\n\nValue: String\nlistener.tcp.internal.zone = internal\nMountpoint of the MQTT/TCP Listener.\n\nSee: listener.tcp.$name.mountpoint\n\nValue: String\nlistener.tcp.internal.mountpoint = internal/\nRate limit for the internal MQTT/TCP connections.\n\nSee: listener.tcp.$name.rate_limit\n\nValue: rate,burst\nUnit: Bps\nlistener.tcp.internal.rate_limit = 1000000,2000000\nThe TCP backlog of internal MQTT/TCP Listener.\n\nSee: listener.tcp.$name.backlog\n\nValue: Number >= 0\nlistener.tcp.internal.backlog = 512\nThe TCP send timeout for internal MQTT connections.\n\nSee: listener.tcp.$name.send_timeout\n\nValue: Duration\nlistener.tcp.internal.send_timeout = 5s\nClose the MQTT/TCP connection if send timeout.\n\nSee: listener.tcp.$name.send_timeout_close\n\nValue: on | off\nlistener.tcp.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for internal MQTT connections.\n\nSee: listener.tcp.$name.recbuf\n\nValue: Bytes\nlistener.tcp.internal.recbuf = 16KB\nThe TCP send buffer(os kernel) for internal MQTT connections.\n\nSee: http://erlang.org/doc/man/inet.html\n\nValue: Bytes\nlistener.tcp.internal.sndbuf = 16KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp.$name.buffer\n\nValue: Bytes\nlistener.tcp.internal.buffer = 16KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nSee: listener.tcp.$name.tune_buffer\n\nValue: on | off\nlistener.tcp.internal.tune_buffer = off\nThe TCP_NODELAY flag for internal MQTT connections.\n\nSee: listener.tcp.$name.nodelay\n\nValue: true | false\nlistener.tcp.internal.nodelay = false\nThe SO_REUSEADDR flag for MQTT/TCP Listener.\n\nValue: true | false\nlistener.tcp.internal.reuseaddr = true\n--------------------------------------------------------------------\nMQTT/SSL - External SSL Listener for MQTT Protocol\nlistener.ssl.$name is the IP address and port that the MQTT/SSL\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 8883, 127.0.0.1:8883, ::1:8883\nlistener.ssl.external = 8883\nThe acceptor pool for external MQTT/SSL listener.\n\nValue: Number\nlistener.ssl.external.acceptors = 16\nMaximum number of concurrent MQTT/SSL connections.\n\nValue: Number\nlistener.ssl.external.max_connections = 102400\nMaximum MQTT/SSL connections per second.\n\nValue: Number\nlistener.ssl.external.max_conn_rate = 500\nZone of the external MQTT/SSL listener belonged to.\n\nValue: String\nlistener.ssl.external.zone = external\nMountpoint of the MQTT/SSL Listener.\n\nValue: String\nlistener.ssl.external.mountpoint = devicebound/\nThe access control rules for the MQTT/SSL listener.\n\nSee: listener.tcp.$name.access\n\nValue: ACL Rule\nlistener.ssl.external.access.1 = allow all\nRate limit for the external MQTT/SSL connections.\n\nValue: rate,burst\nUnit: Bps\nlistener.ssl.external.rate_limit = 1024,4096\nEnable the Proxy Protocol V1/2 if the EMQ cluster is deployed behind\nHAProxy or Nginx.\n\nSee: listener.tcp.$name.proxy_protocol\n\nValue: on | off\nlistener.ssl.external.proxy_protocol = on\nSets the timeout for proxy protocol.\n\nSee: listener.tcp.$name.proxy_protocol_timeout\n\nValue: Duration\nlistener.ssl.external.proxy_protocol_timeout = 3s\nTLS versions only to protect from POODLE attack.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: String, seperated by ','\nlistener.ssl.external.tls_versions = tlsv1.2,tlsv1.1,tlsv1\nTLS Handshake timeout.\n\nValue: Duration\nlistener.ssl.external.handshake_timeout = 15s\nPath to the file containing the user's private PEM-encoded key.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: File\nlistener.ssl.external.keyfile = etc/certs/key.pem\nPath to a file containing the user certificate.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: File\nlistener.ssl.external.certfile = etc/certs/cert.pem\nPath to the file containing PEM-encoded CA certificates. The CA certificates\nare used during server authentication and when building the client certificate chain.\n\nValue: File\nlistener.ssl.external.cacertfile = etc/certs/cacert.pem\nThe Ephemeral Diffie-Helman key exchange is a very effective way of\nensuring Forward Secrecy by exchanging a set of keys that never hit\nthe wire. Since the DH key is effectively signed by the private key,\nit needs to be at least as strong as the private key. In addition,\nthe default DH groups that most of the OpenSSL installations have\nare only a handful (since they are distributed with the OpenSSL\npackage that has been built for the operating system it\u2019s running on)\nand hence predictable (not to mention, 1024 bits only).\nIn order to escape this situation, first we need to generate a fresh,\nstrong DH group, store it in a file and then use the option above,\nto force our SSL application to use the new DH group. Fortunately,\nOpenSSL provides us with a tool to do that. Simply run:\nopenssl dhparam -out dh-params.pem 2048\n\nValue: File\nlistener.ssl.external.dhfile = etc/certs/dh-params.pem\nA server only does x509-path validation in mode verify_peer,\nas it then sends a certificate request to the client (this\nmessage is not sent if the verify option is verify_none).\nYou can then also want to specify option fail_if_no_peer_cert.\nMore information at: http://erlang.org/doc/man/ssl.html\n\nValue: verify_peer | verify_none\nlistener.ssl.external.verify = verify_peer\nUsed together with {verify, verify_peer} by an SSL server. If set to true,\nthe server fails if the client does not have a certificate to send, that is,\nsends an empty certificate.\n\nValue: true | false\nlistener.ssl.external.fail_if_no_peer_cert = true\nThis is the single most important configuration option of an Erlang SSL\napplication. Ciphers (and their ordering) define the way the client and\nserver encrypt information over the wire, from the initial Diffie-Helman\nkey exchange, the session key encryption ## algorithm and the message\ndigest algorithm. Selecting a good cipher suite is critical for the\napplication\u2019s data security, confidentiality and performance.\n\nThe cipher list above offers:\n\nA good balance between compatibility with older browsers.\nIt can get stricter for Machine-To-Machine scenarios.\nPerfect Forward Secrecy.\nNo old/insecure encryption and HMAC algorithms\n\nMost of it was copied from Mozilla\u2019s Server Side TLS article\n\nValue: Ciphers\nlistener.ssl.external.ciphers = ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384,ECDHE-ECDSA-AES256-SHA384,ECDHE-RSA-AES256-SHA384,ECDHE-ECDSA-DES-CBC3-SHA,ECDH-ECDSA-AES256-GCM-SHA384,ECDH-RSA-AES256-GCM-SHA384,ECDH-ECDSA-AES256-SHA384,ECDH-RSA-AES256-SHA384,DHE-DSS-AES256-GCM-SHA384,DHE-DSS-AES256-SHA256,AES256-GCM-SHA384,AES256-SHA256,ECDHE-ECDSA-AES128-GCM-SHA256,ECDHE-RSA-AES128-GCM-SHA256,ECDHE-ECDSA-AES128-SHA256,ECDHE-RSA-AES128-SHA256,ECDH-ECDSA-AES128-GCM-SHA256,ECDH-RSA-AES128-GCM-SHA256,ECDH-ECDSA-AES128-SHA256,ECDH-RSA-AES128-SHA256,DHE-DSS-AES128-GCM-SHA256,DHE-DSS-AES128-SHA256,AES128-GCM-SHA256,AES128-SHA256,ECDHE-ECDSA-AES256-SHA,ECDHE-RSA-AES256-SHA,DHE-DSS-AES256-SHA,ECDH-ECDSA-AES256-SHA,ECDH-RSA-AES256-SHA,AES256-SHA,ECDHE-ECDSA-AES128-SHA,ECDHE-RSA-AES128-SHA,DHE-DSS-AES128-SHA,ECDH-ECDSA-AES128-SHA,ECDH-RSA-AES128-SHA,AES128-SHA\nSSL parameter renegotiation is a feature that allows a client and a server\nto renegotiate the parameters of the SSL connection on the fly.\nRFC 5746 defines a more secure way of doing this. By enabling secure renegotiation,\nyou drop support for the insecure renegotiation, prone to MitM attacks.\n\nValue: on | off\nlistener.ssl.external.secure_renegotiate = off\nA performance optimization setting, it allows clients to reuse\npre-existing sessions, instead of initializing new ones.\nRead more about it here.\n\nSee: http://erlang.org/doc/man/ssl.html\n\nValue: on | off\nlistener.ssl.external.reuse_sessions = on\nAn important security setting, it forces the cipher to be set based\non the server-specified order instead of the client-specified order,\nhence enforcing the (usually more properly configured) security\nordering of the server administrator.\n\nValue: on | off\nlistener.ssl.external.honor_cipher_order = on\nUse the CN, EN or CRT field from the client certificate as a username.\nNotice that 'verify' should be set as 'verify_peer'.\n\nValue: cn | en | crt\nlistener.ssl.external.peer_cert_as_username = cn\nTCP backlog for the SSL connection.\n\nSee listener.tcp.$name.backlog\n\nValue: Number >= 0\nlistener.ssl.external.backlog = 1024\nThe TCP send timeout for the SSL connection.\n\nSee listener.tcp.$name.send_timeout\n\nValue: Duration\nlistener.ssl.external.send_timeout = 15s\nClose the SSL connection if send timeout.\n\nSee: listener.tcp.$name.send_timeout_close\n\nValue: on | off\nlistener.ssl.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for the SSL connections.\n\nSee: listener.tcp.$name.recbuf\n\nValue: Bytes\nlistener.ssl.external.recbuf = 4KB\nThe TCP send buffer(os kernel) for internal MQTT connections.\n\nSee: listener.tcp.$name.sndbuf\n\nValue: Bytes\nlistener.ssl.external.sndbuf = 4KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp.$name.buffer\n\nValue: Bytes\nlistener.ssl.external.buffer = 4KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nSee: listener.tcp.$name.tune_buffer\n\nValue: on | off\nlistener.ssl.external.tune_buffer = off\nThe TCP_NODELAY flag for SSL connections.\n\nSee: listener.tcp.$name.nodelay\n\nValue: true | false\nlistener.ssl.external.nodelay = true\nThe SO_REUSEADDR flag for MQTT/SSL Listener.\n\nValue: true | false\nlistener.ssl.external.reuseaddr = true\n--------------------------------------------------------------------\nExternal WebSocket listener for MQTT protocol\nlistener.ws.$name is the IP address and port that the MQTT/WebSocket\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 8083, 127.0.0.1:8083, ::1:8083\nlistener.ws.external = 8083\nThe path of WebSocket MQTT endpoint\n\nValue: URL Path\nlistener.ws.external.mqtt_path = /mqtt\nThe acceptor pool for external MQTT/WebSocket listener.\n\nValue: Number\nlistener.ws.external.acceptors = 4\nMaximum number of concurrent MQTT/WebSocket connections.\n\nValue: Number\nlistener.ws.external.max_connections = 102400\nMaximum MQTT/WebSocket connections per second.\n\nValue: Number\nlistener.ws.external.max_conn_rate = 1000\nRate limit for the MQTT/WebSocket connections.\n\nValue: rate,burst\nUnit: Bps\nlistener.ws.external.rate_limit = 1024,4096\nZone of the external MQTT/WebSocket listener belonged to.\n\nValue: String\nlistener.ws.external.zone = external\nMountpoint of the MQTT/WebSocket Listener.\n\nSee: listener.tcp.$name.mountpoint\n\nValue: String\nlistener.ws.external.mountpoint = devicebound/\nThe access control for the MQTT/WebSocket listener.\n\nSee: listener.tcp.$name.access\n\nValue: ACL Rule\nlistener.ws.external.access.1 = allow all\nVerify if the protocol header is valid. Turn off for WeChat MiniApp.\n\nValue: on | off\nlistener.ws.external.verify_protocol_header = on\nUse X-Forwarded-For header for real source IP if the EMQ X cluster is\ndeployed behind NGINX or HAProxy.\n\nValue: String\nlistener.ws.external.proxy_address_header = X-Forwarded-For\nUse X-Forwarded-Port header for real source port if the EMQ X cluster is\ndeployed behind NGINX or HAProxy.\n\nValue: String\nlistener.ws.external.proxy_port_header = X-Forwarded-Port\nEnable the Proxy Protocol V1/2 if the EMQ cluster is deployed behind\nHAProxy or Nginx.\n\nSee: listener.tcp.$name.proxy_protocol\n\nValue: on | off\nlistener.ws.external.proxy_protocol = on\nSets the timeout for proxy protocol.\n\nSee: listener.tcp.$name.proxy_protocol_timeout\n\nValue: Duration\nlistener.ws.external.proxy_protocol_timeout = 3s\nThe TCP backlog of external MQTT/WebSocket Listener.\n\nSee: listener.tcp.$name.backlog\n\nValue: Number >= 0\nlistener.ws.external.backlog = 1024\nThe TCP send timeout for external MQTT/WebSocket connections.\n\nSee: listener.tcp.$name.send_timeout\n\nValue: Duration\nlistener.ws.external.send_timeout = 15s\nClose the MQTT/WebSocket connection if send timeout.\n\nSee: listener.tcp.$name.send_timeout_close\n\nValue: on | off\nlistener.ws.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for external MQTT/WebSocket connections.\n\nSee: listener.tcp.$name.recbuf\n\nValue: Bytes\nlistener.ws.external.recbuf = 2KB\nThe TCP send buffer(os kernel) for external MQTT/WebSocket connections.\n\nSee: listener.tcp.$name.sndbuf\n\nValue: Bytes\nlistener.ws.external.sndbuf = 2KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp.$name.buffer\n\nValue: Bytes\nlistener.ws.external.buffer = 2KB\nSets the 'buffer = max(sndbuf, recbuf)' if this option is enabled.\n\nSee: listener.tcp.$name.tune_buffer\n\nValue: on | off\nlistener.ws.external.tune_buffer = off\nThe TCP_NODELAY flag for external MQTT/WebSocket connections.\n\nSee: listener.tcp.$name.nodelay\n\nValue: true | false\nlistener.ws.external.nodelay = true\n--------------------------------------------------------------------\nExternal WebSocket/SSL listener for MQTT Protocol\nlistener.wss.$name is the IP address and port that the MQTT/WebSocket/SSL\nlistener will bind.\n\nValue: IP:Port | Port\n\nExamples: 8084, 127.0.0.1:8084, ::1:8084\nlistener.wss.external = 8084\nThe path of WebSocket MQTT endpoint\n\nValue: URL Path\nlistener.wss.external.mqtt_path = /mqtt\nThe acceptor pool for external MQTT/WebSocket/SSL listener.\n\nValue: Number\nlistener.wss.external.acceptors = 4\nMaximum number of concurrent MQTT/Webwocket/SSL connections.\n\nValue: Number\nlistener.wss.external.max_connections = 16\nMaximum MQTT/WebSocket/SSL connections per second.\n\nSee: listener.tcp.$name.max_conn_rate\n\nValue: Number\nlistener.wss.external.max_conn_rate = 1000\nRate limit for the MQTT/WebSocket/SSL connections.\n\nValue: rate,burst\nUnit: Bps\nlistener.wss.external.rate_limit = 1024,4096\nZone of the external MQTT/WebSocket/SSL listener belonged to.\n\nValue: String\nlistener.wss.external.zone = external\nMountpoint of the MQTT/WebSocket/SSL Listener.\n\nSee: listener.tcp.$name.mountpoint\n\nValue: String\nlistener.wss.external.mountpoint = devicebound/\nThe access control rules for the MQTT/WebSocket/SSL listener.\n\nSee: listener.tcp.$name.access.\n\nValue: ACL Rule\nlistener.wss.external.access.1 = allow all\nSee: listener.ws.external.verify_protocol_header\n\nValue: on | off\nlistener.wss.external.verify_protocol_header = on\nSee: listener.ws.external.proxy_address_header\n\nValue: String\nlistener.wss.external.proxy_address_header = X-Forwarded-For\nSee: listener.ws.external.proxy_port_header\n\nValue: String\nlistener.wss.external.proxy_port_header = X-Forwarded-Port\nEnable the Proxy Protocol V1/2 support.\n\nSee: listener.tcp.$name.proxy_protocol\n\nValue: on | off\nlistener.wss.external.proxy_protocol = on\nSets the timeout for proxy protocol.\n\nSee: listener.tcp.$name.proxy_protocol_timeout\n\nValue: Duration\nlistener.wss.external.proxy_protocol_timeout = 3s\nTLS versions only to protect from POODLE attack.\n\nSee: listener.ssl.$name.tls_versions\n\nValue: String, seperated by ','\nlistener.wss.external.tls_versions = tlsv1.2,tlsv1.1,tlsv1\nPath to the file containing the user's private PEM-encoded key.\n\nSee: listener.ssl.$name.keyfile\n\nValue: File\nlistener.wss.external.keyfile = etc/certs/key.pem\nPath to a file containing the user certificate.\n\nSee: listener.ssl.$name.certfile\n\nValue: File\nlistener.wss.external.certfile = etc/certs/cert.pem\nPath to the file containing PEM-encoded CA certificates.\n\nSee: listener.ssl.$name.cacert\n\nValue: File\nlistener.wss.external.cacertfile = etc/certs/cacert.pem\nSee: listener.ssl.$name.dhfile\n\nValue: File\nlistener.ssl.external.dhfile = etc/certs/dh-params.pem\nSee: listener.ssl.$name.vefify\n\nValue: vefify_peer | verify_none\nlistener.wss.external.verify = verify_peer\nSee: listener.ssl.$name.fail_if_no_peer_cert\n\nValue: false | true\nlistener.wss.external.fail_if_no_peer_cert = true\nSee: listener.ssl.$name.ciphers\n\nValue: Ciphers\nlistener.wss.external.ciphers =\nSee: listener.ssl.$name.secure_renegotiate\n\nValue: on | off\nlistener.wss.external.secure_renegotiate = off\nSee: listener.ssl.$name.reuse_sessions\n\nValue: on | off\nlistener.wss.external.reuse_sessions = on\nSee: listener.ssl.$name.honor_cipher_order\n\nValue: on | off\nlistener.wss.external.honor_cipher_order = on\nSee: listener.ssl.$name.peer_cert_as_username\n\nValue: cn | dn | crt\nlistener.wss.external.peer_cert_as_username = cn\nTCP backlog for the WebSocket/SSL connection.\n\nSee: listener.tcp.$name.backlog\n\nValue: Number >= 0\nlistener.wss.external.backlog = 1024\nThe TCP send timeout for the WebSocket/SSL connection.\n\nSee: listener.tcp.$name.send_timeout\n\nValue: Duration\nlistener.wss.external.send_timeout = 15s\nClose the WebSocket/SSL connection if send timeout.\n\nSee: listener.tcp.$name.send_timeout_close\n\nValue: on | off\nlistener.wss.external.send_timeout_close = on\nThe TCP receive buffer(os kernel) for the WebSocket/SSL connections.\n\nSee: listener.tcp.$name.recbuf\n\nValue: Bytes\nlistener.wss.external.recbuf = 4KB\nThe TCP send buffer(os kernel) for the WebSocket/SSL connections.\n\nSee: listener.tcp.$name.sndbuf\n\nValue: Bytes\nlistener.wss.external.sndbuf = 4KB\nThe size of the user-level software buffer used by the driver.\n\nSee: listener.tcp.$name.buffer\n\nValue: Bytes\nlistener.wss.external.buffer = 4KB\nThe TCP_NODELAY flag for WebSocket/SSL connections.\n\nSee: listener.tcp.$name.nodelay\n\nValue: true | false\nlistener.wss.external.nodelay = true\nlistener.wss.external.ciphers = ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384,ECDHE-ECDSA-AES256-SHA384,ECDHE-RSA-AES256-SHA384,ECDHE-ECDSA-DES-CBC3-SHA,ECDH-ECDSA-AES256-GCM-SHA384,ECDH-RSA-AES256-GCM-SHA384,ECDH-ECDSA-AES256-SHA384,ECDH-RSA-AES256-SHA384,DHE-DSS-AES256-GCM-SHA384,DHE-DSS-AES256-SHA256,AES256-GCM-SHA384,AES256-SHA256,ECDHE-ECDSA-AES128-GCM-SHA256,ECDHE-RSA-AES128-GCM-SHA256,ECDHE-ECDSA-AES128-SHA256,ECDHE-RSA-AES128-SHA256,ECDH-ECDSA-AES128-GCM-SHA256,ECDH-RSA-AES128-GCM-SHA256,ECDH-ECDSA-AES128-SHA256,ECDH-RSA-AES128-SHA256,DHE-DSS-AES128-GCM-SHA256,DHE-DSS-AES128-SHA256,AES128-GCM-SHA256,AES128-SHA256,ECDHE-ECDSA-AES256-SHA,ECDHE-RSA-AES256-SHA,DHE-DSS-AES256-SHA,ECDH-ECDSA-AES256-SHA,ECDH-RSA-AES256-SHA,AES256-SHA,ECDHE-ECDSA-AES128-SHA,ECDHE-RSA-AES128-SHA,DHE-DSS-AES128-SHA,ECDH-ECDSA-AES128-SHA,ECDH-RSA-AES128-SHA,AES128-SHA\n--------------------------------------------------------------------\nBridges\n--------------------------------------------------------------------\n--------------------------------------------------------------------\nBridges to aws\n--------------------------------------------------------------------\nStart type of the bridge.\n\nValue: enum\nmanual\nauto\nbridge.aws.start_type = manual\nBridge reconnect time.\n\nValue: Duration\nDefault: 30 seconds\nbridge.aws.reconnect_interval = 30s\nBridge address: node name for local bridge, host:port for remote.\n\nValue: String\nExample: emqx@127.0.0.1,  127.0.0.1:1883\nbridge.aws.address = 127.0.0.1:1883\nProtocol version of the bridge.\n\nValue: Enum\n- mqttv5\n- mqttv4\n- mqttv3\nbridge.aws.proto_ver = mqttv4\nThe ClientId of a remote bridge.\n\nValue: String\nbridge.aws.client_id = bridge_aws\nThe Clean start flag of a remote bridge.\n\nValue: boolean\nDefault: true\n\nNOTE: Some IoT platforms require clean_start\nmust be set to 'true'\nbridge.aws.clean_start = true\nThe username for a remote bridge.\n\nValue: String\nbridge.aws.username = user\nThe password for a remote bridge.\n\nValue: String\nbridge.aws.password = passwd\nMountpoint of the bridge.\n\nValue: String\nbridge.aws.mountpoint = bridge/aws/${node}/\nPing interval of a down bridge.\n\nValue: Duration\nDefault: 10 seconds\nbridge.aws.keepalive = 60s\nForward message topics\n\nValue: String\nExample: topic1/#,topic2/\nbridge.aws.forwards = topic1/#,topic2/#\nSubscriptions of the bridge topic.\n\nValue: String\nbridge.aws.subscription.1.topic = cmd/topic1\nSubscriptions of the bridge qos.\n\nValue: Number\nbridge.aws.subscription.1.qos = 1\nSubscriptions of the bridge topic.\n\nValue: String\nbridge.aws.subscription.2.topic = cmd/topic2\nSubscriptions of the bridge qos.\n\nValue: Number\nbridge.aws.subscription.2.qos = 1\nBridge message queue message type.\n\nValue: Enum\nExample: memory | disk\nbridge.aws.mqueue_type = memory\nThe pending message queue of a bridge.\n\nValue: Number\nbridge.aws.max_pending_messages = 10000\nBribge to remote server via SSL.\n\nValue: on | off\nbridge.aws.ssl = off\nPEM-encoded CA certificates of the bridge.\n\nValue: File\nbridge.aws.cacertfile = etc/certs/cacert.pem\nClient SSL Certfile of the bridge.\n\nValue: File\nbridge.aws.certfile = etc/certs/client-cert.pem\nClient SSL Keyfile of the bridge.\n\nValue: File\nbridge.aws.keyfile = etc/certs/client-key.pem\nSSL Ciphers used by the bridge.\n\nValue: String\nbridge.aws.ciphers = ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384\nTLS versions used by the bridge.\n\nValue: String\nbridge.aws.tls_versions = tlsv1.2,tlsv1.1,tlsv1\n--------------------------------------------------------------------\nBridges to azure\n--------------------------------------------------------------------\nStart type of the bridge.\n\nValue: enum\nmanual\nauto\nbridge.azure.start_type = manual\nBridge reconnect count.\n\nValue: Number\nbridge.azure.reconnect_count = 10\nBridge reconnect time.\n\nValue: Duration\nDefault: 30 seconds\nbridge.azure.reconnect_time = 30s\nBridge address: node name for local bridge, host:port for remote.\n\nValue: String\nExample: emqx@127.0.0.1,  127.0.0.1:1883\nbridge.azure.address = 127.0.0.1:1883\nProtocol version of the bridge.\n\nValue: Enum\n- mqttv5\n- mqttv4\n- mqttv3\nbridge.azure.proto_ver = mqttv4\nThe ClientId of a remote bridge.\n\nValue: String\nbridge.azure.client_id = bridge_azure\nThe Clean start flag of a remote bridge.\n\nValue: boolean\nDefault: true\n\nNOTE: Some IoT platforms require clean_start\nmust be set to 'true'\nbridge.azure.clean_start = true\nThe username for a remote bridge.\n\nValue: String\nbridge.azure.username = user\nThe password for a remote bridge.\n\nValue: String\nbridge.azure.password = passwd\nMountpoint of the bridge.\n\nValue: String\nbridge.azure.mountpoint = bridge/azure/${node}/\nPing interval of a down bridge.\n\nValue: Duration\nDefault: 10 seconds\nbridge.azure.keepalive = 10s\nForward message topics\n\nValue: String\nExample: topic1/#,topic2/\nbridge.azure.forwards = topic1/#,topic2/\nSubscriptions of the bridge topic.\n\nValue: String\nbridge.azure.subscription.1.topic = $share/cmd/topic1\nSubscriptions of the bridge qos.\n\nValue: Number\nbridge.azure.subscription.1.qos = 1\nSubscriptions of the bridge topic.\n\nValue: String\nbridge.azure.subscription.2.topic = $share/cmd/topic2\nSubscriptions of the bridge qos.\n\nValue: Number\nbridge.azure.subscription.2.qos = 1\nBridge store message type.\n\nValue: Enum\nExample: memory | disk\nbridge.azure.store_type = memory\nThe pending message queue of a bridge.\n\nValue: Number\nbridge.azure.max_pending_messages = 10000\nPEM-encoded CA certificates of the bridge.\n\nValue: File\nbridge.azure.cacertfile = cacert.pem\nClient SSL Certfile of the bridge.\n\nValue: File\nbridge.azure.certfile = cert.pem\nClient SSL Keyfile of the bridge.\n\nValue: File\nbridge.azure.keyfile = key.pem\nSSL Ciphers used by the bridge.\n\nValue: String\nbridge.azure.ciphers = ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384\nTLS versions used by the bridge.\n\nValue: String\nbridge.azure.tls_versions = tlsv1.2,tlsv1.1,tlsv1\n--------------------------------------------------------------------\nModules\n--------------------------------------------------------------------\n--------------------------------------------------------------------\nPresence Module\nEnable Presence Module.\n\nValue: on | off\nmodule.presence = on\nSets the QoS for presence MQTT message.\n\nValue: 0 | 1 | 2\nmodule.presence.qos = 1\n--------------------------------------------------------------------\nSubscription Module\nEnable Subscription Module.\n\nValue: on | off\nmodule.subscription = off\nSubscribe the Topics automatically when client connected.\nmodule.subscription.1.topic = $client/%c\nQos of the subscription: 0 | 1 | 2\nmodule.subscription.1.qos = 1\nmodule.subscription.2.topic = $user/%u\nmodule.subscription.2.qos = 1\n--------------------------------------------------------------------\nRewrite Module\nEnable Rewrite Module.\n\nValue: on | off\nmodule.rewrite = off\n{rewrite, Topic, Re, Dest}\nmodule.rewrite.rule.1 = x/# ^x/y/(.+)$ z/y/$1\nmodule.rewrite.rule.2 = y/+/z/# ^y/(.+)/z/(.+)$ y/z/$2\n-------------------------------------------------------------------\nPlugins\n-------------------------------------------------------------------\nThe etc dir for plugins' config.\n\nValue: Folder\nplugins.etc_dir = etc/plugins/\nThe file to store loaded plugin names.\n\nValue: File\nplugins.loaded_file = data/loaded_plugins\nFile to store loaded plugin names.\nplugins.expand_plugins_dir = plugins/\n--------------------------------------------------------------------\nBroker\n--------------------------------------------------------------------\nSystem interval of publishing $SYS messages.\n\nValue: Duration\nDefault: 1m, 1 minute\nbroker.sys_interval = 1m\nSession locking strategy in a cluster.\n\nValue: Enum\n- local\n- one\n- quorum\n- all\nbroker.session_locking_strategy = quorum\nDispatch strategy for shared subscription\n\nValue: Enum\n- random\n- round_robbin\n- sticky\n- hash\nbroker.shared_subscription_strategy = random\nEnable batch clean for deleted routes.\n\nValue: Flag\nbroker.route_batch_clean = on\n--------------------------------------------------------------------\nSystem Monitor\n--------------------------------------------------------------------\nEnable Long GC monitoring.\nNotice: don't enable the monitor in production for:\nhttps://github.com/erlang/otp/blob/feb45017da36be78d4c5784d758ede619fa7bfd3/erts/emulator/beam/erl_gc.c#L421\n\nValue: true | false\nsysmon.long_gc = false\nEnable Long Schedule(ms) monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: Number\nsysmon.long_schedule = 240\nEnable Large Heap monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: bytes\n\nDefault: 8M words. 32MB on 32-bit VM, 64MB on 64-bit VM.\nsysmon.large_heap = 8MB\nEnable Busy Port monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: true | false\nsysmon.busy_port = false\nEnable Busy Dist Port monitoring.\n\nSee: http://erlang.org/doc/man/erlang.html#system_monitor-2\n\nValue: true | false\nsysmon.busy_dist_port = true\n```\n. I used the mosquitto_pub tool to send the MQTT message with the following command:\nmosquitto_pub -p 1883 -h 127.0.0.1 -t \"/v1.6/devices/mqtt\" -u 'XsLcvtqD1ZHs4gvfuzKKu3NICfuyRP' -P 'XsLcvtqD1ZHs4gvfuzKKu3NICfuyRP' -m '{\"v1\": {\"value\": \"5\"}, \"t2\": {\"value\":1}}' -d -q 1\nMore information about this command in https://mosquitto.org/man/mosquitto_pub-1.html. ",
    "Morphiaaa": "Hi, I just figured out what's the main issue. I should make mqtt server hold server cert chain, and make the client hold device cert chain. I mis-placed the cert chain.. ",
    "protostartup": "Hi Gilbert,\nJust read the doc you referred, My question is If Cluster A has Node A1 and A2 and Cluster B has node B1 and B2 and there exists a Bridge A2 ---/# ----- B2,\nIf I subscribe for a topic on A1 and Publish for the same topic on B1 will I receive the Msg???\n . The above setup was not working, This was because the bridge subscriptions are local to the node. \nAnyhow I solved the issue by making the subscriptions shared. \nThanks for the help . ",
    "andy1247008998": "\nfixed by input correct credentials in emqx_auth_mysql.conf.\nWeb GUI should provide much more friendly error info rather than 500 error.\nDatabase plugin should be loaded even if it can not connect to the database. Let's say if we lost connection to a remote database for only 1 minute, caused by database service reboot or Internet shaking, database plugin may crash for hours until someone manually restart emqx.\nWhen I click config in Web GUI, I get Network Error and No Default Configuration, even when this plugin is loaded.. \n",
    "boboxiaodd": "@terry-xiaoyu \nwhen  client A connected with a same client_id of client B,  client B will be kickout ,\nclient B reconnect , will recv \"bad user name or password\" or \"not authorized\"   and stop reconnect . @tigercl  i know , but client will reconnect which  be kickout, it's loop\nclient need a flag to know it is be kickout , and stop reconnect , so i need  4 or 5 flag return\n. @tigercl  our client will logout  when recv \"bad user name or password\" , so i need  emqx_auth_http can return flag 4 \ni am from vernemq , it can do it.. @tigercl  i use emqx_auth_http , correct password it return 200, bad password it return 4xx,\nbut client recv a disconnect , not flag 4. @Gilbert-Wong \nour client recv flag 4 will stop reconnect,  how to do it with emqx ?\ni use emqx_auth_http , my boss will not do change client code.. > @boboxiaodd\u5982\u679c\u60a8\u5e0c\u671b\u670d\u52a1\u5668\u5728\u5ba2\u6237\u7aef\u4f7f\u7528\u6b63\u786e\u7684\u5bc6\u7801\u65f6\u8fd4\u56de\u201c\u9519\u8bef\u7684\u7528\u6237\u540d\u6216\u5bc6\u7801\u201d\uff0c\u6211\u4eec\u5c31\u65e0\u6cd5\u505a\u5230\u3002\nclient's password is wrong , in emqx_auth_http , i return 40X,   but client can't get the flag 4 , . @turtleDeng \ni have diffect qos of these topics ... i mean is  topic1 's qos is 0 , and topic2 's qos is 2. ",
    "six-six-six": "rebar3 hava alreay installed.\nroot@xxx:~/sunjinhui/emq-relx# rebar3 version\nrebar 3.7.0-rc2+build.4191.ref9c24f55 on Erlang/OTP 21 Erts 10.1\nbut i  facing new problems. I don't know how to solve it. can you help me?\nTLS client: In state certify at ssl_handshake.erl:1371 generated CLIENT ALERT: Fatal - Unknown CA\nmake[1]: Leaving directory '/root/sunjinhui/emq-relx/deps/emqx_web_hook'\nmake[1]: Entering directory '/root/sunjinhui/emq-relx/deps/emqx_auth_jwt'\nmake[2]: Entering directory '/root/sunjinhui/emq-relx/deps/jwerl'\n===> No entry for profile default in config.\n===> Verifying dependencies...\n===> Fetching jsx ({pkg,<<\"jsx\">>,<<\"2.9.0\">>})\n=INFO REPORT==== 19-Nov-2018::11:38:52.688422 ===\nTLS client: In state certify at ssl_handshake.erl:1371 generated CLIENT ALERT: Fatal - Unknown CA\n===> Failed to fetch and copy dep: jsx-2.9.0\nbu.mk:186: recipe for target 'compile-erl' failed\nmake[2]:  [compile-erl] Error 1\nmake[2]: Leaving directory '/root/sunjinhui/emq-relx/deps/jwerl'\n../../erlang.mk:312: recipe for target 'deps' failed\nmake[1]:  [deps] Error 2\nmake[1]: Leaving directory '/root/sunjinhui/emq-relx/deps/emqx_auth_jwt'\nerlang.mk:310: recipe for target 'deps' failed\nmake:  [deps] Error 2\n. *I use rebar3 upgrade, i find it is not work.\nI use proxy. is something am not config?\nroot@xxx:~/myapp# rebar3 local upgrade DEBUG=1\n===> Unable to fetch latest rebar3 escript. Please try again later.\n=INFO REPORT==== 19-Nov-2018::11:49:14.727180 ===\nTLS client: In state certify at ssl_handshake.erl:1371 generated CLIENT ALERT: Fatal - Unknown CA\n===> Uncaught error in rebar_core. Run with DEBUG=1 to see stacktrace or consult rebar3.crashdump\n===> When submitting a bug report, please include the output of rebar3 report \"your command\"\n. but i see official website documentation is supported\uff0cIs it wrong?\nhttps://www.rebar3.org/docs/configuration\nhttp_proxy                   # standard proxy ENV variable is respected\nhttps_proxy                  # standard proxy ENV variable is respected\nCan you help with the method of setting up the proxy under rebar3?. ok\uff01 I am using otp 20 to compile it. \nSee if the problem can be solved. I reinstalled the Erlang/OTP 20 version\nroot@xxx:~/sunjinhui/emqx-relx# erl\nErlang/OTP 20 [erts-9.3.3.3] [source] [64-bit] [smp:6:6] [ds:6:6:10] [async-threads:10] [hipe] [kernel-poll:false]\nI downloaded the tar -zxvf emqx-2.3.11.tar.gz package.\nExecute the following command:\ntar -zxvf emqx-2.3.11.tar.gz\nmv emqx-2.3.11 emqx-relx\nmake\nThis is all the compilation log\nroot@xxx:~/sunjinhui/emqx-relx# make\nmake[1]: Entering directory '/root/sunjinhui/emqx-relx/deps/cuttlefish'\n./rebar get-deps\n==> getopt (get-deps)\n==> goldrush (get-deps)\n==> lager (get-deps)\n==> neotoma (get-deps)\n==> cuttlefish (get-deps)\n./rebar compile\n==> getopt (compile)\n==> goldrush (compile)\n==> lager (compile)\n==> neotoma (compile)\n==> cuttlefish (compile)\n==> getopt (escriptize)\n==> goldrush (escriptize)\n==> lager (escriptize)\n==> neotoma (escriptize)\n==> cuttlefish (escriptize)\n./rebar skip_deps=true escriptize\n==> cuttlefish (escriptize)\nmake[1]: Leaving directory '/root/sunjinhui/emqx-relx/deps/cuttlefish'\nmake[1]: Entering directory '/root/sunjinhui/emqx-relx/deps/goldrush'\nmake[1]: Leaving directory '/root/sunjinhui/emqx-relx/deps/goldrush'\nmake[1]: Entering directory '/root/sunjinhui/emqx-relx/deps/gproc'\nmake[1]: Leaving directory '/root/sunjinhui/emqx-relx/deps/gproc'\nmake[1]: Entering directory '/root/sunjinhui/emqx-relx/deps/lager'\n DEPEND lager.d\nmake[1]: Leaving directory '/root/sunjinhui/emqx-relx/deps/lager'\nmake[1]: Entering directory '/root/sunjinhui/emqx-relx/deps/esockd'\nmake[2]: Entering directory '/root/sunjinhui/emqx-relx/deps/gen_logger'\n DEPEND gen_logger.d\nmake[2]: Leaving directory '/root/sunjinhui/emqx-relx/deps/gen_logger'\n GEN    rebar.config\nmake[1]: Leaving directory '/root/sunjinhui/emqx-relx/deps/esockd'\nmake[1]: Entering directory '/root/sunjinhui/emqx-relx/deps/ekka'\nmake[2]: Entering directory '/root/sunjinhui/emqx-relx/deps/jsx'\nmake[2]: Leaving directory '/root/sunjinhui/emqx-relx/deps/jsx'\n DEPEND ekka.d\nmake[1]: Leaving directory '/root/sunjinhui/emqx-relx/deps/ekka'\nmake[1]: Entering directory '/root/sunjinhui/emqx-relx/deps/mochiweb'\nmake[1]: Leaving directory '/root/sunjinhui/emqx-relx/deps/mochiweb'\nmake[1]: Entering directory '/root/sunjinhui/emqx-relx/deps/pbkdf2'\nmake[1]: Leaving directory '/root/sunjinhui/emqx-relx/deps/pbkdf2'\nmake[1]: Entering directory '/root/sunjinhui/emqx-relx/deps/lager_syslog'\nmake[2]: Entering directory '/root/sunjinhui/emqx-relx/deps/syslog'\nmake -f c_src/Makefile.erlang.mk\nmake[3]: Entering directory '/root/sunjinhui/emqx-relx/deps/syslog'\nmake[3]: Nothing to be done for 'all'.\nmake[3]: Leaving directory '/root/sunjinhui/emqx-relx/deps/syslog'\nmake[2]: Leaving directory '/root/sunjinhui/emqx-relx/deps/syslog'\nmake[1]: Leaving directory '/root/sunjinhui/emqx-relx/deps/lager_syslog'\nmake[1]: Entering directory '/root/sunjinhui/emqx-relx/deps/bcrypt'\nmake -f c_src/Makefile.erlang.mk\nmake[2]: Entering directory '/root/sunjinhui/emqx-relx/deps/bcrypt'\nmake[2]: Nothing to be done for 'all'.\nmake[2]: Leaving directory '/root/sunjinhui/emqx-relx/deps/bcrypt'\nmake[1]: Leaving directory '/root/sunjinhui/emqx-relx/deps/bcrypt'\nmake[1]: Entering directory '/root/sunjinhui/emqx-relx/deps/clique'\n DEPEND clique.d\nmake[1]: Leaving directory '/root/sunjinhui/emqx-relx/deps/clique'\n DEPEND emqttd.d\n ERLC   emqttd.erl emqttd_access_control.erl emqttd_access_rule.erl emqttd_acl_internal.erl emqttd_acl_mod.erl emqttd_alarm.erl emqttd_app.erl emqttd_auth_mod.erl emqttd_base62.erl emqttd_boot.erl emqttd_bridge.erl emqttd_bridge_sup.erl emqttd_bridge_sup_sup.erl emqttd_broker.erl emqttd_cli.erl emqttd_cli_config.erl emqttd_client.erl emqttd_cm.erl emqttd_cm_sup.erl emqttd_config.erl emqttd_ctl.erl emqttd_gc.erl emqttd_gen_mod.erl emqttd_guid.erl emqttd_hooks.erl emqttd_http.erl emqttd_inflight.erl emqttd_keepalive.erl emqttd_message.erl emqttd_metrics.erl emqttd_mgmt.erl emqttd_misc.erl emqttd_mod_sup.erl emqttd_mqueue.erl emqttd_net.erl emqttd_packet.erl emqttd_parser.erl emqttd_plugins.erl emqttd_pmon.erl emqttd_pool_sup.erl emqttd_pooler.erl emqttd_protocol.erl emqttd_pubsub.erl emqttd_pubsub_sup.erl emqttd_rest_api.erl emqttd_router.erl emqttd_serializer.erl emqttd_server.erl emqttd_session.erl emqttd_session_sup.erl emqttd_sm.erl emqttd_sm_helper.erl emqttd_sm_sup.erl emqttd_stats.erl emqttd_sup.erl emqttd_sysmon.erl emqttd_sysmon_sup.erl emqttd_time.erl emqttd_topic.erl emqttd_trace.erl emqttd_trace_sup.erl emqttd_trie.erl emqttd_vm.erl emqttd_ws.erl emqttd_ws_client.erl emqttd_ws_client_sup.erl gen_server2.erl lager_emqtt_backend.erl priority_queue.erl\n APP    emqttd.app.src\n GEN    rebar.config\nBut eventually did not generate the _rel file.\nThere is no error\nroot@xxx:~/sunjinhui/emqx-relx# ll\ntotal 204\ndrwxrwxr-x 12 root root  4096 Nov 19 15:57 ./\ndrwxr-xr-x  3 root root  4096 Nov 19 15:50 ../\n-rw-rw-r--  1 root root   582 Jul 22 15:41 CONTRIBUTORS.md\ndrwxr-xr-x 18 root root  4096 Nov 19 15:52 deps/\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 doc/\ndrwxr-xr-x  2 root root  4096 Nov 19 15:57 ebin/\n-rw-r--r--  1 root root  3656 Nov 19 15:57 emqttd.d\ndrwxr-xr-x  3 root root  4096 Nov 19 15:57 .erlang.mk/\n-rw-rw-r--  1 root root 75721 Jul 22 15:41 erlang.mk\ndrwxrwxr-x  3 root root  4096 Jul 22 15:41 etc/\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 .github/\n-rw-rw-r--  1 root root   333 Jul 22 15:41 .gitignore\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 include/\n-rw-rw-r--  1 root root 11357 Jul 22 15:41 LICENSE\n-rw-rw-r--  1 root root 24911 Jul 22 15:41 LICENSE-MPL-RabbitMQ\n-rw-rw-r--  1 root root  2103 Jul 22 15:41 Makefile\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 priv/\n-rw-rw-r--  1 root root  5483 Jul 22 15:41 README.md\n-rw-r--r--  1 root root   787 Nov 19 15:57 rebar.config\n-rw-rw-r--  1 root root  1154 Jul 22 15:41 rebar.lock\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 src/\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 test/\n-rw-rw-r--  1 root root    72 Jul 22 15:41 .travis.yml\n. http://www.emqtt.com/docs/v2/install.html\nThis is our official guide\uff0cCan you help me to see what causes this?\n.  emqx-2.3.11.tar.gz download from https://github.com/emqx/emqx/releases. Emqx-2.3.11.tar.gz is a source package not an executable\u3002\nThe source package file is as follows\uff0cSo it needs to be compiled\u3002\nDownload path\uff1ahttps://github.com/emqx/emqx/releases\nroot@xxx:~/sunjinhui/emqx-2.3.11# ll\ntotal 184\ndrwxrwxr-x 9 root root  4096 Jul 22 15:41 ./\ndrwxr-xr-x 4 root root  4096 Nov 20 08:48 ../\n-rw-rw-r-- 1 root root   582 Jul 22 15:41 CONTRIBUTORS.md\ndrwxrwxr-x 2 root root  4096 Jul 22 15:41 doc/\n-rw-rw-r-- 1 root root 75721 Jul 22 15:41 erlang.mk\ndrwxrwxr-x 3 root root  4096 Jul 22 15:41 etc/\ndrwxrwxr-x 2 root root  4096 Jul 22 15:41 .github/\n-rw-rw-r-- 1 root root   333 Jul 22 15:41 .gitignore\ndrwxrwxr-x 2 root root  4096 Jul 22 15:41 include/\n-rw-rw-r-- 1 root root 11357 Jul 22 15:41 LICENSE\n-rw-rw-r-- 1 root root 24911 Jul 22 15:41 LICENSE-MPL-RabbitMQ\n-rw-rw-r-- 1 root root  2103 Jul 22 15:41 Makefile\ndrwxrwxr-x 2 root root  4096 Jul 22 15:41 priv/\n-rw-rw-r-- 1 root root  5483 Jul 22 15:41 README.md\n-rw-rw-r-- 1 root root  1154 Jul 22 15:41 rebar.lock\ndrwxrwxr-x 2 root root  4096 Jul 22 15:41 src/\ndrwxrwxr-x 2 root root  4096 Jul 22 15:41 test/\n-rw-rw-r-- 1 root root    72 Jul 22 15:41 .travis.yml\u3001\nNo error was reported during compilation, and no _rel file was generated after compilation.\nThe following is the compiled log and the compiled file directory.\nroot@xxx:~/sunjinhui/emqx-2.3.11# make\n DEP    cuttlefish\n DEP    goldrush\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/.erlang.mk/rebar'\n./bootstrap\nRecompile: src/rebar\nRecompile: src/rebar_abnfc_compiler\nRecompile: src/rebar_app_utils\nRecompile: src/rebar_appups\nRecompile: src/rebar_asn1_compiler\nRecompile: src/rebar_base_compiler\nRecompile: src/rebar_cleaner\nRecompile: src/rebar_config\nRecompile: src/rebar_core\nRecompile: src/rebar_cover_utils\nRecompile: src/rebar_ct\nRecompile: src/rebar_deps\nRecompile: src/rebar_dia_compiler\nRecompile: src/rebar_edoc\nRecompile: src/rebar_erlc_compiler\nRecompile: src/rebar_erlydtl_compiler\nRecompile: src/rebar_escripter\nRecompile: src/rebar_eunit\nsrc/rebar_eunit.erl:279: Warning: crypto:rand_uniform/2 is deprecated and will be removed in a future release; use rand:uniform/1\nsrc/rebar_eunit.erl:293: Warning: random:seed/3: the 'random' module is deprecated; use the 'rand' module instead\nsrc/rebar_eunit.erl:295: Warning: random:uniform/0: the 'random' module is deprecated; use the 'rand' module instead\nRecompile: src/rebar_file_utils\nRecompile: src/rebar_getopt\nRecompile: src/rebar_lfe_compiler\nRecompile: src/rebar_log\nRecompile: src/rebar_metacmds\nRecompile: src/rebar_mustache\nRecompile: src/rebar_neotoma_compiler\nRecompile: src/rebar_otp_app\nRecompile: src/rebar_otp_appup\nRecompile: src/rebar_port_compiler\nRecompile: src/rebar_proto_compiler\nRecompile: src/rebar_proto_gpb_compiler\nRecompile: src/rebar_protobuffs_compiler\nRecompile: src/rebar_qc\nRecompile: src/rebar_rel_utils\nRecompile: src/rebar_reltool\nRecompile: src/rebar_require_vsn\nRecompile: src/rebar_shell\nRecompile: src/rebar_subdirs\nRecompile: src/rebar_templater\nRecompile: src/rebar_upgrade\nRecompile: src/rebar_utils\nRecompile: src/rebar_xref\n==> rebar (compile)\n==> rebar (escriptize)\nCongratulations! You now have a self-contained script called \"rebar\" in\nyour current working directory. Place this script anywhere in your path\nand you can use rebar to build OTP-compliant apps.\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/.erlang.mk/rebar'\n/root/sunjinhui/emqx-2.3.11\n DEP    gproc\n DEP    lager\n DEP    esockd\n DEP    ekka\n DEP    mochiweb\n DEP    pbkdf2\n DEP    lager_syslog\n DEP    bcrypt\n DEP    clique\n DEP    jsx\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/cuttlefish'\n./rebar get-deps\n==> goldrush (get-deps)\n==> lager (get-deps)\n==> cuttlefish (get-deps)\nPulling getopt from {git,\"https://github.com/basho/getopt.git\",{tag,\"v0.8.2\"}}\nCloning into 'getopt'...\nPulling neotoma from {git,\"https://github.com/basho/neotoma.git\",\n                          {tag,\"1.7.4\"}}\nCloning into 'neotoma'...\n==> getopt (get-deps)\n==> neotoma (get-deps)\n./rebar compile\n==> getopt (compile)\nCompiled src/getopt.erl\n==> goldrush (compile)\nCompiled src/gr_sup.erl\nCompiled src/gre.erl\nCompiled src/gr_manager.erl\nCompiled src/gr_param_sup.erl\nCompiled src/gr_counter_sup.erl\nCompiled src/gr_context.erl\nCompiled src/gr_app.erl\nCompiled src/glc_run.erl\nCompiled src/glc_ops.erl\nCompiled src/gr_manager_sup.erl\nCompiled src/glc.erl\nCompiled src/glc_lib.erl\nCompiled src/gr_counter.erl\nCompiled src/gr_param.erl\nCompiled src/glc_code.erl\n==> lager (compile)\nCompiled src/lager_util.erl\nCompiled src/lager_transform.erl\nCompiled src/lager_manager_killer.erl\nCompiled src/lager_common_test_backend.erl\nCompiled src/lager_console_backend.erl\nCompiled src/lager_default_formatter.erl\nCompiled src/lager_config.erl\nCompiled src/lager_handler_watcher_sup.erl\nCompiled src/lager_file_backend.erl\nCompiled src/lager_msg.erl\nCompiled src/lager_trunc_io.erl\nCompiled src/lager_crash_log.erl\nCompiled src/lager_sup.erl\nCompiled src/lager_format.erl\nCompiled src/lager_backend_throttle.erl\nCompiled src/lager_app.erl\nCompiled src/lager_handler_watcher.erl\nCompiled src/lager_stdlib.erl\nCompiled src/lager.erl\nCompiled src/error_logger_lager_h.erl\n==> neotoma (compile)\nCompiled src/neotoma.erl\nCompiled src/neotoma_parse.erl\n==> cuttlefish (compile)\nCompiled src/cuttlefish_duration_parse.peg\nCompiled src/conf_parse.peg\nCompiled src/cuttlefish_duration.erl\nCompiled src/cuttlefish_conf.erl\nCompiled src/cuttlefish_enum.erl\nCompiled src/cuttlefish_advanced.erl\nCompiled src/cuttlefish_bytesize.erl\nCompiled src/cuttlefish_translation.erl\nCompiled src/conf_parse.erl\nCompiled src/cuttlefish_flag.erl\nCompiled src/cuttlefish_datatypes.erl\nCompiled src/cuttlefish_variable.erl\nCompiled src/cuttlefish_mapping.erl\nCompiled src/cuttlefish_escript.erl\nCompiled src/cuttlefish_util.erl\nCompiled src/cuttlefish_generator.erl\nCompiled src/cuttlefish.erl\nCompiled src/cuttlefish_vmargs.erl\nCompiled src/cuttlefish_effective.erl\nCompiled src/cuttlefish_rebar_plugin.erl\nCompiled src/cuttlefish_error.erl\nCompiled src/cuttlefish_duration_parse.erl\nCompiled src/cuttlefish_validator.erl\nCompiled src/cuttlefish_schema.erl\nCompiled src/lager_stderr_backend.erl\nsrc/cuttlefish_unit.erl:4: Warning: export_all flag enabled - all functions will be exported\nCompiled src/cuttlefish_unit.erl\n==> getopt (escriptize)\n==> goldrush (escriptize)\n==> lager (escriptize)\n==> neotoma (escriptize)\n==> cuttlefish (escriptize)\n./rebar skip_deps=true escriptize\n==> cuttlefish (escriptize)\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/cuttlefish'\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/goldrush'\n DEPEND goldrush.d\n ERLC   glc.erl glc_code.erl glc_lib.erl glc_ops.erl glc_run.erl gr_app.erl gr_context.erl gr_counter.erl gr_counter_sup.erl gr_manager.erl gr_manager_sup.erl gr_param.erl gr_param_sup.erl gr_sup.erl gre.erl\n APP    goldrush.app.src\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/goldrush'\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/gproc'\n DEPEND gproc.d\n ERLC   gproc.erl gproc_app.erl gproc_bcast.erl gproc_dist.erl gproc_info.erl gproc_init.erl gproc_lib.erl gproc_monitor.erl gproc_pool.erl gproc_ps.erl gproc_pt.erl gproc_sup.erl\nsrc/gproc_dist.erl:25: Warning: behaviour gen_leader undefined\n APP    gproc.app.src\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/gproc'\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/lager'\n DEPEND lager.d\n ERLC   error_logger_lager_h.erl lager.erl lager_app.erl lager_backend_throttle.erl lager_common_test_backend.erl lager_config.erl lager_console_backend.erl lager_crash_log.erl lager_default_formatter.erl lager_file_backend.erl lager_format.erl lager_handler_watcher.erl lager_handler_watcher_sup.erl lager_manager_killer.erl lager_msg.erl lager_stdlib.erl lager_sup.erl lager_transform.erl lager_trunc_io.erl lager_util.erl\n APP    lager.app.src\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/lager'\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/esockd'\n DEP    gen_logger\nmake[2]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/gen_logger'\n DEPEND gen_logger.d\n ERLC   console_logger.erl error_logger_logger.erl gen_logger.erl lager_logger.erl\n APP    gen_logger.app.src\nmake[2]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/gen_logger'\n DEPEND esockd.d\n ERLC   esockd.erl esockd_acceptor.erl esockd_acceptor_sup.erl esockd_access.erl esockd_app.erl esockd_cidr.erl esockd_connection.erl esockd_connection_sup.erl esockd_gen.erl esockd_keepalive.erl esockd_listener.erl esockd_listener_sup.erl esockd_net.erl esockd_proxy_protocol.erl esockd_ratelimit.erl esockd_server.erl esockd_ssl.erl esockd_sup.erl esockd_transport.erl esockd_udp.erl esockd_util.erl\n APP    esockd.app.src\n GEN    rebar.config\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/esockd'\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/ekka'\nmake[2]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/jsx'\n DEPEND jsx.d\n ERLC   jsx.erl jsx_config.erl jsx_consult.erl jsx_decoder.erl jsx_encoder.erl jsx_parser.erl jsx_to_json.erl jsx_to_term.erl jsx_verify.erl\nOld inliner: threshold=0 functions=[{doublequote,5},\n                                    {singlequote,5},\n                                    {maybe_replace,2},\n                                    {format_number,1},\n                                    {handle_event,3}]\n APP    jsx.app.src\nmake[2]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/jsx'\n DEPEND ekka.d\n ERLC   ekka.erl ekka_app.erl ekka_autoclean.erl ekka_autocluster.erl ekka_autoheal.erl ekka_boot.erl ekka_cluster.erl ekka_cluster_dns.erl ekka_cluster_etcd.erl ekka_cluster_k8s.erl ekka_cluster_mcast.erl ekka_cluster_static.erl ekka_cluster_strategy.erl ekka_cluster_sup.erl ekka_guid.erl ekka_httpc.erl ekka_membership.erl ekka_mnesia.erl ekka_node.erl ekka_node_monitor.erl ekka_node_ttl.erl ekka_sup.erl\n APP    ekka.app.src\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/ekka'\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/mochiweb'\n DEPEND mochiweb.d\n ERLC   mochifmt.erl mochifmt_records.erl mochifmt_std.erl mochiglobal.erl mochihex.erl mochijson.erl mochijson2.erl mochilists.erl mochilogfile2.erl mochinum.erl mochitemp.erl mochiutf8.erl mochiweb.erl mochiweb_base64url.erl mochiweb_charref.erl mochiweb_cookies.erl mochiweb_cover.erl mochiweb_headers.erl mochiweb_html.erl mochiweb_http.erl mochiweb_io.erl mochiweb_mime.erl mochiweb_multipart.erl mochiweb_request.erl mochiweb_response.erl mochiweb_session.erl mochiweb_util.erl mochiweb_websocket.erl\n APP    mochiweb.app.src\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/mochiweb'\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/pbkdf2'\n DEPEND pbkdf2.d\n ERLC   pbkdf2.erl\n APP    pbkdf2.app.src\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/pbkdf2'\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/lager_syslog'\n DEP    syslog\nmake[2]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/syslog'\nmake -f c_src/Makefile.erlang.mk\nmake[3]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/syslog'\ncc -c -o c_src/syslog_drv.o c_src/syslog_drv.c  -finline-functions -Wall -fPIC -I \"/usr/lib/erlang/erts-9.3.3.3/include\" -I \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/include\" -fPIC\ncc -o priv/syslog_drv.so c_src/syslog_drv.o  -L \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/lib\" -lerl_interface -lei   -shared\nmake[3]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/syslog'\n DEPEND syslog.d\n ERLC   syslog.erl syslog_app.erl syslog_sup.erl\n APP    syslog.app.src\nmake[2]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/syslog'\n DEPEND lager_syslog.d\n ERLC   lager_syslog_backend.erl\n APP    lager_syslog.app.src\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/lager_syslog'\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/bcrypt'\nmake -f c_src/Makefile.erlang.mk\nmake[2]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/bcrypt'\ncc -c -o c_src/bcrypt.o c_src/bcrypt.c  -finline-functions -Wall -fPIC -I \"/usr/lib/erlang/erts-9.3.3.3/include\" -I \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/include\" -Ic_src -Wall -fPIC -finline-functions -Wall -fPIC -I \"/usr/lib/erlang/erts-9.3.3.3/include\" -I \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/include\"\ncc -c -o c_src/blowfish.o c_src/blowfish.c  -finline-functions -Wall -fPIC -I \"/usr/lib/erlang/erts-9.3.3.3/include\" -I \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/include\" -Ic_src -Wall -fPIC -finline-functions -Wall -fPIC -I \"/usr/lib/erlang/erts-9.3.3.3/include\" -I \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/include\"\ncc -c -o c_src/bcrypt_nif.o c_src/bcrypt_nif.c  -finline-functions -Wall -fPIC -I \"/usr/lib/erlang/erts-9.3.3.3/include\" -I \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/include\" -Ic_src -Wall -fPIC -finline-functions -Wall -fPIC -I \"/usr/lib/erlang/erts-9.3.3.3/include\" -I \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/include\"\ncc -c -o c_src/bcrypt_port.o c_src/bcrypt_port.c  -finline-functions -Wall -fPIC -I \"/usr/lib/erlang/erts-9.3.3.3/include\" -I \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/include\" -Ic_src -Wall -fPIC -finline-functions -Wall -fPIC -I \"/usr/lib/erlang/erts-9.3.3.3/include\" -I \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/include\"\ncc -c -o c_src/async_queue.o c_src/async_queue.c  -finline-functions -Wall -fPIC -I \"/usr/lib/erlang/erts-9.3.3.3/include\" -I \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/include\" -Ic_src -Wall -fPIC -finline-functions -Wall -fPIC -I \"/usr/lib/erlang/erts-9.3.3.3/include\" -I \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/include\"\ncc -o priv/bcrypt_nif.so c_src/bcrypt.o c_src/blowfish.o c_src/bcrypt_nif.o c_src/bcrypt_port.o c_src/async_queue.o  -L \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/lib\" -lerl_interface -lei -shared -L \"/usr/lib/erlang/lib/erl_interface-3.10.2.1/lib\" -lerl_interface -lei -lpthread  -shared\nmake[2]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/bcrypt'\n DEPEND bcrypt.d\n ERLC   bcrypt.erl bcrypt_app.erl bcrypt_nif.erl bcrypt_nif_worker.erl bcrypt_pool.erl bcrypt_port.erl bcrypt_port_sup.erl bcrypt_sup.erl\nsrc/bcrypt_nif.erl:57: Warning: call to crypto:rand_bytes/1 will fail, since it was removed in 20.0; use crypto:strong_rand_bytes/1\nsrc/bcrypt_port.erl:42: Warning: call to crypto:rand_bytes/1 will fail, since it was removed in 20.0; use crypto:strong_rand_bytes/1\nsrc/bcrypt_port.erl:46: Warning: call to crypto:rand_bytes/1 will fail, since it was removed in 20.0; use crypto:strong_rand_bytes/1\n APP    bcrypt.app.src\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/bcrypt'\nmake[1]: Entering directory '/root/sunjinhui/emqx-2.3.11/deps/clique'\n DEPEND clique.d\n ERLC   clique.erl clique_app.erl clique_command.erl clique_config.erl clique_csv_writer.erl clique_error.erl clique_handler.erl clique_human_writer.erl clique_json_writer.erl clique_manager.erl clique_nodes.erl clique_parser.erl clique_spec.erl clique_status.erl clique_sup.erl clique_table.erl clique_test_group_leader.erl clique_typecast.erl clique_usage.erl clique_writer.erl\n APP    clique.app.src\nmake[1]: Leaving directory '/root/sunjinhui/emqx-2.3.11/deps/clique'\n DEPEND emqttd.d\n ERLC   emqttd.erl emqttd_access_control.erl emqttd_access_rule.erl emqttd_acl_internal.erl emqttd_acl_mod.erl emqttd_alarm.erl emqttd_app.erl emqttd_auth_mod.erl emqttd_base62.erl emqttd_boot.erl emqttd_bridge.erl emqttd_bridge_sup.erl emqttd_bridge_sup_sup.erl emqttd_broker.erl emqttd_cli.erl emqttd_cli_config.erl emqttd_client.erl emqttd_cm.erl emqttd_cm_sup.erl emqttd_config.erl emqttd_ctl.erl emqttd_gc.erl emqttd_gen_mod.erl emqttd_guid.erl emqttd_hooks.erl emqttd_http.erl emqttd_inflight.erl emqttd_keepalive.erl emqttd_message.erl emqttd_metrics.erl emqttd_mgmt.erl emqttd_misc.erl emqttd_mod_sup.erl emqttd_mqueue.erl emqttd_net.erl emqttd_packet.erl emqttd_parser.erl emqttd_plugins.erl emqttd_pmon.erl emqttd_pool_sup.erl emqttd_pooler.erl emqttd_protocol.erl emqttd_pubsub.erl emqttd_pubsub_sup.erl emqttd_rest_api.erl emqttd_router.erl emqttd_serializer.erl emqttd_server.erl emqttd_session.erl emqttd_session_sup.erl emqttd_sm.erl emqttd_sm_helper.erl emqttd_sm_sup.erl emqttd_stats.erl emqttd_sup.erl emqttd_sysmon.erl emqttd_sysmon_sup.erl emqttd_time.erl emqttd_topic.erl emqttd_trace.erl emqttd_trace_sup.erl emqttd_trie.erl emqttd_vm.erl emqttd_ws.erl emqttd_ws_client.erl emqttd_ws_client_sup.erl gen_server2.erl lager_emqtt_backend.erl priority_queue.erl\n APP    emqttd.app.src\n GEN    rebar.config\nroot@xxx:~/sunjinhui/emqx-2.3.11# ll\ntotal 204\ndrwxrwxr-x 12 root root  4096 Nov 20 09:04 ./\ndrwxr-xr-x  4 root root  4096 Nov 20 08:48 ../\n-rw-rw-r--  1 root root   582 Jul 22 15:41 CONTRIBUTORS.md\ndrwxr-xr-x 18 root root  4096 Nov 20 09:03 deps/\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 doc/\ndrwxr-xr-x  2 root root  4096 Nov 20 09:04 ebin/\n-rw-r--r--  1 root root  3656 Nov 20 09:04 emqttd.d\ndrwxr-xr-x  3 root root  4096 Nov 20 09:03 .erlang.mk/\n-rw-rw-r--  1 root root 75721 Jul 22 15:41 erlang.mk\ndrwxrwxr-x  3 root root  4096 Jul 22 15:41 etc/\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 .github/\n-rw-rw-r--  1 root root   333 Jul 22 15:41 .gitignore\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 include/\n-rw-rw-r--  1 root root 11357 Jul 22 15:41 LICENSE\n-rw-rw-r--  1 root root 24911 Jul 22 15:41 LICENSE-MPL-RabbitMQ\n-rw-rw-r--  1 root root  2103 Jul 22 15:41 Makefile\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 priv/\n-rw-rw-r--  1 root root  5483 Jul 22 15:41 README.md\n-rw-r--r--  1 root root   787 Nov 20 09:04 rebar.config\n-rw-rw-r--  1 root root  1154 Jul 22 15:41 rebar.lock\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 src/\ndrwxrwxr-x  2 root root  4096 Jul 22 15:41 test/\n-rw-rw-r--  1 root root    72 Jul 22 15:41 .travis.yml\n. ",
    "manifest": "It seems to me that some of previous commits introduced the coverage loss. I appreciate your quick response.. @Gilbert-Wong thanks. It works with emqx_client:connect(Client).. ",
    "lzh2nix": "hi, Marina190489, you can check http://emqtt.io/docs/v2/config.html#allow-anonymous-and-acl-file\nI'm using v2.3.11 and it's worked for me.. ",
    "0xfadeef": "Hello, @tigercl! We are using emq_auth_username plugin.. I was talking about ACL file for internal module, by default it's located at etc/acl.conf. Afaik acl reload command reads only this single file.. Thank you, @tigercl! Really appreciate your work.. ",
    "ruijf": "great!. ",
    "zsb7798169": "When we stop client for a while,our client will receive duplicate messages and be forced to disconnect,and I can see  Duplicated subscribe too,our version is 2.3.10,qos level is one,is the same problem?. We try to reconnect,but always failed,maybe there are too many legacy messages and repeated subscriptions at the same time,eventually we had to restart emqtt or changged the clientid.Is there any other solution?. clean session is false,retain flag is true. ",
    "nosixtools": "the version of 3.0-rc3 can subscribe and publish use one instance of client . Golang  github.com/eclipse/paho.mqtt.golang\nInstance one client connect to emqx, one thread for publish data to topic(test), one thread for subscribe data from topic (test). V3.0-rc3 can work, rc4 can publish, but can\u2019t receive data from that topic(test). Thanks for your solution. ",
    "Wagos": "Hi, @Gilbert-Wong , here is an example of bridge config:\nbridge.br.start_type = auto\nbridge.br.reconnect_interval = 30s\nbridge.br.address = another_broker_url.com:1883\nbridge.br.proto_ver = mqttv4\nbridge.br.client_id = bridge_br1\nbridge.br.username = bridge\nbridge.br.keepalive = 60s\nbridge.br.subscription.1.topic = $share/bridge/root/#\nbridge.br.mqueue_type = memory\nbridge.br.max_pending_messages = 10000\nbridge.br.ssl = off. ",
    "Rebellioncry": "Hi,@Gilbert-Wong,I am sorry to reply so late.\nHere is the configuration file and log file.\nlog.zip\nThis configuration file can be used on mysql5.7, but only changed the ip address to mysql8.0, other configurations are unchanged, emqx is given an error.Please check it.\n. @zhanghongtong Thank you for your answer,I also thought about the problem that may be caused by the new password mechanism of mysql8.0.But why can't emqx support compatibility?Just like java uses java driver, you can connect directly to mysql8.0 without changing the code.And I hope you can answer the second question.Can emqx connect mysql when mysql use ssl?Just like java driver set  \"usessl = true\".I look forward to your reply.. @zhanghongtong Ok, I know, thank you for your reply.. ",
    "linjunjj": "My task is arranged by Feng. Do you have any good suggestions? Please help me correct it. Thank you\uff01@Gilbert-Wong\n . I learned, thank you . I learn , good. Hi @MyraBaba  I can't reproduce this issue. This may be a network I/O problem causing a timeout\uff0cA client? Cloud you please provide more details information to resolve this.. Hi @BorisPetelj  I think this might be caused by short timeout. You can try to reduce CPU usage by setting the log level as error. Cloud you please provide more details information?. Hi @biswaKL  So sorry for so late response, What is your EMQX detailed version? Could you please provide more details information to help solve this?. @biswaKL  This is very strange\uff0cIs the 'emqx_management' plugin running in Dashboard?. Hi @victorclaessen  Did you modify the corresponding host name  in 'node. name' of  'emqx. conf'? . @victorclaessen Is 10.0.0.1 one of the IPs on your local server? Try to resolve myserver.mydomain.nl using tools like ping and nslookup.. @victorclaessen  Connect to the broker node by RPC\nrelx_nodetool rpc emqx_ctl run_command $@. @victorclaessen  When you use the emqx_ctl command,  Will start EPMD. EPMD completes mapping between Erlang nodes and IP ports,In fact, Start a node will be connected to the broker  node. But this is a brief connection. Next send commands to emqx broker by RPC\uff0cWhen myserver.mydomain.nl myserver points to a local ip, it is actually usable. I feeling that  the 10.0.0.1  is not the native actual IP, This IP feels like a router, Maybe you should check  IP.\n. Hi @xiaode123  How about the configuration of ACl in your configuration? Could you please provide more details information about your emqx.conf and ACL configuration.. @xiaode123  Maybe you need to open debug mode to view log information to find problem, set 'log.level = debug' in emqx.conf, . Hi@perroudchris  sorry for the late reply. Do you mean to receive only retainer-type messages?\n. Hi@phper-chen So sorry for late reponse, This is LAN ip.  Maybe you need to try again on other networks:blush:. @phper-chen  It's no problem to get IP, Because the device you connect to is in a local area network. If you want to verify that getting IP is correct, You can try it on other networks. For example, Using external network.:wink:\n. @phper-chen  Sorry, I thought about it carefully. Do you use NAT(Network Address Translation) on the Internet:question:. @phper-chen What the server reads is that the public address of the router cannot read the address of the client LAN. I think both your server and client are in the LAN. So I got the IP address of the client router. That's why this IP is 10.255.0.2.\n. I think you are a local area network with multi-level routing. You want the server to get the address and port of each client in the network, This one is not available.. @chrysa95  Try this command \uff0c./_rel/emqx/bin/emqx start. Hi @suijunqiang  Could you please give me some logs when this issue happend, and config information. Hi @phper-chen  It seems that your auth. mongo. server configuration is wrong\n. @phper-chen yeah. Does your mongoDB use Replica Set \uff1f. > > @phper-chen yeah. Does your mongoDB use Replica Set \uff1f\n\nyes, I used a url like this \"mongodb://dds-xxxxxxxxx.mongodb.rds.aliyuncs.com:3909/example?replicaSet=mgset-201893\"\nIn log, it shows below, and this error leads a high cpu usage.\n\n\n@phper-chen  The auth. mongo. server configuration only supports host + port format. You can try this dds-xxxxxxxxx.mongodb.rds.aliyuncs.com:3909 . > My env in docker-compose:\n\n\nAnd it always show these error:\n\n\nIt seems that password error. Is your MongoDB account password and url correct?\n. @aaamitsingh   Do you mean to use username and password authentication in plugin 'emqx_auth_username' \uff1f. @aaamitsingh   Hi, Creating any user from cli its not reflecting on Dashboard,  From my test, When I  create a new user from cli , mqtt connection authentication work with new username and password.. @aaamitsingh  Yeah, Start the corresponding plugin, Create new username and password by cli. I use MQTTBOX tool, Both new user and old user are available, If you don't want to use the old username, you can delete it by cli\n. @aaamitsingh  when you just want to use a new user and password, you can delete old user, then create new username and password, In the new PR, add a command to update the password. @servucn   sorry, I can't reproduce your issues, please provide more details.  . Hi @aaamitsingh  Did you start redis? Please check redis state.. @aaamitsingh How do you configure your \u2018emqx_auth_redis.conf\u2019 profile?. @aaamitsingh But the emqx plugin shows that the connection was rejected\uff0cDid you open a firewall?\n. @aaamitsingh  I can't reproduce this problem. I offer my guess\uff0cDoes your redis configuration use internal IP Address in redis and EMQ environments? If your redis configuration uses an extranet ip Address, make sure that the extranet IP Address is accessible.  How do you Redis-cli running? In Ec2\uff1f. @aaamitsingh if redis and emq on the same server.  You try local address 127.0.0.1:6379. Hi@elvizlai  You may need to read the documents\uff0cThe $queue can work for my test. The subscribe topic $queue is equivalent to load balancing. For example. When two clients connect to the emq broker, Subscribe to a $queue/test/abc topic , then publish a message, One of the two receives a message.. @h00s  I can't reproduce this issues\uff0cPlease provide the emqx.conf file and log file. @h00s   The problem has been fixed and will be released in beta.2 :). @visit24ir  Emq will disconnect client  when token is expired. . @dophlin  We checked and found this problem.. The problem has been fixed and will be released in v3.1-beta.2. sorry. I will correct... yes!  your are right. sorry I add describe. But the problem is the need to disconnect with the client when http acl rejected\uff0c so use this name. Yeah good idea. approve. ok. Load 'acl_deny_action ' configuration for the first time, Reduce duplicate read configuration\uff0c I learned\ud83d\ude01\ud83d\ude01\n. ",
    "fromiuan": "Thank you for replying, I use the documentation prompt to install[http://emqtt.com/docs/v2/cluster.html#emq-s1-emqtt-io],\nWhen the program hangs, I use the command emqttd_ctl cluster status to display the following prompt.\n[root@ecs-emqtt-b ~]# emqttd_ctl cluster status\nNode 'emqttd@192.168.0.10' not responding to pings.. This is a detailed log\nemqtt_log.zip\n. ok ,I find the nodeerl_child_setup closedCrash dump is being written to: /var/log/emqttd/crash.dump...done\nthe log:\nemqtt_log_node.zip\n. I'm sorry ,the crash log so big,so ...,I had upload full log,\ncrash_log.zip\n. thinks, . ",
    "mkrusemark": "@GilbertxWong: you are right! Installing the whole Erlang stuff on Debian Sid solves this issue. Thanks:-). Ticket can be closed.. ",
    "andares": "here is the bug, when use nginx proxy to visit dashboard, and nginx user is not www-data, it will not work.. I have not idea for that. I move the docker-compose to other dir, and it is work. \ud83d\ude02 and I think the problem should not send to here.. you can see it in this issue: \nhttps://github.com/emqx/emqx/issues/2023\nCould I send a mail to you?. no, docker image is not changed.. ",
    "sylnkk": "EMQ Version\uff1a2.3.9\nCentos Version\uff1a6.8\nWe use EMQ for three-terminal message push (android:tcp, ios:tcp, web:ssl).\nBy the way, we don't use haproxy.\nAll of our clients use qos0 links to emq for subscribe, and i use EMQ HTTP API to push message.\nI keep EMQ start for several days, and the maximum number of clients per day is less than 2000.\nI found that the EMQ take up more and more memory\uff0cand the memory cannot be freed.\nHow can i do to take down the memory?\nThis is the Dashboard Image\n\nThis is the emq.conf.\nemq.conf.txt\n. @ranvijayj \nHow can i reduce the message retention time?\nI've decreased the timeout for clients, but the memory cannot be freed too.\nlistener.ssl.external.acceptors = 16\n. ",
    "ikoo": "we met the same problem, and have no idea. ",
    "netfw": "\nHi, @ozgursoft .First log indicates that emqttd could not read the file opt/emqttd/ssl/emqtt.key, you should configure the right path of the emqttd.key.\n\nHello @Gilbert-Wong thank you so much and this first problem was solved and the problem was correct by giving the correct key path. I'm still looking for the answer to second question sir haproxy is running and emqtt is installed on two servers and running as a cluster.\nemqtt1: 10.10.10.5\nemqtt2: 10.10.10.6\nhaproxy: 10.10.10.7\nSo all requests passing through haproxy so should this certificate install on haproxy? for as wss work.. ",
    "cjmNo1": "\u6709\u6ca1\u6709\u53ef\u4ee5\u5c1d\u8bd5\u7684\u65b9\u6cd5\uff0c\u73b0\u5728\u5728\u751f\u4ea7\u73af\u5883\uff0c\u603b\u662f\u5b95\u3002\u8c22\u8c22. ",
    "aviscaerulea": "Thank you for your reply.\nI seem to have misunderstood the following contents.\nI understood it correctly.\nhttp://emqtt.io/docs/v2/cluster.html#session-across-nodes. ",
    "AshokKumarTech": "emqttd version: 2.1.2\nerlang/otp version: 7.3.1\nIt was running since last two years. But since last couple of days we are getting this issue. At first it was not working in dev,qa, and prod environment but worked in staging at that time(same docker image for all environments). Now staging also having same issue.\nIf as you said that the dependency mochiweb which is depended by emqttd is not build into emq is the issue here. Please help me to fix this.. Is there any other way to fix this other than upgrading?. ",
    "qianshui423": "Here is my screenshot\uff1a\n\n. > Please try with ./emqx/bin/emqx_ctl status to lookup the status of emqx.\n\n. > Then please try with ./bin/emqx stop to stop emqx, and if it still failed, you could kill -9 the emqx processes.\n./bin/emqx stop result:\n\nI can't find the emqx processes:\n\n. > Then please try with ./bin/emqx stop to stop emqx, and if it still failed, you could kill -9 the emqx processes.\nI found the cause of the problem.I changed the .erlang file in the Home directory.\nThank you for your attention to this issue.. I solve the problem by add etc directory and conf file.\nThank you for your attention to this issue.. ",
    "jvrahav": "If we take a case of a slow subscriber who is unable to consume messages in the rate at which they come into emqtt, what happens then. Will the qos 0 messages be held in memory until the subscriber reads it. In this case is it possible to determine the messages that are yet to be processed. ",
    "1181513953": "A \u201cconsumer \u201drefers to a client which subscribes messages from broker.\nA \u201cproducer\u201drefers to a client which publishes messages to broker.\nI meant that when a consumer is slower than producer ,some messages would be discarded even though the messages are qos2.\nso\uff0chow can i do to avoid this problem?\ne.g.\nwhen \u201cclient  a\u201c publishes messages to the topic \"/testTopic\" at a speed of 100messges/s and \"client  b\" subscribe messages from the topic  \"/testTopic\" at a speed of 1messges/s\uff0cthen 99 messges will be discarded\u3002\n. ",
    "maojing0609": "i have find a mistake with emq and emqx. ",
    "berk-can": "No we are using free version. I am sorry for misunderstanding it must be one of our class names it is named like that because we implemented kafka integration, question is on client.subscribe hook we cannot listen for error cases . that would be very helpful, thank you. I am closing issue. ",
    "rahulwinzo": "Could you please help with the issue? We've been getting these CPU spikes a lot lately.. Hi @terry-xiaoyu, we're using the cluster for our chat application. The application has around 10k online users at any point of time. So, I guess that's the number of publishers and subscribers that we're looking at. Since it's like any other chat application where one user can chat with another user, there are around 70k topics on our cluster right now (as visible on EMQ dashboard). For the publish speed part, I'm not sure what exactly are you looking for? Publish speed per topic or the overall publish speed.. @terry-xiaoyu \n1. Yes, we do have a common topic to which all clients subscribe. It's our common group chat topic.\n2. Yes, we keep the log level as error which I guess is default log level.\n3. Clients are connected to EMQ via TCP. We don't have TLS in place yet.. Hi @terry-xiaoyu, the group chat feature wasn't present in the app until a couple of weeks ago. And we've been seeing CPU spikes from even before.. So, this is the data I've pulled out. Total number of users who actively send messages on the common topic are not more than 300. And over an hour, maximum number of messages sent over the topic hasn't ever exceeded 100. Let's say, if this is the reason behind high CPU usage, what should be the configuration of the cluster to avoid such scenarios.\nP.S.: We expect an increase in the number of connections/publish/subscriptions/etc.. emqx_ctl doesn't have any 'attach' usage. I'm not able to attach into the Erlang shell.. ",
    "Odinysus": "mosquitto to EMQ. \uff1f\u76ee\u524d\u662f\u6211\u5bf9\u90a3\u53f0\u4e3b\u673a\u6ca1\u6709\u63a7\u5236\u6743\uff0c\u65e0\u6cd5\u4fee\u6539mosquitto\u7684\u914d\u7f6e\u3002\u81ea\u52a8\u5ffd\u7565\u524d\u63d0\u6761\u4ef6\u8fd8\u884c. ",
    "jt-tech": "\nIt must be network problems, could you please make emqx_rel again?\n\nI tried to build the next day - everything compiled successfully.\nI do not know why the whole previous day did not come out. The server was in Amazon EC2.\n\nAnd could you please tell me which branch of emqx-rel did you checkout ?\n\nLast branch\n. ",
    "yu-chun-young": "No, Emqx doesn't start on windows service. I just did emqx console / start / stop on cmd.. ",
    "guydillen": "Any progress?\nThanks.. Followed exact the same instructions as in the document, but don\u2019t succeed to access the dashboard with https port 18084!. I suppose the files under /var/log/emqx?\nemqx.log.1.txt\nerlang.log.1.txt\nrun_erl.log\n. did you had the chance looking at the logfiles?. my initial post dates from december 28th 2018, can someone please have a look at it. Thanks.. This problem completely blocks our work since december 2018! If you don't have the intention to provide, on short-term, a solution we will switch to a competitive product (VerneMQ).. The results for the checks you mentioned. I suppose all tests are successful.\n\nport 18084 listening:\n\n$ ss -tln\nLISTEN 0 128 0.0.0.0:18084 0.0.0.0:* \nBroker is listening on port 18084\n\nnetcat connect to port\n\n$ nc -v xxx.xxx.xxx.xxx 18084\nfound 0 associations\nfound 1 connections:\n     1: flags=82\n    outif en0\n    src 10.0.0.43 port 57960\n    dst xxx.xxx.xxx.xxx port 18084\n    rank info not available\n    TCP aux info available\nConnection to xxx.xxx.xxx.xxx port 18084 [tcp/*] succeeded!\n\nopenssl\n'\n$ openssl s_client -connect xxx.xxx.xxx.xxx:18084\nCONNECTED(00000003)\n4584957548:error:140040E5:SSL routines:CONNECT_CR_SRVR_HELLO:ssl handshake failure:/BuildRoot/Library/Caches/com.apple.xbs/Sources/libressl/libressl-22.240.1/libressl-2.6/ssl/ssl_pkt.c:585:\n\n\nno peer certificate available\nNo client certificate CA names sent\nSSL handshake has read 0 bytes and written 0 bytes\nNew, (NONE), Cipher is (NONE)\nSecure Renegotiation IS NOT supported\nCompression: NONE\nExpansion: NONE\nNo ALPN negotiated\nSSL-Session:\n    Protocol  : TLSv1.2\n    Cipher    : 0000\n    Session-ID: \n    Session-ID-ctx: \n    Master-Key: \n    Start Time: 1551642299\n    Timeout   : 7200 (sec)\n    Verify return code: 0 (ok)\n\nModifications I made to the default out-of-the-box config:\n\nallow_anonymous = true\nenable auth_username (and added a user)\nin emq_dashboard_conf\n\nValue: IP:Port | Port\n\nExamples: 18084, 127.0.0.1:18084, ::1:18084\ndashboard.listener.https = 18084\nThe acceptor pool for external Dashboard HTTPS listener.\n\nValue: Number\ndashboard.listener.https.acceptors = 2\nMaximum number of concurrent Dashboard HTTPS connections.\n\nValue: Number\ndashboard.listener.https.max_clients = 512\nPath to the file containing the user's private PEM-encoded key.\n\nValue: File\ndashboard.listener.https.keyfile = /etc/letsencrypt/live/abc.xyz/privkey.pem\nPath to a file containing the user certificate.\n\nValue: File\ndashboard.listener.https.certfile = /etc/letsencrypt/live/abc.xyz/fullchain.pem. File location is correct and permissions are rwx for ugo (didn't change these)\nSee log with loglevel debug.\nThanks.\nlog.txt\n. emqx.log.1.txt\nerlang.log.1.txt\nrun_erl.log.txt\n. Nope that's all there is:\ndrwxr-xr-x  2 emqx emqx     4096 Mar  4 10:34 .\ndrwxrwxr-x 14 root syslog   4096 Mar  4 11:19 ..\n-rw-rw-r--  1 emqx emqx   330220 Mar  4 11:09 emqx.log.1\n-rw-rw-r--  1 emqx emqx       18 Mar  4 11:09 emqx.log.idx\n-rw-rw-r--  1 emqx emqx       13 Mar  4 11:09 emqx.log.siz\n-rw-rw-r--  1 emqx emqx    54551 Mar  4 16:39 erlang.log.1\n-rw-rw-r--  1 emqx emqx      258 Mar  4 11:09 run_erl.log. -> stopped emqx\n-> deleted all logfiles in /var/log/emqx\n-> started emqx\nemqx.log.1.txt\nerlang.log.1.txt\nrun_erl.log.txt\ndrwxrwxr-x 2 vmadmin vmadmin   4096 Mar  5 10:14 .\ndrwxr-xr-x 5 vmadmin vmadmin   4096 Mar  4 18:58 ..\n-rw-r--r-- 1 vmadmin vmadmin 163986 Mar  5 10:14 emqx.log.1\n-rw-r--r-- 1 vmadmin vmadmin     18 Mar  5 10:14 emqx.log.idx\n-rw-r--r-- 1 vmadmin vmadmin     13 Mar  5 10:14 emqx.log.siz\n-rw-r--r-- 1 vmadmin vmadmin   1825 Mar  5 10:14 erlang.log.1\n-rw-r--r-- 1 vmadmin vmadmin    258 Mar  5 10:14 run_erl.log\n. Uncommenting dashboard.listener.https.ciphers doesn't change anything.\n```\nCONNECTED(00000003)\nwrite:errno=54\n\nno peer certificate available\nNo client certificate CA names sent\nSSL handshake has read 0 bytes and written 0 bytes\nNew, (NONE), Cipher is (NONE)\nSecure Renegotiation IS NOT supported\nCompression: NONE\nExpansion: NONE\nNo ALPN negotiated\nSSL-Session:\n    Protocol  : TLSv1.2\n    Cipher    : 0000\n    Session-ID: \n    Session-ID-ctx: \n    Master-Key: \n    Start Time: 1551789461\n    Timeout   : 7200 (sec)\n    Verify return code: 0 (ok)\n\n```. I understand, anyway many thanks for the effort helping trying to solve the problem.. The only \"strange\" thing is comparing with EMQ 2.3.3:\nthe entry:\ndashboard.listener.https.access.1 = allow all\nisn't available anymore in v3.0.1\n. ",
    "rajatbhatia389": "Ok. I have found a solution to this problem. But I guess it needs to be documented.\nAfter encoding the topic name containing\"/\" (using https://www.urlencoder.org/), it worked. So, for example,\nfor topic name sensors/plug/A, the request should be:\n```\nGET  /api/v3/routes/sensors%2Fplug%2FA\n[\n    {\n        \"node\": \"emq@10.0.2.6\",\n        \"topic\": \"sensors/plug/A\"\n    }\n]\n```. ",
    "gst6062825": "\nCould you please check the dashboard of emqx, and it will show the number of message that EMQ X received.\nAlso, I would suggest to add a sleep time after mqtt.sendToMqtt(topic, 0, content);.\n100 threads without any sleep time between invocation of publish method will probably cause SDK failed to process.\n\nThanks for the response,I just figure out is not the emqx server's problem.It's client's.. ",
    "biswaKL": "its the latest one 3.0.0. 3.0.0. @linjunjj yes its running. ",
    "ioncamera": "\u975e\u8d85\u65f6\u65ad\u5f00\uff0c\u8d85\u65f6\u65ad\u5f00\u53ef\u4ee5\u6b63\u5e38\u6253\u5370[MQTT] Shutdown for keepalive_timeout. We set the interval time 25s, the heartbeat log as follow.\nBut in the end, 13 seconds after the emqx server receive and send heartbeat, emqx server print \"Terminated for {shutdown,closed}\"\n    Line 8711: 2019-01-12 10:21:34.788 [debug] STEBP@118.56.44.183:15697 [MQTT] RECV <<192,0>>\n    Line 8712: 2019-01-12 10:21:34.788 [debug] STEBP@118.56.44.183:15697 [MQTT] RECV PINGREQ(Q0, R0, D0)\n    Line 8713: 2019-01-12 10:21:34.789 [debug] STEBP@118.56.44.183:15697 [MQTT] SEND PINGRESP(Q0, R0, D0)\n    Line 8735: 2019-01-12 10:21:59.735 [debug] STEBP@118.56.44.183:15697 [MQTT] RECV <<192,0>>\n    Line 8736: 2019-01-12 10:21:59.736 [debug] STEBP@118.56.44.183:15697 [MQTT] RECV PINGREQ(Q0, R0, D0)\n    Line 8737: 2019-01-12 10:21:59.736 [debug] STEBP@118.56.44.183:15697 [MQTT] SEND PINGRESP(Q0, R0, D0)\n    Line 8750: 2019-01-12 10:22:24.324 [debug] STEBP@118.56.44.183:15697 [MQTT] RECV <<192,0>>\n    Line 8751: 2019-01-12 10:22:24.325 [debug] STEBP@118.56.44.183:15697 [MQTT] RECV PINGREQ(Q0, R0, D0)\n    Line 8752: 2019-01-12 10:22:24.337 [debug] STEBP@118.56.44.183:15697 [MQTT] SEND PINGRESP(Q0, R0, D0)\n    Line 8765: 2019-01-12 10:22:49.485 [debug] STEBP@118.56.44.183:15697 [MQTT] RECV <<192,0>>\n    Line 8766: 2019-01-12 10:22:49.486 [debug] STEBP@118.56.44.183:15697 [MQTT] RECV PINGREQ(Q0, R0, D0)\n    Line 8767: 2019-01-12 10:22:49.486 [debug] STEBP@118.56.44.183:15697 [MQTT] SEND PINGRESP(Q0, R0, D0)\n    Line 8789: 2019-01-12 10:23:14.696 [debug] STEBP@118.56.44.183:15697 [MQTT] RECV <<192,0>>\n    Line 8790: 2019-01-12 10:23:14.697 [debug] STEBP@118.56.44.183:15697 [MQTT] RECV PINGREQ(Q0, R0, D0)\n    Line 8791: 2019-01-12 10:23:14.697 [debug] STEBP@118.56.44.183:15697 [MQTT] SEND PINGRESP(Q0, R0, D0)\n    Line 8795: 2019-01-12 10:23:27.359 [debug] STEBP@118.56.44.183:15697 [MQTT] Terminated for {shutdown,closed}\n    Line 8796: 2019-01-12 10:23:27.359 [info] STEBP@118.56.44.183:15697 [MQTT] Shutdown for closed. ",
    "tangliming": "Just find the answer from #1272, this issue can be closed.. ",
    "aq2004723": "\u95ee\u9898\u5df2\u89e3\u51b3 \u662frabc\u6743\u9650\u95ee\u9898. ",
    "Frank111": "I have the same scene, I want to use prometheus+grafana.. > We can use this exporter bro ..\n\nhttps://github.com/nuvo/emq_exporter\n\nThank you very much, and is there a grafana template?. yeah, I mean dashboard, I didn't find a working template in grafana dashboard template.. topic\u3001collection\u3001node\u3001message count?\n```\nHELP emq_exporter_total_scrapes Current total scrapes.\nTYPE emq_exporter_total_scrapes counter\nemq_exporter_total_scrapes 5\nHELP emq_up Was the last scrape of EMQ successful\nTYPE emq_up gauge\nemq_up 0\nHELP go_gc_duration_seconds A summary of the GC invocation durations.\nTYPE go_gc_duration_seconds summary\ngo_gc_duration_seconds{quantile=\"0\"} 0\ngo_gc_duration_seconds{quantile=\"0.25\"} 0\ngo_gc_duration_seconds{quantile=\"0.5\"} 0\ngo_gc_duration_seconds{quantile=\"0.75\"} 0\ngo_gc_duration_seconds{quantile=\"1\"} 0\ngo_gc_duration_seconds_sum 0\ngo_gc_duration_seconds_count 0\nHELP go_goroutines Number of goroutines that currently exist.\nTYPE go_goroutines gauge\ngo_goroutines 13\nHELP go_info Information about the Go environment.\nTYPE go_info gauge\ngo_info{version=\"go1.11.4\"} 1\nHELP go_memstats_alloc_bytes Number of bytes allocated and still in use.\nTYPE go_memstats_alloc_bytes gauge\ngo_memstats_alloc_bytes 3.56732e+06\nHELP go_memstats_alloc_bytes_total Total number of bytes allocated, even if freed.\nTYPE go_memstats_alloc_bytes_total counter\ngo_memstats_alloc_bytes_total 3.56732e+06\nHELP go_memstats_buck_hash_sys_bytes Number of bytes used by the profiling bucket hash table.\nTYPE go_memstats_buck_hash_sys_bytes gauge\ngo_memstats_buck_hash_sys_bytes 1.444181e+06\nHELP go_memstats_frees_total Total number of frees.\nTYPE go_memstats_frees_total counter\ngo_memstats_frees_total 436\nHELP go_memstats_gc_cpu_fraction The fraction of this program's available CPU time used by the GC since the program started.\nTYPE go_memstats_gc_cpu_fraction gauge\ngo_memstats_gc_cpu_fraction 0\nHELP go_memstats_gc_sys_bytes Number of bytes used for garbage collection system metadata.\nTYPE go_memstats_gc_sys_bytes gauge\ngo_memstats_gc_sys_bytes 2.234368e+06\nHELP go_memstats_heap_alloc_bytes Number of heap bytes allocated and still in use.\nTYPE go_memstats_heap_alloc_bytes gauge\ngo_memstats_heap_alloc_bytes 3.56732e+06\nHELP go_memstats_heap_idle_bytes Number of heap bytes waiting to be used.\nTYPE go_memstats_heap_idle_bytes gauge\ngo_memstats_heap_idle_bytes 6.2111744e+07\nHELP go_memstats_heap_inuse_bytes Number of heap bytes that are in use.\nTYPE go_memstats_heap_inuse_bytes gauge\ngo_memstats_heap_inuse_bytes 4.472832e+06\nHELP go_memstats_heap_objects Number of allocated objects.\nTYPE go_memstats_heap_objects gauge\ngo_memstats_heap_objects 4753\nHELP go_memstats_heap_released_bytes Number of heap bytes released to OS.\nTYPE go_memstats_heap_released_bytes gauge\ngo_memstats_heap_released_bytes 0\nHELP go_memstats_heap_sys_bytes Number of heap bytes obtained from system.\nTYPE go_memstats_heap_sys_bytes gauge\ngo_memstats_heap_sys_bytes 6.6584576e+07\nHELP go_memstats_last_gc_time_seconds Number of seconds since 1970 of last garbage collection.\nTYPE go_memstats_last_gc_time_seconds gauge\ngo_memstats_last_gc_time_seconds 0\nHELP go_memstats_lookups_total Total number of pointer lookups.\nTYPE go_memstats_lookups_total counter\ngo_memstats_lookups_total 0\nHELP go_memstats_mallocs_total Total number of mallocs.\nTYPE go_memstats_mallocs_total counter\ngo_memstats_mallocs_total 5189\nHELP go_memstats_mcache_inuse_bytes Number of bytes in use by mcache structures.\nTYPE go_memstats_mcache_inuse_bytes gauge\ngo_memstats_mcache_inuse_bytes 6912\nHELP go_memstats_mcache_sys_bytes Number of bytes used for mcache structures obtained from system.\nTYPE go_memstats_mcache_sys_bytes gauge\ngo_memstats_mcache_sys_bytes 16384\nHELP go_memstats_mspan_inuse_bytes Number of bytes in use by mspan structures.\nTYPE go_memstats_mspan_inuse_bytes gauge\ngo_memstats_mspan_inuse_bytes 31008\nHELP go_memstats_mspan_sys_bytes Number of bytes used for mspan structures obtained from system.\nTYPE go_memstats_mspan_sys_bytes gauge\ngo_memstats_mspan_sys_bytes 32768\nHELP go_memstats_next_gc_bytes Number of heap bytes when next garbage collection will take place.\nTYPE go_memstats_next_gc_bytes gauge\ngo_memstats_next_gc_bytes 4.473924e+06\nHELP go_memstats_other_sys_bytes Number of bytes used for other system allocations.\nTYPE go_memstats_other_sys_bytes gauge\ngo_memstats_other_sys_bytes 1.054627e+06\nHELP go_memstats_stack_inuse_bytes Number of bytes in use by the stack allocator.\nTYPE go_memstats_stack_inuse_bytes gauge\ngo_memstats_stack_inuse_bytes 524288\nHELP go_memstats_stack_sys_bytes Number of bytes obtained from system for stack allocator.\nTYPE go_memstats_stack_sys_bytes gauge\ngo_memstats_stack_sys_bytes 524288\nHELP go_memstats_sys_bytes Number of bytes obtained from system.\nTYPE go_memstats_sys_bytes gauge\ngo_memstats_sys_bytes 7.1891192e+07\nHELP go_threads Number of OS threads created.\nTYPE go_threads gauge\ngo_threads 9\nHELP process_cpu_seconds_total Total user and system CPU time spent in seconds.\nTYPE process_cpu_seconds_total counter\nprocess_cpu_seconds_total 0.13\nHELP process_max_fds Maximum number of open file descriptors.\nTYPE process_max_fds gauge\nprocess_max_fds 1024\nHELP process_open_fds Number of open file descriptors.\nTYPE process_open_fds gauge\nprocess_open_fds 12\nHELP process_resident_memory_bytes Resident memory size in bytes.\nTYPE process_resident_memory_bytes gauge\nprocess_resident_memory_bytes 1.206272e+07\nHELP process_start_time_seconds Start time of the process since unix epoch in seconds.\nTYPE process_start_time_seconds gauge\nprocess_start_time_seconds 1.54868698319e+09\nHELP process_virtual_memory_bytes Virtual memory size in bytes.\nTYPE process_virtual_memory_bytes gauge\nprocess_virtual_memory_bytes 1.14630656e+08\nHELP process_virtual_memory_max_bytes Maximum amount of virtual memory available in bytes.\nTYPE process_virtual_memory_max_bytes gauge\nprocess_virtual_memory_max_bytes -1\nHELP promhttp_metric_handler_requests_in_flight Current number of scrapes being served.\nTYPE promhttp_metric_handler_requests_in_flight gauge\npromhttp_metric_handler_requests_in_flight 1\nHELP promhttp_metric_handler_requests_total Total number of scrapes by HTTP status code.\nTYPE promhttp_metric_handler_requests_total counter\npromhttp_metric_handler_requests_total{code=\"200\"} 3\npromhttp_metric_handler_requests_total{code=\"500\"} 0\npromhttp_metric_handler_requests_total{code=\"503\"} 0\n```\n. > maybe your flag is still not correct, because I get this,\n\nhttps://pastebin.com/LgX7j3SE\n\nI used emq-3.0 version,is there any error\uff1f\n./emq_exporter --emq.uri=\"http://localhost:8080\" --emq.username=\"admin\" --emq.password=\"public\" --emq.node=\"emqx@127.0.0.1\"  --emq.api-version=\"v3\" . yeah, i can access http://localhost:18083/#/applications by using username and password,  but applications list is empty,  show your execute command?. the --emq.password  is not emqx dashboard user\u3001password (localhost:18083)? . > No, it's different. 18083 is dashboard (admin:public) and 8080 is API (AppID:AppSecret)\n\n--emq.password is AppSecret.\n--emq.username is AppID\n\nThanks, my version is v3.0-rc.5 ,and I get the same results when i used v3.0.1 .. @enrahmad  Hi\uff0ccan you share your dashboard with me? . ",
    "enrahmad": "We can use this exporter bro ..\nhttps://github.com/nuvo/emq_exporter. \nDashboard you mean? Here, I just get value from metrics and show using graph.. maybe your flag is still not correct, because I get this,\nhttps://pastebin.com/LgX7j3SE. Have you ever accessed API using that username and password, and success? If yes, i've no idea.\nIf no, maybe you need make an AppID at http://localhost:18083/#/applications then use AppID (username) and AppSecret (password) to access API.. $ ./emq_exporter --emq.password=\"Mjg1NjkyMzU0Mzk5OTIyNjY2MDIwNDQ2NTc2NTUyODM3MTC\" --emq.api-version=v3 --emq.node=\"emqx@127.0.0.1\"\nhttps://d1edrlpyc25xu0.cloudfront.net/kiwari-prod/image/upload/97QT4s1mhJ/Screenshot+from+2019-01-29+15-06-45.png. No, it's different. 18083 is dashboard (admin:public) and 8080 is API (AppID:AppSecret)\n--emq.password is AppSecret.\n--emq.username is AppID. Oh let's see,\n```\n---------step 4 ------\nemqx2:~$ emqx_ctl cluster status\nCluster status: [{running_nodes,['emqx2@10.0.0.2','emqx3@10.0.0.3']},\n                 {stopped_nodes,['emqx1@10.0.0.1']}]\n--------- step 5 -------\nemqx4:~$ emqx_ctl cluster status\nCluster status: [{running_nodes,['emqx1@10.0.0.1','emqx4@10.0.0.4']}]\n```\nWhy emqx1 is in emqx2's cluster and it was stop? My expectation it was go away automatically from emqx2's cluster because emqx1 join at emqx4's cluster. \n. ",
    "chrysa95": "@linjunjj  @Gilbert-Wong \nHello ,\nI have install the emqx broker like this unzip emqttd-ubuntu16.04-v2.3.11.zip\nAlso, after that i have 3 files emqttd , emqx  and emqx-rel.\nThe file emqx doesn't include bin file\nThe file emqttd contains bin file which have emqttd,emqttd.cmd,emqttd_ctl,  ...etc\nThe file  emqx-rel contains bin file bin file which have emqx,emqx.cmd,emqx_ctl,  ...etc\nWhich of the above files should I run and how ?I'm confused\nI try \n      hit2@hit2-Virtual-Machine:~/emqx-rel$ ./bin/emqx start\n      hit2@hit2-Virtual-Machine:~/emqx-rel$ ./emqx_rel/bin/emqx start\n      hit2@hit2-Virtual-Machine:~/emqx-rel$ ./bin/emqx.cmd start\n     hit2@hit2-Virtual-Machine:~/emqttd$ ./bin/emqttd start\n. @Gilbert-Wong \nI did what you suggested but did not work, the same mistake remains.\n\n\nUbuntu version 16.04.5\n\n\n\u0399 have download the zip file emqx-ubuntu16.04-v3.0.0 from this source: htps://www.emqx.io/downloads/emq/broker\n\n\nThen,  in command line i install broker like this : unzip emqx-ubuntu16.04-v3.0.0.zip\nAlso , i have intsall the erlang \n. ",
    "suijunqiang": "@linjunjj \nfull error log as below after clicking config\n2019-01-20 01:11:48.130 [error] GET /api/v3/nodes/emqx@127.0.0.1/plugin_configs/emqx_auth_mysql error: {badmatch,\n                                                                        {error,\n                                                                         {'EXIT',\n                                                                          {badarg,\n                                                                           [{ets,\n                                                                             lookup,\n                                                                             [emqx_config,\n                                                                              emqx_auth_mysql],\n                                                                             []},\n                                                                            {emqx_mgmt_cli_cfg,\n                                                                             read_config,\n                                                                             1,\n                                                                             [{file,\n                                                                               \"src/emqx_mgmt_cli_cfg.erl\"},\n                                                                              {line,\n                                                                               70}]},\n                                                                            {emqx_mgmt_config,\n                                                                             read_,\n                                                                             1,\n                                                                             [{file,\n                                                                               \"src/emqx_mgmt_config.erl\"},\n                                                                              {line,\n                                                                               89}]},\n                                                                            {emqx_mgmt_config,\n                                                                             read,\n                                                                             1,\n                                                                             [{file,\n                                                                               \"src/emqx_mgmt_config.erl\"},\n                                                                              {line,\n                                                                               38}]},\n                                                                            {rpc,\n                                                                             local_call,\n                                                                             3,\n                                                                             [{file,\n                                                                               \"rpc.erl\"},\n                                                                              {line,\n                                                                               321}]},\n                                                                            {emqx_mgmt,\n                                                                             rpc_call,\n                                                                             3,\n                                                                             [{file,\n                                                                               \"src/emqx_mgmt.erl\"},\n                                                                              {line,\n                                                                               477}]},\n                                                                            {emqx_mgmt_api_configs,\n                                                                             get_plugin_configs,\n                                                                             2,\n                                                                             [{file,\n                                                                               \"src/emqx_mgmt_api_configs.erl\"},\n                                                                              {line,\n                                                                               85}]},\n                                                                            {minirest_handler,\n                                                                             dispatch,\n                                                                             3,\n                                                                             [{file,\n                                                                               \"src/minirest_handler.erl\"},\n                                                                              {line,\n                                                                               55}]}]}}}}, stacktrace:\n[{emqx_mgmt_api_configs,get_plugin_configs,2,\n                        [{file,\"src/emqx_mgmt_api_configs.erl\"},{line,85}]},\n {minirest_handler,dispatch,3,[{file,\"src/minirest_handler.erl\"},{line,55}]},\n {minirest,handle_request,2,[{file,\"src/minirest.erl\"},{line,66}]},\n {minirest,init,2,[{file,\"src/minirest.erl\"},{line,51}]},\n {cowboy_handler,execute,2,[{file,\"src/cowboy_handler.erl\"},{line,37}]},\n {cowboy_stream_h,execute,3,[{file,\"src/cowboy_stream_h.erl\"},{line,274}]},\n {cowboy_stream_h,request_process,3,\n                  [{file,\"src/cowboy_stream_h.erl\"},{line,252}]},\n {proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,249}]}]. Opooos...\nThe issue same as https://github.com/emqx/emqx/issues/1946\nHow ever in the issue of 1946, has not clear how to input correct credentials in emqx_auth_mysql.conf.\nI have added mysql user/pasword,  but the errors seem the module of emqx_auth_mysql.conf has not been load...\n. @Gilbert-Wong \nIt works well after setting emqx_auth_mysql.conf & restart the process of emqx.\nThanks anyway.\n. ",
    "driverzhang": "me too. ",
    "earnestXu": "this issue is fixed without doing anything. . ",
    "wajidp": "Any update?. not via rpm\n. can we have an ETA ?. Update openssl now running\nopenssl version \nOpenSSL 1.0.2q  20 Nov 2018\nBut still same error. Worked thanks. through the plugin conf emqx_auth_ldap.conf. I have configured as per the readme & this is a working ldap settings \n```\n--------------------------------------------------------------------\nLDAP Auth Plugin\n--------------------------------------------------------------------\nLDAP server list, seperated by ','.\n\nValue: String\nauth.ldap.servers = 192.168.0.100\nLDAP server port.\n\nValue: Port\nauth.ldap.port = 389\nLDAP pool size\n\nValue: String\nauth.ldap.pool = 8\nLDAP Bind DN.\n\nValue: DN\nauth.ldap.bind_dn = cn=dcadministrator,cn=users,dc=dt,dc=local\nLDAP Bind Password.\n\nValue: String\nauth.ldap.bind_password = XXXXXXX\nLDAP query timeout.\n\nValue: Number\nauth.ldap.timeout = 30s\nDevice DN.\n\nVariables:\n\nValue: DN\nauth.ldap.device_dn = cn=users,dc=dt,dc=local\nSpecified ObjectClass\n\nVariables:\n\nValue: string\nauth.ldap.match_objectclass = users\nattributetype for username\n\nVariables:\n\nValue: string\nauth.ldap.username.attributetype = sAMAccountName\nattributetype for password\n\nVariables:\n\nValue: string\nauth.ldap.password.attributetype = userPassword\nWhether to enable SSL.\n\nValue: true | false\nauth.ldap.ssl = false\nTODO: SSL Support\nauth.ldap.ssl.certfile = etc/certs/cert.pem\nauth.ldap.ssl.keyfile = etc/certs/key.pem\nauth.ldap.ssl.cacertfile = etc/certs/cacert.pem\nauth.ldap.ssl.verify = verify_peer\nauth.ldap.ssl.fail_if_no_peer_cert = true\n```. Find below \n2019-01-28 14:38:16.476 [error] ad305941-c7c5-4d43-9b4f-1b0d73aa96e01548664054947@192.168.250.45:52392 Username 'dcadministrator' login failed for auth_modules_not_found. we have a working active directory in the specified host & the same parameters are used for gitlab ldap authentication which works fine\ngitlab_rails['ldap_servers'] = YAML.load <<-'EOS'\n   main: # 'main' is the GitLab 'provider ID' of this LDAP server\n     label: 'DT'\n     host: '192.168.0.100'\n     port: 389\n     uid: 'sAMAccountName'\n     bind_dn: 'cn=dcadministrator,cn=users,dc=dt,dc=local'\n     password: 'XXXXXXXX'\n     encryption: 'plain' # \"start_tls\" or \"simple_tls\" or \"plain\"\n     verify_certificates: false\n     active_directory: true\n     allow_username_or_email_login: false\n     lowercase_usernames: false\n     block_auto_created_users: false\n     base: 'cn=users,dc=dt,dc=local'\n     user_filter: ''\n EOS\n. Find below\n2019-01-28 14:51:54.748 [debug] ad305941-c7c5-4d43-9b4f-1b0d73aa96e01548672150374@192.168.250.45:53294 SEND CONNACK(Q0, R0, D0, AckFlags=0, ReasonCode=5)\n2019-01-28 14:51:54.748 [debug] ad305941-c7c5-4d43-9b4f-1b0d73aa96e01548672150374@192.168.250.45:53294 Terminated for {shutdown,unauthorized_client}\n2019-01-28 14:51:55.773 [debug] 192.168.250.45:53295 RECV <<16,101,0,4,77,81,84,84,4,194,0,10,0,49,97,100,51,48,53,57,52,49,45,99,\n       55,99,53,45,52,100,52,51,45,57,98,52,102,45,49,98,48,100,55,51,97,97,57,\n       54,101,48,49,53,52,56,54,55,50,49,53,48,51,55,52,0,15,100,99,97,100,109,\n       105,110,105,115,116,114,97,116,111,114,0,21,100,99,97,100,109,105,110,\n       105,115,116,114,97,116,111,114,35,64,50,48,50,48>>\n2019-01-28 14:51:55.774 [debug] 192.168.250.45:53295 RECV CONNECT(Q0, R0, D0, ClientId=ad305941-c7c5-4d43-9b4f-1b0d73aa96e01548672150374, ProtoName=MQTT, ProtoVsn=4, CleanStart=true, KeepAlive=10, Username=dcadministrator, Password=******)\n2019-01-28 14:51:55.775 [error] ad305941-c7c5-4d43-9b4f-1b0d73aa96e01548672150374@192.168.250.45:53295 Username 'dcadministrator' login failed for auth_modules_not_found. > we have a working active directory in the specified host & the same parameters are used for gitlab ldap authentication which works fine\n\ngitlab_rails['ldap_servers'] = YAML.load <<-'EOS'\n   main: # 'main' is the GitLab 'provider ID' of this LDAP server\n     label: 'DT'\n     host: '192.168.0.100'\n     port: 389\n     uid: 'sAMAccountName'\n     bind_dn: 'cn=dcadministrator,cn=users,dc=dt,dc=local'\n     password: 'XXXXXXXX'\n     encryption: 'plain' # \"start_tls\" or \"simple_tls\" or \"plain\"\n     verify_certificates: false\n     active_directory: true\n     allow_username_or_email_login: false\n     lowercase_usernames: false\n     block_auto_created_users: false\n     base: 'cn=users,dc=dt,dc=local'\n     user_filter: ''\n EOS\n\nThe above works for me with gitlab dcadministrator . ldapsearch result\n```\nldapsearch \\\n\n-x -h 192.168.0.100 \\\n-D \"dcadministrator\" \\\n-W \\\n-b \"cn=dcadministrator,cn=users,dc=dt,dc=local\"\n\nEnter LDAP Password: \n\nextended LDIF\n\nLDAPv3\nbase  with scope subtree\nfilter: (objectclass=*)\nrequesting: ALL\n\nDCAdministrator, Users, dt.local\ndn: CN=DCAdministrator,CN=Users,DC=dt,DC=local\nobjectClass: top\nobjectClass: person\nobjectClass: organizationalPerson\nobjectClass: user\ncn: DCAdministrator\ndescription: LDAP Authentication for Gitlab (Bigdata)\ngivenName: DCAdministrator\ndistinguishedName: CN=DCAdministrator,CN=Users,DC=dt,DC=local\ninstanceType: 4\nwhenCreated: 20190108065024.0Z\nwhenChanged: 20190118152741.0Z\ndisplayName: DCAdministrator\nuSNCreated: 104833633\nuSNChanged: 107251647\nname: DCAdministrator\nobjectGUID:: xsunRPR2jEmsLQMdY6ChBA==\nuserAccountControl: 66048\nbadPwdCount: 0\ncodePage: 0\ncountryCode: 0\nbadPasswordTime: 131931489761821599\nlastLogoff: 0\nlastLogon: 131931490315948032\npwdLastSet: 131914038244103197\nprimaryGroupID: 513\nobjectSid:: AQUAAAAAAAUVAAAA4m6hXfnjE8soEq+p1g8AAA==\nadminCount: 1\naccountExpires: 9223372036854775807\nlogonCount: 6\nsAMAccountName: dcadministrator\nsAMAccountType: 805306368\nuserPrincipalName: dcadministrator@dt.local\nobjectCategory: CN=Person,CN=Schema,CN=Configuration,DC=dt,DC=local\ndSCorePropagationData: 20190108071432.0Z\ndSCorePropagationData: 20190108065024.0Z\ndSCorePropagationData: 16010101000000.0Z\nlastLogonTimestamp: 131922988616502079\nsearch result\nsearch: 2\nresult: 0 Success\nnumResponses: 2\nnumEntries: 1\n. kindly note ldap is **microsoft active directory** @Gilbert-Wong . It doesn't work with microsoft ad @Gilbert-Wong.\nI tried uid. Any update or did i miss something?. am not able to curl from the pod can you help me out?\nbut its accessible from the node.\nNAME                                READY     STATUS    RESTARTS   AGE       IP          \nemqx-77589b484c-d6lkr               1/1       Running   0          15m       10.244.3.134 \nemqx-77589b484c-w9hng               1/1       Running   0          15m       10.244.1.110 \nemqx-77589b484c-wl7q5               1/1       Running   0          15m       10.244.0.119 \n\nWajids-MacBook-Pro:k8s-fluentd-elk wajid$ kubectl exec -it emqx-77589b484c-d6lkr /bin/sh\n/opt/emqx # curl http://192.168.53.71:8080/api/v1/namespaces/default/pods\ncurl: (7) Failed to connect to 192.168.53.71 port 8080: Connection refused\n/opt/emqx # ping 192.168.53.71\nPING 192.168.53.71 (192.168.53.71): 56 data bytes\n64 bytes from 192.168.53.71: seq=0 ttl=63 time=0.462 ms\n64 bytes from 192.168.53.71: seq=1 ttl=63 time=0.551 ms\n```\nWhat will be the reason?\n. ",
    "rangeshgupta-altair": "I also faced the same issue:\n{\"Kernel pid terminated\",application_controller,\"{application_start_failure,kernel,{{shutdown,{failed_to_start_child,kernel_safe_sup,{on_load_function_failed,crypto}}},{kernel,start,[normal,[]]}}}\"}\nKernel pid terminated (application_controller) ({application_start_failure,kernel,{{shutdown,{failed_to_start_child,kernel_safe_sup,{on_load_function_failed,crypto}}},{kernel,start,[normal,[]]}}})\nBut after upgrading the openssl library, service started. In my case, without upgrading all the packages it worked.\nVersio before upgrade: OpenSSL 1.0.1e-fips 11 Feb 2013\nVersion after upgrade: OpenSSL 1.0.2k-fips  26 Jan 2017\n. \n@zhanghongtong: Thanks for the reply! \nCan we compile it from source code for SUSE? Did anyone try it before and is there any bottleneck or challenge, which you guys are aware of it?. ",
    "IcyBridge": "Environment\n\n\nOS : Windows Server 2016 x64\n\n\nErlang/OTP:\n\n\nEMQ X 3.0.1\n\n\nIs there any solutions for the problem yet? Problem is similar to this issue. Following line comes with console command.\nC:\\Program Files (x86)\\EMQ X\\Windows 10>bin\\emqx console\nC:\\Program Files (x86)\\EMQ X\\Windows 10>set args_file=-args_file \"C:\\Program Files (x86)\\EMQ X\\Windows 10\\etc\\vm.args\"\nC:\\Program Files (x86)\\EMQ X\\Windows 10>set sys_config=-config \"C:\\Program Files (x86)\\EMQ X\\Windows 10\\etc\\sys.config\"\n\\EMQ was unexpected at this time.\nC:\\Program Files (x86)\\EMQ X\\Windows 10>  set boot_script=C:\\Program Files (x86)\\EMQ X\\Windows 10\\releases\\3.0.1\\emqx\nC:\\Program Files (x86)\\EMQ X\\Windows 10>. ",
    "WooHao": "I have the same problem.\n@Gilbert-Wong do you have a plan to solve this?. ",
    "GuiuMateu": "Hi @Gilbert-Wong,\nI was talking about users, not clients/sessions. I agree that one MQTT client with his session only exist in one node, but I think that users (available to manage cluster by API or web) should exists in all nodes.\nIf I have one cluster with 3 nodes and a new admin user is created by API Rest (POST api/v2/users) in one node, the other two don't have this user, so I can't login in management web (18083) on these nodes.\nIs that correct?\nThank you. ",
    "danigranados": "\nIn the latest implementation of emqx cluster mode, one client/session just exist in one node, it would not be backup or migrated in different nodes. We would redesign it in the future.\n\nIf users are not replicated at all the nodes, when they send a request to the API with their credentials at basic auth header they obtain a 401 when load balancer sends the request to the node that has not that user information. If there are two nodes, then you have that half of the times user get an unauthorized response at login.. ",
    "nixlong": "\nPlease try with git reset --hard and make distclean , then make project again.\n\nthx, it works... : ). ",
    "aaamitsingh": "@Gilbert-Wong : Any update?. > @aaamitsingh Do you mean to use username and password authentication in plugin 'emqx_auth_username' \uff1f\n@linjunjj : Yes\n. @linjunjj Have you tested it at your side?\n. @linjunjj The problem is neither the password is updating nor the user is deleting from the CLI although when I'm giving the command for the update and delete I'm getting a response \"OK\".. @linjunjj Yes, Redis is running.  I'm using \"Amazon ElastiCache for Redis\" and I can connect it from the Redis-cli running on same Ec2 instance where EMQX is installed.. @linjunjj @turtleDeng : Any help?. @linjunjj : Here is my \"emqx_auth_redis.conf\" file:\n\n. @linjunjj : Yes, the firewall is open and I can connect to the Redis from the Redis-cli running on same Ec2 instance where EMQX is installed.. @linjunjj : I have installed the redis-cli on the same server where emqx is running. I can access the Redis by using basic redis-cli command like \"redis-cli -h MyServerAddress -p 6379\". ",
    "salcedo": "Correct. I was supposed to point to 8083 not 1883. Thanks!. ",
    "drPytho": "https://screenshots.firefox.com/nj3vOMhRisJHKXoT/localhost\n. out.pcap.log\nA Wireshark pcap file with .log to upload. (51e68d20911d@172.17.0.2)1> 2019-02-06 21:10:25.979 [debug] 172.17.0.1:55966 RECV CONNECT(Q0, R0, D0, ClientId=866039040298482, ProtoName=MQIsdp, ProtoVsn=3, CleanStart=true, KeepAlive=0, Username=guest, Password=******)\n(51e68d20911d@172.17.0.2)1> 2019-02-06 21:10:25.980 [debug] 866039040298482@172.17.0.1:55966 SEND CONNACK(Q0, R0, D0, AckFlags=0, ReasonCode=0)\n(51e68d20911d@172.17.0.2)1> 2019-02-06 21:10:26.819 [debug] 866039040298482@172.17.0.1:55966 RECV <<130,6,0,0,0,1,99,1>>\n(51e68d20911d@172.17.0.2)1> 2019-02-06 21:10:26.820 [debug] 866039040298482@172.17.0.1:55966 RECV SUBSCRIBE(Q1, R0, D0, PacketId=0, TopicFilters=[{<<\"c\">>,\n                           #{nl => 0,qos => 1,rap => 0,rc => 0,rh => 0}}])\n(51e68d20911d@172.17.0.2)1> 2019-02-06 21:10:26.824 [debug] 866039040298482@172.17.0.1:55966 Terminated for {shutdown,packet_id_invalid}\n(51e68d20911d@172.17.0.2)1> 2019-02-06 21:10:26.824 [info] 866039040298482@172.17.0.1:55966 Shutdown for packet_id_invalid. Is there some way to get around the packetId being zero?\n. Embedded C version of https://github.com/eclipse/paho.mqtt.embedded-c. Yes, it was a poor implementation of the mqtt client. It worked with rabbitmq-mqtt so bad assumption on my side lead me to think something was off here. No issues here. . ",
    "sbcsuman": "Hi Team,\nI am created emqttd LB setup with roundrobin . but i want to failover setup. ",
    "rajkiranjeet": "what protocol we have to select over ssl so we dont have to use certificate on client side ,please explain little more as we already setup ssl on emq dahsbpard.\n. Re you able to do some paid work to setup things for us if you have good experience,we already finding some one on upwork but no one we find ,please help us.\nthanks\n. ",
    "mozaiquan": "\nI suggest you to start emqx via emqx.cmd start on windows.\n\nthere will be another error:\n\n. > If you want to start emqx on windows , the path you place emqx should not contain space, you could place emqx in root directory of C disc. For example, C:\\emqx. Anyway, it is not a good choice to run emqx on windows. I suggest you to run emqx on linux.\nWorks! Thanks very much.. ",
    "horowitzb": "apparently when I enter  ./bin/emqx_ctl bridges start aws, I get start bridge successfully.. the aws bridge seems to be defined in the emqx.conf file, so maybe I should make a new section in emqx.conf for every bridge I want to make?  \nedit: adding a custom bridge to emqx.conf seems to work. Is there any up-to-date documentation for EMQ X? the documentation here doesn't seem to match up with the implementation of bridges I'm currently using (which I believe to be the latest version).. one further question: has the ability to both publish and subscribe to  a bridge been implemented yet? I'm able to subscribe through a bridge, but there doesn't seem to be an option to publish (that I can find). And if I try to create a bridge between both brokers, and subscribe to a topic on both, publishing to that topic from a client causes an infinite loop.. ",
    "servucn": "\ndetails\n\n\n. ",
    "zhongtianxie": "\nYes, we have v3.0.1 arm64 architecture package and docker image, you can access here and here to get\n\nthanks a lot , i'd got it. thanks you effort .. ",
    "wigginskuang": "@emqplus . ",
    "avivros": "I understand that Linux is a preferred option but why is it not recommended to run Emqx on Windows Server?\nIs it just that Linux performance is better or are there some other limitations?. ",
    "Pilchards": "Duplicate of #https://github.com/emqx/emqx-web-hook/issues/93. ",
    "viktorsmari": "Of course, when I am using the Dashboard, and connecting with Websockets, I am connecting from my computer, therefore using my own IP address, not the servers IP.\nSo if I add my own IP address to the ACL file, it works.\nIs there a way to make the Dashboard always able to connect with Websockets, no matter who is logged in to the Dashboard?\n\nFor example, you have 3 admins logged in to the Dashboard from anywhere in the world, and they want to use the Websocket tool.\n\nUPDATE\nI found out I just had to add dashboard in the Username field before connecting with the Websocket. - No Password needed\n\n. ",
    "sriuppu": "I understand that currently there is a feature, which can be enabled to cache ACL for a topic whenever the client publishes/subscribes on that topic for the first time or if the TTL has expired.\nBut what I am looking for here is to cache all the allowed topics for pub/sub for that client (complete ACL set) at once on successful client authentication, rather than caching ACL each topic when a client does a publish/subscribe.. ",
    "ThucHoang": "I got a tip to increase the timeout of the LoadBalancer I created for my service to be over 60s (because they also have it has the default timeout value). This solved the issue I mentioned above. . ",
    "xpunch": "Can you improve your log format, it's really hard to read this error log.. Sorry, turn out it's kafka not work properly.. ",
    "haimiko": "Found the root cause:\nDefault behavior of upstart service command is to remove all environment variables. \nWhen i write a wrapper script for the emqttd command, and use sudo -H to set the home dir, like so:\n```\n!/bin/sh\nBEGIN INIT INFO\nProvides:        emqttd\nRequired-Start:  $network $remote_fs $syslog\nRequired-Stop:   $network $remote_fs $syslog\nDefault-Start:   2 3 4 5\nDefault-Stop:    1\nShort-Description: Start emqttd daemon\nEND INIT INFO\nsudo -H /opt/emqttd/bin/emqttd $@\n```\nand then run:\n```\nupdate-rc.d emqttd defaults\n```\nEverything works well!  Problem solved.\n. ",
    "xiangjiangnan": "\n@xiangjiangnan Hi, please check if you have any typos about IP addresses in your configuration file of mysql auth plugin.\n\nI use the default config,does it any question? But my username authentication is also based on this mysql auth plugin and it runs ok.. > Could you post the content of your emq_auth_pgsql.conf here?\nThis is my emq_auth_mysql.conf file.\nauth.mysql.server = 127.0.0.1:3306\nauth.mysql.pool = 8\nauth.mysql.username = root\nauth.mysql.password = xxxx(mysql password )\nauth.mysql.database = mqtt\nauth.mysql.auth_query = select password,salt from mqtt_user where username = '%u' limit 1\nauth.mysql.password_hash = md5,salt\nauth.mysql.super_query = select is_superuser from mqtt_user where username = '%u' limit 1\nauth.mysql.acl_query = select allow, ipaddr, username, clientid, access, topic from mqtt_acl where ipaddr = '%a' or username = '%u' or username = '$all' or clientid = '%c'. I'm so sorry .It's my fault , i insert a record containing NULL,but  i write to 'NULL'.\nThanks.. ",
    "kscorpio": "Q 4 ,When to transmit local topic message to Aliyun Iot( send or receive) , how to configure the parameters below? \n -  bridge.aliyun.forwards = \n -  bridge.aliyun.subscription.1.topic = cmd/topic1\n -  bridge.aliyun.subscription.1.qos = 0 \n -  bridge.aliyun.subscription.2.topic = cmd/topic2\n -  bridge.aliyun.subscription.2.qos = 0\nQ5 Because, Aliyun iot has a special device name gateway, which can control some sub-device. Can the devices of EMQx play the role of sub-device on Aliyun iot . I config  bridge.aliyun.forwards = /product/bridge_device/update ,  Because ,Aliyun IOT Limit topic functions only can publish or subscribe by the device named \" bridge_device \" , \nSo on Aliyun ,EMQ is just a general device named  \" bridge_device \". On the EMQ side , When l the devices just only publish to the topic /product/bridge_device/update,  EMQ can forward the message to Aliyun . Is there a method , realize the devices of EMQ communicate with the devices of Aliyun. If file emqx.conf has some errors , can emq shows the error lines when start. like \uff1a bridge.edge.type = in may lead to start fail \uff08EMQ 3.0.1\uff09. ",
    "elvizlai": "@Eluso \n1\u3001No need to use + or #, because topic name is clear.\n2\u3001only $queue not works\nserver side\nfor {\n        fmt.Println(cli.Publish(\"test/abc/123\", 1, false, time.Now().String()).Error())\n        <-time.After(time.Second)\n    }\ngo client code\n```\n    // not work\n    cli.Subscribe(\"$queue/test/abc/123\", 1, func(c mqtt.Client, msg mqtt.Message) {\n        fmt.Println(\"queue\", string(msg.Payload()), msg.Duplicate(), msg.Retained(), msg.MessageID(), msg.Qos())\n    })\n// works well\ncli.Subscribe(\"$share/group1/test/abc/123\", 1, func(c mqtt.Client, msg mqtt.Message) {\n    fmt.Println(\"share\", string(msg.Payload()), msg.Duplicate(), msg.Retained(), msg.MessageID(), msg.Qos())\n})\n\n```. @Eluso @linjunjj may be there is something wrong with go sdk?\nThe dashboard shows $queue subscribe ok, but there is no message for go to print\n\n\n. LOL... go mqtt client only support $share prefix now.\n\n. ",
    "motomyslen": "Thanks for quick answer. https://github.com/emqx/esockd can't be combined with mqtt-sn as termination proxy? Maybe you know if solution like this will work: MQTT-SN client -> (DTLS encryption) -> (DTLS termination proxy) -> MQTT-SN Gateway? . ",
    "karlem": "I have to same issue on EMQ: v3.0.0. ",
    "h00s": "\n@h00s The problem has been fixed and will be released in beta.2 :)\n\nSorry for not providing emqx.conf file, I've been quite busy last few days.\nBut, my emqx.conf is basic, only changes on cluster cookie, node name and anonymous set to false.\nGood to hear it will be fixed! :) Thanks for the fix and all the hard work, will test it when beta.2 is released!. ",
    "visit24ir": "@linjunjj I believe disconnection alone is not just enough. i suppose there must be a way to handle exceptions such as sending non-zero return code \"5\"  not authorized.. ",
    "jerrylee529": "I fixed this problem,  the node.name was set with a wrong ip address. ",
    "kaido42": "\nCould you provide completely the 1st and 2nd part of raw data to help to dig out this problem?\n\nsure, but not publicly. your email?\n. > You can send it to: heeejianbo@gmail.com\nsent.. easily repeatable with the following python code:\n```\nmport paho.mqtt.client as mqtt\nimport time\ndef main():\n  client = mqtt.Client()\n  client.connect(\"localhost\", 4883 , 60) ## your broker address/port here\n  client.loop_start()\nfor x in range (16):\n      msg = \"_\" + str(x)\n      msg = msg.zfill(100)\n      client.publish('kala/kala', payload=msg)\ntime.sleep(2)\n  client.loop_stop()\nmain()\n```. >> Is there a workaround for this? \nsure, the bug has to be fixed :). ",
    "jgustavo99": "Hello!\nIn session events and connected devices is working.\nbut when I post a message on the topic I do not receive the data in the callback.\n. Is the beta case already fixed?. Thank you. A doubt. Is there any documentation that directs me to migrate one version to another?\nFor example, a beta for stable.\n. ",
    "bkrajendra": "Ok ... so now I just ran command\nchown emqx mydomain.key\nand it started working.!. ",
    "jinrm": "validated in the latest 3.1 beta.2 build, and it has been fixed.. ",
    "elvisci": "Line 51 is too long:     ets:new(?ACL_RULE_TAB, [set, public, named_table, {read_concurrency, true}]),.\n. Remove the dynamic function call on line 147. Only modules that define callbacks should make dynamic calls.\n. Line 167 is too long:             ets:insert(?ACCESS_CONTROL_TAB, {tab_key(Type), lists:keydelete(Mod, 1, Mods)}),.\n. The spec in line 50 uses a record, please define a type for the record and use that instead.\n. Line 58 is too long: -spec auth(Client :: mqtt_client(), Password :: password()) -> ok | {error, any()}..\n. Line 130 is too long:     ets:insert(?ACCESS_CONTROL_TAB, {auth_modules, init_mods(auth, proplists:get_value(auth, Opts))}),.\n. Line 79 is too long: check(#mqtt_client{client_id = ClientId, peername = {IpAddress, }}, _Password, [{password, no}|]) ->.\n. Line 89 is too long: match(Client, _Topic, {AllowDeny, all}) when (AllowDeny =:= allow) orelse (AllowDeny =:= deny) ->.\n. Line 152 is too long:                         ets:insert(?ACCESS_CONTROL_TAB, {tab_key(Type), NewMods}),.\n. Line 87 is too long:         {'EXIT', Reason} -> lager:error(\"Load module ~s error: ~p\", [Name, Reason]).\n. Remove the dynamic function call on line 85. Only modules that define callbacks should make dynamic calls.\n. The spec in line 50 uses a record, please define a type for the record and use that instead.\n. Line 167 is too long:             ets:insert(?ACCESS_CONTROL_TAB, {tab_key(Type), lists:keydelete(Mod, 1, Mods)}),.\n. Line 79 is too long: check(#mqtt_client{client_id = ClientId, peername = {IpAddress, }}, Password, [{password, no}|]) ->.\n. Line 167 is too long:             ets:insert(?ACCESS_CONTROL_TAB, {tab_key(Type), lists:keydelete(Mod, 1, Mods)}),.\n. Remove the dynamic function call on line 141. Only modules that define callbacks should make dynamic calls.\n. Line 131 is too long:     ets:insert(?ACCESS_CONTROL_TAB, {acl_modules, init_mods(acl, proplists:get_value(acl, Opts))}),.\n. Line 79 is too long: check(#mqtt_client{client_id = ClientId, peername = {IpAddress, }}, _Password, [{password, no}|]) ->.\n. Remove the dynamic function call on line 147. Only modules that define callbacks should make dynamic calls.\n. Line 87 is too long:         {'EXIT', Reason} -> lager:error(\"Load module ~s error: ~p\", [Name, Reason]).\n. Use the '-callback' attribute instead of 'behavior_info/1' on line 42.\n. The spec in line 81 uses a record, please define a type for the record and use that instead.\n. Line 30 is too long: -spec start(StartType, StartArgs) -> {ok, pid()} | {ok, pid(), State} | {error, Reason} when .\n. Line 131 is too long:     ets:insert(?ACCESS_CONTROL_TAB, {acl_modules, init_mods(acl, proplists:get_value(acl, Opts))}),.\n. Remove the dynamic function call on line 84. Only modules that define callbacks should make dynamic calls.\n. Line 129 is too long:     ets:new(?ACCESS_CONTROL_TAB, [set, named_table, protected, {read_concurrency, true}]),.\n. Line 129 is too long:     ets:new(?ACCESS_CONTROL_TAB, [set, named_table, protected, {read_concurrency, true}]),.\n. Use the '-callback' attribute instead of 'behavior_info/1' on line 42.\n. The spec in line 50 uses a record, please define a type for the record and use that instead.\n. Line 130 is too long:     ets:insert(?ACCESS_CONTROL_TAB, {auth_modules, init_mods(auth, proplists:get_value(auth, Opts))}),.\n. Line 51 is too long:     ets:new(?ACL_RULE_TAB, [set, public, named_table, {read_concurrency, true}]),.\n. Line 77 is too long: check(#mqtt_client{client_id = ClientId, peername = {IpAddress, }}, _Password, []) ->.\n. Use the '-callback' attribute instead of 'behavior_info/1' on line 42.\n. Line 86 is too long:         {error, Error}   -> lager:error(\"Load module ~s error: ~p\", [Name, Error]);.\n. Line 51 is too long:     ets:new(?ACL_RULE_TAB, [set, public, named_table, {read_concurrency, true}]),.\n. Remove the dynamic function call on line 84. Only modules that define callbacks should make dynamic calls.\n. Remove the dynamic function call on line 141. Only modules that define callbacks should make dynamic calls.\n. Line 89 is too long: match(_Client, _Topic, {AllowDeny, all}) when (AllowDeny =:= allow) orelse (AllowDeny =:= deny) ->.\n. The spec in line 109 uses a record, please define a type for the record and use that instead.\n. Remove the dynamic function call on line 94. Only modules that define callbacks should make dynamic calls.\n. The expression on line 149 and column 46 is nested beyond the maximum level of 3.\n. Line 30 is too long: -spec start(StartType, StartArgs) -> {ok, pid()} | {ok, pid(), State} | {error, Reason} when .\n. Remove the dynamic function call on line 85. Only modules that define callbacks should make dynamic calls.\n. Line 58 is too long: -spec auth(Client :: mqtt_client(), Password :: password()) -> ok | {error, any()}..\n. Line 86 is too long:         {error, Error}   -> lager:error(\"Load module ~s error: ~p\", [Name, Error]);.\n. Remove the dynamic function call on line 147. Only modules that define callbacks should make dynamic calls.\n. The spec in line 81 uses a record, please define a type for the record and use that instead.\n. Remove the dynamic function call on line 141. Only modules that define callbacks should make dynamic calls.\n. Line 77 is too long: check(#mqtt_client{client_id = ClientId, peername = {IpAddress, }}, Password, []) ->.\n. The spec in line 109 uses a record, please define a type for the record and use that instead.\n. Line 88 is too long: -spec match(mqtt_client(), topic(), rule()) -> {matched, allow} | {matched, deny} | nomatch..\n. The spec in line 81 uses a record, please define a type for the record and use that instead.\n. The spec in line 109 uses a record, please define a type for the record and use that instead.\n. The expression on line 149 and column 46 is nested beyond the maximum level of 3.\n. Line 88 is too long: -spec match(mqtt_client(), topic(), rule()) -> {matched, allow} | {matched, deny} | nomatch..\n. Line 131 is too long:     ets:insert(?ACCESS_CONTROL_TAB, {acl_modules, init_mods(acl, proplists:get_value(acl, Opts))}),.\n. Line 152 is too long:                         ets:insert(?ACCESS_CONTROL_TAB, {tab_key(Type), NewMods}),.\n. Line 88 is too long: -spec match(mqtt_client(), topic(), rule()) -> {matched, allow} | {matched, deny} | nomatch..\n. Remove the dynamic function call on line 84. Only modules that define callbacks should make dynamic calls.\n. Remove the dynamic function call on line 94. Only modules that define callbacks should make dynamic calls.\n. Line 58 is too long: -spec auth(Client :: mqtt_client(), Password :: password()) -> ok | {error, any()}..\n. The expression on line 149 and column 46 is nested beyond the maximum level of 3.\n. Remove the dynamic function call on line 85. Only modules that define callbacks should make dynamic calls.\n. Line 129 is too long:     ets:new(?ACCESS_CONTROL_TAB, [set, named_table, protected, {read_concurrency, true}]),.\n. Line 152 is too long:                         ets:insert(?ACCESS_CONTROL_TAB, {tab_key(Type), NewMods}),.\n. Line 30 is too long: -spec start(StartType, StartArgs) -> {ok, pid()} | {ok, pid(), State} | {error, Reason} when .\n. Line 86 is too long:         {error, Error}   -> lager:error(\"Load module ~s error: ~p\", [Name, Error]);.\n. Remove the dynamic function call on line 94. Only modules that define callbacks should make dynamic calls.\n. Line 89 is too long: match(_Client, _Topic, {AllowDeny, all}) when (AllowDeny =:= allow) orelse (AllowDeny =:= deny) ->.\n. Line 87 is too long:         {'EXIT', Reason} -> lager:error(\"Load module ~s error: ~p\", [Name, Reason]).\n. Line 77 is too long: check(#mqtt_client{client_id = ClientId, peername = {IpAddress, }}, Password, []) ->.\n. Line 130 is too long:     ets:insert(?ACCESS_CONTROL_TAB, {auth_modules, init_mods(auth, proplists:get_value(auth, Opts))}),.\n. Line 86 is too long:         {error, Error}   -> lager:error(\"Load module ~s error: ~p\", [Name, Error]);.\n. The spec in line 109 uses a record, please define a type for the record and use that instead.\n. The expression on line 149 and column 46 is nested beyond the maximum level of 3.\n. Remove the dynamic function call on line 94. Only modules that define callbacks should make dynamic calls.\n. Line 77 is too long: check(#mqtt_client{client_id = ClientId, peername = {IpAddress, }}, _Password, []) ->.\n. Line 88 is too long: -spec match(mqtt_client(), topic(), rule()) -> {matched, allow} | {matched, deny} | nomatch..\n. ",
    "yy-chen": "There is a very small probability that the subscriber does not exist and the ets table also has it's subscribe info.. In the vast majority of cases, the server can work well, but the problem we encountered is that the scale of the cluster is relatively large. \nFor example, at a very low probability, a subscriber has been offline for a long time and his session process is no longer there, while the subscription information in the ets table has not been cleared, In this case, if the shared subscription is random to the subscriber, then the message will be lost and no subscribers can receive it. \nThe modification here is for the most simplified to fix this situation.\nAs to why the subscriber process has disappeared and the data in the ets table is still there, we have not found it. \nThis is not a short-lived situation, when we found this bug, the subscriber has been offline for many days.. it should be undefined when mqtt version < 5. "
}