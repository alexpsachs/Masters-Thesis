{
    "sthulb": "@kami Thanks for the pull request :) \nWe intentionally made it > 1.9.3 due to EOL for 1.8.7, but we'll merge this in :+1: \n. @whatisjasongoldstein Which version of phantomjs are you using? and on a mac by any chance?\n. Weird... I'm aware of a bug in PhantomJS 1.7 & web fonts. I'm unaware of any on 1.9.x\n. @whatisjasongoldstein Thanks, we're pretty sure this is an issue with PhantomJS, we'll do a bit of testing to make sure.\n. @DaveBlooman Maybe we should add that binary of phantom into the install script.\n. @lendamico It's something we should definitely look into. \n. @DaveBlooman Want to up the Chrome version a little? Your new UA sets it to Chrome 24.\n. @gabrielnau Maybe, I'll talk it over tomorrow.\n. I think @jasonkarns is right, we shouldn't do it.\n. @annie-l Sure :)\n. @annie-l done, thanks!\n. ha! I knew you'd miss one :)\n. I think this out of scope of this tool. Like @jasonkarns mentioned, something else would be a better fit.\n. @steveworsley Can you share your config?\n. Great :) I'll fix this tomorrow for you :+1: \n. We're not using RVM, internally, we use chruby.\n. I've fixed it by specifying ruby ver 1.9.3-p385.\n. Ideally, we should package as a gem. \n. As far as I know, there are no headless IE/Trident browser tools. It would be cool though :)\n. We've merged the other one, #18 :+1: \n. Looks great :)\n. @remitbri @jviotti I think I've fixed this now.\n. Although, the error I got using ruby 2.0 was different.\n. Hi @reggieb :)\n. @reggieb there's a branch by me called next-ver which does all of this. I just need to tidy up  \n. We should transparently do this. We should check the ENV['PATH'] to see if it's there and use it if it is. There shouldn't be any config for this.\n. You could probably do: xvfb = ENV['PATH'].split(':').select { |p| File.exist?(\"#{p}/xvfb-run)\" }\n. Hi @kerasai, unfortunately everyone who worked on this tool inside the BBC left and there\u2019s no policy for contributing/maintaining something once people have left the BBC. Unfortunately the tool died when @daveblooman left. . ... I wasn't done ...\n. @DaveBlooman now merge.\n. I moved the webdriver file to the wiki.\n. I didn't see it... but I'm doing a lot more than #75 \n. @kenoir use from GitHub, we haven't published to rubygems yet\n. Thanks @mortonfox, unfortunately #242 is more full featured! Please don't stop this from contributing in the future!\n. Thanks @AdenFraser! Thanks for caring so much about me :)\n. Can you convert do/end to braces please?\n. @timabell An offline CSS file would allow people to use it when they're not connected to the internet, we have people who work whilst on a train.\n. if !wraith.comp_domain.nil?\n. compare_url = wraith.comp_domain + path if !wraith.comp_domain.nil?\n. What is your real email address? \n. remove this line\n. does that not error?\n. task :config, :foo, :bar do |t, args|\nname your args.\n. name args\n. This class could be little more abstract.\n. \n. ",
    "Kami": "@sthulbourn Thanks!\n. Sure, is 8e0cf6f66747926731fc178720aa7086d390429c better?\n. ",
    "dblooman": "Our first pull request \n\n. Can you give us an example site @whatisjasongoldstein ?\n. It seems this is more an issue with PhantomJS rather than Wraith.  You can download a custom build of PhantomJS and Google web fonts will work again. Link : http://arunoda.me/blog/phantomjs-webfonts-build.html It would appear Typekit has bigger problems that will be fixed some time in the future of PhantomJS.\n. It seems mostly down to the UA string, I have changed the UA string on a branch if @whatisjasongoldstein wants to try it out\n. Im going to close this as it is a problem with PhantomJS, for those wanting the best font support, use SlimerJS\n. Hi, have you edited the config.yml?  Or are you running clean master?\n. I will try and get it working on a Mac today\n. This seems to be very closed linked to Windows, using trifle, you can use wraith with Windows, but not with Unix.  Going to close this as you can achieve IE testing, only on Windows :(\n. I don't think we need this in create_gallery.rb do we?\nFileUtils.cp(BOOTSTRAP_LOCATION, \"#{location}/bootstrap.min.css\")\n. Could you update the Readme indicating where the data.txt will be, thanks.\n. When using multiple widths, the gallery will still only show 1 diff image per path.  I also think we should group the pages so it orders the images base, compare then diff.  What do you think @timabell ?\n. Hi,\nI have put some detailed information here https://github.com/BBC-News/wraith/wiki/Detailed-instructions\nWraith will work on any computer once the dependencies are installed, I have broken these down into the packages so you seen what the install script is installing.  \nRuby and Rake are required to run the tool in edition to ruby gems.\n. @liakong Check out the readme now, if you think there is anything missing, leave a comment, otherwise I will close this in 24 hours.\n. You could combine Wraith with webdriver to achieve this, but I think this would be something we look at in the long term.  We will investigate this feature, thanks for the input.\n. We are about to commit a change that will ensure that the heights are always the same. \n. Fixed in master\n. have you uninstalled imagesize and installed image_size?  I used the wrong gem name for the cropping, you need the underscore version for use with ruby 2.0\n. Just to confirm @remitbri, you don't have the imagesize gem installed and you do have the image_size gem installed while using ruby 2.0.  Also, you are using ruby 2.0 while running Wraith\n. This looks good, could you update the readme to indicate the new functionality.\n. If you merge in master, I will merge this\n. Looks good, thanks for the PR\n. We had a different name for Wraith before we release it, snappysnaps.  I was going to remove all the references to it, so it would probably make sense to do the same in your PR.  e.g wraith_manager \n. Reviewing now\n. You are only setting one domain, we expect you to set two.  If you do only want one, the comparing aspect of Wraith wont work.  If you are OK with this, copy the domain and then uncomment line 54 in wraith_manager.rb, this will grab the pages for you.\n. Hi, can you try again now.\n. I hadn't thought of comparing Webkit to Geeko within the same test, it makes a lot of sense if you know that your live code is fine on webkit and you want to test Geeko against local/new code.  I think setting in the config would be a good approach.\n. I did a quick fix before as I was in the middle of something, so I deleted the .gitignore file, could you add it back as a part of this PR, thanks.\n. I think we kept it separate as it is something you are only going to use once\n. I think an image magick solution would be better, can you try adding the following to wraith.rb.  If that works in the same way as your fix, we will use IM.\nputs convert #{crop} -background none -extent 0x#{height} #{crop}\nI haven't actually tested this, I don't know any websites with transparency to test against.\n. Could you merge in master, then I will merge your PR\n. Thanks for the PR, out of curiosity, what is the website you are testing against, would be good to have a site to test regressions against.\n. Will be take care of via #90 \n. This should be fixed now with the new Window support\n. Wraith assumes that there is a file called config in configs folder if you are running the default task, other wise a rake config[configname] should work, you shouldn't need quotes.  Can you try running a different config using the config command from within the configs folder.  Could I know your OS as well. @rupl \n. @rupl I think I might make it just run from anywhere in the Wraith dir, that would much simpler.  Thanks for the feedback :)\n. This should be fixed now with the new Window support\n. So we assume you are going to have a config.yaml, if you don't, then the assumption fails and it wont run from any directory.  We make this assumption in the Rakefile, if you delete this following line\n@wraith_manager = WraithManager.new('config')\nit will allow you to run a config from a different directory.  I did this so you could run the other tasks, crop images etc, though that is only possible with config.yaml instead of any config file.  Perhaps that could be a feature in the future, but we haven't seen anyone asking for that, only that we maintain the ability with config.yaml.\nI would rather preserve the ability to run tasks separately from the main task with config.yaml rather than have any config run from the main Wraith directory.  When I next do some work on Wraith, I can see if it is possible to achieve both.\n. Unless it seems, if you are on Linux, some weird behaviour.  @rupl I think it is worth merging, but can you add that this is only if you have deleted the config.yaml file, thanks.\n. This should be fixed now with the new Window support\n. @JakeChampion Fancy reviewing this one?\n. One liner should do it\n. Could be something related to the wrong path being used for libltdl.\nTry something like export DYLD_LIBRARY_PATH=/usr/local/libltld/lib\nThe image not found part refers to the libltdl.7.dylib package, so you just need to ensure the path is correct and the package exists.\n. Hi, this is great, could you add something in the read me under Using Wraith about this.\n. Can you add anemone to the Gemfile\n. Did you try PhantomJS?  Do you get the same result?  Rendering is handled by the browser, so I would imagine that is the issue.\n. That is the next step, but I might do some refactoring first, so this seemed like a quick win\n. Your config looks fine, so could you upload a screenshot of the gallery please.\nThanks\n. I can't view the image\n. If you git pull now, I believe I have fixed the issue.\n. Thanks for the ticket!\n. @JakeChampion @BogdanDogaru \n. Thanks for the PR, here is Nicolas Cage to say thank you\n\n. Hi, I assume the domains are placeholders, you need to label the path for the screenshot.\nhome: /\n. Hi, I have committed a patch, can you pull and give another try.\nThanks\n. The end goal is to release as a gem, that will include a basic task that will show the capabilities of wraith.  Ultimately with the gem, the user will have to pass in a config file of their own, so the config.yaml will only exist to show what wraith does.  For now, I would prefer config.yaml to remain as it is.\nYour other changes look good, if you update your branch, i'll merge it.\n. We are adding a docs folder, submit content there, then we'll add it to the wiki too.  I like having the option to read offline or via text editor, so having both will be handy.  Once #75 is merged, you can start adding docs.\n. Sounds good.  What's the location needed for?\n. I cant actually test this, but something like this?\nhttps://gist.github.com/DaveBlooman/8170818\n. And this.....I changed on to active\nhttps://gist.github.com/DaveBlooman/8170849\n. This is with slimerjs set in your PATH?\n. Yeh, just add a line in the config to explain that the key is being used and it should be fine.\n. Continued in PR #74 \n. Nice, text looks good, how different is phantom?\n. The other configs and specs need updating, but it would also be good to have some new documentation for headless Slimer and wraith.  I am writing a new guide for the Android and iOS support as Selenium have dropped support of there own drivers in favour of third parties.  All docs will now go in the docs folder in PR #75 \n. It seems OK, but it feels like there is enough logic to move it into the manager as a new method.\n. The save_images method is quite big now, it needs to be broken down.  Im just looking at the best way.\n. I don't think the hash is needed, I have broken up save_images a bit, then created an options method for the xvfb task.  Does that work on the sandbox?  Is there anything missing from the xvfb side?\nhttps://gist.github.com/DaveBlooman/8173870\n. @sthulb Any thoughts on this?\n. Sorry, It wasn't even the right PR FFS....\n\n. Guess I'll delete PR #75 then\n. We might come back to this later\n. You don't have to put do not merge in every PR, it happened once.  It's not like i did rm -rf /System\n. You can remove all the webdriver code, Selenium are not supporting there own apps anymore, so i'm testing out the third parties they recommend, Selendroid and iOS driver.\n. You can do resource blocking in the JS by replacing the existing onResourcesRequested, an example of stopping all CSS, but it could be JS or HTML or images.  \njavascript\npage.onResourceRequested = function(requestData, request) {\n    if ((/http:\\/\\/.+?\\.css/gi).test(requestData['url']) || requestData['Content-Type'] == 'text/css') {\n        console.log('The url of the request is matching. Aborting: ' + requestData['url']);\n        request.abort();\n        current_requests += 1;\n    }\n};\n. I have seen a couple of Travis builds fail using Ruby 2.0, so trying to track down why.\n. Could you have a look at my changes @sthulb \n. @sthulb \n\n. @meza Pull request away!\n. I found the best way to test was to empty the file contents as wraith was running.\n. Could do it the other way, I just wanted to hand a directory to those tasks, rather than the config object.  Eventually, it wont matter though.\nI am rewriting the specs from scratch.\n. Thanks for the PR, this will be taken care of in PR #90 \n. Travis is failing @meza \n. I think the CLI should be implemented in a different way, I will show you what I mean in a PR.  I have made it more friendly to be run as a stand alone gem that can work with different configs and help first time users.  \nMost of what I done can work with your changes, I like the logging, but I want to merge mine in first.  Most of my changes are actually in the cli.rb, with most of the Rakefile being deleted.\n. @meza PR #94 \n. Im almost done with my branch, my main issue is that, like you, I want to stop shelling out the gallery creation, so Im going to look at the at before merging in.\n. @meza I used your technique for creating the gallery, though I didn't use a gallery and gallery_generator, just the single gallery file.  Do you see any conflict in the way I have done it?  A general review would also be appreciated :)\n. I have created some new docs on the gh-pages branch, http://bbc-news.github.io/wraith/index.html, I want to keep the readme light on github. \n. Yeh, that sounds like a good feature.\nLooking at it again, perhaps it would be better to call command_line_image_tool.rb file something more generic, rather than have the thor CLI point to wraith.rb then point to command_line_image_tool.rb.  So we could make it so all the Wraith commands are separated from accessing the config, would probably be better from a dependency point of view.\n. Although the build passed, there some issues in the logs.\nGiven how most people are going to use Wraith, i'm not sure if is worth the added complexity of splitting it up, but I would be interested to see how you think it would all tie together.\n. I think it is a survey pop up that appears on the front page on the news site, so that image will have extra width and fail.  It is out of my control unfortunately, so running the test again should work, I have kicked it off.\n. Is there an issue with image it is trying to crop?\n. I think my PR for donk should take care of a lot of this, but the Windows detection is quite good, so we should keep that in.\n. @meza Do you to open a new PR, or just update this one?\n. I thought that is what the changes you made in wraith.rb do? \n. I get you now, an optional switch on the config could do this.  Something like\nsnap_path_relative: true\nThat could mean we could check the path of the config file and assume it has a relative snap file.  \n``` ruby\ndef initialize(config_name)\n    if File.exists?(config_name)\n      @config = YAML::load(File.open(config_name))\n      @snap_path = File.expand_path(File.dirname(\"#{config_name}\"))\n    else\n      @config = YAML::load(File.open(\"configs/#{config_name}.yaml\"))\n    end\n  end\ndef directory\n    @config['directory'].first\n  end\ndef snap_file\n    if @config['snap_path_relative'] == true\n      \"#{@snap_path}/#{@config['snap_file']}\"\n    else\n      @config['snap_file']\n    end\n  end\n```\n. This PR is looking really good, I have created a milestone for a 1.2 release, we'll put a lot of the features we've discussed in there. \nI was also thinking about the remote configs feature, I don't think that should be a part of Wraith.  I'm going to write something separate that uses octokit which just pulls down the configs and then every time after, checks the github repo for changes.  \nWhether that is run via a shell script, or is actually called by Wraith in some way, I haven't decided, but it feels like Wraith should just look for a local config file.  Thoughts?\n. There is one thing I just noticed, older users who are using the rake task will have to change the path of the snap file in the config.  On clean master, with just the path updates, wraith will look in /Users/Dave/Desktop/tools/wraith/lib/wraith/lib/wraith/javascript/snap.js instead of /Users/Dave/Desktop/tools/wraith/lib/wraith/javascript/snap.js.\n. Apart from the rake issue, happy to merge this\n. We are almost ready to move over to Donk full time, I have added the different path work into master already.\n. We've been using the new donk code, really nice how it works with build numbers now.  I made some more refinements to the news side, https://github.com/DaveBlooman/wraith-donk/pull/1, the only thing I haven't done is made the index page link to the actual build pages.  \nIf you want to try out my stuff, use bundle exec thin start and then head to http://localhost:3000/build/ to view builds, like I said, thats the last thing before we role it into production.\n. Im going to close this PR as it has become stale, we have also made quite a lot of beneficial changes that would probably be worth bringing up to date in your fork.\n. Hi, I'll merge this now, but if you want to add to the PR with you extra desc, that would be great.\n. Sorry I have just got around to reviewing this.  Could you just update the config files to include the spidering option, then I will merge.  Thanks.\n. I don't think forcing the user to prefix the config would break backwards compatibility and just add work.  I think this can be solved by clearer documentation, perhaps in the PR you have already created?\n. This is an interesting bug, I cant reproduce it locally, but it does happen on Travis and on other machines.\n. Im still not able to reproduce this, I'll try some different configs and OS's though\n. This will be fixed by #112 \n. I think surrounding config_name in brackets is potentially confusing for first time users\n. I think it is a lot clearer now, if you are finished with this PR, i'll merge it in.\n. Im going to wait until the other PR's are in before I do another Gem release, but this will probably go out next week.\n. Could you post your config file please, thanks.  \nEdit: good spot, I actually forgot that was a feature.\n. Hi @i-like-robots, can you give an example of the work around, thanks.\n. I have pushed a fix up now, it was a bug in the paths handling that prevented this from working.\n. There is a related ticket here #99 \n. I suppose we could append the date/time to the folder name on creation, that would mean that we wouldn't need to remove the old folder as every top folder would be unique.\n. Hi,\nCould you \nruby\ngem list\ngem env\nand post the output\n. Also, can you just type wraith into terminal and see if it prints out the commands available?\n. I have tried on a couple different linux versions with different Ruby, cant reproduce it.  My initial thought was that it's a Gem issue, perhaps\ngem cleanup and then remove your older version of nokogiri?\n. Well, bundler is actually required in the bin/wraith file, so it is needed.  I don't actually think that is needed anyway.  Could you try deleting that line in you local Wraith gem dir to see if that solves it. \n. I remember why I added that now, but it was redundant as Thor made set up easy, just forgot to remove it.  Good spot.\n. Unfortunately, the build failed.\n. I did look into this, it's probably worth implementing anyway, just haven't got around to it.  It's just taking the pixel difference value, which we already calculate, then dividing that by the total pixel count of the image, then multiply by 100.  \nThis could be done in the gallery, or perhaps a separate task that updates the file with the calculation.  That does open other options with adding in failure rates for images, so I think it's worth exploring.\n. Feature request for #107 \n@meza Perhaps this could be used with Donk?\n. Main issue with this way is the output on cmd line for massive page changes gives numbers in power of form, eg 1838283e+03.  They return as 0.\n. Could you post your config in a gist?  Also, are you using a Mac/Linix/Windows?\n. You can drop the quotes around the Domains, that might be causing the issue.  If not:\nAre you using the full version of SlimerJS or the light version?\nCould you try just using the snap script.  E.g slimerjs snap.js http://www.mysecondsite.com\u200b 320 test.png\n. No, each config would have to be separate, so one for phantom and one for slimer.\n. Yes, you could use something like this\n``` ruby\nclass CompareImages\ndef compare_images(dir)\n    files = Dir.glob(\"#{dir}//.png\").sort\n    until files.empty?\n      base, compare = files.slice!(0, 2)\n      diff = base.gsub(/([a-z0-9]+).png$/, 'diff.png')\n      info = base.gsub(/([a-z0-9]+).png$/, 'data.txt')\n      puts compare -fuzz 20% -metric AE -highlight-color blue #{base} #{compare} #{diff} 2>#{info}\n    end\n  end\nend\ncompare = CompareImages.new\ncompare.compare_images('shots')\n```\n. Goes and looks at Jruby\n. The problem I faced was that images weren't being saved in some cases.  This lead to issues cropping and comparing.  Your solution looks good, could you create a PR for it, thanks.\n. Hi @mattsenior, after playing around a bit, your PR would solve another bug we've seen with images not saving.  I have added a little check into save_images to ensure that no images get missed.  A part from that though, the speed is impressive.\nhttps://gist.github.com/DaveBlooman/10009778\n. Mmmmmmm, so fast.  @mattsenior, I'll delete this PR and use yours when you've made it, though have a look at the changes I made.\n. Hi @mattsenior, I found that I had issues on my Mac with threads set at 16, it missed a load of images first time.  When I dropped it to 8 to replicate my hardware, 4 cores hyper threading, it handled it much better.  Have you seen anything like this on your side?  Also, we have a invalid image already in the repo under assests that could be cp and renamed to failed image.\n. Better solution in #126 \n. I started a PR #123, but there is a better way of doing it.  The bug is actually to do with Phantom, if the process dies or anything else goes wrong, it just skips over to the next image.  This means the cropping occurs when there are an incorrect amount of images.\nThe solution is to find a folder where the image(s) are missing, then add a placeholder to prevent the whole process from failing.  Simply raising as exception and moving on instead wouldn't work as the images would then be out of order when comparing.\n. This will be fixed by #112 \n. I think this could be taken care of by the code example I left in your PR #90 \n. @meza This is one of the things we talked about last week, the Donk branch I made would then pick up the archive and show links to those galleries.  Still not sure how to get build numbers in there though, any thoughts?\n. Could you make a PR to the wraith docs page, https://github.com/BBC-News/wraith/tree/gh-pages\n. It depends on the type of site, but as Jake said, small changes can give a false positive if a 1px change is made at the top of the page.  \nWhat you can use is something we are going to introduce to BBC, https://github.com/guardian/wraith-donk, it will email you when changes are found.  I think this is probably the best thing right now for a per pull request/build system.  \nMy plan is to introduce a percentage based output, instead of pixel based, then enable a min-max tolerance, this will tie into wraith-donk to enable less notifications to be sent.  An example would be, only let me know about regressions that fall into the 5%-10% range.  This is coming soon.\n. This will be fixed by #112 \n. Looking good\n. Do you have any time to finish this PR this week?\n. Poke\n. Thanks for the contribution @JackMarshallHD \n. When start a normal run using the capture command, does comparing fail then?\n. Can I ask to see the config you are using, also, to confirm that both domain images are being captured.\n. Hi, this is actually a quirk of our website....You can't hit that particular URL due to redirection, for that, I apologise.  Can I ask you to replace the config with the following https://gist.github.com/DaveBlooman/11209429\n. I agree, I'll working on better error handling tomorrow.  Thanks for the feedback.\n. We've just updated wraith with better error handling.\n. Are you using the gem or the source?\n. Are you using wraith setup to create the template JS and YAML files?\n. Could you gist your config please.\n. Thanks, it looks fine.  To confirm, in the directory you are running wraith, you have a folder called javascript and a snap file in that folder. I can't see what else it could be except the path to the JS file is wrong or doesn't exist\n. I see, if you change it to lib/wraith/javascript/snap.js it should start working\n. OK, if you do a pull on the repo, it should be working.\n. Could you post what errors are getting?\n. What issues is the current config causing?\n. In the config file, you can set the fuzz %, could you try a lower number, perhaps 5.  We have a conservative default of 20%, but sometimes it needs to be more sensitive.\n. Hi, wraith needs a compare domain, it is missing from your config.\n. Unless you have a large amount of threads, the maximum requests per second would probably be 8.  Most websites should be able to handle that, if not, then running tests outside of peak hours would be advisable.\n. We have nothing planned at the moment, we'd appreciate any contribution.\n. Simple answer is the tests need rewriting.  It is something that I am currently working on though.  For now, I have fixed the broken tests, will be merging a PR once the build passes.  After that, you can add your tests: :)\n#146 for fixes\n. OK, git pull and you should be good to test\n. Just to confirm, we can close this in favour of 152?  If so, will merge in 151 and 152\n. Sounds good, ready to merge once you pull in master\n. Great, I will be looking at #154 today.\n. This is good, will merge with 150\n. After looking again, I think the path logic could do with a refactor, creating a new class inside spider.rb would be a better solution.  So inside save_images and folder\nruby\n  def spider_paths\n    Wraith::SpiderFile.new(wraith).determine_paths\n  end\nThen in spider.rb\n``` ruby\nclass Wraith::SpiderFile\n  attr_reader :wraith\ndef initialize(wraith)\n    @wraith = wraith\n  end\ndef determine_paths\n    wraith.paths ? wraith.paths : spider_path\n  end\ndef spider_path\n    if !wraith.sitemap.nil?\n      read_spider(wraith.sitemap)\n    else\n      read_spider(wraith.spider_file)\n    end\n  end\ndef read_spider(spider_type)\n    path = File.read(spider_type)\n    eval(path)\n  end\nend\n```\n. It think the spidering feature is separate enough that it deserves to be improved along with your changes.\n. The problem I see is that we have duplication of checking paths in folder.rb and save_images.rb.  So your PR will break spidering when save_images checks for no paths, gets none and then tries to spider using spider.txt when a sitemap.xml is desired.\nI think this would be good to change, perhaps a separate class and call that from each method as above.  Another option is when it is called in folder.rb, it updates the wraith.spider_file so when it is called in save_images, the right file is selected.\n. I think it would be simpler to alter the gallery to show failures first, but give users the option to view the other images if they want.\n. I like this, I think we need some additional documentation on the GH pages.  What do you think of moving the code to remove unchanged diffs to a different class?  It feels like it shouldn't live in the gallery class.\n. I suppose it depends if there are any additional use cases for an analysis phase that would warrant this.  I am happy with option 1 otherwise.\n. I thought I had removed this :)\n. Im going to do a gem release now\n. 3.84 GPA\n. Could I see your config file, I want to be able to reproduce the bug\n. There seems to be an issue with the label of the domains and how it deals with the case.  I just changed the labels to use all lower case and it works fine, e.g\n``` yaml\nHeadless browser option\nbrowser:\n  webkit: \"phantomjs\"\n  # gecko: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory:\n  - 'shotsLbc'\nAdd only 2 domains, key will act as a label\ndomains:\n  leboncoin: \"http://www.leboncoin.fr\"\n  leboncoin2: \"http://www2.leboncoin.fr\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 320\n  - 600\n  - 768\n  - 1024\n  - 1280\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\n  #uk_index: /uk\nIf you don't want to name the paths explicitly you can use a yaml\ncollection as follows, and names will be derived by replacing / with _\n\npaths:\n- /imghp\n- /maps\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n  - 10\n```\n. This might cause an issue if the config is called something the same as something in the current folder\n. There would probably be too much contention for resources, if you have 8 threads that create 8 instances of wraith, that might then try create dozens of instances of phantomjs.\n. Published the gem, you can go ahead with the restructure of the configs repo\n. Yep, but grabber doesn't work anymore as the parallel PR broke it.  This just makes it work again and shows an example of how to use it without the rake task.\n. Hi, this was removed as general feedback was that it was not needed due to the gallery offering the same features, I will update the docs.\n. I think it could be, it's just 2 lines from the compare_images method\nruby\ncontents = Dir.glob(\"#{wraith.directory}/*/*.txt\").collect{|f| \"\\n#{f}\\n#{File.read(f)}\"}\nFile.open(\"#{wraith.directory}/data.txt\", \"w\") { |file| file.write(contents.join)  }\n. If you have changes to the way the data is added to the file, or the format it comes out in, CSV? Let us know, might be worth putting back in\n. I don't know tbh, I haven't looked at the code in a few years, not sure if anyone looks after the code base anymore.. Definitely an issue on Linux, perhaps that IM command has some compatibility/performance issues.\n. See #180 \n. Gem update time\n. We always assume that you already have a folder setup by running the setup folders task, I hadn't thought about this kind of use case.  It would be interesting to see how you have implemented the whole workflow.  I'll merge the PR in now and do a gem release.\n. Gem release is done\n. Also need to write tests\n. Still need to do documentation, but this is working now\n. This would change the urls for all current users though\n. Once the history support is done, that will be 2.0, so we can merge this into master, the gem release will include it for 2.0 with full change log.\n. Can you post your config?\n. Hi, thanks for the PR.  We need to set a default incase people don't update configs with the colour they want, we can probably stick with blue as the default.\n. What is the error message you are seeing in cmd prompt\n. Hi,\nI tried your config, \n``` yaml\nHeadless browser option\nbrowser:\n  phantomjs: \"phantomjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory: 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  dev: \"http://hcldev.prod.acquia-sites.com\"\n  live: \"http://www.hcltech.com\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 600\n  - 1024\nType page URL paths below, here are a couple of examples\npaths:\n  Page1: /careers/explore-hcl\n  Page2: /financial-services\n  page3: /i-have-an-idea/straighttalk\n  page4: /servers-and-storage\n  page5: /i-have-an-idea/hcl-global-meet\n  page6: /grassroot-innovations\n  page7: /consumer-electronics\n  page8: /geo-presence/united-states\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nmode: diffs_first\n```\nand JS file\n``` js\nvar system = require('system');\nvar page = require('webpage').create();\nvar fs = require('fs');\nif (system.args.length === 3) {\nconsole.log('Usage: snap.js ');\nphantom.exit();\n}\nvar url = system.args[1];\nvar image_name = system.args[3];\nvar view_port_width = system.args[2];\npage.viewportSize = { width: view_port_width, height: 1500};\npage.settings = { loadImages: true, javascriptEnabled: true };\npage.settings.userAgent = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/28.0.1500.95 Safari/537.17';\npage.open(url, function(status) {\n  if(status == 'success') {\n    window.setTimeout(function() {\n      console.log('Snapping ' + url + ' at width ' + view_port_width);\n      page.render(image_name);\n      phantom.exit();\n      }, 5000);\n  } else {\n    console.log('Error with page ' + url);\n    phantom.exit();\n  }\n});\n```\nIt's possible there are some spaces or format issues with your files, could you try copy and paste mine and see if they work.\n. Could you confirm you have imagemagick installed\n. This can be done using phantomjs options, such as page.settings loadImages false\n. #189 \n. @JakeChampion review some Javascript?\n. Could you post your config\n. I see the issue, you are using https which PhantomJS has a little trouble with.  You need to pass a command line option in your config file to get around the errors.  This config file should sort your issue.\n``` yaml\nphantomjs_options: --ssl-protocol=tlsv1\nHeadless browser option\nbrowser:\n  phantomjs: \"phantomjs\"\n  # slimerjs: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory: 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  dev: \"http://anvil-first.codio.io:3000/\"\n  prod: \"https://vih.dk\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 320\n  - 600\n  - 768\n  - 1024\n  - 1280\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nChoose how results are displayed, by default alphanumeric. Different screen widths are always grouped.\nalphanumeric - all paths (with, and without, a difference) are shown, sorted by path\ndiffs_first - all paths (with, and without, a difference) are shown, sorted by difference size (largest first)\ndiffs_only - only paths with a difference are shown, sorted by difference size (largest first)\nmode: diffs_first\n``\n. Can you confirm that you have phantomjs installed by runningphantomjs -v. This is because of the parallel gem, it is out of our control.\n. Yes, I think this could be done in the JS file where it forces the use of the print style sheet\n. Could you explain the workflow that causes this bug\n. Hi, been really busy, will be looking at this today, but it looks good.\n. I think justphantomjs_options: --ssl-protocol=tlsv1in your config should work, could you try that.\n. I see your point, it is slightly different to the way we work at BBC.  We work on a branches, so our master branch is updated regularly, so screenshots become out of date quickly.  What we would want is awraith reset` command that would rename the files and allow you to run wraith latest again.  \nIs this the sort of feature you are asking for?\n. I will have a look at this\n. This was fixed in #250 \n. Could you merge in master\n. The ruby version seems to have issues, i bumped to 1.9.3 to solve it.\n. No, that was just testing an idea\n. Because you have an old version of the travis.yaml using 1.9.2, it is failing the build, could you update that file to ensure the build will pass, thanks.\n. Example with threshold at 50%\n\n. This is already possible using the history feature, I have also just added some new features for CI's with thresholds, all the example configs have them in the docs.\nAs long as you keep the workspace, it should work\n. Im not sure what you mean by this\n. The height is what the web page returns, most use cases are full page shots.  If you want a specific part of the page, you can use the component config using casperJS\n. Can you post your config file\n. In the domains section, you need 2.  There is also an extra option needed for SSL, put this at the top of your config file phantomjs_options: --ssl-protocol=tlsv1\n. Have you tried setting the CPU shares manually in the docker run ?\n. It would be interesting to learn how you are using docker with wraith if you could share your workflow\n. Sounds awesome, I added some features recently that aids jenkins jobs, thresholds and exit codes, i updated the docker image to include the latest version of wraith if you want to give it a go.\n. I just pushed it up, I will put together a blog post about how we use docker too, we also use it with Jenkins and then offload the images to S3, which are made public to view the galleries. \n. It is a phantomjs bug https://github.com/ariya/phantomjs/issues/12697\n. Can you confirm that the original shots are good, sometimes one of the original shots fails to capture completely.  Also, could you post your config.\n. Could you also confirm that the text files that are output with the difference in are present and they contain a value.  You should have the old shot, the new shot, the diff image and a text file.\n. OK, so there must be an issue with the images that have been captured, perhaps a different size.  When the 2 images are being compared, if there is any issue, invalid is written into the file.  Could you have a look at both the history image and the latest image and check the files are the same width and height.\n. Could you try phantomjs_options: --ignore-ssl-errors=yes --ssl-protocol=tlsv1.  It seems to work for me, but the the other way doesn't, will look into why.\n. Sorry, my mistake, could you try phantomjs_options: --ssl-protocol=tlsv1 --ignore-ssl-errors=yes\n. Thanks for the PR :)\n. We had problems with fonts too, our solution was to install a version of phantomjs that does.  You should be able to use brew install phantomjs192\n. Imagemagick needs to have the same widths as the pixel sizes need to be the same.  The only thing I can suggest is making the new shot 602px.  Sorry for the late reply.\n. Hi, what command are you running?\n. Could you post your config\n. I think it is due to the domain labels you have used.  Could you try without dashes\n. @AdaRoseEdwards Noticed you had used widths and heights in your config, which Wraith didn't support, but there are now some examples of how to make it work with yaml file & JS file\n. New gem released, thanks for the fix\n. Wraith should return the width set in the config.yaml, is this what you are seeing?\n. Unfortunately not, though Facebook have a tool that might interest you https://github.com/facebookarchive/huxley\n. It doesn't look like you are calling the wraith gem, those options aren't in the CLI.  If you repeat your steps and choose -v or -h what are the outputs?\n. Anemone is the gem we used for the spider, it should follow redirects by default.\n. The spidering mode was a bit too unpredictable as there may be lots of differences in the amounts of pages between runs.  For that reason, we left the features separate, though as you have said they can work together assuming your site has the same number of pages.\n. Are the images the same size?\n. We dropped that feature in 2.0 due to bugs it created.  It is something we would bring back, but it would require a rethink in how the paths are set.\n. Can you explain what this does?\n. Thanks for this, we really need some tests around the history mode.\n. @darnould Can you review\n. Could you actually make it /urdu and /pashto instead, news isn't available on .com for all users, we have some redirects in place.  The final config should look similar to this.\n``` yaml\nHeadless browser option\nbrowser:\n  phantomjs: \"phantomjs\"\n  # slimerjs: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory: 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  pashto: \"http://www.bbc.com/pashto\"\n  urdu: \"http://www.bbc.com/urdu\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 320\n  - 600\n  - 768\n  - 1024\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\n  sport: /sport\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n  - 10\nChoose how results are displayed, by default alphanumeric. Different screen widths are always grouped.\nalphanumeric - all paths (with, and without, a difference) are shown, sorted by path\ndiffs_first - all paths (with, and without, a difference) are shown, sorted by difference size (largest first)\ndiffs_only - only paths with a difference are shown, sorted by difference size (largest first)\nmode: diffs_first\nthreshold: 5\n```\n. I merged in a PR that fixes this issue, thanks for the PR :)\n. Just to confirm the work flow so I can test.  Run a normal job, then just run the wraith compare_images task?  That seems to work for me.\n. Could provide a sample config and details of OS/Gem version\n. I think Ruby 2 should be the base.  I think the issue here might be the capitalised label of the domain though.\n@steveworkman Can you try with a lowercase label, e.g qaa rather than QAA\n. I will update the docs to include some limitations of the config file.\n. The wraith-selenium project is a separate fork from this project.  Wraith is still maintained.\n. Can you provide a sample config, specifically the BBC one you were trying, thanks.\n. This should be fixed with #265 \n. Are you installing the wraith gem via Rubygems?\n. So when you run your wraith command, what is the output?\n. I will add a download link and file into the GH pages repo - http://bbc-news.github.io/wraith/history.html\n. I have made a PR to address the highlighting of the diff text, this also includes a little refactoring.  The URL in the gallery might require a little more thinking as the whole gallery process is based on file and not config.  Only global things like threshold are pulled in from the config and used.\nI will ask someone with a bit more front end knowledge to look into the other queries.\n. Im unsure of terms of licensing and copyright, who owns it etc\n. You pass them using an optional config param, \nyaml\nphantomjs_options: \"--ignore-ssl-errors=true\"\n. :cake: \n. What does the finished output look like?\n. Just a few initial things I noticed from reading the new code.  Will have another pass at some of the more tricky logic\n. I know some of the things are not in your PR, but probably slipped in over time\n. Not really sure about having TODO comments in code\n. Think thats it @ChrisBAshton.  Merry Christmas :)\n. Probably better to have the CSS in the project\n. I think saying \"in /shots\" on the end would be better\n. For a neater terminal output, we could use puts ruby create_gallery.rb shots using backticks\n. Spelling mistakes are my nemesis\n. Was there a particular use case for this?  I would rather leave config.yaml as it is, it means someone who is just trying out Wraith can just run the rake task.\n. Adding if !@config['xvfb'].nil? will prevent everyones configs from breaking\n. not my email addresses\n. david.blooman@gmail.com\n. Phantomjs typo\n. empty line\n. empty line\n. If we are using the config in this way, we could remove dir and use wraith.directory. \n. Extra spaces needed path = path(crop)\n. We can actually remove this now the webdriver features are out\n. Adding path caused the links to the actual images in the gallery to break\n. Yeah, it seems rubcops suggestions have limits, probably other stuff too.\n. Unused parameters are prefixed with underscore, thats in our style guide.  Actually, its just an underscore for single unused parameters, I think it's clearer for multiple unused parameters to prefix..\n. Please use parentheses when there are arguments for a method\n. Please use parentheses when there are arguments for a method\n. Any particular reason?\n. This should reflect method name so multi_capture\n. wraith style is to wrap arguments in parentheses\n. Something I just did, created a txt and ran it, it didn't work because of new lines.  Suggest we chomp the config name.\n. dont need a begin here, just yield and rescue\n. Lets use \nruby\nunless File.directory?(wraith.history_dir)\n. lets change line 38 to \nruby\nmatcher(match, filename, dirname, category) unless match.nil?\nand line 81 to\nruby\ngroup = match[2][dash + 1..-1] unless dash.nil?\n. Would be better off with is_a? \nruby\nwidth = \"MULTI\" if width.is_a? Array\n. Will just go back and look at the global issue, but this should be puts message if $wraith.verbose anyway\n. is_a?\n. last evaluated is returned, so dont need the return word\n. better to use unless @wraith.domains here\n. unless here too\n. blank line\n. engine = engine.values.first if engine.is_a? Hash for line 38\n. blank line\n. looks fine, but can we tidy up the white space in this file, 134, 146 and 148\n. white space\n. incorrect indentation\n. some blank lines in this file\n. do-end blocks for multi line\n. do-end again\n. remove space\n. Why don't hand the boolen object from where verbose_log is called.  e.g. pass true if wraith.verbose is set.  We can set that in the initialise block where we need to call verbose log, then hand that to the method.  \nI dont think we should ever need globals after this?\n. I know its a bit more verbose, but I think rescuing within the method is more clear.  It will allow for specific errors over the catch all here. \n. Feels like we can split this method up, bit of a monster\n. blank line\n. We use puts a lot, but we could wrap this in a nice ansi output, i think there is a gem for that\n. If you create a attr method, you can drop the instance variables for wraith, e.g @wratih\n. Review other comment on global\n. Any reason this is set?\n. Can we not just use puts here?  E.g \nruby\nputs capture_image = saving.construct_command(320, test_url1, test_image1, selector, false, false)\n. blank line\n. blank line\n. blank line\n. blank line\n. here\n. We still need to set the variable though\n. This will need to be removed. ",
    "whatisjasongoldstein": "It's a Mac, PhantomJS 1.9.1\n. Sure. I'm using\nhttps://inpression.scruffylogic.com\nhttp://whatisjasongoldstein.com\nhttp://theverge.com\nThe first two are mine (Google Fonts and Typekit respectively) and I added The Verge (Typekit) to rule out it's not something specific to my code/server/etc.\n. @DaveBlooman's branch works for Typekit but not Google fonts. I'll check out the other fixes later tonight.\nThanks.\n. The webfont-ready phantomjs binary also works with Typekit (this is with the current master branch), but still not Google Fonts.\nYou're right, this is a known issue on their end: https://github.com/ariya/phantomjs/issues/10592#issuecomment-18539213\nThanks guys.\n. ",
    "retlehs": "This repo shows how to get Typekit working with PhantomJS: https://github.com/bramstein/phantomjs-typekit\n. ",
    "annie-l": "Agreed, this would be key.\n. Thanks!\n. ",
    "DaveRobinson": "If you've just got a site behind basic auth the http://{username}:{password}@www.example.com/ notation works for me.\nObviously only do this if you're happy for all users who can read your yaml file to have the password.\n. ",
    "timabell": "I did successfully use https://user:pass@site notation in the config but if anyone's got time to look at this I recommend reading http://12factor.net/config and using environment variables as this be more maintainable when run by continuous integration servers or other non-interactive systems.\nI think it's worth clarifying whether this issue refers to http basic auth or automatic submission of login forms on a site to access restricted content. (This patch tackles both at once: https://github.com/ecometrica/wraith/commit/4298a1a836d0489a45ac56159a5b38d8434cb1a2 )\n. Done, good catch.\n. All comments addressed. How's that? :-)\nThanks for looking at all my requests.\n. ## You are right, I noticed that this morning too. I wonder if it's worth merging anyway so that people have a common starting point for improving the feature. I expect most users will be developers so a first step might encourage contributions. I don't think this patch takes away from the existing work.\nTim Abell\n07779577969\nDavid Blooman notifications@github.com wrote:\n\nWhen using multiple widths, the gallery will still only show 1 diff\nimage per path.  I also think we should group the pages so it orders\nthe images base, compare then diff.  What do you think @timabell ?\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/BBC-News/wraith/pull/16#issuecomment-22166857\n. Any particular reason? I think I prefer the cdn approach in this case as the html file is likely to be duplicated a lot, and that would mean the css file would have to be too. Currently it's a very clean output of just one file.\n\nIt's not a particularly strongly held opinion though, and this is just how the author of the commit did it.\n. ",
    "lendamico": "The issue as reported referred to a simple .htaccess-type login/pass combo.\n. ",
    "jasnow": "This is my next mountain.\n. \n. Dropped into Dropbox:\nhttps://dl.dropboxusercontent.com/u/16409400/Screenshot%20from%202013-11-07%2004%3A55%3A22.png\n. Verified fix 478fca90e41fddceae560ca11ff9cffb727b72e7 - Thanks\nAlso tried sandbox vs production since production is old and saw LOTS of difference - WOW.\n. Might want to change the README to use fork/clone instead of wget because I\nfollowing the instructions exactly and had to work around that fact to get the one changed file.\n. ",
    "sbelyea": "A quick note: if your site does authentication (and ensuing checks) based on cookies, you may be able to log in to your site_prior_ to testing, copy the cookie data into your snap.js file and then execute wraith.  I'm currently doing this without issue for sites that I maintain.\n. For cookies, that's it.  There should be an example cookie commented out in snap.js.  A full example could look something like this:\njs\nphantom.addCookie({\n     'name': 'myCookie',\n     'value': 'someUniqueValueToIdentifyAuthenticatedUser',\n     'domain': 'www.mywebsite.com'\n });\nYou can also add an expiration date; see the API link below\nIf you're trying to do this to pass authentication, however, it's really going to depend on how your application identifies authenticated users.  You may need 2 or more cookies (just call phantom.addCookie({}) multiple times).  If you don't use cookies, this won't help.\nA quick browse through the phantom.js API documentation (http://phantomjs.org/api/webpage/property/library-path.html) doesn't show any reference to local/session storage.  That's as far as my phantom knowledge goes. :-(\n. Grace - are you able to successfully execute the default config.yaml file that comes from the repo?\n. An interesting idea, but I'm having trouble figuring out how the process would work.\n1. Use of nokogiri to find classes on page after phantom.js/slimer.js has opened it\n2. Remove/edit class to a set appearance (black square?) via js\n3. Take the screenshot?\n4. ???\n5. Profit?\nInstead of making a change on the Wraith side, could you serve up a specific set of CSS (to hide/display: none) or JS based on the User Agent with some sort of device detection?  You can configure the User Agent for phantom.js in the snap.js file.\n. Good point!  Should I submit an updated pull request with the below addition for the default config? (or is there a better way for this?)\nYAML\ndesc \"Execute wraith on two sites using the default config.yaml\"\n. I think this is actually related to Issue #122 and looks like it was closed a few days ago.  Don't believe the gem is updated, though.\n. Will do - I'll make it when I get home this evening.\n. ",
    "gracekum": "Can you give us an example of what kind of cookie data you put in snap.js? and where in snap.js do you add it?\nlike this?\nphantom.addCookie({\n    'name': '',\n    'value': '',\n    'domain': ''\n});\nAlso if the authentication is stored in 'local storage' instead of cookie, is there a way to get that working in Wraith?\n*Sorry I am a newie to Ruby :(\n. I am having the same problem. I just download the latest wraith about a week ago. Do we have a patch for this? What do i need to change on my end to have it working since I do need the screen comparison portion of the test?\n. Hi there,\nThanks for much for replying.\nI even tried to change to domain to something generic such as \nwww.google.com but still have the same problem.\nHere is my config file:\nHeadless browser option\nbrowser:\n   webkit: \"phantomjs\"\n   # gecko: \"slimerjs\"\ndevice:\n   base: firefox\n   compare: firefox\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"snap.js\"\nType the name of the directory that shots will be stored in\ndirectory:\n- 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n   PROD: \"https://max.makerstudios.com\"\n   INT: \"https://intmax.makerstudios.com\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n- 320\n\n600\n  #  - 768\n  #  - 1024\n  #  - 1280\n\nType page URL paths below, here are a couple of examples\npaths:\n   home: /\nIf you don't want to name the paths explicitly you can use a yaml\ncollection as follows, and names will be derived by replacing / with _\n\npaths:\n- /imghp\n- /maps\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n- 10\nOn 12/19/13 11:22 PM, Jaik Dean wrote:\n\nWhat are the keys for your domains in |config.yaml|? Ensure they only \nuse a\u2013z. If you still have problems then it's a different bug and you \nshould open a new ticket.\n\u2014\nReply to this email directly or view it on GitHub \nhttps://github.com/BBC-News/wraith/issues/60#issuecomment-30993039.\n. \n",
    "phoebebright": "I'm trying to use wraith with a django site where all the pages requires login.  My attempt at a script for before_capture runs but I'm not getting any screens captured.  If I run without the script I get images of the login screen.  Can anyone suggest what I'm doing wrong or if there is a better way?  I've looked at the cookie option but django generates a session with the user authentication inside, so it seemed a good idea to use the normal login form if possible:\n```\nmodule.exports = function (casper, ready) {\n       casper.echo(casper.page.url);\n\n// if it wants me to login then do\nif (casper.exists('#username') && casper.exists('#password')) {\n\n    casper.echo('login required');\n\n    casper.fill('#login-form', {username: 'testing', password: '1234567'}, true);\n\n    var next = casper.page.url.split(\"next=\");\n    var nexturl = 'http://127.0.0.1:8000' + next[1];\n\n    casper.echo('redirecting to '+nexturl);\n\n    //require('utils').dump(casper.page);\n\n\n    casper.open(nexturl);\n\n    casper.then(function () {\n        setTimeout(ready, 10000);\n    });\n}\n\n}\n```\nOutput is:\n```\n(board)iMacs-iMac:_testing phoebebr$ wraith history configs/history.yaml\nDEBUG: #################################################\nDEBUG:   Wraith version:     3.1.0\nDEBUG:   Ruby version:       ruby 2.0.0p481 (2014-05-08 revision 45883) [universal.x86_64-darwin14]\nDEBUG:   ImageMagick:        Version: ImageMagick 6.9.2-10 Q16 x86_64 2015-12-21 http://www.imagemagick.org\nDEBUG:   PhantomJS version:  1.9.6\nDEBUG:   CasperJS version:   1.0.0\nDEBUG: #################################################\nDEBUG: \nConfig validated. No serious issues found.\nCreating Folders\nSAVING IMAGES\nDEBUG: casperjs  '/Library/Ruby/Gems/2.0.0/gems/wraith-3.1.0/lib/wraith/javascript/casper.js' 'http://127.0.0.1:8000/' '320,600x768,768,1024,1280' 'shots/home/MULTI_casperjs_dev.png' 'body' '/Users/phoebebr/Development/commshub/_testing/javascript/login.js' 'false'\nDEBUG: casperjs  '/Library/Ruby/Gems/2.0.0/gems/wraith-3.1.0/lib/wraith/javascript/casper.js' 'http://127.0.0.1:8000/dashboard' '320,600x768,768,1024,1280' 'shots/dashboard/MULTI_casperjs_dev.png' 'body' '/Users/phoebebr/Development/commshub/_testing/javascript/login.js' 'false'\nhttp://127.0.0.1:8000/accounts/login/?next=/\nlogin required\nredirecting to http://127.0.0.1:8000/\nhttp://127.0.0.1:8000/accounts/login/?next=/dashboard/\nlogin required\nredirecting to http://127.0.0.1:8000/dashboard/\n```\n. ",
    "natethinks": "The docs don't seem to mention this, was any progress ever made in this issue?. ",
    "jasonkarns": "I'm unfamiliar with Poltergeist, but CasperJS supports screenshots based on a CSS selector. (captureSelector)\n. If all you want is programmatic ability to capture screenshots at various resolutions, I would look into CasperJS on top of PhantomJS.\n. Thanks for the references. \nre: grunt-shell: was hoping to use a node port to remove the ruby dep entirely.\nI don't think I presently care enough to bother with a port. (gem should work for time being) But long-term could foresee it ported and integrated via a @linemanjs plugin.\n. gist of gem env and gem list: https://gist.github.com/jasonkarns/0dc815316f8215167ac0\nwraith gets the same error\n. After gem cleanup:\n$ wraith \nWARN: Unresolved specs during Gem::Specification.reset:\n      rake (>= 0)\nWARN: Clearing out unresolved specs.\nPlease report a bug if this causes problems.\nCould not find sass-3.2.12 in any of the sources\nRun `bundle install` to install missing gems.\nsass is the only gem in Gemfile in this project. Not sure why wraith is complaining about it.\nAlso unsure why wraith is complaining about rake >=0:\n$ gem list rake\n*** LOCAL GEMS ***\nrake (10.1.1, 0.9.6)\nBut after uninstalling rake 10, wraith stops complaining about it:\n```\n$ gem list rake\n LOCAL GEMS \nrake (10.1.1, 0.9.6)\n$ gem uninstall rake\nSuccessfully uninstalled rake-10.1.1\n$ gem list rake\n LOCAL GEMS \nrake (0.9.6)\n$ wraith\n/Users/jasonkarns/.rbenv/versions/2.0.0-p195/lib/ruby/gems/2.0.0/gems/wraith-1.1.4/bin/wraith:6:in require': cannot load such file -- wraith/\ncli (LoadError)\n        from /Users/jasonkarns/.rbenv/versions/2.0.0-p195/lib/ruby/gems/2.0.0/gems/wraith-1.1.4/bin/wraith:6:in'\n        from /Users/jasonkarns/.rbenv/versions/2.0.0-p195/bin/wraith:23:in load'\n        from /Users/jasonkarns/.rbenv/versions/2.0.0-p195/bin/wraith:23:in'\n```\n. still failing with a brand new, just built ruby\n```\n$ rbenv install 2.0.0-p353\n...\n$ rbenv global 2.0.0-p353\n...\n$ gem install wraith\n...\n$ rbenv rehash\n...\n$ wraith \n/Users/jasonkarns/.rbenv/versions/2.0.0-p353/lib/ruby/2.0.0/rubygems/core_ext/kernel_require.rb:53:in require': cannot load such file -- bundler/setup (LoadError)\n        from /Users/jasonkarns/.rbenv/versions/2.0.0-p353/lib/ruby/2.0.0/rubygems/core_ext/kernel_require.rb:53:inrequire'\n        from /Users/jasonkarns/.rbenv/versions/2.0.0-p353/lib/ruby/gems/2.0.0/gems/wraith-1.1.4/bin/wraith:3:in <top (required)>'\n        from /Users/jasonkarns/.rbenv/versions/2.0.0-p353/bin/wraith:23:inload'\n        from /Users/jasonkarns/.rbenv/versions/2.0.0-p353/bin/wraith:23:in `'\n```\nmavericks, btw\n. Not sure what I did, but finally get a different, more useful error, with a clean install. Closing here and opening a separate issue for what was (likely?) the core problem.\n. Yeah, I meant that it's not needed in the sense that the 'require bundler/setup' line was unnecessary. :smile: \nI've already verified that it works without it, and I'm submitting a PR for this ticket. (Also submitting a second, related one.)\n. With both require calls removed (for bundler, and rubygems), everything works again and I have my joy back!\n. Not sure if you get notifications for commits added/build fixed. So... ping!\n. another option for script is: RUBYLIB=./lib ./bin/wraith capture config\nThis way the wraith bin file is still treated as an executable, and the lib dir is still added to the LOAD_PATH prior to execution.\n. ",
    "gabrielnau": "That's what I thought, but it was an open question : since you do visual regression testing on a large scale, how do you feel about the point of making module screenshots ? \nFor example, shouldn't we test visually some components that react to user interaction ?\n. ",
    "ghost": "All good! Thanks for that.\n. Thanks man, I will test this that this week end ;)\n. Hi Dave, \nlate reply as well :) \n... but the thing is: We test for CSS regression. The 602px width is because of bad CSS. I can't foresee that when creating history shots. \nAt this point the tool and workflow breaks for me. :(\nSuggestion: Make a shot at the actual width and cut it to 600px (I actually expect it to be 600px when I configure 600px) before creating diffs. That way we miss the +2px CSS problem BUT at least we have a working documentation with diffs of all pages. \n. @jonkemp Maybe you've used only the command \"wraith capture\"? As I've realized this does not really work on only one single url as there is nothing to compare. After using \"history\" and \"latest\" the error has gone as there has been something to compare. \"capture\" does only really work, if you compare two or more installations.\nPossibly there could have been thrown a more explicit exception.\n. As a workaround I convert the spider file contents to a static page config before running latest.\n. ",
    "steveworsley": "Hi, I've tried with the master & few different URL combinations & its working fine. I can't replicate the bug so I think it must have been a syntax error. Thanks for your help.\n. ",
    "remitbri": "(Disclaimer: I'm a total Ruby n00b)\nFYI, I had a undefined method '>' for nil:NilClass as I was testing Wraith using the clean master. \nbash\n/Users/test/wraith/Rakefile:88:in `block (3 levels) in <top (required)>'\nIt turns out using Ruby 2.0.0-p247 was the source of the problem, and switching to 1.9.3-p448 solved it. So\u2026 not yet Ruby 2.0?\n. Aaand #facepalm, I came here with a google search (erm), I didn't see issue 20\n. Thanks :)\n. Hi Juan, can you check that, like for me, if you switch to a 1.9.3 version of Ruby, everything turns fine ?\n. Hmm, for some reason it didn't work for me with 2.0.0-p247, even after having uninstalled imagesize. In other words:\n1.9.3-p448 image_size installed, imagesize installed or not : yay\n2.0.0-p247 image_size installed, imagesize installed or not : nay\nStill the error for \"if base_height > compare_height\".\n. Aaaand\u2026 sorry for the false alarm. Bad, bad newbie. I had installed indeed image_size while being under 1.9.3, but that didn't mean it was installed for 2.0.0. I can report now 1)I've understood the usefulness of rbenv; 2) yes your patch is working under 2.0.0. Sorry for the trouble, have a great weekend :)\n. ",
    "frodsan": "Thanks!\n. ",
    "reggieb": "I don't think that is a good solution! It would have been better to remove .ruby-version from the repository. Then add .ruby-* to gitignore to keep rvm config files out of the repository\n. If you are packaging this up as a gem, I'd suggest the following changes:\n- Namespace the rake command. Using 'rake' as the command to run the process isn't going to scale well. Something like 'rake wraith:process_run' would be better.\n- Move the management of the processing steps out of rake. I suggest creating a Process module, and defining the steps in a run module method. So the rake task will just call Wraith::Process.run, and run will define the steps. That way you'll be able to more easily run the process from within a host ruby environment without having to call out to rake.\n- Extract the YAML specific code from the Wraith class, and initialize Wraith instances with a hash rather than the path to the yaml file. You'll then need to add a separate process step that will extract the config from a file, before passing it to Wraith. This again will make it easier to use the Wraith class in a host app.\n- Add the facility to pass a config path into the rake command. So you can do 'rake wraith:process_run path/to/config.yaml\n. Looks like I was too keen to dive into the code. You need to run the app at least once to set up the shots directory, before running the tests.\n. Hi @sthulbourn Great to see you are still creating interesting ruby code at the BBC. :)\n. Oh, and being able to define the config file within the rake call, means the config no longer has to be at the root of wraith, so decoupling the config file location from the wraith code location.\nSo you can do this:\nrake wraith:process_run[/home/<user_name>/my_wraith_configs/german]\n. @sthulbourn and you've name spaced your classes. That was going to be my next suggestion :+1: \nI still think it would be worth looking at my Rakefile. Rake is a nice way to add command line access to ruby processes.\n. ",
    "hoguej": "Yes, my refactoring has been to make making a gem easier to do.\nOn Friday, August 16, 2013, Simon Thulbourn wrote:\n\nIdeally, we should package as a gem.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/BBC-News/wraith/issues/11#issuecomment-22759726\n.\n. 2 is mostly done.\n\nI agree with the rest, but I'm just a contributor. Maybe, we should make\neach bullet an issue. Then we can spread out the work.\nOn Monday, August 19, 2013, Rob Nichols wrote:\n\nIf you are packaging this up as a gem, I'd suggest the following changes:\n- Namespace the rake command. Using 'rake' as the command to run the\n  process isn't going to scale well. Something like 'rake wraith:process_run'\n  would be better.\n- Move the management of the processing steps out of rake. I suggest\n  creating a Process module, and defining the steps in a run module method.\n  So the rake task will just call Wraith::Process.run, and run will define\n  the steps. That way you'll be able to more easily run the process from\n  within a host ruby environment without having to call out to rake.\n- Extract the YAML specific code from the Wraith class, and initialize\n  Wraith instances with a hash rather than the path to the yaml file. You'll\n  then need to add a separate process step that will extract the config from\n  a file, before passing it to Wraith. This again will make it easier to use\n  the Wraith class in a host app.\n- Add the facility to pass a config path into the rake command. So you\n  can do 'rake wraith:process_run path/to/config.yaml\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/BBC-News/wraith/issues/11#issuecomment-22861597\n.\n. Requested changes added.\n. Merged with master. Can we commit mine next? I'm finding it hard to keep up with master, because this is pretty core change.\n. cd /home/rafael/lab/wraith\nbundle\n. Going to look at the installer, see if this step is missing.\n. Looking at the install file, it appears ruby is completely out of scope. That seems reasonable. Let me know if this resolves your issue, though. You may need to do this before the other steps:\n\ngem install bundle\n. I'll fix this. This is a test bug.\nOn Friday, August 16, 2013, Rob Nichols wrote:\n\nLooks like I was too keen to dive into the code. You need to run the app\nat least once to set up the shots directory, before running the tests.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/BBC-News/wraith/issues/26#issuecomment-22753529\n.\n. Can you paste the contents of your config.yaml file? \n. I think if you make them both library methods, and you have an explicit\ncall in the rake to do this comparison, it would be fine.\n\nPeople who want it, get it. People who don't, won't.\nOn Tue, Aug 20, 2013 at 6:32 AM, David Blooman notifications@github.comwrote:\n\nI'm thinking making it possible to compare Webkit and Geeko screenshots to\nget a broader overview of the differences, running phantom and slimerjs\ntogether. The way I think this could work would be to do a regular compare\njob, outputting to /geekoshots & /webkitshots then the final compare shots\nwould be in /browsershots.\nI'm looking at this from a BBC point of view, as we could benefit from\nmore Geeko testing. The main reason for raising a question for this feature\nis that Slimerjs isn't headless, or at least, not out of the box headless\non newer versions of OSX.\nWhat are peoples thoughts on mixing headless testing with non headless\ntesting?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/BBC-News/wraith/issues/32\n.\n. Was thinking about this some more... what if we added both (as before), and enabled this functionality in config?\n\nAlso, seems like we want to do 1 of 3 things:\na) compare site a to site b\nb) compare browser to browser b\nc) compare all\n- site a with browser a to site a with browser b\n- site a with browser a to site b with browser a\n- site a with browser b to site b with browser b\n- site b with browser a to site b with browser b\n- exclude site a with browser a to site b with browser b, because it's too many variables and doesn't give you new data.\n. Actually, if we provide a direct link to the script, the script could live in master. What do you think?\n. Actually, not sure how it's included already, but doesn't appear to be\nneeded. Pushed a commit with that deleted.\nOn Mon, Aug 12, 2013 at 9:45 AM, Martin Laine notifications@github.comwrote:\n\nIn spec/wraith_spec.rb:\n\n@@ -0,0 +1,53 @@\n+require 'rspec-given'\n+require 'wraith'\n+require 'wraith_manager'\n+# require 'image_size'\n\nIf this is commented out, can we remove it?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/BBC-News/wraith/pull/24/files#r5709495\n.\n. \n",
    "nathggns": "Is headless technically a requirement to add Trident support? \n. ",
    "lukeggchapman": "http://triflejs.org/ Its still in Beta but looks promising\n. ",
    "jamesryanbell": "Sorry to drag up an old question but I have just started to work with Wraith and I managed to get it running with TrifleJS on my windows machine so I thought I would share how for those who also want to.\nAll you need to do is change the page.onResourceReceived with page.onLoadFinished as onResourceRecieved hasn't made it into the TrifleJS Api yet.\nSo to get it working within your snap_trifle.js file just replace\n//SlimerJS or PhantomJS\npage.onResourceReceived = function(res) {\n  if (res.stage === 'end') {\n    current_requests -= 1;\n    debounced_render();\n  }\n};\nwith\n//TrifleJS only\npage.onLoadFinished = function(status) {\n  if (status == 'success') {\n    current_requests -= 1;\n    debounced_render();\n  }\n};\n. No problem, I have updated the config file appropriately. Thanks\n. ",
    "Qlczas": "Hello dear Sirs,\nI am using Wraith with SlimerJS for past half year, but it was configured before not by myself.\nI am trying now to use it with either PhantomJS (but I'm getting an error in screenshots \"Access Denied (authentication_failed)\" instead of screenshots of the page).\nAlso another issue is - how to configure TrifleJS? I don't have snap_trifle.js file? Should I create it? what should be inside the file?\n. Hi, I have same problem as described above.\nMy config:\nWindows 8 Lenovo W540 laptop, PhantomJS 1.9.8. Wraitha 3.2.0, Imagemagick 6.9.5, Ruby 2.3. \nOn \"Snapping...\" it freezes... it just creates the first images but not the thumbnails.\nI've tried different options... basing on default capture.yaml config :/\n. Hi,\nI had the issues as everyone else e.g. https://github.com/BBC-News/wraith/issues/441\nwhen used Phantom 2+. It's not even starting to take screenshot.\nWith Phantom1.9.8 I got stuck at \"snapping\"...\n. hello... any help? been almost two weeks...\n. Hello again,\nthanks for all the replies.\nI've updated to Wraith 3.2.1\nI've updated to PhantjomJS 2.1 because with 1.9.8 Wraith won't even start at all.\nAnd now with PhantomJS2.1 I receive following errors:\nC:\\Wraith>wraith capture configs/test.yaml   & PAUSE\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nDEBUG: #################################################\nDEBUG:   Command run:        capture configs/test.yaml\nDEBUG:   Wraith version:     3.2.1\nDEBUG:   Ruby version:       ruby 2.3.0p0 (2015-12-25 revision 53290) [x64-mingw\n32]\nDEBUG:   ImageMagick:        Version: ImageMagick 6.9.5-2 Q8 x64 2016-07-11 http\n://www.imagemagick.org\nDEBUG:   PhantomJS version:  2.1.1\nDEBUG:   CasperJS version:   CasperJS not installed\nDEBUG: #################################################\nDEBUG:\nConfig validated. No serious issues found.\nCreating Folders\nSAVING IMAGES\nDEBUG: phantomjs  'C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wrait\nh/javascript/phantom.js' 'http://www.onet.pl/' '600x768' 'shots/home/600x768_pha\nntomjs_current.png' 'body' 'C:/Wraith/javascript/disable_javascript--phantom.js'\n 'false'\nDEBUG: phantomjs  'C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wrait\nh/javascript/phantom.js' 'http://onet.pl/' '600x768' 'shots/home/600x768_phantom\njs_new.png' 'body' 'C:/Wraith/javascript/disable_javascript--phantom.js' 'false'\nDEBUG: phantomjs  'C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wrait\nh/javascript/phantom.js' 'http://www.onet.pl/' '1024' 'shots/home/1024_phantomjs\n_current.png' 'body' 'C:/Wraith/javascript/disable_javascript--phantom.js' 'fals\ne'\nDEBUG: phantomjs  'C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wrait\nh/javascript/phantom.js' 'http://onet.pl/' '1024' 'shots/home/1024_phantomjs_new\n.png' 'body' 'C:/Wraith/javascript/disable_javascript--phantom.js' 'false'\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/600x768_phantomjs_current.png on attemp\nt number 1 of 5\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.jCsa'n''\nt open ''C:/Ruby23-x64/lib/ruby/gemWARN: Failed to capture image shots/home/600x\n768_phantomjs_new.png on attempt number 1 of 5\ns/2.3.0/gems/wraith-3.2.1/lib/wraith/javascript/phantom.js''\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/1024_phantomjs_new.png on attempt numbe\nr 1 of 5\nWARN: Failed to capture image shots/home/1024_phantomjs_current.png on attempt n\number 1 of 5\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/600x768_phantomjs_current.png on attemp\nt number 2 of 5\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/600x768_phantomjs_new.png on attempt nu\nmber 2 of 5\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/1024_phantomjs_current.png on attempt n\number 2 of 5\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/1024_phantomjs_new.png on attempt numbe\nr 2 of 5\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/600x768_phantomjs_current.png on attemp\nt number 3 of 5\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/600x768_phantomjs_new.png on attempt nu\nmber 3 of 5\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/1024_phantomjs_current.png on attempt n\number 3 of 5\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/1024_phantomjs_new.png on attempt numbe\nr 3 of 5\nCCaan'nt 'otp eonp e'n' C':'/CR:u/bRyu2b3y-2x36-4x/6l4i/bl/irbu/bryu/bgye/mgse/m\n2s./32..03/.g0e/mgse/mwsr/awirtahi-t3h.-23..12/.l1i/bl/iwbr/awirtahi/tjha/vjaasv\ncarsicprti/ppth/apnhtaonmt.ojms.'j's\n''\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/600x768_phantomjs_new.png on attempt nu\nmber 4 of 5\nWARN: Failed to capture image shots/home/600x768_phantomjs_current.png on attemp\nt number 4 of 5\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.1/lib/wraith/java\nscript/phantom.js''\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nFatal Windows exception, code 0xc0000005.\nWARN: Failed to capture image shots/home/1024_phantomjs_current.png on attempt n\number 4 of 5\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/1024_phantomjs_new.png on attempt numbe\nr 4 of 5\nCCCCaaaannnn''''tttt    ooooppppeeeennnn    ''''''''CCCC::::////RRRRuuuubbbbyyyy\n22223333----xxxx66664444////lllliiiibbbb////rrrruuuubbbbyyyy////ggggeeeemmmmssss\n////2222....3333....0000////ggggeeeemmmmssss////wwwwrrrraaaaiiiitttthhhh----3333\n....2222....1111////lllliiiibbbb////wwwwrrrraaaaiiiitttthhhh////jjjjaaaavvvvaaaa\nssssccccrrrriiiipppptttt////pppphhhhaaaannnnttttoooommmm....jjjjssss''''''''\nFatal Windows exception, code 0xc0000005.\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nFatal Windows exception, code 0xc0000005.\nFatal Windows exception, code 0xc0000005.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nPhantomJS has crashed. Please read the bug reporting guide at\nhttp://phantomjs.org/bug-reporting.html and file a bug report.\nWARN: Failed to capture image shots/home/600x768_phantomjs_current.png on attemp\nt number 5 of 5\nERROR: Unable to capture image shots/home/600x768_phantomjs_current.png after 5\nattempt(s)\nWARN: Using fallback image instead\nWARN: Failed to capture image shots/home/600x768_phantomjs_new.png on attempt nu\nmber 5 of 5\nERROR: Unable to capture image shots/home/600x768_phantomjs_new.png after 5 atte\nmpt(s)\nWARN: Using fallback image instead\nWARN: Failed to capture image shots/home/1024_phantomjs_current.png on attempt n\number 5 of 5\nERROR: Unable to capture image shots/home/1024_phantomjs_current.png after 5 att\nempt(s)\nWARN: Using fallback image instead\nWARN: Failed to capture image shots/home/1024_phantomjs_new.png on attempt numbe\nr 5 of 5\nERROR: Unable to capture image shots/home/1024_phantomjs_new.png after 5 attempt\n(s)\nWARN: Using fallback image instead\nCROPPING IMAGES\nProcess.fork is not supported by this Ruby\nDEBUG: Both images are exactly 1024x500 - no cropping required. (shots/home/1024\n_phantomjs_current.png, shots/home/1024_phantomjs_new.png)\nDEBUG: Both images are exactly 600x768 - no cropping required. (shots/home/600x7\n68_phantomjs_current.png, shots/home/600x768_phantomjs_new.png)\nCOMPARING IMAGES\nProcess.fork is not supported by this Ruby\nComparing shots/home/1024_phantomjs_current.png and shots/home/1024_phantomjs_ne\nw.png\nSaved diff\nComparing shots/home/600x768_phantomjs_current.png and shots/home/600x768_phanto\nmjs_new.png\nSaved diff\nGENERATING THUMBNAILS\nProcess.fork is not supported by this Ruby\nGENERATING GALLERY\nGallery generated\nView the gallery in your browser:\n         file://C:/Wraith/shots/gallery.html\nPress any key to continue . . .\n. Hi again, sorry for long silence. This can be closed.\nI've managed to run wraith succesffully - the issue I had was with one of our pages it was behind logging system which was causing Wraith not to take screenshots. But other project is working fine, the versions that are working on my Lenovo Thinkpad with Windows 7 are:\n-Wraith 3.2.1\n-Ruby environment as a Windows installer (version 2.3.1), \n-ImageMagick (version 7.0.3)\n-PhantomJS (version 1.9.8)\nOnly hack needed is for Ruby problems, Work around: \nCertification file \u201eGlobalSignRootCA.pem\u201d has to be copied to below folder (after installation of Ruby):\nC:\\Ruby23\\lib\\ruby\\2.3.0\\rubygems\\ssl_certs (or the path of your ruby)\nthanks for all the help\n. ",
    "liakong": "Thanks very much for your update and now I have installed and tried the tool successfully. As far as I know, wraith can use two kinds of browser engines to capture screenshots, webkit by phantomjs and gecko by SlimerJS . But modern browsers with same browser engines can still have differences. So wraith is mainly used to compare a website to its history, not to find the differences between different browers. Have you ever considered to develop another tool for browser compatibility testing based on wraith? Look forward to hearing your opinion.\nIf you think this question is not in the right place, please let me know. Thanks.\n. ",
    "paazmaya": "Thank you, that is good news!\n. ",
    "jviotti": "@remitbri Worked with Ruby 1.9.1. Thanks.\n. I cloned master, and tried with Ruby 2.0.0-p247 again. Still the same issue.\n. @DaveBlooman that worked! You should update the README to let users know that they have to install image_size, not imagesize. Thanks a lot for the support!\n. ",
    "doryphores": "@DaveBlooman merge done. Over to you.\n. Just a heads up: you should merge master into your branch so that you don't miss the changes merged from #21 which should be copied into your new WraithManager class.\n. If this is commented out, can we remove it?\n. ",
    "rafael-santos-olx": "Command 'bundle' made me realise that ruby version was 1.8 and some other dependencies were missing.\nI upgraded it to 1.9.3, installed bundle and now it's working...\nThanks for your support.\n. ",
    "UpWorks": "``` javascript\nAdd only 2 domains, key will act as a label\ndomains:\n  english: \"http://mvvbc.com\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 320\n  - 600\n  - 768\n  - 1024\n  - 1280\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\n  about: /about.php\nIf you don't want to name the paths explicitly you can use a yaml\ncollection as follows, and names will be derived by replacing / with _\n\npaths:\n- /imghp\n- /maps\n```\n. Thank you! - Would it be ok if I help out with the documentation through a PR?\n. ",
    "gidsg": "thanks, working again now.\n. ",
    "malengrin": "Thanks Dave, \"-background none\" is working.\nI've updated the pull request\n. I am testing http://www.vestiairecollective.com/\nBut we added a bgcolor on the body so it won't be transparent soon.\nA simple test page is:\n<html>\n<body>\n    TEST\n</body>\n</html>\n. ",
    "pomeh": "Afterward, I think this workaround is far from ideal if you have a shots directory with a lot of files, because the deletion time may be too long.\n. ",
    "rupl": "I'm still having trouble running any config file that is not named config.yaml \u2014 for example moving the test_config.yaml works fine once it's renamed, but Wraith silently fails when I run the following on a fresh \"install\" of Wraith.\nbash\nrake config['test_config']\nThe only feedback provided when --trace is added is the following.\n** Invoke configs (first_time, not_needed)\nI'm a bit green to ruby so if you provide instructions I'm happy to produce more info but I'm not sure where to go from here.\n. My OS/ruby:\n- Mac OS 10.8.4\n- ruby is via rvm: 1.9.3-p385\nHowever, your response has helped me resolve my issue. I was missing was the fact that I need to be inside the configs directory to get it to run properly. After running the command directly inside that folder everything worked great!\nThanks for the quick response, and I'll follow up with a minor doc PR to help those who make my same mistake.\n. That would be great! In the spirit of giving back I will still offer this PR and you can feel free to close it after you modify Wraith to pick up the configs from the root dir.\n. In my experience you do. @DaveBlooman agreed about this need in #41 and this doc PR was only in place until his comment about adding the ability to run rake from anywhere within the Wraith dir was resolved.\n@JakeChampion if you could explain what command needs to be run in the mean time that would be awesome!\n. ",
    "JakeChampion": "You don't need to be inside the configs folder to run the command.\n. I just run rake config[CONFIGNAME] whilst inside the wraith dir and that works, no need to be in the configs dir.\nYou still need a default config.yaml otherwise it will not run any config.\n. Other than providing a default for the snap_file, this looks good to merge.\n. Seems good from an initial review, haven't tested the functionality or ran tests yet.\n. Could we specify more than one engine and have wraith iterate over them?\n. :+1: \n. In regard to the unable to convert \"\\xCF\" from ASCII-8BIT to UTF-8 error\nA message from https://github.com/mudge/re2/issues/16 explains the issue:\nApparently this is a bug in RDoc included in Ruby 2.0.0: see rdoc/rdoc#195 and davidfstr/rdiscount#96\nCan you try upgrading RDoc to 4.0.1 to see if this remedies the warning? \nAlso, the project has a specified ruby version (which you deleted). Have you tried installing the ruby version specified at all?\nI can look into seeing if this works with Ruby 2.0 + but to my knowledge no-one has checked.\n. @DaveBlooman Reviewing this now\n. :+1: \n. Looks good to me\n. :+1: \n. :+1: :ghost: \n. I don't believe we currently have a process in place for adding content to the wiki. CC @DaveBlooman \n. :+1: \n. I thought we should allow the user to choose where they have the binary installed instead of presuming /usr/bin/xvfb-run\n. @DaveBlooman When using the edits you made in the gist I had this error:\nsh: /usr/bin/xvfb-run /home/developer/slimerjs-0.9.0/slimerjs: No such file or directory\nI believe this is because capture_page_image expects 4 parameters being passed but is actually getting 5\n. SlimerJS was set in my PATH, but I also had it defined absolutely in the config.yaml it seems\n. Also, I think we should name the files according to the browser key and not the browser value, incase people like me absolutely define the location instead of adding it into their PATH.\n. SlimerJS hitting the homepage at 320 \n\n. phantom hitting domestic homepage at 320\n\n. I'll add documentation once I get it running with both phantom and slimer when xvfb is turned on.\n. I'll do that now\n. I believe this to be ready for review now :)\n. @sthulb @DaveBlooman How would you know it's available in the PATH? Wouldn't it just list the folder that it is within? Would you check the contents of each folder defined in the PATH and see if xvfb-run is in one?\n. Will update the PR with @sthulb's suggestion\n. @sthulb How about this? :)\n. I'd advise that you create a new stylesheet that hides the elements in question and then add that it on runtime with either a page.evaluate or an page.injectjs. These should be added into the snap file inside either page.open or lines 73 & 82. You could have this as a separate snap file that you define in the config.yaml.\nExample:\n``` JS\nvar css = fs.read(\"stylesToHideShizzle.css\");\npage.open(url, function(status) {\n    page.evaluate(function(css) {\n        var fonts = document.createElement(\"style\");\n        var head = document.getElementsByTagName(\"head\")[0];\n    fonts.innerHTML = css;\n    head.appendChild(fonts);\n}, css);\n\n});\n``\n. Maybe we should write to the console that an invalid image has been found?\n. Just testing it out now.\n. I think it looks good to go, I just have that one question about where the directory is being taken from. I see that all the tasks to do with directories after thesave_imagestask all grab the directory from@save_images.directory`, is it because then we don't have to parse the yaml multiple times?\n. rspec fails.\n. :+1: Then merge whenever :)\n. Just update this PR by committing to the same branch and pushing :)\nOn Thu, Jan 30, 2014 at 3:27 AM, Stephen Belyea notifications@github.comwrote:\n\nGood point! Should I submit an updated pull request with the below\naddition for the default config? (or is there a better way for this?)\ndesc \"Execute wraith on two sites using the default config.yaml\"\n\nReply to this email directly or view it on GitHubhttps://github.com/BBC-News/wraith/pull/92#issuecomment-33657358\n.\n. @DaveBlooman Why the closing of this PR? Could we have some feedback upon why this feature didn't make it upstream into Wraith?\n. You can suppress whitespace by passing the parameter w with the value 1.\n\nhttps://github.com/BBC-News/wraith/pull/100/files?w=1\n. A node port has happened already, with a corresponding grunt task. I shall\ntry and find a link to it.\nOn Sun, Feb 16, 2014 at 4:36 PM, Jason Karns notifications@github.comwrote:\n\nThis seems to be primarily a front-end tool. As such, it might make more\nsense as a node utility (especially with grunt integration). This would\nmake wraith useful outside of the ruby world.\nWould a node port be welcomed?\n\nReply to this email directly or view it on GitHubhttps://github.com/BBC-News/wraith/issues/103\n.\n. https://github.com/jrcryer/wraith/tree/gruntify Hat tip to @DaveBlooman for finding the link. This port isn't up to date though.\n. If however you just want grunt integration, you could use Grunt-shell\n. Maybe run save_images on each commit/branch and then run compare_images? I've not tested this technique, but I don't see why it shouldn't work.\n. :+1: \n. :+1: \n. Why the close?\n. ### TL;DR\n\nTry increasing the viewport height in your yaml config to trigger your lazy-loading\nExplanation of how we trigger a render\nIn snap.js we have some logic already that will only fire off the rendering when either all the requests have come through or one of the two timeouts has been fired.\nLines 44-84 of snap.js:\n``` js\npage.onResourceRequested = function(req) {\n  current_requests += 1;\n};\npage.onResourceReceived = function(res) {\n  if (res.stage === 'end') {\n    current_requests -= 1;\n    debounced_render();\n  }\n};\npage.open(url, function(status) {\n  if (status !== 'success') {\n    console.log('Error with page ' + url);\n    phantom.exit();\n  }\n});\nfunction debounced_render() {\n  clearTimeout(last_request_timeout);\n  clearTimeout(final_timeout);\n// If there's no more ongoing resource requests, wait for 1 second before\n  // rendering, just in case the page kicks off another request\n  if (current_requests < 1) {\n      clearTimeout(final_timeout);\n      last_request_timeout = setTimeout(function() {\n          console.log('Snapping ' + url + ' at width ' + view_port_width);\n          page.render(image_name);\n          phantom.exit();\n      }, 1000);\n  }\n// Sometimes, straggling requests never make it back, in which\n  // case, timeout after 5 seconds and render the page anyway\n  final_timeout = setTimeout(function() {\n    console.log('Snapping ' + url + ' at width ' + view_port_width);\n    page.render(image_name);\n    phantom.exit();\n  }, 5000);\n}\n```\nI haven't tried running wraith against anything that lazy-loads images in. Could you try and change the viewport height in your yaml configuration to atleast the height of the document in question and see if that will force your lazy-loading implementation to kick in. If it does, then it will fire new requests off which would hopefully get caught in our request counting logic I spoke about at the beginning.\n. I may have referenced the wrong file, let me just refresh my head :-)\n. Apologies, it's inside the snap.js file on Line 18\n. @rajee1009 Here is a way to run some JS in the page context before the render happens.\nhttps://gist.github.com/JakeChampion/9771686\nLines 17-23, 70-74, 86 & 94 are the ones you should note, all the rest is standard.\nPlease comment on this issue if you have more queries, it seems you don't get emails for comments on gists.\n. That depends on your lazy-loading technique, if it's like most implementations then it will only kick off requests when the image in question is within X pixels of the viewport height.\nIf you post the plugin for lazy-loading I could perhaps give you some JS to load the images.\nHere's an example of some JS that loads the images for David Walsh's LazyLoad plugin.\nJavascript\nvar lazyImages = Array.prototype.slice.call(document.querySelectorAll('img[data-src]'));\nlazyImages.forEach(function(image) {\n    image.src = image.dataset.src;\n    image.fade(1);\n});\nIf you head to his example page and run that JS in the console, it will load all the images in.\n. Here is that function included in a stripped down snap-file https://gist.github.com/JakeChampion/9793902\nI realised the previous gist I sent recommending a place to put the JS wasn't the best suggestion. This one runs the lazy-load busting function as soon as the page is open.\n. What are you trying to achieve by running it on CI? Would you like it to fail the build if the change exceeds a certain threshold?\nOr are you just wanting to have an archive of diffs that correspond to each patch?\n. We use it in two scenarios. \n1. To see if the changes made in a pull request aren't causing any visual changes other than what the feature may require.\n2. Running the proposed release against the current release, which should hopefully catch any regressions that were missed by scenario 1.\nI wouldn't recommend a threshold limit breaking a build. That could break the build for only adding a small change, an example would be if you're developing the BBC News responsive site and you increase the height of the News logo. That change would knock the rest of the page down and cause wraith to say everything below the logo has been altered, making the diff-size massive for only an arguably small change; which would cause your CI to fail, even if the feature being requested was to increase the logo height.\n. wraith compare_images config_name should be the command for you :-)\n. We are just updating the wraith compare_images task to make it more useable. https://github.com/BBC-News/wraith/pull/123\nWe are also thinking about have a flag that you can pass in to specify a folder of images instead of a config file :-)\nI saw the solution you and your team made WRT to the lazy-loading problem you had, your technique is nice in the fact that it is not coupled to the lazy loading technique you employ. Meaning you can switch lazy-loading plugins without having to edit your snap.js each time :+1: \n. I've had success using this:\nconfig.yaml:\nyaml\ndirectory:\n  - 'shots'\nfolder setup:\nwraith\n|-- shots\n|    |-- images \n|    |    |-- image_1.png (Make sure the images you want to diff against are after each other alphabetically)\n|    |    |-- image_2.png\n|-- configs\n|    |-- config.yaml\nExecute via:\nbash\nrake compare_images\nor if installed as a gem\nbash\nwraith compare_images config\n. It was indeed :-) Since we have an answer to the question, I'm going to close the issue.\nI'm glad our tool fits your workflow. Now that I've seen different workflows, I'm tempted to create some docs that describe different ways to utilise Wraith. Thanks for the question :+1: \n. If the issue is because Phantom failed. Maybe we should try and figure out why it is failing to render? Also, if we notice an image is missing when we are running through the whole process, could we get wraith to run again for the scenarios that relate to the missing images?\nE.G. The filenames are in a consistent format:  #{width}_#{engine}_#{domain_label}.png\nSo if we are missing an image with the name 320_phantom_live, we can then spin up phantom at 320px wide and open the url in the yaml file for the live label.\n. I am not sure how an icon would help make the case.\nA better way to make the case would be to show/explain some scenarios upon where it is useful to have testing tools such as Wraith used.\nOne such scenario is when added/editing a component on the page. Wraith would enable you to see for certain if any unwanted side effects have occurred, which could then be addressed; thus mitigating the likelihood of visual regressions appearing in the production application/website.\n. Images need to be of the same height for ImageMagick to run successfully.\nThe ImageMagick command used is:\ncompare -fuzz #{wraith.fuzz} -metric AE -highlight-color blue #{base} #{compare} #{output}\nWe crop the images to the same size I believe -> lib/wraith/crop.rb\nHopefully that helps.\n. Check out https://github.com/BBC-News/wraith/issues/121 - Hopefully that is what you are after\n. Hide it behind a flag for now?\n. You could make a tool that goes over the data.txt files and copies the images that have a pixel difference - https://github.com/BBC-News/wraith#output - https://github.com/BBC-News/wraith/blob/35d759baa4b63beec6aa1ada6674dc7ad5b5f9ec/lib/wraith/compare_images.rb#L18\n. :+1: WRT the failures directory (images that have a diff - not always indicative of failure). Would you be copying those images or would they be the only copy? If they are the only copy then it sounds like a good idea.\nI'd say make it a config option to only output the differences, but what would you display if no images are different?\n. @DaveBlooman This was a feature request raised by @paruchurisilpa. I think we should think about how we want people to setup Wraith, the majority of the configuration is in the yaml file that is loaded, why not try and consolidate the other common features into the same file? Ignoring edge case configuration to keep it sane.\n. Could we have it run the jobs in parallel at all? Or would that interfere with the parallel phantomjs instances that Wraith uses for the capture?\n. :+1: \n. @DaveBlooman Is this the same as Grabber?\n. It's to do with the parallel gem in use https://github.com/BBC-News/wraith/blob/master/wraith.gemspec#L31\nhttps://github.com/grosser/parallel/blob/master/lib/parallel.rb#L173\nruby 2.1.2 will resolve this issue, give that a shot :-)\n. @boonet If the issue is not resolved by upgrading the version of Ruby running Wraith, please feel free to reopen the issue.\n. @tgoswami013 I can not, sorry. I have not used this tool for nearly 3 years.. How about making it configurable but with a sane default value? That way Wraith can indicate on any colour scheme that the extra space was created by Wraith or not.\n. @Mark-JM I'm for the latter approach you have outlined.\n. @pgchamberlin Have you seen this? https://github.com/BBC-News/wraith/issues/121 Possible duplicate?\n. @Mark-JM Which browser are you passing the javascript file to? This does need to have some better error handling logic.\n. @Mark-JM What were you editing in the snap.js file? Is it something can we could pull out into the yaml config file passed to wraith? Ideally Wraith has a single configuration file that powers the system.\n. @Mark-JM Ping :-)\n. @Mark-JM Maybe we should resurrect this? https://github.com/BBC-News/wraith/issues/164\n. @Mark-JM I can't confirm if there was any discussion offline, there was no discussion online though. I've got a local branch with the changes in for custom headers. If this is an agreed direction for the project to take I will happily create the PR for it.\n. @DaveBlooman Has this been fixed?\n. @nickschuch @javiercejudo Could you try this version out at all?\n. @DaveBlooman Bump major version number then?\n. @DaveBlooman What do you think to bumping major version number with this change?\n. Unfortunately PhantomJS does not offer CSS media emulation (Chrome DevTools offers this). This means that it can not be done in a way that will work across all project types. [1]\nIf your CSS media types are each housed in individual link tags then you could have some JS that removes the the media types which are not print and then change all print types to screen.\nIf however all your CSS is bundled together into one file then the JS needed for the conversion gets a bit more complex. Here's my initial attempt at converting all CSS print styles into screen styles and removing  all the rest of the CSS.\n[1]: PhantomJS will use print styles when rendering a PDF instead of a PNG of the webpage. However Wraith makes use of PNGs for the image diff aspects of the application.\n. @DaveBlooman What do you think on the idea of being able to pass a print option to Wraith that changes the rendering done via the headless browser to pdf instead of png so that it gets the print styles. After this Wraith can use ImageMagick to compare the PDFs as it can handle them according to docs. I've search for already made tools that automate print visual regression testing and found none by the way.\n. Any reasoning behind the closing of this issue?\n. :+1: LGTM\n. @DaveBlooman This is now working\n. @chris-dura Could you try using this snap file instead of the default one. This issue is actually a phantomjs issue.\n@DaveBlooman I think we should default to using the custom width and height snap file until this phantomjs issue is resolved, what do you think?\n. @chris-dura I can confirm that your issue is replicable and is also resolved by the snap file mentioned in the above comment.\n. @chris-dura I'm glad the issue was resolved. I think this issue should be closed and a new issue raised to discuss the feature request. (I don't have the priviledge to close issues)\n. @chris-dura If it is just image comparisons then yes Wraith can do it. I would recommend something like http://huddle.github.io/Resemble.js/ if you want a tool to do solely image comparisons.\n. Nice feature @nlisgo, the code needed for it is simple also, which is a bonus! :+1: \n. Related to https://github.com/BBC-News/wraith/pull/184\n. @steveworkman Can you try ruby 2.0.0-p247 instead of ruby 1.9.1 please?\n@DaveBlooman I think we should add a ruby version requirement to the readme and maybe into the CLI. What do you think?\n. Maybe we should provide a default if snap_file isn't defined.\n. Just reviewing the code, so far so good.\nSome typos in the comment though.\n\"ignore urls to file extensions such as images etc\"\n. gecko\n. spelling nazi\n. I'm going to not comment on the rest...\n. :+1: I was just thinking of how to do that :)\n. Currently with this change you can't run both phantom and slimer. This would make phantom also use xvfb. @DaveBlooman \n. nope, try running this PR with only phantomjs set to run\n. It'll get caught here, so that it doesn't run the empty xvfb\n. Why grab the directory from save_images instead of the config? As we do in compare_images.rb#L11\n. Should this now point to BBC-News?\n. Nice addition :) I think we should mention that it will use the default config file and specify the name of the config file for the user.\n. How about this?\nruby\ndef image_height(image)\n  File.open(image, 'rb') do |fh|\n    ImageSize.new(fh.read).size[1]\n  end\nend\n. I haven't seen this syntax before, is it still a hash?\n. This makes no sense\n. I've commented on the ones I think are odd, the rest seems fine\n. Don't ignore this file\n. After reading about best practices for authoring a gem, it seems you don't commit the gemfile.lock. It should be committed when developing an app, not a gem.\nApologies for the false advice earlier\n- http://yehudakatz.com/2010/12/16/clarifying-the-roles-of-the-gemspec-and-gemfile/\n. @coderkind is correct.\nCasperJS isn't blocking on the call to change the viewport and as such there is currently a race condition present in this code between resizing the viewport and snapping the image.\n. ",
    "boldfacedesign": "Has there been any developments on this issue yet. I'm getting the same Invalid Parameter errors on Windows.\n. Sure thing.\nI had a few issues with ImageMagick on set-up that would be VERY useful for other people to know about, will include that too.\n. Cool. Let me know if it works for you and if there's any amends you think are needed. In the meantime I'll fix my typos.\n. Anemone dependency added to Gemfiles\n. ",
    "1stevengrant": "all good now :+1: \n. ",
    "scottnath": "I had to delete that ruby version file to get given_core to install. I asked around the office here and was instructed to try turning off docs instead using this command:\n$ gem install --no-rdoc --no-ri rails\nDid it and ran \nbundle install\nagain and looks like the installation went through with no hiccups.\nThe solution was found here:\nhttp://charles.lescampeurs.org/2008/11/21/install-gem-without-documentation\nthanks for getting back to me!\n. ",
    "jaikdean": "Aborting at this point, before the domain1 thumbnail or the diffs are generated, appears to leave valid screenshots for both domains in the shots directory.\nwraith:master$ rake\nprocessing '/' ''\n2013-11-19 13:01:17.767 phantomjs[28239:d07] *** WARNING: Method userSpaceScaleFactor in class NSView is deprecated on 10.7 and later. It should not be used in new applications. Use convertRectToBacking: instead. \nSnapping http://domain2.dev/ at width 1280\n2013-11-19 13:01:25.782 phantomjs[28242:d07] *** WARNING: Method userSpaceScaleFactor in class NSView is deprecated on 10.7 and later. It should not be used in new applications. Use convertRectToBacking: instead. \nSnapping http://domain1.dev/ at width 1280\ncropping images\n^Crake aborted!\n. Yes, the domains are placeholders. I've double- and triple-checked they are correct, and as per my comment above, it looks like the screenshots for both domains are actually being created correctly.\nUsing non-labelled paths is a documented feature in the config.yaml. I get the same results using:\nyaml\npaths:\n  home: /\n. Commenting out the @wraith_manager.compare_images line in the Rakefile leaves valid screenshots and thumbnails in place. Everything appears to work correctly, obviously without the actual image comparison side of things.\n. Looks like this was down to my domain names containing numbers.\n. What are the keys for your domains in config.yaml? Ensure they only use a\u2013z. If you still have problems then it's a different bug and you should open a new ticket.\n. ",
    "plukevdh": "We could do that, I figured that setting up the config file, though, should be a basic first mandatory step. I still have the config there, it just got moved to a more conventional config.yaml.sample. \nThe main issue I saw with it is if I changed the config for my own use, then wanted to submit a patch (like this one), then git wants to commit the changed config, which is not what I wanted. Up to you though.\n. sounds good, i'll push an update shortly\n. ",
    "kerasai": "What ever happened with this? I see a few related PRs but it doesn't seem that any have been accepted/merged and I don't see any support for xvfb.. Thanks for the reply.\nShortly after posting this, I realized that xvfb was not necessary at all when using phantomjs. At some point it was needed, but not any longer.. ",
    "kenoir": "For example, if I wanted to do something like this: https://github.com/kenoir/wraith_sidekiq/blob/master/app.rb I don't think I can right now.\n. ",
    "meza": "Can't wait to integrate this with my work. Any chances of getting it in soon?\n. Thanks! Let's see how fast I can integrate this!\n. I've incorporated the comments :)\n. Argh... fixing it\n. It's passing\n. Is there anything I could do to make this happen? :)\nhttps://github.com/guardian/wraith-donk is coming to a pretty happy place in minutes! :)\n. I have another set of changes that introduce proper logging all around. Should I attach it to this PR or wait for it to be merged and add it separately?\n. Cool! I'm not using the command line aspects of wraith at all, so I don't think we'll have any conflicts :)\n. I went through several tools to do so, but all of them were either buggy, or leaking or simply slow.\nI'm not sure ruby's up for the task yet.\n. @DaveBlooman  the only reason I stripped it out was to keep backward compatibility with the executable script style of the gallery.rb. If it's not used from the outside, there's probably no need for 2 files!\n. I removed the leftover / which I believe broke the links. TBH I don't use the extra path thing, but someone had a question about what happens if they decide to host the gallery from a different location/domain \n. I've merged in your changes so far, so this pull request should be merge-able without any conflicts\n. Just a thought: would it be a good idea to separate the wraith lib from the executors like cli and http?\nThen we'll end up with \ngem 'wraith-cli'\ngem 'wraith-http'\nand each could use the wraith gem as dependency\n. Haha, indeed! What a silly mistake, lol. On it\n. @DaveBlooman can you tell me what's wrong here? https://travis-ci.org/BBC-News/wraith/jobs/18653502\n. @DaveBlooman I managed to reproduce it on the guardian site too, so it's not that. Looking into it.\n. @base, @compare = files.slice!(0, 2)\nseems to yield a nil @compare\nThe problem is that it's not consequent. Maybe a null-check would  do justice to it in the find_heights method\n. I'll update this shortly. Been in back to back meetings ever since\n. It's in!\n. My only problem with the absolute path config support is that the snap.js resolution should be realtive to the config_location setting (currently) in wraith_donk\nIt would be nice to be able to configure Wraith to look for configurations in a specific folder. Any thoughts?\n. it just loads up a config file if it's an absolute path. Need a bit more work to make the config directory configurable. Basically just to have the \"configs\" extracted, and the snap.js location to be relative to hat directory.\nWill look into it tomoz \n. I wouldn't even use the snap_path_relative thing, it would annoy the hell out of users imho.\nA simple File.exists? could check if it's available relative to the snap_path or not :)\nWill integrate tomorrow, thanks for the tip!\n. I'm not sure anymore that we need to solve this inside wraith or even donk. From now on as we can use configs from other directories, we can leave this issue up to the users. They could use puppet, git, scp, ftp, whatever they want to populate the config location. Of course, this doesn't mean we can't give them a tool to use! :)\n. Yay! I'll look at the rake issue right away! We've started using it big time, and some minor enhancement ideas came up. Gonna focus on the UI on donk's side now, but let's get this merged! :)\n. @DaveBlooman it's http://donk-host/<project>?label=<anything, could be a build number>\n. This just crowned my week! Thanks @sthulb ! :D\n. yeah, was thinking about that. Ok :)\n. Yeah, that needs to be changed once it's in. If I change it now, that could confuse anyone trying to use my fork\n. Interesting, they work for me perfectly. Let me check soon\n. ",
    "subru77": "It somehow started working ... Sorry for the trouble. \n. ",
    "patrickng": "I couldn't find any documentation or any other post regarding this so I'm posting it here. If you are behind a proxy and need to pass in some options to PhantomJS in order for it to access your test sites, you can pass a string to phantomjs_options in config.yaml\neg:\nphantomjs_options: \"--proxy=address:port --proxy-auth=user:pass\"\n. ",
    "i-like-robots": "Sure, NP.\n. Unfortunately my Ruby skills are... best left unmentioned. I'll see if I can grab a little time with one of the proper Ruby guys here.\n. I guess it makes it the argument appear optional when it isn't, right?\n. I've added a note about the config file path and removed the square brackets. I can squash commits together.\n. Squashed commits, go for it!\n. ```\nHeadless browser option\nbrowser:\n  webkit: \"phantomjs\"\n  # gecko: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory:\n  - 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  styleguide: \"http://localhost:8080/styleguide\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 320\n  - 768\n  - 1025\nType page URL paths below, here are a couple of examples\npaths:\n  - /typography\n  - /pagination\n  - /dropdown\n  - /buttons\n  - /inputs\n  - /alerts\n  - /badges\n  - /cards\n  - /icons\n  - /tags\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n  - 10\n.\npaths:\n  typography: /typography\n  pagination: /pagination\n  dropdown: /dropdown\n  buttons: /buttons\n  inputs: /inputs\n  alerts: /alerts\n  badges: /badges\n  cards: /cards\n  icons: /icons\n  tags: /tags\n```\n. :thumbsup: \n. ",
    "PJnes": "I had this error when trying to run without imagemagick installed. It's not mentioned in the ReadMe, but is covered in the OS requirements in the full docs. \n. ",
    "nikglavin": "I encountered this issue when only a single domain was supplied in config and it looks like it was trying to get sizes etc of an image that doesn't exist. \nApologies for the false report \n. I still seem to be getting a similar issue would these be related ?\nwraith-1.1.4/lib/wraith/crop.rb:45:in `initialize': no implicit conversion of nil into String (TypeError)\n. Ideally I would like a -1 or a fail if the patch exceeds the certain thresh hold, so the developer can address the issue before it gets merged into the main branch.\nI might be off track there, if so I am interested in finding in more detail from others how wraith is integrated into their development workflow. Is it used more as a release tool ? run when a release is branched to compare changes against the last release ?\n. ",
    "zeroxme": "i'm getting the same error and i can't solve it ... any help!?\n. ",
    "jonnywyatt": "@zeroxme this also occurred for me when running the standard config with a single domain, same as @nikglavin \n. ",
    "wildlyinaccurate": "@jonnywyatt can you please post your exact config and the output of the failing run (including the command you ran)?\nIn capture mode, Wraith is intended to run against two domains. If you want to compare differences over time on a single domain, you probably want to use history mode.\n. @ToniStella you should run wraith from the \"wraith\" directory (not \"configs\") and either specify a filepath or a config name, i.e.\nwraith capture configs/config.yaml\nwraith capture config\nWhere with the second example, wraith infers that you meant configs/config.yaml.\n. require appears to be relative to the file which is currently being evaluated. Since your snap_file is inside the javascript/ dir, you should change your config to\nyaml\nbefore_capture: \"./test.js\"\nI'll try and figure out whether this is the intended behaviour. If it is, we should update the documentation and example configs to be more clear. Otherwise we should find out when the behaviour changed and fix it.\n. I'm seeing this error as well (though nothing as serious as a crashed box!) -- I think this might be caused by a backwards-incompatible change in 4f82c06\n@ChrisBAshton has the format of path configs changed now? We have something like\nyaml\npaths:\n  front_page_news: /news\n  live_page_news: /news/uk-politics-17456712\nBut that code looks like it expects a path key like this, unless I'm reading it wrong?\nyaml\npaths:\n  front_page_news:\n    path: /news\n  live_page_news:\n    path: /news/uk-politics-17456712\n. That does appear to be the case -- changing the config to have path keys fixes the issue.\nI think we should revert that change or at least perform a major version bump because there will be many configs in the wild which will break.\n. Could you show how you're running Wraith? Also see #288 (and my solution) which sounds like it might be the same issue.\n. We could quite easily set the viewport height to the full document height, but I wonder what effect that would have when diffing images with different heights?\nFeel free to experiment -- you should be able to do this by changing the following line in javascript/_getDimensions.js from\n'viewportHeight': parseInt(dimensions[2] || 1500)\nto\n'viewportHeight': parseInt(dimensions[2] || document.body.offsetHeight)\n. This is a really good idea, so long as it can be toggled on/off for people who use (e.g.) HTTP client hints.\nTo jump on the efficiency bandwagon, we could also add support for loading pages concurrently. I'm pretty sure PhantomJS has relatively good support for this. We would need some significant changes, though: Wraith would have to push the config into the client (Phantom, Slimer, etc) and the client would be responsible for doing much of what Wraith currently does.\nIn a way this is a much cleaner architecture -- Wraith effectively acts as a back-end and only cares about reading configs, calculating diffs, and creating the gallery.\n. \ud83d\udc4c  Great suggestion! I've made that change, and also enabled closing the lightbox with the escape key.. If this does Just Work\u2122 with existing configs then that is awesome! I'm no longer with the BBC and don't use Wraith anymore, but I'll pass this along to some other BBC colleagues who might be interested in reviewing and testing the PR.. Nice work on this \ud83d\udc4c. If the logging was done by a Logger class, the verbose state could live within that. You could even just use Ruby's standard Logger.\n. Does this break BC or was this script never invoked in user-land?\n. ",
    "trodrigues": "@nikglavin @DaveBlooman I don't think it is the same issue. I've opened one here #114\n. Completely missed these notifications.\nYeah, I assumed this would be related to Phantom because I started using Slimer and the problem doesn't happen anymore. Need to give a try to the latest version with Phantom.\n. ",
    "BeWhy": "for the record:\nhttps://www.npmjs.com/package/wraith\n. ",
    "Aupajo": ":+1: Getting the same issue here.\n. ",
    "elicaf": "That's awesome! Thanks a lot :)\nOn Fri, Feb 28, 2014 at 7:55 PM, David Blooman notifications@github.comwrote:\n\nI did look into this, it's probably worth implementing anyway, just\nhaven't got around to it. It's just taking the pixel difference value,\nwhich we already calculate, then dividing that by the total pixel count of\nthe image, then multiply by 100.\nThis could be done in the gallery, or perhaps a separate task that updates\nthe file with the calculation. That does open other options with adding in\nfailure rates for images, so I think it's worth exploring.\n\nReply to this email directly or view it on GitHubhttps://github.com/BBC-News/wraith/issues/107#issuecomment-36410253\n.\n\n\nBest,\nElica Farjadian\n. Thanks for your reply....I thought the config file should work if I pass a list to 'paths', no? Otherwise, will the code above work for different image sizes? Cause ImageMagic doesnt really support different image sizes(when dimension is different)..Thanks for your help\n. gem\n. I didnt touch anything, it was its default files. Just changed the config file to grab the images from the address that I set, which I have done before with the previous versions that I had.\n. #Headless browser option\nbrowser:\n  webkit: \"phantomjs\"\n  # gecko: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory:\n- 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  193: \"/Users/elica/Documents/Images/image1/\"\n  192: \"/Users/elica/Documents/Images/image2/\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n- 1024\nType page URL paths below, here are a couple of examples\npaths:\n  home: img/image1\nIf you don't want to name the paths explicitly you can use a yaml\ncollection as follows, and names will be derived by replacing / with _\n\npaths:\n- /\n- /uk\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the filename of the spider file to use, if not specified it will fallback to spider.txt\nspider_file: bbc_co_uk_spider.txt\nSet the number of days to keep the site spider file\nspider_days:\n- 10\n. Yes, I have this file under wraith/lib/wraith/javascript/snap.js\n. Its there, first \"wraith\" is the name of the dir that I have all these.\n. ",
    "vdruon": "```\nbrowser:\n  gecko: \"slimerjs\"\u200b\n\u200b\ndirectory:\n  - 'shots'\u200b\n\u200b\ndomains:\n  english: \"http://user:pass@www.mysite.com\n  russian: \"http://www.mysecondsite.com\u200b\n\u200b\n\u200b#Type screen widths below, here are a couple of examples\u200b\nscreen_widths:\n  - 320\u200b\n\u200b\npaths:\n  url1: /mentions\n\u200b\nfuzz: '20%' \n\u200b\nspider_days:\n  - 10\u200b\n```\nJust tried the same with webkit: \"phantomjs\" and it works...\nEDIT: Using it on Debian 7\n. I did what you said, and got SlimerJS to work.\nNow, SlimerJS opens a frame to get his shot, that's well for now, but I run this on a VM which has 96MB of memory, so it's very long, moreover, i feel that for SlimerJS keeping doing his tasks I have to close this 'frame', am i just crazy or what? :)\nEDIT: My question is just, Can we use the same snap.js for PhantomJS AND SlimerJS ?\n. ",
    "mattsenior": "Hello,\nI\u2019ve been playing with adding Parallel too, and just noticed this PR - did your experiments go any further?\nI\u2019ve got a branch over here which is taking a 15 min Wraith batch down to 2.5 min on my machine - I\u2019d be interested to hear your thoughts on it\u2026\nCheers (and cheers for making Wraith, hoping to get it into our workflow).\nMatt\n. Hi @DaveBlooman sorry for the delay,\nI\u2019ve taken the failsafe code you\u2019d added and turned it into a loop to retry a few times.\nI\u2019ve also taken your use of :in_processes => Parallel.processor_count for the heavy processing (cropping etc.) but left the remote image capturing running on a whole bunch of threads, which benchmarks much quicker for me.\nWhat do you think? I\u2019ll make a PR of my branch shortly which might make this ongoing discussion easier.\nCheers :)\n. Hi Dave, sorry for the delay, I\u2019ve been moving house and decorating all week - I\u2019m not likely to be able to get this done today, but I\u2019m aiming to find some time over the weekend now the dust has literally settled. Cheers.\n. Hi Dave, I\u2019ve added in the fallback image handling - let me know how you get on with it. Cheers.\n. ",
    "rajee1009": "Thank you for the quick response. I did'nt understand how to increase the viewport height in config.yaml. There is no section for height. Can you please specify where?\n. Also If there is a way to execute a JS script before loading can also solve this issue. Please let me know if there is a way to do it?\n. I am getting all the mails :) I just tried increasing the view port height and didn't work. I think the only way is to run a javascript before the render. Will post my questions after trying. \n. Hi, I tried injecting JS to scroll down the page to load and still no use. Looks like there is a synchronization issue. Is there a way I can some how make wraith to wait until the page loads before rendering? Like a wait statement for phantom.\n. Hi, \nWe just managed to resolve the lazy load. Below is the snap.js\nvar system = require('system');\nvar page = require('webpage').create();\nvar fs = require('fs');\nif (system.args.length === 3) {\n    console.log('Usage: snap.js   ');\n    phantom.exit();\n}\nvar url = system.args[1];\nvar image_name = system.args[3];\nvar view_port_width = system.args[2];\nvar current_requests = 0;\nvar last_request_timeout;\nvar final_timeout;\nvar scrollStepInterval;\nvar winHeight = 1000,\n    scrollDelay = 2000,\n    isPostDocumentLoaded = false,\n    stepCountTotal=0,\n    stepCount=0;\n// the scrollStep function scrolls the window with a delay between scrolls\n// the scrolls will trigger more images loading and the page.onResourceRecieved method will start triggering the debounce method\nvar scrollStepIntervalFunction = function(){\n  stepCount ++;\n  var scrollY = stepCount * winHeight;\n  var result = page.evaluate(function(scrollY) { $(document).scrollTop(scrollY); return scrollY; }, scrollY);\nif(stepCount == stepCountTotal) {\n    console.log(\"stepCountTotal : \"+ stepCountTotal);\n    isPostDocumentLoaded = true;\n    debounced_render();\n    clearInterval(scrollStepInterval);\n  } \n}\npage.viewportSize = { width: view_port_width, height: winHeight};\npage.settings = { loadImages: true, javascriptEnabled: true };\n// If you want to use additional phantomjs commands, place them here\npage.settings.userAgent = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.17 (KHTML, like Gecko) Chrome/28.0.1500.95 Safari/537.17';\npage.onResourceRequested = function(req) {\n  current_requests += 1;\n};\npage.onResourceReceived = function(res) {\n  if (res.stage === 'end') {\n    current_requests -= 1;\n    // only start using the debounce_render function after the document has loaded and the scrolling has started\n    if(isPostDocumentLoaded) {\n      debounced_render();\n    }\n  }\n};\npage.onLoadFinished = function(status) {\n  var docHeight = page.evaluate(function() { return document.documentElement.scrollHeight; });\n  stepCountTotal = Math.floor(docHeight / winHeight) + 1;\n  scrollStepInterval = setInterval(scrollStepIntervalFunction, scrollDelay);\n};\npage.open(url, function(status) {\n  if (status !== 'success') {\n    console.log('Error with page ' + url);\n    phantom.exit();\n  }\n});\nfunction debounced_render() {\n  clearTimeout(last_request_timeout);\n  clearTimeout(final_timeout);\n// If there's no more ongoing resource requests, wait for 1 second before\n  // rendering, just in case the page kicks off another request\n  if (current_requests < 1) {\n      clearTimeout(final_timeout);\n      last_request_timeout = setTimeout(function() {\n          console.log('Snapping ' + url + ' at width ' + view_port_width);\n          page.render(image_name);\n          phantom.exit();\n      }, 2000);\n  }\n// Sometimes, straggling requests never make it back, in which\n  // case, timeout after 5 seconds and render the page anyway\n  final_timeout = setTimeout(function() {\n    console.log('Snapping ' + url + ' at width ' + view_port_width);\n    page.render(image_name);\n    phantom.exit();\n  }, 4000);\n}\n. Thank you so much your ideas. I just learnt how much we can manipulate the snap.js. \n. Thank you :). You guys are really helpful. Will try it out. I hope you got to see my comments for issue #118. \n. For wraith compare_images config_name what should be the parameters in config file. where should we mention the path of the images? Can you please provide me a sample?\n. Thank you! I could successfully compare screenshots. And I am surprised there were multiple files like 320_ , 600_ etc. And it compared the respective files. Was it designed to work this way?\n. ",
    "donovanh": "Yes, running the normal capture command fails in the same way, after the cropping stage.\n. Sure, these are the images being captured:\n\nConfig:\n```\nHeadless browser option\nbrowser:\n  webkit: \"phantomjs\"\n  # gecko: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory:\n  - 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  english: \"http://www.live.bbc.co.uk/news\"\n  russian: \"http://www.live.bbc.co.uk/russian\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 320\n  - 600\n  - 768\n  - 1024\n  - 1280\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\n  uk_index: /uk\nIf you don't want to name the paths explicitly you can use a yaml\ncollection as follows, and names will be derived by replacing / with _\n\npaths:\n- /imghp\n- /maps\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n  - 10\n```\n. Thank you, that works. Never occurred to me to test other urls!\n. ",
    "kkusalavan": "Error with page https://www.abc.com\nFailed to capture image. ",
    "javiercejudo": "Ah, nice, thanks! Closing this.\n. ",
    "runningrhetoric": "Thanks! \n. ",
    "bbttxu": "d0d2fa55e6273e591587b778a0be15f9e31febdf\nAdd a basic date and time stamp to the gallery HTML template.\n. ",
    "pmuir": "Added parentheses.\n. Will update this on top of the changes I made in #152\n. Ok, this is now rewritten on top of #152\n. @DaveBlooman Once you merge #152 I will rebase this commit and push, and you can see what this one does in isolation...\n. @DaveBlooman ok, this one is updated now.\n. Agreed, I was really trying to not disturb the existing architecture too much with this change :-)\n. @DaveBlooman Ok, rewrote spider.rb to allow for multiple methods of spidering. Currently we have the Anemone crawler and the sitemap.xml ones. Let me know if you like this approach, or if you prefer some other way.\n. @DaveBlooman I don't think that is a problem. In my rewrite I'm outputting the result of the \"spider\" to spider.txt, whether you do the \"spider\" by crawling the site using anemone, or by reading the sitemap.xml. By treating the crawl or the sitemap.xml as equivalent in spider.rb, I didn't have to touch the rest of the code.\n. I'm happy to create a pull request for this change, but it will require a bit of reworking of the way things work today, only copying the screenshots to the output dir if the diff is showing >0%, and deleting shots with no changes.\n. To explain a bit more why I need to be able to isolate the failures and only copy that part of the gallery it may help to understand my use case.\nWe intend to run wraith around 5-20 times a day (each time someone submits a change request), and use it to help people understand the unintended consequences of their change. \nI just took a look at the current output from wraith when run against our site, and it's 673mb - if we copy that 5-20 times daily, we are looking at transferring between 3 and 13GB (admittedly this reduces a bit because as we gzip the files before rsyncing them) of data daily from our CI environment (in one data center, in this case located in Singapore), to our web staging environment (in another data center, in this case located in Phoenix). This is obviously not possible from a cost, or time, perspective ;-)\nSo, for this to be useful for me, I need to be able to easily isolate only the failure data, and copy that over.\nAn idea based on @DaveBlooman's comment is to create a failures directory that only contains the failed shots, and leaves the shots directory alone. This could be enabled using a flag in the config.\n. Yes, I can definitely fork wraith and add this, or overlay some extra code, but I was hoping to contribute it back to the upstream :-)\n. Agreed on it feeling wrong to have the unchanged diffs in the gallery class.\nThe approach I took relies on the \"assembly\" on the data in the gallery class (the bits which generated the nested maps of files). I can see two options:\n1) Just extract that removal code in to another class, but still call it from gallery.\n2) Adjust the lifecycle so there is an additional \"analysis\" phase, which does the assembly of the data, sorts it if needed, and performs the deletion.\n(1) is obviously easy. (2) is more of a change, not least as it will require some sort of intermediate data storage format to move from the analysis phase to the render phase.\nAny thoughts?\n. BTW I can add some changes to gh-pages for you.\n. Ok, I have implemented option 1, please check the updated commits.\n. ",
    "nickschuch": "I have also run into this issue, due to the fact Im running my phatomjs binary out of a \"bin\" directory in my project.\n. @JakeChampion I will take it for a spin today!\n. ",
    "klamping": "Sure thing. I test against a local environment, so it won't work locally w/o setting it up.\n```\nHeadless browser option\nbrowser:\n  webkit: \"phantomjs\"\n  # gecko: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory:\n  - 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  local: \"http://localhost:9001\"\n  live: \"http://rackerlabs.github.io/encore-ui\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 1024\nIf you don't want to name the paths explicitly you can use a yaml\ncollection as follows, and names will be derived by replacing / with _\npaths:\n - '/#/overview'\n - '/#/component/configs'\n - '/#/component/hotkeys'\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n  - 10\n```\n. It's an ugly hack, but this code in gallery_template.erb works:\n<a href=\"<%=file[:filename].sub! '#', '%23'%>\">\n    <img class=\"short-screenshot img-thumbnail\" src=\"<%=path%><%=file[:thumb].sub! '#', '%23'%>\">\n</a>\nHave to do the same thing for the thumbnails as well. Unfortunately I don't know enough Ruby to have a better solution just yet (trying to figure out where in the gallery.rb file this would fit).\n. Okay, just realized there is a much simpler solution/workaround to this issue, and that is to name the urls to be validated:\npaths:\n  home: '/#/overview'\n  configs: '/#/component/configs'\n  hotkeys: '/#/component/hotkeys'\nDoing that solves the problem. Feel free to close this issue if you'd like.\n. ",
    "yfloch": "I confirm it works.\nThank You Dave.\nWraith is very helpfull !\n. Finally it works. I know that this trace can occur when the snap file path is incorrect.\n. ",
    "maleghast": "@DaveBlooman Could you review please?\n. @JakeChampion That's a question for @DaveBlooman at this point, as I am just learning my way around Wraith and can't answer that ;-)\n. @DaveBlooman Please can you confirm my changes and merge..?\n. ",
    "boonet": "@JakeChampion I will give it a try and see how it goes. Thanks \n. @JakeChampion : This is still not fixed. I am using Ruby 2.1.3\n. ",
    "vinodmadhav": "Any solution for this issue? I am facing the process.form issue. i am using ruby 2.0.0p648 (2015-12-16) [x64-mingw32]\n\nCROPPING IMAGES\nProcess.fork is not supported by this Ruby\nCOMPARING IMAGES\nProcess.fork is not supported by this Ruby\nComparing shots/contact/1024_phantomjs_current.png and shots/contact/1024_phanto\nmjs_new.png\n. Do you have any solution or work around to this problem? I m stuck!! \n. @kunfoo3 , Thanks. how did you get this issue fixed? Imagemagic reinstall? \n. 1.9 did the magic for me too. Thanks!! \nbut now i am stuck with \"Error Cannot find module javascript/disable_javascript--ph antom.js\" and the execution is stuck at this error. doesn't move forward. \n- Phantomjs 1.9.2\n- ruby 2.0.0p481 (2014-05-08) [i386-mingw32]\nhere is the error from command\nphantomjs://bootstrap.js:289\nphantomjs://bootstrap.js:254 in require\nC:/Ruby200/lib/ruby/gems/2.0.0/gems/wraith-3.1.0/lib/wraith/javascript/phantom\njs:103 in runSetupJavaScriptThen\nC:/Ruby200/lib/ruby/gems/2.0.0/gems/wraith-3.1.0/lib/wraith/javascript/phantom\njs:87 in markPageAsLoaded\nC:/Ruby200/lib/ruby/gems/2.0.0/gems/wraith-3.1.0/lib/wraith/javascript/phantom\njs:81 in checkStatusOfAssets\n. So, i am not the only one chasing this issue. i have been breaking my head to figure out thi s one for the past 3 days. i get \"Error: Cannot find module 'C:/wraith/C:/wraith/javascript/disable_javascript--phantom.js'\" \n. I am stuck at the same before_capture #369 issue, so i decided to try the above suggestion by removing before_capture. \nMy results are the same as what @dave81 mentioned above. image folder structure will be created, folders initial screenshots, thumbnails contains no images and the gallery showing differences will not be created.\nCommand line seems to get stuck at the last snapping task. \n. ",
    "ChrisBAshton": "@vinodmadhav please open a new issue (when you open the issue, there are instructions for including some useful debug information). Thanks\n. We recommend using PhantomJS 2+. If upgrading Phantom does not work, please open a new issue.\nThanks\n. There is an outstanding issue (#296) where diff images can't be generated if the two images are different dimensions.\nGenerally speaking this issue can be avoided by first running the crop_images task, to ensure images are cropped to the same dimensions before they are diffed.\nLet me know if you're still having issues.\n. I once had a snap file which wasn't doing what I expected - it was snapping the right dimension images but it wasn't resizing the browser. Big pages with lots of white background (e.g. this GitHub page on a desktop screen!) meant lots of blank images. So perhaps this was an issue to do with your snap file?\nThe snap files are now abstracted away in Wraith 3.0, so that users no longer have to worry about maintaining them. Could you try again with the latest version of Wraith (removing snap_file from your config) and raise a new issue if you're still having problems. Thanks\n. Wraith is not currently compatible with PhantomJS 2. I've updated the docs to show this.\nhttp://bbc-news.github.io/wraith/os-install.html\nThanks\n. Could be fixed in #302 :)\n. We have added the links below the thumbnails, and we have the diff highlighting. The only other thing is the sticky navigation, which is tricky if you have lots of paths or only a short viewport. It sounds as though you want the sticky behaviour because you want to be able to view all diffs without having to scroll - something which can now be achieved by opting to use the 'slideshow' template.\nyaml\ngallery:\n  template: 'slideshow_template'\nThanks again for the UI suggestions. Not sure if there's much value in keeping this issue open though.\nIf more work is required, I would welcome you to open a PR with any proposed changes, or perhaps even a new gallery template. We currently have two different gallery templates, visible in https://github.com/BBC-News/wraith/tree/master/lib/wraith/gallery_template. It is quite simple to add more templates here.\n. Hi @jonkemp can you confirm if upgrading to Wraith v2.7.0 fixes this?\n. Hi, @jonkemp (and @seanhamlin, if you're using the same configs...):\nCan you confirm that you have this directory history_dir: \"shots_history/qa2_mobile\", and that it contains something like:\n/home/\n/home/1024_phantomjs_base.png\n/shows/\n/shows/1024_phantomjs_base.png\n...etc, for EVERY path in your YAML config\nIf a single subdirectory or image is missing, this error is thrown. I've raised an issue to improve this: #304.\n. Also please confirm you are running wraith latest (and that you initially ran wraith history to generate the base screenshots.\nIf you are running wraith capture, that is incompatible with your current config (requires two domains) and could lead to an error such as this.\n. I strongly suspect this was down to running wraith capture but only specifying one domain. I've raised an issue (#340) which will perform some checks before letting users run commands, to give more helpful error messages than the one you've seen.\n. Hi @JakobP, thanks for your PR - we've made significant changes to the snap files since you opened this PR. Phantom/Casper snap files should now be able to cope with static width pages (they'll just clip a smaller proportion of the page).\n. Hi, thanks for the PR. I've manually verified that your fix appears to work - great stuff! Would you consider writing an automated test for this so that we're protected against future changes to the codebase?\n``` ruby\n  describe \"Wraith gallery generator\" do\n    let(:gallery) { Wraith::GalleryGenerator.new(config_name, false) }\nit \"should not break when there is a `-` in the filename\" do\n  dirs = gallery.parse_directories 'spec/thumbnails'\n  puts dirs.inspect\n  # hopefully this can get you started!\nend\n\nend\n```\n. Hi all - apologies for the delay. We've been reorganising ourselves internally and should now be in a position to provide better ongoing Wraith support.\nI plan to set aside some time to look at (and merge!) this next week. Thanks for adding the test, @adouglas.\n. Thanks @adouglas - a variation of this fix (and test) was merged in #300 and published as Wraith v2.7.0.\n. Are you saying that you have some diff.png/diff.txt files already (from an earlier run), and when you run Wraith it isn't able to overwrite those files - and thus always reports a failure (because it always uses the values in the original diff.png/diff.txt files)?\nThe traditional use for running wraith (e.g. wraith latest /  wraith capture) does automatically clear the shots directory (and therefore all the diff files). But it makes sense to clear the diffs before running compare_images. Is that what you're requesting? That would fix your problem, right?\n. Closing issue due to lack of response, plus actually writing the code in to remove the diff.png/txt files is an unnecessary complication if this is such an edge case.\n. NB: this is also pretty useful for sending custom headers with each request! Example code:\njavascript\nmodule.exports = function (casper) {\n    // load the page with the correct header overrides\n    casper.open(casper.page.url, {\n        method: 'get',\n        headers: {\n            \"data_override\":      \"https://some-data-override-service.bbc.co.uk\"\n        }\n    });\n}\n(A better way of sending additional headers should be baked into Wraith, but this is a halfway decent hack for the time being. Having the beforeCapture hook gives a lot of freedom.)\n. Updated docs: http://bbc-news.github.io/wraith/index.html#beforeCapturehooks\nAlso pushed to Rubygems.\n. Spidering has been overhauled in Wraith v4. Please re-open if this is still an issue.. Sounds like you're installing on Linux. Did you look at the Ubuntu pre-requisites? You need to install the pre-requisites before running gem install wraith.\nClosing the issue, as you managed to get Wraith installed. But we'll gladly accept PRs for better documentation, if that is what was required here.\n. Thanks for raising the issue. I've now refactored the example configs: https://github.com/BBC-News/wraith/commit/5f16645748e6c272c82e5500509cb79c7ba7d752\n. Thanks for the PR, David, but we won't be merging this as it adds a lot of code and is quite an edge-case. A similar thing can be achieved outside of Wraith by writing a script which uses MongoDB to generate the spider.txt file which you can refer to from your Wraith config.\n. Not sure this is still an issue.\n. Done in 4f3cf6cab5c1e4d5f9887df13e6a1fc3bf8f553d\n(Courtesy of http://www.favicon-generator.org/)\n. @ToniStella this could be any number of things.\nEither phantomjs isn't installed properly (can you run phantomjs -v and paste the output here), or Wraith isn't working properly on Windows (in which case, this is a legitimate issue, but you may want to try running Wraith in Docker in the meantime).\n. Thanks for your PR. This seems fair. It will be in the next Wraith gem release.\n. You can run Wraith in history mode: http://bbc-news.github.io/wraith/index.html#HistoryMode\nRun wraith history to generate your screenshots before a deployment, then wraith latest to generate and compare after a deployment.\n. Thanks for reporting the issue. This is a duplicate of #283\n. At time of writing, the thumbnails look different as well as being different sizes:\n\nThe diff command is failing - you'll find that there is no diff.png and there should be. I've run into this issue myself on CI, and it's something to do with ImageMagick not being properly installed. Hopefully that can help you?\nI agree, Wraith should be throwing an error if the diff image is not being generated properly! So will keep this issue open.\n. I now believe this was a PhantomJS issue, and may be related to this waitFor function never returning true: https://github.com/BBC-News/wraith/commit/afa232f03c09f857a6b958dd7fde3ac10f0ebee1#diff-605a7e8fcc91f25c078396c8bf825c95R39\n(e.g. if an image failed to download for some reason).\nI've not had the issue since I started running Wraith in Docker. Cannot reproduce - so closing the issue.\n. Hi - first of all I see a typo:\nsh -c \"casperjs\" \"\" \"javascript/casper.js\" \"https://foo.internal.dev\" \n\"1024\" \"shots/home/1024_phantomjs_dev.png\" \" \" \"javascript/gobal.js\" \"false\"\nShould be global.js.\nSecondly, here is an example module which works with the beforeCapture hook:\njavascript\nmodule.exports = function (casper) {\n    casper.wait(2000, function() {\n        casper.click('.ns-panel__hotspot--2');\n    });\n}\nSo in theory this should work (i.e. without the checkPage wrapping block):\njavascript\nmodule.exports = function (casper) {\n      casper.test.assertUrlMatch('signin', 'Login Page');\n      casper.test.assertExists('form#login', 'Login Page Form has been found');\n}\nHope that helps!\n. @factologist @nehafish there is an unofficial way of passing arguments to the command line:\nyaml\nphantomjs_options: --ssl-protocol=tlsv1\n(I only recently discovered this myself! See https://github.com/BBC-News/wraith/issues/308#issuecomment-162674478)\nCan't guarantee it will carry on working - we may refactor this in future - but for now, this should help you.\n. Not sure why I didn't close this before. No longer an issue.\nHave raised #363 to rename/refactor/document the PhantomJS options property.\n. \n. Hi @marciovicente, neat idea! What's the most useful feedback we can give to the developer? I think something like this:\nFailures detected:\n    buttons failed at a resolution of 320 (4.14% diff)\n    buttons failed at a resolution of 624x768 (30% diff)\nSteps:\n1. Add ':' to end of 'Failures detected'\n2. Add a few spaces before listing out the failed item\n3. This also needs to support cases where the height has been set manually (see the second failure in my example above)\n4. Put the % diff in brackets after the message\n5. The red color is nice but I think \\e[31m is Unix-only. We have to try to support Linux, OSX and Windows, so I'd be inclined to remove it.\nDo you think you could tweak your PR to do this? That would be great!\n. Hacky fix - use the beforeCapture hook as follows (adds a 1px colored pixel to the content):\n``` javascript\nmodule.exports = function (casper) {\n    casper.wait(1000);\n    casper.evaluate(function () {\n        var clickableGuide = document.querySelector('.ns-panel--interactive'),\n            newDiv = document.createElement('div');\n    if (clickableGuide) {\n        clickableGuide.appendChild(newDiv);\n        newDiv.style.position = 'absolute';\n        newDiv.style.top      = '0';\n        newDiv.style.right    = '0';\n        newDiv.style.display  = 'block';\n        newDiv.style.width    = '1px';\n        newDiv.style.height   = '1px';\n        newDiv.style['background-color'] = 'red';\n    }\n});\n\n}\n```\nConfirmed fix.\n. Actually, we should just be able to comment out any paths we temporarily want to ignore. Have raised an issue for this: #304.\n. @ryandowd this looks really promising! Could you fix the conflicts, and also remove 'wraith-2.6.0.gem' from the PR?\nI also suggest a tweak to your config additions - the new gallery becomes the default, but (optionally) you can customise your theme through the YAML file like this:\nyaml\ngallery:\n  - thumb_width:   200\n  - thumb_height: 400\n  - template:         '/path/to/your/template.erb'\nThanks\n. This is a duplicate of #293.\n. Fixed in 3.0\n. Wraith is expecting the before_capture file to be in the form of a module, i.e.:\njavascript\nmodule.exports = function (browserEngine) {\n    console.log('testing');\n}\nCan you try that and see if it still pauses the process?\n. This should now be fixed in Wraith 3.0.1.\n. Hi @renettarenula - there is no phantomjs_options property in Wraith, so whatever you put there in your config file is not going to be passed to the PhantomJS command line.\nIt would have to be something we add to a future version of Wraith. Just to confirm (after a bit of looking around), it looks like the following extra command line options would be useful:\n--ignore-ssl-errors=true\n--ssl-protocol=tlsv1\nWe could perhaps add this to a future version of Wraith as follows:\nyaml\nignore_ssl_errors: true # false by default\nssl_protocol: 'tlsv1' # 'SSLv3' by default. Change as per http://phantomjs.org/api/command-line.html\nThese options would apply to both PhantomJS and CasperJS. More investigation required to see if this would also be of benefit to SlimerJS.\n. @peruukki it appears you're right! Thanks for saying. I'll make a note to add this to the documentation.\n. Hi @renettarenula I believe this is down to a buggy example config.\nFor wraith capture two base URLs need to be provided, as that runs a site-by-site comparison.\nFor history mode, you should be able to run wraith history then wraith latest.\nI'm working on a new release today which should hopefully give a correct example config.\n. We've now released v2.8.0. :)\nYou can use spider.yaml as a basis for running wraith capture against (it has two domains specified - but you may have to change these to real domains).\nThe other two examples should be run in history mode.\nI'll be working on improving the documentation for the next couple of hours, and will bear this in mind when I rewrite it.\nThanks\n. Moving to #330. Going to merge all into one develop branch.\n. Completed in release 3.1.0\n. Hi @msafta, do you have a phantom--nojs.js somewhere in your project? Perhaps try moving your javascript folder inside your configs folder.\nThis issue should go away when we've implemented #305, which abstracts the JS files away so that you don't have to worry about them.\n. With the release of Wraith 3.0.0, the snap files have been abstracted away and you should no longer have to maintain them yourselves.\nIn addition, I've updated the docs to warn against using PhantomJS 2 with Wraith for the time being.\n. Hmm, this isn't an easy fix. These dimensions are passed to Phantom/Casper before it loads the page - so the height is unreliable. Not to mention that the height might change at runtime, or after you do something with the before_capture hook.\nI think what you'll want to do is put this in your YAML config:\nbefore_capture: javascript/resizeHeight.js\nAnd make a resizeHeight.js file something along the lines of:\nmodule.exports = function (phantom) {\n    phantom.viewportSize.height = document.body.offsetHeight;\n    phantom.open(phantom.page.url);\n}\n. I hear you - it would definitely be great to fix this.\nReopening the issue by popular demand, will try to look at this more closely in the coming weeks. In the meantime, pull requests are welcome!\nWraith v3.1.1 has more resilient image cropping, so should cope with dynamic heights much better, so hopefully this issue can be fixed more easily now.\n. Implemented in 3.0\n. Realistically this is a bit of an edge case and unlikely to get completed anytime soon.\n. Doesn't look like a Wraith issue to me, sorry - CasperJS / PhantomJS are installed independently of Wraith. If running casperjs --version or phantomjs --version gives you errors, there's an issue with your setup.\n. The latest versions should be fine. Personally I have Phantom 1.9.8 and Casper 1.0.0, if that helps. Best of luck!\n. Applied in Wraith v4! https://github.com/BBC-News/wraith/pull/486. How strange! Thanks for finding this. You're right, there appear to be some hidden characters messing up the formatting.\n\nI'll fix this in the next release.\n. :+1: I'll tag it onto wraith --verbose in #313.\n. Completed in release 3.1.0\n. Spidering has been overhauled in Wraith v4. Please re-open if this is still an issue.. Hi @abioneperhobby,\nYou can run Wraith in two main modes:\n- capture requires two domains (there's only one in the component.yaml file). Comparison of two domains.\n- history, followed by latest. Comparison of one domain over time.\nEither add a second domain to your config, or switch to history/latest mode.\nPlease close if that solves your issue. Thanks\n. Please re-open if that didn't answer your question.\n. No longer valid. The changes this would require under the hood are too unclean (we're already passing too many arguments to the command line than is advised for maintainability!) and this can be easily accomplished using the beforeCapture hook.\nI've added some clear examples for achieving this, which can be retrieved by running wraith setup: https://github.com/BBC-News/wraith/commit/b0f1aaee13d8162bdc59c4170ada6ba5c7ba7fb7\n. Completed in release 3.1.0\n. I suspect this was down to using 'diffs_only' again - if there are no diffs, an empty gallery will be generated.\nThat said, there was some buggy behaviour in Wraith's use of Phantom (#352), which should be fixed in the next release.\n. Thanks\n. Thanks for your PR - the reason we won't merge this is that the template shouldn't have that logic in it - files[:data] should never be nil. Wraith ought to have more robust code/validation in the controller before it ever gets to the template.\nWe've released a few versions of Wraith since you opened this PR, so hopefully this has already been fixed indirectly.\n. Completed in release 3.1.0\n. Thanks for your PR. However, it should no longer be required since the release of Wraith v4.. @Gribnif, @DecipherOne can you raise new issues for those?\nThe \"Error generating gallery\" is the same error message, but it looks like the underlying cause is different.\nThanks\n. Sounds like there's still an issue here - will reopen for the time being but please raise new issues in the meantime.\n. Thanks @laubsauger. I'll look into fixing this early next week.\n. Spidering has been overhauled in Wraith v4. Please re-open if this is still an issue.. This is the same issue as #352, so I'll close this one but keep the older one open. Please keep an eye on the discussion in there.\nThanks\n. You should assume the window has already loaded when the before_capture hook is called. Also, the hook needs to be in the form of a module, something along the lines of:\njavascript\nmodule.exports = function (browserEngine) {\n    browserEngine.evaluate(function () {\n        window.localStorage.clear();\n    });\n}\n. Hi @darshan-dave, could you tell me:\n- your operating system (Linux, Windows..?)\n- the Wraith command you're using (latest, capture..?)\n- also please paste the contents of the YAML config file you're using\n. Thanks @darshan-dave - I suspect this is down to Windows not understanding the pwd command. I've tagged this as a bug.\n. Hi @darshan-dave - thanks for letting us know! :)\n. Hi @stephen-richards - thanks for this. I'm reluctant to pass even more command line parameters to Phantom/Casper, it's already quite tricky to maintain. Besides, a similar timeout can be achieved using the before_capture hook, e.g.\nyaml\nbefore_capture: javascript/wait_a_few_seconds.js\njavascript\n// wait_a_few_seconds.js\nmodule.exports = function (phantom, ready) {\n    // make Wraith wait a bit longer before taking the screenshot\n    setTimeout(ready, 3000); // you MUST call the ready() callback for Wraith to continue\n}\n(Please note, this example is as of Wraith 3.1, which will happen when #361 is merged).\nHowever, I do like the idea of being able to configure the number of threads Wraith uses! Please consider editing your PR.\n. Hi @meowris I can see your config doesn't pass the YAML validator:\n\nWe had a similar issue about a month ago.\nPlease clean up the config and try again. Thanks\n. Going to annotate the code to help whoever code reviews this.\n. Thanks Dave, very thorough. Will have a look tomorrow. Merry Christmas yourself :)\n. No question is a silly question! Yes this property is passed to both engines. Which is why I've raised an issue to rename it (phantomjs_options is misleading).\n. Looks good :+1: \n. This looks like a duplicate of #295 or #308.\nYou may need to add this to your config:\nyaml\nphantomjs_options: --ssl-protocol=tlsv1\nAlso, I assume you meant https://www rather than https:\\www\n. Hi @dave81 - can you tell us what command you are running?\nAlso, please add verbose: true to your config, try running your command, then copy and paste the contents here.\n(Wrap it in three backticks (`) before posting here and it will be formatted nicely - I've done that to your comment above. Thanks)\n. Thanks @dave81  - it does look like there is a problem determining the absolute path to the before_capture file when using windows.\nCan you try without the before_capture hook and let me know if it runs?\n. Hopefully this has been fixed since v3.1.1 (Windows filepath calculation fixes).\nPlease reopen if there is still an issue as of v3.1.8 (latest release at time of writing). Thanks\n. Thanks!\n. Fixed in v3.2.0\n. Spidering has been overhauled in Wraith v4. Please re-open if this is still an issue.. Closed for reasons outlined in #383.\n. This is beyond the scope of Wraith.\nI suggest you use the before_capture hook to change the user agent header with your request, then on your website you check the header and only download Google Analytics if the header is not 'wraith', e.g.\n``` javascript\nmodule.exports = function (casper, ready) {\n    // load the page with the correct header overrides\n    casper.open(casper.page.url, {\n        method: 'get',\n        headers: {\n            \"X_USER_AGENT\":    \"wraith\"\n        }\n    });\nready();\n\n}\n``\n. Closed for [reasons outlined in #383](https://github.com/BBC-News/wraith/issues/383#issuecomment-179748161).\n. It looks like you installed [node-wraith](https://github.com/jamesryanbell/node-wraith), which is a wrapper for Wraith that is not maintained by our team. Use it at your own risk. Otherwise, I highly recommendgem install wraith` to use our gem directly. You're also using an outdated version of Wraith (we're currently on v3.1, and you say you're using 2.0.2).\nNB, it looks like node-wraith isn't supported on OSX/Linux, so I would not expect it to work on Ubuntu.\nI'm going to close your other issues on the assumption that they too were created as a result of using node-wraith on Linux and an outdated version of Wraith. Please reopen if that's not the case.\n. Closed for reasons outlined in #383.\n. Unable to reproduce. I created a config file called config.yaml:\n```\ndomains:\n  english: \"https://[user]:[password]@[domain].com\"\npaths:\n  home: \"\"\n  blog: \"about-sfmta/blog\"\n  blogPost: \"about-sfmta/blog/east-meets-west-view\"\nfuzz: '10%'\nthreshold: 5\nscreen_widths:\n  - 320\n  - 480\n  - 481\n  - 768\n  - 769\n  - 980\n  - 981\n  - 1199\n  - 1200\n  - 1680\nbrowser:\n  phantomjs: '/home/[user]/Documents/regression/sfmta-wraith-configs/javascript/casper.js'\nsnap_file: '/home/[user]/Documents/regression/sfmta-wraith-configs/javascript/casper.js'\nhistory_dir: '/home/[user]/Visual tests/shots-history'\ndirectory: '/home/[user]/Visual tests/shots'\ngallery:\n  template: 'slideshow_template'\n  thumb_width: 200\n  thumb_height: 200\n```\n...and ran wraith validate config.yaml, output was \"Config validated. No serious issues found.\" Are you sure you're using the latest version of Wraith?\n. To help us debug, can you paste the contents of your YAML file here?\n. Superseded by #393\n. Hi @sumaoang, could you paste the contents of your YAML file inside backticks as per GitHub markdown so we can see the contents properly formatted? It's very difficult to debug otherwise.\nCould you also add verbose: true to your config file, and then just run wraith validate configs/config.yaml and copy and paste the output (again, ideally in backticks) so we can help diagnose the issue.\nThanks\n. Thanks, can you paste the output of wraith validate configs/config.yaml (not wraith capture).\nAlso, copy and paste your YAML into http://codebeautify.org/yaml-validator and see if it validates. It looks like you've got an extra ' character at the beginning where you shouldn't, but that may just be how you copied and pasted it here.\n. Thanks for keeping us informed. Nevertheless, you should have had a more helpful error message than the one you had! I'll make a mental note to double check that Wraith produces a proper error message if it cannot find the config file.\n. Thanks for the PR, I wonder if this could work with wraith --version like other programs?\ni.e.\n```\n$ phantomjs version\nCan't open 'version'\n$ phantomjs -version\nError: Unknown option: e\n$ phantomjs --version\n1.9.7\n```\nI agree Wraith should have a version command, just not sure wraith version is the 'standard' way of invoking it :)\n. Fantastic!\nIt would also be really helpful if you could make a PR to the gh-pages branch so that the new command is described in http://bbc-news.github.io/wraith/#Commandlineoptions. If not, I'll get around to it eventually!\nThanks once again.\n. This error has been fixed in 3.2.1:\n'spider': undefined local variable or method 'wraith' for # (NameError)\nHowever, I can see that the original error in this issue is:\ncore.rb:298:in =~': type mismatch: String given (TypeError)\nThis issue has been closed in error. Re-opening.\n. Smashing, thanks!\n. Hmm, good question!\nYou could accomplish this with a file-level before_capture hook:\n```\nbefore_capture: 'javascript/headers.js'\ndomains:\n  prod:\n    current:  \"http://www.mydomain.com\"\n  failover: \n    new:      \"http://www.otherdomain.com\"\n```\nAnd a hook something like this:\n// headers.js\nmodule.exports = function (casper, ready) {\n    if (casper.page.url === 'http://www.otherdomain.com') {\n            // load the page with the correct header overrides\n            casper.thenOpen(casper.page.url, {\n                method: 'get',\n                headers: {\n                    \"X_USER_AGENT\":          \"cucumber\",\n                    \"X_PAGE_FRAME_OVERRIDE\": \"responsive\"\n                }\n            });\n            ready();\n    }\n}\nDoes that solve your problem?\n. Looks like you managed to fix this as you opened #405. Please reopen if that's not the case.\n. Someone had a similar issue not long ago:\nhttps://github.com/BBC-News/wraith/issues/398#issuecomment-191877407\nIn their case it was because they misspelled the filename passed to the Wraith command. Can you make sure a directory called configs exists, and inside that directory a file called config.yaml exists?\nWraith shouldn't be throwing this error though, it should give a proper error message, we'll definitely want to fix this in the next release.\n. Fantastic, @katekligman - you're right, newer versions of ImageMagick appear to fix the issue. Thanks!\n. Difficult to debug without seeing a screenshot - can you attach one here?\n. Please reopen when you have more information. Thanks\n. As of Wraith v3, the snap file is now abstracted away inside Wraith. What you want to do with cookies can be achieved using the before_capture property:\nhttp://bbc-news.github.io/wraith/#beforeCapturehooks\n. Hmm, thanks for this. We solved a similar issue with adding/removing paths: #293. I don't think we've ever changed the screen sizes after the initial choice so have not run into this before, but yes, Wraith ought to be able to cope with this!\n. http://bbc-news.github.io/wraith/#beforeCapturehooks\ne.g. http://bbc-news.github.io/wraith/#CasperJSbefore_capturemodule\n. Well spotted - we merged the version work but didn't publish a new gem. Now fixed in v3.1.3. Thanks\n. Hi Charles,\nThis is down to your YAML formatting. (You have two spaces before browser: and also you're missing the gallery property which template, thumb_width and thumb_height should be sub-properties of).\nUse http://codebeautify.org/yaml-validator to validate your YAML and try again. I got it working by doing this:\n``` yaml\nbrowser: 'phantomjs'\ndomains:\n  current: \"https://www.sfmta.com\"\npaths:\n  home: /\nscreen_widths:\n  - 320\n  - 600x768\n  - 768\n  - 1024\n  - 1280\nresize_or_reload: 'resize'\nhistory_dir: 'shots_base'\ndirectory: 'shots'\nfuzz: '20%'\nthreshold: 5\ngallery:\n  template: 'slideshow_template' # Examples: 'basic_template' (default), 'slideshow_template'\n  thumb_width:  200\n  thumb_height: 200\nmode: alphanumeric\nverbose: true\nhighlight_color: red\nphantomjs_options: ''\n```\n. Please reopen if closed in error. Thanks\n. Hi @daffers \nFirst issue - the missing images - this sounds like Wraith is taking pictures before all the assets have downloaded (this is especially likely if images are added in afterwards at runtime using JavaScript). To make Wraith wait before taking images, use the before_capture hook to wait for a few seconds before capturing - an example is available here: http://bbc-news.github.io/wraith/#PhantomJSbefore_capturemodule\nSecond issue - cropping - is a known issue (#318) which we hope to fix in a future release. Until then, the fix is to specify a large height to accommodate the page, e.g. 1280x5000.\n. You shouldn't need to sudo, but yes, gem install wraith - then you can wraith -v to see what version you're running.\n. Fixed in v3.1.5\n. I suspect you're running an old version of Wraith. This should have been fixed in v3.1.1\n(gem install wraith to update)\nPlease reopen if you still have an issue. Thanks\n. Please work through the following checklist to help us debug. Thanks.\n- [ ] The command I ran when I saw the issue was: paste command here\n- [ ] I have validated my config file against YAML Validator to make sure it is valid YAML.\n- [ ] I have pasted the contents of my config file below:\npaste config here\n- [ ] I have run the command in verbose mode (by adding verbose: true to my config) and pasted the results below:\npaste results here\n. Thanks. I can't see anything wrong with your config. Can you confirm whether javascriptwait--phantom.js lives inside configs or if it lives in the directory above that, or somewhere else entirely?\nIn the meantime, you might want to try specifying an absolute path to the snap file to see if that solves your issue, e.g.\nC:/github.com/org/prod/wraith/javascriptwait--phantom.js\n(At time of writing, the drive name must be a capital letter).\n. Doesn't basic_template do this for you? http://bbc-news.github.io/wraith/#Gallery&Output\n. That's the slideshow template, not the basic one. Change your config like this:\nyaml\ngallery:\n  template: 'basic_template'\n. Duplicate of #401. Thanks for the detailed config and output information though.\n. Thanks for raising this, @mfdj - the code looks good, we just need to find time to reproduce issue 423, and check that your fix works. Hope to do this soon.\n. Great stuff, thanks for spotting this.\n. Hi @johnsyweb - sorry for the slow reply on this.\nAre you sure this is what you're intending? Merging this PR will install newer versions of Nokogiri up-to-and-NOT-including 1.7.0 (according to http://guides.rubygems.org/patterns/ - \"Had we said ~> 2.2.0, that would have been equivalent to ['>= 2.2.0', '< 2.3.0'].\")\nEDIT: Looking more closely at the linked issue, you're looking at Nokogiri version gem 'nokogiri', '1.6.7.2' so this PR should be sufficient.\nHappy to merge \ud83d\udc4d \n. Hi @daffers,\nWhich version of Phantom are you using? And what is the CSS being applied to the tag?\nPhantomJS (and particularly older versions of PhantomJS) uses quite an old rendering engine that doesn't necessarily support modern browser features (so if this is an SVG or base-64 encoded background image, for instance, Phantom might fail to render it).\nSome of my colleagues prefer SlimerJS because it seems to be better at rendering more modern CSS, but Wraith does not support it out of the box (feel free to +1 issue #364 if you'd like to request that we provided dedicated support for it).\n. As of v3.2.0, Wraith now works with newer versions of Phantom and Casper - try updating to the latest versions of these and see if that solves your issue. Thanks\n. Please work through the following checklist to help us debug. Thanks.\n- [ ] The command I ran when I saw the issue was: paste command here\n- [ ] I have validated my config file against YAML Validator to make sure it is valid YAML.\n- [ ] I have pasted the contents of my config file below:\npaste config here\n- [ ] I have run the command in verbose mode (by adding verbose: true to my config) and pasted the results below:\npaste results here\n. Please reopen when you have this information. Thanks\n. Hi @jjpmann, thanks for the PR. What was your use case for this? It might be better to make an improvement to one of the default templates rather than rely on people creating their own. In any case, we'd need a test to accompany this feature - please reopen if you want to add a test. Thanks\n. This is almost identical to #405 (though the exact error message for that issue is no implicit conversion of String into Integer (TypeError) rather than your message of can't convert String into Integer (TypeError) - probably because you're using ruby version 1.9.1, and the person in the other issue is using ruby version 2.3.0.\nCan you check if any of the fixes in #405 work for you?\n. Fixed in https://github.com/BBC-News/wraith/releases/tag/v3.1.7\n. Fantastic, thanks.\n. Thanks for the feedback @micros123 , that's really useful. To help debug this, could you add verbose: true to your config, run your command and paste the output here?\n. Interesting idea... so what you're trying to avoid having is config1.yml and config2.yml where the properties are identical apart from the domains property.\nThis will be possible if/when we implement #324 - have a read of the proposed API there.\nYou'd basically have dev.yml, local.yml and a common.yml which the first two YAML files import, saving you duplicating stuff.\n. Hi @theguythatrepeatedit it looks like when you passed -verbose as a command line parameter, it didn't actually run it in verbose mode (verbose mode should tell me what version of Ruby, Phantom, Wraith you have, etc).\nCan you try adding verbose: true to your yml file and then paste the output of your command here?\nThanks\n. Does XXX:/Ruby22/lib/ruby/gems/2.2.0/gems/wraith-3.2.0/lib/wraith/javascript/phantom.js definitely exist? \nIf you run more XXX:/Ruby22/lib/ruby/gems/2.2.0/gems/wraith-3.2.0/lib/wraith/javascript/phantom.js you should see output like this: https://github.com/BBC-News/wraith/blob/master/lib/wraith/javascript/phantom.js\nIf more doesn't give you the file contents, it probably can't find the file. Let's just check that first.\n. Could you raise a new issue please, @SimonKeep ?\nThere are some instructions in the 'New Issue' screen for giving us some useful debug information.\nThanks\n. Are you trying to take screenshots of http://develop.example.com? Because that doesn't exist, and will give an error.\nPlease reopen if this is not the case.\n. It looks like Phantom isn't running properly. To determine if this is the case, try running one of those commands you can see in debug mode, i.e.\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js' 'http://www.facebook.com/' '320' 'shots/home/320_phantomjs_current.png' 'body' 'F:/wrth/javascript/disable_javascript--phantom.js' 'false'\n. I know other Wraith users who run it on Windows, we've not seen this problem before. The quotes shouldn't affect it - and are needed in case you run in resize mode (in which case, width would be '320,624,1024', say... so inside the quotes, that's treated as one argument. Without quotes, it might be treated as several).\nI'm also confused as to why you need to double backslash the snapfile path!\n. Moving issue to #489.. Thanks @SimonKeep, this looks similar to #441, it looks like PhantomJS 2+ doesn't like apostrophes in the command line.\nThis is a bug but I can't promise we'll be able to fix it anytime soon! Pull request fixes are welcome.\n. Moving issue to #489.. @SimonKeep provides a good way of doing this in his comment (thanks, Simon!), but leaves out one detail, which I'll fill in now.\nThis kind of thing will vary for every user, so unfortunately we can't do any more than provide general guidance. Though Simon's code is a good starting point, the contents of your file will have to be tweaked according to your needs. E.g. the ID of your username/password fields will be different. Also if you don't have jQuery in the page you'll have to rewrite in vanilla JS.\nHis approach will work if your login script redirects you to the page you want to test - but assuming your login script always redirects you to, say, /dashboard, then you'd never be able to take screenshots of other 'logged in' pages, e.g. /settings.\nTake this example YAML file:\n``` yaml\npaths:\n  'dashboard': '/dashboard'\n  'account': '/account'\n  'settings': '/settings'\nbefore_capture: 'js/login.js'\n```\nIn the before_capture script we need to log the user in as per Simon's approach, but then we need to redirect to the original requested page so we take a screenshot of the right page. Here is a Casper example:\n``` js\nmodule.exports = function (casper, ready) {\n    casper.open('/login.php');\ncasper.evaluate(function () {\n    // write your JS which fills in your login form and submits it here   \n});\n\n// at this point we're now at /dashboard - so need to redirect ourselves to the\n// page we wanted to test in the first place, e.g. /settings\ncasper.thenOpen(casper.page.url); // casper.page.url is the URL Wraith originally tried to load (before /login.php)\n\nready();\n\n```\nAlternative approach\nIf you have control over the server-side code of the website you want to test, you could use the before_capture hook to set a custom header - e.g. change your user agent to wraith - then look for that header when a request is made to your server, and mock the login of a test user account when you see that header.\nSo for example, you could visit /settings with your user agent set to wraith, and your server would know to show you the settings page for a user called TestAccount.\n\nHope that's useful! We can't really provide any more specific advice I'm afraid. Good luck with your testing!\n. Thanks @Domi202 - we've merged this and released as part of v3.2.1.\n. This looks like #449 - ImageMagick doesn't appear to be installed.\nStrange that we'd have two bug reports like this in the same day - perhaps ImageMagick have released a version which doesn't have the compare command built in?\nYou say your ImageMagick is this version:\nVersion: ImageMagick 7.0.2-4 Q16 x64 2016-07-11 http://www.imagemagick.org\nWhat do you get if you run convert -version? For reference, I get:\n$ convert -version\nVersion: ImageMagick 6.9.1-3 Q16 x86_64 2015-05-25 http://www.imagemagick.org\nCopyright: Copyright (C) 1999-2015 ImageMagick Studio LLC\nLicense: http://www.imagemagick.org/script/license.php\nFeatures: DPC Modules\nDelegates (built-in): bzlib freetype jng jpeg ltdl lzma png zlib\n. Closing this issue - keeping track of it in #459 instead.. The issue is this bit: DEBUG:   ImageMagick:        ImageMagick not installed\nYou need to install ImageMagick for Wraith to work: http://bbc-news.github.io/wraith/os-install.html\n. The issue is this bit:\nyaml\npaths: \n   home:\n    Retailer: /find-a-retailer\n    selector: '.tab.retailer>a'\nRetailer should be path. And, presumably, home should be Retailer! (Since you're testing the retailer page, not the home page)\n. You need to separate it out into separate paths, i.e.:\nyaml\npaths: \n   Retailer:\n    path: /find-a-retailer\n    selector: '.tab.retailer>a'\n   HomeHeader:\n    path: /\n    selector: '#header'\n   HomeFooter:\n    path: /\n    selector: '#footer'\n. Can you confirm you are still using:\nyaml\nmode: diffs_first\nand not\nyaml\nmode: diffs_only\n...as diffs_only won't show any output if there are no diffs.\nWhat files have been generated in Retailers_CSS_Selector_shots?\n. Ahh interesting - perhaps it's to do with camel case?\nBecause I presume your config is actually:\nyaml\npaths: \n   Retailer:\n    path: /find-a-retailer\n    selector: '.tab.retailer>a'\n   HomeHeader:\n    path: /\n    selector: '#header'\n   HomeFooter:\n    path: /\n    selector: '#footer'\n...in which case, there shouldn't be a Home folder - there should be a HomeHeader and a HomeFooter folder. Can you confirm this is your YAML above?\nYou may also want to try renaming to:\nyaml\npaths: \n   Retailer:\n    path: /find-a-retailer\n    selector: '.tab.retailer>a'\n   home_header:\n    path: /\n    selector: '#header'\n   home_footer:\n    path: /\n    selector: '#footer'\n. What happens if you change the selector?\npaths: \n   home_header:\n    path: /\n    selector: 'body'\nIf that works, then the problem is with the hash in the selector.\n. Ok, so we've established that, for you at least, the # id selector doesn't seem to be compatible with Wraith and Casper.\nThis could be a quirk on your setup, or it could be a problem in Wraith. I'll update the Issue title to reflect this.\nIn the meantime, you can try to target the header/footer in a slightly different way (not using IDs), e.g. div:first-child span or whatever the markup of the page is.\n. Glad to hear it resolves your issue, @rayferns  - but I'll keep the issue open, because Wraith should be able to cope with hashes in selectors!\n. You have two before_capture hooks in one YAML file - there should only be one\n``` yaml\nbefore_capture: 'javascript/wait--casper.js'\nbefore_capture: 'javascript/disable_javascript_and_cookies--casperjs'\n```\nRegardless, you'd have to find a casper command which disables cookies (I'm not sure this exists, so consider switching to Phantom, where it does exist).\nThese links are relevant:\n- https://github.com/casperjs/casperjs/issues/355\n- https://github.com/casperjs/casperjs/issues/843\nGood luck!\n. Where are you getting RemoveSelectors and HideSelectors from? Is it in the docs?\nAs far as I know, this isn't a feature!\n. Thanks @SimonKeep.\nYes, the docs are at http://bbc-news.github.io/wraith/#before_capturehooks. Good luck!\n. That's right - Wraith can only currently cope with 1 domain (in History/Latest mode) or 2 domains (in Capture mode). There are no plans to introduce further domain support. If you need 3 domains to be identical to each other, you can run 1 Wraith batch between environments a) and b), then another Wraith batch between environments a) and c). In theory, b) and c) should match if a)/b) and a)/c) match.. Duplicate of #308.. @Qlczas it sounds as though 'Unsafe JavaScript attempt to access frame' isn't necessarily the issue here -  your last line of copied output is Snapping http://onet.pl/ at: 600x768, so what happened then - does the program just hang, or does it go on to generate a gallery?\nFYI, I've copied it locally and it works for me too - though I had to comment out the before_capture hook because I didn't have the disable-javascript file, but it did end up creating a gallery. Maybe try disabling the before_capture hook and see if you still have the issue? \nIf it helps, my output is below:\n\n\n\nOutput from my machine\n\n\n$ wraith capture conf.yml \nDEBUG: #################################################\nDEBUG:   Command run:        capture conf.yml\nDEBUG:   Wraith version:     3.2.1\nDEBUG:   Ruby version:       ruby 2.2.1p85 (2015-02-26 revision 49769) [x86_64-darwin14]\n\nDEBUG:   ImageMagick:        Version: ImageMagick 6.9.1-9 Q16 x86_64 2015-07-19 http://www.imagemagick.org\n\nDEBUG:   PhantomJS version:  2.1.1\n\nDEBUG:   CasperJS version:   Couldn't find nor compute phantom.casperPath, exiting.\n\nDEBUG: #################################################\nDEBUG: \nConfig validated. No serious issues found.\nCreating Folders\nSAVING IMAGES\nDEBUG: phantomjs  '/Users/ashtoc03/.rvm/gems/ruby-2.2.1/gems/wraith-3.2.1/lib/wraith/javascript/phantom.js' 'http://www.onet.pl/' '600x768' 'shots/home/600x768_phantomjs_current.png' 'body' 'false' 'false'\nDEBUG: phantomjs  '/Users/ashtoc03/.rvm/gems/ruby-2.2.1/gems/wraith-3.2.1/lib/wraith/javascript/phantom.js' 'http://onet.pl/' '600x768' 'shots/home/600x768_phantomjs_new.png' 'body' 'false' 'false'\nDEBUG: phantomjs  '/Users/ashtoc03/.rvm/gems/ruby-2.2.1/gems/wraith-3.2.1/lib/wraith/javascript/phantom.js' 'http://www.onet.pl/' '1024' 'shots/home/1024_phantomjs_current.png' 'body' 'false' 'false'\nDEBUG: phantomjs  '/Users/ashtoc03/.rvm/gems/ruby-2.2.1/gems/wraith-3.2.1/lib/wraith/javascript/phantom.js' 'http://onet.pl/' '1024' 'shots/home/1024_phantomjs_new.png' 'body' 'false' 'false'\nLoading http://onet.pl/ at dimensions: 600x768\n\nLoading http://onet.pl/ at dimensions: 1024x1500\n\nLoading http://www.onet.pl/ at dimensions: 1024x1500\n\nLoading http://www.onet.pl/ at dimensions: 600x768\n\nSnapping http://www.onet.pl/ at: 600x768\n\nSnapping http://www.onet.pl/ at: 1024x1500\n\nSnapping http://onet.pl/ at: 1024x1500\n\nSnapping http://onet.pl/ at: 600x768\n\nCROPPING IMAGES\nDEBUG: Both images are exactly 600x768 - no cropping required. (shots/home/600x768_phantomjs_current.png, shots/home/600x768_phantomjs_new.png)\nDEBUG: Both images are exactly 1024x1500 - no cropping required. (shots/home/1024_phantomjs_current.png, shots/home/1024_phantomjs_new.png)\nCOMPARING IMAGES\nComparing shots/home/1024_phantomjs_current.png and shots/home/1024_phantomjs_new.png\nComparing shots/home/600x768_phantomjs_current.png and shots/home/600x768_phantomjs_new.png\nSaved diff\nSaved diff\nGENERATING THUMBNAILS\nGENERATING GALLERY\nGallery generated\nWARN: Failures detected:\nWARN:    home failed at a resolution of 600 (18.04% diff)\nWARN:    home failed at a resolution of 1024 (54.3% diff)\n\nView the gallery in your browser:\n     file:///Users/ashtoc03/Downloads/shots/gallery.html\n\n. This is quite possibly down to #489 - Wraith's attempt at getting PhantomJS and Windows playing nicely together needs a little bit of work!\nRE:\n\nI can't run my config with \"verbose: true\" :/ it's not starting at all\n\nIf you upgrade to Wraith v4 you can now run wraith info - could you do that and paste the contents here?. Ok, great.. You'll have to raise the issue with the wraith-selenium project. Very little of your YAML config applies to the core Wraith project itself.\n. v4 of Wraith allows you to 'import' another YML file, which should help you externalize things like environments and paths.\nThere is no plan for JSON config support, but you could write a script which converts your JSON to YML files before triggering Wraith.. PhantomJS 1.9.7 isn't very modern - it doesn't even let you use JavaScript's .bind method - so if your site is quite modern CSS/JS-wise (e.g. using Flexbox, canvas, web components, etc) then Phantom may not render it correctly.\nYou may want to try upgrading to Phantom 2.1.\nAlso, it would be helpful to paste the entire config - for instance, if you've set your domains to be https rather than http then that could also cause problems.\nOther than that, I can confirm that your config seems ok from here, so there's nothing obvious to explain why your pages might not be rendering properly.\n. Hi @Sabbi0612 - I've just tried your config locally and I get the same issue, the screenshots look weird. I'm using a modern version of Phantom 2.1.1.\nYou site uses Flexbox (I had a quick look at your site and there is a CSS rule .two-col-block__inner { flex-basis: 49%; }).\nAfter digging into this in a bit more detail, it appears that there is very limited support for Flexbox even in Phantom 2+. See this discussion.\nThe good news is that they reckon Flexbox will be fully supported in the next major version of PhantomJS.\nUntil then, there isn't really a fix for this. You could try using SlimerJS instead, which is a different rendering engine, but this isn't supported by Wraith out of the box (see #364) so you'd have to write your own snap file, etc.\n. I believe Wraith already has what you're looking for (as a config option):\n\u200b#Choose how results are displayed, by default alphanumeric. Different screen widths are always grouped.\u200b\n\u200b#alphanumeric - all paths (with, and without, a difference) are shown, sorted by path\u200b\n\u200b#diffs_first - all paths (with, and without, a difference) are shown, sorted by difference size (largest first)\u200b\n\u200b#diffs_only - only paths with a difference are shown, sorted by difference size (largest first)\u200b\nmode: diffs_first\nSounds like you want diffs_only.\n. Thanks for the PR @Dahie - but it is already possible to do this with Wraith, see instructions here:\nhttps://github.com/BBC-News/wraith/issues/446#issuecomment-241659809\nYou would apply something along the lines of:\n``` js\nmodule.exports = function (casper, ready) {\n    var CURRENT_URL = casper.page.url;\ncasper.open('/login.php');\ncasper.evaluate(function () {\n    // write your JS which fills in your login form and submits it here   \n});\n\n// at this point we're now at /dashboard - so need to redirect ourselves to the\n// page we wanted to test in the first place, e.g. /settings\ncasper.thenOpen(CURRENT_URL);\n\nready();\n\n});\n```\n. Ahhh, I didn't realise you had a server-side redirect before the page loads. I don't think Wraith can handle that yet.\nWe will definitely consider merging this PR! Probably ought to write a guide in the GitHub Pages docs too, as login-only pages seem to be a fairly common requirement.\n. There is an open feature request (#324) which would allow YAML files to import the contents of other YAML files (which could pull in a 'standard_config.yml' file, for instance) which should answer your question. It's on our list, but no guarantee on when this will be done - pull requests are welcome!\n3) if you could narrow it down and simplify a config as much as possible so that it reproduces the problem, please file a bug ticket.\nThanks\n. Hi Sean,\nThis has been requested a few times - often enough that we are now considering writing a short guide on how this can be done using before_capture scripts.\nI've raised an issue to update the documentation: #469 \nUntil that's done, the most detailed answer you'll find is probably this one:\nhttps://github.com/BBC-News/wraith/issues/446#issuecomment-241659809\nHope this helps!\n. Debugging on CI is a nightmare when there are different versions of everything running.\nWe strongly recommend running Wraith inside Docker if you're planning on running the same tests on multiple machines (including CI):\nhttp://bbc-news.github.io/wraith/os-install.html#RunwithDocker\nFor what it's worth, with regards to your specific setup on Travis, your debug info looks fine, no alarm bells there. I don't think ImageMagick is your issue - the ImageMagick phase isn't even being reached here, it's Phantom which is in charge of taking those initial screenshots.\nYour version of Phantom is identical, except Travis will be a Linux build of Phantom and yours is an OSX one. This may or may not be the issue. We've had similar problems in the past because Travis has been unable to access internal URLs we are testing... could it be that?\nAnyway, try moving to Docker. Once it's working locally, it should work fine on Travis too. \n. Closing old issue.. 1) looks like you're having certificate problems in your terminal. If you try gem install rspec or any other gem you're likely to have the same issue. This could be down to proxy settings on your machine, or any number of reasons. I would try and fix this soon, as it's bound to cause other problems for you eventually!\n2) Installing the gem locally from GitHub is possible, you'll have to gem build wraith.gemspec to create the gem locally, then gem install wraith from within the same directory and it will install the locally compiled gem. You should then be able to run wraith setup from wherever.\nGood luck.\n. Spidering has been overhauled in Wraith v4. Please re-open if this is still an issue.. Spidering has been overhauled in Wraith v4. Please re-open if this is still an issue.. Spidering has been overhauled in Wraith v4. Please re-open if this is still an issue.. Thanks for raising this issue - it is a duplicate of #444, and can hopefully be fixed for the time being by downgrading to PhantomJS 1.9.\n. Not yet. We're logging the full issue in #318.\n. Good spot - thanks!\n. Thanks @vfonic . Thanks for your PR. However, it should no longer be required since the release of Wraith v4.. Imports introduced in Wraith v4.. That's a fair comment - I agree. Had a rethink after publishing v4, should have gone more explicit, i.e.\nyaml\nspider_file: 'spider_paths.yml'\nWould be less stateful and easier to maintain. PRs are welcome!. HTTPS is a known issue. Please see #308 for details. Sorry we are not able to provide a fix at the moment.. Thanks.. Please see issue #469, which links to a detailed answer on testing pages behind login.. Wraith should be able to cope with this, so let's keep the issue open.. That is because wraith.domains is undefined (https://github.com/BBC-News/wraith/blob/master/lib/wraith/gallery.rb#L63)\nIf your YAML file does look like this, then domains is indeed undefined, because the # comments it out.\n```yaml\n(required) The domains to take screenshots of.\ndomains:\ndev: \"http://dev.upf.sites.capitalnumbers.com\"\nlive: \"https://theupsstorefranchise.com\"\n```\nTry removing the # from your config, i.e.\n```yaml\n(required) The domains to take screenshots of.\ndomains:\n  dev: \"http://dev.upf.sites.capitalnumbers.com\"\n  live: \"https://theupsstorefranchise.com\"\n```\n(and do the same everywhere else you have a # commenting a property out.. I'm not sure how those filenames are getting generated?\nHome_1Dec-win8.1-ie-11.0.png\nHome_2Dec-win8.1-ie-11.0.png\nHome_1Dec-win8.1-ie-11.diff\nHome_1Dec-win8.1-ie-11.data\nWraith only supports Phantom and Casper out of the box, so I'd expect to see Home_1Dec-phantom.png, for example. How did you get it using IE 11?\nI think the problem stems from the . in win8.1.. If you're naming them manually, try using filenames without . and - in them.. This should now be fixed in v4.0.1.. Hmm, I was going to say wraith [your command] > log.txt, but because of the way Wraith works, nothing gets piped through to the file. Good spot!\nNot sure if there is currently a way of accomplishing what you want to do.. This is a known issue - please see #489.\nCurrent workaround is to use a version of Phantom below 2.. Does this not give you what you need?\nhttp://bbc-news.github.io/wraith/#before_capturehooks\n(The before_capture: \"javascript/config-level.js\"\u200b bit, which is run at the beginning of every path).. Thanks for bringing that to my attention, @ThomasWunderlich - I have hopefully fixed the build in #505. Could you merge master into your branch so that the tests are run against this PR again?. Thanks - your fix looks good, I think we intended to pass the imports_must_resolve boolean as part of v4.0.0 and it never made it in.\nWill merge and release as 4.0.1.. Hmm, we have:\nyaml\n\u200b#Choose how results are displayed, by default alphanumeric. Different screen widths are always grouped.\u200b\n\u200b#alphanumeric - all paths (with, and without, a difference) are shown, sorted by path\u200b\n\u200b#diffs_first - all paths (with, and without, a difference) are shown, sorted by difference size (largest first)\u200b\n\u200b#diffs_only - only paths with a difference are shown, sorted by difference size (largest first)\u200b\nmode: diffs_first\nSounds like you would like a diffs_above_threshold option for mode. This isn't implemented yet, but we would be happy to review a PR!. Code looks good - does this work in the \"lightbox\" mode too? (If not, could it be made to?)\nSee #329. Thanks for taking the time to raise an issue. This is a duplicate of #507.\n. This should now be fixed in v4.2.3.. Thanks. Thanks for your comments. This does happen occasionally - someone else has logged the issue here: #508\nPlease keep an eye on that issue rather than create a new one.. \nPhantom is not very good at rendering anything too \"complex\" or modern. If Phantom can't render it, Wraith can't screenshot it. (Similar issue: #462)\nFor example, looking at this in IE9, I can see a console error saying web audio API is unsupported.\nTo know exactly what's failing for your project, try implementing a progressive enhancement approach so that you deliver some decent core content by default, and then replace it with the web audio stuff if the browser supports those features. (If the screenshot takes screenshots of your core content rather than the full fat experience, you know Phantom was not able to render the full experience)\nThis is a Phantom issue rather than a Wraith issue.. Hi @anandshirkande  - this is a known issue - Wraith does not work with ImageMagick v7 (see #459).\nPlease downgrade to ImageMagick v6 to get it working with Wraith.. Thanks for the PR. This has now been released in v4.2.3.. It depends how the lazy loading is implemented. Is it lazy loaded based on user's scroll position? Phantom/Casper will not scroll until you tell it to, so the content would never get loaded.\nIt sounds as though you need a before_capture JS file in which you interact with the page a little before you attempt to take any screenshots.. Fixed in v4.2.2.. Thanks very much for the PR - I've published this today as v4.2.2.. Thanks for the PR. This has now been released in v4.2.3.. Duplicates #568. Thanks for the PR. This has now been released in v4.2.3.. We want to catch custom errors (e.g. MissingRequiredPropertyError) and just display the error message nicely. System errors (unexpected ones) should throw a full stack trace.\n. These methods were here already. I've moved them inside the no_commands block because they shouldn't be called directly by the user.\n. This, however, is a new user command, used to verify the basic validity of the config file. One can also pass the mode to the validate method, e.g. 'history', for additional mode-specific validation.\n. Moved this method up a bit to make the code read from top to bottom.\n. This file is extracted from what was an embedded class in save_images.rb\n. To make our code more testable, I'm trying to get Wraith to raise named exceptions rather than a generic abort. These exceptions are encapsulated here.\n. This file is extracted from what was an embedded class in save_images.rb\n. Yes, the global $wraith feels a bit unclean. This is set from within Wraith::Wraith constructor. It was the easiest way of checking the current Wraith instance.\n. Command-line dimensions in resize mode are now \"320,464,624\" rather than \"'320','464','624'\" - the extra quotes weren't necessary.\n. I've removed the __common file (which was referenced by phantom.js and phantom--nojs.js). If users want to disable JavaScript, they're now encouraged to do so through the before_capture file.\n. Wraith doesn't support SlimerJS anymore (in truth, it hasn't for several releases now) - the result of increasing abstraction and encapsulation.\nWe should raise an issue on GitHub to implement SlimerJS support (only needs to be done in a few places) if the issue gets enough +1s.\n. removed this from the helpers file as it is only specifically used by one of the test suites and references variables defined inside that test suite.\n. This file is essentially the same as the 'main' casper.js file, but without the reference to the _helper.js module (which Casper can struggle to find).\nFor backwards compatibility reasons, people can still use their own snap file if they wish, so this file is required for testing that.\n. Also, for clarity I'd refer to these as 'overridden' values rather than 'non-standard' (which suggests Strings instead of ints, or non-ASCII characters or something)\n. Never invoked in user land.\n. I felt it needed to be explicit, otherwise it looks like we're calling a method to capture the page image. Will remove the return but rename the variable more clearly.\n. That would just output the command as a string, wouldn't it? We want to run it.\n. :+1: \n. :+1: \n. :+1: \n. :+1: \n. We can remove this line if you're making an attr\n. Ah, true.\n. I would change this to logger.info Wraith::VERSION just to keep this consistent with the rest of the codebase (and not sure the \"Wraith version\" bit is necessary, other programs just output their version numbers).\n. Shouldn't this be command?\n. ",
    "tgoswami013": "@JakeChampion \nCould you please let me know. Which fields need to edited in parallel.rb and wraith.gemspec.\nIn wraith.gemspec already   spec.add_runtime_dependency 'parallel' is selected. I am still gettting the same error.. ",
    "danielcrisp": "Would have been useful to have a single file to parse though... is there a way to make it optional? \nI'm trying to integrate this into an automated build / test process\n. Amazing, thanks Dave\n. ",
    "pa-ve": "Hi Dave,\nDoes wraith supports getting the difference report in csv format ?? We need to have report stating which pages have difference.. HI Guys,\nIs there a way to get the difference output in csv file (like for which paths, the pages differ).\nThanks. ",
    "Matthew-Kirk": "@DaveBlooman This latest change does away with any attempt to overlay a pattern onto the extra space and instead just fills it in with bright fuchsia. The rationale is that currently the extra space shows up as white/grey which will can be confusing for sites that are mostly white/grey (i.e. most sites) whereas making the extra space fuchsia will only be confusing for Geocities-era sites.\n. ",
    "MarkMhn": "Second this.\nOne approach to this could be to have the latest task mop up any files in the shots directory which contain 'data', 'diff' and 'new' in their filename.\nThere could be some complications with that though, e.g. how would wraith handle cases where the first set of images are modified by the second scrape (i.e. when images are cropped to enforce matching dimensions)?\nAnother approach could be to have the latest task create a copy of the shots directory and work from that, so that successive calls have a fresh state to work from each time. Old copies would be trashed each time to keep disk usage under control.\n. Hey @JakeChampion. We were editing snap.js to modify cookies and request headers, both of which I imagine would be easy enough to make configurable as we're just talking about passing arrays in. The file was being passed to PhantomJS.\n. @JakeChampion That seems sensible to me, I'm on board. Was there any discussion around its closure before?\n. ",
    "pgchamberlin": ":-)\n. Looking good @DaveBlooman :-)\n. ",
    "chrisgedrim": "Awesome. I'm 99.9% certain that I'd run setup folders before anything else..\n. ",
    "aman4you": "After some snapshot, snapping process stop. there is no error message in cmd prompt\n. When snapping process not completing than i have to use ctrl + c command for try again.\n. Thanks for reply. I tried the above code but still snapping process not finishing. I think may be these problem occur because of parallel execution of snapshot. How to take one snapshot at one time.\n. yes, imagemagick is installed. \nIf i run command \"wraith capture config\" for some url's like 3 and at screen width like 1024 then snapping process is completing. If i increase the number of url's like 10 and at screen width like 1024, 600 and 300 then snapping process is not completing.\n. ",
    "nimishsinghal": "Hi,\nEven I am facing this issue Error: Cannot find module '../javascript/disable_javascript--phantom.js'. My version of PhantomJS is 2.1.7, I tried using 1.9.2 but support is not there for this version.. ",
    "jcmartinez": "Same issue here.\nIt only finishes the job when I have one screen resolution. If I configure more than one resolution, it freezes at the end. \nI enabled \"verbose: true\" and I don't see feedback of anything breaking; however, it apparently freezes right before showing the \"CROPPING IMAGES\" message.. ",
    "entendu": "@DaveBlooman could you help me understand how #189 solves this?\n. ",
    "lsolesen": "```\nHeadless browser option\nbrowser:\n  phantomjs: \"phantomjs\"\n  snap_file: \"javascript/snap.js\"\n directory: 'shots'\ndomains:\n  dev: \"http://anvil-first.codio.io:3000/\"\n  prod: \"http://vih.dk\"\nscreen_widths:\n  - 320\n  - 1024\n  - 1280\npaths:\n  home: /\nfuzz: '20%'\nspider_days:\n  - 10\n```\n. That solved it. Thanks.\n. ",
    "kunfoo3": "I had the same issue. The cause was that the ImageMagic installer doesn't install some utilities like compare.exe by default. Need to check the corresponding option during installation.\n. ",
    "ssteigen": "I reinstalled Imagemagick, checking all the boxes for the optional components, and that fixed the issue for me.. If you're using phantomjs you can get full-page screenshots by commenting out a few lines in lib/wraith/javascript/phantom.js\n```\ndiff --git a/lib/wraith/javascript/phantom.js b/lib/wraith/javascript/phantom.js\nindex 78f1a89..9332b86 100644\n--- a/lib/wraith/javascript/phantom.js\n+++ b/lib/wraith/javascript/phantom.js\n@@ -132,12 +132,12 @@ function resizeAndCaptureImage() {\nfunction takeScreenshot() {\n   console.log('Snapping ' + url + ' at: ' + currentDimensions.viewportWidth + 'x' + currentDimensions.viewportHeight);\n-  page.clipRect = {\n-    top: 0,\n-    left: 0,\n-    height: currentDimensions.viewportHeight,\n-    width: currentDimensions.viewportWidth\n-  };\n+  // page.clipRect = {\n+  //   top: 0,\n+  //   left: 0,\n+  //   height: currentDimensions.viewportHeight,\n+  //   width: currentDimensions.viewportWidth\n+  // };\n   page.render(image_name);\n }\n```\nI think this is the solution pointed out by @rithipooh in https://github.com/BBC-News/wraith/issues/318#issuecomment-282342193.. I'm also having this issue.\nI'm using:\n- Windows 7\n- Wraith v. 4.0.1\n- Phantomjs v. 1.9.8\nI think my output is the same, but in case it helps, here it is:\n\n[x] I have validated my config file against YAML Validator to make sure it is valid YAML.\n[x] I have run the wraith info command and pasted the output below:\n\nInvalid drive specification.\nC:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.1/lib/wraith/helpers/utilities.rb:56:in `run_command_safely': undefined method `chomp' for nil:NilClass (NoMethodError)\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.1/lib/wraith/helpers/utilities.rb:37:in `list_debug_information'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.1/lib/wraith/cli.rb:169:in `info'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/command.rb:27:in `run'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/invocation.rb:126:in `invoke_command'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor.rb:359:in `dispatch'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/base.rb:440:in `start'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.1/bin/wraith:5:in `<top (required)>'\n        from C:/Ruby23-x64/bin/wraith:23:in `load'\n        from C:/Ruby23-x64/bin/wraith:23:in `<main>'\n\n[x] I have run the command in verbose mode (by adding verbose: true to my config) and pasted the output below:\n\nInvalid drive specification.\nC:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.1/lib/wraith/helpers/utilities.rb:56:in `run_command_safely': undefined method `chomp' for nil:NilClass (NoMethodError)\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.1/lib/wraith/helpers/utilities.rb:37:in `list_debug_information'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.1/lib/wraith/validate.rb:14:in `validate'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.1/lib/wraith/cli.rb:145:in `block in history'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.1/lib/wraith/helpers/utilities.rb:4:in `within_acceptable_limits'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.1/lib/wraith/cli.rb:144:in `history'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/command.rb:27:in `run'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/invocation.rb:126:in `invoke_command'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor.rb:359:in `dispatch'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/base.rb:440:in `start'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.1/bin/wraith:5:in `<top (required)>'\n        from C:/Ruby23-x64/bin/wraith:23:in `load'\n        from C:/Ruby23-x64/bin/wraith:23:in `<main>'\n\n[x] I have pasted the contents of my config file below:\n\n```\nbrowser: \"phantomjs\"\ndomains:\n  mypath: \"https://www.google.com/\"\npaths:\n  home: /\nbefore_capture: 'javascript/wait--phantom.js'\nscreen_widths:\n  - 360\n  - 480\n  - 768\n  - 992\n  - 1200\nresize_or_reload: 'resize'\nhistory_dir: 'shots_base'\ndirectory: 'shots'\nfuzz: '20%'\nthreshold: 5\ngallery:\n  template: 'slideshow_template' # Examples: 'basic_template' (default), 'slideshow_template'\n  thumb_width:  200\n  thumb_height: 200\nmode: diffs_first\nverbose: true\nhighlight_color: red\nphantomjs_options: ''\n``. If I setverbose: false, I am able to executewraith history configs\\history.yaml`\nI guess there's a problem in the code that prints the debug info?. ",
    "patricknelson": "I'm having the same problem on Windows w/ ruby 2.4.4p296 (also with the parallel gem installed). Reinstalled the installer (ImageMagick-7.0.8-12-Q16-x64-dll.exe) and still have this message. \n@dblooman - When you say it's because of the parallel gem, do you happen to recall anymore specific details as to why? Thanks.. Following up since I posted here a few days ago.\nSo, yes it looks like the error emanates from the parallel gem, but I think it's more of an issue with the fact that Process.fork just isn't supported in Windows (reference). I've read on StackOverflow that you could potentially get Process.fork to work on Windows using Cygwin, but I couldn't get it to work in the time I had to test it out.. Not only that, but this documentation page (which links here) should probably be updated to reflect the Chrome support. \nI was just researching this while thinking about picking up this tool, but I was considering long term support now that PhantomJS/CasperJS are both now officially dead. It would make sense to rewrite the codebase and migrate the documentation to reflect this new shift. Maybe add a new issue or update this one to reflect going full-on with Slimer + Selenium Webdriver? \nWhile this has a great feature set, without full support for a working and actively maintained browser backend, it\u2019s not as enticing to pick it up as a new user. Currently I can\u2019t tell offhand from the docs how to set this up using Selenium Webdriver (without using a 4yr old fork of the repo, implemented now in #541?)\nEDIT: Also, related (for reference): #521. There's another situation where exactly the same error comes up (regarding crop.rb): If you're performing a latest against a history that happened to have a different list of paths. In my case, I had a sort of complicated setup (which was also CPU intensive) that made it tough to track down:\n\nCheckout master\nRun front-end & back-end builds\nRun wraith history config.yml \nCheckout feature-branch\nRun front-end & back-end builds\nRun wraith history config.yml  <-- \ud83d\udca3\ud83d\udca5\n\nIrritating that it'd die on that last step with no explanation for why until I went through all 54 directories (yeah, I have that many VQA regression tests \ud83d\ude04) and found the one that was missing. I keep my config.yml file checked into git, so since that differed, wraith was exploding. \n. Was there ever any intention to support multiple files and/or importing at depth?\nI found this implementation to be helpful but very limiting beyond very basic configurations. That is: You can only import one file. Period. You can't just import one file per YAML file; just one file. So, you can't chain multiple files together to better abstract the config and you cannot list multiple files to import and merge together (would be preferred).\nTo me this suggests that:\n- When another YAML config is imported, you have to just override values (instead of having any sort of complicated nested merging strategy, which I understand).\n- Importing therefore cannot be recursive (also requiring more logic to prevent infinite recursion). . How stable is this? @shmargum do you think it\u2019s worth gathering up some of your knowledge thus far and writing up documentation for gh-pages to reflect setup and config of this feature now? That way the world can more easily know about the new path forward, since PhantomJS/CasperJS are practically dead \ud83d\udc80 \nI actually started in the docs, which made no mention of the modernized Chromedriver support and ended up in #364 but found that some of this work has now been done in this PR. I\u2019m not a ruby dev myself either, but I\u2019d be potentially interested in picking this up, especially if it were to have Windows and/or Linux support at some point in the future (if not already).. @shmargum\n\nI can try to add some docs for the gh pages, not sure where to do that though.\n\nYou can do that by doing a pull request against the gh-pages branch (which is the basis for the site at http://bbc-news.github.io/wraith/).\np.s. I'm actually hacking this into my own VQA regression testing workflow right now. Curious: Do you know where to start if I wanted to find a way to add the before_capture hook into this new chrome browser type? Would this be configured somehow in Chromedriver?. Are you running this on WIndows? Posted a comment about this which you may find helpful here: https://github.com/BBC-News/wraith/issues/195#issuecomment-430029699 . This is your issue:\njs\nbefore_capture: 'javascript/wait--chrome.js'\nThe wait--chrome.js file is referencing module, so you're getting a ReferenceError. I don't think it supports this pattern in ChromeDriver (while it was probably supported in PhantomJS, which is now defunct). Unfortunately, the documentation surrounding ChromeDriver support in Wraith is seriously lacking right now. This is literally what I've put into my before_capture JavaScript file \ud83d\ude04 \n```js\n(function() {\n    // This is undocumented, but discovered that there is an \"arguments\" variable where the only argument is a function\n    // which turns out to be executable and is a callback that you can trigger to ensure selenium gets control back.\n    // And, since it's undocumented, I don't yet know what this callback argument is named...\n    const done = arguments[0];\n// ... execute your in-page JavaScript....\n\n// Tell Wraith you're finished.\ndone();\n\n})();\n```\nPersonally I think the abstraction wrapping ChromeDriver should provide more robust support (e.g. module pattern for defining your code) with better documentation. But, for now, hopefully this helps.. ",
    "paracycle": "@DaveBlooman Of course (I should have done that in the first place, actually)\nGiven the following config.yml:\nyaml\n...\ndirectory: 'shots'\nhistory_dir: 'history'\n...\nmode: diffs_first\nIf you execute wraith history config, everything works fine. wraith latest config also works fine, after that.\nHowever, once the shots and history folders are in place, if you want to store a new baseline by executing wraith history config, what happens is that a history/shots folder appears that includes the contents of the shots directory. A subsequent wraith latest config will create new shots (based on old history files) and will error out while building the gallery because there is no path configured for the shots folder inside history. The error happens while sorting the directories by the amount of diffs they have in gallery.rb:99 (that's why the mode is relevant).\nAll other parts of the config seems to be unrelated to this issue. I've tested this with a CasperJS and a PhantomJS based config and multiple paths. To make my tests easier I've only used one screen size, though.\n. @DaveBlooman Did you have a chance to recreate this?\n. Sure I get that. I just wanted to follow up to make sure that it didn't\nfall through the cracks.\n\nHi, been really busy, will be looking at this today, but it looks good.\n. \n",
    "alexreardon": "I have also come across this requirement\n. I have figured out how to get this working.\nAlthough undocumented, it looks like if you define a phantomjs_options string in your config.yaml then wraith will use it: https://github.com/BBC-News/wraith/search?utf8=%E2%9C%93&q=phantomjs_options&type=Code\npahntomjs_options: \"--ignore-ssl-errors=yes\"\nHowever, I ran into an issue where I also needed to pass another flag --ssl-protocol=tlsv1. I found I could not pass multiple options to the current wraith implementation, even if I escaped the whitespace. What I ended up doing was this:\nphantomjs_options: \"--config=configs/phantom.json\"\nAnd provided all of the options I needed in the file:\n{\n  \"ignoreSslErrors\": true,\n  \"sslProtocol\": \"tlsv1\"\n}\n. Yeah it did work. I was showing my solution\nOn Tue, 25 Nov 2014 7:01 pm David Blooman notifications@github.com wrote:\n\nI think just phantomjs_options: --ssl-protocol=tlsv1 in your config\nshould work, could you try that.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/BBC-News/wraith/issues/200#issuecomment-64322565.\n. \n",
    "kristablink": "switching to casperjs from phantom corrected for me. Just in case anyone is still looking\n. ",
    "Yuvaraja-KS": "I also faced this certification problem, and due to that unable to capture the proper screenshot. Now i am able to capture the same by adding the below line in my YAML file.\nphantomjs_options: --ssl-protocol=tlsv1\nThanks for this solution.\n. Please help. I am also looking for image comparison, once I have logged in. If you could provide step by step configuration steps, that would be great.\n. ",
    "JohnAlbin": "\nWe work on a branches, so our master branch is updated regularly, so screenshots become out of date quickly.\n\nOh, I see! So you run wraith history every time something is merged into master and commit those files to master. And to test a feature branch you run wraith latest on refs/pull/*/merge. Right?\nThat workflow makes quite a bit of sense as only the approved images ever get committed to the repo. Nice!\nHowever, how do you ensure that the images that get generated with wraith history are the ones you want to keep? I find that the only way to ensure that the most recently run snap shots are correct is by having a human review the image diffs. In other words, the output of wraith history (by itself) does not give me any way to verify that its images are \"correct\" and should become the new baseline; this is because a network error could have caused some assets to load in the wrong order, or too slowly, or not at all, making the history snapshots (possibly subtly) incorrect, and, frankly, my eyes make really crappy image diffs.\n\nWhat we would want is a wraith reset command that would rename the files and allow you to run wraith latest again. \n\nYep, that does sound like what I would need! But, I'm not sure \"reset\" is accurate description of that action though. \"archive_images\"? \"archive\"? \"archive_latest\"?\nAgain, I'm super new to wraith, so my questions are coming from its unfamiliarity. Thanks for your response!\n. Was this fixed? or \"won't fix\"?\n. ",
    "matiassingers": "@DaveBlooman of course, but the branch is already up-to-date with master - not sure why the Travis CI build failed though.\n. @DaveBlooman do you want me to pull in the overrides branch or?\n. @DaveBlooman saw you did a bunch of changes to master (awesome :tada:) - do you want me to rebase this PR?\n. ping :smile: \n. @DaveBlooman hmm I rebased with changes from master, not sure why it still fails on 1.9.3.\n. @DaveBlooman do you want me to open up a new PR with these changes, or are you not interested in them?\n. Awesome addition :+1: \n. :+1: \nAlso related to #204 \n. ",
    "mikecrittenden": "Beautiful, thanks!\n. ",
    "frontenddeveloping": "Can I add some parameters to config for post request of the page?\nThe parameters must be sended via post-request to page and then page is loaded - make a screenshot. Can I make such case by wraith?\n. @DaveBlooman can u help me?\n. I changed site name to https://m.example.com, but note that I use https protocol. Config file:\n```\nHeadless browser option\nbrowser:\n  phantomjs: \"phantomjs\"\n  # slimerjs: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory: 'shots'\ndomains:\n  \"mobile\" : \"https://m.example.com\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 320\n  - 600\n  - 768\n  - 1024\n  - 1280\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\n  add: /add\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n  - 10\nChoose how results are displayed, by default alphanumeric. Different screen widths are always grouped.\nalphanumeric - all paths (with, and without, a difference) are shown, sorted by path\ndiffs_first - all paths (with, and without, a difference) are shown, sorted by difference size (largest first)\ndiffs_only - only paths with a difference are shown, sorted by difference size (largest first)\nmode: diffs_first\nthreshold: 5\n```\n. Thanks. It works.\n. Thanks!\n. ",
    "usenkanov": "If it helps, thumbnails are not being generated either. But there is no error message for that, the folder is just always empty. \n. I just found out that there was a similar error, which was due to a single domain in config file. I have two domains in my config file. \n. I had two domains in my config file.\n. ",
    "KurtPreston": "@usenkanov were you able to get this working?  I'm encountering the identical problem.\n. ",
    "MohamedBassem": "Nvm, It was a bug in our snap file, Thank you. \n. We have been using Wraith for a while as described in our blog post here : http://blog.trustious.com/css-regression/ . Now we are building our automated build pipeline using jenkins, and the css regression is one step of it. The jenkins master assigns the css regression job to one of its slaves which pulls the wraith image from docker hub and starts the container and then the results gallery can be accessed through a small HTTP server. If you have any further questions please let me know. Your docker image saved us lots of time. Thank you :)\n. That's great, I'll sure give it a try. Where can I find the new image ? The one on docker hub is the one i'm using and it's two months old.\n. ",
    "claytonneal": "Hello.\nMy config is attached.\nAll the baseline screenshots using the HISTORY command look ok\nHeadless browser option\nbrowser:\n  phantomjs: \"phantomjs\"\n  # slimerjs: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap-war.js\"\nType the name of the directory that shots will be stored in\ndirectory: 'shots'\nhistory_dir: 'shots_history'\nAdd only 2 domains, key will act as a label\ndomains:\n  static: \"http://ie1-t-prj-02.sandbox.local/skin/frontend/smartbox_rwd_v1/static\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n- 320\n- 600\n- 768\n- 1024\n- 1280\nType page URL paths below, here are a couple of examples\npaths:\n  home_with_promo: /home.php?page=home\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n- 10\nChoose how results are displayed, by default alphanumeric. Different screen widths are always grouped.\nalphanumeric - all paths (with, and without, a difference) are shown, sorted by path\ndiffs_first - all paths (with, and without, a difference) are shown, sorted by difference size (largest first)\ndiffs_only - only paths with a difference are shown, sorted by difference size (largest first)\nmode: diffs_first\nthreshold: 5\n. I cannot find diff images and the .txt file only contains the word \"invalid\"\n. thanks for all the help!\ni deleted the shots and shots_history directories and started from scratch, its now working\ni guess one of the baseline images wasnt correct\ngood xmas!\n. ",
    "denchev": "Just want to add that this error can occur also if you don't have imagemagick library installed. It is written in the documentation but since I installed wraith following an external article this was not mentioned.\n. ",
    "nickdunn": "Woop! Thank you.\n. ",
    "tugelbend": "This results in \nInvalid values for 'ignore-ssl-errors' option.\nI'm using ruby 1.9.1 on Ubuntu.\n. No error regarding the parameters this time. But the result is the same as not using the phantomjs_options parameters at all. \nFor context: I've got two servers that I want to access through SSL and compare. One uses a self-signed cert. Using one of the phantomjs options make the capturing work for one server respectively. Using none or both as you proposed, no images are captured and the fallback images are shown. \n. ",
    "chipcullen": "Two things:\n1 - First, for the sake of anyone reading this later - to install the phantomjs above, the command is brew install homebrew/versions/phantomjs192 - that's apparently a new thing. Before you do that, you might need to brew uninstall phantomjs.\n2 - @DaveBlooman - I was originally trying to @import url(goolgefonts....), but those fonts still were not rendering. If I did a local file-based @font-face declaration, the font face would render. In you set up, were you using @font-face to declare your fonts? \nThe wrinkle now is that the typeface is there, but weights are not working. So close! Sigh. Perusing the PhantomJS GH issues seems to indicate this is an ongoing problem, and seems to happen randomly. \n. ",
    "AdaRoseCannon": "Imagemagick is installed.\n. ./shots\n\u251c\u2500\u2500 home\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 1024x800_webkit_uat-data.txt\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 1024x800_webkit_uat-diff.png\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 1024x800_webkit_uat-v57.png\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 1024x800_webkit_uat-v58.png\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 400x600_webkit_uat-data.txt\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 400x600_webkit_uat-diff.png\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 400x600_webkit_uat-v57.png\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 400x600_webkit_uat-v58.png\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 600x400_webkit_uat-data.txt\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 600x400_webkit_uat-diff.png\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 600x400_webkit_uat-v57.png\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 600x400_webkit_uat-v58.png\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 800x1024_webkit_uat-data.txt\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 800x1024_webkit_uat-diff.png\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 800x1024_webkit_uat-v57.png\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 800x1024_webkit_uat-v58.png\n\u2514\u2500\u2500 thumbnails\n    \u2514\u2500\u2500 home\n        \u251c\u2500\u2500 1024x800_webkit_uat-diff.png\n        \u251c\u2500\u2500 1024x800_webkit_uat-v57.png\n        \u251c\u2500\u2500 1024x800_webkit_uat-v58.png\n        \u251c\u2500\u2500 400x600_webkit_uat-diff.png\n        \u251c\u2500\u2500 400x600_webkit_uat-v57.png\n        \u251c\u2500\u2500 400x600_webkit_uat-v58.png\n        \u251c\u2500\u2500 600x400_webkit_uat-diff.png\n        \u251c\u2500\u2500 600x400_webkit_uat-v57.png\n        \u251c\u2500\u2500 600x400_webkit_uat-v58.png\n        \u251c\u2500\u2500 800x1024_webkit_uat-diff.png\n        \u251c\u2500\u2500 800x1024_webkit_uat-v57.png\n        \u2514\u2500\u2500 800x1024_webkit_uat-v58.png\n. All of the .txt files contain small numbers like '0.06'\n. wraith capture ./configs/config-uat-simple.yaml\n. ```\nHeadless browser option\nbrowser:\n  webkit: \"phantomjs\"\n  # gecko: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory:\n  - 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  \"uat-v58\": ## Hidden for the bug ticket\n  \"uat-v57\": ## Hidden for the bug ticket\nType screen widths below, for heights separate with an x i.e. widthxheight\nscreen_widths:\n# smallscreen portrait\n- 400x600\n\n# smallscreen landscape\n- 600x400\n\n# largescreen landscape\n- 1024x800\n\n# largescreen portrait\n- 800x1024\n\n# ipad portrait with massive height so we can see the whole of vertical scrolling pages.\n# Because of the hacky way we are passing in dimensions no two sets can share the\n# same width.\n#- 751x4000\n# hd monitor\n#- 1920x1080\n\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\nIf you don't want to name the paths explicitly you can use a yaml\ncollection as follows, and names will be derived by replacing / with _\n\npaths:\n- /imghp\n- /maps\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n  - 10\nphantomjs_options: \"--proxy=localhost:8888\"\n```\n. That was it!! Thank you!!\n. Thanks for the additional info we were doing this already :)\n. ",
    "abhinavguptabsl83": "Hello,\nI am getting below error while running wraith capture configs\\ferodo.co.uk.yaml file . It is throwing error while it is trying to execute gallery .\nI am using Win10 64 bit with a) rubyinstaller-2.4.2-2-x86 b) phantomjs-1.9.7-windows c) ImageMagick-6.9.9-Q16-HDRI \nC:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/gallery.rb:71:in get_path': undefined method[]' for nil:NilClass (NoMethodError)\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/gallery.rb:65:in figure_out_url'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/gallery.rb:53:inmatcher'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/gallery.rb:40:in block (2 levels) in match'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/gallery.rb:38:inforeach'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/gallery.rb:38:in block in match'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/gallery.rb:35:ineach'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/gallery.rb:35:in match'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/gallery.rb:31:inparse_directories'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/gallery.rb:142:in generate_gallery'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/cli.rb:114:inblock in generate_gallery'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/helpers/utilities.rb:4:in within_acceptable_limits'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/cli.rb:111:ingenerate_gallery'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/cli.rb:128:in block in capture'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/helpers/utilities.rb:4:inwithin_acceptable_limits'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/lib/wraith/cli.rb:120:in capture'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/thor-0.20.0/lib/thor/command.rb:27:inrun'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/thor-0.20.0/lib/thor/invocation.rb:126:in invoke_command'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/thor-0.20.0/lib/thor.rb:387:indispatch'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/thor-0.20.0/lib/thor/base.rb:466:in start'\n        from C:/rubyinstaller-2.4.2-2-x86/lib/ruby/gems/2.4.0/gems/wraith-4.0.1/bin/wraith:5:in'\n        from C:/rubyinstaller-2.4.2-2-x86/bin/wraith:23:in load'\n        from C:/rubyinstaller-2.4.2-2-x86/bin/wraith:23:in'\n. ",
    "chris-dura": "\nWraith should return the width set in the config.yaml, is this what you are seeing?\n\nNo, I'm seeing wraith return .png at the width of the body tag.\nHTML:\nhtml\n<body>\n    <img src=\"wraith.png\" />\n</body>\nCSS:\n``` css\nbody {\n   background-color: red;\n   width: 600px;\n}\nimg {\n   background-color: blue;\n   width: 100%;\n}\n```\nWhen wraith captures the 320px viewport, I get a .png that's 600px wide:\n\nBut I was expecting a PNG that was only 320px wide, with the image masked off because of the viewport size, something like this (just looking at it with Chrome devtools):\n\n. @JakeChampion -- thanks!\nOn a side note, this unintended behavior could actually be useful to some folks, especially, like me, who are trying to deal with converting websites that might not be fully responsive. It could be a way to catch problems outside the viewport and might be a nice feature to be able to configure Wraith to capture the entire contents of the <body>, maybe with a demarcation of where the actual viewport ends.\n\n. I was kind of looking for a similar workflow @mindmelting, I encountered several projects... PhantomCSS being one of them.\n@DaveBlooman, please correct me... but I think one possible workflow for @mindmelting (and me :smile: ) would be to use PhantomJS/CasperJS to send click events to a single page app and capture screenshots. Then use Wraith to compare those screen shots? \n. ",
    "mindmelting": "Thanks :)\n. ",
    "danbohea": "Ooops, wrong project - sorry for the noise.\n. ",
    "rodrigoeg": "I found what was causing this issue. The server I am runing wraith has basic authentication, and Anemone does not crawl it (I think when I opened this issue I run with \"/home\" in the domain on a server without password protection). \nI have to crawl my site without password to generate the spider.txt correctly and then change snap.js file to be able to return the password in the website:\n// sets the user name used for HTTP authentication.\npage.settings.userName = 'user';\n// sets the password used for HTTP authentication.\npage.settings.password = 'password';\n. ",
    "mishradileep": "If it is HTACESS password then you can give your URL as http://{username}:{password}@www.example.com/ (Follow :  https://github.com/BBC-News/wraith/issues/4). For code generated authentication I am still struggling.\n. ",
    "Razrael": "In my oppinion it should be okay to generate a spider file when typing wraith history. In my oppinion this command does the initialisation for the history mode, so it should work similar like \"capture\". Just don't do it on wraith latest so it will use the last generated.\nWouldn't that solve the problem?\n. Ah, looks like this is the issue. Now I discovered a lot more pairs of images which do not have exactly the same width. Most of the time just some px more.\nLooks like on these pages there are some css errors. So they are bigger than expected.\nIn my config I set 1024px for the width, but some images are some pixel off. Isn't there a way to cut them down to the right size (or resize the smaller one and add some white space) or do the comparission anyway?\nThe comparission would maybe not be perfect, but I would not expect to get verry different screenshots marked as 0 difference.\n. Can I assume that the reason this was closed is a fix in the code?\nI don't have the possibility to test it myself at the moment, so I just ask.\n. Thanks. I already tried it with the user:password@domain.com notation, but i tried again anyway.\nThis time it worked with this notation, so I did probably a dumb error the last time :-(\nThanks for you help and effort.\n. ",
    "teameh": "See https://github.com/BBC-News/wraith/issues/4\n. ",
    "ocean": "Thanks for the update @DaveBlooman, if I get a chance I'll have a look at the code, but then I don't write much Ruby any more.\n. ",
    "Adrian3martin": "Working now. It seems this was a network issue. I work for a bank and network security is well... important. I just started, so permissions are gradually getting handed down to me, but for this case I switched to my personal hotspot and no more issue. \n. ",
    "jozefkucia": "This regex should match only when a string ends with one of the extensions from EXT array. The old version doesn't do this. It matches any string which contains one of the extensions at any position. For example, http://www.exmaple.net/mka/page.html is matched as it contains mka (see http://rubular.com/r/s4Rr8bGGQG).\nThe old regex is equivalent to the following: (\\.flv)|swf|png|jpg|gif|asx|zip|rar|tar|7z|gz|jar|js|css|dtd|xsd|ico|raw|mp3|mp4|wav|wmv|ape|aac|ac3|wma|aiff|mpg|mpeg|avi|mov|ogg|mkv|mka|asx|asf|mp2|m1v|m3u|f4v|pdf|doc|xls|ppt|pps|bin|exe|rss|(xml$)\n. ",
    "peruukki": "This also seems to fix #202.\n. @bootstraponline, thanks for the tip about calling shellescape directly on the string, it makes the changes much nicer one-liners! Shellwords is part of the Ruby standard library, so apparently it shouldn't be added to runtime depedencies; I tried adding it, but then the gem installation failed to this:\nERROR:  While executing gem ... (Gem::UnsatisfiableDependencyError)\n    Unable to resolve dependency: 'wraith (= 2.4.1)' requires 'shellwords (>= 0)'\nI changed the commit to call shellescape everywhere and rebased it.\n. @ChrisBAshton, actually there is phantomjs_options in Wraith, see e.g. https://github.com/BBC-News/wraith/pull/251. I'm not sure if it's documented, though.\n. ",
    "bootstraponline": "shellwords needs to be added to the gemspec as a runtime dependency.\n. > This pull request contains merge conflicts that must be resolved.\n\nOnly those with write access to this repository can merge pull requests.\n\nand the pull request needs to be rebased\n. > Shellwords is part of the Ruby standard library, so apparently it shouldn't be added to runtime depedencies;\noh, sorry didn't know that. The PR looks good to me. :+1: \n. /cc @DaveBlooman\n. :+1: \n. :+1: \n. I think you can just do compare.shellescape\n. ",
    "darnould": "LGTM :+1:\n. https://github.com/BBC-News/wraith/blob/master/LICENSE#L74-L88 :+1:\n. ",
    "JustJenFelice": "I've been encountering the same issue as well @DaveBlooman. I've tried running two URL comparisons, localhost comparisons, historic comparisons...I can never get a diff to generate. Even when two perfectly generated screenshot images are being used for comparison. I've tried phantomjs v2, phantomjs v1.9, reinstalling Imagemagick...you name it. Still can't get a diff image to generate.\nHave there been any answers provided on this issue? \n. ",
    "icrossing-lee": "Our dev site does have hyphens in the URL, but we\u2019re seeing the error even with our production site that doesn\u2019t have hyphens.\nWraith 2.4.0\nOS X 10.10\nruby 2.2.2p95 (2015-04-13 revision 50295) [x86_64-darwin14]\nSample config:\nHeadless browser option\nbrowser:\n  phantomjs: \"phantomjs\"\n  # slimerjs: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory: 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  devixd: \"http://devsite-withhyphens-inurl.com\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n- 320\n- 600\n- 800\n- 1080\n- 1280\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n- 10\nChoose how results are displayed, by default alphanumeric. Different screen widths are always grouped.\nalphanumeric - all paths (with, and without, a difference) are shown, sorted by path\ndiffs_first - all paths (with, and without, a difference) are shown, sorted by difference size (largest first)\ndiffs_only - only paths with a difference are shown, sorted by difference size (largest first)\nmode: alphanumeric\nthreshold: 5\nFull output of one of the error moments on a straight wraith history command:\nlalalmodovar:wraith-test lalmodovar$ wraith history config\nCreating Folders\nReferenceError: Can't find variable: Modernizr\nhttp://devixd.toyota.com/tcom/js/events.js:46\n  http://devixd.toyota.com/tcom/js/events.js:47\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1665 in execCb\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:874 in check\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1158 in enable\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:782 in init\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1185 in callGetModule\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1559 in completeLoad\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1686 in onScriptLoad\nSnapping http://devixd.toyota.com/tcom-ui/molecules/color-selector// at width 320\nReferenceError: Can't find variable: Modernizr\nhttp://devixd.toyota.com/tcom/js/events.js:46\n  http://devixd.toyota.com/tcom/js/events.js:47\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1665 in execCb\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:874 in check\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1158 in enable\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:782 in init\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1185 in callGetModule\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1559 in completeLoad\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1686 in onScriptLoad\nSnapping http://devixd.toyota.com/tcom-ui/molecules/color-selector// at width 800\nReferenceError: Can't find variable: Modernizr\nhttp://devixd.toyota.com/tcom/js/events.js:46\n  http://devixd.toyota.com/tcom/js/events.js:47\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1665 in execCb\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:874 in check\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1158 in enable\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:782 in init\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1185 in callGetModule\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1559 in completeLoad\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1686 in onScriptLoad\nSnapping http://devixd.toyota.com/tcom-ui/molecules/color-selector// at width 600\nReferenceError: Can't find variable: Modernizr\nhttp://devixd.toyota.com/tcom/js/events.js:46\n  http://devixd.toyota.com/tcom/js/events.js:47\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1665 in execCb\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:874 in check\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1158 in enable\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:782 in init\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1185 in callGetModule\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1559 in completeLoad\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1686 in onScriptLoad\nSnapping http://devixd.toyota.com/tcom-ui/molecules/color-selector// at width 1080\nReferenceError: Can't find variable: Modernizr\nhttp://devixd.toyota.com/tcom/js/events.js:46\n  http://devixd.toyota.com/tcom/js/events.js:47\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1665 in execCb\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:874 in check\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1158 in enable\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:782 in init\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1185 in callGetModule\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1559 in completeLoad\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1686 in onScriptLoad\nSnapping http://devixd.toyota.com/tcom-ui/molecules/color-selector// at width 1280\nReferenceError: Can't find variable: Modernizr\nhttp://devixd.toyota.com/tcom/js/events.js:46\n  http://devixd.toyota.com/tcom/js/events.js:47\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1665 in execCb\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:874 in check\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1158 in enable\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:782 in init\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1185 in callGetModule\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1559 in completeLoad\n  http://devixd.toyota.com/tcom/common/bower_components/requirejs/require.js:1686 in onScriptLoad\nSnapping http://devixd.toyota.com/tcom-ui/molecules/color-selector// at width 1600\n/usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1392:in initialize': Operation not supported @ rb_sysopen - /./home/1080__devixd.png (Errno::ENOTSUP)\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1392:inopen'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1392:in block in copy_file'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1391:inopen'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1391:in copy_file'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1359:incopy'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:471:in block in copy_entry'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1497:incall'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1497:in wrap_traverse'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1500:inblock in wrap_traverse'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1499:in each'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1499:inwrap_traverse'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1500:in block in wrap_traverse'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1499:ineach'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1499:in wrap_traverse'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:468:incopy_entry'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:443:in block in cp_r'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1570:inblock in fu_each_src_dest'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1584:in fu_each_src_dest0'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:1568:infu_each_src_dest'\nfrom /usr/local/Cellar/ruby/2.2.2/lib/ruby/2.2.0/fileutils.rb:442:in cp_r'\nfrom /usr/local/lib/ruby/gems/2.2.0/gems/wraith-2.4.0/lib/wraith/folder.rb:37:incopy_old_shots'\nfrom /usr/local/lib/ruby/gems/2.2.0/gems/wraith-2.4.0/lib/wraith/cli.rb:52:in copy_old_shots'\nfrom /usr/local/lib/ruby/gems/2.2.0/gems/wraith-2.4.0/lib/wraith/cli.rb:117:inhistory'\nfrom /usr/local/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor/command.rb:27:in run'\nfrom /usr/local/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor/invocation.rb:126:ininvoke_command'\nfrom /usr/local/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor.rb:359:in dispatch'\nfrom /usr/local/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor/base.rb:440:instart'\nfrom /usr/local/lib/ruby/gems/2.2.0/gems/wraith-2.4.0/bin/wraith:5:in <top (required)>'\nfrom /usr/local/bin/wraith:23:inload'\nfrom /usr/local/bin/wraith:23:in `'\nIf there\u2019s anything else I can help with, please let me know.\nLEE ALMODOVAR\nQA Lead (Automation)\niCrossing\n310.664.2969 direct\n562.360.0451 cell\n310.664.2931 fax\nlee.almodovar@icrossing.commailto:lee.almodovar@icrossing.com\nwww.icrossing.comhttp://www.icrossing.com/\nConnecthttp://www.icrossing.com/icrossing-blogs-conversations-feed with us in social spaces\nNamed a global \"Leader\" in the Gartner Magic Quadranthttp://www.icrossing.com/for-second-consecutive-year-icrossing-is-named-a-leader-in-gartner-magic-quadrant-for-global-digital-marketing-agencies for Digital Marketing Agencies.\nOn 5/19/15, 8:34 AM, \"David Blooman\" notifications@github.com<mailto:notifications@github.com> wrote:\nCould provide a sample config and details of OS/Gem version\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/BBC-News/wraith/issues/255#issuecomment-103555039.\n\niCrossing Privileged and Confidential Information\nThis email message is for the sole use of the intended recipient(s) and may contain confidential and privileged information of iCrossing. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message.\n. I've installed modernizr, and removed the 1600 size, is there anything else that I can do to fix this?\n. Thank you for not fixing it or providing guidance, that\u2019s very helpful to us!\nLEE ALMODOVAR\n\niCrossing Privileged and Confidential Information\nThis email message is for the sole use of the intended recipient(s) and may contain confidential and privileged information of iCrossing. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message.\n. ",
    "steveworkman": "@DaveBlooman lowercase label works, and works with ruby 1.9.3 (even though the gems says it's in 1.9.1, odd vagrant setup)\nFrom reading the issues, labelling feels really fragile (numbers, hypens, now capital letters). Can you at least document what does work and what doesn't work and put that into the sample config?\n. ",
    "lrobeson": "Agree with @steveworkman, I'm running into the same error(s) after various tweaks to my config. Would be good to know what's acceptable, especially when dealing with local sites that may use specific ports, etc.\n. ",
    "MichaelMallett": "I keep running into this, it generates approx 95% of screenshots, but not all. Sometimes it repeats the missing ones. Sometimes it doesn't generate the thumbnails and there's a blank space but clicking through reveals the shot.\nI'm struggling to find out how to get error logs etc. We do sometimes get javascript errors in the console when running capture, from a 3rd party module, but they don't seem to effect the outcome that much.\n. Is there any way of debugging this? When it's taking the snapshots sometimes it will show that it has had to retry a few images. There's never an error that suggests that it failed, but the image that it generates is blank. Actually, to clarify, the blank images it seems are not the ones that have to be retried\nThe pages in question exist, and load very quickly, especially on production as they are behind caching layer.  There is absolutely no useful debugging information.\n. When trying this on my local mac, running latest ruby, wraith and phantomjs, I get lots of these errors (different CGContexts).\nlocal phantomjs[73408] <Error>: CGContextShowGlyphsAtPositions: invalid context 0x0. This is a serious error. This application, or a library it uses, is using an invalid context  and is thereby contributing to an overall degradation of system stability and reliability. This notice is a courtesy: please fix this problem. It will become a fatal error in an upcoming update.\nHowever, I have no idea if this is related, as they don't appear related to the problematic image when the error occurs - but wraith appears to run multiple phantomjs threads, and I assume then takes multiple snaps simultaneously, so it could be related after all.\nTo sum up, this is happening on the following setups, all 3 on different websites.\nMacbook Pro running Yosemite, Ruby 2.2.0, Wraith 2.4.2, phantomjs 2.0.0\nUbuntu 10.04.4 LTS, Ruby 1.9.3, Wraith 2.4.1, Phantomjs 1.9.7\nUbuntu 12.04.5 LTS, Ruby 1.9.3, Wraith 2.4.1,, Phantomjs 1.9.7\nAll 3 generate blank/partial images. Only the Macbook Pro gives me any actual errors (which I think are XCode related).\nIronically, one of the websites we wish to use this for is a BBC one, but it's just not working reliably enough right now\n. I've removed pertinent information.\n```\nHeadless browser option\nbrowser:\n  phantomjs: \"phantomjs\"\n  # slimerjs: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory:\n  - 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  qa: # Redacted\n  prod: # Redacted\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 320\n  - 768\n  - 1280\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\n  tickets: /tickets\n  about-us: /about-us\n  news-landing: /news\n  experiences-landing: /experiences\n  experiences-item: /experiences/keeper-for-a-day\n  science-landing: /science\n  social-hub: /social/all\nIf you don't want to name the paths explicitly you can use a yaml\ncollection as follows, and names will be derived by replacing / with _\n\npaths:\n- /imghp\n- /maps\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n  - 10\n```\nAll of those paths exist on both sites.\n. Hi, thanks for the response. I've since given up on the casperjs, phantomjs\nbleeding edge versions. However, I'd still like to understand the issue.\nYeah, I installed through rubygems, is that where I went wrong?\nOn Mon, Jun 15, 2015 at 11:05 AM, David Blooman notifications@github.com\nwrote:\n\nAre you installing the wraith gem via Rubygems?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/BBC-News/wraith/issues/263#issuecomment-112003934.\n. \n",
    "jlillyreed": "Error logs would be amazing!\n. ",
    "Boztown": "Somewhere in this thread one person mentioned that they didn't believe this to be a timeout issue but for me it was.  I upped the timeout values in snap.js.\n``` javascript\n  if (current_requests < 1) {\n      clearTimeout(final_timeout);\n      last_request_timeout = setTimeout(function() {\n          console.log('Snapping ' + url + ' at width ' + view_port_width);\n          page.render(image_name);\n          phantom.exit();\n      }, 5000);\n  }\n// Sometimes, straggling requests never make it back, in which\n  // case, timeout after 5 seconds and render the page anyway\n  final_timeout = setTimeout(function() {\n    console.log('Snapping ' + url + ' at width ' + view_port_width);\n    page.render(image_name);\n    phantom.exit();\n  }, 12000);\n```\nThis slows things down but it worked.  You could probably play with the values and find a good balance.\n. ",
    "andrewholgate": "The issue ended up being caused by trailing &#8203; in the HTML which was then being copied into config.yaml file.\nPerhaps this could be cleaned up or a raw / downloadable version made available in the docs?\n. This seems to be the correct link: http://bbc-news.github.io/wraith/#HistoryMode\n. ",
    "Ruff9": "I can't find the file you're talking about,  and the link you gave is not avalaible (404)\n. ",
    "eyal919": "I agree with Andrew... \nthe tested link in the html report will be great.\nalso, when having long name of the image, the image name overlapping the sidebar, so wider body will be nice as well \n\n. ",
    "JakobP": "@eyal919 I'v submitted a pull request with a possible solution to overlap from the sidebar.\n. @andrewholgate\nI tested making the left menu always visible by including this snippet of CSS in gallery_template.erb. \n\n.panel {\nposition:fixed;\n}\n\nUnfortunately it creates an issue where the bottom of the list isn't visible when you have a large amount of pages. Any suggestions for avoiding that?\n. I can no longer reproduce the error - It must have been a local issue :-/\n. ",
    "adouglas": "This may be the same as #272\n. Note that this also seems to cause the same issue when the mode is diff_first:\nError\n/usr/local/rvm/gems/ruby-2.2.2/gems/wraith-2.5.2/lib/wraith/gallery.rb:104:in `*': nil can't be coerced into Fixnum (TypeError)\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/wraith-2.5.2/lib/wraith/gallery.rb:104:in `block in sorting_dirs'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/wraith-2.5.2/lib/wraith/gallery.rb:104:in `each'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/wraith-2.5.2/lib/wraith/gallery.rb:104:in `sort_by'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/wraith-2.5.2/lib/wraith/gallery.rb:104:in `sorting_dirs'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/wraith-2.5.2/lib/wraith/gallery.rb:48:in `match'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/wraith-2.5.2/lib/wraith/gallery.rb:32:in `parse_directories'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/wraith-2.5.2/lib/wraith/gallery.rb:129:in `generate_gallery'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/wraith-2.5.2/lib/wraith/cli.rb:88:in `generate_gallery'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/wraith-2.5.2/lib/wraith/cli.rb:128:in `latest'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/thor-0.19.1/lib/thor/command.rb:27:in `run'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/thor-0.19.1/lib/thor/invocation.rb:126:in `invoke_command'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/thor-0.19.1/lib/thor.rb:359:in `dispatch'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/thor-0.19.1/lib/thor/base.rb:440:in `start'\n    from /usr/local/rvm/gems/ruby-2.2.2/gems/wraith-2.5.2/bin/wraith:5:in `<top (required)>'\n    from /usr/local/rvm/gems/ruby-2.2.2/bin/wraith:23:in `load'\n    from /usr/local/rvm/gems/ruby-2.2.2/bin/wraith:23:in `<main>'\n    from /usr/local/rvm/gems/ruby-2.2.2/bin/ruby_executable_hooks:15:in `eval'\n    from /usr/local/rvm/gems/ruby-2.2.2/bin/ruby_executable_hooks:15:in `<main>'\nconfig.yaml\n```\nbrowser:\n  phantomjs: phantomjs\ndirectory: /var/shots\ndomains:\n  english-gb: \"https://www.trurating.com/en-gb/\"\nfuzz: 20%\nhistory_dir: /var/shots_history\nmode: diffs_first\npaths:\n  about-us: about-us\n  bussinesses-we-love: businesses-we-love\n  charity: charity\n  contact-us: contact-us\n  for-bussines: business\n  how-it-works: how-it-works\n  jobs: jobs\n  login: login\n  press: press\n  prizes: prizes\n  terms-and-conditions: website-terms-and-conditions\nscreen_widths:\n  - 320\n  - 768\n  - 1280\nsnap_file: /var/wraith/javascript/snap.js\nthreshold: 5\n```\n. Seems to be an issue with some of the file names including - for example english-diff. This seems to break the matcher so that the diff % is not being added to the local object.\n. May also fix #268 \n. Sure, I'll add tests next week.\n. Added test and fixed merge issue\n. ",
    "seanhamlin": "I am running 2.7.0 and can confirm this is still an issue\nGenerating thumbnails\n/Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/lib/wraith/gallery.rb:108:in `each': comparison of NilClass with 0.0 failed (ArgumentError)\n    from /Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/lib/wraith/gallery.rb:108:in `max_by'\n    from /Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/lib/wraith/gallery.rb:108:in `block in sorting_dirs'\n    from /Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/lib/wraith/gallery.rb:108:in `each'\n    from /Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/lib/wraith/gallery.rb:108:in `sort_by'\n    from /Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/lib/wraith/gallery.rb:108:in `sorting_dirs'\n    from /Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/lib/wraith/gallery.rb:48:in `match'\n    from /Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/lib/wraith/gallery.rb:32:in `parse_directories'\n    from /Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/lib/wraith/gallery.rb:132:in `generate_gallery'\n    from /Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/lib/wraith/cli.rb:82:in `generate_gallery'\n    from /Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/lib/wraith/cli.rb:94:in `capture'\n    from /Library/Ruby/Gems/2.0.0/gems/thor-0.18.1/lib/thor/command.rb:27:in `run'\n    from /Library/Ruby/Gems/2.0.0/gems/thor-0.18.1/lib/thor/invocation.rb:120:in `invoke_command'\n    from /Library/Ruby/Gems/2.0.0/gems/thor-0.18.1/lib/thor.rb:363:in `dispatch'\n    from /Library/Ruby/Gems/2.0.0/gems/thor-0.18.1/lib/thor/base.rb:439:in `start'\n    from /Library/Ruby/Gems/2.0.0/gems/wraith-2.7.0/bin/wraith:5:in `<top (required)>'\n    from /usr/bin/wraith:23:in `load'\n    from /usr/bin/wraith:23:in `<main>'\n. ",
    "factologist": "Looks like I'm having this problem too, with wraith capture.\n```\n..\nGenerating thumbnails\n/Library/Ruby/Gems/2.0.0/gems/wraith-2.6.0/lib/wraith/gallery.rb:98:in `*': nil can't be coerced into Fixnum (TypeError)\n..\n```\n. Is there intent to merge this? Would love it!\n. Hey @ChrisBAshton is this something we'll see merged soon? These failures drive me nuts. Thanks!\n. +1, would be awesome to have the ability to insert Casper code and PhantomJS args. \n. Ahh, awesome thanks @ChrisBAshton !\n. ",
    "revett": "+1\n. ",
    "aripalo": "Hmm doesn't the license of the pull request adhere the license of the main repo (in this case Apache v2)? \nI'm not expert on these of course so don't trust me :) But as the designer of the logo I'm willing to give the license & copyright of the logo to the Wraith open source project. Of course as \"personal pride\" goes, I don't mind if my name is mentioned :D but in general I feel the licensing matches the main project and by submitting this PR the copyright belongs to Wraith open source project.\n. Sounds good to me\n. ",
    "stevenjack": ":+1: If there's credit to the author of the logo and the copyright remains with the Wraith project I reckon that seems reasonable right?\n. ",
    "micahgodbolt": "My guess is that www.live.bbc.co.uk is the URL in England, but in the US the URL redirects to www.live.bbc.com, which is broken. www.bbc.com is the correct URL.\nIs it possible to use URLs that will resolve properly in any country?\n. Ah Drat! Usually look for dups before posting. Totally missed that.\nOn Fri, Oct 2, 2015, 3:29 AM Chris Ashton notifications@github.com wrote:\n\nClosed #291 https://github.com/BBC-News/wraith/issues/291.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/BBC-News/wraith/issues/291#event-425125958.\n. \n",
    "ndarville": "Awesome!\n. ",
    "SimonKeep": "This is still an issue Chris.\n. I'm getting this too.\n. Hi,\nI am now getting this issue having upgraded PhantomJs to 2.0 from 1.9.\nI have been successfully running Wraith with 1.9 for a while. If I switch back to 1.9 everything starts working again.\nI am on windows.\nAny ideas? \n. Which version of PhantomJS are you using? You may need to use 1.9 with windows. See #444. \n. I've tried two methods for this with forms authenticated pages.\n1) Use a before_capture script to perform the login when the page is redirected to the logon page.\n2) Add a valid cookie in the phantom.js driver used by wraith (mine is located here C:\\Ruby22-x64\\lib\\ruby\\gems\\2.2.0\\gems\\wraith-3.2.0\\lib\\wraith\\javascript\\phantom.js). This is a bit of a hack as you have to remember to set it up again either when the cookie expires or if you upgrade Wraith but I have found it to be more reliable than 1).\nThe cookie is added like this before the page.open...\nphantom.clearCookies();\nphantom.addCookie({\n         'name': 'MyAuthCookie',\n         'value': '1BA1EC8FD7BABDCB08CCBD6102C46E9CEB63AD69F940D8A84BA8A43656A3ABB996AFEE956892C460DFA3AB9C3824441AE5D0FE4ED1F67554DC668072463044B1A6DD83CF428D44B82BDF5E3A0934165D64CC6EB98A46683F7E2E619169F1A3C395380976E99AE2010B2F9D2D5E9466D4CE6E18CD190767374C0C7B821199E468035A9A2357D47C2B8F567E6FB1670758D9AA425D',\n         'domain': 'localhost',\n         'path':'/'\n     });  \npage.open(url, function(status) {...\n. I can't guarantee this is correct but the script was something like this, literally pasting the username and password in and clicking submit.\n``` js\nmodule.exports = function (phantom, ready) {\n    phantom.evaluate(function(){\n            if ($(\"#logonContainer\").length > 0)\n            {           \n                // Enter username and password in the input fields\n                $(\"#UserName\").val(\"yourusername\");\n                $(\"#Password\").val(\"yourpassword\");\n\n                // Click the submit button\n                clickElement($(\"input:submit\")[0]); \n            }   \n        }); \n    });     \n});\n\nsetTimeout(function(){ready();}, 20000);\n\n}\n```\nNote: that the setTimeout has to be long enough to give time for the logon page to redirect the browser back to the original page that you were trying to capture.\n...and the config file refers to the script like this...\nyaml\nbefore_capture: 'javascript/logon.js'\n. You can interact with the page in your before_capture files so you can just use js/jquery to remove elements that you dont wan't.\n. This isn't going to help much but your config works for me.\n. I tried it with the diasable-javascript file so its not that.\n. ",
    "ToniStella": "here's my config.yaml\n```\nHeadless browser option\nbrowser:\n  phantomjs: \"phantomjs\"\n  # slimerjs: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory: 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  stage: \"http://www.google.co.uk/\"\n  prod: \"http://www.google.fr/\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 320\n  - 600\n  - 768\n  - 1024\n  - 1280\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n  - 10\nChoose how results are displayed, by default alphanumeric. Different screen widths are always grouped.\nalphanumeric - all paths (with, and without, a difference) are shown, sorted by path\ndiffs_first - all paths (with, and without, a difference) are shown, sorted by difference size (largest first)\ndiffs_only - only paths with a difference are shown, sorted by difference size (largest first)\nmode: diffs_first\nthreshold: 5\n```\n. Thanks for helping guys \n. ",
    "markthannah": "I've been experiencing the same issue. Good to know that this is what's going on. Unfortunately, I've been unable to track down an issue with ImageMagick. \n. ",
    "nehafish": "Here's my casperjs:\nGeneric CasperJS Code. I've tried to embed the basic casper.fill directly into wraith's javascript/casper.js file, but here I have it bundled into basic objects I can call from javascript/casper.js via:\n```\nphantom.page.injectJs('./loginPage.js');\n// phantom.injectJs('...');\nvar loginPage = new LoginPage();\nloginPage.checkPage();\nloginPage.fillForm('user1','password');\n```\n```\nfunction LoginPage() {\nthis.startOnLoginPage = function() {\n    casper.echo(\"base url is : \" + url);\n    casper.start(url + '/signin');\n    casper.userAgent(\"Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.204 Safari/534.16\");\n  };\nthis.checkPage = function() {\n    casper.then(function() {\n        casper.test.assertUrlMatch('signin', 'Login Page');\n        casper.test.assertExists('form#login', 'Login page form has been found');\n    });\n  };\nthis.fillForm = function (username, password) {\n    casper.then(function () {\n        this.fill('form#login', {\n            'username' : username,\n            'password' : password\n        }, false);\n    });\n  };\n```\nAttempt with beforeCapture.js/beforeCapture hook:\nmodule.exports = function (casper) {\n  checkPage: function() {\n    casper.then(function() {\n      casper.test.assertUrlMatch('signin', 'Login Page');\n      casper.test.assertExists('form#login', 'Login Page Form has been found');\n    });\n  }\n}\nMy heavily revised and fussed over casper.js script:\n```\nvar system = require('system');\nvar page = require('webpage').create();\nvar fs = require('fs');\nvar casper = require(\"casper\").create();\nvar url = \"https://foo.internal.dev\"\nvar view_port_width = 1024\nvar image_name = blah_name\nvar selector = ' #signin-btn'\nvar globalBeforeCaptureJS = 'javascript/global.js'\nvar pathBeforeCaptureJS = 'javascript/local.js'\nfunction snap() {\n  if (!selector) {\n    this.capture(image_name);\n  }\n  else {\n    this.captureSelector(image_name, selector);\n  }\n  console.log('Snapping ' + url + ' at width ' + view_port_width);\n}\n// phantom.page.injectJs('./loginPage.js');\n// phantom.casperPath('/usr/local/bin/casperjs');\n// phantom.injectJS(phantom.casperPath + '/home/neha/code/tools/casperjs/bin/bootstrap.js');\n// var loginPage = new LoginPage();\n// var casperDebug = new CasperDebug();\n// casperDebug.setDebugOpt();\n// casperDebug.debugPage();\n// casperDebug.catchResourceStatus();\n// casperDebug.dumpHeaders();\n// casper.checkAuth();\ncasper.start();\ncasper.open(url);\ncasper.viewport(view_port_width, 1024);\ncasper.then(function() {\n    if (globalBeforeCaptureJS) {\n        require('./' + globalBeforeCaptureJS)(this);\n    }\n});\ncasper.then(function() {\n    if (pathBeforeCaptureJS) {\n        require('./' + pathBeforeCaptureJS)(this);\n    }\n});\ncasper.waitFor(function() {\n  return this.evaluate(function() {\n    var images = document.getElementByTagName('img');\n    return Array.prototype.every.cal(images, function(i) { return i.complete; });\n  });\n}, function then () {\n  snap.bind(this)();\n});\n//loginPage.startOnLoginPage();\n// casper.checkAuth();\n// loginPage.checkPage();\n// loginPage.fillForm('user1','password');\n// casper.run(function() {\n//      test.done();\n// });\ncasper.run();\n```\n. And finally, with this config, I'm currently getting results similar to https://github.com/BBC-News/wraith/issues/288:\n'Failed to capture image shots/home/1024_phantomjs_dev.png on attempt number 3 of 5\nUnable to open file:'\n. @ChrisBAshton my apologies for bugging you, but I wanted to check-in regarding this issue. It looks like you may be tied up elsewhere. Do you have any thoughts or suggestions on the best route to take re: casper-based authentication? I hope I'm missing something obvious, but I'm happy to assist with further debugging or reporting if necessary. Any response is appreciated. Thanks for your continued work!\n. This may be a silly question, but for the casperjs option is the property name \"casperjs_options\", or are phantomjs_options applied to both phantom and casper, assuming you're running both?\n. ",
    "sherakama": "Thank you.\n. Makes sense. Glad you are taking the right approach. \nThanks for the response. \n. ",
    "marciovicente": "@ChrisBAshton could you take a look here? :grin: \n. @ChrisBAshton \n\nLook this commit also. It's a smooth change, instead parse a string like 320x480_phantomjs to integer (returns 320), parse string by underscore and get first parameter (the resolution / returns 320x480). I think it's a better approach, once now you can pass height to screen_widths.\n. :eyes: \n. ",
    "ryandowd": "New updated gallery on a desktop\n\nWhen 'compare' icon clicked all three full sized images are loaded into a modal which is scrollable\n\nFrom there all diffs can be compared side by side\n\nExample of a 768px test\n\nExample of a 768px test viewing diffs in modal\n\n. ",
    "jenbennings": "Creating Folders\nCasperError: No element matching selector found: javascript/test.js\n  /Users/benjennings/Documents/dir/project:832 in getElementBounds\n  /Users/benjennings/Documents/dir/Web/project:316 in captureSelector\n  /Users/benjennings/Documents/dir/Web/project/javascript/casper.js:28 in snap\n  /Users/benjennings/.rvm/gems/ruby-2.2.2/gems/casperjs-1.0.0/bin/bootstrap.js:52\n  /Users/benjennings/Documents/dir/Web/project/javascript/casper.js:56 in then\n  /Users/benjennings/Documents/dir/Web/project:1326 in runStep\n  /Users/benjennings/Documents/dir/Web/project:332 in checkStep\nEither I'm missing something obvious or there could be a versioning problem?\n. ",
    "fredrivett": "@renettarenula I'm getting the same issue, http works fine, but https not so, just generates a blank png.\nMy component.yaml file is like so:\n```\nAdd as many domains as necessary. Key will act as a label\ndomains:\n  english: \"https://www.google.com\"\n(optional) JavaScript file to execute before taking screenshot of every path.\nCan be used to reload current page with headers specified, or to dynamically\nAJAX in content, or all manner of other uses!\nbefore_capture: 'javascript/global.js'\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\n# clickable_guide:\n  #   path: /news/entertainment-arts-27221191\n  #   selector: '.idt__news' # selector to take a screenshot of\n  # clickable_guide__after_click:\n  #   path: /news/entertainment-arts-27221191\n  #   selector: '.idt__news'\n  #   # (optional) JavaScript file to execute before taking the screenshot of this path.\n  #   # This is always executed AFTER the 'global' before_capture hook toward the top of this file.\n  #   before_capture: 'javascript/beforeCapture--casper_example.js'\namount of fuzz ImageMagick will use when comparing images. A higher fuzz makes the comparison less strict.\nfuzz: '20%'\nthe maximum acceptable level of difference (in %) between two images.\nWraith considers it a failure if an image diff goes above this threshold.\nthreshold: 5\nscreen widths (and optional height) to resize the browser to before taking the screenshot\nscreen_widths:\n  - 320\n  - 600x768\n  - 768\n  - 1024\n  - 1280\nthe engine to run Wraith with.\nbrowser:\n  phantomjs: \"casperjs\"   # variant of PhantomJS that allows screenshots by element selector\n  #phantomjs: \"phantomjs\" # PhantomJS, built on top of Webkit and JavascriptCore (like Safari)\n  #slimerjs: \"slimerjs\"   # SlimerJS, built on top of Gecko and SpiderMonkey (like Firefox)\nthe file in charge of taking the screenshot\nsnap_file: \"config/wraith/javascript/casper.js\"\nthe directory that your base screenshots will be stored in\nhistory_dir: 'shots_base'\nthe directory that your latest screenshots will be stored in\ndirectory: 'shots'\nchoose how results are displayed in the gallery (default is alphanumeric if omitted)\nDifferent screen widths are always grouped together.\nOptions:\nalphanumeric - all paths (with or without a difference) are shown, sorted by path\ndiffs_first - all paths (with or without a difference) are shown, sorted by difference size (largest first)\ndiffs_only - only paths with a difference are shown, sorted by difference size (largest first)\nmode: alphanumeric\n```\nWith terminal output of:\n$ wraith capture config/wraith/configs/component.yaml\nCreating Folders\n2015-11-05 11:29:52.190 phantomjs[41532:23337360] *** WARNING: Method userSpaceScaleFactor in class NSView is deprecated on 10.7 and later. It should not be used in new applications. Use convertRectToBacking: instead.\n2015-11-05 11:29:52.196 phantomjs[41533:23337361] *** WARNING: Method userSpaceScaleFactor in class NSView is deprecated on 10.7 and later. It should not be used in new applications. Use convertRectToBacking: instead.\n2015-11-05 11:29:52.209 phantomjs[41534:23337362] *** WARNING: Method userSpaceScaleFactor in class NSView is deprecated on 10.7 and later. It should not be used in new applications. Use convertRectToBacking: instead.\n2015-11-05 11:29:52.222 phantomjs[41535:23337363] *** WARNING: Method userSpaceScaleFactor in class NSView is deprecated on 10.7 and later. It should not be used in new applications. Use convertRectToBacking: instead.\n2015-11-05 11:29:52.313 phantomjs[41536:23337364] *** WARNING: Method userSpaceScaleFactor in class NSView is deprecated on 10.7 and later. It should not be used in new applications. Use convertRectToBacking: instead.\nSnapping https://www.google.com/ at: 600x768\nSnapping https://www.google.com/ at: 1024x1500\nSnapping https://www.google.com/ at: 768x1500\nSnapping https://www.google.com/ at: 320x1500\nSnapping https://www.google.com/ at: 1280x1500\ncropping images\ncropping images\ncropping images\n/Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/wraith-2.7.0/lib/wraith/crop.rb:40:in `initialize': no implicit conversion of nil into String (TypeError)\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/wraith-2.7.0/lib/wraith/crop.rb:40:in `open'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/wraith-2.7.0/lib/wraith/crop.rb:40:in `image_dimensions'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/wraith-2.7.0/lib/wraith/crop.rb:21:in `block in crop_images'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:410:in `call'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:410:in `call_with_index'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:379:in `process_incoming_jobs'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:361:in `block in worker'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:354:in `fork'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:354:in `worker'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:345:in `block in create_workers'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:344:in `each'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:344:in `create_workers'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:301:in `work_in_processes'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:232:in `map'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/parallel-1.6.1/lib/parallel.rb:194:in `each'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/wraith-2.7.0/lib/wraith/crop.rb:16:in `crop_images'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/wraith-2.7.0/lib/wraith/cli.rb:64:in `crop_images'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/wraith-2.7.0/lib/wraith/cli.rb:91:in `capture'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/thor-0.19.1/lib/thor/command.rb:27:in `run'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/thor-0.19.1/lib/thor/invocation.rb:126:in `invoke_command'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/thor-0.19.1/lib/thor.rb:359:in `dispatch'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/thor-0.19.1/lib/thor/base.rb:440:in `start'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/gems/wraith-2.7.0/bin/wraith:5:in `<top (required)>'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/bin/wraith:23:in `load'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/bin/wraith:23:in `<main>'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/bin/ruby_executable_hooks:15:in `eval'\n    from /Users/fredrivett/.rvm/gems/ruby-2.2.2@tpo-social/bin/ruby_executable_hooks:15:in `<main>'\n. ",
    "jmdodge": "I'm having a similar issue, but using casperjs - is there any way to pass command line options to casperjs? \n. In my case, I resolved this issue another way - I had installed phantomjs via Ubuntu's apt package manager where it was apparently a bit out of date. When I removed and reinstalled via npm, a more recent version was downloaded and it wasn't necessary to do anything beyond the default to get a successful capture on my https site.\nIt still sounds like a nice feature to have extra command line options available to you though.\n. ",
    "aaronbauman": "Thanks for the guidance, throwing the ignore errors solved it for me, since i'm using a self-signed cert:\nphantomjs_options: --ignore-ssl-errors=true\n. ",
    "renettarenula": "Hi all, I just wanna let your guys know that as of Wraith version 3.1.4, this issue no longer happens for me. So feel free to close the task (unless if some of you are still having issues). Thank you for the fix!\n. Hey @ChrisBAshton \nThanks for replying and I will try this out. Can this solution be apply to this issue as well: https://github.com/BBC-News/wraith/issues/308 ? Both issues are related is it?\nThanks for your reply.\n. I am also receiving this issue but I did not remove 320 from screen_widths at all. I got this error when I use PhantomJS and remove the clickable_guide and clickable_guide__after_click:\nCROPPING IMAGES\n/usr/local/lib/ruby/gems/2.1.0/gems/wraith-3.1.2/lib/wraith/crop.rb:48:in `initialize': no implicit conversion of nil into String (TypeError)\nAnd I got this error when I am using the script (history.yml) as is:\nGENERATING GALLERY\n/usr/local/lib/ruby/gems/2.1.0/gems/wraith-3.1.2/lib/wraith/gallery.rb:114:in `each': comparison of NilClass with 0.0 failed (ArgumentError)\nPerhaps there is more to it than changing widths? \n. I noticed that this error is looking for _helper.js in my current folder instead of the one in the wraith gem itself.\n```\nCasperError: CasperJS couldn't find module /Users/viki/workspace/raynor/_helper.js\n/Users/viki/.rvm/gems/ruby-2.1.1/gems/casperjs-1.0.0/bin/bootstrap.js:126 in _require\n/Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/javascript/casper.js:24 in requireRelative\n/Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/javascript/casper.js:4\n```\nPerhaps fixing this would fix the HTTPS issue itself?\n. Alright, to verify if correctly linking to _helper.js would fix the issue, I just add _helper.js in the root of my current folder. The test seems to run normally but the screenshots generated is still empty and this is the logs that I got:\n```\nDEBUG: #################################################\nDEBUG:   Command run:        latest configs/history.yaml\nDEBUG:   Wraith version:     3.2.0\nDEBUG:   Ruby version:       ruby 2.1.1p76 (2014-02-24 revision 45161) [x86_64-darwin12.0]\nDEBUG:   ImageMagick:        Version: ImageMagick 6.9.2-5 Q16 x86_64 2015-11-01 http://www.imagemagick.org\nDEBUG:   PhantomJS version:  1.9.7\nDEBUG:   CasperJS version:   1.0.0\nDEBUG: #################################################\nDEBUG: \nConfig validated. No serious issues found.\nSAVING IMAGES\nDEBUG: casperjs --ignore-ssl-errors=true --ssl-protocol=tlsv1 '/Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/javascript/casper.js' 'https://smackaho.st:3022/' '320x10000,600x10000,768x10000,1024x10000,1280x10000' 'shots_latest/home/MULTI_casperjs_english_latest.png' 'body' '/Users/viki/workspace/raynor/javascript/wait--casper.js' 'false'\nSnapping https://smackaho.st:3022/ at: 320x10000\nSnapping https://smackaho.st:3022/ at: 600x10000\nSnapping https://smackaho.st:3022/ at: 768x10000\nSnapping https://smackaho.st:3022/ at: 1024x10000\nSnapping https://smackaho.st:3022/ at: 1280x10000\nCOPYING BASE IMAGES\nCopying shots_base/home to shots_latest\nCROPPING IMAGES\nDEBUG: Both images are exactly 1008x9984 - no cropping required. (shots_latest/home/1024x10000_casperjs_english.png, shots_latest/home/1024x10000_casperjs_english_latest.png)\nDEBUG: Cropping both images to 1264x9984. (shots_latest/home/1024x1500_phantomjs_english.png, shots_latest/home/1280x10000_casperjs_english.png)\nDEBUG: Both images are exactly 304x9984 - no cropping required. (shots_latest/home/320x10000_casperjs_english.png, shots_latest/home/320x10000_casperjs_english_latest.png)\nDEBUG: Cropping both images to 1280x9984. (shots_latest/home/1280x10000_casperjs_english_latest.png, shots_latest/home/1280x1500_phantomjs_english.png)\nDEBUG: Cropping both images to 584x9984. (shots_latest/home/320x1500_phantomjs_english.png, shots_latest/home/600x10000_casperjs_english.png)\nDEBUG: Cropping both images to 600x9984. (shots_latest/home/600x10000_casperjs_english_latest.png, shots_latest/home/600x768_phantomjs_english.png)\nDEBUG: Both images are exactly 752x9984 - no cropping required. (shots_latest/home/768x10000_casperjs_english.png, shots_latest/home/768x10000_casperjs_english_latest.png)\n/Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/crop.rb:48:in initialize': no implicit conversion of nil into String (TypeError)\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/crop.rb:48:inopen'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/crop.rb:48:in image_dimensions'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/crop.rb:26:incrop_if_necessary'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/crop.rb:19:in block in crop_images'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:453:incall'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:453:in call_with_index'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:422:inprocess_incoming_jobs'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:404:in block in worker'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:395:infork'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:395:in worker'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:386:inblock in create_workers'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:385:in each'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:385:ineach_with_index'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:385:in create_workers'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:327:inwork_in_processes'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:241:in map'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/parallel-1.9.0/lib/parallel.rb:203:ineach'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/crop.rb:18:in crop_images'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/cli.rb:98:inblock in crop_images'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/cli.rb:28:in within_acceptable_limits'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/cli.rb:95:incrop_images'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/cli.rb:173:in block in latest'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/cli.rb:28:inwithin_acceptable_limits'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/lib/wraith/cli.rb:168:in latest'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/thor-0.19.1/lib/thor/command.rb:27:inrun'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/thor-0.19.1/lib/thor/invocation.rb:126:in invoke_command'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/thor-0.19.1/lib/thor.rb:359:indispatch'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/thor-0.19.1/lib/thor/base.rb:440:in start'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/gems/wraith-3.2.0/bin/wraith:5:in'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/bin/wraith:23:in load'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/bin/wraith:23:in'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/bin/ruby_executable_hooks:15:in eval'\n    from /Users/viki/.rvm/gems/ruby-2.1.1/bin/ruby_executable_hooks:15:in'\n```\nWith _helper.js found, screenshot generation is still empty and gallery failed to be created :(\n. ",
    "CharlesBelov": "Still happening for me in Wraith 3.1.4 with apt-get version of phantomjs (1.9.0-1). Installed phantomjs version 2.1.1 and it works fine! Be sure to uninstall the old version of phantomjs.\n. In case anyone asks, if I remove all comments, I get a new error:\n```\nwraith -c '/home/[redacted]v/Documents/regression/sfmta-wraith-configs/configs/config2.yaml' \n/home/[redacted]/Documents/regression/sfmta-wraith-configs/configs/config2.yaml:152\nmode: alphanumeric\n      ^\nReferenceError: alphanumeric is not defined\n    at Object. (/home/[redacted]/Documents/regression/sfmta-wraith-configs/configs/config2.yaml:152:7)\n    at Module._compile (module.js:456:26)\n    at Object.Module._extensions..js (module.js:474:10)\n    at Module.load (module.js:356:32)\n    at Function.Module._load (module.js:312:12)\n    at Module.require (module.js:364:17)\n    at require (module.js:380:17)\n    at Object. (/usr/local/lib/node_modules/wraith/cli.js:20:15)\n    at Module._compile (module.js:456:26)\n    at Object.Module._extensions..js (module.js:474:10)\n``\n. Eliminating the comments and the linemode: alphabetic` allows the program to proceed.\nI'm guessing that mode: alphabetic is from an earlier release of Wraith or represents a missing component, but it seems a bug that comments are not permitted.\n. Confirmed. I've run:\nsudo npm uninstall -g wraith\ngem install wraith\nand now \nwraith setup\nworks.\nHowever\nwraith validate\nreturns\nERROR: \"wraith validate\" was called with no arguments\nThe help documentation and response to\nwraith help validate\nstill need to be updated to show:\nwraith validate  [config_name]\n. Run the following terminal command\nsudo gem install wraith\n. Just to clarify, I'm not looking for something totally literal. When there's a slide in from the top or bottom, I don't expect it to land on the same screen size it just left, and I don't want to see a parade of screen sizes or a diagonal slide. Just something that calls out to me this is the next (or previous) page and not an alternate layout of the same page.\n. Only for perhaps a second for the first displayed page while the page loads:\n\nThen all but one size disappear:\n\n. While that may seem inconvenient to have to scroll down, I can zoom out and see more sizes at once per page.\n. Duh-oh!\nYes, that's what I'm looking for, thank you.\n. And sorry for the inconvenience.\n. Aak, I was one directory up from where I needed to be to find the configuration file.\nIf I can edit this issue, I'm changing it to \"Respond that config file is not found when config file is not found,\" otherwise, I'll file a new issue.\n. So, the request is that if the configuration file is not found, wraith respond with an error message that the configuration file is not found rather than the current mysterious Ruby error message.\n. If I edit the config file by deleting all but two pages and all but two screen sizes, wraith runs through to completion and I get a gallery, so I've verified that the installation is correct.\n. ",
    "whyAto8": "Adding phantomjs_options: --ignore-ssl-errors=true worked for me, but --ssl-protocol=tlsv1 didnt.\n. ",
    "kentr": "Wraith 4.0.0 and 4.0.1 have been working for me consistently with HTTPS urls.\nI'm using these options:\nphantomjs_options: '--ignore-ssl-errors=true --ssl-protocol=tlsv1'. @swati-qa, I am using the config in my previous comment with CasperJS.\nLooks like one person in this thread noted that upgrading PhantomJS solved the problem for them.\n\nOn Apr 17, 2017, at 5:33 AM, swati-qa notifications@github.com wrote:\nFor phantomJS it worked, can someone tell what should be done when using casperJS browser. Adding this line does not help here.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub, or mute the thread.\n. I suspect it's related to the system OpenSSL library.  \n\nTry --ssl-protocol=any\nFrom the PhantomJS docs:\n\n--ssl-protocol=[sslv3|sslv2|tlsv1|tlsv1.1|tlsv1.2|any] sets the SSL protocol for secure connections (default is SSLv3). Not all values may be supported, depending on the system OpenSSL library.\n\nFor me, https URLs are still working fine with this setup:\n\nwraith 4.2.1\nphantoms 2.1.1\ncasperjs 1.1.3\nmacOS High Sierra\nOpenSSL 1.0.2q (MacPorts)\n--ssl-protocol=tlsv1 or --ssl-protocol=any. For anyone else who finds this, it appears that casper.options.pageSettings.javascriptEnabled = false; disables the critical CasperJS / PhantomJS functionality and causes the screenshot to fail.\n\nSee \n casperjs/casperjs#256\n https://groups.google.com/forum/#!topic/phantomjs/c2nPy_dhbXE. To help folks find this via Google:\nIf you've run bundle install and are getting errors like the following, it may be due to the issue in this PR.\n```\n  phantomjs://code/bootstrap.js:227 in loadCasper\nCouldn't find nor compute phantom.casperPath, exiting.\n```\nTo fix, try:\ngem uninstall casperjs. @shmargum Do you have any insight on how to get debug output with this setup?  I need to see errors returned by the browser, by the driver, etc.\nFWIW, in my case, the images are completely failing for my dev instance of the site on my local box.  The site works fine when I visit it in the browser.. @shmargum \n\nYou are not seeing any errors? such as ERROR: Net::ReadTimeout\n\nYes, no errors in the output.\n\nI would suggest to only do a single comparison at a time locally, as the full job can take a while.\n\nI did this, with the same results.  The local screenshot is completely blank, and the prod screenshot is normal.\nDebugging the reason for the blank page is my end-goal, but to do that I'd like to know how to see the errors from the browser.  They're getting swallowed somewhere.  \nSince you know more about the components involved in using Chromedriver I thought you might have insight on how to bring the errors to the surface.. This looks like a duplicate of #546.. The change introduced in the PR fixes the issue for me.\nBefore, the latest command was crashing.  Now, it works as expected.\n@NetoBuenrostro ++!. @staylos92 @jimbobhickville @shmargum \nCan any of you look into committing this?. Looks like this also fixes #546.. ",
    "swati-qa": "For phantomJS it worked, can someone tell what should be done when using casperJS browser. Adding this line does not help here. . Yes, this line needs to be added into your config.yaml file at the top, it resolves the issue where PhantomJS is been used (tried it myself). For CasperJS, I am myself trying to find that how does it helps there.. ",
    "chandragupthan": "Hello, I am still having this problem. I am using Wraith 4.2.1 and I have tried phantomjs 2.1.1 (current latest) and 1.9.7 and 1.9.8 and all having the same problem. Empty images are captured when an \"https\" site is used. The same works fine when I use an \"http\" site. Any pointers please?. ",
    "DobriGenchev": "Hello, as @chandragupthan pointed out the problem still exists. \nI am running Wraith 4.2.3 (on Windows machine), PhantomJS 1.9.7 (due to Windows issue) and I am not able to get proper image over https. Any help is appreciated! . ",
    "mattalberon": "Great - cheers Joseph.\n. ",
    "msafta": "Hi,\nThanks for your reply.\nWraith's folder is C:\\wraith-master. I've tried both ways presented in the thread you linked, with same results using an unchanged config file:\nwraith capture multiple_domains\n\nwraith capture configs/multiple_domains.yaml\n\n. Hi,\nThe phantom--nojs.js file is in the javascript folder (same goes for phantom.js) inside the wraith folder:\n\nI have tried moving the javascript folder under configs, but to no avail... \n. Hi,\nYes, 1.9.2 worked for me too :)\nNow I have to deal with Process.fork is not supported by this ruby which is outside the scope of Wraith: https://github.com/BBC-News/wraith/issues/195\n. ",
    "phanib": "I'm having the same issue, I keep getting the same error.\n. ",
    "lesleyblankendal": "Same issue here...\nAlso seeing the quotes messed up in the cmd prompt:\nCan't open ''javascript/phantom.js''\nCanC'atn 'otp eonp e'n' j'a'vjaasvcarsicprti\\ppth\\apnhtaonmt.ojms.'j's\n. Thanks! that fixes my issue...\n. ",
    "ghuygens": "I had the same issue on windows I switched phantomjs version 2.0 with version 1.9.2 and it is working fine now.\n. ",
    "dsingleton": "I've been running into the same issue, wanting to get the the full page height, while using wraith with history/latest. We've used wraith in the past and the output was full height. I'm not sure if thats a change in wraiths behaviour, or perhaps in an un-versioned dependency on phantomjs behaving differently?\nCurrently, i'm trying to put together a wraith config for a new app, using the latest version of wraith, and a modern config (which is :+1: better). The behaviour we're after is full page height capture and image diffs.\nI tried some variations of the phantom.viewportSize.height suggestion, but unfortunately couldn't get it to alter the capture height - it also looks like crop_images would override that before the diff is generated anyway :/\nIt sounds like this isn't supported right now, and not straight forward to add? If I can find the time i'd be interested in looking into this in more detail, but i'd be good to get a steer first :smile: \n(edit: sorry about the commit reference spam, there was some excessive rebasing)\n. ",
    "Gribnif": "I, too, consider this a huge failing of version 3.x, as capturing with an arbitrarily large height of, say, 10000px has a major performance impact. A job that used to take about 2-3 minutes with version 2.x now takes over 10 minutes to perform the same analysis.\nWhy was this changed from version 2? Can the old behavior be restored?\n. I am still seeing this issue with 3.1.0. It happens when the key to a path is purely numeric, such as:\npaths:\n  1: /foo\nIf I change this to:\npaths:\n  \"1\": /foo\nit works as expected. If there's no direct way of preventing this error, then at least please change the code to detect the error and offer a suggestion of how it can be fixed, for us YAML newbies.\n. ",
    "mootari": "From what I'm seeing in phantom.js there is no way to set the viewport dimensions via a before_capture script as they will always be overridden by the configured dimensions.\n@ChrisBAshton What needs to be done to move https://github.com/BBC-News/wraith/pull/439 forward?. ",
    "VGBenjamin": "Hello,\nI currently use the version 4.0.0 with phantomjs but I still have the same issue when I didn't specify a height in the screen_widths attribute it is still resized to 1500px. \nThe _getDimensions.js didn't exist in the project should I create it? What is his content?\nRegards,\nBenjamin V.. ",
    "rithipooh": "Hello,\nMy friend and colleague found a wonderful solution to this issue. All we had to do was reduce the default height in helper.js to 100 instead of 1500 px in the function getWidthAndHeight(), and comment the line page.clipRect in Phantom.js to prevent setting the height. The code then takes the rendered height of the page for the screenshot!!! Try out and let us know how it works out.... Hello,\nMy friend and colleague found a wonderful solution to this issue. All we had to do was reduce the default height in helper.js to 100 instead of 1500 px in the function getWidthAndHeight(), and comment the line page.clipRect in Phantom.js to prevent setting the height. The code then takes the rendered height of the page for the screenshot!!! Try out and let us know how it works out.... ",
    "MrSleeth": "If this helps, I seem to have Wraith producing full-screen screenshots using Casper and the following:\n\nSet a small, arbitrary height under the screen_widths section of the capture file and then have a pre-capture script similar to the below.\n\nmodule.exports = function (casper, ready) {\n    // test interaction on the page\n    casper.wait(5000, function() {\n        casper.viewport(320, 765); // this seems to take a dynamic height?\n        ready();\n    });\n}. ",
    "maheshm": "@rithipooh That worked perfectly fine. Do we really have to change the _helper.js file? Did not understand why that is being done. page.clipRect basically did the magic. . ",
    "duartegarin": "Hi guys,\nI have the same issue.\nThe fix to phantomjs seems to work fine, can this be fixed in Wraith?\nI call this from within CI and every time spin a new docker instance so it would be awesome if it comes correct on install.\nCheers,. ",
    "bernhardberger": "Is there any news on this?. ",
    "terescode": "All,\nThere is a teribble, awful, awful way to workaround this without having to modify the core code so that it addresses this comment from @duartegarin.\nIf it weren't for the immediate need to have this resolved, I would never do this but what you can do is copy the snap file phantom.js and it's helper class _helper.js into your project directory, make the change to phantom.js described in this comment from @ssteigen.  Then use the old snap_file config property to point to your local copy of phantom.js.\nAgain, I caution this is a terrible solution as you won't pick up maintenance or enhancements to the core copies of these files, but it will get you a temporary solution that works around having to patch the core code.. Here is a PR that attempts to integrate the suggestions above.\nhttps://github.com/BBC-News/wraith/pull/572. ",
    "agarpac": "I have tried to make the changes of #572 and I can not make the screenshots in full screen, using screen_widths:\n -1280\n -1280xauto\nThe ones suggested in this comment either. \nAm I the only one that doesn't work?. ",
    "abioneperhobby": "@ChrisBAshton thanks.\ni will move on casper support.\nand what about versions suggestion? \n. @ChrisBAshton i changed component.yaml to use phantomjs\nbrowser:\n  #phantomjs: \"casperjs\"   # variant of PhantomJS that allows screenshots by element selector\n  phantomjs: \"phantomjs\" # PhantomJS, built on top of Webkit and JavascriptCore (like Safari)\n  #slimerjs: \"slimerjs\"   # SlimerJS, built on top of Gecko and SpiderMonkey (like Firefox)\nbut there is also some issue\nC:\\src\\automatictestingtool\\wraith\\player4x>wraith capture configs/component.yaml\nCreating Folders\nSAVING IMAGES\nCan't open ''javascript/casper.js''\nCan't open ''javascript/casper.js''\nCan't open ''javascript/casper.js''\nCan't open ''javascript/casper.js''\nCan't open ''javascript/casper.js''\nCan't open ''javascript/casper.js''\nCan't open ''javascript/casper.js''\nCan't open ''javascript/Failed to capture image shots/clickable_guide__after_click/600x768_phantomjs_english.png on attempt number 1 of 5\ncasper.js''\nshould i open a new issue report? why there is some reference to casper if i'm using phantomjs?\n. solved downloading phantom 1.9.7 from here https://repository-javaetmoi.forge.cloudbees.com/release/org/phantomjs/phantomjs/1.9.7/\n. @ChrisBAshton you are right.\ni suggest to catch error and advise user if using wraith capture with only one domain.\nthanks.\n. ",
    "kaiprt": "@ChrisBAshton is there any update on this feature? This would be much appreciated in the testing community. \ud83d\ude04 \n. ",
    "luke-holloway": "@mpietsch: After running it through http://codebeautify.org/yaml-validator, it turns out that it is apparently a formatting problem. This worked for me: \n```\nAdd as many domains as necessary. Key will act as a label\ndomains:\n  my_site:  \"http://www.example.com\"\n  my_other_site: \"http://www.test.example.com\"\nNotice the absence of a paths property. When no paths are provided, Wraith defaults to\nspidering mode to check your entire website.\nA list of URLs to skip when spidering.\nRuby regular expressions can be used, if prefixed with !ruby/regexp as defined in the YAML Cookbook.\nSee http://www.yaml.org/YAML_for_ruby.html#regexps\nspider_skips:\n  - /foo/bar.html           # Matches /foo/bar.html explicitly\n  - !ruby/regexp /^\\/baz\\// # Matches any URLs that start with /baz\nthe filename of the spider file to use. Default: spider.txt\nspider_file: example_com_spider.txt\nthe number of days to keep the site spider file\nspider_days: 10\namount of fuzz ImageMagick will use when comparing images. A higher fuzz makes the comparison less strict.\nfuzz: '20%'\nthe maximum acceptable level of difference (in %) between two images.\nWraith considers it a failure if an image diff goes above this threshold.\nthreshold: 5\nscreen widths (and optional height) to resize the browser to before taking the screenshot\nscreen_widths:\n  - 320\n  - 600x768\n  - 768\n  - 1024\n  - 1280\nthe engine to run Wraith with.\nbrowser:\n  #phantomjs: \"casperjs\"   # variant of PhantomJS that allows screenshots by element selector\n  phantomjs: \"phantomjs\" # PhantomJS, built on top of Webkit and JavascriptCore (like Safari)\n  #slimerjs: \"slimerjs\"   # SlimerJS, built on top of Gecko and SpiderMonkey (like Firefox)\nthe file in charge of taking the screenshot\nsnap_file: \"javascript/phantom.js\"\nthe directory that your latest screenshots will be stored in\ndirectory: 'shots_nojs'\nchoose how results are displayed in the gallery (default is alphanumeric if omitted)\nDifferent screen widths are always grouped together.\nOptions:\nalphanumeric - all paths (with or without a difference) are shown, sorted by path\ndiffs_first - all paths (with or without a difference) are shown, sorted by difference size (largest first)\ndiffs_only - only paths with a difference are shown, sorted by difference size (largest first)\nmode: diffs_first\n```\nHope that fixes it for you! If not just let me know\n. ",
    "jrcryer": "I'd imagine wraith version might be better suited.  Or if you run wraith -v or wraith --verbose which printed this at the start.\n. ",
    "tywhang": "Awesome thanks!\n. ",
    "tomsabin": "Also fixed for me when using sitemap: public/sitemap.xml. Any progress on having this PR considered? The build seemed to have failed due to bundler, perhaps it's worth a rebuild to see if the problem still persists now?\n. ",
    "alex-sachaniuk": "lib/wraith/gallery.rb   \nruby\n  def get_path(category)\n+    return '' if wraith.paths.nil?\n     wraith.paths[category]['path'] || wraith.paths[category]\n  end\nhttps://github.com/BBC-News/wraith/pull/351 - adding that line fixed my issue\n. for me it throws the same error when I do not specify path\nhttps://github.com/BBC-News/wraith/issues/352\n. ",
    "DecipherOne": "Also, any labels with a dot notation will break the gallery functionality as well.\nFor example domains:\n                         google.com: www.google.com\nI am dynamically generating the yaml files from a rest endpoint, so I simply wrote some re-write rules into my controller for a work around. It formats the label to replace \".\" with \"_\" , and this allows the gallery.html generation to succeed.\n. ",
    "hhatcher": "I encountered this issue today when attempting to generate a gallery for a url path with a label named \"no\", but renaming the label to \"nox\" fixed the issue and allowed the gallery generation to complete.\n. ",
    "Peter-Petrik": "Used the same edit in lib/wraith/gallery.rb to fix get_path': undefined method```[]' for nil:NilClass (NoMethodError)\n+    return '' if wraith.paths.nil?\n. Experiencing this in 3.2.1\n/var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:298:in```=~': type mismatch: String given (TypeError)\nIn spider.yaml I commented out:\n- !ruby/regexp /^\\/baz\\//\nand I'm no longer seeing the error.\n. ",
    "delmarr": "I resolved my issue by removing all \"/\" and \"-\" from the url keys.. ",
    "laubsauger": "This is definitely the case. Providing an ID here instead of a class causes the selector to be ignored and neither global nor local before_capture scripts will be executed.\nI had a quick look and realized that if there is a hash character in the selector field, every cli argument for casper that comes after the selector is set to undefined.\n. @ChrisBAshton Just wanted to let you know that the same problem exists for the path property.\nIf you're trying to use an url here that has a hash or ampersand in it, you'll break wraith. These characters are probably not getting escaped when being passed to ruby. \nWorkarounds:\nselector: use attribute selector instead of hash ([id=\"mainWrapper\"] instead of #mainWrapper)\npath: use encoded character instead of special char (# => %23, & => %26)\n. ",
    "Natshah": "My solution for this, we need to add our Validation for the Wraith::FolderManager to transliterate truncate_bytes.\nWe need to have the transliterate for babosa:\n``` ruby\nencoding: utf-8\nmodule Babosa\n  module Transliterator\n    class Arabic < Base\n      APPROXIMATIONS = {\n  }\n\n  def transliterate(string)\n    super.gsub(/(c)z([ieyj])/) { \"#{$1}#{$2}\" }\n  end\nend\n\nend\nend\n```\nAnd go and Fork Wraith, then add some custom config functions and load the Arabic transliterate truncate_bytes for where we create or use files and directories.\n. ",
    "darshan-dave": "Operating System : Windows 7\nWraith command : 'history' and 'latest'\nContent of config YAML file:\n``` yaml\nHeadless browser option\nbrowser:\n  phantomjs: \"phantomjs\"\n  # slimerjs: \"slimerjs\"\nIf you want to have multiple snapping files, set the file name here\nsnap_file: \"javascript/snap.js\"\nType the name of the directory that shots will be stored in\ndirectory: 'shots'\nAdd only 2 domains, key will act as a label\ndomains:\n  english: \"http://www.live.bbc.co.uk/news\"\n  russian: \"http://www.live.bbc.co.uk/russian\"\nType screen widths below, here are a couple of examples\nscreen_widths:\n  - 320\n  - 600\n  - 768\n  - 1024\n  - 1280\nType page URL paths below, here are a couple of examples\npaths:\n  home: /\n  uk_index: /uk\nAmount of fuzz ImageMagick will use\nfuzz: '20%'\nSet the number of days to keep the site spider file\nspider_days:\n  - 10\nChoose how results are displayed, by default alphanumeric. Different screen widths are always grouped.\nalphanumeric - all paths (with, and without, a difference) are shown, sorted by path\ndiffs_first - all paths (with, and without, a difference) are shown, sorted by difference size (largest first)\ndiffs_only - only paths with a difference are shown, sorted by difference size (largest first)\nmode: diffs_first\nthreshold: 5\n```\n. Thank you @ChrisBAshton \nThis works fine on one of my test Windows machine with same configuration, but not on another.\n. Thank you, @ChrisBAshton \nThe fix provided by you worked for me.\nThank you again.\n. Thank you for your inputs, Chris.\nLet me check if this works, will get back to you.. Hey @ChrisBAshton,\nI tried interacting with the page (scrolling) by making changes in snap.js. The solution that I tried is provided in the last comment from 'rajee1009' in https://github.com/BBC-News/wraith/issues/118, but to no avail.\nPlease advise.\nThank you.. @ChrisBAshton and @DaveBlooman,\nCould you advise the way out of this? Your help would be highly appreciated.\nThank you. . ",
    "yareckon": "Please Please Please!  My VM is too puny for 8 phantomjs threads, and I would love to be able to set this much lower.\n. ",
    "colorful-tones": "I've read through all threads related to this mysterious property: phantomjs_options: '--ssl-protocol=tlsv1'. Where does one use it, and how please? Does this get placed in the your config.yaml? And how does it work with CasperJS please?. Is there an option to pass for dependency within ImageMagick if installed via homebrew?\nI see that one needs legacy ImageMagick 6.x version, but wondering if there is an option to pass? Here is what I get when I run brew info imagemagick:\nimagemagick: stable 7.0.4-9 (bottled), HEAD\nTools and libraries to manipulate images in many formats\nhttps://www.imagemagick.org/\n/usr/local/Cellar/imagemagick/7.0.4-4 (1,518 files, 22.5M) *\n  Poured from bottle on 2017-01-18 at 11:09:26\nFrom: https://github.com/Homebrew/homebrew-core/blob/master/Formula/imagemagick.rb\n==> Dependencies\nBuild: pkg-config \u2714\nRequired: libtool \u2714, xz \u2718\nRecommended: jpeg \u2714, libpng \u2714, libtiff \u2718, freetype \u2714\nOptional: fontconfig \u2718, little-cms \u2718, little-cms2 \u2718, libwmf \u2718, librsvg \u2718, liblqr \u2718, openexr \u2718, ghostscript \u2718, webp \u2718, openjpeg \u2718, fftw \u2718, pango \u2718\n==> Requirements\nOptional: x11 \u2718, perl >= 5.5 \u2714\n==> Options\n--with-fftw\n        Compile with FFTW support\n--with-fontconfig\n        Build with fontconfig support\n--with-ghostscript\n        Build with ghostscript support\n--with-hdri\n        Compile with HDRI support\n--with-liblqr\n        Build with liblqr support\n--with-librsvg\n        Build with librsvg support\n--with-libwmf\n        Build with libwmf support\n--with-little-cms\n        Build with little-cms support\n--with-little-cms2\n        Build with little-cms2 support\n--with-opencl\n        Compile with OpenCL support\n--with-openexr\n        Build with openexr support\n--with-openjpeg\n        Build with openjpeg support\n--with-openmp\n        Compile with OpenMP support\n--with-pango\n        Build with pango support\n--with-perl\n        Compile with PerlMagick\n--with-quantum-depth-16\n        Compile with a quantum depth of 16 bit\n--with-quantum-depth-32\n        Compile with a quantum depth of 32 bit\n--with-quantum-depth-8\n        Compile with a quantum depth of 8 bit\n--with-webp\n        Build with webp support\n--with-x11\n        Build with x11 support\n--with-zero-configuration\n        Disables depending on XML configuration files\n--without-freetype\n        Build without freetype support\n--without-jpeg\n        Build without jpeg support\n--without-libpng\n        Build without libpng support\n--without-libtiff\n        Build without libtiff support\n--without-magick-plus-plus\n        disable build/install of Magick++\n--without-modules\n        Disable support for dynamically loadable modules\n--without-threads\n        Disable threads support\n--HEAD\n        Install HEAD version\nOr is my only option to install ImageMagick as binary on Mac if I want the necessary (Wraith compatible) version?. ",
    "gunnx": "+1\n. ",
    "jirimatousek": "+1\n. ",
    "jbearden": "+1\n. ",
    "Sabbi0612": "+1\n. To check if this is something due to my Windows System, I installed a New Ubuntu (Linux) system 14.04 LTS as a VM in my Windows Machine only. The Installation on Ubuntu was a success but the screenshots observed for the above mentioned .yaml file were still same and didn't loaded the page properly even after imparting enough page load time. The Screens shots display the pages that seem visually broken.. \n. ``` yaml\n\n\nThis is an example configuration provided by Wraith.\nFeel free to amend for your own requirements.\n---\nThis particular config is intended to demonstrate how\nto use Wraith in 'capture' mode, which is best suited to\ncomparing a test and live version of the same website.\n\nwraith capture churchfinder.yaml\n\n\n\n(required) The engine to run Wraith with. Examples: 'phantomjs', 'casperjs', 'slimerjs'\nbrowser: \"phantomjs\"\n(required) The domains to take screenshots of.\ndomains:\n  current:  \"http://www.churchfinder.com\"\n  new:      \"This can't be shared due to privacy policy of the company\"\n(required) The paths to capture. All paths should exist for both of the domains specified above.\npaths:\n  home:     /\n(required) Screen widths (and optional height) to resize the browser to before taking the screenshot.\nscreen_widths:\n  - 320x3000\n  - 600x3000\n  - 768x3000\n  - 1024x3000\n  - 1280x3000\n(optional) JavaScript file to execute before taking screenshot of every path. Default: nil\nbefore_capture: 'javascript/disable_javascript--phantom.js'\n(required) The directory that your screenshots will be stored in\ndirectory: 'shots'\n(required) Amount of fuzz ImageMagick will use when comparing images. A higher fuzz makes the comparison less strict.\nfuzz: '20%'\n(optional) The maximum acceptable level of difference (in %) between two images before Wraith reports a failure. Default: 0\nthreshold: 5\n(optional) Specify the template (and generated thumbnail sizes) for the gallery output.\ngallery:\n  template: 'slideshow_template' # Examples: 'basic_template' (default), 'slideshow_template'\n  thumb_width:  200\n  thumb_height: 200\n(optional) Choose which results are displayed in the gallery, and in what order. Default: alphanumeric\nOptions:\nalphanumeric - all paths (with or without a difference) are shown, sorted by path\ndiffs_first - all paths (with or without a difference) are shown, sorted by difference size (largest first)\ndiffs_only - only paths with a difference are shown, sorted by difference size (largest first)\nNote: different screen widths are always grouped together.\nmode: diffs_first\n```\nAND THE DISABLE JAVASCRIPT FILE USED IN THE BEFORE CAPTURE HOOK IS AS FOLLOWS -\n``` js\nmodule.exports = function (phantom, ready) {\n    // disable JavaScript\n    phantom.settings.javascriptEnabled = true;\n// reload the page without JS enabled\nphantom.open(phantom.url, function () {\n    setTimeout(ready, 5000);\n});\n\n}\n```\nComment :\nThe site is of http domain only so i think that shouldn't be a problem.\nAs per your comment @ChrisBAshton I updated the Version of PhantomJS to 2.1.1 as it shows on Terminal (Ubuntu) and CMD (Windows) but the problem is still the same. For all the Resolutions provided the screenshots are visually broken. I'm attaching the screenshot for reference , Please have a look.\nYou can compare it with the URL written in the Yaml file.\nI Appreciate your help on this. \nReally eager to implement wraith successfully for my project.\nThanks for the efforts.\n. ",
    "Medenius": "+1\n. ",
    "juodaspaulius": "+1. ",
    "ihorzenich": "+1, cause PhantomJS becomes dead, and his Webkit engine is outdated, so we all need some recent browser engine, and SlimerJS is the only one that exists now.. If Wraith hangs on \u201cComparing shots\u201c or you got errors like\nARN: Failures detected:\nWARN:    Unable to create a diff image for XXX page\nyou should check there is NO SPACES in your path names.. +1 Please add headless Chrome Integration, because current PhantomJS had very outdated CSS support! Thanks!. ",
    "hey-ape": "+1. This fix worked for us: https://github.com/ariya/phantomjs/issues/14365, as referenced originally by @ChrisBAshton \nIt's a PhantomJS issue. Try putting prefixes in your css for Safari 4!. +1. ",
    "vishal-quint": "+1. The new Wraith supports chrome browser now, so this might not be required any more.. ",
    "zapatoche": "+1. +1. ",
    "ClementChaumel": "+1. ",
    "cromination": "+1. ",
    "rteobaldo": "Isn't more interesting use Firefox headless rather SlimerJS?. ",
    "jimpriest": "I'll second this request.  Trying to hack something up in CI and it would be nice to define this URL ourselves.\n. I got side tracked off this project but had a chance to try this and I think it works.  \nThanks for the solution!\n. ",
    "dave81": "Hi Chris thanks for getting back to me\nCommand currently being used: wraith capture googlecapture (this being edited base capture.yaml file)\nI've also tried to edit yaml file to include verbose: true however this seems to prevent the command from executing. Does not get as far as creating folders, saving images.\nJust noticed a similar issue to #369 occurring. If config has \n# (optional) JavaScript file to execute before taking screenshot of every path. Default: nil\n before_capture: 'javascript/disable_javascript--phantom.js' enabled, then I'm getting an error whereby directory is being duplicated in path to give an invalid location\nError: Cannot find module 'd:/wraith_new/d:/wraith_new/javascript/disable_javascript--phantom.js'\n. Without before_capture then the image folder structure will be created, \"home\" will show the initial screenshots, thumbnails contains no images and the gallery showing differences will not be created. \nCommand line seems to get stuck at the last snapping task.   \nWhen I close the command line at this point I'm seeing a warning prompt \nWARN: Failed to capture image <then imageName...> on attempt number 1 of 5\nIf I add verbose: true then I'm back at the point of command not executing\n. ",
    "kittyPillai": "Hi,\nI too am facing this issue.\nI have installed Wraith version 4.0.1 and Phantomjs 1.9.8, could you please suggest a sollution.. It is working. Only real slowly. Has taken nearly 7 hours to run comparison of one page. \n. ",
    "issyl0": "(This tool looks cool - good work, btw!)\n. ",
    "SergiuCip": "Hi there,\nThank you for your help, however I have now fixed the issue. It was due with the way I was trying to running. Doing lots of researching and combining bits and pieces of how to run containers now it is working how it should, however I would suggest putting a better 'how to run it section' for docker & wraith beginners as myself.\nThanks,\nRegards,\nSergiu\n. ",
    "sumaoang": "Thank you Chris. The contents of the config.yaml file:\nbrowser: \"phantomjs\"\ndomains:\n  current:  \"http://www.hudl.com\"\n  new:      \"http://www.hudl.com\"\npaths:\n  home:     /\nscreen_widths:\n  - 320\n  - 600x768\n  - 768\n  - 1024\n  - 1280\nbefore_capture: 'javascript/disable_javascript--phantom.js'\ndirectory: 'shots'\nfuzz: '20%'\nthreshold: 5\ngallery:\n  template: 'slideshow_template'\n  thumb_width:  200\n  thumb_height: 200\nmode: diffs_first\nverbose: true\nAnd the output:\n``\nssumaoang16m:TEST2 shannon.sumaoang$ wraith capture configs/config.yaml\n/usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/wraith.rb:172:in[]': no implicit conversion of String into Integer (TypeError)\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/wraith.rb:172:in verbose'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/wraith.rb:11:ininitialize'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/validate.rb:10:in new'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/validate.rb:10:ininitialize'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/cli.rb:132:in new'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/cli.rb:132:inblock in capture'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/cli.rb:28:in within_acceptable_limits'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/cli.rb:131:incapture'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/command.rb:27:in run'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/invocation.rb:126:ininvoke_command'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor.rb:359:in dispatch'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/base.rb:440:instart'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/bin/wraith:5:in <top (required)>'\n    from /usr/local/bin/wraith:23:inload'\n    from /usr/local/bin/wraith:23:in `'\nssumaoang16m:TEST2 shannon.sumaoang$ \n``\n. My bad.  Looks like no difference between capture and validate unfortunately. Yes, the extra'` was because the way I pasted (I updated and removed the invalid char), it is not in the original YAML file.  The yaml-validator returns \"Valid YAML\" when copying from the file to the site.\nssumaoang16m:TEST2 shannon.sumaoang$ wraith validate configs/config.yaml\n/usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/wraith.rb:172:in `[]': no implicit conversion of String into Integer (TypeError)\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/wraith.rb:172:in `verbose'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/wraith.rb:11:in `initialize'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/validate.rb:10:in `new'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/validate.rb:10:in `initialize'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/cli.rb:48:in `new'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/cli.rb:48:in `block in validate'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/cli.rb:28:in `within_acceptable_limits'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/lib/wraith/cli.rb:47:in `validate'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/command.rb:27:in `run'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/invocation.rb:126:in `invoke_command'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor.rb:359:in `dispatch'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/base.rb:440:in `start'\n    from /usr/local/lib/ruby/gems/2.3.0/gems/wraith-3.1.2/bin/wraith:5:in `<top (required)>'\n    from /usr/local/bin/wraith:23:in `load'\n    from /usr/local/bin/wraith:23:in `<main>'\nssumaoang16m:TEST2 shannon.sumaoang$\n. Chris please ignore this issue.  This is a silly/stupid mistake on my part.  It is a misspelled file name so not a problem at all with Wraith.\nWas typing in: wraith validate configs/config.yaml\nWhen I should have been typing wraith validate configs/configS.yaml\nMy apologies. I will close this issue.\n. ",
    "lvlmd": "For fix this issue, need:\nEdited .bash_profile\nadd\nexport PATH=/Users/**MyAccName**/.rvm/gems/ruby-2.3.0/bin/wraith:$PATH\n. yes. it was issues because old version of Ruby.\n. @ChrisBAshton may you ask advice what im doing wrong if i've got these messages and cant run app ?\n. This step fixed this issue:\nEdited .bash_profile\nadded \nexport PATH=/Users/MyAccName/.rvm/gems/ruby-2.3.0/bin/wraith:$PATH\n. i think needs to implement a new command like \"update\".\n. i need the same bro. Please, guys, who can help? \n. ",
    "katekligman": "Thanks for the feedback!\nI've changed to logger.info and removed the 'Wraith version' from the output.\nFor the version command itself: I've noticed other programs tend to stay somewhat consistent with the formats of their parameters. For example phantomjs uses '--' with other parameters so it would make sense for their version command to also have that prefix. \nThat said, there are a lot of variations among other programs. I kept 'version' as the primary and documented Wraith command to stay consistent with the format of Wraith's other commands. I also mapped \"-v\", \"--version\" and \"-version\" to also invoke it.\n. ",
    "altV": "I'm getting undefined local variable or method `wraith' for #Wraith::Crawler:0x005648d0ca4be8 (NameError) for default spider.yml as well, version 3.1.2\n. ",
    "imagreenplant": "Same here:\nwraith capture configs/spider.yaml \nConfig validated. No serious issues found.\nno paths defined in config, crawling from site root\n/Library/Ruby/Gems/2.0.0/gems/wraith-3.1.2/lib/wraith/spider.rb:64:inspider': undefined local variable or method wraith' for #<Wraith::Crawler:0x007fd2f1938610> (NameError)\n. ",
    "Vexrm": "Ditto. I can't add extra information, but am watching for more info.\n. ",
    "trioni": "I get the same thing. Same error as @imagreenplant \n. ",
    "Dbuggerx": "I'm also getting the same error as @imagreenplant. Is this solved?\n. ",
    "ocrunch": "Same Issue!\n. ",
    "slimatic": "Any thoughts on what this issue could be?\n/usr/local/lib/ruby/gems/2.1.0/gems/wraith-3.2.0/lib/wraith/spider.rb:64:inspider': undefined local variable or method wraith' for #<Wraith::Crawler:0x0055cde740ed58> (NameError)\n. ",
    "xinbin": "I have the same error message as @slimatic , full dump:\n\n/usr/local/lib/ruby/gems/2.2.0/gems/wraith-3.1.2/lib/wraith/spider.rb:64:in\n 'spider': undefined local variable or method 'wraith' for # (NameError)\n    from /usr/local/lib/ruby/gems/2.2.0/gems/wraith-3.1.2/lib/wraith/spider.rb:36:in 'determine_paths'\n    from /usr/local/lib/ruby/gems/2.2.0/gems/wraith-3.1.2/lib/wraith/spider.rb:24:in 'check_for_paths'\n    from /usr/local/lib/ruby/gems/2.2.0/gems/wraith-3.1.2/lib/wraith/cli.rb:36:in 'check_for_paths'\n    from /usr/local/lib/ruby/gems/2.2.0/gems/wraith-3.1.2/lib/wraith/cli.rb:134:in 'block in capture'\n    from /usr/local/lib/ruby/gems/2.2.0/gems/wraith-3.1.2/lib/wraith/cli.rb:28:in 'within_acceptable_limits'\n    from /usr/local/lib/ruby/gems/2.2.0/gems/wraith-3.1.2/lib/wraith/cli.rb:131:in 'capture'\n    from /usr/local/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor/command.rb:27:in 'run'\n    from /usr/local/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor/invocation.rb:126:in 'invoke_command'\n    from /usr/local/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor.rb:359:in 'dispatch'\n    from /usr/local/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor/base.rb:440:in 'start'\n    from /usr/local/lib/ruby/gems/2.2.0/gems/wraith-3.1.2/bin/wraith:5:in ''\n    from /usr/local/bin/wraith:23:in 'load'\n    from /usr/local/bin/wraith:23:in ''\n\n. ",
    "bjorndavis": "I'm getting this as well:\nC:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.2.0/lib/wraith/spider.rb:65:in `spider': undefined local variable or met\nhod `wraith' for #<Wraith::Crawler:0x00000002e81ca8> (NameError)\n        from C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.2.0/lib/wraith/spider.rb:38:in `determine_paths'\n        from C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.2.0/lib/wraith/spider.rb:24:in `check_for_paths'\n        from C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.2.0/lib/wraith/cli.rb:36:in `check_for_paths'\n        from C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.2.0/lib/wraith/cli.rb:134:in `block in capture'\n        from C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.2.0/lib/wraith/cli.rb:28:in `within_acceptable_limits'\n        from C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.2.0/lib/wraith/cli.rb:131:in `capture'\n        from C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor/command.rb:27:in `run'\n        from C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor/invocation.rb:126:in `invoke_command'\n        from C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor.rb:359:in `dispatch'\n        from C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/thor-0.19.1/lib/thor/base.rb:440:in `start'\n        from C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.2.0/bin/wraith:5:in `<top (required)>'\n        from C:/Ruby22-x64/bin/wraith:23:in `load'\n        from C:/Ruby22-x64/bin/wraith:23:in `<main>'\n. ",
    "catchergeese": "It fails for me too (default spider config yaml file, running in docker container):\n$ wraith capture configs/spider.yaml\n/usr/local/lib/ruby/gems/2.1.0/gems/wraith-3.2.0/lib/wraith/spider.rb:64:in `spider': undefined local variable or method `wraith' for #<Wraith::Crawler:0x0055808ac4a508> (NameError)\n    from /usr/local/lib/ruby/gems/2.1.0/gems/wraith-3.2.0/lib/wraith/spider.rb:36:in `determine_paths'\n    from /usr/local/lib/ruby/gems/2.1.0/gems/wraith-3.2.0/lib/wraith/spider.rb:24:in `check_for_paths'\n    from /usr/local/lib/ruby/gems/2.1.0/gems/wraith-3.2.0/lib/wraith/cli.rb:36:in `check_for_paths'\n    from /usr/local/lib/ruby/gems/2.1.0/gems/wraith-3.2.0/lib/wraith/cli.rb:134:in `block in capture'\n    from /usr/local/lib/ruby/gems/2.1.0/gems/wraith-3.2.0/lib/wraith/cli.rb:28:in `within_acceptable_limits'\n    from /usr/local/lib/ruby/gems/2.1.0/gems/wraith-3.2.0/lib/wraith/cli.rb:131:in `capture'\n    from /usr/local/lib/ruby/gems/2.1.0/gems/thor-0.19.1/lib/thor/command.rb:27:in `run'\n    from /usr/local/lib/ruby/gems/2.1.0/gems/thor-0.19.1/lib/thor/invocation.rb:126:in `invoke_command'\n    from /usr/local/lib/ruby/gems/2.1.0/gems/thor-0.19.1/lib/thor.rb:359:in `dispatch'\n    from /usr/local/lib/ruby/gems/2.1.0/gems/thor-0.19.1/lib/thor/base.rb:440:in `start'\n    from /usr/local/lib/ruby/gems/2.1.0/gems/wraith-3.2.0/bin/wraith:5:in `<top (required)>'\n    from /usr/local/bin/wraith:23:in `load'\n    from /usr/local/bin/wraith:23:in `<main>'\nAre there any chances you are going to fix it in the near future?\n. I confirm that this pull request fixes mentioned issues. \n. I can confirm that bug.\n. ",
    "kyleskrinak": "3.2.1 does not address this issue on my system. I'm still seeing the error message:\n.rvm/gems/ruby-2.2.0/gems/anemone-0.7.2/lib/anemone/core.rb:298:in `=~': type mismatch: String given (TypeError)\n        from /Users/x/.rvm/gems/ruby-2.2.0/gems/anemone-0.7.2/lib/anemone/core.rb:298:in `block in skip_link?'\n        from /Users/x/.rvm/gems/ruby-2.2.0/gems/anemone-0.7.2/lib/anemone/core.rb:298:in `any?'\n        etc\u2026\n. I had to tweak this example to get this to work on Windows Docker CE. Note I've added the --rm flag to destroy the resulting image when done with the capture.\ndocker run --rm -P -v c:\\path\\to\\wraith\\dir:/wraithy -w=/wraithy bbcnews/wraith capture configs/capture.yaml. ",
    "sembrat": "For the folks encountering this issue, does the removal of non-regexp within the spider_skips fix this? \nSome quick testing on my end noticed that anything processed within Ruby regexp was handled fine, whereas anything with a string of the path broke spider_skips.\nTo solve this, I had to encapsulate all my non-regexp strings to skip as strict string matches in regexp, which isn't exactly ideal for those (like me) who are awful at regexp syntax.. ",
    "edurenye": "This error is related to the web-spider framework that is using wraith called Anemone this framework in not maintained anymore, last commit was in 2012.\nI think we should replace it with Medusa a maintained fork of Anemone that has the same API, so should work without to much trouble.. I think we should use docker compose and have chrome or whatever in a separate container so we can use Firefox or whatever we want, or add it to a bigger compose that already have selenium with chrome for lets say use behat. This way we do not have 2 chromes there.. With an ENV variable somehow, maybe? I don't know, we have to figure it out.. ",
    "ErroneousBosch": "@sembrat \nYes, switching to regex does seem to correct the errors.. ",
    "Rohnin": "I have the exactly same error. I already tried other versions of Ruby, still this problem is occuring.\n. ",
    "mariovisic": "I'm not sure why 8 was chosen initially, i'm guessing it may be due to websites throttling clients? So long as you're not scraping other peoples websites then I can't see a problem in going over 8 if you have enough cores available.\nIf you think it would be more appropriate to have the option user customisable then let me know and I can add a configuration option to achieve this!\n. I've made another PR #412 where i've added the option for this to be set, I think this is a better solution than hardcoding to the number of processors available as in my testing around 1.5x available CPUs yielded the best performance.\nClosing, see: #412 \n. ",
    "johnsyweb": "\ud83d\udc4d \n. Do I need to do anything else to get this merged, @ChrisBAshton?\n. Thank you.\nWe bumped Nokogiri to 1.6.8.rc3 and the number of segmentation faults in our Rails application dropped by about 50%!\n. And now they're all gone: https://github.com/sparklemotion/nokogiri/issues/1426#issuecomment-220180137\n. ",
    "JimBledsoe": "I have been using this on my local branch and it has added a tremendous amount of flexibility in testing.  I am currently favoring closer to 2x the # cores, but 1.5 is good as well.\n. I ran into the same problem processing a site with 2000+ pages and while I don't have a fix, I have a hackey work-around.  After the spidering is complete and it begins processing images, I run a bash script in another session that takes a snapshot of the phantomjs process list and compares it to a list 60 seconds later and kills and session that is still running.  Wraith will spin up a new attempt up to 5 times for a single page.  The script keeps looping until all phantomjs processes have completed.\nphantomjs_hawk.txt\n. ",
    "dgiddins": "Thanks, I had tried to set page height before with the * rather than the x (i.e. 1280*3000). RTFM\nAm having problems with the before capture call as described here: https://github.com/BBC-News/wraith/issues/420\n. Hi Chis, \nThis did not fix the issue. I update wraith and it was running at 3.1.4. I uninstalled it (turns out that i had 3.1.1, 3.1.3 and 3.1.4 installed so removed them all) then re-installed 3.1.1. Same error, Uninstalled again and wend to latest and had the same error. What other info do you need to help with this?\n. Command was: wraith history configs\\dff.yaml\nThe yaml is valid accordig to the ymal validator\nThe config file is shown below (with some product/company names obfuscated)\n```\n(required) The engine to run Wraith with. Examples: 'phantomjs', 'casperjs', 'slimerjs'\nbrowser: \"phantomjs\"\n(required) The domains to take screenshots of.\ndomains:\n  current:  \"http://dff.ci-sf.env.com\"\n(required) The paths to capture. All paths should exist for both of the domains specified above.\npaths:\n  com:     /Feedback/Dff?domain=com\n(required) Screen widths (and optional height) to resize the browser to before taking the screenshot.\nscreen_widths:\n  - 1280x5000\nhistory_dir: 'shots_base'\n(optional) JavaScript file to execute before taking screenshot of every path. Default: nil\nbefore_capture: 'javascriptwait--phantom.js'\n(required) The directory that your screenshots will be stored in\ndirectory: 'shots'\n(required for history mode, otherwise optional) The directory that your base screenshots will be stored in.\nhistory_dir: 'shots_base'\n(required) Amount of fuzz ImageMagick will use when comparing images. A higher fuzz makes the comparison less strict.\nfuzz: '20%'\n(optional) The maximum acceptable level of difference (in %) between two images before Wraith reports a failure. Default: 0\nthreshold: 0\nverbose: true \n```\nThe output with verbose: true is \n```\nDEBUG: #################################################\nDEBUG:   Wraith version:     3.1.4\nDEBUG:   Ruby version:       ruby 2.2.3p173 (2015-08-18 revision 51636) [x64-mingw32]\nDEBUG:   ImageMagick:        Version: ImageMagick 6.9.3-7 Q16 x64 2016-03-06 http://www.imagemagick.org\nDEBUG:   PhantomJS version:  1.9.8\nDEBUG:   CasperJS version:   1.0.0\nDEBUG: #################################################\nDEBUG:\nConfig validated. No serious issues found.\nCreating Folders\nSAVING IMAGES\nDEBUG: phantomjs  'C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.1.4/lib/wraith/javascript/phantom.js' 'http://dff.ci-sf.env.com/Feedback/Dff?domain=com' '1280x5000' 'shots/com/1280x5000_phantomjs_current.png' 'body' 'c:/github.com/org/prod/wraith/c:/github.com/org/prod/wraith/javascriptwait--phantom.js' 'false'\nLoading http://dff.ci-sf.env.com/Feedback/Dff?domain=com at dimensions: 1280x5000\nError: Cannot find module 'c:/github.com/org/prod/wraith/c:/github.com/org/prod/wraith/javascriptwait--phantom.js'\nphantomjs://bootstrap.js:289\nphantomjs://bootstrap.js:254 in require\nC:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.1.4/lib/wraith/javascript/phantom.js:103 in runSetupJavaScriptThen\nC:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.1.4/lib/wraith/javascript/phantom.js:87 in markPageAsLoaded\nC:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.1.4/lib/wraith/javascript/phantom.js:81 in checkStatusOfAssets\n```\n. Hi, i just realised that this was totally my fault. It was a path error/filename error. I must have had a copy paste error. Thanks for your support.\n. ",
    "wjanoti": "That would be great, I recently came across with the same problem.\n. Hi, I have also a config file with a high numbers of URLs to test and one thing that really sped up the process was putting resize_or_reload: reloadon the config file.\n. Hi @balaspace , I created a simple script to update the config.yaml file with the URLs I needed.\n. ",
    "mcgoooo": "indeed, would love this feature too\n. ",
    "amehreteab": "Restarting my computer fixed the issue, awesome app thanks!\nhttp://giphy.com/gifs/the-it-crowd-chris-odowd-F7yLXA5fJ5sLC\n. ",
    "micros123": "@ChrisBAshton Dynamic heights would be a great addition! But despite having built a Gem from your 'refactor' branch, screenshots keep defaulting to 1500px height. Any ideas on why it might not be able to detect the height? (We are using PhantomJS)\n. ",
    "chrowe": "I tested this and it seemed to be working. I didn't have to change anything in my configs yaml file. All I did was install the a new gem based on the branch and run wraith with my current config.\nInstall steps\ngem uninstall wraith //all versions\ngit clone git@github.com:BBC-News/wraith.git\ncd wraith/\ngit checkout remotes/origin/refactor\ngem build wraith.gemspec\ngem install ./wraith-3.2.0.gem. ",
    "thom8": "324 looks like a good solution but why not also add some simple args to override config?\nThis could even be environment vars that get evaluated inside the config file.\neg.\nDOMAIN1=http://domain1.local wraith capture /path/to/yaml\nYAML contains -->\ndomains:\n  prod: \"http://domain.prod\"\n  domain1: \"{{ DOMAIN1 }}\"\n. BTW this is for a CI solution so each feature branch would have a different domain so we don't want to add conf per branch. Otherwise we'd have feature1.yml, feature2.yml etc\n. @tfrothingham-yottaa do you mind posting an example I'm looking into overriding the local DNS but I just know it will come back to bite me...\n. - it's not just domain settings I'm wanting to override\n. nice work!\nI'd considered the same but it sounds like for my current use case it might be easier to migrate to something that supports dynamic config..\nhttp://shoov.io/ looks promising... \n. ",
    "tfrothingham-yottaa": "I had to work through a similar problem, ended up wrapping wraith in another script that allowed me to put the parameters I needed in a run time.\n. What I had to do was actually pretty involved as what needed to be tested is really outside the scope of what Wraith is intended for.  What it boiled down to was writing a set of small libraries that took in a data set and created the yaml files as well as custom js files to handle some custom headers.  In the end this fed into a system call, that provided Wraith with the correct information:\n` hconfig = '/configs/'+ site + yamlfile\n```\n  puts \"using config #{hconfig}\"\n  mpath = File.join(Dir.pwd, hconfig)\nbegin\nputs \"Starting wraith for #{site} using #{type} mode\"\nputs \"config file: #{mpath}\"\nsystem \"wraith #{type} #{mpath}\"\n\nrescue StandardError => error\n    puts \"not able to run wraith with #{mpath}\"\n    puts error.inspect\nnext\n\nend`\n```\n. That looks very interesting.\nBest of luck.\n. ",
    "theguythatrepeatedit": "Good day!\nDEBUG: #################################################\nDEBUG:   Command run:        capture configs/capture.yaml\nDEBUG:   Wraith version:     3.2.0\nDEBUG:   Ruby version:       ruby 2.2.4p230 (2015-12-16 revision 53155) [i386-mingw32]\nDEBUG:   ImageMagick:        Version: ImageMagick 6.9.3-8 Q16 x64 2016-04-10 http://www.imagemagick.org\nDEBUG:   PhantomJS version:  2.1.1\nDEBUG:   CasperJS version:   CasperJS not installed\nDEBUG: #################################################\nDEBUG:\nConfig validated. No serious issues found.\nCreating Folders\nSAVING IMAGES\n[...]\n. Interesting!\nmore C:/Ruby22/lib/ruby/gems/2.2.0/gems/wraith-3.2.0/lib/wraith/javascript/phantom.js\nInvalid parameter - /Ruby22\nThen I flip the slashes around:\nmore C:\\Ruby22\\lib\\ruby\\gems\\2.2.0\\gems\\wraith-3.2.0\\lib\\wraith\\javascript\\phantom.js\n// modules\nvar system = require('system'),\n    page   = require('webpage').create(),\n    helper = require('./_helper.js')(system.args[2]);\n.......\n.................\nI hardcoded it now in wraith.rb and ran into the exact same problem on the next opportunity :smiley: \nThanks alot Chris ! I probably should have spotted that myself hehe, will probably get around the other ones my self ;)\nHave a good weekend\n. Hi again, I don't know how I reopen - but the URL is not the problem, no connection will be made and all I have is the  general WARN out - this is facebook and github\n```\nF:\\wrth>wraith capture configs/capture.yaml\nDEBUG: #################################################\nDEBUG:   Command run:        capture configs/capture.yaml\nDEBUG:   Wraith version:     3.2.0\nDEBUG:   Ruby version:       ruby 2.3.0p0 (2015-12-25 revision 53290) [i386-mingw32]\nDEBUG:   ImageMagick:        Version: ImageMagick 6.9.3-8 Q16 x64 2016-04-10 http://www.imagemagick.org\nDEBUG:   PhantomJS version:  2.1.1\nDEBUG:   CasperJS version:   CasperJS not installed\nDEBUG: #################################################\nDEBUG:\nConfig validated. No serious issues found.\nCreating Folders\nSAVING IMAGES\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js' 'http://www.facebook.com/' '320' 'shots/home/320_phantomjs_current.png' 'body' 'F:/wrth/javascript/disable_javascript--phantom.js' 'false'\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js' 'http://github.com/' '320' 'shots/home/320_phantomjs_new.png' 'body' 'F:/wrth/javascript/disable_javascript--phantom.js' 'false'\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js' 'http://www.facebook.com/' '600x768' 'shots/home/600x768_phantomjs_current.png' 'body' 'F:/wrth/javascript/disable_javascript--phantom.js' 'false'\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js' 'http://github.com/' '600x768' 'shots/home/600x768_phantomjs_new.png' 'body' 'F:/wrth/javascript/disable_javascript--phantom.js' 'false'\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js' 'http://www.facebook.com/' '768' 'shots/home/768_phantomjs_current.png' 'body' 'F:/wrth/javascript/disable_javascript--phantom.js' 'false'\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js' 'http://github.com/' '768' 'shots/home/768_phantomjs_new.png' 'body' 'F:/wrth/javascript/disable_javascript--phantom.js' 'false'\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js' 'http://www.facebook.com/' '1024' 'shots/home/1024_phantomjs_current.png' 'body' 'F:/wrth/javascript/disable_javascript--phantom.js' 'false'\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js' 'http://github.com/' '1024' 'shots/home/1024_phantomjs_new.png' 'body' 'F:/wrth/javascript/disable_javascript--phantom.js' 'false'\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nWARN: Failed to capture image shots/home/600x768_phantomjs_current.png on attempt number 1 of 5\nWARN: Failed to capture image shots/home/768_phantomjs_current.png on attempt number 1 of 5\nWARN: Failed to capture image shots/home/320_phantomjs_current.png on attempt number 1 of 5\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nWARN: Failed to capture image shots/home/1024_phantomjs_current.png on attempt number 1 of 5\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nWARN: Failed to capture image shots/home/320_phantomjs_new.png on attempt number 1 of 5\nWARN: Failed to capture image shots/home/600x768_phantomjs_new.png on attempt number 1 of 5\nWARN: Failed to capture image shots/home/768_phantomjs_new.png on attempt number 1 of 5\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nWARN: Failed to capture image shots/home/1024_phantomjs_new.png on attempt number 1 of 5\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nWARN: Failed to capture image shots/home/600x768_phantomjs_current.png on attempt number 2 of 5\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nWARN: Failed to capture image shots/home/768_phantomjs_current.png on attempt number 2 of 5\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nWARN: Failed to capture image shots/home/320_phantomjs_current.png on attempt number 2 of 5\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nWARN: Failed to capture image shots/home/768_phantomjs_new.png on attempt number 2 of 5\nWARN: Failed to capture image shots/home/1024_phantomjs_current.png on attempt number 2 of 5\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nWARN: Failed to capture image shots/home/320_phantomjs_new.png on attempt number 2 of 5\nWARN: Failed to capture image shots/home/600x768_phantomjs_new.png on attempt number 2 of 5\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nubWARN: Failed to capture image shots/home/1024_phantomjs_new.png on attempt number 2 of 5\nygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nWARN: Failed to capture image shots/home/600x768_phantomjs_current.png on attempt number 3 of 5\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nCCWARN: Failed to capture image shots/home/768_phantomjs_current.png on attempt number 3 of 5\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\nubygems\u263b.2.0gemswraith-3.2.0libwraithjavascriptmyphantom.js''\na\n``\n. .. OK I tried out a few things now\n Just to make sure - do you mean running the command like this ?C:\\Ruby23\\lib\\ruby\\gems\\2.3.0\\gems\\wraith-3.2.0\\lib\\wraith\\javascript>phantomjs phantom.js http://facebook.com/`\nFailed over and over until I found that the apostrophes in the arguments most likely is the problem - so this will fail:\nC:\\Ruby23\\lib\\ruby\\gems\\2.3.0\\gems\\wraith-3.2.0\\lib\\wraith\\javascript>phantomjs phantom.js 'http://www.facebook.com/' '768' 'shots/home/768_phantomjs_current.png' 'body' 'F:/wrth/javascript/disable_javascript--phantom.js' 'false'\nLoading 'http://www.facebook.com/' at dimensions: NaNx1500\nError with page 'http://www.facebook.com/'\nAnd this will pass\nC:\\Ruby23\\lib\\ruby\\gems\\2.3.0\\gems\\wraith-3.2.0\\lib\\wraith\\javascript>phantomjs phantom.js http://facebook.com/ 768 shots/home/768_phantomjs_current.png body F:/wrth/javascript/disable_javascript--phantom.js false\nLoading http://facebook.com/ at dimensions: 768x1500\nSnapping http://facebook.com/ at: 768x1500\n:)\nIs there something wrong with my system that makes it so intolerable to paths and apostrophes, a setting or something ?\nI am glad to have found another cause of failure, but not sure how I can fix this globally ? do you know\n. Oh lord, I finally made it! and I can not believe I'm the only one with this problem !? Maybe I'm the only one running Windows\nInside save_images.rb.construct_command - removed all variable apostrophes and hardcoded a new snapfile with double backslashes, like this:\n```\nsnap = \"C:\\Ruby23\\lib\\ruby\\gems\\2.3.0\\gems\\wraith-3.2.0\\lib\\wraith\\javascript\\phantom.js\"\n    command_to_run = \"#{meta.engine} #{wraith.phantomjs_options} #{snap} #{url} #{width} #{file_name} #{selector} #{global_before_capture} #{path_before_capture}\"\n```\nPHEW :) I can probably make a real fix later in the week if anyone is interested\n. ",
    "stephenbe": "I am getting the same error \nC:\\Projets\\Tests\\wraith>wraith capture configs/capture.yaml\nConfig validated. No serious issues found.\nCreating Folders\nSAVING IMAGES\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/javascript/phantom.js''\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/javascript/phantom.js''\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/javascript/phantom.js''\nCan't open ''C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/javascript/phantom.js''\nThe file really exists : \n\nI get the same error as @theguythatrepeatedit when I do the command \nmore C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/javascript\nI get this error :\nInvalid parameter - /Ruby22\nBecause of this error I cannot get wraith to work\nWindows 10\n. @SimonKeep It is working now thank you\nIf this helps anyone : \nnpm install -g phantomjs@1.9.19 and it works on windows\nThis should be documented because anyone that is on windows won't be able to use wraith\n. ",
    "Imlus": "How is this not fixed yet? :) @theguythatrepeatedit you are a saver.. ",
    "michael-ns": "The cmd getting executed: \nphantomjs  'C:/Ruby22-x64/lib/ruby/gems/2.2.0/gems/wraith-3.2.1/lib/wraith/javascript/phantom.js' 'http://www.google.com/' '1024' 'shots/home/1024_phantomjs_current.png' 'body' 'false' 'false'\nIf I executed this cmd from the console, it works just fine for both phantomjs v1.9.8 & v2.1.1\nDid a quick fix which strips out the single quote from the cmd which works fine for both version.\nPR: https://github.com/BBC-News/wraith/pull/479\n. well spotted, thanks @ChrisBAshton \n. ",
    "balaspace": "@wjanoti how do you import a file into the config.yaml ?\n. cheers, thanks\n. ",
    "mramitanand": "So I am doing a capture with 1000 urls and i get the following error at the end when it is trying to create the gallery. If I do a small amount like 5-10 it works fine so dont think its my ruby version. Anybody have any ideas? Thanks\nGENERATING THUMBNAILS\nGENERATING GALLERY\n/usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/gallery.rb:71:in get_path': undefined method[]' for nil:NilClass (NoMethodError)\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/gallery.rb:65:in figure_out_url'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/gallery.rb:53:inmatcher'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/gallery.rb:40:in block (2 levels) in match'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/gallery.rb:38:inforeach'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/gallery.rb:38:in block in match'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/gallery.rb:35:ineach'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/gallery.rb:35:in match'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/gallery.rb:31:inparse_directories'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/gallery.rb:142:in generate_gallery'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/cli.rb:114:inblock in generate_gallery'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/helpers/utilities.rb:4:in within_acceptable_limits'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/cli.rb:111:ingenerate_gallery'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/cli.rb:128:in block in capture'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/helpers/utilities.rb:4:inwithin_acceptable_limits'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/lib/wraith/cli.rb:120:in capture'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/thor-0.19.4/lib/thor/command.rb:27:inrun'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/thor-0.19.4/lib/thor/invocation.rb:126:in invoke_command'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/thor-0.19.4/lib/thor.rb:369:indispatch'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/thor-0.19.4/lib/thor/base.rb:444:in start'\n    from /usr/local/rvm/gems/ruby-2.3.3/gems/wraith-4.0.1/bin/wraith:5:in'\n    from /usr/local/rvm/gems/ruby-2.3.3/bin/wraith:22:in load'\n    from /usr/local/rvm/gems/ruby-2.3.3/bin/wraith:22:in'\n    from /usr/local/rvm/gems/ruby-2.3.3/bin/ruby_executable_hooks:15:in eval'\n    from /usr/local/rvm/gems/ruby-2.3.3/bin/ruby_executable_hooks:15:in'\n. Actually I discovered what is wrong - in my paths section I had a few entries like\n404:   404.html\nFor some reason it wont take numeric it looks like. \n. The exact same error is happening for me and I am only running against current production domain. I tried using both the capture.yaml and the spider.yaml config files with same result.. Fails for me with following:\nwraith spider spider.yaml\nDEBUG: #################################################\nDEBUG:   Command run:        spider spider.yaml\nDEBUG:   Wraith version:     4.0.0\nDEBUG:   Ruby version:       ruby 1.9.3p484 (2013-11-22 revision 43786) [x86_64-linux]\nDEBUG:   ImageMagick:        Version: ImageMagick 6.7.7-10 2016-11-29 Q16 http://www.imagemagick.org\nDEBUG:   PhantomJS version:  1.9.0\nDEBUG:   CasperJS version:   CasperJS not installed\nDEBUG: #################################################\nConfig validated. No serious issues found.\nCrawling https://www.fdic.gov\n/var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:298:in =~': type mismatch: String given (TypeError)\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:298:inblock in skip_link?'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:298:in each'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:298:inany?'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:298:in skip_link?'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:256:invisit_link?'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:151:in block in run'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:151:indelete_if'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:151:in run'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:92:inblock in crawl'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:83:in initialize'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:90:innew'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:90:in crawl'\n    from /var/lib/gems/1.9.1/gems/anemone-0.7.2/lib/anemone/core.rb:18:incrawl'\n    from /var/lib/gems/1.9.1/gems/wraith-4.0.0/lib/wraith/spider.rb:25:in crawl'\n    from /var/lib/gems/1.9.1/gems/wraith-4.0.0/lib/wraith/cli.rb:45:inblock in spider'\n    from /var/lib/gems/1.9.1/gems/wraith-4.0.0/lib/wraith/helpers/utilities.rb:4:in within_acceptable_limits'\n    from /var/lib/gems/1.9.1/gems/wraith-4.0.0/lib/wraith/cli.rb:42:inspider'\n    from /var/lib/gems/1.9.1/gems/thor-0.19.4/lib/thor/command.rb:27:in run'\n    from /var/lib/gems/1.9.1/gems/thor-0.19.4/lib/thor/invocation.rb:126:ininvoke_command'\n    from /var/lib/gems/1.9.1/gems/thor-0.19.4/lib/thor.rb:369:in dispatch'\n    from /var/lib/gems/1.9.1/gems/thor-0.19.4/lib/thor/base.rb:444:instart'\n    from /var/lib/gems/1.9.1/gems/wraith-4.0.0/bin/wraith:5:in <top (required)>'\n    from /usr/local/bin/wraith:23:inload'\n    from /usr/local/bin/wraith:23:in `'\n. I commented this section out of spider.yaml and now it works for - future reference I noticed in issue #401  that this was similar issue:\nspider_skips:\n- /foo/bar.html           # Matches /foo/bar.html explicitly\n- !ruby/regexp /^\\/baz\\// # Matches any URLs that start with /baz\n. Im need help with this as well!. @pcraig3 How did you resolve this? Also how do you pass options to clear cache from phantomjs? Id appreciate any info thanks!!. Thanks for responding! So Ive done a couple of things which I found here and on the internet to help me resolve some of our issues. The first is for when it hangs (I am running on sets of 10k so it does hang for me), @JimBledsoe wrote a script that will kill any hung phantomjs process' and wraith should restart it (upto 5 times I believe). That issue and script is here:\nhttps://github.com/BBC-News/wraith/issues/461\nTo clear my cache, I followed this link and appended an \"?wraith\" to each line of my paths.\nhttps://www.phase2technology.com/blog/wrestling-with-wraith-quick-and-dirty-visual-regression-testing/\nAs described:\n\"I also sometimes find that it\u2019s useful to add \u201c?wraith\u201d to the ends of each path, so that you can see which requests are coming from Wraith in logs/analytics if needed. This can also be useful for busting caches to make sure you\u2019re testing fresh pages, not cached ones.\"\nIll try to use what you put and see if works for me. Thank you!!\n. ",
    "muralir87": "Hi SimonKeep, \nCan you elaborate this in detail, even am facing the same issue.\nPlease help me out here as am new to phantomjs browser and image comparison.\nIf u explain authentication with step by step configuration it will be more helpful.\nRegards\nMurali\n. ",
    "maxtedford": "I'd love to see this merged in. Is there anything preventing that at the moment?\n. ",
    "patriciamarchand": "I try to run convert -version but it doesn't work. So I downgraded imagemagick to previous version imagemagick 6.9.5-Q8 and it seems to be working now. I think you are right, the new version has changed something. In fact the change the command line script from convert to magick.\n. will you update Wraith to support the new version of ImageMagick? \n. ",
    "krelde": "When installing ImageMagick 7 make sure to check \"Install legacy utilities\"\n\n. When installing ImageMagick 7 make sure to check \"Install legacy utilities\"\n\n. ",
    "xiaoping0x": "Microsoft FAT NTFS utility C:\\Windows\\System32\\convert.exe conflict with ImageMagic convert.exe, will cause wraith check failed.\nI can rename system utility for now. but I think imagemagic need rename executable filenames.\n. ",
    "rayferns": "Thanks for that, I applied the changes as you said and it works.\nI took it a step further, to add more than one CSS selector on a page, like this:\npaths: \n   Retailer:\n    path: /find-a-retailer\n    selector: '.tab.retailer>a'\n   Home:\n    path: /\n    selector: '#header'\n    selector: '#footer'\nre-running wraith capture does the job returns errors:\nConfig validated. No serious issues found.\nCreating Folders\nSAVING IMAGES\nDEBUG: casperjs --ssl-protocol=tlsv1 --ignore-ssl-errors=yes 'C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/javascript/casper.js' 'http://www.volkswagen.co.uk/find-a-retailer' '600x800,320x533,750x1334' 'Retailers_CSS_Selector_shots/Retailer/MULTI_casperjs_Live.png' '\\#retailer-search' 'C:/VisualRegression/javascript/wait--casper.js' 'false'\nDEBUG: casperjs --ssl-protocol=tlsv1 --ignore-ssl-errors=yes 'C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/javascript/casper.js' 'http://origi\nn-vw03.vwcloud.co.uk/find-a-retailer' '600x800,320x533,750x1334' 'Retailers_CSS_Selector_shots/Retailer/MULTI_casperjs_Origin_VW03.png' '\\#retailer-search' 'C:/VisualRegression/javascript/wait--casper.js' 'false'\nDEBUG: casperjs --ssl-protocol=tlsv1 --ignore-ssl-errors=yes 'C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/javascript/casper.js' 'http://www.volkswagen.co.uk/' '600x800,320x533,750x1334' 'Retailers_CSS_Selector_shots/Home/MULTI_casperjs_Live.png' '\\#footer' 'C:/VisualRegression/javascript/wait--casper.js' 'false'\nDEBUG: casperjs --ssl-protocol=tlsv1 --ignore-ssl-errors=yes 'C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/javascript/casper.js' 'http://origin-vw03.vwcloud.co.uk/' '600x800,320x533,750x1334' 'Retailers_CSS_Selector_shots/Home/MULTI_casperjs_Origin_VW03.png' '\\#footer' 'C:/VisualRegression/javascript/wait--casper.js' 'false'\nSnapping http://origin-vw03.vwcloud.co.uk/find-a-retailer at: 600x800\nSnapping http://www.volkswagen.co.uk/find-a-retailer at: 600x800\nSnapping http://origin-vw03.vwcloud.co.uk/ at: 600x800\nSnapping http://www.volkswagen.co.uk/ at: 600x800\nCROPPING IMAGES\nProcess.fork is not supported by this Ruby\nCOMPARING IMAGES\nProcess.fork is not supported by this Ruby\nGENERATING THUMBNAILS\nProcess.fork is not supported by this Ruby\nGENERATING GALLERY\nC:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/gallery.rb:124:in `block in sort_by_diffs': undefined method `[]' for nil:NilClass (NoMethodError)\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/gallery.rb:122:in `each'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/gallery.rb:122:in `sort_by'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/gallery.rb:122:in `sort_by_diffs'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/gallery.rb:114:in `sorting_dirs'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/gallery.rb:45:in `match'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/gallery.rb:31:in `parse_directories'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/gallery.rb:142:in `generate_gallery'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/cli.rb:125:in `block in generate_gallery'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/cli.rb:28:in `within_acceptable_limits'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/cli.rb:122:in `generate_gallery'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/cli.rb:140:in `block in capture'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/cli.rb:28:in `within_acceptable_limits'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/cli.rb:131:in `capture'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/command.rb:27:in `run'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/invocation.rb:126:in `invoke_command'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor.rb:359:in `dispatch'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.1/lib/thor/base.rb:440:in `start'\nfrom C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/bin/wraith:5:in `<top (required)>'\nfrom C:/Ruby23-x64/bin/wraith:23:in `load'\nfrom C:/Ruby23-x64/bin/wraith:23:in `<main>'\nLooking a the snapping folders; they are empty.\nAm I doing something wrong here?\nThanks,\n. \nThanks, that generates gallery successfully in MS Dos without any errors. However, the html gallery page returns blank for HomeHeader and HomeFooter hyperlinks. Only Retailer category shows up. Is this an issue with hash CSS Selector? I'm using Firefox Firepath addin to identify CSS selectors for the areas I need to verify. Is there a workaround to this? See above screenshot\n. I had tried\nmode: diffs_first\nand\nmode: alphanumeric\nFiles generated are:\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Home\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Home\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\1280x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\1280x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\1280x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\320x533_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\320x533_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\320x533_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\600x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\600x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\600x800_casperjs_Origin_VW06.png\nThe Retailers folder is fine, but the Home folder is empty\n. Replaced the path headers as you said.\npaths: \n       Retailer:\n         path: /find-a-retailer\n         selector: '.tab.retailer>a'\n   home_header:\n         path: /\n         selector: '#header'\n   home_footer:\n         path: /\n         selector: '#footer'\nThe folders and sub folders were created, however, the home_header and home_footer subfolders were empty.\nHere is the file list:\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\gallery.html\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_footer\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_footer\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_header\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\1280x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\1280x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\1280x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\320x533_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\320x533_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\320x533_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\600x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\600x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\600x800_casperjs_Origin_VW06.png\nRuntime errors:\n\nDEBUG: casperjs --ssl-protocol=tlsv1 --ignore-ssl-errors=yes 'C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/javascript/casper.js' 'http://www.volkswagen.co.uk/' '600x800,320x533,1280x800' 'Retailers_CSS_Selector_shots/home_footer/MULTI_casperjs_Live.png' '\\#footer' 'false' 'false'\nDEBUG: casperjs --ssl-protocol=tlsv1 --ignore-ssl-errors=yes 'C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-3.2.0/lib/wraith/javascript/casper.js' 'http://origin-vw06.vwcloud.co.uk/' '600x800,320x533,1280x800' 'Retailers_CSS_Selector_shots/home_footer/MULTI_casperjs_Origin_VW06.png' '\\#footer' 'false' 'false'\n\n\n. That works fine, files are generated in home_header folder. But I need to select the Headers and Footers.\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\gallery.html\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_footer\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\1280x800_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\1280x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\1280x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\1280x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\320x533_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\320x533_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\320x533_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\320x533_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\600x800_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\600x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\600x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\home_header\\600x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\1280x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\320x533_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_data.txt\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\Retailer\\600x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_footer\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_header\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_header\\1280x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_header\\1280x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_header\\1280x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_header\\320x533_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_header\\320x533_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_header\\320x533_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_header\\600x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_header\\600x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\home_header\\600x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\1280x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\1280x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\1280x800_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\320x533_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\320x533_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\320x533_casperjs_Origin_VW06.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\600x800_casperjs_diff.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\600x800_casperjs_Live.png\nC:\\VisualRegression\\Retailers_CSS_Selector_shots\\thumbnails\\Retailer\\600x800_casperjs_Origin_VW06.png\n. Yes, that's the best option, by not using ID's as CSS Selectors, but '.'. This ticket can now be closed.\n. Sure, no problem. Thanks for resolving this.\n. RemoveSelectors and HideSelectors is not documented in Wraith docs, I googled this and found it from Node JS backstopJS project. Was eagerly looking for solutions.\n. ",
    "andreilupu": "I just encountered this issue, but I think it is easy to use a selector like:\ndiv[id=header]\nAlso, there is a semantic win in this formula in my opinion.. ",
    "jorgelopezlago": "Just confirming this issue is still present. It is an important limitation for wraith.. I have wraith 4.2.1 and I have tried the following selector types to no avail; all of them fail either for being considered invalid or illegal:\ndiv#value\ndiv[id=value]\n.class:nth-child()\n.class:nth-of-type()\nNone of them work. It seems that the selectors capability in wraith/casperjs is very very limited.. ",
    "erikahlswede": "I believe capture only compares 2 domains.\nWhat you could do is create a baseline (wraith history) and have multiple configs for running regressions against the baseline:\nwraith latest domain1.yaml\nwraith latest domain2.yaml\nwraith latest domain3.yaml\nWhat you won't get from this is a diff between each of the environments\n. ",
    "spsmanikandan": "Could someone help me with the steps for downgrading from Phantomjs 2.1.1 to 1.9.8?. ",
    "Stanton": "I have the same issue (I believe), I have 417 paths being captured. restarting my local machine allows my task to complete, but that's far from ideal.\nDEBUG: #################################################\nDEBUG:   Command run:        latest wraith.yml\nDEBUG:   Wraith version:     3.2.1\nDEBUG:   Ruby version:       ruby 2.3.0p0 (2015-12-25 revision 53290) [x86_64-darwin16]\nDEBUG:   ImageMagick:        Version: ImageMagick 6.9.5-9 Q16 x86_64 2016-09-10 http://www.imagemagick.org\nDEBUG:   PhantomJS version:  2.1.1\nDEBUG:   CasperJS version:   1.1.2\nDEBUG: #################################################\nDEBUG:\nConfig validated. No serious issues found.\n. ",
    "seanw": "@Sabbi0612 Trying PhantomJS 2.5 beta as it appears to have much improved flexbox support. . ",
    "alexharris": "@seanw Any luck with 2.5? I installed phantomjs with homebrew, which only provides up to 2.1.1, but could try to manually switch to 2.5 if flexbox support is there. ",
    "iget-master": "There is a release date for 2.5? Flex box feature is really f*cking me :(. ",
    "automagisch": "Turns out that the Safari fix doesn't solve everything.. A lot, but not everything.\nTo get around, I created a little hack I call 'the casper tweak'. The idea is to have casper set a 'casper-env' class to the body of the headless page (so it will not interfere with the application when displayed through Chrome), and catch up on it in your css to disable flex properties in the application casper is looking at. \nI am aware that this is far from optimal and goes against every design principle of regressive testing, but in my case the flexbox property was not subjective to the test, but nonetheless the bug rendered the page useless, so I came up with this gist to get around that:\nhttps://gist.github.com/automagisch/7ad2be5ee75b27e10111971b6394918b\nIt allows for checking if the env class had been set, and respond in your (s)css to that class change, so I would set a 'display: flex' to 'display: block' for Casper, so I can still test my functionalities :). \n\ndefinitly not a fix, but untill phantomjs2.5 is released this works pretty well (at least for me - as a last resort :p).. \n",
    "raivisdejus": "Thanks for noting. Funny that I did not see this comment in example configs myself.\nCheers!\n. ",
    "Dahie": "We did not get casperjs to work, but that's a different topic. With phantomjs, this is what happens for us:\nIn wraith /lib/javascripts/phantom.js:58 it opens the target url a first time. This target URL requires login, so it redirects to our login page and the callback function within this call already has page.url != url as page.url now contains the url of the login and not the target.\nNow in the before-capture.js outside of wraith in our configuration, the phantom/page object already contains the wrong login-url and not the expected target-url.\nPlease enlighten me, how to handle this without changing the gem, if I can avoid that I'm all for it. :)\nThanks for taking the time.\n. Yeah, we have server-side redirects. Thanks for considering! :)\n. Hi, any news on your considerations? We'd like to see this in wraith and mothball our forked. :)\n. ",
    "KaiHotz": "@ChrisBAshton Those are nice changes that Dahie proposes, when could we see this integated ?. ",
    "EXPEsatgupta": "Is there any update on this, I am also facing the same issue.. ",
    "thedaviddias": "Same issue for me. I've got the same message with Ruby 2.3.0.\n. ",
    "sramzan": "Awesome, thanks for the update @ChrisBAshton! Apologies for such a delayed response.\nFor some others you come across, setting a proxy may also help. That's how I was ultimately able to resolve my issue if it helps at all.\n. ",
    "vishall": "wraith: command not found issue \nI have these things installed\n1)ruby 2.6.1p33 (2019-01-30 revision 66950) [x86_64-darwin16]\n2)phantomjs -v\n2.1.1\n3)imagemagick 7.0.8-28 already installed\nPlease help. ",
    "darciew": "@vishall I was having the same issue - try installing an older version of Ruby with rvm and running gem install wraith again. \nI used ruby 2.5.1 and the wraith installation was successful.\nNot sure if this is a known issue with ruby 2.6.1?. ",
    "BernsteinA": "bug is on https://github.com/BBC-News/wraith/blob/master/lib/wraith/spider.rb line 66\nit's expecting spider_days to be an array.\nso, as a workaround, change spider_days: 10 to \nspider_days:\n  - 10\n. ",
    "richiekastl": "Just FYI for anybody else experiencing this issue, I had to downgrade to PhantomJS 1.9.7. I kept getting a security error with PhantomJS 1.9.8.\n. ",
    "jjok": "I don't think you need to do steps 2 and 5. They happen automatically when you first do docker run ..... Oh, never mind. I didn't have to do those steps because I manually created a config file.. ",
    "Screenack": "One other thing: I was running a test against \"127.0.0.1\" which is inaccessible from the container. I used \"host.docker.internal\" instead, and wraith was able to access my local instance. Read here for more information.. ",
    "akiessling": "The spider command overwrites the file that is configured with imports. So you can't save a common configuration to that file AND have the spider command update the paths. Maybe the paths should be loaded from a separate file? . YAML.load does not return an empty hash, if the file is empty. If i add a dummy config like this, the spider starts to crawl.\n~~~\nfoo: bar\n~~~. ",
    "ajoah": "Hi @ChrisBAshton \nI'm trying to use this new command but i may have missed something because if i use this config exemple : http://bbc-news.github.io/wraith/configs.html#Spiderconfig ,\nI get : \nwraith spider configs/demo.yml\nConfig validated. No serious issues found.\nERROR: unable to find referenced imported config \"paths_generated_by_spider.yml\". ",
    "alecgibson": "I get the same thing. Is there something we need to configure to run these tests locally?. Aha. This fix only works in \"history\" mode and not in eg \"capture\" mode. Will close for now, because I don't have time to rethink it.. ",
    "charu-jain": "Did it. Still getting following error\nC:\\wraith>wraith generate_gallery config\nGENERATING GALLERY\n(erb):38:in `block (2 levels) in get_binding': undefined method `>' for nil:NilClass (NoMethodError)\n        from (erb):32:in `each'\n        from (erb):32:in `block in get_binding'\n        from (erb):31:in `each'\n        from (erb):31:in `get_binding'\n        from C:/Ruby23-x64/lib/ruby/2.3.0/erb.rb:864:in `eval'\n        from C:/Ruby23-x64/lib/ruby/2.3.0/erb.rb:864:in `result'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.0/lib/wraith/gallery.rb:158:in `generate_html'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.0/lib/wraith/gallery.rb:145:in `generate_gallery'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.0/lib/wraith/cli.rb:114:in `block in generate_gallery'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.0/lib/wraith/helpers/utilities.rb:4:in `within_acceptable_limits'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.0/lib/wraith/cli.rb:111:in `generate_gallery'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.4/lib/thor/command.rb:27:in `run'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.4/lib/thor/invocation.rb:126:in `invoke_command'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.4/lib/thor.rb:369:in `dispatch'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/thor-0.19.4/lib/thor/base.rb:444:in `start'\n        from C:/Ruby23-x64/lib/ruby/gems/2.3.0/gems/wraith-4.0.0/bin/wraith:5:in `<top (required)>'\n        from C:/Ruby23-x64/bin/wraith:22:in `load'\n        from C:/Ruby23-x64/bin/wraith:22:in `<main>'. Yeah.. I am working with local image folders & so giving names manually. I just tried out commands crop_images, compare_images, generate_thumbnails & then generate_gallery on these folders. Now it works for filenames without . & - in them + commenting out domain property [though i didn't get why do we need domains!!!!]. Gallery generated successfully. Thanks.. ",
    "gbeveridge": "I am have this same issue with the default spider.yaml config files. \nDEBUG: #################################################\nDEBUG:   Command run:        spider configs/spider.yaml\nDEBUG:   Wraith version:     4.0.0\nDEBUG:   Ruby version:       ruby 2.3.3p222 (2016-11-21 revision 56859) [x86_64-darwin16]\nDEBUG:   ImageMagick:        Version: ImageMagick 6.9.6-8 Q16 x86_64 2016-12-12 http://www.imagemagick.org\nDEBUG:   PhantomJS version:  2.1.1\nDEBUG:   CasperJS version:   1.1.2\nDEBUG: #################################################. ",
    "pcambra": "Same here\nwraith spider configs/spider.yaml \nDEBUG: #################################################\nDEBUG:   Command run:        spider configs/spider.yaml\nDEBUG:   Wraith version:     4.0.0\nDEBUG:   Ruby version:       ruby 2.0.0p648 (2015-12-16 revision 53162) [universal.x86_64-darwin15]\nDEBUG:   ImageMagick:        Version: ImageMagick 6.9.5-4 Q16 x86_64 2016-07-30 http://www.imagemagick.org\nDEBUG:   PhantomJS version:  2.1.1\nDEBUG:   CasperJS version:   CasperJS not installed\nDEBUG: #################################################\nConfig validated. No serious issues found.\nERROR: unable to find referenced imported config \"spider_paths.yaml\"\nIt would appear that this commit was intended to fix this very same issue: https://github.com/BBC-News/wraith/commit/a8c968a830d15f60e0044819266700f18fb42a20\nAdding a spider_paths.yaml file in the configs folder with the following content solves the issue:\npaths:\n  home: /. ",
    "preda-bogdan": "Thank you @pcambra It solved the issue for me.. ",
    "micheal-cooper": "@ChrisBAshton, I just installed version 4.0.1 using brew, but to get spider working, I had to add config/spider_paths.yml (thank you, @pcambra) and comment out the spider_skips (thank you, @mramitanand), so this issue does not seem to be fixed.. ",
    "bartlangelaan": "Ignore this message. There was more then one fault in my config yaml file. \nMaybe it's an idea to show more useful error messages if there is an incorrect formatting of the domains, or the paths? Makes this a lot more user-friendly \ud83d\udc4d :-)\nClosing this issue.. ",
    "slefevre": "What was the issue? I'm getting this error. \nAlso, I'm getting this line:\nConfig validated. No serious issues found.. I figured out my problem. \nThe configs/history.yaml came with this stanza out of the box:\n```\n(required) The paths to capture. This particular config is using casperjs, so we can take screenshots of selectors rather than the entire page.\npaths:\n  clickable_guide:\n    path: /news/entertainment-arts-27221191\n    selector: '.idt__news' # (optional) selector to take a screenshot of\n```\nHowever, when I changed it to this, it caused the error:\n```\n(required) The paths to capture. This particular config is using casperjs, so we can take screenshots of selectors rather than the entire page.\npaths:\n  home_page:\n    path: /\n```\nChanging it to this stopped the error:\n# (required) The paths to capture. This particular config is using casperjs, so we can take screenshots of selectors rather than the entire page.\npaths:\n  home-page: /\n. ",
    "ThomasWunderlich": "Looks like the build is erroring out because the current version of nokogiri requires ruby >= 2.1.0.  Do you want to pin nokogiri to an older version or should I upgrade the ruby version?. @ChrisBAshton ,\nThanks for the quick fix. Wraith is now building with my fix. ",
    "pcraig3": "Hey!  Thanks for the interest.\n> How did you resolve this?\nUnfortunately, I haven\u2019t had any success getting this to work reliably on our project, although I have noticed that there seem to be specific conditions under which it fails.  \nRunning Wraith against a couple of other projects we work on or against our live site seems to work much more reliably than the local version of the project I linked to \u2014 I think this means that it\u2019s not getting something back that it expects in the response from the makeshift server we\u2019re running in this project, but since filing this I\u2019ve been working on other things and I haven\u2019t had much more time to look into it.\n> Also how do you pass options to clear cache from phantomjs?\nSetting default parameters for phantomjs seems to be something you can do with the JavaScript files you run before opening each page (this one is a good example ), so the way that I added this line to my JS file to be run before the thing.\nphantom.clearMemoryCache();\nWhich I found in this stack overflow answer. \nDidn\u2019t actually help solve my particular problem though, so it might not be what you\u2019re looking for.. ",
    "micron": "I am experiencing the same issue. Wraith hangs on the last url. I'm running wraith in the container https://hub.docker.com/r/bbcnews/wraith/ tagged 6eac3f399c56fc54bdbfd973908b190defa9c6cf74958900e0042118ed726f33.\nThe site which I compare against (current) is on the internet. The (new) site which I run the test against is inside a container which is linked with the wraith container. My setup looks like this:\ndocker run -d --name=wraith_new -v $PROJECT_ROOT/public:/usr/share/nginx/html nginx\ndocker run -it -v $(pwd):/wraithy -w='/wraithy' --link wraith_new:wraith_new bbcnews/wraith capture config.yml\n\nUnfortunately wraith hangs always on the last url, no matter if I lower the amount of pages.\nI'll try to publish both pages on a webserver to see if it still hangs when both pages are on the web and I'll share my findings here.. ",
    "pivica": "We had the same issue on local dev Linux machines - we wanted to compare live instance with local dev instance. Wraith was hanging on the last URL check all the time and was only working with a couple of test URLs, but as soon as we have 7-8 or more URLs it was failing.\nWe tried all recommended solutions in this and other issues and none of them worked. Finally we started changing web drivers so:\n\nphantomjs - NOT working, hanging on last URL.\ncasperjs - NOT working, hanging on last URL.\nslimerjs - NOT working, not compatible with latest Firefox Quantum engine.\nchrome - WORKS!\n\nChrome driver support landed recently in https://github.com/BBC-News/wraith/pull/541 and I would just recommend everybody just to use this and nothing else. Its solving last URL hanging issue and it is also faster in execution. At least until slimerjs is fixed to work with latest Firefox engine this is the best option for now.. > You may also want to run wraith setup_folders /path/to/config.yaml manually before you run wraith latest /path/to/config.yaml\nDidn't work for me really, was getting bunch of errors when executing wraith latest history  like \nERROR: No such file or directory @ rb_sysopen - shots/...\non saving images step and fatal error on the end.\nAlso manually executing steps like\nwraith reset_shots history\nwraith setup_folders history # missing step\nwraith save_images history\nwraith copy_base_images history\nwraith crop_images history\nwraith compare_images history\nwraith generate_thumbnails history\nwraith generate_gallery history\nIs not working. I think because of a true parameter passed in save_images(config, true) in the method in wraith/cli.rb - you can't pass that parameter over wraith save_images cli command.\nThe only reliable way to make this work was to manually patch cli.rb as in 4f43aca26.. > Add base_path and compare_path options for paths #585\nIf somebody is interested in this, on top of above great patch from @stevenday, the next very basic patch from https://gist.github.com/pivica/56014df4a0c6054c2f4d6c0a3abfbc35 adds support for base_path and compare_path selectors like:\npaths:\n  different-source-and-target:\n    base_path:             /source-path\n    base_path_selector:    \".source-path-selector\"\n    compare_path:          /different-target-path\n    compare_path_selector: \".compare-path-selector\". ",
    "andrei-a-papou": "@pivica  SlimerJS beta should support Firefox 57+ (https://download.slimerjs.org/releases/1.0.0-beta.1/).. ",
    "kud": "I'm using Wraith right now and I still have this problem. I use phantomjs.. How do you use Chrome in Wraith?. Chrome support seems to work by using browser: \"chrome\". However, aborting wraith during processing isn't as smooth as it is with phantomjs. Lots of errors coming from this trigger.. Okay I got it. Sorry for the disturbing. It's about \"vh\" in css and the content in my page. I have to fix this with a max-height. :). I think I could make a configuration file for each path but it could be slower and I'm not sure I'll be glad about having multiple results instead of one (for the generated thumbnails).. ",
    "max4ever": "Ok, it was painfull to get normal chrome to work. \nBut at least it doesn't freezes at the end like it does with casperjs.\n(For mac you need an alias in your ~/.bash_profile\nalias chrome=\"/Applications/Google\\ Chrome.app/Contents/MacOS/Google\\ Chrome\"\nor see https://medium.com/@anotherplanet/how-to-use-headless-chrome-on-apple-osx-d9f7f3a54983)\ncapture.yaml\n```yaml\nbrowser: \"chrome\"\n...\npaths:\n  login_page: /backend/index.php\nbackend01 : /backend/index.php?content=228 # test\n  backend001 : /backend/index.php?content=85 # test\n  backend0001 : /backend/index.php?content=355 # test\n  backend00001 : /backend/index.php?content=31 # test\n...\n(optional) JavaScript file to execute before taking screenshot of every path. Default: nil\nbefore_capture: '../javascript/login-backend.js'\nverbose: true\nsettle: 30 #(optional: integer) Number of seconds to wait for the page to settle (when using Chrome as the headless browser)\nthreads: 1 #(optional: integer) Number of capture threads to run simultanously\n(optional) Color to highlight the image diff. Default: 'blue'\nhighlight_color: red\n```\njavascript/login-backend.js\n```javascript\nvar original_url_asked = document.referrer;\nif (typeof jQuery !== 'undefined') {//maybe 500 or 404 page\n//we ended up on login page, let's login\n$('body > form > input[type=\"password\"]').prop('value', 'PASSWORD');\n$('body > form > input[type=\"text\"]').prop('value', 'USERNAME');\n$('body > form > input[type=\"submit\"]').click();//submit form\n\n//we are logged in\n$('body').empty();//clear all the stuff\n//since we can't redirect, we'll open a full page iframe with the url we wanted to see initially\n$('body').append('<div style=\"position:absolute; left: 0; right: 0; bottom: 0; top: 0px;\"><iframe id=\"frame\" width=\"100%\" height=\"100%\" frameborder=\"0\" src=\"\" ></iframe></div>');\n\n\n$(\"#frame\").load(function () {\n    //we are inside the iframe\n    if (typeof jQuery !== 'undefined') {//maybe 500 or 404 page\n        $(this).contents().find('#root div.backend_left').remove();//delete the menu, because it is usually not equal\n        $(this).contents().find('#root div.backend_right_top').remove();//delete the top bar\n    }\n});\n\n//load that original_url finally\n$(\"#frame\").attr(\"src\", original_url_asked);//cannot redirect or wraith complains\n\n}\n//important or wraith will not understand it is ready to take a screenshot\nvar callback = arguments[arguments.length-1];\nsetTimeout(callback, 2000);\n```\nThis is my wraith info\nDEBUG: #################################################\nDEBUG:   Command run:        info\nDEBUG:   Wraith version:     4.2.3\nDEBUG:   Ruby version:       ruby 2.3.7p456 (2018-03-28 revision 63024) [universal.x86_64-darwin17]\nDEBUG:   ImageMagick:        Version: ImageMagick 7.0.8-16 Q16 x86_64 2018-12-10 https://imagemagick.org\nDEBUG:   PhantomJS version:  2.1.1\nDEBUG:   chromedriver version:  ChromeDriver 71.0.3578.33 (269aa0e3f0db08097f0fe231c7e6be200b6939f7)\nDEBUG:   CasperJS version:   1.1.4\nDEBUG: #################################################\nExecute by running:\nwraith capture capture.yaml\nif you get blank page, that's probably chrome and ssl problem, didn't find a fix, not even with \n```\n(optional) Parameters to pass to Phantom/Casper command line. Default: '--ignore-ssl-errors=true --ssl-protocol=tlsv1'\nphantomjs_options: \"some option here\"\n```. ",
    "Singletoned": "I have the same problem on OSX.  Not using nested directories solved it for me.  Thanks for pointing out the answer.. ",
    "kogoda": "Thanks for having a look. I can capture the core content with no problem. Unfortunately, we are progressively moving many of our pages to react. So I guess we are at the mercy of Phantom. Thanks once more for looking.. ",
    "anandshirkande": "Thanks Chris.\nAnyways I managed to resolved issue. Issue was with decode delegate for PNG images. I just installed libpng delegate and linked them before installing ImageMagick. That resolved my issue.. ",
    "lordgordon": "Very useful tutorial with example on how to capture screenshots with Chrome headless: https://developers.google.com/web/updates/2017/04/headless-chrome\nAlso useful: https://medium.com/@dschnr/using-headless-chrome-as-an-automated-screenshot-tool-4b07dffba79a. ",
    "fisherman90": "+1 For this, I'm considering using wraith but am unsure about the future-proofness if it's not compatible with headless chrome.. ",
    "lounikffm": "+1 Really looking forward to a headless Chrome Integration. ",
    "saulirajala": "Hi!\nI managed to add partial and straightforward support for headless Chrome. Please go ahead and test my solution: https://github.com/saulirajala/wraith/commit/988b705bdf3fdfaa7b16db4d1604e229ff8a4cc0\nSome notices about my solution:\n- Same config-file works as with PhantomJS. Just change the browser to chrome\n- Executing JavaScript-files before capture is not supported, so remember to disable all before_capture hooks.\n- Supports history-mode and both options for resize_or_reload-setting\n- Works only with Mac\n- Assumes that you have Chrome 59 with build-in support for headless execution and the path of the Chrome is /Applications/Google\\ Chrome.app/Contents/MacOS/Google\\ Chrome\nYou can test the solution by overwriting the files of your Wraith. In my computer they are located in /usr/local/lib/ruby/gems/2.3.0/gems/wraith-4.0.1. ",
    "shmargum": "Hey there, I was having some issues integrating the posted solution on OS X and I also wanted to run this as part of our CI\nI made a patch here with Chrome support which has JS before capture support, and works with Chrome on any OS.  It has capabilities of full screen screenshots as well as selector only screenshots.\nGitHub Fork & Branch: https://github.com/shmargum/wraith/tree/chromedriver\nThis relies on Chrome, which you already probably have installed if you are reading this.. This issue can be closed since the Chrome support has been merged.. there are 2 failing tests for chromedriver not being installed on Travis, I am not too sure how to address these\nthere are also 3 failing tests (which are also failing in master) for CasperJS:\nexpected: \"0.0\"\n      got: \"invalid\". I have updated the travis config to install chromedriver, but I am not sure how to address the 3 failing casperjs tests.. This is what a successful wraith setup should look like using this build:\nwraith setup\n      create  configs\n      create  configs/capture.yaml\n      create  configs/history.yaml\n      create  configs/spider.yaml\n      create  javascript\n      create  javascript/cookies_and_headers--casper.js\n      create  javascript/cookies_and_headers--phantom.js\n      create  javascript/disable_javascript--casper.js\n      create  javascript/disable_javascript--phantom.js\n      create  javascript/interact--casper.js\n      create  javascript/interact--chrome.js\n      create  javascript/interact--phantom.js\n      create  javascript/wait--casper.js\n      create  javascript/wait--chrome.js\n      create  javascript/wait--phantom.js\nThe chrome javascript samples are in there.\nIf you are talking about the capture yaml, you can update the one it generates to say \"chrome\" instead of \"phantomjs\"\nYou can have a look at the chrome capture yaml used in the specs: https://github.com/shmargum/wraith/blob/f74a10ebbe58024b5555fb1524ad347864fbc9c8/spec/configs/test_config--chrome.yaml. @ChrisBAshton not sure if you are the right person to approve/give feedback here, but just sending you a ping\nThere are 3 test failures here related to CasperJS which are also failing for me locally on master and am not too sure how I should address them, otherwise I think this PR is pretty complete.. or @wildlyinaccurate i don't know if you are the right person to ask for feedback here. I am not too sure how to get the tests passing on travis, I've definitely tried a few things.\nAny help is appreciated.\nThanks.. hooray i got the travis build passing\nvery long story short -- I added the --hide-scrollbars option to chrome. You are not seeing any errors? such as ERROR: Net::ReadTimeout\nI would suggest to only do a single comparison at a time locally, as the full job can take a while.\nAlso the gem is configured to run with a concurrency of 8, and there is currently no way to configure this (currently), so this could also be causing issues; again if you just do one comparison at a time this won't be a problem.. Hmm I am not sure what the reason is.\nSounds like the issue might be with chrome accessing your local server.  This can be related to your local setup or maybe the config.\nCan you paste your config? Maybe open a new issue as well.  See https://github.com/BBC-News/wraith/blob/master/.github/ISSUE_TEMPLATE.md\nIf you'd like to step through the code with binding.pry these are the related chrome lines:\nhttps://github.com/BBC-News/wraith/blob/master/lib/wraith/save_images.rb#L93-L137\nthis is the entry point to the chrome code:\nhttps://github.com/BBC-News/wraith/blob/master/lib/wraith/save_images.rb#L124. I'd say this is pretty stable; I've been running automated screenshot tests on chrome on a linux jenkins box after successful staging deployments to compare our staging and prod env for about a year now.  The only dependencies are ruby and chrome, so I would expect this to work on Windows as well.  This should even be able to run in docker, though I only recently started using docker myself.\nI can try to add some docs for the gh pages, not sure where to do that though.\nI'd also be down with stripping out some of the phantomjs code to clean things up. Just want to chime in and say that I am on a Mac 10.12.6 and am also using /etc/hosts to define some domain 127.0.0.1 local.www.REDACTED.com and the screenshots work fine.\nI am using 'chrome' as my browser here instead of phantom, but I don't know if that will make a difference.. I would recommend to try switching the browser in your config to chrome\nWhile it looks like there has been some recent activity in the phantomJS github, the author has stepped down from maintaining it.. @staylos92 do you want to have a look at this?\nI'd like to update the docs at github.io as well but not sure how to go about doing that\nI'd also be happy to become a maintainer on this project.  I'm at HuffPost (U.S. online news) and we actively use this for automated testing as part of our continuous integration.. Just a dev note here, need to add binary: '/path/to/binary' (parameterize this) to options constructor as per http://seleniumhq.github.io/selenium/docs/api/rb/Selenium/WebDriver/Chrome/Options.html\nThis would likely be set in the configs rather than an env variable, the config itself can use erb though to read env vars. I bumped the version since 2.3.3 is not installed by default on travis and 2.4.1 is. this would update all the system gems -- not sure why we need it\nbundler is always up to date by default, and this doesn't update the bundle which hasn't been installed yet. this is needed to get chrome working on travis. ",
    "lubosjerabek": "@saulirajala  @shmargum Guys how did you approach logging in scripts? I'm blocked as the before_capture hooks do not work for me. This is what I use:\ndocument.getElementById('Email').value = 'example@domain.com';\ndocument.getElementById('Next').click();\nI'm getting an error that the document unloaded when waiting for the click() function result. Any ideas how to do this? I might be able to force an auth cookie to the session but unsure how?. Also, good thing to point out:\n- When I remove either adding the email element value or clicking the next button it all works fine\n- I reckon this could be caused by the fact that the page does not load again (getting the other part of the form). ",
    "acbilimoria": "Wraith doesn't hang if you run phantomjs_hawk.txt, found in #461 . ",
    "wundo": "This looks un-maintained as well, I suggest we just remove that info from the README.. The Selenium-Wraith is not maintained anymore, we should remove it from the README.. ",
    "scrobbleme": "Generally it would be great to use properties from command line, which could be referenced within th yaml.. ",
    "tbal": "Can confirm this for Ubuntu 17.04. ruby-dev package is necessary to install wraith.. ",
    "michfuer": "I was seeing a similar error\n```\n$ sudo gem install wraith\nBuilding native extensions.  This could take a while...\nERROR:  Error installing wraith:\n    ERROR: Failed to build gem native extension.\ncurrent directory: /var/lib/gems/2.4.0/gems/nokogiri-1.8.1/ext/nokogiri\n\n/usr/bin/ruby2.4 -r ./siteconf20171120-10224-dwnbwh.rb extconf.rb\nmkmf.rb can't find header files for ruby at /usr/lib/ruby/include/ruby.h\nextconf failed, exit code 1\nGem files will remain installed in /var/lib/gems/2.4.0/gems/nokogiri-1.8.1 for inspection.\nResults logged to /var/lib/gems/2.4.0/extensions/x86_64-linux/2.4.0/nokogiri-1.8.1/gem_make.out\n```\n$ lsb_release -a\nNo LSB modules are available.\nDistributor ID:    Ubuntu\nDescription:    Ubuntu 14.04.3 LTS\nRelease:    14.04\nCodename:    trusty\n$ ruby -v\nruby 2.4.2p198 (2017-09-14 revision 59899) [x86_64-linux-gnu]\n$ convert -version\nVersion: ImageMagick 6.7.7-10 2017-07-31 Q16 http://www.imagemagick.org\nCopyright: Copyright (C) 1999-2012 ImageMagick Studio LLC\nFeatures: OpenMP\nI had followed the second answer here to update ruby https://stackoverflow.com/questions/26595620/how-to-install-ruby-2-1-4-on-ubuntu-14-04, i.e.\n$ sudo apt-add-repository ppa:brightbox/ruby-ng\n$ sudo apt-get update\n$ sudo apt-get install ruby2.4\nhowever, ruby-dev was still 1.9 so\n$ sudo apt-get install ruby2.4-dev\ndid the trick for me.. ",
    "dalin-": "This sounds like a dupe of #318 . ",
    "stevenday": "This is an old issue, so you've probably worked around it by now, but just for future reference because I came across it this morning and was a bit stumped. I think it's this line that causes a problem:\nhttps://github.com/BBC-News/wraith/blob/7adfb1b365a913e46b9b6be408ef8f06185e0f20/lib/wraith/helpers/capture_options.rb#L50\nYou can work around it by swapping something like:\nyaml\npaths:\n  some_page: /page?path=xyz\nto:\nyaml\npaths:\n  some_page:\n    path: /page?path=xyz. I guess the ruby code should check options is a hash, otherwise you're potentially using the string's [] method which (TIL) accepts a match_str param: https://ruby-doc.org/core-2.3.0/String.html#method-i-5B-5D. I just noticed that a related bug was present in the GalleryGenerator too, so I've added a fix for that in 0c39b03.\nThe code duplication suggests that the GalleryGenerator should use the CaptureOptions to parse the options, but I didn't want to make such a big change here just to fix this small bug.. Sorry about that, I had a few test failures here which worked fine for me locally, but failed on Travis. I wasn't sure exactly how best to test the invalid image was getting created properly, but I've eventually found a way that's reliable on both - using Wraith! (I copied some other tests, so hopefully this approach is acceptable). I've pushed the changes as a fixup in 9a3a247 in case you'd already looked at the old version.. ",
    "t4k": "I tried making this work. I\u2019m not a Ruby developer, but using Wraith with Chromedriver would be huge for me.\nThis PR requires a specific Ruby version and quickly became a pain because I don\u2019t have RVM or rbenv on my Mac. Wraith works fine by itself with the system Ruby version. (ruby 2.0.0p648 (2015-12-16 revision 53162) [universal.x86_64-darwin15] on my machine.)\nI tried to do what the instructions in #521 said, and was somewhat successful. The gem seemed to build and install, but I didn\u2019t get any of the new Chrome template files, like I thought I should have based on the commits here after running wraith setup.. ",
    "kieranshaw": "I've also had a go with this fork locally the last couple of days and can confirm that it broadly works. The only change I had to make was to create the directories where each screenshot will go before taking the screenshot. I'm guessing I've had to do this as I'm targeting a non-existent subdirectory and I think phantomjs handled this ok before.. ",
    "staylos92": "I've had a look at this locally and all of our existing configs still work as expected \ud83d\udc4d I'm going to hopefully get this merged and a new version of Wraith as soon as the Travis tests are passing :crossed_fingers: . Now that the Travis tests are passing we are aiming to merge this tomorrow and release a new version of Wraith at the same time.. Thanks for fixing this \ud83d\udc4d . ",
    "JimmyMultani": "@BBCNews, any news on when this might be merged? Thanks!. ",
    "L0wry": "YEAHHH BOII \ud83d\udcaa . ",
    "jimbobhickville": "Trying to run wraith info in the container throws the same error. If you apt-get install libnss3-dev libgconf-2-4 the problem goes away. I'm testing a forked image now to see if it solves the original bug.. I looked into this more and apparently this is only possible with the onResourceReceived callback:\nhttp://phantomjs.org/api/webpage/handler/on-resource-received.html\n. ",
    "superwese": "Juan, you're right. This is related to browser: chrome, because chrome depends on the directories to be present. Adding setup_folders(config) in cli.rb doesn't break any tests.\nYou may also want to run wraith setup_folders /path/to/config.yaml manually before you run wraith latest /path/to/config.yaml. I pushed a docker image \"superwese/wraith_chrome\".\nYou may have a look at it:\nhttps://github.com/superwese/wraith. ",
    "milodesc": "+1 on the solution above.\nAdding setup_folders(config) to cli.rb worked for me.. ",
    "georgezee": "I came across the same problem. \nUsing superwese's fork that contains the abovementioned fix worked for me. Thanks.. ",
    "huang-jy": "I found one way of doing this, and that is to \"bounce\" the request via an nginx docker container, that produces a redirect to the other path. Seems overkill for something that can be done within Wraith.... I'm still interested in this -- though I haven't had much chance to test Wraith recently.. ",
    "veromeneses": "This change also fixed the latest command for me. Could you guys please merge it?\nThank you @NetoBuenrostro!. ",
    "khana25": "Found the answer \ud83d\udc4d . ",
    "freelock": "Trying to switch our testing containers over to use headless chrome with Wraith, and I'm hitting an issue trying to get chromedriver working correctly... I think it stems from our container running as root. It looks like the main thing needed is to pass --no-sandbox to Chrome so that it will start up -- is there any way to pass arguments like these into Wraith at this point?. ",
    "m90": "This would solve #561 . What does your config file look like?. ",
    "rbayliss": "I tried this out locally, and got the following block of errors:\nDEBUG: #################################################\nDEBUG:   Command run:        capture config.yaml\nDEBUG:   Wraith version:     4.2.1\nDEBUG:   Ruby version:       ruby 2.4.1p111 (2017-03-22 revision 58053) [x86_64-linux]\nDEBUG:   ImageMagick:        Version: ImageMagick 6.8.9-9 Q16 x86_64 2017-07-15 http://www.imagemagick.org\nDEBUG:   PhantomJS version:  2.1.1\nDEBUG:   chromedriver version:  ChromeDriver 2.37.544315 (730aa6a5fdba159ac9f4c1e8cbc59bf1b5ce12b7)\nDEBUG:   CasperJS version:   1.1.4\nDEBUG: #################################################\nConfig validated. No serious issues found.\nCreating Folders\nSAVING IMAGES\nERROR: javascript error: module is not defined\nJavaScript stack:\nReferenceError: module is not defined\n    at eval (eval at executeAsyncScript (:457:5), <anonymous>:3:1)\n    at eval (eval at executeAsyncScript (:457:5), <anonymous>:5:5)\n    at executeAsyncScript (<anonymous>:457:26)\n    at <anonymous>:473:29\n    at callFunction (<anonymous>:361:33)\n    at <anonymous>:371:23\n    at <anonymous>:372:3\n  (Session info: headless chrome=65.0.3325.181)\n  (Driver info: chromedriver=2.37.544315 (730aa6a5fdba159ac9f4c1e8cbc59bf1b5ce12b7),platform=Linux 4.9.87-linuxkit-aufs x86_64)\nWARN: Using fallback image instead\n... etc, repeated for each path.. ",
    "andyrichardson": "I just tried this out and it works perfectly. Ideal for anyone who's in the same situation as me where they can't use PhantomJS because flex support is sketchy.\n@rbayliss the reason you get that error is because your js scripts are in a module format (not supported when using chrome). See this example for how to write scripts for chrome.. I managed to find a fix to the issue which was related to the before_capture script.\nInvalid PhantomJS capture script\nmodule.exports = function (phantom, ready) {\n    // make Wraith wait a bit longer before taking the screenshot\u200b\n    setTimeout(ready, 2000); // you MUST call the ready() callback for Wraith to continue\u200b\n}\nValid PhantomJS capture script\nmodule.exports = function(phantom, ready) {\n  phantom.open(phantom.url, function() {\n    setTimeout(ready, 5000);\n  });\n};\nNote\nI'll leave this issue open for now as the invalid script is currently provided as an example in the Wraith Documentation.. ",
    "viktoradavid": "Thanks a lot! This used to work for me, but now I keep getting ERROR: chrome not reachable :(\nHowever, it doesn't happen every time. Running this for only one url and 1366 width leads to no issues, adding more resolutions/urls or changing width size breaks ~80% of images.\nRunning the comparison using /configs/capture.yaml\nConfig validated. No serious issues found.\nCreating Folders\nSAVING IMAGES\nERROR: chrome not reachable\n  (Session info: headless chrome=67.0.3396.62)\n  (Driver info: chromedriver=2.39.562737 (dba483cee6a5f15e2e2d73df16968ab10b38a2bf),platf\nrm=Linux 4.13.0-46-generic x86_64)\nWARN: Using fallback image instead\nERROR: chrome not reachable\n  (Session info: headless chrome=67.0.3396.62)\n  (Driver info: chromedriver=2.39.562737 (dba483cee6a5f15e2e2d73df16968ab10b38a2bf),platf\nrm=Linux 4.13.0-46-generic x86_64)\nWARN: Using fallback image instead\nERROR: chrome not reachable\n  (Session info: headless chrome=67.0.3396.62)\n  (Driver info: chromedriver=2.39.562737 (dba483cee6a5f15e2e2d73df16968ab10b38a2bf),platf\nrm=Linux 4.13.0-46-generic x86_64)\nWARN: Using fallback image instead\nCROPPING IMAGES\nCOMPARING IMAGES\nWhat's interesting that addition of another url breaks even the url that previously worked. Testing one url at 1366 works, but two urls at 1366 break both of them. Could chrome be somehow \"overloaded\"?\nAny ideas? TIA!. @bbrooks That's what I needed, thank you so much!\nBTW I had to increase the shm-size even more (up to 4 gigs) for some big and complex pages to work.. ",
    "bbrooks": "@viktoradavid I was running into a similar problem. Seems like chrome needs more resources than the default docker box offers. Try running your docker run cmd with --shm-size=512m to increase the /dev/shm size of the container. It defaults to 64m.\nWhen I did this I no longer got chrome not reachable errors.. @edurenye I agree but how would we get wraith to look for and use the dockerized chrome instead of trying to execute it on the wraith container?. ",
    "gauravm5": "done. The test have not failed due to the change, how can the build be fixed?. ",
    "mattkhanlon": "I've run into this issue before. What version of PhantomJS are you using? You can have a look at #479 as this looks similar to the error i got and this fixed it for me.. ",
    "Nakilon": "brew unlink xz; gem install nokogiri -v '1.8.4'; brew link xz. ",
    "crs1138": "Thank you, that helped!. ",
    "mourique": "this looks great! I'll check it out, been thinking about doing something similar myself! kudos!. ",
    "beathorst": "\nthis looks great! I'll check it out, been thinking about doing something similar myself! kudos!\n\nThanx, I did this 2 years ago with some more functions in my fork with an Jenkins and PHP/Symfony Stack/Worflow. But this is very bad, because I can not merge the original code from bbc in my fork. So it would be nice to have it in the BBC. And I like to use wraith with docker from the original bbc account\n. ",
    "jasonmce": "My understanding is that history creates a \"baseline,\" and each run of latest is compared against this baseline.  It's not a rolling diff, but a \"identify when it broke, and again when it recovered.\"\nTo do a rolling diff (showing what changed since the last run), you'd want to replace your history images with the prior run's snapshots before running latest again.  I believe running either copy_old_shots or copy_base_images (not sure which) before your next run of latest will generate what you want.\nThe code is at https://github.com/BBC-News/wraith/blob/master/lib/wraith/folder.rb if you want to see the inner workings.. ",
    "coderkind": "@DaveBlooman Regarding the note on the PR description and it not resizing over 600; is any resizing currently occurring? The docs suggest you might have to attach a function and use asynchronously: http://docs.casperjs.org/en/latest/modules/casper.html?highlight=captureselector#viewport\nthis.viewport(view_port_width, 1500).then(function() {\n    // new view port is now effective\n});\n. ",
    "vfonic": "You can achieve similar functionality with:\njs\nvar elementClasses = before.attr('class');\nvar similarElements = before.siblings(`[class=\"${elementClasses}\"]`);\n. It might be better to create new variables instead reusing existing ones.\njs\nvar $before = $(before);\n. According to jQuery documentation:\n\n.hasClass( className )\nDescription: Determine whether any of the matched elements are assigned the given class.\n\n...you can just do:\njs\nif (!similarElements.hasClass('processed')) {\n  (...)\n}\n. Or as a one-liner:\njs\nvar allProcessed = !similarElements.hasClass('processed');\n. Use === strict comparison.\n. This whole function can also be a one-liner:\njs\nreturn $(`.list-group .list-group-item a[href=\"/${path}\"]`);\n. I usually add is- or has- prefix to boolean class names:\nis-checked\nIt makes it a tiny little bit cleaner IMO.\n. ",
    "corymcdonald": "nit: space in between display: and inline-block. Any particular reason to use an inline style over just adding another class? . ",
    "kodikos": "Could we tidy this up? A pattern like [opt1, opt2, ...].each |opt| options.add_argument(opt). Can't this be @config['timeout_ms'] || 1000?. Don't quite follow the use of YAML.load to create the object.. ",
    "bigmartyn": "YAML.load takes a YAML string that it parses and returns as an object. To do that from a YAML file, YAML.load_file would be used instead.\nIt's just easier than creating a fixture file when the contents of that file is small.. "
}