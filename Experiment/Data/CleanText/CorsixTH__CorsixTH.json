{
    "TheCycoONE": "I've merged this to an sdl2 branch so that we could collaborate.  Feel free to merge any more of your changes to that branch until it's ready to merge to master.\n. Assigned you to this issue mrtnptrs\n. Play with the labels on the right as well.  And make sure you can Manage Labels on the previous page (button should be under list of labels on the left)\n. @mrtnptrs: I've given testers push access to CorsixTH, it seems like that will give you more control in the issue tracker.  No one should be pushing directly to the CorsixTH/CorsixTH repository, but the only alternative seems to be setting up a fake repository for everything which doesn't really sound nice.\n@TheCycoONE: and now I've tested that I also can edit others comments in case we have to censor them.\n. Github does not allow deleting issues, we'd have to just ignore them.  That said there's not much reason to look at closed issues, especially if we use a label to mark resolved issues and only close them when they get deployed.\n. I've not actually used the GitHub issue tracker at all before.  Google tells me people pick one issue to be the main issue and then in the other issue just write something like Duplicate of #6 (when you write # it makes a link to the referenced issue) and close it.\nI suppose it might also be handy to add a 'Duplicate' label.\n. Verified.  Looks good, thanks Alberth.\n. Ug, I'm very sorry I think I made you mess this up by just reading one commit at a time.  Can you remove 3653960?\n. I'm going to fix this.\n. See pull #17 (Sorry!)\n. Trusting you to know what you need for testing :)\n. Alright.  I guess that you're doing everything in your master branch, which is going to cause some problems with the pull requests unless you go in and cherry pick commits.\nPull 11 only had commit 574a68b, which accidentally included the extra string in english.lua.  It appears that you fixed that in 93c8d58 but never made a pull request based on those two revisions.  (If you did that would be good for the Quick save patch)\nYour new pull 15 includes all changes to date on your master, including the quicksave changes, and from inspection of commit c0402fa some testing of Alberths code cleanup patches.\nSo, I recommend making a new local branch for the quicksave feature, merging 574a68b and 93c8d58 to it and making a pull request based on that.  Then making another branch for any feature you want to pull in.  (Branches are very cheap in git, and local only)  You can also cherry pick commits for the pull request from in github.\n. Closer.  Your branch should be from upstream/master now that your master has other changes.  You'll get the hang of it!\n. @mrtnptrs There's a bit of a learning curve transitioning from svn to a distributed versioning system like git, especially when dealing with multiple patches.  I believe the accumulation of changes was unintentional.  Separate pull requests are easier to review, but we can still pull it all in this way and close the others - as long as the whole thing is good.\n. @MarkL1961 if we merge every change in order so that upstream (CorsixTH/CorsixTH) was in the same state that your repo was when you started each item it should work out.  Git can figure out if you're trying to merge/pull the same thing twice.\n. I've cherry picked your QuickSave changes an merged them.  Unfortunately I don't think I can do much with the rest of your commits as they seem to include unrelated changes.  E.g. c0402fa contains Alberth's documentation changes, and f301700 seems to revert some of the transparent wall stuff.\nIf you have the individual changes you might be better off rebasing on upstream master and reapplying your diffs by hand (line by line to ensure they only contain what you want).  Then make sure to double check all your changes for every commit and ensure it's only what you want.\n. @MarkL1961 I'm on irc every day from around 6AM to 9PM UTC if you'd like to talk!\n. Sounds good, see you then.\n. Making a pull request from a working branch is bound to cause problems.\nBeyond the obvious (every commit you add to the branch is added to the pull request), it would also cause problems if the pull was rejected as you have other changes that rely on it.  It would also cause problems for you if we decided to rebase and squash some of your commits together.\nClosing.  Please submit a pull request for full feature set when done, or break into independent features.  (Using git cherry-pick and/or git rebase you can move your commits around to do this)\n. Sorry, i think I closed this too early, it looks like this is the rest of the feature set for this branch.\nCould you rebase on the latest upstream/sdl2 and squash/remove any commits that are no longer neccessary.\n. @mrtnptrs Using the github site and graphical interface exclusively is causing some problems I'm afraid.  This pull request includes 7f07528 which is your earlier merge of CorsixTH\\CorsixTH to your fork (which you did as a pull request).\nTo sync with upstream (CorsixTH\\CorsixTH) properly (so it doesn't add extra things in the history) I'm afraid you'll need either to use the git shell (command line), or tortoisegit.  If you would like to join us in irc we can help you out with that.  Then maybe you can make a good help document we can point everyone to.\n. Yes, I may be at lunch depending on exactly what time you arrive but I'll be around within the hour.\n. On the plus side, the included commits in this one look like exactly what you meant to include.\n. Looks problematic again, f4a280d shouldn't be there.\n. MarkL, your other pull request went fine.  Anyway to avoid issues like this, you could create your new branches like this:\ngit fetch upstream\ngit branch myfeature upstream/master\ngit checkout myfeature\ngit push origin myfeature\nWhat this does is\ndownload all changes from CorsixTH\\CorsixTH (changing nothing)\ncreate a new branch based on what's in CorsixTH\\CorsixTH:master\ngo to the new branch\npush your new branch to your github account\nAs long as you are always working on quick patches this should be all you need.\n. I'm told I should have wrapped my lines, so I'll commit a new version momentarily.\n. Well if you would like to change the author you can follow the instructions here: https://help.github.com/articles/changing-author-info\nLet us know if you'd like to do that before this is pulled, git-filter-branch is kinda scary so we wouldn't want to run it upstream ;-)\n. @Lego3  Yes I think so.\n. Upstream issue, fixed in hg: https://bugzilla.libsdl.org/show_bug.cgi?id=2140\n. SDL2_mixer 2.0.1 not SDL2 2.0.2.  And yes, we're waiting on upstream now.\n. @jorgenpt I'll have to give CorsixTH its own email address.  At the moment my avatar is tied to the project.\n. It's worth noting here that as an alternative to waiting for the next sdl mixer release or using the hg version, if we shipped non-midi tracks they should work.\n. If they still haven't cut a new release approaching the time we want to cut our release I'll be including an hg version in the Windows release, because this issue has been fixed upstream for a long time now.  We should have enough time to test it in the release candidate phase to test it.\n. Should be fixed in 0.50 beta 1 which uses an hg release of SDL2 mixer.\n. In any case, it's not our issue, and our official builds will not include the broken version.  Closing.\n. I don't follow from this pull request why you can avoid delaying rendering a new frame if the current pts is in the future.\n. @jorgenpt  d5e4761 is unrelated, but merged now anyway so you could rebase without it, or I will when I pull it.  My main concern at the moment is ignoring the current frame time stamp.\n. Thanks jorgenpt!\n. What do you think of local month_of_year instead of local actual_month?\n. I think a broader change to how we track the current month is beyond the scope of this pull request and could take place in the mailing list or issue tracker.  Does anyone feel that this commit shouldn't be merged into the existing code base?\n. Perhaps bike shedding, but I still have a problem with the names 'months' and 'actual_months'.  If there are going to be two it should be something like months_since_start and month_of_year.\nIf it is a function then get_month_of_year(months_since_start);\n. The commit message could be clearer - I'll fix that.\n. @Tsbook please amend the pull request if you don't mind.\n. @Lego3 Sadly our current git flow won't let this cleanly merge to 0.30 because it's based on master which is ahead of 0.30 (and if it was based on 0.30 it still wouldn't merge cleanly to master because cherry-picking does silly things to history)  Eventually we may switch to a workflow that supports this better.  In the mean time I will merge to master and cherry-pick back to 0.30\n. Fixed by #798\n. This is very similar to #76 \nUntil we know they are the same issue, this one is for the Operating Theater and that one is for the GP office.\n. I think you could achieve all of this just with litter_countdown instead of introducing a new litter_probability variable.  Patients could enter the hospital with some random litter_countdown value, when they encounter a bin that could be reset to some high random number again, when they use a vending machine it's reduced drastically, when it hits 0 they drop litter like they do currently.\n. I'm in favor of removing the grace period. Whatever balance issues people were complaining about could probably be better addressed directly.\n. Now that sounds like a good feature :+1: \n. Is the happiness degradation too severe or is the effect of being unhappy too quick?\n. #193 possibly related.\n. I'm afraid there's not enough information in the error to diagnose the problem.  It will be worth adding unhandled exception logging to the C++ code so we can learn more.\nIn the mean time, all the information you can tell us about your operating system and computer you can tell us might be helpful, as well as exactly what happens to cause the crash.  (If it happens when loading that save, or afterwards, and if it happened to your original game or only when loading)\n. Not enough information and no feedback in nearly a year.\n. I don't believe this is the same error code that you got.  In either case it's a very vague memory error, not something we have enough information to correct with what's here, the original reporter isn't responding and no one else is saying me too.\n. Wouldn't it be more appropriate for the bracketed or tool-tip language to be the player's current language instead of always English?\n. Could you include the dwi images (save as).  I can't make out enough from the screen shots to tell what's going on.\n. @MarkL1961 Immediately, I see your working version is using 64bit SDL.dll and SDL_MIXER.dll as it should.  For some reason your other system which isn't working has the 32bit SDL.dll and SDL_MIXER.dll.  This doesn't make sense to me assuming they were both clean installs?\n. I believe in the past we also packaged MSVCP100.DLL and MSVCRT.DLL which I missed this time.  I'll ensure those are included too.  Not sure why LuaSocket isn't working for you, but dependency walker doesn't seem to expand into it so it's not going to be useful in this case :(\n. As far as the 0.30 release.  Should we disable the update check in the config file and press ahead (marking it as experimental), or wait for this to be solved.\n. I'm also looking for these files.  Would it be appropriate for them to uploaded to the forum, hosted somewhere, or added to the CorsixTH-Graphics project?\n. I understand functionally this has been well tested by @MarkL1961 \nOn the surface the code looks good.  A more in depth review will take awhile.\nWould it be feasible for you to merge some more of the commits, specifically ones that only correct prior code, for instance https://github.com/sadger/CorsixTH/commit/b003dbb7621c8a6c27a8f9e680f155d69358b9aa into https://github.com/sadger/CorsixTH/commit/7f02ee4ee5da620f5adeb0b2d53349021b7efb6a and that into https://github.com/sadger/CorsixTH/commit/469b6be06a6f2b6722a8bff38adc4b1c88a94a7e\n. @sadger Thanks, and excellent wiki page!\n. @MarkL1961 I guess they were missed in the mass cleanup earlier this year\n. @tobylane I don't think this issue was resolved. See @MarkL1961's first comment. The title is misleading.\n. You should be able to do an interactive rebase to remove your second two commits.\n. Great.  When this is merged in 0.30 I'll make a new installer.  Maybe @mrtnptrs can find enough people that we we can determine how prevalent the root issue is, or better yet some commonality.\n. @Lego3 no, I think not.  Also as you've probably noticed, cherry-picking doesn't lead to very nice history.  We may eventually want to consider another git workflow, however that's probably off topic here. :)\n. I see storing the temperature colour in the config, but wouldn't the automatic wage policy depend on the hospital you were running?  I think if I had a wealthy smooth running hospital I might check that option to reduce the micromanagement, but not want it for my next start up hospital.\nWhat does everyone else think?\n. For reference before the back trace becomes too dated to follow, the assert that failed was assert(action.reserve_on_resume == door), the function was navigateDoor\n. Yes, that looks much better.\n. The same link tells you how to make those two commits into one.  It's called \"squashing commits\"\n. No problem, if anyone can verify this is good, I'll join the commits when I merge them.\n. @MarkL1961 I know you're not comfortable with git - I don't suppose you'd mind if I rearranged this into two commits, one for the math changes on the machine, and one for the comments.  I'd like to see these changes get merged.\n. Merged with squash and minor edits.\n. I think this will be pretty straightforward but depends on my fix for issue #120.  I'll likely put up a patch for this once that one is pulled.\n. The workaround isn't too bad, I merged it.  We can put it behind a preprocessor flag or remove it entirely when the new SDL is released.\n. Incidentally, those values in the second commit should be set in an initialization list.  Not relevant to this fix, just worth noting.\n. I'm looking into this.  Seems like some of the scaling code was removed.\n. Verified, I saw this as well.  I've begun to look into it.\n. This commit seems to undo a lot of other changes, e.g. speedup.\n. @mrtnptrs Does it work for you?  I haven't downloaded the demo data to test it but if someone confirms it I'll do the merge\n. That's strange, because the condition you're replacing is clearly false for L1-4 and true for 5+.  Maybe print the value there?\n. Yeah, don't worry about squashing.  With such a low volume of contributions it's really no problem for me to do it, but in this case you're right, it's probably easier to start over.\n. Crash does not depend on rendering engine as seen in #347 \n'''\nIt looks like the same thing, however I was using the SDL version, here the Windows error log:\nFaulting application name: CorsixTH_SDL.exe, version: 0.0.0.0, time stamp: 0x54511863\nFaulting module name: CorsixTH_SDL.exe, version: 0.0.0.0, time stamp: 0x54511863\nException code: 0xc0000005\nFault offset: 0x000000000004395c\nFaulting process ID: 0xccc\nFaulting application start time: 0x01cff46647ba306b\nFaulting application path: C:\\Program Files\\CorsixTH\\CorsixTH_SDL.exe\nFaulting module path: C:\\Program Files\\CorsixTH\\CorsixTH_SDL.exe\nReport ID: 73faf04c-605a-11e4-beb9-0c54a556707c\nFaulting package full name:\nFaulting package-relative application ID:\n'''\nError indicates a memory violation.  It would be good to reproduce this in a debugger so we can see the stack trace.\n. Without #348 the memory debugger in windows errors out too early for me, and in linux I get an awful lot of false positives.  I will take a closer look at this after 0.40.\n. I'm not no.  The issue is ultimately in the C++ code, though there's probably a lua workaround.  Even if you can identify what calls are involved in the issue it would be helpful.\n. A save game and video are included in #659\n. I have a feeling that workaround may not be very compatible. 0xffffffffffffffff looks like a 64bit pointer, possibly set by the lua garbage collector, or a free call if use after free tracking was enabled?\n. Fixed.  See #813 \n. Closed prematurely, replicated the crash.\n. It is possible to reproduce this crash without having the patient dialog open, if you disable map limits in the debug menu and scroll to where patients enter / leave. The crash appears to be triggered for new patients (not yet visible) as well as ones that are leaving.\nAlso, the lower and upper left edges of the map do not produce any error, but the top right edge does (I don't have a save game set up where the bottom right edge is used)\n. Also the crash happens in either of two places, getDrawingLayer() as shown in @pwaller's stack trace, or a couple lines earlier in Map::draw at https://github.com/CorsixTH/CorsixTH/blob/25cab02843a4f5f05a23fce49b3b0dbf989f52b1/CorsixTH/Src/th_map.cpp#L885\n. Bad pull request, got distracted ;)\n. @mrtnptrs The backend sdl2 uses has to support rendering to a texture.  I'm not aware of any system which wouldn't support this feature - possibly older phones.  Anyway it tests for the feature being available.\n. Merged fix.\n. Originally reported against v0.10 as seen in #497 \n. @mrtnptrs Recommend that you branch your local copy for changes.  The way you're doing it you could only propose one thing at a time, and you'd have to reset if the patch was rejected.\n. @mrtnptrs Yes when we switch to SDL2, #110 won't apply any more.  As for the rest of your questions, any changes to the behaviour of screenshots was out of scope for this bug.  They are still bitmaps, with the same names, exactly like you would have gotten in 0.30 with OpenGL or SDL backends.\nSDL2 seems to have made taking screenshots harder rather than easier, and I haven't seen any additional functionality to help with PNGs so I think that's the same amount of work it would have been before.\n. I've been reading into how SDL2 might be mixed with a gui library like wxWidgets, for instance they discuss the topic in the SDL forums here ( https://forums.libsdl.org/viewtopic.php?p=39332&sid=f05ee8efa396f3bc4b74f97e8c58a4c5 ).\nUnfortunately I haven't found any solutions, besides porting the GUI portion of the map editor to SDL2, or making an OpenGL map viewer just for the editor.\n@jorgenpt I remember you were talking about a possible option with this, could you elaborate here?\n. @jorgenpt yes, I think this is the only thing holding back sdl2 at the moment.  The music regression is annoying but not the end of the world.\n@MarkL1961 The map editor shares a large amount of code with the game, and that code is dependent on sdl1.  We could release a package containing the old map editor compiled out of the 0.30 branch with the rest of the components from the sdl2/0.40 branch but it isn't a long term solution.\nWe have a number of options.  Probably the nicest, but the most work, is to port the map editor away from using wxWidgets.  On the other side of the spectrum, we could clone CorsixTH based off the 0.30 branch, and strip out everything not related to the map editor so it becomes it's own SDL1/OpenGL project with it's own release cycle and own installer.  (Presumably the level editor would live there too)\n. The approach I've been advocating for is to make the map editor part of CorsixTH with SDL2.  This allows reusing the most code. I have been suggesting that people could take over from my own early experiments with this at https://github.com/TheCycoONE/CorsixTH/tree/sdl2_mapedit_builtin if they want, or start from scratch and copy the functionality out of MapEdit into CorsixTH dialogs.\nThat said, if someone submits a cross platform map editor that works (using any technology, toolkit, or rendering engine) it will be appreciated.\n. Fixed by pull request #142 \n. I agree @MarkL1961 the change merged was specific to a particular desease\n. However the bug itself only talks about pregnant.\n. Probably relevant to quote the specific violations.\nFHS 2.3 spec can be found here: http://refspecs.linuxfoundation.org/FHS_2.3  Many Unix systems and all Linux distros deviate from it in some ways that will hopefully be covered in FHS 3, but that doesn't mean we should ignore it completely.\nFor point 1: agreed, no binaries should be under /usr/share (http://refspecs.linuxfoundation.org/FHS_2.3/fhs-2.3.html#PURPOSE26)\nFor point 2a: If there is to be a default search path for HOSP then I don't mind if it includes /usr/share/games/corsix-th.  /usr/share/games is optional though and it's just as likely to be in /usr/share/corsix-th, /usr/local/share/games/corsix-th or /usr/local/share/corsix-th.\nThis feels to me like it might be more appropriate for the distribution packager to patch.\n2b: You should NOT be putting a new Levels directory in the same path as the original data directory.  I suggest putting the original files under /usr/share/games/corsix-th/HOSP.\n. Alright, as it relates to CorsixTH I think what we need is the ability to store the Lua files separate from the binary in a build time configurable path (should we support changing that path at runtime too?)\nThis would require changing the search for CorsixTH.lua at https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Src/main.cpp#L146 to check a preprocessor variable for the correct location and only doing the search afterwards if the file couldn't be found.\n. I'm working on this now.\nMy thoughts are that a distro package should be able to install the CorsixTH executable in\n/usr/bin/corsixth and the rest of the CorsixTH platform independent resource files under a directory configurable in CMake e.g. (/usr/share/[games/]corsixth).  I am currently investigating the best way to handle this in CMake - I'm sure it's a common requirement for programs in posix environments.\nHOSP data from the original game will not be included by distributions as that would be a copyright violation.  Since that location is prompted at first run I don't see anything to do there, the user is free to store it in /home/user/theme-hospital or /usr/share/local/theme-hospital or anywhere else they feel is appropriate.\n. Not recently. I know the fix but I haven't prioritized it. I suppose anyone else could take it over if they wanted.\n. Part 1 was addressed in 0.62, part 2 is partially addressed. The default location of original game files is not a clear issue. Closing this.. Duplicate of #750 \n. My understanding is that the real fix is to behave like Theme Hospital, allow you to build on litter and vomit which automatically cleans it up.  The same fix should resolve #66\n. In #66, if you had a blueprint and then someone vomits in it you can still lay the blueprint but then there is litter in the room and other errors happen.\nTo fix both we would allow building over litter and vomit (not block the blueprint) and clear it when the room is made.\n. @mrtnptrs  It's how the original game was so I don't mind.  I think trash/vomit was meant to be a minor annoyance rather than a huge obstacle unless things got really bad - yes people did exploit buying lots of plants to clean up mess, you could always hire a large number of handymen over each spot and then fire them right away too. \n. Resolved by #1119\n. I don't believe this crash is at all specific to OSX, it's a segfault in THMap::draw.  It can be difficult to reproduce memory errors like this.\nHowever this bug is missing some important details.  What version of CorsixTH was this.  Did it contain local modifications?  @petrpulc mentioned working on image ordering of the z-axis which could very likely be related.\n. Looks like a duplicate of #124.\n. From hospital.lua:\nlocal total = emer.victims\n  local max_bonus = emer.bonus * total\n  local emergency_success = rescued_patients/total >= emer.percentage\n  local earned = math.floor((emergency_success and rescued_patients/total or 0) * 10) * max_bonus/10\nso:\nlocal total = 8\nlocal max_bonus = 1000 * 8 = 8000\nlocal emergency_success = 7/8 >= 0.75 = true\nlocal earned = math.floor((1 and 7/8 or 0) * 10) * 8000/10 = math.floor(7/8 * 10) * 800 = math.floor(8.75) * 800 = 8 * 800 = 6400\nI'm not sure what the original does, but to me it would make more sense to do:\nlocal earned = (emergency_success and (emer.victims * emer.bonus)) or 0\nIs that what you were thinking?\n. @MarkL1961 the formula I mentioned in my second comment would have given the per patient bonus ($1000) per patient (or none if you didn't cure over the success cutoff).\nit would probably be clearer over a couple lines:\n\nlocal earned = 0;\nif(emergency_success)\n{\n    earned = emer.victims * emer.bonus;\n}\n\n. I'm fairly confident it's suppose to be how you describe, otherwise why specify the reward per patient.  I'll make a pull request for this.\n. Ok great.\n@MarkL1961  If you've tested the patch I believe you can merge it through the web site.\n. I will check if max_bonus is used elsewhere when I fix the formatting.\n. max_bonus is used for the fax as @MarkL1961 said.  Removed brackets\n. Code changes are needed to support libav.  Libav does not include libswresample, so the audio re-sampling code would need to be changed.\nI'm not personally willing to spend time working around their fight.  (I know that Gentoo and Ubuntu side with libav, while ArchLinux and others side with ffmpeg so there is interest in both.)  That said, patches are welcome.\n. In the mean time for Ubuntu/Debian, either ffmpeg can be acquired through other means or CorsixTH can be built _DWITH_MOVIES=OFF\n. It looks like Ubuntu 15.04 will include ffmpeg: https://launchpad.net/ubuntu/+source/ffmpeg\n. On Ubuntu you'll need to use -DWITH_LIBAV=ON or else manually specify the location of ffmpeg. CorsixTH supports LibAV these days.\n. Sadly  0xc0000005 tells us almost nothing.  Do you get this error every time, and do you get it in OpenGL as well?\n. In SDL2 there will not be a separate DX renderer.  My understanding is that SDL will use DX under the hood on windows machines to accelerate it's own API.\n. Does not appear to be an issue with SDL2.\n. I believe this still does happen in 0.50 but it's a duplicate of #124\n. Doesn't run, see my in line comment from 12 days ago.  (I just notice it doesn't tell you about in line comments).\n. I believe due to a config problem with the TravisCI script.  That was quite awhile ago and I don't see an option to rebuild.\n. The commit referenced by @MarkL1961 seems to change the file format so every line conflicts with @SimplyRyan 's pull request.\nI attempted to copy the translation out of MarkL's comment but it didn't preserve the diacritics.\nCould one of you add that line, and double check that nothing else has changed since this pull request was made.  I'd like to have it merged in time for 0.40\nEdit: I can resolve any merge conflicts, as long as the final file is correct.\n. @mrtnptrs It's best to test before merging, this is a pure lua fix so you can test it without compiling.  If you know how to apply a patch file then download it here: https://github.com/CorsixTH/CorsixTH/pull/159.patch otherwise you can grab each of the 3 lua files he changed.  Alternately download the issue62 branch from alan's repository: https://github.com/alanwoolley/CorsixTH/archive/issue62.zip\n. @alanwoolley I'd like to get this pull request merged soon, in time for 0.40.\n. @alanwoolley I'm sure yes.\n. Thanks adrianopol.  Is there any reason you are not using 0.40 final?\n. @mrtnptrs The word wrap also seems to be off.  I believe it's suppose to be wrapped at 80 characters.\nOtherwise there are just a few little english grammar details.  If you don't mind I will join your commits together, fix those details, and merge some time in the next couple days.\n. @mrtnptrs In my last comment I meant off as in wrong, not off as in disabled. :)\n. Edited and merged.\n. @phillipp Would you mind making a pull request that implements your workaround, with a comment to indicate that it's a problem that needs further investigation.  We'll keep this issue open anyway so someone knows to look for the root cause.\n. @phillipp / @MarkL1961 It appears that there is some promising development here, but there were open questions and it's been a month since the last discussion.  Are you still working on this?\n. Lost track of this one, sorry\n. Merged! (Including fix of comment typo mentioned above)\n. Why do you consider these statements to be duplicated?\n. Reopened because this is still an issue someone else could pick up in the future.\n. @wolfy1339 Presumably you have a script for actually creating the deb.  Use ln -s to create a simlink from there instead of duplicating the files in the repository.\nFor the same reason you probably didn't need to rename DebianPackaging in the repo either, but I'm fine with that.\n. @wolfy1339 You cannot move a symlink, and you have to create the target relative to where the symlink is stored.  So from the debian directory something like ln -s ../CorsixTH/Bitmap Bitmap\n. @wolfy1339 All packaging is done manually, so don't worry about incorporating it into cmake.  If there is a script to do it that would be helpful though.\n. @wolfy1339  Maintaining an md5sum list is going to be nearly impossible, that's another thing that I think should be generated by the packaging script.\n. @wolfy1339 not automatically, but you should be able to resolve the conflicts without too much difficulty.\n. @MarkL1961 Probably all of them, but it's trivial to get back in sync: git rebase --ignore-whitespace \nIt's also still easy to merge these changes from the command line.\nIt's the responsibility of out of tree patches to keep in sync with tree, not vice versa, and the things that haven't been merged yet are not ready, either because they haven't been verified or there are uncorrected problems with them, or we don't know if we want them at all.  The white space fixes on the other hand were ready to be merged.\nAs you can see I did merge an affected pull request after merging the white space change.\n. To address this pull request specifically, the md5sums file has to be calculated at package time, not shipped in the repo, so instead there should be a script to generate it.\n. @MarkL1961:\nMy usual workflow is:\n... review the diff on github for anything obvious...\ngit fetch upstream\ngit checkout pr/175\ngit rebase upstream/master\n... build if not pure lua...\n... test ...\n... fix any minor commit details like squashing commits or fixing messages if the author doesn't know how ...\ngit checkout master\ngit rebase upstream/master\ngit merge --no-ff pr/175 -m \"Merge pull request #175 from wolfy1339/master\"\ngit push upstream\n. @wolfy1339 Are you still interested in maintaining this?  If not I'll close the pull request.\n. Good work!  Thanks Alan!\n. I have admin access, so I did it.\n. Squashed into one commit and merged.\nFor future reference, you can use git rebase -i to squash or fixup multiple commits, which can produce cleaner looking patches.\n. @MarkL1961  I was going to suggest making one pull request for hell death rather than submitting it in piecemeal like it is now.  Nothing is affected by this new action yet, but it does nothing for us on its own either.  That said I don't have a strong opinion on the matter, so if you'd rather merge it go ahead.  I know @Lego3 merged #172 which sets precedence.\nI also would have preferred 5133c61 and d118556 merged into d214feb, but that's really a minor detail since we are not using git logs as public change logs.\n. @JASheppard:\nWhen you make separate pull requests for separate components of your overall patch you inevitably end up in a situation where you have to wait for us to pull your earlier requests or else submit a new pull request containing the overlapping commits (when one feature depends on another.)  The alternative which is even worse is to submit a broken pull request with an informal dependency on another.\nOne of the big advantages of having a public repo is that you can point interested parties at your work in progress as you are developing.  This would be done via the issue #165 and you can have separate branches for your individual components in your public repo if it helps.\nI don't see a branch in your public repository that is tracking the overall change, so I can't tell what your strategy is, and I would argue without that it makes it harder for integration testing as people have to find all the individual pieces to merge together.\n. What you're considering pull request candidates I consider commit candidates.  There are any number of ways you can use git, but the way I find most manageable is:\n1. Work in your private branch, commit very frequently for any reason.\n2. rebase -i and merge together all commits so that you end up with one commit per item or feature and no bug fix or style change commits.\n3. push those commits publicly and have people look at them either by directing them to your repository or making a pull request.\n4. someone else will read your commits, test them (yes you can go to and test individual commits), and suggest changes.\n5. you make the changes, run rebase -i again and merge the changes into your commits\n6. repeat 4-5 until everything is acceptable\n7. merge the pull request\nThis addresses your readability argument because before looking at the enhancement as a whole, we will go through each commit and ensure it is perfect, one commit for idle_spawn for example.  Without this, yes it would be too hard to look at a giant diff, or a huge pile of commits and tell what's going on, but with it I think things are very readable - pretty much the equivalent of a patch series in the SVN/CVS world.\nTo help developers, git rebase -i has an exec option which would let them run a test suite between every resulting commit to ensure it all passes.  Git bisect also works best if every commit is a potentially stable release.\n. The only suo is CorsixTH/CorsixTH.suo right?\nAlternately there is no reason to include .suo files regardless of the directory they are in.\n. Merged by hand.\n. We can merge the latest master to SDL2 first.  I'm not sure how much that will affect this pull request?\n. @alanwoolley master has been merged, so you should be able to rebase and get everything working now.\n. I see you fixed the white space in b7b92de in d5f6d95.  In d09fe9c you removed the space between the includes and the functions.\nChanges themselves look good, and obviously work.  Thanks!\n. Let me know if you want to fix the white space or squash the extra commit before I merge?\n. Agreed.\n. Yes they are UTF-8.  There is a note about that in some but not all of the language files.\n. In the past it has occasionally been incremental, occasionally tied to SVN revisions.  There's no reason it can't go back to simply being incremental, there's no actual tie to svn there.\n. Ok, I see some commits in here that are already in master.\nUsing the command prompt and rebase -i (interactive) is really the easiest way to do it.\n. Hmm... it seems like all the changes are in a4e71fd.  Is that correct?  Is it meant to be broken into a few more commits?  Maybe I could work off JASheppard's branch?\n. Yes, that's probably it.\nDoes @JASheppard have all of this stuff in one branch yet?  If not - with a list of required branches and the order they should be applied I could rebase them together to make a single branch that preserves the history.  He's probably the best person to decide what changes belong in what commits.\n. @MarkL1961 do you have some time to talk on IRC?\n. MarkL is planning to improve the commit messages tomorrow.\n. @MarkL1961 The TravisCI changes are not part of this pull request.  We explicitely avoided them by branching from upstream/master instead of master and I don't see them in the diff so I'm confident that worked correctly.\nI believe everything would work out fine following the directions I gave on irc/email.  If you'd really rather I did it, could you let me know what comments belong with what commit?\n. \"This all seems to be overly complicated and I don't recall there being all this hassle with patch files and google code/svn.\"\nI'm not the one that split it into 3 parts, you were.  If there's no reason why it's in 3 parts then obviously we can't describe them.  And I wasn't asking for detail, just high level.\nIf this would all be one svn patch then it might as well be one git commit too.  None of this should be more complicated than svn.  If it seems that way, it's only because github has made quality control easier.\nhttp://code.google.com/p/corsix-th/source/detail?r=1919 is an example of a good commit (in svn or git), as is b506f0c73af5e7b0add530ee02f928e6c61083ea.   http://code.google.com/p/corsix-th/source/detail?r=1830 is a bad commit because it changes two independent things.  (Sorry @Lego3 )\nSo - how would you have committed this to SVN?  Do the same thing and you'll probably be good.\n. @JASheppard  Thanks.  That sounds great.  I look forward to this being merged soon!\n@MarkL1961 I'm very sorry if I caused any grief.  I didn't mean for patches to be broken up arbitrarily, just segmented logically when it made sense to do so, like @JASheppard  was already doing by separating the new action and lua utility functions.\nI admit git is less intuitive than svn, but it is also more powerful.  For manipulating history, git rebase is an invalueable tool.  There are some excellent online books and tutorials that might help you out if you're interested in learning more about it.\n. @JASheppard Sorry I wasn't around to comment earlier, though it sounds like you're on the right track now.\nFirst, yes for a pull request you'll want to rebase on the latest master not merge.  This step is optional, but helpful.  When we merge the pull request into master we will do a --no-ff merge so there will be a single merge commit in the history joining the two branches so that we have a record of when the feature was added.\nAs for starting on a clean branch and doing a meld.  During a normal workflow this shouldn't be necessary.  I haven't used meld myself, finding an interactive rebase sufficient.  However if there are substantial changes to how you want to organize commit history then you might find this method easier.   Even if you use a clean branch and meld this time, I don't suspect you will for future patches - now that you're more aware of end goal.\nThe last question you answered yourself correctly +1\n. Sounds great @JASheppard \n. Duplicate of #139\n. @JASheppard @MarkL1961 \nThe pull request tracks a branch pointer, so you can change history even after a pull request is opened, just by changing this history in that branch and pushing it to origin.  (You will need to do a forced push: push -f)\n. Thanks Sadger, Grimdoc, and MarkL, I'll rebase this and merge it in a couple hours.\n. Merged.\n. Note that I changed the save version from 85 to 84, because current master was at 83.\n. I like the continue game button.  If you don't mind rebasing this on the latest master, squashing the commits, and fixing the path separator issue. I will verify and merge.\n. No need for the note on 1580.  Also you're making reference to savegame version 86, but you do not bump the version.\nAt the moment I think the correct version would be 83.  As an asside - it would be nice if there was a way we could do the versioning that wouldn't depend on the order patches were brought in and didn't create conflicts so often. \n. @timdiels Are the LDocGen changes strictly needed as part of this patch set?  I'm not sure if anyone currently depends on the current names/locations.\n. @alanwoolley If these LDocGen changes (3rd commit) were to affect anyone it would probably be you, what do you think?\n. I specifically meant changing the output directory.  I like it better with your changes, I just want to make sure that @alanwoolley  is prepared for it.  LDocGen is run automatically every commit, and the results are sent to him.\nAnyway don't change it for now, I'll just try to get an answer from him before I merge.\n. Actually there is one conflict in the code.  Please change the reference in https://github.com/CorsixTH/CorsixTH/blob/master/.travis.yml#L86 in the same commit.\n. @timdiels alanwoolley says it won't cause him any problems, so if you fix the travis.yml I can merge this.\n. Alright.  If you don't catch us there we can work it out here.\n. @timdiels It's been awhile since we last heard from you. Did you have any luck with your last few changes?\n. Closing in favor of #721 \n. Shall we take this discussion to the mailing list so everyone notices it?\n. Going to close this pull request because we've decided in favour of a more complete testing framework.\n. why did you close this @MarkL1961 ?\n. @MarkL1961 I'm against merging the commit if it contains two unrelated changes.  Maybe this can be updated and split up?\nThat said, a check for updates button is probably useless, since it checks on start.\n. @ckorn Would you like to fix this?\n. Ah, about time this was merged.\n@ckorn for future reference there are a couple things that can make things a little cleaner.  When you fix your last commit you can use --amend instead of making a new commit.  Alternately use the commit message \"fixup: \" followed by the first line of the commit with the problem.  This makes it easy for you or I to squish them together.\nAnyway thanks for the catch.\n. Merged\n. For our purposes don't consider a pull request with a request for changes published. :)  That comment about unpublished commits is really only relevant when other people are building off your code.\n. @mrtnptrs No reason not to use Lua 5.1.5.  You could replace that in this branch too.\n. @mrtnptrs @alanwoolley Actually I think it makes more sense to do everything other than SDL 2.0.2 against master instead, so that we can still cleanly merge master.\n. @mrtnptrs in this branch, undo all of your changes except the SDL 2.0.2 one.\nIn a separate pull request, from another branch based on master, do everything that applies to the master branch.\n@alanwoolley I have a feeling we're a ways out on merging the SDL2 branch yet, since no one is working on the map editor, and there's a number of open rendering bugs.\n. @MarkL1961 Requesting clarification on a few things, added a few inline comments.\n. Did you lose the part of the code for doing this on non-strike messages?\nI see handling for strike, and going to pause for the 'Speed Up' key, but that's all.\n. @MarkL1961  Don't worry about closing the pull request every time for a clean history.  Until you figure it out, if it's something small like this I can clean up the history when I merge it.\n. I'm also not able to put a radiator in front of a door, but somehow @Frassle managed to (in the bathroom) as evidenced by the save in that ticket.\n@Frassle, was that game started in 0.40 or did you originally start it in an earlier version?\n. Ahh, thanks @MarkL1961 so it's the door placement that needs to be modified rather than object placement.\n. Also I just checked the original, and in it you couldn't place a radiator facing any direction on the tiles adjacent to doors.  In CorsixTH you can as long as the radiator isn't on the door wall, which I feel could lead to other bugs.  Suggesting we use the same restrictions as the original when it comes to doors (parcels must be completely clear on each side).\n. Alright, while I think the title of this ticket should cover that case too. It should not be possible to put any object (bench, extinguisher, radiator, etc.) in the parcels immediately in front (or behind) doors and conversely it shouldn't be possible to place doors that would violate that condition.  Right now the only restriction being enforced is the pathfinder.\n. Fixed by #1163 . Great! Thanks @mrtnptrs \n. Code looks good.  Waiting to hear what @Lego3 thinks of the idea.\n. Doesn't seem like @Lego3 is around these days.\n@MarkL1961 if you can get this ready for latest master I'll merge it.\n. @mrtnptrs do you know how to update those commit messages to be a bit more descriptive like the pull request info?\n. Rebased and merged.\n. I checked and the SDL 2.0.3 package is available.  The failure suggests we're missing a winapifamily.h file.  Based on a quick Google, that file should be part of mingw.\n. @alanwoolley @mrtnptrs \nI was able to find the missing file in http://ftp.jp.debian.org/debian/pool/main/m/mingw-w64/mingw-w64-x86-64-dev_3.1.0-1_all.deb\n. For confirmation SDL2-2.0.3 adds the dependency for winapifamily.h to mingw builds. (http://hg.libsdl.org/SDL/rev/58a69af25ccc)\n. Probably by replacing the rest of mingw with the 3.1 package and not just the meta package.\n. I see that other repositories have fixed this by simply installing SDL2 from a PA instead of building it from source.  I think that would be the easiest solution going forward (and would speed up builds).\nSee: https://github.com/ioquake/ioq3/commit/1ec9f8d1a82122abbc00568659e7de5ed11a8e79\n. Installing the SDL2 from a PA as indicated above wouldn't work, unless it was a mingw/windows version.  Sorry I forgot that we were cross compiling to windows to help the testers.\nSDL2 builds are not working at all right now because the mingw download isn't available.\n. Closing because of successful results in #320 \n. @JASheppard LuaDoc testing was only added to our TravisCI script yesterday.  The script MarkL is using doesn't cover that, and neither would older builds.\n. @MarkL1961 Yes it definitely should be in the side bar with developer topics.  I see there are two different documentation articles in the wiki that could probably be cleaned up/merged.\n@JASheppard I believe the documentation generator is missing those other functions.  It doesn't (yet?) enforce documentation for every function, and likely only strictly parses when it does find a documentation comment it recognizes.  I imagine if you generate the documentation those other functions wouldn't have anything specified.\nOn a somewhat unrelated note, @alanwoolley I know the TravisCI script uploads the latest master docs to your server somewhere.  Are they publicly available, and if so are there any links to them anywhere?\n. @JASheppard that sounds like a good idea.\nEdit:\nPlease separate the function from UIPlaceObjects:setBlueprintCell in it's own commit, and move it to the beginning of your patch series.\n. As far as I know no one is working on it.\n. @J-Shep I'm fine with the graphic issue being fixed later, I don't think it's important enough to hold this back, particularly the new bounds checks that are suppose to fix #221, and the code freeze deadline for 0.40 is fast approaching.\nDid you get to testing the 4th case?\n. @J-Shep The official code freeze is September 24th, new pull requests will not be accepted after that time except for critical or regression bug fixes.\nFor existing pull requests, particularly this and epidemics I'm willing to extend that deadline by a couple days if you're very close and need the extra time, but if there is weeks of work left it'll have to wait until the next version.\n. Alright, that's fine.  Thanks for all your work @J-Shep \n. Deleted my two comments.  I've never actually looked into it and I don't want to be miss leading.  @Lego3 I'm sure knows more about it.\n. @J-Shep https://github.com/CorsixTH/CorsixTH/commit/99245e26403b108b600f1b803729b4edcf8b28bf is the commit that introduced the need_side stuff.  It's a big commit, but it may help.\n. Alright, thank you @J-Shep \n. Thanks @J-Shep!\n. This pull request currently doesn't set the save game version at all.  Lets set it to 87, and check for < 87 as the old version throughout.\n. I have a save game that refuses to load:\nWill not check for updates since this is the Trunk version.\nSavegame version changed from 65 (0.20) to 87 (Trunk). The save was created using 65 (0.20)\nUnreserved an object: sofa at 108:63\nUnreserved an object: video_game at 99:59\nUnreserved an object: sofa at 106:66\nUnreserved an object: sofa at 102:59\nUnreserved an object: video_game at 100:59\nUnreserved an object: sofa at 106:62\nUnreserved an object: sofa at 104:63\nUnreserved an object: sofa at 104:62\n<LocalisedString> Current value:Error while loading game: ./CorsixTH/../../CorsixTH/Lua/entities/patient.lua:941: attempt to index field 'die_anims' (a nil value)\nhttps://sealbaker.com/corsix_saves/testing%20finisham.sav\nIt's probably worth pointing out that in master the save loads with the following console messages:\nSavegame version changed from 65 (0.20) to 85 (Trunk). The save was created using 65 (0.20)\nUnreserved an object: video_game at 100:59\nUnreserved an object: sofa at 106:66\nUnreserved an object: sofa at 104:62\nUnreserved an object: sofa at 108:63\nUnreserved an object: video_game at 99:59\nUnreserved an object: sofa at 104:63\nUnreserved an object: sofa at 102:59\nUnreserved an object: sofa at 106:62\nWarning: Could not find a humanoid to remove from the reserved user list\n. How are you doing on loading old saves e.g. the one I pasted?  The current pull request here gets the same error.\n. @J-Shep thanks for getting to this.  This and epidemics both seem really close so maybe I'll be able to wrap up this weekend after all, which would be great.  I'll let you know if I see anything else.\n. assuming I don't say anything else, don't worry about it, I'll fix it before I merge - pretty straight forward when it's the last commit.\n. Merged.\n. Why did you close this?  According to your message you checked the original and there is a problem with how we handle CorsixTH right?\n. @MarkL1961 It would be easier to merge these if they were one issue per commit, even if the issues are tiny.\n. Needs to be split up\n. I think the in class forward declarations are less clean than the header includes they replace.  Maybe it would be better to be a little less aggressive?\nEdit:\nI see various style guides disagree with me.  I can admit to being wrong :+1: \n. Mind if I squash those commits together when I merge?\n. Please update your commit message.\n(It would be nice if someone did a global trailing whitespace fix so that they didn't end up bloating the diffs of other commits)\n. Sure, a PR to fix all the trailing white space would be great.\n@alanwoolley What are your thoughts on some simple code format checks in the TravisCI.  Trailing white space as a first step?\n. @mounirlamouri @mrtnptrs I was planning to investigate whether we could/should use getopts instead of parsing ourselves as it would cover edge cases like quoted parameters better.\nI'm also not sure why you're capturing 0 or more trailing spaces in your second pattern.  It seems like both patterns were modified to handle the case of a single arg containing a space terminating the setting, but you then don't handle the case of a single arg containing a space between the setting and the value.  Is this intentional?\n. @mounirlamouri I'm not going to use getopts, but the question about your pattern remains.  Are you still around?\n. Closing because there are still issues with this pull request and it appears abandoned.\nIf anyone is interested in picking this up they can re-open.\n. :+1: \n. @mounirlamouri CorsixTH isn't checked out to the current directory.  You can see the Travis CI details.\n. Looks good except for the typo in the usage comment.\n. Squashed fix usage commit and merged.\n. The commit message is misleading.  If you don't mind I'll set it to \"Traditional Chinese translations for cheats\".\n. @GitBranch Are you interested in cleaning this up.\n@MarkL1961 if GitBranch doesn't get back to us, is there anything here we can use?\n. @GitBranch That's good to hear.  I understand that it's best to do your translations against the latest english.lua, as other language files can become obsolete as you ran into here.\n(There has been some discussion about improving the translation processes, but I'm not aware of anything happening on that front at the moment.)\n. @MarkL1961 Maybe someone here with translation experience can help GitBranch out?  I have none.\n. Likely\n. It's been well over a month since we've last heard from @GitBranch - I think we have to consider this pull request abandoned.\n@J-Shep at this point if you were interested you could probably pull the commits into your own repository and make a new pull request based on that.\n. Ok, spiffy.\n. Welcome back GitBranch.  We hadn't heard from you in a long time so I \nthought you lost interest.\nJ-Shep was going to try to pull out the translations you made that are \nstill needed.\nOn 2014-08-21 01:55, GitBranch wrote:\n\nHey, What's up? Closed. :D\n2014-08-21 2:44 GMT+08:00 Stephen E. Baker notifications@github.com:\n\nOk, spiffy.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/239#issuecomment-52823022.\n\n\u2014\nReply to this email directly or view it on GitHub \nhttps://github.com/CorsixTH/CorsixTH/pull/239#issuecomment-52881247.\n. The changes look good.  Can be merged when I or anyone else with commit access tests it.\n. No problem\n. @mrtnptrs It fixes a missing dependency problem with certain compile options.\n. @JoeButler99 Just so you don't run into problems in the future, I'd advise that you don't directly change your master branch.  If every time you want to make a patch you:\ngit checkout master\ngit checkout -b mypatchbranchname\nthen you will avoid some problems.\n\nEdit: This isn't something you need to change to get this pull request accepted, just a piece of advice for your own sake.\n. @JoeButler99  Alright.  I don't think I can accept this patch as is.  I will close this so that we can write a more targeted fix when we know more about what's causing the problem.\nCould you open an issue for this and describe in detail what version(s) of CorsixTH you've seen the issue on, what operating system, was it an upgrade or fresh install, and so on, anything that might be relevant to tracking it down.\n. The individual who last reported it in irc was using 0.21, but I don't recall what operating system.  I am hoping if it still affects the latest master that @JoeButler99 can still reproduce and open an issue about it.\n. Ah, and we remove all trailing spaces now so the problem is probably much more pronounced in current master.\nYes http://www.lua.org/pil/2.4.html indicates \"We can delimit literal strings also by matching double square brackets [[...]]. Literals in this bracketed form may run for several lines, may nest, and do not interpret escape sequences. Moreover, this form ignores the first character of the string when this character is a newline.\"\n. The solution @JoeButler99 has here will work, though it loses some of the intentionally empty lines.\nSomething like \n'fullscreen = ' .. tostring(config_values.fullscreen) .. '\\n' ..\n '\\n' ..\n 'width = ' .. tostring(config_values.width) .. '\\n' ..\n 'height = ' .. tostring(config_values.height) .. '\\n' ..\nmay be prettier\n. @MarkL1961 I searched all of the lua code, and the only affected file is config_finder.lua\nThat said, every line of the config following a replaced variable is affected, so yes more than is in this pull request.\nI will submit my own pull request along the lines of my last comment next time I get an hour if @JoeButler99 doesn't get around to it first.\n. Sorry @MarkL1961, you could have merged that ;)\n. I'm having some problems with this: Arch Linux, opengl\nOn the main menu, if I switch resolution I see:\n\"THMovie overlay should be deallocated before being allocated!\" in the console.  If I then start a campaign, the intro movie is corrupted, and sometimes I get seg faults.\nActually in the SDL2 branch even without this patch I don't get the movie playing correctly after switching resolution, but I don't get that console error.\n. To clarify the above console output is when switching back and forth to full screen, not when changing resolutions.\nThe video corruption does occur even just after changing resolutions.\n. @jorgenpt To correct the corruption I mentioned in my previous comment you just need to share the OpenGL context again.  (The code that is currently in play() as if(!m_shareContext))\nEither that could be deleted in unload or handled in setRenderer.\n. Alright, since @jorgenpt doesn't seem to be available to look at this and the sdl2 branch not being mainlined yet, I've decided to merge this and then clean up the movie issues.\n. I am using SDL 2.0.3 in ArchLinux on a US keyboard.  It would be good to get verification on this on other specs.\n. Changed the SAVEGAME_VERSION from 83 to 100.  83 is used in master now, and it's likely several more versions will be before the SDL2 branch is merged.\n. I found the fix for this: https://github.com/CorsixTH/CorsixTH/pull/250#issuecomment-42153239\n. @romy4 v0.30 is an SDL 1.2 program and not compatible with SDL2.\nWe have an experimental SDL2 branch which might work better for you if your distro doesn't include SDL1.\n. @romy4 You probably need to delete your CMakeList.txt or fill in the missing details manually.  Lots of us compile in linux regularly so you can probably get some help on IRC.  I myself am on pretty regularly Monday to Friday 8:00 - 4:30 EST.\n. pthreads is a unix threading library.  We do not directly request or require it. \nThere are no references to pthreads in our source.  In my build folder I see pthreads not found in my CMakeError log, but it didn't stop the compile from working.\nI think this is more related to CMake or the distribution than it is to CorsixTH and it should not be fatal.\n. What version and operating system?\n. Alright, I can reproduce the issue with your save.  It appears that in your save the gp room is already considered built, so the UIInformation dialog doesn't show up.  The crash is because at this step in the tutorial the game is trying to blink the button on the information dialog.\nI'm not sure how you got it in a state where it thought that a gp had already been built?\n. Well I guess there's kinda two issues here, I don't know how @lgdolman got a save game in the tutorial with no gp offices where it thinks one has been built, and I don't know how @sssheep got so far into the game without the tutorial ending.\n. Ok, I can reproduce this in the original case.\nFirst, make sure debug = false in the config.txt (For some unknown reason debug mode turns off information windows which prevents this bug)\nThen start a campaign with Tutorial on\nBuild a GP office before being told to in the tutorial\nFollow regular tutorial instructions (build a desk, hire receptionist, build another gp office)\nCrash occurs when finishing the second gp office\n. Sorry, I see they did the same thing in the provided save game.\nSo a fix is just to make the criteria for going to step 16 match the criteria for showing the UIInformation window (specifically go to \"next\" instead of 16 if the room has already been built).\n. @MarkL1961 I'll look into that discussion and perhaps reopen the issue here, but I'd like to keep this issue on topic.  I mentioned it in the steps because it affects the ability to reproduce this issue (you need to turn debug off).\n. At this point the issue should be trivial to fix, it should be in 0.40\n. To clarify the above: \nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/room.lua#L641  controls whether to show the UIInformation window and https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/dialogs/edit_room.lua#L244 controls whether to run tutorial step 3, 16.  Tutorial step 3, 16 will crash if the UIInformation window isn't available, so the conditions need to agree.\n. Afraid that opening the old save in the new version won't retroactively fix this.  If you have an older save load that.\n. It is extremely likely that this and #99 are the same issue.\n. In the forums, there was mention of a number of places in room.lua that don't appear to appropriately filter for staff type. Unfortunately they didn't bring the list over here, and I seldom check the forums, but you seem to be confirming their suspicion.\nI wonder if there shouldn't be subclasses of staff.lua for each of the types, and more checks for class.is(humanoid, Doctor) or class.is(humanoid, Nurse) instead of class.is(humanoid, Staff) (An awful lot of Staff.lua is specific to Doctors as it is)\n. Sure, it's been over a month with no traction and I'm sure it's right.\n. The SDL2 branch, with pr #250, with the changes I indicated (https://github.com/CorsixTH/CorsixTH/pull/250#issuecomment-42153239) should address these movie issues.\n. hmm... I bet that's because you put that folder in the saves directory.\n. Yes, the Continue button code expects only the Autosaves folder and save games in the Saves folder, and only saves in the Autosaves folder.\nI suppose it would be better to be more resilient.\n. @alanwoolley Thanks for linking that discussion.\nAs was brought up there, maintaining compatibility with luaJIT is important.  I expect this to be something we work on sometime after the SDL 2.0 merge and CorsixTH 0.40\n. @mrtnptrs We already use LuaJIT 2.x, this issue is just to add support for Lua 5.2.  When someone seriously works on it we can decide if it needs a branch, but I imagine we'll build it on top of what we have so we don't need to break things for a long period like SDL2.\n. Lua 5.3 is now out (www.lua.org/manual/5.3/readme.html#changes)\n. I started some work on Lua 5.2 compatibility.  At the moment CorsixTH compiles with both Lua 5.2 and 5.1 but it breaks in graphics.lua unable to find bitmap:setPalette(...) so I think there is something wrong with luaT_setfunction.\nYou can see and make suggestions based on my work at https://github.com/TheCycoONE/CorsixTH/tree/lua52  I will still be rebasing and forcing changes to that branch.\n. I now have the game working in Lua 5.2 as far as I've tested it.  (Playing the intro movie, starting a custom level or campaign, placing a reception desk)\nLoading a save game (persistence.lua) is not currently functioning due to some setfenv calls.  Likely after I've taken a look at that issue I'll make a pull request for this.\nThanks to @corsix for doing so much of the compatibility work (for an older prerelease of 5.2).  That work certainly made mine a lot easier.\n. Lua 5.2 and 5.3 compatibility is addressed by #703 \n. @JASheppard since you're not developing at the moment would you like me to clean up those couple points?\n. Looks good.  I don't see any merge conflicts - what are you referring to?\n. @JASheppard Spiffy\n@MarkL1961 Do you have a chance to see if this pull request works for you.  I know you had the problem with the last one because of your save folders.\n. Great, thanks @MarkL1961 and @JASheppard \n. Always good to have a new contributor!  I think @mrtnptrs is right, this is a little bit too direct.\n. @Steadi How are you doing on this?\n. Thank you very much for your contribution @Steadi.\nI'm closing this pull request in favour of benchx's pull based on it.  I'm sure your work inspired his and I look forward to your further contributions.\n. The patch also adds trailing white space.  I'm not sure why Travis CI didn't pick up on it.  I think that's the last thing to clean up.\n. Ok, I did the cleanup and merged this.\n. Even though this is clearly a bug fix, these changes will make bench warnings more common (once a year for almost everyone).  I think someone will have to rethink the bench counting before we ship 0.40.\n. Merged\n. Just the one line to change, then this can be merged.\n. Merged.\n. thanks\n. Alright, since this is already merged, could one of you submit a new request with these fixes.\nSorry.\n. To follow up on MarkL:\nThe master branch still exclusively supports SDL 1.2\nThere is a branch called SDL2 which has a few remaining known bugs but is generally quite useable.  If you are building with SDL2 that is the branch you need to use.\nThe upcoming 0.40 is expected to use the SDL 2 branch, but only if we can fix some more of the remaining regressions.  There is currently no set release date for 0.40 - traditionally it would be in June or July, but I'd like to see one of the large pending features land first (Hell Deaths, SDL2, and/or Epidemics)\n. Just to rule out the obvious: you have a research department?\n. I always thought that the intention of the autopsy machine was to improve your research in the disease (cure) specific to the patient that used it.  I don't think this was actually implemented in Theme Hospital, where it was mostly just a way to ruin your reputation.\nEdit:\nIt's unfortunate that the manual doesn't mention it.\n. Ok, but there's still room for improvement in the disease after you can build the room, affecting the chance of success with the cure, so there's no reason to grey the option out.\n. Thanks for digging that up @MarkL1961.  No sense going back and forth over this.  Closing, if someone wants to implement another autopsy behaviour they can open a new issue / pull request for it.\n. I'm not an expert at all, but given that these are closely based on the original midi this triggers some red flags to me about copyright, so we may not be able to include them with CorsixTH.\nCan any experts clarify?\n. There is fairly basic support for external tracks through the MP3's folder in the config.\n. @excpt This discussion probably belongs in the forum (http://forums.corsixth.com/) since it doesn't relate to any change in CorsixTH's code.\n. What happens now when self.current_map_earthquake goes beyond the end of level_config.quake_control?\n. In world:setSpeed it records the current speed so that when you unpause or unspeedup it can return to it.  The problem is we're entering two temporary states, both speedup and pause.\nI think it shouldn't overwrite the current speed when the game is currently Paused or SpeedUp.  Anyway this can be a separate issue.\n. I believe this commit makes the workaround here: https://github.com/CorsixTH/CorsixTH/blob/79c43a958831eccd253e13a9d172f014bb193dbd/CorsixTH/Lua/dialogs/message.lua#L105 irrelevant.\nCould remove it in the same PR for cleanup.\n. @JASheppard as @MarkL1961 points out GameUI:onKeyUp() handles releasing the SpeedUp key already.  The difficulty is that there isn't currently a state tracking when the key is held down so you would know what speed to return to.\nI haven't tested this, but does releasing the \"Speed Up\" key with this patch while the game is paused cause the game to unpause?\n. No it wouldn't, there's a check to see if the game is currently in Speed Up on that function.  That's good at least.\n. @JASheppard It's not perfect, but it should be at least as good as it is now if instead of if self.app.world:isCurrentSpeed(\"Speed Up\") then it was if self.speed_up_key_pressed then.\nThe case where this fails is the same as the case that currently fails, if you press multiple keys down.  That shouldn't come up under normal use.\n. I'm ok with this hook for now\n. Sure, but I'm not convinced that some other tool won't come around at some point.  Something that allows breakpoints throughout the code and the ability to change the lua on the fly, like Visual Studio does for the .NET languages.\nAnyway I did approve it.\n. So to recap where we are on this issue if I understand correctly:\nThanks to @J-Shep's sleuthing we know the problem is caused by a patient in the hospital with a nil tile_x.  One cause for a nil tile_x was known to be an interrupted scanner.\nMoving the room would interrupt the scanning operation and kick the patient out.  It could also make findObjectNear return nil for the screen since temporarily it doesn't exist during the move causing the nil tile_x.\nJ-Shep fixed the scanner room in #293, so what is keeping this issue open?\n. I agree with @MarkL1961.  Actually I would like to do a 0.40 release soon, perhaps without Hell Deaths or SDL2.  Looking through the change log I know that it wouldn't have any super exciting features, but it would have quite a few bug and translation fixes.\nSee: git log v0.30..master --no-merges\n. Lets move the remainder of this conversation to the mailing list, so we don't divert attention away from @J-Shep's patch.\n. That's ok, one pull request for all interruption bugs is fine.  Have you already found them all? Good work!\n. The problem is with world.lua in World:nextEarthquake()\nOne possible solution might be to check the severity of the first earthquake [1] in the else condition instead of the level number to decide on random earthquakes.\nAlternately it might be desirable to simply cycle through the defined earthquakes again after reaching the last one as that would keep the severity levels and time between earthquakes consistent with what the map maker had in mind.\n. We're on the same page for the determining factor for earthquakes then.\nI'm a bit worried about making them completely random after the initial cycle.  For instance severity 10 only comes up in the net levels, and severity 9 is used very rarely (only in month 97 of level 9). EASY05.SAM has an earthquake progression of 1 2 3 4 4 5 5, whereas medium and hard for that same level has 1 2 3 4 5 6 7.  To suddenly throw a 7 or 8 in that easy level would be out of place, a 9 or a 10 would be insane.\nI'm curious how the original game handled this.\n. I think this behavior from the original (no random earthquakes) would be a good fix.\n. Alright, I think it's fine to add a new level flag to enable/disable random earthquakes, defaulting to disabled.\n. The current earthquake trigger is wrong. I'm in favor of earthquakes being purely opt-in, and only at the dates defined in the level file. If we want random quakes indefinitely we can add a new level file line for that.\n. Thanks @MarkL That warning was critical on later earthquakes.\n. I've run several tests on the original with earthquakes added to the first level.\nUnlike ours it seems nothing is random in the original:\nDamage is the severity of the earthquake. We do severity plus or minus 1.\nThe earthquake always happens in the month following end month (accounting for 0 based months), we pick a random date between start date and end date.\nThey have a warning tremor that does not damage about 12 days before, we are missing that.\nOther observations\nThe day of the month is consistent each time I restart but not between different  earthquakes in the same level. I don't know what determines this.\n. I was wrong about never happening between start month and end month.\nWhat I mean is if you replay the same level quakes will happen on the same date every time you play. But from the level config I can't predict when that date will be.\n. Anyway I think that's just due to the way randomness is handled in the original. The only real difference is +-1 severity and the 12 day warning \n. And that we insert random earthquakes after the scheduled ones - which I would like to drop. No reason to treat earthquakes different from other scheduled events in this regard.\n. Fixed. All SDL2 builds will fail at the moment because the external dependency The command \"wget http://ftp.jp.debian.org/debian/pool/main/m/mingw-w64/mingw-w64_3.1.0-1_all.deb\" failed and exited with 8 during . doesn't exist.\nThat said I'm still hoping someone will review this patch.  It doesn't seem at this point like the new version will be SDL2 anyway.\n. This idea isn't workable.  Forgot we're cross compiling here to help the windows testers.\n. Confirmed, the Travis testing builds are missing lua51.dll.  The file has been missing as far back as we've been using TravisCI.\n. That commit probably shouldn't touch ui.lua.\nOtherwise I like the fix.\n. Code looks good.  I don't have a keyboard I can test on at the moment, but if someone else can let me know it works for them I'll rebase these commits into one and merge it.\n. @benckx Excellent, that's good to hear.  I am looking for an independent verification just to confirm.  I do have other keyboards around so I'll try it out next time I have a chance.\n. Ug.  Those should have been rebased.  Sorry.\n. @J-Shep @benckx Since the refactor just changes stuff from the first commit, it should all be a single commit.\nIf benchkx isn't comfortable with an interactive rebase we can do that step when we merge.\n. @benckx Would you mind doing a git rebase -i HEAD~6 to merge those all into one commit? I think I saw that you did it for one of your other pull requests.\n. Nope, something went wrong there...\nNo worries, we can do it.\n. Merged.\n. I don't think there's any harm in making this a repeat button to improve useability regardless of how the original game did it.\n. I'm not really an expert in translations, but this looks good for me except my above comment.\n. Not sure what editor you're using that's removing the final newline from files, but a lot of tools especially for unix systems don't like it to be missing - could you put those back?\n. In general I like what I see except for the couple points I made above.  We'll have to try it about a bit to ensure the numbers are alright and the adviser is the right amount of chatty.\n. @benckx I don't think goHome(false) is appropriate here, it shouldn't be increasing the kicked patient count.  I think it would be better to extend goHome to take a reason (cured, kicked, too_expensive).  Then you could use the mood properly.  (We generally try to mimic the behavior of the original game unless we are sure we're improving it)\n. At this point, I think we better leave this for the next version, given the impact on game balance that needs to be evaluated and the changes left needed.  Look forward to seeing it in 0.50!\n. I'll close this when the new PR is ready.\n. @J-Shep  Change looks good, but what's up with that commit message?\n. :+1: \n. No, but I believe you could just rebase or commit --amend the commit without making any changes to the content and it will run again.\n. As can be seen, this still fails, even with the latest mingw changes.\nI've checked the deb's contents and it does contain winapifamily.h, so I'm not sure why it's not detected.\n. On a positive note, whenever SDL 2.0.4 is released it shouldn't be an issue.\n. Success!\n. Rebased into a single commit.  This is ready to merge.\n. Thanks, will merge this right after 0.40.\n. Changed wrapping to 80 characters and merged.\n. @docucci Does this happen regardless of the rendering engine chosen, or are you always picking the same one? e.g. DirectX?\nCould you paste the contents of your game_log here? (I believe there are instructions in the wiki for how to find it.)\n. Based on that output I believe you have corrupted data files for the original game.  If you pirated the game I recommend buying a copy off GOG, otherwise try copying the files from the CD or running the GOG installer again.\n. @Vzor This issue is different than the one @docucci posted.  I believe your issue has already been fixed for the upcoming 0.40 release.\n. This is a different issue than you originally reported.  It is likely a duplicate of #162 though the stack trace is a little different.\n. Looks good to me, just haven't gotten around to trying it yet with all the release stuff going on.\n. Looks great @Lego3, I like how fun you made it :+1: \n. Merged\n. @marc-cairo Since the crash appears to occur in the frame handler, does it also happen with the DirectX rendering engine or is it specific to SDL?\n. Ok, the memory error with DirectX is known (exists in 0.21 and 0.30).  Will be resolved when we switch to SDL2 for 0.5, and you can work around it for now by turning off movies in your config file.\nThe SDL frame error will need further investigation.  Did you ever get this same error in 0.30, or just other crashes?\n. The SDL frame error just happened to me in CorsixTH 0.30 Linux.\n. Interesting that the original comment here and #715 both reference clicking a doctor as the trigger.\n. Even for lua debugging jit mode needs to be disabled in LuaJIT. I'm not sure how to begin debugging this unfortunately. In the mean time we are recommending plain Lua instead.\n. I believe we fixed this when I readded support for LuaJIT 2.x only.. Thanks @benckx \nWe're all busy with 0.40 at the moment, but once those bugs are squashed and it's out the door, it will be nice to take a look at this.\n. @benckx 58fe774 makes things pretty messy, a rebase would have been better.\n. I don't think there's anything gained by renaming Entity to Creature, lets drop that change. Spawning holes needs to take more into consideration as mentioned above - picking a random wall is probably still the way to go, but if the chosen wall is not suitable for a hole we should either try again or give up (if there are no suitable walls we don't want to be in a non-terminating loop).\nI am not sure why rat spawning was set to require a distance > 6, in the original rats would go between much closer holes than that.\nAs I mentioned above, 58fe774c makes a mess of this PR and needs to be reset out.\n@benckx do you plan on taking this up again?\n. Replaced by #1117\n. @mpmc I think these should be two (or three) separate issues.\n. It seems obvious to me that the first fax shouldn't come up (the condition hasn't been discovered yet).  I think only the send patient home / wait for awhile / greyed out research room should show up until the treatment room is built.\nCurious to get @MarkL1961's input on this.\n. @MarkL1961 this isn't the same as #277, his concern is with the first fax which allows you to \"Take a chance on a possible cure\" before the room exists.\n. Alright, thanks for your freed back @MarkL1961.  That discussion is about the same fax but isn't quite the same complaint as it's about whether it makes sense when there's no more diagnostic rooms, and this is whether it makes sense when there's no room to cure, but I see a broader discussion about when to display faxes / in what order can be had in the future. \nI'll mark this as Future, not a 0.40 blocker.\n. @J-Shep would this be related to the audio changes you made for hell deaths?\n. Sounds like we need further investigation into the behaviour in 0.30 vs 0.40 or if they are the same.  I will get to it next time I have an opportunity if no one else beats me to it.\n. @MarkL1961 we had worked around that SDL_Mixer bug by stopping the music when the game was paused instead of pausing it.  See: https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/audio.lua#L510\nGame testing is needed.\n. Ok, No worries.  If it indeed works in 0.30, git has a feature called bisect where we can isolate the exact commit responsible and see what happened.\n. @J-Shep this isn't a regression then?\n. Confirmed, music continues to play when game is paused in both 0.30 and 0.40, and so do random announcements, so there is no regression.\nAs far as I can tell the fix is a one liner, which this early I'd probably let slide into 0.40 but it's certainly not critical.\n. Just to be clear music should play, it's only the random announcements that shouldn't.\n. Yes I think it's best not to have them.  It can't be frequent enough that you'd miss it @Lego3?  When I was testing I had to wait through several songs before the first one. :-)\nAnyway we pause for a variety of reasons where it's probably not appropriate and it appears to cause confusion.\n. Pull request by J-Shep has been applied and will appear in the next 0.40 beta / release candidate.\n. Looks the same indeed, so not a regression, but not yet in GitHub.  We'll leave this open.\nI'm not sure to what extent this is game breaking.  I'm leaning towards not blocking 0.40 with this since it's been a problem forever, but if someone wrote a fix it would probably be accepted.\n. I'd like this issue to be primarily about the physician stuck in psychiatry (or other room) issue.\n. Ok, thanks for the update @J-Shep \n. What is the state of this pull request?  If unfinished @wolfy1339 did you plan on finishing it?\n. Thanks @benckx \n. We're a little behind actually and I haven't come up with new dates.  How much time do you think you need?\n. merged.\n. It's good to track it until it's done :)\n. http://code.google.com/p/corsix-th/source/detail?r=1427 is https://github.com/CorsixTH/CorsixTH/commit/41c8b342b9ba162d1b2c4f1552cb4588ffd8279d\nEdit: I see you linked to the google source because it has discussion\n. None of the discussion in those two commits says WHY it was turned off for debug though.\n. @Lego3 do you want to join this discussion?\n. Thanks for the insight @Lego3.  The suggestion stands as making the default room information setting a separate config option not tied to debug then.\n. Thanks @MarkL1961, I'm aware of this one.  Duplicate of #147\n. @SupanovaHS Thanks or taking the time to learn Lua to help us out and investigate this bug.\nTesting the original game:\nYou can click edit, and click any radiator, fire extinguisher, or plant in a corridor and move it into any room (or anywhere else in the corridor that's valid).\nWhen editing a room you cannot move any object outside of the room\nYou can right click any \"corridor object\" even when they are in a room.  Radiators, fire extinishers, and plants can be moved in and out of rooms this way.  Drink machines, benches and reception desks can be moved throughout the corridor but not into a room.\nBins are not corridor objects (as has been mentioned).  They should not be changed / included in the resolution of this issue.\nIn general I would prefer a property on those 3 objects, e.g. 'anywhere_object = true' instead of relying on any magic numbers (thob or corridor_object)\n. @MarkL1961 It's used for a couple things, the number itself is used for that, the existence of the property is used to determine if an object can be placed in a corridor, or can be edited outside a room, e.g. https://github.com/CorsixTH/CorsixTH/blob/cc17336e69def0a63d7f9105a6e62980fd8756c2/CorsixTH/Lua/entities/object.lua#L640\nBut yes I certainly don't want to rely on that number being > 3, and checking the thob number is a little cryptic (even though both would work) which is why I proposed adding a new property.\n. Confirmed that this is a regression since v0.30.  I will be running a git bisect to find the exact commit that broke it.\n. Result of git bisect:\n6075e17bacc3cda485349e8866f6b467c872a1ed is the first bad commit\ncommit 6075e17bacc3cda485349e8866f6b467c872a1ed\nAuthor: J-Shep J_Sheppard@live.co.uk\nDate:   Fri Sep 26 15:19:59 2014 +0100\n```\nCreated world.lua \"can object spawn at\" check functions\nBecause lava holes are objects which spawn instead of being\nplaced this commit must implement the object spawn checking\nfunction: world:wouldNonSideObjectBreakPathfindingIfSpawnedAt()\nThis new function performs the required spawn checks by calling\nfour new functions for each test, allowing these tests to also\nbe called in setBluePrintCell() when objects are being placed:\n+ world:areFootprintTilesCoardinatesInvalid()\n+ world:willObjectsFootprintTileBeWithinItsAllowedRoomIfLocatedAt()\n+ world:checkFootprintCellsTileIsBuildableOrPassable()\n+ world:wouldNonSideObjectBreakPathfindingIfSpawnedAt()\nSo this commit must also modify UIPlaceObjects:setBluePrintCell() by moving the\ncode for these tests into the new test functions.\n```\n:040000 040000 5ee8d1d800b1f19985d90ad92ffc67d37e9b6b3d 3b0fca1b88d668317d31cec269b2d52689d98d8c M  CorsixTH\nSo @J-Shep this one's yours :-)\n. I don't see the harm as long as it's:\n- Maintained\n- System agnostic\n- Separate from the source files\n- Organized so things wouldn't get cluttered if we needed projects for multiple versions of Eclipse and/or Visual Studio.\n. @J-Shep normally you unstage changes with git reset.  My experience is that removing files from the git cache causes issues, but I guess you've gotten past that now.\nI think it should be possible to have:\nroot/eclipse/CorsixTH.project\nroot/eclipse/CorsixTH.settings\noutside of:\nroot/CorsixTH/Lua,\nroot/CorsixTH/Src\nThat way all of your new files are in a single new folder dedicated to eclipse.  My own eclipse workspace is setup like that (as is my kdevelop workspace and my plain old cmake build folder)\nI don't mind a single eclipse version for now, but I don't agree that just because it can convert projects to new versions automatically that means we won't ever want to include multiple versions.  One possibility is that we want to take advantage of a new feature for people with an up to date eclipse without breaking support for people with an older version.  Doesn't hurt to do something like:\nroot/projects/eclipse-indigo/CorsixTH.project  This would allow us to continue with e.g. root/projects/kdevelop4/CorsixTH.kdev4 and/or root/projects/vs2010/CorsixTH.vsproj if we desired.\n. You probably want to read: http://help.eclipse.org/juno/index.jsp?topic=%2Forg.eclipse.platform.doc.user%2Ftasks%2Ftasks-45.htm (older version but the same thing applies).\nYou can use a variable for the project location in the linked path and go up from there, so something like ${ProjDirPath}/../../CorsixTH/Src\n. @J-Shep You can use linked resources to link to source paths, which is what I did.  You can see another example here: http://www.freertos.org/Project_Workspace_Relative_File_Paths_Eclipse.html\n. Good find J-Shep.  Agreed that this won't block 0.40.\n. Sounds great J-Shep.\n. Does this depend on #342 \n. What do you see in your package.path from within CorsixTH?\n. Oh, lua sockets is a dll, so it would use package.cpath, you could check that.  Other than that I don't know.\n. 0.40 should be released on Monday, if this had come in earlier (in the beta phase) I would have agreed.  Now I hope it helps make 0.50 the most bug free version yet. :+1: \n. Duplicate of #124 \n. @Lego3 would you mind to look at this and see if it fixes your heap errors.  You were saying on irc you couldn't run in debug mode in visual studio with luaJIT.  With this patch it works for me.\n. @Lego3 Do you still get a heap error?  If so could you post the stack trace in a new issue?\n. What about removing the handler when debug is disabled?\nIt may be simpler to always add the handlers and return immediately in the callback if debug is not enabled.\n. @J-Shep For locality of reference (putting related code together), the debug key handler should be in the afterLoad of ui.lua with the rest of the key handlers.  Otherwise I'm happy with it.\n. @J-Shep your previous comment isn't true, ui:afterLoad is called every time App:afterLoad is called.  You can see the call to ui:afterLoad in app:afterLoad with no condition.\n. ah, sorry about that.\n. If I'm reading this correctly the MyVScrolled derived helper class only exists to avoid a call to SetRowCount if the rows are the same which could also be accomplished by calling GetRowCount, but probably not necessary at all.  I don't think there is a need for this new class?\n. @sirlimpy Was there anything in the gamelog or lua console?\n. Duplicate of #154 \n. Who has access to this, @Lego3 ?\n. @MarkL1961 \"with last update\", do you mean that you copied lua changes from after 0.40b2 effectively putting you on the same version as @mpmc , or simply 0.40b2?\n. Yes, if we can get a sure way to trigger this error it will be easier to run a regression analysis.\n. If this patch is good it can be merged for 0.40.\n- it is a bug fix\n- it is small\n. Alright, if I'm following everything correctly:\n@phillipp This patch ensures that meander doesn't overwrite any more important action by moving setting it to before dealing with the patient.\n@J-Shep you're not completely satisfied with the patch because the Dr. isn't answering the patient already standing in queue at the GPs office, though he does answer the call of new patients?\nNot passing judgement at this time, I just want to make sure I completely understand both of you before I start investigating myself.  And @phillipp, I'm sorry you're frustrated, I hope this doesn't sour you from contributing in the future - both of your efforts on action queue bugs lately have been hugely appreciated.\n. On testing the save game I see the source of the confusion - the patient had already queued for the GP office when the bug existed so the psychiatrist didn't get called, but they are the first time someone queues after the patch is applied.  I agree that this is fine - it's not always reasonable to repair bugs in saves that people have already encountered.\n. Thanks @J-Shep all good advice.\nI like the additional recommendation of git diff --check as well.\n. @J-Shep once the change is in master it's too late to change cleanly.  (You could force push an amend commit, but it has the possibility of breaking other people's repositories so don't, we'll live with the error).\n. Ok, I'll bisect this tonight if no one has found the cause before then.\n. Didn't get to this tonight.  It will have to be 'soon' instead.\n. @MarkL1961 do you happen to have an older save game from back when this worked?  Also what version was that, 0.30?\n. I tried reproducing this in current master with MarkL's save but while the handyman was repairing the ultra scanner I was able to reorder the queue.  The only time things behaved oddly was when the handyman was finished and attempting to use the door, then moving the front patient back in the queue put the handyman in the queue in place of the front person and attempting to rearrange at that point is weird, I think the same behaviour would happen when queuing for the door like you mention.\nI tried this in 0.30 and the behaviour was the same.\n. If zoom still causes problems when we're getting close to release I'll disable it, for now there's still plenty of time to sort out the issues, and the workaround is not to zoom.  Put some tape over that mouse wheel @sadger ;-)\n. And because it's not explicitly stated here, the scaling on sprites that are drawn on the mouse location (which are not part of the zoom texture) appears to be the problem with the ghosting cursors. The other issues @sadger has may be unrelated.\n. No, the save file is clearly corrupt with a cyclic reference.  The scary part is what about the original game state caused this?\n. Is the new title right, or does this apply to all arrivals?\n. @falmasmoum Pirated versions of Theme Hospital are known to contain corrupt data files.  If you are using a version downloaded from an 'abandonware' site we cannot support you, please buy the game from GOG.com.\nIf I misunderstood your comment, I apologize. \n. This is because the current selected language is read from config.txt.  The installer inserts the english language name when you pick a language e.g. FRENCH, but the game itself uses the language name in the chosen language.\nI'll make a patch for this, but I think it should go in after 0.40\n. I take back my comment about the fix not going in 0.40, given the simplicity of the fix.\n. @bennuttall If you are referring to https://github.com/CorsixTH/CorsixTH/wiki/Getting-Started you should be able to edit it yourself.  If not please be specific as to where you read the instructions.\n. Code looks fine for me.  I might have used a '''break''' in the queue loop once the patient is found to make the average search time n/2 instead of n (on the length of the queue), but I suspect the actual performance difference is unsubstantial.\n. @phillipp yeah make it a break if you don't mind.\n. @phillipp Do you have any time for this this week?\n. There is a problem with this patch if the config file language is missing or invalid it crashes on the option screen.  I'll fix that momentarily.\n. Changed to revert to old behaviour if the language can't be found - this is at least no worse than it was.\n. I only tested with an empty entry.  I'll look into that.\n. Oh... I didn't actually push my fix for that before.  Sorry about that :(\n. Doesn't really matter to me if it goes in now or after 0.40.  Use your judgement :-)\n. I've seen this too, at least as far back as 0.20.  Likely errors with uninitialized memory but I haven't traced them down.\n. Fixed by #718\n. @sadger could you include the save game that is experiencing the problems.  All of my save games work.\n. ok, thanks for the two saves.  Doesn't seem like @benckx has seen this yet so I'll take a look.\n. Created a fix.  Unfortunately it seems we created a situation where we can either be compatible with save games before that commit or after that commit (if they happen to have multi_use_object in the action queue for an operating theatre surgeon).  Given that most people will be using an older save game I think this is the right thing to do.  For those of you working with beta or git copies - save when there is no one in the operating theatre and I believe you should be good.\n. Alright, so there is more that needs to be corrected then.  Thanks for testing @MarkL1961 \n. Loading callback functions from the current source for objects from the save source is VERY problematic.  Anyway this time it's because of the after_use callback, which changed much more.\n. J-Shep have you made any progress on this. I see it marked as a 0.5 item. If not let's remove the milestone. \n. As far as I can tell this and #922 are mutually exclusive pull requests, though at the moment both seem to be on hold. Could you guys sort out which of these is the more promising direction?\n. Obsolete by #1119 \n. Says Czech which means it's using freetype.\n@Glimmer-Man Do you see the same problem in 0.30?\n. Fonts are monochrome so it's not that, but it could be a font type that our colouring doesn't work on.  I haven't double checked if the colouring is working with any non-original freetype fonts this version personally, that's probably a first step.\n. Thanks @Glimmer-Man.  Can you tell us what font is set in your config.txt?  Or paste the entire config.txt.\n. Ok, so it's using a white system font to replace a white TH font, but the TH font has a built in drop shadow that fixes the problem and of course system fonts don't.\nFor the fax issue it looks like they improved a colour selection algorithm to take into account the average colour of the sprite the font was writing on top of - I'm not sure if that's called here or not.  Ideally the font would be black for freetype fonts?\n. @Glimmer-Man If you're able could you test my pull request?\nIf you don't use git, try copying https://raw.githubusercontent.com/TheCycoONE/CorsixTH/raise_font_color/CorsixTH/Lua/dialogs/staff_rise.lua over top of your CorsixTH\\Lua\\dialogs\\staff_rise.lua file.\n. Yeah, it'd be good if the language list in the config.txt matched the game for the release - and simple enough to fix.\n. Thanks @bobcanthelpyou \nShould be easy enough to either bound the coordinates (draw the doctor on the map edge) or not draw the doctor when the mouse leaves the map.\nI'd have to play with it to see which feels more natural.\n. Thanks for the report @Glimmer-Man.\n. Is there any output in the console or gamelog.txt?\n. As far as I know, no one is actively working on this.  There was a mention on the mailing list that someone would but I haven't heard from them in a year.\nI guess you're going to try to implement the missions net levels from the original game?\nGood luck?\n. @J-Shep I'm not sure if you've had a chance to play the multiplayer built into the original game.  In it you all play on the same town map, when someone wants to buy a parcel it goes to auction between the players.  You can also interact a little bit with opposing player hospitals with litter bombs.\nGames tend to be pretty short, because as you play it keeps giving you missions like 'buy a parcel' or 'cure x patients' and anyone who doesn't finish that mission in time drops out until one player is the winner.  I don't remember if you could save or not, none of my games lasted long enough to matter.\n. @lbakyl probably best to use screen names here.  Particularly because J-Shep's name isn't Stephen and mine is. :)\n. Thanks for the update @J-Shep, good luck in your future endeavors.\n. Partially solved by #1119 - it is now possible to build over the litter and remove it that way. I don't think it is possible from this issue to determine why that particular piece of litter got dropped from the task lists.\n. This pull request needs more work, there were more persistent functions changed.\n. Replaced with a new copy, there were two other callbacks that needed to be fixed.\n. You're right @MarkL1961.  This is getting to be a trend isn't it.  Fixed.\n. @MarkL1961 I haven't been able to reproduce this error.  Can you be more specific as I can count 4 scenarios, though I think I've tested them all:\nFirst, there are surgeries that are going on before the upgrade, and surgeries going on afterwards, also there are two surgeons.  I think that I've tested every case, but maybe I missed something.\n. I can't produce that here even with those instructions.  Which is to say I see pickup must happen in the console and he doesn't get picked up until the end of the surgery but there is no crash.\n```\nSavegame version changed from 81 (Trunk) to 88 (Trunk). The save was created using 81 (Trunk)\n\nOn call: no\nBusy:   busy and picked up\nLast room:  operating_theatre@17,67\n\n Current value:Clicked on BENLAN   table: 0xb1943578\nClass:  Surgeon\nWarmth: 0.229   Happiness: 0.607   Fatigue: 0.488  Thirst: 0.000  Toilet_Need: 0.000   Health: 0.980\nActions:\nidle  must_happen\nmeander  must_happen\nwalk - going to 20:70  must_happen\nuse_screen - surgeon_screen  must_happen\npickup  must_happen  \n\n\nOn call: no\nBusy:   busy and picked up\nLast room:  operating_theatre@17,67\n\n Current value:Clicked on BENLAN   table: 0xb1943578\nClass:  Surgeon\nWarmth: 0.260   Happiness: 0.551   Fatigue: 0.502  Thirst: 0.000  Toilet_Need: 0.000   Health: 0.980\nActions:\nidle  must_happen\nidle  must_happen\nuse_object - op_sink1  must_happen\nwalk - going to 23:69  must_happen\nidle  must_happen\nmeander  must_happen\nwalk - going to 20:70  must_happen\nuse_screen - surgeon_screen  must_happen\npickup  must_happen  \n\n```\n. @MarkL1961 are you sure your version matches mine, with the local room = self line?\n. These are going in the wiki?\n. @Yehonal they are but only with ffmpeg, not libav.  Ubuntu will get ffmepg in 15.04.\n. @Glimmer-Man @lbakyl The issue tracker is not a chat room, lets keep this on topic.\n. I would like to see a mockup of the edit room dialog with this new button.  As an alternative, I was thinking shift+right click, and caps lock + right click (for people that can only use one hand) could move a room instead of an object.  This would avoid any additional UI clutter and save mouse clicks which I understand is the entire intention of the enhancement.\n. @J-Shep All true, but it sounds like major scope creep for an issue about being able to move a room without dismantling it.\n. These two commits should be joined, bringing in a whole lot of files for a single commit would grow the repository a lot needlessly.\nAt least through github, I'm only seeing the .gitignore and readme changes after all is done, not the project?  I guess this is a work in progress?\n. I'm not entirely clear what you're trying to do.  You want clones of the repository to create files but not to track them after they're created?  Removing them won't help with that, also several of the files added are specific to your computer and not needed, notably all the .log files.\n. @J-Shep based on the conversation in #426 it seems like we may drop LPEG, LFS, and maybe AGG in favor of having the builder supply it themselves e.g. through lua rocks.  I see those directories are included in the eclipse project, do you have any ideas on how that should be handled?\n. I get DLTK Problem at line 1 on several of the translation lua files, which appears to be because it doesn't like the utf-8 bom at the beginning of those files.  Obviously this bom is harmless in reality, is there a way you could suppress those errors or better yet get it to properly respect the file's encoding?\n. Ok, so the language files should be added back.  There isn't really sufficient instructions in the README or any links on how to use this project or what it's for.  It isn't suitable for building CorsixTH without a lot of steps.\n. Cool, I think that boilerplate is acceptable post 0.40.  Have you checked to see how it interacts with our persistence system?\n. @J-Shep How much have you looked at class.lua.  It seems like a lot of what you're doing is redundant to what it's doing when it encounters class \"name\".  If Eclipse could recognize that ...\n. Sure, and if we wanted to do the whole thing you could put 'declared' in class.lua and call it something like end_class.  It should only need to take the string argument to mirror the class method. (assuming eclipse could handle that), since the object would just be _G[name_string].\nThat way it could be called as:\n```\n---@type Car\nlocal Car = {}\nclass \"Car\"\nfunction Car:Car(name, man, mpg)\n  Car.name = name\n  Car.manufacturer = man\n  Car.mpg = mpg\n  Car.distance_travelled = 0\n  instance(Car, self)\nend\nfunction Car:setDistanceTravelled(newDistance)\n  self.distance_travelled = newDistance \nend\nend_class \"Car\"\n```\n. ah, I see what you mean.  The new script local object obscures the global object so all the methods end up being assigned to it instead.\nWhat would the LDT do, if instead of local Car = {} you defined the global Car there (and possibly removed re-defining it from class.lua, but I don't think that matters).  Then copying the methods shouldn't be necessary.\n. @ProjectPaatt What version is this?  And do you have a save game that reproduces the problem?  Maybe the last Autosave from before the crash?\n. I believe this is because you selected to run a debug script but you didn't have any setup to run.  That's kinda going out of your way to find trouble ;-)\n. Sorry, it wasn't very clear.\n. Please don't close this unless it's a duplicate of a github issue - we still need to track and fix these.\n. But we don't use google code for errors now, anything still relevant needs to be on github.\n. Please hold off assigning more (different) graphic glitches to this ticket while we straighten out how we're handling this issue and what we're doing with the old google code issues.  A large number of these have already been reported elsewhere.\n. The @Glimmer-Man screen is closely related to #463 The top screen looks different to me so far.\n. Thanks @JamesWP.  Sadly we don't have any OSX developers at the moment so turnaround on this may be slow.\n. The wiki has a compile guide (https://github.com/CorsixTH/CorsixTH/wiki/How-To-Compile),  which should be your first step.  Quite a few of us spend time online at #corsix-th on Freenode (irc), you may be able to get some extra help there.\n. The two dumps both point to the same spot. :)\n. On closer inspection I believe this may be an SDL bug.  It looks very similar to this: https://github.com/etlegacy/etlegacy-libs/pull/2\n. Thanks @colinjmatt. Unless I'm misunderstanding, this is exactly what Options -> Music, and Options -> Music Volume does.\n. @honux could you update your ticket with the version this bug appears in.\n. Ok, thanks for the update @Glimmer-Man  just because we're so close to release I don't think this will make it for 0.40.\n. Trailing whitespace issue in the hungarian.lua:1889.  I'll fix it in my merge\n. Merged.\n. @JamesWP - could you look how/if dependencies are included in the package?\n. @JamesWP I really mean putting the .so libraries (I assume that's what they are) inside the app.  Maybe look at how it was packaged in the past.\n. The SDL2 requirement will be in the future (after the 0.40 release) not now.\n. Thanks for looking at this @admdly.  At worst we'll just not include the extra utilities in the OSX build for now.  Otherwise if it's possible to just use the binaries from the 0.30 release, I don't think there has been any changes to these tools this version.\n. @admdly Would you like me to put that OSX build on our releases page?\n. @admdly Thanks.  I know rc1 won't be the final release candidate, and I'll probably release rc2 very shortly due to some action queue patches from @phillipp. If you would like to wait for rc2 that's fine.\n. I'll use the dev mailing list. (https://groups.google.com/forum/#!forum/corsix-th-dev)\n. Yes... to maintain the status quo on the app.lua version I was just going to change it when I did the build and not commit (and post the diff in the mailing list so James can use it for the mac build too) - come up with a better solution for version.next.\n. Spelling was corrected.  Thanks @Lego3 \n. It would be helpful to have debugging symbols so we could have the exact line number.  That method is responsible for initializing lua and loading CorsixTH.lua and the Lua/ folder.  My first guess would be that it couldn't find lua folder.\n. In that case that's probably what it is.  The problem seems to be at lua_atpanic which should be merely assigning the given c++ function to lua to call in case of an error.  If the architecture was wrong that would definitely cause issues.\n. Excellent, thanks you @admdly \n. Fixed by merging #420\n. Whatever our last Release Candidate is, and Final, will be tags of the same version, but bumping the save version now makes sense.  Would you mind doing that, and adjusting getVersion accordingly?\n. Or I suppose this isn't merged yet, and I should do it :)\n. Done.\n. Works well for me and I think it's a good idea.  I don't know that we need to strictly switch to test driven development immediately but if people can start writing tests that would be great.\n. Pinging @phillipp as he did the fix for #127.  I haven't looked closely, but the workaround code should catch this I thought.\n. I've merged your extended workaround and further fix.  Want this solved in 0.40, so I guess there will be a second release candidate.\n. A couple questions:\nWhat version were you playing (0.30, 0.40-rc1, etc.)\nDoes this issue happen every time.  If not can you provide the save where it does happen (before it happens)?\n. Unfortunately github doesn't have file uploading on the issue tracker, so you have to put it on dropbox, mediafire or another similar service and provide a link.\n. @admdly If you're familiar with git rebase, would you mind merging all of these cmake changes into one commit?\n. I have seen this in OpenGL in much older versions of CorsixTH. I'm sure the issue was reported in google code.  The SDL2 branch should make this a non-issue in 0.50 and In the mean time I generally recommend not to run the OpenGL version in Windows.\n. That's the one I was thinking of.  @wolfy1339 describes it happening in OpenGL and then says it only applies to OpenGL and SDL, so I'm not sure whether he produced it in the SDL version necessarily or not, but it looks like my OpenGL issue.\n. In that case I think you'll find it's only the opengl version that's affected.  I'll close the google code issue because there's nothing relevant there that hasn't been said here.  I anticipate this being closed when the SDL2 branch is merged.\n. Actually I can't close it, I didn't have those permissions on google code.  @MarkL1961 would you mind to close it?\n. Yes, I use to produce this frequently in OpenGL and haven't seen it in SDL2 (OpenGL)\n. I second @admdly view that it should be external, which is probably obvious because that's how I handled msinttypes.\nIn my view, arguments for externalizing it:\n- Keep our repository free of code that isn't maintained by us (and doesn't match our standards)\n- Clearer distinction between our code and 3rd party dependencies is good for ensuring we keep on\n  top of the latest versions of the dependencies.  This can be seen in practice: we're building against the latest SDL, Lua, and Freetype revisions (within major versions), but we've been using very old versions of LPEG and LFS.\n- This is how we handle msinttypes \nArguments against:\n- It's harder to build the project when you have to go to a whole lot of web sites and download modules, particularly in these cases where the projects arn't shipped by any package manager.\n- There is no CMake built in rules for finding these little lua libraries so there is more up front work incorporating it into the build system.\n- With the libraries included in our code we have more control over exactly what versions people use which allows for less chance of people running into incompatibilities and not thinking to include that information in the bug reports.\n. They probably are, I've never used luarocks.\n. Closing in favour of removing.\n. Closing in favour of removing\n. Interesting.  I don't own a high dpi device which makes it difficult to test, but I don't think DPI scaling i relevant for true fullscreen mode which might be why the option is disabled but doesn't explain why the mouse isn't moving.  It isn't clear to me why DPI scaling would prevent the movement of the mouse (though just the fact that it's not native resolution could prevent the pen from working).\nDoes everything work in windowed mode?  Have you tried setting different screen resolutions?  And have you tried the SDL binary / does it behave any differently?\n. @ArcticRavine do you happen to know how to use git and compile software?  I'm curious if the SDL 2 branch (which will be CorsixTH 0.50) works any better.\nOtherwise I think we're stuck until we find a programmer who has worked with the Surface 2 or similar devices before... or someone buys me one for Christmas ;-)\n. @wolfy1339 First of all, can you reproduce this issue on it?\n. Cool @wolfy1339.  This won't be fixed for 0.40, but it would be interesting to know if it still happens in the SDL2 branch which will become 0.50.\n. Alright, will close this as soon as SDL2 is merged to master then.  Thanks.\n. @MarkL1961  It's finicky to get the mouse in precisely the right spot.  This change makes it easier to scroll because it captures how far the mouse moves each tick and repeats for scroll speed when the mouse leaves the window so you don't need to hover on the border.  I'm not yet 100% sold on the idea but I would be curious to try it out\n@xuancong84 Would you mind to submit the patch you described?\n. @xuancong84  I saw your recommended changes yes.  If you are going to be contributing more I strongly suggest you fork and submit pull requests.  I will do this one when I get some time if you haven't already by then.\nNothing except critical bug fixes are going in 0.40 at this point, but I have a feeling this or something like it will land in the next major version.\n. @admdly That pull request wasn't merged just because of the quality of the patch.  MarkL closed it because he had copied it from google code and no one owned the patch that could work on improving it.  The idea is probably still good.\n. Maybe it would be better to add something like middle click scrolling like web browsers have?\n. Closing this in favour of #723 which suggests locking the mouse in the window (like dosbox, dota2, and other window mode games.)\n. Thanks\n. Copying relevant lines from gamelog.txt:\nWarning: Trying to remove nonexistant room build callback (function: 0x059918c8) from humanoid (table: 0x07eb2078).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0734bc48) from humanoid (table: 0x07eb2078).\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\room.lua:269: Humanoid entering a room that they are already in\nstack traceback:\n    [C]: in function 'assert'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:269: in function 'onHumanoidEnter'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:356: in function 'on_next_tile_set'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1103: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function \nRecovering from error in timer handler...\n. @geordish Is there any more you can tell me about this issue.  Had you built and then moved or edited a psychiatry room before this happened or anything like that.\nHas this issue happened in any other games or to anyone else?\n. @J-Shep can you tell if this is related to your changes in any way?\n. @geordish I took a look at your save and I was wondering a few things.\na) Did you always have multiple screens in the room when the problem first happened?  I think that the bug might simply have been allowing for that.\nb) Do you have a save from before the problem first happened that can be used to reproduce the issue?\n. There should also be fairly frequent autosaves?\n. @Lego3 and I were talking on irc and he suggested that the problem may be happening for you so often because of how close your chairs are to the door.  Basically that when the patient uses the screen the dr. gets up and if they can leave the room before the patient finishes undressing then the error happens.\n@geordish you say you get this problem frequently, and I notice you always use more or less the same room layout.  Could you try putting the dr's chair further from the door and see if that fixes your problem.\n. For some reason the pull request didn't get linked to this issue... #435 \n. I've looked and this is a regression, caused by @phillipp 's pull request #365.  In light of that I'm in favour of fixing this specific case with @Lego3 's pr and doing a 3rd RC.  I'm not really in favour of continuing the Christmas release tradition so this will be a short (half-week) RC before the hopefully final release.\n. Looks good, should be merged once 0.40 goes out.\n. Not necessary as long as the merge is clean, but thanks.\n. Merged.\n. This is very similar to #433 then.  We'll need to take a closer look for all these race conditions in 0.50.\n. This case doesn't appear to be a regression, the code looks the same in 0.30.  Setting the milestone as 0.50.\n. the psych.lua one was a regression, it has been fixed in 0.40-rc3.  Thanks for the full list.\n. Why do you think a coroutine would help here? The issue is the timing of the callback, not that it's being interrupted.\n. An option would be to default the version strings to something like 'Trunk' and let the builder specify -DMACOSX_BUNDLE_SHORT_VERSION_STRING=0.40 when they make the official builds.  This is akin to what I do with the NSIS script on Windows.\nThere might be better options. I'm alright with one commit per version but I don't like the idea of a commit to set the version and a commit immediately after to unset it - so anything that doesn't involve two commits is fine with me.\nAlso couldn't the root CMakeList.txt specify the version to propagate to the others?\n. If it was the debugger.lua from http://wiki.eclipse.org/Lua_Development_Tools_Debugger then it's legal for us to distribute it with CorsixTH under the terms of the EPL. (Provided we include the license as well).\nWhether we want to is another question, the trend for us has been to reduce the amount of 3rd party software included in our repository - so carry on.\n. @J-Shep is there a reason you opted for a connect debugger menu entry over a connect debugger config option?  Just looking for a pro/con list.\n. For some reason the debugger picks the wrong location for my scripts which makes breakpoints and viewing code not work.  I can pause the debugger and see the code trace, but I get this stack:\ndispatch  [ e:/github/corsixth/build_sdl2/corsixth/corsixth/lua/app.lua:850 ]\napp.lua is actually in e:\\github\\corsixth\\corsixth\\lua\\app.lua so it seems to be appending the path from the root of the repository to my build location.\n. @J-Shep did you figure out a solution / do I need to enable both of those logs?\n. I noticed you added a Startup Args.txt for documenting command line arguments.\nTwo notes: first, there are already more command line arguments than -debugger.  I know for example that --config-file is supported; secondly I believe we were trying to follow the getopt long name standard as much as we can, so the flag should be --debugger, or I suppose more precisely --connect-lua-dbgp (as oppose to any other remote debuggers we might theoretically support)\n. Also I think README.txt might be a suitable place for those arguments instead of a new text file.\n. @J-Shep I reverted your changes to main.cpp back to:\nif(lua_gettop(L) == 2)\n            lua_pushnil(L);\n        else\n            lua_pushvalue(L, 1); //L,1 = exe path\nWhich fixed the path problem.  My guess is that passing the exe path in is doing more than you think.\n. As far as I've been able to tell, the purpose of --interpreter= is to specify an alternate lua script to launch instead of CorsixTH.lua.  (Maybe one that supported a different interpreter?)  I have doubts that anyone uses it, or anyone other than @corsix knows exactly what it's intended purpose is.\nWhat I meant above is that while I know more or less how lua_State works, I haven't followed closely enough to understand why many things are done the way they are in this function.  Like why there is a check for if(lua_gettop(L) == 2) that pushes a nil and skips adding the program path.\nMy interpretation (which needs more investigation for any degree of certainty) is that the program path lua_pushvalue(L, 1) is pushed to the top of the stack so that it would be included in the ... parameter of @main.cpp (l_main bootstrap) which specifies the root path to start looking for CorsixTH.lua from.  I would have thought that lua_pushstring(L, \"--connect-lua-dbgp\"); could be done outside of that if block, maybe in the same if block you execute the lua_call with two arguments.\nAnyway I think what I really need to do is write a small function that dumps the entire stack and print it at various points throughout that function while calling CorsixTH.exe with different arguments.\n. @J-Shep I've done some investigation on this now, and there's no reason to modify main.cpp.  All command line arguments are passed, which is how they could end up in App:setCommandLine(...).\nIn my CorsixTH.lua\nlocal code_dir = base_dir .. \"Lua\" .. pathsep\nfor _, arg in ipairs{...} do\n  local dir = arg:match\"^%-%-lua%-dir=(.*)$\"\n  local debug = arg:match\"^%-%-connect%-lua%-dbgp\"\n  if debug then\n    print 'happy'\n  else\n    print 'sad'\n  end\n  if dir then\n    code_dir = dir .. pathsep\n  end\nend\nThat should simplify things.\n. As you can see above, --lua-dir= is another supported command line parameter too.\n. Finally the readme.txt changes can be a separate commit.\ntask 1. Add lua debugger support via dbgp\ntask 2. Document command line options\n. Debugger is working great for me, no issue with either movies or music.\n. Very close to merging this, I'll just want to play with it a little more first.  In the mean time, have you looked at the Zerobrane Lua IDE (http://studio.zerobrane.com/).  It appears to support a somewhat similar remote debugging mechanism, as well as live code updating, and support for debugging any lua interpreter luasocket works with (lua 5.1/5.2/5.3, luajit 2.0+)\nMaybe just review to make sure it would be easy to add support for this as well later, on the surface it looks as simple as calling modebug.lua instead of debugger.lua.\n. Alright, I'm confident from another read over of the changes that it will be easy to add zerobrane support in the future if we want.\n. The first video you're referencing is HOSPITAL\\ANIMS\\ATTACT.SMK.  Would be pretty easy to play it after some idle period on the menu, or immediately I suppose - whatever people want.\nThe recommendation letter requires us to first finish another enhancement, currently we can't write text over the video - which is also why the newspaper headlines in the lose videos are not showing up.\n. For completion the letter video is HOSPITAL\\ANIMS\\WINLEVEL.SMK\n. What happens if the doctor that was called when the patient arrives is diverted (fired or moved to another room)?\n. In the original game to address this case you would set the staff option to keep doctors in their rooms and then you would manually replace the doctor periodically to prevent him from going insane.\n. Question: Do you mean to write a full IRC client in CorsixTH, use a third party IRC library, write a custom in game chat protocol, or something else?\n. @J-Shep you misunderstood me.  The trend is to avoid including 3rd party libraries in the code base is simply a trend towards making them build time dependencies instead, similar to msinttypes, ffmpeg, and so forth.  It merely relates to repository management, not a direction for coding.\n. Thanks @Glimmer-Man\n. Have you looked at the github api?  It would certainly be feasible to send the issue to github on the user's behalf.\n. Sounds good @J-Shep - definitely great work.\nI kinda don't think the user should be asked to choose how they want to report the error (email or github) we should make the choice for them based on what we know.  My feeling is that they shouldn't be expected to learn our processes just because their game crashed, and the choice might intimidate people into not filing at all.  I'm not sure if that's reasonable or not, so I'm just putting the idea out there, not making a requested change.\n. Just email reporting is fine. \n. It may be easier to implement the github API connection in the C++ code since luasec appears to be quite a problem. There are definitely mature portable libraries for C/C++ for sending https traffic. (libcurl for instance).\n. To be frank it wouldn't make a difference. My suggestion was to only implement the network interface to github in C++, then call that from lua with all the ticket information you wanted to submit.\n. There are no new features going in 0.60 at this time. This pr will be reviewed for 0.70.\nThanks for all the work J-Shep\n. From roujin.mw on December 08, 2009 05:54:01\nI see two problems here:\n- staff is supposed to lose their \"tired\" mood as soon as they enter a staff room.\n  This does happen if they go in normally, but doesn't if they're dropped in.\n- nevertheless, the cause of the mood icon appearing over the wrong spot must be\n  fixed, since it also causes other bugs: the little window in the staff dialog is also\n  centered on the wrong spot.\nI'm working on it.\nStatus: Started\n. From roujin.mw on December 08, 2009 05:54:17\nOwner: wolf...@in.tum.de\n. From cor...@gmail.com on December 25, 2009 03:37:48\nIssue 97 has been merged into this issue.\n. From cor...@gmail.com on December 25, 2009 03:51:55\nHave you made any progress with this Roujin?\nI expect that the solution to this will have to be constructing a database of \"person\nmarkers\" for each animation, perhaps looking something like:\nlocal ABD = TheAnimationDatabase -- Alias some global called TheAnimationDatabase\nABD:setMarker(56, \"linear\", {0, 0}, {-1, 0}) -- On animation 56, the person marker\nmoves from tile (0, 0) to tile (-1, 0) over the course of the animation.\nABD:setMarker(72, {-1, 0}) -- On animation 72, the person is always on tile (-1, 0)\nABD:setMarker(182, \"frame-by-frame\", {x0, y0}, {x1, y1}, {x2, y2}, ...) -- On\nanimation 182, the marker should be offset from the default position by {x0, y0}\npixels on the frame 0, {x1, y1} pixels on frame 1, etc.\nABD:setMarker(463, \"linear\", {0, 1}, {0, 0}) -- On animation 463, the primary user\nmoves from (0, 1) to (0, 0)\nABD:setSeconaryMarker(463, {-1, 1}) -- On animation 463, the secondary user remains\non tile (-1, 1)\nThere is also the issue of ensuring that the mood is always drawn on top of the\nentity, but that should be trivial.\n. From roujin.mw on December 25, 2009 08:47:44\nHum, I did not think of such an elaborate solution as you're describing. I only\nthought of fixing the mood icon (and viewport) being on the wrong tile, not the fact\nthat it's statically on that tile (instead of moving with the humanoid as he's\nsitting down / standing up).\nActually at some point I stopped working on this. I now picked it up and brought it\nto a (half) working state. I'm attaching it here as a patch so you can see what I was\nthinking of. No guarantee of being bug-free though; plus the patch is against a\nrather old revision ( r164 )..\nBasically, I just planned to add a \"mood (and viewport) offset\" property to object\norienation definitions. This would then be used to place the mood icon and the\nviewport in the right spot.\nIf you want to do something more elaborate like you described, feel free to use (or\nnot use, as you see fit) my patch as a base. Seeing that you've put much more thought\nin this than I have, I'll better leave this to you.\n. From roujin.mw on December 25, 2009 08:48:26\n..forgot to attach patch.\nAttachment: moodicon_wip2.diff\n. From cor...@gmail.com on December 26, 2009 04:44:59\nI'm going down the elaborate route, with r262 being the first step.\nOwner: corsix\n. From edvin.li...@gmail.com on January 13, 2010 06:35:56\nIs the new way of doing it going to stay roughly the way it is? Because then I will\ncontinue to use it just as I did with toilets.\n. From cor...@gmail.com on January 16, 2010 05:24:07\nI think the current way of doing it will remain roughly the same, though see r360 for\na slight change in how to set multiple markers.\n. From edvin.li...@gmail.com on January 29, 2010 14:30:53\nThe original issue was fixed in revision 370 , but since almost all other objects need\nthese adjustments too I'll let the issue be open.\n. From mark.l1...@hotmail.co.uk on April 08, 2012 13:01:17\nIssue 1207 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on April 08, 2012 13:02:36\nSummary: Mood icons appear above the wrong place when using objects\n. From edvin.li...@gmail.com on January 31, 2013 13:33:00\nIssue 1202 has been merged into this issue.\n. From edvin.li...@gmail.com on February 01, 2013 14:00:47\nIssue 1266 has been merged into this issue.\n. From maartenp...@hotmail.nl on April 01, 2013 07:53:22\nSorry Corsix, I've done this because you're not very active anymore in the project.\nOwner: edvin.li...@gmail.com\n. From cor...@corsix.org on April 01, 2013 10:58:58\nFine by me :)\n. From mark.l1...@hotmail.co.uk on November 08, 2013 12:32:37\nI did notice in TH that the emergency icon disappears as soon as the patient gets close to the inflator (which was in issue #1202 ).\nCould this be an option for us, i.e. remove some of these icons when an object is being used?\n. From cor...@gmail.com on December 15, 2009 04:37:02\nMy immediate thought is that this change would give a dual meaning to being at the front of the queue:\n- Waiting to enter the room\n- In the process of entering the room\n  That being said, you are correct - we do need to keep track of patients in the process of entering.\n. From roujin.mw on December 15, 2009 12:20:52\nWould that be a problem? I personally find it weird that patients are removed from\nthe queue dialog as soon as they stand up from their bench to enter the room, and not\nonly in the instant they actually do enter the room.\nAnyway, the alternative would be adding them to the \"expected\" list again during this\ntime span. But we should be careful that the transistions between the different\nphases are seamless - don't remove them from the expected list at the start of the\ndoor animation, if they are considered as \"in the room\" only at the end of the door\nanimation, etc.\n. From edvin.li...@gmail.com on May 26, 2010 06:45:51\nThe isIdle function now checks if there is a patient scheduled to use the door so\nthat staff never leave prematurely. Now it might be the other way around instead...\n. From niels.de...@gmail.com on August 18, 2010 06:26:35\nIsnt it an idea to make a first box in the queue that is of a different color that means current patient.\nAnd the next one is entered until the first leaves the door\n. From mark.l1...@hotmail.co.uk on August 18, 2013 10:39:52\nOwner: ---\nLabels: -Type-Enhancement Type-Suggestion\n. From maartenp...@hotmail.nl on April 17, 2013 11:20:01\nDoes this problem still occur after almost three years?\nStatus: Input\n. From edvin.li...@gmail.com on April 21, 2013 06:11:19\nProbably it does. No objects use this functionality since it is bugged, but if we could use a few rendering glitches could be fixed.\nStatus: Accepted\n. From maartenp...@hotmail.nl on April 21, 2013 06:46:32\nAnd does anbody know how to resolve it so we can resolve a few glitches?\n. From e.sara...@gmail.com on June 28, 2010 16:17:46\nI'd say this is rather important since it kills the game after the first level which is roughly 20 minutes of gameplay.\n. From cor...@gmail.com on June 28, 2010 16:28:55\nI cannot trivially reproduce this - do you have a savegame?\n. From cor...@gmail.com on June 28, 2010 16:56:02\nThis looks like just a graphical issue. If the progress dialog is opened while a criterion is in the red, then the \"red\" attribute is set. This attribute is then consulted when the dialog is drawn. The immediate problem is then that the \"red\" attribute is never unset, meaning that a red bar is always drawn, regardless of how close the criterion is to completion.\n. From cor...@gmail.com on June 29, 2010 02:19:17\nr918 should fix your problem, though I'd prefer a more thorough refactoring of that dialog.\nStatus: Accepted\n. From edvin.li...@gmail.com on October 09, 2010 08:57:55\nI'll change the summary of this issue to reflect what is left to do.\nSummary: Refactor the progress dialog lua file\n. From cgja...@gmail.com on March 26, 2011 18:55:02\nIssue 584 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on August 25, 2013 10:48:11\nThere are other issues related to this that could be fixed at the same as this one maybe: issue #1132 Differentiate strings depending on if win or lose conditions are currently showing issue #1147 Status screen does not warn of too many deaths issue #1358 Goals window missing a $ sign in the tooltips for bank balance issue #1695 Win conditions are not necessarily reflected in the progress report strings\n. From mark.l1...@hotmail.co.uk on March 22, 2014 12:20:35\nIssue 1695 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on March 22, 2014 12:28:11\nIssue 1132 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on March 22, 2014 12:30:32\nIssue 1358 has been merged into this issue.\n. From cor...@gmail.com on July 01, 2010 06:49:29\nFor issues like these, one important piece of information is which renderer you're using: SDL, OpenGL, or DirectX?\n. From chris_lo...@hotmail.com on July 01, 2010 07:06:46\nYea, sorry - was in the middle of adding a comment with that info when the phone rang!!\nThis is using DirectX but I can try the other renderers if required.\n. From tobyflat...@gmail.com on September 17, 2011 15:20:04\nI also get this problem when toggling off fullscreen using 1920x1200.\nThe only way to continue from the black screen is by hitting ctrl + alt + del and bringing up the task manager. Once I have done that, the black screen is gone and the 1920x1200 window is there.\n. From maartenp...@hotmail.nl on October 15, 2012 03:32:23\nI have this problem too when taggling off fullscreen in DirectX-mode (only) when I'm using 1280x1024 (standard by installation of CorsixTH.)\n. From maartenp...@hotmail.nl on October 15, 2012 09:02:04\nBut sometimes the task managar doesn't resolve the problem: when you open CorsixTH again (which was minimized) it's still a black screen with just a mouse cursor on it.\n. From mark.l1...@hotmail.co.uk on October 15, 2012 11:54:51\nIssue 1336 has been merged into this issue.\n. From ji...@linservers.com on January 20, 2013 07:02:40\nI'm having the same problem using Mountain Lion. Whereas for me I need to force shutdown my mac and restart it to get back into OSX.\n. From maartenp...@hotmail.nl on January 20, 2013 07:11:03\nAnd changing the resolution of your computer or corsixTH doesn't resolve you're problem?\n. From roujin.mw on January 21, 2013 05:08:54\nLabels: Renderer-DirectX\n. From baker.st...@gmail.com on March 20, 2013 06:20:04\nThe game also goes black if you switch between windowed and fullscreen modes in DirectX.\n. From maartenp...@hotmail.nl on March 23, 2013 11:05:38\n@10 I have this bug too.\n. From mark.l1...@hotmail.co.uk on May 27, 2013 01:17:49\nIssue 1630 has been merged into this issue.\n. From Brad.gor...@gmail.com on May 27, 2013 01:22:59\nAlt + enter on a mac, does not change full screen ;l\n. From mark.l1...@hotmail.co.uk on May 27, 2013 11:42:54\n@ 13  Can you locate your config.txt?  In there you can also change it back to windowed\n. From mark.l1...@hotmail.co.uk on May 27, 2013 11:46:55\ntonight changed from full screen back to a window and got the usual black screen.  Used Ctrl+Alt+Del to bring up task manager and get the game window back.  The following text was in the console window\n\nWelcome to CorsixTH Trunk!\n\nThis window will display useful information if an error occurs.\n\nProblem creating overlay: Out of memory\nProblem creating overlay: Out of memory\nProblem creating overlay: Out of memory\nProblem creating overlay: Out of memory\nI have 8gb of memory and had only just started the game, so I can't see why that should happen.  (This was with DX)\n. From Grim...@gmail.com on December 10, 2014 14:45:20\nJust tested this (with DirectX) and it is still valid.\nAt first it worked fine, but the second time I changed from full screen to windowed, I got the mentioned \"black screen\".\nI used 1366x768.\nSummary: Changing to High Resolution Leaves Blank Screen (in DirectX)   (was: Changing to High Resolution Leaves Blank Screen) \nStatus: Accepted\n. I also get the \"THMovie overlay should be deallocated before being allocated!\", ever since an earlier change @jorgenpt made to fix changing resolution / full screen.  Forgot about it.\n. I think so, probably specific to the old directx renderer and not the sdl2 directx path.\n. From mark.l1...@hotmail.co.uk on July 11, 2010 09:03:22\nthe attached screen is to show what happens when you remove the room before buying the new plot\nAttachment: screen.bmp\n. From mark.l1...@hotmail.co.uk on August 21, 2010 10:49:03\nthis is a picture or two from the original to show that you can block off areas near non-purchased plots.\nThere is also one to show a none emergency alien waiting outside the GP room.\nAttachment: ScreenHunter_04 Aug. 21 18.27.gif ScreenHunter_02 Aug. 21 18.26.gif ScreenHunter_01 Aug. 20 21.20.gif\n. From mark.l1...@hotmail.co.uk on November 07, 2010 04:20:04\nanother example of the screened wall going when you build next to it\nAttachment: screen.PNG\n. From mark.l1...@hotmail.co.uk on November 07, 2010 05:58:11\nif you later extend the hospital the wall of the room then disappears\nAttachment: screen.PNG\n. From roujin.mw on November 07, 2010 07:41:37\nGreat find, I would never have thought of trying something like this :D\nAs a solution for this problem, I suggest just making the tiles next to a \"barrier\" wall unbuildable (walk_only). When removing the barriers, make the tiles buildable again, if there's no other object that makes that tile unbuildable (same routine as when an object is removed).\nThis would solve both problems at the same time: There can't be any room walls that would accidentally disappear on buying a plot, and since there are unbuildable (but walkable!) tiles in front of the barrier, the reachability checking already in place will prevent blocking-off.\nStatus: Accepted\n. From roujin.mw on November 21, 2010 12:09:08\nIssue 543 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on December 04, 2010 13:01:30\nIf you create your own map, any wall with a window will also disappear when you build a room.\nThis was with beta4\nAttachment: screen.PNG\n. From SyntheticDolphin@gmail.com on June 29, 2011 02:04:40\nStill true, also if you put a receptionist the other side of the room, they will attempt to walk through, or meander and walk back through the invisible wall which freezes the game.\nAttachment: Screen 2011-06-29 at Wednesday, June 29, 10.02.37 AM.png\n. From Grim...@gmail.com on July 26, 2011 14:06:41\nThis is related: \nOn some levels the room walls replace the outer walls. So if you delete the room, there will be no outer wall.\nI have noticed this on at least level 8 and 9 (see images).\nLoad the attached save game.\nTry to remove the two teaching rooms.\nThe outer wall is being removed too!\nAttachment: wallsaregone.png wallsaregone2.png wallsaregone.sav\n. From t.marinu...@gmail.com on August 29, 2011 14:57:32\n@9: Do you know a way to reproduce the original issue (ie the outer walls being replaced by the room walls)?\nYour savegame is in an invalid state, but how do you reach it?\n. From mark.l1...@hotmail.co.uk on September 25, 2011 11:40:51\n@ comment 10.\nuse the attached save, then build next to the curtain wall.\nAttachment: wall.sav\n. From Grim...@gmail.com on February 12, 2012 14:05:52\nIssue 1144 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on March 12, 2012 12:22:02\nIssue 907 has been merged into this issue.\n. From Grim...@gmail.com on March 20, 2012 15:12:40\nHappened in newest version (0.01).\nWas in \"see through wall\" mode, and this happened when placing a room. The wall is also gone if you move or delete the room.\nAttachment: inviswall.png\n. From edvin.li...@gmail.com on March 21, 2012 03:42:39\nWhat is the error in that last picture?\n. From edvin.li...@gmail.com on March 21, 2012 03:47:12\nI am unable to do what you describe in Comment 14. Your outer wall windows are not the same either, did you have another room there before this one?\n. From mark.l1...@hotmail.co.uk on March 21, 2012 04:32:17\n@17\nI would say it is that the internal walls are at the back of the room, when they should be the external walls.  So deleting the room will leave a gap in the external wall.\n. From mark.l1...@hotmail.co.uk on March 21, 2012 07:19:34\nHere is a possible solution.\nMake see through walls only if you hold down the x key, othewise they are not see through.  It would be harder to build a room whilst the walls are see through if you had to hold down the x key at the same time.  At the end of the day, you only need to have see through walls whilst you are looking for something.  You don't really need to have transparent walls all the time.\nPerhaps also make it that you can't build or edit a room if the x key was depressed\n. From edvin.li...@gmail.com on March 21, 2012 08:22:46\nDoes that mean that you can replicate this Mark? I can't... I see the error in the slack tongue clinic in comment 14, but there should be another error in the picture in comment 16?\n. From mark.l1...@hotmail.co.uk on March 21, 2012 08:29:43\nI could at one time, but it is not something I have checked recently.\nWhen I get home, I will see if I can replicate this with the latest version\nAs for the pic in comment 16, it is as I said in 20.  the exterior walls are not there, so if you remove that room (slack tongue clinic) there would be a gap.  Inflation looks okay to me, the outside window would go if you overlap the walls, that is expected. Perhaps the second picture is to show you what it should look like...\n. From Grim...@gmail.com on March 21, 2012 10:05:54\nI'm sorry about #16. I see now that nothing is wrong with that picture.\nDeleted it, but #15 is clearly still an issue (external walls are switched with internal ones (and the room can be deleted, making a hole in the wall)).\n. From Grim...@gmail.com on March 21, 2012 10:06:52\n@18: I did not have any room there before.\n. From mark.l1...@hotmail.co.uk on March 21, 2012 12:07:31\nI have tried this with r1543 and 0.01 and can't replicate it either.\nYou say level 5, was it the first plot or another one?  (maybe its specific to a plot)\nThe original issue with curton walls still exists and does not need you to have transparent walls turned on either.\n. From mark.l1...@hotmail.co.uk on March 21, 2012 12:10:05\nI think I have sussed it, turn on transparent walls then buy a plot and they build the room, the wall then disappears\nCc: edvin.li...@gmail.com\n. From Grim...@gmail.com on March 21, 2012 12:12:09\nDoes this happen for all new plots?\nIt was btw this plot on lvl 5:\nAttachment: plot.png\n. From mark.l1...@hotmail.co.uk on March 21, 2012 12:23:25\nI think it is same to assume yes, all but the first one.\nAny level, turn on transparent walls, then buy any plot and then build a room (transparent walls are still on, but not for the new plot).  Walls will disappear, well the external ones anyway in the new plot.\n. From maartenp...@hotmail.nl on March 30, 2012 11:21:26\nI have this problem to.\nSee the attached file!\nYou have to delete the room and build a new one to resolve this after you buy a new piece of land.\nAttachment: CorsixTH No wall-bug.png\n. From maartenp...@hotmail.nl on October 13, 2012 08:49:03\nI won't be rude, but will somebody fix this issue?\nThis issue excists for more as two years!\n. From mark.l1...@hotmail.co.uk on November 09, 2012 11:26:43\nI've put this here as it is similar!\nbuilt Op theatre and the wall to the plot grew out into the lawn.\nthis is testing 0.11, I have seen it happen other times on various levels too with previous verions\nAttachment: 3.png\n. From edvin.li...@gmail.com on November 09, 2012 11:59:31\nSo it grew out there when you finished the Op?\n. From mark.l1...@hotmail.co.uk on November 09, 2012 12:08:07\nYes LOL\n. From mark.l1...@hotmail.co.uk on November 10, 2012 11:38:21\nIssue 1320 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on January 22, 2013 07:44:37\nwith regards to comment 7\nIt is not all windows that do this, it is the one that is a whole window (and the top bricks seem to be higher than the others) that will disappear when you build next to it.  The windows that are half a window or whole when you place two next to each other does not seem to have this problem of the wall disappearing.\n. From mark.l1...@hotmail.co.uk on February 08, 2013 11:11:02\nIssue 1498 has been merged into this issue.\n. From maartenp...@hotmail.nl on April 01, 2013 07:08:53\nLabels: Milestone-0.40\n. From mark.l1...@hotmail.co.uk on April 03, 2013 12:42:20\n@ Maarten\nIs setting this as milestone 0.40 a typo?\nCc: -edvin.li...@gmail.com maartenp...@hotmail.nl\n. From maartenp...@hotmail.nl on April 03, 2013 12:54:04\nNo, I thought that this would be maybe something to fix in version 0.40 (then we have enough time for it), but you can change this if you want. This is also a almost three year old issue.\nSummary: Disappearing wall when buying a new plot of land   (was: disappearing wall when buying a new plot of land) \n. From mark.l1...@hotmail.co.uk on April 03, 2013 13:13:46\nThat's fine.  \nThe issue in comment 7 & 36 is down to a particular wall tile with a whole window.\nI have done a patch recently for the map editor that would remove that tile.\nThat would then hopefully fix a small part of this issue.\n. From mark.l1...@hotmail.co.uk on May 22, 2013 12:41:15\n@32\nBy chance I think I have found out why the wall grows into the lawn like it does.\nIf you look closely, there is half a window hidden in the corner, I think that when you build a room, the wall is being replaced by one without the window, I suppose the game thinks it should be a whole window and replaces both halves.\nI found this when I created a map that had a half window close to the corner and it did the same thing when I built the room.\nCc: -maartenp...@hotmail.nl  \nAttachment: 3.png\n. Confirmed that this bug still affects 0.40 from #681 \n. As seen in #1011 this can lead to crashes. Also confirmed in 0.50.\n. It was closed automatically by merging the pull request because it had fix #451 in the message.\n. #1018 was merged.\n. From Florent....@mac.com on August 24, 2010 00:32:02\nI noticed this issue only on a MacBook black 2Ghz, the sound works great on a MacBook Pro Alu 2.8.\n. From SyntheticDolphin@gmail.com on August 24, 2010 00:58:46\nIt may be your SDL or SDL_mixer are faulty, if you follow the latest/svn build instructions these will be updated, plus it will check the fault hasn't been fixed since beta 3.\n. From Florent....@mac.com on August 25, 2010 03:08:43\nThanks. Now, I'm using the r958 and this is the same problem, but always on the MacBook and not the MacBook Pro...\n. From vegar...@gmail.com on December 25, 2010 09:56:37\nUsing CorsixTH Beta 5 i still have the same issue on a MacBook Pro running latest version of OSX.\n. From pinch...@gmail.com on March 05, 2011 05:46:27\nSame issue here, using beta 5 on a 2008 unibody macbook pro.\n. From mwilhelm...@gmail.com on March 13, 2011 14:06:32\nI have a similar problem, beta 5 on 2008 MB Pro, the game runs for a while until the sound disappears without apparent cause.\nHowever, there is no continuous beep, it sounds rather like the volume setting is increased on the software side to absurd values (a crunching/clicking sound for a short time (like \"blowing the speakers\"), then silence). \nThis volume setting is active even for the OS level, and cannot be lowered again (changing the volume results in more clicking sounds, and it clicks even on the lowest setting) until the system is rebooted. The complete sound of the system is stopped, iTunes etc. stay mute afterwards.\nInterestingly, it occasionally helps to save the game to restore the sound for the rest of the OS (such as iTunes runs in background again), but the ingame sound remains dead.\n. From henry%vi...@gtempaccount.com on June 24, 2011 04:43:16\nSame issue - Loud beeping noise, sounds like the speakers are going to break. Sometimes it sounds gritty, other times it's just a short loud beep.\nMBP 2010. Running Beta 6.\n. From t.rebo...@gmail.com on July 06, 2011 16:02:53\nSame issue, beta 7, 10.6.8, macbook unibody late 2008.\n. From fx.ml.gp...@googlemail.com on October 06, 2011 06:41:12\nSame Problem here. Beta 8, 10.7.1, macbook pro late 2006. Loud beep (doesn't matter how loud the sound is actually set) for about a second. sound then returns back to normal. was really creepy the first time it happened.\n. From talk...@gmail.com on January 12, 2012 14:39:59\nSame problem here, Beta 8, OS X 10.7.1, MacBookPro3,1.\n. From l...@lokedupont.info on February 09, 2012 04:46:19\nI have the same issues with my two Macbook Pros. Both is running an updated Lion (10.7.2) and have SDL and SDL_mixer installed from homebrew. It does indeed sound like the speakers breaking or something, and scared me the first time :)\n. From edvin.li...@gmail.com on February 09, 2012 06:40:30\nHmm, we would need a developer using Mac regularly to try to find the cause of this.\nStatus: Accepted\nLabels: OpSys-OSX\n. From Grim...@gmail.com on February 10, 2012 17:46:06\nIssue 914 has been merged into this issue.\n. From knutga...@gmail.com on July 27, 2012 16:07:09\nProblem is still present on latest (0.01b) release on OSX Lion: I only have music for about 20 mins (the time it takes to play trough the entire playlist / jukebox), no sound effects. When the music stops I hear the \"cracking\" sound described above.\n. From darrenlo...@me.com on August 04, 2012 23:46:41\nThis issue maybe related to the error I been having on both my iMac and MacBook Air, after about 20 minutes the music stops, if you goto the jukebox section under Options you can see that each track is being played for a split second on a infinite loop causing a slight disturbance to all other sounds in the game.\nBoth Macs running Mountain Lion.\n. From loe...@gmail.com on August 25, 2012 15:00:31\nSame here, really very laut beep after playing awhile.  System: iMac C2D 2GHz 20\", Mountain Lion, CorsixTH 0.01.\n. From maartenp...@hotmail.nl on July 04, 2013 11:46:38\nDoes this problem still occur after almost a year with version 0.21? And when the answer is yes, could somebody (who has this problem) post his gamelog.txt?\nStatus: Input\n. From remi.lan...@gmail.com on February 25, 2011 12:45:53\nI was a bit annoyed by this issue so I decided to give it a try. Thanks to all the documentation and the clear code, it wasn't so hard.\nNow the research option is always enabled when the message is created. When the fax is displayed, it looks for a room of type \"research\", and disable the choice if no room was found. Patch is attached. I'm very new to LUA so I hope the code is OK. :-)\nI didn't take care of opened fax because I didn't know how to \"refresh\" the fax. Also I tried to look for a callback function when a room is deleted (the opposite of roomFinished), and I didn't find one...\nAttachment: issue_480.patch\n. From edvin.li...@gmail.com on March 22, 2011 13:52:23\nIt is a promising start. :-) Let's try to go the whole way. \nLine 158 in edit_room removes the room from the world. I suggest that you add a new function in world.lua similar to \"newRoom\" that is called instead of just setting the value in the list to nil. There it can remove the room from the list and also do whatever is needed, like \"if the room is a research department: check if there are more such rooms. If not find any open fax (ui.GetWindow(UIFax)) and tell it to update its buttons (a new function).\nThen you will also need to store the buttonpanel in the fax so that the button can be changed. A good practice session in Lua. :-)\nExamples of references: StaffManagement changes when a staff member is sacked. Buttons in the bank manager are hidden/shown.\nStatus: Started\nOwner: ---\n. From Grim...@gmail.com on January 14, 2013 14:38:37\nIt seems like this coder didn't take your suggestions into a new patch..\nIs this fixed by other patches, or should someone take a look at it?\nI can't test it myself right now.\n. From roujin.mw on January 14, 2013 22:54:30\nNo, it was not fixed since then. I am looking into it.\nOwner: roujin.mw\n. From roujin.mw on January 15, 2013 07:27:03\nI'm not fully there yet, but r1851 fixes something related I stumbled over when working on this.\nI'm currently debating what to do in scenarios where not only a button would become available (research built) or unavailable (research destroyed), but the text should be different, i.e. the room is researched (the fax should then not say \"We can not currently treat this\" but \"You have to build room X\" in the middle part).\nCurrently I am leaning towards deleting the fax and creating a new one in that situation, since it is not logical for a fax to suddenly change its wording (in a real-world sense). What do you think?\n. From Grim...@gmail.com on January 15, 2013 10:19:33\nHm. Your suggestion makes sense to me, but maybe edvin should have a word in this.\n. From roujin.mw on January 16, 2013 12:05:36\nThis issue was closed by revision r1863 .\nStatus: Fixed\n. From mark.l1...@hotmail.co.uk on August 20, 2013 12:43:57\nThis issue still exists.\nBuild the research room and forget to hire a researcher (maybe there isn't one!)\nFax arrives and the option to send to research is greyed out, so you close the fax with the x and hire a researcher as one is now available.\nExpected the fax to update and now give you the option of sending to research, but it is still greyed out.  Perhaps the above fix was only where the room was not built.\nSummary: Hire a researcher should update existing faxes with autopsy option   (was: Building Research room should update existing faxes with autopsy option) \nStatus: Queued\nOwner: ---\n. From mark.l1...@hotmail.co.uk on December 06, 2012 07:34:16\nDoes this still happen?\nI tried to replicate and the only thing I noticed was that when you grass over again where the walls were the outline of the H is left behind.  \nIs that the buildable flag?\nAttachment: 1.bmp\n. The new and old map editor share a certain amount of code, so it's possible this may transfer over.\n. From roujin.mw on November 07, 2010 14:09:51\nOwner: ---\n. From mark.l1...@hotmail.co.uk on October 05, 2013 12:46:36\nThe attached patch will make all the stone flags tiles transparent when you toggle wall transparency\nOwner: mark.l1...@hotmail.co.uk\nLabels: -Type-Defect Type-Patch  \nAttachment: map_editor.lua.patch\n. From mark.l1...@hotmail.co.uk on October 06, 2013 01:23:01\nThis patch will only work on newly created maps and does not affect any existing maps\nOwner: ---\n. From mark.l1...@hotmail.co.uk on November 12, 2010 13:12:11\nBloaty head and Slack tongue do this in the original too, as there is no animation for it.  You may not have noticed this, as with bloaty head the machine is usually available from the start of the game, so there is no need to send him to research.\n. From stephen....@gmail.com on December 28, 2010 14:00:20\nThis is curious, as Mark is right in that this situation should never occur. Upon testing I've found the following things:\n- Patients lose their shoes for part of the autopsy animation\n- The autopsy machine display glitches slightly with the patient as they walk past it\n  And most importantly:\n- You can only send patients to autopsy after you've diagnosed them, not when you don't have any idea.\nThis seems backwards, you should be autopsying people that you can't cure, not the ones which you can but haven't built the treatment room for - but this would mean a very common dialog in the game is being displayed incorrectly, which is a scary thought!\nThe fix here is not to draw bloaty head animations, but to make sure this situation can never occur:\n- Research should not be available in level 2\n- When it is, bloaty head is probably meant to be instant-diagnosis\n- Only patients with an unknown illness should be able to go to the autopsy\n- Maybe an ultra-fallback to stop certain illnesses going to autopsy, to cater for custom levels.\nStatus: Accepted\nLabels: Component-Logic\n. From roujin.mw on December 28, 2010 15:08:09\nWhat do you mean with \"a very common dialog in the game is being displayed incorrectly\"?\nI think you're confusing two things here, diagnosing a patient, and researching a treatment for a certain disease.\nAutopsy has nothing to do with diagnosis, but with research.\nIf a patient is not (completely) diagnosed, you cannot send him into autopsy. This is logical because you don't even know what he has, so dissecting him won't help you for your treatment research, because you wouldn't know which disease to relate the insights you gain from him to.\nThat's how it currently works (implemented by edvin, iirc) and I think it's the correct way. Is it not?\nOther than that, I don't think we should restrict the game too much to what the original game data provides. Sure, there may not be animations for the bloaty head patient entering the autopsy machine. But that imo does not mean we should e.g. disallow making it researchable in custom games. Or autopsy-able.\nIn fact I recently made some changes so that in custom levels the author can make even, say, the pharmacy researchable. Which btw reminds me I should check if there are any issues with that and autopsy.\nLast but not least, while I support your enthusiasm, this issue is still about the graphical glitch(es) with the autopsy machine and should thus be marked as such, not \"misused\" as an issue related to issues with the game logic you found (which as I wrote are imo non-issues).\nLabels: -Component-Logic Component-UI\n. From stephen....@gmail.com on December 29, 2010 01:22:39\nSorry Roujin, the more I think about it, the more I agree that that is how the fax is meant to show up. It's strange because the fax itself is just asking to build a treatment room, so an autopsy wouldn't be necessary, but that's Bullfrog's twisted logic for you. \nI'd say in real life autospys are used when there isn't a diagnosis, as you can get a better look, but I do watch too much House.\nI'm still confused how this wasn't a problem in the original TH though, what did they do differently?\n. From edvin.li...@gmail.com on December 29, 2010 01:32:05\nI can't test the original right now, but I suspect there is something wrong here, the alternatives are probably not the same in the original at that stage. Anyone who can check it out?\n. From mark.l1...@hotmail.co.uk on December 29, 2010 02:50:12\nWhat do you want to test for here, is it the faxes?\nIn the original his head disappears when he enters the autopsy machine, as does the head of the slack female.\nI never noticed this when playing the game for the last 10 or 12 years, I never noticed a lot of other things either.\nLets see;\nhandyman only hits the blood machine once with his hammer to fix it.\nhandyman jumps off the xray when he fixes that.\nnurse jumps towards the machine when she has a female with broken bones.\nThese are a couple that spring to mind, I bet there are others, its that you don't notice unless you are really studying the game or until someone points it out.\nNow with bloaty head, how many times did you send him to autopsy in TH, probably never as the inflator is always available from the start.\n. From edvin.li...@gmail.com on December 29, 2010 09:40:08\nExactly, so why do I do it in CorsixTH? There's still no use in sending people to the autopsy when the room is already available, so either the original showed something else, or we would want to change it.\n. From mark.l1...@hotmail.co.uk on December 29, 2010 12:51:42\nThe original does give you the option to send him, I don't know why though, perhaps for the extra cash LOL.\nI have attached the screen from TH for the sceptics.\nI think that unless you can get someone to do the missing animations that you leave it as is.  The same applies to other missing animations, including females with broken bones, which I believe at the moment is not in corsixth. Afterall, if we never noticed when playing the original, why make a fuss now.\nIf you do get someone that can do animations then great it will improve the game, otherwise why spoil it by taking out things because there is something wrong or missing?\nI suspect that in their rush to get the game out that Bullfrog cut a few corners, lets face it there are bigger bugs in all games you buy these days, especially any from EA!\nI have also attached another screen from TH, in my rush to get the first screen I did not place a staffroom and this was the result.\nAttachment: bloaty.PNG crazyDr.PNG\n. From stephen....@gmail.com on December 29, 2010 13:16:00\nAh yes, looks like I was completely wrong, the bloaty head bug exists in TH as well!\nFax for not diagnosed:\n- Send patient home\n- Guess at a cure (only if diagnosed but below diagnosis limit (not sure when this happens))\n- Get the patient to wait in the hospital for a while\nFax for missing room:\n- Send patient home\n- Get the patient to wait in the hospital for a while\n- Send patient to the research department\nAttachment: bloaty2.png\n. From edvin.li...@gmail.com on December 29, 2010 13:21:42\nInteresting with crazy doctor! Does anyone else think it might be worth showing \"go to research...\" only when the treatment room is not yet researched? We will soon need to start making a list of changes compared to TH. :-)\n. From roujin.mw on December 29, 2010 13:32:33\nOh yes, that one thing I noticed but forgot to mention it.. please grey out the \"go to research\" if the treatment room is already researched.\n. From maartenp...@hotmail.nl on February 05, 2013 10:53:23\nI added this issue to issue #1494 (this is a list of all knows graphical glitches.)\n. From maartenp...@hotmail.nl on July 04, 2013 11:47:34\nLabels: -Priority-Medium Priority-Low\n. From mark.l1...@hotmail.co.uk on August 22, 2013 12:18:47\nIt is no longer possible to send someone with Bloaty Head to research in the campaign as the button is now greyed out (room is known from the start).\nThis issue now only affects custom maps.\nCould we change the animation at the crucial moment to a normal looking male for Bloaty Head and the same for males and females with slack tongues; as we do now with the slack female at the time of death?\n. From maartenp...@hotmail.nl on August 22, 2013 12:48:48\nI agree with what Mark sais.\n. From mark.l1...@hotmail.co.uk on February 06, 2012 12:34:34\nI think that this issue should be re-named to something like plots are not buildable if there are too many doors\nI was able to get this map working though:  the top most plot to the back with only one door, remove the door and re-build it and all plots became buildable!\nMaybe it is not the number of doors, but the order in which they are placed?\nPerhaps there should be some instuctions in the wiki on how to build a map, test it out etc.\n. From maartenp...@hotmail.nl on April 06, 2013 13:27:27\nSummary: Map Editor: plots are not buildable if there are too many doors   (was: Map Editor: Rooms with too many doors won't be recognized as a room. ) \n. From maartenp...@hotmail.nl on April 06, 2013 13:27:57\nUpdated link: http://forums.corsixth.com/index.php/topic,579.0.html\n. From maartenp...@hotmail.nl on April 06, 2013 13:38:50\nI can still reproduce this with the Map Editor in version 0.20.\nStatus: Accepted\nLabels: -Priority-Medium Priority-Low Component-MapEdit\n. The buildable flag is assigned by the tile not based on being in an enclosed space in the new map editor.\n. From roujin.mw on December 23, 2010 18:52:42\nCould you provide a savegame where this is happening?\n. From jorrit...@gmail.com on December 24, 2010 03:49:15\nHere's a savegame. The doctor in the Ultrascan room in plot number 2 is an example.\nAttachment: Mapedit.sav\n. From big.big....@gmail.com on December 24, 2010 15:27:32\nI'm also having this happen occasionally on Win7 r1126 full game level 5 and 6\n. From mark.l1...@hotmail.co.uk on January 11, 2011 12:59:23\nI have seen this several times in the past.  I think it happens when the staff decide to go to the staff room and at the same time a patient is about to use the door. The patients action stops the staff from doing what they wanted to do and they get stuck somehow.  Picking them up and putting them down again seems to clear it - sometimes anyway.\nI do think though that this may have been fixed recently.\n. From moolli...@gmail.com on January 13, 2011 01:34:05\nThis bug is still on beta 5.\nI encoutered it with psychiatrists and nurses.\n. From stephen....@gmail.com on January 13, 2011 12:02:08\nMark, do you think it's been fixed since Beta 5?\n. From jorrit...@gmail.com on January 23, 2011 14:54:16\nStill happening as of r1211\n. From mark.l1...@hotmail.co.uk on January 29, 2011 10:36:24\nIt is still happening, well up till Friday anyway as I have not checked since the recent update; it is also reported in issue #605 .\nIf it is to do with the calls dispatcher, then there are other issues that relate to it as well i.e. handymen repair machines whilst in use causes graphical issues - see issue #588 , this is noticable with things like the scanner.  If it repaired whilst in use you get the scanner moving for the patient and not for the handyman (two scanners in the same space as it were). Or as with the inflator it floats above the doctor.\n. From yuhan....@gmail.com on February 12, 2011 07:53:25\nAre you sure this is a bug? This used to happen in the original game--it usually comes about when the staff member in question has a quality like \"Never gives up\" or \"hard worker\" in the 'flavour text'.\n. From cgja...@gmail.com on March 25, 2011 15:08:42\nIssue 605 has been merged into this issue.\n. From Grim...@gmail.com on July 31, 2011 18:41:50\nThis still happens randomly in Beta7/ r1353 .\n. From cgja...@gmail.com on August 10, 2011 00:21:47\nStatus: Accepted\n. From mark.l1...@hotmail.co.uk on October 03, 2011 12:46:47\nDoes anyone have a saved game with staff that are overtired and won't go for a rest?\nThe one attached in comment 2 is bugged, there is a female that is dying in the op that then gets cured and crashes the game when she leaves the room!\n. From SyntheticDolphin@gmail.com on October 04, 2011 07:55:34\nI'm not sure if this one is related to VIPs, the two staff in the wing in view are going to each room the VIP is looking at. Not sure where the crazy one is.\nAttachment: 12.sav\n. From mark.l1...@hotmail.co.uk on October 04, 2011 11:36:48\nThanks for the save, only trouble is you are less than a month away from losing for killing too many patients and the reason your staff are tired is because you have it bumped up to 100% before they can rest.\nWhat I need is a save that replicates this issue, that is staff carry on working past the tired threshold and don't go to rest even though you have staff rooms.\nIf anyone has a save like that, it would be appreciated.\n. From mark.l1...@hotmail.co.uk on October 04, 2011 11:38:37\nWhat was interesting about your save is that you are that close to losing on deaths and yet there was no warning in the progress screen.  I would have expected to see something there show a skull and a red bar, which is what happens in TH.\n. From superma...@gmail.com on March 30, 2012 04:42:34\nI had this problem. The only save I found is about the researcher not leaving the research room, but I had this problem even with nurses or handyman.\nAs you can see from the name of the attached file, there is another bug: nobody is entering the GP's office on the left. Patients and staff (doctor and handyman) are waiting outside....\nThe only way of getting rid of this problem is to rebuilt the structure.\nAttachment: Double bug.sav\n. From thansend...@gmail.com on May 18, 2012 17:19:24\nHi. I installed the latest version released in April 2012 and this problem is still happening randomly for all types of staff. Also sometimes they start out obeying the rule and go when they hit the level of tiredness set then suddenly they started just working until they are about drop. Is there anyway to force all staff to obey the rule and not overwork?\n. From mark.l1...@hotmail.co.uk on October 09, 2012 11:25:16\nI just got round to looking at your save - double bug - and it is the sort of save I was after, so thank you.\nThe GP office does have a queue, the GP is past the tired threshold and patients are not entering plus the GP is not going for a break.\nWhat is strange is if you click on the door and try moving one of the patients to the front of the queue the GP appears to be in the queue.  So perhaps the problem with some staff not going for a break is the door becomes blocked - like no one can decide whose turn it is to use it!\nI am going to study the save some more, perhaps one of the devs can also take a look so that we can get rid of this long standing intermittent  bug.\nAttachment: 4.png\n. From mark.l1...@hotmail.co.uk on October 09, 2012 12:46:56\nHmm there seems to be a deadlock on the door and also on the door of the research room as there is a Dr there too at 100% tiredness.  I did notice a handyman waiting outside the GP office as he wanted to water a plant, but as there is no plant in research I don't think that can be the cause of the deadlock.\nThere is a function in door.lua to check for deadlocks, but I can't see where that gets called from other than in world.lua where at the end of the month there is an entity:checkForDeadlock - are doors entities as I thought they were objects?  Is this the cause of this issue - the deadlock on the door means whoever is in the room cannot leave and at the same time no one can enter either?\nCc: edvin.li...@gmail.com\n. From martin.b...@gmail.com on November 05, 2012 03:48:07\nIve had this problem in a few games now, and finally have a pair of savegames and a staff member who is repeatedly getting overworked, ive had staff in this game get stuck too tired in pharmacies, psych and training thus far\nthe consultant researcher/psych/surgeon in this game working in the research department will not leave when he hits his tiredness threshold\nattached are a couple of savegames - both a before when the staff member got manually moved by me into the staffroom and an after\nRunning Corsix-th .10 win7 64bit OpenGl\nAttachment: Staff Tiredness - Consult Res Surg Psych - Research Lab.sav Staff now overtired.sav\n. From martin.b...@gmail.com on November 05, 2012 05:01:32\nSorry for the double post, attached is a savegame of a stuck nurse\nAttachment: angry nurse.sav\n. From alexgh...@gmail.com on November 20, 2012 12:58:52\nI hope the attached patch will fix this. I also made it so staff members will head to the staff room as soon as they finished dealing with a patient and won't wait until that patient leaved the room.\nAttachment: fix.diff\n. From mark.l1...@hotmail.co.uk on November 21, 2012 11:51:41\nFor the \"double bug\" save this fixed the researcher as he went to the staff room.\nfor the one in the GP office he will still not leave the room.  I moved him and then noticed that another Dr would not enter the room either.  I suspect for the GP Office it was more than just not going for a break.  The corridor layout was very tight and with some re-modelling the GP office became usable again.\nSo that is perhaps another issue.\n. From Omni.Cor...@gmail.com on November 23, 2012 14:03:59\nI've patched comment 25, but I'm having trouble with a nurse not leaving the pharmacy when she's tired. It seems like the door it blocked, the handyman won't enter either. I've attached the save...\nAttachment: nurse stuck in pharm.sav\n. From alexgh...@gmail.com on November 24, 2012 08:56:52\nI've updated the patch and it will fix the blocked doors problem. I don't know what caused the doors to become blocked though.\nAttachment: fix.diff\n. From estei...@gmail.com on November 26, 2012 06:42:50\nI have attached two saves of likely the same problem. In the first save it can be observed in the GP's officed close to the reception desk. In the second two doctors are inside the operating theatre but don't put on their operating clothes and the patient keeps waiting outside.\nAttachment: greenpool-stuck-in-room.sav greenpool-struck-operating-theatre.sav\n. From alexgh...@gmail.com on December 01, 2012 07:39:41\n@30 The patch I posted in comment 28 fixes your second save. The gps office problem I think is caused by issue #1383 . \nI found a problem with staff members that were dropped in the corridor and didn't go to the staff room so I'm reposting the patch to fix it. Did anybody find any other problems?\nStatus: Started\nCc: -edvin.li...@gmail.com  \nAttachment: fix.diff\n. From Grim...@gmail.com on January 14, 2013 14:40:18\nCan't test the patch right now, but I'm adding it to v0.20, so I remember it.\nIt is probably safe to add this to trunk.\nLabels: Milestone-0.20\n. From azrina...@gmail.com on January 23, 2013 19:51:17\nI've tested #31's patch with the lastest trunk. But there's another bug that follows. This bug can be reproduced while testing the patch.\n1. In diagnosis rooms, the doctor will sometimes wait for humaniod that just joined the queue instead of diagnosing existing humanoids that are already in the queue. The behaviour has been observed in General Diagnosis, Cardiogram and Scanner.\n2. When dropping a consultant to a training room that has already a students in, the consultant will go out from the room eventhough there is no any other consultant. Sometimes it is also caused the consultant to open and close the training's room door repeatedly. However when I drop a consultant to an empty training room, this bug not occured.\n3. Sometimes the janitor or doctor can stuck and regarded as a part of a room's queue, picking and dropping them fixes them.\n. From mark.l1...@hotmail.co.uk on January 25, 2013 11:42:46\nAttached save has a Dr who needs to rest and a patient in the GP office which is to the left of reception.\nThe Dr paces up and down and the health of the patient gets worse.  After some time she will die in the GP office and the Dr still does not go to the staffroom.\nAttachment: error.sav\n. From Grim...@gmail.com on February 21, 2013 14:15:10\nJust tried you save, but the patient never died...\nPlaying with latest revision.\n. From mark.l1...@hotmail.co.uk on February 22, 2013 01:39:48\ndid the Dr go to the staffroom?\nWhen I said the patient dies, they can't die in a room, but the patient does show the dying icon (thumb down) and dying is in the dynamic display\n. From Grim...@gmail.com on February 23, 2013 05:05:31\nNo. The doctor didn't leave.\nBut the patient never left/died. But he did have the \"die\" icon.\nHe probably died then..\n. From edvin.li...@gmail.com on March 03, 2013 12:18:47\nIs comment 34 with alexghir's patch? Do the errors in comment 33 not happen without the comment 32 patch?\n. From mark.l1...@hotmail.co.uk on March 03, 2013 12:25:36\nSorry, I don't remember to be sure, but as I attached it here I think I was testing the patch at the time.\n. From mark.l1...@hotmail.co.uk on March 04, 2013 04:11:42\nIf the patch seems to work apart from on my save then please assume that my save is without the patch.\n. From Grim...@gmail.com on March 05, 2013 12:12:59\nSo then we should add it? Would be nice. :)\n. From mark.l1...@hotmail.co.uk on March 07, 2013 13:10:42\nI have tested the patch in #31 against my error save and the over tired Dr does not go for a rest.\n. From mark.l1...@hotmail.co.uk on March 08, 2013 13:07:17\nI have tweaked the above patch so that if you already have staff stuck in a loop and not going for a rest it will send them for a break.\nSecond patch - is combined with my patch for issue #1258\nAttachment: update.patch\n. From Grim...@gmail.com on March 09, 2013 13:36:48\nIf we added this now, then I guess the test crew would have to test this very quickly?\nBecause if we add it, then we are on overtime ( 2013-03-05: Create branch, all bugs need to have been fixed), but I think we should add this now.\nWould be very nice to have fixed this bug before the release.\n. From maartenp...@hotmail.nl on March 10, 2013 03:19:53\nWhen you add this to the Trunk, I will contact my testers about this immediatly.\n. From Grim...@gmail.com on March 10, 2013 04:46:50\nI just installed the \"both\" patch and tested this a little, and it seems to work somewhat well, but my console gives me a lot of text when using the savegame from this thread. And eventually making the game crash (it can be recovered, but it crashes soon again).\nI don't know if this is from Mark's patch or the newest patch from alexghir9, or maybe someone else.. I don't know.\nThe log:\nCreated game with savegame version 67.\nSavegame version changed from 65 (Trunk) to 67 (Trunk). The save was created usi\nng 65 (Trunk)\nUnreserved an object: sofa at 104:63\nUnreserved an object: sofa at 102:59\nWarning: Could not find a humanoid to remove from the user list\nWarning: Trying to remove nonexistant room build callback (function: 08360EC0) f\nrom humanoid (table: 0703BE48).\nWarning: Trying to remove nonexistant room remove callback (function: 08366810)\nfrom humanoid (table: 0703BE48).\nWarning: Trying to remove nonexistant room build callback (function: 0835FCD0) f\nrom humanoid (table: 07BF6160).\nWarning: Trying to remove nonexistant room remove callback (function: 06EE7740)\nfrom humanoid (table: 07BF6160).\nWarning: Trying to remove nonexistant room build callback (function: 0834AEF0) f\nrom humanoid (table: 07BF2038).\nWarning: Trying to remove nonexistant room remove callback (function: 0F80E5F0)\nfrom humanoid (table: 07BF2038).\nWarning: Trying to remove nonexistant room build callback (function: 08353E80) f\nrom humanoid (table: 08369060).\nWarning: Trying to remove nonexistant room remove callback (function: 0F774B88)\nfrom humanoid (table: 08369060).\nWarning: Trying to remove nonexistant room build callback (function: 082952F8) f\nrom humanoid (table: 0836BF68).\nWarning: Trying to remove nonexistant room remove callback (function: 08369268)\nfrom humanoid (table: 0836BF68).\nWarning: Trying to remove nonexistant room build callback (function: 08349DA8) f\nrom humanoid (table: 07035B88).\nWarning: Trying to remove nonexistant room remove callback (function: 07E00D58)\nfrom humanoid (table: 07035B88).\nWarning: Trying to remove nonexistant room build callback (function: 08354C80) f\nrom humanoid (table: 0F77B348).\nWarning: Trying to remove nonexistant room remove callback (function: 0F777568)\nfrom humanoid (table: 0F77B348).\nWarning: Trying to remove nonexistant room build callback (function: 083542A8) f\nrom humanoid (table: 07FF3500).\nWarning: Trying to remove nonexistant room remove callback (function: 07E6BA48)\nfrom humanoid (table: 07FF3500).\nWarning: Trying to remove nonexistant room build callback (function: 0833E148) f\nrom humanoid (table: 0848EF48).\nWarning: Trying to remove nonexistant room remove callback (function: 083642E0)\nfrom humanoid (table: 0848EF48).\nWarning: goHome called when the patient is already going home\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nC:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:431: attempt to index local 'hosp' (a\n nil value)\nstack traceback:\n        C:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:431: in function 'goHome'\n        C:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:464: in function 'tickDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:1063: in function 'onEndDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:978: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:789: in function 'dispatch'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:690: in function \nError in timer handler:\nC:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:431: attempt to index local 'hosp' (a\n nil value)\nstack traceback:\n        C:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:431: in function 'goHome'\n        C:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:464: in function 'tickDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:1063: in function 'onEndDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:978: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:789: in function 'dispatch'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:690: in function \nWarning: No event handler for timer\nLabels: -Priority-Medium Priority-High\n. From mark.l1...@hotmail.co.uk on March 10, 2013 05:36:05\nThose warnings have been there for a while now.  the error though could be \nrelated to my patch, although I have not touched go home cured, it could be \na knock on effect.\nIf I get time later I'll see if I can figure out what - don't let that stop \nsomeone stepping in if they can see why though, I won't mind :)\n. From mark.l1...@hotmail.co.uk on March 10, 2013 11:26:10\nI think I found the problem Grimdoc if you want to try this on the same save.\nNote: I have not yet updated to the latest changes\n. From Grim...@gmail.com on March 10, 2013 14:37:52\nNewest patch upon newest revision, on the \"error.sav\".\nSlightly different error?\nSavegame version changed from 65 (0.20) to 67 (Trunk). The save was created usin\ng 65 (0.20)\nUnreserved an object: sofa at 104:63\nUnreserved an object: sofa at 102:59\nWarning: Could not find a humanoid to remove from the user list\nWarning: Trying to remove nonexistant room build callback (function: 0801C930) f\nrom humanoid (table: 06AC1850).\nWarning: Trying to remove nonexistant room remove callback (function: 083911C8)\nfrom humanoid (table: 06AC1850).\nWarning: Trying to remove nonexistant room build callback (function: 07E8FA98) f\nrom humanoid (table: 0D81DD50).\nWarning: Trying to remove nonexistant room remove callback (function: 07107200)\nfrom humanoid (table: 0D81DD50).\nWarning: Trying to remove nonexistant room build callback (function: 0801BCF0) f\nrom humanoid (table: 0803B088).\nWarning: Trying to remove nonexistant room remove callback (function: 080383B0)\nfrom humanoid (table: 0803B088).\nWarning: Trying to remove nonexistant room build callback (function: 08040760) f\nrom humanoid (table: 080318A8).\nWarning: Trying to remove nonexistant room remove callback (function: 0836AC98)\nfrom humanoid (table: 080318A8).\nWarning: Trying to remove nonexistant room build callback (function: 08040B50) f\nrom humanoid (table: 0D819AE8).\nWarning: Trying to remove nonexistant room remove callback (function: 06E6B728)\nfrom humanoid (table: 0D819AE8).\nWarning: Trying to remove nonexistant room build callback (function: 07E9EDA0) f\nrom humanoid (table: 06BFA2D0).\nWarning: Trying to remove nonexistant room remove callback (function: 04109C68)\nfrom humanoid (table: 06BFA2D0).\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nC:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:529: use of undeclared variable 'room\n'\nstack traceback:\n        [C]: in function 'error'\n        C:\\Games\\CorsixTH\\Lua\\strict.lua:43: in function \n        C:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:529: in function 'tickDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:1063: in function 'onEndDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:978: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:789: in function 'dispatch'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:690: in function \nError in timer handler:\nC:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:529: use of undeclared variable 'room\n'\nstack traceback:\n        [C]: in function 'error'\n        C:\\Games\\CorsixTH\\Lua\\strict.lua:43: in function \n        C:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:529: in function 'tickDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:1063: in function 'onEndDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:978: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:789: in function 'dispatch'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:690: in function \nWarning: No event handler for timer\n. From mark.l1...@hotmail.co.uk on March 11, 2013 01:50:47\n@ Grimdoc\ncan you look in patient lua line 529 approx and uncomment this line\n   -- local room = self:getRoom()\n. From mark.l1...@hotmail.co.uk on March 11, 2013 12:39:43\nAttachment: update - both.patch\n. From Grim...@gmail.com on March 11, 2013 13:20:16\n@50: I tried this, but got an error (same as below).\n@51: I tried this, and I didn't get a crash for a long time, but eventually I did.\nMany lines of \"Trying to remove nonexistant room build callback\"\nAnd then:\nA stack trace is included below, and the handler has been disconnected.\nC:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:430: attempt to index local 'hosp' (a\n nil value)\nstack traceback:\n        C:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:430: in function 'goHome'\n        C:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:462: in function 'tickDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:1063: in function 'onEndDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:978: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:789: in function 'dispatch'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:690: in function \nError in timer handler:\nC:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:430: attempt to index local 'hosp' (a\n nil value)\nstack traceback:\n        C:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:430: in function 'goHome'\n        C:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:462: in function 'tickDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:1063: in function 'onEndDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:978: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:789: in function 'dispatch'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:690: in function \nWarning: No event handler for timer\n. From Grim...@gmail.com on March 11, 2013 13:22:48\nIs there somehing I am doing wrong? I always apply your patches on a \"fresh\" revision (latest).\nOr is it just a very resilent bug?\nBut if this fixes all NEW instances of this, maybe we can survive with some faulty saves?\n. From mark.l1...@hotmail.co.uk on March 11, 2013 13:34:11\nI think there is something wrong with the patch in comment 31, I have created a seperate issue so it can be confirmed.\nI am not sure about the error you got, I ran the save for ages and got nothing.  With it being in gohome I don't think it is something from me unless its indirect.\nthanks for testing anyway\n. From Grim...@gmail.com on March 11, 2013 14:30:50\nOk.\nMaybe a third person could test the latest patch.\nHopefully it is just something on my side.\nmaarten, do you (or someone else) want to give it a small test?\nJust install the latest patch, and test the \"error.sav\" from this issue.\nTurn off salaries and set it to max speed to check for errors.\nCc: maartenp...@hotmail.nl\n. From maartenp...@hotmail.nl on March 11, 2013 14:45:30\nNo error occurs anymore with the latest patch. But now it takes a very long time before a patient comes into the GP-office (especially by the two ones which are builded next to eachother.)\n. From mark.l1...@hotmail.co.uk on March 12, 2013 04:19:53\n@ #56 You should see issue #1529 , I think you will see the same thing happen there too\n. From maartenp...@hotmail.nl on March 12, 2013 04:40:35\nYes, you're right, the same thing happens.\n. From mark.l1...@hotmail.co.uk on March 12, 2013 08:58:52\nIssue 1529 has been merged into this issue.\nCc: alexgh...@gmail.com\n. From maartenp...@hotmail.nl on April 01, 2013 04:36:32\nLabels: -Milestone-0.20 Milestone-0.30\n. From mark.l1...@hotmail.co.uk on April 04, 2013 12:57:34\nFrom what I can tell the fix patch works okay for the not going for a break issue and it is the door blocking bit that causes the queuing problem that I mention in issue #1529 .\nthe attached is the same as fix but with the door blocking bit removed.\nI am hoping someone will test this, what you are testing is do staff still get stuck and not go for a rest and if you have a save where someone is already in this loop do the now go for a rest.  (like the save in comment 34)\nAttachment: not_going_for_break.patch\n. From maartenp...@hotmail.nl on April 09, 2013 10:06:31\nI think we should add this to the Trunk and maybe we could implement this in the upcoming 0.21 version?\n. From Grim...@gmail.com on April 09, 2013 10:51:08\nWhen trying to patch with newest revision, i get this:\n\"\n--- CorsixTH/Lua/app.lua\n+++ CorsixTH/Lua/app.lua\n@@ -28,7 +28,7 @@\n-- Increment each time a savegame break would occur\n -- and add compatibility code in afterLoad functions\n-local SAVEGAME_VERSION = 67\n+local SAVEGAME_VERSION = 68\nclass \"App\"\n\"\nI'm not too good with code, but does this mean that I should manually add +1 to the savegame version? Currently it is at 70.\n. From mark.l1...@hotmail.co.uk on April 09, 2013 10:55:57\nLooks like it is already out of date.  You have to change the app.lua and \nalso where there is an \"if old < 68 then\" to 71 as well.\n. From mark.l1...@hotmail.co.uk on April 09, 2013 10:58:26\nthe other place is in staff.lua\n. From Grim...@gmail.com on April 09, 2013 11:19:20\nI managed to do that, I think.\nBut I just noticed that there are 2 patches here.. Should both be applied, or?\n. From mark.l1...@hotmail.co.uk on April 09, 2013 11:28:34\nAt the moment only the one in comment 61.\nThe earlier one of mine was a combination of patches and one of them from fix.diff has the problem of the queues that stop working correctly.  So mine in comment 61 is Alex's fix with that bit removed and a bit from me added to make it work on old games too.  \nCredit should go to Alex though.\n. From Grim...@gmail.com on April 09, 2013 11:37:12\nAdded patch in r2271 .\nPlease just check that I did the \"save game versioning\" right.\n. From mark.l1...@hotmail.co.uk on April 09, 2013 11:58:47\nWe still have the issue with blocked doors that I think the fix patch was aiming to fix.  But then there was the issue #1529 where I found that queues would start to behave strangely and the patients would all visit the door again and then only new arrivals would enter the room.\nFor this reason I am changing the name of the issue\nSummary: blocked doors cause a problem - patch though causes another issue   (was: Exhausted staff members don't go to staff room) \nStatus: Queued\nCc: -maartenp...@hotmail.nl -alexgh...@gmail.com edvin.li...@gmail.com\n. From mark.l1...@hotmail.co.uk on May 05, 2013 00:10:01\nThe bug \"Exhausted staff members don't go to staff room\" still exists, seen it a couple of times in the last week.\n. From maartenp...@hotmail.nl on May 05, 2013 00:50:05\nCould you provide some saves with this situartion?\nSummary: Exhausted staff members don't go to staff room - patch though causes another issue   (was: blocked doors cause a problem - patch though causes another issue) \nStatus: Started\n. From mark.l1...@hotmail.co.uk on May 05, 2013 06:19:16\nAttachment: not going 4 break.sav\n. From maartenp...@hotmail.nl on May 05, 2013 08:13:06\nBut directly after I unpause, the docotor goes to the staff room. Do you have more saves with this situation and where he does not go to the staff room?\n. From mark.l1...@hotmail.co.uk on May 05, 2013 10:06:38\nOddly in the copy here he rests.  Here is another copy and it is both Dr's in the GP office that are not resting but walk up and down the room instead. https://www.dropbox.com/s/ryds22tkmevgcn8/notresting.wmv\nAttachment: not going 4 break2.sav\n. From maartenp...@hotmail.nl on August 04, 2013 10:06:40\nLabels: -Priority-High Priority-Medium\n. From Grim...@gmail.com on August 06, 2013 15:34:04\nFrom your latest save i get this error after a few seconds:\nSavegame version changed from 74 (Trunk) to 76 (Trunk). The save was created usi\nng 74 (Trunk)\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nC:\\Games\\CorsixTH\\Lua\\room.lua:210: bad argument #1 to '(for generator)' (table\nexpected, got nil)\nstack traceback:\n        [C]: in function '(for generator)'\n        C:\\Games\\CorsixTH\\Lua\\room.lua:210: in function 'getMissingStaff'\n        C:\\Games\\CorsixTH\\Lua\\room.lua:230: in function 'testStaffCriteria'\n        C:\\Games\\CorsixTH\\Lua\\humanoid_actions\\meander.lua:42: in function '?'\n        C:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:547: in function 'Humanoid_s\ntartAction'\n        C:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:639: in function 'finishActi\non'\n        C:\\Games\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:144: in function 'timer_\nfunction'\n        C:\\Games\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n        C:\\Games\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:796: in function 'dispatch'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:697: in function \nError in timer handler:\nC:\\Games\\CorsixTH\\Lua\\room.lua:210: bad argument #1 to '(for generator)' (table\nexpected, got nil)\nstack traceback:\n        [C]: in function '(for generator)'\n        C:\\Games\\CorsixTH\\Lua\\room.lua:210: in function 'getMissingStaff'\n        C:\\Games\\CorsixTH\\Lua\\room.lua:230: in function 'testStaffCriteria'\n        C:\\Games\\CorsixTH\\Lua\\humanoid_actions\\meander.lua:42: in function '?'\n        C:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:547: in function 'Humanoid_s\ntartAction'\n        C:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:639: in function 'finishActi\non'\n        C:\\Games\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:144: in function 'timer_\nfunction'\n        C:\\Games\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n        C:\\Games\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:796: in function 'dispatch'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:697: in function \nWarning: No event handler for timer\n. From mark.l1...@hotmail.co.uk on August 07, 2013 00:56:16\ngetMissingStaff was altered I think when adding more than one nurse can work in the ward. So perhaps that change has broken this save, nothing to do with the issue at hand though.\n. From mark.l1...@hotmail.co.uk on August 25, 2013 12:02:01\nat comment 76\nThe reason you got that error is the save version is the same as when more desks in wards was made possible.\nIf you want to avoid the error you can open ward.lua and look for the if old < and change the number to 75.  It will then get the new variable added.\nCc: -edvin.li...@gmail.com\n. There is a staff policy that should affect whether / when they go to the staff room. Haven't looked into whether it works.\n. I guess we can reopen if we see it again.\n. From jorrit...@gmail.com on December 25, 2010 14:00:18\nAdding the wall back in after you place the plant doesn't work?\n. From Lmkoning...@gmail.com on December 25, 2010 14:02:36\nnope when you I tried that the plant disappears. The wall uses that tile. If you place something else on that tile it dissapears.\n. From maartenp...@hotmail.nl on January 20, 2013 02:18:40\nDoes this strange situation still occurs after two years?\n. From roujin.mw on January 20, 2013 04:22:29\nAs test manager, shouldn't you be exactly the one to find that out, instead of asking? ;)\nAlso, please don't post updates that don't give any new insight to issues, it just clutters the issue feed and hides issues where something is actually happening.\n. From maartenp...@hotmail.nl on January 20, 2013 04:44:42\nYes, that's right. Sorry! I tested this and this issue still occurs. Maybe making a ''line'' between the tiles, where you can put walls, and using the tile itself for decoration or something like that would be a solution? But by floors this issue doesn't occur by me; so, maybe the decoration needs the same behavior as the floor-tiles?\n. From mark.l1...@hotmail.co.uk on May 29, 2013 07:43:51\nThis would appear to only be an issue with tiles that have height and only those against one wall.  (Does this help anyone come up with a solution?)\nLook at the attached image:\nThe only bushes that were removed are those against the top right wall.\nThose against the other three walls are left in place.\nFlat tiles like edging and ponds don't replace the wall\nHedge, tree, lamps etc (anything with height to it) do replace the wall)\nThere is an problem in issue #1456 (which I will merge with this one) where it has been noted that in game objects placed too close to the wall (again those with height) have layering issues.\nAttachment: walls.png\n. From mark.l1...@hotmail.co.uk on May 29, 2013 07:44:00\nIssue 1456 has been merged into this issue.\n. From maartenp...@hotmail.nl on July 04, 2013 11:50:02\nStatus: Accepted\n. From mark.l1...@hotmail.co.uk on January 06, 2011 08:41:17\nI can do you some screens from TH later when I get home\n. From edvin.li...@gmail.com on January 06, 2011 09:25:41\nThis has a rather low priority imo, but it certainly needs to be fixed at some point. Think of it as a feature for now. :-)\nStatus: Queued\n. From stephen....@gmail.com on January 06, 2011 10:17:47\nAttached is a screenshot from TH, you can see that the Autospy machine is indeed shrunk slightly to fit the window.\nI'd say CTH looks quite nice still though!\nLabels: -Priority-Medium Priority-Low  \nAttachment: ResearchView.png\n. From Grim...@gmail.com on January 06, 2011 13:59:23\nI agree that CTH looks good, but it would be an improvement to either make the big machines fit in the window, or make the window frame cut off the excess if the machine is too big.\nBut this is after all a cosmetic issue.\n. From maartenp...@hotmail.nl on February 05, 2013 10:53:50\nI added this issue to issue #1494 (this is a list of all knows graphical glitches.)\n. From Grim...@gmail.com on August 21, 2011 05:30:16\nCould not replicate this in r1363 .\nIt could be a local problem with font files or something.\nClosing this issue (unless the issue reporter says it persists).\nStatus: Fixed\n. From lserg...@gmail.com on August 21, 2011 07:33:13\nI can replicate this issue reliably in r1363 (attachment 1) I have changed my hardware and reinstalled OS since my first report. I'm also using a different font.\nRunning in Russian or Chinese is not required. While running in English, fullscreen toggle would mess up the languge selection menu (attachment 2)\nChanging language after toggling fullscreen mode would produce more graphical issues (attachment 3)\nI have also encountered more weird behaviour while testing this, but I was unable to replicate it (attachment 4)\nI will try to test this on a number of computers later this month and report any results.\nAttachment: 001.jpg 002.jpg 003.jpg 004.jpg\n. From Grim...@gmail.com on August 21, 2011 10:01:44\nOk. Opening it again.\nBut I can't reproduce it at least. Though I use Win7 64 bit.\nStatus: Accepted\n. From Grim...@gmail.com on December 31, 2011 08:39:33\nI can partially replicate this with my 24\" screen (1920x1080) when changing to a smaller window/resolution size.\n. From mark.l1...@hotmail.co.uk on October 30, 2012 13:09:26\nI have seen this and you can also get a message about the resolution not being allowed.  This is odd for me as it was the resolution I started out with before toggling to window and back again.\nI get around this by changing it in config, but sometimes it does seem to allow 1600x900 - maybe with a different exe!\nAttachment: 2.png\n. From maartenp...@hotmail.nl on October 31, 2012 04:46:13\nIs this bug not related to issue #1336 and issue #350 ?\n. From mark.l1...@hotmail.co.uk on October 31, 2012 04:57:46\nYes and no, that it why one has been merged and my comments relate more to 350, but I could not find it last night.\nthey are though probably related\n. From maartenp...@hotmail.nl on February 05, 2013 09:25:05\nI think you can add the OpenGL-label to this issue?\n. From edvin.li...@gmail.com on January 25, 2011 13:37:06\nBeta 4 is quite old. Could you try out Beta 5 or even better the latest trunk version to see if it still happens as often? http://th.corsix.org/corsix-th-latest.html\n. From ladysere...@gmail.com on February 21, 2011 01:22:37\nVersion: Beta 5\nAfter a day of constant investigation on this issue, I have resolved the issue of patients getting stuck seemingly at random.  What clued me in was a constant cycle of:\n- Diagnosed patient goes to GP\n- Then comes out and needs a drink\n- Then uses the restroom and goes back to GP\n- repeat\ngp.lua was written so a diagnosed patient would leave the GP with meander and idle, then nothing afterward.  This fix targets that specific case in two parts.\nAttachment: idle.lua gp.lua\n. From oliver.f...@googlemail.com on February 21, 2011 05:41:56\nFirst off, the files are somewhat outdated (Jan 17th), so i guess updating to the latest version and testing if the problem is present at all, is necessary.\nI don't think that modifing the idle action with behaviour which belongs to other objects would be a good idea. It scatters responsibility. (For the same reason action queues don't get \"autofilled\" with an idle or anwser_call action if they are empty.)\nThis just shows us, that somewhere in the code base some seek_room action isn't assigned properly or even removed.\nThe modifications made to the GP might fix this problem, but i'm not sure if it introduces other problems; due to the fact, that the if-then-else clause in question should never call the else-part if it behaves properly, which brings up the question why is \"else\" there in the first place and why does it get called at all.\nQueueing another seek_room action in onHumanoidLeaveAction is undesirable, as it will definetly add two seek_room actions to the patient once diagnosis is successful.\nAlso, having a look at room.lua might help, as some code is duplicated there. Maybe the whole problem is a copy-paste-issue from the room-baseclass to the gp-subclass, when additional behaviour was added later on.\nFrom my point of view this needs further investigation, but i think we are close.\n. From ladysere...@gmail.com on February 21, 2011 11:03:53\nThe issue is the else-part is triggered when a patient goes back into the GP after they already have their diagnosis flag set to True.  I played an entire game and not a single one of these patients had more than one seek_room actions in their action queue.  This is not a real fix for the issue, its just a band-aid for having stuck patients.  The main thing is now there aren't any stuck patients.  As for why the else-block in question ever gets called ... needs investigation and a real fix.\n. From jorge...@gmail.com on February 21, 2011 11:49:26\nTo be completely honest, I think one problem with implementing a workaround is that there no longer is any motivation to fix the problem.\nStatus: Accepted\n. From mark.l1...@hotmail.co.uk on February 21, 2011 12:05:10\nI don't know if I am reading GP.lua correctly, but it looks to me as though if you diagnose someone before the policy stop_procedure then the \n  else\n    patient:queueAction{name = \"meander\", count = 2}\n    patient:queueAction{name = \"idle\"}\nis called\nI could be completley wrong about this, as I am still picking this coding stuff up...\n. From Grim...@gmail.com on September 04, 2011 05:53:58\nIs this still happening?\n. From mrapsout...@gmail.com on September 04, 2011 06:43:23\nI dont know, I have not managed to play the latest release recently.\n. From Grim...@gmail.com on October 24, 2011 16:13:49\nStatus: Input\n. From puddisei...@gmail.com on November 23, 2011 14:40:30\nIt is still happening with Beta8. See the scanner room to the left of the main entrance. \nDoctors also seem to be affected. There are a few doctors standing around near the training room. I've tried to fire them in order to get rid of them, but they won't disappear. Can't pick them up either. They can be located inside and outside of rooms. I think I've observed the same behaviour for patients.\nAttachment: Autosave12.sav\n. From Grim...@gmail.com on November 23, 2011 16:56:33\nWhen loading your save on the newest version of the game, I get an error after a few seconds that freezes the game completely (no error inside the game), but the log gives this:\nA stack trace is included below, and the handler has been disconnected.\nC:\\Games\\CorsixTH\\Lua\\hospital.lua:575: attempt to index field '?' (a nil value)\nstack traceback:\n        C:\\Games\\CorsixTH\\Lua\\hospital.lua:575: in function 'checkFacilites'\n        C:\\Games\\CorsixTH\\Lua\\hospital.lua:768: in function 'onEndDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:756: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:681: in function 'dispatch'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:583: in function \nWarning: No event handler for timer\n. From mark.l1...@hotmail.co.uk on February 22, 2012 12:57:05\n@ 11\nI think your error comes about when there are stuck kicked patients in the hospital at the time patients are being counted for the seating messages.  If you don't have stuck patients you don't get the error.\nI did do a fix for this before Christmas, but I can't find it.\nIf no one fixes it before, I will attempt it again at the weekend\n. From Grim...@gmail.com on February 22, 2012 14:13:26\nHm. It can also be your fix already is in the game too?\nOr didn't you upload it?\n. From mark.l1...@hotmail.co.uk on February 23, 2012 00:44:16\nI can't remember if I uploaded it or not.  I can remember seeing this issue and your comment and error and realising what it was down to and doing the fix before Christmas, then my wife took really ill, so I may have never got around to posting it here.\nI know what is needed, its whether I can remember how I did it!  I tried something last night, but it still crashed on this save, but then again this save may be beyond help.....\nI think that it needs a check to make sure that the patient is still attached to the hospital before the counting of standing and seated patients is carried out.\n. From baban...@gmail.com on March 17, 2012 07:30:43\nHello,\nI have a similar issue when a patient got stuck inside the general diagnostic room. \nI'm attaching a file that shows that: the patient in the general diagnostic room couldn't leave because the door was blocked by a VP person. Please allow 1 min of play to see that effect.\nAttachment: My2.sav\n. From mark.l1...@hotmail.co.uk on March 17, 2012 08:42:32\nI think that the reason he got stuck has already been fixed in the development snapshot - here is a link for it http://th.corsix.org/corsix-th-latest.html or wait a week and there will be an update on beta 8.\nMost likely cause may have been yawning, hard to tell for sure as the error does not happen now.\n. From Grim...@gmail.com on October 29, 2012 13:09:46\nThe save from #10 still causes this error, but I have never seen it when playing for myself:\nA stack trace is included below, and the handler has been disconnected.\nC:\\Games\\CorsixTH\\Lua\\hospital.lua:615: attempt to index field '?' (a nil value)\nstack traceback:\n        C:\\Games\\CorsixTH\\Lua\\hospital.lua:615: in function 'checkFacilites'\n        C:\\Games\\CorsixTH\\Lua\\hospital.lua:826: in function 'onEndDay'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:916: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:734: in function \n        (tail call): ?\n        C:\\Games\\CorsixTH\\Lua\\app.lua:636: in function \nWarning: No event handler for timer\nStatus: Accepted\n. From mark.l1...@hotmail.co.uk on October 29, 2012 13:35:19\n@ Grimdoc  see issue #1155 - which I closed last month.\nI think it relates to this save in comment 10\n. From Grim...@gmail.com on October 29, 2012 13:55:34\nAh, so this is actually fixed then?\n. From mark.l1...@hotmail.co.uk on October 29, 2012 14:02:46\nI don't think so.\n. From Grim...@gmail.com on December 02, 2012 05:03:34\nLabels: Milestone-0.20\n. From azrina...@gmail.com on January 23, 2013 19:53:13\nApperently, by not building toilets and drink machines, this bug will significantly reduced. Instead, the doctors and janitors will sometimes can stuck eventhough it is rare.\n. From Grim...@gmail.com on March 12, 2013 13:12:21\nDoctors and janitors getting stuck is another issue, I believe.\nLabels: -Milestone-0.20 Milestone-0.30\n. From Grim...@gmail.com on May 12, 2013 05:49:01\nCc: edvin.li...@gmail.com\nLabels: -Priority-Medium Priority-High\n. From Grim...@gmail.com on August 06, 2013 06:15:52\nIs anyone still experiencing this? I haven't seen it in a long time!\n. From mark.l1...@hotmail.co.uk on August 06, 2013 07:46:54\nI opened a save last night that had the same error, but it could be the save is a few months old.  Not too old though as I cleared all my old saves on release of 0.20\n. From Grim...@gmail.com on August 06, 2013 13:52:39\nOkay.\n. From mark.l1...@hotmail.co.uk on August 25, 2013 11:47:11\nLoad the save from comment 10 and you soon get an error\nPatch it with the attached and load the save again and you won't get the same error.\nRun the game for a bit longer you will get an unrelated error from a Dr in the staffroom, but if you look around the hospital there are staff stuck all over the place so I think it is unrelated.\nAttachment: Issue 702.patch\n. From maartenp...@hotmail.nl on August 25, 2013 13:07:28\nLabels: -Type-Defect Type-Patch\n. From Grim...@gmail.com on August 27, 2013 08:04:56\nYes. This fixes this particular error.\nI didn't get any error in save from #15 either.\nAdded this in r2450 .\nShould this be kept open for testing feedback?\n. From mark.l1...@hotmail.co.uk on August 27, 2013 11:20:00\nI have only tried to fix the cause of checkFacilites, not the original issue, so yes let us keep this open for a while.\nStatus: Investigating\nCc: -edvin.li...@gmail.com\nLabels: -Type-Patch -Priority-High Type-Defect Priority-Medium\n. From sheefn...@gmail.com on November 25, 2013 17:31:35\nHi, I'm also having problems with this bug. I can't finish this level. I've attached a saved game and framed the two rooms with the same problem. I think it might have something to do with the excess people standing around. That being said I cleared them out once and it made no difference. Anyways here's the file.\nAttachment: 10-2_patientsStuckInRooms.sav\n. From SyntheticDolphin@gmail.com on February 08, 2011 12:24:32\nIt's the same layering bug as the ward beds through the walls and so on.\n. From cgja...@gmail.com on March 25, 2011 11:58:01\nI cannot reproduce this bug. Does anyone know if it's been intentionally fixed?\n. From mark.l1...@hotmail.co.uk on March 25, 2011 12:14:09\nI don't think it has been fixed.  It is not always the same objects that do this either, for instance if the handyman repairs a machine whilst in use it will happen; otherwise it just rears its head from time to time.\n. From Grim...@gmail.com on May 24, 2012 10:41:08\nHaven't seen this one either.\nCould it have been unintentionally fixed then?\nSummary: Graphical: couch floats over Dr\nStatus: Input\n. From mark.l1...@hotmail.co.uk on May 24, 2012 12:07:20\nI think it will still happen.  As stated above it is layering, with the couch picture above there are two walls the couch and the Dr all in the same tile, it is that combination of more than two objects/humanoids in the same tile that does it in my opinion.\nTake a look at similar issues about graphical glitches and most will have this 2+ objects in the same tile in common.\nIn the above picture it would not have been a problem if the Dr was in front, but the couch is being drawn afterwards, so appears on top.  I was having this problem when try to add the chemical mixer. \nIf I am right, it will most likely need changes to the c++.\n. From Grim...@gmail.com on May 24, 2012 13:29:41\nAha. Let's leave this open then.\nWe actually have a C++ programmer in the IRC channel these days! :)\nHe is trying to implement the videos and main menu.\n. From mark.l1...@hotmail.co.uk on January 22, 2013 12:00:17\nJust adding this as a reminder\nAttachment: 6.png\n. From maartenp...@hotmail.nl on April 01, 2013 07:15:37\nI can still reproduce this.\nSummary: Graphical: couch floats over doctor   (was: Graphical: couch floats over Dr) \nStatus: Accepted\n. Does anyone have a save for this issue?\nI'm looking to address problems like this now. From stephen....@gmail.com on February 08, 2011 13:18:12\nI like the idea - it makes the game harder after the first year, which is a good thing. It's likely that we should be changing things like spawn rates after the first year as well.\n. From edvin.li...@gmail.com on February 08, 2011 13:39:56\nI'm working on spawn rate. I can hopefully commit it soon enough. Just need to make it work with old saves.\nRight now it is quite bad actually. It depends way too much on reputation.\n. From mark.l1...@hotmail.co.uk on February 09, 2011 02:23:02\nI think in TH spawn rate also depends on reputation, once you are below 500 you get in less people and once you are at max you get swarms of them.  So in that respect the spawn rate is right, what is not though is that you currently get all patients, whereas some should go to the AI's; which I know is not in the game yet. I am thinking of the chart in status, sometimes you all have around 25% of the patients at other times when you are doing well compared to the AI's you may have 50%+ (they are coming to you as you have a good rep')\n. From edvin.li...@gmail.com on February 09, 2011 03:41:35\nIt depends on reputation in that if you have a bad reputation you get a smaller portion of all people.\n. From mark.l1...@hotmail.co.uk on February 09, 2011 12:54:37\nIf you have an high rep' does the spawn rate increase, as it seems that way?\nIs having variable spawn rates an option i.e. high ish to start with, then decreasing slightly as the years move on. So that you are never really swamped with patients when you get a rep of 1000?\nRecently I tried fixing a save for someone in the forum.  He was swamped with patients when his rep got high. It was made worse as there were no loos and only one staff room and he had queues at rooms of 30+ and 300+ in his hospital.  In TH this  would only happen if a room became broken (door went missing) as reception would tend to follow queue limits that you set and you would instead have the queues at reception. You would never get 300+ in TH, well if you did, I don't remember it.\nIf the spawn rate didn't increase the way it does he may have been able to cope.  At the same time, if in the early years your rep went up a bit quicker, you would have more money coming in (some have said that they struggle in the early years) and it may help some of the novices. (perhaps on the easier setting) With being an old hand at this game, I find CTH easier personally, but I know there are a lot that find it hard and I think if we can make it a bit easier that this is better than cheats and editors etc.\n. From edvin.li...@gmail.com on February 09, 2011 13:35:54\nIt is fairly straight forward actually in the level config how it probably worked in the original. E.g.:\npopn[0].Month.Change      0       3\npopn[1].Month.Change      1       1\npopn[2].Month.Change      7       0\npopn[3].Month.Change      14      1\npopn[4].Month.Change      21      0\nfor level one of medium difficulty.\nI tried the original for a while, and I could predict the number of patients a given month almost to the exact number.\nThese values say that the first month there will be 3 patients distributed among you and your opponents. The next month they will be 4. Month 7 it will stop increasing and stay at 9 patients per month. Then it will increase to the final 16 per month by the 21 month.\nThese values make the number of patients' spawn rate increase over time no matter what the reputation, except that you get a lesser share of the total if you have a bad rep.\n. From edvin.li...@gmail.com on February 09, 2011 13:37:17\nOh, and yeah, CorsixTH currently change spawn rate only depending on reputation.\n. From mark.l1...@hotmail.co.uk on February 14, 2011 13:12:14\nI have conducted a little experiment to test the reputation increase in the first year on level 1 with both hospitals having exactly the same rooms in size and equipment including corridors + same number of staff.\nOne year on level 1 hard    TH      CTH\nValue               73405       76440\nVisitors            32      43\nDeaths              0       0\nSent home           6       0\nCures               22      27\nRep @ year end          656     608\nIn TH the value started at 70405 and increased twice throughout the year by 1000 and again at year end by 1000.\nIs this related to inflation rate? \nIn later levels I suspect it might go down as equipment gets cheaper and does usage/damage decrease value?\nThe rep in CTH was with me testing the following scheme for the first year\nCures 4\nDeaths -3\nSent home -2\nI suspect that I would have needed to get 6 or more per cure to get the same rep as TH.  I had a third more visitors, but that is to be expected with no competition. \nInterestingly there were no boiler breakdowns in the first year for TH, but in CTH I had six or seven - so perhaps I should change my patch for that.\nBoth games are saved and I will test year two tomorrow night to see what that gives us.\n. From edvin.li...@gmail.com on February 14, 2011 14:28:19\nI really appreciate your efforts! :-) Keep going. Many interesting thoughts. Especially that equipment gets cheaper. So the value increased without you doing anything so to speak? Inflation would seem like a reasonable reason. Does lot prices increase over the years?\n. From mark.l1...@hotmail.co.uk on February 15, 2011 04:53:02\non \"equipment gets cheaper.\"  its a guess on my part at this stage, but with research reducing the costs I do wonder if that will affect the hospital value.\non \"value increased\" Yes, I added no new rooms or anything else, but the value increased.\non \"lot prices\"  There are none in level 1, but when I get to level 2 I will watch for that too.\non \"Inflation\"  I will know better if it is down to that when I get to the level with 50% inflation.  That will confirm this theroy one way or the other.\n. From mark.l1...@hotmail.co.uk on February 16, 2011 12:45:55\nI continued into the second year and then due to a fault in TH (after a rat run it went back to level 1) this is all I have.  I will need to start over, perhaps at the weekend, so if there is anything else you want checking; let me know.\nNumbers are TH then CTH\nVisitors    94   120\nCured       44    90\nDeaths      1     4\nsent home   13    1\nValue     72405  76440\nRep        595   701    (less yearend bonuses in TH) \nThings to note: in TH in level 1 invisible patients don't always get treated.  There are always faxes as they don't know what type it is (varying from say 40% chance - 80%) hence all the sent homes. Strange thing is that they don't count against you in lost rep.\nOn Value.  both start off the same with an empty building, but CTH adds the full cost of the rooms whilst TH only counts 2280 + 100 on a GP - is the 100 the filing cabinet, as desk would include the chair?  Also in TH the value increased by 1000 then down by 1000 a couple of times in the second year - was this due to the inflation m/c decreasing in value though lack of repair? - I will watch for that.\nThings like bench, vending, radiators does not seem to affect the value.\nOn Rep: on average it would seem that TH does the following (year 1 then 2)\nCure       9        4\nDeath      ?       -23 (for now I assume the same in year 1)\nSent home -7       -18\nThis is based on the numbers for each year, some more testing needed to be sure. Also there were two VIP visits and I think that they also increase rep, don't they?\nCTH still gets more patients per year than TH (about a third more)\n. From edvin.li...@gmail.com on February 16, 2011 13:09:23\nProbably because you don't get 50 % of the patients all the time in TH. Maybe you could check that too in the progress report window? (it changes once per month)\n. From mark.l1...@hotmail.co.uk on February 27, 2011 11:12:35\nFor level 1 the percentages were from 1st Feb and then each month 33m, 25 ,30, 33, 46, 21, 22, 28, 36, 24, 16, 20, 16, 20 and 19.\nvisitors were 1, 2, 4, 7, 13, 19, 24, 28, 38, 45, 50, 56, 58,64 and 71.\nHospital value changed between 71315 - 73315 in increments of 1000.  The changes seem to be random and can change from day to day. I suspect that this may just be another bug in TH and perhaps the calculation is done on the fly and this is why it is sometime different.\nOn reputation, what is odd is that if patients get fed up and leave that there is no loss to reputation and they don't get counted as sent home in the case book.\nSo, (I don't think that this is in CTH yet) when you get a fax that says we are 65% sure this is a type of blah blah, what do you want to do: if you send him home it counts against you and if you make him wait he will at some point get fed up and leave and this does not count against you.\n. From leis...@gmail.com on July 12, 2011 08:07:57\nAre you trying to replicate the original? There is little doubt there is room for improvement here.\nIn the original, one cured patient gives about 26 rep, doesn't it? I always assumed it depends on how HAPPY the person is WHEN IT IS CURED. Or are they all fixed numbers? Where does the happiness of the patients come into play with reputation?\n. From mark.l1...@hotmail.co.uk on July 24, 2011 12:51:42\n@ comment 9\nIn level 3 of TH inflation is 50% and lot prices do not change from one year to the next.\n. From mark.l1...@hotmail.co.uk on October 08, 2012 12:01:23\nIssue 1093 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on March 07, 2011 08:24:31\nare you sure that the room was large enough for its placement?\nI had a similar issue when the shield was first implemented and then found that it was due to the room not being large enough. Making the room just one square bigger may be enough to allow for its placement as you have to also allow for movement around the console as well as access to the xray itself.\n. From Alberth2...@gmail.com on March 07, 2011 08:55:45\nYes I am sure.\nI have created a room almost as big as the entire hospital for testing. Also, the other part of the radiation shield (with the radiation on it, and the chair) coloured from grey to blue-ish metal colour.\nLast but not least, the program released the shield from my mouse cursor, which imho also indicates that the program believes it is positioned correctly.\n. From mark.l1...@hotmail.co.uk on March 07, 2011 10:59:40\nIt looks like there are two issues.\nI can confirm that the lua window does display the message about mulitple objects in tile blah blah.\nAlso the minimum room size of 6 x 6 is the same as TH, but in CTH it is not possible to build the room and place the default objects in a 6 x 6 room.  You need a room of at least 7 x 6 to place both objects.\nAttachment: screen.PNG\n. From cgja...@gmail.com on March 25, 2011 10:36:14\nYou can fit everything into an x-ray room in 6x6. But note the clipping errors through the wall.\nAttachment: xray.png\n. From Hugh.A.L...@gmail.com on January 11, 2012 13:20:15\nThere is something else going on here. It seems like the combination in Cgia's photo above is the only possible one. However all the positions below should be allowed in a 6x6 room as the console is 3x3 and the x-ray is mostly 3x3 with the exception of one tile which sticks out.\nAttachment: x-ray1.jpg x-ray2.jpg x-ray3.jpg x-ray4.jpg x-ray5.jpg\n. From mark.l1...@hotmail.co.uk on January 14, 2012 11:56:49\nI think you are right, it has something to do with the footprints.\nI have altered them in this patch, but I don't have the time to test it to see if it causes problems.  It was something I was look at a while back, but at the moment I have too much happening in my life and don't have the time to spare testing things.\nIf you want to do this it would help me no end.\nAttachment: xray.patch\n. From Grim...@gmail.com on January 15, 2012 06:03:46\nIssue 1122 has been merged into this issue.\n. From Hugh.A.L...@gmail.com on January 16, 2012 13:04:14\nSorry Mark, The patch is no good, can't even load a save or create a new game now.\n. From mark.l1...@hotmail.co.uk on January 16, 2012 23:19:14\nthanks for testing, we'll have to leave this one to the dev's to fix.\n. From mark.l1...@hotmail.co.uk on January 17, 2012 08:04:51\nJust thought, do you know how to reverse the patch?\nBasically copy these two lua files over what you have now from your latest downloaded copy\nradiation_shield.lua\nx_ray.lua \nif you look in the patch you will see which directories to copy them to.  Or just copy the whole lua file and it will replace the alertered files along with the others\n. From Hugh.A.L...@gmail.com on January 17, 2012 08:19:13\nI just downloaded the latest version from http://th.corsix.org/corsix-th-latest-win32.zip again.\nOn another note it might be a good idea to place a link to this on the downloads page, with an appropriate description, so people can download it if they want.\n. From maartenp...@hotmail.nl on January 19, 2013 10:36:12\nWill these bugs ever been fixed? :)\n. From Alberth2...@gmail.com on January 19, 2013 11:16:06\nIt seems fixed, or should other things get changed as well?\nAttachment: xray_solved.png xray_solved1.png\n. From maartenp...@hotmail.nl on January 19, 2013 11:18:50\nI still have the issues from comment four and five.\n. From mark.l1...@hotmail.co.uk on January 19, 2013 11:19:23\nThat is odd, because I have had some problems placing both in a larger room than that one!\nIt seems to me that the xray takes up more room in one direction than the other and also looks like sometimes you cannot place the console against the wall, but one tile out.\n. From maartenp...@hotmail.nl on January 19, 2013 11:30:23\nSorry, I mean only from comment 4!\n. From Alberth2...@gmail.com on January 19, 2013 11:56:58\n@15: Placement of the machine is critical, if you move it to another corner you'll have major troubles.\n@16: The clipping? That's technically a different issue (with a different solution), so either\n- a new one should be created (if it does not exist already) and this one should be closed, or\n- this issue should renamed to reflect it is now for a different problem.\n. From cgja...@gmail.com on April 01, 2011 13:00:13\nConfirmed, a simple case is to create a GP and staff room. If you delete the GP after the doctor gets off the couch and heads back to his office, it'll crash because of an empty action queue once he arrives at the space where the door used to be.\nStatus: Accepted\n. From cgja...@gmail.com on April 01, 2011 13:03:15\nRemove the room before the GP gets to it in the following save to reproduce.\nAttachment: removeroomcrash.sav\n. From edvin.li...@gmail.com on April 01, 2011 13:24:45\nThere is a function called \"deactivate\" which is called when a room is deleted in room.lua. It should (does not at the moment) reroute patients and any staff going there which haven't been specifically called.\n. From cgja...@gmail.com on April 02, 2011 13:36:16\nSo, we could solve this problem by getting the EntranceXY of the room and finding all humanoids walking to that co-ordinate and tell them to do something else. This could be computationally expensive in large hospitals but it wouldn't be called very often. But I'm not sure how you'd get the set of humanoids who are walking somewhere.\nThe root cause of the problem is that when people are sent to a room they are just instructed to walk to the tile inside the door. This doesn't tie them to the room at all so when deactivate is called they're not included. If instead, when humanoids are sent to a room they are instructed to use the door, then when deactivate is called all the humanoids with actions tied to the door will get rerouted.\nI'm not very familiar with the action code so I'm not sure how this should be implemented.\n. From edvin.li...@gmail.com on April 02, 2011 14:06:37\nThe thing is that this was working fairly well before. I had logic for exactly this kind of thing, with staff in a list called \"approaching_staff\". But it may have been removed around the time when the calls dispatcher was added or something, I don't know.\nThere was a period during the autumn when there was a new action system (not just tables, \"real\" classes) being worked on (lies as a branch) but it never got into trunk. That system would make such things possible. For patients there is the rerouteAllPatients function. I suggest that a callback/entry in a list is created in the createEnterAction function each time a humanoid calls that function. The room holds all these callbacks/list, and if something happens it can directly call them/traverse the list.\nThe upside of callbacks is that the programmer can decide what to do instead per humanoid (or at least class) without the room's concern. A list on the other hand won't need special persistance care and may be a little easier to implement. Both can be error prone though, one has to make sure the list is up to date at all times.\n. From Grim...@gmail.com on April 02, 2011 17:13:59\nI think this issue is related: https://code.google.com/p/corsix-th/issues/detail?id=690\n. From cgja...@gmail.com on August 10, 2011 00:34:02\nIssue 943 has been merged into this issue.\n. From cgja...@gmail.com on September 06, 2011 02:04:00\nStatus: Started\nOwner: cgja...@gmail.com\n. From cgja...@gmail.com on September 26, 2011 09:39:49\nOk so this is a trickier problem than I original supposed. I have something working but I need some input on what the proper behavior should be.\nLet's give the scenario of a doctors office, a patient, and a doctor. The office is empty, the patient knocks on the door and sits outside, the doctor begins walking towards the office. Then, the player edits the office. Now, what happens?\nIs the room queue emptied? Do the patients look for another room? Or do they wait for the room to be OK-ed and then knock again? Or is the queue kept as is?\nWhat should the doctor do? Do they wait for the edit OK/Delete to decide whether they go back to the room or do find something else to do?\nRight now, I have where editing a room will cause anyone heading to that room to do something else instead and pretend as though the room does not exist. The queue is kept as is but this means that a doctor will not head back to a room in which he was earlier called by a patient until the NEXT person knocks on the door, which is undesirable. \nI tried playing around with this in TH'97 and I found a few bugs, so that makes me feel a little better :)\n. From toasterb...@privatdemail.net on September 26, 2011 09:50:49\nI think staff and queue have to wait while the room is edited.\nOn confirming delete, staff is free to go elsewhere, queue too if a second same \nroom/clinic is available. If not, a fax should pop up, saying that room is missing\nand option: wait or sendhome (third I can not remember from orig. TH)\nSame problem is i.e.: In orig TH if you edit the research room, staff will go out and\nwait until edit is finished. In CTH researcher go out and maybe get called to \nsome work.\n. From mark.l1...@hotmail.co.uk on September 26, 2011 11:19:06\nOkay, I can check all this as I  can still use the original game.  I will answer each question in order.\nThe patients wait while you edit the room.\nThey don't knock again, as they have waited.\nIf he is needed elsewhere he goes there, if he is just wandering he will come back (this all depends on how many staff you have)\nI think the real problem is when you delete a room, if there is another the patients will go there.  If it was the only one, i.e. you buy a new plot and start to move things around the patients will either decide to go home or it throws an error.  What should happen is that they wait to see if you build it again, if others are sent to the room that has just gone you will get a fax as if it is the first time that room was needed.  If you don't build the replacement fast enough the patients will get fed and leave \"no more diagnosis\" etc\n. From toasterb...@privatdemail.net on September 27, 2011 00:13:05\n11\n\"If he is needed elsewhere he goes there, if he is just wandering he will come back (this all depends on how many staff you have)\"\nin my opinion this should only happen if the room is deleted. see research room comment. i.e. if you play large maps, have a number of researchers and your have to edit the room for adding computers aso, your researchers are most times called to\nanother room, and then you have to pick em up and replace them in the research room. not very comfortable. And, for other rooms, if a queue is kept until editing, a doctor/nurse IS needed after editing, so freeing them makes no sense.\nbtw, don't forget to handle the patients in \"expected queue\".\n. From mark.l1...@hotmail.co.uk on September 27, 2011 00:57:45\n@ 12\nI am only reporting what occurs in TH, I have made no opinions on whether this is good or bad, right or wrong.  So in TH if you edit the room the staff will go elsewhere if they are needed; this is a fact.  I may have had a different result if I had more staff, as this might have meant he was not needed elsewhere!\n. From cgja...@gmail.com on September 27, 2011 14:29:24\nThanks for the info guys. I'm going to implement it like the original TH but it should be possible to make special cases on a per-room basis. So it'd be possible to change the behavior for research rooms but that'll probably be a separate patch.\n. From cgja...@gmail.com on September 28, 2011 19:04:03\nThis is fixed in r1412 (hopefully).\nStatus: Fixed\n. From mark.l1...@hotmail.co.uk on January 01, 2014 11:56:44\nI think this issue has started to happen again.  Edited the only scanner room and the queue upped and left with the dynamic info saying \"no more diagnosis available\".\nIf I had been editing the room for sometime this is expected, but it happens straight away.\nVersion 0.30\nStatus: Queued\n. From mark.l1...@hotmail.co.uk on January 05, 2014 11:11:45\nThis issue seems to only affect diagnosis rooms, with treatment rooms if you edit you do get the fax pop up and as soon as you have finished the edit the fax message goes again. \nPerhaps the fix here was never applied to diagnosis rooms?\n. From mark.l1...@hotmail.co.uk on January 23, 2014 12:26:20\njust edited the xray and that had a patient waiting, he however did wait and the usual fax popped up.  So perhaps it is handled correctly here too?\n. From mark.l1...@hotmail.co.uk on April 12, 2011 12:11:08\nThis issues seems to have been reported nine times, did you have some issues when creating it?\n. From edvin.li...@gmail.com on April 13, 2011 00:23:54\nIssue 821 has been merged into this issue.\n. From JoaoCMBa...@gmail.com on April 13, 2011 20:04:02\nGoogle code error 500 every time i tried to submit, sorry, system fault i guess. :S i didn't see anything about the problem i faced in first page, since it was new, and i made this one.\noh and sorry about my interpretation on your comment mark, as you see i really did had issues with it!\nTake care, regards and good work.\n. From mark.l1...@hotmail.co.uk on September 22, 2011 07:40:14\nAccepted:  (sorry, but I have only just seen your last comment)\nIt has happened to me several times, which is why I asked.  Can be annoying, especially if you have typed a lot and it does not save or as with you, you can't see it and do it again, only to find it is now there more than once\n. From maartenp...@hotmail.nl on November 17, 2012 01:55:36\nI have this too with the latest Rc vesion ( http://th.corsix.org/lego3/ ) No music and only sound effects. And I'm using the i386 stable package. Does other users have this still too with this new version?\n. From maartenp...@hotmail.nl on November 17, 2012 03:38:47\nCan somebody test this with the released version 0.11 ( https://code.google.com/p/corsix-th/downloads/list)\n. From maartenp...@hotmail.nl on February 05, 2013 23:42:57\nThis is the good link: https://code.google.com/p/corsix-th/downloads/list .\n. From maartenp...@hotmail.nl on March 22, 2013 15:25:21\nThis bug still occurs with the RC of version 0.20!\n. From maartenp...@hotmail.nl on March 23, 2013 12:30:12\nUsing Ubuntu 12.04.\n. From maartenp...@hotmail.nl on April 01, 2013 07:07:39\nSummary: No music on Ubuntu (12.04)   (was: Sound issues on amd64 deb ubuntu 10.10) \nStatus: Accepted\nLabels: Milestone-0.30\n. From maartenp...@hotmail.nl on April 01, 2013 07:09:30\nLabels: OpSys-Linux\n. From leis...@gmail.com on April 02, 2013 16:40:22\nIf I remember this one correctly, it had to do with the names of the soundfiles? (Linux is Case sensitive, Windows is not)\n. From maartenp...@hotmail.nl on April 02, 2013 22:09:36\nThen I think this issue could be resolved easily?\n\nDate: Tue, 2 Apr 2013 23:40:32 +0000\n. From maartenp...@hotmail.nl on April 03, 2013 07:19:07\n\nThen we should change all the names of sound files at audio.lua to something with only capital letters?\n. From maartenp...@hotmail.nl on April 03, 2013 07:20:23\nAnd at all other files, which are reffering to a sound?\n. From maartenp...@hotmail.nl on April 03, 2013 09:24:20\nHere is a patch that should fix this issue when the capital letters are the cause.\nAttachment: Capital.patch\n. From maartenp...@hotmail.nl on April 03, 2013 10:23:30\nBut where can I find the installation directory of CorsixTH in Ubuntu?\n From: maartenpeters@hotmail.nl\nTo: corsix-th@googlecode.com\nSubject: RE: Issue 826 in corsix-th: No music on Ubuntu (12.04)\nDate: Wed, 3 Apr 2013 07:09:19 +0200\nThen I think this issue could be resolved easily?\n. From maartenp...@hotmail.nl on April 03, 2013 10:34:02\nI know that I can find the executable at usr/games, but where can I find the files?\n From: maartenpeters@hotmail.nl\nTo: corsix-th@googlecode.com\nSubject: RE: Issue 826 in corsix-th: No music on Ubuntu (12.04)\nDate: Wed, 3 Apr 2013 19:23:16 +0200\nBut where can I find the installation directory of CorsixTH in Ubuntu?\nFrom: maartenpeters@hotmail.nl\nTo: corsix-th@googlecode.com\nSubject: RE: Issue 826 in corsix-th: No music on Ubuntu (12.04)\nDate: Wed, 3 Apr 2013 07:09:19 +0200\nThen I think this issue could be resolved easily?\n. From maartenp...@hotmail.nl on April 08, 2013 11:35:09\nWhen someone gives me the location of the installation directory I can test this patch. Or someone else should test this patch.\nStatus: Started\n. From maartenp...@hotmail.nl on April 13, 2013 13:50:14\nSummary: No music on Ubuntu (12.04) - patch attached, testing needed   (was: No music on Ubuntu (12.04)) \nLabels: -Priority-Medium Priority-High\n. From edvin.li...@gmail.com on July 04, 2013 07:41:26\nTo my knowledge we have already abstracted away from such an issue, but it could be that it doesn't work correctly.\nDo you also get \"there is no soundcard\" just before \"could not load music file 'Sound/Midi/MEND.XMI\" Maarten?\nI'll check where it's put when I get home, and also try my Ubuntu VM.\nYou could also do a search like this since I presume your VM system isn't that big?\n\n\nfind / -name app.lua\n. From maartenp...@hotmail.nl on July 08, 2013 04:33:59\n\n\nI can't find the location of CorsixTH in that way, but I will try it tonight on an other computer.\n. From maartenp...@hotmail.nl on July 14, 2013 06:15:19\nI can also reproduce this bug on Ubuntu 13.04.\nSummary: No music on Ubuntu - patch attached, testing needed   (was: No music on Ubuntu (12.04) - patch attached, testing needed) \n. From maartenp...@hotmail.nl on July 14, 2013 06:28:33\nOk, now I've found the location of the files: Usr/Share/Games/CorsixTH. I've extracted the debian package of version 0.20 and so found the location.\n. From maartenp...@hotmail.nl on July 14, 2013 08:07:11\nBut I strangely can't replace the audio.lua with the patched one. Just the paste option is not available. When I look at the properties, it sais that I'm not the owner! Does someone know how to replace this file?\n. From maartenp...@hotmail.nl on July 14, 2013 08:25:44\nI've finally been able to replace the file on Ubuntu 12.04, but it doesn't seem to fix the issue.\n. From maartenp...@hotmail.nl on July 14, 2013 08:34:09\nBut how can I find the Lua console in Ubuntu or gamelog.txt?\n. From Alberth2...@gmail.com on July 14, 2013 08:43:15\nUbuntu uses uppercase letters in its directories??? yuck.\nAnyway, /usr/share is a directory for system-wide installs. Software there is installed for all users (even if there is only one user currently :) )\nObviously, such software should not be modified by a single user, as then other users cannot rely on it any more.\nThe hacky solution is to become root, and modify the files. However, it is often useful to have a copy that you know is not modified.\nSo instead, I recommend doing a user install as in https://code.google.com/p/corsix-th/wiki/GettingStarted , and if not doing 1 in step 3, you'll also need https://code.google.com/p/corsix-th/wiki/HowToCompile .\n. From maartenp...@hotmail.nl on August 07, 2013 07:29:49\nWill look at this again in a few days.\n. From maartenp...@hotmail.nl on August 07, 2013 08:05:35\nOk, here is a new patch!\nChanges:\n*All ''.dat's'' are now also capital.\nBut I think this is maybe not an error in CorsixTH, but of TH itself:\nAt HOSP\\SOUND\\MIDI you can find the file MIDI.TXT. The file contains this text:\natlantis.xmi\nAtlantis\nsixseven.xmi\n6's and 7's\nfortune.xmi\nFortune\ncandy.xmi\nCandyfloss\nmend.xmi\nOn the Mend\ndoctor.xmi\nDoctor Frog\nnightsh.xmi\nNight Shift\nsteady.xmi\nSteady Pulse\nShouldn't all these names in capital letters? I think that CorsixTH looks at these XMI-files as they are standing in MIDI.TXT and then he can't find the files.\nBut I will look at this furture today.\n. From maartenp...@hotmail.nl on August 07, 2013 08:06:07\nSorry, forgot the patch :)\nAttachment: Capital_fix_2.patch\n. From maartenp...@hotmail.nl on August 07, 2013 08:19:55\nBut if the man at the beginning of this issue is right and that this issue on Ubuntu begun when beta 6 was released, then there is something strange: there where no changes to the audio.lua file between beta 5 (2010-12-24) and beta 6 (2011-03-24): https://code.google.com/p/corsix-th/source/list?path=/trunk/CorsixTH/Lua/audio.lua&start=2055 I will look if beta 5 indeed works tonight.\n. From maartenp...@hotmail.nl on August 07, 2013 10:07:09\nI still can't find the path to the gamelog! I also can't find them with this information: https://groups.google.com/forum/#!topic/corsix-th-dev/sTpiE8G08o4 . Without this path, I probably can't solve the problem.\nI've also found out that changing the file names at MIDI.txt doesn't solve the problem.\n. From edvin.li...@gmail.com on August 12, 2013 13:53:13\nThis does appear to be an issue with the Linux release packages. Music worked very well when I compiled myself. We are looking for a new packager anyway...\nSummary: No music on Ubuntu   (was: No music on Ubuntu - patch attached, testing needed) \nLabels: -Priority-High Priority-Medium\n. From SyntheticDolphin@gmail.com on April 14, 2011 02:27:31\nThe . files are inevitable, it keeps track of how you arranged within the Finder window. What is the error given?\n. From catapult...@gmail.com on April 14, 2011 03:58:14\nMusic can not be played. Cant you ignore them in the application?\n. From SyntheticDolphin@gmail.com on April 14, 2011 06:23:27\nIt depends on the exact error, it is likely that the lua could be told to ignore those files.\n. From catapult...@gmail.com on April 14, 2011 13:56:30\nHello.\nError message (or technically speaking)\nAn error has occured in CorsixTH\n./Lua/audio.lua:400 bad argument #1 to 'loadMusicAsync' (String expected got nil)\n[C] in function loadMusicAsync\n./Lua/audio.lua:400 in function playBackgroundTrack\n292: in function playRandomBackgroundTrack\n167: in function init\n./Lua/app.lua.189 in function init\n./CorsixTH.lua:119  in function main chunk\n[C]?\nCrash occurs when first starting the engine randomly if it picks the wrong track.\nCrash does not occur ingame however if ._ files are attempted to be played the jukebox window will not be able to be closed and no other songs will be able to select (no error)\nCheers!\n. From cgja...@gmail.com on May 04, 2011 14:11:23\nStatus: Accepted\n. From edvin.li...@gmail.com on November 06, 2011 01:53:04\nI don't have a Mac myself, what are the offending files named? Is it exactly \".\"? What I can see it only reads files ending with \".mp3\", \".xmi\" or \".txt\".\n. _From edvin.li...@gmail.com on November 06, 2011 01:53:12\nStatus: Input\n. From SyntheticDolphin@gmail.com on November 06, 2011 06:44:59\n.DS_Store and .gitignore are files, .svn is a folder.\n. From edvin.li...@gmail.com on November 06, 2011 12:21:15\nDoes it only happen if you have specified your own music folder?\n. From SyntheticDolphin@gmail.com on November 06, 2011 15:25:01\nYes, and the error isn't going into the gamelog.txt file like normal.\nError in audio.lua:48 cannot open (mp3 dir) No such file or directory\nI used ~ (home folder) as the start of the mp3 directory, does it expect something else? Does ~ work on linux?\n. From maartenp...@hotmail.nl on July 04, 2013 11:56:50\nDoes this still occur after two years with version 0.21?\n. From maartenp...@hotmail.nl on August 12, 2013 10:42:23\nNothing heard from anyone in a month. Maybe this is fixed in a recent version of CorsixTH/Mac, but when not, I will re-open this issue.\nStatus: WontFix\n. From catapult...@gmail.com on October 17, 2013 18:00:10\nSorry for the late response guys, its still happening :)\n. From SyntheticDolphin@gmail.com on June 27, 2011 13:09:14\nYou're meant to be able to send patients to queue for a room that is built but otherwise not ready. Is the casebook clear that you only have to employ people, or does it suggest/look like you have to do some research as well?\n. From mark.l1...@hotmail.co.uk on June 28, 2011 02:22:16\nThis was meant as a suggestion to improve the gameplay, especially for new players.\n. From mark.l1...@hotmail.co.uk on June 28, 2011 11:29:09\nI have tested this out in TH and if you build the pharmacy and don't hire a nurse, each time you get a patient that needs the pharmacy you receive the following fax.\nYour team has discovered a new condition.\nIt is Uncommon cold\nEmploy a Nurse to be able to handle this situation.\nWhat do you want to do with the patient?\nSend home\nGet patient to wait in the hospital for a while\n(shaded out) send to research department\nNow you get this fax for each patient, even if you have already had one for the same illness.  Research is shaded out as it is not available on this level.\nI am sure that you receive a similar fax for surgical illnesses with one of two variants i.e. employ a surgeon or employ two surgeons.\nThis does not happen in CTH, once you have built the room the patients are sent their, even though you cannot cure them yet.  This is why I think there needs to be the same sanity check as there is in the casebook so that in such circumstances you are reminded by the fax that you still need to hire somebody.\nI know how to play the game, but there will always be people that skip the tutorial and don't realise the reason someone died was down to not having the right member of staff.  It will also help those that did say hire a nurse who has since left because she was not given a pay rise.\n. From fr...@scriptzone.nl on June 07, 2012 14:50:09\nConfirmed. Also applies to non-skilled doctors.\nAlso, if a patient is being sent to the Operating Theater, there is an announcement \"two surgeons required\".\nPatient knocks on the door, and queues forever, as no surgeon(s) have been hired.\n. From edvin.li...@gmail.com on March 08, 2012 07:26:43\nIndeed, that would be a good feature to have. Nowadays there are at least one autosave for each month, so it shouldn't be that sensitive anymore.\nStatus: Future\nLabels: -Priority-Medium Priority-Low\n. From Grim...@gmail.com on July 26, 2011 13:52:31\nHere is another related problem when following the three steps in first post:\nThe word x-ray is in English, and the rest is in Norwegian.\nJust for info: The Norwegian translation is \"r\u00f8ntgen\", so the English word is certainly sticking in there.\nAttachment: norwegianenglish.png\n. From Grim...@gmail.com on September 03, 2011 03:01:05\nAddition: This \"language mix-up\" is fixed after restarting the game. \nBut changing language in the game can mix up the language for that specific session.\n. From Grim...@gmail.com on March 29, 2012 06:33:07\nDuplicate: issue #1185 (should be added here automatically, but a bug stopped it from being added).\nThis issue is not only for norwegian-english, but also for other languages.\nStatus: Accepted\n. From Grim...@gmail.com on March 12, 2013 14:15:20\nLabels: -Priority-Medium Priority-Low\n. From Grim...@gmail.com on August 17, 2013 06:34:28\nClosing this, since implementing the patch in issue #1657 will eliminate this problem (since you can't change language in-game).\nStatus: Fixed\n. From maartenp...@hotmail.nl on August 17, 2013 07:24:48\nThis bug still occurs when you change the language at the main menu before you start a savegame with an other language.\nSummary: Mixed languages when changing languages before starting save   (was: Weird language problem) \nStatus: Accepted\n. From mark.l1...@hotmail.co.uk on August 17, 2013 09:01:04\nAre you sure?\nI have changed my language to French and loaded a save and everything is in French!\nStatus: Investigating\n. From maartenp...@hotmail.nl on August 17, 2013 09:58:38\nYes, for example:\n-Let a few patients wait for a room.\n-Save the game.\n-Change the language.\n-Load the game again.\n-Set your cursor at one of the waiting patients.\n-Look at discription (like: patient is waiting for spreekkamer.)\n. From mark.l1...@hotmail.co.uk on August 17, 2013 10:15:39\nOkay I had some with \"on my way to\" in English.  Look at comment 2, perhaps the solution is for the game to restart like it does with font?\nAlso noticed that I could not save a game, which seems odd as I had several attempts and not one of them was there when it came to reload back in English.\nStatus: Accepted\n. From maartenp...@hotmail.nl on August 17, 2013 10:24:13\nFirstly: I don't know what you mean with this: ''Also noticed that I could not save a game, which seems odd as I had several attempts and not one of them was there when it came to reload back in English.'' Could you explain it?\nAs I saw, you don't have to do anything to resolve this, just wait and when every discription of patients are changed, the bug is gone. I could be wrong and will test this better tonight.\n. From mark.l1...@hotmail.co.uk on August 17, 2013 11:03:15\nWith regards to your question:  I could not save means just that - I was not able to create a save when I changed my language to French, this seems odd to me.  I wanted to see what the reverse was i.e. save a game with French text to see if it changes back to English\nAnyway that aside it seems to me that the dynamic_info does not get updated when you change a language.  It does though as the patient continues around the hospital.  Explains what you have seen when the game runs for a while Maarten.\nIf that is the case perhaps it needs a global refresh adding in somewhere.  Maybe the game could detect a language change on loading of the save and do a refresh - what do you think Edvin?\nStatus: Queued\nCc: edvin.li...@gmail.com\n. From maartenp...@hotmail.nl on August 17, 2013 11:06:43\nCould you make a new issue of this?\n. From mark.l1...@hotmail.co.uk on August 19, 2013 11:12:54\nNo I won't make a new issue.\nI can now see that the reason the save would not save was because the button is back. In French I did not know what it was and had forgotten that you hit the enter key to save the game.\nSo no issue other than the original one, which is the text is being saved in a table in the correct language. (for the dynamic info bar)\nWhen you change languages the text in this table is not updated.  It does though become updated as the game progresses and as it does it is then in the new language.\nThe text everywhere else in the game seems to be in the correct language or did I miss something?\nSummary: Mixed languages in the dynamic info when changing languages before loading a save   (was: Mixed languages when changing languages before starting save) \n. From Alberth2...@gmail.com on July 24, 2011 11:55:36\nAfter reporting I noticed another weird thing here, the patient and the doctor seem to be in the same place.\nI uploaded a new picture. The glitch is still there, but if you compare the round picture in both windows (left doctor, right patient), you'll notice that they display the same position.\nAttachment: cardiogram-glitch2.png\n. From SyntheticDolphin@gmail.com on July 24, 2011 14:18:24\nFirst part is a common layering issue, thanks for finding that new combination (in my experience the cardio seems to do it less).\nSecond is to do with the animation as well, if you look at the operating theatre sometimes the emotions over the head don't lean in with the surgeons.\n. From mark.l1...@hotmail.co.uk on November 30, 2012 11:14:59\nThis is still happening and was not fixed with the changes for single tile objects )cardio through the wall).\nNot sure whether the second issue is a glitch as both are that close to each other anyway.\nStatus: Queued\n. From maartenp...@hotmail.nl on February 05, 2013 10:54:08\nI added this issue to issue #1494 (this is a list of all knows graphical glitches.)\n. From mark.l1...@hotmail.co.uk on July 27, 2011 05:10:06\nI have seen this too nand not just with handymen.  It may be fixed in the latest revision from yesterday as there were a couple of issues with Puke.\n. From mark.l1...@hotmail.co.uk on August 21, 2011 08:04:31\nstill see this with the latest version.  A patient will decide to go to the loo and will seem to skip some frames i.e. take a step forward, appear to be one step behind where they were and then for step three be back where they started.\n. From Grim...@gmail.com on November 10, 2011 16:22:40\nWith my save in first post, I can still replicate the teleportation.\nAnd if you follow the handyman for a minute or two, you see that he does this several times.\nIt looks like he teleports when:\nHe is done fixing something and is being called to fix something else - then he is teleported to the new room, and when he is done there, he gets teleported back to the previous place (where he teleported from).\nI don't know if this handyman or save is really bugged, but this is a very weird issue. \nHave anyone noticed similar things on new games?\nStatus: Accepted\n. From mark.l1...@hotmail.co.uk on November 11, 2011 01:11:08\nYes, it also happens with some patients.  Often when one wants the loo they seem to move towards it, appear back where they started and back to where they should be.  I think it can happen when they want the vending machine too, like you say it looks weird\n. From Grim...@gmail.com on August 05, 2012 02:09:38\nIt has been a long time since I saw someone teleporting now. Is it still happening?\n. From Grim...@gmail.com on March 12, 2013 14:20:59\nI tested my old save again, and the Handyman don't teleport anymore..\nI'll say this is solved then.\nStatus: Fixed\n. From mark.l1...@hotmail.co.uk on March 13, 2013 03:43:11\nI still see this happen (with patients mainly)\nStatus: Queued\n. From Grim...@gmail.com on March 13, 2013 08:23:00\nAha.. Hmm..\nBut the Handymen are fixed at least, I think.\nSummary: Patients are teleporting (handyman teleport probably fixed)   (was: Handyman is teleporting) \n. From Grim...@gmail.com on March 13, 2013 08:31:00\nLabels: Milestone-0.30\n. From mde.0...@gmail.com on March 29, 2013 07:57:01\nI had a handyman teleport to fix the x-ray when I clicked the summon button yesterday using v0.20 with the full game on XP 32bit using CorsixTH_SDL. So no, it's not fixed.\n. From Grim...@gmail.com on March 29, 2013 11:54:37\nOkay.\nDo you have an autosave from right before that happening?\n. From mde.0...@gmail.com on March 30, 2013 08:01:29\nPresumably not if the autosaves overwrite, but I'll look out for it happening again. I've only seen it occur once but then I've only been playing for a few days.\nI have to ask where the autosaves are located since I can't seem to find them. The only thing in the SAVES folder is HISCORE.DAT, which I'm pretty sure is not what I'm looking for.\n. From mde.0...@gmail.com on March 30, 2013 11:36:42\nOkay, found them. Using the save file attached, just click on 'Page handyman' for the X-ray machine and he'll suddenly appear.\nOh, and hello, I'm new here!\nAttachment: TelepHM.sav\n. From Grim...@gmail.com on August 06, 2013 13:53:45\nSorry for the late reply, and thanks for the save!\nI can replicate this.\nAnd welcome! :)\n. From mark.l1...@hotmail.co.uk on July 28, 2011 08:10:10\nSorry, but I think that this is so funny, it sort of solves the issue of not being able to reach a plant........\n:)\n. From Grim...@gmail.com on December 29, 2011 15:22:11\nLabels: -Priority-Medium Priority-Low\n. From mark.l1...@hotmail.co.uk on January 22, 2014 12:04:18\nnot exactly the same thing, but I have noticed that if you are building a room next to another one and someone is in the way, that they can walk out of the blue print and through the solid wall of the adjacent room.  It was an handyman too, so perhaps they have some special powers :)\n. From Grim...@gmail.com on January 23, 2014 08:33:57\nHm. Very weird.\nAttachment: clarkkent.png\n. From Grim...@gmail.com on March 23, 2012 15:44:52\nIssue 1179 has been merged into this issue.\n. From nicktheg...@yahoo.com on March 24, 2012 05:03:32\nAttached a save game.\nAttachment: lvl52.sav\n. From mark.l1...@hotmail.co.uk on November 29, 2012 12:18:39\nI can confirm that this still happens with r1755 I was hoping that that the changes with single tile objects might have a knock on effect\nStatus: Queued\n. From maartenp...@hotmail.nl on February 05, 2013 10:55:00\nI added this issue to issue #1494 (this is a list of all knows graphical glitches.)\nThis bug also happens when you use transparant walls.\n. From cgja...@gmail.com on September 26, 2011 11:08:11\nHey Mark, this looks great. Good job finding all the extra animations, they really make the game feel more alive. \nI have a couple of minor qualms about the code. Could you rename the actions to be more consistent with what already exists (i.e. gets_up/get_up, shakes/shake, etc.).\nI think it might be a good idea to take the random out of Patient:falling() and use it whenever it's called instead so it can be different depending on how it's used. \nI think making queuing patients puke is good. I really like knocking patients down but I don't think it happens often enough! I love other games that do things like this like how you can annoy units in Warcraft by clicking on them a bunch of times or how the imps struggle when you pick them up in Dungeon Keeper.\n. From mark.l1...@hotmail.co.uk on September 26, 2011 12:32:04\nI am okay with renaming, I take it you want the s off the end?\nI get stuck when it comes to moving the random though.  Logic says that the next best place is where falling is being called, but it won't work for me from there and at this stage I  can't see why!\n. From mark.l1...@hotmail.co.uk on September 27, 2011 11:29:11\nIt is working after-all, I guess I should have allowed more time from spawning to testing it out (I assume the patient code is loaded at spawning, as it was not working at first)\nI have added more adviser messages, as falling will now occur more often as suggested. (I thought that if he says the same thing each time it will be less funny)\nAlso renamed some of the actions, I assume you wanted them making singular?\n. From cgja...@gmail.com on September 27, 2011 14:33:33\n\nAlso renamed some of the actions, I assume you wanted them making singular?\n\nYea, I know it seems nitpicky but keeping naming consistent is important. Thanks for making the changes.\n. From cgja...@gmail.com on September 27, 2011 16:40:10\nSo I play tested it. There seems to be a problem. I managed to get an empty action queue. Maybe it was by clicking on someone and causing them to fall as they were getting up. Just spam click someone and you'll see it happen. You've got to be really careful messing with the action queue to make sure that doesn't happen.\n. From mark.l1...@hotmail.co.uk on September 28, 2011 00:54:02\nI think I know what causes that error and the same could happen with pee and puke too.\nI have added current.name == \"queue\" to pee and puke function and forgot to do the same for when returning to the action.  Stupid thing is that I did have it in and for some reason took it out again.\nI will look at it when I get home.\n. From mark.l1...@hotmail.co.uk on September 28, 2011 11:38:18\nit wasn't that - shame, sob, sob - so any thoughts on what it could be?\n. From mark.l1...@hotmail.co.uk on September 28, 2011 12:38:00\nI did some more testing and the empty action queue happens for me when you catch the patient before he or she has been to reception or when they are made to fall too often.  Queue also seems to have an impact, so I have removed queue from pee or puke function for now, also added a new variable for being booked in and once a patient has fallen it will take a day to reset.  With these changes you can't make a patient fall until they have been through reception or twice in the same day. I now don't get an empty action queue error.\nI have also removed some of the randomness from the diagnosis process - which was a part of another issue.\n. From mark.l1...@hotmail.co.uk on October 09, 2011 12:32:48\nupdated the patch to the lastest revision\n. From Grim...@gmail.com on October 09, 2011 15:16:25\nPatched this upon r1420 without problems.\nI get several errors when trying to run the game with that patch.\nSee attached file.\nAttachment: error.txt\n. From mark.l1...@hotmail.co.uk on October 10, 2011 00:52:57\nOdd, I'll look into this tonight\n. From mark.l1...@hotmail.co.uk on October 10, 2011 10:59:13\nsorted, one of the other patches had written to the same file as this one, so it clashed.\n. From Grim...@gmail.com on October 10, 2011 11:37:24\nI'm sorry, but I still get similar errors.\nThis time patched upon r1423 .\nAttachment: error.txt\n. From mark.l1...@hotmail.co.uk on October 10, 2011 12:42:00\nI wasn't getting the error, then I  used the patch on a clean install and wham.\nit was all down to a missing coma!\n. From Grim...@gmail.com on October 10, 2011 15:06:12\nNow it works! :)\nBut with this I am experiencing a new error.\nIs this related?\nError in timer handler: \nC:\\Games\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:94: Proper idle not in action_queue\nstack traceback:\n    [C]: in function 'error'\n    C:\\Games\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:94: in function 'action_queue_find_idle'\n    C:\\Games\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:185: in function 'onChangeQueuePosition'\n    C:\\Games\\CorsixTH\\Lua\\queue.lua:194: in function 'pop'\n    C:\\Games\\CorsixTH\\Lua\\objects\\reception_desk.lua:101: in function 'tick'\n    C:\\Games\\CorsixTH\\Lua\\world.lua:811: in function 'onTick'\n    C:\\Games\\CorsixTH\\Lua\\app.lua:674: in function 'dispatch'\n    C:\\Games\\CorsixTH\\Lua\\app.lua:579: in function \n. From mark.l1...@hotmail.co.uk on October 11, 2011 03:32:58\nYou had better not add it then.\nWhat were you doing when the error happened?\n. From Grim...@gmail.com on October 11, 2011 06:39:17\nI didn't add this patch to the repo.\nIt happened when a patient left the GP's (in the door).\n. From mark.l1...@hotmail.co.uk on October 11, 2011 07:39:33\nIt doesn't sound related, but if you have the save from before the error, can you try to run it in an unpatched version to see if you get the same error?\n. From Grim...@gmail.com on October 11, 2011 09:26:15\nI ran a test with a clean version ( r1424 ), and I got no errors after 6 years!\nI also tested your patch again. \nGot the error within 1 game year.\nUploaded the save game (wait for a few patient visits before it happens).\nAttachment: errorsave.sav\n. From mark.l1...@hotmail.co.uk on October 11, 2011 11:37:47\ninitially I was getting errors, but when I slowed the game down, dealt with all the faxes it ran fine. The only error I got then was trying to re-enable the adviser, but that could be down to the different language as I never saw that error before when I tested the disable adviser or disable information.  Are A and I in a different place on your keyboard or are all keyboards the same? For me A is on left next to caps lock and I is between u and o on top row.\noh and I have tested your save on patched and unpatched copies of TH.\n. From Grim...@gmail.com on October 11, 2011 13:07:16\nOk, so you think the error comes from too much faxes and speed?\nMy keyboard is just like what you describe (a QWERTY-keyboard).\n. From mark.l1...@hotmail.co.uk on October 12, 2011 00:53:06\nI think the error might come from the build up of faxes, there is perhaps a limit to  how many can queue.  Odd with the adviser and information as I did not turn them off and could not turn them on - perhaps it does remember on saving, but then why can't I switch them on in your save?\nHopefully the devs will have the answer.\n. From Grim...@gmail.com on October 15, 2011 05:10:28\nBut don't you think it's weird that with you patch, it took under a year to get the error, and without it it didn't happen at all (for as long as I tested, 6 years).\nYes, it would be nice if a dev could say his mind on this :)\n. From mark.l1...@hotmail.co.uk on October 15, 2011 05:59:40\nI think your error was connected to one of the patients with a pending faz.  When I tested your save I did it with both the patched and unpatched game and got the error.  As soon as I opened any of the faxes I got the error. The only way I could continue without an error was to pause the save straight away, kick out all the patients with a pending fax then play from then.\n. From Grim...@gmail.com on October 15, 2011 07:15:10\nCouldn't the error already been \"loaded\" into the save when you test it on both versions (with and without patch)?\nI didn't think you could cross-test unrestricted on the same save across versions.\nBut maybe I'm wrong.\n. From mark.l1...@hotmail.co.uk on November 24, 2011 05:02:04\nIt could just be that your save was bugged.\nHave you tested this with a different save, I still don't get any errors when I run it, only with your save.\n. From mark.l1...@hotmail.co.uk on November 24, 2011 11:19:09\nRe: I didn't think you could cross-test unrestricted on the same save across\nversions. \nIt depends on what the change is.  Something like this patch is only activated when you do something i.e. click on patient calls a function. So, unless I click on a patient, save the game before the function is carried out and then load it in an unpatched version it can't cause a problem.  Reason is the action happens straight away or not at all.\nWhereas if there is a chain of functions and you break the chain, that is where you would get problems, because it could then as part of the chain want to call the next function that is not in the unpatched version.\nNow your error, if it is in the save, it is not likely my patch; unless you clicked on a patient and managed to save it before the patient could fall.\n. From Grim...@gmail.com on November 24, 2011 13:49:10\nOkay. We can always test this on a wider test panel (making a release).\nIs the animations_3.patch containing everything you want added?\n. From mark.l1...@hotmail.co.uk on November 25, 2011 02:19:34\nI'll bring it up to date with the latest revision and add it here later\nthanks\n. From mark.l1...@hotmail.co.uk on November 27, 2011 12:07:55\nI have updated the animations patch and there is a second patch that updates the messages that show when you place staff in the wrong rooms.  Note: as both patches update the staff.lua you may get svn warnings.  If you do, let me know which one you have added and I will update the  other patch and add it again.\nwhat is added: \nNew animations that mean some patients can fall over and some can shake there fist in anger when they have fallen (these are for when there are earth quakes in the game, but for now you may see them before then if you are lucky).\nSome patients might yawn if they are kept waiting.\nTweaked the diag process some more so that a consultant or other high skilled Dr can diagnose in one attempt.\nCorrected what I believe to be a small spelling mistake in the build dialog from \"payed\" to \"paid\".\nChanged the room name to the longer string for all rooms for the messages that show when you place staff in the wrong rooms (the adviser message should now make more sense), also now a message if you place a Dr or Nurse in the toilets.\nSmall change to the adviser messages about seating so that you are not told too often about needing benches.\nAttachment: animations_4.patch wrong_room_msg.patch\n. From Grim...@gmail.com on November 27, 2011 13:27:03\nAdded both in r1448 .\nShould this be closed or kept open?\n. From mark.l1...@hotmail.co.uk on November 28, 2011 01:31:36\nI think that you could close it now. \nThere are already open issues that relate to most of what was in these patches\n. From Grim...@gmail.com on November 28, 2011 05:16:08\nStatus: Fixed\n. From mark.l1...@hotmail.co.uk on October 25, 2012 12:54:18\nI think that I may have finally got this to work without it throwing errors if anyone wants to test it.\nideally during a quake the patient should stop on the ground for longer than they do at the moment, but that can be sorted at a later date\nSummary: Falling over animations\nStatus: New\nOwner: mark.l1...@hotmail.co.uk  \nAttachment: falling.patch\n. From maartenp...@hotmail.nl on October 26, 2012 11:23:57\nI was getting an error with the patched files (using the earthquake-cheat):\nCreated game with savegame version 54.\nSavegame version is 54 (Trunk)\nSavegame version is 54 (Trunk)\nError in timer handler: \n...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:71: Proper idle not in action_queue\nstack traceback:\n    [C]: in function 'error'\n    ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:71: in function 'action_queue_find_idle'\n    ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:96: in function 'action_queue_finish_standing'\n    ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:179: in function 'action_queue_on_change_position'\n    ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:297: in function 'after_use'\n    ...m Files\\CorsixTH\\Lua\\humanoid_actions\\use_object.lua:315: in function 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:165: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:954: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:734: in function \n    (tail call): ?\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:636: in function \n. From mark.l1...@hotmail.co.uk on October 26, 2012 12:35:32\ndo you have the save?\nI have tested this with the quake cheat and never saw that error\nthanks\n. From maartenp...@hotmail.nl on October 26, 2012 12:39:55\nYes, here is the save!\nAttachment: Nieuw awesome time.sav\n. From mark.l1...@hotmail.co.uk on October 26, 2012 12:52:26\nI am not getting any errors with your save either!\nDid you have any issues when you applied the patch?\nI am thinking that maybe not all the files got patched for you.\nIf you are using svn, look for the files with the red ! and delete them.\nthen update to get fresh files\nthen apply the patch again\nIf you have been adding patches on top of each other that are not yet added to the trunk you can get conflicts - especially if the same files are being patched by different people at the same time\n. From mark.l1...@hotmail.co.uk on October 26, 2012 13:00:22\nI have changed the patch slightly so that during an earthquake the patients don't fall over too often\nCould do with some help though\nHow can I make the patients stop on the ground for longer, instead of getting straight up?  I thought that perhaps they should stay down for the duration of the quake.\nAttachment: falling.patch\n. From mark.l1...@hotmail.co.uk on October 26, 2012 13:01:46\n@ maartenpeters did you read comment 40?\n. From maartenp...@hotmail.nl on October 26, 2012 13:49:28\nYes, you're right. I've updated the trunk again and applied the patch again: no errors! Sorry.\n. From maartenp...@hotmail.nl on October 26, 2012 13:57:58\nI think that I'm wrong, but I don't see any patients fall.\n. From mark.l1...@hotmail.co.uk on October 27, 2012 03:14:27\nif it is an old save you won't.\nrun the game for a while so that new patients arrive, I have not added any code to update existing patients with the new fields or you can start a new game\n. From maartenp...@hotmail.nl on October 27, 2012 04:26:06\nYou're right, I will start a new game tonight and test it again!\n. From maartenp...@hotmail.nl on October 27, 2012 08:18:40\nI still don't see people fall when I'm using the earthquake-cheat or am I stupid. How does ''fall over'' look like? Can you attach an image of it?\n. From maartenp...@hotmail.nl on October 27, 2012 11:17:28\nI still don't see patients fall over. So, a patient would fall if he's walking? And not if he's waiting for a treatment, a room or the reception?\n. From mark.l1...@hotmail.co.uk on October 27, 2012 11:26:33\nwalking, \nstanding around,\n. From mark.l1...@hotmail.co.uk on October 27, 2012 11:35:40\nOnly the normal looking patients will fall as there are not that many animations. So invisible, elvis or hairy ones won't fall.\n. From maartenp...@hotmail.nl on October 27, 2012 12:53:37\nI will look at this again tonight or tomorrow.\n. From maartenp...@hotmail.nl on October 29, 2012 12:04:56\nI'm still not seeing anybody fall, do you have a save with people who should fall when an error occurs. I've build a reception and a GP's office, but when they're walking between these rooms and a earthquake occurs, nobody falls! What the hell am I doing wrong!? :)\n. From maartenp...@hotmail.nl on October 29, 2012 12:10:48\nAnd I'm still getting sometimes an error and I'm using the latest patched revision:\nCreated game with savegame version 51.\nSavegame version changed from 51 (0.01) to 55 (Trunk).\nError in timer handler: \n...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:71: Proper idle not in action_queue\nstack traceback:\n    [C]: in function 'error'\n    ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:71: in function 'action_queue_find_idle'\n    ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:225: in function 'onChangeQueuePosition'\n    C:\\Program Files\\CorsixTH\\Lua\\queue.lua:194: in function 'pop'\n    ...rogram Files\\CorsixTH\\Lua\\objects\\reception_desk.lua:100: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:954: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:734: in function \n    (tail call): ?\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:636: in function \n. From maartenp...@hotmail.nl on January 20, 2013 01:49:44\nThe falling-patch does not work with the latest revision (missing hunks-errors.) Maybe you can update this patch and then we can maybe add it?\n. From maartenp...@hotmail.nl on May 05, 2013 12:33:37\nSummary: Falling over animations - Patch attached   (was: Falling over animations) \nStatus: Started\nLabels: Milestone-0.30\n. From maartenp...@hotmail.nl on August 04, 2013 10:13:28\nI think somebody should update this patch to the latest revision and then we could add it to the trunk for more testing I think.\n. From mark.l1...@hotmail.co.uk on August 04, 2013 10:20:34\nIt will be added as part of the adding a tremor to the earthquake at some \npoint in the future\n. From Grim...@gmail.com on August 17, 2013 06:55:24\nSummary: Falling over animations   (was: Falling over animations - Patch attached) \nLabels: -Type-Enhancement Type-Patch\n. From Grim...@gmail.com on May 23, 2012 15:06:33\nIs this bug present in the new version?\nStatus: Input\n. From maartenp...@hotmail.nl on October 13, 2012 09:05:57\nYes, I get this error message too in r1662 when I want to change the resolution in ''DirecX-mode''!\n. From edvin.li...@gmail.com on November 01, 2012 07:36:03\nFor the interested: The error is \"Could not create device\" emanating from line 246 in file th_gfx_dx9.cpp.\nHence a C++ coder with some knowledge in DirectX is required here.\nStatus: Queued\n. From roujin.mw on January 21, 2013 04:52:00\nLabels: Renderer-DirectX\n. From SyntheticDolphin@gmail.com on October 26, 2011 04:40:08\nMp3 or Midi?\nSnow Leopard or Lion?\n. From sgr...@gmail.com on October 29, 2011 14:31:14\nMidi (copied from my own install of theme hospital on windows)\nSnow leopard, 2008 iMac\n. From jatonb...@gmail.com on May 12, 2012 14:33:12\nI'm not sure if my issue is the same, but its kinda similar.\nMy issue is i can have music playing in the game but after a while, maybe 10-15 minutes into playing, the music will stop/refuse to play. If i open the Jukebox it appears to be going through the list of songs very fast as if it can't locate the music files anymore and just keeps skipping through the list. I have to turn off the music option cause it causes a lag if it's allowed to continue going through the list. I'm also running a Mac (Macbook Pro, early 2011, 10.7.3 (recently updated to 10.7.4. same issue occurs). I'm running the 0.0.1b of CorsixTH and the full version of Theme Hospital.\n. From Grim...@gmail.com on May 12, 2012 16:34:35\nAre you running the game from the harddisk (moved the HOSP folder to your disk), or do you run the game from a CD or an emulated CD?\n. From jatonb...@gmail.com on May 12, 2012 16:38:12\ni'm running it on the harddisk (I copied the files from the cd to a folder on the hard drive)\n. From Grim...@gmail.com on May 13, 2012 02:40:19\nOk. Then I don't know. \nI thought it could have been something with the loading of the music files. \nBut since they are on the harddisk, then that is unlikely I guess.\n. From Grim...@gmail.com on August 06, 2013 15:41:13\nDoes this still happen?\nStatus: Input\n. From mark.l1...@hotmail.co.uk on March 28, 2012 12:40:54\nThat is because that part of the object was set to being passible, when perhaps they should walk round the machine.\nAttached patch should resolve this issue.\nNote: that you do need to rebuild the room for the patch to take effect or edit back to the blue print/place door stage at least.\n. From Grim...@gmail.com on March 28, 2012 13:10:39\nYes it works like intended!\nBut I encountered something different with this machine:\nPlace a plant (or other item) like I have shown in the attached image.\nNow try to place an item in the corner above the machine.\nThis is not possible. Why does it reserve that spot?\n. From Grim...@gmail.com on March 28, 2012 13:12:25\nHere is the image..\nBy the way, you can't place it on the other spot above the machine either, so it reserves some space or something that it shouldn't?\nAttachment: cantplaceabove.png\n. From mark.l1...@hotmail.co.uk on March 28, 2012 15:33:35\nI can't re-produce that, can you attach your save?\n. From mark.l1...@hotmail.co.uk on March 29, 2012 00:41:33\nLooking at your picture you are blocking off a tile, which is why it won't let you place that plant, there is already one plant there, right?\nStatus: Started\nOwner: mark.l1...@hotmail.co.uk\n. From edvin.li...@gmail.com on March 29, 2012 03:40:06\nWe've had this discussion a few times before. TH lets humanoids walk on that tile, which is why it is like it is. I think it's more logical to be able to walk there since the machine doesn't take up much of the tile. You can't place the plant there since handymen wouldn't be able to access it.\n. From mark.l1...@hotmail.co.uk on March 29, 2012 04:36:34\nIn which case the patient should appear in front of the machine and not the other way round.\nSuggestion: this and the potion issue are very similar in that the animation layers are shown the wrong way round.  The patches for both offer a temporary soluction until a better one is found. \nShould I therefore add TODO comments against both, so that it is not forgotten about?\n. From edvin.li...@gmail.com on March 29, 2012 05:45:44\nThis one is more important than the pharmacy, but sure, it would be good to have in both places. An alternative is to accept the bug, keep it as it is, and keep the issue open until someone can fix it properly.\n. From mark.l1...@hotmail.co.uk on May 21, 2012 04:06:18\nStatus: Accepted\nOwner: ---\n. From Grim...@gmail.com on May 23, 2012 16:55:42\nWhat is the devs thoughts of this?\nI have no idea what is better.\n. From maartenp...@hotmail.nl on July 04, 2013 12:03:19\nNo developers are working on this at the moment and I think we should thirst fix the OpenGL version before working on a new engine. But could someone give an answer to Grimdocs question?\nStatus: Future\nLabels: -Priority-Medium Priority-Low\n. From James...@gmail.com on July 08, 2013 06:14:03\nIrrlicht is an abstraction layer and it would allow the developers to give the option to use different graphics APIs with one consistent interface, and the users would be able to switch between these graphics APIs without any more effort on part of the developer.\nIrrlicht supports; Software, OpenGL, Direct3D 8.1, Direct3D 9 and I think maybe Direct3D 10 in the latest bleeding edge versions.\nI haven't worked on this because I've been busy and didn't think anyone was interested.\n. From mark.l1...@hotmail.co.uk on July 08, 2013 07:24:21\nHi James\nI don't think it is the case of no interest, but rather it is that the main dev (Edvin) is in his final year at university and has since started work (so he has not had much time for the project recently). It would need to be either him or Corsix that can make a decision like this.\nYou should find in coming weeks you get some feedback and a decision.  If I understand what this is correctly it could replace the three exe's we have with one that works in all scenarios?  correct me if I got that wrong.\nCc: edvin.li...@gmail.com\n. From James...@gmail.com on July 08, 2013 12:11:57\nYes that is correct. I think in the patch (its been awhile) I have it hardcoded to Direct3D 8.1 but it could be easily changed to read a configuration value somewhere to change which engine Irrlicht initializes with at runtime but otherwise most of the heavy lifting has been done and I don't imagine the rendering core of CorsixTH has changed much since.\n. From static.o...@gmail.com on July 08, 2013 13:19:19\nSo far as I'm aware, the only major change to the renderers recently has been to do the graph drawing, and even then it's only line primitives. Perhaps the ffmpeg integration would need some work, but again it shouldn't be much as it appears to be fairly self-contained.\nI'd personally like to see this given some thought as it has the potential to make maintaining the renderers a whole lot easier - especially given that there's so few of us who actually have any sort of knowledge of that side of the codebase.\nMy question for James would be: why Irrlicht specifically? Have you considered any others like Ogre or OSG and how does Irrlicht compare?\n. From James...@gmail.com on July 08, 2013 17:11:55\nIrrlicht I'm most familiar with; it's a fairly small library that is well maintained, is gaining rapid popularity and several open source projects use it already.\nI suppose we could look at Ogre or OSG but most of the work for getting Irrlicht up and running is already done.\nOne area Irrlicht might have up against other libraries is that Irrlicht also includes two different software renderers (a slower more accurate renderer and a W-I-P but faster renderer).\nI'm not sure if OGRE or OSG has a software renderer but I don't recall ever hearing of such.\nObviously hardware acceleration is preferable but software rendering can be real handy for older hardware or certain platforms where there might be really bad, if any, hardware graphics (I'm looking at you Intel GMA).\n. From maartenp...@hotmail.nl on July 09, 2013 00:24:14\nBut are four rendering engines not a bit too much? The idea about this new engine sounds good, but it also makes development harder. Maybe we should descide (if we use the Irrlicht engine) to drop one other engine (like OpenGL, which is broken at the moment.)\n. From mark.l1...@hotmail.co.uk on July 09, 2013 03:46:25\n@8\nThere would not be four, just one - read the earlier comments.\nIt would be one exe where you could decide in the config which renderer it uses.\n. From maartenp...@hotmail.nl on July 09, 2013 04:08:48\nStatus: Started\n. From James...@gmail.com on July 09, 2013 06:26:12\n@8\nIrrlicht is an abstraction layer that handles all the dirty work in regard to the graphics rendering APIs it is sitting on top of; so if anything it would make development easier.\nRather then just jumping ship for Irrlicht all together we could enable it as another exe as an experimental implementation until we're comfortable it's stable.\nI'll probably need to get my dev environment set back up and bring it up to speed against the latest version though.\n. From static.o...@gmail.com on July 09, 2013 08:16:25\n@7 Cool. I know very little about any of these so I just threw some names out there for consideration. It sounds like irrlicht is as good as any and as you say, it has a capable software renderer which is key.\n. From maartenp...@hotmail.nl on August 04, 2013 13:28:37\nBut James, could you then maybe update the patch for the latest revision of the game and perfectionate it? And could you then upload a pre-compiled version of it? I think this really could make it into a release! Good job so far!\n. From maartenp...@hotmail.nl on August 08, 2013 00:34:24\nI really think we should implement the Irrlicht engine if someone could finisch it. Because then it might be possible to add zoom to the SDL-version (isssue 1577) and after this we can descide if we're going to use SDL(_mixer) 2.0. This could maybe also fix the graphical corruption at the OGL-version.\nSo, a question to all developers (and especially Edvin): should we implement Irrlicht or not?\n. From maartenp...@hotmail.nl on August 08, 2013 00:57:55\nBlocking: corsix-th:1577\n. From James...@gmail.com on August 08, 2013 07:03:24\nI've got it updated and sort-of-working with support for graphs and TrueType but it's not really cooperating with me; some renderers don't work properly or have glitches (however the OpenGL one works nearly perfect).\nOne of the glitches I'm seeing is a black bar on top of the window's client area.\nSo I'm thinking the fact that Irrlicht didn't create nor manages the SDL window is causing some strange low-level behavior but I can't be certain, however if I change the SDL window to be borderless the OpenGL renderer seems to work fine as expected.\nLong story short; I've updated the code but it's very glitchy, glitchier then I remember in fact.\n. From mark.l1...@hotmail.co.uk on August 10, 2013 12:47:28\nBlocking: -corsix-th:1577\n. Now using SDL2 for abstraction \n. From edvin.li...@gmail.com on February 18, 2012 01:35:04\nYour notes are available. Different drugs take different time periods to improve.\nThe loss conditions are meant to be in the game, but they may not work. I also think that it prioritizes win conditions, so if there are five winning conditions those will always be shown (possibly in red if appropriate), nothing else.\n. From mark.l1...@hotmail.co.uk on February 18, 2012 11:55:16\nI think it was hospital value and numbers cured that would become hidden so that deaths could be shown.  I don't think you can lose on value and if you are killing too many patients, then it is more appropriate to see the deaths warning rather than how many you have cured - at least until you are out of danger. \nOn the drugs, is CTH taking into account multiple rooms/researchers to increas the speed of research?  The speed on everything else seems about right, just a little slow on the drugs.  On level 10 it is almost impossible not to kill patients as drug strength is low, you get a lot more patients needing drugs, so if research is slow - even with multiple researchers and them devoting all their time to drugs you can't improve them fast enough to reduce the deaths.  You may as well not build the pharmacy in the first year or two, which is not what you did in TH.  I would concentrate research on the drugs, try to get a consultant researcher with another one, just to get strength of drugs to 90% or higher and was able to do so to avoid losing the level.\n. From mark.l1...@hotmail.co.uk on March 09, 2012 00:38:52\ndo you get an error message?\ncould there be some other process running on your computer that causes the game to stop i.e. the other process is taking up all the memory?\n. From Grim...@gmail.com on March 09, 2012 01:22:32\nPlease supply your config.txt, since this most probably contains the error text.\nYou can find it's location here: https://code.google.com/p/corsix-th/wiki/ConfigurationFile Especially big java programs are known for eating a lot of memory.\n. From mark.l1...@hotmail.co.uk on March 09, 2012 11:51:15\nSupply the gamelog.txt which sits next to config.txt as this is where the error will have been written.\n. From Grim...@gmail.com on March 09, 2012 15:28:35\nHaha, thanks for helping me out, Mark!\nI miswrote it all.. It should of course be gamelog.txt we want to look at, but you find this in the same folder as the config.txt :)\n. From plugnp...@gmail.com on March 10, 2012 14:17:07\nThere's only a warning, no error message and the gamelog is empty. The warning message in de CLI is \"Warning: Multiple objects on tile 68,33 - only one will be encoded\" but I'm not sure if that appeared when the screen froze.\nI've usually got no more than a browser (firefox) and a few explorers open and the usual resident processes (drivers with their applications, no antivirus). I've looked up the memory usage and it wasn't more than usual, about 200 MB's and on average 16% CPU load.\nOn an additional note, I've only had this happen when I played for more than an hour or so. Tonight I've closed the application every half hour and reloaded the savegame and there weren't any occurances.\n. From Grim...@gmail.com on March 10, 2012 15:33:39\nHm, okay.\nThe \"Multiple objects on tile\" line is not an error per se, so just ignore that.\nI guess you have a lot more memory than 200 MB in total, so that shouldn't be a problem either.\nI would understand it if there was a memory leak in the program or something, but then again it should use more than 200 MB before crashing.\nMaybe someone else has a better idea of what it is.\n. From Starbrit...@gmail.com on March 22, 2012 09:54:22\nI had something similar happen to me whilst playing for the first time yesterday. I was paused, so I couldn't tell whether the graphics as a whole continued, but the sounds kept going whereas the pointer was completely frozen. I was placing a bench at the time, and had been playing for a couple of hours. I had to force close the program in the end.\nI can't find the gamelog.txt file on my computer at all - the folder it's supposed to be in doesn't seem to exist, and it doesn't come up using Windows 7's search facility either. Sorry I can't be more help!\n. From twink%ga...@gtempaccount.com on March 25, 2012 17:48:06\nI have had this happen multiple times, mostly when i have been playing for a long time.\nThe screen is black but the sounds are going as normal. The game responds to \"P\" to pause & unpause.\nI am able to tab out (i play fullscreen) and there is never an error on the console. I have to force quit and use the latest autosave, where it does not happen again.\nSummary: Its related to time played, not specific ingame events.\n. From boltie on March 26, 2012 09:58:44\n@Comment 7\nYou most likely have your hidden folders hidden. You can change this by going to \"Organize\" in explorer (top right) and selecting \"Folders and search options\". Now select the \"View\" tab and then select the option \"Show hidden files, folders and drives\" and click \"Apply\".\nThe AppData folder contained with the root:\\Users\\\"Username\" folder is a hidden folder.\n. From boltie on March 26, 2012 10:04:50\nCorrection:- top left of explorer.\n. From Grim...@gmail.com on May 23, 2012 15:59:22\nIs this still happening with version 0.01? \nHave you found any other programs that could cause this to happen?\nStatus: Input\n. From lou.card...@gmail.com on May 31, 2012 16:14:14\nHi, just had this happen today, fresh install and been playing for several hours (yikes). Picked up a doctor and dropped him outside, the graphics have frozen but the game seems to be continuing to run (music, doors opening closing etc.) and \"p\" pauses and unpauses. Would be nice to save it before killing it :(\n. From mark.l1...@hotmail.co.uk on June 01, 2012 03:38:31\nif you check the saves folder you will see that there are monthly autosaves in another folder.  It won't fix this issue, but if you are lucky the last save might not repeat the problem.  (tip: don't pick up the Dr this time and see if it still freezes the game)\n. From franskla...@gmail.com on June 09, 2012 13:09:05\nHi,\nI'm seeing this kind of behavior as well, only for me the sound stops. gdb suggests there is still something running in the game. I could reproduce the behavior with the attached .sav on different platforms (Linux 32 bit x86 and Android).\nThe game freezes within a few seconds, as soon as the doctor in the hair restoration room approaches the door. I get no output to console or error log.\nHope this helps,\nFrans\nAttachment: Freeze.sav\n. From mark.l1...@hotmail.co.uk on June 11, 2012 12:57:18\n@14\nYes, the save does freeze, but for me it seems to be a windows error.  I also noticed that once it crashed for me I no longer had any sound on my PC.\nMaybe a dev can see the cause\n. From laurajco...@gmail.com on June 30, 2012 12:45:40\nI've just had this happen 3 times in the same place - had to force power off to get out. On Ubuntu 12.04. I haven't got the sound on so I don't know if that continues. The gamelog.txt file hasn't been updated today. I've attached my most recent autosave (which is where I restart from each time I've had to force power off).\nI originally thought it was when I accepted a fractured bones emergency but then did it again when I rejected the emergency. Each time, I'd just bought the bottom-right piece of land and built a GPs office, hired a GP, put out a load of benches, and loads of patients turn up to wait for the GPs office.\nAttachment: Autosave9.sav\n. From batchelo...@gmail.com on September 25, 2012 02:33:56\nI've just had this happen to me, v1.0. I was playing level 5 (Simpleton) on Normal difficulty. All I was doing was replacing the Inflator after and Earthquake hit\nAttachment: config.txt gamelog.txt\n. From casperva...@gmail.com on September 25, 2012 06:16:52\nI've just had this happen on the same level as comment 17 (lvl5: Simpleton). It seems like it happens at a very specific point: even after completely restarting the level, the same problem appeared on roughly the same moment (using the same strategies, I've reached the same point before the problem happened).\nThe save is about ten seconds (at max speed) before it hangs.\nAttachment: config.txt gamelog.txt V1.sav\n. From edvin.li...@gmail.com on September 25, 2012 07:31:43\nComment 17 and 18: It sounds like your games actually continue to play, just a \"normal\" error occurs, i.e. your mouse doesn't stop to respond?\nComment 17: Your error seems to emanate from a handyman. Did you fire one recently?\nComment 18: Your error appears to happen because the game couldn't find any sound to play. What platform are you on?\nCould you both please make separate issues for these since they are unrelated? That way we won't forget them.\n. From casperva...@gmail.com on September 26, 2012 01:02:58\nMissing sound has never led to problems, so it would be odd that it would now.\nHowever... earthquakes have been added recently, right? Do those have a separate sound file or anything? I'll try to get the sound to work, and if that fixes it, my issue is moot (and thus doesn't need to be added as a separate issue).\n. From Grim...@gmail.com on October 29, 2012 12:36:57\n@20: The earthquake sound problem should be fixed now I think.\n. From casperva...@gmail.com on October 29, 2012 12:53:22\n@21\nForgot to post my fix...\nPlacing the original TH files from the original cd (FOUND IT!!!), was indeed a fix. After checking, I found that several people get their TH from online sources, which do not always include sound in a form that CorsixTH likes. So, my specific bug was a rehash of an earlier bug, which led to something similar to a crash when combined with earthquakes.\nErgo; my bug was unrelated. However, people experiencing crashing and sound-related issues should try to get another version of Theme Hospital. The version which produced errors was around 6mb, whilst the version contained on the cd is more like 36mb.\n. From jpiri...@gmail.com on October 29, 2012 13:50:30\nI checksumed the datafiles that I downloaded from gog.com and the sound files were exactly the same if my gog.com compared with my disk image copy. Nevertheless there is definitely some difference in the files some players are downloading, though at least there is a fix in the trunk for that now.\nSome kind of warning should be sent to stdio (and possibly to the user) when we suppress a sound file because it doesn't exist. It's annoying really that we have to do that at all, but I guess there's not much we can do about it until we have our own data files...\n. From soundasleep on March 28, 2013 19:35:23\nI've also had this happen twice, graphics/mouse cursor freezes but sounds and game logic continue in the background. I can still interact using keyboard shortcuts. The console window doesn't display anything and neither does gamelog.txt.\nWindows 7 x64, using SDL version.\n. From Azu...@Bassiej.com on March 29, 2013 22:13:25\nI just had this happen to me on placing the training room in level 5.\nAttachment: error_training_room.jpg\n. From Azu...@Bassiej.com on March 30, 2013 00:12:14\nI would just like to add to the above comment that it only seems to happen in that particular level. Campaign Level 5..\nAnywhere else I get the overlapping chairs/graphics issue but the room can be build without the game freezing.\n. From Grim...@gmail.com on March 30, 2013 04:36:20\nIt seems that the skeleton placed in the training room can be the problem.\nAre you sure you placed this skeleton in other levels than #5?\nThe chair graphic problem is well known, and appears on all levels.\n. From Azu...@Bassiej.com on March 31, 2013 07:31:09\nyeah grim, I always place all the extra's in the training rooms as well (call it OCD :P ). It seems to work fine on any other level except for level 5 where you only get the 3 consultants.\n. From Grim...@gmail.com on March 31, 2013 08:55:45\nHm. That is weird.\nA developer would have to take a closer look at this.\n. From soundasleep on March 31, 2013 17:38:27\nTo clarify: I get this error repeatedly regardless of game level. I've had it occur at least once per game level, regardless of what I've been doing in the game (building rooms/placing items/hiring staff/just browsing the world), and no debug information/warnings/errors are ever displayed. The only thing that seems constant is that it seems it might occur after the same amount of time.\n. From static.o...@gmail.com on March 31, 2013 18:37:13\n@25 Could you take a look in the levels folder of your original TH files and open FULL00.SAM and tell me if you can find the lines beginning with the following:\ngbv.TrainingRate\nand\ngbv.TrainingValue[2]\nA lot of the training room code needs to be refactored really - I've noticed a fair bit of duplicated/incorrect information in there which isn't helping.\n. Too many separate issues and not enough information in this ticket to be worth leaving open.\n. From Grim...@gmail.com on March 10, 2012 17:27:47\nThe surgeon thing can be fixed by picking up and dropping him outside the room.\nThe same thing will fix the GP's office thing.\nThe GP's office bug happens most probably because you have a plant in the room, which is known to cause bugs like this when the handyman wants to water the plant.\nTo avoid this, just don't place plant inside patient rooms until the bug is fixed :)\nBut again, all you have to do is to pick up and drop the doctor outside the room.\nWhat version of the game are you running?\n. From Grim...@gmail.com on March 10, 2012 17:28:57\nBut I don't know what caused the bug in the operating theatre..\n. From mark.l1...@hotmail.co.uk on March 11, 2012 12:06:41\nI don't think it was the plant.\nI have seen this a few times this week - the doctor gets stuck in a loop of meander and ignores the patient. You're right though, pick him up and put him back seems to break the cycle, but what is causing it?\nSummary: Doctors getting in a loop of meander - wander the room and ignoring the patient\nStatus: Queued\n. From mark.l1...@hotmail.co.uk on March 11, 2012 12:44:03\nI have just remembered where I have been seeing this, in my case it may have been plants!  I was testing the staff moods patch some more, so I had plants in rooms.\nThat does not explain the op theatre though, if there is a plant there I can't see it\n. From plugnp...@gmail.com on March 11, 2012 12:49:53\nFor as far as I can remember I didn't put a plant in there. Actually you should get fines from the health inspection if you were to put plants in rooms other than offices ;).\nI'm running the precompiled Win32/SDL.\nAttachment: config.txt\n. From mark.l1...@hotmail.co.uk on March 11, 2012 13:26:20\nI am not sure why you have added the config as it would be the gamelog we would need to see as that is where any error would be recorded.  gamelog is in the same folder as config.\nI wasn't suggesting you had a plant in the op theatre, my point was that you didn't, so it could not be that causing your issue!\n. From plugnp...@gmail.com on March 11, 2012 13:33:04\nIn comment #1 I was asked what version of the game I was running, so I added the config.txt as there's settings described that might be relevant, for example that I played it windowed. Gamelog was empty.\n. From mark.l1...@hotmail.co.uk on March 11, 2012 13:52:25\nRight, I see:  the version number meant was it beta 8 etc or one of the development snapshots i.e. r1234 .  It doesn't appear in the config as far as I know, but in more recent versions it does tell you on the first menu in the game.  Look below the buttons, it also says which save version you are on.  If it has nothing there, then you are most likely using an older version of the game.\nAs the game log was empty it may mean that no actual error was thrown. (I am not saying that nothing is wrong, it is, just it did not throw an error - it happens)\nThere is also another issue #1118 which seems to be similar to this one.\n. From mark.l1...@hotmail.co.uk on March 20, 2012 09:15:44\nIssue 1118 has been merged into this issue.\n. From NalleLan...@gmail.com on March 14, 2013 09:47:26\nit might be the same type of problem i am having. A doctor was stuck with the smiley-face/hourglass \"i am waiting for a patient\" over his head in the x-ray scanner. No patients entered, the queue got full.\nIn the attached savegame i have tried moving the queue members around and moving the doctor out and then in again - now the doctor is walking around, no patients entering.\nusing snapshot r2141 on windows 7 64-bit.\nalso, at one time the handyman was in the queue, but i think it was after removing the doctor - when i noticed room was stuck, a patient was in queue, not the handyman.\nAttachment: stucklevel5.sav\n. From Grim...@gmail.com on March 22, 2013 11:03:17\nIssue 1540 has been merged into this issue.\n. From Grim...@gmail.com on March 22, 2013 11:03:50\nSee Issue 1540 for additional information.\n. From maartenp...@hotmail.nl on April 07, 2013 03:14:54\nIssue 1571 has been merged into this issue.\n. From maartenp...@hotmail.nl on April 07, 2013 09:56:03\nIssue 1574 has been merged into this issue.\n. From maartenp...@hotmail.nl on April 07, 2013 10:01:55\nI think that the fix for issue #1540 , issue #1571 and issue #1574 would be that none of the doctors can be moved by the user when they're operating.\n. Can you confirm that there was no console output?\n. Another recent save is included in #869\n. Merged.\n. Merged.  Thanks @Alberth289346 \n. From mark.l1...@hotmail.co.uk on April 02, 2012 12:21:30\n0.01 is not the latest version download version 0.01b as there was a bug found at the last minute.\nThe double door is not the fault only a symtom of something else that went wrong.  If it was down to the VIP that was most likely the bug that was fixed in 0.01b.  Try it and see if you still have the same problem.\nLet us know if you still have a problem\nStatus: Input\n. From kizzyco...@yahoo.co.uk on April 02, 2012 12:27:56\nThe entire version system frustrates me. regardless, I got the latest version I could, and it said 0.01 in the bottom-left corner, and it was the latest. I think.\nthe whole file system needs pruning, or a good sorting out. it confused me a lot when I saw this project.\n. From mark.l1...@hotmail.co.uk on April 02, 2012 23:57:28\nIt may still say 0.01 on the menu, I was referring to the download link\nDo you still get the same error?\nAttachment: 2.png\n. From edvin.li...@gmail.com on April 03, 2012 00:23:51\nThis error has already been confirmed in the forum, double doors do not occur because of the VIP bug Mark.\nHere is an attached gamelog for future reference: http://forums.corsix-th.com/index.php/topic,4767.msg6017.html#new\nStatus: Queued\n. From mark.l1...@hotmail.co.uk on April 03, 2012 12:52:31\nNever said it was, I wrote \"If it was down to the VIP\"\n. From kizzyco...@yahoo.co.uk on April 03, 2012 14:37:25\nyes, that is the one I downloaded. 0.01b. the bottom-right thing confused me.\nbut this bug does happen.\ninterestingly, just a short while ago, I had a patient just, freeze in front of a door just before exiting, but it wasn't bricked. it kept going, as if she weren't there.\nI'm attaching the gamelog file, in case it's related.\nAttachment: gamelog.txt\n. From mark.l1...@hotmail.co.uk on April 16, 2012 06:12:15\nIssue 1094 has some comments and saves which may be related to this issue\n. From mark.l1...@hotmail.co.uk on September 12, 2012 12:26:31\nWas this ever fixed?\n. From edvin.li...@gmail.com on September 12, 2012 12:29:52\nNot to my knowledge\n. From mark.l1...@hotmail.co.uk on September 13, 2012 11:21:15\nThis is just a theory Edvin, but there are lots of local functions.\nIf I am right in thinking that local functions only work when called from within the same file? Is it possible that they are sometimes being called inadvertently from outside i.e. one function calls another which inturn calls another?  I am thinking this as in some of the logs you see things like (a nil value).  Or is it that the thing causing the error has become detached from the hospital in some way and that is what is throwing the error. \nSo with this error the patient knows to leave the room and go back to say the GP and on the way he either suddenly thinks he is not in this hospital or as he goes through the door he no longer knows what it was he was supposed to do.\n. From Grim...@gmail.com on January 14, 2013 14:55:23\nWas this fixed with issue #374 ?\n. From maartenp...@hotmail.nl on February 05, 2013 10:55:22\nI added this issue to issue #1494 (this is a list of all knows graphical glitches.)\n. From edvin.li...@gmail.com on April 06, 2012 08:26:47\nIndeed\nStatus: Queued\n. From maartenp...@hotmail.nl on July 04, 2013 12:09:10\nCouldn't this be resolved in the same way as in issue #1646 ?\n. From Grim...@gmail.com on April 11, 2012 14:36:30\nI don't get this.\nSince it is directx I suspect this can be hardware related - But I don't know.\n. From maartenp...@hotmail.nl on April 12, 2012 03:59:37\nAnd how can I finger this out?\nAnd does other users have this problem?\nI attached a file about my hardware.\nAttachment: DxDiag.txt\n. From mark.l1...@hotmail.co.uk on April 12, 2012 04:15:07\nTry one of the other exe's then like openGL, you could find they work better.\nDo you have problems with other programmes or games with the flicker as that would tell you if it was your hardware. You can also adjust the curser rate in control panel I think.\n. From maartenp...@hotmail.nl on April 12, 2012 11:33:15\nI don't have problems with other games and my hardware is not broken or something.\nIt has also the latest drivers. And using other .exe's does work fine, but the DirectX-file doesn't and has a flickering cursor.\n. From maartenp...@hotmail.nl on October 13, 2012 09:17:51\nThis problem still occurs in r1662 . Are you sure that this is hardware-related?\n. From roujin.mw on January 21, 2013 04:53:05\nLabels: Renderer-DirectX\n. From maartenp...@hotmail.nl on July 04, 2013 12:05:19\nWill test this on my Windows 8 computer and see if I get the same situation.\nLabels: -Priority-Medium Priority-Low Component-Graphical\n. From mark.l1...@hotmail.co.uk on April 13, 2012 00:31:37\nIt may say that in the manual, but test it in TH and it is random\n. From henke@henke37.cjb.net on April 18, 2012 16:52:54\nOf course there still was a random part to it, but even random effects can be influenced by other variables.\n. From mark.l1...@hotmail.co.uk on December 03, 2012 12:51:30\nIssue 1392 has been merged into this issue.\n. From maartenp...@hotmail.nl on April 01, 2013 07:17:12\nLabels: -Priority-Medium Priority-Low\n. From maartenp...@hotmail.nl on July 04, 2013 12:06:53\nStatus: Queued\nLabels: Component-Logic\n. In my uninformed opinion both of the time frames are too long. Boiler breakdowns were a semiregular occurrence and most levels can be easily beaten before 5 years.\nDid you measure the average breakdown rate and range in the original?. From hospital self.world.map.difficulty is equal to easy, full, or hard. From henke@henke37.cjb.net on November 04, 2012 11:55:27\nA proposed solution is for the fax to have a single button to note that you can't accept the emergency due to not owning a helipad.\n. From Grim...@gmail.com on November 05, 2012 08:02:57\nUhm, if the map has no working helipad, then you should get an error in the map editor instead, which wouldn't let you save until you had a working one.\nBut that is just my opinion.\n. From mark.l1...@hotmail.co.uk on November 05, 2012 12:18:50\n@2\nIf I read this correctly there is an helipad, it is beyond a plot that has not been purchased yet.\nAnother solution would be to not generate the emergency if there is no accessable helipad.\n. From Grim...@gmail.com on November 05, 2012 13:00:11\nAh, I misunderstood then.\nYour solution would be better.\n. From maartenp...@hotmail.nl on July 04, 2013 12:13:53\nStatus: Queued\nLabels: -Priority-Medium Priority-Low\n. From mark.l1...@hotmail.co.uk on April 17, 2012 08:15:39\nI can't check the save yet and will try to later.\nI don't think this is limited to the op though, there are other times when the Dr or Nurse gets stuck in a room - I can't remember which issue this is in. \nIt may be that he wanted to go for a break and something stopped him.  What is his tiredness level?\nIf you can find a save from before the problem that would be great, look at the autosaves as there are 12 and a good chance that one of those is from before.\nStatus: Started\n. From mark.l1...@hotmail.co.uk on April 17, 2012 11:05:28\nAttached is your save and both doctors are now unstuck for you.  One had an empty action queue, the other one that was stuck as you had fired him - maybe he had the same problem.\nthe error message for the devs is copied from the console as it does not generate one to the log!\n\nOn call: no\nBusy:   busy and picked up\nGoing to staffroom\nLast room:      operating_theatre@59,41\n\n Current value:Clicked on CRABLIN      table: 0A5885D0\nClass:  Surgeon\nWarmth: 0.299   Happiness: 0.498   Fatigue: 1.000  Thirst: 0.000  Toilet_Need: 0\n.000   Health: 0.930\nActions:\nidle  must_happen\nmeander  must_happen\nwalk - going to 59:46  must_happen\nuse_screen - surgeon_screen  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\n\nEmpty action queue!\nLast action: use_screen\nstack traceback:\n        ...x\\fix_stuck_peeps\\CorsixTH\\Lua\\entities\\humanoid.lua:559: in function\n 'startAction'\n        ...x\\fix_stuck_peeps\\CorsixTH\\Lua\\entities\\humanoid.lua:682: in function\n 'finishAction'\n        ...k_peeps\\CorsixTH\\Lua\\humanoid_actions\\use_screen.lua:31: in function\n'when_done'\n        ...k_peeps\\CorsixTH\\Lua\\humanoid_actions\\use_screen.lua:202: in function\n '?'\n        ...x\\fix_stuck_peeps\\CorsixTH\\Lua\\entities\\humanoid.lua:590: in function\n 'startAction'\n        ...x\\fix_stuck_peeps\\CorsixTH\\Lua\\entities\\humanoid.lua:682: in function\n 'finishAction'\n        ...x_stuck_peeps\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:144: in function\n 'timer_function'\n        ...x_stuck_peeps\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:60: in function\n'on_interrupt'\n        ...x\\fix_stuck_peeps\\CorsixTH\\Lua\\entities\\humanoid.lua:598: in function\n 'startAction'\n        ...x\\fix_stuck_peeps\\CorsixTH\\Lua\\entities\\humanoid.lua:682: in function\n 'finishAction'\n        ...tuck_peeps\\CorsixTH\\Lua\\humanoid_actions\\meander.lua:75: in function\n'?'\n        ...x\\fix_stuck_peeps\\CorsixTH\\Lua\\entities\\humanoid.lua:590: in function\n 'startAction'\n        ...x\\fix_stuck_peeps\\CorsixTH\\Lua\\entities\\humanoid.lua:510: in function\n 'callback_ok'\n        ..._stuck_peeps\\CorsixTH\\Lua\\dialogs\\confirm_dialog.lua:72: in function\n'callback'\n        ...sktop\\Corsix\\fix_stuck_peeps\\CorsixTH\\Lua\\window.lua:590: in function\n 'handleClick'\n        ...sktop\\Corsix\\fix_stuck_peeps\\CorsixTH\\Lua\\window.lua:1287: in functio\nn 'onMouseUp'\n        ...sktop\\Corsix\\fix_stuck_peeps\\CorsixTH\\Lua\\window.lua:1271: in functio\nn 'onMouseUp'\n        ...k\\Desktop\\Corsix\\fix_stuck_peeps\\CorsixTH\\Lua\\ui.lua:636: in function\n 'dispatch'\n        ...\\Desktop\\Corsix\\fix_stuck_peeps\\CorsixTH\\Lua\\app.lua:611: in function\n <...\\Desktop\\Corsix\\fix_stuck_peeps\\CorsixTH\\Lua\\app.lua:606>\n\nOn call: no\nBusy:   busy and picked up\nGoing to staffroom\nLast room:      operating_theatre@59,41\n\n Current value:Clicked on WRIGHTWIN    table: 05FBDF38\nClass:  Surgeon\nWarmth: 0.310   Happiness: 0.988   Fatigue: 0.000  Thirst: 0.000  Toilet_Need: 0\n.000   Health: 0.910\nActions:\nidle  must_happen\nmeander  must_happen\nwalk - going to 59:46  must_happen\nuse_screen - surgeon_screen  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\npickup  must_happen\nspawn  must_happen\npickup  must_happen\n\nI'll leave the issue open as hopefully there will be enough to help the devs find the cause.  both were over tired, but whether that was the cause or just because they were stuck I don't know.\nSummary: Doctors getting stuck due to empty action queue / not knowing what to do next!\nStatus: Queued  \nAttachment: lvl3stuckOperatingTheatre.sav\n. From intergal...@gmail.com on April 17, 2012 23:32:19\nI tried to look for auto-saves before I saved my game here, but I can't find one as I started another level after this savegame (which erased previous auto-saves). Thanks for the fixed save game. I will try that.\n. From jatonb...@gmail.com on June 10, 2012 13:11:25\ni've been having this issue, but with Patients instead of Doctors. Happens at random so i haven't noticed a pattern. I'm running 0.01b, Mac OSX, Full version of Theme Hospital. I can attach a save file but i don't know where they are stored.\n. From intergal...@gmail.com on June 10, 2012 20:14:57\n@jatonb...@gmail.com They are stored at C:\\Users\\AppData\\Roaming\\CorsixTH\\Saves  \nAlso, this issue may be related: \"Patient getting stuck when required room has not been built but is available (missing the fax?)\" https://code.google.com/p/corsix-th/issues/detail?id=1227\n. From jatonb...@gmail.com on June 10, 2012 22:37:36\nDo you know the default save path for Mac OSX? That's what i'm running CorsixTH on. Also i'm not sure if its 100% related to issue #1227 because when it happens on my installation the required room is already built. The patient goes and gets cured then the empty action error comes up and then they go through an endless loop of going back to reception and then to the cure room, gets cured and starts the process all over again and the error message keeps popping up. I've observed this time that a patient died waiting for treatment first then for some reason stayed in the hospital, got treatment then the errors started to come up. Thanks for your reply.\n. From intergal...@gmail.com on June 10, 2012 23:56:37\nI don't use Mac OS, but upon searching for the Mac OS equivalent of the Windows directory I mentioned, it seems that it is at: ~/Library/Application Support/CorsixTH/Saves  or  /Library/Application Support/CorsixTH/Saves\nI got that info from this page: http://stackoverflow.com/questions/568708/mac-os-x-where-should-i-store-common-application-data You might also want to open up a new issue report, and then just attach your savegame file.\n. From andy_sim...@me.com on August 03, 2012 05:45:30\nCouple things:\n1. your saved games are stored in your unix home directory under hidden folder .config. Use terminal like so to access them: cd ~/.config/CorsixTH/Saves\n2. has this issue being fixed with the doctors and patients getting stuck? it is happening exactly as described above for both doctors / patients/ handymen\n. From Grim...@gmail.com on May 23, 2012 16:47:55\nThe \"cycle\" might be different, but I see no problem in this.\nTo solve the queue problem:\n1. Place higher skilled doctors in the GP\n2. Build more GP's\nStatus: Queued\n. From mark.l1...@hotmail.co.uk on March 18, 2013 12:47:22\nDoes this still happen?\nIn another issue someone is saying diagnosis is too quick!\nStatus: Input\n. From maartenp...@hotmail.nl on July 04, 2013 12:14:48\nLabels: -Priority-Medium Priority-Low\n. From Grim...@gmail.com on April 30, 2012 23:23:32\nOk, then the music have to be preloaded in your memory - taking up more RAM.\nBut the smartest thing to do is just to copy that HOSP folder to your harddisk.\n. From edvin.li...@gmail.com on May 01, 2012 02:49:21\nIt should indeed not stall the entire game.\nStatus: Accepted\n. From henke@henke37.cjb.net on May 01, 2012 05:01:20\nActually, it doesn't have to be preloaded. It is ok to just have no music for a few seconds while it loads in the next track. The problem is that the loading blocks the rest of the game from running.\n. From maartenp...@hotmail.nl on July 04, 2013 12:16:50\nSummary: Music (on disk) loading blocks the rest of the game from running   (was: Music loading causes lag spike) \nStatus: Queued\nLabels: -Priority-Medium Priority-Low\n. From edvin.li...@gmail.com on May 31, 2012 00:17:02\nThere is indeed a problem with the layers there. As it exists in the original files I'm not sure how to solve it though.\nStatus: Future\n. From mark.l1...@hotmail.co.uk on November 08, 2012 06:01:54\nThis may be relevamt http://groups.google.com/group/corsix-th-dev/browse_thread/thread/f0142aae17618660\n. From maartenp...@hotmail.nl on February 05, 2013 10:55:42\nI added this issue to issue #1494 (this is a list of all knows graphical glitches.)\n. From sican...@yahoo.co.uk on July 15, 2012 06:42:39\nApologies for not attaching the savefile, was hit by the Firefox 13.0.1 Javascript bug. Savefile is here:\nAttachment: Level5-StuckPatientWaitingForOp.sav\n. From sican...@yahoo.co.uk on July 15, 2012 08:04:42\nAdditional note: The patient does not show up in the queue list of either Operating Theatre.\nI have also triggered this again with a Patient waiting for the Pharmacy. I couldn't reproduce this with an autosave:\nClicked on humanoid table: 0xde5cfd8\nClass:  Standard Male Patient\nWarmth: 0.292   Happiness: 0.998   Fatigue: 0.000  Thirst: 1.000  Toilet_Need: 0.623   Health: 0.158\nActions:\nuse_object - bench  must_happen\nqueue - Bench distance: 2 Standing: false\nwalk - going to 82:49\nwalk - going to 77:49  \n\nThe Patient has been in this hospital on that bench for at least 6 months. The Patient will eventually use the nearby toilet then either dies or enters the pharmacy successfully.\nAdditionally, the Patient can also die before being treated in the Pharmacy. The successful treatment will override the death.\nAttachment: Level5-StuckPatientWaitingForPharmacy.sav\n. From sican...@yahoo.co.uk on July 15, 2012 08:20:35\nNB: There are two Pharmacies in this hospital, both adjacent to each other.\n. From mark.l1...@hotmail.co.uk on October 06, 2012 02:11:53\nIssue 1011 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on October 06, 2012 02:14:47\nIssue 1321 has been merged into this issue.\n. From leis...@gmail.com on July 20, 2012 15:57:13\nError message:\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The buttonup handler.\nA stack trace is included below, and the handler has been disconnected.\n...re/games/CorsixTH/Lua/humanoid_actions/seek_room.lua:110: attempt to index field 'hospital' (a nil value)\nstack traceback:\n    ...re/games/CorsixTH/Lua/humanoid_actions/seek_room.lua:110: in function 'action_seek_room_no_treatment_room_found'\n    ...re/games/CorsixTH/Lua/humanoid_actions/seek_room.lua:274: in function '?'\n    /usr/share/games/CorsixTH/Lua/entities/humanoid.lua:528: in function 'Humanoid_startAction'\n    /usr/share/games/CorsixTH/Lua/entities/humanoid.lua:620: in function 'finishAction'\n    ...re/games/CorsixTH/Lua/humanoid_actions/seek_room.lua:203: in function 'on_interrupt'\n    /usr/share/games/CorsixTH/Lua/entities/humanoid.lua:591: in function 'setNextAction'\n    /usr/share/games/CorsixTH/Lua/room.lua:95: in function 'callback'\n    /usr/share/games/CorsixTH/Lua/room.lua:691: in function 'deactivate'\n    /usr/share/games/CorsixTH/Lua/room.lua:698: in function 'tryToEdit'\n    /usr/share/games/CorsixTH/Lua/game_ui.lua:485: in function \n    (tail call): ?\n    (tail call): ?\n    /usr/share/games/CorsixTH/Lua/app.lua:611: in function \nSavefile where it happens, attached.\nAttachment: Autosave2.sav\n. From mark.l1...@hotmail.co.uk on November 18, 2012 03:11:20\nI can confirm the error.\nI also tried a different approach of building another ward first and got a different error when trying to confirm the build\nCreated game with savegame version 51.\nError in buttonup handler: \n...re/games/CorsixTH/Lua/humanoid_actions/seek_room.lua:110: attempt to index field 'hospital' (a nil value)\nstack traceback:\n    ...re/games/CorsixTH/Lua/humanoid_actions/seek_room.lua:110: in function 'action_seek_room_no_treatment_room_found'\n    ...re/games/CorsixTH/Lua/humanoid_actions/seek_room.lua:274: in function '?'\n    /usr/share/games/CorsixTH/Lua/entities/humanoid.lua:528: in function 'Humanoid_startAction'\n    /usr/share/games/CorsixTH/Lua/entities/humanoid.lua:595: in function 'setNextAction'\n    /usr/share/games/CorsixTH/Lua/room.lua:95: in function 'callback'\n    /usr/share/games/CorsixTH/Lua/room.lua:691: in function 'deactivate'\n    /usr/share/games/CorsixTH/Lua/room.lua:698: in function 'tryToEdit'\n    /usr/share/games/CorsixTH/Lua/game_ui.lua:485: in function \n    (tail call): ?\n    (tail call): ?\n    /usr/share/games/CorsixTH/Lua/app.lua:611: in function \nSavegame version changed from 51 (0.01) to 54 (0.11).\nError in buttonup handler: \nC:\\Program Files\\CorsixTH\\Lua\\world.lua:1426: bad argument #2 to 'findPath' (number expected, got nil)\nstack traceback:\n    [C]: in function 'findPath'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1426: in function 'getPath'\n    ...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:364: in function '?'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:526: in function 'Humanoid_startAction'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:618: in function 'finishAction'\n    ...am Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:203: in function 'on_interrupt'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:589: in function 'setNextAction'\n    ...am Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:76: in function 'action_seek_room_goto_room'\n    ...am Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:251: in function 'callback'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:752: in function 'markRoomAsBuilt'\n    C:\\Program Files\\CorsixTH\\Lua\\dialogs\\edit_room.lua:228: in function 'callback'\n    C:\\Program Files\\CorsixTH\\Lua\\window.lua:590: in function 'handleClick'\n    C:\\Program Files\\CorsixTH\\Lua\\window.lua:1287: in function 'onMouseUp'\n    ...Program Files\\CorsixTH\\Lua\\dialogs\\place_objects.lua:449: in function <...Program Files\\CorsixTH\\Lua\\dialogs\\place_objects.lua:448>\n    (tail call): ?\n    C:\\Program Files\\CorsixTH\\Lua\\window.lua:1271: in function 'onMouseUp'\n    C:\\Program Files\\CorsixTH\\Lua\\ui.lua:636: in function \n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:636: in function \nI was using 0.11 win 7 directx\nStatus: Accepted\n. From Grim...@gmail.com on March 12, 2013 14:48:14\nCan replicate with r2130\nLabels: Milestone-0.30\n. From static.o...@gmail.com on April 02, 2013 10:16:07\nI'm not able to replicate this with a new save. \nThere's something weird about the save game provided in #1 because there's a patient making their way to the room who is detached from the hospital and I suspect that's where the error's coming from. I'm tempted to say that this is more of a symptom of another problem rather than a bug in it's own right.\n. From mark.l1...@hotmail.co.uk on April 02, 2013 11:25:21\n@ 5\nattempt to index field 'hospital' (a nil value) would fit with that find and as you say it's probably the patient that is not attached to the hospital that has thrown the error.\nThere was an issue that I think was fixed for 0.20 where a patient could get into a loop of some sort and go back to reception and wait endlessly to re-visit the GP.  Maybe this was the same here and at some point, got fed up and decided to go home and didn't.\nGiven how old the issue is, I reckon we could mark this as fixed - what do you think?\n. From static.o...@gmail.com on April 02, 2013 13:35:22\nI'd say so, we can always re-open if it can be reproduced with one of the newer versions.\nAt the very least, this issue seems to be a specific manifestation of a problem which has probably been fixed already, like you say. That said, perhaps it might be worth adding some clever assertions to try and catch the case when a patient's hospital is dereferenced but it is still in a queue or en route to somewhere to make sure that the root cause has been eliminated.\n. From mark.l1...@hotmail.co.uk on April 03, 2013 03:00:33\n@ 7\nI like the sounds of that, but it beyond my ability with lua.\nCc: edvin.li...@gmail.com\n. Duplicate of #133 \n. From Grim...@gmail.com on August 26, 2012 04:10:33\nI agree with this a little, but remember that once the rats are implemented it will be harder to make the VIP happy.\nBut I still think it is too easy to get money from the VIP - even if he sees a few puddles of puke and pee.\n. From mark.l1...@hotmail.co.uk on November 03, 2012 11:46:57\nfor a while I was thinking the same, it seemed like each time he came it was always $2000.\nIn the last couple of weeks though I have seen all sorts of awards - so I don't think anything is broken and it is like Grimdoc says, once there are rats and more vomit, litter and even some dead rats there is more chance of you getting a low score and award.  With earthquakes and exploding rooms now you should also start to see different responses from the VIP\nIn the attached picture (testing RC) I have a clean hospital, no exploded rooms and only got $1380.  I don't think the awards differ on each level do they?\nAttachment: 4.png\n. From stu...@stuartmcmillen.com on November 03, 2012 17:13:33\nMy comment was made after playing version CorsixTH 0.01.\nI have not yet installed/played CorsixTH 0.10.\nSounds like the issue may have been improved. Should I 'close' this defect, or is there value in keeping it open?\n. From mark.l1...@hotmail.co.uk on November 04, 2012 01:30:47\nLets see if others see differences first, although I don't think the code has altered in this respect since 0.01.\nStatus: Queued\n. From mark.l1...@hotmail.co.uk on November 04, 2012 01:30:25\nI think that the amount you receive is capped at $2000, so it may just be a case of the other factors not yet being in the game.  So $2000 will be the award more times than other amounts.\nLabels: -Priority-Medium Priority-Low\n. From Grim...@gmail.com on August 06, 2013 16:03:25\nAnyone experience rewards that differs from $2000?\n. From mark.l1...@hotmail.co.uk on August 07, 2013 00:41:49\nYes, but 2000 is the most common.\nIt might need some balancing, but the scores would be lower with rats.\n. From Grim...@gmail.com on August 07, 2013 04:16:04\nOk. Then everything is working like expected.\nWe will have to look at this again when rats and epidemics are implemented.\n. From mark.l1...@hotmail.co.uk on August 21, 2013 12:46:36\nWith more vomit you should start to see less money from the vip.  I have one from a custom map yesterday where the reward was less than 1000 and he thought it was a very good hospital.\nLike you say we'll keep an eye in this for a bit more\nStatus: Investigating\n. From mark.l1...@hotmail.co.uk on March 22, 2014 12:18:29\nAfter looking at the code for this I see that the award is multiplied by the level number for the campaign and not otherwise.\nIt tends to be the campaign from level 2 where you often get 2000, whilst in a custom map the amounts vary more.\nI am not sure why we have this multiplier for the campaign, do we need that?\n. Fixed. From Grim...@gmail.com on October 29, 2012 12:31:33\nDid this only happen once, or can you replicate it?\nA savegame from just before the error happening would probably be helpful \n(auto saves are great for this).\nSummary: Patient got stuck at door in pharmacy\nStatus: Input\n. From maartenp...@hotmail.nl on October 29, 2012 12:59:16\nAnd maybe this bug is already fixed in the latest version (0.10) in combination with the Trunk?\n. From Grim...@gmail.com on October 29, 2012 13:42:03\nThat is a possibility, but let's keep it open for a little while longer and see if anyone responds.\n. From hil...@gmail.com on October 29, 2012 14:06:44\nI'll check the new version and keep my eyes open :)\nOve\n. From elimi...@gmail.com on November 06, 2012 15:15:17\nI have had this same thing happen with a handyman with SVN revision 1687 Running: The callback handler.\nA stack trace is included below, and the handler has been disconnected.\n./Lua/audio.lua:419: Could not load music file 'Sound/Midi/STEADY.XMI' (/etc/timidity++/timidity.cfg: No such file or \ndirectory)\nstack traceback:\n        [C]: in function 'yield'\n        ./Lua/app.lua:636: in function <./Lua/app.lua:631>\n. From elimi...@gmail.com on November 06, 2012 15:17:17\nAhh, looking at the error, and then checking my currently installed packages, I don't have timidity++. It should probably be a dependency, yeah?\n. From elimi...@gmail.com on November 06, 2012 15:18:59\nI just had the same problem again, actually...\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the er\nror.\nRunning: The callback handler.\nA stack trace is included below, and the handler has been disconnected.\n./Lua/audio.lua:419: Could not load music file 'Sound/Midi/SIXSEVEN.XMI' (/etc/timidity++/timidity.cfg: No such file o\nr directory)\nstack traceback:\n        [C]: in function 'yield'\n        ./Lua/app.lua:636: in function <./Lua/app.lua:631>\nWarning: Multiple objects on tile 74,67 - only one will be encoded\nWarning: Multiple objects on tile 75,64 - only one will be encoded\nWarning: Multiple objects on tile 74,64 - only one will be encoded\nWarning: Multiple objects on tile 75,64 - only one will be encoded\nWarning: Multiple objects on tile 76,64 - only one will be encoded\nWarning: Multiple objects on tile 77,64 - only one will be encoded\nWarning: Multiple objects on tile 78,64 - only one will be encoded\nWarning: Multiple objects on tile 74,64 - only one will be encoded\nWarning: Multiple objects on tile 74,65 - only one will be encoded\nWarning: Multiple objects on tile 74,66 - only one will be encoded\nWarning: Multiple objects on tile 74,67 - only one will be encoded\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the er\nror.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\n./Lua/humanoid_actions/walk.lua:219: attempt to index field 'queue' (a nil value)\nstack traceback:\n        ./Lua/humanoid_actions/walk.lua:219: in function <./Lua/humanoid_actions/walk.lua:201>\n        (tail call): ?\n        ./Lua/humanoid_actions/walk.lua:179: in function 'timer_function'\n        ./Lua/entity.lua:165: in function 'tick'\n        ./Lua/entities/staff.lua:146: in function 'tick'\n        ./Lua/world.lua:963: in function 'onTick'\n        ./Lua/app.lua:734: in function <./Lua/app.lua:732>\n        (tail call): ?\n        ./Lua/app.lua:636: in function <./Lua/app.lua:631>\nWarning: No event handler for timer\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the er\nror.\nRunning: The buttonup handler.\nA stack trace is included below, and the handler has been disconnected.\n./Lua/humanoid_actions/walk.lua:60: attempt to call local 'timer_function' (a nil value)\nstack traceback:\n        ./Lua/humanoid_actions/walk.lua:60: in function 'on_interrupt'\n        ./Lua/entities/humanoid.lua:589: in function 'setNextAction'\n        ./Lua/dialogs/staff_dialog.lua:312: in function 'callback'\n        ./Lua/window.lua:590: in function 'handleClick'\n        ./Lua/window.lua:1287: in function 'onMouseUp'\n        ./Lua/dialogs/staff_dialog.lua:269: in function 'onMouseUp'\n        ./Lua/window.lua:1271: in function 'onMouseUp'\n        ./Lua/ui.lua:636: in function <./Lua/ui.lua:623>\n        (tail call): ?\n        (tail call): ?\n        (tail call): ?\n        ./Lua/app.lua:636: in function <./Lua/app.lua:631>\nWarning: No event handler for buttonup\nWarning: Multiple objects on tile 53,83 - only one will be encoded\n. From mark.l1...@hotmail.co.uk on September 13, 2012 11:22:02\nOwner: ---\n. From mark.l1...@hotmail.co.uk on December 04, 2012 11:58:55\nJust before I got this error my view of the hospital was at the other end.  The error happened as I was moving my view from that end to this end and I may well have clicked on either the patient or Dr as I scrolled/used the mouse to change my view.\nThis may have nothing to do with error, but then again you never know!\n. From mark.l1...@hotmail.co.uk on July 02, 2013 11:18:35\nIssue 1660 has been merged into this issue.\n. From Grim...@gmail.com on August 07, 2013 08:41:31\nCan this be related?\nI was using MarkL's patch from issue #1352 , but that doesn't change any of the lua files listed below.\nSavegame version is 76 (Trunk), originally it was 76 (Trunk)\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nC:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:634: Can only finish current action\nstack traceback:\n        [C]: in function 'assert'\n        C:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:634: in function 'finishActi\non'\n        C:\\Games\\CorsixTH\\Lua\\rooms\\cardiogram.lua:106: in function 'after_use'\n        ...s\\CorsixTH\\Lua\\humanoid_actions\\multi_use_object.lua:264: in function\n 'timer_function'\n        C:\\Games\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:796: in function 'dispatch'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:697: in function \nError in timer handler:\nC:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:634: Can only finish current action\nstack traceback:\n        [C]: in function 'assert'\n        C:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:634: in function 'finishActi\non'\n        C:\\Games\\CorsixTH\\Lua\\rooms\\cardiogram.lua:106: in function 'after_use'\n        ...s\\CorsixTH\\Lua\\humanoid_actions\\multi_use_object.lua:264: in function\n 'timer_function'\n        C:\\Games\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n        C:\\Games\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:796: in function 'dispatch'\n        C:\\Games\\CorsixTH\\Lua\\app.lua:697: in function \nWarning: No event handler for timer\nAttachment: what2.sav\n. From mark.l1...@hotmail.co.uk on August 07, 2013 12:47:40\nIssue 99 has been merged into this issue.\n. From Grim...@gmail.com on October 06, 2012 09:46:08\nI have seen this earlier, and it only happens with really long queues.\n. From Grim...@gmail.com on October 29, 2012 12:28:26\nSummary: Too many patients in queue causes error\nStatus: Accepted\n. From ryanhugh...@gmail.com on October 27, 2012 17:08:25\nI can replicate this with on Windows 8 using OpenGL and 0.10.\n. From mark.l1...@hotmail.co.uk on October 28, 2012 09:55:05\nI can replicate this with windows 7 and I don't recall having this problem before with OpneGl.\nSummary: OpenGL: Windows key: mouse stuck if you alt+tab from game\nStatus: Queued\n. From mark.l1...@hotmail.co.uk on November 07, 2012 11:18:29\nIssue 1376 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on November 07, 2012 11:19:14\nSummary: Alt+Tab does not work when using the OpenGL version\nStatus: Accepted\n. From maartenp...@hotmail.nl on November 07, 2012 11:30:51\nMaybe updating to SDL 2 would resolve this issue? Look at this discussion with Alan Woolley: https://groups.google.com/forum/?fromgroups#!topic/corsix-th-dev/qr0u-bHPj0w\n. From maartenp...@hotmail.nl on January 20, 2013 11:02:35\nIt looks like that this is now resolved. Alt-tab when using the OpenGL-version will not let the cursor get stuck at the left corner of the screen and you can now move it.\n. From roujin.mw on January 21, 2013 04:53:28\nLabels: Renderer-OpenGL\n. From mark.l1...@hotmail.co.uk on November 02, 2012 13:32:56\nI wish it didn't automatically make you the owner of the issue :)\nOwner: ---\n. From Grim...@gmail.com on November 02, 2012 15:30:15\nI see this all the time!\nStatus: Accepted\n. From mark.l1...@hotmail.co.uk on April 06, 2013 11:39:42\nI have had three similar errors tonight, only I have not been playing for long.  Each time though I was using the arrow keys to scroll around and the game froze with the same message as in the above pic.\nFirst time the error was\nFaulting application name: CorsixTH_DirectX.exe, version: 0.0.0.0, time stamp: 0x514780f0\nFaulting module name: ntdll.dll, version: 6.1.7601.17725, time stamp: 0x4ec49b8f\nException code: 0xc0000005\nFault offset: 0x00038dc9\nFaulting process id: 0x11b0\nFaulting application start time: 0x01ce32f096bec9be\nFaulting application path: C:\\Users\\Mark\\Desktop\\corsixth\\alienDNA\\CorsixTH\\CorsixTH_DirectX.exe\nFaulting module path: C:\\Windows\\SysWOW64\\ntdll.dll\nReport Id: 2ca50395-9ee6-11e2-b15e-8c89a5160b8f\nthen\nFaulting application name: CorsixTH_DirectX.exe, version: 0.0.0.0, time stamp: 0x514780f0\nFaulting module name: CorsixTH_DirectX.exe, version: 0.0.0.0, time stamp: 0x514780f0\nException code: 0xc0000005\nFault offset: 0x0002dff9\nFaulting process id: 0x29c\nFaulting application start time: 0x01ce32f35584ce9a\nFaulting application path: C:\\Users\\Mark\\Desktop\\corsixth\\alienDNA\\CorsixTH\\CorsixTH_DirectX.exe\nFaulting module path: C:\\Users\\Mark\\Desktop\\corsixth\\alienDNA\\CorsixTH\\CorsixTH_DirectX.exe\nReport Id: 654762ef-9ee7-11e2-b15e-8c89a5160b8f\nand the last one\nFaulting application name: CorsixTH_DirectX.exe, version: 0.0.0.0, time stamp: 0x514780f0\nFaulting module name: CorsixTH_DirectX.exe, version: 0.0.0.0, time stamp: 0x514780f0\nException code: 0xc0000005\nFault offset: 0x0002dff9\nFaulting process id: 0x7b4\nFaulting application start time: 0x01ce32f43106910a\nFaulting application path: C:\\Users\\Mark\\Desktop\\corsixth\\alienDNA\\CorsixTH\\CorsixTH_DirectX.exe\nFaulting module path: C:\\Users\\Mark\\Desktop\\corsixth\\alienDNA\\CorsixTH\\CorsixTH_DirectX.exe\nReport Id: 5281436a-9ee8-11e2-b15e-8c89a5160b8f\nLabels: Renderer-DirectX\n. The crash is a memory violation but I'm afraid without a more complete heap dump it could be anything.  If you were able to reproduce this from within the Visual Studio debugger and provide a stack trace it would be useful.\n. It's part of the Visual Studio IDE.  Compile for debugging and launch CorsixTH through Visual Studio with F5.\n. J-Shep's eclipse is just for editing and debugging Lua so far.\n. Ok, a couple more things to do.\n1. Set CorsixTH as the startup project (as opposed to all build), you can do that by right clicking on it.\n2. You need to copy all the dlls into the folder where CorsixTH.exe is.\n. @Lego3 curious, normally that wouldn't be part of the search path so I haven't tried it.  Maybe either CorsixTH itself or CMake influences that.\n. No, what error do you get?\n. The folders are normal.  For VS it still looks like your start up project is set to the wrong thing.  Right click CorsixTH under projects and select Set as startup project.\nIf you were double clicking on the exe the error might be hidden, best to run it from VS or the command line to see any errors.\n. @MarkL1961 do you still get errors like were reported in this ticket?\n. Not enough info. Only call stack is for old engine. From mark.l1...@hotmail.co.uk on November 12, 2012 12:05:40\nShortly after this save i removed the Dr and deleted that room.  The other elvis waiting outside later through this error\nCreated game with savegame version 54.\nSavegame version is 54 (0.11)\nSavegame version is 54 (0.11)\nSavegame version is 54 (0.11)\nSavegame version is 54 (0.11)\nSavegame version is 54 (0.11)\nSavegame version is 54 (0.11)\nError in timer handler: \n...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:71: Proper idle not in action_queue\nstack traceback:\n    [C]: in function 'error'\n    ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:71: in function 'action_queue_find_idle'\n    ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:225: in function 'onChangeQueuePosition'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\patient.lua:809: in function 'notifyNewObject'\n    C:\\Program Files\\CorsixTH\\Lua\\objects\\bench.lua:165: in function 'removeUser'\n    ...m Files\\CorsixTH\\Lua\\humanoid_actions\\use_object.lua:257: in function 'finish_using'\n    ...m Files\\CorsixTH\\Lua\\humanoid_actions\\use_object.lua:295: in function 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:165: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:965: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:734: in function \n    (tail call): ?\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:636: in function \nWhat is odd he continued to wait outside the slicer even though the pychiatric room had been removed and he was no longer near to either of the others.\nThe error came just after I placed a couple of radiators and plants near to reception\nAttachment: 005.sav\n. From mark.l1...@hotmail.co.uk on November 12, 2012 12:14:20\nWhen I come to think about it I had also just placed a drinks machine near to were he is sitting, that may or may not be relevant.\n. From martin.b...@gmail.com on November 13, 2012 07:23:54\nIve seen this issue before a few times in version .10, also happens with gp offices, i havent been able to reliably replicate it though, but if useful i can add a save of it in progress if needed (and this is with a stable no new addition hospital)\n. From mark.l1...@hotmail.co.uk on November 13, 2012 08:08:03\nNot sure what you mean by \"stable no new addition hospital\", but any saves you can post with this sort of problem will no doubt help the devs in finding the cause.\n. From martin.b...@gmail.com on November 16, 2012 00:31:19\nAs in the hospitals physical setup wasnt being changed in any way, i was just happily treating patients.  Im on the lookout of a reproducible set of saves, but im yet to turn one up\n. From mark.l1...@hotmail.co.uk on November 16, 2012 02:52:23\nI see what you are saying now.\nThe first save is before any changes were made and there were no errors thrown.  I had noticed that the patient was not being treated.  I think this is down to the Dr being in a loop of meander, as for why I have no idea.  The trouble with this error, as it does not throw an error message, it is not until you notice a staff member is not doing what they should be that you begin to realise something is wrong.  Most of the time you don't see it until they have the night cap icon.\nThe other errors came after I started to remove rooms etc\n. From Grim...@gmail.com on November 18, 2012 09:51:17\nLabels: Milestone-0.20\n. From Grim...@gmail.com on March 12, 2013 13:06:12\nLabels: -Milestone-0.20 Milestone-0.30\n. From maartenp...@hotmail.nl on July 04, 2013 12:46:28\nSummary: Patient is not being treated/diagnosed    (was: Patient is not being treated/diagnosed - RC 0.11) \n. From Grim...@gmail.com on August 06, 2013 12:14:10\nIn the first save the \"error\" has already been triggered somehow.\nI lifted up the doctor, and put him back when elvis had left (the building, hurr), and when he re-entered, he was cured normally.\n. From alexgh...@gmail.com on November 16, 2012 08:25:54\nI created a small patch that will discover the disease if you accept an emergency and that disease isn't discovered yet. I don't know how this situation is treated in the original TH. Presumably if somebody offers you an emergency and can tell if you can cure the respective disease, they can also inform you about the existence of that disease and a basic cure for it.\nAttachment: fix.diff\n. From Grim...@gmail.com on November 18, 2012 09:39:43\n@1: I think we need to discuss this before adding it.\nHow did the original game work?\n. From mark.l1...@hotmail.co.uk on November 19, 2012 11:25:41\nI have checked this in TH for the same level and I did not get the emergency.  I have checked in the SAM files and invis patients should show up from month 2 and as an emergency from month 8 to month 12.  As I had not discovered the illness until Feb in year 2 the emergency did not happen. (the first invis patient did not appear until month 13)\nI suspect that TH would skip an emergency if it was for an illness you had not discovered, perhaps Edvin can check the SAM files too, as his understanding is better than mine.\nI think there was a similar issue or maybe more than one with aliens and was the other with hairyitus?\nHow did we handle that?\nDo we make the disease known or skip the emergency or swap it for something else?\n. From alexgh...@gmail.com on November 20, 2012 12:49:46\nI think skipping or changing the emergency will create problems with alien DNA (or other emergency only diseases if any are added) because it will cause it to become impossible to get if you don't know it at the beginning of a level. I checked and in the campaign levels it is known but it could be a problem for custom maps. \nIf an emergency is skipped if you don't know the disease shouldn't it also be skipped if you can't build a cure room to keep it consistent?\n. From mark.l1...@hotmail.co.uk on November 20, 2012 12:59:13\nIf you can build the room but have not done so or need to employ someone it tells you this in the fax.\n\"You will need to build a  %s and employ a %s\" etc\nOtherwise if you can't cure it because you can't build the room you are told this\n\"You cannot cure this disease at the moment\"\nSo it is a little different to not knowing what is wrong, even though the fax tells you the illness.  You have not discovered that illness, which is why I think it must skip it.\n. From mark.l1...@hotmail.co.uk on November 20, 2012 13:00:53\nI think with custom maps the illnesses are picked from what is known, I will check this now.\n. From mark.l1...@hotmail.co.uk on November 20, 2012 13:10:20\nIn world lua\nif not disease then\n-- Unknown disease! Create a random one instead.\nI think that this is with campaign and custom map.\nSo in my case the disease was known according to the SAM file, but not discovered, yet, otherwise it would have been replaced for something else. \nPerhaps it should be changed from known to discovered?\n. From mark.l1...@hotmail.co.uk on November 23, 2012 11:00:34\nIssue 1393 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on November 23, 2012 12:36:01\nIn earlier comments I have said a known disease, what I meant was available disease.\n. From alexgh...@gmail.com on November 24, 2012 00:21:56\nWhat I meant to say about the alien DNA problem is that I think it will be impossible to get if the disease is available to be learned but is not discovered at the beginning of the level. Because no non-emergency patients with alien DNA will ever come the disease can never be discovered and that will cause any emergencies containing them to be skipped (or changed) so no alien DNA patients will ever appear. \nDoes anybody know how emergencies were handled in multiplayer games in the original? If the same emergency was offered to more than one player then I don't think emergencies should be skipped or swapped because one player hasn't discovered the disease.\n. From mark.l1...@hotmail.co.uk on November 24, 2012 01:02:22\nFrom what I remember from TH is that patients with alien DNA can walk though the door like other patients. So you should get them before an emergency and it can be discovered, but only by a consultant in the GP Office.\n. From alexgh...@gmail.com on November 24, 2012 01:28:50\nIf you check the file for the alien DNA disease you'll see that the only_emergency flag is set and in a comment for that it says that there are no normal door animations for alien DNA.\n. From mark.l1...@hotmail.co.uk on November 24, 2012 02:42:30\nThat is not how theme hospital worked it is how CorsixTH is working at the \nmoment.  In TH Aliens would arrive via reception just like any other \npatients, not just from emergencies.\n. From mark.l1...@hotmail.co.uk on January 08, 2013 02:40:25\nIssue 1441 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on September 30, 2013 02:39:28\nIssue 1709 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on January 20, 2014 12:24:22\nOn looking through the TH level files (SAM) alien DNA is technically always available.\nThere are also two other settings which we don't currently use #gbv.MinimumAbductTime (which is the number of years which must pass before you get aliens) and #gbv.AbductionsPerYear (a limit to the number of aliens that can arrive through the door).\nIf we are to mimic TH here, then if a disease has not been discovered any emergency would be skipped, not replaced with another one.\nSo the question is do we mimic TH or do we use the above patch to discover the disease when we get the emergency?\nMy vote is for mimic TH and skip the emergency, not replace it with another disease either. If you had enough well trained staff you would likely have discovered it soon!\n. I still think the most sensible option is to automatically decline an emergency if you can't handle it - just like in real life - it would go to one of your competitors instead.. Emergencies are essentially rewards for having a well managed hospital (as opposed to earthquakes and epidemics which are punitive). In that sense it makes sense to reward research as well as having lots of doctors and rooms.. From maartenp...@hotmail.nl on November 18, 2012 04:11:37\nYes, maybe you can record this, upload it to YouTube or something and post the link in your next comment?\n. From mark.l1...@hotmail.co.uk on December 15, 2012 11:59:48\ndo you have a save with this error?\nTrouble is that was an error with the previous version and it should now be fixed!\nWas the save created with the previous version?\nStatus: Input\n. From damjan.k...@gmail.com on December 15, 2012 12:56:57\nSorry but I don't have a save file.\nI might have started playing this level under version 0.10, but I'm not sure. Will try to get a save file if it happens again.\n. From mark.l1...@hotmail.co.uk on December 16, 2012 01:13:50\nIt doesn't matter when you started the level, but if the machine had exploded in version 0.10 then that is why you are still having the issue.  It shouldn't happen now, but if the room had already had an exploded machine it is possible the call for repair was not cancelled.  Also handymen were trying to clean the soot which caused another error.\nIf you get the error again attach the save from before the error so the devs can take a look.  Also include the gamelog.txt which is stored near your saves\n. From damjan.k...@gmail.com on December 16, 2012 01:36:10\nHere is the save file and the gamelog.\nNot sure if the savefile is any help as it is before the room exploded, but the gamelog might contain some information about the crash.\nAttachment: maybe.sav gamelog.txt\n. From mark.l1...@hotmail.co.uk on December 16, 2012 07:09:15\nFor me everything seemed to be normal and a lot of rooms exploded.\nThen when I decided to edit the staff room (handymen had no space to rest so I was going to add some sofas) the game threw an error with one of the handymen and from then two of the exploded rooms had the repair icon above them.\nI think that somehow the task to repair was assigned to handymen in the staff room and this was not cancelled when the room exploded becasue they were in the staff room.\nSavegame version changed from 54 (0.11) to 57 (Trunk). The save was created using 54 (0.11)\nError in timer handler: \n...+autoopen fax\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:219: attempt to index field 'queue' (a nil value)\nstack traceback:\n    ...+autoopen fax\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:219: in function 'action_walk_raw'\n    ...+autoopen fax\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:179: in function 'timer_function'\n    ...p\\corsixth\\Bios+autoopen fax\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n    ...th\\Bios+autoopen fax\\CorsixTH\\Lua\\entities\\staff.lua:145: in function 'tick'\n    ...op\\corsixth\\Bios+autoopen fax\\CorsixTH\\Lua\\world.lua:965: in function 'onTick'\n    ...ktop\\corsixth\\Bios+autoopen fax\\CorsixTH\\Lua\\app.lua:745: in function 'dispatch'\n    ...ktop\\corsixth\\Bios+autoopen fax\\CorsixTH\\Lua\\app.lua:647: in function <...ktop\\corsixth\\Bios+autoopen fax\\CorsixTH\\Lua\\app.lua:642>\nSummary: Equipment marked for repair even after being destroyed by quake   (was: Equipment marked for repair even after being destroyed) \nStatus: Accepted\nLabels: -Priority-Medium Priority-High Milestone-0.20\n. From mark.l1...@hotmail.co.uk on February 26, 2013 12:25:08\nI have had this error tonight.\nIt seems to happen only if you do a manual call for repair and it does not get cancelled if the machine explodes.  As with comment 1 I had made the request, had an earthquake which exploded the machine and the cog was still being displayed after the room crashed.  \nPerhaps the cancel repair only happens if it was an automatic call for repair?\n. From maartenp...@hotmail.nl on April 01, 2013 04:37:19\nLabels: -Milestone-0.20 Milestone-0.30\n. From fabian.w...@googlemail.com on July 18, 2013 02:13:40\nHello, I have a similar problem with 0.21 and no auto-repair.\nThe savegame is an autosave starting within the earthquake:\nThe earthquake will destroy inflator, electrolyser and cast remover (located right),\none op table will be damaged so much that the next use destroys it.\nShort time after, a handyman will be marked while the game crashes. (\"Try to restore?\" -> mouse has no buttonUp handler and you can't do anything.)\nI made some attempts to buy new machines while the quake still shakes, and have once managed to replace electrolyser and inflator in time. Still, the cast remover got destroyed, and you will soon after the save find a handyman causing a crash (\"empty queue\" or something).\nI think there might be a problem about repair tasks not getting removed after machine explosion? Just a guess....\nAttachment: BrokenAfterQuake.sav ReplacedSomeYetCrashes.sav\n. From fabian.w...@googlemail.com on July 18, 2013 02:14:37\nsorry, I meant no manual repair. Auto repair it is.\n. From Grim...@gmail.com on August 06, 2013 12:10:24\nThanks for the save.\nI can replicate your error with it.\n. From #641 we have confirmation that this is still an issue.\n. From mark.l1...@hotmail.co.uk on December 30, 2012 12:28:54\nI think this was the same in TH, it is as if the edge of the loo is built into the wall.  There are some other objects that do the same, desks is one ( the ones the juniors use in the training room)\n. From Grim...@gmail.com on December 30, 2012 15:04:11\nI agree with Mark here. I think this is how it is meant to be. \nWe could of course fix this by designing the toilet a little different when we start to make our own graphics.\n. From maartenp...@hotmail.nl on February 05, 2013 10:56:57\nI added this issue to issue #1494 (this is a list of all knows graphical glitches.)\n. From mark.l1...@hotmail.co.uk on April 22, 2013 04:45:57\nIssue 1595 has been merged into this issue.\n. From maartenp...@hotmail.nl on February 05, 2013 10:57:13\nI added this issue to issue #1494 (this is a list of all knows graphical glitches.)\n. From mark.l1...@hotmail.co.uk on January 04, 2013 00:42:56\nIf you are using windows there is a shortcut in the corsixth folder off the start menu.  There you will find saves, autosaves and the gamelog.txt file\nIf you still have the save upload it here along with the gamelog.txt \nThis sounds like a new error -  being able to pick up the handymen even though they are stuck - so the save and gamelog.txt  will be very useful.\n. From r.wiels...@gmail.com on January 06, 2013 05:24:35\nI don't have an autosave from before the error, but this one will do to see the problem. Any time a handyman enters the inflation clinic, it gets stuck. \nI've continued playing after i removed inflation and built a new one somewhere else in the building, so i hope you can find the bit of gamelog where the handymen get stuck. (the game was saved on 4-1-2013 at 0:11, maybe that helps)\nAnd you'll find a lot of other things in the gamelog, I've found some doctors got stuck too, and i could pick them up (not in this savegame)\nHope this helps!\nAttachment: handymen.sav gamelog.txt\n. From mark.l1...@hotmail.co.uk on January 06, 2013 06:27:17\nI am no expert, but I did notice that one got stuck in the inflation clinic and he was supposed to be reparing the fracture clinic machine next door.  I unstuck him and he repaired the fracture clinic machine through the wall of the inflation clinic.\nI hope this helps one of the developers.\n. From r.wiels...@gmail.com on January 06, 2013 14:50:14\nHow did you unstuck him? I'd like to know so i can do that too ;)\nOp 6 jan. 2013 om 15:27 heeft corsix-th@googlecode.com het volgende geschreven:\n. From mark.l1...@hotmail.co.uk on March 18, 2013 13:50:10\nSummary: Possible to repair fracture clinic machine which in adjacent clinic through the wall!   (was: All handymen get stuck) \n. From mark.l1...@hotmail.co.uk on March 19, 2013 05:29:46\nSummary: Possible to repair fracture clinic machine which is adjacent clinic through the wall!   (was: Possible to repair fracture clinic machine which in adjacent clinic through the wall!) \n. From r.wiels...@gmail.com on March 19, 2013 08:46:23\nI don't get it.\n. From Grim...@gmail.com on January 17, 2013 21:05:30\nWow, that was a severe error!\nStatus: Accepted\n. From maartenp...@hotmail.nl on February 05, 2013 10:57:24\nI added this issue to issue #1494 (this is a list of all knows graphical glitches.)\n. From maartenp...@hotmail.nl on April 07, 2013 10:19:32\nSummary: Graphical glitch when using video game next to ech other   (was: Using Video game>graphical glitch) \n. From maartenp...@hotmail.nl on April 07, 2013 10:19:56\n;)\nSummary: Graphical glitch when using video game next to each other   (was: Graphical glitch when using video game next to ech other) \n. From roujin.mw on January 18, 2013 13:44:57\nGood point, I'm adding it to my list.\nOwner: roujin.mw\n. From mark.l1...@hotmail.co.uk on January 19, 2013 12:32:15\nNo, he is lifting it out of the way so he can get out of the room.  :-)\nOn a serious note, I have also noticed that patients now seem to walk through the helecopter too.\n. From maartenp...@hotmail.nl on February 05, 2013 10:57:36\nI added this issue to issue #1494 (this is a list of all knows graphical glitches.)\n. From roujin.mw on January 22, 2013 05:53:43\nThis would improve usability quite a bit and is definitely a functionality I would like to have in textboxes. However it is not as easy as it sounds:\nFirst, text selection needs to be implemented. The logic of this is not very hard to do, but the visuals raise some questions.\nSecond, ideally the copy-paste functionality would not be limited to the textbox or within CorsixTH, but use the OS's clipboard. This would need implementation on the c++ side, most probably even platform-specific.\nSo to summarize: Not a task I feel like taking on at the moment.\nSummary: Copy/paste functionality in Textboxes   (was: Ctrl+V en Ctrl+C as copy/paste by LuaConsole) \nStatus: Queued\nLabels: -Type-Suggestion Type-Enhancement\n. From maartenp...@hotmail.nl on July 04, 2013 12:53:56\nLabels: -Priority-Medium Priority-Low\n. From roujin.mw on January 23, 2013 11:42:07\nOpenGL version, I guess? Also, does it work when using SDL?\n. From mark.l1...@hotmail.co.uk on January 23, 2013 11:52:29\nOpengl yes, I will have to download sdl to check it out\nDirectory selection is fine with saved games etc\n. From mark.l1...@hotmail.co.uk on January 23, 2013 11:59:56\nSDL works, not sure about directx as I can't compile.  (I always get errors about lpeg and lfs)\nThe space for showing the path could do with being a little wider - for me it just fits with C:\\Games\\bullfrog\\Hospital.  As does width height and height is just overlapping the edge.\nThen again I think this is mentioned elsewhere about buttons not being wide enough for some translations isn't it?\nSummary: Directory selection screen does not show path/directory names (OpenGL)   (was: Directory selection screen does not show path/directory names) \n. From roujin.mw on January 23, 2013 12:26:28\nYeah, suspected that much. By the way, I added labels for the different renderers to the issue tracker recently, so they can be used instead or additionally to writing it into the summary.\nAbout the other issues concerning the option window: Yes, I'm aware of it. I'm not fully done yet with the options window, some more things will get changed there in a bit.\nCc: -roujin.mw\nLabels: Renderer-OpenGL\n. From baker.st...@gmail.com on January 28, 2013 09:55:59\nI can confirm this affects both the Windows and Linux OpenGL versions the same way with NVidia and ATI cards.\n. From maartenp...@hotmail.nl on July 05, 2013 00:40:42\nIssue 1662 has been merged into this issue.\n. Verified working in the latest master. Likely fixed with the move to SDL2.\n. From maartenp...@hotmail.nl on January 24, 2013 07:54:09\nWill this fix any issues?\n. From baker.st...@gmail.com on January 25, 2013 08:17:09\n@maarten: It prevents the game from crashing when the queue is nil.  AFAIK the queue should never be nil in the first place, but it happens sometimes.  I wonder if there should also be a message, at least in debug mode.\n. From baker.st...@gmail.com on January 25, 2013 08:22:31\nIssue 1475 has been merged into this issue.\n. From baker.st...@gmail.com on January 25, 2013 08:22:59\nSecond part of patch from 1745:\n206c206\n<   for i, person in ipairs(queue) do\n\n\nfor i, person in ipairs(queue or {}) do\n319c319\n<   if action.is_in_queue then\n\n\n\nif action.queue and action.is_in_queue then\n348,349c348,351\n<   queue:unexpect(humanoid)\n<   queue:push(humanoid, action)\n\n\n\nif queue then\n      queue:unexpect(humanoid)\n      queue:push(humanoid, action)\n  end\n364c366\n<   if queue.same_room_priority then\n\n\n\nif queue and queue.same_room_priority then\n. From baker.st...@gmail.com on January 25, 2013 08:25:32\n\nSummary: Prevent crash when queue is nil   (was: Patch for /trunk/CorsixTH/Lua/humanoid_actions/walk.lua) \n. From edvin.li...@gmail.com on January 25, 2013 09:32:08\nIt all depends on in which situation the check is made. If the humanoid as a result will just stand with nothing to do somewhere instead of a crash it might be desirable to not fix it like this since it will be even harder to find the root cause. If it on the other hand just prevents the game from crashing in a situation where the call is superfluous anyway it's fine to add a precaution like this imo.\n. From baker.st...@gmail.com on January 25, 2013 13:38:48\n@edvin.linge: I can't speak for this particular patch, but I think in general it would be helpful to distinguish debug versions for developers, and versions for players.\nIn C typically people would define NDEBUG for release versions which disables all their asserts, because crashing is helpful for developers, but bad for players.  As is it seems we crash in a lot of cases where something is wrong that devs need to be aware of, but for the ordinary player, we really don't need to.\n(It's my personal opinion that this patch goes too far in the other direction, hiding the problem as you said.)\n. From mark.l1...@hotmail.co.uk on February 28, 2013 13:07:37\n@7\nI like this idea, there are times the crash means nothing but an annoyance to the player, but like you say are useful if you are testing.\nWould it be possible to have the crashes like empty action queue or where an assert causes a problem that these are only known if you are in debug mode and otherwise there is a fallback of some sort that allows the game to continue?  For instance, on empty action queue or can't find proper idle the fall back could be go home or seek reception.  The player would not think anything was odd, but for anyone in debug you could still see the error and its log.\nWe are already part way there with the message that now pops up, (there was a problem with this person) but that could be changed to a default of send home/sack unless it is debug - maybe?\n. From edvin.li...@gmail.com on February 28, 2013 22:14:12\nThe update I made a few months ago that lets you choose if a humanoid should go home after that humanoid had an empty action queue is probably as far as we can go. Patients suddenly going to the reception is not exactly expected behaviour so players would just get confused if we try to handle errors too gracefully.\nCan't find proper idle and when queue is nil should be handled better in the same way though. At the same time we really need the bug reports, otherwise we will never find out about them.\n. From maartenp...@hotmail.nl on April 27, 2013 06:24:47\nStatus: Queued\nLabels: -Type-Patch Type-Enhancement Priority-Low\n. From mark.l1...@hotmail.co.uk on February 02, 2013 07:19:44\nI noticed that if you select a 4:3 resolution it is in the right place.\n. From maartenp...@hotmail.nl on May 27, 2013 10:46:23\nLabels: -Priority-Medium Priority-Low\n. From maartenp...@hotmail.nl on February 02, 2013 09:40:14\nI think that this issue is related to issue #350 ? And I'm using the SDL-version.\n. From mark.l1...@hotmail.co.uk on February 02, 2013 12:39:51\nand you don't see a message like this?\nAttachment: 7.png\n. From maartenp...@hotmail.nl on February 02, 2013 12:46:03\nNo, only the lua-console which crashes immediatly.\n. From maartenp...@hotmail.nl on July 15, 2013 10:14:10\nIssue 1614 has been merged into this issue.\n. From maartenp...@hotmail.nl on August 04, 2013 10:00:09\nI think that this is caused by my bad video card. Is there someone who could reproduce this crash?\nStatus: New\nLabels: -Priority-Medium Priority-Low\n. From Grim...@gmail.com on August 06, 2013 05:48:05\n1600x1200 did not work (crash), but I think that is because of my laptop video card.\n1366x758 worked fine.\nI guess this is up to the video cards.\nCan test this further when I get home to my desktop PC which should handle all the resolutions.\nOr someone else can give it a try.\nStatus: Input\n. From Grim...@gmail.com on August 06, 2013 06:22:59\nSorry. I misread this.\n1600x1200 is bigger than my screen size, and it crashed.\n1366x758 is smaller, and didn't crash.\nI guess this error is still valid.\n. This doesn't crash anymore. In fullscreen it scales so everything is tiny, and in windowed it just makes big windows.\n. From maartenp...@hotmail.nl on July 04, 2013 12:58:06\nLabels: -Priority-Medium Priority-Low\n. From Alberth2...@gmail.com on February 07, 2013 11:55:26\nA 'reload' made the attachment disappear, here it is\nAttachment: Autosave6.sav\n. From mark.l1...@hotmail.co.uk on February 07, 2013 13:41:15\nWith windows 7 I don't get this error, so maybe it is limited to Linux. (So I am changing the label to Linux)\nThe quake was very violent with the screen dancing all over, I don't know if that is related to the error or not.\nLabels: OpSys-Linux\n. From Alberth2...@gmail.com on February 08, 2013 09:57:06\nI thought later it might have to do with the size of the window.\nBelow are the settings from my config\nwidth = 1200 \nheight = 900 \nfullscreen = false\n. Looks very much like #124 and #155. It would have been nice to have known that the values were.\n. I believe this was a duplicate of #124 \n. From baker.st...@gmail.com on February 10, 2013 13:45:53\nPulling actual back traces on the errors they appear to be in THCursor.  The errors only happen when the game first opens before the intro video or main menu.\n0  0x0409409d in SDL_UpperBlit () from /usr/lib/libSDL-1.2.so.0\n1  0x0809bdbf in THCursor::draw (this=0x942d99c, pCanvas=0x737d204, iX=0, iY=0)\nat /home/stephen/github/corsix-th/CorsixTH/Src/th_gfx_sdl.cpp:879\n\n2  0x0809a215 in THRenderTarget::endFrame (this=0x737d204) at /home/stephen/github/corsix-th/CorsixTH/Src/th_gfx_sdl.cpp:119\n3  0x080812dd in l_surface_end_frame (L=0x5f1c028) at /home/stephen/github/corsix-th/CorsixTH/Src/th_lua_gfx.cpp:629\n4  0x0412adf3 in ?? () from /usr/lib/liblua5.1.so.5.1\n5  0x0413517e in ?? () from /usr/lib/liblua5.1.so.5.1\n6  0x0412b218 in ?? () from /usr/lib/liblua5.1.so.5.1\n7  0x04126f67 in lua_call () from /usr/lib/liblua5.1.so.5.1\n8  0x0806bd17 in CorsixTH_lua_main (L=0x5f1c028) at /home/stephen/github/corsix-th/CorsixTH/Src/main.cpp:197\n9  0x0412adf3 in ?? () from /usr/lib/liblua5.1.so.5.1\n10 0x0412b1c8 in ?? () from /usr/lib/liblua5.1.so.5.1\n11 0x04125b30 in ?? () from /usr/lib/liblua5.1.so.5.1\n12 0x0412a524 in ?? () from /usr/lib/liblua5.1.so.5.1\n13 0x0412b3af in ?? () from /usr/lib/liblua5.1.so.5.1\n14 0x04127002 in lua_pcall () from /usr/lib/liblua5.1.so.5.1\n15 0x08069c28 in main (argc=1, argv=0xbeac8604) at /home/stephen/github/corsix-th/CorsixTH/SrcUnshared/main.cpp:85\n0  0x040794e5 in ?? () from /usr/lib/libSDL-1.2.so.0\n1  0x04093f30 in SDL_LowerBlit () from /usr/lib/libSDL-1.2.so.0\n2  0x040941b7 in SDL_UpperBlit () from /usr/lib/libSDL-1.2.so.0\n3  0x0809bdbf in THCursor::draw (this=0x942d99c, pCanvas=0x737d204, iX=0, iY=0)\nat /home/stephen/github/corsix-th/CorsixTH/Src/th_gfx_sdl.cpp:879\n\n4  0x0809a215 in THRenderTarget::endFrame (this=0x737d204) at /home/stephen/github/corsix-th/CorsixTH/Src/th_gfx_sdl.cpp:119\n5  0x080812dd in l_surface_end_frame (L=0x5f1c028) at /home/stephen/github/corsix-th/CorsixTH/Src/th_lua_gfx.cpp:629\n6  0x0412adf3 in ?? () from /usr/lib/liblua5.1.so.5.1\n7  0x0413517e in ?? () from /usr/lib/liblua5.1.so.5.1\n8  0x0412b218 in ?? () from /usr/lib/liblua5.1.so.5.1\n9  0x04126f67 in lua_call () from /usr/lib/liblua5.1.so.5.1\n10 0x0806bd17 in CorsixTH_lua_main (L=0x5f1c028) at /home/stephen/github/corsix-th/CorsixTH/Src/main.cpp:197\n11 0x0412adf3 in ?? () from /usr/lib/liblua5.1.so.5.1\n12 0x0412b1c8 in ?? () from /usr/lib/liblua5.1.so.5.1\n13 0x04125b30 in ?? () from /usr/lib/liblua5.1.so.5.1\n14 0x0412a524 in ?? () from /usr/lib/liblua5.1.so.5.1\n15 0x0412b3af in ?? () from /usr/lib/liblua5.1.so.5.1\n16 0x04127002 in lua_pcall () from /usr/lib/liblua5.1.so.5.1\n17 0x08069c28 in main (argc=1, argv=0xbeac8604) at /home/stephen/github/corsix-th/CorsixTH/SrcUnshared/main.cpp:85\n. From maartenp...@hotmail.nl on July 15, 2013 07:39:52\nBut how this affects gameplay? Will the game crash or something. Sorry, but I don't understand this issue, could you explain it?\n. From stephen....@ermscorp.com on July 15, 2013 07:47:28\nIt indicates that something unintentional/random is happening in the code.  You would normally want the code to initialize (set the value) of a variable before any code that relies on the value of that variable.  What these messages indicate is a case where that isn't happening.\nOnce someone followed up on it enough to know exactly how it would affect game play in this case they would already know enough to fix it.  I was looking for something else at the time and didn't investigate far enough to determine the cause or full impact here - but there is a code error.\n. From maartenp...@hotmail.nl on July 15, 2013 07:51:37\nOk, thank you Stephen for the explanation. But how did you get those messages from the main post and comment one? Through the Lua console?\n. From baker.st...@gmail.com on July 15, 2013 08:37:30\nUsing Valgrind ( http://valgrind.org/ ) A tool for finding memory leaks and other memory related errors that are all too common in C/C++ programs.  I was using it to find/fix memory leaks in my movie code at the time.\n. From maartenp...@hotmail.nl on July 15, 2013 11:18:15\nNow I understand it! :)\n. Closing because this is about SDL 1.2\n. From baker.st...@gmail.com on February 09, 2013 16:05:57\nOwner: ---\n. From maartenp...@hotmail.nl on March 19, 2013 13:20:13\nI mailed a developer of SDL_mixer about this bug. Hopefully he will fix this issue.\n. From maartenp...@hotmail.nl on March 22, 2013 06:41:09\nI've reported this here: http://bugzilla.libsdl.org/show_bug.cgi?id=1767 . When you have more information about this problem, please add it to that bug report, so they can fix it.\n. From maartenp...@hotmail.nl on March 23, 2013 13:26:32\nThe developer asked this: ''Is midiOutSetVolume() setting the system wide volume?  If that's the case, the only solution I can think of is to use the built-in timidity support for software midi instead.'' Could someone give an answer or add a comment to that bug report?\n. From baker.st...@gmail.com on March 23, 2013 13:40:58\nYes it is and it was a known issue.  I think the set volume in that funtion\nmay not be necessary but there was a comment that it works around another\nbug\naudio:pauseBackgroundTrack mutes all sound in windows\nvolume?  If that's the case, the only solution I can think of is to use the\nbuilt-in timidity support for software midi instead.'' Could someone give\nan answer or add a comment to that bug report?\n. From maartenp...@hotmail.nl on March 23, 2013 14:31:22\nI think something went wrong at your comment? But I reported it to the developer.\n. From baker.st...@gmail.com on March 23, 2013 21:05:21\nAh yes that went crazy.  Tried an email reply on my phone.  So you missed the main point.  Our pause function does set the volume to work around another bug.  I don't know if the other bug still exists so maybe we can get rid of just that line.\n. From maartenp...@hotmail.nl on March 24, 2013 02:01:51\nBut what was that bug?\n\nDate: Sun, 24 Mar 2013 04:05:41 +0000\n. From maartenp...@hotmail.nl on March 24, 2013 02:58:29\n\nBut about which line you're talking about (string, file etc.)? Maybe someone could make a patch to remove this line, so I and others can test it? Attached is a patch that re-activates the pause function, which was disabled in r2055 . Whith this patch we can test if the pause function works when we remove that line.\nAttachment: Pause_reactivate.patch\n. From maartenp...@hotmail.nl on April 09, 2013 13:44:30\nLabels: -Priority-Medium Priority-Low\n. From maartenp...@hotmail.nl on July 04, 2013 13:00:32\nLabels: -Priority-Medium Priority-Low\n. From mark.l1...@hotmail.co.uk on August 19, 2013 11:19:52\nIt will do that, it is saving the game as it is at that moment in time.\nIf you saved a game whilst there was an earthquake, the earthquake would continue when you reloaded!\nStatus: Queued\n. From edvin.li...@gmail.com on February 14, 2013 23:47:57\nIn r2056 I fixed the error that your placement of staff is cancelled just because you happen to click on a door or the reception. Left to fix is to allow players to place the receptionist on top of the reception. This is a special case, and the reason that it isn't allowed at the moment is that the \"spawn action\" when a humanoid is created (for example when a member of staff is placed) requires two tiles. It is of course possible to make a special case, but it will require some coding and making sure everything still works.\nGenerally nice finds you report here! Good work. :-) I can give you some pointers to help you get started if you want to contribute some time. :-) The first step is always to look around in the folder structure, check out the trunk, possibly try compiling and looking at some Lua code - if it is coding you want to do that is...\nSummary: Bad for new players: Unable to place new receptionists on top of the desk   (was: Placing new Receptionists on Desk cause Desk Queue to appear) \nStatus: Queued\n. From Tustin2...@gmail.com on February 15, 2013 08:05:47\nIf it makes it easier to implement, you could well make it so when the receptionist is placed directly on the desk like this, she is immediately staffing the desk without having to queue an action for her to get there (essentially skip using checkForNearbyStaff() in favor of direct assignment on click). I don't think the player would notice or care. (That's assuming this isn't skipping any normal steps of hiring a new employee).\nAlso, I have been looking at the code. I've done a bunch of OO languages, but I'm relatively new to Lua; so I'm fascinated by the class implementation you guys have here, and glad for it. :)\n. From maartenp...@hotmail.nl on February 18, 2013 10:54:19\nI think you've got an (recovervle) error before this problem occured? So, could you post gamelog.txt and maybe some other autosaves from before the problem?\n. From christia...@gmail.com on February 18, 2013 11:00:08\nUnfortunately I didn't save the gamelog (and I've played quite a bit since), but I've attached a save from a couple of minutes before I discovered the bug happening. Hopefully that will help.\nAttachment: stuck2.sav\n. From mark.l1...@hotmail.co.uk on February 18, 2013 11:12:51\n@ 2\nUnless you have had other errors since there is a good chance that the error log saved itself.  You will find it near to where the saves are.\n. From christia...@gmail.com on February 18, 2013 11:21:52\nI had a few further errors since then, but in case it is of any use I am attaching my current gamelog.txt.\nApologies for the general lack of information; I played another level for a while before going back to that savegame and realising the doctor had got stuck.\nAttachment: gamelog.txt\n. From lizanne....@gmail.com on April 30, 2013 03:05:18\nI have a similar problem with 2 handymen and a patient.  One of the handy men is stuck on the helipad and the other is watering a plant near the operating theatre.  The patient is stuck trying to exit the scanner room.\nMy gamelog is attached\nAttachment: gamelog.txt\n. From maartenp...@hotmail.nl on April 30, 2013 04:05:00\n@5 I indeedly see the same error here, but could you also provide some autosaves from before these errors occured? But I also see a Stripped Male Patient error, which let me think of issue #953 and issue i256. A stripped male patient should have walked out the door of the general diagnosis room without clothes. When you provide us with the saves, we can investigate this.\n. From maartenp...@hotmail.nl on April 30, 2013 04:05:24\nI of course mean issue #1256 !\n. From fabien.c...@gmail.com on August 17, 2013 15:16:45\nI've the same problem too. I've corsix th 0.21 on winxp sp3. I join a savegame that can reproduce the bug.\nLoad it, we are 5 mars, go on surgery room, and wait for operation begin, at 8 mars  : if you pick the bottom doctor (WARTON), then the whole room will be locked. You cant pick doctor WHY, and you cant pick the patient too.\nAttachment: before.sav\n. From mark.l1...@hotmail.co.uk on May 27, 2013 11:04:13\nIs this really an issue?\nThe demo has one level, if the player likes the game they buy it.\nI am not sure we should worry whether or not someone using the demo data can load other saved games as this could give them no reason to support EA and buy the full game\nStatus: Input\n. From mark.l1...@hotmail.co.uk on July 10, 2013 08:25:02\nAs we have now established that the demo should only have the one map to play, this is not really an issue.\nThere is nothing to stop someone from getting hold of the full game as it is freely available and not that expensive.\nUnless Edvin thinks we could perhaps have a system that closes open menus on load or something, I'll mark this as invalid?\nStatus: Invalid\nCc: edvin.li...@gmail.com\n. From edvin.li...@gmail.com on July 10, 2013 10:54:33\nWe still need to handle the case that someone has got a saved game from a pal and tries to load it. It should in that case say that the save was made using the full game imo, and then return to main menu.\nStatus: Queued\nLabels: -Priority-Medium Priority-Low\n. Related but not a duplicate I think.\n. From baker.st...@gmail.com on March 17, 2013 06:23:38\nMarkL, when we discussed this before, didn't we determine that there was always some other OpenGL corruption in the game beforehand in these cases, and when there was no corruption the movies played?\n. From mark.l1...@hotmail.co.uk on March 17, 2013 10:31:12\nYes, but it happens now even when there is no other corruption.\nPerhaps it is just opengl, the intro plays fine as do the level movies.\nLabels: Renderer-OpenGL\n. From baker.st...@gmail.com on March 19, 2013 19:20:23\nMarkL could you paste what you sent to my email here.  And any information that might possibly be related (32 bit or 64 bit, screen resolution, window or full screen...)  I'll try to find a debug version of swscale that might dump some more useful information too.\n. From baker.st...@gmail.com on March 19, 2013 19:36:44\nAlso can you determine if it's one specific lose movie.  Maybe modify the lua to pick a certain one, then increment it to the next and so on.\nException code: 0xc0000005 is an access violation, but based on my search it could be anything, from bad drivers to invalid memory access somewhere in the application.\n. From mark.l1...@hotmail.co.uk on March 20, 2013 03:20:53\nalso posted in the other issue\nI have had a look in the windows events log and here is what\u2019s there \u2013 not sure if this helps or not, they relate to errors with both DX and OpenGL.  There is mention of something called \"Action Center control panel\".  Not sure what or where that is, but I will try and find it tonight.\nFaulting application name: CorsixTH_DirectX.exe, version: 0.0.0.0, time stamp: 0x51478100\nFaulting module name: swscale-2.dll, version: 0.0.0.0, time stamp: 0x50e4de5c\nException code: 0xc0000005\nFault offset: 0x000000000001ee9c\nFaulting process id: 0x1860\nFaulting application start time: 0x01ce24de98de166f\nFaulting application path: C:\\Program Files\\CorsixTH\\CorsixTH_DirectX.exe\nFaulting module path: C:\\Program Files\\CorsixTH\\swscale-2.dll\nReport Id: e3770be7-90d1-11e2-b11e-8c89a5160b8f\nThe program CorsixTH_OpenGL.exe version 0.0.0.0 stopped interacting with Windows and was closed. To see if more information about the problem is available, check the problem history in the Action Center control panel.\nProcess ID: e38\nStart Time: 01ce24d51d713b0b\nTermination Time: 8\nApplication Path: C:\\Program Files\\CorsixTH\\CorsixTH_OpenGL.exe\nReport Id: 96054766-90c8-11e2-b11e-8c89a5160b8f\nFaulting application name: CorsixTH_OpenGL.exe, version: 0.0.0.0, time stamp: 0x5144de8d\nFaulting module name: swscale-2.dll, version: 0.0.0.0, time stamp: 0x50e4de5c\nException code: 0xc0000005\nFault offset: 0x000000000001ee9c\nFaulting process id: 0xca8\nFaulting application start time: 0x01ce24d464073f1e\nFaulting application path: C:\\Program Files\\CorsixTH\\CorsixTH_OpenGL.exe\nFaulting module path: C:\\Program Files\\CorsixTH\\swscale-2.dll\nReport Id: b63be331-90c7-11e2-b11e-8c89a5160b8f\nAt the moment it has been the 64 bit version I have tested, but it was also a problem last week with 32 bit.  Windows 7 1600x900 and if in a window 640x480.\nIt has been with different movies as you can tell with the sound that is looping which one was coming up and in the couple of times I did get a visual it was a differnt lose movie.\n. From baker.st...@gmail.com on March 20, 2013 14:56:52\nI need more reports on this so we can compare hardware and software and isolate the cause.  MarkL do you have more than one computer?  As well, you've noted that this happens in both OpenGL and DirectX, does it happen only in windowed or fullscreen or both?\nIt might help to also know your GPU and driver version, so we can see if there's a pattern there.\nThe comment about the different lose movie is interesting... is it from a lose movie that was played in the same session earlier?\nLabels: Renderer-DirectX\n. From Grim...@gmail.com on March 20, 2013 15:40:56\nIn directx, the lose movie is just black for me, nothing else is wrong.\nBut maybe I have to try some more times..\nDirectX\nWin 7 64b\nFullscreen\nASUS P8P67 PRO B3, Socket-1155, with Gainward GeForce GTX 560Ti 2GB PhysX\nDriver version? For the GFX card or?  In that case it is 311.06\n. From mark.l1...@hotmail.co.uk on March 21, 2013 12:20:31\nMain computer Windows 7 Home Premium\nService pack 1\nIntel core i3-2100 CPU @ 3.10GHz\n8GB RAM 64 bit OS\nIntel HD Graphics Driver 8.15.10.2342\nOpenGL both window and full screen\nIntro plays\nOpening menu is corrupted with cursor trails\nlevel change movie plays\nOn full screen the lose movie sound plays to the end and loops, there is no \npicture, but you can hear the car pull up so it's lose4\nOn window first attempt there was no movie or sound, all you could hear were \nthe back ground sound effects from the game in a loop\nsame on second attempt, but then on the third there was no movie at all - \njust the reason why I lost.  On the fourth attempt the movie stopped near to \nthe start,  it was the one where the Dr is slumped on the desk so lose2 - \nthen the game crashed.   This crash generated an error in event viewer\nFaulting application name: CorsixTH_OpenGL.exe, version: 0.0.0.0, time \nstamp: 0x51478098\nFaulting module name: swscale-2.dll, version: 0.0.0.0, time stamp: \n0x50e4de5c\nException code: 0xc0000005\nFault offset: 0x000000000001ee9c\nFaulting process id: 0x11e8\nFaulting application start time: 0x01ce266792e35dcd\nFaulting application path: C:\\Program Files\\CorsixTH\\CorsixTH_OpenGL.exe\nFaulting module path: C:\\Program Files\\CorsixTH\\swscale-2.dll\nReport Id: e1a2cb5b-925a-11e2-85bb-8c89a5160b8f\nI do have two other computers, one XP and the other ME, I  have not used \neither in months though.\nAlso, off topic a bit I did try the DX version on the works computer which \nis XP and got the same missing dll message I had on Sunday.  Same fix \nworked, but I wonder whether you have a newer version of DX and whether \nothers may get the same message.  Would it be worth adding something to \nchangelog.txt and providing a link to the fix http://www.microsoft.com/en-gb/download/details.aspx?id=35\n. From maartenp...@hotmail.nl on March 21, 2013 12:44:13\nYes, I think you could add something about this to changelog.txt and maybe also to readme.txt?You could also place it on this page on the wiki: https://code.google.com/p/corsix-th/wiki/FrequentlyAskedQuestions.Maybe you could also add the workaround for the black-screen-issue when using DirectX and playing movies? Just a few more days to the next release! :)\n\nDate: Thu, 21 Mar 2013 19:20:38 +0000\n. From maartenp...@hotmail.nl on March 21, 2013 12:46:33\n\nSorry, maybe is of course not a part of the hyperlink: https://code.google.com/p/corsix-th/wiki/FrequentlyAskedQuestions\n. From maartenp...@hotmail.nl on April 01, 2013 07:38:36\nLabels: -Priority-Medium Priority-High\n. From maartenp...@hotmail.nl on May 27, 2013 10:53:03\nI see no one else with the same strange crash.\nLabels: -Priority-High Priority-Medium\n. From mark.l1...@hotmail.co.uk on May 27, 2013 11:06:19\nhave you tried to reproduce it?\n. From maartenp...@hotmail.nl on May 27, 2013 11:12:18\nYes, and I couldn't reproduce it, but I will try it again! And the results are: I can't reproduce the crash with the OpenGL and the DirectX version.\n. From mark.l1...@hotmail.co.uk on May 27, 2013 11:25:54\nCan you post details of your computer and graphics card as I did in #8, this may help determine if it is hardware /driver specific?\n. From maartenp...@hotmail.nl on May 27, 2013 11:29:47\nOk:\nWindows 7 without SP1 32-bit\n4GB Ram\nIntel Core 2 Duo E4400 @ 2.00GHz\nIntel 82945G Express Chipset Family (with up-to-date drivers.)\n. From mark.l1...@hotmail.co.uk on August 30, 2013 08:07:52\nDiscovered today that the movies are duplicated in the anims folder so not only do we have lose1.smk we also have 320X2401.SMK which is the same movie.  Found this out from the new check on TH data we have.\nSo at some point some of my files have been deleted or not copied over correctly and I did not have the files \"320x240\".\nAfter copying these over from the CD and testing the cheat I did not get the crash that I had before.\nI will therefore mark this as not valid as I think I was the only person that had this issue. (Sorry Stephen) \nOr do you think we could handle this better by having a notice show if a movie file is missing that then disables global movies rather than it crashing Edvin?\nStatus: Invalid\nCc: edvin.li...@gmail.com\n. From baker.st...@gmail.com on August 30, 2013 08:18:42\n@markl: There's a few things that don't sound right about that.\nA.  I'm using LOSE%d+ to get the list of LOSE movies in the ANIMS folder in order to select which ones to play.\nB.  There is an error message if for some reason the file doesn't exist, and it doesn't crash.  It should also skip with an error any movie which isn't actually a movie (like if you saved a text file as LOSE1.SMK).  It's possible that more subtle forms of corruption wouldn't be caught.\n. From mark.l1...@hotmail.co.uk on August 30, 2013 08:47:33\nI'll leave it open then.\nOdd though that I got a message today about 320x240 being missing which I had never even noticed before.  Then after copying these over and then testing the lose cheat and it did not crash.\nWhat I will do later is remove these from anims and then using a copy of Corsix that I have not updated to see if I can get the error.  Could my error have been fixed for some time and I have only just noticed?  To be honest I turned them off months ago when I was getting errors and only turned them on today because of this new missing data message.\nStatus: Queued\n. From mark.l1...@hotmail.co.uk on August 30, 2013 11:19:57\nOkay did that and once out of ten tests the movie did not play, the rest of the time it did and I never got an error or crash.\nSo if it has nothing to do with the 320x240 files, perhaps a windows update since March sorted things out.\nDo you want to keep this open Stephen?\n. From mark.l1...@hotmail.co.uk on March 15, 2013 03:43:44\nOr perhaps the game should pause when you have a fullscreen menu open, like with the end of year awards.  Although, I did notice that this is now behind the pause tint.\nStatus: New\n. From mark.l1...@hotmail.co.uk on May 28, 2013 12:08:02\nWhat do others think about the game pausing (without the tint) when any full screen window is open?\nPerhaps make it the default behaviour and have an option that turns this off, could even link it to the adviser option.  Game pauses if you have the adviser on and not if he is turned off.\nStatus: Input\n. From Grim...@gmail.com on May 28, 2013 12:57:27\nI like your idea Mark, but I personally wouldn't like that it was linked to the adviser.\nI think it should have its own option to turn on/off.\n. From Alberth2...@gmail.com on May 28, 2013 13:23:15\nI often miss the announcements because I am too busy with something else.\nA way to get the last or second last message would be useful (or a history of messages)\n. From maartenp...@hotmail.nl on July 15, 2013 10:22:34\nI would also really like the idea of adding a history-of-adviser-messages-screen. And I also think that it would be a good idea that the game would pause when a fullscreen window is open. And that blue tint can then maybe be ''removed'' in the same way as is done here: https://code.google.com/p/corsix-th/issues/detail?id=1038#c23 .\nSummary: Advisor message are shown behind the screen and history-of-adviser-messages-screen   (was: Advisor message are shown behind the screen) \nStatus: Accepted\n. From maartenp...@hotmail.nl on March 18, 2013 06:20:45\nI can reproduce this with all movies.\n. From mark.l1...@hotmail.co.uk on March 18, 2013 14:04:18\nI have noticed that for DirectX it works okay in a window and I get sound only if in full screen.  I don't know if this will help you track it down, but you also get a black screen for the game when you switch from window to fullscreen and have to restart the game.\n. From baker.st...@gmail.com on March 18, 2013 14:17:13\nOh, yes I can reproduce if the game is fullscreen, works fine in a Window.  Maarten, is this what you're seeing?\nAt least if I can reproduce I have a chance of fixing it :)\n. From baker.st...@gmail.com on March 18, 2013 18:06:08\nI have a bad feeling that to make DirectX work properly I should be drawing to a DirectX surface instead of an SDL YUV_Overlay on the SDL surface.  That's not going to be an overnight patch.\n. From Grim...@gmail.com on March 18, 2013 18:42:50\nI can replicate it just like Mark says in comment 2, but:\nIf you start the game in directx full screen, press the windows button, and then go back to the game screen, then you see video in full screen too. Maybe this help you sort out the problem too?\nBy the way, in directx full screen, if I turn off the full screen option in the menu, my screen goes black and I have to ALT+F4 (or CTRL+ALT+DEL) the game. When I open the game again, it is in a window mode and working like it should. \nThis only happens with directx, not with the other modes.\n. From baker.st...@gmail.com on March 18, 2013 18:50:17\nGrimdoc's workaround works for me too.  Perhaps that invalidates the directx handle on the window; I should be able to add a hook to do that - something to try tomorrow.\n. From maartenp...@hotmail.nl on March 18, 2013 23:32:30\nI will test if this workaround works, but maybe we could add some information to the Wiki-page about this bug and the workaround until we have fixed this problem?\n@3 Yes, I think that this is what I'm seeing.\n. From maartenp...@hotmail.nl on March 19, 2013 08:22:49\nThe workaround works! Maybe we should add some information about this to the Wiki-page?\n. From baker.st...@gmail.com on March 19, 2013 19:42:32\n@Grimdoc: I don't see an issue for that second bug you mentioned, but I encountered it myself and it seems pretty serious.  Is there an issue I missed, or if not would you mind making one?\n. From mark.l1...@hotmail.co.uk on March 20, 2013 03:07:57\nI think that it might be this one Issue 350\n. From mark.l1...@hotmail.co.uk on March 20, 2013 03:15:37\nI have had a look in the windows events log and here is what\u2019s there \u2013 not sure if this helps or not, they relate to errors with both DX and OpenGL.  There is mention of something called \"Action Center control panel\".  Not sure what or where that is, but I will try and find it tonight.\nFaulting application name: CorsixTH_DirectX.exe, version: 0.0.0.0, time stamp: 0x51478100\nFaulting module name: swscale-2.dll, version: 0.0.0.0, time stamp: 0x50e4de5c\nException code: 0xc0000005\nFault offset: 0x000000000001ee9c\nFaulting process id: 0x1860\nFaulting application start time: 0x01ce24de98de166f\nFaulting application path: C:\\Program Files\\CorsixTH\\CorsixTH_DirectX.exe\nFaulting module path: C:\\Program Files\\CorsixTH\\swscale-2.dll\nReport Id: e3770be7-90d1-11e2-b11e-8c89a5160b8f\nThe program CorsixTH_OpenGL.exe version 0.0.0.0 stopped interacting with Windows and was closed. To see if more information about the problem is available, check the problem history in the Action Center control panel.\nProcess ID: e38\nStart Time: 01ce24d51d713b0b\nTermination Time: 8\nApplication Path: C:\\Program Files\\CorsixTH\\CorsixTH_OpenGL.exe\nReport Id: 96054766-90c8-11e2-b11e-8c89a5160b8f\nFaulting application name: CorsixTH_OpenGL.exe, version: 0.0.0.0, time stamp: 0x5144de8d\nFaulting module name: swscale-2.dll, version: 0.0.0.0, time stamp: 0x50e4de5c\nException code: 0xc0000005\nFault offset: 0x000000000001ee9c\nFaulting process id: 0xca8\nFaulting application start time: 0x01ce24d464073f1e\nFaulting application path: C:\\Program Files\\CorsixTH\\CorsixTH_OpenGL.exe\nFaulting module path: C:\\Program Files\\CorsixTH\\swscale-2.dll\nReport Id: b63be331-90c7-11e2-b11e-8c89a5160b8f\n. From baker.st...@gmail.com on March 20, 2013 05:35:28\n@Mark, I think this comment about the crash is only relevant to the Lose movie crash bug.  This one's just about the full screen movies being black in DirectX which everyone can reproduce.\n. From mark.l1...@hotmail.co.uk on March 20, 2013 06:07:38\nSorry, I pasted it here then realised is should be in the other one and have pasted it there too\n. From mark.l1...@hotmail.co.uk on March 20, 2013 12:19:02\nI am not sure I have pasted them in the wrong place as they are DirectX. That said I do think that the error reports relate only to the lose movie.  I think this because I get a similar pair of errors with opengl and with opengl the intro does play.\nDX Full Screen.  Intro does not play and lose movie crashes the game.\nerrors as follows\nFaulting application name: CorsixTH_DirectX.exe, version: 0.0.0.0, time stamp: 0x51478100\nFaulting module name: swscale-2.dll, version: 0.0.0.0, time stamp: 0x50e4de5c\nException code: 0xc0000005\nFault offset: 0x000000000001ee9c\nFaulting process id: 0x7d8\nFaulting application start time: 0x01ce259e45d40800\nFaulting application path: C:\\Program Files\\CorsixTH\\CorsixTH_DirectX.exe\nFaulting module path: C:\\Program Files\\CorsixTH\\swscale-2.dll\nReport Id: 996430c3-9191-11e2-822c-8c89a5160b8f\nnext error - from the lose movie crash\nFault bucket , type 0\nEvent Name: APPCRASH\nResponse: Not available\nCab Id: 0\nProblem signature:\nP1: CorsixTH_DirectX.exe\nP2: 0.0.0.0\nP3: 51478100\nP4: swscale-2.dll\nP5: 0.0.0.0\nP6: 50e4de5c\nP7: c0000005\nP8: 000000000001ee9c\nP9: \nP10: \nAttached files:\nC:\\Users\\Mark\\AppData\\Local\\Temp\\WERAF8.tmp.WERInternalMetadata.xml\nThese files may be available here:\nC:\\Users\\Mark\\AppData\\Local\\Microsoft\\Windows\\WER\\ReportArchive\\AppCrash_CorsixTH_DirectX_a670c9437689eea7a4fe33cea9ad72f50f02a7e_0f673a32\nAnalysis symbol: \nRechecking for solution: 0\nReport Id: 996430c3-9191-11e2-822c-8c89a5160b8f\nReport Status: 1\nDX in a 800x600 window - all movies play with no errors in the log\n. From baker.st...@gmail.com on March 20, 2013 14:58:20\nAnything relating to a movie crashing I'd like to keep to the other bug, so this one can focus purely on the movies all being black on DX full screen.  This one happens to everyone all the time, and I feel they are probably not related.\nLabels: Renderer-DirectX\n. From mark.l1...@hotmail.co.uk on March 22, 2013 01:55:19\nI thought that some DXDiag reports would provide some usefull info \nThis one is from the computer at work and I will one for each computer I have at home later\nAttachment: DxDiag_XP_Works_PC.txt\n. From baker.st...@gmail.com on March 22, 2013 05:30:39\nI think that everyone is affected by this one.\nI'm still going with my guess that DirectX shouldn't own the window at the same time the SDL Overlay is writing to it.\nIn real life I'm very busy at the moment so I'm not personally making any progress.  I'll update the ticket again when I am more free if someone else doesn't tackle it first.\nIf anyone else wants to look at this, right now I'm envisioning one of two possible solutions.  The first is similar to what I'm currently doing with OpenGL - ensuring that there's a mode switch so that the window is exclusively owned by SDL while the movie is playing.  If mode switching was working in DirectX (right now it's broken) this would require the least code, but might cause some unwanted flicker like it does with OpenGL.\nThe second solution I was considering was moving THMoviePicture to each of the three rendering engines, and then for DirectX (and OpenGL) scaling to an RGB memory buffer instead of the overlay and drawing to a Surface or Texture instead of SDL_YUVOverlay for those rendering engines.\n. From maartenp...@hotmail.nl on April 27, 2013 01:34:39\nIssue 1600 has been merged into this issue.\n. From maartenp...@hotmail.nl on August 04, 2013 10:43:59\nSummary: Black screen when playing movies using DirectX version - workaround available   (was: Black screen when playing movies-DirectX 0.20 RC1) \n. No more DirectX version.\n. From Grim...@gmail.com on March 18, 2013 18:50:39\nI can replicate it.\nBut with me I hear a looping sound too. Maybe it is from the door?\nIt is like something is ringing... If you turn the game speed to max you hear it louder/clearer.\nThis sound stopped after there was an earth quake (will soon happen after the save is loaded).\nAnyone else getting this sound loop too?\n. From maartenp...@hotmail.nl on March 19, 2013 08:24:04\nI also hear this sound loop!\n. From Grim...@gmail.com on March 19, 2013 10:14:10\nSummary: Hanging doors: won't close-0.20 RC1 (and a looping sound)   (was: Hanging doors: won't close-0.20 RC1) \n. From maartenp...@hotmail.nl on March 19, 2013 12:29:03\nI think that this bug is a kind of duplicate of an older fixed issue ( issue #374 .) Here happens exactly the same thing! Maybe you could reopen this issue or merge it?\n. From mark.l1...@hotmail.co.uk on March 20, 2013 07:28:04\ncould it be down to you building the Op so close to that door?  How do they work if you build the Op a bit further away?  I can't really test it at the moment, I just took a quick look.\nA bit like real sliding doors, if you stand too close they will open/stay open.\n. From mark.l1...@hotmail.co.uk on March 21, 2013 04:23:16\nI have been doing some experiments on this level.  Build a standard room with a single door one tile away from the entrance and the sliding doors seem to work okay.\nBuild a room with double doors one tile away from the entrance and the blueprint won't allow you to build the doors directly across from the sliding doors, but will allow you to build them on either side.\nThe sliding doors seem to work okay and they only seem to go wrong when someone leaves the room at the same time as someone else is entering through the sliding doors.  The sliding doors can then either get stuck open or stuck closed.  If stuck open you can here the door sliding sound loop and if they get stuck closed then patients/staff will walk through the closed doors.\nNow I don't know whether this is connected, but you can build corridor objects in front of the double doors. With a fire extinguisher it does not look out of place, but with the radiator it looks odd. Is this to do with the buildable flag? Perhaps if the buidable flag was set to false for all the tiles in front of the double door it would not only stop odd object placements, but would also stop you from building too close to the sliding doors.\nSummary: Sliding doors: won't close-0.20 RC1 (and a looping sound)   (was: Hanging doors: won't close-0.20 RC1 (and a looping sound))  \nAttachment: 1.bmp\n. From maartenp...@hotmail.nl on April 06, 2013 11:48:17\nI now see that the beep was caused by a bomb above the head of a patient near the inflation room.\nSummary: Sliding doors: won't close   (was: Sliding doors: won't close-0.20 RC1 (and a looping sound)) \n. From mmarcott...@gmail.com on May 12, 2013 16:29:47\nI tried to fix this but couldn't reproduce. I loaded the attached saved game, but the bug has already happened in it and I could not find the cause.\nThe \"broken\" door in the saved game thinks it still has an occupant (self.occupant_count == 1) but no one is there. Someone had to leave the door for it to close, but that occupant didn't trigger the required event (object:onOccupantChange(-1)) for some reason.\nWhen someone goes by it \"self.occupant_count\" increases and decreases normally, but it never reaches 0 again, so it won't close.\nIf we could reliably reproduce it, this would be an easy fix.\n. From mark.l1...@hotmail.co.uk on May 13, 2013 01:02:09\n@8  look at my comments in #6 as this may help you reproduce it.  I suspect that that the patient that used the door went straight into that room.\n. From mmarcott...@gmail.com on May 13, 2013 14:39:16\nI had tried that.\nI also let the game run for years and it didn't happened. The way I placed the room is attached.\nDid you do it differently to reproduce it?\nAttachment: doorbug.png\n. From mark.l1...@hotmail.co.uk on May 14, 2013 00:44:28\nThe door to the ward needs to be as oposite the sliding door as you can make it.  I think it was the two doors being used at the same time that was causing them to stick.  i.e. someone left or entered the ward (or any room with double doors) at the same time the sliding doors are being used.  For me the doors could stick closed or open.\n. From mark.l1...@hotmail.co.uk on May 14, 2013 02:53:19\nThis is the closest you will be allowed to put the door.\nAttachment: doors.png\n. From mark.l1...@hotmail.co.uk on May 28, 2013 12:12:00\n@ mmarcottulio \nwere you able to reproduce this in the end?\n. From mark.l1...@hotmail.co.uk on August 26, 2013 11:13:09\nPerhaps the answer/solution is to make the space in front of the double doors not buildable?\nIt would then also stop the odd looking scenario of being able to place radiators in front of them.\nAttachment: 3a.png\n. From mmarcott...@gmail.com on August 26, 2013 11:19:10\n@mark\nNo I was not able to reproduce. I tried all possible double door positions near the main building door, but to no avail.\n. From maartenp...@hotmail.nl on August 04, 2013 10:42:21\nLabels: -Priority-Medium Priority-Low\n. From maartenp...@hotmail.nl on March 26, 2013 23:55:56\nBut do I need the VC6 or VC8 version of LuaSocket? When using the V6 version everything works as intended, but is there no button in-game to check for updates?\nBut I get this error: ''Couldn't check for updates. Server returned code, Valid name, no data record or requested type.''\n. From static.o...@gmail.com on March 27, 2013 05:41:03\nI've only tried the VC8 version, but it shouldn't make much of a difference.\nThere is no button to check. It happens automatically when you start the game. I can't see there being much value in manually checking for an update, unless an option was added to disable the automatic check.\nThat error sounds like it might be a firewall blocking CorsixTH.exe? Does the update URL load in a browser?\n. From maartenp...@hotmail.nl on March 27, 2013 07:14:24\nYes, the firewall was the cause of it. Maybe you could include instructions about to disable the firewall to resolve the error?\n\nDate: Wed, 27 Mar 2013 12:41:09 +0000\n. From static.o...@gmail.com on March 27, 2013 07:45:37\n\nIt would be difficult to provide instructions on how to disable/add CorsixTH to the exceptions in the console window, especially as there's hundreds of consumer firewalls out there, but I could add it as a general suggestion to the end of the error message. Just simple \"Please check that you have an active internet connection and CorsixTH is allowed in your firewall\" might suffice. We could add a more detailed explanation to the FAQ or something, as these issues will (eventually) cause further problems with things like multiplayer when we get round to it.\nI'm afraid that the error message provided is about as verbose as it gets. It's difficult to map an error to a specific problem whether it be firewall, no internet connection, problem with ISP, packet loss, server issues etc.\n. From maartenp...@hotmail.nl on March 27, 2013 12:03:40\nYes, I think you're right. But you could indeed add this string: \"Please check that you have an active internet connection and CorsixTH is allowed in your firewall.\" And when I disable my internet connection (I use LAN) I just get the error from comment 1 at the Lua Console and I can play the game.\n. From maartenp...@hotmail.nl on March 27, 2013 12:07:10\nBut will a user be able to scroll at the update-notification-screen when the changelog is much longer then 1 line? Not that we release this to public, a new version is released and everyone gets an error, because the changelog is too long to fit into the screen. :)\n. From maartenp...@hotmail.nl on March 27, 2013 12:16:50\nBut now also after I've played a game, closed the level game and go to the main menu, the update notification is showed. But maybe this is also a nice feature?\n. From static.o...@gmail.com on March 27, 2013 12:16:54\nI think the term changelog is a bit misleading. My intentions was to have more of a short summary along the lines of \"This is a bug fix release.\" or \"This version adds new features and improves performance.\" The full changelog would then be available on download page, just like we have on https://code.google.com/p/corsix-th/wiki/AboutVersionZeroTwoZero . For example, 0.2 would be \"In this version major new features include in-game movies, objects that occupy only the edge of a tile and the graph window.\"\nIt might be worth putting that text in a scrolling window anyway though, just in case!\n. From maartenp...@hotmail.nl on March 27, 2013 12:20:04\nThat's fully true and would be a very good idea! Only show the largest changes in one or two strings.\n. From static.o...@gmail.com on March 28, 2013 09:46:59\nHere's an updated version. It adds the suggestion regarding firewalls that we discussed before.\nI've added a configuration option to enable/disable the automatic check, but you've got to change the config.txt file at the moment. I'm not sure it's worth adding an in-game toggle.\nI've also made all the strings translatable and added some tooltips, apart from anything that is in the console window because I don't think anything else there is translated.\n-- Alan\n. From static.o...@gmail.com on March 28, 2013 09:47:44\nForgot to actually add the patch! Here we go.\nAttachment: cth_updates_2.patch\n. From maartenp...@hotmail.nl on March 28, 2013 11:34:21\nWill test this one in a few hours!\n. From maartenp...@hotmail.nl on March 28, 2013 11:54:42\nBut now I get a ''2 failed hunks error'' when I want to patch. This only affects the config_finder.lua file. And after applying the patch, I also get the screen with the patch for that file, which says it was rejected.\n. From static.o...@gmail.com on March 28, 2013 12:07:51\nSorry. I made the patch before I'd updated with Mark's latest changes.\nAttachment: cth_updates_3.patch\n. From maartenp...@hotmail.nl on March 28, 2013 12:16:13\nBut now I get the error: ''1 failed hunk.'' And this error affects the same file.\n. From maartenp...@hotmail.nl on March 28, 2013 12:17:24\nAnd then I only get this text at the ''rejected screen:''\n--- CorsixTH/Lua/config_finder.lua\n+++ CorsixTH/Lua/config_finder.lua\n. From static.o...@gmail.com on March 28, 2013 12:27:06\nApplies fine for me with a clean checkout.\n~/corsix-th-read-only $ patch -p0 -i cth_updates_3.patch \n(Stripping trailing CRs from patch.)\npatching file CorsixTH/Lua/app.lua\n(Stripping trailing CRs from patch.)\npatching file CorsixTH/Lua/config_finder.lua\n(Stripping trailing CRs from patch.)\npatching file CorsixTH/Lua/dialogs/resizables/update.lua\n(Stripping trailing CRs from patch.)\npatching file CorsixTH/Lua/languages/english.lua\n(Stripping trailing CRs from patch.)\npatching file CorsixTH/Lua/strings.lua\nNo idea why it's rejecting that hunk, but if it's only rejecting that then it should still work fine. Mystery.\n. From maartenp...@hotmail.nl on March 29, 2013 10:31:39\nI resolved the error by deleting all the trunk files and downloaded them again. It works perfect again!\nBut attached is a patch which adds the Dutch translation for these strings. But why do I get an error when the game wants to load the translation? It said something about string 811, but I don't see what's wrong with it.\nAttachment: dutch_update_strings.patch\n. From mark.l1...@hotmail.co.uk on March 29, 2013 12:58:35\n@ 18\nI think it has to do where you have put them in the file.\nCompare them side by side and you have commas that end on the lines 15 and 19 that are not in the English file.  On looking closer you have two sections called update_window.  I think one should be in a different place in the file and the other one under tooltip.\n. From static.o...@gmail.com on March 29, 2013 13:30:31\n@20 I think you're right. Currently, everything is a table inside tooltip with the patch in 18 so update_window resolves to tooltip.update_window and tooltip.update_window resolves to tooltip.tooltips.update_window. \nYou need to either move everything outside the tooltip table or just move update_window outside and rename tooltip.update_window to just update_window.\nHope that makes sense.\n. From maartenp...@hotmail.nl on April 01, 2013 04:11:35\nLabels: Milestone-0.30\n. From maartenp...@hotmail.nl on April 02, 2013 10:20:03\nMaybe we could upload updatetable to the main CorsixTH-website and test to see if it there also works? Then I think this update is ready to be released to the Trunk.\nStatus: Started\n. From static.o...@gmail.com on April 02, 2013 14:37:17\nIt would be nice to upload it to the CTH website and change the internal references. There's a couple of things that need considering before it's ready to add to the trunk though.\nFirstly, it's not yet decided whether LuaSocket should be integrated or left as an external dependency. I'm favouring the latter because it's much less effort and wouldn't require us to maintain it, but it would mean that non-Windows users would need to be made aware of this and would need to install LuaSocket separately. The package maintainers would also have to be made aware so that they could be updated. I've raised this point here https://groups.google.com/forum/?fromgroups=#!topic/corsix-th-dev/2P9DjuL4pEk%5B1-25-false%5D but so far no input.\nSecondly, the compiled binaries that we provide (or rather, Corsix provides) would need to be updated to include the LuaSocket .dll otherwise we'll end up in the situation we had for ffmpeg where we didn't have any builds for a week or so. Not a big deal, but we can avoid it.\n. From maartenp...@hotmail.nl on May 05, 2013 12:14:35\nSummary: CorsixTH automatic update check - Patch attached   (was: [Patch] Automatically check for updates on startup) \n. From Grim...@gmail.com on May 06, 2013 12:15:19\nWhat do you think, Edvin?\nI think you are the only one who can upload it to the CTH website for testing (ref. comment #24).\nI hope we can add this in v0.3 or v0.4.\nCc: edvin.li...@gmail.com\n. From mark.l1...@hotmail.co.uk on May 28, 2013 12:41:26\n@ static.object\nI like the idea of being able to update things automatically, a little like the trunk and svn but keeping everyone up to date.  What I can't get my head around though is that we currently have various exec's for different platforms.  Each person downloads the package they need for their OS.  I can see that updating the odd lua file here and there is no big deal, but how do you get around the different execs and do they over write themselves? (you have it running to be able to update)  Or are we only talking about updating the lua files here?\nCc: -edvin.li...@gmail.com static.o...@gmail.com\n. From static.o...@gmail.com on May 28, 2013 12:51:57\n@27 Neither - that's currently outside the scope of this patch. At the moment it just alerts you about the fact there's a new version and links to the download page. It's an \"automatic (update check)\", not an \"(automatic update) check\", if that makes sense.\nEventually, it would be nice to have the game files updated this way (at least on Windows) but it'd take much more planning because, as you say, the executables would need to be updated. This would be a nice stepping stone to that though :)\n. From mark.l1...@hotmail.co.uk on May 29, 2013 02:06:00\nSo it is an alert that there is a newer version. Sorry, I misunderstood this completley.   \nWould be nice if we could get this into version 0.30 in September.\n. From Grim...@gmail.com on August 06, 2013 05:25:15\nAh, I misunderstood a little too.\nBut it would be nice to get an alert at least, and tell the user how he can update! :)\nAnd tell about the dangers with adding not fully tested patches.\n. From maartenp...@hotmail.nl on August 13, 2013 01:49:58\nSummary: CorsixTH automatic update check    (was: CorsixTH automatic update check - Patch attached) \nLabels: -Type-Enhancement Type-Patch\n. From edvin.li...@gmail.com on August 25, 2013 09:22:20\nI had a look at this now. Since I'm not really a C++ programmer or have used Visual Studio a lot I didn't manage to compile LuaSocket 2.0.2 for 64-bit Windows, however I found s supposed LuaSocket 3.0RC at https://github.com/diegonehab/luasocket .\nApart from that I would like to change \"Download\" to \"Open download page\" and \"Ignore\" to \"Continue to main menu\" or similar I really like this. :-)\n. From edvin.li...@gmail.com on August 30, 2013 00:02:21\nWould this URL look good? http://www.corsixth.com/check-for-updates I suppose that only the latest version would be specified in that file? There would not be any purpose in supplying more than one right? Possibly if we want to show that there has been more than one update, but is that useful?\n. From maartenp...@hotmail.nl on August 30, 2013 00:19:10\nThat looks create Edvin, that text has to be edited before the release, but now we can prepair the update checker for release (Because updatetable now has a location at our server.) But what if the server goes down and the update checker can't reach the file? Will then CorsixTH crash?\n. From static.o...@gmail.com on August 30, 2013 02:19:48\n@33 Anything like that would be fine. I suppose if you wanted to, you could also just throw the file into the svn repository, and then use Google Code or GitHub to serve the file. eg: https://corsix-th.googlecode.com/svn/trunk/LICENSE . That would mean that it could be updated relatively easily by anyone with access. Whether that's necessarily a good or bad thing, I'm not too sure.\nThe table can only accommodate the very latest update. Can't think of any reason to show multiple versions. Perhaps if you launched CTH a very long time ago, and missed the notification for the previous version then you might not realise there have been certain new features, but if you don't play that regularly then I doubt you would care. \nIf you wanted, you could set the download URL to point to a short version history with a download link on it, or maybe even the CTH google code homepage as that has the latest news on, and the download link is fairly easy to locate there.\n@34 If the server goes down then it should just continue as normal. Various network conditions should ideally be tested though.\n. From edvin.li...@gmail.com on August 30, 2013 04:17:17\nI have tested for network unavailable and server unavailable at least, long response times could be annoying though because of the single-threadness. I'll add this to trunk to let people try it out. The snapshot will only say that LuaSocket isn't available though.\n. From static.o...@gmail.com on August 30, 2013 10:20:10\nI haven't looked into it too much, but it's possible to set a timeout for Luasocket. Might help a little bit. http://stackoverflow.com/questions/6016090/lua-http-socket-timeout\n. From mark.l1...@hotmail.co.uk on December 05, 2014 11:53:14\nAs this is now in the game is it okay to close this?  Or is there more to be done?\nStatus: Input\n. From soundasleep on March 29, 2013 19:45:25\nI managed to workaround by loading a previous autosave. The doctor had not yet exited but the doctor and janitor were still both stuck trying to get in/out. Picking up the doctor allowed me to empty the room and edit it, now it seems to be working OK. Attached is the autosave.\nAttachment: Autosave9.sav\n. From maartenp...@hotmail.nl on March 31, 2013 10:35:33\nWhen you fire janitor, he will leave the hospital and the doctor still stands there. Then an other janitor comes to the room and gets stuck again. I see that the janitor wants to water a plant at 47,55, but I think that there's no plant! But could you also provide gamelog.txt, because there seems to be an error occured.\n. From maartenp...@hotmail.nl on March 31, 2013 10:38:03\nBut next to that room at autosave 9, I see a patient with a bomb above his head. Maybe this has something to do with it?\n. From soundasleep on March 31, 2013 17:35:49\nI looked through the debug window and the gamelog.txt but I couldn't see anything that looked obvious. (I only noticed the bug a few game months after it occurred too.) Attached is my gamelog.txt but I've played through another 2-3 levels since then, I'm pretty sure it won't be useful sorry.\nAttachment: gamelog.txt\n. From maartenp...@hotmail.nl on April 01, 2013 02:35:00\nI see the error from issue #1538 (there's a patch available, which probably resolves the error), an empty action queue error and this error: attempt to index field 'queue' (a nil value.) I can't find a duplicate of this error in the issue tracker, so it is a new one. Could you provide more autosaves from before these errors occured?\n. From soundasleep on April 01, 2013 14:42:11\nSorry - the other autosaves have already been replaced. I should have made a backup of them. :/ I don't know how the game logic works, but is it normally possible for a doctor/janitor pair to both lock on a door? Are there any checks to prevent this from happening?\n. From mark.l1...@hotmail.co.uk on August 26, 2013 11:28:35\nThere is a plant in that room, it is in the bottom left hand corner and is dead.\nThe Dr is trying to leave and the handyman trying to enter and the door is somehow locked so neither can use it.\nPerhaps there should be some failsafe to stop this, where one of them perhaps the one on the outside gives up and it releases the lock?\nSummary: Two staff trying to use the same door locks the door!   (was: Exiting doctor stuck in GP office while janitor tries to enter) \nStatus: Accepted\nLabels: Milestone-0.30\n. From mark.l1...@hotmail.co.uk on September 15, 2013 10:55:18\nHere is another save with a similar problem.\nBoth the nurse and handyman want to go to the fracture clinic and neither is entering the room.\nTry and edit the room to clear the lock and the game crashes.  The error message though seems to be nothing to do with the room in question! \n...nu_Items\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:143: attempt to compare nil with number\nstack traceback:\n    ...nu_Items\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:143: in function 'action_seek_room_no_diagnosis_room_found'\n    ...nu_Items\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:292: in function '?'\n    ...th\\New_Menu_Items\\CorsixTH\\Lua\\entities\\humanoid.lua:550: in function 'Humanoid_startAction'\n    ...th\\New_Menu_Items\\CorsixTH\\Lua\\entities\\humanoid.lua:642: in function 'finishAction'\n    ...ew_Menu_Items\\CorsixTH\\Lua\\humanoid_actions\\idle.lua:31: in function 'timer_function'\n    ...ktop\\corsixth\\New_Menu_Items\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n    ...sixth\\New_Menu_Items\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n    ...sktop\\corsixth\\New_Menu_Items\\CorsixTH\\Lua\\world.lua:1035: in function 'onTick'\n    ...Desktop\\corsixth\\New_Menu_Items\\CorsixTH\\Lua\\app.lua:838: in function <...Desktop\\corsixth\\New_Menu_Items\\CorsixTH\\Lua\\app.lua:835>\n    (tail call): ?\n    ...Desktop\\corsixth\\New_Menu_Items\\CorsixTH\\Lua\\app.lua:739: in function <...Desktop\\corsixth\\New_Menu_Items\\CorsixTH\\Lua\\app.lua:734>\nAttachment: Autosave3.sav\n. The stack trace in this error is a duplicate of #578 \nMay be unrelated.\n. From maartenp...@hotmail.nl on April 01, 2013 02:45:35\nWhat do you mean with artifacts? Could you post a screenshot of this strange situation?\n. From mark.l1...@hotmail.co.uk on April 02, 2013 07:45:29\nWas this will all the execs or just one of them?\nYou could try changing the resolution and then restarting the game as that sometimes helps.  I sometimes get this when zooming out and restarting clears it for me.\nStatus: Input\n. From maartenp...@hotmail.nl on April 04, 2013 05:49:04\nI think this bug occurs with the OpenGL version? This is a known issue.\n. From kinguru2...@gmail.com on April 05, 2013 03:17:59\nSory for long time waiting.\nI attached screenshots with artifacts.\nSimple to reproduce - change resolution or some times after next level loading it's appears.\nAttachment: Untitled-1.jpg Untitled-2.jpg Untitled-3.jpg\n. From kinguru2...@gmail.com on April 05, 2013 03:22:36\nWhen changing resolution in direct3d mode it says \"resolutions not supported in fullscreen mode\" but it is supported in opengl ) and it is generic for my device.\nMy video intel gma4500m (mobile).\nMany 3d games works perfectly - counter strike, quake 3, endless sapce, scared 2, x-com and much more.\nAttachment: direct3d_windowed_800x600.jpg\n. From kinguru2...@gmail.com on April 05, 2013 03:23:52\ncorsix_SDL.exe not running at all - windows alerts an error an proposes to close or find solution in internet.\n. From maartenp...@hotmail.nl on April 05, 2013 04:54:43\nBut what's the error you get using the SDL-version. Look at the logs from Windows.\nLabels: Renderer-DirectX\n. From kinguru2...@gmail.com on April 08, 2013 05:28:46\nArtifacts not only in DirectX, but in OpenGL too.\nScreenshot attached.\nAppeared in a new level.\nAttachment: Untitled-1.jpg\n. From kinguru2...@gmail.com on April 08, 2013 05:30:16\nArtifacts appears after:\n- resolution change\n- at new level\n. From maartenp...@hotmail.nl on April 08, 2013 06:20:36\nI think that this issue is related to issue #1445 .\nSummary: Graphical glitches after change resolutiuon and start a new level   (was: artifactsafter change resolutiuon) \nStatus: New\nLabels: Renderer-OpenGL Component-Graphical\n. From maartenp...@hotmail.nl on April 08, 2013 06:25:04\nThese problems really let me think of compatibility problem. But I think that that isn't possible?\nLabels: -Priority-Medium Priority-High\n. From kinguru2...@gmail.com on April 08, 2013 07:12:08\nIt is very similar to issue #1445 comparing screenshots. Every time it is new artifacts - looks like some wrong texture on items.\nWhat do you mean in compatibility problem? Compatibility with what?\n. From kinguru2...@gmail.com on April 08, 2013 07:12:55\nIf there is some debug option exists I can gather log and send you, guys.\n. From maartenp...@hotmail.nl on April 08, 2013 10:10:30\n@12 Between the computer and CorsixTH. When you don't know what it is then look with Google.\n. From kinguru2...@gmail.com on April 08, 2013 11:19:17\nThnx, I know what it is. It can be bugs in code or some HW support problem - and it is still in code :). But my HW is very recent - core2duo, intel gma4500.\n. From maartenp...@hotmail.nl on April 08, 2013 11:30:48\nBut I think that the render engines are just broken an need a rewrite.\n. From Grim...@gmail.com on August 06, 2013 06:14:16\nIt can't be drivers for the new hardware that makes this happen?\nNew hardware sometimes can be quite buggy without a driver update.\n. New rendering engine \n. From maartenp...@hotmail.nl on April 01, 2013 06:52:42\nCould you upload the savegame with this programm? You can remove or move benches when you rightclick on it.\n. From kamolada...@gmail.com on April 01, 2013 11:00:51\nok i created same situation. I hope it will help :)\nAttachment: bug.sav\n. From maartenp...@hotmail.nl on April 01, 2013 11:10:40\nI see that his savegame was created using 0.20 and I can reproduce the problem.\nStatus: Accepted\n. From mark.l1...@hotmail.co.uk on April 25, 2013 07:08:34\nThe path is being blocked by the patient that is sitting down. The width of the corridor and the benches that face each other mean there is only one tile width for walking and that patient blocks it.  I don't know whether this is the correct behaviour or not, but I have seen something similar with bench placements near to a door. \nIf you build a room and place one or more benches near to the door everything is fine.  Edit the room and keep the door in the same place and you cannot confirm the room as the benches are blocking the door.\nI think in both cases the space in front of the bench is reserved.\n. From Grim...@gmail.com on August 07, 2013 06:30:56\n@5: \"The path is being blocked by the patient that is sitting down\":\nThe patients are taking the long way even if there is no one sitting on the benches.\nI don't know what is the wanted behavior in this case..\n. From mark.l1...@hotmail.co.uk on August 07, 2013 08:08:54\nAs I said \"I think in both cases the space in front of the bench is reserved.\"\nIt looks like the bench takes up the whole tile, whether this is correct or not I don't know) where things like a radiator take up the edge only now.\nI have a feeling that in TH the bench would only take up the edge, but then that would mean you could get two in the same tile and that would not be correct either!\n. From Grim...@gmail.com on August 16, 2013 12:41:40\nIssue 1684 has been merged into this issue.\n. From cor...@corsix.org on April 03, 2013 03:23:43\nThere is no technical reason why this shouldn't be possible; just a matter of identifying an OS X API for reading from DMG files, or writing some code to read from them manually.\n. From edvin.li...@gmail.com on April 07, 2013 03:09:46\nStatus: Future\nOwner: ---\nCc: -cor...@gmail.com\nLabels: -Type-Defect -Priority-Medium Type-Enhancement Priority-Low OpSys-OSX\n. @admdly that sounds reasonable.\n. From edvin.li...@gmail.com on April 07, 2013 03:08:43\nI don't know if Chris actually uses those files at the moment.\nStatus: New\nOwner: ---\n. From maartenp...@hotmail.nl on April 07, 2013 03:11:22\nWhen he doesn't use these files, then we should delete them, update the other files and upload them to the Trunk.\n. From maartenp...@hotmail.nl on April 27, 2013 02:03:56\nBut could somebody ask Chris about this, I don't know how to contact him.\nStatus: Started\nLabels: -Priority-Low Priority-Medium\n. From mark.l1...@hotmail.co.uk on April 05, 2013 02:01:41\nDo you have smpeg.dll in your CorsixTH folder?\nAlso the playing of mp3s only seems to work on 32bit systems as there is no 64it smpeg.dll - not that I can find anyway.\n. From darkome...@gmail.com on April 05, 2013 02:06:01\nA smpeg.dll works on a OSX 10.8 system ? I'll try this evening.\n. From maartenp...@hotmail.nl on April 06, 2013 13:41:36\nAnd do you have the results?\nLabels: OpSys-OSX\n. From darkome...@gmail.com on April 09, 2013 10:29:12\nNot working sir ! Same result in 32 and 64bits mode. \ndll files isn't an OSX thing.\n. From maartenp...@hotmail.nl on April 09, 2013 11:34:16\nCould you provide gamelog.txt? Maybe that file gives more information.\n. From darkome...@gmail.com on April 10, 2013 15:10:44\nAlways the same error :\nCreated game with savegame version 66.\nError in callback handler: \nError in async music load callback: CorsixTH.app/Contents/Resources/Lua/audio.lua:436: Could not load music file '/Applications/CorsixTH/Music/Theme Hospital - Sixseven (ZR Remix).mp3' (Unrecognized music format)\nstack traceback:\n    [C]: in function 'yield'\n    CorsixTH.app/Contents/Resources/Lua/app.lua:690: in function \nError in callback handler: \nError in async music load callback: CorsixTH.app/Contents/Resources/Lua/audio.lua:436: Could not load music file '/Applications/CorsixTH/Music/Theme Hospital - Steady (ZR Remix).mp3' (Unrecognized music format)\nstack traceback:\n    [C]: in function 'yield'\n    CorsixTH.app/Contents/Resources/Lua/app.lua:690: in function \nError in callback handler: \nError in async music load callback: CorsixTH.app/Contents/Resources/Lua/audio.lua:436: Could not load music file '/Applications/CorsixTH/Music/Theme Hospital - Nightsh (ZR Remix).mp3' (Unrecognized music format)\nstack traceback:\n    [C]: in function 'yield'\n    CorsixTH.app/Contents/Resources/Lua/app.lua:690: in function \nError in callback handler: \nError in async music load callback: CorsixTH.app/Contents/Resources/Lua/audio.lua:436: Could not load music file '/Applications/CorsixTH/Music/Theme Hospital - Steady (ZR Remix).mp3' (Unrecognized music format)\nstack traceback:\n    [C]: in function 'yield'\n    CorsixTH.app/Contents/Resources/Lua/app.lua:690: in function \nError in callback handler: \nError in async music load callback: CorsixTH.app/Contents/Resources/Lua/audio.lua:436: Could not load music file '/Applications/CorsixTH/Music/Theme Hospital - Steady (ZR Remix).mp3' (Unrecognized music format)\nstack traceback:\n    [C]: in function 'yield'\n    CorsixTH.app/Contents/Resources/Lua/app.lua:690: in function \nError in callback handler: \nError in async music load callback: CorsixTH.app/Contents/Resources/Lua/audio.lua:436: Could not load music file '/Applications/CorsixTH/Music/Theme Hospital - Sixseven (ZR Remix).mp3' (Unrecognized music format)\nstack traceback:\n    [C]: in function 'yield'\n    CorsixTH.app/Contents/Resources/Lua/app.lua:690: in function \nError in callback handler: \nError in async music load callback: CorsixTH.app/Contents/Resources/Lua/audio.lua:436: Could not load music file '/Applications/CorsixTH/Music/Theme Hospital - Fortune (ZR Remix).mp3' (Unrecognized music format)\nstack traceback:\n    [C]: in function 'yield'\n    CorsixTH.app/Contents/Resources/Lua/app.lua:690: in function \nError in callback handler: \nError in async music load callback: CorsixTH.app/Contents/Resources/Lua/audio.lua:436: Could not load music file '/Applications/CorsixTH/Music/Theme Hospital - Mend (ZR Remix).mp3' (Unrecognized music format)\nstack traceback:\n    [C]: in function 'yield'\n    CorsixTH.app/Contents/Resources/Lua/app.lua:690: in function \n. From mark.l1...@hotmail.co.uk on April 11, 2013 00:45:29\nIn config.txt it does state you need to look for the equivalent for your platform\n--  2) Ensure that SMPEG.dll (or equivalent for your platform) is present.\nHaving never used OSX, I have no idea what that would be, perhaps you could search the internet.\n. From mark.l1...@hotmail.co.uk on August 19, 2013 11:34:49\nAs we are getting close to having our own music, perhaps it is time to find a solution to this one?\nI have never been able to find an equivalent for SMPEG.dll that works on 64bit Windows and it seems there is an issue with OSX too.\nIs there a DLL we can use so that everyone no matter the system can play mp3's?\nSummary: No MP3 Audio on OSX 10.8.3 or 64bit windows   (was: No MP3 Audio on OSX 10.8.3) \nStatus: Investigating\n. From Alberth2...@gmail.com on August 19, 2013 12:02:29\nUnlikely.\nThe mp3 format has some patent problems, and won't ever be supported by big Linux distributions like Fedora or Debian. If you want a 'works-everywhere' solution, you'll need to use a file format that is free of such problems.\nThe only format I know with this property is 'ogg', but I am not an expert in the audio formats, so there may be other formats available too.\n. From mark.l1...@hotmail.co.uk on August 19, 2013 12:42:07\nI am adding that link you sent me as this may help in the decision making http://fedoraproject.org/wiki/Multimedia/MP3\n. From Grim...@gmail.com on August 19, 2013 13:39:00\nI would support using the .ogg format for our sounds and music packed with the game, but also keep the users ability to add own mp3's if he wants to.\n. At least as far as Windows is concerned, we ship with a 64bit smpeg.dll these days.\nThat said, the warning message when selecting an mp3 directory needs to change on two points: first, the comment about 64bit is obsolete, secondly we should call it smpeg and not smpeg.dll because .dll is a windows specific file, and finally we ship smpeg.dll with the windows installer so for most people there's no reason to display this warning.\n. From maartenp...@hotmail.nl on April 07, 2013 08:13:33\nYou will not see this staying selection back in custom maps. It's only confusing for makers of custom maps.\n. I still see similar behavior in the new map editor.  What is the expected behavior?\n. From maartenp...@hotmail.nl on April 08, 2013 11:31:59\nCould you provide gamelog.txt and some saves from before this strange situations?\n. From kinguru2...@gmail.com on April 08, 2013 12:06:26\nOh, I do not have prev save files, it was first one.\nGamelog.txt attached, but I'm not sure if it is those you need.\nAttachment: gamelog.txt\n. From mark.l1...@hotmail.co.uk on April 08, 2013 12:20:55\nYou seem to have a lock on the door.  Put another Dr in that room and the first one will leave and then the handyman will water the plant.  Once that is done the patients will start to use the room again.\n. From maartenp...@hotmail.nl on April 09, 2013 10:02:32\nI can reproduce the problem.\nStatus: Accepted\n. From maartenp...@hotmail.nl on July 04, 2013 13:04:03\nLabels: Milestone-0.30\n. From Grim...@gmail.com on August 06, 2013 11:57:32\nCan still be reproduced, but this should be low priority since it doesn't break anything.\nLabels: -Priority-Medium Priority-Low\n. From maartenp...@hotmail.nl on April 15, 2013 12:12:55\nCould you provide the exact steps to reproduce this (maybe with an affected savegame?) I can't reproduce the error.\n. From mark.l1...@hotmail.co.uk on April 15, 2013 12:24:39\nI can't reproduce this either.\nThe error message is referring to the machine, was it the room you were editing or replacing a machine?\n. From online.s...@gmail.com on April 15, 2013 13:15:14\nI did not replace the machine.\nI tried to move the room, or at least change the interior design.\nIn the attached auto-save file I recreated the error immediately by \n1. using the scissor-tool to edit the room\n2. placeing a door\n3. pressing the cancel button in the room-editing window on the top right of the screen\nLeads to: Cancel button remains in pressed condition, buttonup error complete.\nI retried the save-file and it took a few times and moving two rooms randomly before the steps mentioned above lead to the error.\nThe room I am referring to in this particular recreation is the slack-tongue clinic on the east side of the hospital, directly adjacent to the inflator room.\nThis auto-save file takes place after I repeatedly moved and placed rooms, most times  successfully recreating the error.\nAttachment: Autosave5.sav\n. From online.s...@gmail.com on April 15, 2013 17:20:59\nNow that I thought about what you said about the log referring to the machine, I tried again, getting the same results, but some additional information as well:\nIf after performing the steps in my post earlier the error does NOT occur, then it will refrain from occurring as long as I don't place the machine (I tried a lot of times, but that does not guarantee that this statement is correct).\nAfter placing the machine and going through the steps, the error occured after just a few tries.\nHence, to be even more precise:\n1. use scissor-tool to edit the room\n2. use cancel button to clear the room interior (this means: the machine, most importantly for this bug)\n3. use cancel again to clear door (and windows) [now room can be moved]\n4. place door (and maybe windows)\n5. press accept button\n\nERROR can occur here, if not go on with list\n6. press cancel button to delete doors and windows\nnow EITHER the ERROR OCCURS\nor it does not, in which case there are two possible paths of action.\npath A will NOT lead to the error (althouth I can't be 100% sure, like I said)\nand path B WILL lead to the error, after repeating it a few times at the latest.\n\nA) [since the cancel did not cause an error, the door has been cleared (and windows, too)\n1. place door (and windows)\n2. cancel\n3. repeat from 1\n\nNO ERROR [can't guarantee for this outcome]\n\nB) [since the cancel did not cause an error, the door has been cleared (and windows, too)\n1. place door (and windows)\n2. press accept button\n\nError can occur here, if not go on with list\n3. place machine\n4. press cancel button do delete machine\n5. press cancel button to delete door (and windows)\nif no error, repeat from 1.\nERROR will come at some point after repeating the process\n\nIf this does not help you recreate the error, I might have one more idea to specify the process by leaving out/adding another step.\nJust tell me when you need me to do some more thinking ; )\nOh, I merely added that A-path to underline the relevance of the machine to the error, just in case you wonder.\nCE-Proof\n. From mark.l1...@hotmail.co.uk on April 16, 2013 00:43:41\nYou say \"pressing the cancel button in the room-editing window on the top right of the screen\"\nCan you do a screenshot of this and highlight where you are pressing?\nTo me the cancel button is the x and this is not in the top right of the screen.  Perhaps this is why we can't reproduce the error. The only button I can think of at the top right of the screen would quit from the game, but that is of the game window not the room-editing window.\n. From online.s...@gmail.com on April 16, 2013 02:33:42\nBeing overly precise has its drawbacks...\nIt's just the plain cancel button.\nIn the attached screenshot the mouse cursor is invisible (that just happens when I make a screenshot), but it is currently hovering above the highlighted cancel button, even the popup is labeled 'cancel'.\nAttachment: error screenshot.jpg\n. From online.s...@gmail.com on April 16, 2013 02:37:46\nJust so you people don't think I was trying to offend you:\nBy 'being overly precise' I was referring to myself.\nI probably shouldn't have pointed out where the cancel button was located.\n. From mark.l1...@hotmail.co.uk on April 16, 2013 02:46:45\nAt least we are on about the same button.  \nI will try and reproduce this again tonight.\n. From mark.l1...@hotmail.co.uk on April 16, 2013 11:15:45\nI have had numerous attempts and I can't reproduce the error - using your save and editing the tongue clinic.\nJust to eliminate any corruption at your end, can you reinstall corsixTH then see if you are still able to produce this error?\nThanks\n. From online.s...@gmail.com on April 18, 2013 01:58:53\nI re-downloaded, re-installed and retried, still producing the error.\nHowever, there's more information you might find useful:\nI use the win64 version, CorsixTH-0.20-Win64\nAlso, it seems that it depends on my speed whether the error occurs or not.\nI tend to use the abort function A LOT, so usually I drag the cancel button closer to my room, place stuff, cancel, place, cancel.\nIf I keep the window far away and thus take a long time between placing stuff and canceling, I can't reproduce the error as well, it seems.\nDidn't try it as thoroughly as the previous attempts though.\nI guess you don't actually NEED to fix this then. If I go more slowly it shouldn't be a problem.\n. From maartenp...@hotmail.nl on April 18, 2013 02:39:08\nSo, we have to speed up to reproduce it. Will try this today.\nSummary: [buttonup] error - ocurring when editing rooms with high speed   (was: [buttonup] error - ocurring when editing rooms) \n. From maartenp...@hotmail.nl on April 18, 2013 04:09:31\nI still cannot reproduce the error; could you make a movie of the steps to reproduce the error?\nStatus: Input\n. From mark.l1...@hotmail.co.uk on April 21, 2013 12:48:44\nAs you are trying to build the room, edit it numerous times all with the speed set to maximum I don't see this being an issue that needs fixing.\nThis is like buying a car and complaining to Ford that it keeps crashing when you keep the accelerator pressed down all the time and close your eyes.  \nJust slow down and it should be fine...\nStatus: WontFix\nCc: edvin.li...@gmail.com\n. From edvin.li...@gmail.com on April 21, 2013 22:56:03\nSince it is still normal gameplay I would really like to find this bug just as much as other bugs. So let's keep it open.\nStatus: Accepted\nCc: -edvin.li...@gmail.com\nLabels: -Priority-Medium Priority-Low\n. From online.s...@gmail.com on April 22, 2013 00:50:06\nSorry for not sending frequent updates.\n1. I do not have the speed set to maximum. Game-speed is irrelevant for the error (I think. I usually build rooms on slowest game-speed.)\n   I meant that I (human) click the button quickly (with my mouse) after placing objects, repeating this process successively, since I rather have a cancel-button erase objects for me than try to pick each of them up with my cursor.\n2. You asked me to upload a video. I only tried making a gameplay video once, and that was like 5 years ago, had some issues, gave it up back then. Over the last few days I retried, but I don't spend too much time on that.\n   It recorded my desktop instead of the game, and after going through troubleshooting it still did.\n   I can try to capture the game on my laptop (maybe it\u2019s different on winXP, but I don't really have the pacience setting up video capturing for one bug if it doesn't work immediately...sorry for that.  Also the error may not even occur on winXP).\n3. I have another idea which I will try out later, for now I have to work.\nI agree that this error isn\u2019t anything near an important issue and that I can avoid it myself, so you don't have to focus your efforts on this.\nI simply stumbled upon this bug which had me reload my last auto-saves frequently, and thought it woulnd't be a big thing if I quickly reported the error and gamelog.\nI didn't expect it to be such a complicated thing for anyone else to reproduce...\nSo please forgive me if I don't go out of my way to keep updating this thread... (I am truly sorry, no sarcasm.)\n. From maartenp...@hotmail.nl on April 22, 2013 07:22:03\nMaybe you could try an other recording program?\n. From maartenp...@hotmail.nl on May 06, 2013 04:45:35\nSummary: Error: attempt to index local 'room' (a nil value) - ocurring when editing rooms    (was: [buttonup] error - ocurring when editing rooms with high speed) \nStatus: Input\n. From maartenp...@hotmail.nl on May 09, 2013 01:50:13\nCould you make a movie, so we can investigate this issue?\n. From Grim...@gmail.com on April 22, 2013 11:14:19\nHooray! Great job :)\n. From maartenp...@hotmail.nl on April 22, 2013 11:24:29\nMaybe this is the beginning of importing our own graphics or just an example.\n. From Alberth2...@gmail.com on April 22, 2013 11:53:22\nIt's an open invitation to let you guys consider and decide what you actually want to have.\n. From Grim...@gmail.com on April 23, 2013 13:14:43\nHow about this:\n1. Devs (and whoever wants to) should test this out a little.\n2. Decide how we want to do everything. Limitations and graphical \"rules\" etc.\n3. If there needs to be some changes in code, we could do that, to get the behavior we want.\n4. Write some documentation on how to use the tool, and list all the \"rules\" for how we want it.\n5. ???? (make new graphics)\n6. Success.\nHow does this sound?\nOne of the rules should be that it can't be a direct copy of TH, and not just some minor tweaking with the graphics. It should be re-done with our own twist, so that there is no legal problems. It could still resemble TH I think, but you probably understand what I mean.\n. From Alberth2...@gmail.com on April 27, 2013 05:56:29\nVersion 2 of the patch.\nFunctionality is still the same.\nChanges:\n- Loading a file is now in 3 stages:\n  - Load the original data file.\n  - Load as many custom graphics file as you desire.\n  - Finalize loading (setup stuff for rendering and so on).\nI changed all three video back-ends, but as I can only build SDL, I don't even know whether the DX9 and the OpenGL changes compile. It should be pretty straightforward to fix any problem there.\n- The configuration of what custom files to load has been move to the Graphics class constructor, and is now a table of DataFile -> list of custom files to load.\n  What needs to be done now is to move this data to a point where the user can edit it (if that's desired by the project). Since that's all Lua code, I'll leave that to one of the smart Lua programmers.\n- The \"my_sprites\" directory is still hard-coded. It needs a better place and a configuration. Again, it's all Lua, and I don't know where you want it, so I'll leave that to you.\n- I wrote a C++ sprite file encoder (in /SpritesEncode). After building, it reads the .ini file, and the .png files (it uses libpng), and produces the custom graphics files. This makes the Python stuff of the previous version obsolete.\n- The custom graphics file format now starts with \"CTHG\", and 2 bytes version number in little endian. This should allow for updates in the file format later on without getting mess with people trying to load the wrong file.\n- I have read issue #971 , and tried the animview thingie, but it looks like the wrong direction too me, and way too massive (a 15MB XML file with numbers, what is the use of that?). Also, I read it generates 32bpp images, instead of the 8bpp ones that go in. Last but not least, I believe it is good to keep some distance between data files dropping out of that program, and encoders of new graphics.\n  I would say that a few simple tables should be made with sprite descriptions, sizes, and palettes. That would suffice at first.\n@4: Also, consider full rotation for everything (so eventually you can build a rotation in the game), and perhaps zoom to other sizes.\nHave fun all\nAttachment: custom_graphics2.patch data.ini spr2_2355.png\n. From Alberth2...@gmail.com on April 27, 2013 06:41:29\nSorry, I uploaded a patch without the changes to dx9 and opengl.\nHere is the updated one\nAttachment: custom_graphics2b.patch\n. From edvin.li...@gmail.com on May 03, 2013 05:27:26\nI am eager to try this out, but it will have to wait a few more weeks until our master's thesis is finished unfortunately... :-(\nStatus: Started\n. From Grim...@gmail.com on August 16, 2013 13:04:07\nI see some compiling is needed here. I don't have the knowledge to do that, but maybe someone else could compile it?\nI still think we could start changing our graphics \"as we go\", and not wait until most of the rest is done.\nAs we know, everything with open source and small projects like this takes a lot of time, even for small things, so it would be wise to get started.\nUnless anyone sees any big flaws about that thought?\nCc: edvin.li...@gmail.com\n. From maartenp...@hotmail.nl on August 16, 2013 14:00:40\nI agree with you Grimdoc!\n. From edvin.li...@gmail.com on August 25, 2013 11:36:05\nVery nice indeed! :-)\n@5: issue #971 is one way to go, but I agree that it may be a little too far-stretched. Besides, this seems to work out well enough, and though we could discuss support for 32-bit graphics etc etc I believe it is much better to get something going than to devise a fantastic and open-ended system that is never realised.\n. From edvin.li...@gmail.com on August 30, 2013 05:08:28\nOk, so the next steps here would be:\n1. Me: do some Lua magic to integrate this more nicely as you say.\n2. Decide how to work with palettes. I know almost nothing of this, but also think that we should stick with as few as possible. Maybe you could explain the purpose of different palettes very briefly? :-)\n3. Wait for the SDL2 upgrade so that we only need it to work with one renderer.\n4. Document how artists should work and which sprites there are (how do we do this?)\nLabels: -Type-Enhancement Type-Patch Milestone-0.40\n. From Alberth2...@gmail.com on October 06, 2013 12:26:53\nTake 3.\nI changed the sdl2 branch to the point of having the custom graphics support.\nAttached you will find the entire patch.\nI also have it as patch queue, but it needs a few more loose ends fixed.\nSome of the changes in the patch also exist as pull requests, and/or bug fix in master.\nAttachment: free_graphics3.patch.gz\n. From Alberth2...@gmail.com on October 08, 2013 13:02:01\nhttps://github.com/CorsixTH/CorsixTH/pull/19 created a pull request for it.\n. From maartenp...@hotmail.nl on April 27, 2013 01:30:32\nBut maybe the last screenshot gives some interesting info about yuu overlay? Maybe this is the cause of all the graphical glitches with the openGL version.\nSummary: Graphical glitches in options screen   (was: error in options screen. ) \n. From mark.l1...@hotmail.co.uk on August 24, 2013 10:35:30\nWith regards to \"series of black lines\"\nThat could be the tiles that represent the font being used from the original data.\nPerhaps you have a corruption in your original data, so can you copy the files over again from your CD?\nThe text disappearing when you change between full screen and windowed is known about and is in another issue.\nStatus: Input\n. This is about rendering engines no longer used.\n. From mark.l1...@hotmail.co.uk on April 28, 2013 12:35:13\nIf you were to stop the intro part way through and then later drag the window to one side (beyond the edge of the monitor) you can also see the last frame of the movie - see attached.\nAttachment: 3a.png\n. From maartenp...@hotmail.nl on September 29, 2013 03:08:40\nHopefully this can be fixed with SDL2?\n. Can still reproduce with 0.60-beta2\n. From maartenp...@hotmail.nl on April 27, 2013 11:37:30\nBut could you also provide gamelog.txt?\n. From maartenp...@hotmail.nl on April 27, 2013 11:43:21\nSummary: CorsixTH crashes on startup on Mac OSX 10.6.8   (was: 0.20 crashes on startup on MBP 10.6.8) \n. From static.o...@gmail.com on April 27, 2013 13:44:17\nLooks like it could be another movie related problem to me. I take it that you're using a known good copy of TH?\n. From domc...@gmail.com on April 27, 2013 21:34:41\nhere you go.\nApologies, forgot to state that 0.11 works well for me. Let me know if I need to provide any information.\nAttachment: gamelog.txt\n. From maartenp...@hotmail.nl on April 28, 2013 01:04:50\nThen it really looks like that you're using a broken version of TH. Missing movies at TH-files will give errors in-game and these movies are added in version 0.20. From where did you get TH? And the gamelog gives no valuable info.\n. From domc...@gmail.com on April 29, 2013 08:58:20\nHmm, the game - which i got from gog.com, works fine on my windows pc. Seem to have some trouble with the demo on 0.20. the screen just blanks out.\n. From static.o...@gmail.com on April 29, 2013 09:34:03\nIf you disable movies in your config file ( https://code.google.com/p/corsix-th/wiki/ConfigurationFile ) by changing the following line: \nmovies = true \nto \nmovies = false\ndoes that stop it from crashing?\n. From maartenp...@hotmail.nl on April 29, 2013 10:15:13\nAnd when using the demo files I can't reproduce this on my Windows system.\n. From domc...@gmail.com on April 30, 2013 10:36:03\nNope, unfortunately it doesn't work. I can hear the bg music now though, but still no graphics/videos. Hope it's not my mac.. =(\n. From v2bl...@gmail.com on June 28, 2013 00:11:30\nIt's not just you; I'm having the same problem on my mid-2008 MacBook (running OS X 10.6.8 as well). Trying to run v0.21 at the moment. The file opens, I see a black screen (presumably what should come before the loading screen), and then the app crashes.\n. From Grim...@gmail.com on April 30, 2013 13:28:01\nCan replicate it.\n. From dugu...@gmail.com on May 03, 2013 07:00:03\nApologies, I'm using Windows 8 (with Classic Shell), not Windows 7.\n. From maartenp...@hotmail.nl on May 03, 2013 10:34:44\nI indeed can reproduce this on my Windows 7 computer.\nStatus: Accepted\n. From mark.l1...@hotmail.co.uk on May 05, 2013 10:52:59\nI don't see this!\nAt a slow speed the screen shakes and at a faster speed it shakes faster.\n. From dugu...@gmail.com on May 05, 2013 11:13:42\nHi Mark,\nI've uploaded a video of this (at three different speeds; Ultra, slowest, then normal) here for you: http://www.youtube.com/watch?v=E0rl4f4CkdI\n. Fixed. From mark.l1...@hotmail.co.uk on May 03, 2013 12:47:11\nI have been using map editor a lot in the last few weeks and have not seen this happen. (not on XP though)\nCan you check that all your drivers up to date and run windows updates?\n. From bazsi...@gmail.com on May 03, 2013 13:56:19\nmy drivers are up-to-date but i cannot run windows updates as i have a tweaked (finetuned) xp that cannot be updated from a certain point.\n. From maartenp...@hotmail.nl on May 03, 2013 14:34:37\nMaybe the tweaking-thing is the problem? Does this problem also occur with some other programs?\nStatus: Input\n. From mark.l1...@hotmail.co.uk on May 05, 2013 11:05:39\nI am not able to re-produce this with 0.21 0.20 or the trunk.\ncan anyone else?\n. From maartenp...@hotmail.nl on May 05, 2013 11:17:25\nI can't reproduce this either.\n. From Grim...@gmail.com on May 06, 2013 12:39:06\nBe aware the OP said he used Win XP.\nAnd you (OP) says that it is tuned/tweaked.\nIs this some kind of \"TinyXP\" that is found on the net, or anything home-made similar OS?\nIf that is the case, then I guess you have removed some drivers and files that might be needed for running the MapEdit .\nThis is just a guess, but I know that TinyXP can remove a whole bunch of files.\n. From static.o...@gmail.com on May 06, 2013 13:19:34\nI wouldn't be too quick to dismiss this one.\nWhen I was working on the map editor a month or so ago, I did notice that whilst debugging in Visual Studio whenever I quit it would crash on a certain line (I think it was WXWidgets related but I can't quite remember). I ignored it because it didn't have any effect on the release version, but I wrote a TODO to take a closer look at it when I have the time. It's possible that bazsikai has a debugger installed and it's reacting to it when otherwise it would be left to silently die.\n. From Grim...@gmail.com on May 06, 2013 13:30:55\nI wasn't dismissing it. I just want to hear if my hypothesis was right.\nBut this isn't breaking the map editor in any way, since you decided to close it anyhow when you tried to push the close button.\nBut it should be fixed nonetheless. :)\n. From static.o...@gmail.com on May 06, 2013 14:59:45\nThat wasn't a directed comment, Grimdoc. Sorry if it sounded a bit aggressive.\nI can't confirm just yet so I just don't want this issue to get closed prematurely before I can get a chance to be more definitive. I can distinctly remember being thrown an error on closing whilst debugging though.\n. From maartenp...@hotmail.nl on July 15, 2013 10:48:21\nAnd have you already got a chance to be more definitive about this issue Alan?\nLabels: -Priority-Medium Priority-Low\n. From static.o...@gmail.com on July 17, 2013 13:48:10\n@10 My dev PC is dead at the moment so I won't be doing anything until that's fixed I'm afraid. I'll make sure to look at this when I'm able to.\n. From maartenp...@hotmail.nl on July 18, 2013 00:10:58\n@11 I see that the luck is not on your site at the moment? Good luck with it.\n. From static.o...@gmail.com on August 18, 2013 05:35:05\nI've committed a fix for the crash I was seeing when closing the map editor ( r2417 ). We'll have to wait and see if it's the same issue as this one, but it's the only one I could find.\nbazsikai, I'd appreciate it if you could test the map editor in the latest snapshot when it gets built and get back to me.\n. From maartenp...@hotmail.nl on August 18, 2013 05:54:17\nBy me it closes fine as it always has done. So, now let's hope it is also fixed at bazsika's side.\nSummary: Mapedit crashes upon closure    (was: Mapedit crashes upon closure on RC 0.21) \n. Map Editions is not functional in 0.50 and slated to be replaced.\n. From maartenp...@hotmail.nl on May 03, 2013 14:54:47\nTry to see if you install the nexest version of DirectX solves your problem: http://www.microsoft.com/en-ca/download/details.aspx?id=35 .\n. From maartenp...@hotmail.nl on May 06, 2013 04:54:50\nI can reproduce this bug, but by me I can't only use the mouse and hear the music.\nStatus: Accepted\n. From Grim...@gmail.com on May 06, 2013 12:27:04\nCan't test with directx, only sdl working for me at the moment (testing).\nThis sounds like a directx problem.\n. From maartenp...@hotmail.nl on July 15, 2013 08:55:04\nBut now I can't reproduce the problem with version 0.21, strange....\nLabels: -Priority-Medium Priority-Low\n. From maartenp...@hotmail.nl on May 03, 2013 15:59:02\nThis stays on our TODO list I think, but I leave this open as this is really a kind of bug.\nStatus: Accepted\nLabels: -Type-Defect Type-Enhancement Component-UI\n. From mark.l1...@hotmail.co.uk on May 04, 2013 12:01:06\nNone of the dropdowns will collapse if clicked away, I would imagine that is intentional so you would need to select something, even if it was the same thing.  \nThe best person to answer this though is Manual, as it was he that added these, but his email no longer works.\n. From mark.l1...@hotmail.co.uk on May 04, 2013 12:04:45\nIt is actually marked as something to do in the file, so he may pick this up at some point\n-- TODO: Somehow make the dropdown disappear if the user clicks outside it.\nStatus: Queued\n. From maartenp...@hotmail.nl on May 04, 2013 12:46:17\nYes, that's what I mean.\n. From maartenp...@hotmail.nl on August 16, 2013 14:04:00\nSummary: Make the dropdown disappear if the user clicks outside it   (was: The difficulty selection picklist does not collapse automatically if clicked away) \n. From mark.l1...@hotmail.co.uk on May 08, 2013 03:00:08\nNoticed that there are a couple of \"attempt to index local 'hosp'\", which I though 0.21 was supposed to have fixed.\nWas this a new game or an old save?\nSummary: attempt to index local 'hosp'    (was: Patients always returning to toilets) \n. From maartenp...@hotmail.nl on May 08, 2013 03:35:09\nThe gamelog is from the errors using version 0.20 (see gamelog.txt.)\nSummary: Patients always returning to toilets   (was: attempt to index local 'hosp' ) \n. From mark.l1...@hotmail.co.uk on May 08, 2013 07:49:37\nIt looks like that there have been other errors with the save as one patient is stuck going home.\nOne of the patients has no history, this suggests he has not past reception yet.\nThey both appear to be locked into using the loo and are about to die, this is similar to the error when Dr's get stuck in a loop of not going for a break and the patient starts to die whilst waiting. Only similar in that the dealt with bit has not happened correctly so they can move on.\nSo, does this mean they have no next action to do?\nGiven the age of the save, it is not connected to the recent change in loo use - which I am glad about.\nPerhaps Edvin will have some ideas, so I'll queue this - he is not really available now until June.\nSummary: Two patients in a loop of loo use, keep on re-entering the Toilet room   (was: Patients always returning to toilets) \nStatus: Queued\nCc: edvin.li...@gmail.com\n. From maartenp...@hotmail.nl on May 18, 2013 04:46:55\nCould you provide some savegames from before the error and with the error? Did this happend after editing a room? This seems to be the problem (something with the blueprint of the room when editing) when I look at the error.\nSummary: Error ''bad argument #5 to updateRoomBlueprint'' when editing room   (was: Event Handler, Timer, Motion) \nStatus: Input\n. From mark.l1...@hotmail.co.uk on May 25, 2013 04:57:56\n@ Maarten  please avoid asking stupid questions,  jyfulness has stated that it was at the start of the game, so it did not save.  You could have tried to replicate the error; which is what I have done! \n@  jyfulness I get the same error if I start to build a room and expand the blueprint over the edge of the map.\nGiven that you should build rooms within the hospital the chances of this happening are very small. \nPerhaps it could be handled differently, I'll let Edvin decide that.\nStatus: Queued\nCc: edvin.li...@gmail.com\nLabels: -Priority-Medium Priority-Low\n. From mark.l1...@hotmail.co.uk on May 27, 2013 11:15:21\nI have just checked something else about this error.  \nTo re-produce it you have to be in debug mode and have limit camera un-ticked.  Otherwise you cannot scroll off the edge of the map.\nEdvin:  Do we try and fix errors that can only occur in debug mode?\n. From Grim...@gmail.com on May 27, 2013 12:26:54\nI don't think we should use resources for that right now at least..\nBut it is nice to have an \"error free\" game, even if it is just a debug menu.\n. From mark.l1...@hotmail.co.uk on May 27, 2013 12:43:45\nIt's not an error with the debug menu, it is something that could only happen if you are in debug mode.  Plus you would have to un tick the limit camera option to see the edge of the map to be able to scroll off it with the blue print of a room.\n. Stack trace:\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The motion handler.\nA stack trace is included below, and the handler has been disconnected.\n...rsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\dialogs\\edit_room.lua:1021: bad argument #5 to 'updateRoomBlueprint' (New rectangle is out of bounds)\nstack traceback:\n        [C]: in method 'updateRoomBlueprint'\n        ...rsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\dialogs\\edit_room.lua:1021: in method 'setBlueprintRect'\n        ...rsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\dialogs\\edit_room.lua:1344: in method 'onCursorWorldPositionChange'\n        ...deps_x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\window.lua:1295: in function <...deps_x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\window.lua:1291>\n        (...tail calls...)\n        ...eps_x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\game_ui.lua:423: in function <...eps_x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\game_ui.lua:415>\n        (...tail calls...)\n        ...ld_deps_x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:779: in function <...ld_deps_x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:774>\n. I've added the fix for this into my pull request.\n. From Bori...@gmail.com on May 20, 2013 01:03:44\nMy gamelog\nAttachment: gamelog.txt\n. From Grim...@gmail.com on May 20, 2013 05:56:16\nWas this a new game in version 0.21, or was it an old save from before?\n. From Bori...@gmail.com on May 20, 2013 06:15:48\nThis is a new savegame from game, started in 0.21 version\n. From mark.l1...@hotmail.co.uk on May 21, 2013 11:29:51\nCould be related to issue #916 .  Problem is with the two errors \"No animation for Standard Male Patient using hair_restorer\" is that this should not be possible.  Patients who need this clinic are not standard male patients, therefore how or why did he get in the room?\n. From mark.l1...@hotmail.co.uk on May 21, 2013 11:56:17\nSomething else that is odd, look at his room history and he is diagnosed with TV Personalities, so why did he go to the hair clinic?\nThere is another issue that I opened where I think it was bloaty head patients were queuing outside the wrong room, I think it was due to me building it in their path.  Can't find that issue as I keep getting error 500 (server error)!1 when trying to view the second page of the issues list!\n@ Borizzz \nWas this clinic always in the same place or did you build it in the space where a psychiatric room had been?\nAttachment: 2.png\n. From mark.l1...@hotmail.co.uk on May 24, 2013 11:14:22\nIssue 1583 has been merged into this issue.\n. From mark.l1...@hotmail.co.uk on May 28, 2013 11:34:27\n@ Borizzz \nWas this clinic always in the same place or did you build it in the space where a psychiatric room had been?\nStatus: Input\n. From Bori...@gmail.com on May 29, 2013 20:44:45\n@Mark - sorry for delay.\nThis clinic was always at same place.\nI've attached screenshot and marked problems:\n1. Doc in GD at the top;\n2. Doc near staff room at the middle;\n3. Visitor in WC at the top;\n4. Patient in hair restorer cabinet.\nAttachment: screen.PNG\n. From mark.l1...@hotmail.co.uk on May 30, 2013 03:11:09\nThis could take some figuring out.  The error makes sense, he should not be in that room, question now is why did he go to the hair restoration clinic when he was diagnosed with TV Personalities?\nSummary: Patient goes to the wrong room for treatment and causes error   (was: Doctors and patients stucks) \nStatus: Accepted\nCc: edvin.li...@gmail.com\n. From jottafan...@gmail.com on May 27, 2013 18:04:22\nEasy fixable through config, but should be easy to make a permanent fix aswell :)\nthrowing up a screenshot\nAttachment: Uten navn.png\n. Tested this with current master (SDL2) and the game simply scales.\n. From maartenp...@hotmail.nl on June 22, 2013 00:47:34\nBut I think this is a PART of the game. I think that such an option is not needed, but what do the other developers think of it? But when you want to be able to put earthquakes on/off, you should make an option of this in config.txt. But maybe you could also add some information about those two lines you found in the level files, I don't know if deleting them will put Earthquake off.\nSummary: Earthquake Toggle in Level file    (was: Earthquake Toggle in Level file) \nStatus: Input\nLabels: -Type-Suggestion -Priority-Medium Type-Enhancement Priority-Low\n. From edvin.li...@gmail.com on June 22, 2013 04:48:44\nWell, if you dont specify any earthquakes in a level file there will be none... So this suggestion is already in the game.\nStatus: Invalid\n. From mark.l1...@hotmail.co.uk on June 22, 2013 10:56:09\nI have just tested a custom level and left out the earthquake control and was surprised that I got an earthquake.  Could it be if they are not specified in the level file the game is adding them at random anyway?\nCc: edvin.li...@gmail.com\n. From mark.l1...@hotmail.co.uk on June 22, 2013 11:22:40\nNow tried the same map by adding #quake_control[0].StartMonth.EndMonth.Severity     1   2   0 as the only control and got a quake in May, it was a new game, just the same map.\nSo perhaps this is a valid suggestion or is there another way of not specifying a quake I am not aware of?\n. From Wolfwood...@aol.com on June 23, 2013 10:15:10\n@Maarten\nIt is a part of the game, but no more than emergencies, quarantines, or any other kind of reactive disaster. As of current, i believe emergencies can be set in the level file and will not go off without it. The earlier levels of Theme Hospital also don't have earthquakes.\n@Edvin\nThen could this be noted as a bug? Because it's not working that way. The .level file i'm currently using is based off of example.level, which had no quake controls.\n. From mark.l1...@hotmail.co.uk on June 23, 2013 11:00:47\nStatus: Accepted\nLabels: -Priority-Low Priority-High\n. From mark.l1...@hotmail.co.uk on September 02, 2013 12:25:26\nLooking at this again and taking into account that we know with emergencies the game is programmed to create them when there are none left in the level file (earthquakes appear to be the same with the exception of the campaign, which I think stops them in earlier levels)\nAs this behaviour is requested in another issue (creating them randomly), would it be a good idea to have cheat switches or a config option in the settings menu where a player can disable things like earthquakes, contagions and emergencies if they want to? (Disable Quakes | Disable Emergencies | Disable Contagions)\nIt could be something I can work on, but I don't want to invest any time on this if it is not going to be used.\nIf we went down the cheat route, it would then affect the players score, which seems to be just imo, for them not accepting all the challenges of the game.\n. From Wolfwood...@aol.com on September 08, 2013 10:18:28\nWhy is it just to punish someone just because they don't want to deal with 'one' of the challenges? Earthquakes aren't in the entire game in the original version.\nI would think the level file would be the best solution myself, as then you could just create levels that don't have earthquakes. It's not as if you want to alter the balance of the game, just have levels that aren't balanced around earthquakes.\nI'm just not understanding why the player should feel punished just because they don't want this one feature in a level, provided it's not in the entire game in the original version.\nIf i recalll, Emergencies already has a config option in the level file.\n. From mark.l1...@hotmail.co.uk on September 09, 2013 00:49:16\nI think that the only score that would be affected is that of the campaign.  This is because there is no end of level bonus when you have cheated, so I don't see there is a problem here to be honest.\n. From d.krasni...@yahoo.com on November 05, 2013 04:22:04\nFound it out, guys - if you don't want these irritating earthquakes to happen all the time, edit the #quake_control lines in the *.level file to look like this:\nquake_control[0].StartMonth.EndMonth.Severity 9999 99999 1\nIt means, that theoretically the earthquakes should start to happen at the 9999 month of the game and stop at the 99999 and have severity value of 1. I think, you can use even bigger values without any bugs.\nI removed all the other #quake_control[x] lines from my level file and so far played about 10 years without any earthshaking terrors.\n. From maartenp...@hotmail.nl on November 05, 2013 07:37:32\n@10: this method is not advised, because you can't easily revert this, unless you have a copy of the not-edited files of course....\nLabels: -Priority-High Priority-Medium\n. When we investigated this, didn't we find that the original game didn't do random earthquakes at the end of the specified ones.  If so, I consider that may be the best fix.\n. Closing as a duplicate of #296\n. My earthquake rewrite was done after 0.60 and will be in the next release.. From whiteros...@gmail.com on June 22, 2013 08:02:03\nI loaded an old save and tried to replicate this glitch. Sure enough, it didn't take me long. I just swapped Doctors in and out of the GPs a few times until I got it, then I saved.\nLook at where there are three GPs in a row. The Doctor in the lower left one is trapped, along with his Hairyitis Patient.\nThis particular Patient was coming through the door and on his way to the seat when I dropped the new Doctor in the room.\nThere's are two other glitches on this file which I'm sure you'll notice:\n1) The trapped Slack Tongue Patient beside the exploded room - she got stuck in the door to the X-Ray that used to be there. She was preventing the Doctor from entering or leaving (oddly enough, she wasn't stopping Patients from entering or exiting, just Doctors). Didn't stop me deleting the room.\n2) There's a Patient trapped in a Ward bed. No idea how that happened. Doesn't seem to be blocking Patients from using the nearby bed, but if you try to Edit that Ward, it won't work and you have a hung game.\nAttachment: exampleglitch2.sav\n. From mark.l1...@hotmail.co.uk on June 22, 2013 11:11:27\nLoad the attached save, very soon the Physiatrist will teleport to the general diag room and start diagnosing that patient - then the game throws and error.\nA few days earlier I had placed a replacement Dr in that room and moved the Physiatrist out.  I am adding this here as I think it is related to replacement Dr's.\nSavegame version is 75 (Trunk), originally it was 75 (Trunk)\nError in timer handler: \n...Mark\\Desktop\\corsixth\\spare_1\\CorsixTH\\Lua\\world.lua:1503: bad argument #4 to 'findPath' (number expected, got nil)\nstack traceback:\n    [C]: in function 'findPath'\n    ...Mark\\Desktop\\corsixth\\spare_1\\CorsixTH\\Lua\\world.lua:1503: in function 'getPath'\n    ...sixth\\spare_1\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:364: in function '?'\n    ...\\corsixth\\spare_1\\CorsixTH\\Lua\\entities\\humanoid.lua:547: in function 'Humanoid_startAction'\n    ...\\corsixth\\spare_1\\CorsixTH\\Lua\\entities\\humanoid.lua:639: in function 'finishAction'\n    ...sixth\\spare_1\\CorsixTH\\Lua\\humanoid_actions\\idle.lua:31: in function 'timer_function'\n    ...ark\\Desktop\\corsixth\\spare_1\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n    ...top\\corsixth\\spare_1\\CorsixTH\\Lua\\entities\\staff.lua:145: in function 'tick'\n    ...Mark\\Desktop\\corsixth\\spare_1\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n    ...s\\Mark\\Desktop\\corsixth\\spare_1\\CorsixTH\\Lua\\app.lua:789: in function <...s\\Mark\\Desktop\\corsixth\\spare_1\\CorsixTH\\Lua\\app.lua:786>\n    (tail call): ?\n    ...s\\Mark\\Desktop\\corsixth\\spare_1\\CorsixTH\\Lua\\app.lua:690: in function <...s\\Mark\\Desktop\\corsixth\\spare_1\\CorsixTH\\Lua\\app.lua:685>\nAttachment: Autosave6.sav\n. From david...@gmail.com on June 25, 2013 02:43:42\nJust to report that I am also getting the same problem. I'm not very good with the technical bits but I am willing to provide any requested information.\nVersion 0.21 Direct X on Win 7 64bit.\nThis problem has not been observed to be linked to manually replacing doctors or nurses in a room. I have noticed this seems to happen more frequently after earthquakes but am unable to verify it as such. I have also not noticed any error messages on the command line screen when this happens.\nIf I place a new doctor in the room, they also wander around without doing anything.\nDoctors or nurses do not go to staff room and eventually go \"crazy from overwork\".\nAlso, there seems to be an issue with entering and exiting a room (room size/layout is not an issue). Usually there is a queue, so if a Handyman or patient wants to enter/exit a room, they take turns. However, sometimes the queue gets stuck and no one can enter or exit a room. I have noticed that this only happens with GP, Psych, and Wards and only when they have no patients in them. The doctor or nurse appears to be doing the correct thing: i.e. sitting at desk, typing, fetching patient notes. Manually lifting/replacing staff have no effect on this as the new staff will also get stuck outside or inside. If the doctor or nurse is removed, an announcement is made for a replacement but they cannot enter. Only solution so far is to \"restart\" a room by pressing X on edit room dialog and replacing doors, windows and objects.\n. From maartenp...@hotmail.nl on July 13, 2013 02:47:54\nCould you provide gamelog.txt? But what do you mean with ''folowing a person leaving the hospital?'' Have you clicked on the patient?\n. From maartenp...@hotmail.nl on July 13, 2013 02:49:15\nCould you also provide a savegame where this error occurs?\n. From maartenp...@hotmail.nl on July 15, 2013 10:43:55\nThis issue seems to be a duplicate of issue #1645 or am I wrong?\n. From w.draa...@gmail.com on July 16, 2013 07:54:34\nI tried the Autosave4.sav   of issue #1645 and indeed it,s the same crash.\n. From maartenp...@hotmail.nl on July 16, 2013 07:59:00\nIssue 1645 has been merged into this issue.\n. From w.draa...@gmail.com on July 16, 2013 08:29:08\nOk\n. From maartenp...@hotmail.nl on August 18, 2013 05:08:13\nBut could you also provide the savegame where this error occured?\n. Fixed.\n. Not fixed, but duplicate of #124\n. From mark.l1...@hotmail.co.uk on July 20, 2013 12:54:39\nCan you attach the save where this happens, if possible an autosave from before and the gamelog.txt file?\n. From konradja...@gmail.com on July 21, 2013 05:12:16\nNo, I don't have save before error, only after.\nI want to create this situation but is difficult.\nAttachment: Misja 4 zapis.sav\n. From konradja...@gmail.com on July 21, 2013 05:12:53\nand gamelog\nAttachment: gamelog.txt\n. From mark.l1...@hotmail.co.uk on July 27, 2013 11:44:51\nInteresting error.  From what I can see it was the Dr in the Gen Diag room trying to walk to the space behind the radiator through the wall.  This was the error message eventually (the game does lock for a few minutes first)\nSavegame version changed from 72 (0.21) to 76 (Trunk). The save was created using 72 (0.21)\nError in timer handler: \n...cure and kill\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:130: Suspected infinite loop\nstack traceback:\n    [C]: in function 'error'\n    ...xth\\adviser msg - cure and kill\\CorsixTH\\Lua\\app.lua:715: in function <...xth\\adviser msg - cure and kill\\CorsixTH\\Lua\\app.lua:712>\n    ...cure and kill\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:130: in function <...cure and kill\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:129>\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    ...\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    ...\\adviser msg - cure and kill\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n    ... msg - cure and kill\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n    ...h\\adviser msg - cure and kill\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n    ...xth\\adviser msg - cure and kill\\CorsixTH\\Lua\\app.lua:796: in function <...xth\\adviser msg - cure and kill\\CorsixTH\\Lua\\app.lua:793>\n    (tail call): ?\n    ...xth\\adviser msg - cure and kill\\CorsixTH\\Lua\\app.lua:697: in function <...xth\\adviser msg - cure and kill\\CorsixTH\\Lua\\app.lua:692>\nPicking him up and putting him down again stopped the error from happening again.  I would like Edvin to look at this when he is back from his holidays, because of the suspected infinite loop.\nSummary: Suspected infinite loop crashed the game   (was: Reproducable crash after loading this savegame.) \nStatus: Queued\nCc: edvin.li...@gmail.com\n. From Joachim....@googlemail.com on July 28, 2013 01:01:12\nAh, that explains why I could get around by placing all doctors somewhere else - for a while, and then it happened again later on. I changed the layout in the GD room, and hope it won't happen again.\n. From mark.l1...@hotmail.co.uk on July 28, 2013 04:26:26\nI did wonder whether you had changed the room.  I want Edvin to take a look as it might be the Dr did not know the room had changed, perhaps not being updated correctly.  It could also explain some of the other windows hangs we can get.  I left it hanging whilst I checked the windows events, which is when the game then threw the error about the infinite loop.  I think normally when this happens you tend to opt to end the process with ctrl alt delete.\n. From Joachim....@googlemail.com on July 28, 2013 07:19:55\nThe room was built and not changed.\nUntil you gave me a hint what the cause is I would have never noticed that as a reason since it is not visible from the game that he wants to get around a radiator.\n. From Joachim....@googlemail.com on July 28, 2013 07:21:11\nPS Stable now with the rearranged room, I am already at the point where I have clearly won, it just takes time to accumulate to money.\n. From mark.l1...@hotmail.co.uk on July 29, 2013 11:26:03\nI am not able to reproduce this!\nDo you mean that when you click on the Dr you get the staff information screen and then when you click on the patient you get the patient information screen?  You can only have one of these screens open at any one time.\nPerhaps you can film the error for us?\nStatus: Input\n. From maartenp...@hotmail.nl on July 29, 2013 11:35:17\nNo: when the doctor is treating the patient in the inflation room, you can get the patient information screen when you click on the patient AND THE DOCTOR. Will make a movie of it and will post it here.\n. From maartenp...@hotmail.nl on July 29, 2013 11:55:20\nVideo: http://youtu.be/zXBKjOuT9QU\nStatus: Accepted\n. From mark.l1...@hotmail.co.uk on July 29, 2013 12:25:59\nI think that it is actually that you cannot open the staff information screen if the staff member is in the middle of using equipment. \nWhen you create an issue maarten don't mark it as accepted until someone else confirms.  It can get confusing if you accept your own reports.\nSummary: Inflation room: during treatment you cannot open the staff information screen, you only get the patients   (was: Inflation room: during treatment the doctor is seen as patient) \n. From maartenp...@hotmail.nl on July 29, 2013 12:29:38\nYes, next time I will not accept my own issues. \nBut you also see the same icon at the patient and at the doctor when the patient is been treated (see video.) It looks like that when you click or hold the cursor on the doctor during treatment, the game thinks you click or hold the cursor on the patient.\n. From mark.l1...@hotmail.co.uk on July 29, 2013 12:53:39\nI think it is that you cannot click on the Dr whilst he is using that machine.  You can on other machines, I checked it on the blood machine.  It might be to do with how close they are to each other.\n. From maartenp...@hotmail.nl on July 29, 2013 13:00:18\nThis bug doesn't affect other rooms indeed, but you can click on the doctor when he is on the other side of the room and then still the patient information screen is opened (see video.)\n. From Lmkoning...@gmail.com on July 29, 2013 16:36:13\nOfftopic: @maarten what capture tool are you using? Thanks\n. From maartenp...@hotmail.nl on July 30, 2013 01:29:59\n@8: I'm using Camtasia Studio 8 for this.\n. From Grim...@gmail.com on August 07, 2013 06:25:00\nI added this issue to issue #1494 (this is a list of all knows graphical glitches.)\n. From CharlesP...@googlemail.com on August 07, 2013 10:59:21\nand for reference, he's the (relevant parts of) my /usr/lib , when both lua5.1 and lua are installed:\nliblua5.1.a\nliblua5.1.so\nliblua5.1.so.5.1\nliblua5.1.so.5.1.5\nliblua.a\nliblua.so\nliblua.so.5.1\nliblua.so.5.1.5\nliblua.so.5.2\nliblua.so.5.2.1\n. From maartenp...@hotmail.nl on August 08, 2013 09:04:36\nBut as the compile wiki page sais: Lua 5.2 is not officially supported at the moment. But I think that CMake should not give an error when compiling with Lua 5.1. But maybe you're doing something else wrong? One of the developers with compile experience should look at this.\n. From maartenp...@hotmail.nl on August 08, 2013 09:05:19\nI mean that is also should not give an error when compiling with Lua 5.2!\n. From CharlesP...@googlemail.com on October 13, 2013 03:11:18\nAny sort of progress on this? It completely breaks compilation on arch without it\n. From maartenp...@hotmail.nl on October 13, 2013 03:15:23\nMaybe Edvin could help you as he has much more experience with compiling as I do?\nCc: edvin.li...@gmail.com\n. From edvin.li...@gmail.com on October 14, 2013 07:35:03\nJust to make sure: Did you clear the cmake cache after you removed 5.2?\n. From CharlesP...@googlemail.com on October 14, 2013 15:42:29\nAh, that appears to work :)\nhowever, this is obviously still a bug ;)\n. From CharlesP...@googlemail.com on October 14, 2013 15:44:07\nalso, note that CTH complains-ish that i'm not using LuaJIT, despite it being installed (2.0.2)\n. CorsixTH still can't compile with Lua 5.2.  I've been working on this lately and I have it compiling now but not running.\n. Duplicate of #262 to be fixed by pr #703 \n. From mark.l1...@hotmail.co.uk on August 19, 2013 01:12:08\nLabels: OpSys-OSX\n. From mark.l1...@hotmail.co.uk on August 19, 2013 01:20:22\nIf you can find the config you should be able to go back to windowed.\nI know you are having a problem on that score too, so you could do an un-install as that should clean all the files from your system and you can start again.\nConfig.txt should in theory be here for your system\n${XDG_CONFIG_HOME}/CorsixTH/config.txt or ~/.config/CorsixTH/config.txt\nSummary: Full screen crash - OSX   (was: Full screen crash) \n. From maartenp...@hotmail.nl on August 19, 2013 02:01:32\nLooks like the same crash (it's the same apple crash report) as in issue #1605 . They are both using MacOSX 10.6.8. But in that issue it crashes at startup and here when you set to fullscreen. Maybe the guy who does the MacOSX packages should look at this?\n. From maartenp...@hotmail.nl on August 19, 2013 02:12:24\nAnd also at that topic someone else also reported to have this crash and having MacOSX 10.6.8 too. So, it seems to be an issue at MacOSX 10.6.8.\n. From Him....@gmail.com on August 19, 2013 03:07:19\nThank you for the answer\nHow do I uninstall it, I cannot find the fill config.txt\nI don't understand what ${XDG_CONFIG_HOME}/CorsixTH/config.txt or ~/.config/CorsixTH/config.txt means...\nI have looked everywhere in my computer I cannot find any file call CorsixTH except CorsixTH.app the one I downloaded.\n. From maartenp...@hotmail.nl on August 19, 2013 03:16:49\nThese are the locations where the config file must be.\n. From Him....@gmail.com on August 19, 2013 03:18:33\nBut I don't understand what it means? what is XDG_CONFIG_HOME where do I find it?\n. From mark.l1...@hotmail.co.uk on August 19, 2013 04:38:26\nI have never used a mac computer, but in windows you can either open up a command window or type it in a search window or type it in the start button area (a field for search)\nfor uninstall there should be a menu item for that (in windows in programme files list there is a folder for corsixth) do you have anything similar?  If so look in that for uninstall.\nIf none of this works you will have to wait for someone who has the same os as you.\n. From mark.l1...@hotmail.co.uk on August 19, 2013 11:22:09\nHave you managed to uninstall or find the config?\nStatus: Input\n. From Him....@gmail.com on August 19, 2013 16:45:36\nNo I deleted all that was related to corsixTH and I rebooted my laptop but it still doesn't work. I am looking for corsixTH file, it must be somewhere. The problem is that I didn't put corsixTH.app in the application file at the first launch I think it is why CorsixTH file is not in the file application support  as it should be.\nThank you for the help, I will keep looking for it.\n. From Him....@gmail.com on August 20, 2013 06:28:21\nI created a new user on my laptop to be able to play, I still don't know where the file can be.\nWhatever\n. From Him....@gmail.com on September 05, 2013 02:39:30\nThanks!\n. From watashiw...@gmail.com on September 05, 2013 03:44:34\ntemp fix for fullscreen issue #10 .6.8\nopen terminal enter command:\ndefaults write com.apple.Finder AppleShowAllFiles YES\nfollowed by\nkillall Finder\ngoto your home folder you will see a hidden dir called .config you can edit config.txt there. Change fullscreen to false\nif any of the devs need a 10.6.8 mac to fix fullscreen i can happily test any builds and post and crashlogs etc here. \nThanks guys keep up good work.\n. From maartenp...@hotmail.nl on September 05, 2013 04:29:14\nHim.Rob: can you confirm the the temporary fix for this problem at comment 14 works for you? Maybe SDL2 ( https://groups.google.com/forum/#!topic/corsix-th-dev/qr0u-bHPj0w ) could fix this issue?\n. From Him....@gmail.com on September 05, 2013 14:28:05\nYes it worked but I used the command : defaults write com.apple.Finder AppleShowAllFiles TRUE (not YES)\nI don't know if it change something\nAnyway thank you !\n. From zool.v...@gmail.com on November 17, 2013 12:31:15\nThis fix worked for me too (same issue). I had to use YES, not TRUE in terminal. Too bad the windowed version is so tiny. Is there a way to make the window in the windowed version bigger? Config file maybe? :)\n. From maartenp...@hotmail.nl on August 19, 2013 03:18:56\nI would like the OK button; select the save and then press on OK to start it or just double click on a save to start it.\n. From maartenp...@hotmail.nl on August 21, 2013 10:21:22\nBut that save is from version 0.20. Can you also reproduce this error with a brand new game of the most recent snapshot? \nSo, you're patch fixes an error about calling for the advisor to tell us about the number of patient deaths, but then it will throws an another error (probably related to a patient who wants to use the exploded room?)\n. From mark.l1...@hotmail.co.uk on August 21, 2013 11:41:30\nThat save has been used a lot and has been kept up to date with each update.  I doubt that has anything to do with this issue.  If you want to try an reproduce it with the latest version be my guest.  It could take a while to try and get a room to explode just at the instant someone is about to use the door.\nThe patch does fix another error where I used self.hospital to call a function when I should have used the local hospital which also takes into account that the patient may be on his way home cured\n. From peter.j....@gmail.com on September 09, 2013 05:44:37\nI just had the same or a similar issue with my exploding X-ray in 0.21 (I started the game in 0.21.):\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nB:\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:219: attempt to index field 'queue' (a\n nil value)\nstack traceback:\n        B:\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:219: in function \n        (tail call): ?\n        B:\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:179: in function 'timer_functi\non'\n        B:\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n        B:\\CorsixTH\\Lua\\entities\\staff.lua:145: in function 'tick'\n        B:\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n        B:\\CorsixTH\\Lua\\app.lua:789: in function \n        (tail call): ?\n        B:\\CorsixTH\\Lua\\app.lua:690: in function \nWarning: No event handler for timer\nI got another, identical error after carrying on playing after \"attempting to recover\":\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nB:\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:219: attempt to index field 'queue' (a\n nil value)\nstack traceback:\n        B:\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:219: in function \n        (tail call): ?\n        B:\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:179: in function 'timer_functi\non'\n        B:\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n        B:\\CorsixTH\\Lua\\entities\\staff.lua:145: in function 'tick'\n        B:\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n        B:\\CorsixTH\\Lua\\app.lua:789: in function \n        (tail call): ?\n        B:\\CorsixTH\\Lua\\app.lua:690: in function \nI loaded the gamesave and got back to the earthquake and got the following (different) traceback:\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nB:\\CorsixTH\\Lua\\world.lua:1486: bad argument #4 to 'findDistance' (number expect\ned, got nil)\nstack traceback:\n        [C]: in function 'findDistance'\n        B:\\CorsixTH\\Lua\\world.lua:1486: in function 'getPathDistance'\n        B:\\CorsixTH\\Lua\\hospital.lua:1624: in function 'searchForHandymanTask'\n        B:\\CorsixTH\\Lua\\entities\\staff.lua:892: in function 'searchForHandymanTa\nsk'\n        B:\\CorsixTH\\Lua\\calls_dispatcher.lua:232: in function 'answerCall'\n        B:\\CorsixTH\\Lua\\humanoid_actions\\answer_call.lua:24: in function '?'\n        B:\\CorsixTH\\Lua\\entities\\humanoid.lua:547: in function 'Humanoid_startAc\ntion'\n        B:\\CorsixTH\\Lua\\entities\\humanoid.lua:639: in function 'finishAction'\n        B:\\CorsixTH\\Lua\\humanoid_actions\\sweep_floor.lua:29: in function 'timer_\nfunction'\n        B:\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n        B:\\CorsixTH\\Lua\\entities\\staff.lua:145: in function 'tick'\n        B:\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n        B:\\CorsixTH\\Lua\\app.lua:789: in function \n        (tail call): ?\n        B:\\CorsixTH\\Lua\\app.lua:690: in function \nWeird thing is that it's not happening any more straight after the quake when I load the gamesave. Immediately after the earthquake, lots of Question-mark boxes pop up at the bottom (this happened the first time, but after the error not before). I start accepting these and I get the error (same traceback as immediately above) again. Gamesave is attached.\nAttachment: Autosave3.sav\n. From mark.l1...@hotmail.co.uk on September 10, 2013 11:36:44\nI think there must still be some issues with exploding rooms.  The faxes are most likely to do with any patients that want one of the exploded rooms.\nThis is perhaps something that we should try and fix before the next release?\nLabels: -Priority-Medium Priority-High Milestone-0.30\n. From Grim...@gmail.com on June 03, 2014 08:47:59\nTried both saves in this issue with the newest master repo, and both went well.\nThe rooms exploded, and no errors thrown.\nAny other (recent) examples of this happening?\nStatus: Input\n. From Grim...@gmail.com on June 03, 2014 08:50:58\nSorry. I was using the patches from this pullreq: https://github.com/CorsixTH/CorsixTH/pull/266 With this installed, I got no errors.\nBut without it (master), I got the errors.\n. From mark.l1...@hotmail.co.uk on June 04, 2014 05:11:08\nI wonder why you are not getting the error with that pull request, as it does not appear to be related (it's more to do with price effect)?\nStatus: Queued\n. From mark.l1...@hotmail.co.uk on September 01, 2013 11:40:07\nLets see you have over twenty rooms with a machine and over twenty plants that all want watering, but I can only see four handymen!\nThat could be why you lost so many rooms in the earthquake.\nWhat I do find odd with this save is there are two fracture clinics that have not exploded correctly and both still have the machine and a headless nurse.  This could be why you are getting errors here.\nSummary: Fracture Clinic not destroyed correctly in explosion   (was: Earthquakes shake up all of the game's AI) \nStatus: Queued\n. From elisabet...@gmail.com on September 01, 2013 12:49:09\nThanks!\nThe save is a mess, so I didn't even notice the fracture clinics. There's been a series of earthquakes of various magnitude, so the rooms have exploded over time. I originally had 7 or 8 handymen, but some were killed in the explosions, I guess, and then the ones I had left started freezing, with the need for maintenance piling up. My experience is that the earthquakes are the main issue, causing instability in the first place. As this level has so many earthquakes, the problem becomes a lot more prominent than in previous levels, with none or a lot fewer earthquakes.\n. From Grim...@gmail.com on September 01, 2013 14:30:20\nYes, the main issue here seems to be that the rooms aren't destroyed correctly by the earthquake.\nAnd people are trying to access some of them after they are destroyed.\n. From edvin.li...@gmail.com on September 03, 2013 10:02:59\nHave you tried using the PPA at https://launchpad.net/~jon-severinsson/+archive/ffmpeg as described on the How-To-Compile wiki page? I haven't tried it recently but it worked a few months ago.\nStatus: Input\n. From mark.l1...@hotmail.co.uk on October 16, 2013 11:49:11\nA copy of your save or autosave and the gamelog.txt will help us discover what the problem is.\nIf you are a windows user you will find a shortcut to the folder where these are stored in your start menu.\n\"CorsixTH AppData Folder\"\n. From rachelc...@gmail.com on October 16, 2013 11:56:13\nHere are the files. It happens right after an earthquake occurs.\nAttachment: Level 5.sav gamelog.txt\n. From gedd...@gmail.com on December 18, 2013 12:42:45\nI also seem to be having this error, but it's the handyman going into the scanner room instead. Always happens after an earthquake.\nAttachment: Earthquake.txt Earthquake.sav\n. From mark.l1...@hotmail.co.uk on December 20, 2013 07:47:14\nThis would appear to be the same as another issue, as he is going into the wrong room to repair the fracture clinic machine - see issue #1437\nStatus: Queued\n. From mark.l1...@hotmail.co.uk on October 19, 2013 11:10:50\nAll this seems to do is reverse something that was added intentionally two years ago - see issue #901 .\n. I guess the patch is lost on this, but the idea isn't a bad one. It's clear from the thread that some people want the original theme hospital behavior, and when there is controversy it's good to side with the original game.\n. From mark.l1...@hotmail.co.uk on October 27, 2013 01:35:03\nafter adding the location of the font did you restart the game?\n. From mark.l1...@hotmail.co.uk on October 27, 2013 02:08:33\nWhen you change the font in the config that line should look something like this\nunicode_font = [[C:\\Windows\\Fonts\\arialuni.ttf]]\ndoes that font contain Chinese characters though?  (for me it does not)\nAttachment: a.png\n. From maartenp...@hotmail.nl on October 27, 2013 03:14:54\nThen probably there is an error in the Chinese translation and then this translation is disabled at start?\n. From shuffle....@gmail.com on October 28, 2013 05:25:23\nYes I do restart the game after setting the font.\nI'm not sure if the font contains Chinese characters, how could I check this?\n. From mark.l1...@hotmail.co.uk on October 28, 2013 06:44:25\nI would try and select a font that you know has the correct characters in it, perhaps one you use in word and see if that works.\n. From Grim...@gmail.com on October 28, 2013 12:00:39\nI see that you miss all the language that use that kind of characters:\nKorean\nSimplified Chinese \nTraditional Chinese\n And maybe others.\nPS: Should we maybe add the english name for the translation to the menu so that everyone can easily identify the language?\nFor example I can't tell chinese from korean.\nExample of what the menu would look like:\nCastellano (Spanish)\nDansk (Danish)\nDeutsch (German)\n Etc..\n. From shuffle....@gmail.com on October 28, 2013 16:11:53\nHummm..\nI just tried typing chinese characters with Arial Unicode MS in word.\nUnfortunately my font contains them :<\n. The OSX versions were missing FreeType so they didn't show any of the unicode languages.  This has been resolved in 0.40.\n. The most common reason for this is that the font in your config.txt doesn't cover the characters (or isn't set). See #823 \nThe cause of this issue was resolved.. From maartenp...@hotmail.nl on October 31, 2013 10:41:24\nCould you also provide gamelog.txt?\n. From maartenp...@hotmail.nl on October 31, 2013 10:51:10\nI can't reproduce the errors with version 0.30 RC. Could you provide the EXACT steps you did to produce the error?: like where have you replaced the diag. room? And do you mean the research room with diag. room? And where did you place/move those plants, drink machines etc.?\n. From evans1...@hotmail.co.uk on October 31, 2013 11:18:21\nHi I get the error after moving the research room and completing it and then move the GP office (the one against the wall behind the reception desk to the corner space [top left] behind it) or if I place a new GP office in this corner space. I then place drinks machine, 2x benches, radiator and plants along the new wall created by the GP office in the corner. Usually by this point I get one of the errors mentioned either the error code message or the humanoid empty action command.\nVery occasionally this will be fine for some minutes after the move and will occur when I place a ward or op theatre near the newly placed research room in the bottom section of building. But most of the time I just complete the move of the GP office to the top left corner and it goes.\nMany thanks\nDan\nSent from my iPad\n. From evans1...@hotmail.co.uk on November 01, 2013 15:07:06\nSorry the saved file uploaded earlier is actually the incorrect file for this fault. The correct file is attached below. I have also added a video clip of the error occurring. It happens approx. 1 - 2min into game play.\nbelow is the gamelog.txt\nNotice: LuaJIT not being used.\nConsider replacing Lua with LuaJIT to improve performance.\n\nWelcome to CorsixTH 0.21!\n\nThis window will display useful information if an error occurs.\n\n[smk @ 11944540] max_analyze_duration 5000000 reached at 5016000\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nC:\\Program Files\\CorsixTH\\Lua\\utility.lua:188: stack overflow\nstack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\utility.lua:188: in function 'ipairs'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1885: in function 'getObject'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1525: in function \n        [C]: in function 'findObject'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1524: in function 'getFreeBench'\n...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:175: in function\n'onChangeQueuePosition'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:362: in function\n '?'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:547: in function 'Hu\nmanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:623: in function 'qu\neueAction'\n        ...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:261: in function\n <...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:201>\n        (tail call): ?\n        ...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:179: in function\n <...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:129>\n        ...\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:547: in function 'Hu\nmanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:623: in function 'qu\neueAction'\n        ...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:261: in function\n <...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:201>\n        (tail call): ?\n        ...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:179: in function\n 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:789: in function \n        (tail call): ?\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:690: in function \nWarning: No event handler for timer\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nC:\\Program Files\\CorsixTH\\Lua\\utility.lua:188: stack overflow\nstack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\utility.lua:188: in function 'ipairs'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1885: in function 'getObject'\n        ...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:214: in function\n <...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:201>\n        (tail call): ?\n        ...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:179: in function\n <...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:129>\n        (tail call): ?\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:547: in function 'Hu\nmanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:623: in function 'qu\neueAction'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:236: in function\n 'onChangeQueuePosition'\n        ...ro...\n. From evans1...@hotmail.co.uk on November 01, 2013 15:07:06\n...gram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:362: in function\n '?'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:547: in function 'Hu\nmanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:623: in function 'qu\neueAction'\n        ...\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:614: in function 'se\ntNextAction'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:775: in function 'makeHumanoidLea\nve'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:491: in function 'Hu\nmanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:639: in function 'fi\nnishAction'\n        ...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:144: in function\n 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:789: in function \n        (tail call): ?\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:690: in function \nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nWarning: Entity tile changed while marked as using an object\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\n...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:232: Could not find an i\ndle or drink action when trying to stand in line.\nstack traceback:\n        [C]: in function 'error'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:232: in function\n 'onChangeQueuePosition'\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:166: in function 'push'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:349: in function\n '?'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:547: in function 'Hu\nmanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:623: in function 'qu\neueAction'\n        ...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:261: in function\n <...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:201>\n        (tail call): ?\n        ...Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:179: in function\n 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:145: in function 'tick'\nC:\\Program Files\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:789: in function \\<C:\\Program Files\n\\CorsixTH\\Lua\\app.lua:786>\n        (tail call): ?\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:690: in function \nAttachment: level 8 nov13.sav TH CorsixTH failure.MOV\n. From walzer.e...@gmail.com on November 02, 2013 11:49:21\nJust happen to think to try to refuse the urgency, will try it asap.\n. From walzer.e...@gmail.com on November 02, 2013 12:43:33\ni tried to accept the urgency, to refuse the urgency, or simply not to read it at all.\ndoesn't change anything.\n. From mark.l1...@hotmail.co.uk on November 03, 2013 02:07:56\nI don't know what you mean about the famous level 5 bug.  \nYou lost the level as simple as that.  Look at the reputation bar in the progress report screen and you are way below the minimum for this level.\nRestart the level and try and get a better reputation.\nStatus: Invalid\n. From maartenp...@hotmail.nl on November 11, 2013 00:00:35\n@Mark: there was a level 5 bug in the original TH: http://fr.wikipedia.org/wiki/Theme_Hospital#Bug_de_la_version_fran.C3.A7aise\n. From mark.l1...@hotmail.co.uk on November 11, 2013 02:04:48\nSo only famous to French speakers then, which will be why I have never heard of it :)\n. From mark.l1...@hotmail.co.uk on November 12, 2013 08:15:00\nIf this \"famous level 5 bug\" (famous to French speakers) was just a poor translation in the original data file, I wonder why the French translator for CorsixTH has not done an over ride for it?  There are other over rides for errors etc already, so one more is not going to hurt anything.\nI will queue this as something to be looked at.\nSummary: Issue with poor translation of an advisor string from original TH data (maybe over ride it?)   (was: game plant when urgent patients arrive, level7-8) \nStatus: Queued\nLabels: -Type-Defect -Priority-Medium Type-Other Priority-Low Component-Language\n. From mark.l1...@hotmail.co.uk on January 22, 2014 12:13:40\nSummary: Issue with poor translation of an advisor string from original TH data (French translator could fix maybe?)   (was: Issue with poor translation of an advisor string from original TH data (maybe over ride it?)) \n. From dr.dr....@o2mail.de on November 07, 2013 07:43:25\nAttachment: issue1723.sav\n. From mark.l1...@hotmail.co.uk on November 07, 2013 11:13:28\nStatus: Accepted\n. From maartenp...@hotmail.nl on November 18, 2013 06:53:12\nCould you provide gamelog.txt?\n. From jamespet...@gmail.com on November 18, 2013 14:58:52\nEver since I got an earthquake in one of the previous levels (i think level 6 or 7) the game crashed and triggered this message.\n[smk @ 0000000000e09060 max_analyze_duration 5000000 reached at 5016000\nThis message has remained there ever since then even after closing corsix and restarting it again, I have no idea what it means but maybe it will shed some light on something that has gone wrong? I just ignored it as the game seemed to continue as normal after reloading my save.\nFrom James\nAttachment: Corsix Error.png\n. From mark.l1...@hotmail.co.uk on November 19, 2013 03:38:10\nThat is not an error and is nothing to worry about.\nIt is something related to the movie playback and can be ignored\nIf the game crashed it is unlikely to be anything to do with that message\n. From jamespet...@gmail.com on November 19, 2013 15:13:22\nWhere can I find my gamelog file? Which directory is it placed in?\n. From maartenp...@hotmail.nl on November 20, 2013 02:39:24\nYou can find it at this (C:\\Users\\$(User)\\AppData\\Roaming\\CorsixTH) or this ($(APPDATA)\\CorsixTH)location.\n. From mark.l1...@hotmail.co.uk on November 20, 2013 04:44:13\nAs a windows user you can also find it from the start menu.  Look for CorsixTH and then CorsixTH AppData Folder\n. From mark.l1...@hotmail.co.uk on November 21, 2013 12:04:54\nWith your save I did get the following error following an earthquake that destroyed several rooms\nSavegame version is 80 (Trunk), originally it was 72 (0.21)\nError in timer handler: \n...CorsixTH\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:143: attempt to compare nil with number\nstack traceback:\n    ...CorsixTH\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:143: in function 'action_seek_room_no_diagnosis_room_found'\n    ...CorsixTH\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:292: in function '?'\n    ...s\\GitHub\\CorsixTH\\CorsixTH\\Lua\\entities\\humanoid.lua:550: in function 'Humanoid_startAction'\n    ...s\\GitHub\\CorsixTH\\CorsixTH\\Lua\\entities\\humanoid.lua:642: in function 'finishAction'\n    ...tHub\\CorsixTH\\CorsixTH\\Lua\\humanoid_actions\\idle.lua:31: in function 'timer_function'\n    ...rk\\Documents\\GitHub\\CorsixTH\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n    ...ents\\GitHub\\CorsixTH\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n    ...ark\\Documents\\GitHub\\CorsixTH\\CorsixTH\\Lua\\world.lua:1063: in function 'onTick'\n    ...\\Mark\\Documents\\GitHub\\CorsixTH\\CorsixTH\\Lua\\app.lua:839: in function <...\\Mark\\Documents\\GitHub\\CorsixTH\\CorsixTH\\Lua\\app.lua:836>\n    (tail call): ?\n    ...\\Mark\\Documents\\GitHub\\CorsixTH\\CorsixTH\\Lua\\app.lua:740: in function <...\\Mark\\Documents\\GitHub\\CorsixTH\\CorsixTH\\Lua\\app.lua:735>\nI am looking into your issue, but I have a feeling that it something we have already fixed in the development copy - fingers crossed\nStatus: Started\n. This issue, or a set of circumstances leading to the same stack trace that also involved removing a room is still present in the latest master as evidenced in the final comments of #780\n. From maartenp...@hotmail.nl on November 24, 2013 04:05:53\nCould you provide gamelog.txt as already asked in the issue-template?\n. From Kirbe...@gmail.com on November 24, 2013 04:13:45\nI didn't provide a gamelog.txt, since there was no gamelog for this level. The last gamelog.txt update was from a few days ago.\n. From maartenp...@hotmail.nl on November 24, 2013 05:20:25\nSo, you mean that the gamelog.txt file at the appdata location was not edited after you got this problem for the first time? Could you please still provide gamelog.txt? Maybe it does contain some useful info?\n. From Kirbe...@gmail.com on November 24, 2013 15:45:59\nTo clarify, I played that level (from start) only a few hours yesterday, and there were no changes to the gamelog.txt file (in appdata location) during that time.\n. From Kirbe...@gmail.com on November 24, 2013 20:20:01\nI reproduced the problem again, with scanner room this time.\nI attached another saved game, and a gamelog.\nAttachment: gamelog.txt\n. From Kirbe...@gmail.com on November 24, 2013 20:24:13\nActually it is even worse, with the scanner room. The doctor can't leave the scanner room, and the doctor can't be moved manually removed from the scanner room either. So no way to destroy and rebuild that room.\n. From Kirbe...@gmail.com on November 24, 2013 20:26:46\nAttachment: Scanner blocked.sav\n. From maartenp...@hotmail.nl on March 20, 2014 09:59:54\nThis is because you're using an illegal/pirated version of T, which are known to have this bug. If that is not true, please report this issue again at our new GitHub issue tracker!\nStatus: Invalid\n. From maartenp...@hotmail.nl on March 20, 2014 10:00:21\nWith T I mean TH! :)\n. From mark.l1...@hotmail.co.uk on March 21, 2014 13:58:51\nThe fonts come from the original game and you are right in places they can look bad.\nThe good news is the developers are working on a new sdl2 version which has zoom function. I am not sure whether this will improve the fonts though, but if as you say they are better in sdl now, there is no reason I can think of for them not to be in sdl2.\nPlease accept our apologies for Mr Peters, you have said nothing that would lead me to think you are using a pirated version.  The fonts look bad in places for me too, more so with OGL and I have had my TH disk since 1996 :)\nStatus: Accepted\nCc: edvin.li...@gmail.com\n. From maartenp...@hotmail.nl on March 21, 2014 16:40:57\nSorry, my fault! This issue has been reported several times (but then the fonts were almost unreadeble) Now I looked not good at the images and thought this was an another one. My excuses. Could you make a issue report of this at our GitHub page?\n. From spea...@googlemail.com on March 26, 2014 18:13:45\nHi,\nTHX for your apology. I justgot the good-old-games Version of the game which was sold for less than 3$... Thats y i came to this issue. I will reopen a case in github the Moment i figured out how to do so... Perhaps i should just stop doing those things at 2am ;)\n. How were you thinking 'bigger vomit' would work?\n. Yes it's possible, and a good suggestion, thanks.\n. The file doesn't interfere with my work flow.  I generally advocate git add *changed file* instead of git commit -a.  That said I don't mind at all removing the file, putting it in the ignore list, and putting in a detailed error message when trying to run debug without the file - it does sound like a cleaner way to go.\n. @J-Shep this means you should put the language files back in your eclipse project. #399 \n. @admdly the LevelEdit is already a \"first-party\" app, shipped with the Windows releases.\nThere is plans to merge it with MapEdit (whose own future is a little up in the air right now), but no one is working on it.\n. @koanxd what you propose is worthwhile.  There is a lot of work to be done before LevelEdit becomes redundant, so I strongly suspect it will be shipped with the next version.\n. It would be nice if the level edit capabilities were part of the map edit functionality which is being integrated into the game, but no one is working on that right now and there's no reason to think it will happen soon.\nIf you would like to take ownership of the LevelEdit Java tool in the mean time I would prefer that it become it's own project under the CorsixTH organization with it's own independent releases, similar to the CorsixTH-Graphics project.\nIf that is something you're interested in, I could set that up for you.\n. I haven't heard anything since that last update two years ago.. l_randomdump and l_randomseed (see random.c) exist for this purpose. Storing a table of generated random numbers from a deterministic random number generator would be wasteful.\n. All I'm saying is that the random numbers don't need to be stored. If you dump the initial random seed, and then populate it at the start of the replay the numbers will be the same.\n. Multiplayer is actually somewhat contingent on a lot of the same work needed to get this working properly - that is a deterministic client that can play a list of events and end up at the same end state.\n. I'm not sure anyone was ever able to reproduce it, even you.\n. Should note that the error hints that the cursor left the map area. There have been changes related to cursor to map location binding.\n. Cannot reproduce.\n. This sounds like an upstream SDL issue, anything in their bug tracker?\n. It isn't fixed in 2.0.4 shipped with 0.60?\n. We are not actually invoking SDL_StartTextInput on text fields so the OS has no indication that it should bring up the keyboard. See https://wiki.libsdl.org/SDL_StartTextInput. Potentially fixed by #1245 - Needs someone to test.. Note that I didn't address the SDL2 upstream issue reported earlier in this ticket. I don't have any way to verify if that's still a problem. Was there an upstream ticket?. I don't think so, we didn't add any gesture support explicitly during the SDL2 transition.\n. When you run cmake you may need to point to the proper location.  Incidentally for personal use you don't need that ppa, you can just copy ffmpeg libs to some local path and compile against that.\n. Could you also paste your CMakeCache.txt\n. Alright, you're getting linker errors with swresample.a.  I'm not sure it's valid to be mixing libav and ffmpeg libraries like that, it seems likely that swresample.a would have unsatisfied dependencies so you might first try switching all your libav libraries to ffmpeg ones.\n. I believe if you can add -lz to your compile flags it should fix that error.  Not entirely clear if that dependency only comes up because of the static linking or git ffmpeg, or some other reason.\n. The whole situation is extremely unfortunate, but we're not trying to penalize debian/ubuntu users.  The ffmpeg/libav fork was extremely messy, with a lot of fud and misinformation being spread by both sides, and both sides claiming that they were the true ffmpeg so neither would change their library names to avoid collision. Further developers on the libav side held positions of authority at Debian/Ubuntu which lead to an overly hasty fragmentation of distros as well.  The resampling libraries (libavresample from libav and libswresample from ffmpeg) were the worst affected because they were developed right at the beginning of the fork when the sides were most bitterly opposed.  Anyway despite the information at the time it seems that ffmpeg is maintaining their libavresample library and switching to it would probably be a good choice - I may eventually do it my self as I'm no longer as fed up with it all as I was a year ago.\n. Did you read that link you posted, they spent 3 months porting from libswresample to libavresample, which is exactly what I said was needed above.\n. Thanks for clearing that up @TobiX \n. Sadly the zeranoe builds of ffmpeg for windows which we have been using do not contain libavresample.  If I do decide to support libav it seems like I'd want to implement with both libraries and make cmake ask for one or the other.\n. And I am open to other people implementing this if anyone has any interest.\n. My pull request above solves this issue, pass -DWITH_LIBAV to cmake.\n. Interesting.  I was writing this using libav-11.1  Which version are you using?\n. Even in the oldest version of libav with documentation (0.5) av_recale_rnd is defined (https://libav.org/doxygen/release/0.5/mathematics_8h.html#ad686ab94939ed4c65218309e94bdca72) which should have been included by the #include<libavutil/avutil.h> line near the top of th_movies.cpp (https://libav.org/doxygen/release/0.5/avutil_8h.html)\nIs it possible some of the remnants of your experiments with ffmpeg were left over?  If you can't find anything, could you paste your CMakeCache.txt file contents.\n. I looked at that version and it appears that mathematics.h is actually not being pulled in.  Would you mind testing my theory?\nIn the extern \"C\" block at the top of CorsixTH\\src\\th_movie.cpp, just below #include<libavutil/avutil.h> could you add #include<libavutil/mathematics.h> and see if that fixes it?\n. If you disable movies in your config.txt does the game work fine with that compile?\nI think I'm going to have to install Ubuntu somewhere\n. I have Arch Linux and Windows machines.  For libav I've been using Windows because Arch uses ffmpeg.\n. @legluondunet Just to eliminate certain possibilities;\nStephen@StephenG750 /cygdrive/e/Theme Hospital/HOSPITAL/ANIMS\n$ md5sum *\n4d0c496b10b1b451e91775b11d836f75 *320X2401.SMK\n2482104ac9d185994dc31ac4eecb1fb1 *320X2402.SMK\n241a38b84de945e52af66acfceeeb4ea *320X2403.SMK\ncac991cb86962b70401a3c6722911c10 *320X2404.SMK\n3abafe170e38df1328b46de6d8b5557a *320X2405.SMK\ndc28d06cc94511eb60e2991dce8055c3 *320X2406.SMK\n418c37b21abb838da7ed177dc58cfc45 *AREA01V.SMK\ncd37e94f786a8e93c55be2f8ae0d7b0c *AREA02V.SMK\n703f95bd357c7def52fd685248a1b1fb *AREA03V.SMK\n369b93f872b7be880160fd5441580058 *AREA04V.SMK\n1ef9f28b07a2f328aba7cee63b5e872d *AREA05V.SMK\n234ea556ba5f3a683233dedaa3ef497b *AREA06V.SMK\ndd0b8e9b3cfd545c9dade86973f7e232 *AREA07V.SMK\n582ed9b17ddeea60e0f537f89a552185 *AREA08V.SMK\na7869a354753214290a0ac1d1b62f442 *AREA09V.SMK\n2a5a9406a3594d3c30cb95a3be88e378 *AREA10V.SMK\nb8e7d45a3b0173444d259177e10ec130 *AREA11V.SMK\ned46f581d2aca167dafe2caa114baae0 *AREA12V.SMK\nfd49324840bcf4e0bb24bff094cee059 *AREA13V.SMK\n625ade4e866efdaeb9d8a1e169fcc46c *AREA14V.SMK\nf5012250aab9844ca41346a8651dcf94 *ATTRACT.SMK\n48cb59596caed2e4a309686f6bc53394 *LOPAPER.SMK\n844be5d66f842101d96726f1a69e10c3 *LOSE1.SMK\nfe3010b2a74822d1fca46be00d4db307 *LOSE2.SMK\n92dd1273563847e2d8345f406a1e0fd2 *LOSE3.SMK\n35653bec56aac35006ea50ea7e143218 *LOSE4.SMK\n8976d0f82938281498e9d1eab50a33d2 *LOSE5.SMK\nb30fcad0a7ca654e74d5825bdd5d449a *LOSE6.SMK\ne6923850b74703c48a056fbc9c52431f *MMENU1-0.SMK\n7594c2c37bec795e4f89f19fb415fe98 *MMENU2-0.SMK\n8fd881cf9f39cbf4923e4d331ef1b2ef *WINGAME.SMK\nad06e8010536d1776bf83e1b7d5a8a13 *WINLEVEL.SMK\nand\nStephen@StephenG750 /cygdrive/e/Theme Hospital/HOSPITAL/INTRO\n$ md5sum *\nad4bff04dfb64bc4216d821b4cf3d303 *ATTRACT.SMK\nad5a79ad8df98292220b16e6a29422c1 *INTRO.SM2\n93eeb6c1bb704b976268e87d2a72067d *INTRO.SM4\n. Alright, so we've confirmed your movies are not corrupt.  That's good.  I'm working on getting an Ubuntu 14.04.1 LTS vm up and running, and maybe a 14.10 one while I'm at it.  Will report back when I know more.\n. I'm seeing the same behaviour as you in my Ubuntu 14.04.1 LTS VM.  At least in my VM it appears that avplay (from libav-tools) can't play the intro properly either which doesn't inspire much confidence in that version.  (I don't get a black screen, but I get the video with no sound, followed by the video being frozen with only the sound playing.)\nDo you see the same thing?  If so I think there's a bug with smacker playback that's only fixed in a later version.\n. Alright, that's the same as what I'm seeing with that libav version.  So between that and the the \"max analyze duration reached\" error it looks like the smacker video codec in that version of libav is buggy.\nWhen I next have time to sit with this there are a couple things I will check:\nHow Ubuntu 14.10 behaves (It uses the same version of libav that I've been targeting on Windows).\nHow libav 9.16 behaves on Windows\nAnd finally whether I can workaround the issue by specifying the frame time stamps myself when an older version of libav is detected or whether it's deeper than that.\nIf we can't easily produce a workaround then we might just target Ubuntu 14.10 and higher for movies.\n. I've confirmed that with my patch movies are working perfectly in Ubuntu 14.10.\n. I think this script is mostly obsolete for master.  #621 makes the movie section unnecessary (at least for Ubuntu 14.10 and higher), and sdl2 means the map editor flag isn't currently useful.\n. Perhaps it should go in the wiki as a recommendation for 0.40?\n. Why was this closed?\n. You can update the code and commit again, or because you refuted them we could have further discussion.\nI don't want to lose your valuable contributions over a couple minor syntax concerns.\n. I'm a little confused how this gets into an infinite loop unless iChunkLength is negative.  It should keep reading until it hits EOF and break.\n. @J-Shep I agree that exiting the loop after reading the data size is adequate.  I would just like to know what condition causes it to be a continuous loop and what this means for the actual result and the wav.\nThe final seek is for padded out fmt headers and to skip unprocessed subchunks like info, but it should have also skipped to the end of the file on data and caused a break on the next iteration.  I was thinking maybe if the data chunk length didn't fill the file it might cause issues, but at the beginning of the loop we read 8 bytes forward unconditionally so eventually we would hit the end.  The only thing I can think of is that the data length is negative, but that would cause incorrect results even with your fix.\n. My negative chunk size theory doesn't pan out.  It's a uint32_t, and while RWSeek takes a signed int, it's 64bit so the chunk size would only ever be positive.\n. Merged.\n. Maybe the original allowed inaccessible tiles in a room as long as there was no need to enter there, and CorsixTH doesn't.  What happens if there is a plant in that back corner?\n. https://github.com/CorsixTH/CorsixTH/issues/826 - Did rooms normally allow blocking off equipment? I feel like this was an area where the path finding was actually used, but I haven't tested yet.. I made the change that caused this issue, sorry. (https://github.com/CorsixTH/CorsixTH/commit/9e962a022715c24b0eab8b51454f4db4019fd6e3)  You wouldn't be able to load the save in 0.40 final either.\n. @sadger would you mind to attach the problematic save to the ticket.\n. Added a pull request to fix this in master.  If we really want a 0.41 patch for this let me know and do not merge this, I'll base it against 0.40 instead and then merge that into master.  My feeling though is that there isn't a strong demand, mostly developers would run into it.\n. Several of us compile on Visual Studio including myself and haven't encountered this problem.  I don't have any files resembling cmTryCompileExec1278357856.vcxproj either. I'm curious what edition of Visual Studio you used and what steps you took to get this error:\n. Visual Studio Express 2013 is not supported.  Fortunately there is a much more full featured Visual Studio 2013 Community Edition now which should work better for you.\nEdit: I'll update the wiki.\n. Can the unicode changes be a separate commit?\n. In linux all include headers would be in one folder, similarly all libraries would be in .e.g. /usr/lib.  I don't think there's anything stopping you from doing the same thing in Windows which would make the CMAKE_INCLUDE_PATH etc. work, but it's a little hard to manage updates without a package manager to take care of what package owns what files.\nOn my system I actually have x86_CacheInit.txt and x64_CacheInit.txt, then for example I call cmake with cmake -G\"Visual Studio 10 Win64\" -H\"..\" -B\"..\\x64-opengl\" -C\"x64_CacheInit.txt\" -DWITH_OPENGL=ON -DBUILD_MAPEDITOR=ON -DBUILD_ANIMVIEWER=ON\nSince there isn't really a standard layout for people's library paths I've been reluctant to post my files, but if you are doing a lot of building with different configurations that's the sort of method I recommend.\n. Seems to me this is the sort of thing that needs to be solved upstream at CMake.\n. @J-Shep You can see what I did with Visual Leak Detector in #636 but it only works if the files have normal locations.  I can't see how the vast majority of our libraries would be auto detected.\n. Use the CorsixTH/deps repo with CMAKE_INCLUDE_PATH and CMAKE_LIB_PATH\n. Yes, actually I developed this against Windows x64, using LuaRocks and Visual Studio 2013 CE.  IIRC I just installed the packages in luarocks from the Visual Studio x64 terminal and it compiled them correctly.\n. Uck, sorry about that.  Must not have my settings configured in that IDE.\n. It might be worth noting that newer luarocks versions use other mirrors for packages so they continue to work.  It might be worth getting lua rocks from some other ppa?\n. @jorgenpt We don't require specific versions of these libraries, in fact the versions we were bundling were archaic.  To ship the libraries with the game the dlls will be included in the CorsixTH folder.\n. They are run time dependencies, not compile time dependencies so it doesn't make sense for CMake to check for them, it would be the responsibility of the packager to ensure they were included.\n. I don't mind a CMake check for OSX to include it in the bundle.\nOn Windows, CMake doesn't handle any dlls at all, which is why the distinction between run time and compile time dependencies is important.  A packager cannot rely on CMake or having the program run on their system already because of system dlls like msvcr100.dll and msvcp100.dll, and other lua modules like lua socket which are not part of CMake.\nOn Linux the distribution's copies of these libraries should be used.  It is possible for the package maintainer not to have a copy of the lua modules but to specify them as required in their packages.\nIf we want to help people who aren't reading the wiki we could make a more informative failure message when the libraries are missing and/or a message in CMake informing people they will need them.\n. Ah yes, lfs.dll, lpeg.dll, and probably mime/core.dll socket/core.dll, /lua/socket.lua and /lua/socket/*.lua should be included in the zip sent to alan's site, thanks for the heads up MarkL.  Maybe open an issue about it so I don't forget.\n. Created #686 to address the missing lfs.dll and lpeg.dll.  Ran out of time tonight to include all the luasocket files, but they are not as necessary yet.\n. And... added luasocket as well.  All the dependencies should be there now. :-)\n. That error means your SDL_INCLUDE_DIR is wrong.  You could paste it here, though we'll also need to know your folder layout.\n. 1. It really doesn't matter where you put the files as long as the cmake variables point to them.\n2. msinttypes is a compatibility library because Visual Studio 2012 and earlier were missing the ability to handle C99 int types.  I don't believe it's necessary with VS2013 or higher as MS has corrected the problem.\n. Depending on your system you may have to copy the lua ones as well.  You must have it somewhere in your system's library search path, e.g. system32.  (https://msdn.microsoft.com/en-us/library/7d83bc18.aspx)\n. @MarkL1961 did you have an opportunity to see the stack trace before the program exited?\n. Interesting.  In the video there was an error popup - you didn't get that either?\n. I think this is fixed with #687.  Please comment if you're still experiencing issues and I'll reopen this.\n. This pull request doesn't handle updating save games.  I think it should be fine as long as no dialogs are open though?\n. Yes, the edit room bug is mine, which is why I thought to mention it. #605\n. I can replicate @Frassle 's freeze on the latest master.  No crash, no console output.\n. I have determined that there is an infinite path finding loop when the man in the bathroom reaches the door. (tile 58,60)\n. In particular it keeps calling https://github.com/CorsixTH/CorsixTH/blob/582fee058e/CorsixTH/Lua/humanoid_actions/walk.lua#L179\n. There seems to be a lot of different issues in this ticket, it would be better to open one ticket per issue.  @Frassle could you open a new ticket about freezing after loading that save game.  Include details like whether the game froze while you played originally or only when loading the save, and what I said about the infinite loop when the man tries to leave the bathroom.\n. What version was the save created on?\n. Actually I'd like to look into the framerate issue a little more before this is merged.  The value I came up with is perfect for the intro video (17.5fps) but the lose videos have a drastically different intended framerate (8.333fps).\n. Actually I was pretty close to the answer.  It seems I should be using the time_base from the AVStream not the AVCodecContext.  I'll fix this tonight or tomorrow night.\n. I've corrected the framerate issue, and now I'm quite happy with the state of playing videos with libav.  (So happy that unless I can improve the ffmpeg version I'm going to ship 0.50 with libav)\n. Added a second commit to this pull request which fixes the stutter in ffmpeg.  Incidentally I had caused it trying to take advantage of newer features.  That they weren't available in libav and audio was working fine lead me to the solution.\n. Added explicit include for libavutil/mathematics.h for libav-9.16 as reported by @legluondunet\n. Note: I have verified that this works with libav-11.1 for windows and Ubuntu 14.10.  This code does not work on the earlier libav-9.16 included in Ubuntu 14.04 LTS.  (Of note: avplay in ubuntu 14.04 is also unable to properly play intro.sm4 so it may not be possible to support our movies with that version of libav.)\n. Again you have to run the libav compile instructions from the Visual Studio x64 console.  Enhanced edition can't, but community edition and pro have it.\n. @Lego3 when you say 'always had this', you mean you had an issue with video stuttering in ffmepg as well and libav just doesn't fix it?  Is there anything holding this back from being merged?\n. You are right about postproc. I'll fix FindLibAV to match all the right libraries before it's merged. Not sure about sdl2mixer - not a change I made. \n. Removed postproc and add libavfilter to FindLibAV.cmake for correctness.  Neither are used by CorsixTH.\n. Your hierarchy probably doesn't have unique enough names and doesn't appear to contain the new ID you were discussing above.  If we're going to have globally unique hospital identifiers for email they almost certainly have to be guids.\nIf we're going to save games that way automatically there needs to be a way or mechanism to clean up old games.\n. I think this is a duplicate of #347 - Can you confirm?\n. Save games by default are in the same location as the configuration file: https://github.com/CorsixTH/CorsixTH/wiki/Configuration-File\n. Could you also let us know what version you're using and whether this is a fresh game or a save loaded from an earlier version?\n. Thanks adrianopol\n. @ElvarT did you move the slicer mugmuggy referred to?. The error in your screenshot is known with directX and movies, if you turn movies off or use SDL you shouldn't run into it.  Your first issue is something else, but we don't really have anything to go on.\n. Spiffy, thanks!\n. Sorry @pwaller I don't see much value in merging this as is. If there was an associated issue we could copy jorgenpt's comments there and close this PR so someone else could take it.\n. @sadger could you verify?  If it's not a bug I'll close it.\n. @sadger @mugmuggy Close this?. Well it was marked ready and I was cleaning up PRs for the release candidate.. It is possible to be in the hall with a wall between patients. It's quite an edge case as I can't think of a map that does it. Fine to leave for now.. This seems pretty much what @jorgenpt was suggesting on irc.\n. Looks alright to me.  All these reinterpret_casts make me a bit nervous but I know they predate this patch.  :+1:\n. I believe this pr is superseded by #656.  Thanks @pwaller.\n. @pwaller  Thanks for identifying that scaling the cursor sprites is (at least part of) the problem.  I don't think we need to keep this pull request open.  It will still be linked to the ticket for illustration.\n. @Alberth289346 could you change the commit message to something more informative, like minor grammar correction to CONTRIBUTING.txt\n. @ezeenova GNU/Linux is a little bit general.  In the past members of the respective distributions provided their own packages for CorsixTH.  PlayDeb for instance does have a 0.40 package.\nhttp://www.playdeb.net/app/corsix-th (Ubuntu) - 0.40\nhttps://aur.archlinux.org/packages/corsix-th (Arch Linux) - 0.40\nhttp://packages.gentoo.org/package/games-simulation/corsix-th (Gentoo) - 0.30\nhttp://software.opensuse.org/download.html?project=games&package=CorsixTH (Open SUSE) - ???\nhttp://rpmfind.net//linux/RPM/mageia/cauldron/x86_64/media/core/release/corsixth-0.40-1.mga5.x86_64.html (Mageia) - 0.40\nHopefully that just about covers your needs?  If not please bug your distribution packagers.\n. I've added your tarball to the releases page.  Thanks!\n. @ezeenova I don't know if you follow the mailing list, but I started a CorsixTH\\deps repository with all the prebuilt dependencies.  You must have already done all that work for this, if you have time would you mind adding the 0.40 x64 (amd64) dependencies.\nIf that's something you're interested in doing, please let me know here or on the mailing list and I'll make you a contributor for that repository.\n. An initial goal of feature parity with the old MapEdit is probably a good target.  If you get to it after that I would like to see the level edit functionality integrated into the Map Editor too, my thought was that one of the map edit menu options would bring up all of the level configuration.\n. @Alberth289346 can you rebase and push these changes into the map_editor2 branch on CorsixTH. Consider it a development branch except that we share it (so don't do any force pushes).\n. Zoom is now fully supported, my last commit fixes the cursor for it.\n. Added support for showing the parcel number overlay on the map when a parcel button is pressed. This overlay is now a live view so that changes in the map editor are reflected.\nI do have some concerns with performance, caching might be necessary (there is a cache mechanism built into getCellFlags that may work if we can reset it appropriately as the map is updated).\n. Also what's currently labeled as Parcel 0 is actually the delete parcel button.\n. @MarkL1961 I've seen that too. We'll need to do a performance pass on this once it's all working.\n. The map editor is now capable of setting the number of players for the map (1-4) as well as the starting camera and heliport locations for each of them.\nIf no one has any objections I'd like to merge this branch into master soon. I think that while there are still nice to haves that are not done the new map editor is usable and better than what we have now (nothing).\n. Apparently the new map editor isn't setting flags like buildable, passable and so forth, so it's not ready to merge yet.\n. Thanks for fixing the map flags @Alberth289346. I made some simple maps and they're working in game. One odd thing that's happening is that when I save and then load a few of the tiles seem to change. \nIn the map editor before saving:\n\nIn the map editor after loading the save (or in game):\n\n. The sprites that don't work are the ones with the FlipHorizontal drawing flag enabled. I took a look at the map format, as well as the old map editor and the maps shipped with the game and I can conclude that flipped sprites have never been supported in maps.\nIn the future we could make our own map format with an extended tile set and/or support for draw flags, but for now we can just drop these flipped tiles.\n. The map editor has been merged.\n. I strongly recommend you don't work out of your master branch.  There is a lot of history in this pull request that doesn't belong with it.\nStart by closing this pull request, then:\ngit checkout -b currentwork\ngit checkout master\ngit reset --hard origin/master\nAt that point it's a matter of straightening out your current work.  Maybe jump on #corsix-th or read some git guides.\n. @xuancong84 you run these commands in the terminal.  The instructions in CONTRIBUTING.txt are detailed step by step.\nOnce you have clean pull requests we can go over any changes needed.\n. Yes, definitely sounds like a clipping bug to me - this is the first I've heard of it affecting windows but it makes sense that it would.  Agreed @jorgenpt ?\n. Thanks for that @xuancong84 \nIt's still very likely the problem is in our own code, but that helps us focus.\n. @xuancong84 this is why it's important to make your changes in different branches.\n. @xuancong84 I think you responded to the wrong thread?\n. @xuancong84 there are too many different unrelated commits in this pull request.  Some of them look interesting, but nothing can be merged as is.\nI'm going to close this pr, and you can open new ones for any individual fixes that are still relevant.\n. I believe #644 was open before this issue and #647 was opened in conjunction with it. Nothing to be done for this issue.\n. Is it just the spawn that causes this, because it's months later than in the original on the first campaign level. If someone can verify side by side? (If not then eventually I will)\n. It is consistent that the patient enters the hospital a lot later in CorsixTH than Theme Hospital at the start of level 1. I don't think that comes down to a random 0 spawn.\n. It does sound like a duplicate of #588.  I'll close the issue.  @8mikelx8 if this is not the case, you can reopen.\n. @pwaller the clip bug is new with sdl2, so it won't affect 0.40 or older versions.\n. I don't get artifacts on full screen anymore, do you still see them @Andy51 ?\n. I think this suggests that getClipRect is malfunctioning.\n. Unless you were zoomed far out perhaps?\n. I don't think so, both have infinite loops but the stack trace is pretty different.\n. No his issue is unrelated. I believe there was another issue for his but I haven't been on a computer to look it up. Mugmuggy was working on that stuff. It did, and it succeeded on my machine with the latest master.  There was a conflict in the .travis.yml file but I don't think I changed anything that would have broken it.\n. Duplicate of #124 \n. #684 does indeed fix the issue.\n. Still appears to be failing... I'm going to be running some tests in this pr so don't merge it until I say I'm done\n. @Lego3 Busted is working with this change, seems like the version in TravisCI doesn't like --lpath?  Should probably be merged very soon.\n. Please paste the full error / stack trace in the issue tracker.  It makes it easier to classify and find through search.\n. you do not need to recompile lua, and you put something in the console with print \"This is my print statement\".\nYou could also try out the eclipse debugger that @J-Shep put together in pr #439  He can provide you more instruction on using it.  (As an aside, @J-Shep would you mind putting together a wiki page on how to debug lua.  I think that would be generally helpful.)\n. Thank you @J-Shep , they were a very informative read.\n@ledowong the above, as well as https://github.com/CorsixTH/CorsixTH/wiki/Lua-Console should be everything you need to get started looking at this.  Thanks for your interest.\n. Alright.. perhaps you could tell us what is in your Theme Hosptial directory, because it appears to be missing the normal data files, e.g. Levels/Level.L1\n. No, CorisxTH doesn't work with original game saves at this time.\n. As I mentioned on IRC, this looks to be a problem with SDL_Mixer and/or a lack of midi support on that system (normally provided by windows).  SDL_Mixer has a built in timidity that is suppose to be a fallback on operating systems without midi support, but it can't find it's configuration file.\nYou may be able to work around this, installing timidity and a soundfont with the configuration in c:\\timidity (based on a reading of https://github.com/aduros/SDL_mixer/blob/ac2df1b04a424c507839303ffb1c9cf000a95ac3/timidity/config.h) or possibly by providing another virtual midi interface.\n. Yes.\n. First of all, it is possible yes, and disease suggetions are a very popular category in the forum (http://forums.corsixth.com/index.php/topic,292.0.html)\nYou can see disease definitions in CorsixTH\\Lua\\diseases, the expertise id and visual/non-visual ids should be defined in base_config.lua and then referenced in the levels you want to include these diseases in.  The new strings/translations that show up in the game should go in CorsixTH\\Lua\\languages\\english.lua and any other language you want to translate to.\nIn light of different people having their own ideas of the types of diseases they want to see in the game (with some people having a strong preference for the comical, and some for the realistic) I think a welcome development would be the ability to plug in desease packs that either replace the existing diseases for campaign levels, or introduce new diseases for custom levels.  I feel that any other approach would be controversial.\n. Checked the TravisCI error.  Its probably related to dangling white space.\n. Yes that mirror seems to have been down for a few days.  I haven't gotten around to changing it yet\n. It stands for request for comments, though I guess this could have been wip (work in progress) as well.\nThe reason for the prefixes is because only owners and contributors can set labels. With the prefixes people that make the pull requests can indicate their state.\n[WIP] - work in progress i.e. don't review this, I'm still working on it.\n[RFC] - request for comment i.e. this isn't ready to merge, but it would be good if people could give feedback\n[RDY] - ready i.e. I feel this is ready to merge. Review it and merge if you agree.\n. Probably no need to split it into separate pull requests.\n. Alright, I've skimmed it all. There are a few problems with your last commit as mentioned above (am I right to guess you have some Java background?). The rest of it reads well.\nIt would be good to make a note about the LevelFile -> MapFile change. I agree with it but it will break all the other custom levels out there, maybe we could support both for legacy? I'll let you make the call on that.\n. Looks like LDocGen choked on something, but I'm not sure what.\nAs for reinterpret_cast, just replace that text with static_cast directly. A reinterpret_cast ignores compile and run time checks and basically just points a new type at the old type's memory. This is dangerous because it will never fail and could quite likely produce garbage, e.g. reinterpret_cast<int>(double_value). A static_cast is checked at compile time and converts one type to another.  There's also dynamic_cast, which does a run time check on the type for conversion (useful in some cases of polymorphism when the conversion cannot be checked at compile time), and const_cast, which is also compile time checked and only adds or removes a 'const' constraint.\nstatic_cast is almost always what you want when converting one type to another.\n. @Lego3 Just replace the word reinterpret with the word static\n. Ok, I'll take a closer look.\n. I believe what you want here is iNextChar = unicodeToCodepage437(static_cast<unsigned char>(*s));\nThis whole iNextChar is a little hacky, because it only interprets the next 8 bits, not the entire next character. In reality this works because they are checking the result against ascii characters so any interesting value will always be 0-127 here (because that's how UTF-8 encoding works).\n. Also I see there are a ton of unnecessary reinterpret_casts throughout this file in particular and the rest of the source in general. I'll work on cleaning them up at some point.\n. Yes, @Alberth289346 has given the :+1: and I just want to review the font and iNextChar stuff a little more closely. I've been a little busy with my Travis CI changes (trying to get better C++ x11 support), but should be able to finish my review within the next couple weeks.\n. The business with iNextChar in particular is a bit troubling. It's converting the first byte from utf-8 to cp437 then comparing the char code against the value of certain characters in compiler's code page (most likely cp1257 or utf-8, possibly ascii)\nIt seems to me that this section happens to work on the coincidence that utf-8 and most code pages are (at least mostly) a superset of ASCII. The conversion to cp437 here is not helpful.\n. Good catch.  Works well for me.\n. File doesn't appear to exist anymore, but we believe this is a duplicate of #66\n. Closing as a duplicate of #370 \n. @alanwoolley do pull request builds end up somewhere else, or are they not saved.  I noticed this as well as I had planned to download the build when it was finished and make sure it was all working correctly.\n. It would be relatively easy (if a little messy) to reverse or repair after merging yes.  Another possibility would be temporarily modifying the pull request to push the file somewhere else, though I don't have any servers set up for that at the moment.\n. Spiffy\n. Excellent deduction, thanks @pwaller.  I will try it myself later, but maybe you can answer now - is the reason for the darker red because of the scaling and pixel bleed from the black background, or because the colour is being blended with something on the RenderCopy?  Or as a consequence, is the whole doctor miscoloured on pickup or just the edges?  (Or does this only affect editing rooms for some reason?)\n. Works great for me too.  Excellent work!\n. I don't think the function deserves two shortcuts, but I'm fine with either option.\n. No update in over 2 years. If there is no update in 2 weeks I will close this PR.. Between git blame, git log -G (or -S), and git bisect I haven't really encountered a problem what commit made any particular change.\nOf course the commit messages should be informative, and if it changes the behavior of a public function that should definitely be noted.  In cases where the change is to a private function or changes to a public function where the behaviour isn't changed, often the change and the reason for the change is more important than where - particularly if it's broad, like the whitespaces fixes were, or if someone were to clean up all the signed to unsigned comparisons.\n. Duplicate of #657 \n. Commit message for first commit isn't encompassing of what that commit does.  It really adds an alternative mechanism for recolouring 32bpp graphics (rather than simply disabling attempted pallet swaps)\n. I would prefer i the THDF_Alt32_* parameters were only defined once in lua.  The convention seems to be to make a table of properties and use lowercase naming, something like:\nalternate_32bit_pallets = {\n  GreyScale = 1 * 32,\n  RedBlueSwap = 2 * 32,\n}\nIdeally I think that table would be attached to TH.anims so that it would be available everywhere you might want it, but it would likely be easier and clean enough to put it in ui.lua.  (I'm not aware of anywhere we currently store a table of constants to access from lua with a luaT_class, so the infrastructure likely isn't in place to do it simply.)\n. :+1: Code looks good to me.\n. Close/reopen to trigger travis rebuild.\n. Ah right, the rebuild won't succeed until it's rebased on the latest master.\n. The save game link is dead and there has been no response to the request for more information in over a year.\n. @admdly could you have a look at this remaining SDLMain situation and whether it can safely be removed?\n. @admdly did you make any progress on this?\n. Thanks @admdly, I'll hold off merging this until you get your builds working and can do actual tests. Feel free to discuss your issues with the build on irc or the mailing list.\n. Also verified by tobylane.\n. Merged.\n. This would have to be an SDL Mixer issue.  We switched to SDL2 / SDL_Mixer 2 recently.\n. No, we're not maintaining compatibility with sdl1.  You could try using the latest mecurial version of sdl2 mixer or seeing if there is a known issue reported for it.  http://www.libsdl.org/projects/SDL_mixer/  The latest stable version is 18 months old and there have been quite a few bug fixes since then.\n. II believe it shares a tracker with the rest of SDL2: https://bugzilla.libsdl.org/  Maybe it relates to this? https://bugzilla.libsdl.org/show_bug.cgi?id=876\n. Does it play with freepats / without fluid, or does it not work at all for you?\n. It wouldn't help us.  As I mentioned above this will need to be taken upstream with sdl mixer if there is an issue with sound fonts.\n. @alanwoolley pinging you because this seems to be related to the android version.\n. 1. Command line arguments are actually functioning, I was simply lacking luasocket in that build folder.\n2. I believe that th_getfenv is actually functioning.  I printed the keys to the tables returned in lua 5.2 and lua 5.1 and they are identical.  That suggests the problem is somewhere else in persistence.\n. I managed to get some help from #lua on freenode.  At least in the case of music it's because we're trying to set the metatable to the environindex, which in lua 5.2 we mapped to the first upvalue, but functions created with lua_setfuncs(state, reg, 0) have no upvalues.\n. Re-based on the latest master, and added casts to avoid undoing the work done by @Alberth289346 \n. Travis failure was due to sourceforge downloads again.  Will close and open to trigger rebuild.\n. @alanwoolley Noted, sorry for the noise.\n. Last commit fixes the issue @Alberth289346 mentioned above.  When we are ready to merge it should be rebased into b42445b\n. Removes a few more useless math.floor statements and fixes the zoom issue @Alberth289346 found.  I had really gone overboard with the math.floor for lua 5.3 compatibility.\nThe next two commits fix a conversion warning introduced in the new debugging functions.\n. Fixed research_policy, replacing gfind with gmatch.  Thanks @Alberth289346 \n. Fixed whitespace error pointed out by @Alberth289346 and rebased on lasted master, squashing all fix commits.\n. https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Src/th_gfx_sdl.cpp#L190\n. Will close/reopen to trigger travis rebuild.\n. I like it.\nOnline you were talking about duplication between FindFFMPEG and FindLibAV and I said that I wanted to keep them as separate modules.  Having said that if you want to move the find_component macro into it's own file and include it in both of those Find* files that would be alright.  (Maybe with a less generic name e.g. CMakeFfmpegLib and find_ffmpeg_component).  If you don't feel like doing that I'm good with merging as is.\n. @ezeenova as far as I know it's unavoidable.  Despite the libraries being incompatible both projects continued to use the same naming and version scheme. It won't compile likely.  Maybe we can print a warning if the include directories are not all the same or something - otherwise I think there's some things the compiler will just have to watch out for.\n. Still an issue as of 95d812916783226c1a8281779e94e2586d2ff812\nStack trace:\n1      ucrtbase.dll!00007ffdfe58f6e0()\n*2      lua53.dll!lua_pcallk(lua_State * L=0x000001cd3fc73a18, int nargs=1, int nresults=0, int errfunc=0, __int64 ctx=0, int(*)(lua_State *, int, __int64) k=0x0000000000000000) Line 956\n 3      CorsixTH.exe!l_load_music_async_callback(lua_State * L=0x000001ccf3881248) Line 145\n 4      lua53.dll!luaD_precall(lua_State * L=0x000001ccf3881248, lua_TValue * func=0x000001cd3fca3700, int nresults=0) Line 365\n 5      lua53.dll!luaD_call(lua_State * L=0x000001ccf3881248, lua_TValue * func=0x000001cd3fca3700, int nResults=0) Line 495\n 6      lua53.dll!luaD_callnoyield(lua_State * L=0x000001ccf3881248, lua_TValue * func=0x000001cd3fca3700, int nResults=0) Line 507\n 7      lua53.dll!f_call(lua_State * L=0x000001ccf3881248, void * ud=0x0000002ca38feb40) Line 943\n 8      lua53.dll!luaD_rawrunprotected(lua_State * L=0x000001ccf3881248, void(*)(lua_State *, void *) f=0x00007ffdcb656f50, void * ud=0x0000002ca38feb40) Line 145\n 9      lua53.dll!luaD_pcall(lua_State * L=0x000001ccf3881248, void(*)(lua_State *, void *) func=0x00007ffdcb656f50, void * u=0x0000002ca38feb40, __int64 old_top=128, __int64 ef=0) Line 727\n 10     lua53.dll!lua_pcallk(lua_State * L=0x000001ccf3881248, int nargs=1, int nresults=0, int errfunc=0, __int64 ctx=0, int(*)(lua_State *, int, __int64) k=0x0000000000000000) Line 968\n 11     CorsixTH.exe!luaT_cpcall(lua_State * L=0x000001ccf3881248, int(*)(lua_State *) f=0x00007ff709982b44, void * u=0x000001cd411ac0e8) Line 98\n 12     CorsixTH.exe!l_mainloop(lua_State * L=0x000001ccf3881248) Line 239\n 13     lua53.dll!luaD_precall(lua_State * L=0x000001ccf3881248, lua_TValue * func=0x000001cd3fca36e0, int nresults=2) Line 365\n 14     lua53.dll!luaV_execute(lua_State * L=0x000001ccf3881248) Line 1134\n 15     lua53.dll!luaD_call(lua_State * L=0x000001ccf3881248, lua_TValue * func=0x000001ccf3887db0, int nResults=-1) Line 497\n 16     lua53.dll!luaD_callnoyield(lua_State * L=0x000001ccf3881248, lua_TValue * func=0x000001ccf3887db0, int nResults=-1) Line 507\n 17     lua53.dll!lua_callk(lua_State * L=0x000001ccf3881248, int nargs=1, int nresults=-1, __int64 ctx=0, int(*)(lua_State *, int, __int64) k=0x0000000000000000) Line 925\n 18     CorsixTH.exe!CorsixTH_lua_main(lua_State * L=0x000001ccf3881248) Line 180\n 19     lua53.dll!luaD_precall(lua_State * L=0x000001ccf3881248, lua_TValue * func=0x000001ccf386a4c0, int nresults=0) Line 365\n 20     lua53.dll!luaD_call(lua_State * L=0x000001ccf3881248, lua_TValue * func=0x000001ccf386a4c0, int nResults=0) Line 495\n 21     lua53.dll!luaD_callnoyield(lua_State * L=0x000001ccf3881248, lua_TValue * func=0x000001ccf386a4c0, int nResults=0) Line 507\n 22     lua53.dll!f_call(lua_State * L=0x000001ccf3881248, void * ud=0x0000002ca38ff9b0) Line 943\n 23     lua53.dll!luaD_rawrunprotected(lua_State * L=0x000001ccf3881248, void(*)(lua_State *, void *) f=0x00007ffdcb656f50, void * ud=0x0000002ca38ff9b0) Line 145\n 24     lua53.dll!luaD_pcall(lua_State * L=0x000001ccf3881248, void(*)(lua_State *, void *) func=0x00007ffdcb656f50, void * u=0x0000002ca38ff9b0, __int64 old_top=32, __int64 ef=16) Line 727\n 25     lua53.dll!lua_pcallk(lua_State * L=0x000001ccf3881248, int nargs=1, int nresults=0, int errfunc=1, __int64 ctx=0, int(*)(lua_State *, int, __int64) k=0x0000000000000000) Line 968\n 26     CorsixTH.exe!SDL_main(int argc=1, char * * argv=0x000001ccf385f620) Line 98\n 27     [External Code]\n. Line in CorsixTH where the error occurs: https://github.com/CorsixTH/CorsixTH/blob/95d812916783226c1a8281779e94e2586d2ff812/CorsixTH/Src/sdl_audio.cpp#L145\n. On MSVC 2013 this brings us down to 14 warnings (from over 40).  Most of those are sign mismatch warnings in th_gfx_font.cpp, e.g. line 791.  If you're not getting them in gcc I have to assume that the freetype types differ by platform or you're building without freetype?\n. Below is the output from msvc 2013 and freetype 2.5.5 (specifically referring to the signed/unsigned mismatch warnings at the top).\nI checked the freetype2 api guide and those fields are indeed unsigned int: http://www.freetype.org/freetype2/docs/reference/ft2-basic_types.html#FT_Bitmap.  This was a change from earlier versions of freetype, e.g. 2.4.10: http://freetype.sourceforge.net/freetype2/docs/reference/ft2-basic_types.html#FT_Bitmap\nWarning 5   warning C4018: '<' : signed/unsigned mismatch   E:\\GitHub\\CorsixTH\\CorsixTH\\Src\\th_gfx_font.cpp 756 1   CorsixTH\nWarning 6   warning C4018: '<' : signed/unsigned mismatch   E:\\GitHub\\CorsixTH\\CorsixTH\\Src\\th_gfx_font.cpp 767 1   CorsixTH\nWarning 7   warning C4018: '<' : signed/unsigned mismatch   E:\\GitHub\\CorsixTH\\CorsixTH\\Src\\th_gfx_font.cpp 791 1   CorsixTH\nWarning 8   warning C4018: '<' : signed/unsigned mismatch   E:\\GitHub\\CorsixTH\\CorsixTH\\Src\\th_gfx_font.cpp 801 1   CorsixTH\nWarning 4   warning C4267: 'argument' : conversion from 'size_t' to 'FT_Long', possible loss of data    E:\\GitHub\\CorsixTH\\CorsixTH\\Src\\th_gfx_font.cpp 396 1   CorsixTH\nWarning 11  warning C4267: 'argument' : conversion from 'size_t' to 'Uint32', possible loss of data E:\\GitHub\\CorsixTH\\CorsixTH\\Src\\th_lua_sound.cpp    242 1   CorsixTH\nWarning 10  warning C4800: 'int' : forcing value to bool 'true' or 'false' (performance warning)    E:\\GitHub\\CorsixTH\\CorsixTH\\Src\\th_lua_gfx.cpp  659 1   CorsixTH\nWarning 9   warning C4800: 'Uint32' : forcing value to bool 'true' or 'false' (performance warning) E:\\GitHub\\CorsixTH\\CorsixTH\\Src\\th_gfx_sdl.cpp  293 1   CorsixTH\nWarning 12  warning C4996: 'sprintf': This function or variable may be unsafe. Consider using sprintf_s instead. To disable deprecation, use _CRT_SECURE_NO_WARNINGS. See online help for details.  E:\\GitHub\\CorsixTH\\CorsixTH\\Src\\th_map_overlays.cpp 99  1   CorsixTH\nWarning 2   warning C4996: 'std::_Copy_impl': Function call with parameters that may be unsafe - this call relies on the caller to check that the passed values are correct. To disable this warning, use -D_SCL_SECURE_NO_WARNINGS. See documentation on how to use Visual C++ 'Checked Iterators' C:\\Program Files (x86)\\Microsoft Visual Studio 12.0\\VC\\include\\xutility 2132    1   CorsixTH\nWarning 3   warning C4996: 'std::_Copy_impl': Function call with parameters that may be unsafe - this call relies on the caller to check that the passed values are correct. To disable this warning, use -D_SCL_SECURE_NO_WARNINGS. See documentation on how to use Visual C++ 'Checked Iterators' C:\\Program Files (x86)\\Microsoft Visual Studio 12.0\\VC\\include\\xutility 2132    1   CorsixTH\nWarning 1   warning C4996: 'std::_Transform1': Function call with parameters that may be unsafe - this call relies on the caller to check that the passed values are correct. To disable this warning, use -D_SCL_SECURE_NO_WARNINGS. See documentation on how to use Visual C++ 'Checked Iterators'    C:\\Program Files (x86)\\Microsoft Visual Studio 12.0\\VC\\include\\algorithm    1026    1   CorsixTH\nWarning 13  warning C4996: 'vsprintf': This function or variable may be unsafe. Consider using vsprintf_s instead. To disable deprecation, use _CRT_SECURE_NO_WARNINGS. See online help for details.    E:\\GitHub\\CorsixTH\\CorsixTH\\Src\\th_map_overlays.cpp 184 1   CorsixTH\nWarning 14  warning LNK4098: defaultlib 'MSVCRT' conflicts with use of other libs; use /NODEFAULTLIB:library    E:\\GitHub\\CorsixTH\\build_sdl2\\CorsixTH\\LINK CorsixTH\n. Given that freetype changed their api I think we can address those outside of this issue.\n. I notice that if you compile with libav instead of ffmpeg there are some sign compare warnings in th_movies as well, but these can be dealt with at a later time.\nMerged.\n. @vince0018 the handling for key presses has been reworked (and all of SDL replaced by SDL2) in the latest master.  Could you try the latest master build from http://www.armedpineapple.co.uk/cth/builds/ and let us know if this is still an issue?\n. yep, that's it.\n. I actually can reproduce this in 7b8c4ca0570edda77a815b7635df1b0691cc8960\nIt's subtle.\n. I suspect this is just by virtue of onMouseMove being called on a mouse move event, and the arrow / edge movement only happening onTick().\n. Cannot reproduce on Windows with 7b8c4ca0570edda77a815b7635df1b0691cc8960. Does this still happen for you (e.g. opengl only) or has it been fixed?\n. Ping @Alberth289346 . I can reproduce this in the latest trunk. It is not fixed by #806 but it is a related issue.\n. To reproduce the room needs to be dragged off the top left corner of the map.\n. Added fix for this to #806\n. The console output is very helpful, on top of that there is also a file in the same location as the saves called gamelog.txt which could be attached.\n. Alright, the stack trace at the top of your output is unrelated.  It's issue #660 \nThe frame handler error with no debugging information is known (though very difficult to diagnose). #327 \n. Thanks @Frassle \n. To be clear the infinite loop is in the action queue, when it fails to find a path.  For reasons I haven't diagnosed yet, recalc_route is always being set to true instead of going to action_walk_raw and opening the door.\n. There is a radiator in front of the bathroom door (inside).  If you rush you can remove it and avoid the freeze.  Duplicate of #221\n. Removed: I had put some locking up there and then moved it further down so it probably came from that.\n. Ops... messed this up.  I'll fix it.\n. There, fixed.\n. The travis ci is responsible for generating the latest master docs and uploading them to @alanwoolley 's site at http://www.armedpineapple.co.uk/cth/docs/. .travis.yml will need to be updated accordingly.\n. I'm thinking no doxygen, it could be added to the sudo apt-get list.\n. Not sure what happened to my line comment... if it shows up later I blame github.  Anyway the folder is ${TRAVIS_BUILD_DIR}\\fresh, ${HOME} is not suppose to be used in travis-ci.\n. Generating the docs for lua appears to assume that lua is in the system path, which may not always be the case.  FindLua should be extended to also locate the binary so we can use it instead of hard coding lua in the CMakeList.\nError:\n4>  Generating API documentation for corsixth_lua\n4>  'lua' is not recognized as an internal or external command,\n4>  operable program or batch file.\n. With regards to copying the index file to the build dir when make doc is called.  http://www.cmake.org/pipermail/cmake/2009-March/027892.html has an outline of how to do it.\nBasically a command is added to the target, which calls cmake with -E copy and the source and destination paths.  cmake's executable is defined as ${CMAKE_COMMAND}.\nhttp://www.cmake.org/cmake/help/v3.2/manual/cmake.1.html#command-line-tool-mode is another handy link.\n. On windows the LDocGen target still isn't working.\nE:\\Development\\LuaJIT-2.0.3\\x64\\luajit.exe: ../CorsixTH/Lua/strict.lua:66: module 'helpers' not found:\n3>      no field package.preload['helpers']\n3>      no file '.\\helpers.lua'\n3>      no file 'E:\\Development\\LuaJIT-2.0.3\\x64\\lua\\helpers.lua'\n3>      no file 'E:\\Development\\LuaJIT-2.0.3\\x64\\lua\\helpers\\init.lua'\n3>      no file '.\\helpers.dll'\n3>      no file 'E:\\Development\\LuaJIT-2.0.3\\x64\\helpers.dll'\n3>      no file 'E:\\Development\\LuaJIT-2.0.3\\x64\\loadall.dll'\n3>  stack traceback:\n3>      [C]: in function 'fn'\n3>      ../CorsixTH/Lua/strict.lua:66: in function 'require'\n3>      E:/GitHub/CorsixTH/LDocGen/main.lua:46: in main chunk\n3>      [C]: at 0x7ff71ab22000\n. Also the doc folder that's created in the source folder instead of the build folder.  I assume that's unintentional.\n. I've solved the LDocGen problems (minimally but a larger fix is probably out of scope for this).\nour_dir = our_dir:match(\"@(.*)\"..package.config:sub(1, 1)) or \".\"\nThe path seperators given are not the platform path separators.  In case they happen to be in some other version of lua I set the line to:\nour_dir = our_dir:match(\"@(.*)[/\"..package.config:sub(1,1)..\"]\") or \".\"\nWith that fixed, the only concern I have is the target directory for the output of the documentation. I feel it should be inside the build folder not the source as I mentioned previously.\n. Merged.\n. I like this solution better than the one in #431 because it matches the experience people would have playing with dosbox, and other window mode games.  Needs a key combo to unlock the cursor obviously.\n. It's not very clear on this point, but the scroll_speed in the config file is just the multiplier when fast scrolling is enabled (while you are holding down the shift key).  2 is 2x normal speed.\n. Holding shift will accelerate both mouse and keyboard scrolling, but there is no way (without modifying the game's lua) to speed up the scrolling with just the mouse at this time.\nIt would be pretty easy to allow setting both the regular scroll speed and the modified scroll speed in the config file, which would allow people to set regular scroll to fast and shift scroll to fine if they'd rather work that way. \n. Didn't seem much different to me either (running dosbox and CorsixTH side by side) but if we fix up the configuration options everyone should be happy.\n. @elfring would you mind to submit a PR for this?  It would be accepted (I have cleaned up redundant NULL checks in e.g. th_movies.cpp)\n. Updated the pull request to multiply scroll speed by 0.5 so old default config values match the new one, and bound the scroll_speeds between 1 and 10 as mentioned in the config file description.\n. Fixed a tab/space issue, and added a comment explaining the 0.5 multiplication in code.\n. Like that @sadger or did you have something else in mind?\n. The macros in the pathfinder started with caps, but the replacement methods should follow our convention of camelCase.\n. @mrtnptrs As was told to me, you can rebuild from the TravisCI site, no need to close and open the PR here.\n. I've played with this a bit and it's running well.  It's also somewhat easier to follow than the earlier path finder and obviously doesn't rely on macros.  I'm in favour of squashing the commits and merging as is. :+1: \n. @ryunp good catch.\n. Copying stack trace so that a search pulls up this issue:\n```\nworld.lua:531 Suspected infinite loop\nworld.lua: in function 'spawnPatient'\nworld.lua:1097: in function 'onTick'\napp.lua:852: in function 'dispatch'\napp.lua:753: in function \n```\n. The code block that is failing is:\nlua\n    local disease = self.available_diseases[math.random(1, #self.available_diseases)]\n    while disease.only_emergency or not isVisualDiseaseAvailable(disease) do\n      disease = self.available_diseases[math.random(1, #self.available_diseases)]\n    end\nwhich suggests possibly that the disease list being loaded isn't complete.\nWould you be able to paste the md5sums of your EASY11.SAM, FULL11.SAM, and HARD11.SAM files.  Of course mention if you have done any modifications yourself to either the level files or the lua.\n. We did not produce the getdeb.net package. However this sounds like an issue either with linking freetype, or with the fonts detected.\nWhat languages show up when you pull up the language list in game?\n. They are likely related, if there is no font for an entry it won't show up in the menu and it can't be selected from the configuration.\nSince you are not seeing a lot of other languages that require unicode fonts I think that is the issue (simplified chinese, russian, korean, etc.).\nHave you followed the instructions here? https://github.com/CorsixTH/CorsixTH/wiki/Fonts\n. The Windows out of box experience is that a unicode font is automatically detected and available on install. I haven't looked into exactly how this works, but ideally this should be the same on all platforms (at least as far as possible, e.g. checking for the existence of common unicode fonts in common locations).\nThe language names are presented in their own language, which means without an appropriate font we cannot display them. I suppose it would be possible in that case to give the English names for the language?\nIt would be interesting to compare in game against arphic-uming, dejavu sans, gnu unifont, fixedsys-excelsior and other unicode fonts (for coverage and appearance).\n. Fixed by pr #803\n. I'm not sure we're organized enough to decide who should get the money. :) Though it would be good if it went towards hosting corsixth.com.\nIs that owned by @corsix ?\n. Yes, the intent is not for the packaged releases to support both, but for people attempting to build (or package) for environments where one or the other isn't available. So on OSX you would use FFMPEG exclusively, on Ubuntu they would use LibAV, and for Gentoo the ebuild would depend on their USE flags.\n. @AgainstTheCurrent Thanks, I'll look at that.\n. The file mentioned above is '''CorsixTH\\Lua\\entities\\patient.lua'''\nOn a quick look I think the buildable flag check is right.  Pee and Vomit are handled elsewhere, so it's likely that the conditions for this function are not being triggered at all; perhaps litter_countdown isn't being triggered. I will take a more in depth look later.\nPlease mention in your ticket what version of the game you are using.\n. I have seen bottles. Maybe this is resolved in latest master?\n. Seeing all litter types. Vomit is just more common.\n. Thank you @MarkL1961, there were substantial changes to input in trunk because of the change to SDL2, so it makes sense that such a regression occurred.\n. Typically this suggests an issue with your timidity configuration or a lack of sound fonts.  Do you have timidity-freepats installed?  Can you confirm midi works elsewhere?\n. Could you post a save game?\n. Thanks for the full investigation @MarkL1961. So as I read it this is purely a LEVEL file issue.\nActionable items are to: a) Remove all surgical diseases from Avatar level\nb) Create a new enhancement issue to scan for and reject or auto correct with warning such LEVEL files so that map makers don't accidentally make crashing levels. \n. Ok, then I misunderstood what you were saying.\nThe operating table isn't researchable, and you wouldn't be able to purchase it when editing the room: (https://github.com/CorsixTH/CorsixTH/blob/18e45548084068dffc0c01066356d2499eae8fc3/CorsixTH/Lua/dialogs/edit_room.lua#L510), and it is needed for the operating theatre - so I don't know how building an operating theatre would work.\nNow to look from the other direction from the actual error, the assert that's failing is:\nhumanoid.world.available_rooms[room_type]\nNow, if we look in world.lua available_rooms is populated in initRooms.  That function looks at each object_needed for a room. If that object is available from the start it says the room is available and it ends up in the list, if the object is available for the level it says the room is discoverable and it's added the list, if it's not the room is not added to the list. All this adds up to the operating theatre not being buildable in Avatar.\nThis is why the error happens in this level and why the fax isn't being displayed.\n. +1\n. Oh, one more thing while were on this.  Can we call it getAvailableRooms to avoid confusion with World:rooms (which is all built rooms)\n. @MarkL1961  as I said in the other issue, the operating theatre is not buildable in Avatar, because the operating table isn't.\n. Closed by pr #766 and #768 \n. The warnings currently occur for any disease that can't be treated, which makes even valid levels like level 1 of the campaign issue warnings. The warning should only happen if the disease is enabled and cannot be cured.\n. Confirmed fixed with #770 \n. Duplicate of #327 \nI've seen this myself, though never when I was able to grab sufficient debugging information.\n. I wouldn't be surprised if this was somehow releated to #709, but at the moment there's not much to go on. I've never seen this particular crash.\n@bobcanthelpyou would it be possible for you to run the game in a debugger so that when you hit this error or the frame one you are able to see all of the stacks?\n. It appears based on these traces that the freeze is within lua and not C++.  It's still possible that an issue running the frame handler which causes lua to freeze / infinite loop afterwards rather than crashing immediately.\n. @bobcanthelpyou have you tried this in luajit recently? I'm curious if it was related to #709 . Ug. This actually still breaks on MSVC. I tested this pull and it compiled successfully but not subsequently. :(  I will be trying to come up with an emergency patch - but the basic problem is that SDL_main_win32.c is C, but includes \"config.h\" which is now C++\n. I can't imagine running a very old version of SDL_main.c on Windows in SDL2 is a good idea, so I'm testing removing that file altogether.\n. Thanks for this @tobylane, OSX nightlies could be nice to have.\nI'll list my biggest concerns here before looking at the changes more closely:\n- Throughout the script you refer to the existing travis-ci build as \"linux\" but that's not a very accurate description of what is actually a cross compile to mingw (windows). In CorsixTH/deps I have called that travisci-mingw.\n- There is a maintenance burden to travisci scripts, and none of the core developers use OSX. We would need ongoing commitment from you to maintain this if we are going to accept it.\n- The first couple commits failed to build, before this is merged it should be reorganized so that every commit results in a successful build; presumably the 'fix' commits could just be squashed into the earlier commits.\n. I'm mostly fine with using $TRAVIS_OS_NAME, but not when it comes to the resulting zip file because in that case it's misleading to the people who will be downloading it (http://www.armedpineapple.co.uk/cth/builds/)\n@alanwoolley do you have any concerns about pushing OSX builds to your server?\n. I think some more symmetry between the 'linux' and 'osx' code would be helpful, for instance the linux cmake and make are in the .travis.yml script, but the equivalents for osx are in the osx_install script.\nlinux_scripts could be called something like build_cross_platform_targets to more accurately describe what it does.\n. As can be seen in the travis failure, the upload of the docs (which shouldn't have been triggered to start with) failed to authenticate.\n. The line in question was:\nif [ $TRAVIS_REPO_SLUG == \"CorsixTH/CorsixTH\" -a $TRAVIS_BRANCH == \"master\" ]; then sshpass -p \"$SCP_PASS\" scp -r -v -P12349 $TRAVIS_BUILD_DIR/fresh/doc/* cthbuilder@server2.armedpineapple.co.uk:/home/cthbuilder/docs/; fi;\nwhich shouldn't be triggered for a PR, so I don't know why it was trying to upload in the first place - unless there was an accidental setting of TRAVIS_REPO_SLUG somewhere or the environment in scripts is different?\n. Perhaps try /bin/test syntax, something like:\n[ \"$TRAVIS_REPO_SLUG\" = \"CorsixTH/CorsixTH\" -a \"$TRAVIS_BRANCH\" = \"master\" ];\n. @tobylane are you still interested in fixing this?\n. Once fix for #750 is merged, this only affects arrow keys (or any time the cursor is not at the end of the string).\nThe cursor position appears to be calculated as if it were the end of the string, not taking into account the centering moving each position left as the string gets longer.\n. Thanks @ihithim \nBased on the error I assume this is 0.50 beta 1.  Could you tell me what resolution you are playing at?\n. Alright, I can't test that specific resolution but I believe my resolution pr will solve that. Of course please verify on beta 2 when it's out.\n. This save doesn't have an inflator. It has a scanner but the visitor count there is quite high (139).  It also appears to crash when showing the room information, but that's unrelated to this.\n. Looks like a duplicate of #146\n. Second error is a duplicate of #578 \n. Verified.\nThe best way to reproduce it is to hold down one arrow key, then a second and release the first, after releasing the first the map will start scrolling in the direction of the second; after that you can keep holding different arrow keys to move the map in each direction.\n. Duplicate of #775 \n. Yes\n. Have you set the font in the config file to one that supports Chinese. Also what OS is this?\n. I'm getting a segfault when I try to use a unicode font:\nTHRenderTarget::createTexture (this=0x0, iWidth=60, iHeight=13, pPixels=0x13cd230)\nCorsixTH/Src/th_gfx_sdl.cpp:635\nSDL_Texture *pTexture = SDL_CreateTexture(m_pRenderer, m_pFormat->format, SDL_TEXTUREACCESS_STATIC, iWidth, iHeight);\n. Full backtrace:\n```\nProgram received signal SIGSEGV, Segmentation fault.\n0x000000000047c996 in THRenderTarget::createTexture (this=0x0, iWidth=37, \n    iHeight=13, pPixels=0x1b02e90)\n    at /home/stephen/CorsixTH/CorsixTH/Src/th_gfx_sdl.cpp:635\n635     SDL_Texture *pTexture = SDL_CreateTexture(m_pRenderer, m_pFormat->format, SDL_TEXTUREACCESS_STATIC, iWidth, iHeight);\n(gdb) bt\n0  0x000000000047c996 in THRenderTarget::createTexture (this=0x0, iWidth=37,\niHeight=13, pPixels=0x1b02e90)\nat /home/stephen/CorsixTH/CorsixTH/Src/th_gfx_sdl.cpp:635\n\n1  0x000000000047ed7b in THFreeTypeFont::_makeTexture (this=0x18829c8,\npEventualCanvas=0x0, pCacheEntry=0x1882d60)\nat /home/stephen/CorsixTH/CorsixTH/Src/th_gfx_sdl.cpp:1538\n\n2  0x000000000046c456 in THFreeTypeFont::drawTextWrapped (this=0x18829c8,\npCanvas=0x0, sMessage=0x15c4948 \"Magyar\", iMessageLength=6, iX=0, iY=0, \niWidth=2147483647, pResultingWidth=0x7fffffffe0cc, pLastX=0x0, \neAlign=Align_Left)\nat /home/stephen/CorsixTH/CorsixTH/Src/th_gfx_font.cpp:734\n\n3  0x000000000046b4f1 in THFreeTypeFont::getTextSize (this=0x18829c8,\nsMessage=0x15c4948 \"Magyar\", iMessageLength=6, pX=0x7fffffffe0cc, \npY=0x7fffffffe0c8)\nat /home/stephen/CorsixTH/CorsixTH/Src/th_gfx_font.cpp:489\n\n4  0x0000000000440224 in l_font_draw (L=0x13bf298)\nat /home/stephen/CorsixTH/CorsixTH/Src/th_lua_gfx.cpp:346\n\n5  0x00007ffff768f950 in ?? () from /usr/lib/liblua.so.5.3\n6  0x00007ffff769c7bd in ?? () from /usr/lib/liblua.so.5.3\n7  0x00007ffff768fbc0 in ?? () from /usr/lib/liblua.so.5.3\n8  0x00007ffff768f2b2 in ?? () from /usr/lib/liblua.so.5.3\n9  0x00007ffff768fde4 in lua_resume () from /usr/lib/liblua.so.5.3\n10 0x00000000004704fe in l_mainloop (L=0x6df718)\n```\nAs discussed on irc, we should be caching a surface instead of a texture so the renderer is not necessary.\n. @adam900710 To address your concern, once pr #787 is in place you should be able to set unicode_font = [[/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc]] and see the Chinese language options. Tested in Arch Linux x86_64.\n. Reopening because of the additional font selector path issue.\n. I can confirm that the root / is not included in Linux. In windows the path is created properly.\nThis issue does not affect any of the directory lookup widgets.\n. Thanks for noticing that, iTexture shouldn't exist at all anymore and possibly the entire union replaced with SDL_Texture. It was originally written the way it was to facilitate multiple rendering back ends, where some would return an index (because you can't have pointers to GPU memory), and others would return a pointer; but now we only need to support SDL2 and this pr could break on another back end because it compares against NULL. If there is still interest in supporting those abstractions I could restore _setNullTexture and add _isNullTexture. (subclasses or templates would probably be a better choice if we were to go down that road again though)\nI could certainly document several of the fields in cached_text_t.\n. Removed iTexture and all references to it, and documented cached_text_t.\n. Fixed by #1314. Duplicate of #352\n. I believe this is the same missing check that allows building doors that are blocked by radiators.  Both shouldn't be possible.\n. Agreed.\n. Duplicate of #221 . I do not see this with Lua 5.3 on Windows with a screen resolution of 600x800.  Would need to do more testing to isolate what condition causes it.\nAlso, please specify what commit hash you are using if you are using a non-release version. You can get this with git rev-parse --short HEAD or from the top of git log or git show\n. At least on Windows (DirectX) I'm unable to replicate, with the same resolution you are using. I also don't get the artifacts around my tiles.\n\nPerhaps this only affects OpenGL/Linux?\n. For all you people that can reproduce this, could you see if you get a false from canvas:scale when this happens:\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/game_ui.lua#L150\n. What looks to be happening is that it's failing to render to the zoom texture. When that happens the scale is not reset, but applies to the entire window instead.\nI'm attaching a PR that will reset the scale and output a warning to the console when that happens. I won't be able to test it myself, but I'll link to the travis build once it's done.\n. Unfortunately it doesn't seem like the build was put up on http://www.armedpineapple.co.uk/cth/builds/\nIf someone can reproduce, they can build themselves (master >= 1c4bc2381)\n. I am able to reproduce only in full screen mode when running the game in a non-native resolution. After zooming the game changes to native resolution, but the bottom panel appears where it would be on the set resolution. A some zoom levels (zooming in) the map shrinks to just the set resolution size (in the top left corner), and after exiting, the menu does as well.\nI think this is a result of not factoring in the pseudo resolution full screen stretch (we don't switch screen modes) when calculating or resetting the zoom scale.\n. I'm going to suggest not including the C++ project.  Your current one is tied to windows (with mingw), and cmake is able to generate eclipse projects fairly easily that work for the c++ (but not the lua).\n. Bundled eclipse project has been discontinued. Eclipse users can target eclipse from cmake.\n. It wouldn't be the same error, lua wasn't picky about floats vs ints until 5.3.\n. The issue is fixed though, it use to be 100% reproducible.\n. I was premature in saying the crash was fixed, reproduced.\n. Is the final result what you want; just asking because of the revert and the revert revert commits.\n. I see there is no difference between your first commit and your last one, so I guess the revert was accidental?\n. It appears that these changes were made against an old version of CorsixTH. The only changes to the current master I see in your pull request is removing end_month and end_year.\n. Changes were merged.\n. This issue was fixed already, after the release of 0.50 beta 2 in 65c85b94f0db\n. I don't disagree with the last suggestion.  What is currently done is that a default hard coded windows path and a default hard coded linux path are checked if unicode_font in nil, but even on Windows 8 those paths are wrong.\nI don't know how one automatically finds a true type font with good unicode coverage (on a number of different operating systems), but web browsers can do it so it must be possible.\n. Probably cleaner if I open a new issue actually.\n. You need timdity-freepats. Timidity itself cannot play music, follow the instructions for your operating system for installing timidity.\n. Duplicate of #746\n. Timidity-freepats is just 33MB so look up instructions for how to get it for your distro, or provide your own mp3 directory in game settings instead of using the original midi.\nThere is no actual audio in a midi file, just instruments and notes. Old sound cards had the sounds built in but new ones don't. That's why you need these big sound fonts and there is no way around it except to use lower quality samples or not play the original tracks.\nPlease avoid calling us stupid. It's not motivating.\n. The warning about 64bit systems not supporting mp3 is obsolete (and should be fixed - let's open an issue about it.)  However it does depend on smpeg, which fedora does not include in their own repos because of their stance on mp3s (http://forums.fedoraforum.org/showthread.php?t=33457) but it is included in 3rd party repos for fedora. (rpm.pbone.net/index.php3?stat=3&search=smpeg)\nAlternative sound track support has not received much attention; I believe it would also be trivial to support other formats supported by SDL_Mixer2 such as ogg vorbis which could play in fedora without third party repo libs (possibly as simple as changing this one line: https://github.com/CorsixTH/CorsixTH/blob/bc51ad3e391510c4b48517b06255996e11de5b0d/CorsixTH/Lua/audio.lua#L119)\nffmpeg and libav support are also possible (I wrote the ffmpeg and libav movie support for CorsixTH, so I've dealt with audio decoding with those libraries already), but it puts a lot of the maintenance burden that's currently covered by SDL_Mixer2 back on us, for a fairly small gain (smpeg is < 1mb, and we can save that space in ffmpeg by shipping a version compiled for only smacker video/audio support).\n. Note that smpeg 2.0.0 is the version needed.\n. Unfortunately there is no SDL2 version of SDL_sound, the last release version of that library is from 2008, and the last commit was in 2012, so it may have been abandoned.\nI think your path of least resistence if you don't want to compile packages yourself is going to be getting timidity-patch-freepats from another rpm distro e.g. http://rpm.pbone.net/index.php3/stat/4/idpl/27540465/dir/mageia_cauldron/com/timidity-patch-freepats-20060219-19.mga5.noarch.rpm.html\n. I said that it would require a change in CorsixTH and pointed out the line (https://github.com/CorsixTH/CorsixTH/issues/818#issuecomment-123704315)\n. Ah I see.  Make sure you have libvorbis installed, because that's what SDL_Mixer 2 uses to open it. Beyond that, you're getting outside of stuff I've tried so I won't be able to help at this time.\n. Is it possible that you blocked off part of your hospital? That could cause the stuck handyman and this error.\n. When you build a new room it loops through all the other rooms in the hospital looking for patients that maybe should be redirected to the newly created room.\nThis error is happening when checking the distance of people at the back of the queue for an old room with the people at the back of the queue for this newly created room. It appears (though I haven't yet run a debugger to be 100% certain) that world:getPathDistance() is not returning a number in one of those look ups. Will need to check with a debugger to determine why that is. I suspect either a room doesn't have a location, a patient doesn't have a location, or there is no path from the patient to the room (all of which would be a sign of another bug, because none of those things should be possible)\n. Thanks @MarkL1961 , so this is one of those cases where it shouldn't be possible to block a path but the checks aren't working correctly.\n. It's somewhat related to #491 and if the suggestion in that issue (to make the tiles next to purchase points unbuildable) was implemented then this issue couldn't happen.\n. There is a lot of code in CorsixTH that assumes nothing is ever blocked off, but I suppose removing that assumption is another possibility.\nIn the original was it possible to trap patients too?\n. I think a goal for CorsixTH then should be to not complain so much about blocked paths. There are good reasons to do so, like containing people to the heated parts of the hospital.\n. Which is to say we'll directly fix this bug (the error when there isn't a path), instead of preventing the blocked path. In the mean time there is a workaround as pointed out by MarkL @zsolmanz \n. I've made a small fix for the error in the stack trace, and another one that happens just afterwards. As soon as you try to add staff though the whole thing gets quite a bit more complicated but I think that all the problems should be tracked through separate issues so the overall problem can be fixed in stages?\n. Thanks for the error report!\n. I wasn't able to reproduce; I believe this issue may have already been fixed since 0.50 beta 2. The actual error relates to the positioning of the people in the door dialog you have open.\n. Fixed by #1364 . ~~#819~~\n. This has been reported before. We believe it's fixed in the latest master, please retest after the release candidate is released Sunday night!\n. Duplicate of #745 \n. I guess this is a change resulting from lua 5.3's new integer types. It should be fixable with explicit formatting strings: http://www.lua.org/manual/5.3/manual.html#pdf-string.format (use %d)\n. Keyboard bindings also need to be added for old save games, at the very least the one for ui.lua.  Bump the savegame number, and add an afterLoad condition to add the new one.\n. yep, and bump the new savegame version (in app.lua)\n. What version is this error from?\n. #1201 has the same stack trace and also involves the cast remover. I'm not sure if a hell death was involved. @l29ah can you clarify?. Going to hold off on this until after the release, thanks for the contribution.\n. Agree this can wait for 0.60; that release should have a number of balance changes if the drug price effect lands.\n. This is very curious; nothing you've shown so far looks wrong, but compiling on linux has works for us on a number of distros and lua versions. It's somewhat obvious in your original error that lfs (luafilesytem) is at fault - this was a version you got from your distro.\nConcerning the original error - could we try taking CorsixTH out of the picture.  Just run lua -e 'require(\"lfs\")' (substitute that with the appropriate lua interpreter of course).\nConcerning the issue with the program terminating with no output, I don't know if that's related at all.\n. @malkavi attaching the contents of CMakeCache.txt may be helpful as well. Not all of the information is dumped in the cmake output.\n. Ok, so it all looks right based on the OpenSuse packages as I'm reading them.\nI'm assuming you installed these packages: http://rpm.pbone.net/index.php3/stat/4/idpl/27312032/dir/opensuse_13.x/com/lua-5.2.2-2.4.1.x86_64.rpm.html\nand http://rpm.pbone.net/index.php3/stat/4/idpl/30431512/dir/opensuse_13.x/com/lua-devel-5.2.0-21.7.1.x86_64.rpm.html\nI'm stumped on this one - short of running gdb and seeing exactly where/why the program is exiting.\n. If you can select the TH folder then lua and luafilesystem are definitely working. If reloading the game data doesn't work for you, you might also try turning off movies in the config.\nWe know that control has been passed to CorsixTH.lua at least - if the above don't work, then we can use mobdebug to walk through the lua and find out where it's exiting.\n. If you know how to run gdb, it would be interesting to know where the segfault is happening. A valgrind dump might also be interesting if it's not a hardware / driver issue.\n. Thanks, that's a nice dump (with debug symbols in SDL even) :+1: \nCould you clarify what resolution you were going from and to during that crash? There is size numbers in the dump and I want to know if they correspond to the before state or the after state.\n. Also is that the release version of SDL2 2.0.2?\n. Yes I fixed this, didn't notice the issue. Thanks.. It looks like the distance to the top is constant, and it's centered horizontally.  You want it to be centered vertically and horizontally or are you seeing something different?\n. Nevermind, I was looking at the menu and you were talking about the background image.  Sorry for the bad reading comprehension :(\n. Merged.\n. I cannot reproduce myself.\nYou say in your ticket \"anymore\", could you find the commit that causes the problem for you? (http://git-scm.com/docs/git-bisect)\n. Alright, I can reproduce with opengl, thanks.\n. It seems that without that commit there is an issue with the placement of the previews when using full screen at non-native resolution in all rendering back ends, but at native resolution (or windowed mode) the placement is right in all renderers. With that commit there is a problem with the placement of all previews in only opengl. The software renderer has severe rendering problems across the board but the placement of the preview is right.\n. Determined that this is an SDL bug that will be fixed with SDL 2.0.4: https://bugzilla.libsdl.org/show_bug.cgi?id=2700\n. @bobcanthelpyou do you know how to squash these changes into one commit, or would you like me to do it?\n. Added brackets for clarity and missing #include <cstring>\n. Updated the pull request to handle the zoom case properly.\n. Is that your final answer? :)\n. There are quite a few grammar errors in that block of text too. I don't suppose you feel like cleaning up more of it?\n. /me considers revoking CorsixTH commit rights from @corsix. j/k, good to see you're still lurking!\n. Thanks for the fix, at this point the PR will have to wait for after the release.\n. Similar to (and possible dupe of) #527 \nThere were some changes to operating theater behavior in 0.40 which may account for any differences.\n. Fixed by #871 \n. Is this a duplicate of #483 ?\n. Good for merge following 0.50 :+1:\n. Possibly related to #866 and/or #527\n. @wolfy1339 is it possible for you to separate the fixes from the reordering. It's pretty hard to review the fixes when everything is moved.\n. Thanks @wolfy1339 \n. @bobcanthelpyou there is no 'order' for a lua table, unless you index it 1, 2, 3..., as such the dump doesn't have an order and it's not something that could easily be fixed.\n. It would be '''using namespace std::uint8_t''' rather than a typedef, but the practice seems controversial even for stdint types. I'm open to the change but I'd like to see what other large projects do.\n. I've looked around for some examples in the wild:\nBoost always supplies fully qualified names.\nHedgewars uses the C library (stdint.h)\nOpenTTD uses the C library\nWebkit uses <cstdint> and splatters e.g. using std::size_t etc. throughout the code (in both headers and cpp files) seemingly at random.\nQt typedef's it's own sized types e.g. quint32, and tries to avoid contamination by stdint types when using 3rd party code, going as far as:\n```\ndefine uint64_t QT_PREPEND_NAMESPACE(quint64)\ndefine uint32_t QT_PREPEND_NAMESPACE(quint32)\ndefine uint8_t QT_PREPEND_NAMESPACE(quint8)\ndefine int_least16_t QT_PREPEND_NAMESPACE(qint16)\n// Header from rfc6234 with 1 modification:\n// sha1.h - commented out '#include ' on line 74\ninclude \"../../3rdparty/rfc6234/sha.h\"\nundef uint64_t\nundef uint32_t\nundef uint68_t\nundef int_least16_t\n```\n(the typo in the above code suggests they don't quite succeed)\nI guess it's up to us what we want to do - especially considering we are not developing a library to be consumed by anyone else. Presumably Boost would be the most technically correct given their close affiliation with the C++ standards committee; but they are also a library and reference implementation for future C++ additions - we don't have the same requirement for technical cleanliness vs verbosity.\n. Used using in config.h.in for all the cstdint and cstddef types that we use commonly as per @Alberth289346 's recommendation\n. I've removed my last commit from this pull request so that it can be merged now. Switching to C++ string functions and updating travis to handle more C++11 features is something I'll do in the future.\n. Please upload a save game if possible, and attach the contents of gamelog.txt or the output of the console window. Also tell us what version you are playing, and on what operating system.\n. Could you disable the FPS display in your config.txt and see if that solves the freeze? Assuming it does I don't need your save - I can see the problem.\n. The crash message from your gamelog.txt is from code that's only accessed if track FPS is enabled, and there is a bug there. I will use this issue to track that problem.\n. Yes, thanks @wolfy1339 \n. Thanks @admdly, I was afraid of that. Good to here you're still around.\nPinging @tobylane\n. I've pulled the OSX release until the issues with it can be dealt with.\nIt should be noted that for this release Lua 5.3 is preferred to LuaJIT. There are some crashes that affect LuaJIT and not Lua (see #327).\n. @admdly is this the same as #1035 \nYou didn't really provide any details.\n. Resolved for 0.62. What video card do you have? Is it Win7 64bit? Could you paste the console output for the feeze?\nI haven't seen this in my windows tests.\n. I don't have access to any comparable hardware to test with. Do you happen to have Visual Studio and the technical expertise to diagnose where the problem is?\nIf not I suppose a couple things are worth checking. First, do the videos work for you in CorsixTH 0.40 (The decoding is nearly identical, but the rendering is completely different), secondly, does the problem still happen in windowed mode (600x800), and finally does the problem still happen with OpenGL: Open the command line, navigate to the CorsixTH directory, type set SDL_RENDER_DRIVER=opengl and press enter, then CorsixTH.exe. If you are still in windowed mode you should see it say opengl instead of direct3d in the window title.\n. When you say the board game freezes \"after a second\", do you mean it plays several frames of the board game before stopping?\n. For the board game the music playback should be independent of the video (the video is actually silent for that one and we trigger a sound to start playing at the same time we start the video).\nAnyway if I understand correctly, the token starts at the start position, gets a few frames in, but doesn't make it to the final position (on level 1 of the board game). It sounds like some sort of deadlock which means it would be really helpful to have the stack trace of all the threads. It would be easy to get that information if you were comfortable with Visual Studio and compiling CorsixTH.\nIf that's an option for you, you can read: https://github.com/CorsixTH/CorsixTH/wiki/How-To-Compile the dependencies are available precompiled for Visual Studio 2013 at https://github.com/CorsixTH/deps and we can provide further assistance on irc (#corsix-th on freenode), where I have the same nick.\nI'll spend some time looking too, but without being able to reproduce the problem the chances of finding the problem are pretty slim for me.\n. No solution so far. It's probably not a coincidence that the two of you are on very similar video cards (ATI cards using the drivers that covered r600 until southern islands).\nWe are still looking for someone with an affected video card that can trace down what exactly is failing.\n. It's not a long shot. With my changes our interactions with the GPU are more conventional so we're less likely to hit driver/hardware issues.\nIs anyone able to retest with the latest master?\n. @suipaste we believe this issue is already fixed after the release of 0.50, are you testing with the latest master?\n. Thanks @emorrp1 \n. We do not directly access the operating system's audio framework in CorsixTH, all of our audio is output through SDL2_Mixer.\n. Possibly one of the libraries SDL2_mixer uses e.g. Timidity.\nIf you're building CorsixTH yourself and could step through the code to determine what is happening (what line is being executed) when that warning is issued) it would help for reporting the issue upstream.\n. I've been leaving upstream issues open until they are resolved upstream. Hopefully people will see them before filing duplicates.\n. Merged.\n. Is this ready now sadger?\n. Ok, change the label to RDY when you're ready for code review again please.\n. It sounds like mouse up isn't being registered. That's not something I've seen. Does this happen every time?\n. Is this a traditional mouse, or some other type of pointing device? Is there anything else unusual about your setup? Does the problem happen in both fullscreen and windowed mode? (you can edit config.txt in notepad, it's in %APPDATA%/CorsixTH)\nBasically anything you can tell us that might help tracking it down, since it doesn't happen to us.\n. You should also post your gamelog.txt file or any console output from when this happens.\n. From the TravisCI output:\n```\n[100%] Generating API documentation for corsixth_lua\n/usr/bin/lua: ./lua_scan.lua:93: Unknown documentation command: Change (Lua/world.lua near line 800)\nstack traceback:\n[C]: in function 'error'\n\n./lua_scan.lua:93: in function 'ParseComments'\n\n./lua_scan.lua:226: in function 'IdentifyMethods'\n\n./lua_scan.lua:293: in function 'MakeLuaCodeModel'\n\n...home/travis/build/CorsixTH/CorsixTH/LDocGen/main.lua:82: in main chunk\n\n[C]: ?\n\nmake[3]: *** [CMakeFiles/doc_corsixth_lua] Error 1\nmake[2]: *** [CMakeFiles/doc_corsixth_lua.dir/all] Error 2\nmake[1]: *** [CMakeFiles/doc.dir/rule] Error 2\nmake: *** [doc] Error 2\n```\n. I'm not sure how to go from here to including mingw-w64-g++ 4.8. I like that the travis ci containers are much faster, but we might still need sudo so I'm hesitant to have this merged yet.\n. @alanwoolley Once this is merged, would you be able to make this appveyor build the source of your latest-builds. They are native windows builds, and I'd like to take mingw out of travis-ci.\n. @alanwoolley Actually AppVeyor is capable of hosting artifacts itself, so I'll go that route and put a link in the wiki. Thanks.\n. I'm pretty happy with the script now. It generates a CorsixTH.zip that contains everything needed to run on windows.\n. Switched inconsistent slash. Thanks @Alberth289346 \n. Yes I do, the playdeb people decided to use lua 5.1. I don't know how to get in contact with them and tell them to change that, but if you could remove luajit from your system - that might fix it. If it does let us know please.\n. CorsixTH built against lua 5.1 will not find lua 5.2.\nIf you're willing or able to compile yourself (it actually isn't very hard in Ubuntu) we could walk you through it. Then we can see if the problem goes away, or if not - run a debugger and find where the problem is.\n. Alright, well I guess all we can conclude is that there's something wrong with the playdeb package. If it still segfaulted we could have maybe seen why. Do you know if there's any way to report it to them?\n. Agreed, could you use ldd to determine what if any differences exist between the libraries used by your compile vs the ones used by playdeb?\n. Well now I'm running out of ideas. I guess you are not using the exact same code version, so you could git checkout v0.50 to verify.\n. @tonihele anything to add from more recent experience?. @wolfy1339 can you take a look at this.\n. Should be fixed by #899 In the mean time you can work around this by manually specifying your LUA_INCLUDE_DIR and LUA_LIBRARY. e.g.cmake -DLUA_INCLUDE_DIR=/usr/include/lua5.2/ -DLUA_LIBRARY=/usr/lib/lua5.2/ .\n. it sounds like your LUA_LIBRARY variable was wrong. It should be the exact path to liblua.so (or liblua5.2.so, or liblua.so.5.2, or whatever it is in your distirubtion) including the file name.\n. @chaosink I specifically said in my last comment to include the file name.\n. Yes that's what I meant. Your current issue is with ffmpeg, which appears to be failing to find a symbol in libz. This is out of scope for CorsixTH as we don't require ffmpeg to link against libz at all.\n. @chaosink you should be able to set -DWITH_MOVIES=off and not include ffmpeg in your build. If you care to join us on irc (freenode #corsix-th) that is a more appropriate forum to continue this discussion.\n. Non issue, there are actual issues blocking the OSX release e.g. #1035 \n. I see the version of cmake included in travis CI is too old to contain the FindLua module. Given that I will modify the pull request to include the latest version of the upstream FindLua.cmake module\n. Thanks for the report and the save game. Could you also copy in the gamelog.txt or console output from the crash?\n. Duplicate of #124 \n. A number of problems, const char[] cannot take numbers over 127, static enum doesn't make sense (should be enum).\n. Implemented changes recommended by @Alberth289346. Use C++ vector in bootstrap so that the data can be passed to a function and maintain their size.\n. Based on the conventions in the wiki I think camel case is right. I used underscore in rnc.cpp just to match the surrounding code which I think was copied from another project.\n. Ok I've made the rest of the changes mentioned by @Alberth289346 that were appropriate. In the case of the lua.hpp functions there is already a comment in that file explaining why those functions are being defined. I've additionally changed rangeScale to range_scale to match other functions in that file.\n. It seems so. Probably the easiest way to build on Windows is to copy the appveyor.yml script. Usually problems with main have to do with linking sdl2.\n. Yes, I ran into that myself. Currently all the deps are built against 2013 rather than 2015.\n. There are VS2015 x64 deps in the deps repo as well, so the second issue isn't either.\n. Are you able to build earlier versions, and what version of lua are you using? It definitely works with lua 5.3.1 with and without compatibility enabled. I haven't personally tested with lua 5.1.\n. Actually there are is no \"lua_rotate\" in our code. That suggests that the includes you are using don't match the library.\n. The second commit (Merge branch 'master'...) shouldn't be there. Are you familiar enough with git to fix this yourself or would you like one of us to fix it on merge?\n. :+1: \n. Heh, we disagree on the enum type name thing - I think it's the enum class name is usually the most elegant name for variables/properties of that type - after all they represent the same thing. Perhaps because I've been exposed to the .NET framework for so long and they almost always use that convention e.g. CommandType\nA replacement for utf8next would be interesting, particularly if we could turn it into an iterator for a new lightweight string type that stores a const char pointer and a length without doing a copy on construction. It wouldn't handle normalization, but I don't think there's anyway to properly do normalization and character set conversions and case conversions without large tables like the ones that bloat ICU. We can address those issues in the translation files themselves though, so we probably don't need to be doing that processing at run time.\nThe biggest issue with what we have is that we can only handle very simple left to right languages. If there is ever any interest in an Arabic translation work will be needed.\nThe problem I see with using unicode strings everywhere is that almost all the strings in CorsixTH come from and are manipulated in lua, and lua is only aware of c strings. It would be possible to provide a framework for making lua handle unicodeString but I think it would take a lot of work.\nMy searches have also turned up the UTF-CPP library which looks promising as far as what we're looking for, though I'm concerned that it may not be widely used or well maintained.\n. I don't think this was the right direction to take.\n. Pasting contents of logs here:\nCreated game with savegame version 105.\nWarning: Trying to remove nonexistant room build callback (function: 000000C7852D7820) from humanoid (table: 000000C7849C9420).\nWarning: Trying to remove nonexistant room remove callback (function: 000000C794216380) from humanoid (table: 000000C7849C9420).\nWarning: Trying to remove nonexistant room build callback (function: 000000C7846FA9C0) from humanoid (table: 000000C785F0CA70).\nWarning: Trying to remove nonexistant room remove callback (function: 000000C79B1AEDD0) from humanoid (table: 000000C785F0CA70).\nWarning: Trying to remove nonexistant room build callback (function: 000000C785D2BB30) from humanoid (table: 000000C7849C9420).\nWarning: Trying to remove nonexistant room remove callback (function: 000000C785B080E0) from humanoid (table: 000000C7849C9420).\nWarning: Trying to remove nonexistant room build callback (function: 000000C7846DD4A0) from humanoid (table: 000000C793C17850).\nWarning: Trying to remove nonexistant room remove callback (function: 000000C7845E41D0) from humanoid (table: 000000C793C17850).\nWarning: Trying to remove nonexistant room build callback (function: 000000C7846F4C00) from humanoid (table: 000000C785232EA0).\nWarning: Trying to remove nonexistant room remove callback (function: 000000C79B2A23D0) from humanoid (table: 000000C785232EA0).\nSavegame version is 105 (0.50), originally it was 105 (0.50)\nWarning: Trying to remove nonexistant room build callback (function: 000000F8B64CC3B0) from humanoid (table: 000000F8A6B9D5F0).\nWarning: Trying to remove nonexistant room remove callback (function: 000000F8A7818760) from humanoid (table: 000000F8A6B9D5F0).\nWarning: Trying to remove nonexistant room build callback (function: 000000F8B64D0D90) from humanoid (table: 000000F8A6887390).\nWarning: Trying to remove nonexistant room remove callback (function: 000000F8A7534720) from humanoid (table: 000000F8A6887390).\nWarning: Trying to remove nonexistant room build callback (function: 000000F8B6A17C30) from humanoid (table: 000000F8A6CC2920).\nWarning: Trying to remove nonexistant room remove callback (function: 000000F8A55CA530) from humanoid (table: 000000F8A6CC2920).\nWarning: Trying to remove nonexistant room build callback (function: 000000F8B6A12E90) from humanoid (table: 000000F8A6EF7740).\nWarning: Trying to remove nonexistant room remove callback (function: 000000F8B4E4C410) from humanoid (table: 000000F8A6EF7740).\nError in timer handler: \nD:\\Spiele\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:174: Suspected infinite loop\nstack traceback:\n    [C]: in function 'error'\n    D:\\Spiele\\CorsixTH\\Lua\\app.lua:797: in hook '?'\n    D:\\Spiele\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:174: in function <D:\\Spiele\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:137>\n    (...tail calls...)\n    D:\\Spiele\\CorsixTH\\Lua\\entity.lua:218: in method 'tick'\n    D:\\Spiele\\CorsixTH\\Lua\\world.lua:1121: in method 'onTick'\n    D:\\Spiele\\CorsixTH\\Lua\\app.lua:878: in function <D:\\Spiele\\CorsixTH\\Lua\\app.lua:875>\n    (...tail calls...)\n    D:\\Spiele\\CorsixTH\\Lua\\app.lua:779: in function <D:\\Spiele\\CorsixTH\\Lua\\app.lua:774>\n```\nWelcome to CorsixTH 0.50!\n\nThis window will display useful information if an error occurs.\n\nChecking for CorsixTH updates...\nYou are running the latest version of CorsixTH.\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nD:\\Spiele\\CorsixTH\\Lua\\hospital.lua:1559: attempt to index a nil value (field '?')\nstack traceback:\n        D:\\Spiele\\CorsixTH\\Lua\\hospital.lua:1559: in method 'getTreatmentPrice'\n        D:\\Spiele\\CorsixTH\\Lua\\hospital.lua:1543: in method 'receiveMoneyForTreatment'\n        D:\\Spiele\\CorsixTH\\Lua\\room.lua:176: in method 'dealtWithPatient'\n        D:\\Spiele\\CorsixTH\\Lua\\rooms\\operating_theatre.lua:199: in field 'after_use'\n        ...piele\\CorsixTH\\Lua\\humanoid_actions\\multi_use_object.lua:264: in local 'timer_function'\n        D:\\Spiele\\CorsixTH\\Lua\\entity.lua:218: in field 'tick'\n        D:\\Spiele\\CorsixTH\\Lua\\entities\\staff.lua:149: in method 'tick'\n        D:\\Spiele\\CorsixTH\\Lua\\world.lua:1121: in method 'onTick'\n        D:\\Spiele\\CorsixTH\\Lua\\app.lua:878: in function \n        (...tail calls...)\n        D:\\Spiele\\CorsixTH\\Lua\\app.lua:779: in function \nWarning: No event handler for timer\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nD:\\Spiele\\CorsixTH\\Lua\\hospital.lua:1559: attempt to index a nil value (field '?')\nstack traceback:\n        D:\\Spiele\\CorsixTH\\Lua\\hospital.lua:1559: in method 'getTreatmentPrice'\n        D:\\Spiele\\CorsixTH\\Lua\\hospital.lua:1543: in method 'receiveMoneyForTreatment'\n        D:\\Spiele\\CorsixTH\\Lua\\room.lua:176: in method 'dealtWithPatient'\n        D:\\Spiele\\CorsixTH\\Lua\\rooms\\operating_theatre.lua:199: in field 'after_use'\n        ...piele\\CorsixTH\\Lua\\humanoid_actions\\multi_use_object.lua:264: in local 'timer_function'\n        D:\\Spiele\\CorsixTH\\Lua\\entity.lua:218: in field 'tick'\n        D:\\Spiele\\CorsixTH\\Lua\\entities\\staff.lua:149: in method 'tick'\n        D:\\Spiele\\CorsixTH\\Lua\\world.lua:1121: in method 'onTick'\n        D:\\Spiele\\CorsixTH\\Lua\\app.lua:878: in function \n        (...tail calls...)\n        D:\\Spiele\\CorsixTH\\Lua\\app.lua:779: in function \nWarning: Proper idle not in action_queue\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nD:\\Spiele\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:174: Suspected infinite loop\nstack traceback:\n        [C]: in function 'error'\n        D:\\Spiele\\CorsixTH\\Lua\\app.lua:797: in hook '?'\n        D:\\Spiele\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:174: in function \n        (...tail calls...)\n        D:\\Spiele\\CorsixTH\\Lua\\entity.lua:218: in method 'tick'\n        D:\\Spiele\\CorsixTH\\Lua\\world.lua:1121: in method 'onTick'\n        D:\\Spiele\\CorsixTH\\Lua\\app.lua:878: in function \n        (...tail calls...)\n        D:\\Spiele\\CorsixTH\\Lua\\app.lua:779: in function \nWarning: Proper idle not in action_queue\n```\n. Generally the infinite loop in the walk handler issue happens when part of the hospital is unreachable. This shouldn't happen, but there are a couple cases where you can build a room in an unreachable area, or block a door with a radiator.\nThe other issue is new to this ticket. Could you link a save game to reproduce the issue?\n. The effect of moving the machine impacts your other pr #913 since presumably a proper fix wouldn't call onDestroy. Leaving it open too.\n. @JoshKeegan obj:foo(args) in lua is syntactic sugar for obj.foo(obj, args). function obj:myfunct(args) is syntactic sugar for function obj.myfunct(self, args). So you are already passing self as a parameter, it's just hidden. In the case of a local function you will need to pass self explicitly, but this is no different than what's already being done except that this time you see it.\nIt's a small price to pay for encapsulating functions that shouldn't be called by the outside world.\nI think calculateUsesLeft could be left exposed though. That seems like harmless and possibly useful information for another object to ask for.\n. I see, it's setSmoke(bool) that's the helper method not used elsewhere. place_object unfortunately needs to be aware of recalculateSmoke (no way around that without refactoring so that objects are notified when they are placed - which is a good idea, but out of scope for this PR). I'm ok with it then.\n. Yeah, I'm not a big fan either. Maybe updateSmokeLevel or just placeSmoke? Also I think in the case of room.crashed it should setSmoke(false) instead of just returning, though the condition won't come up. When you do that you can squash the commits together too.\nWorks well in my tests.\n. Yes, good work\n. :+1:\n. As mentioned in #912 the current behavior when machines is moved is wrong. I think correcting that behavior will completely change how this is managed.\n. No update in over 2 years. If there is no update in 2 weeks I will close this PR.. I actually think this change is worth merging anyway. Thanks @JoshKeegan. We are striving to have all new functions documented, please add documentation comments describing this function.\n. :+1: \n. Your scenario of a developer without the internet seems contrived - how did they get the source, and how are they going to get the dependencies that they are reading about in the build instructions? And if they know ahead of time to get all that stuff, why wouldn't they just save the wiki page?\n. The issue is that it moves the maintenance burden from the community (anyone with an account can update the wiki) to the very small group of us that develop the game. If you feel passionately enough to produce a pr with some simple easy to maintain build instructions in the readme that would be ok. Feel free to copy appveyor.yml's script for Windows.\n. Yes, the build location moved recently. I did update the wiki, so if you found an old link let me know where it was please. You want to go to https://ci.appveyor.com/project/TheCycoONE/corsixth/history then click a build with just a number (the ones with number-stuff are pull requests), then click the artifact tab and there it is.\n. Actually, this looks like a perfect candidate for std::map. Something like:\nstd::map<const char *, THMapNodeFlags> lua_node_flag_map = {\n    {\"passable\", THMN_Passable},\n    {\"hospital\", THMN_Hospital},\n...\nauto iter = lua_node_flag_map.find(field);\nif(iter != lua_node_flag_map.end())\n{\n  if (lua_toboolean(L, 6) == 0)\n    pNode->iFlags &= ~((*iter).second);\n...\n- Above was written by hand in this comment section, untested, I can't vouch for it but I think it should work.\n. Actually you'll need to either specify an alternate compare function or use std::string for the key.\n. TravisCI failure caused by https://github.com/Olivine-Labs/busted/issues/459, we can ignore it.\n. Lets merge these commits, the second rewrites a lot of the first anyway.\n. Merged with squash.\n. I don't think this is the right approach for this issue. You are suppose to be able to call that function after a handyman has already been assigned to the machine, and it bumps the task to the top of the queue in that case. If you are getting multiple calls in the queue then getIndexOfTask is where I'd look.\n. Pinging @MarkL1961 oracle of all things original theme hospital :)\n. Thanks @MarkL1961. @Alberth289346 I think we should replicate this.\n. I don't mind if it's tacked on as a separate commit in this PR, on the other hand I see no reason why it has to be, and this has been in purgatory for a long time so it might be best to make a new one.\n. Fails in gcc with \"th_lua_map.cpp:(.text+0x47a3): undefined reference to `th_map_node_flags::passable_mask'\" etc.\nI haven't yet looked into why this is, or whether gcc or msvc is more 'correct'.\n. Swapped static const uint32_t values for an enum, which provides more consistent support across msvc and g++.\n. Updated to satisfy @Alberth289346's personal hatred of == false ;-)\n. Further cleaned up THMapNode, removing the object_type value from flags and making a single objects list.\n. Fixed the unused found variable as per @Alberth289346 's comment, and changed th_map_node_flags to use array indexing instead of bit operations to modify values by key.\n. No update in over a year. If there is no update in 2 weeks I will close this PR.. From a brief glance, it seems like all this lua cleanup functionality can be removed, simply calling the two cleanup operations, Mix_CloseAudio, and SDL_Quit explicitly.\n. Looks good, I think you could join some of these commits - then you won't need a commit with the message \"Other Improvements\".\n. The order of commits on the github site is confusingly just by date.\nHave you verified those afterLoad methods are called? I know world.lua is suppose to call it on all hospitals, entities and rooms that it's aware of which probably covers the ResearchDepartment. I don't see where epidemic would be called from. (I would guess it should be chained in the afterLoad from Hospital and isn't?)\n. Ok, I think it's good. Can be rebased into one commit.\n. Reads well to me :+1: \n. I looked into moving this class but I'm not happy with it. By convention th_lua* just contains the lua bindings. The class also requires the utf8encode and the two charset functions which are not normally exposed anywhere else, as well as the charset lookup tables. To me it feels cleaner to leave it in th.cpp.\n. Improved the documentation of THStringList. Explicitly delete unimplemented move and copy operations.\n. The problem happens with recent versions of ffmpeg (2.8 and higher) on all operating systems. When it first happened with 2.8.0 I assumed it was an ffmpeg bug that would be fixed shortly. It may  be an ffmpeg bug, or it may be something we're doing wrong that only now is causing problems.\nThank you for the reminder, the issue needs to be isolated and dealt with or reported upstream.\n. On further investigation this is our bug. sws_scale takes the source height parameter not the destination height parameter. I checked earlier versions of ffmpeg and this has always been the case, so I'm uncertain why the issue suddenly started causing problems in 2.8.\nA PR will be coming soon. The AUR maintainer should apply the fix as a patch.\n. I tacked on a second commit that replaces some deprecated ffmpeg/libav with the newer alternatives because they are dropped in the current development versions and it needed to be done.\n. The message you pasted is just a warning about not being able to check for updates because luasocket isn't installed. It isn't related to background music.\nThe most likely reason you're not hearing background audio is that you don't have Timidity set up correctly: https://wiki.archlinux.org/index.php/Timidity\nOtherwise, check your music settings in the config.txt file\n. Excellent, I'll clean this up for a pr then.\n. I've updated this PR. I now consider it ready to be merged (pending review).\n. *my computer.  Alright, I need spell check then. :) Thanks.\n. Updated with the above corrections. For some reason Doxygen is only generating help for config.h so I wasn't able to test.\n. Which version and operating system is this?\n. No reponse. I've sent an email to our packager at playdeb to see if they use this at all. If they don't, then I agree to merge this.\n. The PlayDeb maintainer has gotten back to me. They have no use for this directory, their build scripts are actually public here: https://github.com/ckorn/PlayDeb/tree/wily/corsix-th\n. @Lego3 are you ok if I merge this? (not marked as rdy)\n. 7789566 doesn't remove the usage of music_warning from folder_settings.lua, it should be removed from code as well as the language files right?\n1e93923 and fce138f should be squashed and 7789566 should remain on its own I think.\n. Thanks for the report.\nFor clarity the problematic line is https://github.com/CorsixTH/CorsixTH/blob/cec44a1bda705ce8fc931a45be0e84e56f737960/CorsixTH/Src/th_lua.h#L57 and is used only when compiling against lua 5.1\n. This will currently break any save game where any of those callbacks are currently registered. There's not enough changes yet that I think that would be worth it, maybe add e.g.\n-- callbacks for savegame compatibility\n----[[persistable:patient_toilet_build_callback]] function(room)\nif room.room_info.id == \"toilets\" then\n  self.going_to_toilet = \"no\"\n  self:unregisterRoomBuildCallback(callback)\nend\nI believe you could put that anywhere, and conventionally we put these at the bottom of the files they were originally defined in. Actually you could probably just make the definition blank and set callback to nil in your afterLoad?\n. Thanks!\n. I believe malloc.h should be removed entirely (replaced by cstdlib), it's not a standard header. You can try it in a PR and if it still builds with travis / appveyor then it can be merged.\n. It's a bit harder to remove then that. We use alloca from malloc.h. That usage should be and can be replaced with standard C++ 11 code so I will work on it.\n. Should be resolved by #963 \n. If someone needs lua 5.2 specified that way we can let them make a PR for it.\n. Changed to use C++ casts instead of C style casts. It should be possible to remove these mallocs entirely by replacing m_pData and m_pStringBuffer with stl containers, but that is complicated by the fact that these variables are dual purposed and out of scope for this PR.\n. Looks fine, can you rebase these into one commit?\n. To recap, it's a good patch set. I think that visited_or_unavailable might actually only be visited but I'm not 100% sure on that. If it's the case the commit message should reflect that.\n. Could you check if there are any errors in your gamelog.txt and if so paste them here.\n. Ok, in that case other hospitals are not implemented yet.\n. No I don't have a time frame, no one is working on it at the moment. I'm not sure how the original game came up with it's numbers. The level files have lines like: #computer[0].Skill.StaffLevels.Luck.Speed.Comfort.GuessAt.Playing    3   4   3   30  7   90  1   ORAC It's likely that the original game had a formula involving those numbers and other information in the level file with some randomness thrown in.\n. @Alberth289346 it's 0.50 final. The version indicator in each release candidate included -rc#.\n. :+1: from me. You can merge this directly, we don't require devs to make pull requests on feature branches.\n. @benckx I've cloned your pr and rebased it on the latest master (https://github.com/TheCycoONE/CorsixTH/commit/price_impact). We want the commits in this pull request rewritten in such a way that each one introduces a small self contained feature or refactor. Since this is a difficult thing to do and you are new to git I have taken it upon myself to make the changes.\nWhen I am done you can either reset your branch on my changes, or we can close this PR and I'll open a new one.\nYour authorship will be maintained throughout.\n. My progress can be monitored at https://github.com/TheCycoONE/CorsixTH/commits/price_impact2\nAt the moment I still have a ways to go. Some of the later fix up commits are particularly broad and will need to be broken up and sorted into their respective features.\nEdit: I am rebasing and force pushing the above branch frequently. It is not a good idea to base any work off it.\n. @benckx this policy is mentioned at https://github.com/CorsixTH/CorsixTH/blob/master/CONTRIBUTING.txt#L75, though perhaps it could be more explicitly stated.\nPolicy regarding nested functions is not explicitly stated anywhere at this time, I will be adding some guidelines on that to the wiki now.\n. @bobcanthelpyou if all the issues are cleaned up or ignored could you add this to the travis script? I think lualint would be most useful as part of the continuous integration. If there are still lots of open issues then we'll hold off.\n. @bobcanthelpyou sadly I only know two ways of testing travis changes, either spinning up an Ubuntu 12.04 server vm, or committing changes to a branch that's part of a pull request like this one and reading the output until you get it right. I use both methods.\nI was thinking luacheck, since that's what you're familiar with.\n. The travis script is failing due to https://github.com/travis-ci/travis-ci/issues/5548 we are awaiting some upstream direction.\n. Rather frustrated with the ancient software stack travis is running, but yes I should be able to replace luarocks.\n. Thanks @wolfy1339 #977 switches to Trusty containers.\nSadly at least for the last run it was really slow to spin up, losing all the advantage I gained by disabling sudo earlier, but hopefully that's something that will improve with time.\nAnyway once that pr is merged you should be able to continue @bobcanthelpyou \n. Thanks for the suggestion @houqp for now we'll move to Trusty, but we won't use sudo so once they have containers on Trusty we can use them.\n. I like it a lot. Obviously we can't merge this PR as is since it breaks the travis build, but I think all those unused and shadow warnings are worth correcting if you're willing to do it.\n. Lets keep it in this PR as much as possible. If you would like assistance with a particular warning then comment on it here and when someone else agrees to help they should link back here in their PR.\nAs for commits in this case, it's up to you what you consider a logical grouping that makes review straight forward - there's no hard fast rules for this scenario; in general I would suggest that any larger refactors be isolated in their own commit, and many smaller similar refactors (e.g. all the cases where you remove local to avoid shadowing) be grouped in a single commit.\nAny remaining references to _DECODA should go, I believe the same with _MAP_EDITOR.\n. One last note: I would actually avoid doing larger refactors to clean up things in this PR. Just do the bare minimum to clean up those warnings - that will make merging simpler if other people make large changes to the lua code at the same time. (I know that there are other significant refactoring projects underway).\n. @bobcanthelpyou are there any of the remaining warnings you would like a hand on?\n. @bobcanthelpyou have you given up on this? I'd really like to get luacheck support merged early after 0.60, even if it means we have to disable a lot of errors to start with. (There can be an ongoing issue to enable them again).\n. Errors like this usually indicate that a path is blocked so someone can't get where they want to go. e.g. there is an open issue about radiators being able to block doors. Can you see if there is anything like that?\n. @simonsan can you attach a save that reproduces this issue (e.g. upload one to dropbox or another file service and link)\n. Not enough info, possibly fixed by #1163. @tmarplatt do you have any suspicion as to how this might have happened? Did you save the game and load it between when you knew it was good and when it wasn't? Are you able to reproduce?\n. Could you clarify what additional is needed.\n. I think the scope of this PR is fine as is, thanks.\n. Please rebase on the latest master so that this PR can run against the new working Travis (as well as the comment fix I mentioned above).\n. I just tested this and it doesn't appear to fix #745 \nPressing the number keys during the save dialog still changes the game speed for me.\n. Alright, it appears to depend on the initial state of numlock. If I start the game with numlock off and turn it on in game then everything works, but if it's on when the game starts then ti doesn't, and numlockactive doesn't turn on until I turn off numlock.\n. https://bugzilla.libsdl.org/show_bug.cgi?id=2736 explains it. An SDL bug.\n. I tested with SDL 2.0.4 and I'm getting some very strange behavior. When I turn numlock on I can't change the game speed with any of the number keys even when the dialog isn't showing. When numlock is off I can change the game speed with the top numbers only.\nEdit: I have however verified that with SDL 2.0.4, SDL_GetModState() is working correctly.\n. I think it needs to be part of this PR as the current commit causes a regression not just in keypad support but in all key bindings. I believe a quick workaround would be to remove numlockactive before https://github.com/CorsixTH/CorsixTH/blob/80836f6e24bdd22b9772b93ab1d7003e1639de55/CorsixTH/Lua/ui.lua#L579\n. I spent some time thinking about this, but I'm not sure the best way to handle numlock. I am leaning towards it being in that table but making the key bindings check more sophisticated to ignore particular modifiers, alternatively I thought of removing numlock from the table early in onKeyDown, and replacing Keypad 1-9 with the actual numbers in 'char' when numlock is on, and the arrow keys when it is not, kinda like we do with esc.\n. @bobcanthelpyou How is this going? I would like it in 0.60 (even if that means dropping the movement support for now).\n. :+1: works well in SDL 2.0.4 \n. The version in CorsixTH/Lua/api_version.lua needs to be bumped (whenever the Lua depends on a new version of the C++).\n. Nothing else, I think this can be marked [RDY] if you do.\n. Precisely I'm enforcing:\nhttps://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#c128-virtual-functions-should-specify-exactly-one-of-virtual-override-or-final\nhttps://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#c133-avoid-protected-data\n. sadly I can't think of anything nicer than matching to the parenthesis there, except that I would put all the values on separate lines like:\nlua\nfor _, key in ipairs({\"use_position_secondary\",\n                      \"finish_use_position\",\n                      \"finish_use_position_secondary\"}) do\nEdit:\nIt's insanely hard to line up things like that with a variable width font.\n. By latest build do you mean the latest git copy of master or 0.50.\nIt's worth noting that the Android version is a sister project not directly managed by us; you can find their project here: http://www.armedpineapple.co.uk/projects/corsixth-for-android/\nIs there anything in your gamelog.txt, or if you run from the terminal does anything show up in your terminal? The game works for us on Arch Linux; and the last time I worked with https://aur.archlinux.org/packages/corsix-th/ that was working as well.\n. There still isn't much to go on here. Could you compile with debugging symbols and reduce optimizations to e.g. -O1, then run the program with gdb and post the back trace at the point that it is stuck.\n. Sadly the gdb output isn't very helpful. We would need the backtrace on each thread, and we would need the game compiled with -g -O1\nThat said, we think there may be an issue with your CD. To rule that out could you run md5sum against DATA/LANG-0.DAT, DATA/SOUND-0.DAT, and INTRO/INTRO.SM4\nI would also be curious if the result is any different if you copied the files off the CD into your home folder (the files themselves, don't trip the iso), and change the config to point there. It's been quite some time since I tested with my physical cd and I'm not sure about others, so there may be an issue with our iso support.\nFinally please paste your config file. For clarity in github surround it with ```.\n. Potential duplicate of #499 ?\nPlease keep separate issues separate or else they become difficult to manage.\n. If you are using a CD, verify that you can copy all the files to your hard drive. If you are using a pirated or \"abandonware\" version of theme hospital, it is not supported and we do not endorse its use, buy a copy from Origin or GOG or download the demo.\n. Alright I've tried to use @Alberth289346's suggestions. Any other comments? My test repo has also been updated for those that want a preview.\n. Pinging @Lego3 \n. @Lego3 My feeling is that ISSUE_TRACKER.md is a clear case of a file that has no meaning outside of GitHub so it definitely belongs in .github, README.md is probably in that category too so if it works under .github I'll move it there.\nCONTRIBUTING.txt isn't as clear cut, I think it has just as much value read locally as it does in GitHub, so I'd prefer to leave it where it is.\nSensible?\n. I did a test in my repo with a readme.txt at the root and readme.md in .github and github ended up using the readme.txt, so I think this has to stay as is. Marking [RDY].\n. Transcription of error:\n```\nRunning: The timer handler.\n...\nCorsixTH/Lua/entities/humanoid.lua:662: Can only finish current action\nstack traceback:\n    [C]: In function 'assert'\n    CorsixTH/Lua/entities/humanoid.lua:662: in method 'finishAction'\n    CorsixTH/Lua/rooms/cardiogram.lua:97: in field 'after_use'\n    CorsixTH/Lua/humanoid_actions/multi_use_object.lua:264: in local 'timer_function'\n    ...\nWarning: No event handler for timer\nWarning: Humanoid leaving a room that they are not in\n...\n```\n. Duplicate of #500 \n. Would have to be @Lego3 since I didn't have any access back then. Was there any particular attachment you thought might be valuable? I would think most of that stuff would be too old to be useful.\n. Thanks!\n. I fixed an invalid read in rnc.cpp a few years ago, I bet it's also still in the AnimView version. Consolidation will go in the TODO list.\n. :+1: \n. The idea is controversial, I tend to agree with @voodoo070, but I've seen it come up often enough that it probably warrants an option (down the road).\n. @AVeryFatElf if you can reproduce please open a new issue and fill in all the information from the template.\n. Curious about the appveyor failure, I don't even see the build, and it doesn't help that the error is cut off.\n. Just waiting for #993 to drop because I think it will be easier to fix conflicts here than there.\n. @Alberth289346 could you rebase this on the latest master. I'll merge now since drug casebooks is delayed again.\n. Thanks @Alberth289346 \nBig ugly is sorta what was left after I sorted out what I wanted as I didn't want to change the final result much without consulting the community first. Thanks for your patch for it. I was also planning to unlocal computePriceDistortion and make it return a value again (I don't see any reason for making it work via side effect?)\n. I've applied your action queue patch. Thanks for sorting through some of the individual changes. I too have questions about getCasebookId. @benckx could you comment on that, and maybe some of the other changes in that commit?\n. Reset on @Alberth289346 's hacking_ugly branch\n. Made all the early commit changes proposed by @Alberth289346 \n. Thanks @benckx \nI notice that in the various diagnosis are called diseases in the existing code (e.g. https://github.com/CorsixTH/CorsixTH/blob/c595120db48773fbfa123489bff5be80fa4bf39b/CorsixTH/Lua/diagnosis/diag_gp.lua#L22 ) too, and use the diag__roomname_ format which is what you're replicating here. Maybe the getDiseaseId name you didn't like was right after all. Anyway this is something I'll spend some time looking at, along with the 15257cd commit that Albert says is broken.\nIf you have anything else helpful to add looking over our patch set I'm happy to hear it.\n. The problems with Hospital:recieveMoneyForTreatment were not in benchx's original PR (or my original commit set). I will resolve them later.\nBig ugly refactor commit is getting smaller, though there are some bug fixes in it that need to be moved back to the appropriate commits, and a couple other things to pull out of it.\nThere are also some outstanding white space issues.\nI don't think there's anything left I don't know what to do with, so thanks everyone.\n. @MarkL1961 do you recall if you're suppose to receive money from a patient when they die from the cure? Without this patch you do and with it you do not.\n. I have yet to test this successfully, so it's very likely to crash spectacularly but all of the substantial changes I had wanted to make are done. I will be testing this later myself, but if anyone else wants to get a head start and review the patches or test the pull request it would be helpful at this stage.\n. When reviewing in GitHub remember you can add &w=1 to ignore white space changes. This is particularly helpful for Refactor common \"if patient.disease\" condition out\n. Just pushed a new copy as I fixed a crash on curing a patient.\n. Alright, with these changes the check for the treatment being effective is done before payment so they can either go home paying, go home refusing to pay, or die from an ineffective cure. I'm not sure how much difference it makes, but I can change it.\n. @Alberth289346 sadly the commit comments were lost. In short:\nI removed the addition of the local variables in the goHome commit. I'm ambivalent on them, so the smaller patch won out.\nI reduced the likelihood of the adviser message by 10x. In my testing it did come up very often.\nThe initial value of quality is used, so I didn't make any changes there.\nI also rebased your documentation fixes in. I actually had a more detailed comment for getTreatmentDiseaseId but I seem to have lost it.\n. I just made one more change. I didn't think Room was a good place for the treatment logic so I moved it back into Patient in a new function Patient:treatDisease().\n. @MarkL1961 that makes sense, though it's a pretty serious deviation from what @benckx did.\nHow do people feel about leaving this the way benchx implemented it, vs MarkL's suggestion that patients should leave because of pricing once they know what the next room is, not after treatment. To be honest I think what MarkL is saying makes a lot more sense.\n. The prompt is: \"A patient left without paying for X because it's too expensive.\" I suppose that could go either way but it does imply they received service and refused to pay.\n. @MarkL1961 you mean to say as soon as they leave a room they refuse to pay for the next room. E.g like you said above, as soon as they leave the reception desk they might go home because GP is too expensive?\n. Alright, thanks @MarkL1961 \nI'll take some time to look at how substantial the modifications will need to be to implement it that way. My feeling is that it will be fairly simple to implement.\ngoHome('over_priced') gets simplified because the patient would never be in a cured state when that happened. Likewise treatDisease()/treated() is simplified because the patient won't refuse to pay at that step. room.lua / gp.lua / reception_desk will be complicated slightly where the next room is set, and patient will need a getNextTreatementDiseaseId() or similar.\nLocking the price from the time they leave the last room is something I'm more reluctant to do - It's such an edge case that I don't think it's worth preserving state for. All that means is that a micromanaging player early on could lower the price so the patient accepts it and then quickly raise it before they have to pay - the patient will still be unhappy (and it will harm reputation) about it but won't refuse to pay. I think that's acceptable - later in the game it wouldn't be a viable strategy anyway.\nThoughts?\n. @MarkL1961 One more question I'm hoping you might know the answer to as our resident Theme Hospital expert. Does a patient leaving do to over_priced affect the reputation of the patients disease, the specific diagnosis that's over priced, or just the overall hospital?\nThe way it's implemented in this patch at the moment, it's the patient's disease (when they go home because of it, and the overall hospital when they pay for it).\n. I've run into an issue with switching to the way the original does it. @benckx based a lot of (half the weight) of the expected price on the quality of the staff working in the treatment room. Now we won't know which staff will treat the patient at the point we have to decide on whether the price is appropriate.\nI plan to use the patient happiness as part of the calculation instead and possibly and weight more towards disease reputation. Any thoughts? Particularly from @benckx as I know you did quite a bit of analysis on the old calculation.\n. @Lego3 the price doesn't depend on the staff, the impact of the price on the patient does, but I've had to remove that anyway.\nOn my local system it is now a factor of the patient's happiness, the drug effectiveness, and the reputation of the treatment (which appears tied to the reputation of the hospital), where I've made drug reputation the most important factor.\nbenckx had:\n50% staff quality\n40% drug reputation\n10% drug effectiveness\nI currently have:\n50% drug reputation\n30% drug effectiveness \n20% patient happiness\nThose ratios are open to adjustment - when I'm done other changes we can work with them. The problem with valuing happiness higher is that it's too prone to extremes (even starting at 100%) and we want values that tend to the center by default. I'm leaning to reducing it to 10% and pushing drug reputation higher, like 70%.\n. Ok, I've pushed the changes I've made for the new behavior. I haven't yet merged them back into the earlier commits yet. If anyone wants to try it out go ahead.\n. I undid the change that caused treatment to only be payed for on success. I'm fairly confident they are meant to pay, then leave the room and die.\nI also fixed what I think was a bug where the cure was no longer added to the transaction log.\n. I've also significantly reduced the noise this added to the adviser.\n. @Lego3 would you mind to review this. The rest of the active contributors have code in here.\n. We use to set nil for the hospital for all patients that were no longer active. This patch eliminates that entirely. despawn does not set nil either.\n. Made the changes pointed out by @Lego3 \n. Rebased on the latest master to fix build checks.\n. Changed to account for AllocDelay and remove nil hospital check from goHome.\n. In this case I've just done the rebase.\nRequiring the pr to be up to date with the latest master is new, I haven't completely sorted out how I feel about it yet. I've gone both ways on it.\n. Did the original game implement this? I don't recall the extinguisher having any effect on machine strength.\n. I think it would be good to implement, though we should have a consensus on what the desired behavior should be before you spend time coding it.\nThe first thing to do would be to study machine breakdown in the original game, if it has any effect there then that would be an ideal template.\nI don't think it's viable that a fire extinguisher make the base strength of the machine higher. If there's nothing in the original game to copy, then I like the idea of a small increase in the chance that the machine doesn't explode for each use past the critical threshold.\n. stricmp is not standard and should be replaced. It seems that for whatever reason _MSC_VER is defined in your setup. It should not be if you are not using Microsoft's compiler, you can check your list of defines and remove it if it's in there.\nThe rest of the errors are freetype related. You will need to tell us what freetype version you're using, and maybe provide a dump of your cmake output. See the travis-ci script for how to enable verbose debugging from cmake.\n. It is possible that compiling without freetype is broken, I haven't tried that path.\n. We will replace all stricmp / strcasecmp instances because we don't like to use non-standard C / C++ functions in this project. In the mean time I suggest using one of the supported compiler / operating system combinations until someone with more experience with mingw can solve the issues.\n. @Alberth289346 said he would do it on irc earlier. The ones in sdl_core don't need to be strcasecmp, they can be regular strcmp or string.compare because those strings are always lowercase and fixed in lua code.\nThe one in sound probably has to stay, unless we know that the archives always have the same names and we fixed them in lua.\n. @Tsbook could you add a newline to the last line of the file?\n. :+1: Thanks.\n. You could update the wiki :)\n. @LiamDawe doxygen shouldn't be required to compile unless you want to make docs. What was the error you got when you tried to compile without it?\n. free_loos is a very misleading name for what this is. That's out of scope though and this commit looks fine.\n. The save game version on this now needs to be bumped. Best to rebase on latest master at the same time.\n. Bump savegame version should be merged into 95a9397\n. Everyone can make a pull request, so I'm not sure what's happening with your situation.\n. Looking at your public repository Grimdoc/CorsixTH the last thing I see is a patch-3 branch with prompt changes for 0.50.\n. The changes in your diff have been in master for quite awhile: https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Src/th_movie.h#L50\n. Since this commit: https://github.com/CorsixTH/CorsixTH/commit/9260930bd1e4721736859bee9c86aa70ecd3ddba\n. The output of sum() is in the 3 print lines around line 285. Without anything specifying that sum() should only be used for ints, I would move the floors down there.\n. Is the RequiredResources.txt change related to this?\n. Alright, could you move it to a separate commit.\ngit reset HEAD^\ngit add  CorsixTH/CMakeLists.txt\ngit commit --amend\ngit add  CorsixTH/RequiredResources.txt\ngit commit\ngit push -f\n. We haven't implemented the AI hospitals yet which is why you see the population pie chart in one case but not the other.\nLets focus this issue on the position and color of the legend in the graph.\n. Could you rename the Build Status lines to Travis Build Status and AppVeyor Build Status. This is what I see in other projects.\n. I don't think we'd need to address this if #451 was fixed.\nClosing as a duplicate.\n. I think the newly added walk action should have setIsLeaving(true), then the original check would have worked.. Wow, plot thickens. Ok, I'll investigate later this weekend.. Lets clarify that second commit message. You can make a top line header, then an empty line, then a longer description: something like:\n```\nDo not place walls in unowned plots\nWhen a room is built next to an exterior wall, windows are converted to normal walls to\navoid strange looking graphics. Windows are two tiles wide, but in the case of the border\nwith an unowned plot their may only be half a window. Fixed by not replacing non-wall tiles.\n``\n. I think it's good as is. RDY?\n. @Lego3 no :)\n. No, I've just been crazy busy and haven't had time to test it.\n. Maybe make your second commit a make target (like docs) instead of a cmake flag? Or would that not work?\n. I meantADD_CUSTOM_TARGET, or better yetINSTALand then after buildingmake fooormake install`.\nAll of the rsync steps should be in the install target. \nI believe INSTALL can already do most of the dylib  changes for you too.\nFor xcode I have seen it run as xcodebuild --target install\n. Ok, I'm fine with this, or maybe just a redistributable target, as includeDylibs is a bit wordy and specific.\nEdit: Nevermind, it's fine.\n. If lfs.so doesn't exist in your lua path there is no way CorsixTH would work, so it must be somewhere on your system.\nActually I was thinking about it, and those lua so files may have been what was giving the bad instruction errors.\n. Sorry @tobylane I didn't realise that you had updated this. It needs a CMAKE flag I think - we don't want to unconditionally brew install anything. I'll review it closer soon.. Anything left, or are you RDY?\n. Looks valid, any particular reason you prefer named local functions to lambdas in the method call?\n. Ok, lets hold this commit for the PR with the rest of that action API.\n. This PR can't be cleanly merged now. Could you rebase it on the latest master.\n. Humanoid.lua walkTo function. The must_happen logic is convoluted for a bool. \n. Crash:\nRunning: The buttonup handler.\nA stack trace is included below, and the handler has been disconnected.\n...H\\Debug\\..\\..\\..\\CorsixTH\\Lua\\objects\\reception_desk.lua:228: attempt to call a nil value (global 'StaffReception')\nstack traceback:\n        ...H\\Debug\\..\\..\\..\\CorsixTH\\Lua\\objects\\reception_desk.lua:228: in method 'occupy'\n        ...H\\Debug\\..\\..\\..\\CorsixTH\\Lua\\objects\\reception_desk.lua:169: in method 'checkForNearbyStaff'\n        ...H\\Debug\\..\\..\\..\\CorsixTH\\Lua\\objects\\reception_desk.lua:187: in method 'setTile'\n        ...CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\entities\\object.lua:60: in method 'Object'\n        ...H\\Debug\\..\\..\\..\\CorsixTH\\Lua\\objects\\reception_desk.lua:77: in local 'constructor'\n        ...s2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\class.lua:76: in field '?'\n        ...s2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\world.lua:1940: in method 'newObject'\n        ...TH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\dialogs\\place_objects.lua:514: in method 'placeObject'\n        ...TH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\dialogs\\place_objects.lua:472: in method 'onMouseUp'\n        ...2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\window.lua:1462: in field 'onMouseUp'\n        ...d-vs2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\ui.lua:649: in function <...d-vs2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\ui.lua:636>\n        (...tail calls...)\n        ...-vs2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:904: in function <...-vs2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:899>\n. The problem line should be StaffReceptionAction instead.\n. Another crash\nA stack trace is included below, and the handler has been disconnected.\n...ug\\..\\..\\..\\CorsixTH\\Lua\\humanoid_actions\\knock_door.lua:58: attempt to index a nil value (local 'door')\nstack traceback:\n        ...ug\\..\\..\\..\\CorsixTH\\Lua\\humanoid_actions\\knock_door.lua:58: in field '?'\n        ...rsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\entities\\humanoid.lua:576: in upvalue 'Humanoid_startAction'\n        ...rsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\entities\\humanoid.lua:652: in method 'queueAction'\n        ...TH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:306: in function <...TH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:254>\n        (...tail calls...)\n        ...TH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:232: in local 'timer_function'\n        ...2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\entity.lua:219: in method 'tick'\n        ...s2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\world.lua:1075: in method 'onTick'\n        ...-vs2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:1003: in function <...-vs2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:1000>\n        (...tail calls...)\n        ...-vs2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:904: in function <...-vs2015-x64\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:899>\n. For the above, KnockDoorAction should set self.door = door, not self.knock_door = door.\n. What was the logic used to decide if a parameter should be in the constructor or set via a setter?\n. There is a regression in this patch series, people no longer die when they reach 0 health (play chapter 1 with no nurse in the pharmacy). There are no errors in the console.\n. Why does GetUpAction have self.must_happen =true.\nI don't see that in the old code for get_up\n. A PR doesn't need to be opened to be referenced, link from top of #1107 will work.\n. Very pretty!\n. The large bin radius might make it too easy to avoid litter. I agree it makes sense to have bins in the hall, and it makes sense for patients not to litter if they encounter a bin, but we may have to nerf this a bit.\nAnyone have a feeling on whether to play test this first, or merge it and see what the players think?\n. Just as an update I'm taking your suggestion to postpone this until post 0.60.\n. 924fbaa3c6d3bc82c2b56ab0d542d29b10f67de4 is dubious. A function to remove from a table by value could be useful in utils, repeating the code doesn't seem better to me.\n. 3a7f11f61fa4b2b6c85f65a058b5f3f17a6e00c6 is another one I question the value of. Patient may not be the right place for it, but room is worse imho.\n. With the exception for the two commits I've commented I'm very happy with the direction of this patch.\n. The PR looks good (except my one comment, above).\nI have strong reservations about putting a setting like this into the config file though. It means if we ever decide to do a balance pass later everyone with an old install will still have their old values. I also don't see the need for a grace period when there is more than enough money and time to put the game on the slowest setting and build a fine starting hospital including radiators before any patients arrive.\n. Working in master is causing you serious problems.\ngit fetch upstream\ngit checkout upstream/master\ngit branch norwegian-060\ngit cherrypick 59eac8a\ngit checkout master\ngit reset --hard upstream/master\nIf the first line complains that you don't have a remote called upstream:\ngit remote add upstream https://github.com/CorsixTH/CorsixTH.git\nThen make a pull request of norwegian-060.\n. Just a couple extra things to help classify the issue before we investigate:\nThis is a custom build, which version of SDL2 were you using (or if you were using CorsixTH/deps, which commit).\nDoes the same problem happen in the 0.50 release?\n. Alright, quite a few things changed there but I think the most likely suspect is the bump from SDL 2.0.3 to 2.0.4.\n. I believe what we are seeing is this upstream issue: https://bugzilla.libsdl.org/show_bug.cgi?id=3147\n. If https://bugzilla-attachments.libsdl.org/attachment.cgi?id=2364&action=diff&format=raw&headers=1 fixes the issue I'll apply that patch on deps.\n. I have confirmed that the above patch fixes the issue. I have included this patch in CorsixTH/deps so 0.60 and the AppVeyor builds should be good. We can leave this issue open as a tracking issue until the problem is fixed upstream.\n. @DavidFair \nThank you for the offer. I'll post here when there is a dep build that includes the patch from that issue.\n. Should be fixed in the deps now. You should only need to replace the dll in your already compiled CorsixTH.\n. For clarity I simply applied that changeset to SDL2-2.0.4, I wanted to avoid introducing any other potentially unstable changes that may have accumulated in their hg.\n. @Alberth289346 you are certainly the most prolific contributor not named. I don't see anywhere where you've used your full name. Your date range would be 2013-2016.\n. I need to extend this list with the names of people who have copyrights in individual files. Some significant contributors never directly committed anything while we were on SVN.\n. I've updated LICENCE.txt, I believe it now contains the name of everyone that ever claimed copyright in CorsixTH, as well as some other contributors who did not claim copyright in any files.\n. Thanks @Lego3 I fixed that and made the file encoding consistently utf-8. It had been using latin-1 which may not work for some names.\n. This was left off with @voodoo070 saying he would get saves. Is that still something you're working on?\n. Looks to be fixed now, probably by #1034 \n. Sorry, I misunderstood the issue. Will continue to investigate.\n. This has been fixed in master.\n. Perhaps you could clean up the setHospital overrides that this replaces at the same time. The patient one in particular still conditionally checks for the nil hospital case. The staff one can be simplified because it would only be called when adding the staff to the hospital, transferring staff is not an option in Theme Hospital.\n. I remember litter bombs, auctions on the town map, and emergencies cycling between the hospitals when they were refused. I think the hiring list might have been shared but I don't recall any way to actually poach / hire staff off another hospital. It has been a couple years since I've played multiplayer though, and I've only played a handful of games.\n. Thanks for pointing that out, I'll have to test it. I think it should be relatively easy to add setHospital for staff that does the appropriate thing when the time comes (compared to some of the other challenges in implementing multiplayer).\n. I believe this is because tobylane compiled for his system instead of targeting a lower common denominator. @tobylane look at http://stackoverflow.com/questions/19397973/what-is-exc-bad-instruction-sigill-why-is-it-caused and see if it helps.\n. Well SSE 4.2 would exclude a lot of CPUs. On Linux you would be looking at the -march option.\n. Is he on a core 2 or an original core? Might be safer just to target i586.\nI'm not sure how you ensure all brew libraries are the same.\n. Never mind I see OSX 10.6 required core 2 duo so we don't support older processors anyway. Just a matter of ensuring brew and corsixth use the same and not using newer vector instructions than SSE4. \n. No longer relevant to 0.62.. :+1: from sight inspection of all the averages changes.\n. Does CorsixTH not work with the version of LibAV in jessie? I wrote LibAV support in for Ubuntu some time ago, though admittedly it's not as well tested as the ffmpeg path.\n. We do not plan to offer linux builds. I will link to downstream packages on the releases page for the next version as I'm notified of their existence.\nI think the other issue in this ticket about Debian dependencies was resolved?. Curious, I'm aware of the deprecation, but it built fine with ffmpeg 3.0 for me. There are several functions relating to packets that are deprecated as the memory model was changed so that instead of owning buffers packets share buffers and reference count them.\nhttps://github.com/FFmpeg/FFmpeg/blob/bb9f7bf1a21d6e00dcb2afaf94d8f84e410cf89c/doc/APIchanges#L68\nI would have made the change already but I haven't yet verified if our use of av_dup_packet is a noop or needs to be av_packet_ref.\n. The commit referenced above was part of 0.50.\nhttps://github.com/CorsixTH/CorsixTH/commit/9260930bd1e4721736859bee9c86aa70ecd3ddba is probably the one you needed; https://github.com/CorsixTH/CorsixTH/commit/4ae56e100911c1763cb9fd9a4b8647e323ecc032 is also a required patch (or else movies will segfault on newer ffmpeg); and https://github.com/CorsixTH/CorsixTH/commit/5e1ea3ae88e7f807dd1f51cfc05e9ad7958895ff is required for AMD users.\nI think you could apply git diff v0.50..v0.60-beta2 -- CorsixTH/Src/th_movie.* as a quick patch in isolation from the rest of 0.60 if you needed something.\n. If you don't mind I'd like to leave this open to cover the av_*_packet deprecation.\n. All deprecation warnings have been resolved for 0.60. Do you guys have any other reason to keep this open (e.g. for 0.50)?\n. Taking a quick look at your map it looks like you didn't assign parcel numbers to your interior. Everywhere you own initially must be \"Parcel 1\"\n. What map editor are you using? Your issue says 0.50 but that version has no map editor. The MapEdit program from 0.40 is discontinued. I tried editing your map in the map editor from 0.60-beta2 and it works fine:\nhttps://www.dropbox.com/s/cq7xt56bh2tsw7m/Test002.map?dl=0 (I only bothered fixing the floor by the entrance).\nIt's worth noting that the new 0.60 map editor places flags based on the tile type (e.g. inside / outside / wall), and does not detect / care what is an enclosed space.\n. @voodoo-burger I drew a relatively small area of inside tile on your huge map near the door and I am able to build on the portion that I drew: https://www.dropbox.com/s/ezmt0kjuwu6x4dk/Huge%20Map.map?dl=0\nClearly I'm missing something in my testing, so as mentioned in the other issue, I'd like to know exactly what steps you took to make the map (in order)\n. Not anymore, we base the flags just on the tile type now rather than trying to determine enclosed areas. It should be much simpler and more foolproof, but based on these bug reports there is something we didn't account for.\n. I have confirmed, a floor built on a tile that has never had a parcel does not get flagged buildable even after the parcel is added. Oddly it seems that setting the parcel back to 0 and resetting the tile to grass does not reproduce.\n. @MarkL1961 both folders are used for both, you can store your .level files and .map files in either folder. The one in Roaming\\CorsixTH\\Levels overrides the other one. This is by design because users don't necessarily have write access to where CorsixTH is installed, especially on Linux.\n. I'd like to keep this bug on topic though. It's clear that placing an inside floor tile before placing the parcel causes a problem with the 0.60 map editor.\n. Oh, I didn't see where you said you built inside tiles before parcels and could build on it (on a new section of map). I was able to reproduce with the instructions provided by @voodoo-burger\nBeside the road I made two sets of tiles, one with parcel added then tiles, and the other with tiles then parcel and I could only build on the one with parcel then tiles. However anywhere that was buildable I could clear and make buildable again in any order.\nhttps://www.dropbox.com/s/qx3ov2fq86tsmmb/Huge%20Map2.map?dl=0\n. So far I can't see in code how parcels would be a difference either - but I did produce it. This will take some digging.\nThanks for your efforts @MarkL1961 \n. All 'inside' tiles (on the inside tab) are given the flags buildable, passable, and hospital. The game uses the combination of those flags and parcel id to determine if you can build on the tile.\nAll 'road' tiles and some of the 'outside' tiles are given the flag passable, but not hospital or buildable.\nIt looks like 'passable' is being preserved, but 'hospital' is being lost. 'builadble' isn't actually shown so we don't know the state of that flag.\n. Yep, I've done this myself for testing. Just edit Lua/dialogs/menu.lua: copy the lines starting from https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/dialogs/menu.lua#L755 to just before https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/dialogs/menu.lua#L543\nThe bytes overlays do not work because they grab information directly from the map file, not live, but flags and heat overlays do work.\nI had plans for introducing the flags overlay as part of another editor mode but didn't get around to them.\n. Ok, what I see is that this only happens when you draw the tiles, save, load, and draw the parcel. And what's better is that I do see the issue in the code as well. When loading a map we only mark the hospital and buildable flags for parcels.\nThe safest fix would be to add a parameter that is set when loading in the map editor which causes it to always set all flags as set on the map. That said I don't know that there is any harm in always setting them regardless - I will run some tests removing the condition altogether.\nEdit:\nhttps://github.com/CorsixTH/CorsixTH/blob/adc15852/CorsixTH/Src/th_map.cpp#L441 is the problematic line.\n. @Lego3 not a bad idea but out of scope for this issue. My main concern is that without fixing this people that use a Linux distribution package will not be able to save their maps. That is probably a 0.60 blocker.\n. The sentence still feels wrong to me, with or without the comma. Perhaps it should be split?\n. Thank you\n. Where are they reported as dead?\n. Alright, I've reopened #1032 Thanks.\n. Agreed.\n. I didn't reproduce the crash with the slack tongue on the latest master, but as mentioned that's not the issue here. The GP room is already broken at the start of the save.\n. A couple questions: did you notice this bug before you saved, or only after loading the save? Was there anything else in the original game log? And do you have an earlier save from when the GP still worked that eventually reproduces this?\n. Duplicate of #76 \n. Would someone mind to check this and merge or let me know of any changes I need to make before Sunday?\n. Sounds reasonable to me. At this point it's too late to land in 0.60, but I suspect it could be fairly easily implemented for the next version.\n. It could be. Is there any precedent for this feature?\n. I did a quick google search and find a lot of people on both sides of the issue for numerous mainstream games. An option seems like the best way to please everyone.\n. My opinion is that such a heuristic complicates the matter and still runs the risk of not pleasing everyone.\n. And how do we know if the window is occluded (partially or fully)? What happens when the user moves the window covering the game window without focusing on the game? How can we tell?\nIf you know how to do these things, volunteer to write the patch. If you don't, please avoid insinuating that it's simple.\n. @sherief Sorry, I had Real Life (tm) reasons for being more tense than usual yesterday. If I end up being the one to implement this feature I'll play with all options that can be accomplished with SDL window events. I would definitely include a toggle in the config as well because no behavior is going to please everyone. I'm sure some people would also want the game to auto pause and others would not.\n. This will land after 0.60 since we're in feature freeze right now. Good work!\n. If we are deciding something (rather than the author writing something) lets make this RFC. Otherwise no action is going to happen.\n. An afterload here is non-trivial, I'm in favour of merging as is.\n. Not only that, but any new staff dialog would have the new feature because it's newly constructed, so it would just be for open windows. (Comment based on reading source, not testing)\n. Verified, works in saves.\n. These functions weren't added to libav until very recently: https://git.libav.org/?p=libav.git;a=blob;f=doc/APIchanges;h=c3b81faf36d13448896e4eb21820f2de50ecad58;hb=HEAD#l192\nI've updated the code to reflect that.\n. @sgtbigman could you squash these commits?\n. Duplicate of #1050 \n. There's no plan to change this from the original Theme Hospital. Is there anything different about the original Theme Hospital's handling of this room that made it more useful in your opinion?\n. Sorry, it's going to stay that way. No strategy if every room is a cash cow.\n. Hiring less skilled / less attentive doctors will also cause it to be used more.\n. It is broken, you need to use a newer commit from luasocket (they don't have a working release version).\nI included a working version in CorsixTH\\deps\n. I agree with @Alberth289346 the crash is definitely triggered when the patient enters the door of the psych room (the doctor has been at the book shelf in all my trials). Confirmed that the crash happens regardless of the screen position.\nI didn't discover any useful information about which value is nil or why yet.\n. It's the patient that's crashing. For some reason action does not have an x or a y, in fact the only property it has is name=\"walk\".\n. Here is the stack trace where the bad action gets added to the action queue.\n...rsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\entities\\humanoid.lua:737: in method 'walkTo'\n        ...015\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\rooms\\psych.lua:87: in method 'commandEnteringPatient'\n        ...s_x64_2015\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\room.lua:400: in method  'onHumanoidEnter'\n        ...TH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:356: in field 'on_next_tile_set'\n        ...TH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function <...TH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:137>\n        (...tail calls...)\n        ...x64_2015\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\entity.lua:219: in method 'tick'\n        ..._x64_2015\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\world.lua:1059: in method 'onTick'\n        ...ps_x64_2015\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:1000: in function <...ps_x64_2015\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:997>\n        (...tail calls...)\n        ...ps_x64_2015\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:901: in function <...ps_x64_2015\\CorsixTH\\Debug\\..\\..\\..\\CorsixTH\\Lua\\app.lua:896>\n. It's because findObjectNear(patient, \"couch\") is returning nil. Moving the couch prevents the crash. I think this is a path finding bug because the couch doesn't look blocked (the radiator shouldn't prevent access)\n. Curious, I didn't get the crash when I moved the couch to the middle, as I mentioned above. I will be putting an assert in walkTo for the next version so that we can see where these errors are coming from without all the debugging I've been doing.\n. Ok, so the issue isn't with the pathfinder, the problem is that the tile with the radiator is marked as not passable. It should be passable with can_travel_e = false;\n. I made myself a debug overlay so I could see when the passable flag gets turned on / off, and it appears to be a problem with the couch itself. The tile in front of the top of the couch gets set to not passable when the couch is placed.\n. Doing more testing, I see it's suppose to not be passable. The THOB for the couch is actually suppose to be in front of the top of the couch. When you put the radiator on the tile and save the game the couch THOB gets lost when you load the game again - so it's actually only possible to reproduce this bug by setting it up, saving, then loading the save.\n. @Alberth289346 the problem as I said only happens when you load the map after it's saved. When it sets the cell flags it makes a two element list, but after load only the radiator is in that cell. I have confirmed this:\n- make psych room with couch facing to the south\n- add a radiator in front of the couch on the east side (where the couch thob is)\n- dumping the object list for that node from c++ => {18, 44}\n- save\n- exit\n- load\n- dump the object list again for the same node. => {44}\nThe question is - what happened to the couch?\n. Thanks @TheMatia \nAs a newly introduced bug I have assigned a 0.60 milestone target in spite of the low severity (not game breaking).\n. @JoshKeegan are you available to look at this?\n. Alright, I'd like it fixed sooner than that so I'll take a look first.\nAs for the release:\nThe first release candidate that's available for two weeks with no blocking bugs will become 0.60. Release candidates will be released either weekly or every other week as demand dictates. Only regressions over 0.50 are blocking bugs, but other severe game breaking bugs (e.g. anything that crashes) can also be fixed during this period.\n. Thanks!\n. Duplicate of #508 \n. RAM is allocated by your operating system on an as needed basis, why do you want to allocate more RAM to CorsixTH?\n. How do you normally allocate programs more resources?\n. You won't find one, this is typically a feature of languages like Java that run in a garbage collected VM. Increasing the heap size in those languages means the garbage collector can run less aggressively and sets a maximum memory limit for the program to use. CorsixTH requests memory on demand and has no limit.\n. How reproducible is this?\n. Ok, hopefully it happens in VS where you can see it. Otherwise it probably wrote a dump file somewhere for sending to Microsoft, but I'm not sure where you'd find it.\n. IIRC an ntdll.dll fault represents anything that happens in kernel space, so it could be a driver or anything. It is definitely outside of CorsixTH though.\n. Alberth is running an AMD HD7000, which might be important to the issue. We couldn't reproduce it in ArchLinux but that was on nvidia. It would be good if everyone posted their video card and what drivers they're using as well.\n. The other thing we determined is that it only happened when the scale was changed more than twice in a frame - which is more confusing than enlightening.\n. Thanks @mpmc, so that's another vote for something affecting AMD devices. My understanding is that this isn't a CorsixTH regression (the same behavior happens in 0.50 when compiled against SDL 2.0.4)?\n. Also it would be very helpful if someone with the affected hardware could do a bisect on sdl2, and then report the bug upstream.\n. Yes definitely sounds like a regression in the video driver now. Tricky.\n. Looks good, one minor nit pick and then it should be ready to merge.\n. Looks quite a bit better, thanks @Alberth289346 \n. Duplicate of #68 \nSince it happens with new rooms as well we might be able to sort it out from the given save.\n. I marked it as a duplicate because they were both about being stuck in the operating theater. Something triggered #68 that isn't included in the description of the issue, but we don't know what it is. Anyway I agree that the trigger is likely different, and in this case the doctors can't be removed even by force - though in another issue I found that in the case of the GP office I was able to easily get from a save where the dr was stuck but could be dragged out to a state where the dr. was completely stuck.\n. @viktorcech you do not have this issue, your issue is probably a duplicate of #68 and probably caused by the issue identified in #1087 \n. @Grimdoc I think @SimplyRyan is working on something easier for you. For now just install the latest release candidate, make your changes, and attach it to an issue with dropbox or copy it in surrounded by ``` tags.\nSee us on irc about cleaning up your repository, and never make a pull request from master.\n. I don't want this to devolve into git vs svn, or github vs googlecode; lets work on solutions instead.\nClearly pull requests are complicated for casual users, and possibly made even more so by github's public user repositories. I assume that creating patch files is not any easier for casual users.\nMy suggestion is that people create a regular issue (not a pull request). In that issue they should say the commit hash or release version of CorsixTH that they started from and paste the entire contents of the changed file. That way one of the regular contributors can turn it into a pr and that person can manage the patch if anyone else has corrections.\nIs there any problem with this?\nEdit:\nUnder this model, these contributors should not fork or clone CorsixTH on github. They should be using the files from a release or an appveyor or travis build (or by downloading the raw file off github). The appveyor builds to use are the ones with just a number.\n. Use tags in your title to indicate the state:\n[WIP] - I'm still working on this\n[RFC] - Please review / comment, but don't merge. I want some feedback.\n[RDY] - Review and merge please.\n. I mean as you go :)\n. No update in over a year. If there is no update in 2 weeks I will close this PR.. I don't speak Italian, but it looks good other than a handful of tab vs space issues.\n. Are you ok with amending the commit, or would you like help with this?\n. mm... if you can use the command line (git bash) you can still fix it:\ngit rebase -i HEAD~2\nin the text file that opens change the last line where it says \"pick\" to \"f\"\nsave/close the text editor\npush -f when done\nIf you'd rather not, I can submit on your behalf.\n.  Ah... because you did it online the changes weren't in your local repository.\ngit is a powerful but tricky tool to use, so certainly don't feel you need to master it unless you want to become a coder. We are ok with translations being pasted in a github issue or even submitted to the google group instead.\nIn the future when using git, do not do any work in the master branch - make a new branch for each pull request. It will save problems down the road.\nYou were right to be weary of a force push when things didn't look right. Ultimately we will have to do one but we need everything to look good first.\ngit reset --hard master\ngit pull\ngit rebase -i HEAD~2\nthere should be both of your commits listed in the text file here, change the second one's \"pick\" to \"f\", save and close\nfollow rebase instructions\nAssuming everything looks good: git push -f\n. Duplicate of #1044. I guess that confirms that this does happen in 0.60, but it does not happen when I make maps. Can you explain how you created the map in that issue (perhaps it's the order things were done that matters)?\n. All these stuck room issues are very tricky. Thanks for the report.\n. Before this is merged, we should discuss whether it is worth making a 0.61 patch release for.\nThe workaround in the mean time is to redraw the inside tiles after loading the map if you had not placed a parcel on it before saving; alternately always place parcels before saving.\n. We can see if anything else significant comes up in the next couple weeks. If this is going to be for 0.70 I will do the proper fix (checking for owner everywhere buildable is checked) instead.\n. Only preserving this in case we want to make a patch and #1086 is too complex.\n. Duplicate of #221 \n. I've noticed this too. It definitely makes the map editor frustrating to use.\n. My profiling has shown that the slow down is caused by the canvas:scale() lines in UIMapEditor:fillCursorArea. It appears that the method we are using to draw scaled is too inefficient.\n. You may find setting the music volume to around 0.05 or so more to your liking. The lowest recognized value is 0.0128 (which can be written as 0.01) not 0.1. We pass these values directly to SDL_Mixer, which I understand uses a linear scale for volume rather than an exponential one to account for our logarithmic perception of volume, which is to say the difference between 0.01 and 0.1 will sound a whole lot more significant than the difference between 0.1 and 0.2 (or 0.5).\n. That is the full range of control we have over the volume I'm afraid. You're probably running into an issue like: http://stackoverflow.com/questions/5864603/sdl-mixer-midi-volume-issues-on-windows-vista-7\nMIDI support on modern computers is bad. The ideal solution is to get an ogg / mp3 recording of the music (from one of the good midi cards of the past like a roland sc-55) and play with them instead. Unfortunately we can't provide those tracks. Alternatively in the forums there some fan created sound tracks that are similar in feel but not copies of the original music.\n. @botcherO That's a really great tool. I tried it out and the MIDI sounds so much nicer. Would you mind adding the suggestion to the wiki?\n. I need to bump the api version. That's not related to MarkL's problems though, the app veyor version runs for me. Unlike the release version it's only 64bit. The run time required is VS 2015, but that's for the release version as well.\n. I believe the problem is that AppVeyor is making debug builds, which depend on the debug runtime, which is not independent of Visual Studio and not redistributable. I'll correct AppVeyor to make release builds.\n. Alright, I've rebased on the appveyor changes, and bumped the api version. I neglected to test anything related to staff so there may be issues there.\n. @MarkL1961 not sure what your plans are, but you should be able to test this now.\n. This PR is about not being able to build on other players hospitals (or any tile with the build flag which is not in a parcel owned by the current player). I tested placing objects and building / editing rooms myself somewhat. I didn't deal with placing staff, but it occurs to me that you should only be able to place staff on tiles you own too. So generally things relating to land ownership.\nEdit: It's also about being able to save a map without parcel information, then loading it and drawing the parcel and having it still work.\n. Making a multiplayer map won't work because the game doesn't support it. What I did was made a hospital that wasn't part of any parcel. The current map editor gives it the build flag, but it's not owned by the player and it's not removed by the parcel purchase stuff.\n. I've now also updated the PR to include properly assigning the parcels to other players on multiplayer maps, so your original method would work. Additionally I've rebased so you can have the map editor performance improvements.\n. You're misunderstanding slightly.\nPlayer 1 owns all parcel 1s at the start, Player 2 owns all parcel 2s from the start, Player 3 owns 3s, and 4 owns 4s. Plots above the set player count are not owned from the start. You should be able to build on all the parcel 1 hospitals, but not the parcel 2 ones.\nEdit: \nTo clarify the camera position does not in any way affect ownership - though it's only reasonable for a map maker to put the correct players camera over the correct parcel.\n. The 9 parcel restriction comes from the original game. We can see about easing it at some point perhaps though my feeling is that the 128x128 grid would feel tight after that.\nThe original multiplayer capitalized on the scarcity, e.g. one of the objectives was to buy a plot of land, and you could force your components out of the game by outbidding them on the properties. The games also tended to be short and frantic because of these escalating objectives.\n. @MarkL1961 sorry, I thought it said that in Alexander's map details, but it doesn't, it actually says that there are two bytes assigned for parcels, which is enough for more parcels than there are map tiles, so I don't know why such a high number is supported. I guess the 9 is just from the old map editor? So yes, we'll extend that at some point, please open another ticket.\n. I've just tested the staff issues you mentioned in the original theme hospital (playing an IPX game against myself). In the original you could not place staff in other player's hospitals.\nI didn't see patients wander in other player's hospitals, but the map wasn't set up that they had any reason to either - maybe there's a map where I could quickly set up such a situation?\nIn the mean time I will change my PR to prevent placing staff outside of owned plots.\n. I've added restrictions on where you can place staff, and enforce patients to wait for a reception desk in their own hospital, as well as epidemic injections in their own hospital (indirectly). There are probably a lot more actions that would need to be filtered, once multiplayer is seriously implemented but I've probably caught the most obvious.\nI will be cleaning this up and looking for any more obvious places to check the hospital owner then move it back to RFC. Feel free to test as is, but it's not ready to review the code yet.\n. I don't think there's any regressions now. Implementing multiplayer may show some need for improvement but that can be addressed then.\n. Fixed indentation issues.\n. Excellent sleuthing!\nAre you going to open a PR?\n. Thanks for the update. I guess it didn't hit any of the new (since 0.60) action queue checks then. Too bad.. @MarkL1961 this artifact looks better to me, can you confirm you can run it? If you can, then after this is merged I'll rebase my other PR on these changes so you can run it too.\n. Yeah that would be great.\n. CorsixTH actually supports parcel numbers up to 65535, though I don't see even a far fetched point in going beyond 16384 (the number of tiles on the map) unless we eventually support larger maps as well. I guess it depends on the UI that we go with whether it makes sense to pick some low limit like 32 or just let map makers pick anything they want within the supported range.\n. The bug is probably in luasocket. Unfortunately without having a real release in years, and the last RC being buggy, it's tricky for everyone to be on the same page.\nCould you post what lua-socket you're using and/or a link to the package page for lua-socket for your flavor of Debian?\n. Also Debian?\n. I can't reproduce, but my feeling is that this is a lua socket (or packaging) issue. Can you see if the issue happens with git master of lua socket? Also compile with debugging symbols and frame pointers for a better back trace.\nDo not use the 3.0-rc1 version with no patches. It doesn't work.\n. I agree. Maybe let them know it happens in CorsixTH not just mpv \n. We know, Mark was suggesting a workaround in the mean time. We're aware of door reserve bugs.\n. Duplicate of #68 / #1087 then?\n. Thanks for joining the discussion Alan.\n@corsix himself should have known that malicious bytecode passed to loadstring_envcall could potentially escape its sandbox, he created examples himself.\nAs for what has changed - probably just a few more years of experience and the warning of a 3rd party who saw our bug posting on lua-socket and followed our code a bit.\n. I think @corsix's https://gist.github.com/corsix/6575486 is a proof of concept, at least for a particular lua version and operating system. There is a workaround in lua 5.2 and higher to disable bytecode being loaded (which we don't implement). Parsing is safer though. The old xml may have been overkill, but a delimited flat file is an option.\n. @Lego3 the version information is transmitted in plain text, so it's fairly trivial to intercept and replace with a payload of the attacker's choice.. Was there any output in your gamelog.txt?\n. Stack trace is consistent with what I was seeing. Cell flags were being fetched over and over.\n. Great find @mugmuggy \nFor both this issue, and your door PR it would be helpful to have a routine that recalculated expected cell flags, then we could repair saves and automate detection.. @mugmuggy Right about the bench thing. That is all that is blocking that PR, if you could bump the version and put an afterload there.\nFor this, I was speculating outside of the version condition and make it noisy, like:\nWARNING: Correcting corrupt map tile at [X,Y]. Flag xxxxxxxx is on, should be off.\nFor every such issue.\nIt should be clearly labeled in code as a hack, until we find the cause.. Duplicate of #1105. @Lego3 now that it's past the end of August do you have the resources to test on 32 bit? (Though that's increasingly unimportant now that XP is no longer supported)\n. @Lego3 I've been inclined for some time to go the other way and only ship the x86 installer. CorsixTH doesn't benefit from 64bit at all, and all amd64 (x86_64) systems are x86 compatible.\nI think we can merge this now and delay that decision. RDY?\n. You need the Microsoft Visual C 2015 redistributable. See the link at the top of https://github.com/CorsixTH/CorsixTH/releases/tag/v0.60\nA warning will be added to the installer. #1095 \n. While you're tweaking the order, the library order should be the same as the include order.\nKitware's module is better than ours: https://github.com/Kitware/CMake/blob/master/Modules/FindLua.cmake because it does more to ensure include and library versions match. (This is an issue on arch linux, and possibly others).\n. The reason we are not yet using the built in module is that it does not come with CMake 2.8.12 and that version is still important to support for TravisCI. I speculate it could be back ported but simply putting newest version first for now would be an improvement.\n. Yes the Campaign folder was meant to be included. Thank you for the report.\n. Related to #560 and #1114 \nThe current git master / next version will make it somewhat easier to trace this errors. As is it's almost impossible without a save game that can reproduce it.\n. I was just about to push exactly this change.\n. All the code still looks to be there for original campaign progression. I haven't tested but I don't see any obvious problem there. I suppose there is no harm in making it persist for other levels as well - is this what you mean @lewri \n. On a vaguely related note, debug should not disable these dialogs. If it's annoying for developers there should be another config option for it.\n. :+1: \nI remember you saying you don't do pull requests - maybe we can convince you to reconsider.\n. @mugmuggy you're saying this is a duplicate of #1094?. Link to mugmuggy's insight: https://github.com/CorsixTH/CorsixTH/issues/1094#issuecomment-337849879. Couldn't we use humanoid:setMood here instead of looping over the staff, since that is the humanoid that is leaving?\n. Disregard the previous, I wasn't thinking about patients leaving.\n. Verified by visual inspection up to ec0b4f025ee\nThe following commit uses enableTreatmentRoo is there justification for why you use enable here and set for others e.g. setMustHappen\n. Maybe setIsTreatmentRoom, taking an optional bool for consistency? The rest of that commit looks good.\n. For SpawnAction in d1ea6253af0efe8e620f2421d23973cd1f84b19c I think point is required but you include setPoint rather than putting it in the constructor. My understanding is that required fields go in the constructor (which would make it easier to add verification in the future).\n. Visually reviewed up to 2d4aceaf511c015 inclusive.\n. In 3ddeedee057 seek_reception.lua setMustHappen is set to true instead of action.must_happen\n. 684cc7e32 and 06e20d9de look ok to me in kdiff3\n. Right, I've seen other enable/disable flags now so that's alright. enableTreatmentRoom still sounds weird to me for a flag that advises that the target room is for treatment but I can live with it. The flag name predates this pr.\n. Commit message typo in 5eefb3d bood to blood.\n. 6ebf067 results in incorrect indentation for queuing sink action. Maybe fixed in later commit?\n. Visual review up to b7fbd264 exclusive. Have not gone back to changes yet.\n. b7fbd2643ac29f1d8f443ef42d73267a693b3eb9 changes the function signature for the loop_callback function to take the action as an argument instead of a closure. A quick grep of the code shows that some actions call loop_callback passing in the action and some do not.\nI'm not saying it's wrong, but it is suspicious.\n. In the use_object commit, calling setWateringPlant with no argument sets it to nil not true. It is called with no argument in plant.lua.\nMaybe should use enable style here?\nAdditionally lots of action properties were not converted to methods. Is than an oversight or justified?\n. Also use_object. In dna_fixer setProlongedUsage is called with no argument. Should be called with false\n. In ward.lua setProlongedUsage is called without argument for true, but the function is not defined that way.\n. For multi_use rewrite, again setProlongedUsage does not set to true with no argument. Called that way in place of true frequently. Not listing them here.\n. In cardiogram.lua loop_callback function name does not match in diff\n. Use_object and multi call setNoTruncate. Function is disableTruncate\n. With respect to the loop_callback argument above, it looks alright in this case. Two caveats are that in meander the loop_callback is called without providing the action, and in idle_spawn, the callback is copied from another action so the argument would be different than the closure. It doesn't look like either of those can come up as a result of a use_object action.\n. Sometimes a temporary is introduced to split lines and sometimes the next method in the chain is just placed indented on the next line. I prefer this method if we are not otherwise using the action variable. Can point them out inline if you like.\n. Further enhancements isn't a descriptive commit message, but it looks like it can be squashed into walk rewrite\n. Re-reviewed up to seek staffroom rewrite, all looks good so far.\n. Reviewed up to walk rewrite exclusive. Please do the suggested rebase before I continue. sha-1s won't change up to f0456ce037 and I can then only look at 'final' commits.\n. Typo in walk rewrite, scanner_room. diableTruncate \n. Reviewed all action rewrite commits. I need to go back and look at the split commits again.\n. All LGTM. Still going to test.\n. This looks right to me.\n. The lines around 245 in the build callback are for a different case. In that case we are waiting indirectly for a room (we can't go to room_type until room_type_needed is built). Once room_type_needed is built we continue with the original goal of going to room_type.\nIn this case we are waiting for room_type because we have not been diagnosed yet, but our diagnosis is over the guess threshold and there is none of room_type available so we don't wait for it to be built at all, we go to the treatment room instead.\nI haven't sorted out the remove callback yet.\n. Thanks\n. /me fails at copy and paste. Fixed.\n. Thanks Alberth\n. Thanks for the report. On the surface this looks like another error where the walk action is given a nil destination. I'm hopeful in the near future we will be able to capture these problems at their source which will make them easier to debug.\nIn the mean time I will investigate this issue.\n. Odd, I don't remember a CodeRewrite (refactor) label. :smiley: \n. Rathole is one word. This patch mixes RatHole and Rathole (and uses rat_hole)\n. Looks like a fine approach.\n. I found the message helpful to know the parameter, otherwise you just get the function and line number in the error message. The actual parameter restriction is unnecessary though, so maybe I'll just change them all to 'Invalid value for x!'\n. Travis failure appears to be due to a change in Busted, unrelated to this PR.\nI've updated the PR to change the assert message to Invalid value for parameter 'foo' everywhere.\nI also created a HumanoidAction:afterLoad function and update the actions to conform to the proper parameter types there instead of humanoid.lua\n. Looks like Busted was fixed.\n. I don't understand why litter would affect the buildable flag at all, it shouldn't get in the way of building. I think that's a historical accident that you can simplify right out. Still need to fix the existing ones for the save though.\n. I really like this patch set. Reviewed all of it. :+1:\n. Are you comfortable enough with git to squash those commits, or would you like us to do it?\n. No problem. We also accept translations pasted in or linked to issues since most translators are not experienced with git to make pull requests. (The fact that you made the translations on your master branch is going to cause problems for instance.)\n. Wonderful, thanks maki-chan. I don't personally have OSX but I will but out a call for testers.\n. I extracted they dmg and I didn't see the dylib files. Possible I just missed them. Can you verify?\n. @maki-chan Look at Tobylane's patches here: https://github.com/CorsixTH/CorsixTH/pull/1016 they may help with bundling the dylibs.\n. I don't see the library files for lfs, and mime/core and socket/core. I would have expected them to be either in the top level or under luarocks/lib/5.3?\n. When you built lpeg, lfs, and lua sockets you must have generated some sort of .so or .dylib file somewhere. Typically that's in luarocks/lib/5.3 if you are using luarocks. These modules are composed of C code - that code cannot be translated to pure lua.\nDo you have nothing in the above folder in your luarocks tree?\n. @tobylane did you miss luarocks/share? I don't see the lua files for the modules.\n. The lua socket ones are used for the upgrade check if available. It's possible the lpeg ones are not used but that shouldn't be relied on.\n. Excellent news, thanks @tomyun \nI'll edit the release page to mention both this ticket and the homebrew formula.\n. @jehoyes if the version you found is 0.50 or later, it would be worth pointing it out here.. Updated release note text. Thanks @gakera . Manually copying lfs.so and lpeg.so is fine as long as they were built with the same link options.\nHow did you get your other dependencies?. Should be good then. What OS version did you target?. It's not particularly simple, I wasn't able to come up with a workaround. It comes down to a couple lines in the CMakeLists.txt:\ndefinitely: https://github.com/CorsixTH/CorsixTH/blob/b8e9d7ff500f357b8e7a6562e4aaec22c48ee102/CorsixTH/CMakeLists.txt#L25\nand possibly: https://github.com/CorsixTH/CorsixTH/blob/b8e9d7ff500f357b8e7a6562e4aaec22c48ee102/CorsixTH/CMakeLists.txt#L252\nThe executable needs to know where to find the resource files in the app. Currently it does this by absolute path, defined at compile time. On windows it uses a relative path because the whole application lives in one directory and the working directory becomes that directory; on Linux it uses absolute paths because the application is installed by a distribution according to the FHS.\nOn MacOS I ran into complications. If I recall correctly, I found that the working directory wasn't fixed. The only good solution was to write a bunch of apple specific code like: https://stackoverflow.com/questions/516200/relative-paths-not-working-in-xcode-c\nI polled our resident mac os using developers at the time and we decided it would be fine to leave it hard coded as long as we shipped an 'installer' to copy the app to Applications (like so many you must have seen).\nSo that's basically it - optimally the app would work anywhere and we'd have an installer; currently, 0.62 has to be run from a fixed location, so it's probably best to make an installer and maybe warn people up front.. Of course I was doing this with no direct access to and limited knowledge of MacOS; so I quite possibly missed something obvious and easy.. No, sorry my knowledge of MacOS is limited; but assuming your dmg opens one of those 'Drag to Applications' dialogs or the equivalent; that's awesome.. Alright, GitHub was flaking out uploading the dmg, so I've copied your dropbox link in the release announcement for now.\nFrom personal experience, you could get a substantial size (and compile time) reduction by setting your ffmpeg flags like I do in vcpkg:\nhttps://github.com/CorsixTH/vcpkg/blob/corsixth/ports/ffmpeg/portfile.cmake#L39-L43\n(Incorporate if you want, 30mb isn't going to make or break most people these days). Curious what you find about the paths, even if it ends up needing to go into 0.63.. Sorry, all the flags from lines 39 to 43, or else you won't be able to do much with it at all :). I don't ship AnimView with the other builds, since it's mostly a developer tool.. I think thanks to @colinjmatt we can now mark this bug as closed. Any individual issues can go in their own tickets. If the wiki documentation is insufficient, and you learn the answer, please update the wiki. It has been awhile since we had many MacOS users.. Whatever the issue was with Busted it seems to have been resolved upstream.\n. Holding this PR, as long as maintenance is free I don't see a rush to pull it out. If it breaks again we can merge this\n. Obsolete.. I know, it looked funny but didn't seem to do any damage because the handymen only had to walk beside it. This is better.\n. Possibly related to #550 ?\n. I believe you are right about level 10. If you don't mind I'd like to make this issue focus on that, rather than the perception of being overly violent (possibly related to #550)\n. Related to #296\n. Okay. Addressing #296 by removing random occurrence earthquakes would make the frequency match the original game and fix the level 10 problem.\nThe actual strength is difficult to determine exactly - my understanding is that it isn't consistently too strong. In the original game earthquakes were a big problem - once you got an earthquake warning you had to actually click through your machines and make sure they were near max strength or they would get wiped out in later levels. It is possible that our upper range is too high. I still want to make this about the easier issue, then address balance in a new issue afterwards if necessary after.\nEdit: on second thought, 296 could cover level 10 and all random occurrences and this could be about strength,\n. I believe this is fixed already by #1139. Eventually I'd like the commit to add luacheck to be at the end, so that they all pass travis in between.\n. For future consideration splitting by file isn't very helpful, it is pretty easy to see the file boundaries in a commit, and it makes navigation here more cumbersome.\n. I like your tags\n. I get an error trying to run this branch:\nError loading dialogs\\edit_room.lua:\n...\\CorsixTH\\Lua\\dialogs\\edit_room.lua:1476: 'end' expected (to close 'function' at line 1120) near <eof>\n. Plays well now\n. I had really hoped to do more with this PR, but luac is rather limited (and quiet).\n. That is definitely the redistributable issue so yes. Maybe you installed the   wrong one e.g. 32 vs 64 bit\n. The installer for future versions will tell the user to download the redistributable if they do not have it.. LuaCheck couldn't catch this unless there was some sort of style rule about argument counts matching. : just injects self as the first argument.\n. @Erlend85 is this one of the (many) test apps for CorsixTH 0.60 on OS6, or the homebrew version, or one you compiled yourself?\nThere is likely a missing dylib or a mismatched version, specifically relating to ffmpeg - but without knowing what you are running I can't say who should be informed or what to tell you to do.\n. Updated:\nMore comments have been added throughout, including documentation for all newly added variables.\nThe commit that moved stop_day calculations has been dropped since it was entirely removed in the next commit anyway.\nThe magic number used in the shake size calculation has been moved into a local variable and commented.\n. I actually did have the size calculation logic wrong. Must have been tired, anyway fixed now.\n. Thanks @sgtbigman. I will fix that comment. In an earlier version of this patch I addressed the date as well but now I am leaving it for a refactor purely focused on date handling.\n. Addressed multiple no-earthquake states, consolidating on { active = false }\n. Sounds like a good enhancement to me. I'll have to play test it later to see how it feels in practice.\nWe are striving for better coding practice than we had in the past, so please add comments to the top of the new functions using LDocGen syntax (https://github.com/CorsixTH/CorsixTH/wiki/Coding-Conventions#ldocgen-syntax)\nOtherwise on the surface the actual code changes look good to me. \n. Edge scrolling and resizable windows do not mix super well, but I don't see the harm in adding it anyway.\nThis patch doesn't trigger the movies to resize but it should be fairly easy to add that. Since around 0.50 the movie is sized as it's drawn in refresh(), so the target size could be passed there instead of play.\n. What was changed in your last rebase?\n. @ecrips are you interested in making resizing during movies work a bit better?\n. @ecrips That's what I was thinking yes.\nIt's working well for movies. An issue I've found play testing - if I zoom all the way out, and then stretch the window bigger, the screen glitches and I can no longer zoom in or move around the map.\n. Looks good, rebase into one commit and it should be good to merge.\nThanks!\n. @wolfy1339 I'm aware, but when people are capable of using git properly like ecrips I'd rather they did it themselves. Keeps everyone in sync. :-)\n. My feeling is that the name data is not worth pursuing because it has no semantic meaning. I understand what is stored in this table is room type information.\n. I think it is OK. Will test later\n. GitHub isn't sending me any sort of notice when you bump this, so please comment each time.\n. Thanks for looking into this. Litter can only be dropped inside the hospital outside of any rooms, which is already handled. Checking the hospital flag is not normally enough - ownerid should be tested as well.\n. What's the reason you make an exclusion for the invisible tiles in the blueprint?\n. Invisible was introduced in 506a03c73 and only intended to affect the appearance of the blueprint. If you want to modify when a tile is acceptable modify the footprint / one of the other flags.\nThat aside, there are some discrepancies with the original game due to the path finding requirement in CorsixTH as well, but that can't currently be removed without causing crashes: see https://github.com/CorsixTH/CorsixTH/issues/826\nI suggest keeping your first PR as small as possible in scope to resolve the door issues and leave other placement issues for your next patch.\n. It looks like the litter itself didn't have a tile (x, y) https://github.com/CorsixTH/CorsixTH/blob/8d79e0afca86aee13706fce48cdcd852eeaaa642/CorsixTH/Lua/objects/litter.lua#L98\nThe back trace isn't completely useless.\n. Could be, it will take a more detailed look. :)\n. Related to #506. It looks like we never addressed this. We did investigate the original game and found that emergencies for undiscovered diseases were simply skipped there, as per the discussion in #506. Resolving #506 will resolve this as well.. Fast moving target that library - thanks for the update.\n. I believe I fixed all of these and didn't close the ticket.. SDL Mixer doesn't expose any midi device configuration unfortunately. There is nothing in the API for that library and I did a quick web search to see if there was any environment variable that could be used but I didn't find anything except some non-promising remarks about an older version: http://stackoverflow.com/questions/28182609/how-to-specify-device-using-sdl-mixer\nIf you can make it your system default midi device, CorsixTH should just use it.\n. You seem to have ended up with one of @Alberth289346's commits in your PR. It shouldn't be there. Do you know enough about git to remove it cleanly?\nI'm not a big fan of using a bit mask for invalid_tile. Bit manipulation doesn't play to lua's strengths, a table seems more appropriate. At the very least it should be documented (I didn't see any documentation on it / what the bit positions mean) in your PR.. I am largely happy with the direction of the latest attempt. I think the flag name passthrough could be clearer, I had to read your comment to know what it meant. Maybe sharable or exclusive?. That luadoc error isn't very helpful. I'll try to get to the bottom of it.. I did a bit of testing, and I'm confused by the following:\nWhy is no door allowed here:\n\nAnd a door allowed here?\n\nMy understanding (though I haven't double checked the original) is that the bench footprint shouldn't block the door in either case.. Thanks for checking @MarkL1961 \nI think that's why @mugmuggy had to special case benches - because the same sort of situation isn't allowed with drink machines?\nAnyway it seems to not always be working.. I built the first bench before loading your branch, and the second after - perhaps existing benches aren't getting the new flag?. The savegame version must be set. It also must be bumped as 118 was taken by the mouse capture pr. I'd like to land this next if you could focus here @mugmuggy?. Merged. Did you look into modifying the bench's footprint instead? It seems like that passable flag isn't doing much now.. Merged into #1163. Thanks @MarkL. Graphics are handled in a kinda special way to allow a hybrid of lua and C++ functions. You need to forward the function from the lua font to the C++ font via the font_proxy_mt structure in graphics.lua. It looks to me like it doesn't like saving a persisted function that is defined inside a local function scope - which makes sense, there would be no way to address it, local functions without a persist line are not persisted.\n@Alberth289346 pinging you because this is relevant to your work. . I made a simple test case that suggests my assumption was wrong. So far I have not been able to reproduce . What version of Lua is this?. @MarkL are you able to reproduce this?. The lua version should be in the title of the window, if you have the screen windowed.. So is it a matter of simply not updating often enough?. It is instant, but not necessarily every action updates it.. What OSX build were you using, there is no official release for OSX, but people have reported success with brew.. Closing to to lack of feedback.. Likely related, but not the same issue. That one has to do with saving the state, and this one has to do with the state after load (not during save).. For extra fun, those cannot be fixed ever :/. Probably the point is that we should have a vsync or fps setting independent of track_fps.\nEdit: Sorry, didn't read the description properly.. Dumping the humanoids_enroute for the room reveals the issue to be a patient with no tile_x/tile_y. Unfortunately at present that invariant is badly enforced. We may just have to add more checks until we can get to the true cause of the issue.\nI should note that this entity does not show up in the world.entities list. It's likely that they left the hospital but were not cleaned up everywhere (a common problem at the moment).\nward\nclass:Standard Male Patient x:52 y:87\nclass:Standard Female Patient x:66 y:84\nclass:Standard Male Patient x:nil y:nil. Pirated versions are unsupported. According to https://www.libsdl.org/projects/SDL_mixer/ FluidSynth is supported, so it's just a matter of figuring out how to use it.. Looks like a compile flag. So you will need to build your own SDL Mixer or request your distro to use it.. You may also just need to set the SDL_SOUNDFONTS environment variable as per the warning in gentoos https://gitweb.gentoo.org/repo/gentoo.git/tree/media-libs/sdl-mixer/sdl-mixer-1.2.12-r4.ebuild. @andoruB any update?. You need to set the font to one that supports Cyrillic.\nOpen %APPDATA%\\CorsixTH\\config.txt and set unicode_font = C:\\Windows\\Fonts\\ARIALUNI.TTF (or some other true type font that you have installed). I'm guessing we don't have any reviewers for brazilian portuguese so we'll have to take it on faith that your translations are more accurate than what we had before. That said your first commit also does a significant reformatting of brazilian_portuguese.lua, moving a lot of prompts around.\nCould you walk us through how you arrived at that layout, what you corrected vs. what you added, etc.?. Do you know enough about git to squash your commits, or would you like me to?. Note that whenever I rebase this it's going to cause you problems, so let me know when you're done with the updates :). I'll give it a couple days in case you change your mind. Are those last changes still good translations? Because I think we have to fix the dialog box problem anyway, but I don't know when that will be.. Duplicate of #1156. This may be related to #709 in which case try the latest git. Alternatively maybe your TH install is bad - where did you get it?. I meant, CD, gog, Origin.... Ok, I'd rather not ask questions one at a time:\nPlease test with a recent nightly build, e.g. https://ci.appveyor.com/project/TheCycoONE/corsixth/build/177/artifacts\nIf that works we will close the ticket, if not please answer the following questions:\nDid you do a full install from the CD?\nPlease paste the full contents of your config.txt\nPlease paste the md5sums from all the files in HOSPITAL\\SOUND\\MIDI. Digits are not the same in all languages. The CJK languages use different digits as does Arabic (which we do not support) off the top of my head. That said we likely use ansi digits regardless. I didn't find any conversion for numbers. Alternatively we could use one text box per digit for this display.. No unfortunately there is no known workaround for this issue. Regression bisects and/or patches are appreciated. Otherwise I'll try to get this fixed before the next major version.. Could you open a new ticket about that?. Is there any information in the gamelog.txt? Is the crash reproducible?\nIt looks like a driver crashed; whether that's a problem with CorsixTH, SDL, or the drivers themselves is hard to tell from this report.. https://github.com/CorsixTH/CorsixTH/wiki/Frequently-Asked-Questions#where-do-i-find-the-configuration-or-the-gamelog-file. It will probably have to me that looks at it; Albert was relying on my guidance for persistence, but that was a very large refactor and something may have been missed.\nIn this particular case I believe local room = self was removed because it masked the other room variable in scope. I will have to look at the diff more carefully. If the issue turns out to only affect already broken saves, I'm inclined to leave it like this.. The tribal knowledge on this project is largely lost as the original contributors have moved on. I am not aware of any such experiments.. @MarkL thanks for the insight.. Duplicate of #1061. Please report this to the ebuild maintainer. You need a newer version of luasocket.\nEdit: Alternately they could patch the config to disable update check by default.. @PenguiN560 exactly. That version is over 3 years old and known to be broken. Unfortunately there hasn't been another official release. Most distributions are shipping patched versions of luasocket, but gentoo doesn't seem to be.\nThere is an open upstream bug here: https://bugs.gentoo.org/show_bug.cgi?id=585962 but it doesn't seem to have any traction.\nFor now I suggest either turning off the update check like you did (it serves no purpose when you have a package manager to handle your updates), or build a recent git copy of luasocket.. If this was 0.60, earthquakes have been largely rewritten since then. Try the latest builds instead. Please include a version number in your tickets.. Thanks for checking @MarkL1961 \nI'll review the save game (likely tonight) to determine how it survived the 115 afterLoad logic in a bad state.. @MarkL1961 I suspect you are right. The above pull request fixes a regression in the latest build, which I think @lucasmr will confirm results in a stack trace close to what he is seeing in 0.60.. There is a local variable in world.lua that controls the length. I was testing against the original when I made my changes but I don't remember exactly whether I matched the original or found it was determined by game speed. I think it had something to do with the fastest game setting. You can play with earthquake_warning_length and suggest a value you like.. Rebased on the latest master. Duplicate of #832 possibly others.. Yes, the new luacheck is noisy - we'll need to suppress some warnings until they can be cleaned up, but this PR is clear.. I cannot reproduce. Can you fill in the rest of the issue template.. Relevant line from graphs.lua:\nhttps://github.com/CorsixTH/CorsixTH/tree/73570dbe7ccbf574e294671ce147c0f5d1a86890/CorsixTH/Lua/dialogs/fullscreen/graphs.lua#L407. Fixed. Unfortunately there are a lot of these stuck individual bugs, and diagnosing what causes them is very difficult with the current design. The stuck patient / staff is a symptom and by the time it happens the cause is usually lost. If you can come up with precise steps to reproduce these issues they will likely be fixed - otherwise the chances are quite slim.. Which SDL version?. I've begun to implement a fairly naive scaling setting for the game using the same approach as zoom (using SDL_RenderSetLogicalSize). @matejdro if you're around, can I have your opinion on #1224 . Thanks @matejdro \nI was hoping SDL could be a little more naive in it's scaling, but I think we have to do it all ourselves. The result will be better anyway, at least for those not using the built  in bitmap fonts.. @theAlevan no - no one is working on this at the moment. My quick patch wasn't acceptable, so there is just full screen fuzzy scaling at the moment.. Anyone can continue my PR #1224 \nThe default scaling value should be 0 (auto), which will be interpreted as 1x until automatic high dpi detection is built.\nThe scaling filter could be exposed to the config; or we could force nearest (quality 0) for the time being. From what I've read that was the default it should have been using before though.. Thanks Grimdoc, I'll see about making a PR for this shortly. Google Translate:\nI have Windows 10 x64.\nInstalled the game, along with CorsixTH, the English version. I downloaded the latest version of CorsixTH (0.60), rolled over the installed one, but there is no Russian language in the list. As it turned out, it can not find the ARIALUNI.TTF font in the Windows / fonts folder. This is evidenced by the line in the file \"CorsixTH \\ Lua \\ graphics.lua\":\nFont_file = windir .. pathsep .. \"Fonts\" .. pathsep .. \"ARIALUNI.TTF\"\nI run CorsixTH, then I go to Settings -> Folders -> Fonts (I just click the button opposite), I opened the window where I follow the path (the path for windows) \"C: /Windows/Fonts/Arial.ttf\" - I double-click on Arial.ttf. What happened - I chose a font that will display the text in the game. Reboot the game and this time in Settings -> Game Language -> more languages \u200b\u200bare displayed, including Russian. Now everything is fine, but for a long time I could not figure out what the reason was.\nYou can also edit the file \"CorsixTH \\ Lua \\ config_finder.lua\"\nAnd instead of the string\nUnicode_font = nil\nWrite\nUnicode_font = [[c: \\ Windows \\ Fonts \\ arial.ttf]]\nWell, or just in the Windows \\ Fonts \\ folder, create a copy of the arial.ttf file and rename it to arialuni.ttf (how many other games and applications will start asking for it). So @ButCheR-PRO what exactly is it you would like to see changed? Some sort of automatic font detection, or a message indicating why you can't see some language options?. The way CorsixTH uses and exposes fonts is lower level than most people are use to and are comfortable with. Normally a program would query the operating system e.g. fontconfig on linux or windows.h on windows for a list of font faces to show the user. There can be multiple files for multiple styles of the same font face which is part of why the lists don't match. It would be a good task for someone new to CorsixTH development.. Duplicate of #475. For most languages there just isn't the people to verify the accuracy of the translations.\nWhen your changes are ready for review you should mark your PR with [RDY], if you are not ready for merge but would like someone to take a look, use [RFC].\nAre you comfortable enough with git to squash your changes yourself?\nAs for your other question, it actually should be pretty straight forward to have localized the corrupt files message. The text is currently generated before the languages are loaded, but not displayed until after. That said it's not yet possible to just add a translation for it. An issue for that could be opened.. @tiriana yes that would be helpful, thanks!. By the default font, you mean whatever is specified in config.txt or always arialuni?. @mugmuggy Good find! I don't think we want to be using the built_in here - or anywhere? Would you mind making a PR?. The most complete open font I'm aware of is Google's Noto.\nI suggest starting there - obviously we don't want all 1.1G but if you limit to language families we support and a single style it may be reasonable.\nI've already verified the licence is ok.. Possibly related to map bounds? If you turn on debug mode you should be able to disable map bounds, and see if that changes the behaviour.. @IlDucci what state is this in, could you annotate it with [WIP] or [RDY]?. Thank you for the well thought out comments.\nI'm reluctant to accept controversial balance changes at this time. I would accept accuracy changes if it's demonstrated that the actual game performs differently in some way.. Based on your screenshot you don't have a unicode font defined.\nhttps://github.com/CorsixTH/CorsixTH/wiki/Game-Guide#folder-locations. You can likely use a font that is already on your computer as long as it covers Turkish.\nYou are using windows, so you would set it to something like: C:\\Windows\\Fonts\\arial.ttf (I'm not sure if arial.ttf covers Turkish, but that's the idea, pick a suitable font). It sounds to me like the font doesn't actually cover the characters you use.. Ok, I took a closer look. The answer is in the console window when you start the game. There are a couple of strings in your new translation with newlines in them. E.g. Good job...\nRemove those newlines so that the end \" is on the same line as the start \", when there are no more errors you will see T\u00fcrk\u00e7e in the list with arial.ttf\nThe other three languages with boxes are chinese, simplifed chinese, and korean, which arial doesn't cover.\nI hope this helps.. The message tells you the problem. It would be an issue near line 336. I didn't run into that though so you must have changed something in the file that I didn't. I'm a bit worried that you might have messed up your file.. Maybe try lucon.ttf\nThe font rendering in the game isn't great - as far as I know we haven't really played with the hinting options; and the game is designed for these bi-colour bitmap fonts built into the game which to the best of my limited knowledge on the subject we aren't able to reproduce with freetype.\nEdit:\nIt appears that it would be possible to reproduce with a two pass approach.\n. Sorry @TheOTNN the two pass thing was meant to be internal. I'll move discussion about using system fonts off this ticket.\nGoing to close this issue now. Whenever you are done your updates you can make a PR or attach the lua file to a new issue ticket the same way you did here.\nThanks!\n. I've updated the description of the various window size / resolution settings. I want to properly expose scale in the settings page as well before this is merged.. I have doubts about making committing these changes without:\na) An auto mode that is default\nb) and HighDPI awareness in Windows\nAs is I don't think this feature brings any improvement to the situation on Windows and if we release with a scale of 1 and add auto later a lot of people will end up with tiny windows and have to edit their config. SDLs scaling is not ideal for our use. See #1210 . It's slightly configurable: https://wiki.libsdl.org/SDL_HINT_RENDER_SCALE_QUALITY?highlight=(\\bCategoryDefine\\b)|(CategoryHints). @reubot are you able to test / take over my PR then?. Normally the game asks for your game directory when it starts and the HOSP dir is undefined.\nYou built this yourself @bobcanthelpyou - could you copy your CMakeCache file (or the build options you used)?. Can reproduce. @arnzel making changes in your master branch is likely to cause you a lot of trouble.\nAvoid doing any pulls until after this is merged, then after this is merged delete your fork and start over (or git reset --hard origin/master ; git push -f).\nWe do accept translation updates as files pasted under issues, since we recognize that git has a learning curve to it that isn't worth the trouble for many skilled translators.\nThank you for the contribution.. To be fair the class exists, it just doesn't have a constructor that takes a string.. Sorry for the noise, I keep changing my mind on how far I want to take this. There is one more modification I want to make.. Fixed the picture lock, and added a second commit to make the aborting flag atomic, since it was relying on unsafe / undefined behavior (there is no guarantee without atomic that other threads would ever see the updated value, or that the code wouldn't be reordered.). There is still a restriction that should prevent blocking off an area. There are a few quirks in it still like the radiator door bug. I haven't looked at this save in particular. sebastienaubry says there was another entrance, which makes it very curious. I lack the time at the moment to really investigate.. For what it's worth, the failure is here: https://github.com/CorsixTH/CorsixTH/blob/0.6x/CorsixTH/Lua/humanoid_actions/seek_reception.lua#L47 getPathDistance is returning false rather than a number because it couldn't find a path.\nThis would be related to #826. @sebastienaubry do you recall what order you built those rooms and if you edited or moved any of them?. Thanks @MarkL1961 \nI read back on the notes on #819. Evidently this is a known problem and at the time I opted to fix the crash instead of preventing the blocking, with the goal of eventually allowing blocking like the original game. Seems I didn't really follow up over the last couple years and forgot about that resolution.\nTo be consistent then and to make some progress against #825 we should fix the actual error.\n. @MarkL1961 exactly what my thinking was.. https://github.com/CorsixTH/CorsixTH/blob/6a079fd02bc456be7410e4394d7661308e86b3bf/CorsixTH/Lua/entities/humanoid.lua#L665 is the assert. No relevant information in that method.\nhttps://github.com/CorsixTH/CorsixTH/blob/6a079fd02bc456be7410e4394d7661308e86b3bf/CorsixTH/Lua/rooms/general_diag.lua#L68 is more interesting.\nIt seems that between when the staff was assigned the idle action while the patient used the trolly, and when the patient finished the staff had already been assigned another action. I'm not sure whether tearing down the other room had any impact.\n. It would be helpful for diagnosing if that assert gave a little more information about the state of the action queue; or if we had a state dump -\n@hnsl is the issue reproducible or was it a one time thing?. A bit of a mess here due to working off your master branch @altiereslima \nAs far as I can tell your actual changes since last time are in bd84d71 and 0cea33a\nCan you verify that?\n. @altiereslima is this PR superseded by #1235. @altiereslima could you provide some insight into these two PRs?. We use SDL_Mixer to handle our MIDI. I believe SDL Mixer at the moment only supports Mac, Windows, and Haiku for native MIDI. Could you take this request upstream?\n. @DMJC do you have a ticket with SDL that we can track?. Looks to be, thanks!. Please include the contents of gamelog.txt. https://github.com/CorsixTH/CorsixTH/wiki/Frequently-Asked-Questions#where-do-i-find-the-configuration-or-the-gamelog-file. Oh, a hard crash like a segfault. Interesting - thanks.. @wolfy1339 I have a fix, but I'm waiting for #1247 to ensure I give you a build with the latest SDL version.. @wolfy1339 just had to push my changes and rebase on master. Should be testable now.. Based on wolfy1339's tests, SDL2 doesn't bring up the on screen keyboard for Windows laptops. I have read that it does work on Windows RT (but only for UWP software). I'm not sure what other platforms are or are not supported.\nThe only other advantage is the potential to support IME character entry, but that will require some other input changes, and I don't have any ability to test that either.\nMy suggestion is to leave this PR open as long as it still merges cleanly in case someone comes along that can work with it, but not to merge for now.. duplicate of #1195. Holding, depending on the direction of #1259 . Closing in favour of #1274. That is a sequence of good ideas; and a number of the prerequisites are also needed to get networking going.\nWould you be interested in refactoring input into a command pattern so that it could be recorded and replayed as well as outlining the worst of the determinism issues. At present save games do not lead to deterministic replays even with no further input - I haven't spent much time looking into why.. The idea was that the game would be deterministic. The random number generator is MT, and the current seed is suppose to be saved in the save game and reloaded (I haven't personally tested that). That said, the game currently makes heavy use of floating point; some actions are based on asynchronous events (music track / sound effect ending), and some things are triggered by frames instead of in game ticks. I believe both of those things currently impact the same random number generator, if not other aspects of the game state. There is also the possibility that lua's pair ordering might impact the game, since the order of objects in a lua table is not guaranteed.\nIt's certainly something that needs to be addressed with more rigor than has been done until this point.. That one is my fault, I think we need two random number generators - one tied to the game, where we save the seed, and one for visuals or other non-behavior cases. Also those calls should be gated :). Curious, this doesn't happen other times when a surgeon leaves the room? How reproducible is this?. I didn't fix anything yet. Not easy to produce then.. Duplicate of #221 . Looks like the translation for the fax is too long, and ran into the text for the top checkbox.\nAny spanish translators able to condense this a bit?. The translation is in Lua\\languages\\spanish.lua.\nThe first paragraph is on line 183 at the moment. I'm not sure where the second paragraph is, but it seems like an original prompt.\nhttps://github.com/CorsixTH/CorsixTH/blob/6a079fd02bc456be7410e4394d7661308e86b3bf/CorsixTH/Lua/languages/spanish.lua#L183. That map is not one of ours; you should write to the author e.g. on the forum where you found it.. Curious, that's an original prompt. The english is [44,40] \"Out of a maximum bonus of %d, you have earned %d.\"\nIs this bug present in the original game too, or did they change the order of the parameters depending on the language?. I think so. Keeper St. can you provide a reworded sentence so that the 4800 can come first.. Ok, I'll make sure that lands in the next version. I can reproduce this. Technically build_while_paused doesn't explicitly say that you can also move doctors, and this feature wasn't available in the original to compare, but I agree it would make sense to be able to move them.\nI'm not sure what should happen if you move more than one to the same room during the same pause - in normal game play that would never happen; I suspect the last one you place should stay and the rest should make their way to the exit. Situations like that may be part of why it wasn't implemented.. Alright @MarkL1961, lets call it an enhancement. I think it makes sense to be able to move doctors too, once you turn on the rest of that pause mode cheating :). Thanks @lewri \nIt's closely related or the same as #475 and a couple other glitches between people and objects. I'm aware of the general issue, but haven't devoted time to it. . There is no such script, there is a render algorithm, partially documented here: https://github.com/CorsixTH/CorsixTH/wiki/Rendering. The actual cause is related to redrawing which isn't mentioned that wiki article.\nThe below patch fixes the bed issue, but creates another glitch with people showing through walls. A real fix will be to make the redraw logic a bit more sophisticated.\n```diff\ndiff --git a/CorsixTH/Src/th_map.cpp b/CorsixTH/Src/th_map.cpp\nindex e8ee4f40..c564dd48 100644\n--- a/CorsixTH/Src/th_map.cpp\n+++ b/CorsixTH/Src/th_map.cpp\n@@ -1059,7 +1059,7 @@ void THMap::draw(THRenderTarget* pCanvas, int iScreenX, int iScreenY,\n             //in the tile above it side objects to the east of the tile).\n             if(bRedrawAnimations && !bFirst)\n             {\n-                bool bTileNeedsRedraw = bPreviousTileNeedsRedraw;\n+                bool bTileNeedsRedraw = false;// bPreviousTileNeedsRedraw;\n             //check if an object in the adjacent tile to the left of the current tile needs to be redrawn\n             //and if necessary draw it\n\n``. This logic was introduced as part of a very large commit by Alex Ghiran in 2012: 99245e26 (As such it's obviously not directly related to any of the graphical issues reported in 2011). Thedebug` menu items are potentially game breaking, and meant for diagnosing issues encountered in game play.\nBug 1 is worth investigating. For 2, the only ideas I would entertain are resetting the button handlers after a crash, and maybe some sort of visual indication of 'valid diseases.\nLet's focus this ticket on the first issue.. Fixed the issues pointed out by @Alberth289346 \nAdded commit to rename the confusingly named pLastNode variable.. I was able to get substantially more information out of lldb:\n(lldb) run\nProcess 8493 launched: '/home/stephen/github/CorsixTH/kbuild/AnimView/AnimView' (aarch64)\nAnimView: malloc.c:2427: sysmalloc: Assertion `(old_top == initial_top (av) && old_size == 0) || ((unsigned long) (old_size) >= MINSIZE && prev_inuse (old_top) && ((unsigned long) old_end & (pagesize - 1)) == 0)' failed.\nProcess 8493 stopped\n* thread #1, name = 'AnimView', stop reason = signal SIGABRT\n    frame #0: 0x0000007fb725daa0 libc.so.6`__GI_raise + 184\nlibc.so.6`__GI_raise:\n->  0x7fb725daa0 <+184>: ldr    x19, [x19, #0xa20]\n    0x7fb725daa4 <+188>: mov    w0, w4\n    0x7fb725daa8 <+192>: ldr    x2, [x29, #0x128]\n    0x7fb725daac <+196>: ldr    x1, [x19]\n(lldb) bt\n* thread #1, name = 'AnimView', stop reason = signal SIGABRT\n  * frame #0: 0x0000007fb725daa0 libc.so.6`__GI_raise + 184\n    frame #1: 0x0000007fb725f200 libc.so.6`__GI_abort + 400\n    frame #2: 0x0000007fb72a0dbc libc.so.6`__malloc_assert + 108\n    frame #3: 0x0000007fb72a3e6c libc.so.6`sysmalloc + 2020\n    frame #4: 0x0000007fb72a4d48 libc.so.6`_int_malloc + 3528\n    frame #5: 0x0000007fb72a61a0 libc.so.6`__GI___libc_malloc + 160\n    frame #6: 0x0000007fb75252f0 libstdc++.so.6`operator new(sz=116420) at new_op.cc:50\n    frame #7: 0x00000055555acdc4 AnimView`THAnimations::loadXMLFile(this=0x00000055557ce8b8, xmlDocument=0x0000007fffffd6e8) at th.cpp:368\n    frame #8: 0x0000005555596ed0 AnimView`frmMain::load(this=0x00000055557ce4d0) at frmMain.cpp:321\n    frame #9: 0x0000005555596b84 AnimView`frmMain::_onLoad(this=0x00000055557ce4d0, (null)=0x0000007fffffdd50) at frmMain.cpp:285\n    frame #10: 0x0000007fb785a688 libwx_baseu-3.0.so.0`wxEvtHandler::ProcessEventIfMatchesId(wxEventTableEntryBase const&, wxEvtHandler*, wxEvent&) + 136\n    frame #11: 0x0000007fb785a7ec libwx_baseu-3.0.so.0`wxEventHashTable::HandleEvent(wxEvent&, wxEvtHandler*) + 204\n    frame #12: 0x0000007fb785ad64 libwx_baseu-3.0.so.0`wxEvtHandler::TryHereOnly(wxEvent&) + 116\n    frame #13: 0x0000007fb785ae3c libwx_baseu-3.0.so.0`wxEvtHandler::ProcessEventLocally(wxEvent&) + 76\n    frame #14: 0x0000007fb785af74 libwx_baseu-3.0.so.0`wxEvtHandler::ProcessEvent(wxEvent&) + 276\n    frame #15: 0x0000007fb7d9a4b0 libwx_gtk2u_core-3.0.so.0`wxWindowBase::TryAfter(wxEvent&) + 216\n    frame #16: 0x0000007fb785aaec libwx_baseu-3.0.so.0`wxEvtHandler::SafelyProcessEvent(wxEvent&) + 20\n    frame #17: 0x0000007fb7beeca0 libwx_gtk2u_core-3.0.so.0`___lldb_unnamed_symbol1363$$libwx_gtk2u_core-3.0.so.0 + 160\n    frame #18: 0x0000007fb6bcf784 libgobject-2.0.so.0`g_closure_invoke + 444\n    frame #19: 0x0000007fb6be33a8 libgobject-2.0.so.0\n    frame #20: 0x0000007fb6beb6b0 libgobject-2.0.so.0`g_signal_emit_valist + 2280\n    frame #21: 0x0000007fb6bec09c libgobject-2.0.so.0`g_signal_emit + 132\n    frame #22: 0x0000007fb6f01494 libgtk-x11-2.0.so.0\n    frame #23: 0x0000007fb6bcf784 libgobject-2.0.so.0`g_closure_invoke + 444\n    frame #24: 0x0000007fb6be31f8 libgobject-2.0.so.0\n    frame #25: 0x0000007fb6beb6b0 libgobject-2.0.so.0`g_signal_emit_valist + 2280\n    frame #26: 0x0000007fb6bec09c libgobject-2.0.so.0`g_signal_emit + 132\n    frame #27: 0x0000007fb6f001ec libgtk-x11-2.0.so.0\n    frame #28: 0x0000007fb6fa89cc libgtk-x11-2.0.so.0\n    frame #29: 0x0000007fb6bcf784 libgobject-2.0.so.0`g_closure_invoke + 444\n    frame #30: 0x0000007fb6be32e8 libgobject-2.0.so.0\n    frame #31: 0x0000007fb6beb4bc libgobject-2.0.so.0`g_signal_emit_valist + 1780\n    frame #32: 0x0000007fb6bec09c libgobject-2.0.so.0`g_signal_emit + 132\n    frame #33: 0x0000007fb70c2f5c libgtk-x11-2.0.so.0\n    frame #34: 0x0000007fb6fa6ed8 libgtk-x11-2.0.so.0`gtk_propagate_event + 216\n    frame #35: 0x0000007fb6fa73d4 libgtk-x11-2.0.so.0`gtk_main_do_event + 964\n    frame #36: 0x0000007fb6e20f6c libgdk-x11-2.0.so.0\n    frame #37: 0x0000007fb6afff38 libglib-2.0.so.0`g_main_context_dispatch + 712\n    frame #38: 0x0000007fb6b00190 libglib-2.0.so.0\n    frame #39: 0x0000007fb6b00540 libglib-2.0.so.0`g_main_loop_run + 240\n    frame #40: 0x0000007fb6fa61a4 libgtk-x11-2.0.so.0`gtk_main + 172\n    frame #41: 0x0000007fb7b82934 libwx_gtk2u_core-3.0.so.0`wxGUIEventLoop::DoRun() + 60\n    frame #42: 0x0000007fb76f4dc8 libwx_baseu-3.0.so.0`wxEventLoopBase::Run() + 232\n    frame #43: 0x0000007fb76b5668 libwx_baseu-3.0.so.0`wxAppConsoleBase::MainLoop() + 104\n    frame #44: 0x0000007fb774adcc libwx_baseu-3.0.so.0`wxEntry(int&, wchar_t**) + 116\n    frame #45: 0x000000555558ea08 AnimView`main(argc=1, argv=0x0000007ffffff198) at app.cpp:27\n    frame #46: 0x0000007fb724abb4 libc.so.6`__libc_start_main + 228\n    frame #47: 0x000000555558e914 AnimView`_start + 52\nDespite lldb pointing to https://github.com/CorsixTH/CorsixTH/blob/6a079fd02bc456be7410e4394d7661308e86b3bf/AnimView/th.cpp#L368 \nm_iFrameCount is 11642. Looked at this again with ASan enabled. There is a heap-buffer-overflow when loading the XML, which corresponds to what @MarkL1961 sees. As per my discussions with @Alberth289346 on irc. I'm leaning towards removing the xml saving/loading from AnimView.\n```\nstephen@alarm ~/g/C/build-clang (master)> ./AnimView/AnimView\n20:33:54: Warning: Mismatch between the program and library build versions detected.\nThe library used 3.0 (wchar_t,compiler with C++ ABI 1011,wx containers,compatible with 2.8),\nand your program used 3.0 (wchar_t,compiler with C++ ABI 1002,wx containers,compatible with 2.8).\n=================================================================\n==5921==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x007cde21d2fa at pc 0x0061ab8867cc bp 0x007fe86efae0 sp 0x007fe86efaf8\nWRITE of size 2 at 0x007cde21d2fa thread T0\n    #0 0x61ab8867cb in THAnimations::loadXMLFile(TiXmlDocument) /home/stephen/github/CorsixTH/AnimView/th.cpp:359:29\n    #1 0x61ab843e8f in frmMain::load() /home/stephen/github/CorsixTH/AnimView/frmMain.cpp:321:18\n    #2 0x61ab828407 in frmMain::_onLoad(wxCommandEvent&) /home/stephen/github/CorsixTH/AnimView/frmMain.cpp:285:5\n    #3 0x7ce6a0f77f in wxEvtHandler::ProcessEventIfMatchesId(wxEventTableEntryBase const&, wxEvtHandler, wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21c77f)\n    #4 0x7ce6a0f8e3 in wxEventHashTable::HandleEvent(wxEvent&, wxEvtHandler*) (/usr/lib/libwx_baseu-3.0.so.0+0x21c8e3)\n    #5 0x7ce6a0fe5b in wxEvtHandler::TryHereOnly(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21ce5b)\n    #6 0x7ce6a0ff33 in wxEvtHandler::ProcessEventLocally(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21cf33)\n    #7 0x7ce6a1006b in wxEvtHandler::ProcessEvent(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21d06b)\n    #8 0x7ce6f6b1bf in wxWindowBase::TryAfter(wxEvent&) (/usr/lib/libwx_gtk2u_core-3.0.so.0+0x49a1bf)\n    #9 0x7ce6a0fbe3 in wxEvtHandler::SafelyProcessEvent(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21cbe3)\n    #10 0x7ce6dae03f  (/usr/lib/libwx_gtk2u_core-3.0.so.0+0x2dd03f)\n    #11 0x7ce5cc9253 in g_closure_invoke (/usr/lib/libgobject-2.0.so.0+0x13253)\n0x007cde21d2fa is located 2 bytes to the right of 20728-byte region [0x007cde218200,0x007cde21d2f8)\nallocated by thread T0 here:\n    #0 0x61ab81beb7 in operator new (/home/stephen/github/CorsixTH/build-clang/AnimView/AnimView+0x17ceb7)\n    #1 0x61ab88665b in THAnimations::loadXMLFile(TiXmlDocument) /home/stephen/github/CorsixTH/AnimView/th.cpp:355:16\n    #2 0x61ab843e8f in frmMain::load() /home/stephen/github/CorsixTH/AnimView/frmMain.cpp:321:18\n    #3 0x61ab828407 in frmMain::_onLoad(wxCommandEvent&) /home/stephen/github/CorsixTH/AnimView/frmMain.cpp:285:5\n    #4 0x7ce6a0f77f in wxEvtHandler::ProcessEventIfMatchesId(wxEventTableEntryBase const&, wxEvtHandler, wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21c77f)\n    #5 0x7ce6a0f8e3 in wxEventHashTable::HandleEvent(wxEvent&, wxEvtHandler*) (/usr/lib/libwx_baseu-3.0.so.0+0x21c8e3)\n    #6 0x7ce6a0fe5b in wxEvtHandler::TryHereOnly(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21ce5b)\n    #7 0x7ce6a0ff33 in wxEvtHandler::ProcessEventLocally(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21cf33)\n    #8 0x7ce6a1006b in wxEvtHandler::ProcessEvent(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21d06b)\n    #9 0x7ce6f6b1bf in wxWindowBase::TryAfter(wxEvent&) (/usr/lib/libwx_gtk2u_core-3.0.so.0+0x49a1bf)\n    #10 0x7ce6a0fbe3 in wxEvtHandler::SafelyProcessEvent(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21cbe3)\n    #11 0x7ce6dae03f  (/usr/lib/libwx_gtk2u_core-3.0.so.0+0x2dd03f)\n    #12 0x7ce5cc9253 in g_closure_invoke (/usr/lib/libgobject-2.0.so.0+0x13253)\n    #13 0x7ce5ce15f3  (/usr/lib/libgobject-2.0.so.0+0x2b5f3)\n    #14 0x7ce5ceaba3 in g_signal_emit_valist (/usr/lib/libgobject-2.0.so.0+0x34ba3)\n    #15 0x7ce5ceb6bb in g_signal_emit (/usr/lib/libgobject-2.0.so.0+0x356bb)\n    #16 0x7ce6013253  (/usr/lib/libgtk-x11-2.0.so.0+0x92253)\n    #17 0x7ce5cc9253 in g_closure_invoke (/usr/lib/libgobject-2.0.so.0+0x13253)\n    #18 0x7ce5ce128f  (/usr/lib/libgobject-2.0.so.0+0x2b28f)\n    #19 0x7ce5ceaba3 in g_signal_emit_valist (/usr/lib/libgobject-2.0.so.0+0x34ba3)\n    #20 0x7ce5ceb6bb in g_signal_emit (/usr/lib/libgobject-2.0.so.0+0x356bb)\n    #21 0x7ce6011d1b  (/usr/lib/libgtk-x11-2.0.so.0+0x90d1b)\n    #22 0x7ce60d9bfb  (/usr/lib/libgtk-x11-2.0.so.0+0x158bfb)\n    #23 0x7ce5cc9253 in g_closure_invoke (/usr/lib/libgobject-2.0.so.0+0x13253)\n    #24 0x7ce5ce13a3  (/usr/lib/libgobject-2.0.so.0+0x2b3a3)\n    #25 0x7ce5cea687 in g_signal_emit_valist (/usr/lib/libgobject-2.0.so.0+0x34687)\n    #26 0x7ce5ceb6bb in g_signal_emit (/usr/lib/libgobject-2.0.so.0+0x356bb)\n    #27 0x7ce622101f  (/usr/lib/libgtk-x11-2.0.so.0+0x2a001f)\n    #28 0x7ce60d7c67 in gtk_propagate_event (/usr/lib/libgtk-x11-2.0.so.0+0x156c67)\n    #29 0x7ce60d81b3 in gtk_main_do_event (/usr/lib/libgtk-x11-2.0.so.0+0x1571b3)\nSUMMARY: AddressSanitizer: heap-buffer-overflow /home/stephen/github/CorsixTH/AnimView/th.cpp:359:29 in THAnimations::loadXMLFile(TiXmlDocument)\nShadow bytes around the buggy address:\n  0x001f9bc43a00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x001f9bc43a10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x001f9bc43a20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x001f9bc43a30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x001f9bc43a40: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n=>0x001f9bc43a50: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00[fa]\n  0x001f9bc43a60: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x001f9bc43a70: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x001f9bc43a80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x001f9bc43a90: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x001f9bc43aa0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07 \n  Heap left redzone:       fa\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n  Left alloca redzone:     ca\n  Right alloca redzone:    cb\n==5921==ABORTING\n. Corrected that error and now there is another one, this time in the common rnc code:\nstephen@alarm ~/g/C/build-clang (master)> ./AnimView/AnimView\n20:47:05: Warning: Mismatch between the program and library build versions detected.\nThe library used 3.0 (wchar_t,compiler with C++ ABI 1011,wx containers,compatible with 2.8),\nand your program used 3.0 (wchar_t,compiler with C++ ABI 1002,wx containers,compatible with 2.8).\n=================================================================\n==6234==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x00752b44c1ea at pc 0x005d4a300838 bp 0x007fe5664220 sp 0x007fe5664238\nREAD of size 1 at 0x00752b44c1ea thread T0\n    #0 0x5d4a300837 in bitread_fix(bit_stream) /home/stephen/github/CorsixTH/common/rnc.cpp:215:24\n    #1 0x5d4a2fe07f in rnc_unpack(unsigned char const, unsigned char) /home/stephen/github/CorsixTH/common/rnc.cpp:444:17\n    #2 0x5d4a311c2b in THAnimations::Decompress(unsigned char, unsigned long&) /home/stephen/github/CorsixTH/AnimView/th.cpp:817:8\n    #3 0x5d4a315c37 in bool THAnimations::_loadArray(th_colour_t&, unsigned long&, wxString) /home/stephen/github/CorsixTH/AnimView/th.h:227:23\n    #4 0x5d4a30c14f in THAnimations::loadPaletteFile(wxString) /home/stephen/github/CorsixTH/AnimView/th.cpp:565:9\n    #5 0x5d4a2c0ef3 in frmMain::load() /home/stephen/github/CorsixTH/AnimView/frmMain.cpp:322:18\n    #6 0x5d4a2a5407 in frmMain::_onLoad(wxCommandEvent&) /home/stephen/github/CorsixTH/AnimView/frmMain.cpp:285:5\n    #7 0x753374677f in wxEvtHandler::ProcessEventIfMatchesId(wxEventTableEntryBase const&, wxEvtHandler, wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21c77f)\n    #8 0x75337468e3 in wxEventHashTable::HandleEvent(wxEvent&, wxEvtHandler) (/usr/lib/libwx_baseu-3.0.so.0+0x21c8e3)\n    #9 0x7533746e5b in wxEvtHandler::TryHereOnly(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21ce5b)\n    #10 0x7533746f33 in wxEvtHandler::ProcessEventLocally(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21cf33)\n    #11 0x753374706b in wxEvtHandler::ProcessEvent(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21d06b)\n    #12 0x7533ca21bf in wxWindowBase::TryAfter(wxEvent&) (/usr/lib/libwx_gtk2u_core-3.0.so.0+0x49a1bf)\n    #13 0x7533746be3 in wxEvtHandler::SafelyProcessEvent(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21cbe3)\n    #14 0x7533ae503f  (/usr/lib/libwx_gtk2u_core-3.0.so.0+0x2dd03f)\n    #15 0x7532a00253 in g_closure_invoke (/usr/lib/libgobject-2.0.so.0+0x13253)\n0x00752b44c1ea is located 0 bytes to the right of 746-byte region [0x00752b44bf00,0x00752b44c1ea)\nallocated by thread T0 here:\n    #0 0x5d4a298eb7 in operator new (/home/stephen/github/CorsixTH/build-clang/AnimView/AnimView+0x17ceb7)\n    #1 0x5d4a315ba7 in bool THAnimations::_loadArray(th_colour_t&, unsigned long&, wxString) /home/stephen/github/CorsixTH/AnimView/th.h:223:34\n    #2 0x5d4a30c14f in THAnimations::loadPaletteFile(wxString) /home/stephen/github/CorsixTH/AnimView/th.cpp:565:9\n    #3 0x5d4a2c0ef3 in frmMain::load() /home/stephen/github/CorsixTH/AnimView/frmMain.cpp:322:18\n    #4 0x5d4a2a5407 in frmMain::_onLoad(wxCommandEvent&) /home/stephen/github/CorsixTH/AnimView/frmMain.cpp:285:5\n    #5 0x753374677f in wxEvtHandler::ProcessEventIfMatchesId(wxEventTableEntryBase const&, wxEvtHandler, wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21c77f)\n    #6 0x75337468e3 in wxEventHashTable::HandleEvent(wxEvent&, wxEvtHandler*) (/usr/lib/libwx_baseu-3.0.so.0+0x21c8e3)\n    #7 0x7533746e5b in wxEvtHandler::TryHereOnly(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21ce5b)\n    #8 0x7533746f33 in wxEvtHandler::ProcessEventLocally(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21cf33)\n    #9 0x753374706b in wxEvtHandler::ProcessEvent(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21d06b)\n    #10 0x7533ca21bf in wxWindowBase::TryAfter(wxEvent&) (/usr/lib/libwx_gtk2u_core-3.0.so.0+0x49a1bf)\n    #11 0x7533746be3 in wxEvtHandler::SafelyProcessEvent(wxEvent&) (/usr/lib/libwx_baseu-3.0.so.0+0x21cbe3)\n    #12 0x7533ae503f  (/usr/lib/libwx_gtk2u_core-3.0.so.0+0x2dd03f)\n    #13 0x7532a00253 in g_closure_invoke (/usr/lib/libgobject-2.0.so.0+0x13253)\n    #14 0x7532a185f3  (/usr/lib/libgobject-2.0.so.0+0x2b5f3)\n    #15 0x7532a21ba3 in g_signal_emit_valist (/usr/lib/libgobject-2.0.so.0+0x34ba3)\n    #16 0x7532a226bb in g_signal_emit (/usr/lib/libgobject-2.0.so.0+0x356bb)\n    #17 0x7532d4a253  (/usr/lib/libgtk-x11-2.0.so.0+0x92253)\n    #18 0x7532a00253 in g_closure_invoke (/usr/lib/libgobject-2.0.so.0+0x13253)\n    #19 0x7532a1828f  (/usr/lib/libgobject-2.0.so.0+0x2b28f)\n    #20 0x7532a21ba3 in g_signal_emit_valist (/usr/lib/libgobject-2.0.so.0+0x34ba3)\n    #21 0x7532a226bb in g_signal_emit (/usr/lib/libgobject-2.0.so.0+0x356bb)\n    #22 0x7532d48d1b  (/usr/lib/libgtk-x11-2.0.so.0+0x90d1b)\n    #23 0x7532e10bfb  (/usr/lib/libgtk-x11-2.0.so.0+0x158bfb)\n    #24 0x7532a00253 in g_closure_invoke (/usr/lib/libgobject-2.0.so.0+0x13253)\n    #25 0x7532a183a3  (/usr/lib/libgobject-2.0.so.0+0x2b3a3)\n    #26 0x7532a21687 in g_signal_emit_valist (/usr/lib/libgobject-2.0.so.0+0x34687)\n    #27 0x7532a226bb in g_signal_emit (/usr/lib/libgobject-2.0.so.0+0x356bb)\n    #28 0x7532f5801f  (/usr/lib/libgtk-x11-2.0.so.0+0x2a001f)\n    #29 0x7532e0ec67 in gtk_propagate_event (/usr/lib/libgtk-x11-2.0.so.0+0x156c67)\nSUMMARY: AddressSanitizer: heap-buffer-overflow /home/stephen/github/CorsixTH/common/rnc.cpp:215:24 in bitread_fix(bit_stream*)\nShadow bytes around the buggy address:\n  0x001ea56897e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x001ea56897f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x001ea5689800: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x001ea5689810: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x001ea5689820: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n=>0x001ea5689830: 00 00 00 00 00 00 00 00 00 00 00 00 00[02]fa fa\n  0x001ea5689840: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x001ea5689850: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n  0x001ea5689860: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n  0x001ea5689870: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\n  0x001ea5689880: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07 \n  Heap left redzone:       fa\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n  Left alloca redzone:     ca\n  Right alloca redzone:    cb\n==6234==ABORTING\n```. Curiously this second error does not happen in ASan when running CorsixTH, even though they should be unpacking the same files .... Hi @DavidFair \nThank you for the contribution. The license is MIT contributed to the individual author so you guessed correctly. It is documented in a couple places, we could certainly add an instruction in the contributing guidelines about it.\nRegarding the CorsixTH/deps package, that was my idea, but I have been the only one maintaining it, and after switching to visual studio 2017 I didn't cherish the thought of recompiling everything by hand again, so I'm looking to vcpkg now. You can see what I've done so far in #1247.\nNow vcpkg can generate a redistributable of all the compiled packages, which I'm considering uploading to CorsixTH/deps for VS2017. I won't be maintaining multiple versions of MSVC deps, though I'm happy to accept them from someone else.\nSee: https://github.com/Microsoft/vcpkg\n. I'd still like to see this one tested more before it lands. I'll see if I can get my hands on any devices. I think @wolfy1339 has one?. I can't seem to generate those events on my linux chromebook, both the touchscreen and the touchpad only make normal mouse events.\n@wolfy1339 testing even with the razer blade would be helpful.. I like having this scripted!\nThe cmake folder isn't appropriate - that should just be cmake modules. In my opinion 'scripts' is the best folder, an argument could be made for the 'build_files' folder as well.\nYour script covers the build time dependencies for CorsixTH. There are a couple runtime dependencies which I have been successful in submitting to upstream vcpkg (luafilesystem and lpeg) and one which I haven't attempted to handle yet. luasocket is going to be tricky - there isn't a release (or release candidate) version that works, so we have to pick a semi-recent git commit instead; which I think that upstream wouldn't accept.\nThere is also wxwidgets needed for building AnimView\nIt is better to pull from a specific vcpkg commit or release; or from my fork (or a CorsixTH organization fork), because new releases will break our builds until we can fix compatibility.\nThe export could be optional, it's not necessary for local builds.\nFor building the lua documentation, it is useful to additionally copy lfs.dll and lpeg.dll into the vcpkg /tools directories (where lua.exe and luac.exe are placed)\nPerhaps the script could write-out the cmake line to use the vcpkg, or a link to the embedded documentation: https://github.com/Microsoft/vcpkg/blob/master/docs/users/integration.md#cmake-toolchain-file-recommended-for-open-source-cmake-projects ?. > > The cmake folder isn't appropriate - that should just be cmake modules. In my opinion 'scripts' is the best folder, an argument could be made for the 'build_files' folder as well. \n\nOkay, I'll put this in scripts as build_files is picked up by .gitignore with build*\n\nGood\n\n\nThere are a couple runtime dependencies which I have been successful in submitting to upstream vcpkg (luafilesystem and lpeg) \n\nI didn't see them listed in the wiki as dependencies. I'll add them too and update the wiki.\n\nThanks - it's on all of the wiki pages I checked. Which wiki page are you reading?\n\n\nluasocket is going to be tricky - there isn't a release (or release candidate) version that works, so we have to pick a semi-recent git commit instead; which I think that upstream wouldn't accept.\n\nIt looks like development has stopped and nobody has an active fork. Does the vcpkg team have a policy on the state of a library before it is accepted?\n\nThe people that work on vcpkg prefer to use upstream releases with the minimal number of patches for compatibility (and they prefer those patches get merged upstream.) I'm not aware of another package on it in a situation like luasocket. As far as I know luasocket is not dead, but has received very little attention over the past number of years. I would like to drop luasocket in favour of implementing the functionality through libcurl, but that is out of scope for now.\n\n\nThere is also wxwidgets needed for building AnimView\n\nThe export could be optional, it's not necessary for local builds.\n\nSounds good.\n\nOriginally my plan was to build all dependencies and distribute them pre-compiled like we currently do with the dependencies. However the final size of the .7z archive is 80MB so I prefer your approach of getting users to build locally rather than forcing them to download the exported libs.\n\nIf we maintain our own vcpkg ports we could (optionally) dramatically reduce that by controlling the ffmpeg compile flags, similar to what I did with CorsixTH/deps\n\nI'll adapt the script so it integrates with CMake and allows us to specify if AnimView is being built. This should allow us to compile only what users need instead of everything.\n\nGood\n\n\nIt is better to pull from a specific vcpkg commit or release; or from my fork (or a CorsixTH organization fork)\n\nII'm going to leave it pointing at the official repository and include checking out a specific commit. We can just change the commit we point to instead of having to pull the latest changes to test.\n\nI'm feeling fairly strongly that we will be adding a CorsixTH\\vcpkg fork so that we can maintain anything we need that deviates from upstream. It will be easy to swap though.\n\n\nPerhaps the script could write-out the cmake line to use the vcpkg[...]\n\nIf CMake invokes the script we could easily glob the final path and handle everything within the build script.\n\nI'm interested in seeing how you do this.\n\nMy only other concern is CI servers, I'm reluctant to force them to rebuild the same dependencies each time. If AppVeyor/Travis allows us to preserve files between builds we could save the current commit we use for vpckg and export the dependencies. This way we can easily determine if we need to rebuild or just extract and reuse previously built ones?\n\nBoth AppVeyor and Travis have the concept of dependency caching, so we can avoid rebuilding every time.. Ok, there is now a CorsixTH/vcpkg. For the moment is a straight fork. I read your changes after writing my last response - CMAKE_PREFIX_PATH sounds like a good way to go.. The other thing that vcpkg toolchain does, which would be nice to have, is copy the dlls to the program output directory: https://github.com/Microsoft/vcpkg/blob/master/scripts/buildsystems/vcpkg.cmake#L126\nWe could do something more specific to CorsixTH that also copied lfs.dll and lpeg.dll.. For now I suggest end users make CorsixTH in a subdirectory of the checkout path, which is why build* is ignored. The program correctly finds CorsixTH.lua and the lua directories in this configuration.\nI think it's out of scope for this PR, but config.h.in should be given the destination path to CorsixTH.lua; and cmake install should copy them out to the appropriate path e.g. to the output directory on windows and ${prefix}/share/corsix-th on Linux.. Copying all dlls (and maybe all pdbs for debug builds?) from the bin folders seems line a fine approach to me.\nI like the approach in the accepted answer for https://stackoverflow.com/questions/10671916/how-to-copy-dll-files-into-the-same-folder-as-the-executable-using-cmake since it puts it in the correct directory regardless of the project configuration.. Release build is working, the debug build is not. It seems that some libraries SDL2 and freetype in particular are given a 'd' suffix for their debug dlls, but CMake is using the release libs which don't match that name. It's annoying but we might be better off just respecting CMAKE_BUILD_TYPE up front instead of the CONFIG at build time.\nI also have concerns about updating vcpkgs packages (iirc the old versions need to be manually removed, but we don't want to do that every time, so we'll have to check for updates), and maybe how to handle builds that require old versions (e.g. release tags), though I'm willing to ignore them for now.. With respect to my above comment, it seems debug builds are broken even with CMAKE_BUILD_TYPE=debug. In the vcpkg toolchain file, they put the debug path before the non-debug path on debug (and unspecified) builds: https://github.com/Microsoft/vcpkg/blob/master/scripts/buildsystems/vcpkg.cmake#L73\n. @ras0219-msft What's the version policy if a package targets a git commit instead of an upstream release?\nEdit: disregard, I see tiny-dnn 2017-10-09-dd906fed8c8aff8dc837657c42f9d55f8b793b0e which combined with the comment from earlier should mean it's ok if later upstream makes a release and we follow their numbering.. Getting close now. The release configuration runs properly. The debug configuration still depends on the release SDL2.dll both directly (as well as the debug SDL2d.dll), and indirectly due to an upstream issue: https://github.com/Microsoft/vcpkg/issues/1951\nDirect:\n```\nE:\\GitHub\\CorsixTH\\build-localvcpkg\\CorsixTH\\Debug>dumpbin /dependents CorsixTH.exe\nMicrosoft (R) COFF/PE Dumper Version 14.00.24213.1\nCopyright (C) Microsoft Corporation.  All rights reserved.\nDump of file CorsixTH.exe\nFile Type: EXECUTABLE IMAGE\nImage has the following dependencies:\nSDL2.dll\nlua.dll\nSDL2_mixer.dll\navformat-57.dll\navcodec-57.dll\navutil-55.dll\nswscale-4.dll\nswresample-2.dll\nfreetyped.dll\nKERNEL32.dll\nMSVCP140D.dll\nVCRUNTIME140D.dll\nucrtbased.dll\nSDL2d.dll\n\nSummary\n    1000 .00cfg\n    4000 .data\n    5000 .idata\n   2B000 .rdata\n    7000 .reloc\n   28000 .rsrc\n   B9000 .text\n    1000 .tls\n\n```\nIndirect:\n```\nE:\\GitHub\\CorsixTH\\build-localvcpkg\\CorsixTH\\Debug>E:\\GitHub\\CorsixTH\\build-localvcpkg\\CorsixTH\\Debug>dumpbin /dependents SDL2_mixer.dll\nMicrosoft (R) COFF/PE Dumper Version 14.00.24213.1\nCopyright (C) Microsoft Corporation.  All rights reserved.\nDump of file SDL2_mixer.dll\nFile Type: DLL\nImage has the following dependencies:\nSDL2.dll\nsmpeg2.dll\nflac.dll\nmodplug.dll\nvorbisfile.dll\nWINMM.dll\nVCRUNTIME140D.dll\nucrtbased.dll\nKERNEL32.dll\n\nSummary\n    1000 .00cfg\n    2000 .data\n    2000 .idata\n    3000 .rdata\n    2000 .reloc\n    1000 .rsrc\n   1C000 .text\n\n```\n. I've synced CorsixTH/vcpkg with the latest upstream so we should be able to test. I'll run it tonight if no one beats me too it.\n@DavidFair \nWe will also need to consider how to handle the share folder resources. I'll put some thoughts on that later.. Sorry I didn't post here after I tested yesterday. There is still an issue upstream with the smpeg2 package, and as I mentioned, our own project appears to end up depending on both SDL2 and SDL2d directly in Debug. I don't know why, but if you have no idea either I will try to do some reading and play around. (Multi-config cmake is new to me). Using vcpkg commit 23702360ce912b1827afe5559de936cc9a24cd0c (which I have pushed to CorsixTH/vcpkg), all transitive dependencies on SDL2 are fixed. We still have a direct dependency which I need to look into further.. Ok, I got it working.\nThe solution is to skip the FindSDL2 module all together (evidently Find* modules are somewhat of a deprecated concept in CMake, replaced by Config files).\nWhat you need is the following three lines:\nFIND_PACKAGE(SDL2 CONFIG REQUIRED)\nTARGET_LINK_LIBRARIES(CorsixTH SDL2::SDL2)\nTARGET_LINK_LIBRARIES(CorsixTH SDL2::SDL2main)\nYou also need to skip the normal Find SDL2 block. Since I don't know how prevalent SDL2 config modules are yet, it's probably best to do that conditionally on vcpkg usage.. @DavidFair are you able to continue on this?. No problem, thank you for getting the ball rolling on this.. LGTM\nPing @Lego3 . I don't want 0e2303c as part of this; I want to fix that issue at it's source.. Cool, can you squish this up, or would you like me to do it?. Merged. Merged.\nAn obvious future enhancement would be to add a default capture mouse option to the config file.. Duplicate of #1195 . Thanks @mugmuggy I know how to fix that.. Ah, I see. From some sleuthing I found that the texture is already destroyed when it's renderer is destroyed at:\n```\n\nCorsixTH.exe!THRenderTarget::update(const THRenderTargetCreationParams * pParams) Line 280  C++ Symbols loaded.\n    CorsixTH.exe!l_surface_update(lua_State * L) Line 605   C++ Symbols loaded.\n```\n\nI believe this is directly related to #1263 . The issue is a double free (or double destroy in this case) because the font cache doesn't know that the texture is destroyed when the renderer is destroyed. The corruption may be from using the texture with the wrong renderer (after it has been destroyed). Ok, thanks.\nSo there is the definite issue of the font cache not being properly invalidated when the renderer is destroyed, and likely a second issue about the renderer being recycled too often.\nEdit: Yes that condition is missing a bit mask if (info.flags & SDL_RENDERER_PRESENTVSYNC == iRenderFlags). At that point further simplification is possible.. This code has also changed quite a bit since 0.60\n We may have already fixed this\n. This should already be fixed by #1119 \nAre you able to test with the latest master? 0.60 is quite old now. (Yes, I need to put out another release). I'd rather the version was bumped here, if it's out of order I'll get a merge conflict and can fix it. If it's not there at all I could miss it.. There are hard coded litter check at:\n https://github.com/CorsixTH/CorsixTH/blob/fa0ae5362fdf1ac115d84b817513225cb75686c8/CorsixTH/Lua/dialogs/edit_room.lua#L1150\n https://github.com/CorsixTH/CorsixTH/blob/fa0ae5362fdf1ac115d84b817513225cb75686c8/CorsixTH/Lua/world.lua#L2721\nThe first one is almost an identical check to what you're doing here (though it doesn't also check rat tiles, which may be a bug.) As well these are the only place isTileExclusivelyPassable is called on. I would prefer you remove the redundant checks, if you must keep checks for particular object numbers instead of flags, put them in one function (e.g. isTileExclusivelyPassable), and preferably use another object property besides it's thob.\n. Some day I hope for a cleaner fix for this.. Done, for 0.61-beta1.. So what we are trying to prevent seems to be github.com turning malicious (or being hacked) and providing tarballs that don't match the tagged source code. An issue arises because you've downloaded my public signature from github, and the release tarball from github. A malicious party could replace my public signature with another one in my name for which they have the signing key, and then put out their own 'evil' tarball - unless you want to obtain my key in some other way?. Added asc which I have verified both on a locally generated tarball and the one downloaded from github. Just have to remember to do this every release.. Duplicate of #1155 . @ras0219-msft I played for awhile tonight trying to use the CMAKE_TOOLCHAIN_FILE like you suggest, but so far haven't been able to turn it into a good experience.\nI'll try again tomorrow, and document what I'm seeing then if I still can't get it to work.. @ras0219-msft The first problem I run into with that approach is that MSVC isn't set before PROJECT, so I don't know if we are in an appropriate environment to use VCPKG.. @ras0219-msft Disregard the above - I've gotten considerably closer.\nNow the issue I run into when I use the vcpkg toolchain is:\n```\nBuilding CorsixTH\nCMake Error at vcpkg/scripts/buildsystems/vcpkg.cmake:159 (_find_package):\n  Could not find a package configuration file provided by \"SDL2\" with any of\n  the following names:\nSDL2Config.cmake\nsdl2-config.cmake\n\nAdd the installation prefix of \"SDL2\" to CMAKE_PREFIX_PATH or set\n  \"SDL2_DIR\" to a directory containing one of the above files.  If \"SDL2\"\n  provides a separate development package or SDK, be sure it has been\n  installed.\nCall Stack (most recent call first):\n  CorsixTH/CMakeLists.txt:97 (FIND_PACKAGE)\n```\nCompared to the code I just committed, this was my changes:\n```\ndiff --git a/CMake/VcpkgDeps.cmake b/CMake/VcpkgDeps.cmake\nindex 08933a19..1d778194 100644\n--- a/CMake/VcpkgDeps.cmake\n+++ b/CMake/VcpkgDeps.cmake\n@@ -56,23 +56,4 @@ if(err_val)\n       \"\\nIf this error persists try deleting the 'vcpkg' folder.\\n\")\n endif()\n-# We cannot use a toolchain file at this point despite it being recommended by MS.\n-# The arch is determined by the generator in use on Windows. For example\n-# Visual Studio xx Win64 <= implies 64 bit build. If we use a toolchain this\n-# always defaults to a 32 bit build.\n-\n-# If the user specified their own generator it is too late at this point.\n-# We would need to restart CMake at this point, delete the\n-# cache and invoke CMake again with the toolchain set.\n-\n-# For both of these reasons we will use CMAKE_PREFIX_PATH\n-\n-set(VCPKG_INSTALLED_PATH ${VCPKG_PARENT_DIR}/vcpkg/installed/${VCPKG_TARGET_TRIPLET})\n-\n-if(CMAKE_BUILD_TYPE MATCHES \"^Debug$\" OR NOT DEFINED CMAKE_BUILD_TYPE)\n-  list(APPEND CMAKE_PREFIX_PATH ${VCPKG_INSTALLED_PATH}/debug)\n-  list(APPEND CMAKE_LIBRARY_PATH ${VCPKG_INSTALLED_PATH}/debug/lib/manual-link)\n-endif()\n-\n-list(APPEND CMAKE_PREFIX_PATH ${VCPKG_INSTALLED_PATH})\n-list(APPEND CMAKE_LIBRARY_PATH ${_VCPKG_INSTALLED_DIR}/lib/manual-link)\n+set(CMAKE_TOOLCHAIN_FILE ${VCPKG_PARENT_DIR}/vcpkg/scripts/buildsystems/vcpkg.cmake)\n``. It turned out that the VCPKG_TRIPLET was ending up as just-windows`.\nin vcpkg.cmake, if VCPKG_TARGET_TRIPLET is specified it skips setting _VCPKG_TARGET_TRIPLET_ARCH, then later in the file it sets VCPKG_TARGET_TRIPLET again. I don't know how this is normally handled when you use -DVCPKG_TARGET_TRIPLET, but when I was setting it in VcpkgDeps.cmake the ARCH was never set and then removed.\nBy avoiding setting VCPKG_TARGET_TRIPLET, it lets the toolchain detect it and set it properly.\n. AppVeyor is broken because I haven't put lfs.dll in the lua cpath for lua.exe. At @Alberth289346's request I've made the indentation for the two new CMake files internally consistent.\nIf no one else has anything to add, I'll squash these up and move this PR back to RDY tomorrow.. All squished up and ready to go.. I haven't had time to look at this issue yet (been focusing on the CMake improvements), but is it possible that the bonus shown on the fax isn't being rolled back into the salary?. Staying in the room without the diagnosis continuing until the room is staffed again sounds like fine behaviour to me, both for game play and realism.\nThat said I haven't looked at how it would be implemented.. In cases without clear consensus we default to original game behaviour as a matter of rule.\nAt this point, if someone is looking to address this issue, they should replicate the original and allow nurses to leave while patients stay in the beds and continue to be diagnosed.\n@mugmuggy from your tests of the original game, could patients leave without a nurse present?. I am ok with the behaviour @MarkL1961 describes, with the diagnosis progress updated every hour while the nurse is present (or with a chance of being updated every hour depending on how the numbers work out) based on the quality of the nurse and the number of patients in the ward.. tick and hour are likely the same thing in this case. tick is used both for an in game tick, also called an hour (even though there are 50 in a day), and a system tick. If you were using the wrong tick then the rate of progress would depend on the game speed - which would clearly be bad.. @dsnkostic on the latest git version, ctrl+f10 can be used to enable/disable mouse locking. There should be a setting to configure the default; and I haven't tested on full screen multi-monitor, but I have every reason to believe it works. Are you able to try it?. Sounds reasonable to me.\n@mugmuggy do you want to do this? Should go in config_finder.lua, somewhere near prevent_edge_scrolling I think. true by default, then switch your self.capturemouse in app.lua to read from that instead.  Also throw it in config_template.txt. No need to make an in game option.. Merged.. I didn't realise any of them were actually translated. It seems only French was, so I will restore it. The rest have the wrong English name, so replacing the number isn't sufficient.. @Lego3 there is no good landing page anymore. You get it from here: https://www.visualstudio.com/downloads/ which I consider a little overwhelming.\nYou're right about the architecture issue. I used the 'bookmark' link from that page, which wasn't updated whether I selected x64 or x86. I thought it might be using some sort of host detection to serve the appropriate file but that looks not to be the case. I can fix it to link to the appropriate file; or we can make our own landing page and link there?. @wolfy1339 that page also appears to only link to the x64 version?. Yeah, I think that's friendly enough for now. Certainly better than the 0.60 approach (nothing, except a note in the release notes).\nThanks @wolfy1339 . Pushed a couple changes to address the comments by @Lego3 and @wolfy1339 \nHopefully we can get more localizations done before the release.. @Lego3 do you think you'll have a chance to look at my fixes this week?. How did you block the room in the first place?\nLinking to meta tracker #826 . That's what I expected. Just leaving this open as part of #826 because when blocked areas are supported the behavior needs to change.. I'm curious what the original does here if there is no valid walk tiles. I will test if no one beats me to it.. I answered my question in the RFC; in short the original just allows the patient to fall through an invalid tile. There is a minor graphical issue (the patient falls through whatever was blocking them), but nothing game breaking for such a rare occurrence.. I looked into the history of \nhttps://github.com/CorsixTH/CorsixTH/blob/f539713e462821df8f793166912a737e57fd953f/CorsixTH/Lua/hospital.lua#L2166 and found this curiosity:\ndiff\nindex 94be3f83..c0bf692e 100644\n--- a/CorsixTH/Lua/hospital.lua\n+++ b/CorsixTH/Lua/hospital.lua\n@@ -1513,7 +1513,7 @@ function Hospital:removeHandymanTask(taskIndex, taskType)\n     local task = subTable[taskIndex]\n     table.remove(subTable, taskIndex)\n     if task.assignedHandyman then\n-      if taskType ~= \"cleaning\" and task.object.ticks ~= true then\n+      if task.object.ticks ~= true then\n         task.assignedHandyman:intreruptHandymanTask()\n       end\n     end\nWhich effectively is the same thing that you are doing by disabling ticks on litter. There was no indication in the commit as to why they removed that test.\nI don't like that the purpose of ticks was overridden like this - it's suppose to only indicate when we can call enity.onTick() - but the use of ticks for handyman tasks predates your PR by years so I will let it go in favour of a future refactor.\nOtherwise, I was concerned about the action getting disrupted, and litter being abandoned, but it seems that the must_happen takes care of that.\nI'm still concerned about the state deviation between old saves and new litter tasks. I means a code cleanup in the future could easily lead to broken state with little clue as to why. Should be able to fix that with an afterLoad on staff.lua that checks humanoid_class, and user_of and removes the task for any litter found?. lgtm. RDY @mugmuggy?. Welcome back @bobcanthelpyou \nI can't reproduce this. If I remove either config.txt or ~/.config/CorsixTH it just prompts me for the location of the HOSPITAL directory and then continues properly.\nIt's also rather suspicious that it's complaining about line 251. Are you confident in your steps to reproduce?. Sorry, I can produce it. I just wasn't on a late enough commit on this computer.. The regression happens on commit 80f5e569f715243d6b6861b55db70b29982fae93\nAt the moment I don't see what would have caused it.. Avoid extremes, we still want to eventually support #826 which may mean that there is no free tile to fall in:\nScreenshot from trapped patient dying in the original game:\n\n. This might be too much of a step back, but someone can improve it later if they think it's an issue.. Classifying as a low priority enhancement, since micromanaging doctors after the leave for rest was part of the original game; but you're right it's kinda tedious and doesn't add much fun. The alternative was the stick to your room policy, in which case you'd have to micromanage how tired they were getting.. @joh024 I think your code doesn't match the issue. I also think it's worth considering. Could you look if there is a more suitable issue, and if not then create a new one?. I'm willing to add a level like this to the built in set if someone makes it.. You probably don't want MaxDiagDiff to be 100 across the board. That number is out of 1000 and represents how difficult it is to diagnose a patient with that disease. With a very low number they aren't likely to need to visit many diagnostic rooms, and there is no need for better doctors.\nEdit: In fact you can delete that whole column of numbers if you also delete the .MaxDiagDiff part of the line on the left - then it will use the game defaults.. By default it uses the settings from https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/base_config.lua#L154. Unfortunately the timer is hard coded at present. As a workaround, either slow the game to the minimum speed (which gives you quite a bit of time), or enable build while paused in the config. These aren't level settings though; everyone that wants that functionality would have to do it.. There is no 0.61 yet, you mean 0.61-beta1?. That game log was not from using the map editor; it must have been from an earlier play through.\nIf you can reproduce, and run the game from the command line, hopefully their would be helpful output there.. That's unfortunate. Not much to go on in this ticket, but we'll keep an eye out. Save frequently :(. Please keep suggestions for new rooms, equipment, and diseases to the appropriate section of the forums. This issue tracker is not the right place to discuss them at this time.. Please use release candidate 1.. Note that handyman cleanup was changed in rc1.. Thanks for the report. Looks like a regression related to multigesture.\nThis is a release blocker.. On the releases page.. I see, the savegame version wasn't bumped properly, so the afterload condition that was suppose to enable multigesture didn't happen. This breaks compatibility with save games from the beta only; games from earlier (before savegame_version 118) should work fine.\n@overlordchaos if you want to recover your save game, edit game_ui.lua, and change https://github.com/CorsixTH/CorsixTH/commit/b68864a6555826f6410e1055ad6f11d71bfb2597#diff-2941452853592df382d60ed7e9d6a3bcR1144 from < 118 to < 120. I will add a note to the release page.. We have a conversion, that's literally what I had you tweaking.\nThere is a small window of saves it doesn't handle between when mugmuggy wrote multigesture support and when I merged it which is entirely my fault.\nI don't feel that correcting an issue that only affects beta 1 saves (0.60 saves convert fine) to be worth delaying the release another two weeks for.\nYour second issue error I can't explain off hand. I'll take a look at your save over the next few days to see what is going on there.. Duplicate of longstanding issue #521 \nThis issue in the gamelog is interesting but unrelated. Did you notice any other behavior related to that you could open another ticket for?. This is because your level file is broken. Your lines with MaxDiagDiff need another number for that value.. Start a new game with the corrected MaxDiagDiff and see if you can still reproduce. It seems likely to be connected to that (and I can see from your game log that there's still invalid values there). Note that changing a level and opening the old save will not work.. @MarkL1961 what are you talking about? There's no MaxDiagDiff in your list, and that number is between 0 and 1000. I have never seen it set below 100.. https://github.com/CorsixTH/CorsixTH/compare/v0.61-beta1...v0.61-rc1\nNothing relevant that I see.\nEmergency patients don't walk in, they come by helicopter when you agree to handle an emergency.. Note that there is always a chance that the GP can completely diagnose a patient. My feeling is in your beta save you just got lucky with a highly skilled GP.\nThat said you likely want to disable walk in alien DNA in your level.. @MarkL1961 sorry I misunderstood. Yes you're right, the early levels do seem to have some very low values, e.g. the 1 for INVIS (at all difficulties), and 10 for INVIS in level 3 etc.\nI have a very strong feeling that CorsixTH is not handling that value the same way that the original game did. A value of 1 should (I think) mean that the GP can always diagnose the disease regardless of skill - instead we are using it as a modifer on the base diagnostic progress (capped at 0.4) which really diminishes the impact of MaxDiagDiff, so that it makes at most at 0.4 difference in diagnostic progress:\nhttps://github.com/CorsixTH/CorsixTH/blob/4349cc74d2fb07dbca02f4c1f0678d1b7cc31dbd/CorsixTH/Lua/entities/patient.lua#L176-L205\n(We need a progress of 1 to be 100% sure of the disease)\n. @overlordchaos yes it's already listed in https://github.com/CorsixTH/CorsixTH/wiki/Programming-Ideas#dna-fixer\nJust low priority, unless someone that can write code feels like taking it on.. @MarkL1961 yes, lets assume a MaxDiagDiff of 0, and a staff that was perfectly skilled and perfectly attentive, and not at all fatigued. If the random number generator was also on our side we would get:\ndiagnosis_base = 0.4\nmultiplier = 7.5\nattn_detail = 1\nskill = 1\ndiag_bonus = 1.4\nMaking the total diagnostic progress 10.9, or 1090% diagnosed just based on the GP. As you can see our 40% from MaxDiagDIff didn't really have much of an impact, even if the difficulty was 1000, we'd be 1050% diagnosed.\nThe formula feels like it was hacked together - this should impact positively, this should impact negatively, lets add a random factor here and there. If someone were to go to the trouble of comparing I don't think they'd find much correlation with the original game.. Look at: https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/diseases/alien_dna.lua\nFor reference on a disease with diagnostic rooms see: https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/diseases/uncommon_cold.lua\nThe main problem is that there are no graphics for Alien DNA patients using anything. They really shouldn't be coming to the hospital any way except via helicopter, like in the original game - which would be a much easier fix too.. Thank you for trying.. Yes, I agree with option 1. It might land in 0.62.. @MarkL1961 how did the original deal with the missing graphics then?. Ew... Ok, thanks MarkL.. You are saying the room factor is per disease type then. How did you observe all these components?. \"that beeing said, could you take a closer look to the alien disease? why it breaks down the game when a patient comes in as a regular patient? and i dont mean the animations, i can live with that. but the doctor's and staff gets frozen in place, rooms get broken or with the patient stuck, etc.\"\n\"@MarkL1961 i never said anything about a game freeze.\"\n@overlordchaos these moving goalposts are frustrating. This issue can only be about one thing. Right from the top it looks like it is about diagnosing alien disease, which is exactly what mugmuggy was helping with.\n. A standalone binary won't be an option, but zip files are available through appveyor that can be run from whatever directory they are extracted in.\nI can either link, or copy those zip files to the release page. The Visual C++ Runtime would still be required, independently.\nWould this satisfy your requirements?. We can't legally statically link some of our dependencies because we are not a GPL project.\nMixed linking is possible in some cases but not a game I feel like playing if it works at all in our case.\nIncluding the msvcr*dll is an option I believe (though I have to go over the license to see the restrictions): https://www.visualstudio.com/en-us/productinfo/2017-redistribution-vs. @lewri I know including the non-debug dlls from the redistributable is allowed.\nThe only reference I see to static linking in that stack overflow is talking about standalone executables. CorsixTH depends on lua files and other resources outside of the executable anyway, so all we would gain from static linking is potentially a little bit smaller download from dead code removal.\nThere is nothing blocking this issue. A portable x86 zip file for v0.61 can and will eventually be provided.. Done.. Other people with contribute access, please hold off on merging this until after the release.. Handyman litter cleanup was modified with CorsixTH 0.61-rc1 to address an issue almost identical to this one; please use the latest release (at this time CorsixTH 0.61-rc2.. In the original game people will choose one of the 4 player hospitals to visit based on their relative merits. In CorsixTH 25% of people will visit your hospital of your reputation is 500, if your reputation is maxed out then 75% of people will visit your hospital.\nThe total world population for each month is defined in the level file, usually with a fairly slow ramp up - you can speed up the game to help with that. If you are playing a custom level then the map author controls the population.\nIs there anything particular / any level in particular that you think is incorrect?. Thanks @DavidFair \nThe change won't land in the RC - I don't think it's enough of an issue at this point - the actual release is imminent; and this isn't a crash or regression from 0.60.\nAs such, a fix moving the logic into app.lua would be welcome. I have simplified the release process substantially, and don't plan to have any more children in 2018, so I expect 0.62 won't take as long to materialize.. :) I snuck in a change to the version number scheme, we no longer jump by 10s. That said I will merge this and the refactor PR can come any time you like.. I am in favour. I would also suggest adding a toggle to the in game menu along side the edge scrolling option here:\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/dialogs/menu.lua#L639\n. Code review LGTM\nI'll play test this later today.. Plays well to me too.\nReady to merge @DavidFair or did you want to fiddle with the history first?. Any time saveConfig is called, all of the persisted config entries are saved including edge scrolling, but not triggering the save is a bug.\nLock windows prevents dragging around the in game dialogs. It seems to have never been made a persistent config option at all... My guess is that no one ever uses it, as I can't think of a use case.\nI don't mind whatever you decide to do or not do with that one.. Merci !. The hit test fix for 789 should be in a separate commit (I don't mind it in the same PR)\nI don't understand the --register and --deregister comments where you are doing the key binding.\nHave you tried with and without including the zoom level to see how it felt? I'm curious which is the better experience.. @mugmuggy this is still marked as WIP, what is the state of this PR?. Sounds great. First feature for the next release!. Bumped the SAVEGAME_VERSION and merged.. Not much to go on without debugging info. Are you able to compile yourself or does opensuse provide debug packages?. Ah, you are the package manager!\nOk, now that you have debug symbols, run the game through gdb. When it segfaults type bt and let us know the trace.\nI also recommend switching to lua5.2 or 5.3 these days. Should still run with 5.1 but it has been awhile since I tried.. @bobcanthelpyou can you post a backtrace then?. Interesting. I assume that movie is there? (The lua shouldn't call it otherwise). @Mailaender in the short term you could fix the opensuse package with minor loss of functionality by adding -DWITH_MOVIES=OFF to your cmake line (and dropping the ffmpeg dependency.)\nWe will keep looking into why it isn't working.. Verified smacker isn't included: https://build.opensuse.org/package/view_file/multimedia:libs/ffmpeg/enable_decoders?expand=1\nSo @Mailaender you will need to disable movies as I mentioned above. We will keep this open because we need to handle this condition more gracefully.. If someone affected by this could test pr #1473 that would be helpful.. Fixed. Not our problem? Some virus scanners will identify anything unrecognized. No info here.. Yep, false positives. Baidu seems notorious for that.. Can you add a quick justification as to why you selected Google Test Framework (over another unit testing framework for C++). I would like some discussion on this before we jump on one or another.. I would like input from other contributors on bd7a723\nNote that:\n for FHS compliance we already need better support for selecting a datadir. Some packages patch our source code to change the location - should be a cmake variable.\n The install target already copies those files: https://github.com/DavidFair/CorsixTH/blob/bd7a72332f17023801d93cf68ef78cabd8a91924/CorsixTH/CMakeLists.txt#L234 (to the CorsixTH executable directory, not the proper location for FHS compliance)\n. The sprite function doesn't need it's own file. It is logically connected to the other gfx code.\nSee similar anti-guideline: https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#Rnr-lots-of-files. @DavidFair I'm very much in favour of the things you've listed under future work. If you look at my own commit history I have been slowly pushing the code in that direction myself. Additionally I would like to eliminate code macros.\nI am in favour of adding a unit test framework, but I have strong reservations about adding one without also including a substantial number of tests to prove it; otherwise we're likely to end up like the lua situation, with a test framework in place but serving no use.\nAll changes unrelated to adding the unit test framework, and adding tests I'd prefer were not in this PR. Many of the changes included are controversial, and worthy of their own discussion.. From my research so far, Google Test seems fine (widely available, reasonably expressive, used by quite a few other projects, cross platform.)\nEvery major distro seems to include gtest packages, which for me reinforces the idea we treat it exactly the same way as other dependencies. A flag to enable/disable building the tests would be appropriate.\n. I've come around to being in favor of copying the data directories to the cmake_binary_dir.\nI don't think they need to be copied to the target directory, so we could use the more ergonomic FILE commands instead of the external cmake calls.\n@DavidFair do you mind if one of us handles this as a separate PR. I would like to attack #144 at the same time - they are closely related.. Because we are using CorsixTH/vcpkg\nThe upstream changes need to be merged in then point to the resulting SHA in that repo.\nLeave this here as a reminder.. You can use ebe81932c323b6437eea7d77ef6860024508f5e4 now.\nHave you verified that this issue affected us? I see a space issue affecting boost, and another one that says some perl scripts - haven't tested it myself.. @wolfy1339 can you change the has to the one I posted and push again?. Nothing suspicious stands out about the Homebrew formulae. Please post one of your saves.. The error is a bit strange. I'm interested to see your app as well.. Indeed I can open that save fine in ArchLinux ARM. I see also that the save is produced in 0.61.\nThat said, the app you posted is not CorsixTH v0.61, it's 0.40!. From my reading of https://github.com/Homebrew/homebrew-core/blob/master/Formula/corsixth.rb lpeg and luafilesystem should be bundled. My best guess at the moment is that you are running an older app you had installed before.. I updated the wiki to suggest using the build directory on Linux as well.\nI'm not against the extra line going in .gitignore, if you want to make a PR; but I do recommend switching over, after which it will be a non-issue.. Since it's a path, please include the trailing /. Instead of storing the path separator in self, you could store it as a file local. Then getPathSeparator could be called as a static.\nPath might be a better name than PathManager.. No, there just isn't much advantage to the PR as it is right now. The standard lua way of getting a path separator is ugly but conventional to the language. path.concat is used for the same purpose as pathsep, but there isn't an effort to standardize path building. For corsixth.require we use yet another approach with gsub.\nSo it's a very nice PR but it needs to go further with unification to be worth merging.. Actually we can drop FindLua.cmake entirely because of the CMake version bump recently. It's included upstream.\nYou're right about the msinttypes too; and there's some other convoluted and dead code I haven't addressed yet which could belong in this PR.. I need to update the Deps repository first because FindLua.cmake considers A/include/lua to be higher president than A/include/. Even after updating Deps we are still getting the wrong lua include. I think our FindLua.cmake was better (or at least incompatible with the upstream one), so I will restore it and fix it's issues.. Don't worry about travis, it's broken until #1325 is merged.. I'd rather you didn't make a new directory for this unless/until more classes can go in it. Date is fine to be top level for now.. Looking forward to seeing this flushed out.\n. I would like to see utilities.lua and Path.lua in the same space because they fill the same function (abstracting system details)\nDate doesn't belong with them, it is game logic.\nWorld is too general, unless you move entities and hospital and and objects etc.\nBut I don't see the problem with a relatively flat stucture. What problems is it causing you?. It would be nice if some of the metatable methods could be implemented for this new Date type; specifically __eq, __lt, and __lte. That would simplify several of the comparisons in the code.. Right, the facility isn't really there for it at the moment, but it can be added:\n```diff\ndiff --git a/CorsixTH/Lua/class.lua b/CorsixTH/Lua/class.lua\nindex e601df8a..a40160b6 100644\n--- a/CorsixTH/Lua/class.lua\n+++ b/CorsixTH/Lua/class.lua\n@@ -88,6 +88,7 @@ local function define_class(name, super, adopts_self)\n   methods_mt.__class_name = name\n_G[name] = methods\n+  _G[name .. '_mt'] = mt\n end\nstrict_declare_global \"class\"\ndiff --git a/CorsixTH/Lua/date.lua b/CorsixTH/Lua/date.lua\nindex 185c3541..73df77c3 100644\n--- a/CorsixTH/Lua/date.lua\n+++ b/CorsixTH/Lua/date.lua\n@@ -27,6 +27,7 @@ class \"Date\"\n---@type Date\n local Date = _G[\"Date\"]\n+local Date_mt = _G[\"Date_mt\"]\nlocal month_length = {\n   31, -- Jan\n@@ -100,6 +101,10 @@ function Date:clone()\n   return Date(self._day, self._month, self._year)\n end\n+Date_mt.__eq = function(self, other)\n+  return self._year == other._year and self._month == other._month and self._day == other._day\n+end\n+\n -- PRIVATE\nfunction Date:_adjustDayOverflow()\ndiff --git a/CorsixTH/Luatest/spec/date_spec.lua b/CorsixTH/Luatest/spec/date_spec.lua\nindex 915681a7..0b524387 100644\n--- a/CorsixTH/Luatest/spec/date_spec.lua\n+++ b/CorsixTH/Luatest/spec/date_spec.lua\n@@ -120,6 +120,12 @@ describe(\"Date\", function()\n     local origin_date = Date(12,3,2)\n     local clone_date = origin_date:clone()\n     assert.True(origin_date:equals(clone_date))\n-    assert.False(origin_date == clone_date) -- different objects\n+  end)\n+  it(\"implements ==\", function()\n+    local date1 = Date(1,2,3)\n+    local other_date1 = Date(1,2,3)\n+    local date2 = Date(3,2,1)\n+    assert.True(date1 == other_date1)\n+    assert.False(date1 == date2)\n   end)\n end)\n```. Diff above is a proof of concept. Of course it should be cleaned up, and the class extension should be it's own commit. I'm not sure that name_mt is the best convention either.. I personally haven't hit that issue with this PR. It doesn't happen every time then? Do you know the cause?. @pschoffer I was on an out of date pr. I can reproduce it. I had the same hunch as you, but it's wrong. This issue seems to be that the method it's using to return the names of those pieces of code is returning nil.\nAt the moment, one workaround is this:\n```diff\ndiff --git a/CorsixTH/Lua/date.lua b/CorsixTH/Lua/date.lua\nindex 9c991578..35adea79 100644\n--- a/CorsixTH/Lua/date.lua\n+++ b/CorsixTH/Lua/date.lua\n@@ -105,11 +105,11 @@ end\nlocal Date_mt = Date._metatable\n-function Date_mt.__eq(one, other)\n+Date_mt.__eq = --[[persistable:date_eq]] function(one, other)\n   return one._year == other._year and one._month == other._month and one._day == other._day\n end\n-function Date_mt.__lt(one, other)\n+Date_mt.__lt = --[[persistable:date_lt]] function(one, other)\n   if one._year == other._year then\n     if one._month == other._month then\n       return one._day < other._day\n```\nI think that's ugly though. Perhaps we can do better.. I don't blame you, the persistence code is pretty opaque. Functions can't be read on their own, because they assume the state of the lua stack, and what that state should be isn't documented.\nAt a high level, it crawls through the permanent objects tables, recursively. Functions (prototypes) are stored in a cache, keyed by source file and line number, which are indexed; so if the same function is encountered again later in the search (e.g. multiple callbacks storing the same function reference), the cache is checked and the existing index is pulled out so that the function info is only stored once.\nBecause source name and line number are not going to be constant between game versions, another table exists that maps names to these values. This table is also in the lua stack (put there by init()) and when we add a function we've encountered for the first time, we lookup in this table what the name should be. There are three ways for names to get into that table.\n\nAll top level functions and class methods are automatically added by persist.lua\nA function can be annotated with f = persistable\"name\"( function() ... end)\nA function can be annotated with the --[persistable:name]] comment\n\nThere are some fine differences between those methods. The problem with jumping directly to method 2 or 3, is that if we do add automatic annotation (which should be doable, given the ._metatable pattern) we would need to make sure the names match, otherwise saves won't be compatible.\nhttps://github.com/CorsixTH/CorsixTH/wiki/Persistence has some more details.. This is actually the fix I recommend:\n```diff\ndiff --git a/CorsixTH/Lua/persistance.lua b/CorsixTH/Lua/persistance.lua\nindex a779221c..d5be8a21 100644\n--- a/CorsixTH/Lua/persistance.lua\n+++ b/CorsixTH/Lua/persistance.lua\n@@ -103,6 +103,11 @@ local function MakePermanentObjectsTable(inverted)\n         permanent[v] = name .. \".\" .. k\n       end\n     end\n+    for k, v in pairs(class._metatable) do\n+      if type(v) == \"function\" then\n+        permanent[v] = name .. \"._metatable.\" .. k\n+      end\n+    end\n   until true end\n-- C/class/library methods\n```\n(I'm not sure if I still like the _metatable name - but that would be bike shedding and I don't think we need to dwell on that.). LGTM\nMerge pending play test.. I will test before merging so I don't repeat last time. Normally do and get burned whenever I don't.. All good. Could you squish?. That's not a good change, the next_vip_date isn't reset again until the previous VIP leaves, or you refuse the fax.\nI suppose you could either add sameDay, or nil out the date once you enter the condition.. Sorry, I didn't think to mention it earlier. The new date class and all it's methods should have ldocgen comments.. Thank you for the detailed report.\nThe attached save game is from after the error occurred - could you check to see if you have a save from before the error where we can follow the steps to reproduce the error from?. @overlordchaos This issue has nothing to do with gog.. @overlordchaos this conversation is irrelevant to this ticket. Please move any such speculation to the mailing list or irc.. Thanks @psypod. Thank you @ElvarT. Your issue is interesting because it is not litter.. You are right @mugmuggy. @ElvarT let's move discussion of your issue to #624. This looks close to ready, and I would like to get it merged sooner than later. Would you mind squishing it into 2 commits? (first 2 functional commits into one, second 2 style commits into another) ... if you do my path change to include ?/init.lua put that in the first commit.\nIf you don't feel comfortable squishing but are otherwise ready to merge let me know and I'll handle it.. Exactly.. +1. Assuming you're ready, mark as [RDY] please :). Just add some noise so it shows up in the game log along with information to identify the patient (type, x, y etc.)\nBe clear in code that an invariant has been violated.\nLonger term, we need to cut down on action queue meddling and enforce that invariant . @pschoffer how does this error look in the output?. Looks great to me, thanks. We should improve error to dump a call stack, but that can be another issue.. \nIt looks like your radiators have heat at least. But I see the town map isn't showing it.. Most of your hospital is a fine temperature. That said there is an issue with the heat distribution it seems. You can see in the above screenshot there is a 22.8 next to a 4.2 with nothing in between to stop the flow. I watched this over many ticks and it doesn't change.. @vertibird not at this time. This is the first I am aware of it.. I can reproduce in any new game.. No problem. It was never explicitly called out in the comments. The only way to tell is to look carefully at my screenshot.. I think that commit fixes linux, short of potential path issues with characters.\nApple is probably still very broken. I think it doesn't work out of source at all yet, and that rsync stuff has to go (it should be handled by cmake). @tobylane ok, the above changes work for me with the following issues:\nlfs.so and lpeg.so need to be copied manually into the Resources path.\nbundle location is fixed by CMAKE_INSTALL_PREFIX. In practice that might be acceptable because on MacOS bundles should always be in Applications, and the installer can enforce that.\nI haven't tested at all with xcode, if the IDE mangles paths it might break - everyone uses make && make install right?.... I tested XCode with USE_SOURCE_DATADIRS and at least with that option it works well.\nI know that the shell script to launch with the source directory when USE_SOURCE_DATADIRS is not set will not find the right directory; I'm not sure if there's other problems.. I'm good with the state of this now. If anyone has something specific they'd like to change, mention it now or file another PR after this is merged.. I'd rather not move them; we normally put .in files in the same directory (relative to the source directory) that they output to (relative to the binary directory)\nThe only other place they might make sense is in the root, outputting to the root.. @pschoffer I hope you don't mind I did this.. Agreed, I will switch to dot notation to be more 'require' like.\nThe other differences from a real require are that it doesn't search the LUA_PATH and it doesn't work with compiled lua.. dot notation changes have been made.. Added documentation\nRebased on latest master (since date pr landed)\nFixed one require that my sed script had missed in map.lua. Duplicate of #1329. @MarkL1961 he implemented the same logic that @mugmuggy mentioned, where the length and whether it happened depends on the handyman / radiator ratio.. afterLoad gets called immediately after loading a save game. Old is the save game version of the file and new is the current save game version. When making changes to the lua representation you bump the SAVEGAME_VERSION in app, and put in a condition to do the conversion in the relevant classes.. @da4id the heat spreading is in C++, in th_map.cpp.\nIt's called in world.lua:1041 self.map.th:updateTemperatures()\nIt is passed 0.25 + self.hospitals[1].radiator_heat * 0.3. The magic numbers there are never explained, which is not so nice.\n. Add HeatingController to .luacheckrc globals list.. @da4id Are you still interested in pursuing this? Perhaps in a more limited fashion without the refactor?. We can certainly deviate if we have a better idea; and density is a better idea (though harder to calculate). Heh, ptrdiff_t is a c89 type. Closing as duplicate of #1087 . Yes, I noticed both issues too. I still don't really know what naming convention we want for classes, and haven't settled on one yet.\niso_names_their_classes_like_this\nStroustrop_names_his_classes_like_this\nJavaStyleIsPopular\nTHPrefixesAreUsedBySomeVendorsLikeApple\nand by extension enums.. Strostrup and the C++ Core Guidelines have strong objections to ALL_CAPS being used for anything but preprocessor macros. I agree with their reasoning.. Ping @pschoffer . Mostly good, this is how the resulting error looks to me:\nError in timer handler: \n...ephen/github/CorsixTH/CorsixTH/Lua/entities/humanoid.lua:870: Action queue was empty. This should never happen. <LocalisedString> Current value:WHITHAM - class: Doctor\nWarmth: 0.212   Happiness: 0.999   Fatigue: 0.000  Thirst: 0.000  Toilet_Need: 0.000   Health: 0.930\nActions: [walk - going to 65:59   must_happen, meander]\nSkills: (0.519)  Surgeon (0.000)  Psych (0.000)  Researcher (0.000)\nstack traceback:\n        [C]: in function 'error'\n        ...ephen/github/CorsixTH/CorsixTH/Lua/entities/humanoid.lua:870: in method 'getCurrentAction'\n        .../stephen/github/CorsixTH/CorsixTH/Lua/entities/staff.lua:265: in method 'isTiring'\n        .../stephen/github/CorsixTH/CorsixTH/Lua/entities/staff.lua:161: in method 'tick'\n        /home/stephen/github/CorsixTH/CorsixTH/Lua/world.lua:1036: in method 'onTick'\n        /home/stephen/github/CorsixTH/CorsixTH/Lua/app.lua:1014: in function </home/stephen/github/CorsixTH/CorsixTH/Lua/app.lua:1011>\n        (...tail calls...)\n        /home/stephen/github/CorsixTH/CorsixTH/Lua/app.lua:915: in function </home/stephen/github/CorsixTH/CorsixTH/Lua/app.lua:910>\nI think a newline and a label is warranted in the error, maybe something like:\nError in timer handler: \n...ephen/github/CorsixTH/CorsixTH/Lua/entities/humanoid.lua:870: Action queue was empty. This should never happen.\nhumanoid:\n<LocalisedString> Current value:WHITHAM - class: Doctor\nWarmth: 0.212   Happiness: 0.999   Fatigue: 0.000  Thirst: 0.000  Toilet_Need: 0.000   Health: 0.930\nActions: [walk - going to 65:59   must_happen, meander]\nSkills: (0.519)  Surgeon (0.000)  Psych (0.000)  Researcher (0.000)\nstack traceback:\n        [C]: in function 'error'\n        ...ephen/github/CorsixTH/CorsixTH/Lua/entities/humanoid.lua:870: in method 'getCurrentAction'\n        .../stephen/github/CorsixTH/CorsixTH/Lua/entities/staff.lua:265: in method 'isTiring'\n        .../stephen/github/CorsixTH/CorsixTH/Lua/entities/staff.lua:161: in method 'tick'\n        /home/stephen/github/CorsixTH/CorsixTH/Lua/world.lua:1036: in method 'onTick'\n        /home/stephen/github/CorsixTH/CorsixTH/Lua/app.lua:1014: in function </home/stephen/github/CorsixTH/CorsixTH/Lua/app.lua:1011>\n        (...tail calls...)\n        /home/stephen/github/CorsixTH/CorsixTH/Lua/app.lua:915: in function </home/stephen/github/CorsixTH/CorsixTH/Lua/app.lua:910>\nlet me know what you think.. I don't like that <LocalisedString> Current value: noise, but I don't know where that is coming from.. Actually it comes from https://github.com/CorsixTH/CorsixTH/blob/6af2a5c575f22ac8921eb08bd1030a44ae180011/CorsixTH/Src/th_lua_strings.cpp#L380 - but why?. Linking to the relevant issue and discussion: #84 . LGTM\nI'll merge if you are ready. Normally you can't remove persistable functions, but that one is outside of any possible save, so I'm not sure why it was marked that way in the first place.\nIf your save games load, it should be good.. What's the state of this @tobylane . Tested \ud83d\udc4d . g++ seems to dislike variables with the same names as classes even when the classes are explicitly namespaced (allowed in clang)\nhaven't determined the cause of the msvc errors yet.. For reasons I'm not clear on, g++ was only concerned with one of the class / variable name collisions (map in map_scanline_iterator). Still plenty of complaints from MSVC though.. Opening this up to bike shedding now.\nIt's probably the best time to chime in if you don't like any of the new names, or to point out that I missed something with an old style name.\nNote:\nL is still used as the name of the Lua_state variable - this is a lua convention.\nl_ is still used as a prefix for functions to be called from lua. This is temporary until those functions can be moved into another namespace.\nLikewise with the luaT_ prefix.\nI did not touch local variable or parameter names in this PR. It's big enough without them.\n. Still working on your suggestions. One other significant change I have made since then is renaming map_node to map_tile and everything related (because they are tiles, and node is needlessly general).. Addressed all of the naming issues mentioned by @Alberth289346 as well as some of the formatting issues (I know I missed some).\nCode issues are out of scope for this PR.. Ok, let's get this merged since it basically blocks C++ work.\nAnimView won't be updated to this naming scheme as it clashes with wxWidgets. I can't see how it would negatively impact the game in any way, so I'm open to it - but having our own graphics would be a prerequisite.. Do we need more state for this, or is it just as natural to idle randomly?. Ok, thanks for looking. @Brainsample why isn't this a PR?. Fixed. I'm open to closing this, or making it a feature request on a path sanity check when starting a level.. @AdamFx990 please read the Travis output and correct whitespace problems.. @grimdoc are you happy with this pr. Yeah, never make changes off your master branch - it makes a big mess.\ngit branch translations\ngit reset --hard origin/master\ngit checkout translations\ngit rebase -i master\n(remove all lines not pertaining to this change, save and close)\ngit push origin --set-upstream translations\nclose this pr, and open a new one off that branch.\n. As an addendum, please read and follow:\nhttps://raw.githubusercontent.com/CorsixTH/CorsixTH/master/CONTRIBUTING.txt. If you run the game from cmd you should see something but it probably won't be too useful (though it might be, so try it.)\nYou can create a crash dump with windows error reporting (built into windows) or other similar tools available for download:\nhttps://msdn.microsoft.com/en-us/library/windows/desktop/bb787181(v=vs.85).aspx which might have enough information to go on.\nEven better, you can get visual studio and compile yourself with debug, and give us the dump from there. That would definitely give us something we can work with if you are able to reproduce the error in that environment.. Avoid multiple unrelated issues in the same PR.\nYour problem is that you are doing all your work on master, which sooner or later is going to backfire.\nRead our contributing.md and maybe a git tutorial.. Close this pr\ngit branch mess\ngit reset --hard origin/master\ngit checkout -b meander\ngit reset --hard eb2b04\nOpen a new PR from meander\nYour other patch will be in mess and can be rebased or cherry picked later.\n. I have tested this briefly on LuaJIT 2.1.0-beta3 and everything runs fine.. Haven't looked yet but I'm curious what your PR does, and if this only affects certain lua versions. th_getfenv is completely different in Lua 5.1/LuaJIT than Lua 5.2+. If you're curious, what you did was remove 'info' which is userdata (i.e. a c++ class/struct) from the upvalues (variables from outside a function, stored with and used in a function) from the persistable jukebox_toggle_track function. Now the only upvalue that function stores is the index i.\nEvidently that userdata was not properly configured for storage. There are likely still problems with persisting the jukebox; e.g. if the music list changes between loads. \nI'm ok with merging this PR as is, because I think it's a bit cleaner, but preferably UIJukebox would be excluded from saves, and the callback wouldn't need to be persistable. Since this hasn't changed in many releases, it's probably safe to not even add a contingency for old saves.. Not sure what you mean here @Alberth289346 \nThe issue is that info is a C++ object not a lua object, and doesn't have the prerequisite methods defined on it to be able to be persisted.\nThis PR doesn't address that directly, instead removing info from the persist list. In truth we don't want UIJukebox persisted at all.\nTo summarize: this PR is not the fix we want for this issue. The question is whether the new code is cleaner and should be merged, or is messier or just as messy and should be rejected independent of being a workaround for the bug at hand. I haven't decided yet.. That is weird... I have never heard of it happening. Try unplugging your mouse. Closing as this is not reproducible, and there has been no response for months.. Missed a file it seems.. Did you do anything with the screen in the psych room?\nThis error would happen if there was no screen in the room, if it was inaccessible, or possibly if it was in a corrupt state.\n(Note: I have not yet looked at your save). I guess this means that you are making a snap for us. \\o/. What version is this? Please fill out the issue template.. Did you mean for your PR behavior to depend on staff policy? I don't recall anything about policy in #1290. This and 1406 should be merged into one PR.\nLDocGen comments for new non-trivial functions are mandatory. \nBusted unit tests would be appreciated.\nIt will take me awhile longer to evaluate whether the approach is sane or will lead to unintended side effects.. @lekoook are you able to try the latest git version of CorsixTH. I have made changes to the memory handling in movies - though mostly from the point of view of patching memory leaks. Asan is clean for me.\nAs for compiling the latest git version. Read the instructions on the wiki. In particular if you had to copy the source directory then you are missing -DUSE_SOURCE_DATADIRS=ON. We have CI builds for Windows - https://github.com/CorsixTH/CorsixTH/wiki/Testing-Builds. Unfortunately as I said, with ASAN enabled I am not seeing any bad memory access. I am using ArchLinux ARM with ffmpeg 4.\nYour backtrace is in a free and hints at earlier corruption.\nDepending on how comfortable you are with this stuff you could run asan or valgind yourself, or post your ffmpeg version and md5 hashes of your movie files and I'll see if I can spot anything.. Can confirm I'm getting a double free on Ubuntu 14.04 in the latest master. I must have broken compatibility with old ffmpeg / libav versions inadvertently.. The above PR fixes the regression in 16.04 entirely for me. 14.04 / LibAV seems to have other problems, but they are unrelated to this ticket.. Further tests show that my 14.04 / LibAV VM behaves the same way in all versions back to 0.50, which is the first version it will build on; so that aspect is not a regression.. As for the luacheck errors, I'll fix the stub arguments in the functions. I need to figure out how to make it ignore the globals in describe blocks for busted (or maybe just the whole Luatest folder) because they are specifically handled and cleaned up by busted.. Resolved luacheck errors.. As I'm fairly certain this PR won't help the issue, lets hold off on merging it until someone can test with ffmpeg 2.8.14.. Does this error happen every time for you? I have run this brew version of CorsixTH on MacOS High Sierra before.\nI can see the error in the stack trace, and there is indeed a problem; but it should only trigger if you use a multitouch gesture in main menu, or during the intro movie.. GOG.com version worked, demo didn't, but the error was about the multigesture event handler? That is very curious.. Could you see if your gamelog.txt is always the same, or if the error there is actually unrelated to the not starting?. The issue is outside of CorsixTH. Ensure your operating system and drivers are up to date.\nSorry there isn't much else to go on.. @utkusen are you able to test with the latest master?. Closing because there is no information to fix the error and no update from the submitter.. I am open to the idea, but not willing to take it on myself. Do you have any experience?. Thank you for the report. https://github.com/CorsixTH/CorsixTH/blob/61f0f7c2e71bc9e39f551769c61d5976b3530bab/CorsixTH/Lua/entities/humanoid.lua#L675\nIt appears that the line that failed failed because a patient didn't have anything in their action queue, which is an illegal state. Unfortunately the stack trace doesn't tell us what caused that.. If you can, try the latest master. There has been some effort to improve memory management recently. I am assuming the slowdown you are seeing is from leaking video ram.. Your systems could not be more different from one another - how long were you playing before you noticed the slow down, and did it also seem related to zoom to you?. From @mlugg 's description the game got slower every time he zoomed, so even resetting the zoom wouldn't help. You'd have to compare a game you started from the beginning without playing with zoom, and a game where you frequently switch zoom levels.. @CyberKiller40 what screen resolution are you running the game at?. Duplicate of #1338 . That map looks broken to me. Closing as a duplicate (you should not have a temporary wall in front of your doors, did you make this map?). Ok, I'll check my own level 9. Maybe the game is not opening the map correctly.. The map itself is broken, tile flags were not set correctly.\nThis is a low risk fix and should land in 0.62.. Note that you will have to load a save from before that map, e.g. just before victory on the previous level.. @ElvarT good work with these bug reports. Are you able to use 0.62-rc2?. There is no built in option for configuring the autosave period. It's easy enough if you want to fiddle with the lua;\nOpen CorsixTH\\Lua\\world.lua\nand copy the line shown here:\nhttps://github.com/CorsixTH/CorsixTH/blob/47b9ed6c3402f0bd9d63eb177ae6e7126237b6c1/CorsixTH/Lua/world.lua#L1196\ninto onEndDay for instance.. Accepted as an enhancement idea - making the autosave period configurable.. It is all cleaned up when the program exits (doesn't show up on the ASAN report) so it must be referenced memory.\nDo you know if this is a regression? I will take a look before releasing.. No, I haven't seen it. In my debug clang build with memory tracking it fairly consistently climbs to a little under 1GiB and sticks there.\nFrom pmap there are a lot of anon blocks.\nOn g++ without asan I am seeing about 350MiB. Again it is very consistent.\nAnd on g++ I don't see lots of anon blocks, most memory is in one that I assume is my heap.\nIt would be helpful to dump the objects\n. Normally you would keep your custom levels in the ~/.config/CorsixTH/levels directory so they would carry over.. LGTM. I've switched us from using the deprecated Travis CI Service to the current Travis CI App on GitHub. Perhaps it will help?. Does this happen when you start CorsixTH again?. Those are Theme Hospital save files, not CorsixTH saves.\nThe CorsixTH saves should be in the same location as gamelog.txt, under the Saves directory.. So on a brand new game (not loading the save) speed works correctly or are there two issues?. Alright... the issue with your build in the screenshot is that it expects to be installed (sudo make install). If you want to use the data files directly from a git checkout then add -DUSE_SOURCE_DATADIRS=ON but leave everything else the same.. Was this installed with the Windows Installer?. Could you add print(path) to CorsixTH/Lua/app.lua line 1264 and print(file) to CorsixTH/Lua/app.lua line 1266.\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/app.lua#L1264\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/app.lua#L1266\nThen paste the full output.. Sorry, newlines before the additions Curious there's no path information printed, but I'm guessing the change caused an error.\n(Sorry I missed your update). On a quick read through, it looks good.. Ok if I merge this @mugmuggy ?. Was the vomit outside the hospital caused by invalid map flags? This ticket reads like that one. Since I cannot reproduce this myself, are you able to add a line at https://github.com/CorsixTH/CorsixTH/blob/47b9ed6c3402f0bd9d63eb177ae6e7126237b6c1/CorsixTH/Lua/window.lua#L1008\nIf you look inside the CorsixTH.app, there should be a Resources/Lua/window.lua file.\nprint('keypress: char: ' .. char .. ' cursor_pos: ' .. self.cursor_pos[1] .. ', ' .. self.cursor_pos[2])\nThen paste the resulting log of typing a word and having the cursor move on you. . sorry, I meant to put that on the previous (or following) line, not as an and to the assignment expression.. Ah! Ok. I'm not surprised our handling of key_mapping has bit rotted over time.. @Thorworx what was your use case for remapping number keys?. Fixed by #1486 - entirely new hotkey mechanism.. Is it the original save game from 0.60 with the issue, or did it happen later while playing with 0.62?. My question was, did that save have the issue before you ran it in v0.62, or only after playing awhile after?. Excellent report. vomit.lua needs a check that humanoid.tile_* are inside the hospital in action_vomit_end. An assert could be added to newObject as well.. Thank you mugmuggy. There was another map we shipped like that which I corrected for 0.62. I haven't looked at this save yet. Is it another one of ours?. Looks pretty good to me. If you're able to add busted tests to the Luatest/specs folder that would be great. Our testing is still a bit immature though so I understand if it's too much trouble.. Doesn't help that their site is down right now. I don't have to change anything about lpath, but I've been running it exclusively on Linux. I'll look at Windows later.\nI'm happy that you managed to get some tests going. I'll separate out the mocks later so tests can share better - as I mentioned, that whole aspect is a bit underdeveloped in CorsixTH at the moment.\nReally what's left is going through the announcements and assigning sane priorities / decay times I think.\n. Merged. Closing in favour of #1446 . It is likely an issue with the campaign. The maps are due for a careful review.. Need to exclude Apple. Updated to hopefully address your concerns and mine.. Ready to merge. Fixed by #1478 . The warning doesn't relate to you losing. It means that the levels were never updated to our new format from several versions ago. It is harmless.. So far there is nothing for us to go on in this ticket. Can you reproduce the loss with one of your saves you could attach?. @Tigertye you will need to upload it somewhere. Dropbox or similar.. I haven't checked yet. I or another developer will update the ticket either way when we do.. Thanks @mugmuggy \nWas it one of our maps, or one from the internet?. Thanks mugmuggy. Closing as this is a 3rd party map issue. destroyEntity loop is safe because it breaks out of the loop immediately on delete.\nHumanoid and findAllObjects loops in crashRoom are safe. Not over entities.\n. Earthquake case is safe all the way up (looping over room objects not entities). Action case is not safe, action calls machineUsed, called inside ipairs loop over entities in world:onTick . I will create a new issue. crashRoom shouldn't happen in machineUsed, it should happen in a new loop in world near the end of tick()\nEdit: for a less impactful fix, destroyEntity could just mark entities as destroyed and the actual cleanup done later in World.. If the destroyed entity is earlier in the entity list than the current entity, or is the current entity, then the next entity in the list will have it's tick() skipped. This cascades for every removal, so if 5 entities are removed (<= current), five will be skipped that loop through. Removed entities ahead of the current one cause no effect.\nipairs is basically equivalent to for (i = 1; table[i] != nil; i++) { res = table[i]; ... }, and table.remove(t, x) does something like for (i = x; table[i] != nil; i++) { table[i] = table[i + 1] } (excuse the C style notation)\nAn additional benefit to doing all the removals at once is that we can use a single pass (worse case order N, instead of order N^2). ```lua\nlocal destroyed_entities = 0\nlocal entity_count = #self.entities\nfor i = 1, entity_count, 1 do\n  if self.entities[i].destroyed then\n    destroyed_entities += 1\n    self.entities[i] = nil\n  else\n    self.entities[i - destroyed_entities] = self.entities[i]\n  end\nend. This looks good to me. RDY?. I think this needs cleaned up later. Can you split this into two issues so we can track each please.. By \"to match\" do you mean too many?. The rate of people coming to the hospital is defined in the level files; and adjusted to an extent by your hospital reputation.\nIs this only a problem for you with Coffalot?. @Feanathiel between that line and \nhttps://github.com/CorsixTH/CorsixTH/blob/b969a05dc56ec958fb0d570e3d2f3c01d566ecd2/CorsixTH/Lua/world.lua#L1212 I agree the spawn rate looks fishy. I'd need to do more research to see if it's actually wrong; but it looks like it would spiral out of control.\n@MarkL1961 @mugmuggy do either of you know the spawn behavior of the original game.\na) If the level file skipped a month, would the spawn rate stay steady or keep increasing by the last specified amount?\nb) should the spawn rate have anything to do with the current hospital population?\n. Population is a really weird name for that variable. Thank you for doing the analysis.\nI guess this is working as expected then. Consider it a time pressure to meet the win criteria.. Coffalot is our own campaign - I don't know if it's intentional or not, but others have been ok with that level.. This is a duplicate of #624 . Related to #968. I'd like to have more evidence one way or another before any action is taken on this issue. If it can be proven that there is a major (and unwanted) discrepancy then we can address it; otherwise we'll close this.. So it is deterministic whether they will gain a specialty (given infinite time). If (trainer skill - trainee skill) / specialties being taught > the threshold for each specialty?. Or is training value unrelated to your first equation and just assigned when visiting those 3 things?. Actually you wrote the same formula for both. I don't think that is right?. @Icenowy would it be better if we allowed the algorithm to break after each of those characters instead? Do you have a list?. I have a proof of concept. After testing some edge cases I should be able to replace this PR.\nShould lines break before or after the punctuation?. Closing in favour of #1478 \n. The second error is not lua, it's macos open file limits. I have seen the same error in mysql and elsewhere. I don't think we should be holding lots of open file handles so I will look into that.. For open file descriptors I see that one is being open for every file in the directories that are opened. They seem to get garbage collected over time. Just leaving the file picker in one spot for awhile they go away.. I'm working on a PR to prevent the large number of files from being open at a time / left open. In the mean time if you want to test bumping your file limit: https://apple.stackexchange.com/questions/33715/which-command-controls-the-open-file-limits. I thought there was another issue open for the multigesture error, but I don't see it now. If you want to open a second issue for it - that error comes up pretty much any time you do a multi-finger gesture on the trackpad outside of the game, because the stub handler is missing from ui.lua\nAs far as I know, it is harmless.. If you enable debug mode (through the config file), you can disable the camera locking. The original game wasn't meant for such things so they have some glitchy areas outside the normally visible bounds of the map. There is really no good solution.. Fixed missing err variable.. @colinjmatt The fix for that issue is already applied. That is what my prior comment was about. Sorry for the confusion.. The android port was an independent effort by @alanwoolley. I haven't heard from him in some time.\nhttps://github.com/CorsixTH/CorsixTH/blob/8f31878e4fbd4805a5cc8bc4702d87991735722a/CorsixTH/Lua/graphics.lua#L260\nThe assertion suggests your original game data is corrupt. Where did you get it?. Actually that is the main menu graphic that should be installed with the game, not original game data.... Let me know what the result is of running the portable version, extracted to a different location. . As I mentioned, I don't believe the file it's asserting on is from the original game, it should be loading mainmenu1080.dat/pal from the CorsixTH/Bitmap folder.\nIn Graphics.lua, between the existing line's 401 and 402, add\nlua\nprint('bg_size_1: ' .. tostring(bg_size[1]) .. ' bg_size_2: ' .. tostring(bg_size[2]))\nJust to verify the file it is trying to open, and the size being passed in.. Sorry, I meant ui.lua, not graphics.lua.  Good that you posted that!. No, that's exactly what it should be reporting. The failure is somewhere in https://github.com/CorsixTH/CorsixTH/blob/3a972fd6be37b0a901df12dfe70235ab27c179d7/CorsixTH/Src/th_gfx_sdl.cpp#L789 but unfortunately that code essentially reduces all errors to false. \nUnless you are able to / feel like compiling yourself I'm going to have to prepare you a special build of CorsixTH to diagnose this. At the earliest that's going to be 8 or 9 hours from now.. Ok, extract this over your CorsixTH directory, replacing all files, and try to run it.\nCorsixTH-bitmap-debug.zip\n. I do not accept donations, but thank you.\nWe know from that error that the problem is related to acquiring memory from your video card to display the main menu. It's unfortunate that Direct 3D responded with 'UNKNOWN' instead of giving a more detailed description of the problem.\nIf I were to bet - I'd guess your video card / driver doesn't like allocating textures as large as 1920x1080.\nIn the short term:\n Try commenting out (--) the following line in app.lua:\nhttps://github.com/CorsixTH/CorsixTH/blob/8f31878e4fbd4805a5cc8bc4702d87991735722a/CorsixTH/Lua/app.lua#L284\nand\n Ensure your game resolution is no higher than your monitor resolution, either in the main menu, or in %APP_DATA%/CorsixTH/config.txt\n* Be wary of zooming out (that also creates large virtual textures and might crash on your system)\nIf that makes you a playable game; I will see about providing alternative mainmenu graphics to display on smaller resolution screens.\n. No you didn't, I did. Comment out line 462 in app.lua as well. Apparently we load the background twice - . Thanks - same cause; the same fix should resolve it. I am curious if zooming causes an error, like I speculated above.. I'm going to work on a patch that will load a more appropriately sized menu background for the target game resolution. I think that will fix the issue for you (and presumably anyone else with similarly restrictive graphics cards). @Nox13last could you test the CorsixTH build from https://ci.appveyor.com/project/TheCycoONE/corsixth/build/304-xvjguhef/artifacts (without your lua modifications).. Actually this build instead: https://ci.appveyor.com/project/TheCycoONE/corsixth/build/304-hfujysge/artifacts. No rush. Fixed. Missed an include that MSVC didn't care about.. looks good to me. It occurs to me we could (and should) have used isPlayerHospital() rather than hard coding 1. It won't matter until multiplayer though.. Fix confirmed by @Nox13last. RFC because this is untested.. Switched to the same error handling we use elsewhere in this routine. A future refactor could switch to exceptions.. Marking RDY. I don't hold out much hope in attracting people from the issue.. @mugmuggy I think https://github.com/CorsixTH/CorsixTH/blob/309460a939630c1adde9fc24f754cea1a1d8f71d/CorsixTH/Lua/dialogs/edit_room.lua#L1153 is the same issue - if litter and something else was on the same tile, the thob could be 62 and allow a door where it shouldn't?. I meant that the litter could be masking another object that should prevent the door being placed, but since it only does the thob check the litter shows up and not the bench?. I'm inclined to accept this as is.. I like this change as is.. Thanks @mugmuggy\nThe original behavior seems better, and fairly easy to implement.. @Icenowy could you confirm that this displays the text correctly. It looks right to me, but since I can't read it I want to make sure I'm not corrupting characters or something.. Improved readability. @Icenowy verified the fix on irc.. Oh, I also added ideographic space (0x3000) to the list of characters, since it seemed like it fit in.. @colinjmatt could you check that this PR eliminates the error.. Ok. Good enough for now. In the future it may make sense to propagate these events and use them in scroll boxes.. Reads ok to me now \ud83d\udc4d \nRDY?. @mugmuggy what is the state of this PR? Ready to check?. Thank you @leiget \nAs mentioned above, some changes are requested - mostly related to formatting, a few more significant. I like what you are doing here and think it will improve the game. I hope you continue with this.. Yeah, the afterLoad stuff is wrong. Basically in all cases now you want to remove all keymaps and set them all on load as well as initialization.\nFor each UI object with keymaps make a function to set keys and call it both at the end of afterLoad and in the constructor. Clear any mappings.. Close @mugmuggy, but unfortunately in this case it can't be guarded because the keys could change. Just run the handler every time in afterLoad.\nIdeally we wouldn't save them at all, but that can be future work.. Skip if old in this case, and also remove the old binding.\n```lua\nlocal function setKeyHandlers(ui)\n  ui:addKeyHandler(hotkeys[...], callback)\n  ...\nend\nfunction UIPlaceObjects:afterLoad(old, new)\n   ...\n   setKeyHandlers(self)\nend\n```\nAnd in ui.lua\nlua\nUI:afterLoad(old, new)\n  self.key_handlers = {}\n  UI:setupGlobalKeyHandlers()\n  Window.afterLoad(self, old, new)\nend\nSince we are now eliminating all key handlers in all save games with the above, also remove any old afterLoad conditions that manipulate them across the code base.\n. If you like later tonight I can write a patch file. Commit that patches your afterLoad handling; doesn't address @mugmuggy's comment about just using names and doing the mapping in ui.lua (which I think is a good idea)\nhttps://github.com/TheCycoONE/CorsixTH/commit/c78e59c23aa173aebb1f0b98e395ef9c3af9ac1d\nLet me know if you want me to apply it directly to your branch. (I only touch other people's pull requests with permission). They were removed intentionally. How afterLoad works is that when you load a save game, it calls the afterLoad functions (you can follow the path from app, up through the various objects) to convert the save to the current format. Since the current format doesn't use any of the old keypress handlers, we do not want to add them to save games, no matter how old. I explicitly drop them all on all save games in ui.lua.. Why can't it go in setUI where I put all the others?. @leiget The commit I sent you removes all of the hotkeys when loading the save - prior to that the behavior was to keep them. Anything open during the save is not 'constructed' again, but loaded with all the variables as is at the time of save - which is why we have to run afterLoad to fix things.\nThe key line from my patch is: https://github.com/CorsixTH/CorsixTH/blob/22be2fbe4e27615e420d0e3f6022e444cd01c8af/CorsixTH/Lua/ui.lua#L846. Please remove your backup folder from the commit.. Coming along!\nTo summarize the outstanding issues:\n- [x] I'd like to see the change mugmuggy mentioned in https://github.com/CorsixTH/CorsixTH/pull/1486#issuecomment-434100279 - the hotkey lookup moved to one spot in the addKeyHandler function, instead of everywhere.\n\n\n[ ] Some white space and formatting changes to pass travis tests and conform to our code style; most of which I commented on from the start.\n\n\n[x] Change the storePosition / restorePosition to use a separate entry for each position rather than only storing the modifier to combine with 0-9.\n\n\n[x] Investigate code reuse between print_table and table_toString\n\n\n[ ] tests?. From my phone so I haven't tested this but my feeling is that return should be removed. The addRemoveDebugKeyHandlers call could then be moved to ui if it's still needed at all.. @leiget No, that's not what I had in mind at all. My point was that both are functions to recurse through tables and convert them to human readable strings. Currently the implementations differ but I don't see much functional difference. \n. The forMenu code is rather specialized and should be a separate function, not part of utility.lua but simply local to menu.lua\n\n\ne.g.\n```lua\nlocal function hotkeyToString(opt)\n  if type(opt) == string then\n    return string.upper(opt)\n  end\nlocal result = \"\"\n  for _, v in ipairs(opt) do\n    result = result .. tostring(v) .. \"+\"\n  end\nif result == \"\" then\n    return \"\"\n  end\nreturn result:sub(1, result:len() - 1)\nend\n```\nI don't actually see any other use of table_toString in your code. print_table itself is only used in one place, where it is dumped to the console / gamelog in an error situation, so the exact output is open to change.\nWhat I was actually looking for was using whatever table serialization function you needed to get the result you wanted, and either changing print_table to just call it, or remove print_table altogether; but as is the print_table serialization handles more cases than your's, in particular it has two safeguards against table cycles, whereas yours would lock up.\nAdditionally your type == '...' tostring() code is somewhat redundant (and tostring(nil) == 'nil' as well, so that special case doesn't need to be there).\nHowever if you have no further need with forMenu moved out, maybe we can leave table_toString or whatever it ends up being, out.. @leiget No, I don't like passing in for_X to a general purpose function.\nI think you'd be better suited by an array_join(tbl, separator) method anyway.\nTable key order is undefined so iterating with pairs is unsuitable for generating a config file.\nYes your new classes need to be added to the globals list in luacheckrc. Will do. I have that aspect done, so I will clean up the commits and post them later today.\nNoticed another issue in the mean time. table.unpack is not in lua 5.1 or luajit, so that table.clone function isn't eligible.\nI'm not sure we still need it ... check after I post my changes.. https://github.com/TheCycoONE/CorsixTH/commit/894588733054494358b4be89c6ef0bc9466c6a79\n. Sorry, version compatibility issue: \nhttps://www.lua.org/manual/5.2/manual.html#8.2\nI'll have to add a wrapper function that calls load on 5.2+ if there isn't already one.\n. Try adding:\n```lua\nif not loadstring then\n  function loadstring(str)\n    load(str)\n  end\nend. Ok I'll make the polyfill when I'm on a computer. Probably do a version check instead. And it belongs near the top of utility.lua\nThere should be other examples.. Yes, like loadsting_envcall if you want to try.. In retrospect loadstring_envcall should have been what was used anyway. Just switch loadstring to loadstring_envcall.. It is actually table.unpack that isn't supported. You were better leaving clone but changing the implementation. E.g.\n``lua\nfunction shallow_clone(tbl)\n  local res = {}\n  for k, v in pairs(tbl) do\n    res[k] = v\n  end\n  return res\nend\n. On a related note, the default scroll keys should stay the arrows. git itself can find those line problems.git diff master --check`. There is a list of globals in .luacheckrc, add these functions and classes there and commit.\nYou said earlier you had, but I don't see the change in your PR.. Is there anything else pending for this PR? I am ok with leaving better numpad handling for s follow up.. The giant function with the table renamed several times should be split up. I can help with that if you are done with it.. Doesn't work with luajit \nui.lua:469 attempt to call field 'unpack' (a nil value). Sorry about the delay:\n659254ef608e8b291d3035a2b59c6dcd5c18347f. @leiget the commit before the one you merged on the same branch had the pack fix for luajit.. I also noticed in my testing that using modifiers doesn't work with scroll keys (e.g. ctrl+w) - we need to fix that or block them from being set.. Yes I mean the basic scroll without the speed shift.. > \n\nIf a python file doesn't have a newline at the end, does it have a little arrow pointing at a \"no\" symbol?\n\nIf any text file is missing the training newline git (and github) will flag it. In github it shows up as the little arrow with the \"no symbol.\" Many Unix tools expect a trailing newline on text files.. I think this is ok. I'll play test before merging.\nHow do you feel about a rebase to clean up history. Normally we insist on it, but this is kinda big and collaborative. We made an exception previously for SDL2.. And I'll have to look at the busted failures. You need\n```diff\ndiff --git a/CorsixTH/Lua/config_finder.lua b/CorsixTH/Lua/config_finder.lua\nindex bcccb681..31e94915 100644\n--- a/CorsixTH/Lua/config_finder.lua\n+++ b/CorsixTH/Lua/config_finder.lua\n@@ -805,7 +805,7 @@ local string_03 = [=[\n end\nfor k, str_val in pairs(hotkeys_values) do\n-  local status, lua_val = pcall(loadstring_envcall('return ' .. str_val))\n+  local status, lua_val = pcall(loadstring_envcall('return ' .. str_val), {})\n   if status then\n     hotkeys_values[k] = lua_val\n   end\ndiff --git a/CorsixTH/Luatest/spec/utility_spec.lua b/CorsixTH/Luatest/spec/utility_spec.lua\nindex c9e0acc5..87c352c6 100644\n--- a/CorsixTH/Luatest/spec/utility_spec.lua\n+++ b/CorsixTH/Luatest/spec/utility_spec.lua\n@@ -31,7 +31,7 @@ describe(\"serialize\", function()\n   it(\"serializes a simple key value table\", function()\n     local test_tbl = {foo='bar', [true]='candy', bar=42}\n     local res = serialize(test_tbl)\n-    local res_tbl = loadstring_envcall(\"return \" .. res)()\n+    local res_tbl = loadstring_envcall(\"return \" .. res)({})\n     assert.same(test_tbl, res_tbl)\n   end)\n```. Ok. This is not the PR I would suggest cutting your teeth on so I'll handle it now. Thank you for your persistence!. Nothing for you at the moment, unless you could rebase on the latest master to see if it fixes appveyor.\nI need to test on Windows, then merge.. Neither probably. If you have a remote called upstream for CorsixTH/CorsixTH then git fetch upstream; git rebase upstream/master. That last commit very much broke things... ok, just leave it to me.. No, I can recover it.. Probably not what you want to hear, but I found a bug:\n1. Change some hotkeys\n2. Click accept\n3. Go back to hotkeys, change some more\n4. Click cancel\nInstead of going back to the previously configured hotkeys, it goes back to the original set from when the game was loaded.\nWant to fix this after the merge?. Ok, I had started the rebase/merge. I'll pull your changes into it.. Verified your fix. Merged. Leiget, now that this is merged, please consider updating the wiki, specifically: https://github.com/CorsixTH/CorsixTH/wiki/Hotkeys and the relevant programming ideas section.\nAlso due to the way you used git, your private repo / master branch is going to be a mess. If you have upstream as a remote:\nbash\ngit fetch upstream\ngit reset --hard upstream/master. https://help.github.com/articles/configuring-a-remote-for-a-fork/. I'm not personally experienced enough with Docker to review this, but I don't see the harm in including it as long as it's maintained, and the documentation on how to use it is added either to this file (comments) or the wiki.\n@emorrp1 are you able to look at this?\nShould we specify a particular version of Ubuntu? latest makes me nervous.. Encountering build failures with ffmpeg 4.1. I doubt that hardware acceleration is implemented for smacker or would be very useful for the low resolution videos in CorsixTH.. Fun, thanks for sharing. I gather from a brief look around that it was an automatic transformation using a tool you wrote for your own lua derivative?. @iAmRenzo please add version information, and try colinjmatt's suggestion.. I believe this is a duplicate of #1439 \nAs a workaround, there is a male patient, probably sitting (near / in toilet), that is dying. If you load an earlier save and keep them up / outside the room when they die you shouldn't get the crash.. Right, max_bonus can be removed.\nI'll add a commit for that, and modify this commit to fix the parenthesis style.\n. This seems like an unreleated change?\nEdit: nevermind, I see the commit message mentions adding the update button\n. This line is not needed, you pause in the next condition.\n. Neither this line nor the next are needed, the pause is done above, and the blue filter is done below.\n. missing names and entity parameter descriptions\n. missing !\n. These 5 lines are equivalent to:  silences_pointer = (silences_pointer % #silences) + 1\nThe above is more readable to me, but maybe not for everyone, do what you want here.\n. Missing num_silences in documentation and !'s\n. flag_a is not a very descriptive name.  I understand it has to do with whether we are currently playing a sound in random sequence, which sounds more like what 'self.playing_sounds_in_random_sequence' would be for.\n. Only if statements at the beginning of this function.  Is this todo out of date, referring to another function, or about the calculation of the return value.\nE.g. you could not calculate south / east if neither north or west were useable.\n. I think you would have been better off with this being onEndPause instead of being a toggle.  It would make your code here and later a little simpler.\n. With the change I mentioned, this could call TheApp.audio.onEndPause here and pause_state_changed could be removed.\n. What is 3320 you are referring to?\n. Should be dirsep (package.config:sub(1, 1)), \\ is not the path separator on linux or OSX.\n. Was this comment left in accidentally?\n. Someone else should clarify but I don't think these changes are valid, I think utf8 belongs in the Encoding function not the Language function.\n. In this case isn't \"clique\" the proper word, or maybe cliquer?\n. ^ with the caveat that my french is horrible and I'm probably wrong. :)\n. hat should be that\n. Still looking for a comment here.  Something brief to explain why we're removing the assignedHandyman from the task.\nIf you're too busy still I'll write something.\n. Dangling whitespace\n. Dangling whitespace\n. Dangling whitespace\n. These two functions could use some documentation.\n. Shouldn't these numbers line up with the others?\n. spacing, same throughout function.\n. Surprised we don't have something more general for this.  Possibly a point for future refinement - don't change in this pull request.\n. Remove brackets\n. Should be a space around operators\n. Less math if this is kept in the same units as spread_factor. i.e. 200.\n. space after comma\n. space around operations\n. extra brackets in this if around the not function\n. this if reads a bit messy, in part because of the extra brackets and in part the nested comment.  Non-obvious reasons a patient wouldn't be infected should be elevated to function comments, obvious reasons don't need to be documented.\n. These are debug messages?  They should be hidden behind the debug flag or removed.\n. space around operator >=\n. >= 87\n. < 87\n. < 87\n. Fix dangling whitespace\n. Fix dangling whitespace\n. dangling whitespace\n. dangling whitespace\n. dangling whitespace\n. dangling whitespace\n. dangling whitesplace\n. dangling whitespace\n. dangling whitespace\n. No, > is right, older save games wouldn't have sounds to play.\n. this print now needs to be indented\n. Maybe these lines can be removed because addOrRemoveDebugModeKeyHandlers() does the remove anyway.\n. No that's alright, I think it's good I was looking too narrowly.\n. Good catch.\n. I find that last sentence patronizing.  A link to the debugger tutorial would be appreciated though.\n. LDocGen was custom made by Corsix.  I'm quite ok with moving to some more standard format as long as all the tooling is updated at the same time.  Such a project is out of scope for this pull request though.\n. A couple things about this.\na.  The way this is written that code is not in the else block, but it's indented as if it were.\nb.  I think this block could be pulled outside of the if(!bGotScriptFile) block so that it would be pushed regardless of whether the interpreter was specified on the command line?  I'm not 100% what's happening with the lua_State here though.\n. First part of this condition is now redundant.\n. Can get rid of this one too?\nOtherwise perfect.\n. Unless I missed something, iPassable and iNFlags are defined the same for all the pathfinder types?  So a derived TryNode isn't needed?\n. Nevermind, I see that objectVisitor and idlePathFinder are a little more tricky.\n. Could you explain why\nif not current_room or current_room.room_info.id ~= \"research\" then isn't sufficient?\n. I'm not sure why you changed this line, or the other place you substituted Return for return. It's not documented in your commit.\n. Can leave out LUA_INCLUDE_PATH and LUA_LIBRARY_PATH. The Lua compiled in is from CorsixTH/deps which is what we desire. LUA_PROGRAM_PATH is only used for running LDocGen (on the make docs target).\n. Since you have compiled lua 5.3.2 for Ubuntu, perhaps you could replace the one in CorsixTH/deps. I believe that repo still has 5.3.1\n. There isn't any reason for this table to exist in lua, unlike C it doesn't add any type safety since you can refer to unset keys, and also unlike C it's not a free call. Ultimately you're saying go_home_reasons[\"CURED\"] = \"cured\". You could achieve a little bit of type safety with something like go_home_reasons.CURED = {}, but it's probably best to leave the reason as a string and document the possible values on goHome().\n. This indentation change looks wrong?\n. I think it's good as is.\n. What happens if you put a condition here for numlockactive on and off, setting to numbers like you do when on, or arrows like you do in the file right now when off, then remove the condition you added above.\nI think it would be more straight forward.\n. There is no way for x_diff or y_diff  to be false here.\n. Should be removed, good catch.\n. Or neither one, countCured use to be called more than once, but not now that they can't be cured and over_priced. I'm fine with changing it either way.\n. Not sure what you mean here? Are you talking about renaming the goHome reason?\n. Agreed, there is reference in the original theme hospital to a world spawn rate and a pie chart of what is allocated to each hospital, we should do our hospital's spawn there.\n. Yes, sorry missed this - I was only looking on the conversation page.\n. After reading the description of AllocDelay I agree.\nShould be 0.25 until AllocDelay, and this after.\n. I removed it in the one where we changes hospital = nil to despawn();\n. Will be 12 months since save. Need to subtract current month.\n. The only access this needs to private THMap properties is m_pPlotOwner and there is a public method for getting the plot owner.\nIn conformance with C++ Core Guidelines C.4, this method should not be a part of the THMap class. Since it's not used outside of this file, it can be defined as \ncpp\nstatic void check_dividers(THMapNode* pNode ...)\n{\n...\n}\n. Use a reference rather than a pointer here. & instead of *.\nEdit: Looking at the usage - return the splitTiles vector instead. Since C++11 this is a move operation which doesn't involve copying the elements so there is no reason not to.\n. I think luacheck explicitly ignores redefining _ so it can be reused in cases like this. Nicer than introducing a second ignore name.\n. west_cell_flags isn't used until 294, so this line could be moved down.\nEdit: I wonder if this method couldn't be made clearer. It should be commented at the top, the setCell lines maybe should be broken up, e.g. local wall_type = ... and move self.th:setCell outside of the inner condition.\nYou are essentially setting the west wall and/or the north wall to the inside or outside style of the adjacent room, depending on where the room is in relation to the new plot (south, north, east, west respective of the order of the conditions if I'm reading correctly).\nIt may be possible to refactor this to use a direction table, something like:\n``` lua\nlocal dirs = {south = { block_id = 2, room_cell_flags = cell_flags, adj_cell_flags = north_cell_flags, tile_cat = 'inside_tiles', wall_dir='north' },\n north = { block_id = 2, room_cell_flags = north_cell_flags, adj_cell_flags = cell_flags,  tile_cat = 'outside_tiles', wall_dir='north' },\n east = { block_id = 3, room_cell_flags = cell_flags, adj_cell_flags = west_cell_flags,  tile_cat = 'inside_tiles', wall_dir='west' },\n west = { block_id = 3, room_cell_flags = west_cell_flags, adj_cell_flags = cell_flags,  tile_cat = 'outside_tiles', wall_dir='west' },\n...\n}\nfor _, dir in pairs(dirs) do\n  if dir.room_cell_flags.roomId ~= 0 and dir.room_cell_flags.parcelId ~= dir.adj_cell_flags.parcelId then\n    local wall_type = self.app.walls[self.app.world.rooms[dir.room_cell_flags.roomId].room_info.wall_type[dir.tile_cat][dir.wall_dir]\n    self.th:setCell(x, y, dir.block_id, wall_type)\n  end\nend\n```\nLet me know what you think?\n. Yes, it should be the first argument.\n. This should not be here. addRemoveDivderWalls should only be defined in the th_map.c compilation unit. You will have to move the definition in th_map.c higher in the file (before it is used).\n. Maybe add some newlines after the conditions here (like @Alberth289346 has done in some of his refactor changes), just to make this take less horizontal space.\nSimilar with the next line should be split. I'm not sure the best ways to add line breaks to this one.\n@Alberth289346 what's your opinion on this function overall now?\n. What do you think about mixing the highPriority flag into the action, i.e. :setHighPriority() instead of ,true?\n(out of scope but the queueAction position number bugs me a bit too, seems like leaky abstraction)\n. Assigning more litter would happen on the next run anyway - is there a reason why the distance is (potentially) longer than when first entering the hospital?\n. Should assert or print paranoia debug output here, don't want exception cases to be silent.\n. name isn't great. Maybe rangeMapLookup?\nCould possibly be general enough (or generalized enough) to move up to utilities.\n. If we agree to call this a range map above I'd like to keep that name here - e.g. death_ratio_rangemap.\n. Ah yes, it was a very copy pasta sort of patch.\n. It's copy / pasted from initSavegameDir below. I didn't want to expand the pr by consolidating them this late into 0.60, but they have identical functionality.\n. I don't think you use strength anywhere except the next line. You might as well just have self.strength = self.hospital...\n. Should be a local function still (just top level), pass in self as a parameter.\n. This line is very long, please split it according to the coding convention (after and)\n. should be spaces not tabs\n. spaces\n. spaces\n. spaces\n. spaces\n. spaces\n. spaces\n. Any reason to switch to ipairs here?\n. Thanks, I will correct that.\n. info is the plural of info\n. It can't be called outside the program, it's local.\n. I considered it but I don't know where I would put it.\nIdeally I have in mind something like class.lua but for simple enums, so we'd write something like enum('Direction', { 'north', 'south', 'east', 'west' }) then everywhere we would write enum.is(point.direction, Direction)\nIf you don't mind I won't do that for this pr.\n. Does this ever happen? I don't think it's caught other places.\n. More efficient to use self:getObjects and loop through them here. Might be useful to extend getObjects to take type filter there instead (then simplify the getObject function).\nNot critical.\n. Always use braces\n. Use braces\n. Should be 2 spaces indented rather than 4, to line up with cheats.\n. 2 space indent, similar to other translation blocks.\n. This is a little roundabout, hosp:isInHospital calls a C++ function that tells it what hospital is at the current hospital and returns true if that hospital matches the hospital number. Because there are very few hospitals it doesn't matter, but this could be O(1) instead of O(N)\n. Should use brackets for popen and read. Could potentially be used everywhere not just OSX, so maybe this outer condition isn't necessary.\n. Spaces around assignment operators (consistency)\n. Maybe an extra newline, or move the body of the if onto the next line. Just trying to separate the break so it doesn't look like it might belong with the previous if.\n. Is this require still needed? I thought require \"TH\" was just to load in the c++ functions available through the provided TH argument, and had no side effects.\n. same with this one\n. and this one\n. and this one\n. ditto\n. etc.\n. Similarly, typically in lua if nothing is done with the require it's not necessary. (It's possible for the require to define globals, but that's considered bad practice.)\n. Try without them\n. broken record\n. \"\"\n. \"\"\n. Not a fan of calling it methods2, as that implies it's different from methods. It's not, but call on a metatable passes the actual table as the first argument. t is a fairly conventional name for that first argument. m would be fine as well in our case.\n. This function is huge. Suggest breaking it up, which might avoid using silly variable names.\n. Two spaces between * and skill. I know you didn't put them there, but since you touched the line anyway, might as well fix it.\n. Promote the local function to the top level. It doesn't use the closure and that avoids renaming the variable.\n. Promote this local function to top level, same reasons as the previous one.\n. Possibly promote the function instead. It does use the closure for self, so the entity map would have to be passed in another way.\n. May have noticed I'm not a fan of *2 variables. Here dx, dy are change in the x / y location of the mouse between calls of onMouseMove dx2 and dy2 are the scroll distances. Silly things are done with tick_scroll_amount_mouse otherwise I'd suggest dropping the temp variable entirely. Suggesting tsam_x and tsam_y instead.\n. Could move this function to top level and rename it font_reloader\n. Incidentally the only place this is used is to call UIBankManager.showStatistics https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/dialogs/fullscreen/bank_manager.lua#L318\nThe argument to that function is a bool for whether to replace the cursor.\n. dialog is right. With this notation self needs to be explicit.\n. Not identical in the nil case, but I assume the old value was made up anyway.\n. I think you still need to handle the 0 case here, otherwise math.floor(0 * 40 + 0.5) == 0, then you subtract 1, so you would be saying from 0 to -1 step 1, which seems like a bad thing to do.\n. And yet they get written to on Line 1286 anyway. But that's ok, closer to const parameters.\n. Disregard, lua handles this.\n. Use std::to_string http://en.cppreference.com/w/cpp/string/basic_string/to_string\n. This block was meant to be merged into the prior commit, not this one.\n. This commit just moves variables into the next_earthquake structure. A commit further in the series replaces this whole block.\n. Yes, suggesting I should restore the comment I cut here, or add a new one?\n. I set it to 0 in afterLoad because any save game with an active earthquake the actual earthquake is already in progress (warning period is over).\n. This needs to be updated for new screenShake methods.\n. Agreed to always set { active = false } but it's not enough to test that because an earthquake scheduled for the future is also active = false (but with a start_month and start_day).\n. I kill this function later in the pull request, so imo it's not worth documenting.\n. Can't test active here, active is expected to be false. start_day and start_month should be nil or 0 if the earthquake shouldn't happen though so the size test is unnecessary.\n. Works well, please remove this print.\n. world:adjustZoom has to deal with minimum zoom levels too, perhaps the logic can be consolidated.\n. Add your tolerance directly to the MinimumZoom returned by the function, since it's that value that is off, not the usage of it.\nI myself don't see a way around it. Be sure to document the magic number, and please include a space around your + operator.\n. If this function isn't called, drop it. It probably won't actually be done this way later anyway.\n. You don't need this, if there is any false you can exit early: if not tile_flags[flagtype] return false end and return true at the end.\n. To not mask the patient argument from the parent function. Though the parameter is redundant: patient is an upvalue here so pat is not needed at all.\n. Ditto\n. Why leave this here?\n. Let's not require declaring (or avoiding declaring) _. It is a near universal convention (mentioned in PIL and enforced by several IDEs) in lua to use _ as a dummy variable so the chance of conflicting with anything else is very slim, which makes this a micro-optimization.\n. This is currently the only documentation for current_state, best to replace it with a comment indicating what each of the current_state values mean.\n. I see, luacheck allows shadowing _, but not referencing it as a global. Fine then, we'll follow their lead.\n. It's still used.\n. I didn't mean animation numbers.... ok, maybe you should just document self.current_state (which was an index into the state array). Normally I agree with removing pointless aliasing, but in this case it may save a sneaky gotcha.\nIf operation_standby gets called with a : instead of a . then self would be shadowed by whatever table the callback happened to be a part of. This would be a programming error, but a subtle one that could be hard to catch - whereas room is safe.\nIf the name room is causing an issue, maybe pick a different alias.. Sorry, that's not true. I clearly need my morning tea.. Language extensions like this function belong in utility.lua\nPlease add spaces after commas, and between operators, matching the style of the surrounding code.. This condition is wrong. It was wrong before your patch too. The tile needs to be buildable and owned by the player.. Move this function up to file scope (out of the setDoorBlueprint function). We are progressing to a style where we avoid nested functions unless closure is needed.. Why did you put this inside the anim loop? It looks like it would do the same thing every loop iteration unless I'm missing something.. Add braces around invalid_tile == 0 to avoid confusion. Shouldn't this be +4. The comment belongs with busted, so luacheck should be added below. Shouldn't these settings (or at least the globals) go in the luacheckrc file with the other globals?. No, an oversight. I was going to write the callback function here, but I needed the closure.. Oops, yes this looks wrong.. Intentional - releasing should unlock every thread waiting for the queue. It's theoretical though because currently only one other thread would be waiting.. That's not how lua works, require caches the object in packages.loaded so every subsequent call pulls up the same object - it can even store state.\nI picked up the convention from https://github.com/pkulchenko/MobDebug/tree/master/examples, but I concede we don't use it elsewhere and it isn't entirely clear to people who aren't read up on lua - I'll change it if the functions work.. Still pretty sure you actually want not buildable or not owned by the player here.. Not sure if it's the cause of the error, but there should be no space between the ! and param here. See https://github.com/CorsixTH/CorsixTH/wiki/Coding-Conventions#ldocgen-syntax. Similarly there should be no space between ! and param or ! and returns. returns should be return and the type should be in round brackets.. Thanks for looking into it! Those changes seem like a prerequisite for this PR, as long as you want to continue using lua 5.3 bitwise operators.\nIt's unfortunate that we can't continue to automatically build and test lua 5.2, as I'm sure compatibility will degrade if it's not used. That said the situations where the latest CorsixTH was available, but only lua 5.2 are likely very close to 0 these days.\n. s/returns/return. Make 0.002 (mulitgesture_sensitivity_cutoff?) a variable (constant) defined near the top of the class. Let's avoid magic numbers.. 100 is another magic number, so put it in a variable too.. condition isn't necessary, just set them to 0.. Please add documentation to new functions.. indent. s/build/built. We don't copy tools to the output path. The only thing we need tools for is LUA_PROGRAM_PATH to run LDocGen. We also need lfs.dll and lpeg.dll in the tools directory for that to work (or we copy everything out to another directory like I did in my appveyor PR). lfs.dll and lpeg.dll need to be in the output directory; they should still be in the bin folder though. The tools folder only contains lua.exe and luac.exe, which we don't need to distribute.. Haven't tried it yet, but these don't look right: https://cmake.org/cmake/help/v3.2/command/add_custom_command.html#build-events\nDisclaimer, I haven't tested it, but I think it should read like:\nadd_custom_command(\n  TARGET CorsixTH POST_BUILD\n  COMMAND ${CMAKE_COMMAND} -E copy_directory\n    \"${VCPKG_INSTALLED_PATH}/$<$<CONFIGURATION:Debug>:debug/>bin\"\n    $<TARGET_FILE_DIR:CorsixTH>). Unfortunately at this time vcpkg update doesn't actually perform an update, it just finds a list of ports that have updates and tells you to remove and install them again. I don't know how fancy you want to get here.. Redundant?. I think you would also be ok with ./vcpkg remove --outdated then sending the whole list to install. On the train though so I can't test.\n. Checking the vcpkg source it sadly looks like this isn't allowed. So sure, clean and rebuild.. Prefer c++ style casts.\nIn this case though use SDL_TRUE and SDL_FALSE in the expression instead of casting.. Indentation  issue. Return the number of values you are pushing back to lua. In this case 0.. Indentation  issue. Shouldn't be a bug, it will just pass the top of the stack back as the return value, which is useless.\nMoving the top of the stack to 1 and returning 1 might be to return self, for a fluent interface.. You also need to bump the savegame version to 118.. Too much copy/paste... config_values.capture_mouse. Maybe mention ctrl-f10 here too. e.g. something like \"Initial mouse capture state when the game starts. To toggle in game press ctrl-f10.\". Since you added this header, the top five items in this file are all CMake related as well.. Not relevant to your PR, but I just noticed this toggle doesn't save, when the others do.. +1. Remove this line if there are other changes, should be one empty line.. I generally discourage building in the root source directory. Building out of source isn't well supported yet, but building in a build*/ subdirectory works really well.. 1 line. Thanks, I was going to do this but got sleepy \ud83d\udc4d . OK. I'm good with bumping the target language to C++14, but is it actually related to this commit in any way?\nSuch an important change should either go in it's own commit, or with the introduction of C++14 features into the code.. Downloading gtest shouldn't be the only (or even the default) behaviour.\nIf people have configured to use vcpkg, then gtest can be installed from there. We should use FIND_GTEST  to locate it and import the relevant macros.. I'd prefer GTEST_ADD_TESTS for the improved output when running ctest.. trailing whitespace here. We use a 2 space indent for lua code.. drop extra newline. Should be require probably; we don't want to load this file twice.. Still a problem with your file endings on all files - strange editor.\nThere should be a single newline at the end of the file.. Yes to both, but the second is out of scope for this PR.. Hold over, I can drop these.. This condition will never be true now.. Ah, thanks. I changed the file name in a later commit and didn't fix this line.. This should be correct at install time, not build time. The initial slash is going to be a problem - otherwise do paths get evaluated relative to the app on OSX?. A little late now, but /mime/?.so and socket/?.so shouldn't have been part of this. ? is replaced by the module name, which is mime.core and socket.core.. also add code_dir .. \"?\" .. pathsep .. \"init.lua\" for completeness - lua normally allows that naming convention.. Could be simplified to self.world:date() > Date(1,5,1) there are several places like this.. year, month, day is more conventional.. Nicer to use Date for the other side of earthquake and emergency as well.. Perhaps because I live so close to the US (where they use month/day/year), or because my country has 3 different standard date formats, but I would prefer an ISO 8601 date format because it's unambiguous.\nyyyy-mm-ddThh (since this is for humans not machines, and the 'hours' aren't real, I'm open to suggestions on the time seperator). double space after show_msg, was there before, but since you touched the line :). The date comparison would be shorter / clearer here world:date() >= Date(1,5). This comparison doesn't make sense, and shows the need for the world:date() comparison. It should be on the 15th day of every month after 4, not just May through December.\nI guess anything beyond refactoring belongs in a separate commit.. Another broken expression, should be all dates >= (1,5). Another broken comparison. One of my issues with the current (pre patch) date code is the discrepancy between tick as in sdl event loop, tick as in in game time, and hour as in in game time.\nIt doesn't have to be addressed now, but it would be nice if it was.. Technically correct, but Date(1) might be clearer? I'll leave that up to you.. Another bug in the old code. This should be month of game.. Almost certainly should also be month of game.. Best to leave old modifications in, in case code in between relied on it. In this case it probably doesn't. Note that old saves will continue to have self.hours_per_day until you nil it out in your < 124 afterLoad.. What is .metadata?. Space around -. You might want to pull the state before the object is destroyed, in case the destruction breaks the state?. Can you move these magic numbers to 'constants, e.g. local COLD_TOLERANCE_TEMP = 0.22. Space on both sides of * (formatting was wrong before). Do not remove old save conditions. Nm I see you just moved it. Preferably don't.. Space after each , and split long lines.. Hospital shouldn't directly set warmth_msg. Add a clearWarmthMsg setter.. Add getter. Getter should not have side effects. Reset acc_heating in setter or onEndMonth method.. The test for announcements and the argument are redundant. These methods should be private (prefix with _ or specify outside of the class) and should not take isPlayerHospital.. You can use or 200 to specify the default. Preferably move the default to a file local const.. Test is always true, remove.. He's probably unfamiliar with french punctuation and assumed it was a mistake. But yes the French put a space before and after almost all punctuation marks (notably excluding . and ,). Did you try adding local assert = require(\"luassert\") to class_test_base?. SMPEG.dll is not used on any platform anymore, and different libraries are needed for different sound formats. This comment should be generalized.. MP3 comment here needs to be generalized for more music formats. Remove the comment about SMPEG here; this is meant for end users, and we will ship with every relevant library.. Actually remove that line completely. This is for end users, and we will ship with all relevant libraries.. Remove the isPlayerHospital argument here; it's not useful. Just don't call this method if you don't want to display anything.\nActually I don't think this advisor stuff (or anything that depends on whether it's the player hospital) belongs in this class. I think the class should just expose whether it's too hot or cold.. Was going to ask your opinion. Formatting is my next PR in this series. We need to start a list. Ok, it'll get clobbered in the format PR by I will fix it now too.. Esoteric C operator for no reason... another on for the list.. I will be switching all of these to C++ style in the format PR.\nhttps://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#nl18-use-c-style-declarator-layout\nhttp://www.stroustrup.com/bs_faq2.html#whitespace. Extensions to luafilesystem. Ok I will change this to be clearer. I struggled with this name a bit (and for awhile I did have text_area_*. But a text_area is usually a container for text and I think it should be emphasized that this is the actual resulting size of the text as rendered.  Open to other suggestions.. Perhaps should be uint32_run_length_encoder/decoder, because it encodes / decodes uint32s. Being a RLE affects the generated result and means the corresponding decoder has to be compatible (i.e. not an implementation detail). It's a fairly low level concept so I think the name makes sense (except 'integer').. Pathfinder is one word in English.. Maybe even sound_dat_file_header. Ok, I will make a point to address this in the format PR. Ok, I didn't know it generated the link before.. sound_player could use a lot of work. At the very least the list of preinitialized sounds should be in a vector.. 2 is a Lua stack index. There are a lot of magic number lua stack indexes in the code - it makes it very hard to follow.. luafilesystem is the name of a 3rd party module. This is an extension to make it play nicer with Windows.. I'll take a second look at this whole struct. Seems like it confuses what it is with how it's used.. Why?. Yes. I like text_layout, changed locally. I'll push my changes when I've addressed everything.. done. renamed completely, file here is misleading at best.. Because this sound player prepares an SDL sound for every piece of sound data so that they are ready to play, and because they don't use an stl container for sounds.. fixed. No idea, I didn't follow this one enough to dispute the existing name.. either way it's short for \"abstract base class\", I like abstract better these days, so I'm keeping it :p. Keeping lfs, that's luafilesystem's internal name. e.g. lfs.dir(...), lfs.attributes(...). I didn't refactor that but it could certainly be pulled out of the loop. They are just drawing any progress bar after all text.. Sure. The real condition here is that it has to run in travis_ci; which is currently running Ubuntu 14.04. I don't mind bringing in a back port of a newer python version; but if we don't have to it's easier.. I believe that means 3.4.0 should be the target version.. Error message prints wrong argument.. I think it would be better to use the game_date from world than tracking your own hours/in game ticks here.. We'll check this at the time it's merged - depends what else goes in between now and then.. You probably want to drop it since you handle this in your < 128 condition.. Preferably yes, in the afterLoad.. Looks like an excellent use case.. Only one is allowed to play at a time, so this could be a boolean. Why did you end up changing this from pairs to ipairs?. ipairs iterates in index order, but your table doesn't use numeric indexes so it's moot. If you need guaranteed order you will have to change it into an array instead.\nlua\n  self.priorities = {\n    AnnouncementPriority.Critical,\n    AnnouncementPriority.High,\n    AnnouncementPriority.Normal,\n    AnnouncementPriority.Low\n  }. Which doesn't work at all ... keep another table (array) of the priorities in order and loop through that instead.. ... disregard everything, those are numbers. Sorry.. I think Hot and Cold warnings should be priority Normal; save Low for the random banter?. We use XDG_CONFIG_HOME if available, otherwise HOME/.config. nit pick, but I think I'd prefer you set this back to the empty set rather than nil, similar to what happens to humanoids_enroute in deactivate. Please make this clearer with brackets, it's too easy to forget precedence of and and or. As is it's a bit hard to read.\n. No, I'll fix this.. I copied this text, with minor editing, from http://corsixth.com/. These changes aren't actually necessary - but I feel more comfortable with them. I got a buffer overflow when I messed up the number of skipped bytes above originally.. Naming nit: asc_order / desc_order. Also comment that it keeps the player on top for equivalence, that was not obvious.\nNaming the keys and giving the player_hospital a variable would reduce the number of magic numbers and make the code more readable IMO:\n```lua\nfor i, hospital in ipairs(world.hospitals) do\n  self.money_sort[i] = { value: hospital.balance - hospital.loan, hosp_index: i }\n  ...\nend\n-- When sorting keep the player hospital on top when values are the same\nlocal player_index = 1\nlocal desc_order = function(a, b) return a['value'] > b['value'] or (a['value' == b['value'] and a[hosp_index] == player_index) end\nlocal asc_order = function(a, b) return a['value'] < b['value'] or (a['value'] == b['value'] and a[hosp_index] == player_index) end\n``. It'd be nice if this was switched from player to hospital to avoid confusion and be consistent with the loop above. For the same reasonidxshould matchiabove. I preferiorhosp_indextoidx`.. Undo this whitespace change. and this one. Undo this change. The stylized section headers are only used within the config file.. Ok to add a newline here, but just one. Undo this change. Not consistent with other dividers. If you want to make another commit or pr making these section headers consistent it would be appreciated but not necessary.. Did you verify this function was never persisted?\nEither way this change belongs in its own commit.. I don't mind if you remove the extra spaces, or line up the table like the old scroll_keys.. Should be removed.. Fixing it's as easy as making a separate handler option for each. Should be done since the rest of the options expect / allow a table, and these ones can only be strings.. CaptureMouse is inconsistently cased compared to the rest of the options.. Can't you modify print_table to suit your uses instead of writing a whole new implementation?. Yeah, I think that's fine.. All of these should support hotkeys with modifiers. I can put that in my patch if you want.. It ended up being bigger than I anticipated. A simple array join isn't suitable for the config and I'm ending up writing a general purpose serializer based loosely on the old print_table.\nMaybe a few days due to my availability.. Yes it does.. You can fix it now - we'll be squishing a lot of the commits later anyway.. You don't modify temp_table, why clone?. Revert this. Same as first branch. Skip clone on the string if you check types anyway, or pass anything in.. Flipped position on purpose?. temp_keys_copy = { temp_keys } no?. In that case you don't need clone, just if type is string, wrap with table. The original won't be affected.. the index is always 1, no reason to take the length. You could also assign the table here, like you do below for lifetime symmetry. e.g. temp_table = {self.app.hotkeys[\"ingame_scroll_shift\"]}. You need it for the table case; in the string case temp_keys_copy wouldn't reference temp_keys, it references a new table that contains that string.. The comments in this function are obsoleted by this patch and misleading.. I somehow missed these changes earlier - they seem overly repetitive; surely it could be a local function with LDocGen comments explaining what it does.. This function is defined twice in this file, just define it in the file scope once (preferably the second version with the comments). here is the other one. I think we don't use this function anymore, or shouldn't.. Still need the newline here.. switch with loadstring_envcall. switch with loadstring_envcall. Yeah, you would still need to repeat that part. Just the condition could be abstracted. Maybe not worth it.. Nah, leave as is.. Still shows the letter (T for town map, R for research, etc.) which is wrong.. These headings are inconsistent. Does it look better centered?. Yes. That block was preexisting, just moved. I'm ok either way.. ",
    "jorgenpt": "Cool, submitted https://github.com/CorsixTH/CorsixTH/pull/4 for some more changes.\n. Other than my two in-line notes that would improve readability, this looks great to me. Feel free to merge it with or without the suggested changes.\n. @Alberth289346, @TheCycoONE: Here are the changes I suggested for #14. I might make more as I look at the code again. :p\n. @mrtnptrs, once the work to get videos working has been done. I've started it, and I'll finish it once I have enough time to sit down and look at it again.\n. Okay, pushed an amended commit that fixed the sprite_t assignment.\n. Yes, SDL 2.0.1 is backwards compatible with SDL 2.0.0. It does add some new\nAPIs though, but I don't think we need any of them.\n- J\u00f8rgen.\nOn Sun, Oct 13, 2013 at 1:52 PM, Maarten Peters notifications@github.comwrote:\n\nI saw that you're preparing SDL 2.0.1 for release:\nhttp://hg.libsdl.org/SDL/shortlog Will the SDL2 branch be compatible with\nversion 2.0.1?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/pull/23#issuecomment-26226805\n.\n. @mrtnptrs, @TheCycoONE: Could one of you change your GitHub avatar? It's really hard to track conversations when you both have the same avatar, so I'd really appreciate it. :-)\n. @mrtnptrs, I deleted the comments referring to other issues, as they are all either tracked or fixed. I'm not sure what you mean by \"That light white mask it the blue shader you get when you set the game to pause, but it should not show that shader in the case you change the resolution\", but is it the issue fixed by these commits? 04472234f4305458fcf06326d0fe399c1415ae5f b09af373727d394d23687e575fedd9285da05c64\n. I've pinged one of the SDL_mixer authors about cutting a new release, since it's still at 2.0.0.\n. I heard back -- they're planning on releasing a new version of the \"satellite\" libraries when they release SDL 2.0.4. Still waiting to hear what the schedule for 2.0.4 is.\n. It seems like it links cleanly with the latest version, yes, so we can consider linking against it for the next release.\n. @mrtnptrs, yes, but that's not related to this pull request. Please keep general discussions on the mailing list rather than cluttering unrelated pull requests.\n. The old model would render each video frame only once (it didn't clear the frame buffer between frames), so it would unconditionally advance after each present - this could cause us to advance to a video frame that it wasn't time to present, so we needed that check.\n\nThe new model keeps rendering the same video frame every frame until the  next video frame is ready for present, at which time we advance the video frame. That means that whatever video frame is our current \"read frame\" is always ready for present.\nDoes that clarify?\n. (Rebased the branch.)\n. The problem is that the THRenderTarget only gets destroyed when the GC decides to free the memory, AFAICT. The solution should be to explicitly call a 'destroy' method before opening the new one.\n. Ah, there are also other references to the TH.surface in the app, so they are lingering.\n. So this is caused by the fact that SDL_RenderSetClipRect considers an empty rect to be the same as disabling clipping instead of disabling rendering. I'm not sure why that's the case, it seems a little backwards. I'll investigate and provide a workaround.\n. My pull request in #242 should fix this, here are some screenshots. I reproduced the problem, paused the game, saved it, and reloaded it. I then took one screenshot, applied my patch & rebuilt, then took another screenshot.\nBefore:\n\nAfter:\n\nIf you're curious about the problem in SDL, every rendering backend has this code: https://hg.libsdl.org/SDL/file/97d23eef62fd/src/render/opengl/SDL_render_gl.c#l977\nBasically, if SDL_RectEmpty, then the clipping functionality is turned off. I think this is probably not intentional, but it just happens because the renderer-specific UpdateRect doesn't have a way of differentiating between a cliprect of {0, 0, 0, 0} and one that was passed in as NULL.\nI might fix this bug in SDL if I get consensus, but until that happens, we'll need a workaround.\n. I fixed the bug in SDL: https://bugzilla.libsdl.org/show_bug.cgi?id=2504\nSo that change will go out with the next SDL. Leaving our workaround in place, though.\n. This seems to be because of an intentional change to SDL_mixer, that got included in the 2.0 release:\nhttps://bugzilla.libsdl.org/show_bug.cgi?id=1610\n. Fixed in 3f266df\n. @TheCycoONE  I think what I was referring to was SDL_CreateWindowFrom, but it seems like that method is not yet usable, as it does not work with OpenGL contexts. Rewriting the GUI portion using SDL2, or ensuring that SDL supports a way of creating a window with OpenGL capabilities from an existing window and then that the SDL_Render functionality works with it as intended (with a restricted viewport) are likely our best two options.\nI can investigate the latter one the next time I have some free time - I'm a committer to SDL, so I can try to get the necessary changes in the next release, since others need it too.\nThis looks to me to be one of the large remaining pieces for full SDL2 support, correct?\n. Maybe the best solution to this would be to use apt-pinning and adding the 14.04 repositories for only the mingw-w64 packages, along the lines of this:\nI.e. install our dependencies, then add the repo and do the pinning as described here:\nhttp://askubuntu.com/questions/103320/install-packages-from-newer-release-without-building-apt-pinning\nAnd pinning these packages: binutils-mingw-w64-i686 binutils-mingw-w64-x86-64 g++-mingw-w64 g++-mingw-w64-i686 g++-mingw-w64-x86-64 gcc-mingw-w64 gcc-mingw-w64-base gcc-mingw-w64-i686 gcc-mingw-w64-x86-64 mingw-w64-dev\n. I can't actually test and play with this right now since I don't have a Linux machine here.\n. @TheCycoONE :+1: to CI failing on whitespace. Only way to keep it consistent.\n. @TheCycoONE, yeah, that sounds good. Would you mind doing that? I won't have time to revisit this for a little while.\n. Correction:\u00a0The previous work was in PR #243.\n\nKind regards,\n J\u00f8rgen Tjern\u00f8.\n (Sent using a touchscreen keyboard)\nOn Mon, Apr 21, 2014 at 6:51 PM, Stephen E. Baker\nnotifications@github.com wrote:\n\nDue to a change in SDL_mixer, onMusicOver is now called when\nthe music is stopped with Mix_HaltMusic. When the music is stopped\nwe do not want onMusicOver starting another background track.\nFixes GH-129.\nThis is based on the work of @jorgenpt in pr #129\nYou can merge this Pull Request by running:\n  git pull https://github.com/TheCycoONE/CorsixTH sdl2_haltmusic\nOr you can view, comment on it, or merge it online at:\n  https://github.com/CorsixTH/CorsixTH/pull/247\n-- Commit Summary --\n- Do not play another track onMusicOver if stopped.\n  -- File Changes --\n  M CorsixTH/Lua/audio.lua (2)\n  -- Patch Links --\n  https://github.com/CorsixTH/CorsixTH/pull/247.patch\n  https://github.com/CorsixTH/CorsixTH/pull/247.diff\n\nReply to this email directly or view it on GitHub:\n  https://github.com/CorsixTH/CorsixTH/pull/247\n. Meant to merge this to master\n. @TheCycoONE, @MarkL1961: This seems resolved, since @MarkL1961 used to have the problem. Deallocated / allocated issue is benign and unrelated (and fixed in #678.)\n\nClose this?\n. This change is a little frustrating -- there's no CMake step that checks for them, and I don't even see how we are bundling these libraries with the game. The first time this will fail with an error is when I try to start the game and Lua scripts look for the lfs / lpeg requires. There's no indication on how to resolve this problem. In addition, we require a specific version of these libraries, so why is it not versioned in sync with the tree? (At least for LFS, we could use a git submodule to manage it, if need be.)\nIf you make a build now, will it rely on the users to install these packages?\n. I don't think the distinction between \"run time\" and \"compile time\" makes sense here -- they are required parts of the build. CMake produces a non-working product (.app bundle, in the context of Mac.)\nI think CMake should both check for the existence of these libraries, and copy them into the bundle, so that our builds produce a fully functioning package. \n. The danger of not enforcing this compile-time is that the packager will have these things installed in a system-accessible location, the .exe will work fine for them, they will ship an installer / zip / whatever to customers, and then the game won't work on their machine (because they don't have it in a system-accessible location.)\n. From SDL_video.h, SDL_GetWindowSurface(): You may not combine this with 3D or the rendering API on this window.\n. This is probably legacy code predating SDL_Render. We should use SDL_RenderReadPixels instead:\n/** \n *  \\brief Read pixels from the current rendering target.\n *\n *  \\param renderer The renderer from which pixels should be read.\n *  \\param rect   A pointer to the rectangle to read, or NULL for the entire\n *                render target.\n *  \\param format The desired format of the pixel data, or 0 to use the format\n *                of the rendering target\n *  \\param pixels A pointer to be filled in with the pixel data\n *  \\param pitch  The pitch of the pixels parameter.\n *\n *  \\return 0 on success, or -1 if pixel reading is not supported.\n *\n *  \\warning This is a very slow operation, and should not be used frequently.\n */\nextern DECLSPEC int SDLCALL SDL_RenderReadPixels(SDL_Renderer * renderer,\n                                                 const SDL_Rect * rect,\n                                                 Uint32 format,\n                                                 void *pixels, int pitch);\n. Sorry for the long turnaround. I submitted a pull request now. We were already using SDL_RenderReadPixels, but we were trying to retrieve the window surface to get the format to pass to RenderReadPixels. This was not necessary -- we can just specify our own pixel format.\n. @Andy51, nice catch!\n. Other than that one in-line nitpick, LGTM (Looks Good To Me).\n. Untested fix, but according to my reading of the source, this should resolve the issue.\n. That looks good to me.\n. LGTM.\n. I would store pColours[*pPixels] in a temporary, for clarity and ease of refactoring.\n. I would store m_pPalette->getARGBData()[m_pSprites[iSprite].pData[iY * iWidth + iX]] in two different locals, to make this a lot more readable.\n. I would create a temp pSDLRect, pass that to SDL_RenderGetClipRect, and then check  SDL_RectEmpty(pSDLRect). That way you're consistent with THRenderTarget::setClipRect. It should be exactly the same check under the hood, though.\n. ",
    "mrtnptrs": "I'm currently only able to close/edit issues, I can't give them a lable or manage the lables. I just can't click on lables at this issue.\n. And indeedly, now I can edit the lables and I have my commit acces back! :) But don't worry, I won't commit something! I will now test everything.\n. Ok, I'm now creating some extra lables we also have at Google Code, correct me if I'm doing something wrong.\n. But isn't there something like a template that users can fill in to report their bugs?\n. I know there is an option to close an issue, but is there also an option to delete an issue in case it is spam or for example to delete this issue when everyone has tested his/her permissions through this issue. Or can only owners do this?\n. You're right, but when someone wants to test his permissions at the issue tracker, then you can always re-open this issue if you want. But is there also something like merging issues here and saying something like that issue 5 is a duplicate of issue 3?\n. The first change isn't wrong!\n. The two wikipages (getting started and FAQ) are now transfered to GitHub, so this pull request can be merged.\n. GitHub is much greater then all these patches! :) This is also a very nice feature. Hopefully it will be added soon.\n. Thank you, I've already put everything about testing on our forums months ago.\n. But remember, we are working on using SDL2 in combination with CorsixTH. So, these changes could break those changes.\n. Do I look like a GitHub expert? ;) Sorry!!!\n. But where is the uploaded image?\n. But could someone upload a pre-compiled version of SDL2 in combination with CorsixTH, so I can also start looking for any bugs?\n. Yes, let's try it again! ;)\n. Ok, will contact you tonight through irc! That will be in something like three hours, could you then be there?\n. Yes Edwin, I know that, could someone else fix that and merge this change?\n. Will try this!\n. Accidentally uploaded the changes to the Dutch language directly to CorsixTH/CorsixTH with the little fix regarding aangemaak(t). Sorry, but I think that now this pull request can be closed.....\n. When will you think that SDL2 will be ready for testing? \n. Sounds great!\n. I saw that you're preparing SDL 2.0.1 for release: http://hg.libsdl.org/SDL/shortlog Will the SDL2 branch be compatible with version 2.0.1?\n. He looks like having the same problem as me Stephen. Maybe you should help him too?\n. I agree with you're idea.\nDate: Thu, 10 Oct 2013 05:13:50 -0700\nFrom: notifications@github.com\nTo: CorsixTH@noreply.github.com\nCC: maartenpeters@hotmail.nl\nSubject: Re: [CorsixTH] Key presses (#26)\nI don't understand how it is pulling in these other things!\nLast night I created a branch for visual diseases and pasted in line by line from the patch then did the pull request.\nAfter I switched back to the master and created another branch for this and then copied these line by line from the patch. I then did the pull request for this branch.\nEach time I checked locally that only the right changes were in the commit and nothing else had sneaked in.\nSo there must be something on the site copies that  is messing things up....  Perhaps it is remembering the previous version of that branch even though I had deleted it the day before?\nPerhaps tonight I should do four small language changes\nadd an un needed string\nadd another un needed string\nchange the two previous strings\nfinally remove them\nWe wouldn't need to add them to the trunk, but it might help to see where it goes wrong?\n\u2014\nReply to this email directly or view it on GitHub.                  \n. Could this make it into 0.30? Then I think we should merge it now, so I can test it with all other stuff.\n. Exactly what we need Stephen! Will talk tomorrow with you about my problem with GitHub, I don't have time for it now.\n. That light white mask it the blue shader you get when you set the game to pause, but it should not show that shader in the case you change the resolution.\n. So, SDL_mixer 2.0.1 should fix this music issue?\n. Do we have to wait for a new SDL_mixer release before this bug is fixed?\n. Sorry, that's what I meant :) Fixed! But does someone know when we can expect this new SDL_mixer version? \n. @jorgenpt I think these commits indeedly fixed this. Will change my avatar!\n. @TheCycoONE And what exactly do you mean with your latest comment? That we could wait for the next sdl_mixer version or just use the snapshot (hg) of sdl_mixer?\n. Then I will update the travis script as soon as the new version comes out :)\n. Can we use the latest version om FFmpeg (http://www.ffmpeg.org/index.html) for compiling at the moment in combination with SDL2? These new versions contain a lot of improvements and maybe also a few that could fix some little bugs with movies? Or do we then need to change a bit of the CorsixTH code to use the most recent version of FFmpeg?\n. Could Stephen then make a complete list of all libraries he used to compile and which version of it? Then we all know which version of the libraries he uses to compile.\nSomething like:\n-SDL 2.0.1\n-SDL_Mixer 2.0.1\n-Lua 5.1.5\n-FFMpeg 2.0\netc.... \n. Sorry, but this name has now bad references to Savile name.\nAnd second, giving your opinion is good, but demanding isn't too nice.\nDate: Sun, 1 Dec 2013 18:09:57 -0800\nFrom: notifications@github.com\nTo: CorsixTH@noreply.github.com\nSubject: Re: [CorsixTH] Replace Billy Savile (ViP) in English version (#42)\nSorry, what?\nFor gods sake, is the name \"Jimmy Saville\" banned now? The name isn't even the same, it's \"Billy\"\nPlease revert this ridiculous change.\n\u2014\nReply to this email directly or view it on GitHub.                  \n. Please cool down, this is only for this game and this is not a kind of censorship! It's just a decision at our side.... It's just a game, don't get mad at us! The game must be fun for everyone, with no bad references to people or things! We don't say that every game developer should do this, but WE think that this is the best for everyone.\nSo, don't get mad at us!\n. Could you provide an autosave?\n. And you're using version 0.21 of CorsixTH?\nDate: Sun, 20 Oct 2013 05:25:22 -0700\nFrom: notifications@github.com\nTo: CorsixTH@noreply.github.com\nSubject: Re: [CorsixTH] Error report 2 (#50)\nx-ray!\nbtw, nice job guys, thx for this project, i can enjoy the game again!!!\n\u2014\nReply to this email directly or view it on GitHub.                  \n. I saw these errors is some other issues... I think we could better fix this before releasing 0.30? What do you think?\n. Sorry, those last two commits fix an issue at the menu where tabs where used instead of spaces and updated the Dutch translation to add these hotkeys.\n. Sorry Mark, but what do you mean with the second part of your comment? I don't understand what you mean.\n. This would probably need some new strings, because I think that these messages are using the Original strings of TH?\n. Great, maybe we could add this to version 0.30?\n. Well, I have reproduced this with a brand new game created in 0.30 RC1. I currently only reproduced this with the Scanner.\n. Will do this tonight!\n. It is indeedly just not implemented yet.\n. But what is the result of removing the grace period? That staff and patients complain when the temprature is too low? I think that would be the most realistic behavior even if it is not included in TH.\n. Yes, but there was also a problem with this with version 0.21... The Trunk version will work, but have you looked at that link?\n. Yes\n. Maybe you could make a new issue of this error, because it probably has nothing to do with scrolling momentum?\n. Yes, works fine for me.\n. I should say try to disable you anti-virus/firewall and see if you can still reproduce this bug?\n. Isn't it maybe a better idea to not implement this in 0.30 and implement this in 0.40? Because I think this updater is not tested yet on Ubuntu and Mac and also gives issues now at Windows?\n. Sounds great! Well done so far! :)\n. So, the whole epidemic branch at Sadger/CorsixTH is the same as this pull request?\nWhat I also see, is that you have given the \"epidemic\" value at CorsixTH/Lua/languages/english.lua two times a different value:\none time this: epidemic = \"Create Epidemic\",\nand the second time this: epidemic = \"Creates an epidemic\",\nBut we can just use the latest executable from the trunk to test epidemics with, because no changes are made to the C++ code?\n. @sadger Ok, thank you for the explanation! No need for that as I have no time for it currently. I will maybe test epidemics these days.\n. Nice! Will test it the next weeks now I have enough time! :)\n. Will test it!\n. Conflict here, probably caused by issue #237. Want to test it, but could you make documentation about how it should exactly work as we can then see if it really does and not just have to guess if it does?\n. Fixed in the SDL2-branch!\n. The idea sounds very good to me, but I haven't try it.\n. And when do you think this new version will be released? Shouldn't we then remove this workaround; that is much nicer. But to use the upcomming new SDL version, we have to fix #228 first.\n. Can we merge this now?\n. Conflict here, probably caused by issue #237.\n. Can this be merged to the master?\n. I'm not sure, but I thought I indeedly saw this a few times. Also that a machine is being repaired when it is in use, but that is an other issue....\n. Could you provide the savegame of this?\n. I also see this problem also occuring. And when that cutscene is finished, the music restarts.\n. And which features are then exactly required to be able to use zoom?\n. \"Checks to see if the environment supports the required features and if so enables zoom.\" Which required features? If it uses SDL 2.0 or what?\n. Yes sir! :)\n. These changes also fix issue #110?  And how will the screenshots be named? Just as it always was: screenshot [number]? (As I can see here: https://github.com/CorsixTH/CorsixTH/blob/d1ddd03ee6474354f642602410915725bc154be0/CorsixTH/Lua/ui.lua#L876) \nAnd, as a suggestion, we could maybe add a date and time to the file name? I saw an issue about this a time ago on Google Code and I think it is also on our TODO list there. But it is of course optional and can also be done later, but I thought when you're already working on screenshots, you could maybe also do this if it isn't too much work of course? :)\nI can also remember that Mark posted an issue on Google Code a time ago that our BMP images are really big, even too big to get uploaded to our forum. I think that the solution for this would be to save the screenshots in an other format, like png or something? But Mark said this would require a lot of work, but if this got easier now with SDL2, we could do this maybe (in the near feature)? But it is of course more important that you can make screenshots then that they are too big. :)\nWhat do you think? \n. @TheCycoONE Thank you for answering my questions. Nice that the bug is fixed then.\n. @MarkL1961 Well, if you upload the save to an online storage page and you download it, the file date will be useless for us as it is changed then.\n. @MarkL1961 Indeedly, we can see at the savegame_version with which version the savegame was created and saved. So, you're right.... You can remove it from our TODO list.\n. @MarkL1961 It were two wiki pages at Google Code (programmin ideas and future options.)\n. How are we going to handle this? @jorgenpt \n. Which version of CorsixTH do you use?\n. This would be great indeedly and also fix the root cause of issue #66. What do the others think about this idea? \n. @TheCycoONE  That would be indeedly an easy fix, but could also be very exploitable if you have enough money.\n. @MarkL1961 Not everyone is as smart as you ;) No, I haven't done that in the past. Indeedly you can also exploit it by hiring a large number of Handymen and then fire them immediatly. So, the idea (https://github.com/CorsixTH/CorsixTH/issues/147#issuecomment-59633044) would indeedly perfectly fix this.\n. Sorry, but that file hoster sais the files will get deleted in 3 days. Could you upload the files, gamelog and save, to something like Google Drive or Dropbox?\n. Thank you!\n. Can you reproduce this issue? What exactly were you doing when this happened? I think a new Mac packager should look at this? As Darrell has no Mac anymore (only VM).\n. Maybe this is caused by when you scroll with your mouse to one of the corners of the map (in the black part) with a doctor picked up? Then I indeedly get a crash (can send you gamelog.txt if you want) every time or isn't that what you mean? And does this bug also happens with the SDL-version? Could you provide the EXACT steps to reproduce this bug. And where the mouse cursor is at that time.\n. Why did the Travis-CI build failed?\n. GitHub sais there are conflicts, so it can't automaticly merge.... How can this be fixed?\n. Conflict here, probably caused by issue #237 \n. Nice, I thought I have seen this issue a few times at Google Code (errors with bad argument #4 to 'findDistance' ) Now we can finally fix this bug maybe. Can we merge this? Then I can test everything.\n. Yes, you're right, I can also download the source of every branch to get these lua files without the patch. Will test it these days! Sorry, I sound a bit lazy.\nDate: Sun, 2 Feb 2014 19:01:55 -0800\nFrom: notifications@github.com\nTo: CorsixTH@noreply.github.com\nCC: maartenpeters@hotmail.nl\nSubject: Re: [CorsixTH] If a handyman dies, deallocate him from his task (#159)\n@mrtnptrs It's best to test before merging, this is a pure lua fix so you can test it without compiling.  If you know how to apply a patch file then download it here: https://github.com/CorsixTH/CorsixTH/pull/159.patch otherwise you can grab each of the 3 lua files he changed.\n\u2014\nReply to this email directly or view it on GitHub.                  \n. So, can you also reproduce these bugs in a brand new game?\nAnd btw: excellent bug report, contains all info we want :)\n. Could someone look at it now to make sure I made no mistakes, as English is nog my mother language? Does someone maybe have an other suggestion/opinion/idea on how our users should upload their gamelogs and saves?\n. @TheCycoONE Done!\n. @TheCycoONE Yo can help me if you want! :) The word wrap was never on.\n. @TheCycoONE  Could you then edit my comments and merge this?\n. Yes sir! :) Please someone open this one again if I'm doing something wrong.\n. Conflict again probably caused by issue #237. \n. Conflict here, probably caused by issue #237\n. @MarkL1961 Well, I'm sick of it that (almost anytime) no one reports back to me about testing, so the test team is pretty ineffective and I don't know how to resolve this.... :( But I have to admit, I'm getting a bit lazy :) How can I test this and are these commits compatible with SDL2?\n. As there is already a pull request for this....\n. Conflict here, probably caused by issue #237\n. Conflict here, probably caused by issue #237\n. Conflict here, probably caused by issue #237\n. @MarkL1961 Could you make an other issue for this problem, that the game can't be saved when the jukebox window is open? This issue only goes about that new hotkey for it and not that you can't save the game when it is open. Then the one at Google Code can be closed.\n. Conflict here, probably caused by issue #237\n. Here too conflicts probably caused by issue #237. \n. Conflict here, probably caused by issue #237 \n. Ok, will then replace the 5.1.4 with 5.1.5 tonight :)       \nEdit: already done, also updated freetype, or did I do that wrong?  \n. Do I have to revert that change or how could I fix this?\nDate: Mon, 10 Mar 2014 11:01:48 -0700\nFrom: notifications@github.com\nTo: CorsixTH@noreply.github.com\nCC: maartenpeters@hotmail.nl\nSubject: Re: [CorsixTH]  Update Travis to support SDL 2.0.2 and ffmpeg 2.1.4  (#215)\n@mrtnptrs  The build failed on freetype so perhaps you did do it wrong\n\u2014\nReply to this email directly or view it on GitHub.                  \n. Will revert the freetype change tonight!\nEdit: everything is ok now! :)\n. Sorry, tried it in issue #218 and it went wrong....\n. @TheCycoONE What do you exactly mean? What d0 you want me then to do exactly?\n. @alanwoolley @TheCycoONE Ok, I will create a brand new repo I think for a clean start. Then I will do what you said.\n@Lego3 @TheCycoONE  @alanwoolley Maybe I can manage the issue tracker again with labels, so it's very clear what the status is of everything and who is working on it? But I need to get my acces to the issue tracker for that back..... I'm now more used to the way GitHub works, so, don't worry! :)\n. Created new pull requests as asked!\n. @MarkL1961 @Grimdoc @Lego3 @TheCycoONE  I have something in mind, on it! :)\n. I think this went wrong, I don't understand it.... \n. Good feature :)\n. But was this initial grace period also there in the Original TH? It was introduced because to many users complained about the patients complaining about the cold? So, standard the patients won't complain now about the cold in the first year. That is very unrealistic... Couldn't we make it the way that only some patients complain about it (and loss some happiness and reputation) and not all of them or that they less feel the cold, so their happiness doesn't go down too much; that would be far more realistic and it's also a solution for the original problem. What do you guys think about this?\n. Yes, will do that next time, sorry!\nDate: Sat, 15 Mar 2014 14:02:24 -0700\nFrom: notifications@github.com\nTo: CorsixTH@noreply.github.com\nCC: maartenpeters@hotmail.nl\nSubject: Re: [CorsixTH] Removed left references to Google Code (#227)\n@mrtnptrs do you know how to update those commit messages to be a bit more descriptive like the pull request info?\n\u2014\nReply to this email directly or view it on GitHub.                  \n. Can someone look why the Travis test failed (look at the Travis CI build details)? Are the SDL2-2.0.3 files just not already uploaded to our download source or something? \n. @TheCycoONE @alanwoolley How can we fix this?\n. @TheCycoONE @alanwoolley Could someone else do this then, because I'm not very familiar with those build scripts? :) Then someone else can do what Stephen said and then we can merge this pull request afterwards; if Stephens solution works of course ;)\n. Accideantially clicked the wrong button, sorry :(\n. Bump :) @alanwoolley @TheCycoONE  Will Stephens solution resolve the issue?\n. @alanwoolley  Ok, don't worry, be happy :)\n. There is also a conflict here, probably caused by issue #237. \n. Well, Peter is not (so) active anymore..... It can take a while before he will answer I think. @JASheppard If you want, I could still try to help you out with these problems? Send me an e-mail if you want.\n. I think issue #237 resulted in a conflict with this....\n. The Travis CI build failed, what's wrong?\n. Could you provide a savegame? But I think this is a duplicate of an error reported on Google Code.\n. @jorgenpt @TheCycoONE @mounirlamouri I would say to make a new issue about this discussing this option into Travis? But issue #237 was a great start to fix all trailing white space we had at the moment :)\n. Conflict here, probably caused by issue #237\n. @TheCycoONE Agree with this Stephen?\n. This is great! :) Already put this nice python code on a new GitHub repositry of you? :) But see below; this commit caused many conflicts with other commits :(\n. What does this issue fix in detail? What was the original problem?\n. But where can I find the pre-build version of CorsixTH with these commits? I can't find them here: http://www.armedpineapple.co.uk/cth/builds/ This is because only builds from the Master branch and SDL2 branches (already committed to that branch) etc. are automaticly build and placed on the server of Alan, but not the SDL2 builds in pull requests, isn't it? Would like to test these commits, so it can be finally merged :)\n. Which Linux distro do you use? More information is welcome...\n. Do you also have a savegame?\n. You're using an old version of CorsixTH! Please use the most recent version of CorsixTH, version 0.30! You can download it from here: https://github.com/CorsixTH/CorsixTH/releases\n. Have a savegame from just before the error occured or maybe after?\n. @TheCycoONE Then we can indeedly make a Lua 5.2 branch for it. But do we want to use Lua 5.2.x or LuaJIT 2.x then? I know LuaJIT is faster and maybe we will need this if we will make our HD own graphics? :) I will give this a 0.50 milestone flag and we will see what comes....\n. @TheCycoONE Sorry, I'm not really an expert in these things ;)\n. Nice work Steadi, but shouldn't the increasing/decreasing reputation work like this?:\nLower/higher the costs for the treatment of a disease>make a patient with THIS disease (of which the cost were increased/decreased) happy/unhappy with this>this will affect your reputation. (instead of directly affect your reputation.)\n. Oeps, accidentally clicked on the wrong button :) But doesn't this code now increase/decrease the happiness of a patient AND also your reputation? It should only increase/decrease your happiness, as it will then automaticly increase your reputation, isn't it?\n. Can you still reproduce this problem? Could you maybe make a video of the problem if you can reproduce it? And are you using the demo version or the full version of Theme Hospital to play CorsixTH?\n. @vikkiesingh Did copying the files from the TH disc to your computer work for you?\n. Uhmmmmmm? HUH?! :) What did you do/mean with this! \n. @Grimdoc I know :)\n. Sorry Albert, it's not really a fix, but more an enhancement and as you know me...... :) I also made two new labels for the AnimViewer and the Level Editor.\n. @J-Shep I don't find that comment disrespectful, as I still have it in my mailbox. It was just a message in which you can hear @phillipp is a bit frustrated. So, I think there was no reason to remove it and if it needs to be removed, @TheCycoONE @MarkL1961 or @Lego3 will do that! Don't do such things on your own, because when I would have done that when I was still active, my privileges would be revoked immediatly by Edvin I think.\n. 1. Known\n2. Known, including DirectX dll files is not the solution. You have to install DirectX.\n3. The OpenGL version is really buggy atm. I suggest you to not use it. \nWe're working on a SDL2 version of the game, which should fix this all! :) It's still a game in development, so don't expect a fully stable product! You're getting a bit rude in your post above..... We're just also people, don't forget that....\n. Well, this seemed to broke Travis, as it now produces an error when trying to compile a new build: The command \"sudo luarocks install lpeg\" failed and exited with 1 during . Seems like it can't find lpeg and luarocks anymore, since we don't store it locally anymore.\n. Then very sorry! :) Hopefully this will be fixed when luarocks comes back online.\n. Testing Travis\n. It indeedly seems to be travis still uses a very old version of this \"program\": version 2.x if I looked right at the building progress... Will look at it again now..\n. look at this part of the build log:\ng++-mingw-w64-i686 g++-mingw-w64-x86-64 gcc-mingw-w64 gcc-mingw-w64-base\n  gcc-mingw-w64-i686 gcc-mingw-w64-x86-64 mingw-w64-dev\n0 upgraded, 10 newly installed, 2 to remove and 118 not upgraded.\nNeed to get 71.9 MB of archives.\nAfter this operation, 133 MB of additional disk space will be used.\nGet:1 http://us.archive.ubuntu.com/ubuntu/ precise/universe binutils-mingw-w64-i686 amd64 2.22-2ubuntu1+1 [6,633 kB]\nGet:2 http://us.archive.ubuntu.com/ubuntu/ precise/universe binutils-mingw-w64-x86-64 amd64 2.22-2ubuntu1+1 [7,541 kB]\nGet:3 http://us.archive.ubuntu.com/ubuntu/ precise/universe mingw-w64-dev all 2.0.1-1 [15.8 MB]\nGet:4 http://us.archive.ubuntu.com/ubuntu/ precise/universe gcc-mingw-w64-base amd64 4.6.3-1ubuntu5+5ubuntu1 [11.9 kB]\nGet:5 http://us.archive.ubuntu.com/ubuntu/ precise/universe gcc-mingw-w64-i686 amd64 4.6.3-1ubuntu5+5ubuntu1 [13.0 MB]\nGet:6 http://us.archive.ubuntu.com/ubuntu/ precise/universe g++-mingw-w64-i686 amd64 4.6.3-1ubuntu5+5ubuntu1 [7,536 kB]\nGet:7 http://us.archive.ubuntu.com/ubuntu/ precise/universe gcc-mingw-w64-x86-64 amd64 4.6.3-1ubuntu5+5ubuntu1 [13.2 MB]\nGet:8 http://us.archive.ubuntu.com/ubuntu/ precise/universe g++-mingw-w64-x86-64 amd64 4.6.3-1ubuntu5+5ubuntu1 [8,053 kB]\nGet:9 http://us.archive.ubuntu.com/ubuntu/ precise/universe g++-mingw-w64 all 4.6.3-1ubuntu5+5ubuntu1 [962 B]\nGet:10 http://us.archive.ubuntu.com/ubuntu/ precise/universe gcc-mingw-w64 all 4.6.3-1ubuntu5+5ubuntu1 [954 B]\nFetched 71.9 MB in 2s (26.8 MB/s)\n(Reading database ... 76973 files and directories currently installed.)\nIt seems it downloads a really old version from ubuntu or am I wrong?\n. Testing if it now can build, as the site of the file it wants to download is just online.\nEdit: still fails! :(\n. @TheCycoONE At your service!\n. Could you try to use your Origin version instead of the Torrented version? If you use an ISO file in combination with a mounting application, it could cause the slowdown when loading assets of the game. Also, many things can be wrong with an illegal version, so, I would try the non-torrented version anyways. Could you also provide the specs of your pc/what hardware your pc has?. ",
    "MarkL1961": "Was this added in time for 0.30?  I have just had an error running the 0.30rc with a save and clicking on the progress report.  see  Issue #58 as it was the same error as there.\nIt could be the reverse of that error i.e. 0.30 has the old values and my save the new ones\n. Do I need to submit any of these again then?\n. I think things started to go wrong when I started creating branches.\nI'll talk with you tonight if that's alright, to make sure I have things set up correctly - you lost me with upstream :)\n. @Lego3 \nWhilst updating the wiki pages I noticed that Alt + S is now for quick save and also for toggle sound....\nAny suggestions, sorry, keeping track of all these key combinations is getting difficult?\nPerhaps I could change quick save and load to Shift+S and Shift+L\nedit: actually that won't work either as those two are already in use :)\nDone a pull request to change these to Shift + Alt + S and Shift + Alt + L\n. I don't understand how it is pulling in these other things!\nLast night I created a branch for visual diseases and pasted in line by line from the patch then did the pull request.\nAfter I switched back to the master and created another branch for this and then copied these line by line from the patch. I then did the pull request for this branch.\nEach time I checked locally that only the right changes were in the commit and nothing else had sneaked in.\nSo there must be something on the site copies that  is messing things up....  Perhaps it is remembering the previous version of that branch even though I had deleted it the day before?\nPerhaps tonight I should do four small language changes\n1 add an un needed string\n2 add another un needed string\n3 change the two previous strings\n4 finally remove them\nWe wouldn't need to add them to the trunk, but it might help to see where it goes wrong?\n. Why would you want transparent walls on when buying a plot of land?\nI use it to find an object that is out of view.  If it is left on it might cause issues, not just with buying new plots, which is why I thought it would be better as something you only have whilst you hold a key down.\nThe issue with the barrier or divider wall not only happens with transparent walls anyway, you get a similar issue with them when you build against them. I think it has something to do with how the c++ side  replaces barrier walls with internal walls when building rooms and so even though it is an outside wall it is not seen as outside by the game.  Normally if you build a room against the outside wall the outside wall remains as an outside wall.\n. see issue #94  Key Presses \n. I think someone is working on our own music.  There are ways to copy the midi's into other formats, but I suspect there would be copyright issues with that though,\n. There are several places where we need to know what actual month is.  In visuals I did local current_month = (self.year - 1) * 12 + self.month and there are then similar locals for earthquakes and emergencies and possibly also for spawning patients and staff availability.\nGiven we clearly need to know how many months have gone by i.e. Feb in year 3 is month 26, why don't we have a parameter of actual month and use it in all these places?\n. There are not many places where you need a year, status/overview and the bottom menu are two I can think of, then awards is another.\nThis is why I think a global current month count on top of what is already there to determine the year would be a possible solution.  Otherwise we have several places that are converting the year + month back into current month\n. What I am suggesting is that we have the global to replace all the other re-calculations we already have here and there. (global might not be the correct term)\nYou have local month_of_year = 1 + ((self.next_emergency_month - 1) % 12)  and then I have  local current_month = (self.year - 1) * 12 + self.month and there are then similar locals for earthquakes and emergencies and possibly also for spawning patients and staff availability.  When all we need is one Self.current_month = (self.year - 1) * 12 + self.month for example (in world) that can then be called upon in all the places it is needed. Or have Self.current_month  run independently in its own right.  self.current_month = 1 and increase it by one on each month end.\n. I have no problem with it being merged.\ndoes anyone have any issue with my suggestion?\nOnce it has been merged, if you are okay with the suggestion, I will make a start on it.\n. @skippamorgan\nThe idea is to remove him from the game and replace him with someone else. \n. This was something that came up in the forum and to be honest, as he was the only person I have ever heard of with the last name Savile, I have to agree with the suggestion.\n. @jehoyes \nSir Lancelot Spratt is the replacement, he was the fictional character of the Dr films (Dr in the house etc)\n. There is an autosave every month, so you would have had to continue playing for a year for it to get overwritten.\n. duplicate of #50 \n. I have managed to replicate the error.\nSack the Dr whilst someone is using the xray and you get the same error. Perhaps the same thing can happen with other machines being used and the staff getting sacked part way through diagnosis?\n. From memory he had sacked his Dr whilst diagnosing someone, this will be why fatigue was nil as he no longer worked there.  The original equation referred to room.staff_member, which he no longer is.\nThe diag process uses the tiredness as part of the equation and as it was nil it caused the error.  All I have done is made it so it does not matter now if the staff have left.  i.e  local fatigue = room.staff_member.attributes[\"fatigue\"] or 0 \n. Agreed\n. this is a duplicate of #50 \nthere is a possible fix pending in #51 \n. This is something that we know about and have not managed to fix yet.  For anyone that is interested you can read what is known here http://code.google.com/p/corsix-th/issues/detail?id=1189 and there is also a save.\nTo save any confusion, the original issue in google is closed and any further comments should be included here.\n. Your hospital is not valuable enough to win the level.  It is worth $114985 and needs to be worth $120000\n. There is an issue here with the same/similar error message here http://code.google.com/p/corsix-th/issues/detail?id=1696\nTo save any confusion, the original issue in google is closed and any further comments should be included here.\n. Should be simple enough to fix.  On the first of either cured or killed these messages are not relevant anyway as there are special messages that relate to first cured and first killed.\n. Similar error here http://code.google.com/p/corsix-th/issues/detail?id=1732\n. Neither will allow you to edit it out.\nCan you edit the room and delete or move it?  (I think you have said not.)\nThe only thing I can think of is looking in your autosaves to find one where there is no litter in the room.  You might need to have transparent walls on to see inside the room.  Chances are though it has been there a while.\n. This is another known issue and more details can be found here http://code.google.com/p/corsix-th/issues/detail?id=1673.\nTo avoid confusion the issue in google code is now closed and any further findings should be recorded here\n. You don't need to move the room, edit and then accept and you also get the improved machine for free!\n. https://www.dropbox.com/s/wkocvktjp96kknw/Autosave10.sav\nHere is another save,  seems that github won't let you add saves so it is on dropbox for now.\nThere is a block of five GP Offices and a couple of them have Drs wandering the room.  Wait about a month and all the GP offices will be the same and then the operating theatres too.  If you pick up the Dr and place him outside or in the staff room another will come along.\nNot sure what is going on here, but it does seem to be happening a lot more that it used to before.  I tend to only notice it when there is a build up of patients.\n. Odd, that is something that was fixed a long time ago - maybe it got broken again!\n. Watch to see if it only the scanner or other machines as well please\n. I think it may be related to there being a screen.  If the timing is right and there is a patient getting undressed, if the handyman enters the room as the patient is walking towards the machine he ignores the fact that a patient is about to use the machine.\nWe then have a machine in use and being repaired at the same time.\n. I think some patients should be dropping litter as well as those that use the vending machine.  It is something that we have not got around to yet.\n. Not that I am aware of, at the moment I think there is a chance you will litter the hospital after using the vending machine.  Bins are only decorative and do not reduce litter and I am not aware that there is any random littering.\n. With regards to \"Also, the heat indicator will be at ~15-25% even though there is not one single heater in the hospital. It was quite close to 0% in the original game.\"\nWhich one are you referring to?\n. It could be that the initial_grace period of one year is too long.  In level 1 you can usually complete in less than a year. I can't remember why this was added, but perhaps it is something that the player could turn on or off?\nI have compared the heat indicator in town map and progress and they are both about the same as in TH\n. I have checked in TH as well and if there is no heating the staff have the cold icon from the start.  Perhaps we should remove the grace period or default it to false or perhaps only on for the tutorial.\nWhat do you think?\n. I think if we removed it we would get people complaining it is too hard again, which is why it was added.\nRemoving it would make the game more like TH not less.\nHaving an option to chose which the player wants might be better or perhaps reduce the grace from a year to a couple of months?\nPerhaps in time it could be linked to the mode you chose i.e. easy it is on hard it is off\n. @Lego3 \nI was wondering whether what people were really complaining about was staff asking for pay rises too often, but it was a long time ago.\nA lot of changes have been made since then, although there could still be room for improvement on wage requests it seems.  (newly promoted staff is one that comes to mind)\nWhatever the reason was, I think that because we have now identified the side effect that neither staff or patients show their feelings about how cold or hot they are in the first year is or was never intended.\nSo do we remove the grace period or give the player the choice to remove it if they want to?\n. Seems to be working fine in the trunk, for me anyway.  Can't really comment on 0.30RC as I have not seen it yet. Perhaps you have not got the hang of how to do it?\n. I think it was added/corrected later - you are on about the fact it was not added correctly in 0.21?\nhttp://code.google.com/p/corsix-th/issues/detail?id=1621\n. So that should no longer be a problem.  0.30 is made from the trunk so it should be working and in the trunk it is for me.\nI have not seen 0.30rc though\nhave you tried changing the setting in config?  Mine is scrolling_momentum = 0.8 perhaps try 1.0\n. scrolling momentum is working okay for me with 0.30RC.\nI can't load any saves though!   Not even one created today with 0.21\nCannot check for updates since LuaSocket is not available.\n Current value:Error while loading game: C:\\Program Files\\Corsi\nxTH\\Lua\\persistance.lua:90: bad argument #1 to '(for generator)' (table expected\n, got userdata)\n. At what point does it crash as your save works fine for me?\n. Still no error for me!\nAre you getting a windows error?\n. Can you look in the events log to see what the error was?  If you have windows 7 just type events in search programmes and files box on the start menu.\n. That is the one, we just need someone who understands these things to take a look now.\n. @TheCycoONE I think we have another issue like this somewhere, perhaps google.  From memory it only ever happens to me when we have a new release, the trunk does not normally cause me the same problem.\nPerhaps there is something different in how the releases are compiled compared to the daily's?  i.e. different dll's.  and for instance lua51 and lua5.1 \n. Just edit it in hospital.lua line 1463 and change 1 to 10\n. I read somewhere on google I think that it is also used for spawning patients.  Something like you get 50% and then 25% after the initial_grace.\nHowever I could not find it in the code the other day.\n. Accepting it was a click on the wrong button in this case, doing any merging to the master is not something I would do intentionally. \n. This could perhaps have been achieved through the tooltips, but I see that they have been deactivated in the dropdown menus.\n. 64bit windows so either 32 or 64 should work.\nI installed over the existing 0.21, I am going to now uninstall and do a clean install\n. Uninstall leaves mime and sockets folder, so deleted them and did another install freshly downloaded - same problems.\nCompared files from installer to zip and installer has mime.lua and socket.lua which are not in the zip, unless they are in a different folder.\nEdvin, when you say it works for you, did you use the installer?\n. Tried to install it on my old XP machine and I get the same problems.  Am I supposed to install lua sockets first or something?  That is all I can think of that might be different and that you might already have and I don't.\n. XP is 32 bit. \nWhat is the installer 32, 64 or both?\n. I don't understand why for me it does not work on either PC and yet the trunk does.  Development snapshot works for me too. \n. Yes\nIn the zip those files are not there, but are with the install.\nOn win7 it put the corsixth folder in program files not program files (x86)\n. \\mime\\core.dll is 15kb and \n\\socket\\core.dll is 46kb\nshould they be the same size?\n. On XP mime\\core.dll is 13kb socket\\core.dll is 37kb\nI have tried taking the other from the install, but I get the same issue\nAnyway win7 is 64 bit, the same as win8 so if it works for you it should for me!\nAlso tried replacing them on the XP machine and it makes no difference there either.\n. Okay, found the problem on both machines.\nIn config changed check for updates to false and now the game works fine\n. One thought I had was could my firewall be blocking lua sockets?\n. I have already tried that and also added corsixth to the allow list\n. I changed line 1225 in app to local current_version = \"Trunk\" --self:getVersion() and I can now load and save.\nchanged it to local current_version = \"0.30\" --self:getVersion() and I can't and get the error.\nCould it have something to do with version number?  Although that would not explain why it works for you Edvin!\nIt didn't like 0.21 either\n. What I can't get my head around is, if luasocket is not working for me, why does that stop me from loading or saving?\nIf I turn it off I can load and save, leave it on and it does not work, but then I can't load or save - why or where are they connected?\n. I thought I'd see if I can install this at work today, also win7 64 bit.\nGot a different error\n\nI have not had any problems running corsixth on this pc with 0.21 or trunk!\nSame error message with all the exe's\n. \nThis is what I got from the pc at work, I think this could be a DX issue again, so I will see if there are any updates.\nWindows updates say this pc is up to date!\n. It was similar to the DX.\nThese are from the pc at home (Win7), where I can open Corsixth, just can't load or save\n\n\n\n. I'll email them as this site does not allow anything other that pics.\n. I get similar from my working trunk copy so they might not be that helpful\n. PC at work is 64bit too, so not sure why the installer did that, it's not something you can choose or anything!\nWith the lua thing, could that be related to the lua51.dll, as sometimes you get two with a lua5.1.dll included as well?\nOn the works pc I did install over the last copy which I think was either 0.20 or 0.21, but then I suppose really even if those files were left behind they should still be the correct versions.\n. not with the original issue, that is still unsolved.\nthe second issue comes about when you install over a previous copy if one was 32 and the other 64.  For some reason some dll's were left behind I think.\nAnyway complete uninstall first fixes that.\nAs for the original issue connected to the luasocket I am not sure where to start looking as I can't see the connection with being not able to check for updates and loading/saving.\n. I noticed that I don't get this issue with the trunk copy after I  changed version numbers so that App:getVersion(version) returned 0.30.  It still returns a message that lua sockets is not available, but I could load and save.\nWhat else is different from 0.30rc and the trunk apart from recent additions?\n. Okay just copied the mime and socket directory with the core.dll into where I changed the version numbers.\ncan still load and save and still get the message about luasocket not being available.  This was with using the existing exe, the one from the installer does not work with the trunk and gives an error, but downloading a fresh sdl.exe from svn snapshot works with the error about  luasocket not being available.  Also extracted the other dll versions and get the same result for luasocket not being available.\nIf you were referring to 0.30, I did already try and use different versions of core.dll the other week. All combination have the problem of lua socket not being available and the added issue of saving and loading not working.\nIn case you are wondering, yes I did also put copies of the other three files in the lua directory of my trunk copy which were mime, ltn12 and socket or did I miss something?\n. My save and load problems appear to be connected to those three extra lua files! \nEverything seemed to be okay apart from luasocket not being available and went wrong when I added mime, ltn12 and socket to the lua directory.  luasocket is still not available, but it is then I get the issue of not being able to load or save as well.\nIn the last comment I had put the files in and forget to test save and load and was only looking for the message :/\nSo at least we now know which files add the save/load issue, but are still no wiser why luasocket is not working for me.  Could the cable modem block it in some way?  If it is that, I have no idea how to fix it...\n. Narrowed it down to socket.lua\n. Yes, but why does it also stop me from loading or saving?  It says luasocket is not available whether that file is there or not, but leave socket.lua out and I can load and save.\nI just don't see what the connection is with checking for updates and being able to save a game or load a save.\n. I'll try that when I get home\n. Line 1266 (0.30rc) has local valid_url = false, if I move that down a line and replace it with return the game won't start at all. In the trunk line 1266 is blank and falls between if current version == \"Trunk\" and local success, socket = pcall(require, \"socket\").  Adding return here also means the game will not start.\nFor the benefit of Alan the issue is and as always been that I have installed 0.30rc on a windows7 and windows xp machine at home and with both of them I cannot load or create saves, including autosaves with the update check set as true.\nI have been able to get it working on the pc at work which is also windows 7, but did have other issues which were down to installing over a previous version.  It seems it kept some of the original files and one install was 32bit and the next 64 bit.  At work the check for updates does work, as does the game and the only issue there is with the DX exe, but Stephen is aware that another file might need adding.\nWith my two pc's the only thing I can think of is my router/cable modem is blocking something.  If it was the firewall, it is supposed to ask me and anyway I have turned it off, added corsix to the safe list etc.\nIf it is the cable modem, then I won't be the only person to have an issue as it is a pretty bog standard thing that virgin media use.  I am not bothered for myself as I will always know if there are updates, so can turn it off and never miss it, but if it is the modem we need a solution.\nWhat does not make sense to me is why is it stopping me from saving or loading a save.  Why cannot it just say cannot check for updates and leave it at that?\nOn your last question, I think it is just me, but then again how many testing this have virgin media for broadband?\n. Yes, while it thinks it is trunk I can load and save, it just gives the message about  not checking for updates.\nWith return entered there when you try and start the game you just see the lua screen flash up and then close \n. If the disease changes they can then follow that diagnosis path, until it is discovered they have an infectious whatever the new diseases is.  If they were on their way to a room that is not in the new diseases list they could perhaps go back to the GP.\n. Why 0?  What if after the first GP visit it was 50% as the Dr as an idea what is wrong, on the way to the next diag room the patient is infected.  Following that diagnosis it is still 50% and the patient goes back to the GP.  The GP takes a second look and the results from the diag and now thinks oh it can't be what I thought it was, so sends the patient to another diag and the progress is now 55% or thinks oh it's x disease and an infectious strain at that and calls the epidemic.  What better reason to think you have an epidemic on your hands if you send someone to another diag room thinking they have the squits for the results to come back that it is gut rot.\n. I was thinking about testing this against a custom map in freeplay mode.  I wanted to see how this was handled as there is no money in freeplay.\nThen I realised that you would currently not get any epidemics with the current custom maps as the setting needed does not exist and does not exist in the base config either.\nThis is perhaps something you could look at?\nAlso noticed and this was with the cheat, if you were to use it before any patients were spawned it throws an error.  However if you are not keeping the cheat this won't really matter.\nThis was the error\nCreated game with savegame version 80.\nError in buttonup handler: \n...orsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\hospital.lua:1240: attempt to index local 'patient' (a nil value)\nstack traceback:\n    ...orsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\hospital.lua:1240: in function 'createEpidemic'\n    ...epidemics\\CorsixTH\\Lua\\dialogs\\resizables\\cheats.lua:164: in function 'func'\n    ...epidemics\\CorsixTH\\Lua\\dialogs\\resizables\\cheats.lua:128: in function 'buttonClicked'\n    ...epidemics\\CorsixTH\\Lua\\dialogs\\resizables\\cheats.lua:95: in function 'callback'\n    ...\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\window.lua:645: in function 'handleClick'\n    ...\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\window.lua:1406: in function 'onMouseUp'\n    ...\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\window.lua:1390: in function 'onMouseUp'\n    ...ktop\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\ui.lua:703: in function <...ktop\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\ui.lua:690>\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    ...top\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\app.lua:740: in function <...top\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\app.lua:735>\n. it was ContRate I was referring to, perhaps we could add something in the wiki so people know they need this to get epidemics in their level.\nOr perhaps I could do another custom map that includes ContRate and the new awards (and anything else that is missing) that are not included in the level editor at the moment so people have a template to work from?\nwith freebuild it does refer to money, so I am not sure what we should do here.  With the VIP there is a different message, I got no fax with an emergency telling me about any bonus.  Perhaps they should be disabled in freebuild, what do you think?  Another option could be in freebuild you take a bigger rep hit or there is a greater chance of an evacuation...\nOn your question, yes they seem easy, but then again I have not had a really busy hospital yet so there has not been much chance for it to spread.  As I recall in TH they are easy at first, then in later levels you sometimes wish you opted to pay the fine and not tried to cover it up.\n. I am hoping to have more time nearer Christmas to do just that.\nAt the moment I seem to have many things to do and not enough time to do them in....\n. I am running level 8  at the moment and now into the third year, but not a single epidemic.  I am not planning on using the cheat as I want to see how often they occur etc.  I have an average of 20 patients so not mega busy, but even so I thought I should have had at least one by now.  Is there something I can tweak in the code to increase the chances of one happening?\n. I think I have found out why I am not getting anyone that is contagious, I was looking to see where you use ContRate and noticed that was not in my copy of your files.  I guess I must have copied them too soon or something.\nI now see a \"Contagious\" message in the console, so we'll see what occurs.\n. In the level files it says this\nContRate    -       Is this a Contagious Illness (1/ContRate are contagious)\nSo 10 means 1/10 and 40 means 1/40 so the higher the number the lesser the chance of being contagious!\nLook at level 6 and this seems to be the case as those numbers are lower than other levels but this is the level with more chances of epidemics\nso is this line correct?\nlocal potentially_contagious = contRate and contRate  >= math.random(1,100)\nor should it be \nlocal potentially_contagious = contRate and (100 / contRate)  >= math.random(1,100)\nI have made this small change and already the number of patients spawned contagious has increased - what do you think?  However, I have still not had an epidemic and I am now in year 4 with 30+ patients.\n. I am getting a lot more contagious prints showing up (assume that is patients spawned contagious?), but still not a single epidemic :(\nI am surprised as I have also ramped up the diag thing so they are over diagnosed and in the hospital for longer.\nPerhaps I will have more luck tomorrow\n. What do you mean \"You toggling the icons with the cheat?\"\nI am not using the cheat\nor are you suggesting switching on the icons so I can see who is contagious?\n. I started my game again with the small change and noticed that this time it not only prints contagious it was also creating epidemics and shortly after I actually got one with one patient.\nAfter a while though it only prints contagious, does it stop creating epidemics after one for each disease has been created?\nI ask this as I also noticed people were being removed from the epidemic and the table deleted as well.  Had two more epidemics quite close after the first one was covered up, the little cross came up just after the comp fax haha,  Each one has only had one person though, I thought with all the contagious prints I might get an epidemic with more people involved, perhaps the spreading needs turning up?\nI tried the toggle thing, a bit confusing as you don't know who is current when the epidemic is revealed.\nSomething else I have just noticed is it is not sticking to the level file when creating epidemics.  I just seen one being created for fractured bones, baldness and king complex which all have contrate of 0 in the level file.\n. Got my first error, I think it was a nurse seeking out infected patients\nError in timer handler: \n...orsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\epidemic.lua:598: attempt to index field 'entity_map' (a nil value)\nstack traceback:\n    ...orsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\epidemic.lua:598: in function <...orsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\epidemic.lua:590>\n    (tail call): ?\n    ...orsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\epidemic.lua:555: in function 'createVaccinationActions'\n    ...CorsixTH-epidemics\\CorsixTH\\Lua\\calls_dispatcher.lua:249: in function <...CorsixTH-epidemics\\CorsixTH\\Lua\\calls_dispatcher.lua:245>\n    (tail call): ?\n    ...CorsixTH-epidemics\\CorsixTH\\Lua\\calls_dispatcher.lua:436: in function 'executeCall'\n    ...CorsixTH-epidemics\\CorsixTH\\Lua\\calls_dispatcher.lua:358: in function 'answerCall'\n    ...-epidemics\\CorsixTH\\Lua\\humanoid_actions\\meander.lua:32: in function '?'\n    ...orsixTH-epidemics\\CorsixTH\\Lua\\entities\\humanoid.lua:550: in function 'Humanoid_startAction'\n    ...orsixTH-epidemics\\CorsixTH\\Lua\\entities\\humanoid.lua:642: in function 'finishAction'\n    ...xTH-epidemics\\CorsixTH\\Lua\\humanoid_actions\\idle.lua:31: in function 'timer_function'\n    ...\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\entity.lua:178: in function 'tick'\n    ...h\\CorsixTH-epidemics\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n    ...p\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\world.lua:1039: in function 'onTick'\n    ...top\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\app.lua:839: in function <...top\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\app.lua:836>\n    (tail call): ?\n    ...top\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\app.lua:740: in function <...top\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\app.lua:735>\n. Another three epidemics now :) but still each only has the one victim.  Perhaps this is where we need it to spread to anyone, not just someone with the same disease?\nI changed this a little and it does seem to be sticking to the level file now when creating epidemics\nlocal potentially_contagious = contRate > 0 and (100 / contRate)  >= math.random(1,100)\nEarly days though, I'll update you if this does not help.\n. Just got another error, this came after the health Inspector fax giving me compensation.  I suspect the nurse was looking to vaccinate someone, but they had both been cured!\nError in timer handler: \n...CorsixTH-epidemics\\CorsixTH\\Lua\\calls_dispatcher.lua:249: attempt to index local 'epidemic' (a nil value)\nstack traceback:\n    ...CorsixTH-epidemics\\CorsixTH\\Lua\\calls_dispatcher.lua:249: in function <...CorsixTH-epidemics\\CorsixTH\\Lua\\calls_dispatcher.lua:245>\n    (tail call): ?\n    ...CorsixTH-epidemics\\CorsixTH\\Lua\\calls_dispatcher.lua:436: in function 'executeCall'\n    ...CorsixTH-epidemics\\CorsixTH\\Lua\\calls_dispatcher.lua:358: in function 'answerCall'\n    ...-epidemics\\CorsixTH\\Lua\\humanoid_actions\\meander.lua:32: in function '?'\n    ...orsixTH-epidemics\\CorsixTH\\Lua\\entities\\humanoid.lua:550: in function 'Humanoid_startAction'\n    ...orsixTH-epidemics\\CorsixTH\\Lua\\entities\\humanoid.lua:642: in function 'finishAction'\n    ...xTH-epidemics\\CorsixTH\\Lua\\humanoid_actions\\idle.lua:31: in function 'timer_function'\n    ...\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\entity.lua:178: in function 'tick'\n    ...h\\CorsixTH-epidemics\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n    ...p\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\world.lua:1039: in function 'onTick'\n    ...top\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\app.lua:839: in function <...top\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\app.lua:836>\n    (tail call): ?\n    ...top\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\app.lua:740: in function <...top\\corsixth\\CorsixTH-epidemics\\CorsixTH\\Lua\\app.lua:735>\nIt printed creating epidemics for Kings complex etc, they were not revealed though.  It does not do this now though, so perhaps that little change helped?\nJust a thought, but when can they infect others?  If you only have one patient that is contagious and it is revealed when it is diagnosed it does not leave much time for them to infect anyone.  Can they infect others before it is revealed?\n. I think there should be announcements when you get the first and last fax.  I have added these two functions in epidemic.lua and called them at the same time as the faxes are called.  The one thing I can't be sure of right now is whether there is always an announcement if you fail to cover up or you hear it when you succeed as well.\nfunction Epidemic:announceStartOfEpidemic()\nlocal announcements = {\"EPID001.wav\", \"EPID002.wav\", \"EPID003.wav\", \"EPID004.wav\"}\n  if announcements and self.hospital:isPlayerHospital() then\n    self.world.ui:playAnnouncement(announcements[math.random(1, #announcements)])\n  end\nend\nfunction Epidemic:announceEndOfEpidemic()\nlocal announcements = {\"EPID005.wav\", \"EPID006.wav\", \"EPID007.wav\", \"EPID008.wav\"}\n  if announcements and self.hospital:isPlayerHospital() then\n    self.world.ui:playAnnouncement(announcements[math.random(1, #announcements)])\n  end\nend\n. feel free to add this and anything else I suggest if you want when you do some changes\nI have since noticed that the announcements at the end overlap with the one you added for \"there is a man from the ministry in the building\" as this one is called when the Inspector leaves reception and the ones I mentioned are called when the results fax is sent.  I am not sure how easy this will be, but perhaps your message could be called when he arrives rather when he is leaving the desk so they don't overlap or perhaps you can think of another place to call self:announceEndOfEpidemic()\n. I am now on my third game with about 90 patients on average this time - so very busy - and when I get an epidemic there is still only one victim.  As he is already diagnosed he is on his way to be treated, when really he should have been spreading his disease to others whilst waiting to be diagnosed. If you could tweak the spread-ability up a notch or two it would not be so easy.  (I have only failed to cover up once and that was when I accidently clicked on send home)\nI will email you my save as it is always good to have one with a lot of patients.\n. I think I have found a flaw, I just got an epidemic with two victims and then noticed that one of them had not even been to reception yet.  I am guess that it was a fluke she had the same illness and that it was not passed  on to her by the first one.\nWith the last two epidemics, again with only single victims I looked at their history and could see that they had been in the hospital a while with GP, Diag room, GP then discovered.  The hospital is very busy, so they would have come into contact with others, so it ought to have spread to them.\nHave you made any changes yet to allow a disease to change if not discovered for that patient?  This is the only thing I can think of for the spreading not happening as the chances are pretty slim for two patients to come into close contact and also have the same illness.\n. I have tried to expand the \"who can be infected\" a little by creating a function that returns true if the contrate does not equal 0 (trying to limit it to the diseases that are already inline for infection).  That has not really helped, so what I might try next is expand on that idea by returning all non-visual diseases.\nIt might well be that I am not calling it from the right place though. I'll let you know if I see any improvement/increase in victims tonight.\n. I don't think we need the existing cheats, they were okay for testing.  Perhaps though there should be an option to disable them for those that are new to the game (so a sort of cheat).\nA while back I was looking at adding an option like this and also one to turn off earthquakes.\n. @TheCycoONE   I can confirm that this has been tested by me over the last year or there abouts.  It is working and does not break existing game play.  It mimics very closely what would happen in TH, minus the annoying bug of the epidemic failing when a patient left one part of the hospital to go to another block.  :+1: \n. @TheCycoONE Lots of trailing spaces in base config, which is where a lot of those were copied from!\n. I don't think it is specific to the demo files, there are lots of times where objects do that: usually when they are placed next to each other and one is in use.\nIt is on the list of things to fix, but it might take a while to happen\n. At first I wasn't really sure what you meant as I am able to build a research room using demo data.  Then I noticed if you click on the research screen button you get a message from the advisor saying that you need to build a research department, when really what you should see is an information screen telling you that this dialog is not available with the demo data.\nAm I right, is this what you are trying to tell us?\n. @therealgreenpower \nthere is a patch/pull request to fix this, but could you confirm that this is what you meant when you made this issue?\n. Where did the white space come from if all I have done is add some lines further up and that line has moved down?\n. I find that more often than not the readme and instructions are just a link to a website from the game menu.\nIs that an option for us? \n. I have now had the chance to test this against a game with one planned earthquake and further random earthquakes still happen :+1: \nSo if this is added this issue in google code can be closed http://code.google.com/p/corsix-th/issues/detail?id=1653&q=quake\n. I don't think that was the problem.  The game is creating random earthquakes whether you want them or not and the only reason they are not happening in the early campaign levels is because they are being blocked by the code, not from what is in the level file.\nI do agree that the way emergencies are set up to work is a better way, but that is far too complicated for me to take on at the moment.\n. If the game loads the 00 sam file first as the base config and then the actual level file adds or changes values specific to that level, then when you look in the 00 file both emergencies and earthquakes have zero values as the default and the level files adds them if required.\nOn that basis I would say that the lines of code \"(tonumber(self.map.level_number) and tonumber(self.map.level_number) >= 5) or (not tonumber(self.map.level_number))\" are the problem as they are stopping earthquakes in the early campaign levels only.  It is more logical to stop them with \"if self.map.level_config.quake_control.Severity == 0\" as this would then stop them in the early campaign levels and also stop them if the map maker sets severity to 0 if he/she does not want any earthquakes in that level. \n. Maybe, if I knew how...\n. That works for me, I now get a message in the console about getting user data and now I can load games.\nWhen I save I get the message being repeated and the same with autosaves.\n\nWelcome to CorsixTH 0.30!\nCannot check for updates since LuaSocket is not available.\nWarning: Expected table but got userdata. A library probably failed to load.\nWarning: loaded savegame version 80 (Trunk) in older version 78 (0.30).\nWarning: Expected table but got userdata. A library probably failed to load.\nWarning: Expected table but got userdata. A library probably failed to load.\nWarning: Expected table but got userdata. A library probably failed to load.\n. Is there any code I can add to see what this user data is?\nIt might give us a clue on what is going wrong\n. @alanwoolley and @Lego3 \nIf you can think of a method, just let me know.\nI wondered whether it was the system returning a message  and it is being handled incorrectly i.e. windows wanting to tell me that a program was trying to access the internet and do I want to allow it. (you would normally see a message pop up, but that has not happened - since initial install I have added it to the firewall anyway.\nAlthough I have turned off the firewall and added CorsixTH  to the safe programs list, neither seems to have helped.  Windows 7 seems to be very protective and ignores all sorts in the name of security.  \nI have checked the modem settings and I can't see anything there being barred - everything is ticked as allow.\n. @alanwoolley \nOkay, I could be going about this all wrong, but I added print(type(\"userdata\")) and it returned string.\nSo I then added (copied from another location)\n              if type == \"string\" then\n          -- convert from file's default encoding to UTF-8\n          v = encoding(v)\n        end\n      print(type(\"userdata\"))\n      print((v))\nand it returned \nstring\nnil\nDoes this help or am I doing this wrong?\n. now on load it displays  a message that it can't find socket.core, so you were correct\nC:\\Program Files\\CorsixTH\\Lua\\strict.lua:66: module 'socket.core' not found:\n        no field package.preload['socket.core']\n        no file '.\\socket\\core.lua'\n        no file 'C:\\Program Files\\CorsixTH\\lua\\socket\\core.lua'\n        no file 'C:\\Program Files\\CorsixTH\\lua\\socket\\core\\init.lua'\n        no file 'C:\\Program Files (x86)\\Lua\\5.1'\n        no file 'C:\\Program Files (x86)\\Lua\\5.1'\nCannot check for updates since LuaSocket is not available.\nThe installation directory is program files not program files (x86) - this is what it opted for at install\nlua5.1.dll is one deeper in CorsixTH and\ncore.dll is one deeper again in CorsixTH\\socket\\\nI cannot see any init.lua or core.lua\n. same message, renamed the folder to crocket so it would then be crocket\\core.dll\nC:\\Program Files\\CorsixTH\\Lua\\strict.lua:66: module 'socket.core' not found:\n        no field package.preload['socket.core']\n        no file '.\\socket\\core.lua'\n        no file 'C:\\Program Files\\CorsixTH\\lua\\socket\\core.lua'\n        no file 'C:\\Program Files\\CorsixTH\\lua\\socket\\core\\init.lua'\n        no file 'C:\\Program Files (x86)\\Lua\\5.1'\n        no file 'C:\\Program Files (x86)\\Lua\\5.1'\nCannot check for updates since LuaSocket is not available.\n. there was a couple of old corsix installs in there (program files (x86)), so deleted them and get this\nC:\\Program Files\\CorsixTH\\Lua\\strict.lua:66: module 'socket.core' not found:\n        no field package.preload['socket.core']\n        no file '.\\socket\\core.lua'\n        no file 'C:\\Program Files\\CorsixTH\\lua\\socket\\core.lua'\n        no file 'C:\\Program Files\\CorsixTH\\lua\\socket\\core\\init.lua'\n        no file 'C:\\Program Files (x86)\\Lua\\5.1'\n        no file 'C:\\Program Files (x86)\\Lua\\5.1'\nCannot check for updates since LuaSocket is not available.\nthen renamed core.dll to score.dll (the one in the socket directory) and got this\nC:\\Program Files\\CorsixTH\\Lua\\strict.lua:66: module 'socket.core' not found:\n        no field package.preload['socket.core']\n        no file '.\\socket\\core.lua'\n        no file 'C:\\Program Files\\CorsixTH\\lua\\socket\\core.lua'\n        no file 'C:\\Program Files\\CorsixTH\\lua\\socket\\core\\init.lua'\n        no file 'C:\\Program Files (x86)\\Lua\\5.1'\n        no file 'C:\\Program Files (x86)\\Lua\\5.1'\nCannot check for updates since LuaSocket is not available.\nI don't have any directories named lua or files named 5.1, so nothing to rename and you can't rename program files.\n. Solved the issue\nI found that there was an environment variable set up \nC:\\Program Files (x86)\\Lua\\5.1\nThis may have been done by me several years ago when I first attempted to compile corsix myself and then gave up after months and months of failures.\nremoved that variable and now 0.30rc checks for updates\n. Perhaps that should be done by someone that understands exactly what the function is doing, I have only added the save to config part?\n. If you didn't want it in a particular game you could un tick it, at the moment it never remembers your preference from one game to the next unless you edit it in the config. \nThe same could be said about sound levels etc, we allow them to be saved from one game to the next!\n. I downloaded a copy of your branch to my desktop, I don't know what you mean by \"are you on master when testing this\".\nI don't think the error has anything to with your changes as I have seen this happen before.  When I can find it in the google issues I will link them together.\nWhat I have noticed is that if you play for more than an hour you start to get a lot of errors, but I don't seem to get many at all if I play in short bursts of say 20 - 30 minutes.  (Not sure if this is relevant though)\n. Well hopefully by taking it from your page I have the full code.  There was an issue earlier in the week where I seemed to missing chunks i.e. I had nothing in hospital.lua about epidemics, so I downloaded it again.  There is a feature on your page that allows you to download a zip, as I could not figure out how to clone it.\nIt is possible that this error is related to your code, but as this save is in the early stages, I don't think any epidemics have been created yet.\nI have seen the wrong room being displayed on the dynamic menu before, not the assertion part of the error.  Other times though were if you had just moved a room.\nIf it crops up again I'll move it to your issues in case it is related.\n. I was testing the epidemics when this error happened, but I don't think the error is related to epidemics (even though it happened in that branch); which is why I posted the error here - I think it is a general error that happened\n. Perhaps there are two issues here.  One being the assertion error which is also reported here http://code.google.com/p/corsix-th/issues/detail?id=1726 and then the wrong info in the dynamic menu; which I have started to notice happen in other games. i.e. patient waiting for phyc and the info says waiting for gp or similar. \nThe assertion error  is the most important as this one throws an error\nI have now created a new issue for the dynamic info being wrong sometimes\n. Is this with 0.21 or 0.30?\n. I am wondering whether there is some limit to how far the pathfinder can see the correct room?  I have seen sort of similar behaviour with the staff room, if you have a large hospital and one large staff room it sometimes seems that some staff don't know its there and are then less likely to take a break.  When I have seen this is most is when you expand, build a new staff room in the new block and remove the original.  You then start to see GP's wandering the room and not diagnosing the patient. Picking them up seems to reset the issue.\n. Thanks, this is a known issue\n67\n. It looks like my branch is created off yours, not sure why, might be because I cloned!\n. Had already made the changes before seeing your comment.\n. Looks a bit complicated, I have already messed up with the command prompt in recent weeks.  Might try this in a few months time when I am more familiar with it.\n. that is only one of them, there are several and it looks to me they are specific to the actual machines, so it was in the wrong place I believe.\n. @TheCycoONE  You can if you want and at the same goes for any other pull requests I have done.  For the time being I am not contributing code and don't have the time or inclination to change any of my pull requests.  Partly due to git and partly due to other priorities at the moment.\n. @alanwoolley does it with direct3d, but you have to have selected the staff member first as it is the shadow that is above him that is showing on the menu\n. I don't think it did when the pull request was done!\n. What I don't understand now is why was that code about levels 1-4 there?  I need to run a long game to be sure we don't still get random earthquakes.\nI'll close this though and submit at some point the replacement changes.  Too much hassle to squash then or whatever it's called.\n. Now I have just had this save crash with DX (trunk) opengl and sdl are fine and DX it only crashes sometimes.\nThis is the dependency check from my 0.30DX install if it helps\nhttps://www.dropbox.com/s/ib5lxp7ij9zpiql/CorsixTH_DirectX.dwi\n. not really as you can't attach anything other that a picture with github which is not ideal!\nI have put one in dropbox, but how long for?  I think we need a better way than this, as some issues take a while to fix and we can't expect people to clutter their dropbox or similar with our saves can we.\nhttps://www.dropbox.com/s/urjnr24yr8fxjs9/Autosave2.sav\n. \nIn the same save go over to the op theatre and there is another patient not showing in the queue\n. Just seen a similar situation where a patient was not in the queue dialog for the cardio, but then realised he was getting a drink and he then went in.  Does this mean there is a period of time when a patient in the queue for a room can come off this dialog just before entering the room?  In which case, what if in this time there is some interruption, would they then remain off that menu and it would appear they are queuing but are not anymore?\n. Now had this happen during an emergency, all I can think of is this happened whilst the machine was repaired\n\n. Seen this again and noticed that it happened just after the handyman entered the room to repair the machine.  There was still someone wanting the room, only now he is not in the queue and does not enter\n. You will notice that for that room it says there is someone expected, but they never show up.\nPerhaps he has left the hospital, but somehow is locked to that room. \nIt means you cannot edit that room at all.\n. @mrtnptrs  with regard to \"maybe add a date and time to the file name\", I also think this was suggested for saves to.  In windows you can see this information anyway, I have no idea about other platforms, but would imagine they to have this information.  So I can't really see any merit in adding the same information to the file name.\nIf it is the same for other platforms we should perhaps remove it from the todo list as it would be a pointless change IMO.\n. And why would that matter?\nIf we are talking about an image, does it matter when it was created, moved, copied etc?\nThe same for a saved game, why do we need to know when it was saved?\nIt might matter to the user if they want to see their most recent save, but they can do that now anyway.\n. Gladly, but where in the todo list did you see this?  I had a look, but could not find it, perhaps it was an issue or suggestion on google code.\nCan you remember?\n. Both of those have been copied to here now and I don't see anything in them about names including date and time.\nSo nothing to worry about then\n. I am sure that I have mentioned this before somewhere, if there are issues with the map editor and sdl2, why not leave it as it is?   The map editor does not get many updates to it and it is a stand alone exec anyway.  So does it matter that you need opengl to compile it, it has other dependencies that the main game does not need? \n. I think I found the cause, well actually Sadger found it.  I will continue testing tonight to be sure it was down to this error in the disease file\n. I don't think this is fixed, the patch was for one disease with a wrong id, but it appears that was not the full solution.\nIn a map I have been working on for epidemics I have limited visuals as follows #gbv.HoldVisualMonths 9 and #gbv.HoldVisualPeepCount 60 and in month 5 and 5 visitors so far I have had a serious radiation patient arrive.  I have checked and the visual id is correct for this one.\n. I think it applies to all visuals, when making the issue it was pregnant then  Sadger discovered the error in that file and I thought ok it is fixed.\nHowever, it would seem that all visuals are ignoring the setting as they appear from the start when the setting is delaying their appearance or I have missed something in creating the level file?\n. Tried this again against the  current master and is working fine, so a false alarm.  Perhaps Sadger's branch for epidemics was further behind the master than I realised.\n. See issue #141 \n. I agree, in TH you could actually remove both by placing a bench or other object on top unless it was somewhere where you could not do that like in front of a door.\nIn at least one issue though the litter appears to be inside the room already, suggesting that it was either dropped inside the room or through the wall, either of these should not be possible though or was the room built over it and it wasn't removed?\n. No need to buy lots of plants, you only had to place a single tile object over the litter, you could then keep moving the same one.  You could do the same with the rat holes, did you never do this @mrtnptrs ?\n. I prefer what TH did and that is the litter is removed when any object or room is placed over it.\n. The saves and log can be accessed from here too \nhttp://code.google.com/p/corsix-th/issues/detail?id=1731\n. @Alberth289346  save is available\nhttps://drive.google.com/folderview?id=0B0HUYrWk9OBjbE43M3BZT1ZuQnM&usp=sharing\n. It seems to make a difference depending on which way you orientate the \"H\"\n\nIs this something we can change or should we update the wiki on map making?\n. It doesn't say it can't be that way either, I think it gives the impression that so long as you have a 5x5 box with an H in a different coloured tile that it will work and be seen as an heliport.  I think it should either mention that the orientation makes a difference or alter the game so that it doesn't.\nI think there should be some mention that it must be accessible from the start of the game (I have seen an issue where if it is not accessible from the start it is never seen as an heliport).\n. I can't remember what TH did either, but I could check I suppose.\nWhat I was expecting (to be honest it is not something I've ever really taken much notice of before) is if I cure 7 out of 8 I would get 7/8ths of the 8000, so 7000.\nPerhaps TH only ever gave us a proportion too, it just seems odd to me that you get 80% of the maximum bonus for not treating one person in eight.\n. To be on the safe side I have run TH to see what the results should be and it is how we think it should be.\n\n. I'll do the test tonight and then have a go at merging it :)\n. @Lego3   Apart from the comments above, are you okay with this change?  Does anything spring to mind to support the bonus being calculated this way, I think it was likely a mistake that we have never noticed.\n. Can max_bonus be removed?\nI think it is still in the fax as the fax tells you how much you could have earned as well as what you did earn\n. It is used by the fax because I have tried removing it, other than that your change is working fine.\n. Not every time and not with opengl, but I have had this happen before and I mostly use DX.  I couldn't reproduce it at will, but when I have had it happen before the message is the same. I say message, I copied this from the error log, windows does not do the standard error reporting it normally does when an application crashes.\n. @mrtnptrs\nNo that is not what I mean\ncan you zoom out with SDL?  (That is why I have not mentioned SDL)\nThe exact steps are already mentioned, which are \"from the debug menu I un-ticked limit edge and got this crash as I zoomed out \"\n@TheCycoONE \nAs this seems to be specific to DX and is only connected to a debug option should we close this? \nIf the plan is to move to SDL2, will we still have DX?\n. I see the following in the console window\nError loading languages\\spanish.lua:\n...Desktop\\corsixth\\CorsixTH-grim_reaper\\CorsixTH\\Lua\\languages\\spanish.lua:99:\nunexpected symbol near '='\n. I think the polish file has had an update recently, so perhaps this conflicts with the above changes. If it is that, then simplyryan will need to include that recent change - I think it was only one line anyway, so not a big change to do.\n. The change was in issue #192 and was only new_game = \"Zacznij gr\u0119 od samego pocz\u0105tku\u200f\",  So it will be simple enough for you to add this again if that line gets lost when this is merged\n. the patient appears to be in the wrong room!\nIn her treatment history the last room is pharmacy and she now also shows the about to die icon.\nThere are other issues about going to the wrong room and also about being able to die in a room, so perhaps there is a connection here?\n. Sorry no one has replied and I can't really help as I barely understand the action queue myself.  Perhaps you can get some help in the wiki as actions are detailed more there\nhttps://github.com/CorsixTH/CorsixTH/wiki/Humanoid-Actions\nIt would be nice to get a solution to this as there have been lots of crashes around proper idle\n. I think that what should happen is you can't die in a room and should either continue with the treatment or leave the room and die.\nThis was really an attempt to fix an issue we had a few months back, if I remember correctly though for some reason with the operating theatre it seemed they did not leave and carried on with the operation.  If I can find the original issue I will add a link here and then perhaps you might see something that is wrong in the current logic.\n. This is the issue which is still open\nhttp://code.google.com/p/corsix-th/issues/detail?id=1258\nand this was the partial fix\nhttp://code.google.com/p/corsix-th/source/detail?r=2449\n. So far for me they have all gone to heaven, new game and old save.\nIs there a chance that you have not copied everything to github yet?\n. Does it matter if the hole appears under debug patients?\nThey are not part of the game, they are only there for testing, in normal gameplay they are not used.\n. I was wondering why I am not seeing any deaths other than heaven so I have been looking at the files.\nIn humanoid_actions, the die.lua file does not mention the Grim Reaper.\nPerhaps you forgot to include this and perhaps others when you transferred everything to your github master?\nI'll stop testing for now and wait for you to make the branch as you mention  above.\n. As you know the adding of the Grim Reaper is being tested.  Tonight he arrived in my game and there is a film (sorry no sound) of it here https://www.dropbox.com/s/gjsqma3sdsactms/TheGrimReaperHasArrived.wmv\nWith Alan's help there is a windows build available for testing http://www.armedpineapple.co.uk/cth/builds/MarkL/CTH-20140223-GrimReaper-a4e71fd350.zip  or you can checkout my branch and compile it yourself https://github.com/MarkL1961/CorsixTH/tree/hell-deaths.\n@mrtnptrs   We would appreciate as many testers as possible, as it would be nice to get this and epidemics into 0.40,  how is that going @sadger, you were making some change?\n. I would say that #372 and this are the same issue\n. That might be the real issue, I think that was added for better crash handling and might be why sometimes \"dead\" patients wander to reception not knowing what to do.  Something interrupts the dying, they then have no action to do and defer to the stand-by of seek reception.  They no longer need diagnosis as they died, but didn't finish it off by going to heaven so they just sit around and do nothing and sometimes they go back to reception.\n. If you have turned on debug mode, this is available in the config file you should be able to click on a patient or staff and see some facts in the console window.\nThese can be added to by adding \"prints\" in the lua files, look in humanoid.lua for examples\n. I have given this a small test against a couple of saves and it would appear to fix this issue.\nI did however notice that it was still possible for a patient close to death to enter the treatment room, show the icon for dying, but then go on to be cured (because they were in the treatment room).\nMaybe the mood icon for dying is showing too soon, showing in a room is normal if the treatment fails, so perhaps if the mood icon is dying and they are then cured at the last minute it should change to cured?\n. I think it would be enough to remove line 538  self:setMood(\"dead\", \"activate\") as the mood should show anyway once self:die() is called, what do you think?\n. @phillipp not sure I understand?  If line 538 is removed that takes self:setMood(\"dead\", \"activate\") away and leaves it to be called by  Patient:die(), self:setMood(\"sad6\", \"deactivate\") still gets called from line 537.  It might mean for a few seconds there is no mood, is that what you mean?\n. I am still waiting for a reply from Phillipp, it maybe he sees something I have not.  Otherwise I think what I said a couple of comments ago would do.\n. I have tested this against a couple of saves that displayed this problem and it appears to be working as expected.\n@TheCycoONE  I won't attempt to add this though as it looks like it won't be straight forward (needing the command line is not my favourite as you know)\nNeed to remember that this is linked to Issue #163 where there is then a link to the original issue in google that will want closing\n. I don't think the duplication was in the original patch, but may have come about when several patches were added together, so well spotted\nhttp://code.google.com/p/corsix-th/source/detail?r=2420\n. @TheCycoONE \nthe afterload is entered twice\n. Tested this and it fixes the stated problem.\nAs I don't use debug patients, it might be good for someone that does also to verify this?\n. In the clip it looks like the bald guy gets a bloaty head when he dies.\nIs that what this fixes?\nThis came up before, https://groups.google.com/forum/#!topic/corsix-th-dev/8BQqrhdhhmA\n. That is a good idea.\nI think it would be rare for one to die, but say if you guessed the cure and it was the wrong type of baldness then it is possible\n. We had that issue with the slack female for heaven death (losing the head). In the die code there is some change that is done so she has a normal head  now.\nI suggest that on death the patient type is changed to standard male.  There is no head with the new hair for falling either, so the change could happen just before falling - what do you think?\n. This does exactly what is stated, patient with a bald head now gets a normal one with hair just as he is about to die - thanks for the fix.\n. @TheCycoONE  Given how many pull requests #237 has affected, would it not be easier to reverse that change and then add these existing pull requests first before merging #237 again?\n. So basically we could do with someone testing these pull requests to confirm they do what they say they do without causing new errors, before they become out of sync? \nI thought that Maarten had volunteered to manage the testing, I know he is back, because it was Maarten who listed all the requests that had a conflict with #237.\n@mrtnptrs now that you are back, are your testers doing any testing?\n. SDL2 is still a separate branch, those who are working on that will make sure everything works when they decide to merge it I guess.  The majority of the patches are for the main branch so it should be that you test it against.\nAs for testing, I think you can checkout the relevant branches - @TheCycoONE  is that what you do?\n. @TheCycoONE \nI think this should be safe to add as it affects nothing at the moment and will be needed for the hell death - do you agree?\n. @TheCycoONE  I see from issue #180  which is yet to be merged that the travis build is already done - or that is how it looks!\nHow will this work for the existing pull requests?\nCould this cause problems, as not every pull request gets merged, but it looks like it is added to the test builds before anyone has made a decision?\n. Re: the edit.  I might need some instructions for that.  What I was thinking was to build the \"going to hell death\" stuff for testing, to see if it works okay.  Only trouble with that though is some of the pull requests already exist :(\n. @alanwoolley  @TheCycoONE \nI have created a branch for hell deaths so we can get builds for testing.  Are you okay with me merging the existing pulls or would you prefer to do it in case I mess things up?\nActually, having taken a look I am not sure I know how to move the existing pull requests to the new branch.\n. I like your last suggestion better, I can then like you say copy a lot over manually.\nI was going to add several of the patches as there are going to be some c++ changes to come as well and they really all need to become one for testing it all.\nIf you can help with the travis thing that would be great, (could be quicker than trying to compile it)should be around tomorrow night\nthanks\n. @alanwoolley   I have made a branch off my master for hell deaths and I am ready to add the patches that relate to hell deaths including a c++ change for heaven deaths.  I have not done pull requests yet, in case yours needs to be done first.\nAm I right in thinking the pull request you mention will give me the ability to build with Travis CI?\n. Yes that is correct and I have branched off my fork for hell deaths\nthanks\n. Sorted, took me a while to find where :)\n. @TheCycoONE \nI think this should be safe to add as it affects nothing at the moment and will be needed for the hell death - do you agree?\n. I don't think anyone ever planned on killing them and they are only for testing; so not really that important - unless someone thinks it could be useful?\n. I think the svn link was to do with the automatic builds, so that there was a message to tell you that you needed to re-compile (needed a new exec)\n. I can't now either!\nDirect3D\nMaybe just a glitch on that day, as I recall it did it more than the once though.\n. don't merge the travis file though\n. @TheCycoONE  I might need help here to merge or squash the history.  I have tried two different ways to avoid the command line prompt and I don't feel confident enough to it try that way just yet :(\n. I created a new branch \"GrimReaper\" and copied all the changed files over from the build so that it would not keep all the history, that is most likely what is in a4e71fd.\nI don't understand why all the other stuff is there too.\nPerhaps I should rollback the changes and then submit the pull request from this branch to the corsixth master? I have a feeling that the Hell Deaths branch here was created by accident last week and is a copy of my hell deaths branch and that is why the history is there, would that make sense?\n. RE: Does @JASheppard have all of this stuff in one branch yet.\nYes, this is where all the history comes from, plus there are several changes and fixes to merging errors that we have had.\nLet's see if the roll back idea works, everything is in a4e71fd and the rest is how we got there.\nAnother thought is the travis file, if I exclude that will the pull request think I am deleting it?\n. @TheCycoONE   Sadly it seems hell bent on taking the history with it, even though this is a new branch from my master and the changed files then added.  Should I have used a different name for the new branch?\n. @TheCycoONE  I have not edited the comments as I have noticed the builds went to my folder so it might not have worked out as expected. \nI have though added most of the comments from Joe at the top as you can still review the code, but if there is still an issue with the travis file whoever does the merging will have to watch we don't overwrite the original in the master.\nI have also been a little tied up trying to tidy up the wiki so that it is readable etc\n. @TheCycoONE   Good to hear that the travis file should not cause a problem, it made me wonder what was going off when the builds for all three parts were notified to me and they don't show where the other builds are.\nAs for the commit comments, there was no particular order used when submitting the changed files, so it would be difficult to say which of the comments relate to which files.  I just selected a group of the changed files and submitted them, one part was the c++ changes and the other two were the lua files.\nThe build works and the Grim Reaper does now make an appearance sometimes when someone dies, the sound effects match and so far in testing I have no errors thrown.  The only thing I can't check is the coding style used as I am no expert at that myself.  Some blocks seem to be too long to me, but that does not mean they have been done wrong!  Joe has included comments in the files he has changed to explain the changes, so I don't really see why you also want a detailed description for the three parts of the pull request.  This all seems to be overly complicated and I don't recall there being all this hassle with patch files and google code/svn.\n. In svn it would have been one patch.  If changes were requested for whatever reason they could be done and a changed patch submitted to replace the first - job done.\nIn the examples you have chosen I can see why the second is a bad commit as they are two different things being fixed or added and are not related.\nThe above for the Grim Reaper is for one change, to add the Grim Reaper, it does though span several files.  I read somewhere here that you preferred big changes to be split, which is what I think Joe was attempting to do.  In the process of doing this he was also making changes so we were ending up with some files being changed more than once. \nI then suggested that he submits them to a branch I created off my clone, the intention being that when he had put everything together and when there would be no more changes needed we could submit a combined pull request in one lump.  At the same time I hoped that we would lose the history of all the changes along the way.\nHowever this did not work as the pull requests kept showing all the changes along the way too. Which is when you kindly helped me the other day to submit a pull request without all these changes.  Whilst we were doing this I got the impression that you wanted it splitting up and I said that I was now confused, because you had previously wanted it in one change.  I then said that I had a list of the changed files and would just split them, but wasn't sure that they would work without the rest.\nThis is where I start to find git confusing, because in pulls I have done there may be something wants changing i.e. a trailing space. I make the change and git adds that change on its own to the pull request, which you then want it merging. It would almost be easier to just delete it and start over. (I have done that before now)  With svn the new patch would replace the old, whereas with git it keeps a track of what you have done and shows them as separate changes.\nI don't know, perhaps something got confused along the way and comments have been mis-understood!\nAnyway, the three parts above are all part of the same change, I doubt one part would work without the other two, but I have not tested the separate builds, only the whole thing.\nIf you want it in one, I will have to delete it and start over, but I suspect the way git seems to work it will still remember these three parts as well :(\n. I had a go at trying to merge or squash the commits and was getting nowhere and kept getting errors and then stuck, so in the end I just reverted the changes and then added the files again.\nLooking above it seems it has kept a record of all of this and has most likely made things worse than they were already!!!\nI'm sorry, but I am finding all this way too complicated, even when following your instructions :(\n. @JASheppard Thanks Joseph, if you want to squash what is already submitted above you have full access rights to my repository and are more than welcome to take over.  :+1: \n. @TheCycoONE  Believe it or not I followed your instructions and also had a webpage up to follow as well and it still went wrong.   I may well have been trying to do something in the wrong order, who knows.  I will learn how eventually, it will have to be in small chunks.  That command prompt is very unforgiving and I find I soon get lost when something goes wrong.\n. Might be because this pull also removes some trailing spaces!\n. That can be done as a separate pull or we end up with this being in bits and an expectation of them being merged.\nI will look through the existing strings for the advisor, as there may already be something relevant.\n. There is one, but I think it is part of the multiplayer challenge \n\"You must accept at least one visit from a VIP in the next %d months. You also have to receive a positive report from the VIP.\"\nWe could use this or just create one - thoughts?\nPerhaps something like \"You can't keep fobbing off these visits, they can just visit you without an invite you know!\"  \nShould the VIP score be reduced on unannounced visits as well?\n. Take a look at the earlier comment, we are thinking of adding a message from the advisor warning you not to fob them off etc.  As for when they arrive, there is already something for when they turn up, or were you thinking of something more specific, like \"a VIP is about to visit you un-invited, they can do that you know!\"\nAny messages though will have to come in a separate pull from this one.\n. With regards to issue 1580 mentioned above, the issue is that you get a persistence error on saving if the jukebox is open and includes autosave. The error is a persistence thing, which I don't totally understand, but I think it is that the save cannot include the ticks and crosses or your selections and only if the menu is open.  There is no problem if the menu is closed, so this makes me think it is not your selections it can't save, it is it can't represent them (the ticks and crosses) in the save.  Is that possible and can anyone think of a way to fix this?\n. Might be because this pull also removes some trailing spaces!\n. I don't see what is wrong with the indentation, I have compared it to others and they look the same to me\n. Because I have just messed it by trying to add something I had missed \n. This replaces the earlier pull as I had missed some small bits in the customise menu and git was being a git again for me - so easier to start over and delete the previous branch\n. Might be because this pull also removes some trailing spaces!\n. The check for updates button is so it can be turned off!\n. @mrtnptrs  The build failed on freetype so perhaps you did do it wrong\n. Can you roll back or revert 9de7af0  and change freetype  back to what it was?  (I am by no means an expert at Git!)\nIt looks like the latest freetype is a little more involved, perhaps @TheCycoONE  or @alanwoolley can offer better assistance here?\n. does your th data have sound-0.dat?\n. Perhaps you missed that folder when copying the data over?\nDoes that mean there is no longer an issue?\n. Duplicate of issue #66 \nYou will notice that the list of objects for the room is including litter, which it should not do.\n. When I attempted to download your save the download was blocked as the there was some Trojan or Virus on that site.\nAccess has been blocked as the threat Mal/HTMLGen-A has been found on this website.\nCan you move your save to somewhere like dropbox?\n@Lego3 / @TheCycoONE \nNot being able to attach saves and game logs on Github is a bit of a drag.  Can either of you think of a way around this, perhaps having a space somewhere like dropbox or similar that anyone can access easily that does not have virus's and the like?  Then having a link to this easy to use place on here.\n. Easier to re do this pull\n. I don't see any save or game log, just a picture of a cloud with an M!\n. That is level 12 I think.\nRemove the radiator from in front of the inflator clinics door and you won't get the errors.\nYou should not be able to place objects in front of a door.\nThis is mentioned in http://code.google.com/p/corsix-th/issues/detail?id=1537, so has been known about for some time.\nChanging the title of this issue to remind everyone of the problem.\n. I am no longer able to place a radiator in front of a normal door, but it is still possible to overlap on a double door.\n@J-Shep \nHave you started to fix this then?\n. @TheCycoONE   Try placing a radiator in a position where if you were to build a room you would place the door.  Now build the room around the radiator and whilst in blue print mode you can place the door next to the radiator.  Now you have a room with a radiator blocking the door\n. I think there is still an issue with the blue double doors and that it is still possible to place a radiator in front and over lapping them.  Can't check it again at the moment, but it was still possible the last time I checked.\nAlso bench placement can cause a problem when next to a door - think that is in another issue somewhere\n. Already in fax lua, for the end of level offer fax\n. @mrtnptrs  Try to be consistent with your argument!\nno it was not in TH (the grace period or an option to turn it off)\nno the patients or staff don't complain in the first year of every level.\nYes that is unrealistic, that is why I thought to add an option to turn if off\nYes it was added because people complained, they also complain that it is unrealistic, hence an option to turn it off\n. I thought it was about right when testing.  It needs to be more than 50:50 as it is only males, but then again not too often as you did always see more go to heaven in TH and only sometimes was it the Grim Reaper.  So 65% sounds about right\n. In https://github.com/CorsixTH/CorsixTH/wiki/LDocGen I think it says --! not ---.\nWhere have you seen this?\n. Perhaps we have adopted our own style then!\n@TheCycoONE  Our wiki pages on this topic are not in the side bar, so not that easy to find really.  I know they have only been created recently, so may not yet be complete.\nShould I add  a link on the side bar or not or perhaps link to them from one of the other pages like  Coding Conventions?\n. @TheCycoONE  We have a link in the wiki that I copied from google, it goes to the corsix server I think.  Shall I update it to Alan's server when I do the other changes later?\n. @TheCycoONE  I have merged those two pages with Coding Conventions as they would appear to be related anyway.\nNot sure what you mean by cleaned up as they look okay (I have though cleaned up the appearance, so headings are the same sizes). \nIf you didn't want them merging it is easy enough to split them.\nI have also updated the link for documentation on the home page, hope that is okay @alanwoolley \n. With regard to falling through the wall, is that related to this issue?\n. As you are fixing it so they find the space to fall I've closed that issue on google, plus so it removes it from the graphical list at the same time.\n. Two minor changes here now for over five months!\n. This does appear to be a duplicate of the issues on Googlecode.\nI have closed those and linked back here.\n. Ageed\n. That will be either Bluebaerry or SimplyRyan, I have never dealt with translations as such, but have had lots of dealings with the English file and original strings.  I only picked up on the mistakes above as it was those lines gave me problems when we first moved to github.\nThe forum is a good place to start as there is a translations section  http://forums.corsixth.com/index.php/board,11.0.html?PHPSESSID=2e79d3219987889079999a90142bf244\n. Do you need to start from scratch?\nWhy not remove the lines we know are not needed, see my first comment.  You should then be able to see what is left to do when you press Ctrl + Shift + D from in the game.\nThe string dump should tell you what still needs to be done and it might tell you of any other strings that have since been removed (there are not many that have been removed and these cheats might be the only ones).  There is more info in the wiki.\nWhere it might be tricky if any strings have been changed or re-worded, but I don't think there have been many and you could trawl through the closed issues to see what they are.\n. I think this is a duplicate of #235, although there could be other issues in there too\n. This may be relevant, but I found a while back that some lines merged with the previous one.  For me it seemed to be where the dashes were so you would get in the config things like prevent_edge_scrolling = false-------\nIt never affected the game from loading, but I thought it looked odd when viewing the config and I started to add extra lines in config_finder. \nThis could have been around a year ago, if you think it is relevant I'll try and track down when and where etc.  It was around the time we started to tidy up this file and added the extra settings menus.\n. I am and was using windows 7\nJust looking through some commits and http://code.google.com/p/corsix-th/source/detail?r=2161 is a good example of what I was seeing in the actual config.txt (line 49).  I am not saying this is when it started to go wrong, just that this is the sort of thing I was seeing sometimes back then.\nIt  might be an idea to delete the existing config.txt so the game can create a new one to see if this can still happen, otherwise it tends to just update the one you have when there are changes.\n. This was on google and seems to be related\nhttp://code.google.com/p/corsix-th/issues/detail?id=1106\nCould this be one place you need trailing spaces?\n. Not many people would notice the change as the config has not changed recently.  Joe though would get a new/updated config file when he made a change and this is why he has had the problem.\nI take it you know how or where to fix or does the above patch do what is needed?\n. From memory to keep the intentionally empty lines when I was tidying this file I started them with two dashes.  I have just looked at an old config finder I have at work and I can see that where there weren't two dashes there were spaces. (trailing spaces was never an issue back then, which will be why there were so many!)  Now that these have been stripped it is possible that more lines than those in this patch will have been affected. \nI don't have a working copy of the game at work so I can't check that here.  Perhaps have them all as you have suggested for consistency?\n. I'll look out for it and will test it straight away seeing as I know what I am looking for.  The config finder ought to be the only file affected as it is the only one I can think of with the double square brackets.\n. Just for testing I have deleted my existing config.txt to get a new one.  Not only was there the problem Joe reports, I also has some words (field names) get repeated e.g. heightheight\n. I'll close this seeing as there is now a pull request.  I won't merge it until @TheCycoONE has taken a look\n. Didn't like to until you had seen it as you may have had other ideas - best to play safe, what works is not always the best solution.\nNice bit of collaboration though, always good when you can fix issues quickly\n. That works for me, deleted my config.txt and made some changes and got no problems :+1: \n. Had you had the tutorial on?\n. Tutorial usually ends on hiring the Dr!\nin order to replicate can you give a step by step breakdown of what you did?\n. Re: \"For some unknown reason debug mode turns off information windows\" that is by design.  There was something in google a couple of years ago and was a requested change.\n. @TheCycoONE   Not sure how I could test this to be honest.  As you are the movie guru do you want to add it if you know what it is it is fixing?\n. I have flagged it as low priority and future, if as you say sdl2 will fix this there is no need to rush.\nOdd that it is random!\n. On a side note, is it just me that gets a webpage crash when setting labels within the issue?\nSet this as high priority as it will need investigating and fixing before the next release\n. Yes that's it, moved the other folders and it works.\nStill not perfect, I doubt I am the only one to have added folders to group saves\n. It will be an option on the fax you recieve\n. Was the research room built before the fax came?\n. It will depend on what you were expecting to get from sending them to the research room!  The research room will find a cure (clinics) and improve one (the machines and drugs), it won't discover an unknown disease.\nIf you get a fax where the send to research is greyed out it is because you don't have a research room or researcher.   If you then hire one or build the room the button won't then become available to the existing fax - it is something that would be nice to have and is known about/recorded elsewhere as a future option.\n. From memory the button is also shaded out if the clinic can be built, but you have not built it yet.\n. The edit button is currently only for rooms, using it for corridor items has not been implemented\nsee the TO DO list\n. That seems to be okay :+1: \n. Hope that worked out, it's the first time for me to be merging intentionally :)\n. The charges increase anyway as your reputation increases and they also go down when your reputation goes down.\nThe feature you have referred to will need some investigating.  It is where when you increase your prices directly some patients will leave without paying.  They sometimes did this without you increasing your prices, which suggests that this was complex.  I never thought to experiment with it in multiplayer, but it may well have had something to do with attracting patients away from your competitors.\n. Who or what is to say a price is too high?\nIt may well be that the patient is happy to pay over the top if you have a good reputation for dealing with a particular disease and have had no or few deaths.  They may also compare what you charge compared to other hospitals in the area and also compare their success rates at the same time.\nIt may be as simple as the patient does not care what it costs if the insurance is paying the bill.\n. @Steadi   Why have you closed this, are you planning on making some changes?\n. @Grimdoc  Easy to check, lift the bench and see if the mood goes with him\n. On wiki, I would suggest you create a page.  We can then either link to it or we might copy it into an existing page if that seems more appropriate.\nOn your other comments.  I doubt we will ever really know how it worked in TH, I and others have tried and can't really see a pattern.  Interest rate might have something to do with it as that varies from level to level.  My thought was that maybe the patients have a base line that they would see as acceptable to pay for any treatment and that this base line would increase over the years in line with inflation. Pretty much how we might judge prices now, we tend to know if we think we are being over charged, but that can vary from person to person.  What you say with insurance makes sense, why would you refuse to pay when you are not paying.  Other than this, I would say that what ever the scheme we come up with, so long an no one thinks it is too complex and providing it makes it near impossible to increase prices without it making you lose patients (cheating) then I say we do it.  It is possible that some patients might think you are over charging, but will pay anyway and at the same point their happiness would go down and maybe even your rep as you would spread the word to others.\n. I meant inflation rate\n. Could this be the same as issue #256 ?\n. Maybe the insurance Company is going to pay their bill in a few months time!\nsee here\n. Unless you are compiling the SDL2 branch, I think you need 1.2 see wiki.\nNot sure why it mentions SDL2 from version 0.40 just yet, as that has not been released as far as I know!\n. @TheCycoONE   I have updated the wiki page mentioned above.  I think we can add about SDL2 once it has been added to the main branch/0.40, until then I think it will cause confusion.\n. Yes :)\nIf you look closely it is above the fax\nThe choice is greyed out because the pharmacy is researched, you just need to build it.  This rule seems to be ours though as from looking at the first fax from TH it did not do the same here!\n. @Lego3 I think this rule came about as there was no logic in sending someone to research if you could already build the room.  Does this sound about right to you Edvin?\nIn TH there was the perception that you could earn something from the autopsy, but if I remember correctly I researched this a while back and although it is in the casebook, you don't actually get paid from an autopsy.\nPerhaps during the planning for TH this was the intention and why such an option was available?\nShould we perhaps consider this an improvement in Corsixth?\n. @TheCycoONE   It does add to the research with a chance that if you are found out your reputation goes down.  This was the same in TH.  We don't show the machine in the casebook like they did in TH, but in TH it said you earned from its use (there was a fee listed), but in testing I could not see that being applied.\n. I see what you are saying, but you would not get the fax once the room is built (using pharmacy as the example) would you?  The fax in the example above is only received because there is no pharmacy room built.\nOr are you thinking of it as a tactic you could use where the drugs percentage is low; so you could by choice not build the room and instead boost the percentage of drugs by sending the patients to research?  This is something you could have done in TH (I don't remember using this method myself, but I can see the benefit in the later levels to help keep the deaths down) judging by the fax above.  With that in mind then perhaps we should re think this rule we have?  On these lines this could also apply across the board as you may want to improve a machines strength quicker in levels where there are likely to be earthquakes.  Something else we can't do with this rule in place\n. This is the change that made sending to research not an option if you could build the room.\nhttp://code.google.com/p/corsix-th/source/detail?r=1851\n. I can't re-produce this error, the sofa does not move unless the room is being edited and you cannot do that until the staff have left the room.\nFor me the crane picks up the staff member only!\nDo you have the save where this happens?\n. I don't doubt you, I suspect though the error was somewhere else in the game. Proper idle not in action_queue is known about and mentioned in another issue.  My feeling is that error was being thrown anyway and is just a coincidence to when you picked up the Dr.\n. I have been able to recreate this issue.  It occurs if you switch between full data and demo data.  Build the research room with the demo data, save and then load this save with the full data and the game does not recognise you already have the research room and disables the research screen.  You will even get messages from the advisor.\n@marcelhbertonzzin  is it possible that this is what you did?  Perhaps you loaded a game created by someone using the demo.\n. Are you sure you have the full version and not just the demo?\nI feel sure this issue has been mentioned before.\n. So you were able to select easy and hard before then?\n. So we can rule out corruption, can you copy your original files over again from the cd and then try it.\n. It says your save is from beta 8 or before, which is very very old indeed.\nthere have been numerous fixes in the last three to four years.\nI suggest you update to 0.30 load this save and then click on restart. (you might be able to get away with restarting, just see how it goes) This will mean playing this level again, but I doubt you will get this error.  If I had the time I would check, but I do have a feeling that this is something that was fixed ages ago.  It was something to do with a bug in the original level files if I remember correctly in level 7 one emergency is for a disease that is not discovered until level 8 (hairyitus).\n. It should be no different as I left all that in!\n. Just run a game for several years past the one and only planned earthquake and no further random earthquakes!\nI have no idea why and no time to figure it out so someone else will have to run with this.\n. I am not sure this is fixed!\nI am testing with CTH-20140824-master-b408fa2818 and not only did the game not pause at year end I also did not get the fax to move on to the next level.  Speed setting 3 or speedup has the same result.\nsave\n. For the win game fax you don't have to click on anything now as it should open on its own\n. Just got around to testing this and it is working for me.  I think it is safe to close now - thanks :+1: \n. For me if you are using the speedup key when the award screen opens then once you close it the game is running fast and the speedup key becomes a pause key!\n. Did you see function GameUI:onKeyUp()?\n. @DjCoke did you try sending patients home between those dates?  That might be the reason why the tile_x variable became nil.\n. @J-Shep does this help?\n. @J-Shep If you scan through the issues both here and on google code you will see that there are issues with rooms that have screens,  one I can think of is editing the room and the undressed patient trying to leave without getting dressed again.  Perhaps related to what you are looking for here.\n. @J-Shep  Had a thought about this error.  If a patient is on the way to a room that is then deleted he should be directed elsewhere (similar room or perhaps reception or go home).  If it in the patients list of things to do and that room is no longer there could it result in tile_x variable becoming nil?  I think I have read somewhere that the go to room order is based on the tile coordinates which are just inside the rooms door.  This must work most of the time otherwise this error would be seen all the time.  But, perhaps there's an edge case when combined with something else that stops the order being removed.\n. @J-Shep  for \"a lot of question marks \" I take that to mean green fax icons as this is what you get if there is a queue for the room as you will get a fax (?) for each one asking what you want to do as the room they want is no longer there.  In fact I think this is the wrong thing to happen as in TH if you move the room the patients will just wait for a bit and then go back to reception if the room is deleted.\n. @J-Shep why create a patch for 0.30, it was first reported more than a year ago and does not come up that often.\nI think it would be better to update the existing branch as we cannot be far off from a 0.40 release.\n. @TheCycoONE  Do you have a date in mind?\nHow much work in needed to get hell deaths, sld2 or epidemics in?  (all or any of these would mean a new feature added).  It would be a shame to not get at least one of these in after waiting all this time.\n. @J-Shep Operations not being interruptible is intentional I believe, I remember this from when that room was first added.\n. I have seen this before, can't remember what the cause was though.   \nWere you loading a save or starting a new game or is it every time?\n. @Ep0na  I think it has something to do with the level file, perhaps something is missing.  Can you link to a copy of the level file or copy the win lose criteria to this issue?\n. The line in the error message is to do with loading the win and lose criteria. this is what you see when you open the status screen.  What level was you playing when you got the error message?  I need to know this first so I can tell you what to copy.  Custom games have the level files in a different place to the TH Campaign.\n. @Ep0na \nNeed a response or how can we help you with this issue!\n. @hedcase1 Please create a new issue, you don't appear to have the same issue here as this one is to do with clicking on the status button.  (yours is to do with room confirmation).\n. No reply from @Ep0na so I'll mark this invalid\n. This has been said before, but I have never been able to reproduce it.  Can you provide video of this?\n. I think I have said before when this was mentioned that you would have to be very quick to get such a patient back to the GP and re-diagnosed before they died and I think that would be almost impossible to do.\nEdit: What mechanism is there to direct a patient back to the GP, did they do this on there own?  \n@TheCycoONE  Can we say that this is a none issue unless someone was to provide footage of this happening?\nPerhaps it was possible in the rare demo mentioned here\n. I think if it is #quake_control[0].StartMonth.EndMonth.Severity 0 0 0 then there should be no earthquakes (including from the cheat) and it should only generate random ones once either there are none left in the level file or if the map creator states random(), which I think is an option for emergencies.\n. I think in the original, once they had expired that was it, same with emergencies.  I am not about to test this though as it takes too long and TH does not always like it when you play with the level file.\nPerhaps the random ones should be no higher in strength or lower than the planned ones +/- 1.  Your idea of repeating them seems sensible.\nI wonder how the random() emergencies actually work out in frequency, numbers, illness etc?\n. Or a toggle that allows you to turn off random earthquakes.  As I said in the other issue this then gives the player the choice of not having any in a map they create or for that to be ignored by turning on randoms.\nIt should be a simple enough fix, as I recall when I attempted a solution it was the random that caused me the problems when trying to make it accept 0 severity means none and remove the hard coded bit for levels 1 - 5 or something like that.\n. I can't see this mentioned here, but it may have been said elsewhere. In TH you always had a warning (tremor or slight screen jolt) to tell you a quake was on the way.  This was when most of us would have slowed the game down and checked all our machines were up to it.  CorsixTH is lacking this tremor.   \nEdvin and I did look at this a few years back, but the current code is complex and Edvin was busy at that time.  Was thinking that perhaps a month prior to the specified quake the screen moves quickly and you get the warning announcement etc, but no damage - then get the quake.\nIn favour of the other suggestions as well\n. @TheCycoONE  I am not sure I understand your \"Other observations\" regarding different earthquakes in the same level?\n. Agreed \n. @TheCycoONE\nAs the build fails I can't test this either, although I can see what it will do.  Do you want to add this as well so it can be tested?  I feel sure if it breaks anything you can reverse it \n. The demo is limited, so if you decide you like it you can buy it at gog.com.  I don't think it matters that theme hospital is a windows/dos application as it is just the data you need for corsixth and it will run on mac\n. @TheCycoONE odd thing is it is in the builds that are in my folder from testing the grim reaper.  This is perhaps why I never noticed it before.\n. CTH and TH are identical when it comes to selecting the number of objects you want to buy!\nDid you try clicking and holding shift or ctrl? \n. I did check before commenting.  You might be thinking of the drug casebook.\nYou don't need to use the keyboard and mouse to click multiple times, only if you want to use shift or ctrl.\n. That could be why I can't see it happen then as I have been using dos box more recently and mine was the updated version for windows95\n. Looks like @TheCycoONE and me re-opened this at the same time. \nI didn't think you were being snappy, I just thought you were reporting a bug and I could not see that there was one.  Once you had said you had a different version etc I could see no harm in the change being made to match the earlier version.\n. @mpmc as you are able to still run the original dos version on an old pc would you mind taking a look at issue #295?\nIf this is something you can see happen in that version, perhaps you could video it for us?\n. Too tiny for me to see :)\nOpenGL is known to have lots of corruption, try DX if you are using windows or sdl if you are not bothered about zoom.\nHoping that the SDL2 will solve this one.\n. This is a duplicate of issue #221\n. Is that a custom message?  I think the problem is something to do with the $, can't think where I have seen this.  Use the existing string as no value is mentioned, look for  charges_too_low or charges_too_high in the original stings language file\n. I think you should try and keep amount in, but without $.\nThen near where you are going to use the string format it as local cost = (\"$\" and amount) - you may need to play around with this as I can't remember from the top of my head how to code this bit\nso you end up with adviser:say(_A.warnings.patient_not_paying:format(casebook.disease.name, cost))\nLook here as this may help you\n. What about using the actual strings from TH which were \"Your charges are high. This will make big profits in the short-term, but ultimately you'll start to drive people away.\" and \"You're charging too little. This will bring people to your hospital, but you won't make a lot of profit from each one.\"\n. With those strings, they already exist in the original files, so you don't need to add them into the English file.\nTo see what the original strings are you can get instructions here https://github.com/CorsixTH/CorsixTH/wiki/Localization.\nWe tend not to add to the English file where they exist already, only when they don't or need changes.  This will apply to French and other languages that were in the original.\nWhen the patient walks out, did you add the mood icon?  \n\n. In TH if they refuse to pay they leave as well, only then does that mood show so you know who it is.  You could use the other sad mood to indicate they are thinking of leaving if they think it is expensive.\nAlso it could have been any treatment, including diagnosis.  Are you able to run the original - dos box works okay - it will then give you an idea of what went off?\n. @alanwoolley Okay to merge then?\n. I can't reproduce with 0.30 or trunk, can anyone else?\n. @J-Shep  Is this with debug patients again or standard patients?  I have been trying to re-produce this for over an hour and I can't.\nIf it is with just debug patients there is already an issue for that, and to be honest I don't see that as a problem.\n. I added self:die() to the on click statement and did not get a problem, so perhaps like you say it just happens when in the debug script.\n. If you used the installer for 0.30 and are a windows user you should find in the start menu a CorsixTH folder.  From there look for the shortcut to CorsixTH AppData Folder, this is where your saves are by default and also the game log mentioned above.\n. copy the gamelog txt file here as this will assist. (it is next to the saves folder)\nBy the way if you exit the game, reload it and open the autosave folder you should be able to continue your game, you may not  get the error next time.\n. I think this is a duplicate of issue #127 \n. Do you have any windows errors?   You can check this in event viewer, search for events from start menu if you are not sure where to look.\nAlso it says you have a stack trace, can you copy the gamelog.txt file to here?  From the start menu look for corsixth and then CorsixTH AppData Folder\n. Just in case this is specific to the map, which one are you playing?  If it is your own custom map, perhaps you could share it and the level file?\n. Also, if I remember correctly, in TH, rat holes don't appear behind radiators (or drinking machines) and placing such an object in front of a hole was even a way to get rid of it. Can somebody confirm?\nYou are right on the second part, not the first though.  I remember picking up a radiator or drinks machine to delete rat holes to find that there was one behind the radiator or drinks machine as well.\n. this has been mentioned before and is TH behaviour, although it does not seem logical every time.   It is not that the illness has not been discovered, it is you cannot cure or diagnose it.  Although you can see what it is the patient has (as it is a visual illness), the Dr is not 100% sure, you need more diagnosis rooms to be 100% sure.\nEven if you had a research room you cannot send people to research to speed up the build of diagnostics only for cures\n. Did you read what I said?\nAlthough you can see what it is the patient has (as it is a visual illness), the Dr is not 100% sure\nyou means you as the player, the Dr is not completely sure\nTo diagnose slack tongue you really need an x-ray (I think), so the Dr thinks it might be slack tongue, but to be 100% sure he could do with sending the patient to the x-ray to confirm his suspicions.  You don't have one so you are being asked whether you want to take a chance (and risk death).  Only in this case you can't even do that as you don't have the clinic to cure that anyway.  \nAs I said it does not always seem logical, but consider this, depending on the rooms available it might have been that you had discovered and built the clinic (so you could then have taken a chance).  These things are determined by the level file and how you carve up the research.\n. @TheCycoONE   I wasn't thinking of that issue.\nI would say the problem is the faxes are showing in the wrong order.  But even changing the order would not always make sense. The Dr only thinks he has discovered a new disease, he needs more diagnosis to be sure.  So the player is asked to make a decision, in this instance there is not actually a room to perform the cure either.\nAs I said earlier, this has come up before, it is not perfect, but it is what would happen in TH.  I have no intention to debate it now as it is already recorded here as something that needs improvement.\n. @TheCycoONE  It is the same point Albert was making.  In both cases \"Get Patient to wait, while you build more diagnosis rooms.\"   But there are no more rooms yet!\nGoing for the second option sends another fax if you don't have a cure room either.  not mentioned in the first issue, but was spoken about.\nAgreed though this has nothing to do with 0.40, it was in the original and we know it could do with improving\n. Should add if you put the sliders up in the policy screen you can reduce and stop these faxes.  It all depends on how much you want to micro manage the game.\nI would imagine the point of the fax is if you knew you were close to completing research on diagnosis rooms, you may want the patient to hang around for it.  As for guess at cure, you may want to take the chance, but as the room is not available it perhaps should be greyed out.  That said, what if you knew you were close on getting the next clinic as well, you may well want the patient to wait in case it is the one you need. \n. May be connected, music plays whilst paused too.  I think it has something to do with not being able to pause sound - perhaps @Lego3 knows more?\n. Perhaps you have turned music off?\nIt is a long standing issue and I think it relates to sdl mixer\nI don't know what audio changes you refer to as I have just checked 0.40 and this bug persists\n. @J-Shep are you saying you had fixed this then?\nSee here I think this were it was last mentioned\n. @TheCycoONE   I think that TODO is what I am thinking of.\nI have never noticed any improvement, for a long time (seems like always) you can pause the game and music and announcements continue on.   \n. I think both these are known issues here and here\n. Pick up and put back seems to work.  As for the glitch with animation, there are many of those.  Neither stop the game or cause a crash\n. @J-Shep For pure lua changes you don't need to compile, only when there are c+ code changes \n. Doctors can sometimes get stuck in the GP office, will this fix that as well?\n. No, it is just something you start to notice as queues build up and you see there is a Dr in the GP room walking around the room whilst the patient sits there.\nI have noticed that they are ready for a break, but that could well be a symptom of walking around not the cause.\n. I think it is that they don't know the patient is in the room and are waiting for one to enter.  Normally if there is a patient they either sit at the desk or use the filing cabinet.  Instead they wander the room.  One time I placed another Dr in the room expecting the first one to leave, but they both just wandered the room as if they were waiting for a patient.\nThere is perhaps some problem with the door code, waiting for the patient who is already in the room so they can leave/deal with the patient.\n. I'll close this as you seem to have it in hand\n. http://code.google.com/p/corsix-th/source/detail?r=1418  is where it was added that you could turn them off and here for debug http://code.google.com/p/corsix-th/source/detail?r=1427\n. I don't recall there being one for adding it to debug, that came from Edvin a short while after the option to turn them off was added.\n. I've tried to find the original issue, with no luck so far.  From memory I think the consensus was that these information screens could get annoying, especially whist testing as we knew what each room was for and didn't need reminding.  It was similar with the advisor, you don't always want him popping up telling you what you already know.\n. @TheCycoONE  Just to let you know this is not a regression, it would happen in 0.30 sometimes and before.\nThere is already an issue open for this, perhaps in google.\n. I'll take a look tonight if no one has beaten me to it\n. The problem with adding object.corridor_object = 7 to bin.lua then makes the bin a corridor object. \nPersonally I think having bins in corridors is of more use than in a room (it is where you would expect to seem them, near drinks machines), but they were not corridor objects in TH.  If we were to have them in corridors it might be an idea for them to have some effect on littering too.\nWhat do others think about bins in corridors?\n. Instead of using object.corridor_object you could use object.thob\n-- Check2a: some corridor objects are allowed in any room.....\nif object.thob and object.thob == 50 or  \n    object.thob > 42 and object.thob < 46 then  \n     is_object_allowed = true  \n    end\nThere might be a better way to achieve the same thing\n. Explore the wiki, it will help you understand a lot of what is happening in the code.\nAs for bins, not sure they did anything at all in TH, but that is what I was thinking when I said I thought they would make more sense if they were in the corridor. Litter at the moment is pretty random, so something that increased the likelihood on difficulty and on proximity to a bin when you use the drinks machine would I think be an improvement.  I also think that some patients should litter anyway, even if they have not used the machine, because that is how some people are.\n. I think that object.corridor_object is to determine the objects position on the menu where you buy them\n. @TheCycoONE\nWhat method was being used before 0.40?  Until 0.40 this was working fine, you could pick up such objects from a room, move them, you could even take radiators from the corridor and put them into a room.\n. @J-Shep  As you can't test at the moment.  If you have any suggestions for a fix that you want tested you can either email them to me or post here and I will test for you.\n. The goal is to have the game working across platforms so that we can then add to and improve it.   As for it being a clone to the original, well not always as there have already been some changes / improvements, the main objective is to have as much of the game working first though.\nI think @TheCycoONE was trying to stop us going off topic, as you had raised an issue and that needs to be fixed urgently.  Then you dropped bins into it, I never picked up on that for a couple of reason and we were then going off topic.\nGeneral rule of thumb is issues raised here each to its own where possible.  Suggestion in IRC and or the forum to test the water.  Some changes are made across the board and some have been done with switches so people can choose to have them or not.\nOn bins, well you have seen my thoughts above, but I also have a memory from when I first saw the demo all those years ago that bins were a corridor item, but clearly not as they aren't in the demo; so either a false memory or were there two demos?\nIf you want to pursue litter and bin placement, open a topic in the forum and then perhaps others may jump in with their thoughts.\n. Works for me\nI don't see anyway to merge this so I'll leave it to the experts\nThanks\n. Edit:  After reading the reported issue again,  I am able to reproduce this, the walls don't persist when loading a save with a part built room?  \nI can only get the persistence error message sometimes, only if I try to load an incompatible save, otherwise there is no error message.\nEdit 2:  This is not a regression, the same thing happens in 0.30.  The chances of it happening are small I reckon as would you save a game whilst building a room?  Chances are you would never come across this unless you loaded an auto save file that was made whilst building a room.  It is not game breaking either, so I don't think it is a high priority that needs to be fixed before 0.40 the release.  What do others think?\n.\n. see issue #124 \nI think this is the same thing\n. @J-Shep  No need to be sorry, it often happens, fixing one thing can break another.  This error does not seem to happen every time, so I hope you can get an idea what is wrong from the error message\n. I don't know.\nI have loaded the auto save several times and cannot reproduce the error\n. Just looked at the date on the game log and that is from a week ago.  So although the game did crash tonight it did not update the game log with the error message!\n. It just crashed again when I paused the game to update here a few minutes ago.\nI think this might be a windows error actually, I can see in the event viewer for both just now and about an hour ago when the first crash happened\n. I have copied the events here, not sure if I did this correctly; let me know if not\nhttps://www.dropbox.com/s/p8jdly4mdswd3os/DX_Error_1033.MTA?dl=0\nhttps://www.dropbox.com/s/zqy73j3d9c691a6/DX_Error.evtx?dl=0\nThe second crash was slightly different as the game stopped responding whilst it was paused.\nFor the first error the game stopped responding whilst building the GP Office, but that may have been co-incidence.\n. I wonder if both he dead patients are going to hell?\n. Why did he quit /you fire him?\n. 0.21 is very old.\nGo here and download either 0.30 or you can try 0.40 beta\n. The report a bug link takes you there as well.\n. So that one has been fixed then\n. I have just had what appears to be the same error in slightly different circumstances\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:659: Can only finish current action\nstack traceback:\n    [C]: in function 'assert'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:659: in function 'finishAction'\n    C:\\Program Files\\CorsixTH\\Lua\\rooms\\general_diag.lua:72: in function 'after_use'\n    ...Files\\CorsixTH\\Lua\\humanoid_actions\\multi_use_object.lua:264: in function 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1103: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\nI was also editing a room, but the error occurred in a different room to the one being edited and I did not have the staff dialog open at the time.\n0.40 beta 2 with last update win 7 using DX\n. beta 2 and the fix in 356 were copied into it\n. I am not sure it is a regression.\nWhat I'll do tomorrow using the auto save is try and reproduce it.\nI have a feeling though that this error has come up before in previous versions\n. Nice that you managed to work this out :+1: \n. I have tried and could not do so either.\nI don't think it has anything to do with editing the room, I was editing rooms at the time, but not the one where the error happened.\n. This is not a regression, see #127 \n. What error did you get?  I have run your game and didn't get any error.\nWhich rooms exploded?  For me it was xray and cardio.\n. @ghidosoft I had the same thought, perhaps because I have the update from @J-Shep I don't get the error and @crowbarsolutions is using the straight beta 2?\nAre you using @J-Shep 's fix?\n. Confirmed.\nI cannot though reproduce this with an older version of the game, so in effect this is a regression, but not game breaking as the game does not crash because of it.\n. @TheCycoONE  Just sent you one via your Hotmail\n. As stated in #423 a select or open button here would also be useful.\nI think the ability to rename a save would also be useful\n. It was then it was changed and I have now changed it back.  There are a lot of additions that might be useful, if you look at the title name changes above you will what some of them are.\nIf you want to tackle this you are welcome to, a couple of weeks are not going to make a difference as it could be some time before the next release (it is too late for 0.40 though)\n. I can't load it with older versions either\n. As it is an autosave, can you load the ones before or after it?\n. All I can think of is that something was happening at the point that first save was created that was not persistable, but what!\n. 5 or 6 tiles would be better @phillipp \n. All arrivals, VIP gets pushed to the front and blocks reception until he gets there.  Others join the queue in the order they arrive in the hospital, no matter how far from the desk they are\n. Are you trying to use a font file?\nIf you are using one of the languages that was in Theme Hospital you don't need to.\n\n. Look at your config.txt file, that font looks all wrong to me so there might be something entered.  It should look like this \nunicode_font = nil -- [[X:\\ThemeHospital\\font.ttc]] \n. It will be next to where your saves are kept. well it is in Windows, not sure with OSX.\nWhat you are showing is where theme hospital is installed.\nThis might assist you\nhttps://github.com/CorsixTH/CorsixTH/wiki/Configuration-File\n. How did theme hospital get onto your pc?  Did you install it or copy files over from the CD?\nIf you installed it that might be where the problem is, all you need to do is copy the file hosp from the cd onto your pc and then link that to corsixth when you install that.\n. @falmasmoum  are we to take it from your lack of reply you are using a pirated copy?\n. no reply in over 3 weeks so assuming it was a pirate copy !\n. You don't need to install theme hospital, just copy the hosp or hospital directory to somewhere on your hard drive and let corsixth know where it is.\n. @bennuttall \n@daiscog \nI have updated the wiki, please confirm what I have added makes sense as I have never used Linux or wine\n. @phillipp Only seen this tonight, I have copied your changes, I just need to either find a save that has this problem or just play for a few hours to see if the issue remains.\nThe save I added to the original issue throws errors on load related I think to issue #380 \n. Managed to get my save working and tested this and it fixed several patients that had dropped off the queue. :+1: \nThe one thing I did notice was the queue size in the dynamic info was wrong, but that corrected itself once the next patient entered the room.\nI won't merge this though in case @TheCycoONE  wants it testing some more first.\n. Added this to the second beta to test and seems ok as the casing is now sorted.\nThe list of languages is still not matching those in the config, perhaps that is for another pull?\nI typed into the config Welsh which does not exist and apart from a load of something going off in the console the game did not crash and reverted to English - so all good there.\nSome languages though are not displayed correctly in the list (it has always been like this for me).  This though because I am missing the relevant font.\n\n@TheCycoONE are you happy for this to be merged with it being a minor fix?\n. @TheCycoONE  I just got this error when testing the pulls in #377 using my save from #127 \nHappens as soon as you load this save.  \nSavegame version changed from 81 (Trunk) to 88 (Trunk). The save was created using 81 (Trunk)\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\rooms\\operating_theatre.lua:191: use of undeclared variable 'surgeon'\nstack traceback:\n    [C]: in function 'error'\n    C:\\Program Files\\CorsixTH\\Lua\\strict.lua:43: in function '__index'\n    C:\\Program Files\\CorsixTH\\Lua\\rooms\\operating_theatre.lua:191: in function 'loop_callback'\n    ...Files\\CorsixTH\\Lua\\humanoid_actions\\multi_use_object.lua:205: in function 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1103: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function \n. @TheCycoONE  Tested your fix on my old save and whilst it did not crash on load it did after a minute\nSavegame version changed from 81 (Trunk) to 88 (Trunk). The save was created using 81 (Trunk)\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\rooms\\operating_theatre.lua:225: use of undeclared variable 'first_action'\nstack traceback:\n    [C]: in function 'error'\n    C:\\Program Files\\CorsixTH\\Lua\\strict.lua:43: in function '__index'\n    C:\\Program Files\\CorsixTH\\Lua\\rooms\\operating_theatre.lua:225: in function 'after_use'\n    ...ogram Files\\CorsixTH\\Lua\\humanoid_actions\\use_object.lua:318: in function 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1103: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function \nI managed to get around this by loading the save in an old copy of the game, cancelling all operations and creating a new save and then loading it again in 0.30.  With my save operations were already in progress when the save was created.\n. Did you include dead rats as litter as I suspect it won't be long before we start seeing them running around.  They are after all also litter as is the other mess some patients do on the floor when they can't find a loo.\n. @Glimmer-Man  The odd thing is there really shouldn't be a situation where there is more than one litter on a tile at a time.  But I have to say that I have seen it happen with vomit, for some reason it is sometimes ignoring the check that the tile is free of other objects.   If that was to be resolved then this would resolve the problem here and I think there is another issue open about multiple vomit not being cleaned in one go it would fix too.\n. Which language are you using?\nHave you selected to use your own font, if so which one?\n. Don't know how I missed that.\nIf the language was not in Theme Hospital it will be using a user specified font I believe, so I think the user needs to select a better font set.  It might be the font selected does not contain black characters which is why the writing is white.\n. There was an issue a long time ago regarding fonts and faxes that was fixed, so perhaps it is related to that.  That mentioned something about colouring and how the game was doing it I think.  I'll see if I can find it as that solution might work here also.\n. This is the one\nhttp://code.google.com/p/corsix-th/source/detail?r=1980\nAlso some help is the actual issue\n\nNow when you look at what the TH font looks like on these wage requests it is not that clever as the font is mainly white and it gets worse if you are on a large monitor as it gets smaller.\n. Black would be a better choice here, agreed\n. @TheCycoONE  As a side issue I see that the config.txt does not include all the languages when compared to the language directory.\n. @TheCycoONE \nDo we need another issue about the config.txt, not sure how that affects the game, only that I could not see Czech in the list?\n. This is mentioned in issue #155 and also here\n. Be warned, he is very good as I found out to my cost\n. :+1: \n. New text is added to the English file and then translated into other languages by the translators.  Look at line 244 in C:\\CorsixTH 0.51\\Lua\\languages\\English.lua for an example of Load Game in the same menu\nThen in C:\\CorsixTH 0.51\\Lua\\dialogs\\resizables\\main_menu.lua to see how the buttons are added.\nI think the game will use whatever font is specified here from either the TH font file or a user font if they have specified one i.e. where none English characters are used\n. It is sort of possible already by creating your series of maps and changing the extension of both parts i.e. level.l1 level1.map etc\nNot perfect I know as you have to put them in the TH levels folder for the game to see them.\nI don't know what you have in mind, but what I thought would be good is if you could put a selection of maps and level files into a named directory with our levels folder which includes a txt file that lists the contents and the order they should be played in.\nI look forward to you implementing this as I have a couple of campaigns and there is one already in the forum as you know.\n:+1: \n. I think with vomit it can pile up so there may be more than one vomit there that will take two or more cleans.\nAnyway someone is working on all litter being cleaned when placing new rooms so it soon won't be a problem\n. @Alberth289346  In TH dropping the handyman on the  litter would make him clean that first. Could our code be altered so that when we drop an handyman on a task like litter cleaning it gets added to the list with the priority to do it next?\n. Could it be that  the handyman assigned this task was sacked, quit or killed in an exploding room?  Are tasked reassigned?\n. It doesn't look any different!\n. That works with the old save issue :+1: \nNow for the bad news, if you attempt to pick up one of the surgeons during an operation you get the following error when the operation is completed\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\rooms\\operating_theatre.lua:194: attempt to call method 'dealtWithPatient' (a nil value)\nstack traceback:\n    C:\\Program Files\\CorsixTH\\Lua\\rooms\\operating_theatre.lua: in function 'after_use'\n    ...Files\\CorsixTH\\Lua\\humanoid_actions\\multi_use_object.lua:264: in function 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1103: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function \nOne of the surgeons can be moved, but not the second one.\nAt first it seems you cannot move him and see \"pickup must happen\" in the console, as soon as the operation ends you get the error.\n. @TheCycoONE  Using my save scroll down to where the theatres are.  The one in the top corner there is no operation, but one is about to start.  Pick up the nearest surgeon and place him outside when the operation is about to start.  He is called back and gets changed. As he washes his hands pick up the other one, you can't and in the console it says pickup must happen for each time you attempt it. As soon as the operation ends and the patient gets up to pay there is the error.\n\n. You're right, how did I miss that?   With local room = self I am not getting the error, so it should be safe to merge then?\n. @J-Shep  Some room contents cannot be rotated into every direction\n. What debug script was you loading?\n. @honux If the game crashed and there was nothing in the console or gamelog.txt then it might be a general computer crash.  That sometimes happens and if it is windows you can see this in the event log.\nI have ran your save and did not get any problems at all.\nYour explanation for the current output above does not make sense though, what else did you do?\nThe more detail you can provide the greater chance there is that someone can reproduce it.\n. When I ran your save I had no problems, but there was an earthquake.  Look here it tells you where the config is and the gamelog is in the same location.  I suspect though you know where the config is as you say you made changes.\nThis level is the first one to have earthquakes and I think that this caused someone problems in the past as well.\nWhere did you get your game files from?  If they were from a wares site or abandon ware that could well be the issue here.\n. If your gamelog is empty this would suggest that it is not a game error.  Are you a windows user?\nIf you are take a look in event viewer to see if there was something there at the same time as when the game stopped (look under windows logs then application).\n. @TheCycoONE  might be able to throw some light on that output with some luck.\nAs you are using windows try the DX exe to see if you get the same problem and then the sdl.exe\n. Try loading your save and slowing the speed.  When I ran it, I slowed it down and got no error, but just now I tried again and left it running at full speed and it crashed.\nPerhaps it is connected to it running at full speed?\n. Try closing the patient dialog, there is a known error where the game can crash if this is open when the patient leaves the map and de-spawns.\nIt worked for me, even on full speed\n. Good that we solved this for you in the end, so this is a duplicate of issue #124 then\n. Yes, we have lots of those sorts of glitches.  The majority are reported on our googlecode issues\n. It is a duplicate, it was first reported here in March 2011!\n. Since when?\nIt was my understanding that new issues go on git.  I have a feeling that last year @mrtnptrs  offered to transfer them all to here and was told to leave them there!\nSo we just ignoring google issues then? \n. Duplicate of #345\n. Perhaps the Dr's were about to go to the room when it was moved and this left them confused or with a task they can't complete?  The similar issue with physiatrists was down to the calls dispatcher in the end wasn't it.  Perhaps it is the same here?\nNice one for spotting a possible cause :+1:\n. New game or old save?\n. The fix for #127 was for seated patients, are there benches free where he could sit?\nIf you hover over him what is in the dynamic info menu?\n. Yes, it is the same error, he is not on a queue menu.  I also got a empty action error whilst searching for him, but from someone else.\nIf it's not too late have you a save before he gets stuck? I know it's a long shot as you don't always notice them early enough.  It can sometimes help to see the actions prior to the problem.\n. So getting a drink just before entering the room causes them to fall off the queue still?\n. Is your fix in the RC?\n. Confirmed, at speed 5 he goes in the GP after the drink machine!\n. Did that and for me he stands next to the drinks machine.\nStrangely though the installer says it was 0.40rc even though I downloaded the beta3!\nEdit: To be on the safe side I  have downloaded beta3 again and did not see 0.40rc this time, I must have clicked on the wrong one first time.\nSame result though, he stands at the drinks machine\n. Might be to do with resolution, game normally defaults to 800x600 if your monitor cannot run dimensions selected.  What monitor dimensions (resolution) do you have /did you set?\n. Is that what your monitor is capable of, what you selected or both?\nHave you selected full screen or windowed?\n. I am not able to reproduce this by selecting the demo data, not even on a new install.\n. Tried to reproduce this on the works pc which also has 1920x1080 resolution and did not have a problem.\nI don't think your crash was anything to do with demo data or 0.40rc either.\nAt first I thought it might be related to this, but now I am not sure.\nThe error message suggests there was a problem initialising the display (perhaps), but as it is working fine since it might be best to close this for now.\nOpen another issue if you start have a problem again.\n. It could be down to that as that is something that is not supported yet see this\n. Was it this one?  I don't recall there being any problems like this with sdl before though.\n. Done, thought I did so earlier.\n. I'll merge this with #369  and change that title as they are about the same menu\n. Consultants from the start is level 5, not level 4\n. I don't understand, as you can already edge scroll in window mode!\n. What if you want to leave the game window, to open an email for example, will you still be able to do that?\n. Was closed in error\n. There is sometimes a crash if you scroll to the maps edge, so I would want to be able to turn this off or wait until the crash issue is fixed first.\nThere was a pull request for pause on lose focus in issue #213 , if you want to use some/all of that.\nCan I also mention that there is an issue now that if you are scrolling when the game is saved (autosave) the game continues to scroll when you load it - and that is annoying.\n. I think you can already do that with the middle mouse button @TheCycoONE \nPress it and you can sort of pivot and change position/throw your view over the screen (sorry, not easy to describe)\n. I have copied your code changes to test this out and I would definitely want to be able to either turn this off in the config or something or at least have the scrolling stop if I click outside the window.\nI often run the game in a small window for testing and do other things at the same time on my pc.  It would be very frustrating for me to have the game scroll to the edge of the map all the time. \n. There have been some changes to screen use since 0.30 to stop patients leaving a diag room undressed.  Perhaps this is an unintended effect, although I have not seen it happen yet,\n. The expected is working fine with my save, perhaps yours is bugged?\nStart a new game or restart this one and see if it still happens.\nWhen I tried your save the other day I noticed the staff room is log jammed.  I tried to edit the room and no one would leave.\n. Just to rule out something daft what is the staff policy regarding rooms and leaving them?\n. I was seeing if I could reproduce this and noticed this patient still waiting for the psychiatric room even though I have moved it.  (it was behind the drinks machine) If you click on him, he is a queue, but for what room? \n\nhttps://www.dropbox.com/s/eed78mq52tn6alo/phyc.sav?dl=0\nI am putting this here as I think it could be related.\n. :+1: Looking good\n. Ok for me\n. I see nothing at all in the console, which is a little odd, there is usually something there - even if its only about not checking for updates.\nI did notice that changing to full screen put the menu/button bar a third of the way up the screen when it normally stays at the bottom.\n. \n. What if you were to minimise the fax and they say build the research department?\nWould the fax update to show the option of send to research?\n. I wanted to be sure as it did not read that way to me in the previous comment.  If re-opening does a recalculate that is indeed what is needed \n. The issue was that odd staff members would stop in the room and not go for a rest, nothing to do with the policy.  With handymen I think they would just wander around getting more and more tired, but not go for a break.\nI have no idea whether this still happen or not, but it was never all staff, just odd ones here and there.\n. Not sure why you think that @Lego3 as you are still able to type in your own values by clicking on custom!\nAnyway I can't replicate the error reported, although I did find entering the dimensions awkward to do.\n. @Alberth289346  In that it is the VIP and the fax causing the issue!\nI think the level multiplier is the issue here for always getting the same award, which I think is also the maximum award.  I have not checked the changes in #837 in detail to see if you have done that there\n. Not tried SDL2 yet, otherwise yes at times it does crash \n. Is Visual Studio debugger  something I can download for nothing and would it need to be running in the background to get this stack trace?\nMight all be pointless, but all the same it could be useful if it does crash again\n. Ah, in that case I am not sure as I have never had any luck with compiling.\nI am thinking of giving @J-Shep 's eclipse method ago at some point (when I have several hours to spare that is), but does that use Visual Studio IDE?\n. @TheCycoONE  my mistake, it was his Setting Up Windows Dev Software page I was thinking about.\nI've now compiled a copy, so how do I go about running it from visual studio?  pressing f5 just throws an error.\nMy exec is in C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\Debug, but my corsix files will be in C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\CorsixTH.\nIf I move my exec to where the other files are, how does visual studio know what to open?\nSorry if the questions sound stupid, but I am new to this sort of thing \n. \n. I suspect that even though it compiled there may be something wrong as the file size is 827kb and the latest sdl2 is 1950kb - so a big difference.\n. Neither worked for me, do I need to start again with cmake as it has been told where to build?\nsee the wiki page mentioned above to see the build path\n. No error as such, it just closes straight away if I try and start the game in the normal way.\nIf I try to run from within VS I get this error, which makes sense as the exec is not built there,\n.\nThere seems to me that a lot of folders are being created, not sure whether this is cmake or VS\n\nIs that normal?\n. This is the error I see now\n'CorsixTH.exe' (Win32): Loaded 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\Debug\\CorsixTH.exe'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\ntdll.dll'. Cannot find or open the PDB file.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\kernel32.dll'. Cannot find or open the PDB file.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\KernelBase.dll'. Cannot find or open the PDB file.\nThe program '[2620] CorsixTH.exe' has exited with code -1073741515 (0xc0000135) 'A dependent dll was not found'.\n. Those 3 dll's are in that folder\n. Downloaded the PDB and the message is now\n'CorsixTH.exe' (Win32): Loaded 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\Debug\\CorsixTH.exe'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\ntdll.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\kernel32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\KernelBase.dll'. Symbols loaded.\nThe program '[3840] CorsixTH.exe' has exited with code -1073741515 (0xc0000135) 'A dependent dll was not found'.\n. I copied all the dll's into the folder where the exec is from where I test.  I would say there are more than is needed as I have not compiled for movies, just the basic as in the wiki page\n. I've not tried since then\nedit:  I should have read further back, not compiled in a while, but as for the original error I have not really had the time to run the game in the last year either so I wouldn't really know.\n. You can handle it though, it is treatable just not discovered.  There are plenty of diseases in the game which are treatable before they are discovered, although this could be poorly thought out sam files.\nThe error only occurs if you try an view the disease in the casebook as described in the connected issue.  Otherwise they are treated and leave like anyone else.. I have researched the treatment.  Emergencies are already diagnosed, they require treatment only.\nJust because TH would skip them when you have not discovered the disease could be a bug.\nIf I could not treat the emergency it will still be offered to me, it would be a mistake to accept it though.\nI can treat it, so I accept it.. Just started a copy of 0.30 and was told it was the latest version!\n\nI was expecting it to inform me there was a newer version available and take me to a download page or something.\n. Ah that explains it.\n. If you say so\n. I don't remember the issue, but is he referring to this?\n\n. That should be free toilets that limits who can enter the room, we changed it from the number of loos a couple of years ago. \nPeeing outside is a possibility i.e. on the way and don't quite make it...\nAgree with what you say about amount of patients overall, the only times I  have seen this problem is with an overcrowded hospital, otherwise I don't see this problem.  You also get lots of other errors though when the hospital is overcrowded, so perhaps there is a connection there.\n. Perhaps sdl2 is more stable!\nHave you had large numbers of patients, as that seemed to be related?\n. The original link above was meant to work, but @Lego3  ticked something on googlecode that now means you cannot access it.  I noticed the same applies to other links we have in the suggestions wiki etc.\nI don't think this was intended, so I wonder if it is worth removing that for the time being Edvin?\n. Is it?!\nI thought the issue was that setting severity to 0 did not work as the game then  creates random earthquakes.  Which is why code was later added to disable them in the early levels of the campaign.  If setting severity to 0 did work then there would not have been any need for the additional code in the campaign, as they have severity at 0 as a default in the level files already.\n. I think that one possible solution would be to have a config option that turns off random earthquakes.  That way the extra code for the campaign could be removed and setting severity to 0 would then work if the player had also turned off random earthquakes.  This way, if a player wanted to add earthquakes into the early campaign levels they could do.\nThe code for random earthquakes it written to add them once the planned ones on the level file have finished, which is why I think at the moment they kick in when severity is 0.\n. I think since 0.60 this has been improved upon.  I have been testing the trunk version for  a few weeks and we now get a tremor followed by the main quake - damage has been less severe as well. I have a save with that name so likely to be from this issue @Alberth289346 \nhttps://www.dropbox.com/s/9o9qqgrcjasj6q0/12-4%20crash.sav?dl=0. I'll close it then. @admdly  With not having anyone on the team with OSX, it was not known until now whether this the other one were fixed - thanks\n. Brilliant\n. Just a thought, but the lava hole as various sound effects, perhaps some of these are missing in some versions.\nWhat TH language settings are you using?  (i.e. for sound effects and announcements)\n. If I use SOUND-5.DAT this save crashes for me too.  I can see that it has the same lava sounds though when using DKSound.exe.  Perhaps @J-Shep can make sense of it?\nEdit: to be clear 0-4 did not crash for me. 1 sounds like French.  The lava sounds do look correct in all the files, but only 5 crashes for me.\n. There were no sounds missing in any of my sound-*.dat's but with 5 lava004.wav (extracted) did crash sometimes when played with the media player.\n@J-Shep  I think by fall back @Lego3 means that it should not crash at all, perhaps skips that sound on error?\n. I  know what @Alberth289346 is saying.  In the past I have had an error, but when I tried to reproduce it things did not happen in the same way.  I replayed the same save 50 times and only reproduced the error once.  I put it down to the randomness in the game and there is a lot of it.\nSo unless you are able to record the decisions made in a game you will never get a proper replay\n. At the moment they use the same timer\n. @Lego3 \nI don't think they did in the original for the same reason.\nI have a feeling I checked this out last year for @sadger and there might be some mention of this on his page.\n. Can you share your save?\nPlease describe your actions i.e. where you picked him up from and where you placed him if there is more than one operating room.\n. Did any rooms explode?  The error mentions out of bounds which makes me think the surgeon was perhaps being placed somewhere he shouldn't be\n. I wonder if the operating theatre was in need of repair after the earthquake and was perhaps locked.\nShould be easy enough to replicate to see if such a thing would throw an error when you place some staff in such a room.\n. I tried that and ended up with three surgeons in the room!  \n\nIf a machine is in urgent need of repair the staff don't usually leave, but the room can lock so no one enters until it is repaired or so I thought.  I had four uses left and another patient entered, so that blows that theory....\n. Because of your comments\n. Yes we have played all the levels!\nI can't download your save though\n. Copy and paste the first link does not help either, but the second link is fine.\nYour save works for me!\nI create a save once patient is cured and I can load it afterwards.\nPerhaps you have a corrupted file somewhere.\nTry uninstall and reinstall to see if that helps\n. Windows 7\nI have loaded lots of saves from other people over the last 4-5 years through checking issues (some of them must have been created on systems other than window), and I have not had problems like this in the past.  So unless something has changed recently I would be surprised if the save had something in it that was OS specific.\nPerhaps someone (@TheCycoONE or @Lego3 maybe) with access to different operating systems could check out whether this has now become a problem?\n. I have seen this as well.\nThe x-ray room can at times be impossible to place both objects at some sizes, depending on where the door is.  I can think of one layout where it won't allow you to place the shield against the wall, but will let you one tile away from the wall, which I think is odd.\n. There is or was a rule to prevent blocked off areas in corsixTH. (discussed in another issue I think). Yes you could stick things in a blocked corner as stated above.  Plants though would die because the handyman could only get near a plant if the room was not used, if at all.  This though could have been a bug in TH.  I never used to place many plants in rooms anyway, but I can remember putting the fire extinguisher in a corner like that because once placed there was no interaction.. @sadger Can you load your save in an earlier version, save it when you closed the open menu (was it staff wage request) and then load in current version?\n. I would say that is going to be rare, so does it need a fix?\n. I can't think of any games that remember what menus you had open when the save was created.\nWould a solution be for the future for us to stop our saves from remembering?\nThat would also solve the issue where you cannot create a save if the jukebox menu is open and if we had done this earlier would have stopped this issue.\n. That would work as well I guess\n. Is this why I am having issues compiling today?  If the process is now different then perhaps the \"how to compile\" instructions should be updated.  On a side note there is a r missing from occurred in the message as well.\nNotice: LuaJIT not being used.\nConsider replacing Lua with LuaJIT to improve performance.\nAn error has occured in CorsixTH:\n...uild\\CorsixTH\\Debug......\\CorsixTH\\Lua\\strict.lua:66: module 'lfs' not fou\nnd:\n        no field package.preload['lfs']\n        no file '.\\lfs.lua'\n        no file 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\De\nbug\\lua\\lfs.lua'\n        no file 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\De\nbug\\lua\\lfs\\init.lua'\n        no file 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\De\nbug\\lfs.lua'\n        no file 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\De\nbug\\lfs\\init.lua'\n        no file 'C:\\Program Files (x86)\\Lua\\5.1\\lua\\lfs.luac'\n        no file '.\\lfs.dll'\n        no file '.\\lfs51.dll'\n        no file 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\De\nbug\\lfs.dll'\n        no file 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\De\nbug\\lfs51.dll'\n        no file 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\De\nbug\\clibs\\lfs.dll'\n        no file 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\De\nbug\\clibs\\lfs51.dll'\n        no file 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\De\nbug\\loadall.dll'\n        no file 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\De\nbug\\clibs\\loadall.dll'\nstack traceback:\n        [C]: in function 'fn'\n        ...uild\\CorsixTH\\Debug......\\CorsixTH\\Lua\\strict.lua:66: in function\n'require'\n        ...H\\build\\CorsixTH\\Debug......\\CorsixTH\\Lua\\app.lua:23: in main chun\nk\n        [C]: in function 'dofile'\n        ...\\build\\CorsixTH\\Debug......\\CorsixTH\\CorsixTH.lua:93: in function\n'dofile'\n        ...\\build\\CorsixTH\\Debug......\\CorsixTH\\CorsixTH.lua:107: in main chu\nnk\n        [C]: ?\n. In the updated wiki the path is http://luarocks.org/en/Download., but when I click on it, I am taken to https://rocks.moonscript.org/.  Although I can see a link there for LuaFileSystem I cannot see how to install this Lua Rocks thing on windows!\n. Thanks Edvin, I'll keep a lookout - thought I was going crazy with not seeing some obvious download link\nFound this although you may already know about it https://github.com/keplerproject/luarocks/issues/306\n. Would this lfs change stop the daily builds from working as I get an error message about lfs?\n. I managed to figure out where I went wrong, my path was slightly out.\nNow on to the compiling and I get an error\nerror C1083 Cannot open include file SDL,h: No such file or directory\nI think I downloaded everything listed, so I am now lost. \n. These are my paths\n1) C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\n2) C:/Users/Mark/Documents/Github/Libraries/SDL2-2.0.3/include\n3) C:/Users/Mark/Documents/Github/Libraries/SDL2-2.0.3/lib/x86/SDL2.lib\n4) C:/Users/Mark/Documents/Github/Libraries/SDL2_mixer-2.0.0/include\n5) C:/Users/Mark/Documents/Github/Libraries/SDL2_mixer-2.0.0/lib/x86/SDL2_mixer.lib\n6) C:/Users/Mark/Documents/Github/Libraries/lua-5.1.5-Win32/include\n7) C:/Users/Mark/Documents/Github/Libraries/lua-5.1.5-Win32/lua5.1.lib\nI am not clear where msinttypes-r26.zip goes, so my directory looks like this at the moment.\n\nOn the last attempt my errors are\n\nIt is likely I am doing something stupid, if that is the case I am sorry.  I am following the instructions to make sure they are idiot proof and I am the idiot when it comes to understanding compiling. :/\n. This is what I see in cmake\nNote: Using SDL as renderer (default)\nNote: SDL audio is enabled (default)\nNote: FFMPEG video is disabled\nNote: FreeType2 is disabled\nBuilding CorsixTH\n  SDL found\nFound Lua library: C:/Users/Mark/Documents/Github/Libraries/lua-5.1.5-Win32/lua5.1.lib\nFound Lua: C:/Users/Mark/Documents/Github/Libraries/lua-5.1.5-Win32/lua5.1.lib\n  Lua found\n  SDL_mixer found\nCMAKE_MODULE_PATH=C:/Users/Mark/Documents/GitHub/CorsixTH/CMake\nConfiguring done\nGenerating done\n. I have followed all the steps now several times, if anything I am getting more errors now.\n\n. I have figured out one problem, although I changed the paths earlier, I had kept on loading the wrong file/solution as one of the mistakes in my paths was to a different corsixth folder.\nWith that sorted things are progressing in Visual Studio and I now get the following errors\n\n. Thanks, I had the wrong SDL and SDL_mixer, I should have scrolled down the page a little more.\nIt has now built for me, so my next task is running corsixth in debug -thanks for the assistance :+1: \n. Could we update this page to explain where these come from?\n5.Copy the following files from your libraries folder into: .../Github/CorsixTH/build/CorsixTH/Debug: \u25e6SDL2_mixer.dll (lib/x86)\n\u25e6SDL2.dll (lib/x86)\n. I was wondering why is it you only have to copy over these two dll's and not the lua one for example?\n. Ah, in an earlier version of the wiki page you had to download lua for windows or something like that (it has since been removed from the instructions), so it must be down to that.\nThat might also explain why in cmake it was defaulting the lua to a different location (in program files) than the one in the wiki page\n. @J-Shep \nI have found this wiki page very useful and although I had a few problems on the way, I do now have a working exec that I compiled.\nI have tried several times in the last few years to do some compiling and was never able to manage it as something or other did not go the way it said it would in the instructions I was following at the time.\nThe page should prove very useful to other first timers - thanks\n. Did you mean to close this, are you sorted now?\n. For me it appears to freeze when the invisible emergency patients start being sick.  There is sound and it appears the game is still running, but everything you see is paused!\nThis is what I get from VS in debug, hope it helps\n'CorsixTH.exe' (Win32): Loaded 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\Debug\\CorsixTH.exe'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\ntdll.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\kernel32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\KernelBase.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\Debug\\SDL2.dll'. Module was built without symbols.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\gdi32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\user32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\advapi32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\msvcrt.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\sechost.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\rpcrt4.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\sspicli.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\cryptbase.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\lpk.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\usp10.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\imm32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\msctf.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\ole32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\oleaut32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\shell32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\shlwapi.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\version.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\winmm.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Program Files (x86)\\Lua\\5.1\\lua5.1.dll'. Module was built without symbols.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\winsxs\\x86_microsoft.vc80.crt_1fc8b3b9a1e18e3b_8.0.50727.6229_none_d089f796442de10e\\msvcr80.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Users\\Mark\\Documents\\GitHub\\MarkL\\CorsixTH\\build\\CorsixTH\\Debug\\SDL2_mixer.dll'. Module was built without symbols.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\msvcr120d.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\msvcp120d.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\uxtheme.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\clbcatq.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\XAudio2_7.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\opengl32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\glu32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\ddraw.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\dciman32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\setupapi.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\cfgmgr32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\devobj.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\dwmapi.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\ig4icd32.dll'. Cannot find or open the PDB file.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\msctf.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Unloaded 'C:\\Windows\\SysWOW64\\msctf.dll'\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\ole32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Unloaded 'C:\\Windows\\SysWOW64\\ole32.dll'\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\msctf.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Unloaded 'C:\\Windows\\SysWOW64\\msctf.dll'\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\msctf.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Unloaded 'C:\\Windows\\SysWOW64\\msctf.dll'\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\d3d9.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\d3d8thk.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\igdumdx32.dll'. Cannot find or open the PDB file.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\igdumd32.dll'. Cannot find or open the PDB file.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\powrprof.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\MMDevAPI.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\propsys.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\AudioSes.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\avrt.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\wdmaud.drv'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\ksuser.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\msacm32.drv'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\msacm32.dll'. Symbols loaded.\n'CorsixTH.exe' (Win32): Loaded 'C:\\Windows\\SysWOW64\\midimap.dll'. Symbols loaded.\nThe thread 0x1474 has exited with code 0 (0x0).\nThe thread 0xf20 has exited with code 0 (0x0).\nThe thread 0x169c has exited with code 0 (0x0).\nThe thread 0x954 has exited with code 0 (0x0).\nThe thread 0x1454 has exited with code 0 (0x0).\nThe thread 0x17d8 has exited with code 0 (0x0).\nThe thread 0x14c8 has exited with code -1073741510 (0xc000013a).\nThe thread 0x10ec has exited with code -1073741510 (0xc000013a).\nThe thread 0x16cc has exited with code -1073741510 (0xc000013a).\nThe thread 0xb68 has exited with code -1073741510 (0xc000013a).\nThe thread 0x14f0 has exited with code -1073741510 (0xc000013a).\nThe thread 0x14a8 has exited with code -1073741510 (0xc000013a).\nThe thread 0xa04 has exited with code -1073741510 (0xc000013a).\nThe thread 0x1658 has exited with code -1073741510 (0xc000013a).\nThe thread 0x12b8 has exited with code -1073741510 (0xc000013a).\nThe thread 0x1754 has exited with code -1073741510 (0xc000013a).\nThe thread 0x2a0 has exited with code -1073741510 (0xc000013a).\nThe thread 0x119c has exited with code -1073741510 (0xc000013a).\nThe thread 0x89c has exited with code -1073741510 (0xc000013a).\nThe program '[5952] CorsixTH.exe' has exited with code -1073741510 (0xc000013a).\n. There was nothing in the console window at all.   The game carried on running with staff leaving etc, but you could not see any of the action at all (except the usual stuff about not checking for updates and lua jit etc that is).\nThere was nothing in the windows event viewer either, which is why I then loaded the save in VS and ran it under debug to see what that showed.\nOh and it did not exit, I closed it in the end \n. No, I saw that in the video, but I did not get that.  It does not look like anything from the game, I wondered whether it was some OS thing?\n. Okay did things a little differently this time.  Loaded top autosave and the end of year screen is open. Close this pause the game and add benches near to pharmacy, hire nurse.   This time the invis patients can sit down, seated patients cannot vomit.\nNo error this time, until there is a fax being created, game crashes as in issue #619 \nSo is original error linked to vomit?\n. Notice also that the bottom menu does not show in the screenshot, I have not edited that out.\n. Seems to be limited to autosaves and saves, so is this connected to issue #618 ?\nStarting a game seems to be fine when it comes to the fax creation\n. It  will tell you when you load it, from the top of my head it was 80.  It was one I was using to test the 0.40 betas\n. There is an issue on the forum http://forums.corsixth.com/index.php/topic,5538.msg7898/boardseen.html#new which has a screen shot of the error message.\nIt looks to be fax related so there might be a connection ?\n. I have now been able to check and the save is 90 (0.40)\n. Would it not be simpler to allow the player the chance to select which save or saves they send?\nI am not sure I like the idea of the game doing this without the player taking some part in the process.  There is also privacy laws to think about, even windows reporting gives you the option to not send information.\n. @J-Shep If you are asked for something and choose to give it there are no issues with data protection, well, as far as I am aware for UK.  It only becomes a problem if you take personal information without the persons explicit knowledge.\nEDIT:\nPerhaps we should have a privacy policy that you can include a link to?  Something like any information provided will only be used to fix any errors and improve the game.  If you provide your email address we will not sell it or share it with others and that it will only be used to let you know when the error has been fixed or on rare occasions to request further information we might need to find a solution to the error.\n. there are a couple of suggestions that have been made in the past here.\nTo add to that it would be nice to see a birds eye view of your map in miniature at the side, or to have the ability to zoom in and out.  I usually end up saving it, loading it in the game. just to see if I need to add or change something.\n. I thought I would give this a test and got this error, which you may already be aware of.\nCreated game with savegame version 105.\nError in buttonup handler: \nC:\\CTH Map Editor\\Lua\\game_ui.lua:50: use of undeclared variable 'UIMapEditor'\nstack traceback:\n    [C]: in function 'error'\n    C:\\CTH Map Editor\\Lua\\strict.lua:43: in function \n    C:\\CTH Map Editor\\Lua\\game_ui.lua:50: in function 'constructor'\n    C:\\CTH Map Editor\\Lua\\class.lua:76: in function 'GameUI'\n    C:\\CTH Map Editor\\Lua\\app.lua:501: in function 'loadLevel'\n    C:\\CTH Map Editor\\Lua\\app.lua:1273: in function 'mapEdit'\n    ...\\CTH Map Editor\\Lua\\dialogs\\resizables\\main_menu.lua:121: in function 'callback'\n    C:\\CTH Map Editor\\Lua\\window.lua:682: in function 'handleClick'\n    C:\\CTH Map Editor\\Lua\\window.lua:1475: in function 'onMouseUp'\n    C:\\CTH Map Editor\\Lua\\window.lua:1459: in function 'onMouseUp'\n    C:\\CTH Map Editor\\Lua\\ui.lua:623: in function \n    (tail call): ?\n    (tail call): ?\n    C:\\CTH Map Editor\\Lua\\app.lua:783: in function \nError in timer handler: \nC:\\CTH Map Editor\\Lua\\world.lua:1060: attempt to index field 'ui' (a nil value)\nstack traceback:\n    C:\\CTH Map Editor\\Lua\\world.lua:1060: in function 'onTick'\n    C:\\CTH Map Editor\\Lua\\app.lua:882: in function \n    (tail call): ?\n    C:\\CTH Map Editor\\Lua\\app.lua:783: in function \nError in motion handler: \nC:\\CTH Map Editor\\Lua\\app.lua:944: attempt to index field 'ui' (a nil value)\nstack traceback:\n    C:\\CTH Map Editor\\Lua\\app.lua:944: in function \n    (tail call): ?\n    C:\\CTH Map Editor\\Lua\\app.lua:783: in function \nError in keydown handler: \nC:\\CTH Map Editor\\Lua\\app.lua:920: attempt to index field 'ui' (a nil value)\nstack traceback:\n    C:\\CTH Map Editor\\Lua\\app.lua:920: in function \n    (tail call): ?\n    C:\\CTH Map Editor\\Lua\\app.lua:783: in function \nError in keyup handler: \nC:\\CTH Map Editor\\Lua\\app.lua:924: attempt to index field 'ui' (a nil value)\nstack traceback:\n    C:\\CTH Map Editor\\Lua\\app.lua:924: in function \n    (tail call): ?\n    C:\\CTH Map Editor\\Lua\\app.lua:783: in function \nError in active handler: \nC:\\CTH Map Editor\\Lua\\app.lua:952: attempt to index field 'ui' (a nil value)\nstack traceback:\n    C:\\CTH Map Editor\\Lua\\app.lua:952: in function \n    (tail call): ?\n    C:\\CTH Map Editor\\Lua\\app.lua:783: in function \nError in textediting handler: \nC:\\CTH Map Editor\\Lua\\app.lua:928: attempt to index field 'ui' (a nil value)\nstack traceback:\n    C:\\CTH Map Editor\\Lua\\app.lua:928: in function \n    (tail call): ?\n    C:\\CTH Map Editor\\Lua\\app.lua:783: in function \ndownloaded CTH-20151019-map_editor2-c0a33e68d6.zip            19-Oct-2015 16:41\nfrom http://www.armedpineapple.co.uk/cth/builds/\n. Yes\n. Line 50 reads local FLIP_H = DrawFlags.FlipHorizontal << 8\n. I commented out the << 8 and it now loads.\n. that works too.  I am using the files that came in the zip\nThere is lua 5.1 installed from ages ago, would that make a difference?\n. @TheCycoONE   I noticed that performance was slow when trying it out last night.  I select a floor tile and then select a tile to drag out an area and it seems slow to update, it was almost as if I had something else running in the background - which I didn't. I can't think of another way to describe it other that it was very juttery.\n. It looks like you had a lot of errors, the first one suggests you were trying to place a staff member somewhere you shouldn't \"Map co-ordinates out of bounds\".  I have seen that in another issue in recent weeks. \nCan you recall what you were doing when that first error happened?\n. I think this is a duplicate of issue #508 \n. What happens if you are editing a room when one of these announcements happen?\nWill my object rotate or will my view centre on the cause of the announcement?\nhttps://github.com/CorsixTH/CorsixTH/wiki/Hotkeys#edit-room--place-objects-window\n. How long it takes for the first patient to arrive can depend on where on the map they spawn as some points are further away from the entrance than others\n. Sounds good to me\n. It didn't crash for me.  I have a feeling this is a repeat of the issue with hell death sound effects as the grim reaper is at work at the start of this save.\n. I can confirm that when I change my sound effects file to French the game will crash, which is a duplicate of issue #588 I believe, so has already been fixed in the trunk.\nI don't think the issue was limited to the French sound effects alone.\n. As already stated, I think this is fixed and the same as issue#588, which is pretty much verified by his brother.\nI don't think it is related to #656 as clipping is not the issue. The issue is around hell deaths and one or more of the sounds for the gates to hell!\nI think we could close this @TheCycoONE ?\n. @pwaller  I am aware of the clipping issue, thanks.  I don't believe that became a problem until after 0.40 though.\nPlease read my first two comments.   It didn't crash for me until I changed my language file.\n. Is this a duplicate of issue #563 ?\n. At what point did it crash? \nfor me it was towards the end of the month and it was elvis getting changed.  This has a familiar ring to it, does it ring any bells for others?\n. Same in Windows 7 for 0.40.\nI have a feeling though that to skip the intro movie it is click or spacebar.  Even so it should not crash.\n. I think you have added the wrong save, for me it is the start of the level!\n. Did you uninstall origin?\nI know when I did it took away the theme hospital files at the same time.\n. If you are having problems with sound effects, there was an issue that became known after 0.40 was released as one or more sound effects relating to the gates of hell were causing a crash.\nIf that is what you are having a problem with, then this was fixed by this update in the trunk.\n. You should remove that link please as it could be taken as distributing the original files.\nLang is the written text, such as what the advisor tells you and menu names etc.\nIt should not cause the game to crash, but there have been issues with the correctness of some translations.  As Ryan as already said we can override those sorts of mistakes and already have done when they have been pointed out to us.\nIf it sound effects or announcements etc then it is sound-1.dat as in the title of this issue that needs to be checked\n. I am not getting any crash from the language file.  I can't comment on the actual text as I can't read or speak French.\n. No, against 0.40.  Do you want me to test against trunk as well?\nOnly I cannot do that as the latest build is looking for lfs which I don't have!  Perhaps @Lego3 or @TheCycoONE can do that? \n. Tested with latest build and all seems fine\n. Does this mean your problem was not with the language or sound file, but the missing .dll's?\n. What is this patch doing?  If it is to correct text, we can do that, if it is to correct sounds then you are best sticking with the original for now.  Only you have mentioned sound-1.dat and also LANG-1.DAT, which is the language file (which is what you linked to).\n. I think for now you will have to put up with the missing sounds.  Perhaps one day we will have our own, but for now I am not aware of anyone working on this.\n. The error message does suggest you have file corruption, so it would be worth doing as suggested by Ryan and copying the files over again.\nAlso you can check the config file for corsixth in case the data location has been altered\n. When you click on a contagious patient he is marked for vaccination.  Once the nurse does that he or she is no longer contagious, but still needs to be cured.  You can tell this as there is a cross through the bug icon\n. @sadger I am interested in what is meant by \"new way\".\nWhat we have done is not just from my memory, as I can still play the original game\n. Issue #66  and issue #147 are related\n. Duplication of issue #451 \n. The latest build I can see is CTH-20150208-master-fa0a7775b5.zip     from   08-Feb-2015 20:39\nIs this because this needs merging first?  I had thought we got a build from travis as soon as the testing was done.\nI'd jump in and click on merge, but as I can't test it until I have a build I don't like to interfere...\n. If for some odd reason it does not work, is it easy enough to reverse?  @TheCycoONE \n. I'll keep my fingers crossed then :)\n. :+1: \n. YOUR is grammatically incorrect.  Should either be YOU ARE or contracted to YOU'RE\n. How does it crash?\nWhat is the error message?\n. @SimplyRyan  Would you get anything in the console?  I can't check this right now, but from what I understand it is not the game that is crashing and there is no actual error.\nThe annual report has popped up whilst he is editing a room and the editing menu has kept the focus.  There is a way round it i.e. closing the edit room menu, but that is not ideal. Closing the annual report would be okay, but as it does not have the focus you cannot interact with it.  Normally the full screen menus have focus when they are open\n. @mortengormmadsen  Sometimes hitting the escape key can close an open menu, does that help?\nThere is no other logging available other than enabling debug.  I don't think that will help here though.\nWhat we need to do is give the annual screen the focus when it opens and pauses the game and then the open edit room or any other menu won't make a difference as it will still be there once you close the awards screen (I think that is the last is the series)\n. I have struggled to reproduce this and the only way I could was to ignore or move the year end screen to finish off the room.  If I close the year end screen first I don't have a problem as I can then go back to the room.\nSo for me the year end screen has the focus until you click away from it/behind it.\nTried this again with a much larger resolution and I was able to finish off the room and then close the year end screen.  So I can't see what the problem is now or perhaps I am not re-producing it in the same way!\n. Can you upload a pic of which state the room was in at the time as there are many stages and perhaps I am not catching it at the right one?\nI will then take another look tomorrow night\n. I cannot see any problem.\nI start to edit the room to the same stage as you and the end of year screen pops up.  I move it out of the way and I am then able to finish off the room and go back to the end of year screen.\nIf you cannot do that and we are both using 0.40 I cannot think why it is you cannot complete the room!\nNot sure if this will make a difference, but you could try and re-install 0.40.\n. @TheCycoONE @J-Shep \nI could be wrong as I have not played CTH fully for ages, but I thought the game paused at the end of year?\nIf the game did pause I don't think there would be an issue here as you would then have to deal with the end of year screen, then close it to continue the game and finish off the room edit in this case.\nHas some change in recent months stopped the pausing or am I not remembering it correctly?\n. I hadn't noticed that the game was paused because I had slowed it down to give me time to edit the room.\nYou are right in that if the game is paused, then how is it you can continue editing the room?\nI am not sure what modal dialog is, but if it is what I think it is, then we are in a way agreed.\nThat screen takes precedence and should be dealt with first.  Is this what you mean?\n. In the settings menu there is an option in customise to disable building whilst on pause.\nI have the setting on to allow building.  If I disable building on pause then I cannot use the edit room menu.\nWhat setting are you using?\n. With the disable build option I can now produce your error.  Got there in the end :)\nYou are correct in saying what you say about now not being able to interact with the year end menu if you click away from it and click on the edit room menu\n. I'll try and look into why over the weekend, but don't let that stop anyone else from taking a look\n. @Alberth289346   In theory it should not be possible to drop litter or be sick in a room.  So I wonder does it happen through the wall from a patient walking past? \n. Have you tried shift + arrow as that is a little faster?\nAlso look in config.txt for scroll_speed - the default is 2 I think, but you can increase the speed and perhaps the smoothness as well.\n. It was something @Lego3 added a while ago, I think there were issues around callbacks not being removed\n. It is much slower compared to the original game version.\nFor me they seem to be about the same.  Maybe Theme hospital seemed faster as it was a much small resolution?\nPerhaps it is something that is specific to some computers compared to others - different graphics cards for instance may slow things down if they have a higher definition! \n~ just throwing ideas out there ~\n. Checked this again 0.3 and 0.4 and this only becomes an issue in the trunk version\n. @bobcanthelpyou \nWindows 7. try using number pad keys as it does not happen with top row number keys\n. This disease needs both a ward and operating theatre to be treated.  Usually you would get a message/fax telling you that one or other is missing and you are asked what you want to do  i.e. wait while you build the room, send home etc.\nFrom the above error message it looks like there is no operating theatre (or is it that it is not staffed).  I can't check the save at the moment, but if that is the case, why has the previously mentioned fax not been received?  Is this just a trunk thing as it has been working fine for me with 0.40 and a copy of the trunk from about two months ago?\n. Sounds like it is specific to that level.  You would have thought that any diseases needing two doctors would have been disabled, so that perhaps could be part of the solution.\nHowever, not sure if your Dr is a surgeon or not, but either way there should be a fax telling you that you can't treat that patient as the room does not exist and/or you have not the staff for it.\nI've looked in the level file and there are other diseases in there that need the operating theatre!\n. Running your save I can confirm your error.   I am not sure why it is not sending a fax for a decision as you clearly cannot cure the disease.\nI am going to run some more test on this level\n. I'd have to check it against TH, but I feel sure there was a fax to say you couldn't cure the disease, and the usual choices and that it would also show the red x in the casebook.  I know we don't have the casebook bit fully right, because it does not go back to the red x if you lose a surgeon or room, but I did think we had the fax right for this.\n. @Alberth289346 I have been trying to remember the bug report you refer to and the only one I can recall is getting a fax for a decision where you don't have a room and cannot build it yet anyway.  Is that the one you mean or was there another one?\n. Yep, that was the one I was thinking of.  In your case you are getting a fax, this issue is you are not getting one.\n. Played this map from start and each new disease generates a fax - disease discovered and if you cannot cure a fax- decision needed.  Then when pregnant patient arrives the game will crash as she exits the GP office.  Never got to other operable diseases, but assuming it will be the same.\nI know I have seen these faxes in other maps, so is it that you don't have the room or don't have the staff that is throwing the error?\n. \n\n\nIn situations where you can build the operating theatre and haven't the faxes are generated.  If you can't build it as it is not available the game will error as above, then you get the first fax but not the  decision fax\n. In both Avatar and the level I tested an operating theatre is researchable.  There are many of the campaign levels where a disease appears before you have researched a room.\nSo why does it crash in this case?\n. I was thinking it was researchable because of RschReqd, but as @TheCycoONE  says the room cannot be without the table.\n. What I don't understand is Avatar was added a couple of years ago, so why as this error never appeared before?\n. To test this I have just run it on a version from March 2013 and got the same error.  Perhaps nobody has ever played this level or if they have they haven't informed us of the error!\n. I don't understand what your problem is, can you explain it clearer?\nWhen it says all done it means you cannot research anything more in this section.  Not every room is available in every level.\nhttps://github.com/CorsixTH/CorsixTH/wiki/Game-Guide#research\n. Specialization is the one where you have to click on something in the drug casebook.  If you have not selected anything then it cannot be used.\nSpecialization: This concentrates a percentage of your research on a specific cure that you are able to select in the Casebook screen.\n@triceo it is not specific to drugs!  You could for example improve the strength of your machines.\nThis will happen over time anyway, but you may want some machines to improve quicker than others, so you select it in the casebook\n. I don't know then, I cant remember whether it ever said all done even in TH\n. Do we want the game to specify \"All done\" on specialisation when all possible machines have been researched, drug improvements are all at 100%, machines are all at maximum strength?\nThis being the case then the drugs casebook will also require a change to disable \"concentrate research\".  I think it is for level 1, but as the above it what specialisation is about then if everything is known it should be blanked out.  Not sure what TH did, but that would make the most sense here.\nI have noticed in 0.61 something in the casebook is set to concentrate research by default from level 2, not sure when that was implemented?\nAnother possible knock on change would be disable this function in the casebook if you have opted to not fund any research in the area - otherwise you could be under the impression you have focussed research on something that is not going to happen because you are not paying for that. do you have the save from before he went to research?\nWas he already on the way there when you researched and built the room?\n. This is as I thought, you get the fax, send him to the research and just after this the shower is researched before he gets there.  I think to get the error it would be bad timing/edge case.  It might even be the researcher with the task of putting him in autopsy leaves the room and the task is not reassigned as it should be\n. Can you share the save?\nThe counters reset when you edit the room, so it might be down to that\n. I'm baffled as I can't reproduce it.  Editing the room does reset the machine usage, but this is the other way around so it can't be to do with that.\nAre you sure that queue menu is for the same room?\n. I didn't look at your save after reading @TheCycoONE comments about the save not having an inflator.\nI'll check it out tonight\n. @bobcanthelpyou \nHas an earthquake occurred in this game?\nEarthquakes can damage machines and this will appear as uses until there are none left then boom the machine is soot\n. I have this happen and can also lose the bottom menu altogether.\nI found this happens when I have selected a resolution my computer display was not designed to run.  When I do I also see the artifacts @TheCycoONE  has mentioned.\n. The reason you can't build in that plot from I can see is it is blocked off by the bench, drinks machine and radiator.  Move those objects and you should be fine.\n\n. No, the check is correct.\nAt the time the items are placed they are against the wall, so they weren't blocking anything and I think that should be possible.  There are hospitals where you can and would want to build a room at the joining point, so I don't see why that should be banned either.\nI think the player should be prepared to either remove objects or rooms if they block areas when new plots are purchased.  In TH it was actually possible to block off areas of the hospital and I think it is only disallowed in corsixth because of the path finding code.\n. Perhaps the solution is to disallow the purchase of that plot until the corridor is cleared?\nA message could be shown to say you cannot buy this plot as it does not have access to the main hospital.\n. Yes you could trap patients, because the advisor would say you should plan your hospital better as someone was stuck or something like that.\n. It was also possible to trap staff, an easter egg was where the handyman turns into a yeti if he is trapped\n. Agreed, this has been an issue for several years, it has come up a lot, so it would be nice to mimic TH behaviour instead of disallowing something that players like to use to as you said to partition off parts of the hospital,\n. Just to clarify in TH you could not place staff in blocked off areas, but you could trap them by blocking off an area they were in.  If you tried to place one they remained on the cursor in grey the same as they do outside the hospital.\nIf I have the time I'll check what the situation was for rooms and objects. \n. Could that be down to the small space?  I think the patient falls, a hole appears which he is supposed to walk to and disappear into it.  The animation thing might be where it has to change for the disappearing part.  He should not continue on for any treatment and I am surprised the hole is so near to where he fell, but that could be down to the small space available.\n. Hell deaths do need a bit of space, so I am surprised it did one there when it should really have switched to heaven death.\n. For such a comment I would think no reward and the reputation in community should go down and the fax should reflect that the reputation is reduced.\n. I'll take a look at the strings then and get back to you as I was thinking that one was bad\n. The good ones should get a cash reward and a boost to the rep, but it only tells you about the cash.\nMedium get a boost to the rep only and the bad get nothing\n. When john added the VIP I think he did some scheme to work from, I'll see if I can track it down\n. https://www.dropbox.com/s/p7c40gdjsr7lpet/vip-algorithm.pdf?dl=0\n. (0 <= internalRating <= 19) => ultimateRating = 1 (- 100 reputation)\n(20 <= internalRating <= 39) => ultimateRating = 2 (-50 reputation)\n(40 <= internalRating <= 59) => ultimateRating = 3 (no change)\n(60 <= internalRating <= 79) => ultimateRating = 4 (+50 reputation, 5000 cash)\n(80 <= internalRating <= 100) => ultimateRating = 5 (+100 reputation, 10000 cash)\nThe cash amounts were changed from this in the end, but you can see the middle score should do nothing\n. I'd be inclined to only have the middle one (average) with nothing, not even a rep gain and leave the others as they are\n. Perhaps he has no other place to go right now and the logic in the game is for staff to return to their last room until needed.\nIs a Dr needed somewhere else?\n. Confirmed, the call is not getting cancelled in the calls dispatcher\n. Not played in a while, but I think with the board you have to click on it for it to open the level, but I guess you know this....\n. Take a look in \\lua\\dialogs\\fullscreen\\bank manager as there are examples there.  line 161 for instance.\nWhere function has function: function name () local is written differently as it is only called from within the same file - others can be called from other places e.g. world: tick()\n. The is a link in the wiki home page\n. My understanding is they get updated when merged not when committed.\nI used to download the latest build and then merge pull requests to test them\n. How do you know that there is no handyman coming to repair?  Did you open the calls dispatcher menu or are you expecting to see the cog over the machine?\n. The repair calls are pending, but you have only two handymen!\n. You have also told one of them to sweep rubbish only and the other to water plants only!\n. I'd have to check that, I can remember being able to place objects over litter and it clearing.  It came in handy when there was a vomit wave as you could help the handymen to clean it up.  As for rooms, I don't think you could, but will check it for you later.\n. You can build a room over litter.   I did this with the original setup, so cannot do a screenshot.\nIf someone can remind me how to run TH in dos box I will do screenshots for you.  I thought all had to do was type in hospital or cd\\hospital and enter, but it is returning illegal command\n. sorted\n\n. I don't get any errors either.\nYou said un-pause, but for me it is running fast, so have you shared the wrong save?\n. @Alberth289346  It was working perfectly up until 0.40, it got broke in 0.50.\nI have used it many times for testing new maps\n. Do you still get the charts or are you saying there is nothing recorded for the other hospitals?\nIf the latter, that has not been added.\n. Skills improve quicker in the classroom, but they also improve slowly whilst working.\nCould it be this is what you have seen?\n. If you want to train a researcher etc you are better off starting with a junior so there is time for him to learn the skills and become a consultant.  If you put in a mid skill Dr you will find there is not the time for him to learn the skill and they become consultants quickly\nThe hardest to do is train a consultant with all three skills, but it is doable with a really low skilled junior.\nYou can also increase the speed they learn by adding a skeleton and some bookcases.\n. Error in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\map.lua:50: bad argument #1 to 'floor' (number expected, got nil)\nstack traceback:\n    [C]: in function 'math.floor'\n    C:\\Program Files\\CorsixTH\\Lua\\map.lua:50: in method 'getRoomId'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:2275: in method 'getRoom'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:75: in method 'getEntranceXY'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:696: in upvalue 'tryMovePatient'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:758: in method 'tryToFindNearbyPatients'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:479: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:371: in method 'onHumanoidEnter'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:356: in field 'on_next_tile_set'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:218: in field 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:149: in method 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1121: in method 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:878: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:779: in function \n. No that is not what he said!\nLook for radiators in front of doors.  Use transparent walls feature to see other side of doors and walls\n. Could it be an option in free play?\nI agree with @voodoo070 that it is a mechanic of the game / all part of the challenge.\nIf it gets easy you are less likely to enjoy, but as part of free play it could be seen as the training ground.  There would need to be some sort of penalty though, perhaps time penalty that you have to wait a year before you can edit it and replace the machine and clean up the tiles.\n. @TheCycoONE   I don't remember that and who would pay for a fatal treatment?!\nUsing the autopsy had a treatment charge value in the casebook, but when I checked the charge was never made.\n. Thinking about it the payment is made before the patient dies. not sure if the same happens with insurance, how would you know.\n. As I recall patients leaving without paying would happen between rooms or it always seemed that way.\nVisit GP be told what the treatment was and on the way to treatment realise how much it was going to cost and it was then they left without paying.\nIn the case where the GP is pricey they make the decision after going to reception - so again before using the room.\n. Tried it out on TH and it is before the room use not afterwards.  The charge is determined before it is used, so if you bump up the price whilst someone is on the way they pay the original price, the next patient pays the higher price\n. @TheCycoONE  Yes, they make that decision before getting to the room.\nIf just arriving and you have increased the cost of GP they will decide or not it is too expensive after the reception desk.  If on the way back to GP it will happen as the leave the diagnosis room.  With treatment it will happen as they have been diagnosed and are leaving the GP office.  Some walk out and some pay it.  It did seem that those that were insured were more likely to pay, but the sample was small, so that may not have always been the case.\nIt was as if they found out how much it was going to cost and decided then it was too much.\n. Agreed\nWith reception first room is always the GP.  Does that make it any simpler to do?\n. @TheCycoONE   Like what you have done, the staff factor can affect reputation if you wanted.\nHospitals that employ a lot of juniors that are not training or on those lines.\nWho actually treats you in he end is not something you would be aware of at the time or before the event.  Your happiness when you leave the hospital would or could affect the reputation if you were sent to multiple rooms for diagnosis because the Dr was unsure (a junior) and you would be happier if you had seen a consultant who knew what he was doing and you were treated quickly.\nSome of those factors are already in as your happiness goes down the longer you are in the hospital, although it does improve when you are cured\nAll something for another time\n. I don't believe they increased the strength of a machine or reduced the chance of explosion through use.  Once a machine reaches 0 in uses it explodes.\nHowever it may have reduced the chance of explosion from an earthquake, which would be difficult to check as the screen moves that much and for different lengths of time you would have trouble measuring how quickly the uses go up.\nSo as checking TH on this is pretty much out of the question, why not get a consensus from everyone on whether this would a good addition to the game?\nIf that is the way you go you get my vote for reducing the risk of explosions when one is present in the room.\n. Exploded rooms are closed off so how are patients and staff interacting with closed rooms?\n. It may or may not help, but several years back @corsix  started a new action queue branch which is available on github.  It will be years out of date now and lots of other things have been added since, but it might be the basis for a change to the action queue system - with a lot of work no doubt.\n. It is perhaps something I missed when it was added.  The whole of fall down and get up animation for earthquakes was causing problems so it was disabled.  Similar to #1094  where the fallen would sometimes slide on their belly off the map\n. I think a three tile radius from the bin there is a 90% chance the patient uses it,  five tiles there is a 50% chance of using it.  People are lazy, so any further there is more chance of them just littering.\nI also think there should be a chance everyone has litter, I think at the moment only some patients that use a drinks machine can litter, whereas in TH everyone dropped litter\n. @Alberth289346  Sounds okay to me, I look forward to trying it out when I have some spare time\n. What shows the following month?  There is an initial fee when you first hire, then the month cost and a cost if you fire.  Your statement looks correct to me, but would be wrong if you were charged again in Feb\n. That is unexpected behaviour then\n. @TheCycoONE  Regarding transferring staff is not an option in Theme Hospital\nI think it was in the multiplayer @Lego3 may remember, I think poaching staff was an option, or I could be mixing this up with something else\n. I have only ever played one or two myself, but check out the language strings (which may have been used)\n\"One of your staff has been poached by another Hospital.\"\n \"No way! Someone is already trying to poach that person.\"\n\"Somebody is poaching your staff. You're going to have to fight to keep them.\"\n. I think you would have to click on the other players staff and the other player would see a pay rise request to stay or leave\nTrouble is it has been two or three years and I only played a few multi player games at that\n. the H is to do with path finding or it was with the external editor.\nI have not used the new editor, so I will have a bash with it tonight to see what problems if any I can find\n. I noticed that there are two new things that were not needed before.\nCamera position was where you were looking when you saved and now is something you select and a dropdown for the number of players.   I did both and could build as expected, perhaps this was not done above?\nI would attempt creating another map to try out this theory, but I still find the map editor slow and judery to use.  For me it does not like dragging and freezes and then paints objects in the wrong place.  Annoying as I could not find an undo button.  This was window mode, I'll perhaps try full screen to see if that is better\n. Just seen the additional comment.  I placed the floor after the walls and then the parcel\n. Something else I have just noticed is that the map is saved near your saves and the level file is in the level file where corsixth is run from.  Both folders are levels.\nPreviously you placed both parts for a map in the same folder.\nI noticed this as I created another test map and placed it in the level folder with the game and then when I tried to play it it was the old test map.  I then copied my new map to where the saves and there is no level file in that location and I got to load my newer map.\nSo it could be like me you are making changes and loading the wrong map without realising it?\n. There are my locations\nC:\\CorsixTH 0.60\\Levels\nC:\\Users\\Mark\\AppData\\Roaming\\CorsixTH\\Levels\n. Yes but  I placed the floor after the walls and then the parcel and I had the buildable flag.  Parcel was 0 as default and I changed to 1.\n. @TheCycoONE \nI don't see how this is off topic if we are trying to discover what causes an error sometimes and not others. Both I and @voodoo-burger placed the parcel after the floor he can't build and I can!\nTherefore explore other options in case we are missing something.\nThe thing with the level folders may be relevant if like me you end up with two maps with the same name that are in different locations and any changes don't seem to take affect (because you are not aware that the older one is overriding the newer one)\n. I'll take a look at your map in a minute\nI built another in full screen (still slow at responding though) and did things in stages in case it was adding an heliport that removed the flag or something and when it came to playing it the game did not recognise there was one.  Yes, this is off topic.\nNot selecting camera or number of players did not make a difference.\n. @TheCycoONE \nLoaded the above map in the old editor and only middle tiles have the buildable flag in the large building  (I did this as you can see flags in the old editor.)\nI can see the bits you refer to and purple part is not buildable.  Becomes buildable when you add walls, again this is the older editor.  The large building has walls, I take it with the new editor walls has nothing to do with the buildable flag now?\nNow loaded it in the new editor and renamed it test map to go with my level file.  Load the scenario the build flags are as I saw them above.\nThen in the new editor added parcel 2 to the purple space and also added another door to the large building.  In game there was no change to the large building, only the middle tiles are buildable and a couple in the purple space.\n\n. just a thought, in the old editor there could be issues with the build flag if buildings were too big or had too many doors.\nI would try and create a large building from scratch, but as I have no real control of what the mouse is doing it could take weeks doing it a tile at a time\n. Is there a way to add the debug menu or at least the flags part to the editor?\nThat way we can see what happens before and after save as it maybe that saving loses the flag.\n. Try moving up the middle slider in the hospital policy screen as this will make patients visit more diagnosis rooms.  Move it back when queues start to build up though\n. In my testing I had moved the couch to the middle, removed radiators, separated couch bookcase screen and chair so there was space around them all and still got a crash each time.  The only time it did not crash for me was knocking the room down and building it some where else.\nCould the path finding issue be location specific?\n. Has a familiar ring to it, is it anything to do with 64 and 32 bit versions and running the wrong one?\n. It says user names cannot be changed\n. @TheCycoONE  How is it a duplicate? This one has the error No animation for Doctor using op_sink1 facing east phase 0 and there is no error message in #68 \n. Doctors or other staff being in a cycle of wandering around and not going for a break has been an issue for several years and it could be there are other issues open that refer to that as well as #68. This one though mentions something about \"no animation\". @Alberth289346 could not replicate it so I wondered whether @Scrabblebonce has incomplete or corrupted data?\n. Agreed :+1: \n. For me it is not creating the pull that is the problem it is when you have to make changes as it is so easy to then get in a mess and have a branch you cannot get out of. Or splitting things to then be asked to merge them.  For those used to git it is a great tool, but a complicated one for those more used to a windows interface like svn.\nIf I choose to contribute in the future I will take you up on the offer as above\nThanks\n. If you were to do a 0.61 you could make it clear that it is a patch to fix the map editor.  Some people then may not bother as I don't think it is all players who delve into making their own maps\n. I think in FAQ would be good\nhttps://github.com/CorsixTH/CorsixTH/wiki/Frequently-Asked-Questions, perhaps \nQ: my midi sounds don't play or the quality is poor \nA: ~your suggestion\nThen perhaps link to any detailed instructions which could be added here https://github.com/CorsixTH/CorsixTH/wiki/Sound-List\nIf you need any help doing this, shout up as I am happy to assist\n. @robin110 \nCan you try the solution from @botcherO  see https://github.com/CorsixTH/CorsixTH/wiki/Frequently-Asked-Questions and if this works for you we can perhaps close this?\n. @TheCycoONE  I wanted to try this out, I downloaded the test build but the game won't run. (closes on open with no log report)\nI know it says I need Microsoft Visual C 2013 Runtime. It says the same for 0.60 and that works so I assume I have that.\nWhat am I missing?\n. I think that is what I have\n\n. Unless I am missing something I have tested this with #1089 and gave it the thumbs up.\nDrag is working as I would expect and is smooth and I can run the exe created by appveyor now\nIf I missed something please shout up\nThanks\n. The saving worked for me anyway.\nAt the weekend I will create a multiplayer map and see what restrictions there are.\nFrom my limited (twice I think) knowledge of multiplayer there are some things you are allowed to do.  Placing litter bombs and moving them was one and the other was poaching staff.  I can't remember exactly how that worked, but I am sure if that became an issue later a fix could be found?\nSo for testing, create a map for more than one player and parcel it into areas for starting for each player with an helipad and some un-owned areas for players to buy?  I can't think how you zone an area for each player from the controls I have seen.  I saw something about different helipads though.\nIf I have any problems I'll create an issue for each one \n. Okay\n. I could be doing something wrong.  Built a basic map to start with and set the camera positions in each of the corner plots for each player and set the middle plots as parcels 2, 3 etc.  Corner plots are all 1.\nIn town map it appears different players own the other corner plots, but I can build on them.\nThose parcelled 2 and up can be seen in game and in the town plan, whereas you only normally see an outline of those until you buy them.  It shows in town map that I own all the other plots, which might be why I can see them, but I can't see what you would do other than parcel other than 1 to make them unowned. I can't build on these other plots though!\nMap is very basic at the moment and I do need to add walls and paths/roads - so that might cause what I am seeing.   I will work on finishing the map at the weekend.\n. Yes, I think I just got that as I have been updating my map.  So far sort of working as planned as you have just said the first four parcels were in different spots to where I placed the camera.   As I get the hang of map making for multi player I'll update the wiki\nOne point though is I don't think 9 parcels is enough as that is essentially two buildings per player and one over\nEdit:\nLooking in the old editor there were 31, but that is likely too many  20 - 24 should be enough if you were to fill a map with buildings\n. How was that determined?\nI have just opened L44 from TH and there are 16 parcels in that one\n32 in L43\n. Parcels not players\nOpen one of the two original maps as above and they are both four player but a lot more parcels\n. Old map editor went up to 31, so that was one short based on L43 it seems\n. Back to testing this update:\nI am able to place staff in buildings I don't own.  I am not sure whether you could in TH, but I can't see why you would want to.\nYou can't place objects or rooms in building you don't own as expected.\nPatients wander other building, that is fine and from what I remember is the same as TH.\nTown map displays the other player name for their buildings.  I think though their plots should appear in a colour for each player - this will need to be verified in TH.\nI can't test the placement of the litter bomb as they are not implemented.\n@TheCycoONE  Can you think of any thing else to check for?\nJust noticed that the handyman I placed in a building I don't own stopped there and did not attempt to go to one of my buildings. This could be the same in TH\n. I was using L43 which as four plots close together in the centre at the start.\nI did notice later that peeps had been sick in one of the un-owned plots and that a handyman went to clean it up.\nIf we stop patients wandering into other plots this won't be a problem.  It does occur though that if an handyman gets a call to clean vomit in another players building the same could happen with Dr's and nurses.  Same with plant watering and machine repairs.\nEdit: for un-owned I mean the other players plot\n. This one runs\nThanks\n. Do you want me to merge?\n. :+1: \n. Plot numbers.\nMap makers parcel up the different buildings on the map. 1 is owned from the start and the rest you buy in game.  For multi-player (which is not working yet) it is the first plots that belong to the players 1 for player 1, 2 for player 2 etc 5 and higher you buy or bid for in game\n. It looks like the door is being reserved by someone and as a result no one else can use it.\nPick up the staff and place them outside then edit the room back to the blueprint stage.  This cleared the reservation for me\n. @TheCycoONE \nI reckon so\n@viktorcech \nThe people working on this project do so for the love of the game and do it in their spare time.\nIf you are after a bug free game go an buy one, although in my experience even those have bugs in them.\n. Tested against 0.50 and it was working then, not in 0.60 though\nEdit\n@TheCycoONE \nI can't spot any differences either in world or room relevant to this between the two versions\n. I think we understand the problem and until 0.50 CorsixTH did the same unless in debug.  For some reason this got broke and we need to see where so we can restore it to match TH\n. I don't understand the issue as you can still access the buttons if you are allowing build on pause.\n. That sounds more like a maintenance efficiency check.  Percentage of rooms destroyed being high suggests poor overall maintenance.  However with earthquakes being over;y strong that would not be a fare thing to evaluate on any way.\nOn the second point, I think you'll find lots of places where more than the players hospital was not taken into account and will need changing once multi-player becomes an option.  Some are noted above the functions. \n. Interesting that the screenshots are for a different game!\n. I'll close this and you can post an issue under the right game then\n. I know, and it's morning here \ncya\n. @maki-chan   A lot of projects out there for old classics OpenTTD (transport tycoon) is another and Return to the Roots if you liked settlers 2\n. It also depends who is diagnosing.\nHave a consultant and he is more likely, a junior is less likely\nJust because you can see what is wrong doesn't mean your Dr's can.\nIt also gets harder on each level\n. Also in the later levels you will find you have to send patients to more machines before there is a diagnosis.\nAs for Lego3's comment, there is a table in the wiki which tells you which machines help for which disease\nhttps://github.com/CorsixTH/CorsixTH/wiki/Diseases\n. It appears to be the door that is blocked to this room preventing anyone from using it.\nI have a feeling this may have been fixed since 0.60, perhaps this can be confirmed?\n. @Alberth289346 \nI'll download the current master and see if some of these things happen to me then. \nWith the attached save editing the room fixed the issue, but that does not find the cause.\nI'll close this and open a new issue if and when I come across these error messages\n. I have run this same level for 5 years using a more up to date version from trunk and I am not getting any errors - which is brilliant in some ways, but annoying when you want it to go wrong......\n@EythanF Can you remember what things you did prior to the staff getting stuck i.e. did you move rooms around\n. Maybe of some use then?\n. I have added the autosave for just before the error.\nI can't see any litter near reception in that save or in the one with the error.\nOn one re-run someone arriving at reception did vomit, no error though. Might need many re-runs to re-produce.\nCould it be the vomit did not land?  You see the patient vomit but as it is close to desk it does not land on floor.\n. No changes in that area at all Alberth289346. With the exception of removing one or two plants which were not next to the desk, but against the wall opposite that area is pretty much as it was first set up at the start of the game.  Second desk was added, but that was at least a year before then - maybe last night or even the night before\nCalls for litter clearing don't appear in calls dispatcher, are they still handled that way or is it they are no longer displayed in the debug menu for calls?\n. Lovely!\nSo if handyman arrives to say sweep litter, could it be that if the litter is no longer there -  put brush away and move one?  (Rather than throwing an error) Or do we need to find out why there is no litter i.e. already cleaned and not updated / there was never any in the first place?\n. Happened again on another level.\nhttps://www.dropbox.com/sh/ndakv2q87252tsq/AAAS1TXUuIiJdsLoA0_CyY9ra?dl=0\nFrom the link above download autosave 10.  As it opens just cancel the build and move to the main entrance.  A handyman will go to the long corridor entrance and attempt to sweep none existent litter and it throws an error\nAlso include the autosave from the month before as you may be able to determine what it was he was going to sweep.\nAlso added log file, the earlier one now has old in the title\n. Got a save where I have been able to replicate the error.\nUnpause and watch the handyman entering the double doors.   He will sweep an empty space and the game throws an error\nhttps://www.dropbox.com/s/szwwdcg29l7782r/sweep%20nothing.sav?dl=0\nC:\\Users\\Mark\\Downloads\\CorsixTH (272635fd )\\Lua\\world.lua:2134: attempt to perform arithmetic on a nil value (local 'y')\nstack traceback:\n    C:\\Users\\Mark\\Downloads\\CorsixTH (272635fd )\\Lua\\world.lua:2134: in method 'removeObjectFromTile'\n    ...rk\\Downloads\\CorsixTH (272635fd )\\Lua\\objects\\litter.lua:98: in method 'remove'\n    ...orsixTH (272635fd )\\Lua\\humanoid_actions\\sweep_floor.lua:45: in local 'timer_function'\n    C:\\Users\\Mark\\Downloads\\CorsixTH (272635fd )\\Lua\\entity.lua:216: in field 'tick'\n    ...rk\\Downloads\\CorsixTH (272635fd )\\Lua\\entities\\staff.lua:149: in method 'tick'\n    C:\\Users\\Mark\\Downloads\\CorsixTH (272635fd )\\Lua\\world.lua:1051: in method 'onTick'\n    C:\\Users\\Mark\\Downloads\\CorsixTH (272635fd )\\Lua\\app.lua:1005: in function \n    (...tail calls...)\n    C:\\Users\\Mark\\Downloads\\CorsixTH (272635fd )\\Lua\\app.lua:906: in function . Another save where it can be replicated.\nLoad save and see litter being cleaned near to Op theatre, then by around 14th another handyman cleans the same space and the error occurs.\nFirst time I have been able to replicate and see the original litter.\nhttps://www.dropbox.com/s/fr5gi1rxwwnecpm/no%20litter.sav?dl=0. Use the same save and try and remove the litter (coke can) before the handyman gets there.   I used a nearby bench.\nThis time you get the error when the first handyman tries to sweep nothing.. The only way I can see to stop the error is to first remove the litter with an object and then pick up the handyman before he gets to that tile as this seems to cancel the cleaning call. Refer back to my last two comments @Alberth289346 \nThere is litter and somehow two handymen get the task of sweeping it around ten days apart.\nIf the first one cleans the litter the second one can't and you get an error when he tries\nIf the player removes it with an object, you get the error when the first handyman tries to clean it\nYou can only break the cycle by removing the litter and then picking the handyman up before he gets to that tile.\nWhy does picking the handyman up break the cycle/cancels the call to clean?\nHow do two handymen get the call to clear the same litter days apart?\nI agree that the system is broken, I am not sure why handymen have their own call system, it might have been that the calls dispatcher was not working as intended and this was a work around.  But I have seen two or more handymen turn up to repair the x-ray for example for some time now, doesn't throw an error though. \nI do think fixing this as it breaks the game and will be annoying to players is a must - even if it is a band aid.  The proper fix is going to be big job, I appreciate that having read through the calls dispatcher in the past.\nIf you want to attempt the big job and need help testing let me know.. Level 6 and accepted an emergency for invisibility which I have not discovered yet but can apparently treat\nError in buttonup handler: \n...ds\\CorsixTH (6)\\Lua\\dialogs\\fullscreen\\drug_casebook.lua:151: attempt to index a nil value (field '?')\nstack traceback:\n    ...ds\\CorsixTH (6)\\Lua\\dialogs\\fullscreen\\drug_casebook.lua:151: in method 'updateIcons'\n    ...ds\\CorsixTH (6)\\Lua\\dialogs\\fullscreen\\drug_casebook.lua:139: in method 'selectDisease'\n    ...ds\\CorsixTH (6)\\Lua\\dialogs\\fullscreen\\drug_casebook.lua:92: in local 'constructor'\n    C:\\Users\\Mark\\Downloads\\CorsixTH (6)\\Lua\\class.lua:74: in global 'UICasebook'\n    ...sers\\Mark\\Downloads\\CorsixTH (6)\\Lua\\dialogs\\patient.lua:322: in local 'callback'\n    C:\\Users\\Mark\\Downloads\\CorsixTH (6)\\Lua\\window.lua:682: in method 'handleClick'\n    C:\\Users\\Mark\\Downloads\\CorsixTH (6)\\Lua\\window.lua:1478: in field 'onMouseUp'\n    ...sers\\Mark\\Downloads\\CorsixTH (6)\\Lua\\dialogs\\patient.lua:228: in method 'onMouseUp'\n    C:\\Users\\Mark\\Downloads\\CorsixTH (6)\\Lua\\window.lua:1462: in field 'onMouseUp'\n    C:\\Users\\Mark\\Downloads\\CorsixTH (6)\\Lua\\ui.lua:650: in function \n    (...tail calls...)\n    C:\\Users\\Mark\\Downloads\\CorsixTH (6)\\Lua\\app.lua:906: in function \nhttps://www.dropbox.com/s/38u6qujdgv8d3jy/Level%20six.sav?dl=0\nAs clicking on the casebook icon from patient menu should open casebook on that patients illness, perhaps the solution for when you have not discovered it (emergencies) is for it to open on General Practice or better still disable the button as you would normally. i.e. when someone has not been diagnosed yet\n. One possible solution is to amend dialogs\\patient.lua from line 321 that stops the button being clicked on if it is an undiscovered disease\nfunction UIPatient:viewDiseases()\n  local patient = self.patient\n  if patient.hospital.disease_casebook[patient.disease.id].discovered then\n  local dlg = UICasebook(self.ui, self.patient.diagnosed and self.patient.disease.id or nil)\n  self.ui:addWindow(dlg)\n  end\nend\n. Look at level 1 for example, inflation room is there from the start and you discover bloaty head later in the game.  There are other levels where you have the cure before you have the disease.\nI think we had this discussion several years ago.  These are the original levels and no matter how you set things up and the times you want them to appear there will always be a player who by chance gets things out of order like I did. \nI agree on the logic for an emergency, but who can predict which patients turn up and in sufficient volume for you to discover what they have before a scheduled emergency?  There are some diseases you can't discover until you have the right diagnostic machine built.  If you set your research priorities to drugs ahead of other things you can skew any timetable the mapmaker may have intended.\nI think its best to expect such things might happen and make sure they don't cause an error\n. If I am reading the level file correctly the emergency for invisibility comes in year one between month 8 and 12 and you need the scanner to diagnose it which you don't get until month 14. They would be around the hospital from around month 5, but you could not discover what they have early enough for the emergency unless you concentrated research towards diagnostic machines and got the scanner earlier than planned.\nThere are other levels where you can cure something before it is discovered and where you can build the cure room before you know what the room is for.  The game is mad like that, the same as it is mad that when you move up a level you forget everything you discovered at your previous hospital.\nI think when this was talked about before it was on googlecode, not sure if those issues can be seen now\n. That sounds like a better option @Lego3 \n. have you looked at this? (Plays the original files without conversion, but with improved quality)\nhttps://github.com/CorsixTH/CorsixTH/wiki/Frequently-Asked-Questions#midi-music-is-too-loud-andor-volume-setting-is-ignored-ingame\nI don't know whether this is just for windows or not\n. @TheCycoONE   I would have said that it should not be allowed in either case, unless the bench was rotated.  This is purely from memory though, as the legs of those waiting would block access to the door.  If I can remember how to run TH in dosbox I will check this out.\nHaving now checked TH both of these are allowed\n\n\n. @TheCycoONE   Just looking for an old issue that I created a while back that could be related to mp3 crash.\nThis is not it, but should this have been closed given the merge in December?. Having looked at line 113 I can confirm that the operating theatre was in use at the time.\nNot sure if there is any point in loading a save as autosave failed so you would have to run the previous save for a month or more and hope it will replicate the error\nhttps://www.dropbox.com/sh/txfrpgjplakl024/AAC6903tIBwDSGnwpUPkSXtSa?dl=0. Seems to be limited to when the Operating theatre/table is in use at the time of the save as so far it has not happened again.. Not so far, but each time it came to save the op was not in use, will try a normal save later \nWhere will I find lua version?. Load this save and position yourself over the two operating theatres\nhttps://www.dropbox.com/s/y0jh4gygi4ta7k4/level%20eight.sav?dl=0\nAt end of Oct both should be just about to start operations and the error happens again,\nthe only thing I have done is change the policy to 50% for taking breaks.\nTable does not have to be being used,  just did it again with a patient walking to the screen at month end. This was when saving, there is a patient behind the screen\n\nI could not save until after the operation and the patient paid\nLua is 5.3. Also says 64bit and direct3d along the title bar\n. @Alberth289346 Is your comment meant for issue #1174 or does that save throw an error on saving?. I take it the Operating Theatre was in use?\nWith the error message I was not able to save until the room was clear and with the console message on auto save it just skips the saving part, game locks for a bit while all those \"Unhandled argument to th_getfenv\" messages are printed to the screen and then you can continue. This time it says he is queuing for GP office and did so when he was sat on bench, but he is in x-ray!\n\n. Now he is going home for some reason, but it still says queuing for GP Office. Diagnosis progress is close to 100%, although that could be down to the policy.\n\n. How often does it update?\nI thought it was more or less instant, but I started to notice it showing the wrong information so started taking screenshots.\nEdit:  After giving this some thought it should be instant.   You hover over the patient to see what he or she is doing and thinking.  If he has the exit sign you want to know why.  Is he fed up of waiting or been told that there is no more treatment. Interesting, they should do.  Especially things like going home as you need to know why. \nSpotted someone who is cured and also fed up and leaving, I don't think this should be possible.  You can leave at any point up to being treated and then you either leave cured or dead\n. Cannot replicate this.\nOne slider is meant to stop the other so they cannot pass each other.\nI move them together and can then move them back. I can replicate this if both are moved to 100%. Tested against 0.30 and cannot replicate.  From version 0.50rc I can replicate it.\nI don't have a version in between, but could download one if needed. For me it now does not save/remember your choice.\nI move the sliders and the next time I open the screen they are back in the default positions\nThis is the same with all sliders, the only choice it remembers is if you change allow to leave room. Works for me and fixes the save in the original issue. May or may not be relevant, there is an extra r in operating twice just below line113 so it reads operatring\nEdit: actually more than two, all the persistables have an extra r in operating.  Although fixing those has meant I still can't save. Could it be that you got the bin from corridor items and placed it in a room after it was built?\nEdit\nScrub that, just tried it with bin, plant and radiator and they are removed when you delete the room. Are you sure the bin was in the room, could it have been on the outside wall in the corridor?\nI have tried various ways to replicate your observation and can't.\nIf you can reproduce this, yes create a save.  You won't be able to post the save here, but you can use something like dropbox and post a link to it. If you have the auto save file from the month before we can test that. I can't replicate this following your instructions.  However I have seen this behaviour at times and have never been able to pinpoint why it happens or why it then stops. Could it be that you are using a pirated copy of theme hospital?\nI have just tried to reproduce this with Free Build mode turned on and did not have any crash. Try gog.com \nTried with tutorial mode and I don't get a crash there either although building general diagnosis is not part of the tutorial.\nRead this it could answer any questions you may have\nhttps://github.com/CorsixTH/CorsixTH/wiki/Getting-Started. What operating system do you have?\nI am not able to re-produce this, I have windows 10 and have tried standard music setup using TH midi files and also using mp3 files in user defined music folder with and without the playlist file and there are no issues for me.. @Alberth289346  I wondered whether the red line is from reputation, [scrub that thought, just looked again and that line is not red] but when I changed languages yesterday I got what you did and that was small numbers only.\nAre numbers the same in all languages?  If they are could we just use the default font from TH here?. I think the problem here are that the spaces in most cases were designed with only English in mind.  Often the translations are much longer as with English we have a greater variety of words that mean the same thing.\nOne solution I can think of is leaving these things in English and having an option where the hover text is in your chosen language.  Hover texts expand around the text so would grow to the required size.\nIf this was something that could be turned on and off so the player could decide which they prefer.  As there are already hover texts it could perhaps be hover + Ctrl for translation.\nIs this something that could be added?  @TheCycoONE  @Alberth289346 . If there was a Russian version this is not mentioned in the language file.  It should be possible to add  Inherit(\"original_strings\", 0) to your language file.  Replace the 0 with the relevant number and the game then only uses our file for missing or new strings.  We would need to work out which number to use, ours was 0, 1 for France etc. Version numbers are for released versions and the last release was 0.60.  Between released builds they have always been named as \"trunk\", we then refer to the build numbers. The zero thing was added several years ago and the reasons for it where in an issue in google code.  It was that long ago I cannot remember all the details, only it was something we came up with in the absence of any knowledgeable code writers (Edvin was in his last year at university I think, so was not around that much).  Myself and Grimdoc tried to keep things ticking over for quite a while.\nIt may not have been the best solution though.\nI think there was an issue around building rooms to fill the available space and not having the staff to make use of them i.e build two operating theatres and only have access to two surgeons.  So close one off to stop having one surgeon in each and neither of them actually working.. Your save is from 0.60.  Here is the error message running this save after around one minute\n`  Will not check for updates since this is the Trunk version.\nSavegame version changed from 111 (v0.60) to 116 (Trunk). The save was created using 111 (v0.60)\nAn error has occurred!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nC:\\Users\\Mark\\Downloads\\CorsixTH (c258bbf1 )\\Lua\\world.lua:589: attempt to compare number with nil\nstack traceback:\n        C:\\Users\\Mark\\Downloads\\CorsixTH (c258bbf1 )\\Lua\\world.lua:589: in method 'tickEarthquake'\n        C:\\Users\\Mark\\Downloads\\CorsixTH (c258bbf1 )\\Lua\\world.lua:1003: in method 'onTick'\n        C:\\Users\\Mark\\Downloads\\CorsixTH (c258bbf1 )\\Lua\\app.lua:1005: in function \n        (...tail calls...)\n        C:\\Users\\Mark\\Downloads\\CorsixTH (c258bbf1 )\\Lua\\app.lua:906: in function \nError in timer handler:\nC:\\Users\\Mark\\Downloads\\CorsixTH (c258bbf1 )\\Lua\\world.lua:589: attempt to compare number with nil\nstack traceback:\n        C:\\Users\\Mark\\Downloads\\CorsixTH (c258bbf1 )\\Lua\\world.lua:589: in method 'tickEarthquake'\n        C:\\Users\\Mark\\Downloads\\CorsixTH (c258bbf1 )\\Lua\\world.lua:1003: in method 'onTick'\n        C:\\Users\\Mark\\Downloads\\CorsixTH (c258bbf1 )\\Lua\\app.lua:1005: in function \n        (...tail calls...)\n        C:\\Users\\Mark\\Downloads\\CorsixTH (c258bbf1 )\\Lua\\app.lua:906: in function \nWarning: No event handler for timer   . I think it is connected to the decontamination room, which has two handy men and neither are repairing the machine.  As soon as it is Dec 4th the error is thrown.  Have tried to replace the machine and remove the handymen. but the room seems to be locked down.. Whilst testing with the trunk version earthquakes have seemed to be much better.  The one thing I think that is still not right is the tremor, which seems to last as long as the quake.  I suspect it is lasting one day and if we are to match TH it should be less than that, perhaps the equivalent of an hour or 1 / 24th of a day.  Is that feasible, so many ticks rather than a day?  In TH the tremor is a quick jerk of the screen to warn you an earthquake is coming. Okay, I will do some comparing with TH tp see if I can determine how long they lasted. I have not compared with TH yet but a value of 5 seems to be about right.  Just enough to warn you an earthquake is coming and not too long that it damages your machines.\nThe save below is close to a tremor if you want to test it out with that value\nhttps://www.dropbox.com/s/q4s7bwud58awu5j/tremor.sav?dl=0. I have windows 10 64 bit and the list of fonts seen in-game\n![in-game fonts](https://cloud.githubusercontent.com/assets/4965487/25196638/255f48aa-2539-11e7-9a1b-6b90c963af6d.png)\ndoes not match the list in the windows font folder\n![fonts](https://cloud.githubusercontent.com/assets/4965487/25196644/28db0c1c-2539-11e7-9d69-416fd1bd6132.jpg)\nIf the game is looking for  Font_file = windir .. pathsep .. \"Fonts\" .. pathsep .. \"ARIALUNI.TTF\"  ` as suggested then this will be why it cannot be found. So I can see the problem - why should the player have to re-name his/her font file in windows or make  a copy.\nIs this something new with windows 10?\nThe list of fonts you see in game with arial in the name is greater than seen in the windows folder.  How does the player know which one will work?  I have tried several and none have worked for me.. From the above screenshot I can now see the one I want is the tenth in the list, which I could not see in game (the above screen is slightly larger).   However I cannot see Russian as an option in game.  \n. Thanks, but where does that name come from?\nIn the language file I see Language(\"\u00d0\u00a0\u00d1\u0192\u00d1\u0081\u00d1\u0081\u00d0\u00ba\u00d0\u00b8\u00d0\u00b9\", \"Russian\", \"ru\", \"rus\")\nalthough I suppose if I spoke or read Russian I would know what it meant....\nI also looked in the config file and didn't  see anything different there either. Russian               / ru / rus\nI am just trying to understand the reasons behind the issue here, although the problem maybe in trying to find the correct font to use\nNow I have selected this the config is language = [[\u0420\u0443\u0441\u0441\u043a\u0438\u0439]]  which is not shown in the current help text in the config either\n. I can now see what I did wrong last night, I opened the language file and by default my pc used a lua editor rather than notepad.  (duh)\nI like your fallback idea\nI also think the config.txt needs to be updated to display this additional name so you can see what the available languages are, and the user could copy the relevant one including the square brackets if they chose to e.g.\n-- [[\u0420\u0443\u0441\u0441\u043a\u0438\u0439]]   Russian / ru / rus\nAs you can see, it is not obvious what you have to enter from the current instructions if you chose to edit the file manually\n\n. You have two handymen, 15 plants, 7 machines and they have to sweep as well.\nI click on the repair icon for Operating room and it is 6th in the list behind 5 watering requests.  They will get to it, if they don't quit first for being over worked.\nOr you could just hire more staff and stop being a slave driver!  For a hospital of that size I would have at least a dozen handymen, more if I have plants to water as well.. When I clicked on repair the handyman did go to repair the machine ahead of watering the plants.\nYou need to hire more handymen for a hospital of that size.. This warning is in app.lua.\nI could be wrong, but I think this is loaded before the routine that runs the translations (I think it is something that has been mentioned before several years ago)\nThere are different people involved with the programming now, so they may have some thoughts on how this could be achieved.\n@Alberth289346 @TheCycoONE . Not long, someone would need to verify that the code is good and the translations are genuine.\n. 15 x -6 = -90 (not a lot to lose if you had other reputation gains in the trophy room)\nValues are by default taken from the file with 0 and then the level file can overwrite some values\nI am not aware of depreciation being implemented as yet!\nI have never had any issues playing any of the levels.  Are you saying they are too easy or not hard enough?. Each level had to be played differently to win it and it often meant losing a few times before you got it right.  The only thing I would want to change is that there is a difference between easy, hard and full, at the moment they are the same for this trophy - which does seem odd, but this is what TH did as the awards are taken from their files. Did you then select this as your font in the game?\nYou can either do this direct in the config.txt by including the path to this font or from within one of the option menus you see before you start a game - folder locations\nhttps://github.com/CorsixTH/CorsixTH/wiki/Game-Guide#folder-locations. It is telling you that a } is missing on the line with return_to_main_menu\nEvery string of words starts with {  and ends with }, just look at the other lines of text.  Whereas any comments or information sits behind -- or  --[ which then ends with ]-- when it is more than a line of text.  Commas and the end of each line is also important.\nIf you start again with a clean file that works and replace text between the {  }, you should be fine and don't change the name of the line i.e.   return_to_main_menu as this is how this is referred to e.g. where this line appears it will show the text that is between the braces.. Change the language in game back to English and keep your chosen font should work.\nYou could try a different font if the one you use is not good.  What font does your pc use when in word or a similar package?\nWe have a forum for translations where you can ask others who are doing the same thing in other languages http://forums.corsixth.com/index.php?board=11.0 so they may know more than we do here. Could be  handled better, but the game needs to know where your files are to work correctly. From what I can see there is no clear path to the new room, which is likely the reason it crashes.  Move the cardio and staffroom to clear the path and then patients and staff will be able to get to the phyc.\n@thecycoone \nOdd thing is at one time you would not have been able to build there, so I guess that restriction was removed?  Perhaps without this blocking we used to have in place there needs to be better handling of what patients / staff do when they can't access a room?  There was an advisor message in TH that went something like \"someone is stuck, you should plan your hospital better\".  Could we have that in these instances maybe? (the stuck person could perhaps meander until they get fed up)\n. The other door/main entrance is not connected to the rest of the hospital, it would be once the nearby plot it purchased. (this is from memory).  If patients walked over lawns it would be accessible, they have to stick to pavement tiles or floor tiles in a building - which is only right really.\nIf the blocking off rules is still in place I am surprised you were able to build there\n\n. Try this, build the staff room against the dividing wall.  Buy the adjacent plot and it will allow you to build!\nVery strange bug....\n\n. I think I agree, if I have understood the intention correctly.\nThe real error here is the game throws an error because pathfinding can't calculate the distance to a blocked off area.  Perhaps it should instead give the message about planning your hospital better and meander those that cannot find a path - they will leave it is not sorted out.\nThe fact that you can sometimes build in a blocked area (like this issue) is not really an error if we work towards allowing blocked off areas and handle it in a better way.\nIs this what you are thinking? @TheCycoONE . @sebastienaubry  Glad that you can move on and finish that level and thanks for reporting. \ud83d\udc4d \nThere is an issue and this has reminded us of it. I suspect that there are going to be  a lot of places where this error is happening in one form or another i.e. new room callback, staff checking for work, patients looking or waiting for a room.\nIf you get the time to work on a solution and need a tester let me know. Can you provide the save and any log files?\nYou will have to save to somewhere like dropbox and paste a link to it here.\nhttps://github.com/CorsixTH/CorsixTH/wiki/Frequently-Asked-Questions#where-do-i-find-the-configuration-or-the-gamelog-file. If there was no game log then the game has not crashed as such and it might be a windows thing.\nWhere the game is located should not make a difference, I have mine in various places.\nWhat is D:\\ is it a second hard drive or a removable type drive?\nI'll look into the tutorial to see if I can replicate the error in about an hour. Tutorial is working fine for me, it is left click to place the Doctor, right click would cancel the hiring, no error if I right click.\nThis is the location of my game \\Downloads\\CorsixTH (060890fb)\\CorsixTH.exe.  Where it is stored should not make a difference so long as you tell the game where the original TH files are located and you have permission for that location.\nYou could have some missing TH files as that can cause the game to crash.  Have you read the FAQ's as there are some helpful solutions to common issues?\nhttps://github.com/CorsixTH/CorsixTH/wiki/Frequently-Asked-Questions#the-game-crashes-on-startup-or-after-clicking-start-game. I believe that these missing translations relate to a feature that was added after the last release and most translations are added just before a release.  The feature is to do with over and under charging.  There is a good chance that it is the same one as all such messages are once only and the treatment is added separately (which is translated).\nThe only translation needed therefore is for A patient left without paying for ## because it is too expensive. - where ## equals the name of the treatment\nDon't go hunting for more of this type because if one treatment is missing they will all be missing.  There are likely to be others for a different scenario so if I can see what they are I will paste them here. These are the most likely to need a translation and % is the place holder for the treatments which seem to be translated already:\nA patient is leaving without paying for %s. It's too expensive. \nYour charges are high. This will make big profits in the short-term, but ultimately you'll start to drive people away. \nYou're charging too little. This will bring people to your hospital, but you won't make a lot of profit from each one.. Oddly some are also in the overrides of the English file, which are not normally needed if they exist already in the TH files! The original does not include the treatment name, which might be why they are there.\n    low_prices = \"You're charging too little for %s. This will bring people to your hospital, but you won't make a lot of profit from each one.\",\n    high_prices = \"Your charges for %s are high. This will make big profits in the short-term, but ultimately you'll start to drive people away.\",\n    fair_prices = \"Your charges for %s seem fair and balanced.\",\n    patient_not_paying = \"A patient left without paying for %s because it's too expensive!\",. Fixed. @TheCycoONE \nI have always assumed that was down to amount of randomness there is in the code that would not always be repeated when loading a save and could therefore send staff or patients into a different direction.\nI could be wrong, this is just what I have assumed when trying to replicate some of the issues over the years. Is it a poor translation by Bullfrog?. So, like I suggested it was a fault from Bullfrog?  There have been many and the way to get around it could be to provide an override in our Spanish file. Build on pause was so you could take your time at the start of a level and build your hospital the way you wanted without the pressure of the timer.  Also for when you expand into new plots so the people don't get in your way when adding and moving rooms.. Is the bed (or other objects at times) appearing because the patient is walking next to it and the rendering is not taking into account there is a wall in between, so you should not see it anyway?  In the above image it looks to me that the top of the wall remains and the bits below disappear.\nI have read the wiki on rendering, but it is way above my limited knowledge, so I am only offering possibilities.. Debug patients have that icon to show they are debug patients.\nThey can move, not independently though, you click on them and then click where you want to them to go to.\nThey are not apart of the normal game play. This might be connected, but I get errors running this when I have exported the animations.  If I move the folders it creates it starts to work again.. @mugmuggy  I could be wrong, but I think you need to update app.lua to local SAVEGAME_VERSION = 118 as the current save game is 117 (I got this from the last build on appveryor)\nOtherwise your afterload won't work as intended.\n@TheCycoONE might do this at the merge stage, as it can be difficult to keep track if merges are done out of order. Can you attach your save please?. I have tested this out on a later version and it does appear to be broken as the salary offer should carry over into the next level unless you have cheated and it is no longer doing this . I am not saying you have cheated.  I explained how it should work and did work.\nLoad your save to dropbox or similar and add a link to it here. I've been looking through the code and there are other factors that affect your score/salary.\nThe number of deaths and your reputation also have an impact - look at lines 1070 ish onward.\nHowever I can't see how that would have a negative impact as it looks to me that at the very least you would get +30 each month and no more than +300.\n-- add to score each month\n  -- rate varies on some performance factors i.e. reputation above 500 increases the score\n  -- and the number of deaths will reduce the score.\n  local sal_inc = self.salary_incr / 10\n  local sal_mult = (self.reputation - 500) / (self.num_deaths + 1) -- added 1 so that you don't divide by 0\n  local month_incr = sal_inc + sal_mult\n  -- To ensure that you can't receive less than 50 or\n  -- more than 300 per month\n  if month_incr < self.sal_min then\n    month_incr = self.sal_min\n  elseif month_incr > self.salary_incr then\n    month_incr = self.salary_incr\n  end\n  self.player_salary = self.player_salary + math.ceil(month_incr)\nQuestion now is why does your salary reduce from offer at the end of one level to the end of year 1 in the next?   Perhaps there is another factor I am not aware of - this needs some investigation or input from someone who already knows the answer.\nI have compared relevant code for offer and it appears to be unchanged from earlier versions (0.4 and 0.5). I have a feeling that this is intentional ( @Lego3 ) might be able to confirm this.\nHow would the patients get diagnosed in an unstaffed room?\nYes TH did it this way, but that may have been a bug, like the one where you failed an epidemic just because a patient left one part of your hospital to go to another part.\nThe staff in a room also play a part in the speed of the diagnostic process, the higher the skill level the faster the process is.\nWhat I do think could be an improvement is if the nurse leaves the room the patients go back to the  queue.  If the nurse is ready for a break then if there is no spare nurse, patients wait outside until she comes back.. \u201call patients are magically cured when the last nurse exits the room\u201d \u2013 the room is a diagnosis room and also serves as pre-op prior to surgery so there can be no cures from this room\nThe concept of \u201cthe original behaviour would be the favoured approach\u201d \u2013 this is not strictly true.  We have been known to change TH behaviour where it was generally thought to be either a bug or could be done better.  \nCurrent CorsixTH behaviour is largely based on observations, we have never before had access to actual behaviour through decompiling.  Just because we might now know how it was being done does not mean we have to replicate it exactly.\nWe just need to agree whether there is a better way of using this room.  I think that the code for diagnosis is copied to be the same across all the diagnosis rooms, this one though should be the exception.\nAll the others have one staff member and one patient at a time, so if the staff member leaves the room or is picked up it is logical that the process is aborted.\nA ward can have multiple users as well as staff and patients stop for varying lengths of time. It should be possible for the nurse to go off and come back without the diagnosis process being aborted.  Logically though it should not be possible to diagnose everyone by just removing the nurse (the exploit mentioned above) .\nSo where a nurse leaves the room, why not pause the diagnosis clock until she returns?\nThe attributes of the nurse should affect the speed of the process as should abilities and her tiredness, otherwise you would only hire cheap staff not the skilled ones.  This might get complicated if there are staff changes throughout the process, but it should not be impossible.\n. That is somewhat realistic, there are people where I work who just wander round all day whilst others are run off their feet :) . @lewri  with those rooms if you have more than one they go to either after a break.  This can be annoying if you have one training room to train surgeons and another for psychiatrists as they end up learning both over a longer period.\nHaving an option where staff go back to their room first would be a bonus. If you were to reduce the max queue size for each room the other rooms would get used sooner too. That will be the anti spammers captcha\n. When you are testing a beta you can expect this to happen sometimes, just delete the save and start over.. From memory you need a consultant to diagnose the first one, once it is a known disease it gets easier.\nOddly you can build the treatment before something is known, but that is the same with other diseases at times\nSame in TH as well\nLowering MaxDiagDiff will make it easier, in the campaign it has a high MaxDiagDiff. Take a look at the level file for level 1 in campaign, I have a feeling you have to be lower not higher.\nJust took a look and invis is 1, which makes it easy to diagnose in that level.  Missing maxdiagdiff off a level files will mean it uses game defaults.  I would use 1 if you want to make it easy\nResearch is hard coded and not in the level file from what I remember,  what is in the level file is the ability to make everything available from the start\nHave you read https://github.com/CorsixTH/CorsixTH/wiki/Custom-Levels?\nNote also from my next comment that it says Known specifies whether it should show up from the beginning of the level and\n RschReqd how much research is required to discover the treatment room for the disease.\nI would enter 1 0 (known from start and no research needed.  Like General Practice is. Unless things have changed here are some examples from a level file\n-------------------- Disease Configuration -------------------------\nWhen a drug is researched, what effectiveness does it have\ngbv.StartRating 80\nThe following table contains all diagnoses and treatments that shows up in the drug casebook\nin the game. Known specifies whether it should show up from the beginning of the level and\nRschReqd how much research is required to discover the treatment room for the disease.\nexpertise[1].Known.RschReqd 1 0 GENERAL_PRACTICE\nexpertise[2].Known.RschReqd 1 40000 BLOATY_HEAD\nexpertise[3].Known.RschReqd 0 40000 HAIRYITUS\nexpertise[4].Known.RschReqd 0 60000 ELVIS\nexpertise[5].Known.RschReqd 0 60000 INVIS\nexpertise[6].Known.RschReqd 0 60000 RADIATION\nexpertise[7].Known.RschReqd 0 40000 SLACK_TONGUE\nexpertise[8].Known.RschReqd 0 60000 ALIEN\nexpertise[9].Known.RschReqd 0 20000 BROKEN_BONES\nexpertise[10].Known.RschReqd 0 40000 BALDNESS\nexpertise[11].Known.RschReqd 0 40000 DISCRETE_ITCHING\nexpertise[12].Known.RschReqd 0 40000 JELLYITUS\nexpertise[13].Known.RschReqd 0 40000 SLEEPING_ILLNESS\nexpertise[14].Known.RschReqd 0 30000 PREGNANT\nexpertise[15].Known.RschReqd 0 40000 TRANSPARENCY\nexpertise[16].Known.RschReqd 0 20000 UNCOMMON_COLD\nexpertise[17].Known.RschReqd 0 60000 BROKEN_WIND\nexpertise[18].Known.RschReqd 0 20000 SPARE_RIBS\nexpertise[19].Known.RschReqd 0 20000 KIDNEY_BEANS\nexpertise[20].Known.RschReqd 0 20000 BROKEN_HEART\nexpertise[21].Known.RschReqd 0 20000 RUPTURED_NODULES\nexpertise[22].Known.RschReqd 0 40000 MULTIPLE_TV_PERSONALITIES\nexpertise[23].Known.RschReqd 1 60000 INFECTIOUS_LAUGHTER\nexpertise[24].Known.RschReqd 0 40000 CORRUGATED_ANKLES\nexpertise[25].Known.RschReqd 0 40000 CHRONIC_NOSEHAIR\nexpertise[26].Known.RschReqd 0 40000 3RD_DEGREE_SIDEBURNS\nexpertise[27].Known.RschReqd 0 40000 FAKE_BLOOD\nexpertise[28].Known.RschReqd 0 40000 GASTRIC_EJECTIONS\nexpertise[29].Known.RschReqd 1 20000 THE_SQUITS\nexpertise[30].Known.RschReqd 0 20000 IRON_LUNGS\nexpertise[31].Known.RschReqd 0 40000 SWEATY_PALMS\nexpertise[32].Known.RschReqd 0 20000 HEAPED_PILES\nexpertise[33].Known.RschReqd 0 20000 GUT_ROT\nexpertise[34].Known.RschReqd 0 20000 GOLF_STONES\nexpertise[35].Known.RschReqd 0 20000 UNEXPECTED_SWELLING\nexpertise[36].Known.RschReqd 0 40000 I_D_SCANNER             DIAGNOSIS\nexpertise[37].Known.RschReqd 0 50000 I_D_BLOOD_MACHINE       DIAGNOSIS\nexpertise[38].Known.RschReqd 0 20000 I_D_CARDIO              DIAGNOSIS\nexpertise[39].Known.RschReqd 0 30000 I_D_XRAY                DIAGNOSIS\nexpertise[40].Known.RschReqd 0 60000 I_D_ULTRASCAN           DIAGNOSIS\nexpertise[41].Known.RschReqd 1 20000 I_D_STANDARD            DIAGNOSIS\nexpertise[42].Known.RschReqd 1 20000 I_D_WARD                DIAGNOSIS\nexpertise[43].Known.RschReqd 1 20000 I_D_SHRINK              DIAGNOSIS\n| Objects available | Available from the start | Strength | Available for this level | Comment\nobjects[9].StartAvail.StartStrength.AvailableForLevel 1 8 1 Inflator Machine\nobjects[13].StartAvail.StartStrength.AvailableForLevel 1 13 1 Cardiogram\nobjects[14].StartAvail.StartStrength.AvailableForLevel 0 12 1 Scanner\nobjects[22].StartAvail.StartStrength.AvailableForLevel 0 9 1 Ultrascan\nobjects[23].StartAvail.StartStrength.AvailableForLevel 0 7 1 DNA Restorer\nobjects[24].StartAvail.StartStrength.AvailableForLevel 0 11 1 Cast Remover\nobjects[25].StartAvail.StartStrength.AvailableForLevel 0 8 1 Hair restorer\nobjects[26].StartAvail.StartStrength.AvailableForLevel 0 10 1 Slicer for slack tongues\nobjects[27].StartAvail.StartStrength.AvailableForLevel 0 12 1 X-Ray\nobjects[30].StartAvail.StartStrength.AvailableForLevel 1 12 1 Operating Table\nobjects[37].StartAvail.StartStrength.AvailableForLevel 1 0 1 Projector\nobjects[40].StartAvail.StartStrength.AvailableForLevel 0 1 1 Research Computer\nobjects[41].StartAvail.StartStrength.AvailableForLevel 0 1 1 Chemical Mixer\nobjects[42].StartAvail.StartStrength.AvailableForLevel 0 10 1 Blood Machine\nobjects[46].StartAvail.StartStrength.AvailableForLevel 0 8 1 Electrolysis Machine\nobjects[47].StartAvail.StartStrength.AvailableForLevel 0 7 1 Jellyitus Moulding Machine\nobjects[54].StartAvail.StartStrength.AvailableForLevel 0 10 1 Decontamination Shower\nobjects[55].StartAvail.StartStrength.AvailableForLevel 1 10 1 Autopsy Research Machine\nobjects[57].StartAvail.StartStrength.AvailableForLevel 0 57 1 Video Game\nthe number of months before first\nvisuals[0]  1 I_BLOATY_HEAD\nvisuals[1]  21 I_HAIRYITUS\nvisuals[2]  7 I_ELVIS\nvisuals[3]  9 I_INVIS\nvisuals[4]  23 I_RADIATION\nvisuals[5]  11 I_SLACK_TONGUE\nvisuals[6]  41 I_ALIEN\nvisuals[7]  11 I_BROKEN_BONES\nvisuals[8]  12 I_BALDNESS\nvisuals[9]  5 I_DISCRETE_ITCHING\nvisuals[10] 12 I_JELLYITUS\nvisuals[11] 1 I_SLEEPING_ILLNESS\nvisuals[12] 18 I_PREGNANT\nvisuals[13] 16 I_TRANSPARENCY\nnon_visuals[0] 1 I_UNCOMMON_COLD\nnon_visuals[1] 3 I_BROKEN_WIND\nnon_visuals[2] 19 I_SPARE_RIBS\nnon_visuals[3] 31 I_KIDNEY_BEANS\nnon_visuals[4] 25 I_BROKEN_HEART\nnon_visuals[5] 18 I_RUPTURED_NODULES\nnon_visuals[6] 1 I_MULTIPLE_TV_PERSONALITIES\nnon_visuals[7] 14 I_INFECTIOUS_LAUGHTER\nnon_visuals[8] 21 I_CORRUGATED_ANKLES\nnon_visuals[9] 15 I_CHRONIC_NOSEHAIR\nnon_visuals[10] 1 I_3RD_DEGREE_SIDEBURNS\nnon_visuals[11] 31 I_FAKE_BLOOD\nnon_visuals[12] 13 I_GASTRIC_EJECTIONS\nnon_visuals[13] 6 I_THE_SQUITS\nnon_visuals[14] 9 I_IRON_LUNGS\nnon_visuals[15] 9 I_SWEATY_PALMS\nnon_visuals[16] 15 I_HEAPED_PILES\nnon_visuals[17] 18 I_GUT_ROT\nnon_visuals[18] 7 I_GOLF_STONES\nnon_visuals[19] 5 I_UNEXPECTED_SWELLING\n. @TheCycoONE I never said it was in my list.  I said if you miss it off the game uses the defaults\nTake a look at easy level 1 , unless my file is corrupted it is set as 1\nexpertise[5].Known.RschReqd.MaxDiagDiff    1   0   1   INVIS. Alien DNA do not attend other diagnostic rooms that is how it was in TH\nIt is disabled in the game by default as there are no animations for siting or using a door etc.  If you enable it you accept that they will change into men/women and then change back.  This was how it was in TH.\nYou need a consultant or a GP that is nearly a consultant/has high skills for it to be diagnosed.\nNote that there are also issues with the animations for the treatment\nIt has always been this way. @overlordchaos\nIn the campaign it is only in the higher levels and it does take a while before they get diagnosed.\nThis is why you have training rooms to upskill your doctors.\nIt can be diagnosed if you have the right staff, I have done it\n. @TheCycoONE   Would it get to one with high skilled staff?\nWhat about the slider in hospital policy, if that was set to 90% would the process end at 0.9?  . With regards to \"They really shouldn't be coming to the hospital any way except via helicopter, like in the original game - which would be a much easier fix too.\"\nThis is incorrect, if you played for long enough they did arrive as a patient in later levels, not just emergencies.\nCurrently in TH they are emergency only patients unless you opt to allow them to arrive like others and when you did opt for this there is a message that pops up telling you about the limitations or at least there was, it may have been removed in the last year or two. The same as we do now, the patient uses the door changes to normal for that action and then changes back, same with sitting down , using drinks machine etc. Most of the time you would not actually notice it as the hospitals tend to get crowded the longer you play.\nI was making lots of notes, this was when the project first started so would play on slow speeds a lot of the time. There are other missing graphics, I think females with broken bones is one where the nurse appears to jump across the room when closing the door of the machine.\nInitially these were being blocked from the game, but then were added as option where the player choses to accept this or not.\nThere are still issues with the treatment of aliens, I think that is missing the lightening bolt effect at the change back stage in the machine and then the green glow in radiation patients and the explosion when machines blow up.  I don't believe missing animations to be a reason to exclude things though \nWhen we get someone capable of animations joins us they can get fixed, until then if we accepted in TH why not now?. With regards to maxdiag diff, this was something I added many years ago, although it may have been altered since then.\nI do remember it was not easy working with something that ranges from 1 - 1000. 1 meaning in level 1 something had a chance of being diagnosed with no other rooms available and at the same time the player getting the choice to send for cure.  Then in later levels it has a much higher count and you have to use diag rooms to get it diagnosed.  It is possible I got something wrong, but it appeared to mimic TH without altering other diseases at the same time.   Hence the use of maths random :)\nI also used skill level  (I think it was that) as this was not being used at all in the game, to me it makes sense that a better skilled member of staff would get it right more often than a low skilled junior.\nIf you can see a better way to mimic TH behaviour feel free to change it. @overlordchaos \nI have been trying to replicate the freeze you mention and cannot.  So far out of three aliens the first was diagnosed straight off and the next two sent home - all by consultants.  At the moment I cannot treat the disease yet.\nAs said previously, you need consultants or highly skilled doctors to diagnose alien dna and even then not every time as there are different strains of most of the diseases in the game.  There are no machines to diagnose this, so it can only be done by a highly skilled doctor.\nThere is a slider in the hospital policy screen.  If you set this too high patients are more likely to get sent home if the diagnosis process falls below this.  Lower the slider and you are more likely to receive a fax from the doctors.  The ones that say we are 60% sure it is alien dna etc what would you like us to do.  Be warned though as this is a lottery and if you were to send them straight to cure the cure could kill the patient.  Just because it looks like something does not mean it is what you think it is.  This is why the doctors have to do a lot of training :). @overlordchaos \nIn a new game today 5 out of 5 were diagnosed without any freeze.  This was by a fully skilled consultant.\nI had the option to send to research which I did and then the treatment was discovered.  The next alien to arrive was also diagnosed by the same consultant and sent for treatment and still no game freeze.\nAs previously stated it is expected that you need a very qualified doctor to be able to diagnose this disease.  Otherwise you could staff your hospital with juniors and save a fortune.\nAttach your custom level and map, I will take a look\n@TheCycoONE in light of the discovery above from @mugmuggy we could add diagnosis room(s), although there would be no animations for this. This would then improve the chances of diagnosis, however having aliens going to a diagnosis room other than GP Office was something I never saw in TH.\nThe one room that would make sense to me is the blood machine, because apart from getting into the machine when the alien would need to switch to normal the patient is not really visible that much.. Straight off I already told you to lower maxdiagdiff, you have 900 which means it will still be hard to diagnose.  I have changed to 1\nFor first walk in a low skilled Dr did not send home and I got this fax\n \nI took a chance and the cure killed him.  I am not a Dr so should not have took the chance.  Now put a Consultant in and he has diagnosed it straight away, but he could not on the next and I got another fax - different strain to the first one - like I said above - it might look like the last patient, but he had a different strain.  I have now altered the hospital policy so that unless the Dr is 80% or more sure he will send patient home - this prevents all the faxes.\nAlien DNA is meant to be hard to diagnose, even setting maxdiagdiff to 1 makes it easier but not guaranteed on every patient.  Look at level 1 in the campaign invis is set at 1 and all that does is trigger the faxes where you have to take a chance.\nFrom what I can see the game is working as expected\nYou should not need the emergency to get aliens.  \nYou have set no goals so it is impossible to win or lose.\nI would not make a hospital that large, I did once and as soon as people tried to play it they said it was difficult to see the edges\nOnly a researcher can work in the DNA fixing clinic.  You must make sure that there is one (you have made research pointless as everything is available), so if did not hire one for this reason that will mean the clinic is not operational.  It's like having the operating theatre and no surgeons to work in it.\n. Your files updated are here https://www.dropbox.com/sh/twba7umxa33m562/AACFkLVcEoSK_EcPYwskykOEa?dl=0\ntest save is with the changed settings and everyone so far is diagnosed, no emergency they all walked in. \nHigh skilled Consultant and researchers in the clinics. You need to have a consultant to diagnose alien dna, the only other dr that can do it is one that is nearly a consultant - look at the skills bar.  The researchers I hired were just above 50% skilled.\nThat is not really a bug, that is the way it is.\nIt would be easier if we had diagnosis rooms for alien dna, but that is up for discussion.  If you want to add them for your own use you can edit the lua files, but don't ask for help here if your changes cause a crash/freeze. Have you checked the monthly autosaves\nhttps://github.com/CorsixTH/CorsixTH/wiki/Game-Guide#menu-bar. If \"prevent the abusive usage of objects to manually remove litter\" refers to placing an object over litter to remove it that is intentional to replicate how TH allows objects to clean litter. Which comes in handy with vomit waves.. I've taken a bit of a look at how TH does some of this logic, around the diagnosis progress.\nPatients are initialised with a diagnosis difficulty randomly between 1 and expertise.MaxDiagDiff for their disease\nlua\ninitialdiagnosisdifficulty = random(1, expertise.MaxDiagDiff)\nThen for each diagnostic step:\nThis difficulty value is subtracted away from the calculated diagnosis progress value each step\nlua\ndiagnosticdiff = currentdiagnosislevel - initialdiagnosisdifficulty\nThen there is a random factor calculated as: \nlua\nrandomSkill = 250 - randomRange(0,500)\nFollowed by what I'm pretty sure is\nlua\nstaffSkill = 200\nif 'staff' is Junior\n  staffSkill = -100\nThen a tiredness factor\nlua\nif staff.fatigue > gbv.VeryTired then\n  tired = -200\nelseif staff.fatigue > gbv.Tired then\n  tired = -100\nelse\n  tired = 100\nend\nI then think if the staff member is crazy tired\nlua\nquacDoc = -400\nThe room also has an influence, many have no influence, some have positive and some have a negative value, ie x-ray on invis patients. GP doesn't influence it.\nThe room factors that I can see are with values -400, -200, 0, 200, 400\nlua\nroomAdd = roomFactor(disease, room)\nAdd all these values up then add the the staff members ability level, then if that is greater than the current diagnosis level, increase diagnosis progress.\nlua\ndiagnosticdiff = diagnosticdiff + randomSkill + staffSkill + tired + quacDoc + roomAdd + staff.ability\nif diagnosticdiff > currentdiagnosislevel  then\n  currentdiagnosislevel = diagnosticdiff\nend\nIf it ever reaches 1000, they can be diagnosed.. Disease|Scanner|Blood|Cardio|Xray|Ultra|General|Ward|Shrink\n---:|---|---|---|---|---|---|---|---\nBLOATY_HEAD|400|0|0|0|0|0|200|0\nHAIRYITUS|200|0|0|0|0|0|400|0\nELVIS|0|0|0|0|0|0|200|400\nINVIS|0|400|0|-200|0|0|0|0\nRADIATION|-200|400|0|-400|0|0|0|0\nSLACK_TONGUE|400|0|200|0|0|0|0|-200\nALIEN|200|400|0|200|200|0|0|-400\nBROKEN_BONES|0|0|200|400|0|0|0|0\nBALDNESS|0|400|0|0|0|0|200|-200\nDISCRETE_ITCHING|0|400|0|0|0|0|0|0\nJELLYITUS|0|0|0|0|0|400|0|0\nSLEEPING_ILLNESS|400|0|0|0|0|0|200|0\nPREGNANT|0|0|0|0|0|0|0|0\nTRANSPARENCY|0|0|0|0|0|0|400|0\nUNCOMMON_COLD|0|0|0|0|0|400|0|0\nBROKEN_WIND|0|0|0|0|400|0|0|0\nSAPRE_RIBS|0|0|0|400|0|0|0|0\nKIDNEY_BEANS|0|0|0|200|400|0|0|0\nBROKEN_HEART|0|0|400|0|200|0|0|0\nRUPTURED_NODULES|400|0|0|0|200|0|0|0\nMULTIPLE_TV_PERSONALITIES|0|0|0|0|0|0|0|400\nINFECTIOUS_LAUGHTER|0|200|0|0|0|0|0|400\nCORRUGATED_ANKLES|0|0|400|0|0|0|0|0\nCHRONIC_NOSEHAIR|400|0|0|0|0|0|200|0\n3RD_DEGREE_SIDEBURNS|0|0|0|0|0|0|0|400\nFAKE_BLOOD|0|400|0|0|0|0|0|0\nGASTRIC_EJECTIONS|0|0|0|0|0|0|400|0\nTHE_SQUITS|0|0|0|0|0|400|200|0\nIRON_LUNGS|200|0|0|400|0|0|0|0\nSWEATY_PALMS|0|0|-400|0|0|0|0|400\nHEAPED_PILES|0|0|0|0|0|0|400|0\nGUT_ROT|0|0|0|0|400|0|0|0\nGOLF_STONES|0|0|0|200|400|0|0|0\nUNEXPECTED_SWELLING|400|0|0|0|0|0|0|0\n. If you are adding self.world.map.level_config.gbv.DisasterLaunch can you look at adding the vomit wave at the same time?\nPatients can already vomit, but from what I remember from TH it was like everyone had and it was hard to clean up.\nThere is some code in patient I think that should trigger one, but I have never seen it happen.  Logic says one would get triggered based on the current state of cleanliness, perhaps @mugmuggy can tell from TH what was being used?. It is something that could be added to custom maps in the future and map makers can update their maps. Good idea to add a fall back just in case.\nHave you decided on what the trigger is going to be or is that what the other issue is for?. So is it just random then?\nWith the boiler you said you can mitigate the chances by having more handymen per radiator, is there not something that can mitigate the vomit wave i.e. less rubbish/vomit/dead rats per tile means less or no chance and greater than a certain ratio/percentage of tiles with it is more likely to happen?. @TheCycoONE I am not talking about boiler breakdowns :)\n\"Vomit waves get vetoed by some variable also.\"\nSo I am wondering by what. I was just going to say the same, you are not meeting all the win conditions yet. Not every condition is mentioned in the briefing, best to view the status screen. What about doing this as an hover text as those only show when you hover and can expand easily ?. Does the tool tip work on hover the button or the name label?  It only needs to work from one of them and you could use the other. I have just looked at the game to see what you are doing and I can see the problem with my suggestion.\nOnly the selected language as a hover text.\nYou could widen the menu and then widen the text area of the dropdown to show the extended text. From the original issue it is clear some can't see the benefit of this, but let's suppose your pc lacks the correct font and all you see is squares or you accidently select the wrong language it is useful to see the language selected and then perhaps the English name to correct your mistake..\nYes you can correct it in config, but how may times have we had someone not know where to find it?\nTooltips is deactivated, can that be reversed so the option stated above becomes a solution?\nCan we widen the drop down to show more text?  (also suggested above)\nWhat about undo so that you can go back to the way things were?\nDoes someone have another idea?. Having an icon for insurance payments was not part of TH\nIn TH the frequency was different to how we do it,  I think each company had its own frequency - some more often than others.  In corsixth it is a standard of around three months (I think). Yes it is a flawed map, there has to be a route to the edge of the map from the start.. Perhaps the sanity check should be in the map making, maybe on save.\nYes you would get a warning if you saved the map during making it, but if on save there was a warning that it would not be playable and the same with hele-pads it would save this from happening.\nIn Settlers 3 when map making there was an option to see your map in-game.  It would be at this point the game would list all the things that were wrong with your map if you were to try and play it - is this something we could have?. @TheCycoONE   Hi I think I have found the old issue from a couple of years back.  At that time I was using mp3s for the music so the screen shots there may give a clue of what the windows error was.\nhttps://github.com/CorsixTH/CorsixTH/issues/504\nI have since stopped (due to a change of computer and losing the copies I had) using the mp3s and I have not had similar errors since - may or may not be relevant. scrub that, the screenshots linked to googlecode . As you cannot save with the jukebox open I tend to agree there won't or should not be any issues with saves. (I don't think you ever could)\nI am not sure that anyone would even notice that the music was changed from a save to loading it later and as it would only happen if you had the jukebox open at the time it is even less likely to happen. Windows 10 Home here and no problems either. What audio  system do you have?\nAre you using original sound files or other?. Have you built a reception desk and hired a receptionist?\nDid you open your hospital - timer to the bottom left of screen?\nNeed the above before you get patients and even then it takes a month or two (gives you the time to start building rooms. No response, so did this fix your problem?. I have loaded snuffit sands as a single map and could get emergencies.  Do I have the correct map? Could it be that the map is different in the campaign? . copied from CorsixTH\\Campaigns (both the map and level file) and pasted AppData\\Roaming\\CorsixTH\\Levels.\nCan you share your save and I'll test it later?. try and disable the game movies, you can do this in config.txt found in AppData\\Roaming\\CorsixTH.\nyou might be missing these files and this is why it hangs. Where elements of a map file are missing the defaults take over so look in base_config.lua to see what the default is.. As already stated you need the 0 on the last line to stop it increasing month on month,\nThere are some levels in the original campaign where a hospital can get over crowded, mainly where entrances are limited meaning all traffic end up back to the main entrance.  Here is one trick I use and that is remove reception desks until things quieten down this stops new patients entering the hospital.\nIt may be intended that the hospital gets busier to stop you wanting to stay where you are and move on.. @TheCycoONE I agree and from the same person too.\nYou can train Doctors as well as juniors and it does get quicker the more special objects there are and less people to learn.   Don't try and train high skilled Doctors as promotion will  come first and that was the same in TH\nAs always seemed comparable with TH to me, but I cannot say it is exactly the same as TH. Regarding \"I can't recall if an evacuation affected the statistics in the original \" see https://github.com/sadger/CorsixTH/issues/34  this was something we discussed when implementing epidemics and the feeling was you lose rep on sent home already so on a really busy level it would kill the game if you got stung twice if the evac also gave you a rep loss.. Are there other folders in application support?  the + usually means there are and when there isn't one it means there are no other folders, just files.. 3320 looks like an animation number to me\n. surely this should be less than 87 (< 87)?\n. @TheCycoONE  I know I am the novice when it comes to coding, but is that not the point of the afterload function \"to add new values to old saves\", not add new values to newly created saves? \n. ",
    "Lego3": "Checking the network diagram to the right, it appears not to have made it.\n/Edvin\nOn 2 November 2013 20:31, MarkL notifications@github.com wrote:\n\nWas this added in time for 0.30? I have just had an error running the\n0.30rc with a save and clicking on the progress report. see Issue #58https://github.com/CorsixTH/CorsixTH/issues/58as it was the same error as there,\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/pull/11#issuecomment-27630505\n.\n. I actually think the best forward for you now is to try to compile the game yourself...\n. The referenced pull request fixed this issue.\n. Looks good. I'm uncertain how to try pull requests before merging so I'll merge, test, and then check how I do that...\n. There is still a merge commit that should not be present in this pull request. Could someone extract the relevant parts? Or could you try once more Maarten?\n. Maybe it would be better to have two separate pull requests for speed up and transparent walls? I don't feel confident in adding the transparent walls part since disabling buying plots of land with transparent walls gets very magical for the user. It's better to wait with adding transparent walls shortcut and keep it in debug until the cause of the problem has been solved imo.\n. I tried this again, and Itake your arguments about transparent walls. However, I tried using the highest speed now, and that does not work anymore. Pressing \"5\" works just as pressing \"z\" now.\n. And there is by the way a parenthesis missing in game_ui.lua. :-P\n. Hmm, I'm unsure whether the ground_tiles folder should be included as it is right now. Maybe a folder called Graphics first or something?\n. Indeed, its own project might be what we need, should we make one within the CorsixTH organization maybe?\n. Worked just fine. :-)\n. This issue is now only tracking the music issue.\n. Thank you for your contribution. :-)\n. The reason is that all .SAM files specify time in months since the beginning.\n. Thank you for your assistance. :-) Have you had a look at recently added strings too?\n. If you notice english strings inside the game it is usually because they haven't been translated yet. You can do Ctrl + T while in the game (and in French) to get a list of not-yet-translated strings in the same folder as where the configuration file is (shortcut in the start menu if you use Windows)\n. Cleaning up among issues.\nI couldn't reproduce this either, and since we haven't heard anything in a long time I'll close it.\n. Thank you for your contribution. The License file does not have the .txt extension at the moment, but that might change again in the near future...\n. Yes, I'm sorry, but the LICENSE file still doesn't have the .txt extension. I do think we will add it back in the near future though.\n. Ok, so the .txt was added now, which means I can accept your pull request. In the future it is safer to make different pull requests when the changes are unrelated.\n. Nice to see your contribution! :-) Just one small detail though: The indentation towards the end has accidentally become 1 space instead of 2.\n. Couldn't wait any longer for someone else to accept this as we really would like to get 0.30 finished...\n. It was created because people reported that opposite behaviour, namely that they did not complain about being cold in TH, but they did in CorsixTH.\n. Indeed. For instance making sure that the adviser tells you it's cold before staff starts threatening to resign.\n. I believe the grace period was originally added just after happiness degradation from cold was introduced, to mimic the original game. In TH you could finish both level 1 and 2 without any radiators, but then it started to get harder.\n. Before it was a little of both, and especially with staff resignations \nit was drastic in the way that a single doctor could threaten to resign \nlike 3-4 times a year.\n\nOn 2016-04-05 20:37, Stephen E. Baker wrote:\n\nIs the happiness degradation too severe or is the effect of being \nunhappy too quick?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly or view it on GitHub \nhttps://github.com/CorsixTH/CorsixTH/issues/74#issuecomment-205939317\n. You can try Stephen's RC here: https://github.com/TheCycoONE/CorsixTH/releases/tag/2a04c18156dfab9136e2bf00a3512539f3727af9\n. I understand that this particular change was so very small that you could as well do it yourself, but it is usually best if someone else than the one who created the pull request accepts it.\n. Each language already has a specified english name.\n. It works just fine for me. Are you on a 32-bit system?\n. Yes\n\nOn den 2 november 2013 10:24:06, MarkL wrote:\n\nUninstall leaves mime and sockets folder, so deleted them and did\nanother install freshly downloaded - same problems.\nCompared files from installer to zip and installer has mime.lua and\nsocket.lua which are not in the zip, unless they are in a different\nfolder.\nEdvin, when you say it works for you, did you use the installer?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/85#issuecomment-27618539.\n. Very strange. I tried it on my Windows 8 laptop (where I haven't done any development) and it works just fine there too. Is your XP a 32-bit install? I suspect it has something to do with that, it's the only thing the installer does differently.\n. Both. It recognizes your configuation and then installs differing files \ndepending on 32 or 64-bit\n\n/Edvin\nOn den 2 november 2013 17:15:52, MarkL wrote:\n\nXP is 32 bit.\nWhat is the installer 32, 64 or both?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/85#issuecomment-27625174.\n. That is why I suspect it has to do with the 32-bit version. The \ninstaller probably does not copy the correct files or something. Or \nthey might be corrupt.\n\nWhere you installed 0.30, do you have the following:\nmime/core.dll\nsocket/core.dll\nLua/ltn12.lua\nLua/socket.lua\nLua/socket/http.lua\n?\nOn den 2 november 2013 17:27:14, MarkL wrote:\n\nI don't understand why for me it does not work on either PC and yet\nthe trunk does. Development snapshot works for me too.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/85#issuecomment-27625412.\n. And how large are the core.dll files?\n\n/Edvin\nOn den 2 november 2013 17:27:14, MarkL wrote:\n\nI don't understand why for me it does not work on either PC and yet\nthe trunk does. Development snapshot works for me too.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/85#issuecomment-27625412.\n. Is that the case on your XP machine too? My theory is that it installs \nthe 64-bit versions of these dlls on 32-bit systems too, which would \nexplain why it can't use them.\nTry to replace those two dlls with \"the other ones\" in the installer. \nYou can open the installer file using e.g. 7-zip and extract files from \nit.\n\n/Edvin\nOn den 2 november 2013 17:40:00, MarkL wrote:\n\n\\mime\\core.dll is 15kb and\n\\socket\\core.dll is 46kb\nshould they be the same size?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/85#issuecomment-27625711.\n. Yes, it does have something to do with checking for updates, but we still need to find the cause, in case more users encounter this too.\n. It's still luasocket that is the problem. If you use Trunk it won't \ncheck for updates.\n\n/Edvin\nOn den 3 november 2013 13:48:38, MarkL wrote:\n\nI changed line 1231 in app to local current_version = \"Trunk\"\n--self:getVersion() and I can now load and save.\nchanged it to local current_version = \"0.30\" --self:getVersion() and I\ncan't and get the error.\nCould it have something to do with version number? Although that would\nnot explain why it works for you Edvin!\nIt didn't like 0.21 either\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/85#issuecomment-27643987.\n. That also looks very much like some DLL is wrong. I won't have time to take a closer look until tomorrow though. If you want to try it you can use \"Dependency Walker\" to see which DLLs the executable needs to start successfully.\nhttp://www.dependencywalker.com/\n. What about the SDL version?\n\nOn den 4 november 2013 17:01:39, MarkL wrote:\n\nerror\nhttps://f.cloud.github.com/assets/4965487/1465972/45748b08-456a-11e3-9b9f-67f6ff9d04f9.png\nThis is what I got from the pc at work, I think this could be a DX\nissue again, so I will see if there are any updates.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/85#issuecomment-27696470.\n. Do we have any idea what causes this yet?\n. Have you added the DLLs from the Installer to the place where you run master? It all boils down to the game not being able to load the core.dlls from LuaSocket, but the question is why.\n. Yes, but that is still the same problem. If there is no socket.lua it \nwill say \"luasocket not available\" because that file is missing. Inside \nthat file core.dll is loaded, so when it is available it will try to \nload core.dll, but since it fails it will still say that luasocket is \nnot available.\n\n/Edvin\nOn den 25 november 2013 21:55:24, MarkL wrote:\n\nNarrowed it down to socket.lua\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/85#issuecomment-29241154.\n. It is indeed very strange. If you let the files be, but put \"return\" on line 1266 in app.lua so that it doesn't check for updates, does it work then?\n. Yes, we could disable it by default and instead encourage people to try if\nit works for them?\n\nI have no clue how to move forward in this issue? The issue could very well\narise for everything from 5 % to 90 % of those who download the game...\n/Edvin\nOn 26 November 2013 14:51, Stephen E. Baker notifications@github.comwrote:\n\nAs far as the 0.30 release. Should we disable the update check in the\nconfig file and press ahead (marking it as experimental), or wait for this\nto be solved.\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/issues/85#issuecomment-29293308\n.\n. For line 1266 I was refering to trunk, yes. The game does not start at \nall if you add return there?! That would make the mystery even greater. \nWhen you changed version so that getVersion returns Trunk it still \nworked right?\n\n/Edvin\nOn den 26 november 2013 20:23:13, MarkL wrote:\n\nLine 1266 (0.30rc) has local valid_url = false, if I move that down a\nline and replace it with return the game won't start at all. In the\ntrunk line 1266 is blank and falls between if current version ==\n\"Trunk\" and local success, socket = pcall(require, \"socket\"). Adding\nreturn here also means the game will not start.\nFor the benefit of Alan the issue is and as always been that I have\ninstalled 0.30rc on a windows7 and windows xp machine at home and with\nboth of them I cannot load or create saves, including autosaves with\nthe update check set as true.\nI have been able to get it working on the pc at work which is also\nwindows 7, but did have other issues which were down to installing\nover a previous version. It seems it kept some of the original files\nand one install was 32bit and the next 64 bit. At work the check for\nupdates does work, as does the game and the only issue there is with\nthe DX exe, but Stephen is aware that another file might need adding.\nWith my two pc's the only thing I can think of is my router/cable\nmodem is blocking something. If it was the firewall, it is supposed to\nask me and anyway I have turned it off, added corsix to the safe list etc.\nIf it is the cable modem, then I won't be the only person to have an\nissue as it is a pretty bog standard thing that virgin media use. I am\nnot bothered for myself as I will always know if there are updates, so\ncan turn it off and never miss it, but if it is the modem we need a\nsolution.\nWhat does not make sense to me is why is it stopping me from saving or\nloading a save. Why cannot it just say cannot check for updates and\nleave it at that?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/85#issuecomment-29323231.\n. Ah, sorry, cannot do like that apparently...\n\nOn den 26 november 2013 22:01:47, MarkL wrote:\n\nYes\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/85#issuecomment-29333531.\n. We are trying it out using the sprites Zephyris made and attached in the forum, but I'm unsure how to distribute the compiled sprite file right now. Albert or me could maybe give it to you on freenode.\n. I have been waiting for a reply from Zephyris about licensing of the new sprites, but haven't heard anything yet. Any idea how we could get in touch with him? (I suspect he doesn't log in to the forum...)\n. Sounds good. I'm unsure about iv. though. That may make it very difficult to treat all patients in time?\n. It might be some text editor \"auto correct\" thingy? That's the only thing that came to my mind.\n. Is the .md extension required? The readme is packaged in our releases too, and there the readability is not really increased by this format, so I'm not sure what is best?\n. I do find it useful here, but we'll have to decide if we still want to include the exact same readme in the release packages. We might want to differentiate them anyway, or possibly not include a readme in e.g. the Windows Installer file since it could be deemed obsolete.\n. We will stick with .txt for now, but thanks anyway for your suggestion. :-)\n. I would say it would be more logical to not have any earthquakes if there are none defined. I.e. if the map maker wants random earthquakes from the very beginning they need to specify that just as done for emergencies?\n. Maybe we could add a warning printout if that's the case, for future reference if someone has a problem?\n. Other than that, great. :-)\n. Is it possible to cherry-pick commits to another branch on the web site? My guess is no...\n. Oh my... I guess it won't happen that often to our users then. :-) \nStill good that we got that message in though. :-D\n\n/Edvin\nOn den 29 november 2013 20:40:45, MarkL wrote:\n\nSolved the issue\nI found that there was an environment variable set up\nC:\\Program Files (x86)\\Lua\\5.1\nThis may have been done by me several years ago when I first attempted\nto compile corsix myself and then gave up after months and months of\nfailures.\nremoved that variable and now 0.30rc checks for updates\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/96#issuecomment-29534406.\n. I know the feeling Mark... I think I spend like 70 % of my time with CorsixTH fiddling around with Git at the moment. :-P\n. In Lua TH.surface is called when changing resolution etc, which creates a new window. But the old window is never destroyed (THRenderTarget::~THRenderTarget() is not called).\n. This has been fixed in latest sdl2 branch. My guess is by #250.\n. This issue has now been fixed.\n. This has now been fixed.\n. This issue was fixed in the pull request referenced above.\n. This was fixed in pull request #125 \n. Shouldn't the patient dialog be closed on despawn anyway? Or is it already, but it still crashes?\n. The SDL2 branch is enough.\n. #157 should fix this issue. Particularly the Lua Console was completely broken before.\n. This was fixed in the #137 pull request.\n. We are working on integrating the Map Editor into the game, that is being tracked in #639 .\n. -D WITH_AUDIO is used to allow the game to work without SDL_Mixer, not the internal audio system of the core SDL library. SDL.audio.loaded is set in sdl_audio.cpp, which is only used if WITH_AUDIO is ON.\n\nThat said it would be even cleaner if we could do without the whole audio subsystem of SDL if WITH_AUDIO=OFF.\n. Have you looked at this anything more, TheCycoONE?\n. Closing the issue\n. Ah, sorry, I saw your comment but forgot to actually make a fix. I will try\nout some amending as soon as I have time.\n/Edvin\nOn 13 February 2014 02:41, Stephen E. Baker notifications@github.comwrote:\n\nDoesn't run, see my in line comment from 12 days ago. (I just notice it\ndoesn't tell you about in line comments).\n\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/pull/157#issuecomment-34939994\n.\n. Fixed the issue for comments now. I don't know if I did it the \"correct\" way when amending the commit though...\n. Adding Jorgen's comment here too, as it seems to have gotten lost in my --amend spree...\n\nIs there any reason to have this block? Can't we just always do it in UI:OnTextInput?\nFrom what I could make of it special keys like Escape are not handled in onTextInput, which is why I need to check in onKeyDown. At the same time onKeyDown doesn't handle modifiers, so depending on keyboard layout hotkeys such as + might need to be handled in onTextInput. /Edvin\n. I'd say that the behaviour should be the same as when the user starts editing a room with people inside. They should leave as soon as possible.\n. The DebianPackage directory and process hasn't been used for a few years, so it is indeed quite outdated. I also did it just for learning a little about creating debian packages in general (manually) so I'm quite sure I broke most standards there...\nGood that you are working on updating it. :-)\n. There are a whole lot of files added in the latest commit that I think should rather we linked than copied?\n. Thank you for your contribution :-)\nI think there are more strings for you to translate if you want to. Interested?\n. I'll close this issue, since they debug patients are only for debugging. If a deveoper wants them to be persistable that person will fix it.\n. Hi! Are you using the OSX package of the 0.30 version?\n. Just incrementing is enough. The re-compilation message will still work.\n. Ok, I'll close it then.\n. The pull request fixing this issue has been merged. I'll close it.\n. Still no news? Just as a reminder we might need to update the page https://github.com/CorsixTH/CorsixTH/wiki/Coding-Conventions at the bottom.\n. Yeah, sorry, we have just moved (bought our first apartment) so there's been a lot going on around that (it is also a brand new apartment). Then it's been a lot at work and I'm just back from my first business trip to British Airways. :-)\n. If I remember correctly complete_cell = true means that no more objects can be placed on that tile. If it is not set, like it is for fire extinguisher and bin you can place both of them on the same tile.\n. The same issue exists on Windows, though close to nobody would ever notice as there is currently no easy way to change default renderer from directx (on which it works fine).\n. The fix in pull request #297 has been merged into master.\n. Since this is supposedly fixed in SDL2 I'll close this issue now.\n. Yes, that sounds right.\n. They should be interruptable, but it takes a while because the \noperation has to finish (we don't handle that the animation ends \nimmediately) if I remember correctly\nOn den 16 augusti 2014 10:29:07, MarkL wrote:\n\n@J-Shep https://github.com/J-Shep Operations not being interruptible\nis intentional I believe, I remember this from when that room was\nfirst added.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/293#issuecomment-52387464.\n. I guess this has been fixed...\n. This has now been added to master and will be a part of the next release.\n. As we are now on SDL2 I'll close this issue. Please reopen it if the problem persists on SDL2\n. It would be really nice to squash these commits into one. What you do in your branch is 'git rebase -i HEAD~4'. Here's a more thorough explanation: http://gitready.com/advanced/2009/02/10/squashing-commits-with-rebase.html\n. Thank you very much for your contribution!\n. Very nice. :-) Originally I was waiting to get started on some kind of AI before changing the amount of patients arriving based on reputation since it would also be a matter of your reputation compared to the other hospitals'. But it's better to start off with this since AI is still far in the future...\n. By the way, since I haven't been following the whole thread, does this patch include that patients sometimes don't pay at all for their treatment if it is too expensive?\n. Is it possible to rerun Travis without doing any change to the commits?\n. Just on a sidenote, is it bad that you get announcements while the game is paused? Personally I like it. :-)\n. Is this the last thing we want to include in 0.40?\n. As mentioned in the commit message the room information dialogs are on by default in the campaign only, and when in debug mode they are off by default. Simply because in the campaign you get some rooms on each level, whereas if you were to get them each time you start a new scenario they would get very annoying. As for debugging you often play the campaign for debugging purposes, but having to turn the information dialogs off each time or continue closing them is also very annoying. At that time we had no in-game options in the config for this kind of thing (only basic sound, where to find TH and language sort of), but now it would be the better solution indeed.\n. Thank you for your contribution. :-)\n. I'm also curious as to Mark's question: How can this have changed lately?\n. The fastest pull request accept so far? :-P Happened to check if I could do anything just now and saw that the pull request was opened 15 seconds ago... Had a quick test and then accepted it. :-)\n. Sure, it's always good to have as many options as possible, everyone has their own preference. :-) Given the list Stephen put above though, especially the first bullet.\n. Since developers usually run on latest and can easily add that line themselves anyway there is no reason to delay 0.4 further to get it in imo.\n. Sure, I will try it out in a few days.\n. It still doesn't work for me. Then again I'm not entirely sure I do everything correctly either...\n. I had a deeper look at this, and I can confirm that your changes solved that particular part of my problem. The reason it still doesn't work for me is that I now get roughly the same error in the call to Mix_LoadWAV_RW in THSoundEffects::setSoundArchive. If I disable sound in cmake it works fine now.\n. I can't see how that could be possible either.\n. If someone has experienced this recently, please reopen the issue.\n. Closing from lack of more info.\n. I thought I had changed all of them... Have never seen that one up there. :-P\n. Now I think I've found them all. Please correct me if I'm wrong.\n. So far I haven't seen this type of issue when running on Windows. What I have seen though is that it sometimes can show a black frame.\n. As we have nothing more to go on, I'll close this. If it happens again, please file a new issue or reopen this one.\n. I still get an error if I have an invalid language in the config and open the options menu. The old behaviour would simply show whatever was put in config.txt\n. If you want to try out Theme Hospital in multiplayer (To see what the maps and the gameplay looks like), just shout. :-)\n. Indeed\n. If it happens it is rare and needs more info to be reproducible.\n. Keep up the good work. :-) We could add C++ support in the future. This is a good first step.\n. We could start out with methods and try it for a while, since it implies less changes. \n. In other words I presume that the instructions how to create packages on https://github.com/CorsixTH/CorsixTH/wiki/How-To-Compile#compiling-on-os-x are very outdated, right? We should either update that section or remove parts of it alltogether.\n. That list is correct, yes. But note that we are in the process of moving to SDL2 after this release, so it will need an update quite soon. I would like to split the page into a general section that then just links to Windows/Linux/Mac build pages. Right now it's hard to find \"your\" section imo.\n\nIf you want to update that page we would greatly appreciate it. :-)\n. Yes, please. :-)\nOn den 8 december 2014 22:02:34, Adam wrote:\n\nI believe I have now found the proper way of doing this using CMake\n(sadly it is MUCH easier than the solution I created, I guess I\noverlooked the simplest solution). If I was to update the CMake files\nto fix this, should I just create a pull request?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/409#issuecomment-66186560.\n. Don't forget to update the getVersion function in app.lua at some point to return the released version.\n. Will we up the savegame version just before we do the actual release? To make sure that we don't get any more changes in \"version\" 88 that still don't end up in the actual release.\n. You need to give your new python file execution rights. On Windows I don't know how it works exactly, but on Linux you just do chmod 755 file.py\n. Indeed. I went with the solution that the existing script uses.\n. Do we believe that we can close this now? I have tried a little going back and forth between resolutions and fullscreen (Windows, SDL2, uses directx). Will anyone try to run CorsixTH with OpenGL in Windows in the future?\n. In the Travis build we do pull LPEG and LFS via luarocks. Luasocket is also available there.\n. Have a look at my pull request\n. I really like this, it works great for me. :-)\n. Now it looks good to me. :-) When I run it using -debugger I am able to e.g. set a breakpoint on the first line of App:App. However, if I click to skip the introduction movie I get a \"CorsixTH has stopped working\" Windows message. Do you get this too? Is it because of some timeout?\n. I did have one. I tried it now but I currently get unrelated errors when trying to open it at all (probably wrong dlls compared to the libs during build). I might have some time tomorrow to look at it. Otherwise probably not until next week.\n. Certainly. They are on the todo list. (programming ideas in the wiki)\n. That sounds unintentional to me actually. And hard for the player to understand what is going on. Good find! I propose that you let the doctor answer calls immediately on put-down, unless there is a queue of course.\n. Sounds like a good idea. :-) \n. I cannot reproduce this error now using sdl2. Please try it out. I do however get a message in the log each time I switch: \"THMovie overlay should be deallocated before being allocated!\"\n. Do you get the message in the log though?\n. Time to have a look at this.\n. We need #1018 as well to fix this completely.\n. I put the test map I used here: https://www.dropbox.com/sh/1urn1hfvq76e61b/AAAPVCfWrz63QQlyV2jVfsgGa?dl=0\n\n1015 fixes issues when you build rooms next to expansion walls, while #1018 fixes issues when you later on buy the expansion.\n. Yes, I know. Would have looked strange to just open it though. :-P\n. Since nobody has added any info to this issue, and we have moved to SDL (mixer) 2 I'll close it. If someone experiences this again they will surely create a new jira.\n. As the old map editor has been deprecated I'll close this issue.\n. Closing. We have moved to SDL2 (i.e. a lot has happened...) and I can't reproduce.\n. I'll close this. Music plays fine on Ubuntu 14.04, and we currently don't distribute debian packages.\n. Since we no longer input individual values, but have a list instead, I'll close this. I am able to change resolution using SDL2 and DirectX...\n. True... I haven't even noticed that at the bottom...\n. I'll close this now. I can't reproduce, and so much has happened since the last comment.\n. This is also one of those issues that might very well happen, but under some very specific circumstances (the vending machine is mentioned). Given that this was reported 4 years ago I would say the one that actually encounters this issue is better of creating a new issue with more information.\n. I'll close this issue now, as we've moved to SDL2.\n. Mark, has this happened lately? It's been a long time since your last post, and we've moved to SDL2 as well.\n. It also usually works for me to have the dlls in the CorsixTH folder itself (where the Lua folder is etc - and the CorsixTH.sln file) then you get the same folder hierarchy as the installed version has.\n. I would still guess you are missing some of our dependency dll's.\nMost important is SDL2.dll, SDL2_mixer.dll and lua51.dll (or equiv), but then for movies there are 7 more.\nAs you state in a previous comment it's funny that you get your executable in that path. For me it's CorsixTH/Debug/CorsixTH.exe, counted from the top CorsixTH repository directory. And then I have all my dlls in the CorsixTH folder.\n. Are you in the chat channel?\n. I havent had the chance to update the file it checks yet. I'll do it when I get home in a few days.\n. Is the same true if it's a handyman that tries to get out as well?\n. Closing, thanks for checking through old issues!\n. Since it is possible to load sprites into the game now (and animations) I'll close this issue. The next step is to actually get some real new graphics, and to make Lua use them. I suggest that in case we need to track it here we create a new issue.\n. Ok, let's have it open for a while longer. I would just like to close the google code project to avoid people reading outdated things there.\n. As we have now moved to SDL2 and I can't really see the image supplied anymore I'll close this issue. Please open a new one if the issue persists.\n. Great. :-) I have done a little refactoring, but more is needed.\n. Has anything happened here?\n. If you mean the customize strings they have changed from s to z in the spelling.\n. Does it happen the instance when it's just about to show, or disappear? Do you have a game log or example save available?\n. If I remember correctly there's one for each original language. 0 is English, 1 French and 5 Swedish. That's the ones I remember from the top of my head. But I also remember that we discovered that some local original distributions differed somehow.\n. It might be worth including some fallback if possible. There might be some versions of Theme Hospital that lack certain sounds. We have had that issue before (I think it was the Italian original release or something that lacked a certain \"idle\" sound)\n. Have in mind also that not all distributions contained all sound archives.\n. You mean that no emergencies happen as long as an epidemic is active and vice versa, right? Could that happen in the original?\n. Did you fire a surgeon before this happened, or had one resigned recently?\n. Anyone reading this who has a tablet with Windows 8/10, and can try it out using latest version of SDL and CorsixTH? There might have been changes.\n. Yes, it would certainly be worth it for SDL2. :-)\n. Indeed. Therefore you need to add Severinsson's PPA if you want movie support. If you don't need it you can just do -D WITH_MOVIES=OFF in the cmake step. Otherwise the compile instructions link you to his site: https://launchpad.net/~jon-severinsson/+archive/ubuntu/ffmpeg\nI will possibly create a pull request for a small script for ubuntu to do everything in one go.\n. Ok, so I went ahead a created that small script. It looks like this:\nif ! grep -q \"jon-severinsson/ffmpeg\" /etc/apt/sources.list /etc/apt/sources.list.d/*; then\n  sudo add-apt-repository ppa:jon-severinsson/ffmpeg\nelse\n  echo \"Jon Severinsson's PPA has already been added on this machine.\"\nfi\nsudo apt-get update\nsudo apt-get install build-essential cmake libsdl1.2-dev libsdl-mixer1.2-dev timidity libfreetype6-dev libluajit-5.1-dev ffmpeg libavcodec-dev libavformat-dev libavresample libavdevice-dev libavutil-dev libavfilter-dev libswscale-dev libpostproc-dev libswresample-dev lua-socket\ncmake .\ncd CorsixTH\nmake\nTry to fix bug in luasocket 3.0-rc1\nsudo sed -i 's/ PROXY/ _M.PROXY/g' /usr/share/lua/5.1/socket/http.lua\nI'll add that to the compile wiki page.\n. Since I already had started on such a script I have now made a pull request about it here: https://github.com/CorsixTH/CorsixTH/pull/595\n. This has been discussed a few Times. However, using libav would require a lot of code changes, and according to some sources ffmpeg might be available in the next version of Ubuntu.\n. Closing.\n. Indeed. I might add something to the wiki or skip it alltogether.\n. Great. :-) I'll close this issue then.\n. Looks to be working good to me. I'll give it a day to let someone more try it out briefly before we merge.\n. Hmm. What do we do with this type of thing? We create a backwards compatibility fix and include it in a 0.41 release maybe?\n. Done. :-)\n. I do roughly the same actually.\n. Have you been able to produce 64-bit dlls for Windows? I haven't found any precompiled ones, and haven't managed to compile any using Visual Studio.\n. Works fine on Ubuntu though\n. I see now that I ran the wrong command prompt. Apparently the VS2013 Pro installer adds certain shortcuts to the start menu which are not the correct ones...\n. From what I can see it looks like luarocks.org is down at the moment.\n. I updated the how to compile and Windows dev pages when i merged this. I do agree with jorgenpt though. It gets harder and harder to \"do it yourself\". Thats the most annoying thing with open source in general imo. When you have to struggle for two days before it works.\n. I suspect that they have temporarily changed to pointer for luarocks.org \nto moonscript. That site has been down for a while, which is why the \nTravis builds fail at the moment. Let's hope that it's temporary at \nleast... There was a fairly good walkthrough on the old site.\n/Edvin\nOn 2015-02-08 20:25, MarkL wrote:\n\nIn the updated wiki the path is http://luarocks.org/en/Download., but \nwhen I click on it, I am taken to https://rocks.moonscript.org/. \nAlthough I can see a link there for LuaFileSystem I cannot see how to \ninstall this Lua Rocks thing on windows!\n\u2014\nReply to this email directly or view it on GitHub \nhttps://github.com/CorsixTH/CorsixTH/pull/610#issuecomment-73426750.\n. When that type of cycle appears I think the save game is \"lost\", so to speak. Has anyone encountered this issue recently, or did it go away in 0.5?\n. If we decide to create a 0.41 at some point we can always cherry-pick onto 0.40 instead. It's impossible to know in advance exactly what we will want in a 0.41 release imo.\n. I didn't manage to create 64-bit binaries for Visual Studio here either... I think I'll scrap Visual Studio soon. :-P On Ubuntu on the other hand everything worked as a charm as usual.\n. While the sound doesn't stutter anymore I get some image stuttering back and forth when running on a virtual Ubuntu machine (always had this)\n. I don't think there is anything holding it back, no. I managed to compile once I found the correct command prompt. :-P CMake still asks for postproc, which I couldn't see is a part of libav. But the game works fine without it...\n. And by the way, has SDL_mixer inclusion always been under the advanced tab in CMake?\n. The dialog looks nice to me. :-) Possibly we could suggest an e-mail address as contact info? And also possibly say somewhere that it's still good to create an issue in our issue tracker anyway.\n. Unfortunately I believe that our main issue right now is that none of us know how to create such packages...\n. Good ones that is.\n. Definitely\n. I agree\n. For the pause thing: The game is not meant to be playable while paused (a kind of difficulty mechanism). However, there is an advanced setting in the options menu that let's you tick \"play while paused\" to on. When on we should indeed show info in the dynamic bar.\n\nI would suggest to create two pull requests, one for each change.\n. One idea I had just now is that maybe the spawn rate is so low in the beginning that sometimes the number of patients for that month is simply 0? As it has a certain amount of randomness in it. Maybe we should have some kind of lower limit, like at least one patient per month, or that the likelihood of at east one patient increases for each \"0\" month?\n. Good catch. :-) Unfortunately the main reason that we didn't link directly to the issue tracker in the first place is that the original in-game font doesn't contain the forward slash or colon characters. I did however update the th-issues.corsix.org link to point to github instead. Thank you for finding it!\n. Strange. In the pull request itself it succeeded right?\n. What directory have you specified as your \"Theme Hospital directory\" in CorsixTH?\n. I'll close this issue now. I don't think we can do much here.\n. Luarocks still down apparently... This change is easy enough to test anyway. :-)\n. Started fixing comments from TheCycoONE. Still todo is m_ and most languages following the update of how introduction texts are parsed.\n. The skylink download mirror on SourceForge appears to be down or similar.\n. What does RFC stand for? I'm thinking of trying to finish this in the coming month or so. What would be most important in your opinion? Should I split it into many pull requests?\n. Okay, so I rebased onto latest master now. What do you guys think? It is still the C++ side I'm most unsure about whether it's good enough since I'm not really a C++ programmer...\n. This looks much neater indeed. :-) Does it look like it will work?\n. Excellent comments! Since I suspect that they will disappear when I push a new version I'll answer them here first. :-)\nStephen: I changed to \"= {}\" and fixed the checkinteger in the correct commit. When it comes to reinterpret_cast I basically just copied from another place it was used, so what would the line look like with a static_cast? I don't really know what really happens there... :-P\nAlberth: Added doxygen and Lua comments in (I hope) all places where I added the thing, used std::max (needed to include , that's ok right?) Also did the various small changes you mention except \"colors\" and \"to -> at\": for colors I just did like it has been done before (with that said I really would like to refactor the whole color definition mess...) so I'll leave it for now, and I believe it should be \"to\"? \"To the right of something?\" It's not at the right inside the list, but rather to the right of the list.\n. Hm, I'm not entirely sure what is the cause of the failed Travis build? Did I create a bad comment?\n. Fixed the things Alberth mentioned. For some reason the diff --check command still didn't show anything for me, but searching for tabs I found some I probably introduced. I hope I found them all anyway.\n. Ok, so the only thing left is that reinterpret_cast thing. But I can't find out what to write instead...\n. That doesn't compile for me.\nOn 23 September 2015 at 14:59, Stephen E. Baker notifications@github.com\nwrote:\n\n@Lego3 https://github.com/Lego3 Just replace the word reinterpret with\nthe word static\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/676#issuecomment-142591414.\n. Yes, that is what I copied... I'll try that out tomorrow.\n\nOn 2015-09-23 18:16, Stephen E. Baker wrote:\n\nAlso I see there are a ton of unnecessary reinterpret_casts throughout \nthis file in particular and the rest of the source in general. I'll \nwork on cleaning them up at some point.\n\u2014\nReply to this email directly or view it on GitHub \nhttps://github.com/CorsixTH/CorsixTH/pull/676#issuecomment-142651867.\n. Seems to work fine. :-) Is this getting ready?\n. That whole file really needs some refactoring, and I didn't really manage to make it much better... I was thinking that might be the next thing I do to learn more C++ at the same time.\n. I personally like to have the Shift + F10 possibility, I use it quite a lot. Maybe we could have both?\n. It depends how much functionality goes into the new shortcut. You dont always want to reload an open game etc.\n. This is because the current way of handling original texts is not optimal. My \"Custom campaigns\" pull request changes the behaviour of parsing original text blocks, if I can get the time I might try to break that pull request into smaller pieces.\n. Yes, the sentences are no longer broken like that. There is a paragraph indent now, though, that I can't decide if it looks good or not...\n. Is it because the hole spawned underneath him?\n. Can you try on the latest master? It's a long shot, but TheCycoONE has done some changes to video rendering.\n. Please try the following version: https://ci.appveyor.com/api/buildjobs/11glfp1yayhdipae/artifacts/CorsixTH/CorsixTH.zip\n. Any news here? Otherwise we'll close the issue.\n. This will come in the soon to be released version 0.60\n. Any news on this issue? Otherwise we'll close it.\n. Looks good. :-) Will make my pull request run through at least. :-P\n. Since the original issue is no more I'll close this.\n. I really like that this is being added. :-) It's one of the bigger things left after AI and Multiplayer.\n. I updated the page at https://github.com/CorsixTH/CorsixTH/wiki/Testing-Builds to more clearly state that the second build link no longer is updated.\n. Sure. :-) \n. Indeed, 7789566 does not remove any usage. I only removed a now incorrect part of the string music_warning, not the whole thing.\n. Ah, sorry. I follow updates in the ForkHub app for Android, and there the template doesn't work... so I forgot about it.\n\nThe only thing would be whether this same pull request should move the other file into the .github folder as well? (CONTRIBUTING) Or do we want README and CONTRIBUTING to stay in the root?\n. Yep.\nOn 22 February 2016 at 14:26, Stephen E. Baker notifications@github.com\nwrote:\n\n@Lego3 https://github.com/Lego3 My feeling is that ISSUE_TRACKER.md is\na clear case of a file that has no meaning outside of GitHub so it\ndefinitely belongs in .github, README.md is probably in that category too\nso if it works under .github I'll move it there.\nCONTRIBUTING.txt isn't as clear cut, I think it has just as much value\nread locally as it does in GitHub, so I'd prefer to leave it where it is.\nSensible?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/985#issuecomment-187171176.\n. I haven't done anything recently. It looks like the whole Google Code Archive is being shut down very soon.\nhttps://code.google.com/archive/\nhttps://code.google.com/archive/about\n. From what I remember you did get paid, but I'm not sure. I do remember that we added the charge for everyone in CorsixTH on purpose though.\n. It makes more sense, but as I recall it it was after the treatment in TH. Isn't the advicer message \"someone just left without paying for their treatment\"?\n. I agree to all points.\n\nOn 14 March 2016 at 13:50, Stephen E. Baker notifications@github.com\nwrote:\n\nAlright, thanks @MarkL1961 https://github.com/MarkL1961\nI'll take some time to look at how substantial the modifications will need\nto be to implement it that way. My feeling is that it will be fairly simple\nto implement.\ngoHome('over_priced') gets simplified because the patient would never be\nin a cured state when that happened. Likewise treatDisease()/treated() is\nsimplified because the patient won't refuse to pay at that step. room.lua /\ngp.lua / reception_desk will be complicated slightly where the next room is\nset, and patient will need a getNextTreatementDiseaseId() or similar.\nLocking the price from the time they leave the last room is something I'm\nmore reluctant to do - It's such an edge case that I don't think it's worth\npreserving state for. All that means is that a micromanaging player early\non could lower the price so the patient accepts it and then quickly raise\nit before they have to pay - the patient will still be unhappy (and it will\nharm reputation) about it but won't refuse to pay. I think that's\nacceptable - later in the game it wouldn't be a viable strategy anyway.\nThoughts?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/993#issuecomment-196297201.\n. Is the final price currently based on the quality of the actual staff? I\nwas wondering whether we should remove that dependency in that case. As a\npatient it would feel a little strange to just happen to get a much more\nexpensive treatment just because I went into the \"wrong\" room? Of course\nit's better for the player if he/she trains the staff if your income\nincreases later on, but the speed of treatment also increases, so it could\nbe \"overpowered\"?\n\nOn 16 March 2016 at 00:33, Stephen E. Baker notifications@github.com\nwrote:\n\nI've run into an issue with switching to the way the original does it.\n@benckx https://github.com/benckx based a lot of (half the weight) of\nthe expected price on the quality of the staff working in the treatment\nroom. Now we won't know which staff will treat the patient at the point we\nhave to decide on whether the price is appropriate.\nI plan to use the patient happiness as part of the calculation instead and\npossibly and weight more towards disease reputation. Any thoughts?\nParticularly from @benckx https://github.com/benckx as I know you did\nquite a bit of analysis on the old calculation.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/993#issuecomment-197068460\n. I am on a business trip, but I will check it out during easter.\n. Yes, so as long as we are sure there are no places that rely on hospital being set to nil we're fine.\n. I've had a look at the code, see comments.\n. Looks good to me now. Is it okay nowadays to merge even if the branch is not up-to-date given that I know what happened in the meantime and the checks passed?\n. Then it's time to get this into master. :-)\n. Thank you :-)\n. Aha, then it sounds like the root cause is #451?\n. Sounds good to me.\n. Can I merge myself in a case like this, where @TheCycoONE said ok and just wanted confirmation?\n. Is something more needed here?\n. Added all suggested changes. The Lua function gets a little longer, but it feels like it's easier to read now?\n. Made additional tweaks.\n. While this is a clear step away from the original I think it is an all-good change. :-) It was always strange why you couldnt place bins anywhere, and their purpose was unclear. Maybe we could allow litter inside rooms as well?\n. Nice! :-) Ribeiro is there twice instead of 2011-2012\n. On Windows it might be better to start saving stuff that users are supposed to easily find in e.g. My Documents?\n. Hm, this is the type of thing I mentioned in #993, evidently there are more places that rely on the hospital being set to nil than we anticipated. Would probably be good to do another search for even more places.\n. I just created it, sent an e-mail to you as well. I just took something and managed to put the wrong number as well... You can change it yourself I believe. :-)\n. Yes, to get multiplayer working the whole call system needs some additions. The same goes for when patients are about to go to the next room. Not  that it's a part of this PR, but at some point. :-) \n. I believe we only run code if it comes from our own domain CorsixTH.com. There is still a risk if that site is harmed though.\n\nThen again it would of course be better to just read something as text, not execute.\n. Yes.. I updated the pr to have localizable name and url too. I also changed the dialog to be a \"download now?\" Yes/No dialog, since the written url couldn't be clicked or selected to copy.\nWhat should the French text be now?\n. Updated French language. Still to do is to test on a 32-bit system. I will be on holiday for a few weeks now, so I might not be able to do much until the end of August.\n. As I note in the text I unfortunately don't have a 32-bit system to test\non, and I don't know anyone with it either. I do possibly have some old\nVista version somewhere that I could create a VM from, but maybe we could\neven go as far as to say that we only supply a 64-bit installer?\nOn Sep 16, 2016 02:57, \"wolfy1339\" notifications@github.com wrote:\n\n@wolfy1339 approved this pull request.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/1095#pullrequestreview-281478,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AC9lSjZ7a6KduciiT9Ri33q4bi8oea64ks5qqelkgaJpZM4I5McK\n.\n. This has worked before for the original campaign, so unless you mean individual scenarios it is a regression.\n. Each machine can only help diagnose some diseases, not all.\n. I remember that at some point illnesses from emergencies were (supposed to be) automatically discovered, so this sounds like a regression.\n. Note that the built in font is used here because paths are incomprehensible in the original Th font. It is missing slashes and colon.. Not having updated and started CorsxiTH for a while, as long as you still\nget the built-in font if you haven't specified any other font file it\nshould be fine.\n\nOn 17 October 2017 at 14:02, Stephen E. Baker notifications@github.com\nwrote:\n\nLGTM\nPing @Lego3 https://github.com/lego3\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/1262#issuecomment-337209079,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AC9lSv9qrk2ICWlnA371n9NaZXWs7H7Sks5stJc6gaJpZM4P792Q\n.\n. Sorry, a little fast there on the merge. Should of course have squashed it. Getting rusty at this.... I concur.\n. In Lua we usually don't use parentheses in if statements. This code is much more clear what is happening than the previous one-liner. Is max_bonus used still, or can it be removed?\n. Sorry I haven't looked at this earlier. I may be wrong, but I think the call should be inside the functions wageIncreaseRequests and temperatureDisplay rather than when creating the menus.\n. I think it's good to leave the sprite index numbers for smoke to make it easier for the person who decides to implement smoke? What do you think?\n. The indentation seems to be incorrect here, tabs maybe?\n. I personally prefer table_length without the s, and even though the for loop is quite fundamental in functionality it still enchances glancing readability to let it be many rows. What do you think?\n\nfor ...\n    do something\nend\n. Shouldn't this still be CorsixTH?\n. This row is very long, maybe split it into more than one?\n. Maximum_screen_size has been removed, but is not translated anew, is that intentional?\n. Great. :-) I just happened to notice when quickly scanning the file.\n. Fixed\n. A new profession in the game? ;-)\n. I would prefer to find the absolute path using something like debug.getinfo(1, \"S\").source:sub(2, -8) (gets this file's path, see other places in the code) as the current approach relies on a specific current working directory. When running through Visual Studio the cwd is different from when you run the executable itself.\n. You don't need to do this now, just a thought:\nIt would be really nice if this function was callable as soon as humanly possible. It could still be available for calls from the main menu etc, but at some point you might need to debug from the very beginning of the application. Then this would need to be done either in the App constructor, or at the beginning of App:init. It requires the config to be optional and the check for lua socket to lie earlier though.\n. Sorry if I'm too detailed now, but for consistency there should be two spaces after DEBUGGER. ;-)\n. Not that it hurts, but the last sentence is a little unnecessary?\n. Is this type of function comments recognized by Eclipse? We do have commenting standards tailored towards LDocGen (not entirely consistently used throughout the code unfortunately), but if another standard would be better for us we might consider changing?\n. Yes, that would be a good idea. :-)\nDen 5 jan 2015 14:58 skrev \"J-Shep\" notifications@github.com:\n\nIn CorsixTH/Lua/app.lua\nhttps://github.com/CorsixTH/CorsixTH/pull/439#discussion-diff-22461388:\n\n@@ -313,6 +313,39 @@ function App:init()\n   return true\n end\n+---\n+-- Initialises a Lua DBGp client and\n+-- connects it to a DBGp server so that\n+-- it can debug lua scripts at runtime.\n+-- @return error_message\n\nI could make a regular expression script to make all functions comments\nabide by the LDocGen function comment conventions.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/439/files#r22461388.\n. As long as LDocGen also recognizes and parses function comments \ncorrectly (to get http://www.armedpineapple.co.uk/cth/docs/) I'm fine \nwith either way.\n\n/Edvin\nOn 2015-01-05 16:10, J-Shep wrote:\n\nIn CorsixTH/Lua/app.lua \nhttps://github.com/CorsixTH/CorsixTH/pull/439#discussion-diff-22465101:\n\n@@ -313,6 +313,39 @@ function App:init()\n   return true\n end\n+---\n+-- Initialises a Lua DBGp client and\n+-- connects it to a DBGp server so that\n+-- it can debug lua scripts at runtime.\n+-- @return error_message\n\nI personally think the LDocGen function comment convention should be \nchanged to be the same as the LuaDoc convention I've used here because \na) Eclipse makes these multi-line comments blue where as all other Lua \ncomments are green and b) a CorsixTH programmer could start a new \ncomment line by pressing return without having to type: --!\n\u2014\nReply to this email directly or view it on GitHub \nhttps://github.com/CorsixTH/CorsixTH/pull/439/files#r22465101.\n. We accidentally got some tabs here... ;-)\n. Accidentally got two tabs here.\n. This whole file contains just tabs instead of spaces.\n. Do we know of a specific reason to set the hospital to nil, that is no longer there?\n. I like the refactorings. The code is getting cleaner and easier to read.\n. The name implies that you just count something, but nothing is returned and it's an increment. Maybe something like incrementCuredCount?\n. If we no longer set hospital to nil, is this a plausible error check?\n. As a further refactoring this could be put in something like incrementNotCuredCount? Like the countCured function\n. Future refactoring: In the spirit of having spelled out names, is messageCured too long? Or maybe even sendMessageCured?\n. Hm, the previous design thought has been that the population variable of the hospital class should be used to vary how many patients a hospital gets. Since we have no AI it is at first 25 % and then always 50 %. A map maker knows that (with some variance of course) the spawn rate for his or her \"World\" is a certain number, and then it's up to the player to get as many of those people as possible. Changing the total number of spawns based on the local player's reputation like this gets us even further painted into a corner?\n\nIt's just a matter of semantics, but I would prefer to move the local player hospital dependency down to the next row just below here, to have them in the same place, and to let the map maker dictate more closely the spawn rate.\n. No, I was thinking about \"msgCured\", but it's not a part of this pull request anyway.\n. We want a calculation like this, yes, but I still believe we want it after the AllocDelay time. It is used to let the map maker decide when the hospitals no longer have 25 % each. For instance if on a certain map you start with a very low reputation, but still want the player to get some patients the first year to build reputation fast.\n. Should we remove it in this pull request?\n. Okay. How should the method get the THMap object to call? Should it also be a part of the argument list?\n. Seems to work fine. :-)\n. No, not really. In this case it works just as well.\n. Yes, I had one go at refactoring it but wasn't satisfied so I thought I'd get some comments on it first. :-) I'll give it another go.\n. I see. I was thinking that maybe all documentation for functions should be in .h\n. Why do we return true or false if the return value is not used in the call to this function anyway?\n. ",
    "Alberth289346": "Hi,\nI am very much aware of that, in fact this pull request is for that branch (did you see the \"sdl2\" word in \"Alberth289346 wants to merge 1 commit into CorsixTH:sdl2 from Alberth289346:sdl2freegraphic..\" line at the top of this page?)\n. I tried it, and it works, but it causes too much havoc imho. I'd like to keep it as-is.\n. I needed a testing ground with sprite \"source code\", hence the sub-directory.\nI fully agree that \"ground_tiles\" is not what it should be. However, I don't know what you want here.\nA \"Graphics\" sub-directory may not be enough. There are going to be several thousands sprites, from different authors. (With different licenses??) Also, you may want to have several sizes perhaps? (Scaling a sprite versus having a sprite at the right size does make a difference in quality.)\nBesides the actual sprites, also expect source files, eg blender files and/or sketchup files (although I would personally hesitate to add proprietary closed source file formats). This quickly runs into the MB to GB range of disk requirements. Adding it as a sub-directory means you have to carry it around as part of the source code checkout.\nYou may want make it a separate branch, a separate project, or even a number of different projects.\nIn openttd, the program source code, and the baseset(s) are separate projects (although a baseset is a lot bigger I think, in the order of 40K game sprites).\nThe NewGRF game extensions are again separate projects managed by their authors. (Unlike what the name suggests, such extensions can also change game behavior. In TH context, think of adding a new disease or new treatment.\n. Fixed by adding the return type\n. The issue seems a little bigger than months.\nThere are also 'day' and 'hour' variables. Lots of code seems to be checking for a point in time by comparing day and month variables, or setting up future points in time by adding amounts to days or hours. In case of the former one then has to check for end-of-month cases, etc (earth quakes).\nA direction for this issue could be to have a central notion world.current_time measured in hours since game-start, and relate all timing and timers to that notion.\nThe simplest form of that time notion would be a single integer, but I can also imagine a table or class with several fields. A table or class would allow keeping shadow variables like month_in_year, etc for reducing cpu costs in converting.\nIt should be possible to create future points in time, and check whether points in time have already passed (a fundamental question here is how to handle different time granularities, eg how many hours is 'two days from now', if the current hour is 5 (with 50 hours in a day)).\nFinally, one should be able to get human-readable dates from it, for display.\n. I just found that #708 is caused by vomit in the room. Would that issue get resolved by your patch?\n. #708 is a crash when the game is trying to get from a built room back to blue-print by collecting the objects in the room (including some litter), and then crashing on the litter. In other words, it never reaches blue-print stage from the built room due to litter.\nTo me, that is different from clearing litter when placing a new blue-print. I mostly wonder what the relation is with this problem.\nDoes #708 happen due to a litter-accident while the room was built, or is there another way to get litter in the room? If you fix the litter-accidents while building, would problems like #708 still happen?\nAs for fixing stuff for 0.50, you seem to have many irons in the fire and time is running short. May I suggest you take out one iron at a time and deal with it completely, preferably selecting an almost ready iron first?\n. I had a go, see #922 but that failed if you reverted the room build process a few steps.\nTrying to fix that implies hacking the handyman job queue, which is a hack on top of the dispatch queue, which imho should be done by the handyman itself, but it can't due to the current action system. (Or something like that). Long story short, I wandered off from fixing this issue to rebuilding the action system :)\n. Looks like the machine was not reachable, judging by the error.\nSince the link to the save is dead as well, and the issue is quite old, I am closing this one. If you encounter it again, please make a new issue.\nfwiw, a stuck staff member means the game is already derailed, trying to do anything at that point is without guarantees that it will work. Such save games are also not useful for debugging, it needs a savegame just before things go wrong\n. Can you tell us where ffmpeg-dev has its header files, and its libraries?\nAlso, cmake should have a log of places where it looked for ffmpeg, Could you get the places that it looked for ffmpeg?\n. CMakeFiles seems to have .log files, but I can't find my ffmpeg libraries in it.\nAlso, it seems to consider other libraries as being ffmpeg. I don't know if it's working, as I have movies disabled in the config:\n-- Found AVCODEC: /usr/lib64/libavcodec.so (found version \"56.26.100\") \n-- Found AVFORMAT: /usr/lib64/libavformat.so (found version \"56.25.101\") \n-- Found AVDEVICE: /usr/lib64/libavdevice.so (found version \"56.4.100\") \n-- Found AVUTIL: /usr/lib64/libavutil.so (found version \"54.20.100\") \n-- Found SWSCALE: /usr/lib64/libswscale.so (found version \"3.1.101\") \n-- Found POSTPROC: /usr/lib64/libpostproc.so (found version \"53.3.100\") \n-- Found SWRESAMPLE: /usr/lib64/libswresample.so (found version \"1.1.100\") \n-- Found FFmpeg: /usr/lib64/libavformat.so;/usr/lib64/libavcodec.so;/usr/lib64/libavutil.so;/usr/lib64/libswscale.so;/usr/lib64/libswresample.so  \n  FFmpeg found\nThis is Fedora, maybe your libraries have a different name. (package of avdevice is however ffmpeg-devel-2.6.4-1.fc22.x86_64, so that seems to be correct)\n. I guess there is no 'before' save game any more. Also, the issue is about version 0.21, and a lot has changed since. If you find this problem again, please open a new ticket\n. the issue is still open, so no\n. @SimplyRyan  any news? If this or corsix as a whole dropped off your list, that's fine, but please let us know\n. Thanks for the labels.\nI called it a fix, because when a sprite viewer cannot display 90% of the sprites in a file to the user, I think the sprite viewer is broken.\n. It's actually about \"OnGetRowHeight()\". From the wxindows documentation ( http://docs.wxwidgets.org/trunk/classwx_v_scrolled_window.html ), I quote \"To use this class [edit: ie wxVScrolledWindow], you need to derive from it and implement the OnGetRowHeight() pure virtual method. You also must call SetRowCount() to let the base class know how many rows it should display, ...\" .\n. This PR saves the litter in a temp storage (and removes them from the world) until the final confirm, which seems like the better solution.\nHowever, saving them just like this means the callback administration of work for handymen breaks, as a handyman may try to clean the litter in the mean time.\nEither the handyman work dispatch should be changed to on-the-fly finding new work (which would also fix all the problems with broken administration of such work due to whatever reason), or this patch should handle removal of the litter from the work list of the handy men until it is clear what the fate of the litter is.\n. I don't think you'll have to worry about project management, so far there aren't enough devs around to cause any problem :)\nAs for making progress, I don't know what kind of design you have in mind. If you have a good idea in mind of what you want, great! Just ignore me :)\nIf you are struggling to find a good form, allow me to suggest one. If you don't like it, again, feel free to ignore me. Otherwise, read it, think about it, and use what you see as useful.\nA multi-player system is a big addition. From what I read here, I get a picture of a feature list, and a desire to make a proper design. (You're talking design diagrams of a finished system at some point above, not sure if that's still your plan.) Design diagrams are great, but they feel a like a bit too much for now, to me. If you make a diagram, you have to make a lot of decisions, where many of them are pretty much unclear. As a result, it's hard to make a diagram. (If I am wrong, you can stop reading here :) )\nAn alternative can be to make a design but with much less details. Maybe you could start by describing how a multi-player game works, mostly in words? Assume each player/computer is a circle, have lines representing the connections. That's the system. At this point, don't worry what each circle does exactly, only worry about the overview picture, how do these circles play a game together? What information is sent over the lines?? What is computed in each circle?? How do you keep time in sync? (all having the same time in the game?) In other words, what do you communicate over the lines?\nThink about a page of text, probably less. In other words, very short, not much detail.\nIf there are several solutions, you can describe all of them, or point out differences (hopefully not too many or it gets too complicated to understand).\nAs a next step from the communication patterns above, you can make a check for the features that you want. Basically, assume someone implemented the circles and lines system above. Now how do you provide the wanted features for each circle? What information needs to be communicated between who?\nThis works in two ways. At the one side, you get an idea of communication needs and patterns. At the other side, you roughly check whether you got all information at the right spot when needed.\nThen, you can consider what messages to send over the network in more detail, and how to handle processing and communication inside the circles.\n. Good luck from me too\n. @Lego3  can this issue be closed?\n. It seems to be a regular 'puke'. The only mystery is that it is not in the 'todo' list of the hospital for handyman. Since handyman only looks in that list for things to do, it doesn't see this vomit.\nIf you add it again by hacking the source code, the handyman promptly cleans it up.\nDid something special happen with any handyman, during the game?\n. @MarkL1961 I suspect something like that happened. I see tasks being de-assigned, but it happens in different ways at different places, which is of course suspicious.\nI am not in favor of adding a second system on top of a broken system for fixing. While things may look solved for a while, you also create a big maze with even more complicated edge cases than we currently have. I already fail at solving the current ones, let alone if I get more complicated ones.\nIn all, my conclusion is that the 'todo' list is too fragile. You make a mistake once in the code, and information gets lost forever. So I believe the solution is in ripping out the todo list completely, and making a simpler system, for example find things to do by looking around.\n. Seems like the wrong direction\n. @daiscog  do you have a savegame about this?\n. no savegame to reproduce, closing this issue, please open a new issue if you find this problem again\n. An alternative solution is to explicitly state you want to run Python:\npython ${TRAVIS_BUILD_DIR}/scripts/check_lua_classes.py\n(for most (but not all) linuces, \"python\" means you want python2, else use \"python3\")\n. This sounds like the \"vomit in room getting edited\" bug that was solved recently in #798.\nWithout stack trace or save game (from just before the occurrence), there is no way for us to decide if this is really the case. In its current state, this issue cannot be solved.\nIf you can manage to dig up more information about this problem, feel free to make a new issue and attach the information.\n. hi again, and welcome back\ngame hasn't moved much, the cyco one is working on pushing the price impact patch into shape for inclusion, I mostly do code changes while pondering about actions and killing dispatch queues. I changed the lua code style of the project, you may want to read it again.\n. I think this is the better option indeed. I would rename \"optional_params\" to just params, and describe its contents as description of \"params\", rather than faking a lot of parameters that don't exist as real argument. Ldocgen will get highly confused by this, and possibly even crash on it.\nSecondly, please split this away from the reporting system. It's a separate feature, that deserves its own PR.\n. I don't believe it is wise to add new features at the last minute, especially such a big and complicated feature with sending reports over the internet. So much stuff that can go wrong and has never been tested.\nCatching the error in the program and a window for the user is just the user front end. I don't know where you are sending the reports, but something needs to capture that traffic, and process incoming stuff, like duplicate detection, and perhaps spam or virus filtering?\nWhile I am sure the new feature won't add many new errors, I current still fail to understand how it makes it significantly better. Who is going to deal with all the new issues? It's not like we are low on open issues that we can't seem to get rid of. Do we need even more?\nSorry to sound so negative, but I'd really like to understand what this is going to solve.\n. In short, the options displayed by the fax should be computed at the moment it is opened rather than being generated beforehand. That way, new options to deal with the situation will also be mentioned in the fax.\n. That's how I read the enhancement indeed. Do you read something else?\nFor that reason, I believe that at the moment the fax gets opened for display, it should decide what to show. If you minimize the fax, change the hospital, and then open it again (re-computing what the fax show display), it will show the correct choices.\n. Lots of talk, and a few save games, but no patch outside the now dead google code.\nAside from that, afaik, getting overworked people is part of game play, I am not sure it should be fixed.\nClosing this one, please open another one if the issue happens again.\n. good enough for me\n. @TheCycoONE  @MarkL1961   how is this related to #835 (or associated PR #837 )\n. Is this done now?\n. Documenting suggested fix:\nAfter accepting the emergency, it is assumed that details of the disease are messaged along with the patient details, leading to discovery of the disease.\nConceptually, this is equal to a doctor discovering the disease in a GP, which is performed by the\nlua\nself.hospital.research:discoverDisease(patient.disease)\ncall at line 147 of gp.lua. (As found by TheCycoONE.)\nAfter accepting the emergency fax, the code should check whether the disease is known, and if not, perform the above call.. \n. \n. Confirmed in trunk\n. Autosave doesn't load in trunk any more, making reproducing a lot more tricky.\n. #279  looks related?\n. Patch nor issue description is available any more, it seems, the only page I get from google archive is \"project moved to github https://github.com/CorsixTH/CorsixTH\"\n. Screenshot is not available any more. Issue #1008 is a better one for this problem. closing\n. In issue #1063, the same error trace as above occurred; a cause for this was fixed in commit 4f3ac15 where loading a save game caused objects to disappear for walking to them, even though they are still displayed at the screen. It would be interesting to know if this commit also fixes this problem\n. Copied the last part of the game log, with the stack dump (dropped lots of \"Trying to remove nonexistant room ...\").\nWarning: Trying to remove nonexistant room build callback (function: 0000000011F6B1F0) from humanoid (table: 0000000012C9DE90).\nWarning: Trying to remove nonexistant room remove callback (function: 0000000012A76FD0) from humanoid (table: 0000000012C9DE90).\nWarning: Trying to remove nonexistant room build callback (function: 0000000011F6B190) from humanoid (table: 000000000802BE50).\nWarning: Trying to remove nonexistant room remove callback (function: 000000001029C8B0) from humanoid (table: 000000000802BE50).\nSavegame version is 72 (0.21), originally it was 72 (0.21)\nSavegame version is 72 (0.21), originally it was 72 (0.21)\nError in timer handler: \nD:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:134: attempt to perform arithmetic on field 'fatigue' (a nil value)\nstack traceback:\n    D:\\Games\\CorsixTH\\Lua\\entities\\patient.lua:134: in function 'completeDiagnosticStep'\n    D:\\Games\\CorsixTH\\Lua\\room.lua:162: in function 'dealtWithPatient'\n    D:\\Games\\CorsixTH\\Lua\\rooms\\cardiogram.lua:123: in function 'after_use'\n    ...:\\Games\\CorsixTH\\Lua\\humanoid_actions\\use_screen.lua:29: in function <...:\\Games\\CorsixTH\\Lua\\humanoid_actions\\use_screen.lua:21>\n    (tail call): ?\n    D:\\Games\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n    D:\\Games\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n    D:\\Games\\CorsixTH\\Lua\\app.lua:789: in function <D:\\Games\\CorsixTH\\Lua\\app.lua:786>\n    (tail call): ?\n    D:\\Games\\CorsixTH\\Lua\\app.lua:690: in function <D:\\Games\\CorsixTH\\Lua\\app.lua:685>\nRecovering from error in timer handler...\nError in timer handler: \nD:\\Games\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:71: Proper idle not in action_queue\nstack traceback:\n    [C]: in function 'error'\n    D:\\Games\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:71: in function 'action_queue_find_idle'\n    D:\\Games\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:225: in function 'onChangeQueuePosition'\n    D:\\Games\\CorsixTH\\Lua\\queue.lua:194: in function 'pop'\n    D:\\Games\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:245: in function <D:\\Games\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:201>\n    (tail call): ?\n    D:\\Games\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:179: in function <D:\\Games\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:129>\n    (tail call): ?\n    D:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:547: in function 'Humanoid_startAction'\n    D:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:639: in function 'finishAction'\n    D:\\Games\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:330: in function 'on_interrupt'\n    D:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:555: in function 'Humanoid_startAction'\n    D:\\Games\\CorsixTH\\Lua\\entities\\humanoid.lua:639: in function 'finishAction'\n    ...:\\Games\\CorsixTH\\Lua\\humanoid_actions\\use_object.lua:317: in function 'timer_function'\n    D:\\Games\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n    D:\\Games\\CorsixTH\\Lua\\world.lua:1023: in function 'onTick'\n    D:\\Games\\CorsixTH\\Lua\\app.lua:789: in function <D:\\Games\\CorsixTH\\Lua\\app.lua:786>\n    (tail call): ?\n    D:\\Games\\CorsixTH\\Lua\\app.lua:690: in function <D:\\Games\\CorsixTH\\Lua\\app.lua:685>\n. Savegame is not available anymore (googlecode fails to get the page of the http address). Imho OK button would be useful at several places in the GUI\n. Try to reduce the scope of the patch, better a small finished patch, than a complete solution that is never created. Sorry to disrupt the party, but wouldn't you need a proper savegame first before this is of any use?\n. Hmm. Before you go off on spending time on this, did you try reloading a game a few times, do nothing, and see how it progresses? the replay sequence is empty (so trivially reproduced), and there are no input events (also trivially reproduced).\nYou'd expect that literally everything progresses in the same way, right?\nI don't remember exactly, but I did this as part of debugging something, and iirc sometimes something different happened. It didn't affect me, so I didn't investigate it, but in your case it could be a problem.\nIf that is indeed the case, then a savegame is already not sufficient information to replay. It probably doesn't save the random generator state, or the generator is reset??\n. Euhm, I still don't understand. How does this work?\nLet's say I am a user. I load a random savegame X from the Internet or something.\nI play for some time, and save into savegame Y onto my disk. I continue playing, and then it crashes.\nWhat file do I send you?\n. No\n. @wolfy1339 any news?\n. @Dinnerbone  is the issue solved now with sdl2?\n. Autosaves/autosave11.sav does not crash for me\n. Recently fixed a bug in loading save games for overlapping objects in a room that may cause this kind of issues. Also, version is quite old, let's close this.\nPlease make a new issue when you see it happening again.\n. \nThis error? If so, that was fixed in  #760 for #759\n. Closing it now.\nIf you referred to another issue, feel free to comment here, and re-open the issue.\n. Video backend was moved to SDL2, discarding all other video backends. This renders the issue obsolete.\n. Good point, corrected message.\n. A little very late, but do you have a game log, or a save game just before the event?\nWithout a way to see what went wrong (or better, a savegame that replicates the behavior, there is very little that can be done.\n. Current version (unfinished, feel free to work further on it) https://github.com/CorsixTH/CorsixTH/tree/map_editor2\ncommit 0ff9194ceca092cbb1567071185dd6405ebf845e contains a list of known things that need to be addressed (some small, some large).\nList from MarkL above:\n- [x] 1300 Premade templates that the editor can add to the map for you in one go. Things like complete windows, complete doors, complete helipads and so on. (done)\n- [ ] 1301 An automatic command in the map editor to add patches of worn hedges in long streaks of pristine hedges.\n- [ ] 1304 An option to let the map editor automatically manage the borders for outside walkways and ponds.\n- [x] Addition by MarkL: birds eye view of your map in miniature at the side, or to have the ability to zoom in and out (may be done as well, as the new map editor is already in the game itself, but needs checking)\n. https://github.com/Alberth289346/CorsixTH/tree/map_editor3  adds copy (RMB-drag) and paste (LMB click or drag) functionality.\n- commit 197ea427fe7757c8d4235ff3258571c3bef41a44 fixes some minor problems in map editor2.\n- commit 6f33ecacc14130a7534c973c9748c55265e9205c fixes function documentation generation.\n- commit c1ece7cd6c4225fb181550245e37c3e9a8db568f could be refactored to belonging in map editor2, but not sure it's relevant enough.\n- commit 35654ecfd92624000953dab95db995832f4d8b8e should be mergeable with some other commit\n- other 4 commits add the functionality.\n. copy/paste rebased and pushed onto corsix/map_editor2 branch\n. do you have the file \"CorsixTH/Lua/dialogs/resizables/map_editor.lua\" ?\nhttps://github.com/CorsixTH/CorsixTH/blob/map_editor2/CorsixTH/Lua/dialogs/resizables/map_editor.lua\n. The error is at game_ui.lua, line 50, which says \"self:addWindow(UIMapEditor(self))\"\nThat \"UIMapEditor\" is in the map_editor.lua file, at line 41\nSo apparently, it doesn't see the new file, but it doesn't complain about it?\nI have no idea what is wrong at this time :(\n. Hmm, change \"<< 8\" to \"* 256\". What Lua version are you using?\n. Apparently, the << is new, I'll change it to \"* 256\" instead, thanks for the report\n. The mirror bit got flipped?\nI also vaguely remember seeing the c++ code doing some tile rewriting at some point. That could also be a cause.\n. All fixed\n. This was #644 and #647 (both closed unfinished), or are there other PRs ?\nDo you have plans to continue working on this?\n(If so, please add the numbers of the pull requests here, so it's easier to find them again.)\n. Perhaps spawn the first patients preferably closer to the entrance?\n. Neither 2.sav nor 12.sav crash with trunk.\n2.sav displays a fail message with or without movies\n12.sav displays a fail message or tries display a movie if enabled (which doesn't work at my system very well), but doesn't crash either way.\n. Black screen may be due to the game playing a movie and fail\n. ``` patch\ndiff --git a/CorsixTH/Lua/world.lua b/CorsixTH/Lua/world.lua\nindex ef0304f..9839c59 100644\n--- a/CorsixTH/Lua/world.lua\n+++ b/CorsixTH/Lua/world.lua\n@@ -1497,7 +1497,7 @@ function World:checkWinningConditions(player_no)\n end\n--! Process that the given player number won the game.\n---!param (integer) player_no Number of the player who just won.\n+--!param player_no (integer) Number of the player who just won.\n function World:winGame(player_no)\n   if player_no == 1 then -- Player won. TODO: Needs to be changed for multiplayer\n     local text = {}\n```\nNo time for other things now\n. just small things, looking great!\n. fixed (both uint32_t and the commit message)\nI saw more types that can be changed, but resisted the temptation to change them now :p\n:palm_tree: just for fun\n. fixed both issues\n. Added a new 'luaT_setconstant' macro the the lua/C interface code, and added the two values as constants in the 'anims' class.\n. Rebase :sparkles: seems to build :ok_hand:\n. I can confirm the crash, but it doesn't make sense :p\n. CorsixTH/SDLMain also exists TheCycoOne found, the SDLMain.h and SDLMain.m in there are also 5 years old, the CmakeLists.txt seems newer for some lines (it mentions SDL2).\nI guess someone with a Mac should have a look at this\n. Patch updated\n. I just installed all timidity and libtimidity stuff through yumex-dnf at my Fedora 22 system. It came with the fluid-soundfont-lite-patches too. After compiling current master commit: f50e626 , it played out of the box.\n. Ran a small test by building a GP office, and noticed the tile cursor jumping around in a weird way. See the attached image. The needle cursor move parallel to the wall of the GP office.\n\n. Found another issue, if you change zoom with the mouse wheel, the world moves a tile toward the bottom right. It does not matter where the cursor is in the screen, or whether you zoom in or out.\nFor best effect, turn the wheel slowly so the program can keep up and sees it as a sequence of small changes.\n. Crash when clicking the 'research' button:\n./CorsixTH/Lua/dialogs/fullscreen/research_policy.lua:113: attempt to call field 'gfind' (a nil value)\nDoesn't exist any more in lua 5.2 see http://lua-users.org/lists/lua-l/2013-04/msg00117.html\nSeems it's called 'gmatch' now (also in that link). 'ack' says there is only 1 gfind in the program.\n. Line 405 of CorsixTH/Src/th_lua.cpp, below the line\nprintf(\"boolean %s\\n\", lua_toboolean(L, i) ? \"true\" : \"false\");\nhas a TAB character in the line.\nOtherwise, it looks fine to me (looked a the combined diff from the master branching point)\n. Thanks for testing, let's open a new issue if it happens again\n. \nAs the picture shows, there is vomit inside the operating theatre. When you press 'edit', this gets added to the inventory of objects of the room.\nHowever, since vomit is not a proper room object, the sorter crashes on deciding its size.\n. That would mean your patch should be sufficient to prevent this problem for happening in the future.\nIn the mean time, I have been trying to drop the litter from the object list, but I am missing something as the program locks up whenever I try that.\n. Fixed the 4 problems in the first commit, and added a second commit with moar type changes\n. commit:f49343e  breaks strings\n. Solved pretty much all warnings. Path finder is coded too silly to even try fixing, lots of warnings from video library, and one or two warnings or so left, where I don't understand what is actually wrong.\nI played level 2, and it seems to work.\n. I added a patch for warnings 4, 11, 10, and 9. This concludes my efforts for this patch, as far as I am concerned.\n. It works now.. I just tried, and cannot reproduce it in current trunk version, commit: 41646aa but  maybe I tested it wrong.\n. fixed in commit: de27e4d\n. Travis doesn't actually build the documents (no doxygen?). Also, I changed the scp command to perform a recursive copy, that @alanwoolley may want to check.\n. Travis refuses to build the documentation, claiming \"nothing to do for target \"doc\" or something like that, currently out of ideas about a cause\n. Thanks for your help TheCycoONE.\nStuff seems to be working now, merged my temporary test fixes into the right place, but kept the improved error reporting that I added while diagnosing the problems as it also fixes a bug in the write call (only lua 5.2 promises that it will return the file handle).\nI haven't heard whether the scp command was correct with the 'recursive' flag, and the different target directory (nor was I able to test that).\n. And Travis fails again, as I added 'have lua interpreter' into 'lua found', and apparently, 'lua51' install doesn't add lua in a way that I expect :(\n. Works, use 'cmake -DLUA_PROGRAM_PATH=/path/to/your/lua' to build docs for lua.\n. - Added the 'add_dependencies' as part of adding the sub-targets, which is indeed much better.\n- I added the duplicate 'if (DOXYGEN_FOUND)' conditions, so each target was independent, but removed them now (now 1 block for adding all doxygen targets).\n- doc/index.html is indeed written during 'cmake .' run. Initially based on the idea of having a static-like file although this file is not retrievable from 'git' or by 'make'. I attempted to find a solution for it, but found that it's impossible to output literal text to a file as part of the build itself (ie in a target). As writing a program to generate that text seems a bit overkill, I left it as-is.\n. It's not ldocgen, it's luajit\n\n$ cd doc\n$ /usr/bin/lua ../LDocGen/main.lua\n$ /usr/bin/luajit ../LDocGen/main.lua \n/usr/bin/luajit: ../CorsixTH/Lua/strict.lua:66: module 'lpeg' not found:\n        no field package.preload['lpeg']\n        no file './lpeg.lua'\n        no file '/usr/share/luajit-2.0.3/lpeg.lua'\n        no file '/usr/local/share/lua/5.1/lpeg.lua'\n        no file '/usr/local/share/lua/5.1/lpeg/init.lua'\n        no file '/usr/share/lua/5.1/lpeg.lua'\n        no file '/usr/share/lua/5.1/lpeg/init.lua'\n        no file './lpeg.so'\n        no file '/usr/local/lib/lua/5.1/lpeg.so'\n        no file '/usr/lib64/lua/5.1/lpeg.so'\n        no file '/usr/local/lib/lua/5.1/loadall.so'\nstack traceback:\n        [C]: in function 'fn'\n        ../CorsixTH/Lua/strict.lua:66: in function 'require'\n        ./c_tokenise.lua:21: in main chunk\n        [C]: in function 'fn'\n        ../CorsixTH/Lua/strict.lua:66: in function 'require'\n        ../LDocGen/main.lua:47: in main chunk\n        [C]: at 0x004044d0\n\nNote that luajit is lying here, if I add ./lpeg.so, it still claims it doesn't exist.\nEDIT: What is a feasible command-line for luajit?\n. Fixed the LDocGen script as suggested (thanks TheCycoONE), docs are now generated out of source. Reverted movement of the LDocGen/output data files by timdiels, and added copying of them in the CMakeLists file.\n. 'ls' lists the doc data, so that seems to work too\n. Fixed name coding style (renaming method names only), travis fails on apt-get, but it compiles locally, as did travis the previous time.\n. Done!\n. You don't expect us to know what it is eh? :)\nhttp://moonscript.org/ it's a language built on top of lua, and can be compiled to lua 'on the fly'.\n. Can you explain why we would want to support Moonscript, and how you envision that in this project??  Suggesting something is one step, but without feasible plan, it's not going to fly.\nI agree with you that Lua isn't ideal, but we have 90,000+ lines of it. Also, there are some non-standard Lua parts in the project, eg our own class definition, etc. How do you suggest to handle that?\nI can see two possible directions for adding Moonscript.\na) Rewrite all to Moonscript.\nCurrently there are a number of Lua developers active, and 0 Moonscript developers. What you'd need is 2-3 very good Moonscript developers to rewrite the code base. Finding such people will take a year, and assuming you find such people, they need 2-3 years rewriting existing code. Besides the questionable assumptions (good Moonscript developers that are bored enough to switch to CorsixTH, and rewrite 'bad' Lua code to Moonscript code for 2 years?), there is little anyone else can do. Coding further in Lua is pointless, and it will be at least a year after finding a Moonscript developer, before some Moonscript-ish would work.\nEffectively, the project won't move forward for at least 3 years in optimistic estimation. Most people call that 'dead project'.\nThe best chance for this to work, is to make a new project 'MoonTH' or so, and start from there. However, if you're going to rewrite from scratch (using existing Lua code as inspiration), I wouldn;t pick Moonscript, but eg Python.\nb) Have some blend of Lua and Moonscript.\nIn order not to get completely out of hand, the existing Lua class things in the project must be compatible with whatever Moonscript uses and assumes. Without it, you won't be able to derive a new Window class from the existing Lua window base class, for example, or a Lua developer can't access some data from the Moonscript object.\nI severely doubt that would work out of the box today. Demonstrating compatibility is the first step before even considering this blend idea.\nAssuming the compatibility issues can be solved, you're facing a project with parts in C++, parts in Lua, and parts in Moonscript. As the recent exercise in upgrading to Lua 5.2 and 5.3 has proven, tracking upstream changes is a major pain in the behind, adding Moonscript won't help there.\nHow does a Lua developer operate in such a project? He can make some changes, but some of the things he needs don't work as he wants in Moonscript. He needs a Moonscript colleague to give him a hand. A Moonscript developer has the same problem, but the other way around.\nYou get a quite fragmented amount of code, where some parts become \"don't touch it, it's another language\". You already see this happening with C++, and C++ code is very very tiny, sitting at the edge of the project.\nMany contributors in this project have troubles enough understanding one language. Adding a second language, with different syntax and ideas, doesn't really help, I think.\nI don't see an easy way to migrate or merge Moonscript into the project. The directions I can see lead to a rewrite of everything (death of CorsixTH as we know it), or to some fragmented  multi-language code base, which is horrible to work in for many but some very good Lua/Moonscript developers.\nWhile the process of migration itself looks quite non-feasible to me, at this moment (if you see other ways, please explain them), let's assume for a moment one could successfully merge Moonscript in some way. What would it bring us?\nBasically Moonscript is a layer on top of Lua. It's strongly influenced by functional programming. It brings fancier syntax and language constructs (to the point of shooting itself in its own feet and introducing weird syntactic restrictions), and classes. While the details of classes are likely to differ between Moonscript and our implementation, they basically exist in the project, and are in use already.\nThe fancier/more-compact syntax is nice for local simplification of the code, but our main problem is large scale programming rather than small scale programming.\nMoonscript doesn't seem to add much there that isn't already dealt with by moving data into objects.\nIn all, while Moonscript is a nicer language than Lua, I fear migration is going to be very painful at least, and the main benefits seem to be a little cleaner code at local scale, while dragging in yet another core third-party dependency.\nIs there something I missed here? Am I totally wrong somewhere?\n. Hi driverpt,\nI wrote my post as a first analysis of what would happen if you tried to integrate Moonscript into the project. You have 90,000 lines Lua, a bunch of Lua and a few C++ developers, and you want to use or integrate Moonscript. How to do that?\n(sort of a first exploration in that aera)\nIf your suggestion is going to fly, there has to be a clean road from 'now' to having Moonscript in the project. The question is thus, what roads to exist, and how clean are they?\nA common way to find roads is to list a few, imagine what would happen if you take the road, and then see if you can wipe the obstacles away from the road (or get around them).\nWhen I find a problem on the road, and I can't see an immediate way to get rid of it, I jump to my next tactic, which is analysis of the problem itself. Trying to solve a problem without understanding it is useless I think. It costs lots of effort, and you get nowhere. It's much more effective if you first work towards understanding why the problem is a problem, so you can look for an opening to attack it in its heart.\nThe first step in analyzing a problem is to identify what it is exactly what we are going to attack. That is, find agreement on that the problem really exists on the road, and if so what its shape is, and how it affects the road we want to go. For us to agree, we need to have a as clear as possible description. The best way (in my view) to do that is to call the ugly things by their ugly names. I believe it is essential to do, especially to hard problems like these.\nSo yeah, I was being aggressive. Not to you, but to the problems, trying to expose them as clearly as I can. After identification, one can move forward to talking about them, discussing, seeing if there are ways to make it work.\nIf you feel I am making unfair estimates or I am incomplete, please explain how my reasoning is wrong. I don't want a flamewar, I want to get an understanding of the problems we will encounter by exchanging views, trying to find out where we agree and where we don't agree (and why). If you can convince me by reasoning, I have no problems saying I was wrong.\nI was not offended at all by your suggestion, in fact, I'd love to get rid of Lua. I think 90,000 lines Lua without typing information in any form is a nightmare.\nHowever, no matter how much I want that, I must also have a road to the better alternative that everybody in the project is happy about. Having a closer look at the problems here will likely give useful insights into that, even if Moonscript turns out not to be the solution.\n. Config file misses the initial / before \"usr\", so it searches the font relative to your home directory rather than from the root of the file system.\n. Yep, that was my conclusion too. Apparently, CorsixTH needs to learn about / being special.\n. I don't think this will happen at all.\n. It looks to me like a few commas are in a weird place, but much better now.\nThanks!\n. Code looks fine to me, and it works at my Linux system.\n. Looks good\n. Removed the bReuseContent, and squashed all commits into one\n. I once reported a bug that the game sent people to the operating theatre without having staff for it, and got as reply that it was correct behaviour.\n. https://code.google.com/p/corsix-th/issues/detail?id=1018&can=1&q=reporter%3AAlberth289346\n. Moved the self.available_rooms initialization out of initRooms (and renamed to getRooms).\n. done\n. With commit:12d35845f8a60b5e8c24ba4db2d144cf79b33039 the game does not crash any more. Instead it removes diseases that cannot be treated.\nTo avoid such surprises for a level designer, the level editor should warn about it, or prevent this situation from happening at all.\n. My first idea would be to disable the treatment as option for the disease.\nIf that is not feasible, or removal of the treatment makes the disease non-treatable, then disable the disease.\nThe level editor should check, and refuse it, avoiding new levels to be created. The game should be quite silent about the removal in general imho, a user cannot fix it, and refusing to play is generally bad. That keeps the existing levels playable.\nIf a level designer disables treatments, he clearly doesn't mean the treatment to be available, thus silently discarding it is in line with his ideas.\nUntil the level editor is fixed, a warning before the removal may be useful to alert the level designer.\n. Maybe this is another issue? Researching a room which is eventually not buildable doesn't sound very useful\n. Addressed in #770 \n. The problem is most likely that \"Specialisation\" doesn't say \"All done\", it's at 100%, yet the tooltip says \"No research is being done here\".\n. You ignored a VIP invitation too often, and he decided to come anyway.\n. \"choice\" and \"choices[i]\" are not the same, due to the \".choice\" selection which is also done in the former case.\nFurther inspection by TheCycoOne also revealed the change should not break savegames, as no new local variables were used in callback functions (the 'i' already existed, so the new code can resolve the function result in the old environment).\n. Untangled things a bit further. 'initRooms' decides about rooms, and delivers info about all rooms. 'initLevel' derives diseases (through world), hospitals use room info and diseases to initlialize themselves.\nAlso changed unused loop variables by _ here and there.\n. There is no diagram, and I wouldn't be able to make one quickly either.\nC++ side of things is in CorsixTH/Src. Lua interface is in _lua_cpp files, with gfx, anims, and sdl being obvious candidates. Lua instantiates the class, and manages its lifetime.\nAt the CorsixTH/Lua side, everything is an animation, app or world.lua instantiates the class, and manages (I don't know how exactly) the running animations.\nFor further detail questions, I'd suggest you use the google forum or perhaps IRC, as that is a better place to discuss such topics.\n. the bad configuration got probably written to the configuration file, and it tries now to switch to that resolution every time you start the game, since by default it picks the resolution from the configuration file.\nhttps://github.com/CorsixTH/CorsixTH/wiki/Configuration-File  explains where to find it\nYou can either edit the file with an ascii editor and fix the resolution (and perhaps the fullscreen setting?) or delete the file, and the game will make a new one, just like the first time you ran the program\n. CorsixTH/Lua/options.lua, line 87 says \"{text = \"1366x768 (16:9)\",  width = 1366, height = 768},\" so it seems the resolution is hard-coded. Perhaps something goes wrong in verifying your machine can actually handle the resolution that you select.\n. Paths have to be exactly correct to work.The leading / is crucial, as is having no spaces between the path and the [[ and ]] brackets.\nAn easy way to test paths is to 'ls' them in a shell\nls -l /usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc\nwhere you copy the file path from with a paste, so you don't make typing errors.\nIf the path is right, you'll get a line telling you owners, and size of the file. If the path is wrong, you'll get an error saying the file doesn't exist.\n. That shouldn't happen, something goes wrong in the path handling thus.\nThanks for reporting.\n. Thanks for the report, that problem was found recently, and has been fixed in #803. It will should work in the next release.\nHave fun playing! :)\n. Because current sound cards cannot deal with MIDI any more, so the software needs to convert it to sounds for them\n. Yes I know OpenTTD, I rewrote the Gui sytem of it :p \nLike CorsixTH, also OpenTTD relies on external soundfonts to convert the MIDI to samples that the soundcard can play.\n'yum' acknowledges this fact with the dependency. If you build from source, you can specify the sound font library (libtimidity). If you don't do that, you won't have music.\nThe only reason your 11MB file works is because you already installed soundfonts previously, eg with your 'yum' command to install the openttd version from the distribution.\nAs for MP3, there are some licensing problems with mp3, so many Linux distributions refrain from distributing that software (although often third-party repositories fill that gap). This is probably the reason why your mp3 cannot be played.\n. Good point about the CONTRIBUTING.TXT\nCopied the stack dump for easier access, can't upload the savegame unfortunately.\nThanks for the report.\nWarning: Trying to remove nonexistant room build callback (function: 00000084F8448530) from humanoid (table: 00000084FD43C260).\nWarning: Trying to remove nonexistant room remove callback (function: 00000084814C38B0) from humanoid (table: 00000084FD43C260).\nWarning: Trying to remove nonexistant room build callback (function: 00000084FE034450) from humanoid (table: 00000084FE698B30).\nWarning: Trying to remove nonexistant room remove callback (function: 00000084FD82BAD0) from humanoid (table: 00000084FE698B30).\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\entity.lua:118: Suspected infinite loop\nstack traceback:\n    [C]: in function 'error'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:797: in hook '?'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:118: in method 'setTile'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:174: in method 'setTilePositionSpeed'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:175: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:137>\n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:575: in upvalue 'Humanoid_startAction'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:651: in method 'queueAction'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\meander.lua:94: in field '?'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:575: in upvalue 'Humanoid_startAction'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:667: in method 'finishAction'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:152: in local 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:218: in field 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:149: in method 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1121: in method 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:878: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:875>\n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:779: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:774>\nRecovering from error in timer handler...\nError in buttonup handler: \nC:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:60: attempt to call a nil value (local 'timer_function')\nstack traceback:\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:60: in local 'on_interrupt'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:638: in method 'setNextAction'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:421: in method 'onClick'\n    C:\\Program Files\\CorsixTH\\Lua\\ui.lua:626: in function <C:\\Program Files\\CorsixTH\\Lua\\ui.lua:609>\n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:779: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:774>\nSavegame version is 102 (Trunk), originally it was 91 (0.40)\nSavegame version is 102 (Trunk), originally it was 91 (0.40)\nSavegame version is 102 (Trunk), originally it was 91 (0.40)\nSavegame version is 102 (Trunk), originally it was 91 (0.40)\nError in buttonup handler: \nC:\\Program Files\\CorsixTH\\Lua\\room.lua:699: attempt to perform arithmetic on a boolean value\nstack traceback:\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:699: in method 'tryToFindNearbyPatients'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:673: in function <C:\\Program Files\\CorsixTH\\Lua\\room.lua:655>\n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:859: in method 'markRoomAsBuilt'\n    C:\\Program Files\\CorsixTH\\Lua\\dialogs\\edit_room.lua:245: in local 'callback'\n    C:\\Program Files\\CorsixTH\\Lua\\window.lua:664: in method 'handleClick'\n    C:\\Program Files\\CorsixTH\\Lua\\window.lua:1445: in field 'onMouseUp'\n    C:\\Program Files\\CorsixTH\\Lua\\dialogs\\place_objects.lua:454: in function <C:\\Program Files\\CorsixTH\\Lua\\dialogs\\place_objects.lua:453>\n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\window.lua:1429: in field 'onMouseUp'\n    C:\\Program Files\\CorsixTH\\Lua\\ui.lua:622: in function <C:\\Program Files\\CorsixTH\\Lua\\ui.lua:609>\n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:779: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:774>\n. Don't think trapping is an actual problem. If they can't go out, patients can't go in, and you're paying their salary.\n. @Lego3  is this solved now?\n. File of aug 7 reproduces in trunk commit a54ddfa a set of images:\n\n\n\n\nFallen patient seems to be woken again (does the reaper do that??), and trying to visit the cast remover, except he has no cast. Animation that is searched is \"anim_set = Standard Male Patient - Nurse\", while only \"Standard Female Patient - Nurse\" and \"Alternate Male Patient - Nurse\" animations exist.\n. No, the animation thing is with the nurse, he stands up, knocks on the door and gets into position as shown in the last picture.\nInteresting theory though, the pathfinder probably cannot find a path to walk to the hole, so he tries his last thing again or so?\n. Hi again!\nNope nobody works on this.\nI did see some fuzzy code in the grim reaper action when there wasn't enough space. I now think the dead person is trying to move into the hole by first going to a tile a bit west of it (in the room), but I haven't looked into it.\n. In Lua/entites/vip.lua, around line 151, the mediocre rating (3 of 1..5) fax is constructed, which has a 'mediocre' string, a boost, and a cash award. That looks like our guy.\nI cross-checked with the message text, and indeed S[44][203] is a mediocre remark in the original strings. In other words, it's a mediocre VIP rating.\nLine 473 defines the cash_reward, and a little below the rating is defines, which is between 45 and 64 for mediocre (probably of 100).\nI agree the message is double.\nThe lesser levels (rating 1 and 2) have a reputation loss and no money, the higher levels (rating 4 and 5) are like the mediocre level at the moment, except for rating 5, which also seems to have a \"thank you\" action of some kind.\nSomething \"in-between\" would be nice, but how to achieve that?\n- Drop the boost\n- Drop the reward\n- Reduce the reward\nI don't know what to do here.\n. that's what \"bad\" and \"very bad\" do currently, so instead of 3 good-ish ones and 2 bad-ish ones, we'd have 2 good-ish ones and 3 bad-ish ones. I think mediocre deserves something in-between good and bad\nMaybe the string itself is wrong?\n. FYI, the string at the fax is https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/languages/original_strings.lua#L2065 Around it you can see the string numbers for the other ratings\n. I made some changes to what seems useful, please let me know what you think.\nThe table below lists the current implementation (rep-loss = reputation loss, rep-gain = reputation boost, mesg X = you get a message about X).\nFirst table is the current implementation, second table is my proposal, with the differences to the current implementation in italic font (if all is well).\nCurrent implementation:\n| Field | Very bad | Bad | Average | Good | Very good |\n| --- | --- | --- | --- | --- | --- |\n| reputation | rep-loss (-10) | rep-loss (-5) | rep-gain | rep-gain | rep-gain |\n| message reputation | mesg rep-loss | mesg rep-loss | mesg rep-gain | mesg rep-gain | mesg rep-gain |\n| money | nothing | nothing | money | money | money |\n| message money | nothing | nothing | mesg money | mesg money | mesg money |\nProposal:\n| Field | Very bad | Bad | Average | Good | Very good |\n| --- | --- | --- | --- | --- | --- |\n| reputation | rep-loss (-10) | nothing | rep-gain | rep-gain | rep-gain |\n| message reputation | mesg rep-loss | nothing | nothing | mesg rep-gain | mesg rep-gain |\n| money | nothing | nothing | nothing | money | money |\n| message money | nothing | nothing | nothing | mesg money | mesg money |\n. I wonder if you could save to memory instead of disk. In my experience, while Lua may crash, the program itself usually keeps on running. When a crash is detected, you can save to disk whatever was saved last.\nBtw maybe you want 2 copies, and alternately save to the other copy. That way you still have a copy if the save itself crashes.\n. \"luaL_optlong\" is not in the CorsixTH sources, and neither is \"optlong\". On first sight, CorsixTH doesn't seem to cause this issue, it's the library itself that needs this symbol.\nThis fits with 'lfs' being a run-time dependency, ie if CorsixTH would be missing the symbol, it wouldn't come off the ground, and start loading 'lfs'.\nUnder the assumption that the library itself needs the symbol, can you please check what lua version you used to build CorsixTH? If you used 5.1, then using a 5.2 library could cause trouble.\n. What I am missing in your reply is the the lua version of the interpreter that you use.\nThe lua interpreter version is the starting point, that's the version you have to match with everything else. You cannot mix 5.1 with something of 5.2 or vice versa. Everything has to be 5.1 or everything has to be 5.2 (or everything has to be 5.3 but you don't have that).\nThe first order of business is thus to\na) find out what lua interpreter you use, and b) decide whether that's what you want to have.\nI can't really help with 'b)', but for 'a)', you can look at several places:\n- Please check or provide the cmake output, as it should tell what lua versions and libraries you get.\n- You could ask the program what lua it needs. (type \"ldd CorsixTH/CorsixTH\" when you are in the root-directory of the check-out) in a terminal. You'll get a long dump of libraries that it needs, filter on 'lua' (type \"ldd CorsixTH/CorsixTH | grep lua\", which means 'give me a dump and only print lines with the word \"lua\" in it') should give you something like\nliblua-5.3.so => /lib64/liblua-5.3.so (0x00007ffb46ac8000)\nThat should give you information about what lua you're actually using.\nAs for \"exit without any error\", did you try running the program from a terminal? That normally gives some indication of what goes wrong (type \"./CorsixTH/CorsixTH\" to start, notice the leading dot before the first /, it's essential, it means 'start looking from the current directory')\n. Reproduction: windowed mode, 1600x900 (in case that matters), bisecting commit: d525af01e95aab6a92059882e61c1ad263d4a308 (Always use zoom texture for map), build program from scratch, play single scenario \"Finisham\", buy nurse, click on nurse. The round area is just see-through, and not displaying the nurse.\nI don't get the area below the window. \nedit: In the 'good' version I get the \"0.999 <= fScale && fScale <= 1.001\" branch, while in the 'bad' version I get the \"eWhatToScale == THSI_All && m_bSupportsTargetTextures\" branch in the method of that commit.\n. Changes seem ok to me\n. And also thanks for forwarding the changes into the repository\n. Given that there may be string proxies involved (app.lua, around line 406), which end up in th_lua_strings.cpp line 730, I am quite not sure we actually have normal lua strings here.\n. Cannot reproduce this in current trunk (a54ddfa, October 2015). Did you try in 0.50 release?\n. While discussing at IRC, @bobcanthelpyou compared original english strings with original german strings, and found that strings [28,32] and [28,33] are the same in the original german texts. After that, strings don't match between both files.\n. The code jumps back and forth between code in different files (rooms, patients, queues) within the loop. At some point the infinite loop detection triggers, it's mostly a matter of luck at what point exactly that happens.\n. Savegame is after the problem occurred, and does not help in reproducing the problem, for an investigation how this problem is formed. We need a save game that is earlier, to see how the problem develops\n. Perhaps add some typedefs around std::uint8_t  and friends? Having to type the std:: prefix for such common types is not so nice.\n. using namespace  would be fine too, I wasn't aware of that option.\n. What version are you using?\n. The change with discussed above was created after 0.50.\n. fixed\n. It does not crash for me, but it does loose at some point (further away than 2 minutes).\nAlso, the game doesn't have a reception desk, probably avoiding the health inspector to give a fine :)\nTo eliminate lack of a reception desk as cause, could you try to add a reception desk, and see if it still crashes? (I expect it will, but that means at least the reception desk is not causing the troubles.)\nSince you can save and continue from the previous game, it may not have to do with the game itself, but eg with sound or movies, or so. Did you try disabling music or sounds? Maybe it's even a specific number that causes trouble?\n. Did you also install lua-dev (or lua-devel), the lua development package (which should have /usr/include/lua.h and some other files it needs to compile against the lua libraries) ?\n. Esentially, you're asking about the overall game structure, I think.\nhttps://en.wikipedia.org/wiki/Game_programming#Game_structure seems like a first shot. If you explain why you want this information, maybe we can help you further.\nAs for the TH files, we don't use any code from them, just the graphics and some data files are used.\n. A better place to discuss game programming in general is at a game programming forum like gamedev.net . If you want to program CorsixTH, just start, the code is right here in this project, it's usually easiest if you hang out in the #corsix-th IRC channel, where you can discuss things. You can also use the google newsgroup if you like. Some lua developers just communicate through issues here, but that is complicated, as issues are not really a discussion medium.\nIn the game loop, some code is running along that performs, eg emergencies, or earthquakes. When the level file is loaded, that code is set up to let those events happen at the time defined by the level file. If the level file does not contain eg emergencies, the 'emergency event' code is set up to never trigger.\n. Usually, you make such changes as part of other translation updates, but fair enough :)\n. Yep, a compile guide should explain how to set things up with cmake.\nIn addition, adding such a thing to our CMake file would mean you have to handle Linux and MacOS as well, which quickly becomes a much more complicated task.\n. It's a C++ crash for me.\nThe culprit seems to be the window with the patient walking home that is open (and walking off-world at June 6).\nCould you try closing that, to check if that fixes the issue? (Clicking the scanner room patient might work because you then also close the currently open window (and open a new one with the scanner room patient).)\nCrash looks somewhat random-ish. At normal speed, it doesn't crash, at speed as set by the save, it does crash, at mostly the same point, but with different addresses. One partial dump:\n``` gdb\nProgram terminated with signal SIGSEGV, Segmentation fault.\n0  0x000000000043e99c in THLinkList::getDrawingLayer (this=0x945c36203d5be653)\nat /home/alberth/corsix-th/corsix_alberth_fork/CorsixTH/Src/th.h:37\n\n37          int getDrawingLayer() {return m_drawingLayer;}\n(gdb) bt\n0  0x000000000043e99c in THLinkList::getDrawingLayer (this=0x945c36203d5be653)\nat /home/alberth/corsix-th/corsix_alberth_fork/CorsixTH/Src/th.h:37\n\n1  0x000000000043bcad in THMap::draw (this=0x81348b8, pCanvas=0xc25ab8, iScreenX=620, iScreenY=870, iWidth=3116,\niHeight=1752, iCanvasX=0, iCanvasY=0) at /home/alberth/corsix-th/corsix_alberth_fork/CorsixTH/Src/th_map.cpp:890\n\n2  0x000000000044ec5b in l_map_draw (L=0x67a1ba8)\nat /home/alberth/corsix-th/corsix_alberth_fork/CorsixTH/Src/th_lua_map.cpp:772\n\n3  0x00007fc15e0a1360 in luaD_precall () from /lib64/liblua-5.3.so\n4  0x00007fc15e0b6a1d in luaV_execute () from /lib64/liblua-5.3.so\n5  0x00007fc15e0a15e0 in unroll () from /lib64/liblua-5.3.so\n6  0x00007fc15e0a0cc2 in luaD_rawrunprotected () from /lib64/liblua-5.3.so\n7  0x00007fc15e0a17f9 in lua_resume () from /lib64/liblua-5.3.so\n8  0x00000000004492ad in l_mainloop (L=0xb54108)\nat /home/alberth/corsix-th/corsix_alberth_fork/CorsixTH/Src/sdl_core.cpp:288\n\n```\nBelow it is more liblua, and a few main.cpp (Src/main.cpp:186, SrcUnshared/main.cpp:85)\n0x945c36203d5be653 is a random value, I also get 0x20 in another crash.\n. Please show cmake output, or did you solve it already?\n. having values with the same name as the enum type looks so horribly wrong :p\nanyway, if the problem is only utf8next, I am sure freerct has some utf8 decoder somewhere without macros. Since I wrote it, I can give it a new license :)\nIf the problem you're solving is bigger, as in satisfying the wish to go C++11, I'd suggest to convert everything to unicode strings on startup. Assuming that's not feasible in a few simple commits, the first step is probably adding support for old and new string formats, and then slowly moving strings over to the new format.\nAnother option is to cache converted strings, so you only have to convert them once for the duration of running the game.\nlibicu is also used by openttd, it's indeed powerful, but also big afaik (yep, very, by the looks of it at my system, although no idea what you actually need). I also remember problems with building for windows and mac, but no idea whether that is still the case.\n. The first (infinite recursion due to non-reachable area) should have its own issue (can't find it currently, but we have a plan somewhere to resolve it).\nPayments have been completely rewritten with the price impact, making the second issue obsolete.\nClosing this issue, as there is nothing here to do anymore\n. Prefixed the title to denote it's not ready to be merged; please change it to \"RDY\" if you think it is ready. Add \"RFC\" if you want to discuss something.\n(and also post a remark here, title updates are not broadcasted to others by githb :( )\n. Nobody ever checks files from the project data, so while we could move the compile instructions to a file and distribute them, they would be less easy to find, and get obsolete in no time.\nI agree the wiki is not ideal, but it's easy to find, and keeping it more or less up-to-date is less effort.\n. > Long story short: It is more convenient and more fool-proof to have all neccessary documentation\n\ndistributed with the game itself.\n\nThis is not necessarily true. If I have a version from 2013, with VS2013, and now I have VS2015, the readme file is definitely not updated to the new situation.\nThe wiki is more likely to be up-to-date wrt current build tools.\n. Last merge that is available seems to be\n```\ncommit de495c315ac27501d2bde17d6cc9693ae66eaa9b\nMerge: bd344a1 9a88bb0\nAuthor: Alberth289346 alberth289346@gmail.com\nDate:   Tue Sep 29 17:38:50 2015 +0200\nMerge pull request #890 from TheCycoONE/new_travis\n\nUse travis containers and g++ 5 in TravisCI\n\n```\nMaybe the disk is full or so? the 43 entries there are around 740MB\n. Could you add a savegame demonstrating the problem (through some file upload service, unfortunately, as github does not allow uploading binary files)\n. Improved the comment message above the code block, and dropped passable as it wasn't doing much. While at it, found and fixed another case, which is perhaps also the final one, as the shiftdelta is now not needed any more.\n. Suggestion implemented\n. Good suggestion.\nMoved lua_node_flag_map up, and re-used it for getcellflags.\n. Updated to \"val\"\n. Yep, will see how the litter currently works, thanks MarkL\n. There was something wrong about the patch, as in, not working correctly in combination with the handy men. As such, addressing performance is best done separately.\nEDIT: The problem was when you went back in the editing process, and moved the room onto new vomit, that would not be cleaned.\n. I dea was too simplistic, #381 looks like a better approach\n. It doesn't crash here.\nThe stack trace suggests you clicked at something, did you?\n. Upon further testing, Autosave does crash in 0.50, at Mar 11.\nThe reason is the window you have open on the patient walking back to home.\nIf you close it before the above date, the program will continue to run.\nThe bug itself has already been fixed in commit 7541804 already.\n. Thanks for the report, apparently nobody ever actually to play a free game.\nSince rooms already failed, you may encounter other things now that are also not free (they could not have been tested at all). Please report them as well, so they can be fixed.\n. oh\nThanks for letting me know, that dramatically reduces the chance of running into other problems then.\n. Seems like a much simpler solution to me, perhaps it had its use in a previous version with all the different back-ends.\n. Changes:\n- Reverted free_build_mode code change in hospital.lua (was in commit 91be0b34de6a1e8acee9972416236ab949e775f8 around line 1457)\n- Added ResearchDepartment:afterLoad in commit e49db0605bf7b0e4fbef9bf8f86dc3ed9215546b and bumped savegame (place in list above is wrong for some reason)\n- Added Epidemic:afterLoad in commit 067ff83017d5ad037ed16831f9a6a6b8ce72c7fa (also wrong place in list)\nAs for merging, just merge everything into one commit?\n. Updated hospital with calls to afterload in commit be876e17fa92a9b42a4147dc6f640942c0cf0145 and commit e9ab153d5045a0b4e6b5f29a7291205d4a76c172\n. squashed & reworded commit message\n. Dump of gamelog + first analysis\n```\nCreated game with savegame version 105.\nSavegame version is 105 (0.50), originally it was 105 (0.50)\nWarning: Trying to remove nonexistant room build callback (function: 0000000013FC11F0) from humanoid (table: 0000000008B4E2A0).\nWarning: Trying to remove nonexistant room remove callback (function: 0000000012A78600) from humanoid (table: 0000000008B4E2A0).\n[lots more removed]\nWarning: Trying to remove nonexistant room remove callback (function: 0000000017717C20) from humanoid (table: 0000000012CD8BF0).\nError in buttonup handler: \nF:\\Spel\\CorsixTH\\Lua\\map.lua:389: attempt to index a nil value (local 'thData')\nstack traceback:\n        F:\\Spel\\CorsixTH\\Lua\\map.lua:389: in method 'loadDebugText'\n        F:\\Spel\\CorsixTH\\Lua\\dialogs\\menu.lua:711: in field 'handler'\n        F:\\Spel\\CorsixTH\\Lua\\dialogs\\menu.lua:390: in method 'onMouseUp'\n        F:\\Spel\\CorsixTH\\Lua\\window.lua:1429: in field 'onMouseUp'\n        F:\\Spel\\CorsixTH\\Lua\\ui.lua:623: in function \n        (...tail calls...)\n        F:\\Spel\\CorsixTH\\Lua\\app.lua:779: in function \nError in keydown handler: \nF:\\Spel\\CorsixTH\\CorsixTH.lua:56: cannot open F:\\Spel\\CorsixTH\\Lua\\debugger.lua: No such file or directory\nstack traceback:\n        [C]: in function 'persist.dofile'\n        F:\\Spel\\CorsixTH\\CorsixTH.lua:56: in function 'dofile'\n        F:\\Spel\\CorsixTH\\Lua\\run_debugger.lua:17: in function \n        (...tail calls...)\n        F:\\Spel\\CorsixTH\\Lua\\ui.lua:243: in field 'callback'\n        F:\\Spel\\CorsixTH\\Lua\\ui.lua:528: in field 'onKeyDown'\n        F:\\Spel\\CorsixTH\\Lua\\game_ui.lua:235: in function \n        (...tail calls...)\n        F:\\Spel\\CorsixTH\\Lua\\app.lua:779: in function \n```\nThis looks like you pressed ctrl+c, after enabling debugging, not sure where \"debugger.lua\" is supposed to come from, probably an external install.\n. \nDoor is not usable, janitor wants to water plant inside, doctor wants to leave.\n. Savegame is already in bad state, we would need an earlier one to understand how the game gets in this state.\n. Changed the staffed desk description, and dropped handling new things in the hospital.\n. Silly bugs seem gone now\n. Intro, and level board movies work flawlessly with this patch. I also tried a different resolution, that works too. Looks like you're on the right track!\n. Except for some minor things in the added docs, looks fine to me.\nIt's also still running at may computer.\n. Already fixed, but not in the 0.50 release\n. Looks fine to me\n. Added dummy callback function to patient, machine, and staff files.\n. Last part of the patient constructor is now\n``` lua\n  self.has_passed_reception = false\n-- Is the patient trying to get to the toilet? (\"yes\", \"no\", or \"no-toilets\")\n  self.going_to_toilet = \"no\"\nend\n```\n. \"underway\" -> \"on her way\" (which works until we get male receptionists)\nadded \"notify_distance\" variable (bench_notify_distance was a bit too long for the line)\n\"get_entities_by_id\" -> \"get_objects_by_id\" function rename\n. Commit 0929e39 is best seen with -w:\ndiff\ndiff --git a/CorsixTH/Lua/objects/plant.lua b/CorsixTH/Lua/objects/plant.lua\nindex 63f70fa..816dc61 100644\n--- a/CorsixTH/Lua/objects/plant.lua\n+++ b/CorsixTH/Lua/objects/plant.lua\n@@ -175,22 +175,22 @@ function Plant:callForWatering()\n   end\n   -- If self.ticks is true it means that a handyman is currently watering the plant.\n   -- If there are no tiles to water from, just die.\n-  if not self.ticks and not self.unreachable then\n+  if not self.ticks then\n+    if not self.unreachable then\n       local index = self.hospital:getIndexOfTask(self.tile_x, self.tile_y, \"watering\")\n       if index == -1 then\n         local call = self.world.dispatcher:callForWatering(self)\n-      if self.current_state > 1 and not self.plant_announced then\n-        self.world.ui.adviser:say(_A.warnings.plants_thirsty)\n-        self.plant_announced = true\n-      end\n         self.hospital:addHandymanTask(self, \"watering\", self.current_state + 1, self.tile_x, self.tile_y, call)\n       else\n+        self.hospital:modifyHandymanTaskPriority(index, self.current_state + 1, \"watering\")\n+      end\n+    end\n+\n+    -- If very thirsty, make user aware of it.\n     if self.current_state > 1 and not self.plant_announced then\n       self.world.ui.adviser:say(_A.warnings.plants_thirsty)\n       self.plant_announced = true\n     end\n-      self.hospital:modifyHandymanTaskPriority(index, self.current_state + 1, \"watering\")\n-    end\n   end\n end\nI think the removed code in commit 9969879 is dead. There is only one call to this function, and it has \"not self.unreachable\" as pre-condition. In addition, there is a \"handyman\" variable mentioned in the removed code, which does not exist at that point. Last but not least, self.unreachable gets cleared in tickDay, so at worst, removing this code just delays trying again.\n. Thanks for the comments. While considering the remarks, I realized it's still way too slow.\nRewrote the entire thing now, much better now :)\n. What version is this exactly? There was a fix in 'tryToFindNearbyPatients', version 0.50 (release).\nIf your version is earlier (ie a 0.50 RC), this bug is likely already fixed.\n. save game is after the problem occurred and thus not useful for reproducing the issue, do you have a previous savegame?\n. I know I can just push it, but this is easier for you to find on a sun(ny?) day.\n. Doing last minute fixes is a big risk, as there is little time to fix any errors, before 0.60 gets spread to everywhere. Doing this after 0.60 is much easier.\nI'd also say that your fixes are useful, but the really bigger thing is that we get regular checking by a lint program with the automagic builds, which is much more valuable and longer lasting.\n. Hello @bobcanthelpyou ,\nWith 0.60 released, the road seems clear to move this patch towards merging. I think it's useful to have this check in the project for our merges.\nAre you still interested in doing that, or shall I have a go?\n. Fixed by #1004 \n. @sadger  could you review this please?\nLine 143 in the old version translates to lines 147 and 148 in the new file. The condition looks a bit weird to me, maybe I made an error?\nAlternatively, you may have intended\n(patient.disease == other.disease or other.disease.contagious) and not other.diagnosed\ninstead?\n. fixed old comment, fixed commit message, and added explanation, all as suggested.\n. rebased\n. fixed, in the way as suggested by TheCycoONE\n. looking good, maybe link to a wiki page where to find the gamelog ?\nperhaps \"try to find a savegame just before the issue happens?\"\nmaybe add that to \"steps to reproduce\"\n. :+1: \n. We consider all google.com data as lost now? I have never been able to pull anything from the archive.\nCan we close this issue?\n. The Doxygen files typos come from the doxygen program upstream. Better not change that, as the next update will revert the change.\n. great, thanks for checking it out.\n. To be sure we speak about the same thing, \"broken room\" is what you get after a machine blows up, eg due to an earth quake? The common terminology in that case is \"exploded room\". Or do you mean something else?\nAnyway, I think there should be a severe penalty for this, any suggestions?\n. Thanks for the confirmation and suggestions.\nThe topic of undoing exploded rooms tends to pop up every now and then, but we don't have an issue for it, it seems. This one looks like a good start :)\nUnless you work on it yourself, don't expect any quick solution. On the other hand, who knows... :)\n. Updated, fixed all points, except the \"spawn points\" comment (in World:spawnVIP), the line was a literal duplicate of the line about 10 lines down, first use is at about 11 lines down.\nModified files:\ndialogs/adviser.lua (empty line removed)\nwindow.lua (split a few more long lines)\nworld.lua (less indenting of a large literal)\n. rebased\n. Not sure my previous comments make a lot of sense at this stage, you may want to ignore them.\nI would like to keep the actions as-is, reformatting is not part of the patch, and it will break my patch for no good reason since even in the complete patch I can already see lines that were not addressed.\nThe patch: (apply to 2c3956c3):\n```\ndiff --git a/CorsixTH/Lua/room.lua b/CorsixTH/Lua/room.lua\nindex 553112d..a162753 100644\n--- a/CorsixTH/Lua/room.lua\n+++ b/CorsixTH/Lua/room.lua\n@@ -173,7 +173,7 @@ function Room:dealtWithPatient(patient)\n       -- Increment diagnosis_progress, and send patient back to GP.\n   patient:completeDiagnosticStep(self)\n\n\npatient:queueAction { name = \"seek_room\", room_type = \"gp\" }\npatient:queueAction{name = \"seek_room\", room_type = \"gp\"}\n       if patient:agreesToPay() then\n         self.hospital:receiveMoneyForTreatment(patient)\n       else\n@@ -186,7 +186,7 @@ function Room:dealtWithPatient(patient)\n       local next_cure_room = patient.disease.treatment_rooms[patient.cure_rooms_visited + 1]\n       if next_cure_room then\n         -- Do not say that it is a treatment room here, since that check should already have been made.\npatient:queueAction { name = \"seek_room\", room_type = next_cure_room }\npatient:queueAction{name = \"seek_room\", room_type = next_cure_room}\n       else\n         -- Patient is \"done\" at the hospital\n         if patient:isTreatmentEffective() then\n@@ -206,8 +206,8 @@ function Room:dealtWithPatient(patient)\n       end\n     end\n   else\npatient:queueAction { name = \"meander\", count = 2 }\npatient:queueAction { name = \"idle\" }\npatient:queueAction{name = \"meander\", count = 2}\npatient:queueAction{name = \"idle\"}\n   end\n\nif self.dealt_patient_callback then\n```\nEDIT: I hacked the ugly patch somewhat, made local functions less local, and tried to refactor code out. The \"getTransactionReason\" is horribly broken due to the plain \"return\" in the middle of the function which was not handled in the original patch. Also, \"patient:getCasebookId\" doesn't always seem to give a diseaseId in the original price impact patch, which makes using casebookId as replacement for diseaseId fishy.\nSee https://github.com/Alberth289346/CorsixTH/commits/hacking_ugly  you may want to apply some of my patches into your branch. I don't care about ownership.\n. +1 on making it return a value, \"compute\" doesn't cover its current functionality imho.\nI also saw some points where I wanted to change things, but I think it's currently more important to get the patch in a useful shape\n. https://github.com/Alberth289346/CorsixTH/tree/impact_fixes   contains a bunch of doc fixes + commit hash to apply them to.\nOtherwise looks quite sane, although it's still difficult to follow\n. fixed in commit b458f0650d30d4c12f1b41ae83d3aa76c3a38fa9\n. Deleted some more lines (#pragma stuff), appveyor reports no new problems\n. Thanks for the review, good points.\nAdded \"std::\" prefix to tolower (I did get your second to last comment too, weird enough).\nDeleted the #pragma that you indicated as well, which again did not change anything in appveyor output. If you look for \"pragma\" though, there are a lot more. No idea what they do.\n. Added the std::strcmp cases too, and removed a now obsolete #include  that I added\n. cmake .\noutput will work, please use 4 backticks above and below the log, so it gets formatted as fixed width teletype font\n. For reference, this is how it looks, and I can see people confusing it for an error :)\n\n. removed the diff_x and diff_y check, and refactored freeLoos out the code completely\n. rebased, added savegame bump\n. To be a bit more verbose, nobody pushes directly to the CorsixTH repository normally, everything is done by issueing a Pull Request from your own repository copy. One of the other devs will then do a review, and if all is fine (which is usually the case with language changes), he will merge it into the main CorsixTH repository.\n. Fixed\n. So you can write chains with callback function names without a zillion lines between the start and the end of the statement, mostly\nlua\nhumanoid:queueAction(UseObjectAction(obj):setLoopCallback(desk_loop):mustHappen())\n. Constructed the actions and replaced the actions I had in my patch\nfirst commit (commit 1a1c012 has not changed)\n. I know, I have already checked that code. It adds action classes (more properly than I do here). He also solves the synchronization issue more nicely (so when several humanoids together do something they both start at the same time). For details, read commit 0b15a7d6744084473645009ba9ad210d91180351 only the fully new files are interesting, and they have a lot of text, which is quite nice.\nAt the same time, he is still squarely in the action system domain, which, as I have just argued above, is one of the causes for much complexity in my view, which makes it unattractive to go in that direction for me.\nObviously, I could be wrong, since I don't have the answer to a better solution yet.\n. Could remove the RFC now, and add a 0.70 label, I think?  @TheCycoONE \n. rebased\n. Removed a \",\" that was left behind (research.lua, after  'persistable:research_desk_loop_callback' function\n. > Humanoid.lua walkTo function. The must_happen logic is convoluted for a bool.\nGood point.\nUpon inspection I realized it was even wrong (it was meant to catch 'not nil', but obviously it also fails on 'false'). Checked this for all my new 'set' functions, and for all vulnerable functions, checked all their uses. That resulted in finding 7 more troubled spots, now attached as 4th commit.\n5th commit removed the parameter of two 'set' methods, as they always set the property.\n\nWhat was the logic used to decide if a parameter should be in the constructor or set via a setter?\n\nLogic was just a check what was always set and what was sometimes set, as that gave the simplest conversion path.\n. Ah right, thanks, that code was already not making any sense.\nI think however it's a separate issue, this PR is about refactoring, just rewriting the code without functional changes. Changing behavior is not part of it.\n. New attempt in #1107, keeping this open for reference\n. Hai Grimdoc,\nGood that you try again to update Norwegian.lua, but you based it on the wrong point in the source code. In my copy, I see the following\n* 0e88b67 (HEAD, upstream/pr/1021) Update norwegian.lua\n*   03a4e80 (tag: v0.40-beta2) Merge pull request #344 from J-Shep/341_fix\nThis means your 0e88b67 patch was added on 0.40-beta2, and not 0.60-beta1 (or whatever its tag is). You first should update to current master, and then fix the language file.\nFYI: I already made a PR from your update in #1014 which has been added to 0.60-beta1 already.\nDidn't you get a message in #1000 ?\nYou may want to check that before doing duplicate work.\n. Handy men don't clean inside the rooms currently, which is somewhat weird, but it makes the corridor have its own special behavior, which I think is good.\nEDIT: I just follow random issues at the issue tracker, I don't know what the original did or did not do :)\n. The patch gives everybody litter that they drop after a number of tiles (random, from 30 to200 or so), within the hospital. I checked, my level 1 & level 4 hospitals need about 40-60 tiles for patients to walk before they go home. Drinks machine lowers the number of tiles to walk between 1 to 12, I think. I was trying to avoid littering the smaller hospitals (in the earlier levels).\nThe bin is only searched when they are about to drop something. that means a row of bins at the entrance will not work (which would if you monitor how close they pass a bin constantly, and delete the litter when they pass close enough). To catch all litter you need to place bins everywhere. To avoid needing to have a bin every few tiles (which looks stupid imho), I increased the range to 8, which can be interpreted as \"they just passed a bin or will soon pass a bin\".\nI also added a small chance they drop litter despite having a bin nearby.\nI pondered about the distance and affecting likeliness of finding the bin, but the tile count is already random, so it would be equal to reducing the radius of finding the bin. (Adding something random on top of something random doesn't it make more random, the amount of randomness stays mostly the same.)\nThings are still pretty much untested for having useful numbers. Maybe chances or ranges should be improved.\n. rebased\n. just dropped commit 3a7f11f although I disagree with the patient updating hospital administration.\nreverted the local function thing of commit 924fbaa too\n. More tweaking done. compared to #225, replaced boolean value by month count, default is 3 months instead of 12 (should be sufficient to setup a heating system, but not too long as otherwise #74 isn't fixed). Users can extend the period to 18 months.\nReverted tuning down the happiness change (so it's 0.02 like it was).\nHospital itself handles decrement of the counter, rather than the world doing it on their behalf.\n. New attempt.\nRemove initial grace period but, reduce negative impact from 0.14 to 0.10\nGrace period was introduced as it was reported that CorsixTH became too cold too quickly. This change started as a report that it was not sufficiently becoming cold (github issue #74). Rather than make the period configurable, it was decided to remove the period entirely and let the user deal with it (github PR #1026).\n0.02 / 0.14 = 0.14285714285714285\n0.10 is less than that, happiness will decrease less quickly.\n. Thanks for the confirmation\n. commit b54c5a832baa5815511ab7f66f78351b0c4c338c gets the blame by git bisect.\n. Added a hack in World:newFloatingDollarSign to fail on assert at the right moment, both for the first and the second payment.\nif patient.disease.id == \"king_complex\" then\n    if patient.going_home then assert(false) end -- crash on second payment\n    print(\"Elvis  is paying, going home = \" .. (patient.going_home and \"yes\" or \"no\"))\n  end\nFirst payment is when reaches the screen, log:\n../Lua/world.lua:1891: assertion failed!\nstack traceback:\n        [C]: in function 'assert'\n        ../Lua/world.lua:1891: in method 'newFloatingDollarSign'\n        ../Lua/hospital.lua:1580: in method 'receiveMoneyForTreatment'\n        ../Lua/entities/patient.lua:282: in method 'treatDisease'\n        ../Lua/room.lua:192: in method 'dealtWithPatient'\n        ../Lua/rooms/psych.lua:118: in method 'loop_callback'\n        ../Lua/humanoid_actions/use_object.lua:289: in local 'timer_function'\n        ../Lua/entity.lua:219: in field 'tick'\n        ../Lua/entities/staff.lua:149: in method 'tick'\n        ../Lua/world.lua:1059: in method 'onTick'\n        ../Lua/app.lua:979: in function <../Lua/app.lua:976>\n        (...tail calls...)\n        ../Lua/app.lua:880: in function <../Lua/app.lua:875>\nSecond payment is when he leaves the screen\n../Lua/world.lua:1891: assertion failed!\nstack traceback:\n        [C]: in function 'assert'\n        ../Lua/world.lua:1891: in method 'newFloatingDollarSign'\n        ../Lua/hospital.lua:1580: in method 'receiveMoneyForTreatment'\n        ../Lua/entities/patient.lua:282: in method 'treatDisease'\n        ../Lua/room.lua:192: in method 'dealtWithPatient'\n        ../Lua/rooms/psych.lua:111: in local 'after_use'\n        ../Lua/humanoid_actions/use_screen.lua:29: in local 'timer_function'\n        ../Lua/entity.lua:219: in method 'tick'\n        ../Lua/world.lua:1059: in method 'onTick'\n        ../Lua/app.lua:979: in function <../Lua/app.lua:976>\n        (...tail calls...)\n        ../Lua/app.lua:880: in function <../Lua/app.lua:875>\nThis patient also triggers the \"going home\" warning with the 2nd payment:\nWarning: goHome called when the patient is already going home\n. Generalized the rangemap function, and moved it to utils; merged all the averaging changes into the 2nd commit. Aside from 3 additional comments \"default value does not generate a message\", it's equivalent.\nAdded new commit to rename camel case variables to lower_underscore_case to unify the variable names somewhat. Tested with a level 1 save, with a VIP visit, giving a report.\n. there is a debian build upstream, afaik\nAs for source build:\n```\ndownload source into \"cth\" directory (other name is also allowed)\ncd cth    # if you used a different name for download, change it here too\nbuild\ncmake .   # <-- note the '.' parameter\nmake\nrun\n./CorsixTH/CorsixTH   # Will ask for the CD \"HOSP\" directory.\n```\n. Not a debian user, so don't know the details there.\nhttps://launchpad.net/debian/+source/corsix-th  seems to be for 0.50 (ugh), and debain unstable\nMovies are optional, you can switch them off with a -D option to cmake\ncmake -D WITH_MOVIES:BOOL=OFF .    # <- don't forget the dot at the end\nthat should solve your libAV problems.\n. Given that we depend on the data of the original game makes stuff a bit awkward, I guess. We are working on getting free graphics, but sound, music, and strings aren't being worked on afaik.\n. The log is actually a stack trace, a list of \"filename : line-number : what it was doing there\" lines.\nIf you compare the lines with the log in #694, they look the same to me, so as for the log it looks like a duplicate issue, but you seem to be talking about something else?\n. Looks like the right direction to me\n. At my Linux system, I don't get all those SDL events. Losing and gaining focus works, but is generally useless, since I use \"focus follows mouse\", so whenever I move the mouse out of the window, you get those (like type a line of chat in a window at the same desktop).\nOtherwise, the minimize and restore seems to work, with \"hidden\" and \"exposed\" attached, as expected. the \"moved to position\" stuff works too. In particular, you don't get anything when you don't have focus (ie move the mouse out of the window, for me, eg to grab another window), so switching to a different desktop, dragging another window on top of it, etc is not reported at all.\nTo demonstrate:\n```\n\nINFO: Window 2 shown\nINFO: Window 2 exposed\nINFO: Window 2 exposed\nINFO: Window 2 gained keyboard focus\n\nINFO: Window 2 lost keyboard focus\n\nNo new messages\n\nNo new messages\n\nINFO: Window 2 gained keyboard focus\nYou're lucky here, there is no other window than the SDL window, which is why it gets focus\n\nINFO: Window 2 lost keyboard focus\n\nINFO: Window 2 gained keyboard focus\n\nINFO: Mouse left window 2\nINFO: Window 2 hidden\nINFO: Window 2 minimized\nINFO: Window 2 lost keyboard focus\n\nINFO: Window 2 shown\nINFO: Window 2 restored\nINFO: Window 2 exposed\nINFO: Window 2 gained keyboard focus\nYou're lucky here, there is no other window than the SDL window, which is why it gets focus\n\nINFO: Window 2 lost keyboard focus\n\nno messages\n\nsecond terminal window gets focus, as that's what my mouse points at\n\nno messages\n```\nIn all, it seems a lot of things depend on your window manager configuration. I don't think it's fixable. There are a zillion different window managers in Unix, with various different ideas on focus. Each idea has a number of users that had a good reason to pick that form of focus and not another one.\nSDL does the best it can, probably, but it doesn't do the same at each system/platform.\n. From my experiments, it seems the following options exist for Linux\n1. Always on\n2. On if on screen somewhere (== not minimized)\n3. On if focus\n4. Always off\nI think this is more or less in order of \"less music\".\nOption 3 is useless to me due to my focus model, but if you use \"click to give focus\", it would work. Assuming you can't have focus when occluded, your option would be tween 2 and 3, I think?\n. I think as user you want to be able to specify at least 1 and 4. Option 2 sounds reasonable too, so that would be useful to have too. I don't know about 3, I can imagine it's a useful choice when you have click-to-focus models, like in Windows. I won't use it though.\nIf you want to add occlusion magic, make it an extra option, imho.\nEDIT: Upon further discussion, I think we need to separate the kinds of noise too\n1. background music\n2. sound effects\n3. announcer\nThat means we'd have 3 sound options. I am not sure what sound options currently exist, but imho it makes sense to integrate this mute idea into them.\n. we already have 3 options, look in the menu, but otherwise, sounds good to me\n. Any effort for afterload seems overkill if it only delays introduction of the feature due to an opened window.\n. GP is visited after reception, and after each diagnosis room, so it's quite normal to visit the gp more than once.\nIt crashes with the patient at the psych room, for me. The patient enters and then crashes. I tried taking some furniture out of the way to try determining the cause, but didn't have much luck with it.\n. Trying to find an old good version failed. I went back until commit 94e1680 (dec 15, 2015), which updates the savegame number to 108, the number of the attached game. I could reproduce it there.\nThe bug is thus older from before dec 15, 2015.\nBefore that mostly fails with an error on finding the reception desk or failing on a build room callback (which got removed in savegame version 108), but I also had one case where the gp office door crashed instead of the psych room door, so it's not purely the psych room door.\n. Hacked the setCellFags to get some info on what happens at lua side: https://github.com/Alberth289346/CorsixTH/tree/debug_setcellflags\n(Where 67,73 is in front of the couch, as far as I can tell.)\nThat gives\n``` text\nthob    18\nstack traceback:\n    ../Lua/map.lua:590: in method 'setCellFlags'\n    ../Lua/entities/object.lua:685: in method 'resetAnimation'\n    ../Lua/world.lua:2317: in method 'resetAnimations'\n    ../Lua/persistance.lua:280: in function 'LoadGame'\n    ../Lua/persistance.lua:292: in function 'LoadGameFile'\n    (...tail calls...)\n    [C]: in function 'pcall'\n    ../Lua/dialogs/resizables/file_browsers/load_game.lua:41: in method 'choiceMade'\n    ../Lua/dialogs/resizables/file_browser.lua:206: in field 'select_callback'\n    ../Lua/dialogs/tree_ctrl.lua:621: in method 'onMouseUp'\n    ../Lua/window.lua:1462: in method 'onMouseUp'\n    ../Lua/window.lua:1462: in field 'onMouseUp'\n    ../Lua/ui.lua:649: in function <../Lua/ui.lua:636>\n    (...tail calls...)\n    ../Lua/app.lua:901: in function <../Lua/app.lua:896>\nthob    44\nstack traceback:\n    ../Lua/map.lua:590: in method 'setCellFlags'\n    ../Lua/entities/object.lua:685: in method 'resetAnimation'\n    ../Lua/world.lua:2317: in method 'resetAnimations'\n    ../Lua/persistance.lua:280: in function 'LoadGame'\n    ../Lua/persistance.lua:292: in function 'LoadGameFile'\n    (...tail calls...)\n    [C]: in function 'pcall'\n    ../Lua/dialogs/resizables/file_browsers/load_game.lua:41: in method 'choiceMade'\n    ../Lua/dialogs/resizables/file_browser.lua:206: in field 'select_callback'\n    ../Lua/dialogs/tree_ctrl.lua:621: in method 'onMouseUp'\n    ../Lua/window.lua:1462: in method 'onMouseUp'\n    ../Lua/window.lua:1462: in field 'onMouseUp'\n    ../Lua/ui.lua:649: in function <../Lua/ui.lua:636>\n    (...tail calls...)\n    ../Lua/app.lua:901: in function <../Lua/app.lua:896>\n```\nwith 18 = 0x12, and 44 = 0x2C\n. That gets recomputed in Lua, I found out in resetAnimations: https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/world.lua#L2313\nEDIT: Object:resetAnimation overloads the above (it's in the stack dump above), and does a\nself.world.map.th:eraseObjectTypes(self.tile_x, self.tile_y)\n(entities/object.lua, line 684) which in C++ says (th_lua_map.cpp:547): \nc++\n/* because all the thobs are not retrieved when the map is loaded in c\n  lua objects use the afterLoad function to be registered after a load,\n  if the object list would not be cleared it would result in duplication\n  of thobs in the object list. */\nstatic int l_map_erase_thobs(lua_State *L)\nAssuming both the radiator and the couch do this, one of them should disappear\nEDIT2: Dumping the thobs that get added and removed on loading the save game, I can confirm this behavior:\nSee 2nd commit in my debugging branch, it prints\n``` text\nCouch pos: erasing\nthob    18\n\nCouch pos: set thob 18\nCouch pos: erasing 18\nthob    44\n\nCouch pos: set thob 44\n```\nThe couch (18) gets added, and removed by the radiator.\nEDIT3: Added a 3rd commit that first removes all object thobs, and then adds them all again. This fixes the issue for me.\n. There was a user in #openttd with the same problem (at least in the same .dll file) yesterday. Dit that get updated recently?\n. closing issue, as we don't fix windows nt bugs\n. First analysis suggests scaling multiple times in SDL is causing havoc. SDL itself does not give an error, so it may be a driver problem at my machine.\n. Tried this, but it already failed on a self-built version of sdl 2.0.3 against head of master (ie 0.60-ish).\nI also tried cth 0.50 against that sdl 2.0.3, and it also failed.\nThis seems to point squarely to the video driver\nEdit: for fun, I tried all combinations (0.50 vs 0.60-ish, and 2.0.3 vs 2.0.4), none of them worked properly.\n. Issue seems to have resolved itself. At least, I could build a GP without glitches with some newer kernel which arrived through updates in the last year.. More, smaller steps, nicer fix, seems to work, both the lucky shot and the unlucky shot\n. ```\n\nWarning: Trying to remove nonexistant room remove callback (function: 0000025306B26CE0) from humanoid (table: 0000025306B193E0).\nSavegame version is 111 (v0.60-rc1), originally it was 111 (v0.60-rc1)\nWarning: goHome called when the patient is already going home\nSavegame version is 111 (v0.60-rc1), originally it was 111 (v0.60-rc1)\nWarning: goHome called when the patient is already going home\nError in timer handler: \n...ogram Files\\CorsixTH\\Lua\\humanoid_actions\\use_object.lua:131: No animation for Doctor using op_sink1 facing east phase 0\nstack traceback:\n    [C]: in function 'error'\n    ...ogram Files\\CorsixTH\\Lua\\humanoid_actions\\use_object.lua:131: in upvalue 'action_use_phase'\n    ...ogram Files\\CorsixTH\\Lua\\humanoid_actions\\use_object.lua:329: in local 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:219: in field 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:149: in method 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1059: in method 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:1000: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:901: in function \n```\nThanks for the report, but we will need a save game from before the probem to be able to investigate. If you could check the autosaved games please?\nThe creation dates should give you a good idea of the age of them, to find the useful one.\n. Autosave did not give that error\n. With git you also have control, but there are more steps to do, and it's easier to make a mess.\nI believe the barrier is not only for translators, also new lua programmers are hit by it.\n. @MarkL1961 if making a branch is not a problem, that could work too perhaps. Make a branch, push it onto your repository, and make an issue with the link (a PR would get messy, as the PR gets linked to your repository, which means no-one else can easily change it).\n(At least I hope you do make branches, or an update from master, or the second patch becomes a mess.)\n@TheCycoONE  One small addition, please also mention the name of the file, with directory if possible. Just in case there is confusion about which file the issue is.\n@Grimdoc  in general, 1 issue for 1 language update (where \"language update\" may change as many strings as you like) is the least confusing. The person modifying it into a PR should worry about splitting into separate commits and so on.\nNot sure how to deal with changes in several files, one comment for each file? Won't happen in translation updates, I guess.\n. See PR #1076\n. ``` shell\nBest is if you are on the master branch, and it is up-to-date with corsix master\n$ git branch ITranslation    # make the branch\n$ git checkout ITranslation  # switch to the branch\n```\nIt is possible to combine both commands into one with a flag of the \"checkout\" command.\n. My game manual says 2-4 players in multi-player\n. When you play the game, you can buy new parcels in the town map window. After buying you own it, and can use it for building more rooms in the game.\nThe first N parcels are for the N players that play (where N==1 always, in the current implementation). Other parcels are just for buy (single player) or for the highest bidder (multi-player).\nAnother easy way to ask questions is to visit the IRC channel (#corsixth at freenode.net)\n. @viktorcech  source code is right here in this project, make a fork, and create a proper patch. We will be most happy with it.\n. I'd prefer to also take out the actual problem; lua seems too flexible to trust a single boolean value set somewhere.\n. I would really prefer a more explicit separation; maybe the lua-devs decide to revert the change made by corsix, or create a hole in it by accident. Explicit code that parses things avoid all those problems, and makes it clear to people browsing the code there is no problem.\n. Upon loading in master, the game opens and scrolls to the right. By clicking, it stops scrolling.\nThe advisor is shown, but no message from it.\nNo messages at the console other than savegame version 111 is used.\nThe game does not respond to ^C, I have to force-kill (kill -9) it.\n. ``` diff\n--- a/CorsixTH/Lua/humanoid_actions/walk.lua\n+++ b/CorsixTH/Lua/humanoid_actions/walk.lua\n@@ -142,6 +142,7 @@ local action_walk_tick; action_walk_tick = permanent\"action_walk_tick\"( \nfunction\n   local check_doors = not not humanoid.door_anims\n   local x1, y1 = path_x[path_index  ], path_y[path_index  ]\n   local x2, y2 = path_x[path_index+1], path_y[path_index+1]\n+  print(\"xy1=(\"..(x1 or \"nil\")..\", \"..(y1 or \"nil\")..\"), xy2=(\"..(x2 or \"nil\")..\", \".\n.(y2 or \"nil\")..\")\")\nif not x2 then\n     -- Arrival at final tile\n```\nAdded a debug line in walk.lua, and it endlessly prints\ntext\nxy1=(86, 68), xy2=(86, 69)\n. or even no config, I don't see the point of enabling the setting, and then disabling it again if you're debugging.\n. Fixed in commit 7b58de79a73345c0ba06590d5718c5171d07fee2, thanks\n. Thanks for the report, but in it's broken state, there isn't much that can be done.\nIt's like looking at a shattered glass in the floor (or in your case several different glasses on the floor where all the pieces are everywhere), and then trying to decide how it (they) fell, and why. As you can imagine, that's hard or impossible to do.\nTo get insight in what causes the problem, a savegame earlier in time is required, one just before the glass was dropped. With such a savegame, you can load the savegame, and replay the events over and over again, analyzing each step of the way, and eventually finding out why the glass gets dropped while it shoudn't, and fix it.\n. > The following commit uses enableTreatmentRoo is there justification for why you use enable here and set for others e.g. setMustHappen\nThe rule is: \"setXYZ\" takes a value, \"enableXYZ\"/\"disableXYZ\" does not. Before, I had some \"setXYZ\" with a value, and some \"setXYZ\" without value, which was too confusing, so I renamed the ones without value. Taking or not taking a value is mostly determined by whether the property is ever given at least more than a single value, although it possible I missed some case there.\n\nMaybe setIsTreatmentRoom, taking an optional bool for consistency?\n\nI had that at some point, but then you have these property setters that only ever assign \"true\", which looks silly too (in particular with properties used in the negative sense \"setNoWait(true)\"-like calls).\n\nMy understanding is that required fields go in the constructor\n\nThat is the intention indeed\n. Updated the branch:\n- Added the setPoint() property into the SpawnAction constructor (spawn rewrite)\n- Fixed the \"action.must_happen\" in seek_reception (queue rewrite)\n- Fixed two typos found by luacheck diff (use_object rewrite)\n- Fixed the doc problem (spawn rewrite)\n. Queueing sink action gets completely rewritten in 'use object rewrite' in commit 141517c, resolving the indent problem\n. Fixes:\n- walk rewrite: \": continuation lines\"\n- queue rewrite: \": continuation lines\"\n- split function from cardiogram... : fix cardiogram loop_callback function name\n- split function from blood room... : fix commit message typo\n- split function from toilets action...: Did not fix incorrect indent, it's not fatal, and gets removed further in the queue anyway\n- use_object rewrite:\n  - Use enableWatering as property instead of setWatering\n  - \": continuation lines\"\n  - setProlongedUsage() argment fixes\n  - use disableTruncate everywhere\n- multi_use rewrite:\n  - setProlongedUsage() argment fixes\n  - use disableTruncate everywhere\n  - add setLayer3 property method\n- futher enhancements: Small action simplifications with action properties not noticed before\n. merged the 'further enhancements' into the walk rewrite, thanks for all your efforts here\n. Clearly a case of writing too much C++ :)\nThanks for finding, fixed it.\n. Fixed typo \"diable\" -> \"disable\", and reverted the accident (looks like git tried to be too smart in applying a patch at first sight)\n. Fixed the messed up loop callback, the original inline persistable function line was not replaced with the newly introduced loop_callback_training variable.\nDiff between new head and the previous head is empty, ie no changes got introduced in the final rewrite result.\n. \\o/\n. Yep, lots of internal book-keeping and callbacks triggering at the wrong moment making messes. I'd be +1 for removing what's possible.\n. The build callback has protection against going to the wrong room, line 247:\nlua\n-- So the room that we're going to is not actually the room we waited for to be built.\n-- Example: Will go to ward, but is waiting for the operating theatre.\n-- Clean up and start over to find the room we actually want to go to.\nAlso, there is a remove_callback, doesn't that one need to be fixed too?\nEdit: Like I said, this callback stuff is just too freaking complicated to get right :(\n. Comments suggest it measures average queue length. Since exploded rooms have 0 queue length, the average decreases if you have many exploded rooms.\nLine 301 CorsixTH/Lua/entities/vip.lua counts queues for non-exploded rooms, line 309 then divides by all rooms, including the exploded rooms.\nIt's fine to name it maintenance efficiency or whatever, but then the comment is wrong.\nI am well aware of not properly handling multiple hospitals all throughout the code, but if we ever want multiplayer, they must be found and fixed at some time, and I see no reason not to start with that now, fixing what you encounter.\n. All fixed\n. rebased, updated game version number\n. drop removing holes by cleaning the hospital, and add removal by placing object on top of it.\n. New version, ratholes get removed when building objects, and rooms, generalizing the world: remove litter functions. Also, you can use objects and rooms to remove ratholes\n. Fixed spaces\nlua\nlocal hole = {x = x, y = y, wall = wall, parcel = parcel}\nindenting the if didn't look right, so I added an empty line too\n``` lua\n    if rathole.x == hole.x and rathole.y == hole.y and rathole.wall == hole.wall then\n      table.remove(self.ratholes, i)\n      if rathole.object then\n        self.world:destroyEntity(rathole.object)\n      end\n  break\nend\n\n```\nThat should be enough :)\n. In C/C++ it also dumps the failed assert, I might be confused with that.\nI agree a message is useful. I was mostly worried about the fact that you write the same thing both in code and in words. On the other hand, if you run into this thing in development, it's nice to  get a description of what is expected immediately without having to check those lines.\nBoth descriptions are fine to me, do what your :heart: tells you, or throw a :game_die: to decide.\n. Resolved all litter problems I know about\n- Litter is stackable now\n- Handyman tasks don't remove the wrong task any more (causing the non-cleanable vomits)\n- Cleanable (ie non-exploded litter) litter stays buildable, rooms and objects can be built on it, and litter will be removed.\n- Improved finding the correct hospital on the map.\nFirst 2 patches need removed, and sane new game version number needs to be assigned\n. Removed the debug patches from the start of the queue, and improved the getHospital function by using plots, which is indeed much faster, thanks for the suggestion.\n. Even faster getHospital function :)\n. Loooong patch queue, but it addresses all points raised by lua check.\nMany thanks to bobcanthelpyou for the initial start of the patch in #972 \nThings are split by file, and while it's a lot of patches, they seem quite readable.\n. This isn't working, merging 120 patches with changes at every 50 lines or so, with random improvements just makes huge mess\n. Merging this in smaller steps instead\n. No idea how to retrigger the build, it failed on getting cth-deps from GH.\n. fixed, running a quick edit room test caught two other errors in room editing\n. There is also the research that improves machines.\nEven then, I am not so sure having 100% diagnosis by whatever means is a situation that should be reachable. It would basically mean you can stop playing, as the hospital completely runs itself. It would become a movie instead of an interactive game.\n. Like #275 ?\n. Luacheck fails on catching this. It reports\nChecking CorsixTH/Lua/entities/patient.lua        8 warnings\nCorsixTH/Lua/entities/patient.lua:202:11: (W211) unused variable diagnosis_bonus\nCorsixTH/Lua/entities/patient.lua:202:11: (W421) shadowing definition of variable diagnosis_bonus on line 184\nCorsixTH/Lua/entities/patient.lua:762:63: (W212) unused argument x\nCorsixTH/Lua/entities/patient.lua:762:66: (W212) unused argument y\nCorsixTH/Lua/entities/patient.lua:855:11: (W213) unused loop variable i\nCorsixTH/Lua/entities/patient.lua:992:7: (W213) unused loop variable i\nCorsixTH/Lua/entities/patient.lua:1089:5: (W542) empty if branch\nCorsixTH/Lua/entities/patient.lua:1174:82: (W212) unused argument room\nNothing about the call to drawbar being wrong.\nOnly ignore on patient is\nlua\nfiles[\"CorsixTH/Lua/entities/patient.lua\"].ignore = {\"callbackNewRoom\"}\n. Thanks for the review.\nThe code is fixable, but after making the above patch, I am having doubts that this is the right solution. Sorry for not explaining earlier, but only after talking with @sadger yesterday, the problem became clear enough to be able to express it in words.\nThe patch will work for the simple stuff I think. Plants, bins, walls, etc. Gui stuff should work too. (Basically, because we probably never want anything else there, I realize now.)\nWhat I am having doubts about are the animations with people in it. Current code is completely tailored for the graphics that we now have. Woman walking north is animation XYZ, with layer flags for head, cloths. Woman walking west is also animation XYZ with some mirror flag and the same cloth/head flags.\nSo if we replace animation XYZ with new graphics, we're going to be stuck with that one animation and a set of flags that is being used for woman walking west and north with some layer flags for cloths and head. You cannot add a new animation for walking north only, or for the woman with the long hair or.. etc.\nIs this something we want or should want?\n. I can see that \"room_info\" isn't optimal, but at least it somewhat says what it contains. Your proposed \"data\" is a bit too generic I think, as it can contain anything by that name. Maybe it should be some name with a \"static\", \"fixed\", or \"properties\" or so, notion.\nWhat I am missing are changes in all the room files (rooms/*.lua). Perhaps there is a structural problem there, or the wrong name is used or so? Would be nice to have that consistent too.\nAs for old saves dying, yep, they do if you rename a field. \"Save\" means literally store the current state, as in \"save all reachable Lua tables\". \"Load\" means then \"re-instate the Lua tables from the file\". Function names are saved for all class methods and all --[[persistable:....]] magic functions. In particular, the code itself is not saved.\nThus if you change a field in the code, and you load an old save, the changed code is trying to find the new name, which fails, since the loaded data still contains the old field name.\nThe current solution to this problem is to increment the savegame version in app.lua, and add an 'if' to the afterLoad method(s) to fix the loaded data.\n. updated\n. Hi MarkL and EythanF,\nThe reason these bugs are so hard to fix is that they are only found long after the bad part has done its dirty job, when the entire state is one big mess that is impossible to untangle.\nWe added more checks when actions are created in the development version, so the program will abort with an error when an \"impossible\" command is created, ie catch the bad part \"in the act\" so to say.\nWe hope to find the real cause in this way.\nHowever, until someone plays the CorsixTH version in the master branch and reports such an error message, it's all just theory.\n. Great! Thanks for testing.\n. Fixed them now, and one extra for bonus. I don't usually keep notes, as I forget them anyway.\nMoved the other 'sheet' variable instead, which looks like it should work too.\n. Further improvements\n. Hi, you seem to have trouble with git.\nThings work a lot better if you make a new branch at master, before you start adding your changes:\nsh\ngit checkout master   # Switch to master\ngit branch mybranch # Make a new branch\ngit checkout mybranch # Switch to the new branch\nIn this way, you're not so badly affected when master moves.\nIn general, NEVER commit anything directly to master, always use a separate branch.\nWhen you want to copy changes in master at the CorsixTH repository into your master branch:\nsh\ngit checkout master # Switch to your master\ngit fetch upstream # Pull new changes in (assumes 'upstream' points to the central CorsixTH repository)\ngit merge --ff-only upstream/master  # Merge new changes from upstream into your master\nThe '--ff-only' flag ensures, your master will stay a proper mirror of the CorsixTH master, so you keep a clean base version.\nWhen you want to incorporate new local master changes into your work, do a rebase:\n``` sh\ngit checkout mybranch # Switch to your branch\ngit rebase master  # Move your patch onto the new master.\nThis may fail if there are modifications close to each other. In that case, you need to fix them\n```\nI am not sure why you make new PRs and close them after a while by yourself.\nIf you prefix the PR title with \"[WIP]\" we won't touch it. If you prefix with \"[RFC]\" it means you're asking for feedback (which we'll be happy to provide), finally, prefix \"[RDY]\" means 'ready for merging', that is, you think everything is ready.\nYou can update the changes of a PR by pushing the same 'mybranch' again. Github will notice it, and update the PR.\nLast but not least, if you want more interaction, please join the #corsixth IRC channel, we may not always be there, but be patient, eventually someone will join.\n. This looks like a handyman sweeping a litter that no longer exists. Likely the handyman got the link to the litter when he accepted the call from the call dispatcher. While he walked to the spot, the litter got removed in some way. Did you build over some litter at the spot of the crash not too long before?\n. Hmm, no recent changes thus.\nAs for litter cleaning in the calls dispatcher, hmm, yeah, you're correct. I forgot about the second call dispatcher thing we have, called \"handymantasks\". For some reason that was added, instead of fixing the real call dispatcher. Iirc it was not done clean either, and the tasks are now in both systems iirc, further complicating things.\n. The proper solution imho is to notify the handyman to find another job, so he doesn't walk to the old position to put his broom away. For this, we need to find the spot when the litter was removed. Afaik you can remove litter only by cleaning, or by building something on it.\nNormal practice is that we do send out a notice, so either we missed one case, or the handyman ignores the notification in some way.\n. Right, this confirms my suspicion, handyman code is severely broken. What I think is happening is as follows, see https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/entities/staff.lua#L966 .\nHandyman gets new task (lines 967-969), ie the cleaning task with the litter object. Lines 971 to 976 add a walk action to the action queue, followed by the sweep action at line 977, and 'ready' claiming at line 978 (I think). In particular, note that task.object (ie the litter) is passed into the sweep action here, at the moment he gets the assignment.\nNow while the handyman is doing the first action, walking to the tile, you make the assignment invalid by removing the litter. Likely (but not checked), the litter warns the task system (but perhaps not the handyman task system?) that it got removed. The walk action is at least not aborted (or he would not arrive at the tile to sweep). The sweep task itself also doesn't check anything, it blindly assumes the object it got is still valid at the time it becomes running. See also https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/humanoid_actions/sweep_floor.lua\nSo the handyman sweeps the floor, and then tries to remove the non-existing litter, which fails (of course).\nThe root cause of this error is the assumption that a reference to an object remains valid while time progresses. That is a false assumption. A reference to some other object may become invalid at any time. Rooms, humanoids, objects, doors, etc, etc may all simply disappear without notifying you. The only things reasonable constant are walls and floor tiles, and even those change somewhat if you buy plots, for example (they get an owner).\nSo while plumbing this hole is easy enough, it isn't fixing the real issue: All over the place, there are references to various types of objects, where it is quite unknown if they still exist in reality.. Thanks for the report.\nThe handyman system has not changed so far, thus this was to be expected.. You shouldn't be able to build anything you haven't discovered, or get any emergencies for undiscovered diseases, I think. At least it doesn't make much sense to me to allow that. What do you think?\n. Level 1 doesn't really count, as you don't have research there afaik, it's an introducory level into the mechanics.\nI agree there should not be an error, but I also don't know what should happen with an emergency. Do you know what the original game does? Did we write these decisions down somewhere?\nI don't even have any idea what's in a level file too :(\n. Pushed updated branch (plant state list modified as described)\n. Removed the \"--  flag_early_list = 1024\" line entirely from walk.lua, as another file still has it.\n. Added list with plant state numbers\n. It's weird that a bench has a special case, can you explain why that is? That is, I don't understand why the empty tile of say, a drinks machine is different from an empty tile of a bench.\nIf there is an explanation we should document that in the code, I think, so it won't get lost. If there is no explanation, something fishy is going on, that needs further investigation. Making special cases without clear understanding why it is the right solution doesn't seem like a good idea to me.. Ok, fair enough. So the bench is different. Your explanation however suggests it's a systematic difference. That tile of the bench behaves different from other passable tiles.\nWhy not change or create a new tile type, add that to the bench, and adjust the code for that new tile type?\nThat gets rid of all the special case \"bench\" code that is being scattered around in the code now, and replaces it by another type of tile that has to be dealt with. While the latter is a bit more work, I think it's a much better solution. We may find other objects to need such a tile too, we may somewhen in the future move the bench data to a separate data file, or add more types of benches. In all these cases (and probably there are several others as well), the new tile type will continue to work without trouble, while hard-coded references to benches in the code will all die, and need to be replaced by some complicated new system to handle the generalized bench case or something.\nTrying to keep object as much as possible separately from each other, and interface through some simple means like tile types, will keep the code much more maintainable towards the future.\nPS For the next time, could you drop pictures in the text (github markdown supports images) instead of linking to your private google storage? It's easier to read, and all information is in one place. To preserver all information now, you need to keep those pictures there forever.. Fixed missing space. Replaced // by math.floor, as some luas don't understand integers. If you remove lines, the labels don't move, I see no other way than recompute label position when you add or remove lines.. Well, this would do it. Not sure the commit sequence makes a lot of sense, but it rewrites pretty much the entire file. The sequence is a compromise between not too many commits and not too many changes at the same time.\nPatch only solves the positioning problem of the graph labels. The text-label colour problem is currently blocked (for me) at the magic Lua/C++ bridge for fonts.. And Travis likes it too, yay!. Moved the comment to just above \"busted\" download. Issue #1174 StuckSliders.sav.zip  reproduces for me, at dec 31\nEdit: No need to do anything, just wait.\nIn the mean time, you could play with the sliders, and figure out how they get stuck.. It throws the error you had too, at Jan 1st, without doing anything. Savegame is in the last days of December, probably just before the problem started. It's great as we now have a reliable way to reproduce the error, so the origin can be traced and it can be fixed.. It's a matter of having bad luck, which apparently doesn't happen often.\nI managed to reproduce it once with the \"2\" save game, but trying a second time didn't fail again.. Thanks @MarkL1961, fixed that.\nI also updated the patch for comments by @TheCycoONE . And fixed again, please review. Comment in the afterload fixed. Thanks for testing!. Just expressing it is super-extra sure we got a diagnosis :p \nYou are right of course, it should be limited to 100%.\n. Looks like a duplicate of #1172 that points to https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/rooms/operating_theatre.lua#L113 \n. Corsix/Src/sdl_core.cpp sets \"track_fps = true;\" in \"init\", see line 81 (or search for track_fps in the file).\nPerhaps the Lua value is not copied to the C++ code if there is no config file?\n. luarocks is an install system for lua, like apt-get is one for packages. You still need to install lfs.\nMy Fedora system has lfs in the package system, as \"lua-filesystem-1.6.3-3.fc24.x86_64\". Maybe debian also has such packages.. I am not sure, but issue #1160 seems to discuss this.. https://github.com/CorsixTH/CorsixTH/wiki/Localization should explain most of the stuff you want to know\nAs for giving us results, we accept\n- proper PRs (pull requests) if you know how to make them, or\n- just edit the language file, and attach the modified language file to this issue, and we'll merge it.\nThanks!. PR would be great!\nSome things to watch out for, in that case:\n- No TABs, only use spaces.\n  Different people have different ideas about length of TABs. To avoid problems, we only use spaces. To be precise 2 spaces at each indent level.\n  It's simplest if your editor can convert TABs to spaces.\n\n\nNo trailing whitespace.\n  In particular, many editors make a mess at empty lines.\n  Simplest check is to search for a space at the end of a line. Do this after you replaced TABs to spaces.\n. - Notepad++ should work. Please make sure you use \"UTF-8\" (or \"Unicode\") when saving the file.\n\n\n\"Trailing whitespace\" are spaces or TAB characters after the last letter of a line.\n\n\nSince whitespace is hard to see, I'll given an example with \"trailing %\"\ntext\n%%some text%%%%\n^^         ^^^^^ Trailing %, these should not be here.\nLeading %, and that's ok\n\nFew reviewed the file, and I do not like here for example the structure of the russian.lua file. It seems that just after the update added the option you want and its translation. It will be necessary to reduce the amount of code a bit. Even it will be interesting, as it himself throw a challenge.\n\nBoth forms are the same in Lua, you are free to change the lines, but do 1 thing at a time. Either improve translation, or modify structure, but not together.\nIf you do them together it becomes very hard to understand what is being modified.\n\n\nIf you have not done already, you can fork the CorsixTH repository to your own account, and work in there. (Use the \"Fork\" button at the top-right of this page)\nhttps://help.github.com/articles/fork-a-repo/  gives more details\n\n\nadviser.tutorial.build_reception (and many others):\nThe game uses the English strings of the original Theme Hospital disk. The \"english.lua\" file only contains new strings (not in the original version), and a few fixed strings, I think.\n\n\nSince the original Theme Hospital disk does not have Russian strings, you must provide a Russian translation for all original strings (such as adviser.tutorial.build_reception), and you must provide a Russian translation for all new and fixed strings.\nFor this reason, many of the language files are very large.. \nIt's hard to see what is happening, so I enlarged the numbers a bit. I hope you added the red line, at least I don't know where that could come from otherwise.\nYou can see clearly that the font of the digits are too small, two numbers fit in one wheel.\nPerhaps you are using a font that cannot provide digits of the right size?\nWhat font do you use, and what happens if you try another font?. You will design around 1,000,000 characters, so we cover all languages that exist in the world?\nAssuming you will not, maybe your time is best spend by finding a suitable set of free .ttf font files that can be used?. While testing, it appears that in the settings.\n- A \"scale\" parameter was added, and\n- Size of the screen is interpreted as unscaled size.\nPlease extend the textual description how to interpret the scale and the screen size here.. good point. In OpenGL you can configure interpolation with GL_LINEAR, see \"Texture Filtering\" at https://learnopengl.com/#!Getting-started/Textures . If SDL uses opengl for this, it may be configurable too. 0 or \"nearest\" looks like very much \"just take the pixel\". OpenGL also names it \"nearest\". Does that do anything useful? (In the sense that the white of the letters should stay white, and not get interpolated or anti-aliased with background (which the OP sees as blurring, I think).). Patients and staff getting stuck isn't supposed to happen, but these bugs are hard to track down and eliminate.\nRooms getting destroyed is part of the game, and are supposed to happen. I agree it's annoying, but that's the whole point of it. Some work has been done to earth quakes to reduce the effect, and that will be in the next release. It will be a while before that happens though.\n. At least the \"charges\" messages have been translated already in the master development branch. I don't know if there are development builds currently (there used to be), but you may want to try one of those instead.\nAlternatively, you can get the spanish translation from https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/languages/spanish.lua ,  which in your installed version is a path like CorsixTH/Lua/Languages/spanish.lua (I don't know the precise install details, but it shouldn't be difficult to find the file, as there is only one spanish.lua file  :)\nYou can also modify that file if you like, compare with the english.lua file to see how the patterns work.\nIf you want to submit changes, start from the github spanish.lua file (so you're updating against the newest version), improve the translation, and submit the changed file (if possible as a text-attachment, so we don't get a message of 3000+ lines of code here).\n. Something is wrong :)\nTo analyze and eventually solve the problem however, we need a guide to reproduce the problem quickly. While testing, we may need to try the same situation a few dozen times, and a guide like \"play corsixth for a few weeks\" doesn't quite work then.\nDo you have a way to get this problem again in say 1 minute? Usually it starts with loading a game, then letting it run for 10-30 seconds doing nothing, or doing some specific instructions, leading to the crash.\nIf you have, please upload the savegame, and tell us how to cause it to crash again.. good find!. I think you will find it's boring game play, ie there is no challenge at all in such a level. @overlordchaos  fair enough, if you share the game level that you made, we can add it to the distribution and let others try it too. Discussions at SO suggest the computer tries to execute code at a place where no executable code is expected (such as a data area or a stack area). However, as German is not my native language, I don't quite understand what it says (yay for translated error messages in an international project).\nWe don't provide OpenSuse packages afaik, so your best bet is to report to whoever supplied you your package (probably opensuse). Once they established the fault is not in their code, they likely report an upstream error back to us.\nI briefly looked for corsixth errors at opensuse, but they don't seem to exist, at least without having an account.. https://software.opensuse.org/package/ffmpeg says\nThis build of ffmpeg is limited in the number of codecs supported.\n\nhttp://opensuse-guide.org/codecs.php (the onoffical guide for Leap 42.3) says\nBy default only free, open, non-patent encumbered formats such as Ogg Theora, Ogg Vorbis and Flac are supported for legal reasons (US software patents and Digital Millennium Copyright Act (DMCA)).\n\nAnd then continues how to install them yourself (normal trick by distributions to avoid being a distributor of codecs).\nIs it possible to detect that no codec was found for the format? Then it would work if the user installed the codec himself, and not crash if there is no codec.. Make unit tests stuff optional in cmake?\nUsers building a version for themselves don't necessarily want to download and run external projects. How is having spaces in directories a good idea?. Hex is better than decimal if you're working with bits, since you can immediately see the bit patterns that the number expresses (I read eg 0xC0 as 1100.0000, I never even consider its numeric value 12*16).\n. Some documentation lines for the new require function, but that's all that seems to be missing.\nNice work!. std::ptrdiff_t eh? New types pop up all the time :p. Conversion of alignment string to enum value seems to be duplicated, and enumeration class names are not consistent, but both are out of scope for this patch I think.\n. I always use CamelCase for classes. Prefixes are silly, use a namespace if you're worried the code will be used in another library with clashing names (ie not going to happen is my guess).\nI use lower_case for variables. Functions/methods are always a bit of a problem, I often use CamelCase too, as they have an active form DoSomething, while classes usually have a more passive wording like DataStore. My alternative form for functions is like_variables. notInitialCamelCase for functions could work too, but I find it less pretty, not sure why.\nI would likely write enum values AS_ALL_UPPERCASE, as they are constants to me, but that may look bad together with the forced prefix.. Except for the standard #include protection, I don't use preprocessor macros in c++. In c, I only use it for plain expressions, that should be 'inline' functions, but c89 (yes, indeed, that old :( ) doesn't have that.. Perhaps to distinguish between a literal English sentence and an English translation of a sentence.. I am confused, the overall if #self.world.rooms ~= 0 is still there.\nYou do realize that it's an unneeded check right? If there are no rooms in the world, the loop will never iterate, so room_count will be 0. Checking that after counting will not only cover having no rooms in the world, but also cover rooms without door.queue, or only having crashed rooms, as what the current patch seems to exclude now as well.. Yes, a / b where b can be 0 is always dangerous :)\nI was suggesting\n```\nfor room in world.rooms do\n  if room \"is a valid room\" then room_count = room_count + 1 end\nend\n-- room_count will be 0 if self,world.rooms == 0 or if no valid room exists.\nif room_count == 0 then  -- viprating is -100\nelse if queue size == 0 then -- viprating is 6\nelse -- do ratio calculation\nend\n```\nIn that way you get -100 for no functioning rooms (which is more general than no rooms at all worldwide), and avoid the crash at the same time.. Indenting looks horribly wrong, don't use tab, use 2 spaces for indenting instead. Hmm, and I liked your positive name \"room_information_dialogs\" instead of the negated form \"room_information_dialogs_off\" which just complicates matters without good reason ;). Nice!\nI think you should start by taking unrelated (like annual report), and somewhat related (refactoring existing hospital/etc code) changes out of this, and make them their own small PRs.\nThat way, you improve the existing code, and pave the way for adding the AI hospital.. I went through the changes in varying states of awakiness, hopefully I covered most of the problems. Lots of comments are not even about the names, I think, at some point I just started writing things that looked wrong, so feel free to move them to the list, or even totally ignore them.\nThe same somewhat applies to renaming suggestions, in the end, as long as the name is unique, it's fine. There are likely more serious things wrong that need fixing than a name.. @Grimdoc\nHi, I just converted your zip above to a commit in #1437 \nI removed the BOM marker from the start of the file, and deleted all whitespace at the end of the lines.\nNo idea what you actually changed, you moved so many lines around, git can't make head or tails from it. Basically it says \"these 35 pages of text got replaced by those 35 pages\".\nAnyway, above, AdamFx990 tried some other changes as well, but those never got merged. Is there anything worth rescuing in those changes?\n. Ok, thanks for the check, let's see if this can be merged now :). A layer woven into the entire program to ~~fix~~ work around the broken persistence?. You know the original TH aimed at a lot of micro-managing?\nAutomating shuffling of staff seems a move away from that.. Code-style for the multi-line 'if' statements is wrong, the 'and' or 'or' should not be at the beginning of the next line, and be indented twice. You may want to check the guldelines:\nhttps://github.com/CorsixTH/CorsixTH/wiki/Coding-Conventions#lua-code. Thanks for the update, looks good, hopefully travis doesn't get stuck again\nEdit: Perhaps something in the check scripts got broken? (no idea how to figure out what though :(\nEdit: Poth pylint3 en pylint2 only give warnings and recommendations on the check scripts (ie no errors). About the catches, I was wondering if the files run in the wrong directory or so?\nAbout the PR builds: It's there, at the top-right is \"more options\" dropdown, with one item \"requests\". There are 2 \"abuse detected\" entries, but no other information that I could find. Good point.\nNaming something \"root\" but then appending it to cwd seems quite counter-intuitive anyway. That should probably be fixed. If you want to fix it further, moving away from python2 seems useful, as is adding a check that we actually do some scanning, to avoid running the program at some directory where no source exists without knowing.\nOn the other hand if\n${TRAVIS_BUILD_DIR}/scripts/check_trailing_whitespaces.py $TRAVIS_BUILD_DIR\nruns, then $TRAVIS_BUILD_DIR is obviously in the checked out repo, so at worst it would scan the entire checked out content.. @antonv6 I have had contact with travis-ci support, and they say\nThe issue is that @antonv6 on GitHub, the author of the pull request\n(https://github.com/CorsixTH/CorsixTH/pull/1430) has not logged into Travis CI before.\nThis causes our abuse detection system to false positive since the user can't be found\nin our database. The solution is to ask @antonv6 to login to https://travis-ci.org at least\nonce so an account is created for them so we can run builds for them in the background\nwhen they push code to your (and other) repositories.\n\nNo abuse has been done, just a false positive and requesting they log into our website with\ntheir GitHub user is the solution. Once they have done that, you can have them push a new\ncommit to the pull request and we will start a build.\n\nNot sure I like this requirement (it's new to us as well), but it's your choice.. ok, shall send more email then :(. @antonv6  Quite a bumpy ride, but thanks for your time and contributions. Just minor stuff, looking great, nice job. I tried to fix this problem, would this be better?\nhttps://github.com/CorsixTH/CorsixTH/wiki/How-To-Compile/_compare/feafcb3fe5650cb693ef036dd4d07818f6d8e5cf...4b68c60d5be89b9a94ec13a68f18494f8a14c0de. Nice! Sorry for not getting online, but terribly busy. Any particular reason you don't fold the _check..(..) thingie directly in the 'if' ? the boolean is used one time, and \"bool isSplitTile = \" is longer than \"if (\".\n. Commit misses documentation what magic return value means (checkDividers == true, does that mean it's checked, or checked good, or needs fixed, or ... ?\n. I'd add a \\n after the \"and\" at line 322, and indent the remaining text 4 spaces relative to the \"if\" (ie double indent on continuation lines).\nFor line 323, \"self.app.walls[self.app.world.rooms[dir.room_cell_flags.roomId]\" looks like \"room_type\" or so to me, so I'd assign that to that variable above line 323 as intermediate step.\nOtherwise, the function looks much better with the table.\n. The aim of this patch was to fix a lot of formatting nuisances I had for a long time. For the actions, it was mostly lack of parentheses, but the big literals didn't look nicely either, and a few experiments with a more function-call like syntax proved to be very useful.\nI haven't studied the actions in much detail, and I am not sure I want to go there. At the surface it all looks very much duplicated and overly complicated to me. I believe the reason is that the code is trying to decide the next action from the end of the current action. (Would love some feedback about that, but it's not trivial to say the least.)\nSome actions (probably the older code, like toilets, and gp) hook that into the \"on-exit\" call, leading to nested persistent recursive functions. Other actions push things into the action_queue (probably was added after deciding nested persistent recursive functions aren't very nice). Then you get problems like pick_up, or interrupts like getting thirsty or going to the toilets, which break such a queue, leading to more work-arounds. Someone messes up and you get an empty action queue, which then leads to new code to decide what to do in that case.\nSo, in all, I believe the core problem is the chain of actions. Instead, I think there should be a point in a humanoid or object(?) that tracks what it is aiming to do long and short term, and generate actions from that. An action is then not much more than an animation. All logic of what to do next moves to that tracking point.\nOne form of such a point is a state machine, but I am not sure it's the best solution.\nOne thing I haven't decided what to make of it, are the registered callbacks that happen all over the place. I think they complicate matters, but don't know how badly.\nAs for your questions, technically the \", true\" is the replacement priority for already existing actions rather than the priority of the new action. (I agree however you can see it as the priority of the new action as well.)\nI haven't looked at the details of that priority flag, but it looks like very bad smelling code to me. In fact, the entire action queue smells, as I just explained. Currently, it looks like a waste of time trying to fix actions, to me, as explained above.\n. The idea was that people staying longer in the hospital and dropping litter have less litter to drop later, but otherwise, not really.\nSplitting between the first and next literings make it feasible to hit bigger / less efficient hospitals harder of softer. Not sure what the right values are here, likely they need a little tweaking later.\n. \\Levels  instead of  \\Saves  ?\n. Other places use it as a list (which is stupid imho, but I am doing patient rather than hospital atm).\n. doxygen comments are not adjusted for these new parameters\n. You can't just remove arguments, also delete the function parameters at line 21\n. This looks weird, simpler would be  local count2 = #t2  and removal of the loop, as far as I can see\n. would be better to add this in the first commit, so new files are all added at the same time\n. Removing this one is wrong, it's used at the line below\nIt's also not defined above, it seems\n(there was one such line duplicate, but that has been removed already, maybe your patch rebase broke made the wrong guess here?)\n. dx and dy typically express \"difference x\" or \"difference y\", rather use xpos, or x_pos, or something like that, as it expresses \"position\", much what x or y does.\n. Here, use something that expresses \"position\" too\n. \"func\" expresses function, so the code here tries to print a function, it seems\nbetter make it \"err_message\"  or \"err_msg\" or so.\n. this is actually a bug fix :)\n. Abbreviating the name throws away information, in this case \"pairs(load_info)\" looks wrong (iterating over a non-plural value looks weird.\nI would suggest you rename that variable to \"load_infos\" instead to express it's a container with many values (and the self.load_info is thus also wrong, but better not touch that, it could be used in many places)\n. perhaps errors_level ?\n. as this looks more map-ish, eg \"errors_map\" for example?\n. Just delete the assignment completely, ie only call the function \"self.sound_fx:play(...)\"\n. this one is tricky to delete; it looks like it is used for debugging, so the function may get called from something outside this program (which luacheck probably doesn't understand), better keep this\n. we need to declare _  ?  seems a bit silly, imho. Why?\n. should be  for _ = 1, size do\n. Alternatively, add the 'else' in comment too:\nlua\n-- else: Other humanoids shouldn't be entering, so don't worry about them\n. This table should be renamed \"load_infos\"\n. Definitely better, I agree\n. there is also a singular load_info variable there. Perhaps use load_info_table here instead?\n. Continuation lines have double indent. I'd also merge line 25 after this one, but that's optional :)\n. Any chance in getting more indenting in these continuation lines?\n. Misses 'nil' as possible value (doc string above also misses that)\nI am not so sure about the usefulness of the messages, as they seem to duplicate the code, but if you like them, why not.\n. missing nil as value\n. maybe refactor the direction test out into a separate function? it seems to happen a lot.\n. misses nil in the error message\n. misses nil in the error message\n. There is a TAB character in this line, please replace by spaces.\n. Another comment said a bar would be half-filled if it has an unknown value. I think 20 is close enough to 22 to make that hold.\n. Indeed, tested this too\n. Make a local variable for the max screen shift, 'multi' can be moved inside the condition too, judging by this patch\n. Would be nice if the existence and meaning of the variables was documented too. World constructor would be the primary place now, although that may be less useful for such a large class.\n. Can't comment on the commit, so just tagging it here: The commit message sentence doesn't seem right.\n. Do these new values have to be added to the new table in the afterLoad function too?\n. Instead of magic 100, why not make the shake_screen_intensity have tile units, and do the translation from intensity to tiles in the beginShakeScreen?\n. Please state meaning of the variable as well\n. It looks to me that you're computing when \"big\" shifts should happen\n. Oh, new comment seems fine if the condition also matches that reality :)\n. Would it make sense to initialize to {active=false} ? then you can always query the boolean instead of \"if world.next_earthquake and world.next_earthquake.active then ..\"\n. Assuming you figured out what this function does, it would be helpful to document it\n. I'd expect a test for being active, and not for having a size\n. This is a bugfix\n. I find it easier to read, mostly\n. sure, also fixed at least 38 other cases\n. There is a lot more wrong here (and elsewhere too), my primary aim is to fix all errors reported by luacheck rather than really improving the local code.\nEDIT: I rewrote it, but the longer I look at it, the less sense it makes. The magic numbers to convert to grey scale look like the regular conversion values, but corsix uses 6 bit colour values, as it says in the comment, so shouldn't that get compensated somewhere in the greyscale conversion, and then back to the 6 bit value in the diff calculation?\n. Sounds good, I changed a few more :p\n. It's indeed about fixing the masking, we don't yet agree on the redundancy property :)\n. Documentation purposes, mostly. I don't know another place where those bit numbers and names/explanation are related with each other.\nNote that I also don't know if the complicated way of building the screen is still used/useful; using OpenGL blitting opens a lot of other ways of doing things, like the Z-buffer.\n. It's not optimization, it's eliminating the following warnings:\nCorsixTH/Lua/map.lua:198:7: (W111) setting non-standard global variable _\n    CorsixTH/Lua/map.lua:218:7: (W111) setting non-standard global variable _\n    CorsixTH/Lua/map.lua:221:7: (W111) setting non-standard global variable _\n    CorsixTH/Lua/map.lua:229:7: (W111) setting non-standard global variable _\n    CorsixTH/Lua/map.lua:233:9: (W111) setting non-standard global variable _\n    CorsixTH/Lua/map.lua:249:7: (W111) setting non-standard global variable _\naka luacheck didn't get the memo about your universal convention :p\n. Fair point, replaced this by a line of comment\n. Removed the line, it's also at objects/door.lua, so the link doesn't get lost\n. No it is not an index, as it starts at 0. It also ends at 5, so there is a missing index somewhere.\nI don't want to debug and fix all plant-related stuff now.\n. Maybe a \"hasBit\" function is better, as that's what you're testing here.. You only need to set the field to 'false' once. After that, you can stop iterating over all tiles of all nearby objects. 'true' and 'false'  are very different from '0' or '4', please adapt (or create) the function documentation, so we can read what the magic numbers mean.. no parentheses needed here, Lua is not C, C#, or Java.. This looks a lot like your other function, maybe refactor it into its own function, and use that at both places?. Document the function. Line continuations are done by a double indent on the line below. That avoids that code shifts all the way to the right margin, creating many lines with mostly white space.. more bit tests.\nAlso, all operators have white space around them, \"^\", \">\", and \"\". \"\" needs whitespace. This pattern is actually the only sane way to call this function, why not fold the \"bit\" function into this one, and make the second parameter the bit number you want to test?\n(oh, and please don't make this 1-based, preserving the 2^p relation is a lot saner imho.)\nAlso, document the function. See also https://github.com/CorsixTH/CorsixTH/wiki/CodeDocumentationStyle. Last line should also have a \\n character. For your editor that probably means you should have an empty line below the last code line.. Fixing is easy enough, it's just that all save games will fail to load then.\nWhen saving, ALL the game data gets copied literally into the save, ie all tables with their keys and values (where 'tables' can also be symbol scopes, ie sets of variable names). For values that are a callback function, a string like this is stored. Upon loading, the program looks for the same string again (in the source code iirc), and re-inserts the associated function code as value in the loaded data.. Spurious space:\nc\npParams ->fWindowScale\n       ^\n. Any particular reason for adding empty lines?\nWhile at it, just write a line documentation perhaps?. Weird that you don't need a [i] here, while the previous version had one, and line 256 also seems to have one. SDL woke up 1 thread, but  I guess this is fine, as everybody will find the m_fAborting flag, and quit?. Given that it doesn't push anything, I guess this is missing \"return 0;\" to fix appveyor error. here too \"return 0;\". Any particular reason for this inline import? I'd prefer doing imports at the top of the file to avoid endless searches for imports. move assignment to before the push_back? Gets rid of the -1. for a 1x1 map, pNeightbour is allowed to be m_pCells[0] and m_pCells[1], which seems wrong\nWouldn't it be simpler to check relative_idx ?  EDIT: Never mind, I am talking nonsense. bit 128 is not 0x80, bit 128 is 2**128, which is 340282366920938463463374607431768211456 or 0x100000000000000000000000000000000 (see how hex makes bits much more clear here?).\nYou mean bit 7 and bit 6 here (bit b has value 2**b, starting with b=0, with value 1.. \"the with\" ? needs something in-between?. Doesn't seem to be a B around here.. Comment that repeats what the code says is less than useless. At best, it actually repeats it (giving no new information), less optimal if it says something else (which can only give confusion). Instead, explain what is happening here at a higher level, and clarify the 60, as it's pure magic now.\n. Corsix documents non-static function in the header files.\n(I don't agree with this policy, but that's another matter.). The game seems to use room.door.queue as \"this is a valid room\" condition rather than #self.world.rooms ~= 0. In other words, your change opens the option that there are rooms in the world, but none has a queue, and thus none is counted. (This will break multi-player games, if we ever get them :) )\nWouldn't it be simpler to keep this counting part as it was, and instead use room_count in the vip-rating above your new line 307 (if not rooms -> -100, elif no queue -> +6, else -> complicated calculation) ?. Documentation comment alignment is messed up, that needs to be addressed at some point.\nWhile I like vertical alignment, if we want to change convention, now is likely a good time.. Pretty non-intuitive as function name, but the entire function looks a bit too clever for its own good. Leave the name (I have no better one), and please consider to kill the thing with a std::min call at some point.. Indenting of other arguments is incorrect now. Ha, this works, just find a new name that is equally long!  :D. Perhaps a bit more expressing what the comment says, xpos_on_tile or xpos_within_tile or so?\nApparently this is currently confusing.. This becomes ambiguous, the comment points to a different y than the variable y here, but that difference disappears with your renaming. Arguably, y here is wrong, I'd make it dy at least, or dy_per_tick or so. a comma?! :p . In freerct, I used 256 sub-tile positions, multiplied the tile index by 256, and merged both numbers so I had a single position number that expressed the precise position in the game.. Given its purpose is inheriting (as stated in the comment), destructor should be virtual. Is 2 a magic number that should be eliminated?. bit long, but probably fine. Should such multi-line strings be merged onto a single line at some point?. link_list is a class, make this one too?. looks like it doesn't belong in a map, tbh. typo \"mae\". th_gfx_font has code like render_target* pCanvas, while here the * is near the variable.\nI prefer the latter, as it matches the true semantics of the pointer declaration, but at least it's inconsistent.. As a general policy, would it make sense to have this 0 vs 1 stuff in the Lua <-> C++ bridge only?. Maybe have a policy about these comments, either above or after the declaration. While at it, I think we have both x_foo and bar_x variables. Not sure it is worth the trouble, I usually pick whatever sounds more natural to me.. bit long-ish, perhaps text_area_size ?. Such a shame that we loose the link to the variables by the rename operation, doxygen would need a # prefix (or a full classname:: prefix) to preserve the link.. additional empty line. could merge the class declaration in the template, I think. text_align ?. the need for :: prefix signals to me that font may be too generic as class name.. integer has no meaning does it?\nAlso run_length could be considered an implementation detail, but that somewhat depends on what other encoders we have.. so this sets requirements for iRecordSize. Imho a better solution is to silently fix any given record size to the requirements.. encoder shouldn't store the output imho. path_finder is perhaps better in line with the other code??. Always fun, these *_ to _* conversions :p . th_header looks wrong, I guess this is the weak point of not using camel case for types. I'd go for renaming the class to something more specific, eg sound_header ?. get_number_of_sounds ?. th prefix looks wrong/inconsistent. looks hopelessly silly, the archive should know the number of sounds, or it should be provided as parameter. why does a sound player need to know how many sounds exist. always nice if there is no channel available. what's wrong with sound_archive ?. looks like something that should be shared and re-used at every point where we have a buffer. not sure about abstract_window, sounds more like something that deals with rectangular areas of some size with generic operations on it, rather than a base class that provides common functionality for a gui, but ymmv.. It doesn't look like a proxy, much more like a string computation storage, which I totally do not get.. looks very short compared to the other names. text_layout? At least, it looks like layout information. The fuzzy part is that there is no text in the structure, which makes row_count and width quite weird.. There doesn't seem to be anything \"Lua specific\" in lfs (eg special handling of lua files or so), just regular fs access for lua. Drop the \"lua\" part?. Seems a bit weird to special-check for being the last entry, and not even use either i or text, unless I am missing something.. :+1: \nPeople probably will not report it though, just like nobody reports or fixes the \"remove unknown handler\" spam that is written to the console in some games.. return next(missing) == nil just like the previous change?. Using str.format looks better:\npython\nprint(\"*{}\\\\{}:{}\".format(path, script, found_class)). outermost parentheses are not needed\nAlso, file look like it uses 2 space indenting while python does 4 in pep8. It would be a great addition, but 3.6 sounds a bit too new, my fedora which tends to deploy the newer versions doesn't even has 3.7 yet. There will be many users that use something older.. Some sections have an empty line, while other have not, adding an empty line everywhere probably looks best for the two sections above. was -> is. designs -> builds  ?. This project -> CorsixTH. Consult the readme file for details how to make the game data of Theme Hospital available for the program.. This is a list of the -> Available. Actually, isn't this XDG standard? Afaik, it allows placement of such files elsewhere too??\nNot sure if corsix actually implements that though. Author -> Authors     (plural rather than singular). This is confusing, the first time I read it, I thought it was copyright of corsix-th, rather than this man-page.\nPerhaps add this to comments at the top of the file? Alternatively, make clear this is not about the game.\n. Is it intentional that the = is concatenated with path here? other options do it differently, not to mention line 44. Isn't the demo useful for only a few levels? It now looks asif it's a full alternative for the purchased copy.\nWould be fair to warn about that, I think.. Maybe mention the name of the license as well, for those without Internet while reading the man page?. Perhaps add a comment what these code points are?. I assume the ' ' matched at 656 gets removed (by the looks of it at 633?), so would that mean the character after the line break match you set here also gets removed?. typo fix:\nsuggestion\n  button_accept = \"Accept hotkey assignment above and save them to the disk\",. suggestion\n  button_cancel = \"Cancel the assignment and go back to the options menu\",. Bit much whitespace before the =. ",
    "Dutchy-": "@mrtnptrs You are missing the t in the last word, \"aangemaakt\".\n. The one on the forum at the bottom of the list? That takes me to github new issue...\n. ",
    "sadger": "I am being very picky but the code documentation style which is currently on the wiki says you should include the type of the parameters and returns if you know them. I have seen examples of this in other code such as hospital.lua something like\n...\n!param x (integer) ...\n!param y (integer) \n!returns x,y (integer,nil) the coordinate of the heliport or nil if none is found\n...\nIf you don't think it is necessary we should redecide on a code style. \n. No problem. We are trying to get any submitted code to be commented currently as we have loads of uncommented code. The style guide for comments is on the wiki if you haven't seen it. Apart from these minor things it looks  really good, nice work! \n. Looks good to me now. :+1: \n. We could do that perhaps. Why do we count in months and not years and months anyway? It seems most the calculations are done monthly and yearly is used for some small things. Do you think it would be a big task to just have a year and month variable where year is >1 and month is [1-12]? Doesn't seem very sane the way it works currently and would certainly clean up some confusion. \n. Can this not be converted into years and months and go from there? Or not use years at all and only count in months either way would be clearer imo. \n. I'm just worried it will get a little confused with yet another month counter which adds another variable to keep track of when we probably have too many already also, you will have month and current_month when current_month is the true month. Maybe renaming can get around the latter issue however. \n. I don't really have an issue  with it but it would be better to have less variables doing the same job, don't think we really need year, month, actual_month and so on, they are all representing the same thing. I will start an issue and we'll talk on there. This can be accepted as it is for now. \n. I agree with you @TheCycoONE  if we are to have several \"month\" variables they should be easily identified and distinguished. \n. So the issue stems from the fatigue level of the doctor being nil according to your fix.\nWhy is the fatigue nil in the first place and a doctor who does have a nil fatigue can they get tired at all? It might be worth looking into this, this change does fix the issue directly but I suspect something else is going on, unless there is good reason for the doctor's fatigue to be nil at all! \n:penguin: \n. Do you happen to have a save file you can attach which this occurs on? If you can reproduce hopefully you do have one! \n. Thanks for this feedback it will be taken into account. It's so hard to remember what the original is like after so long so this is very helpful. \n. I think we should get this fix in the master ASAP if nobody can see any problem with it, you cannot even use the progress report in the upstream/master. Of course the save system needs looking at but this works as a temporary fix. :panda_face: \n. You can probably do it in game as well using the lua console through the debug menu. You could modify the reputation directly there since it's only a variable. :koala: \n. Can we name intial_grace something to do with the heating. The comment explains it well but in the lua code it's not entirely clear what it represents. heating_grace_period or grace_before_heating_complains, as an idea? :dog: \n. There is some kind of spawn X many patients before any are contagious for epidemics. You might have been looking at the config for that. If it's only used for one thing at the moment it's name should probably reflect it. We can always change it later. I see you have done it already (have some :cake:) \n. I hate getting lost in the menus if I accidentally change the language to something non-english. \nIt's a good idea I think. Maybe you can pull the string directly from the lua language file name.\ngerman.lua -> German etc. :panda_face: \n. Oh fair enough then use that :)\n. I can confirm it works compiled from 64 bit linux - the LuaSocket message is still present however. \nI tried one of @MarkL1961 saves he couldn't load/save it it worked just fine for me. \n. Looks good to me code-wise.\nFor testing how can one obtain a folder of the custom graphics? \n. @mrtnptrs The two strings are there for a reason like the other strings in that file, one is for the button and the other for the tooltip, please can take a little more time to look exactly why a change has been made before commenting, if everyone does this then the error reports will contain a lot more useful information.\nIt's completely Lua, yes, i'd recommend testing from my clone though as upstream/master may change in the meantime.\nThe git/github issues are not on topic, I will be happy to talk to you on irc or over the mailing list about how the repository and pull request system works with git. \n. Following the discussion in IRC yesterday it looks like infections need amending for epidemics, I have put my ideas on a new wiki page and would like any input and suggestions before it's implemented if possible.\nPage here: https://github.com/CorsixTH/CorsixTH/wiki/Vaccination-infection-idea\n. Yes, I though that. What would you suggest as a solution though, if the\ndisease changes how can they have any diagnosis?\nOn 8 Nov 2013 19:03, \"Edvin\" notifications@github.com wrote:\n\nSounds good. I'm unsure about iv. though. That may make it very difficult\nto treat all patients in time?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/pull/88#issuecomment-28088427\n.\n. So leave the current diagnosis percentage alone? The reason I suggested resetting to 0 is that its a new disease now and the doctors won't know about it. I guess I can cross reference with the diagnosis needed for the new disease though. I'll leave it as it is for now then rather than reset it. \n. My reasoning behind it was if the two diseases do not share any diagnostic steps then nothing has been done towards the diagnosis of the new disease. I will have to take into account perhaps what diagnostic steps are shared between diseases or maybe just keep the diagnostic progress like you say and just move them onto doing the diagnostic steps for the new disease. \n. By \"setting\" do you mean the ContRate? To have it in a level you would have to specify that at least one disease has a ContRate > 0, i'm not sure what i'm supposed to look at, they certainly shouldn't be allowed by default all you should need do is make a disease with some ContRate and it should spawn an infected patient with that strain ContRate% of the time. On a side note this would let visual diseases able to be contagious should the player specify them, not a huge issue. \n\nI think the error is thrown usually due to missing diseases which is caused by the lack of a reception desk or something like that. Did you have a reception desk when you tried? It's the same with spawning any patient I think you'll find. I plan to keep some sort of epidemic cheat but not sure what exactly yet. \nI am currently making changes to how the infections work as epidemics are too easy at the moment apparently, maybe you can confirm this? \n. Probably either would work well. A nice commented example would be just dandy too. \nI can easily fix the issue about it giving an error message when there is no patients/reception desk. \nPeople might want epidemics in free build though? I guess we can adjust the reputation hit and or number still infected to cause an evacuation like you say. \nIf you have the time i'd like to know how hard the epidemics get as the levels get harder and the hospitals more busy that's the main thing I need to sort before this is released. \n. No pressure just whenever you have time it would be good if you could try them out. \n. Oh good that was a bit worrying for a moment. I'm thinking it's going to be  pain to balance them all nicely, we shall see! The function you want is function Hospital:determineIfContagious(patient) if you are interested in how it works. You can manually tweak things there like the infection rate and so on. \n. Hmm you are right there is seems I was under the impression it was ContRate% of them being contagious. Good spot. I'll have a play this weekend thank you for your feedback, on this change do the epidemics seem hard enough? \n. Thank you. It could be a number of things really, not enough infections happening or they are getting cured too quickly to infect. You toggling the icons with the cheat? I'll have a look as I say this weekend let me know if you find anything else of note my brain missed :P \n. Yes the latter, it might help you see what's going on. The only issue with that is it toggles all infected patients even if they belong to different epidemics, not got a decent way to distinguish just yet. \n. Did you get epidemics for king complex etc. when not using cheats? If so that really shouldn't happen! I'll have a look if that is the case.\nWhat happens with the contagious patients is that if there is an epidemic for X then any new X patient comes along they join that epidemic UNLESS there is a cover-up in progress then nothing happens and  they are treated as a normal patient (or should do anyway). If the disease is a new one then a new epidemic is made and added to the pool of epidemics which carries on in the background, it won't stop after one of each is made it will just keep going. For this reason the \"Contagious\" printing statement is a bit useless, i think It does print a message when they get added to an epidemic though so maybe use that instead for your testing. \nWe do need more infections yes, and I may get time this evening to look at that. I will take into account your new potentially contagious calculation to see if that helps things. \nThanks for your input. I am on IRC most evenings if you want to discuss anything in person.\n. Oh I didn't even realise there were any sounds for that sort of thing! Silly me! \nI think you can actually submit a pull request to my branch with the necessary changes which then propagates to my pull request to upstream. If you don't want to do that i'll just add them manually. We'll get epidemics done eventually but seems there is a lot more to do that I thought! \n. Sorry Mark, I haven't had time to have a good luck/change anything hopefully I will find time soon. It should spread to others even if they are not fully diagnosed because it simply compares diseases. I think what we do need is passing the disease on to other non-visual patients with a different disease but that needs  a bit of work. \n. @MarkL1961 @mrtnptrs  and anyone else who has been so kind as to test epidemics so far.\nI am a bit busy at the moment and falling behind on the issues but so they don't get lost in the thread\nI have decided to open the issue tracker on my fork so we can keep track of any issues/errors/bugs on there so they don't get lost in the main released code issue list. I will start moving them over now and we can comment on separate issues that way. Find the issue tracker here: https://github.com/sadger/CorsixTH/issues \n. Glad to have you back @mrtnptrs. Myself and markl are working on improving epidemics from a new branch in my repository I'll send you the details later. \n. @mrtnptrs  We have moved fixing and improving epidemics to my repository so we can deal with all the issues.\nYou can find the repository here: https://github.com/sadger/CorsixTH\nWe are working on the \"experimental-epidemic\" branch for these experimental changes.\nWe are also using the issue tracker in my repository for any purely epidemic issues. \n. I would like some input on this if possible from anyone reading it. What cheats based around epidemics should we have in the game? Currently there is one cheat to spawn a contagious patient and another to toggle the epidemic icons (the little green blobs) which you don't usually see until the epidemic has been discovered in your hospital. Spawning a contagious patient increases the chance of epidemic but isn't guaranteed to create one. Or maybe we don't want any cheats at all. \n. That should be feasible we could just have a cheat that makes the current epidemic limit 0 or makes no patients contagious. Either way would mean no epidemics happen. Although if contagious patients were in the hospital before the cheat was enabled epidemics could potentially happen. \n. The problem is really that spawning a contagious patient doesn't necessarily mean that an epidemic will occur so it's hard to actually make a cheat which causes an epidemic unless you were to automatically infect some random patients and spawn the fax. I'll add a disable cheat and if people want a spawn cheat we can think about it then. @benckx There is a debug mode if you go into your config file and set \"debug = true\". Then you can start the cheat menu with F11 along with getting other debug output. \n. I could certainly try and do that, i'll look at it again this evening. \n. Thanks @MarkL1961. I want to do a little more testing since it's been rebased I did have to fix an icon showing at the wrong time again which was due to me trying to fix another bug. I've also included your map and level in the last commit. \n. @TheCycoONE  I have made those changes you suggested. Any others you see please let me know.\nI have also detailed how the gameplay works in the wikipage \nhttps://github.com/CorsixTH/CorsixTH/wiki/How-epidemics-work\n. Don't worry you two i'll fix this tomorrow :)\n. @TheCycoONE  Formatting done. Also stripped whitespace and aligned the columns in the level file. Hopefully I have done it correctly. If not please let me know.\n. Woooo! Thanks @TheCycoONE \n. Being picky but the function comments need parameter and return types as stated in the wiki. \n. I can see your stack trace is based on the epidemic repository are you on master when testing this? I can't see how epidemics would cause this but just in case. \n. My reason for saying this is i'm not sure how much my sadger/CorsixTh (master) branch is behind CorsixTH/CorsixTH (master) aka upstream/master. I have seen this error before too but just wanted to make sure you were testing it on already made it into master code rather than experimental epidemic code. Ideally you should test it not on my repository but if you don't think it's related then maybe it's ok. :) \n. Sorry my point is, that if you don't think it's related to epidemics you should not be testing it on the epidemic code base. But if it is related move it to my version of the tracker as you say. We'll figure it out one way or another :palm_tree: \n. I tried it with the latest release (on freebuild anyway) and can replicate it. Sometimes it does find the right room to test the action queue you have to see where the GP sends them, so click them as they are leaving the room. \n. Hello, I think the issue maybe be lua 5.2 which the project doesn't currently work with. Either downgrade lua if possible or install 5.1 alongside (most distributions and I assume fedora should let you) and try and install with that by pointing corsix to the correct lua libs. \nSomething like this to build\ncmake  -D LUA_INCLUDE_DIR=/usr/include/lua5.1 \\\n        -D LUA_LIBRARY=/usr/lib/liblua5.1.so \\\n        -D CMAKE_INSTALL_PREFIX=/usr/share/ \\\n        -D CMAKE_BUILD_TYPE=Release .\ncd CorsixTH\nmake\n. Yeah the pull request is in the wrong place, ideally it's from your branch to my experimental branch not CorsixTH, just close the pull request and just point me to your branch and i'll have a look when I get a second. \n. Code looks fine to me! :cake: \n. I can imagine users reporting this as a bug as it changes the behavior (albeit the the correct one). Perhaps we can add an adviser message saying if they fob them off too much they turn up anyway? \n. I like your message, something like that would be very fitting, so at least the player knows to expect one, perhaps we need another one saying he turned up unannounced to just to cement the fact they can't keep fobbing them off. \nI don't think the VIP should be reduced in any way, just treat it like a normal visit.\n. Looks loads better now, great! I use Colemak myself so I understand your problem! Look forward to seeing any of your future contributions. :+1: \n. I can confirm it works testing ArchLinux 64bit with normal full sized keyboard. \n. This looks very interesting and certainly very good for the codebase. I agree it would be interesting to see say all prices at 100% but poorly qualified staff, in this case one would not expect a reputation gain and potentially a reputation loss. It's a very good start and with minor tweaking I think it can be included. From a code point of view, it's well formatted and nicely commented from what I can tell. Definitely needs some testing before it might be merged. \n. Hi @benckx. We would love to get this included. Only thing that really needs doing is sorting out the commit history to one or maybe 2 commits. \n. Oh welcome back @benckx, good to have you back! I have already done some partial rebasing and modifications to the code but haven't had time to finish it myself. We should probably discuss the best plan to go forward with this.\n. Lets go ahead with the new branch, let make all future discussion on the new PR. Please can you refer to this PR in your new PR as it has useful discussions which we can still read after we close it. \n. Closed due to new one opened #971 \n. This is very nice, look forward to powing some rats. The dirtiness functions could be very useful for improving the frequency of epidemics depending the the \"dirtiness\" of the hospital. So keeping it very general is great. \n. Thanks @auguster. I'll take a look at this over the next few days. Those naughty nurses!  :hospital: \n. The save seems to take place during an epidemic but seems to be due to the nurses being fired or quitting so potentially unrelated. \n. I have found a potential bug not sure if it's the cause of this one but if you move a nurse during an epidemic and click outside the hospital you will get a nil reference for a vaccination call being validation. \n/Lua/calls_dispatcher.lua:200: attempt to perform arithmetic on local 'px' (a nil value)\nstack traceback:\n    ./Lua/calls_dispatcher.lua:200: in function 'close_to_patient'\n    ./Lua/calls_dispatcher.lua:211: in function <./Lua/calls_dispatcher.lua:195>\n    (tail call): ?\nSaid that I can't seem to reproduce it on my own saves. I'll have a look into it.\n. If you can find the steps to reproduce the bug that would be really helpful. And if you can get any output from the console too that would be great. \n. It is very rare we get a bug without much console output. So if you run it with a console open or check your gamelog.txt after the crash hopefully you'll get some useful output. \n. Oh Ok, thank you. I'll take a look at that too.\n. Fixed by a713a222e557cf4b366453cee32b1339025a1b41\n. This is still an issue in the latest master (6316114) since sdl2 has been merged. Makes the game unplayable for me. I'll see if I can track down what is causing it. \nVideo of the offending glitches:\nhttps://www.youtube.com/watch?v=ny7aVIUxBno\n. I can confirm that it is the zooming for me causing these glitches. The offending commit for me is commit 476df8b. adding zoom support to sdl2. I tried the fix by @pwaller  but didn't fix any of the glitches for me. But checking out the commit prior to 476df8b I have no graphical issues.\n. Yes it's very likely probably related. I think an intermediate solution might be to disable zooming until it can be fixed properly. \n. I tried that @pwaller but sadly didn't fix it for me :sob: \n. Offending save https://www.dropbox.com/s/3gz9dwqa61jusv2/forsadger.sav?dl=0\n. I've worked out how zerobrane works now and will be trying to add as an option to the debug config. \n. Hi @J-Shep  looks good! Does this come up automatically when an error is detected or does the user have to click a button to  \"send  error report\" bring this up? The later approach would be better I think based on how much corsix crashes. \n. Also you have a typo. It should be \"if you're not going to report this yourself\"\n. I was thinking it should work much like Windows reporting. You get a small popup with 2 buttons 1) Ignore 2) Report Error then when you  select the second option you get your nice error reporting dialog. That way it's not too intrusive. \n. I think that sounds like a good solution @J-Shep. I was just making a suggestion, whatever you think would work best, the easier the player can report and error the better I reckon! \n. Looks good. +1 on the github integration if you can work it in. Not so sure on the severity option as users won't really know how severe their crash is.  Maybe just behind the scenes say if it's a crash or something else?\n. This is fixed with commit 7f7fffa90106098. Changing severity to 0 in the level file will disable earthquakes. \n. I assumed that code fixed it but if it's not the case i'll reopen this then. \n. As you have rightly guessed, because there is a single timer which is shared between epidemics and emergencies with no current support for multiple timers. Also the button on the timer is used for different things across different scenarios. There will never be an emergency when a epidemic is happening and vice versa. Moreover you will never even see an epidemic/emergency fax when the other is active. There is code to detect this so they never conflict (fax.lua if I recall correctly).\nThis was done on purpose and I think we confirmed the original had no such support for multiple timers. Of course it would be nice to have different timer instances but for now this is a non-issue I believe. Perhaps add it to future programming ideas?\nHope that clears it up. :fireworks: \n. Ah ok. Removed the SDL2 bit from the title then. \n. Save file: https://www.dropbox.com/s/tiyi123les6pdfu/epidemicpatients.sav?dl=0\nCan confirm it doesn't break pre 9e962a0.\nLoading in an older version and closing the dialog and saving again fixes the save and new pop up windows seem to work. Looks like it's affecting saves where the dialog is present when the file was saved. Hope that helps.. \n. It's not really a menu it's the staff wage dialog, you could collapse it down to the fax again on save I guess.\n. At the moment they will only vaccinate if the patient is \"static\" they could be waiting in a queue and perhaps sitting. The nurses won't follow patients around currently and will only go to patients they are very near (5 squares away at most). We did play around with some movement of the nurses but they were chasing the patients for ages without success, it seemed better to do it this way. What you experienced is probably a bit different from the original but intended. Hope that clears it up for you.\n. I think this is grounds enough to reopen. I'll look into this myself but looks like a good fix at a glance.. I think with vaccinations they aren't supposed to be very efficient anyway, there is a random chance they don't even happen. They certainly aren't high priority for the nurses. So I think with the entity map fix we could just not handle these edge cases. Depends how easy the fix would be.. I would like to hear @mugmuggy  's take on this but if we don't hear back soon it can be closed following the fix that will improve matters a lot. . There is extra validation done in the vaccinate action which should hopefully avoid any vaccinations through walls https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/humanoid_actions/vaccinate.lua#L53 . Mainly because I don't think we can have a nurse and patient with a wall between them but with neither of them in a room. I think I need to do some testing on how naughty the nurses are after this fix.. I think it should be good enough how it is, thanks @mugmuggy  Closing.. I checked out your branch and I still get most of them. Mostly picking staff/objects up after zooming makes them glitch all over the screen. And graphics are tearing in some places too. \n. They look fine to me now. Thanks @Alberth289346 \n. Do you have any output in your gamelog.txt when that happens? It's found in the same place as your config file.\n. Seems it's something to do with the walk animations from the log you have provided. Needs investigation I think. \n. Hi @Necrobare. Thanks for letting us know.\nThe first thing you mention, what exactly is happening? Is a different icon showing after being clicked? What do you expect to happen that isn't? \nI will look into the one where the patient isn't getting dressed before leaving. This is definitely a bug!\nAny screenshots or save files would help a lot if you can supply them. I would also recommend looking at the wiki of how epidemics work in case it's expected behaviour you are experiencing. \nhttps://github.com/CorsixTH/CorsixTH/wiki/How-epidemics-work\nThanks\n. The patient trying to evacuate whilst not dressed is definitely a bug after some testing. This would go for any diagnostic step that needs the patient to undress.\n\nError in timer handler: \n./CorsixTH/Lua/humanoid_actions/walk.lua:304: Humanoid (Stripped Male Patient 3) without door animations trying to walk through door (from scanner to corridor)\nstack traceback:\nI'll try and fix it! \n. If you remember it differently then I am interested to know what you thought would happen. It was programmed by myself based on various memories by various people. We ended up doing it in the way which seemed most correct. \nAs for the fix it needs verifying but hopefully we will see it in game soon :)\n. @MarkL1961 I explained it by linking to the guide to epidemics I wrote. I'm interested in how he/she might remember it differently as my decisions were based on how you remembered it. \n. Fixed merged for dressing patients. The other part is a non-issue as discussed above.\n. For anyone who might want to if you clone my animation branch https://github.com/sadger/CorsixTH/tree/animations . And enable custom animations in your config.txt . It should try load a plant when you buy a new one. This branch also includes the encoded plant_anims.dat so you don't need to encode them yourself. \nAfter some testing picking it up isn't necessarily needed, simply trying to purchase one while the cursor is on a shadowed tile will cause the crash. \n. Fixed with commit a87af2bec6c8467953cc267bde06d8345e25b92c\n. For me, it fixes the issue which is great! Nice work @pwaller \n. Tested it and confirmed as working. \n. Do you have the output of your gamelog.txt when it freezes or console output? The file  in question will be in your .config/CorsixTH directory\n. Seems OK to me!\n. This is solved now after pr #726 \n. Looks good to me :+1: \n. Hi @Typiskk. Thanks for reporting this. Sorry I didn't see this issue until it was pointed out to me just now. I assume this is during an epidemic or just before one was revealed? Probably can fix this one pretty easily with any luck.\n. It might also be useful to know that luarocks is configured for a certain version of lua typically. If the default luarocks is configured for lua 5.2 then the lfs/lpeg libraries produced will be installed for that version and will not work with the lua 5.1 version you explicitly specify. If you type luarocks into console it should tell you which it is configured for, example of my output:\nLuaRocks scm, a module deployment system for Lua\n...\nCONFIGURATION\n    Lua version: 5.3\n    Configuration files:\n        System: /usr/local/etc/luarocks/config-5.3.lua (ok)\n. Do you have the output of your gamelog.txt on crash? I'll test it on my game too.\n. Stack trace looks similar to #860 - same tryToFindNearbyPatients in trace\n. \"Needing a vaccination\" is it one marked for vaccination with the blob + spray can on their head or one with just a blob or maybe both?\n. Choosing any patient for the start of the cycle sounds reasonable - in our case the first in the table of emergency/epidemic patients. I can't see any measurement of which should be chosen first so any should do the trick to begin with.\n. Is the countdown timer a button? Does it depress when you click it? A video would be very useful if you can provide one :)\n. Thanks, this should help implement it pretty nicely.\n. Out of interest, what does right clicking do if you haven't left clicked first? Does it bring up the dialog or does it centre the patient with no dialog or nothing?\n. Ok your first bullet point is what I meant, in your video you only right click after you have left clicked. I was wondering if it centred without bringing up the dialog but it seems it always brings one up to centre. \n. I think we are confusing right and left clicks which makes this conversation confusing.\nTo my understanding based on the video:\nLeft click - first click brings up the dialog and subsequent clicks centres on the patient\nRight click - cycles to the next patient\nIs this correct?\n. Oh I see. Right ok. So left does nothing until you have right clicked?\n. Right got it now, thank you for your explanation, you have been very helpful. Being slow today. I've got timer clicks working now so i'll try get this behaviour implemented. \n. I'm talking to you in IRC now of course but I have noted these changes and will take a look.\n. Have done the changes to gameplay - and added the sound. The button off centre and the button being on the whole graphic I will do probably tomorrow.\n. Done all these changes now, please can you test them when you get a chance.\n. Well it makes a lot of sense to show one patient because in an epidemic you have to try and find and cure all the patients. Which patient does it show? I think it should be the first infected with the green icon (not cured) epidemic patient as you dont really want to cycle between the cured ones. Can you see if you can tell which it is?\n. Ok, I'll try something out and hopefully its a sensible solution to which one is chosen. We can always change it later\n. Right I have made it so in an\n- Emergency - right click cycles between all patients, left click centres on a patient\n- Epidemic - right click goes to the first infected patient who has not been vaccinated or cured - repeated clicking will not move to another patient until you have vaccinated the first one. Left click still centres on the chosen patient.\n@joewestcott  I have updated my code can you test it for me? Mostly if the behaviour for epidemics is sensible to you, you can create infected patients in the cheat menu to start an epidemic. If it seems odd or restricted please let me know.\n. No, not yet. The behaviour for epidemics needs changing based on some observations of the original. Will do it this weekend.\n. Could do with a quick test slightly modified, didn't hear from @joewestcott about it again. But code is ready.\n. Looking at the edit room code we could optimise the detection of entities in the build area by using the entity map instead of looping through all world entities. It's directly related to this change or might need a fresh PR. \n. OK, thanks for the input guys. \n. Moving forward with this. It's looking great and I think its very nearly ready! Can we try and get the commits squashed down, probably into a single commit for merging and also its easier to review in this state. I know you wanted to do more simulations, but I mentioned it to the others in IRC and we can always balanced it after merging and after its had some play testing. What do you think?\n. The code logic and comments looks good. There is a general consensus that you have overused local functions however, don't really need to make a function local if you are only going to call it once, probably just pull that code out into the member function its nested into.  If you do feel that a function HAS to be local that's probably fine, can either keep it nested or make it a top-level local function.  Will ask the other guys to suggest any things that need changing too so we can move forward with this if you are happy to do the changes.\n. Just a small reminder you have a typo in your commit message, should be \"re-organise\" (GB) or \"re-organize\" (US) depending on preference. \n. Do you have a save game you can provide when these errors are about to occur? Any more information about when they occur? Is it caused by a doctor or a patient for example?\nEpidemics and emergencies cannot happen at the same time because both use the timer, I think the later levels have a lot of contagious patients, so that is what might be causing it. Again a save might be useful in trying to balance this.\n. Think found the cause of this one with @TheCycoONE's help, the patients and staff were not being removed from the lists in Hospital because the calls to setHospital were removed entirely. Will put a PR in soon fixing this.\n. Can confirm this seems to happen at least for one emergency I tried. Needs further investigation. \n. Really appreciate the bug finding, and sorry for any game problems its causing. Looks like we have a whole host of potentially related bugs at the moment but we already have some ideas to fix them! :smile: \n. You certainly must have played a lot to spot some of these bugs. We are always in need of testers too so if you want to help out please stick around, we'd really appreciate it. We are preparing for our new release which is why its extra important to squash these pesky things. Glad you enjoy it on the most part though :smile: \n. Saves just before help if you get them, sometimes you get lucky with Autosaves. Then its easy for us to test as we can test the save before and after the fix. Don't stress too much about pinning it down, just reporting it with as much info as you can helps us out a lot.\n. Thought so @TheCycoONE .  I'll put WIP for this one just because we need to decide if we want after load so the behaviour works for old saves. \n. Looks good to me. Have you tested this fits on the dialog?. Great! Happy to merge as soon as it's confirmed.. Looks great! Thanks for the contribution.. Do you have a save before this occurred by any chance?. Glad you got this fixed :smile: . Firstly, thanks for the contribution. This function can return an integer for the code or false. What does false represent in this function? We usually require contributors to document their functions where possible. Perhaps refactoring might clarify what this function does.\n. How about a function that checks if it is a code from numpad returning a boolean. And then another function which processes that value, then you don't have to return -1, nil or false. Because your function does 2 things it suggests they can be decomposed. \nlua\nif code_from_numpad(code) then\n      process_numpad_code(code)\nend\nCould you please also document your functions the agreed style is found at the bottom of this page:\nhttps://github.com/CorsixTH/CorsixTH/wiki/Coding-Conventions\n. You don't need this whole else condition here. If it doesn't return anything it will return nil anyway but your boolean condition means this shouldn't ever happen anyway. Apart from that changes look nice. \n. Yes it probably should. I'll change it. \n. Typo s/coordniates/coordinates\n. multiples should be multiple if we are being picky - plural noun\n. desire-full should be desirable\n. I tried running the debugger without eclipse set up and got a nil pointer here. These references to \"self.ui\" should just read \"self\" as you are in the UI class. I made these changes myself and it seemed to show the correct error message then. \n. Yeah was just a simple PR, no problem :+1: \n. This check apart from the \"value\" value is identical to the one above. Can probably be written more concisely with an inner loop switch on the value.\n. if next(missing) then be clearer here?\n. Oh yeah, oops, you can, didn't mean to put that in my commits, hope it didnt ruin your testing.\n. This seems like a bit of a hacky solution to me. The patient should be sent home in this function rather than before ideally. Just an idea, maybe a parameter to treated might work  treated(boolean : happyToPay) or maybe that just adds extra complexity. Not sure, open to ideas.\n. I guess this makes sense, the \"enum\" only serves to self-document the reasons for going home, annotating the method would be fine then.\n. I can see both of those things working, go for it. \n. I tried to make this change myself before I think, needs a lot of thinking and restructure I'd agree, reluctant to allow this change into the code base as it is however. I'm sure we can find an agreeable solution.\n. This is a typo in my original one should read \"-- If leaving and no longer in the hospital\"\n. Comment: -- If the other patient has a different disease OR the other patient's disease cannot be changed\n. Indent/modify this in whatever way we agree on\n. ",
    "bobcanthelpyou": "If it is the same issue it is fixed in the SDL2 mixer packages of Debian Jessie, too\nhttps://packages.debian.org/jessie/libsdl2-mixer-2.0-0\n```\nlibsdl2-mixer (2.0.0+dfsg1-5) unstable; urgency=medium\n\nAdd patch fix-750706-upstream-8ef083375857.patch backported from\n    upstream to fix playing speed with timidity backend.  Thanks Sylvain\n    Beucler (Closes: #750706)\n\n-- Manuel A. Fernandez Montecelo mafm@debian.org  Sat, 25 Oct 2014 11:07:28 +0100\n```\nhttp://metadata.ftp-master.debian.org/changelogs//main/libs/libsdl2-mixer/libsdl2-mixer_2.0.0+dfsg1-5_changelog\nBut it could be still a problem on Ubuntu Trusty \nhttp://packages.ubuntu.com/trusty/libsdl2-mixer-2.0-0\n. at the moment it looks like this:\n\nAnd i think it is a good idea to keep it, you could always switch to the languages you could read.\nThe idea of @TheCycoONE is also okay, to add the translation of the actually chosen language to the tool-tip or the brackets of the languages. \nBut what is the befit of adding a translation to it? Would you choose a language if you can't read the origin name? 'Ah of cause its Korean let me chose that!'\n. @MarkL1961 are the dynamic info are still incorrect sometimes?\n. Possibly fixed by #921\n. I am not sure but i think that problem is somehow LuaJIT related, i can't reproduce these freezes with Lua only. But running CorsixTH with LuaJIT the problem occurs very often. Any ideas how to debug problems with LuaJIT? At https://github.com/CorsixTH/CorsixTH/issues/753 is a gdb backtrace but it seems to be not very helpful.\n. @SimplyRyan could you update the profile of CorsixTH at Transifex for the v0.50 release? Also there are some new requests for new languages. Are there some other people that could take care of it?\n. Could reproduce the crash cause of the following code within the function UIEditRoom:enterDoorPhase()\nlocal map, x, y = wall:getTile()\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/dialogs/edit_room.lua#L855\nDoes someone has an idea where to look at why the walls are not drawn but the blueprint of floor? Is it a savegame issue (e.g. the blueprint walls are not saved or something like that)?\nCorsixTH trunk https://github.com/CorsixTH/CorsixTH/commit/5cd0314e28d6360019afc20af211ed0ddd71e719\n.  @J-Shep there are some issues available with a similar 'Can only finish current action' stack traceback\n858 #650 #500 maybe the savegames of these issues could help you.\n. Could reproduce the issue with CorsixTH trunk. Pick up a staff member move the mouse pointer with the stuff member to the left bottom corner or right bottom corner and wait until the border of the map is reached\n```\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The frame handler.\nA stack trace is included below, and the handler has been disconnected.\n./Lua/dialogs/place_staff.lua:82: bad argument #1 to 'getCellFlags' (Map co-ordinates out of bounds)\nstack traceback:\n    [C]: in function 'getCellFlags'\n    ./Lua/dialogs/place_staff.lua:82: in function 'draw'\n    ./Lua/window.lua:1277: in function 'draw'\n    ./Lua/game_ui.lua:153: in function 'draw'\n    ./Lua/app.lua:897: in function <./Lua/app.lua:890>\n    (tail call): ?\n    ./Lua/app.lua:779: in function <./Lua/app.lua:774>\nError in frame handler: \n./Lua/dialogs/place_staff.lua:82: bad argument #1 to 'getCellFlags' (Map co-ordinates out of bounds)\nstack traceback:\n    [C]: in function 'getCellFlags'\n    ./Lua/dialogs/place_staff.lua:82: in function 'draw'\n    ./Lua/window.lua:1277: in function 'draw'\n    ./Lua/game_ui.lua:153: in function 'draw'\n    ./Lua/app.lua:897: in function <./Lua/app.lua:890>\n    (tail call): ?\n    ./Lua/app.lua:779: in function <./Lua/app.lua:774>\nWarning: No event handler for frame\n```\n. I have a similar issue, the vomit on the floor is ignored by the handymen near the reception desk.\n\nhttp://filebin.ca/25oH9ZCBy76j/vomit.sav\nTrunk (master branch) version of CorsixTH\n. I don't know what happened there. Is it possible to log objects that should be on the 'todo' list, but which are not? Or to 'pause' the game like when an error occurs? I could try to take a look at the patients when they vomit, but i am not sure if the maps are to big and i might miss the problematic one.\n. > Could our code be altered so that when we drop an handyman on a task like litter cleaning it gets added to the list with the priority to do it next?\n+1\n. @JamesWP @t0mtaylor Is that issue still a problem with the latest v0.50 beta release? \n. @Glimmer-Man could you share your maps with different emergency values for testing?\n. This issue is still valid with v0.50 trunk c2e5b0c334fc7094616120efc74b8a18f15b13e9. The dynamic info (e.g. where is a patient going to) is not updated when loading a savegame with a different language.\n. I run very often in this problem, a doctor does not leave his room and the patient is not treated ... \nPick up the doctor and place him somewhere else or in the same room fix the issue.\nsavegame with the issue in GP's Office: http://www.xup.in/dl,91712908/sleep.sav/\nCorsixTH version: trunk / master branch \n. Again in GP's Office (center of the map): http://filebin.ca/281cny3qMqAj/docroom.sav\n. Could reproduce it: \n- Load the savegame (trunk 102): http://www.xup.in/dl,58652606/scotwin2.sav/\n- remove the Hair Restoration and Scotwin starts wandering in the GP's office \nIf the savegame is just loaded without interaction with the map, Scotwin is doing his job normally and take a break in the staffroom. \n. I had a look in the savegame https://github.com/CorsixTH/CorsixTH/issues/483#issuecomment-120283781 again.\nThe wandering issue is caused when start editing the Hair Restoration room. \nThe function Room:deactivate() is called. It seems that the doctor (Scotwin) possibly was not removed from the Hair Restoration room, correctly.\nself.room_info:     categories  table: 0x60d4010\nself.room_info:     required_staff  table: 0x60d4060\nself.room_info:     class   HairRestorationRoom\nself.room_info:     minimum_size    4\nself.room_info:     objects_needed  table: 0x60d52d0\nself.room_info:     floor_tile  17\nself.room_info:     id  hair_restoration\nself.room_info:     tooltip <LocalisedString> Current value:A Doctor uses the Hair-Restorer Room to cure Baldness\nself.room_info:     handyman_call_sound maint007.wav\nself.room_info:     call_sound  reqd016.wav\nself.room_info:     wall_type   blue\nself.room_info:     name    <LocalisedString> Current value:Hair Restoration\nself.room_info:     long_name   <LocalisedString> Current value:Hair Restorer\nself.room_info:     level_config_id 19\nself.room_info:     maximum_staff   table: 0x60d4060\nself.room_info:     build_preview_animation 5074\nself.room_info:     objects_additional  table: 0x60d5d30\nhumanoid.profile:   is_surgeon  0\nhumanoid.profile:   is_black    false\nhumanoid.profile:   layer5  2\nhumanoid.profile:   skill   0.56466559996591\nhumanoid.profile:   attention_to_detail 0.84932921671126\nhumanoid.profile:   chin_index  0\nhumanoid.profile:   is_psychiatrist 1\nhumanoid.profile:   wage    184\nhumanoid.profile:   hair_index  2\nhumanoid.profile:   desc    <LocalisedString> Current value:Not bothered about the job. Bone idle. Listens to rave and trip-hop music. \nhumanoid.profile:   name    <LocalisedString> Current value:SCOTWIN\nhumanoid.profile:   is_researcher   0\nhumanoid.profile:   profession  <LocalisedString> Current value:Psychiatrist\nhumanoid.profile:   face_index  4\nhumanoid.profile:   humanoid_class  Doctor\nhumanoid.profile:   world   table: 0x615e580\nhumanoid.in_room.room_info:     categories  table: 0x6167e30\nhumanoid.in_room.room_info:     required_staff  table: 0x6162180\nhumanoid.in_room.room_info:     floor_tile  18\nhumanoid.in_room.room_info:     wall_type   white\nhumanoid.in_room.room_info:     id  gp\nhumanoid.in_room.room_info:     long_name   <LocalisedString> Current value:GP's Office\nhumanoid.in_room.room_info:     minimum_size    4\nhumanoid.in_room.room_info:     maximum_staff   table: 0x6162180\nhumanoid.in_room.room_info:     call_sound  reqd008.wav\nhumanoid.in_room.room_info:     build_preview_animation 900\nhumanoid.in_room.room_info:     name    <LocalisedString> Current value:GP's Office\nhumanoid.in_room.room_info:     objects_additional  table: 0x6161dc0\nhumanoid.in_room.room_info:     level_config_id 7\nhumanoid.in_room.room_info:     objects_needed  table: 0x6167de0\nhumanoid.in_room.room_info:     tooltip <LocalisedString> Current value:Patients receive their initial consultation and results in the GP's Office\nhumanoid.in_room.room_info:     class   GPRoom\nWhen start editing the room it calls callback.callback()\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/room.lua#L925 \nfor a doctor the callback function is possibly\nhumanoid_entering:setNextAction({name = \"meander\"})\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/room.lua#L112\nwhich interrupts the doctor.\nHumanoid:setNextAction()\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/entities/humanoid.lua#L588\nTODO:\n- make sure staff members are correctly removed from rooms\n- remove staff members from rooms they are not in but assigned to (maybe afterLoad or regular checks)\n- don't call callback() if the room of the callback and the room of the humanoid is in are different \n- wake up wandering staff members, they should get back to work (maybe afterLoad or regular checks)\n- ....\n. Game crash with the following message: \n```\nWill not check for updates since this is the Trunk version.\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\n./Lua/entities/humanoid.lua:662: Can only finish current action\nstack traceback:\n    [C]: in function 'assert'\n    ./Lua/entities/humanoid.lua:662: in function 'finishAction'\n    ./Lua/rooms/general_diag.lua:75: in function 'after_use'\n    ./Lua/humanoid_actions/multi_use_object.lua:264: in function 'timer_function'\n    ./Lua/entity.lua:218: in function 'tick'\n    ./Lua/world.lua:1108: in function 'onTick'\n    ./Lua/app.lua:876: in function 'dispatch'\n    ./Lua/app.lua:777: in function <./Lua/app.lua:772>\nWarning: No event handler for timer\n```\nSavegame to reproduced (with game speed 4, with different speed it doesn't crash): http://filebin.ca/25ENYOa9k5tE/Gamecrash.sav\n. @MarkL1961 does this affect the latest v0.50 beta of CorsixTH, too?\n. > In fullscreen it scales so everything is tiny, and in windowed it just makes big windows.\nOn Windows i also see a combination of both, in window mode and high screen resolutions. It makes a big window and scales at the same time.\n. I could confirm that the first patient in TH is coming shortly after opening the hospital. In CorsixTH it takes much to long.\n. @misslolab and @awong728 could you reproduce your issues with the latest v0.50 beta release of CorsixTH?\n. Same issue here, could reproduce it with the following savegame, but the last fax while waiting for the earthquake have to be opened, if not the game does not crash.\nhttp://filebin.ca/260Gd0LIuc4u/earth.sav (CorsixTH trunk / master branch)\n```\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\n/home/bob/dev/Games/CorsixTH/CorsixTH/Lua/room.lua:504: attempt to index field 'queue' (a nil value)\nstack traceback:\n    ...CorsixTH/CorsixTH/Lua/objects/doors/swing_door_right.lua:138: in function 'timer_function'\n    /home/bob/dev/Games/CorsixTH/CorsixTH/Lua/entity.lua:218: in function 'tick'\n    /home/bob/dev/Games/CorsixTH/CorsixTH/Lua/world.lua:1108: in function 'onTick'\n    /home/bob/dev/Games/CorsixTH/CorsixTH/Lua/app.lua:876: in function 'dispatch'\n    /home/bob/dev/Games/CorsixTH/CorsixTH/Lua/app.lua:777: in function \nWarning: No event handler for timer\n```\n. Can't reproduce the issue with the latest trunk version (https://github.com/CorsixTH/CorsixTH/commit/5cd0314e28d6360019afc20af211ed0ddd71e719) of CorsixTH. Maybe it is already fixed?\n. Not sure if this could be the reason for the issue, the scroll_power is 7 for mouse scrolling (function GameUI:onMouseMove) and 10 for scrolling with the arrow keys (function GameUI:updateKeyScroll)\nlocal scroll_power = 7\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/game_ui.lua#L455\nlocal scroll_keys = {\n  up    = {x =   0, y = -10},\n  right = {x =  10, y =   0},\n  down  = {x =   0, y =  10},\n  left  = {x = -10, y =   0},\n}\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/game_ui.lua#L201\n@vince0018 could you adjust the scroll_keys within the Lua/game_ui.lua file to\nlocal scroll_keys = {\n  up    = {x =  0, y = -7},\n  right = {x =  7, y =  0},\n  down  = {x =  0, y =  7},\n  left  = {x = -7, y =  0},\n}\nand test it?\n. @badabingbambini could you reproduce the game freeze with the v0.50 beta release?\n. I can't reproduce that issue with \nCorsixTH trunk (be5d8f444b4ac42365397e1e1d1ae988d5bed672) on Debian Jessie 32 bit and 64 bit\nCorsixTH v0.50 beta 2 on Windows 7 32 bit\n@juef17 @MarkL1961 which system do you use? And how to reproduce that issue exactly?\nI put the cursor to the input field of the savegame dialog and typed letters and numbers but the game speed did not changed by the keys 1,2,3,4 and 5\n. @MarkL1961 thx \nCould reproduce it with the numpad keys (keypad 1, keypad 2, ..) and also some other keys like for zooming (+, -, keypad +, keypad -) should not work while enter a savegame name.\n. Now it is the patient in the ward: \nhttp://filebin.ca/24gmB2gYGKZc\n. I could reproduce this bug with a trunk build of the master branch and the 0.40 release binary https://github.com/CorsixTH/CorsixTH/releases/tag/v0.40\nThe problem might be the Single Scenario Avatar, there is only one doctor available at all. (maybe the operating theatre is disabled for that scenario, but i don't know)\nThe error occurs if a GP's Office and a Ward is already available and the patient wants to leave the GP's Office or after you build a Ward after it is requested for the pregnant patient and the patient wants to leave the Ward.\n. The first issue also apply to the input field for the savegame name\n. Is the following output useful? What else could help?\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The frame handler.\nA stack trace is included below, and the handler has been disconnected.\n^C\nProgram received signal SIGINT, Interrupt.\n0x00007ffff765905b in ?? () from /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n```\n(gdb) backtrace\n0  0x00007ffff765905b in ?? ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n1  0x00007ffff76644aa in lua_getstack ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n2  0x00007ffff769741e in luaL_traceback ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n3  0x00007ffff7697672 in ?? ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n4  0x00007ffff7656a88 in ?? ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n5  0x0000000000477ae4 in CorsixTH_lua_main(lua_State*) ()\n6  0x00007ffff7656a88 in ?? ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n7  0x00007ffff7699f60 in lua_pcall ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n8  0x00000000004357c3 in main ()\n. @ajdlinux this issue and #327 are not reproduce able and hit users somehow randomly, maybe you could run CorsixTH always with gdb or another debugger (i am not sure which is perfect for lua and luajit)\n.\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The frame handler.\nA stack trace is included below, and the handler has been disconnected.\n^C\nProgram received signal SIGINT, Interrupt.\n0x00007ffff7659028 in ?? () from /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n```\n```\n(gdb) thread 1\n[Switching to thread 1 (Thread 0x7ffff7f9d800 (LWP 12819))]\n0  0x00007ffff7659030 in ?? () from /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n(gdb) bt\n0  0x00007ffff7659030 in ?? () from /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n1  0x00007ffff76644aa in lua_getstack () from /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n2  0x00007ffff769741e in luaL_traceback () from /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n3  0x00007ffff7697672 in ?? () from /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n4  0x00007ffff7656a88 in ?? () from /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n5  0x0000000000477a95 in CorsixTH_lua_main (L=0x40000378) at /home/bob/dev/Games/CorsixTH/CorsixTH/Src/main.cpp:184\n6  0x00007ffff7656a88 in ?? () from /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n7  0x00007ffff7699f60 in lua_pcall () from /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\n8  0x00000000004357c3 in main (argc=1, argv=0x7fffffffe258) at /home/bob/dev/Games/CorsixTH/CorsixTH/SrcUnshared/main.cpp:85\n```\n```\n(gdb) thread 2\n[Switching to thread 2 (Thread 0x7fffe8fd8700 (LWP 12823))]\n0  0x00007ffff78c9050 in sem_wait () from /lib/x86_64-linux-gnu/libpthread.so.0\n(gdb) bt\n0  0x00007ffff78c9050 in sem_wait () from /lib/x86_64-linux-gnu/libpthread.so.0\n1  0x00007ffff7b98cae in SDL_SemWait_REAL (sem=) at /tmp/buildd/libsdl2-2.0.2+dfsg1/src/thread/pthread/SDL_syssem.c:93\n2  0x00007ffff7b98e05 in SDL_SemWaitTimeout_REAL (sem=0x6ca3c0, timeout=4294967295)\nat /tmp/buildd/libsdl2-2.0.2+dfsg1/src/thread/pthread/SDL_syssem.c:120\n\n3  0x00007ffff7b4f163 in SDL_TimerThread (_data=_data@entry=0x7ffff7ddab40 )\nat /tmp/buildd/libsdl2-2.0.2+dfsg1/src/timer/SDL_timer.c:200\n\n4  0x00007ffff7b4ecfc in SDL_RunThread (data=0x6ca730) at /tmp/buildd/libsdl2-2.0.2+dfsg1/src/thread/SDL_thread.c:282\n5  0x00007ffff7b989c9 in RunThread (data=) at /tmp/buildd/libsdl2-2.0.2+dfsg1/src/thread/pthread/SDL_systhread.c:72\n6  0x00007ffff78c30a4 in start_thread () from /lib/x86_64-linux-gnu/libpthread.so.0\n7  0x00007ffff4d3a04d in clone () from /lib/x86_64-linux-gnu/libc.so.6\n```\n```\n(gdb) thread 4\n[Switching to thread 4 (Thread 0x7fffe1cda700 (LWP 12828))]\n0  0x00007ffff4d315cf in ppoll () from /lib/x86_64-linux-gnu/libc.so.6\n(gdb) bt\n0  0x00007ffff4d315cf in ppoll () from /lib/x86_64-linux-gnu/libc.so.6\n1  0x00007ffff432634d in pa_mainloop_poll () from /usr/lib/x86_64-linux-gnu/libpulse.so.0\n2  0x00007ffff432693e in pa_mainloop_iterate () from /usr/lib/x86_64-linux-gnu/libpulse.so.0\n3  0x00007ffff7b881d7 in PULSEAUDIO_WaitDevice (this=0x1eb17b0)\nat /tmp/buildd/libsdl2-2.0.2+dfsg1/src/audio/pulseaudio/SDL_pulseaudio.c:240\n\n4  0x00007ffff7af2634 in SDL_RunAudio (devicep=devicep@entry=0x1eb17b0) at /tmp/buildd/libsdl2-2.0.2+dfsg1/src/audio/SDL_audio.c:502\n5  0x00007ffff7b4ecfc in SDL_RunThread (data=0x1ed1ca0) at /tmp/buildd/libsdl2-2.0.2+dfsg1/src/thread/SDL_thread.c:282\n6  0x00007ffff7b989c9 in RunThread (data=) at /tmp/buildd/libsdl2-2.0.2+dfsg1/src/thread/pthread/SDL_systhread.c:72\n7  0x00007ffff78c30a4 in start_thread () from /lib/x86_64-linux-gnu/libpthread.so.0\n8  0x00007ffff4d3a04d in clone () from /lib/x86_64-linux-gnu/libc.so.6\n```\n. I running the game with Lua 5.1 for some weeks now and i can't see similar crashes with it. Maybe it is a problem with Luajit or the problem is already fixed. I will switch back to Luajit and try to reproduce the issue with it. \n. Back to Luajit 2.0.3 the game is crashing like before, the problem still exists. Is there another way to find the reason for the freezes with Luajit? It seems these issues can't be reproduced with Lua, only.\n. @TheCycoONE can't reproduce the issue and can't figure out which commit fixed it. Could use Luajit (2.0.3 & 2.0.4) without any trouble.. It is about 'Specialisation' as @Alberth289346 mentioned. Why is it not 'All Done' when the tooltip shows 'No research is being carried out in this category at the moment'.\nDo i need to build something, that i didn't build, yet. Is a patient with a special disease missing? Something else?\nIf everything is researched in the category of the scenario it should show 'All Done'.\n. There is nothing left in the Drug Casebook.\n. normally it looks like that:\n\n. I have a savegame before that issue occurs but i can't reproduce it.\nIf serious radiation is already researched then a doctor also take attention to the patient\nMaybe something happens to the doctor with the attention, and then nobody else take care of the patient. Sometimes a doctor starts wandering around and don't leave the room he is in, like here #505 maybe that happened here too. But it doesn't happen here.\nBut you could force the issue, send the patient to the research department and pick up the doctor with the attention and put the doctor to the staff room. Now the patient is waiting until he is dead ...\nIs there also a 'todo' list for doctors as there are for handymen? described here: https://github.com/CorsixTH/CorsixTH/issues/388#issuecomment-113790765 \nIf a doctor lost his attention somebody else should take care of the patient.\nhttp://filebin.ca/25zcuEEapkSl/beforestuck.sav\n. It doesn't matter if the shower is researched before, he will also be put inside the autopsy machine.\nThe problem is the researcher that leaves the room (for a break, fired, ..) and the task is not reassigned to a different researcher.\n. I did not edit the room, i just build it. 3 patients came .. \nIt is also a problem with other rooms. It is the Confined scenario, where i remove and rebuild rooms very often cause of the lack of space.\n. save: http://www.xup.to/dl,45797095/counter.sav/\n. @TheCycoONE i downloaded the file and loaded it within CorsixTH, there is a Inflator room inside. And the room queue and the uses of the Inflator are different.\nI am using the latest trunk version from the Git master branch on a Debian Linux 64bit. Do you use a game with a different savegame version (Savegame version is 102) which could lead to the crash? Can't reproduce it here.\n@MarkL1961 what are the values of the 'Number of times hardware used' and the 'Visitor Count' of my savegame?\n. Ah that should be the reason, thx\n. Maybe similar error with the Inflator room, without error message, i am stuck in the room menu.\n```\nSavegame version is 102 (Trunk), originally it was 102 (Trunk)\nWarning: humanoid entering non-active room\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The buttonup handler.\nA stack trace is included below, and the handler has been disconnected.\n./Lua/dialogs/place_objects.lua:230: attempt to index field 'orientations' (a nil value)\nstack traceback:\n    ./Lua/dialogs/place_objects.lua:230: in function <./Lua/dialogs/place_objects.lua:229>\n    [C]: in function 'sort'\n    ./Lua/dialogs/place_objects.lua:229: in function 'addObjects'\n    ./Lua/dialogs/edit_room.lua:607: in function 'returnToDoorPhase'\n    ./Lua/dialogs/edit_room.lua:191: in function 'callback'\n    ./Lua/window.lua:664: in function 'handleClick'\n    ./Lua/window.lua:1445: in function 'onMouseUp'\n    ./Lua/dialogs/place_objects.lua:453: in function <./Lua/dialogs/place_objects.lua:452>\n    (tail call): ?\n    ./Lua/window.lua:1429: in function 'onMouseUp'\n    ./Lua/ui.lua:622: in function <./Lua/ui.lua:609>\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    ./Lua/app.lua:777: in function <./Lua/app.lua:772>\nError in buttonup handler: \n./Lua/dialogs/place_objects.lua:230: attempt to index field 'orientations' (a nil value)\nstack traceback:\n    ./Lua/dialogs/place_objects.lua:230: in function <./Lua/dialogs/place_objects.lua:229>\n    [C]: in function 'sort'\n    ./Lua/dialogs/place_objects.lua:229: in function 'addObjects'\n    ./Lua/dialogs/edit_room.lua:607: in function 'returnToDoorPhase'\n    ./Lua/dialogs/edit_room.lua:191: in function 'callback'\n    ./Lua/window.lua:664: in function 'handleClick'\n    ./Lua/window.lua:1445: in function 'onMouseUp'\n    ./Lua/dialogs/place_objects.lua:453: in function <./Lua/dialogs/place_objects.lua:452>\n    (tail call): ?\n    ./Lua/window.lua:1429: in function 'onMouseUp'\n    ./Lua/ui.lua:622: in function <./Lua/ui.lua:609>\n    (tail call): ?\n    (tail call): ?\n    (tail call): ?\n    ./Lua/app.lua:777: in function <./Lua/app.lua:772>\n```\n\nsavegame: http://www.xup.in/dl,16318061/Autosave2.sav/\n. The first problem 'crashinflator.sav' seems to be fixed by https://github.com/CorsixTH/CorsixTH/pull/798\nThe second problem 'Autosave2.sav' now crashes with the following error (maybe it is a combination of the first problem and something else):\n```\nWill not check for updates since this is the Trunk version.\nSavegame version is 102 (Trunk), originally it was 102 (Trunk)\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\n./Lua/humanoid_actions/seek_room.lua:143: attempt to compare nil with number\nstack traceback:\n    ./Lua/humanoid_actions/seek_room.lua:143: in function 'action_seek_room_no_diagnosis_room_found'\n    ./Lua/humanoid_actions/seek_room.lua:292: in function '?'\n    ./Lua/entities/humanoid.lua:575: in function 'Humanoid_startAction'\n    ./Lua/entities/humanoid.lua:667: in function 'finishAction'\n    ./Lua/humanoid_actions/idle.lua:31: in function 'timer_function'\n    ./Lua/entity.lua:218: in function 'tick'\n    ./Lua/entities/staff.lua:149: in function 'tick'\n    ./Lua/world.lua:1121: in function 'onTick'\n    ./Lua/app.lua:878: in function <./Lua/app.lua:875>\n    (tail call): ?\n    ./Lua/app.lua:779: in function <./Lua/app.lua:774>\nError in timer handler: \n./Lua/humanoid_actions/seek_room.lua:143: attempt to compare nil with number\nstack traceback:\n    ./Lua/humanoid_actions/seek_room.lua:143: in function 'action_seek_room_no_diagnosis_room_found'\n    ./Lua/humanoid_actions/seek_room.lua:292: in function '?'\n    ./Lua/entities/humanoid.lua:575: in function 'Humanoid_startAction'\n    ./Lua/entities/humanoid.lua:667: in function 'finishAction'\n    ./Lua/humanoid_actions/idle.lua:31: in function 'timer_function'\n    ./Lua/entity.lua:218: in function 'tick'\n    ./Lua/entities/staff.lua:149: in function 'tick'\n    ./Lua/world.lua:1121: in function 'onTick'\n    ./Lua/app.lua:878: in function <./Lua/app.lua:875>\n    (tail call): ?\n    ./Lua/app.lua:779: in function <./Lua/app.lua:774>\nWarning: No event handler for timer\n```\n. Duplicate of #775 \nShould be fixed in CorsixTH 0.50 beta 2 (might be released tomorrow)\n. Thanks for the fast fix, works for me.\n. In this case it could be a missing check by placing the drinking machine as i can't build a door near the drinking machine front?\n. Steps to reproduce the problem: \n- set play_sound to false in the config.txt-file\nplay_sounds = false\n- start CorsixTH and a new scenario (don't load a savegame)\n- build a GP's office \n- hire a doctor and put him inside\n- listen to the sound of the animations\npossible fix:\n- in the function App:loadLevel is self.audio missing\nself.audio:playSoundEffects(TheApp.config.play_sounds)\nWill do a pr later after some testings \n. Could only reproduce the issue when the screen height is equal or lower than 636 (with a screen width of 1280)\nSometimes i have to maximum zoom out and zoom in one step and it looks like the screenshot\nTested with CorsixTH trunk de27e4d77a80495d47cb3ac14849c546e7d393b3\n. It only occurs when the zoom factor is lower that 0.32 in the function GameUI:setZoom(factor)\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/game_ui.lua#L114\nWhen the issue occurs and i quit the game (with the shortcut Shift + q and Enter), the screen looks like that:\n\n. Could also reproduce it with CorsixTH 0.50 beta 2 on Windows 7 (32 bit), 1280x500 (using a Intel 965GM graphic card)\n\n. canvas:scale is never false when that happens.\nAlso there is no output on the console for me with https://github.com/CorsixTH/CorsixTH/commit/1c4bc2381a651077544c66779a16e35994edecdc when reproducing the issue\n. @IlDucci Could you also check the 'Dump Strings' tool within the game (in the debug menu under 'VOLCAR TEXTOS DEL JUEGO')? It complains about the following missing strings:\nmenu_debug.connect_debugger\nfax.vip_visit_result.remarks.very_bad[1]\nfax.vip_visit_result.remarks.very_bad[2]\nfax.vip_visit_result.remarks.very_bad[3]\n. Do you use the v0.50 beta 2 release? or one of the v0.40 rc releases?\nCould you reproduce the error when using\nC:\\Program Files (x86)\\Origin Games\\Theme Hospital\\\nas Theme Hospital Install folder? Or the folder where the following applies:\n-- Theme hospital install folder: original game data files are loaded from this\n-- folder. Between the square braces should be the folder which contains the\n-- original HOSPITAL.EXE and/or HOSP95.EXE file. This can point to a copy of\n-- the Theme Hospital demo, though a full install of the original game is\n-- preferred.\n. Did you specify a font file with unicode support for Chinese characters in the settings-folders game menu or the config.txt-file?\n-- Font file setting. Can be changed from main game menu\n-- Specify a font file here if you wish to play the game in a language not\n-- present in the original game. Examples include Russian, Chinese and Polish.\n--\nunicode_font = [[C:\\Windows\\Fonts\\yourfont.ttf]]\nChinese (simplified) and Chinese (traditional) are supported\n. yum install timidity-freepats\ndoes not work?\n. Found the following info:\n\"The timidity-freepats package is obsolete.  Selecting this package for\ninstallation will cause the soundfont-fluid-lite-patches package, which replaces this\none, to be installed instead.\"\nCould you try that instead?\n. It is listed here: https://apps.fedoraproject.org/packages/fluid-soundfont-lite-patches/overview/\n. Maybe the package name is now:\nyum install fluid-soundfont\n. Maybe someone could add the Enter key of the numpad, it is called 'keypad enter'\nif not handled and (char == \"return\" or char == \"keypad enter\") then\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/window.lua#L1040\n. Added it with #831 \n. Could you provide a screenshot please?\n. I just have to add something like:\nif old-savegame-version < new-savegame-version then\n     self:addKeyHandler(\"keypad enter\", self, ...)\n. added the new keyhandler to the afterload functions and bump the savegame version: #833 \nDid i missed something? Tested most of them with some old savegames, should work hopefully.\n. I am using a German full version of TH. It was part of the following games collection: http://www.amazon.de/PC-Games-Collection-Vol-1/dp/B00004TPL3/\nWhat could be wrong with the data files of the game?\n. As you could reproduce the issue by your self i don't have to do anything at the moment and my game data might not be the problem?\n. Could reproduce it, a dead or wrong patient enters the cast remover room for unknown reason\n```\nSavegame version is 105 (0.50 rc1), originally it was 102 (0.50 rc1)\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\n./Lua/humanoid_actions/multi_use_object.lua:313: attempt to index field '?' (a nil value)\nstack traceback:\n    ./Lua/humanoid_actions/multi_use_object.lua:313: in function '?'\n    ./Lua/entities/humanoid.lua:575: in function 'Humanoid_startAction'\n    ./Lua/entities/humanoid.lua:667: in function 'finishAction'\n    ./Lua/humanoid_actions/walk.lua:152: in function 'timer_function'\n    ./Lua/entity.lua:218: in function 'tick'\n    ./Lua/world.lua:1121: in function 'onTick'\n    ./Lua/app.lua:878: in function <./Lua/app.lua:875>\n    (tail call): ?\n    ./Lua/app.lua:779: in function <./Lua/app.lua:774>\nError in timer handler: \n./Lua/humanoid_actions/multi_use_object.lua:313: attempt to index field '?' (a nil value)\nstack traceback:\n    ./Lua/humanoid_actions/multi_use_object.lua:313: in function '?'\n    ./Lua/entities/humanoid.lua:575: in function 'Humanoid_startAction'\n    ./Lua/entities/humanoid.lua:667: in function 'finishAction'\n    ./Lua/humanoid_actions/walk.lua:152: in function 'timer_function'\n    ./Lua/entity.lua:218: in function 'tick'\n    ./Lua/world.lua:1121: in function 'onTick'\n    ./Lua/app.lua:878: in function <./Lua/app.lua:875>\n    (tail call): ?\n    ./Lua/app.lua:779: in function <./Lua/app.lua:774>\n```\nsavegame: http://filebin.ca/2BKBI2xhiOd8/crash4.sav\n. Okay until then i have some time to improve the pr a little bit.\nMaybe it is better to use setDefaultCursor instead of setCursor while the room is blueprinted. Also i could try to improve the behavior with dialogs and the menu bar.\nI also think the name of the cursor 'resize_room' is confusing and maybe should rename to something different, cause the cursors for resizing are different cursors. It looks like a tool for mortar, but i am not sure which could be a good name for the cursor.\n. I also thought about something like this, cause it is always hard to have a savegame before a problem occurs, sometimes not critical error are seen to late and can't be reproduced or no autosave is available anymore. \nI just thought about something like using the normal autosave but increase the autosave number until the end of the game. Also there should be different autosaves for different game (autosaves should not be overwritten).\nBut the save interval should not be less than a minute, when the game is saving all the time you can't play it. And you will very fast run into problems with free space on your hard drive\nSave interval 1 second, for one hour, autosave size 0,5 MB:\n60 * 60 * 0,5 = 1800 MB\nAlso this should not be enabled by default.\n. > For a single \"black box\" autosave being overwritten every X seconds when its updated, this wouldn't be a problem. \nThis is only a single savegame? And this is only for detecting crash errors? Not for other problems that don't crash the game?\n. - the doctor was in an other room\n- the patient before the Slack Tongue room died\n- the doctor finished his stuff with other patients in the other room\n- the doctor is leaving for the Slack Tongue room\n- in the savegame i put the doctor, on his way, back to the GP's office, and now when i put the doctor out of the GP's office on the corridor he is walking to the Slack Tongue room ...\n. I had a short look into this, a call of a patient is not cancelled when the patient die() or goHome().\nThe functions self:unregisterCallbacks() and self.world.dispatcher:dropFromQueue(self) don't do anything in this case (or at least it doesn't cancel the call)\n. There is a 'file not found' (-> ' Datei oder Verzeichnis nicht gefunden.') problem in SDL_render\n```\nProgram received signal SIGSEGV, Segmentation fault.\n0xb7ef05cb in GL_RenderCopy (renderer=0x10ce2eb8, texture=0xfea78a8, srcrect=0xbfffec3c, dstrect=0xbfffec5c)\n    at /build/libsdl2-jj65qS/libsdl2-2.0.2+dfsg1/src/render/opengl/SDL_render_gl.c:1183\n1183    /build/libsdl2-jj65qS/libsdl2-2.0.2+dfsg1/src/render/opengl/SDL_render_gl.c: Datei oder Verzeichnis nicht gefunden.\n(gdb) bt full\n0  0xb7ef05cb in GL_RenderCopy (renderer=0x10ce2eb8, texture=0xfea78a8, srcrect=0xbfffec3c,\ndstrect=0xbfffec5c) at /build/libsdl2-jj65qS/libsdl2-2.0.2+dfsg1/src/render/opengl/SDL_render_gl.c:1183\n    data = 0x165ec2b8\n    texturedata = 0x0\n    minx = -0\n    miny = -0\n    __PRETTY_FUNCTION__ = \"GL_RenderCopy\"\n\n1  0xb7eea905 in SDL_RenderCopy_REAL (renderer=0x10ce2eb8, texture=, srcrect=0xbfffed28,\ndstrect=0xbfffed18) at /build/libsdl2-jj65qS/libsdl2-2.0.2+dfsg1/src/render/SDL_render.c:1686\n    real_srcrect = {x = 0, y = 0, w = 1920, h = 1080}\n    real_dstrect = {x = -240, y = 0, w = 853, h = 480}\n    frect = {x = -240, y = 0, w = 853, h = 480}\n\n2  0xb7ed91d5 in SDL_RenderCopy (a=0x10ce2eb8, b=0x100757c8, c=0xbfffed28, d=0xbfffed18)\nat /build/libsdl2-jj65qS/libsdl2-2.0.2+dfsg1/src/dynapi/SDL_dynapi_procs.h:378\n\nNo locals.\n3  0x0807e63b in THRenderTarget::draw (this=0x811464c, pTexture=0x100757c8, prcSrcRect=0xbfffed28,\nprcDstRect=0xbfffed18, iFlags=0) at /home/bob/dev/Games/CorsixTH/CorsixTH/Src/th_gfx_sdl.cpp:669\n    iSDLFlip = 0\n\n4  0x0807ec88 in THRawBitmap::draw (this=0xa4102a4, pCanvas=0x811464c, iX=-240, iY=0, iSrcX=0, iSrcY=0,\niWidth=1920, iHeight=1080) at /home/bob/dev/Games/CorsixTH/CorsixTH/Src/th_gfx_sdl.cpp:893\n    fScaleFactor = 0.4444444477558136\n    rcSrc = {x = 0, y = 0, w = 1920, h = 1080}\n    rcDest = {x = -240, y = 0, w = 853, h = 480}\n\n5  0x0807ebdb in THRawBitmap::draw (this=0xa4102a4, pCanvas=0x811464c, iX=-240, iY=0)\nat /home/bob/dev/Games/CorsixTH/CorsixTH/Src/th_gfx_sdl.cpp:872\n\nNo locals.\n6  0x080abdcf in l_rawbitmap_draw (L=0xad3d730)\nat /home/bob/dev/Games/CorsixTH/CorsixTH/Src/th_lua_gfx.cpp:103\n    pBitmap = 0xa4102a4\n    pCanvas = 0x811464c\n\n7  0xb7e5161d in luaD_precall (L=0xad3d730, func=, nresults=0) at ldo.c:320\n    ci = <optimized out>\n    n = <optimized out>\n    cl = <optimized out>\n    funcr = 216\n\n8  0xb7e5c34e in luaV_execute (L=0xad3d730, nexeccalls=3) at lvm.c:591\n    b = 0\n    nresults = 0\n    i = 16988\n    ra = 0x17548f58\n    cl = 0xa8da230\n    base = 0x17548eec\n    k = 0xa885a68\n    pc = 0xa885c9c\n\n9  0xb7e50d93 in luaD_rawrunprotected (L=0xad3d730, f=0xb7e51960 , ud=0x17548eec) at ldo.c:116\n    lj = {previous = 0x0, b = {{__jmpbuf = {-1209558428, 181655344, 2, -1073745880, 345345132, 559028860}, \n          __mask_was_saved = 0, __saved_mask = {__val = {3086388953, 3086684160, 0, 3221221328, 0, \n              1781576192, 3085276308, 3086374070, 3085810777, 3086684160, 0, 3221221328, 0, 3085812257, \n              3221221328, 1, 2, 0, 65535, 3085812102, 3221221304, 3066073088, 3221221236, 3065355346, \n              3085408868, 3085274106, 135033550, 135282720, 5, 3086684160, 135236504, 3017}}}}, status = 0}\n\n10 0xb7e51b21 in lua_resume (L=0xad3d730, nargs=1) at ldo.c:428\n    status = <optimized out>\n\n11 0x0808cf4d in l_mainloop (L=0x80f8b98) at /home/bob/dev/Games/CorsixTH/CorsixTH/Src/sdl_core.cpp:287\n    do_frame = true\n    do_timer = true\n    fps_control = 0x814d16c\n    timer = 1\n    e = {type = 1024, common = {type = 1024, timestamp = 611627}, window = {type = 1024, \n        timestamp = 611627, windowID = 2, event = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000', \n        padding3 = 0 '\\000', data1 = 0, data2 = 374}, key = {type = 1024, timestamp = 611627, \n        windowID = 2, state = 0 '\\000', repeat = 0 '\\000', padding2 = 0 '\\000', padding3 = 0 '\\000', \n        keysym = {scancode = SDL_SCANCODE_UNKNOWN, sym = 374, mod = 148, unused = 0}}, edit = {\n        type = 1024, timestamp = 611627, windowID = 2, \n        text = \"\\000\\000\\000\\000\\000\\000\\000\\000v\\001\\000\\000\\224\\000\\000\\000\\000\\000\\000\\000\\377\\377\\377\\377v\\001\\000\\000\\307\\355\", <incomplete sequence \\355\\267>, start = 148, length = -1233335002}, text = {\n        type = 1024, timestamp = 611627, windowID = 2, \n        text = \"\\000\\000\\000\\000\\000\\000\\000\\000v\\001\\000\\000\\224\\000\\000\\000\\000\\000\\000\\000\\377\\377\\377\\377v\\001\\000\\000\\307\\355\", <incomplete sequence \\355\\267>}, motion = {type = 1024, timestamp = 611627, \n        windowID = 2, which = 0, state = 0, x = 374, y = 148, xrel = 0, yrel = -1}, button = {type = 1024, \n        timestamp = 611627, windowID = 2, which = 0, button = 0 '\\000', state = 0 '\\000', \n        clicks = 0 '\\000', padding1 = 0 '\\000', x = 374, y = 148}, wheel = {type = 1024, \n        timestamp = 611627, windowID = 2, which = 0, x = 0, y = 374}, jaxis = {type = 1024, \n        timestamp = 611627, which = 2, axis = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000', \n        padding3 = 0 '\\000', value = 0, padding4 = 0}, jball = {type = 1024, timestamp = 611627, \n        which = 2, ball = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000', padding3 = 0 '\\000', \n        xrel = 0, yrel = 0}, jhat = {type = 1024, timestamp = 611627, which = 2, hat = 0 '\\000', \n        value = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000'}, jbutton = {type = 1024, \n        timestamp = 611627, which = 2, button = 0 '\\000', state = 0 '\\000', padding1 = 0 '\\000', \n        padding2 = 0 '\\000'}, jdevice = {type = 1024, timestamp = 611627, which = 2}, caxis = {\n        type = 1024, timestamp = 611627, which = 2, axis = 0 '\\000', padding1 = 0 '\\000', \n        padding2 = 0 '\\000', padding3 = 0 '\\000', value = 0, padding4 = 0}, cbutton = {type = 1024, \n        timestamp = 611627, which = 2, button = 0 '\\000', state = 0 '\\000', padding1 = 0 '\\000', \n        padding2 = 0 '\\000'}, cdevice = {type = 1024, timestamp = 611627, which = 2}, quit = {type = 1024, \n        timestamp = 611627}, user = {type = 1024, timestamp = 611627, windowID = 2, code = 0, data1 = 0x0, \n        data2 = 0x176}, syswm = {type = 1024, timestamp = 611627, msg = 0x2}, tfinger = {type = 1024, \n        timestamp = 611627, touchId = 2, fingerId = 1606317768704, x = 2.07392173e-43, y = 0, \n        dx = -nan(0x7fffff), dy = 5.24085626e-43, pressure = -2.83633253e-05}, mgesture = {type = 1024, \n        timestamp = 611627, touchId = 2, dTheta = 0, dDist = 5.24085626e-43, x = 2.07392173e-43, y = 0, \n        numFingers = 65535, padding = 65535}, dgesture = {type = 1024, timestamp = 611627, touchId = 2, \n        gestureId = 1606317768704, numFingers = 148, error = 0, x = -nan(0x7fffff), y = 5.24085626e-43}, \n      drop = {type = 1024, timestamp = 611627, file = 0x2 <error: Cannot access memory at address 0x2>}, \n      padding = \"\\000\\004\\000\\000+U\\t\\000\\002\", '\\000' <repeats 11 times>, \"v\\001\\000\\000\\224\\000\\000\\000\\000\\000\\000\\000\\377\\377\\377\\377v\\001\\000\\000\\307\\355\\355\\267\\224\\000\\000\\000&\\315|\\266\\000@\\217\\266\"}\n    dispatcher = 0xad3d730\n    n = -1209690797\n\n12 0xb7e5161d in luaD_precall (L=0x80f8b98, func=, nresults=2) at ldo.c:320\n    ci = <optimized out>\n    n = <optimized out>\n    cl = <optimized out>\n    funcr = 72\n\n13 0xb7e5c34e in luaV_execute (L=0x80f8b98, nexeccalls=1) at lvm.c:591\n    b = 2\n    nresults = 2\n    i = 16826524\n    ra = 0x99790b0\n    cl = 0x8119ab0\n    base = 0x9979098\n    k = 0x811fea0\n    pc = 0x8120244\n\n14 0xb7e51a8b in luaD_call (L=0x80f8b98, func=0x8105e14, nResults=-1) at ldo.c:378\nNo locals.\n15 0xb7e4d649 in lua_call (L=0x80f8b98, nargs=1, nresults=-1) at lapi.c:782\n    func = <optimized out>\n\n16 0x08078eaa in CorsixTH_lua_main (L=0x80f8b98) at /home/bob/dev/Games/CorsixTH/CorsixTH/Src/main.cpp:184\nNo locals.\n17 0xb7e5161d in luaD_precall (L=0x80f8b98, func=, nresults=0) at ldo.c:320\n    ci = <optimized out>\n    n = <optimized out>\n    cl = <optimized out>\n    funcr = 24\n\n18 0xb7e51a46 in luaD_call (L=0x80f8b98, func=0x80f8dd8, nResults=0) at ldo.c:377\nNo locals.\n19 0xb7e4c1b5 in f_call (L=0x80f8b98, ud=0xbffff364) at lapi.c:800\n    c = 0xbffff364\n\n20 0xb7e50d93 in luaD_rawrunprotected (L=0x80f8b98, f=0xb7e4c1a0 , ud=0xbffff364) at ldo.c:116\n    lj = {previous = 0x0, b = {{__jmpbuf = {-1209558428, 135236856, 135236504, 135236856, 346852460, \n            559028860}, __mask_was_saved = 0, __saved_mask = {__val = {1, 3087006000, 40, 3, 0, \n              3066073088, 3066074144, 0, 135236616, 0, 3221222228, 3221222088, 3221222080, 134571128, \n              3087006000, 0, 66, 3085291669, 4294967295, 66, 3085208752, 3085410304, 20, 3085291638, \n              3085408868, 3085258753, 0, 0, 0, 66, 20, 20}}}}, status = 0}\n\n21 0xb7e51c1d in luaD_pcall (L=0x80f8b98, func=0xb7e4c1a0 , u=0xbffff364, old_top=24, ef=12)\nat ldo.c:464\n    status = <optimized out>\n    oldnCcalls = 0\n    old_ci = 0\n    old_allowhooks = 1 '\\001'\n    old_errfunc = 0\n\n22 0xb7e4d6e7 in lua_pcall (L=0x80f8b98, nargs=1, nresults=0, errfunc=1) at lapi.c:821\n    c = {func = 0x80f8dd8, nresults = 0}\n    status = <optimized out>\n    func = <optimized out>\n\n23 0x0807753b in main (argc=1, argv=0xbffff4c4)\nat /home/bob/dev/Games/CorsixTH/CorsixTH/SrcUnshared/main.cpp:85\n    L = 0x80f8b98\n    stkCleanup = std::stack wrapping: std::deque with -707306104 elements = {\n      <error reading variable stkCleanup (Cannot access memory at address 0x4)>\n    bRun = true\n\n```\n```\n(gdb) thread 2\n[Switching to thread 2 (Thread 0xb53b8b40 (LWP 8768))]\n0  0xb7fdcd40 in __kernel_vsyscall ()\n(gdb) bt full\n1  0xb7e87f98 in sem_timedwait () from /lib/i386-linux-gnu/i686/cmov/libpthread.so.0\nNo symbol table info available.\n2  0xb7f64216 in SDL_SemWaitTimeout_REAL (sem=0x8139370, timeout=30)\nat /build/libsdl2-jj65qS/libsdl2-2.0.2+dfsg1/src/thread/pthread/SDL_syssem.c:146\n    retval = <optimized out>\n    now = {tv_sec = 1438156400, tv_usec = 873045}\n    ts_timeout = {tv_sec = 1438156400, tv_nsec = 873045000}\n\n3  0xb7f10137 in SDL_TimerThread (_data=0xb7fb4d40 )\nat /build/libsdl2-jj65qS/libsdl2-2.0.2+dfsg1/src/timer/SDL_timer.c:200\n\nNo locals.\n4  0xb7f0fc4a in SDL_RunThread (data=0x81765a8)\nat /build/libsdl2-jj65qS/libsdl2-2.0.2+dfsg1/src/thread/SDL_thread.c:282\n    args = 0x81765a8\n    userfunc = 0xb7f10010 <SDL_TimerThread>\n    userdata = 0xb7fb4d40 <SDL_timer_data>\n    thread = 0x8151578\n    statusloc = 0x8151580\n\n5  0xb7f63d38 in RunThread (data=0x81765a8)\nat /build/libsdl2-jj65qS/libsdl2-2.0.2+dfsg1/src/thread/pthread/SDL_systhread.c:72\n\nNo locals.\n6  0xb7e81efb in start_thread () from /lib/i386-linux-gnu/i686/cmov/libpthread.so.0\nNo symbol table info available.\n7  0xb6b4c62e in clone () from /lib/i386-linux-gnu/i686/cmov/libc.so.6\nNo symbol table info available.\n```\n. Could also reproduce a crash of CorsixTH v0.50 rc1 on Windows 7 32 bit with a problem in SDL2.dll but i don't have much more infos about that crash. Also it take some time to run into that crash, also i tried to change other options before switching the screen resolution, again. But i don't have repeatable steps to reproduce the issue.\n. Now CorstixTH https://github.com/CorsixTH/CorsixTH/commit/ee23df1fb7ae5a0842854f3aea7a2cddb8e3a711 on Ubuntu Trusty 32 bit and max. screen resolution is 1280x800\nSwitch from 1600x900 to 1280x960 (window mode)\nSDL2 v2.0.2+dfsg1-3ubuntu1 http://packages.ubuntu.com/trusty/libsdl2-2.0-0\n```\n(gdb) run\nStarting program: /home/bob/dev/CorsixTH/CorsixTH/CorsixTH \n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/i386-linux-gnu/libthread_db.so.1\".\nTraceback (most recent call last):\n  File \"/usr/share/gdb/auto-load/usr/lib/i386-linux-gnu/libstdc++.so.6.0.19-gdb.py\", line 63, in \n    from libstdcxx.v6.printers import register_libstdcxx_printers\nImportError: No module named 'libstdcxx'\n\nWelcome to CorsixTH 0.50 rc1!\n\nThis window will display useful information if an error occurs.\n\n[New Thread 0xb58d7b40 (LWP 2193)]\n[New Thread 0xb095cb40 (LWP 2194)]\n[Thread 0xb095cb40 (LWP 2194) exited]\n[New Thread 0xb095cb40 (LWP 2195)]\n[New Thread 0xb333eb40 (LWP 2196)]\n[Thread 0xb333eb40 (LWP 2196) exited]\nCannot check for updates since LuaSocket is not available.\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProblem creating overlay: Texture dimensions are limited to 4096x4096\nProgram received signal SIGSEGV, Segmentation fault.\nGL_RenderCopy (renderer=0x8fcbb80, texture=0xd9d4c28, srcrect=0xbfffe810, \n    dstrect=0xbfffe830)\n    at /build/buildd/libsdl2-2.0.2+dfsg1/src/render/opengl/SDL_render_gl.c:1183\n1183    /build/buildd/libsdl2-2.0.2+dfsg1/src/render/opengl/SDL_render_gl.c: No such file or directory.\n(gdb) bt full\n0  GL_RenderCopy (renderer=0x8fcbb80, texture=0xd9d4c28, srcrect=0xbfffe810,\ndstrect=0xbfffe830)\nat /build/buildd/libsdl2-2.0.2+dfsg1/src/render/opengl/SDL_render_gl.c:1183\n    data = 0xd4906f8\n    texturedata = 0xffffffff\n    minx = <optimized out>\n    miny = <optimized out>\n    maxx = <optimized out>\n    maxy = <optimized out>\n    minu = <optimized out>\n    maxu = <optimized out>\n    minv = <optimized out>\n    maxv = <optimized out>\n    __PRETTY_FUNCTION__ = \"GL_RenderCopy\"\n\n1  0xb7f02b20 in SDL_RenderCopy_REAL (renderer=0x8fcbb80,\ntexture=<optimized out>, srcrect=0xbfffe8f0, dstrect=0xbfffe900)\nat /build/buildd/libsdl2-2.0.2+dfsg1/src/render/SDL_render.c:1686\n    real_srcrect = {x = 0, y = 0, w = 1920, h = 1080}\n    real_dstrect = {x = -240, y = 0, w = 1706, h = 960}\n    frect = {x = -240, y = 0, w = 1706, h = 960}\n\n2  0xb7ef0ea4 in SDL_RenderCopy (a=0x8fcbb80, b=0xa26b7d8, c=0xbfffe8f0,\nd=0xbfffe900)\nat /build/buildd/libsdl2-2.0.2+dfsg1/src/dynapi/SDL_dynapi_procs.h:378\n\nNo locals.\n3  0x0809bccd in THRenderTarget::draw (this=0x810db24, pTexture=0xa26b7d8,\nprcSrcRect=0xbfffe8f0, prcDstRect=0xbfffe900, iFlags=0)\nat /home/bob/dev/CorsixTH/CorsixTH/Src/th_gfx_sdl.cpp:669\n    iSDLFlip = 0\n\n4  0x0809c3b6 in THRawBitmap::draw (this=0x9475e1c, pCanvas=0x810db24,\niX=-240, iY=0, iSrcX=0, iSrcY=0, iWidth=1920, iHeight=1080)\nat /home/bob/dev/CorsixTH/CorsixTH/Src/th_gfx_sdl.cpp:893\n    fScaleFactor = 0,8888888955116272\n    rcSrc = {x = 0, y = 0, w = 1920, h = 1080}\n    rcDest = {x = -240, y = 0, w = 1706, h = 960}\n\n5  0x0809c2fa in THRawBitmap::draw (this=0x9475e1c, pCanvas=0x810db24,\niX=-240, iY=0) at /home/bob/dev/CorsixTH/CorsixTH/Src/th_gfx_sdl.cpp:872\n\nNo locals.\n6  0x080886b9 in l_rawbitmap_draw (L=0xc9749d0)\nat /home/bob/dev/CorsixTH/CorsixTH/Src/th_lua_gfx.cpp:103\n    pBitmap = 0x9475e1c\n    pCanvas = 0x810db24\n\n7  0xb7e6b5df in luaD_precall (L=L@entry=0xc9749d0, func=,\nfunc@entry=0xcc31920, nresults=nresults@entry=0) at ldo.c:320\n    ci = <optimized out>\n    n = <optimized out>\n    cl = <optimized out>\n    funcr = 216\n\n8  0xb7e763f4 in luaV_execute (L=0xc9749d0, nexeccalls=3) at lvm.c:591\n    b = 0\n    nresults = 0\n    i = 16988\n    ra = 0xcc31920\n    cl = 0x8c0fda8\n    base = 0xcc318b4\n    k = 0xcaa68b0\n    pc = 0xcaa6ae4\n\n9  0xb7e6ad35 in luaD_rawrunprotected (L=L@entry=0xc9749d0,\nf=f@entry=0xb7e6b920 <resume>, ud=0xcc318b4) at ldo.c:116\n    lj = {previous = 0x0, b = {{__jmpbuf = {-1209470976, 211241424, \n            135317108, -1073746952, -234760741, -1064378421}, \n          __mask_was_saved = 0, __saved_mask = {__val = {3086729216, 0, \n              3221220276, 0, 2610803712, 135317984, 585691136, 211241424, \n              3086729216, 0, 3221220276, 0, 3085912309, 3221220276, 1, \n              3221220216, 3068870656, 3221220152, 3068147826, 3085496320, \n              3085380655, 134983118, 135202824, 5, 3086729216, 135156344, \n              135317108, 284007357, 135156456, 3086490183, 3086729216, \n              135156344}}}}, status = 0}\n\n10 0xb7e6bae6 in lua_resume (L=0xc9749d0, nargs=1) at ldo.c:428\n    status = <optimized out>\n\n11 0x0809e88e in l_mainloop (L=0x80e5278)\nat /home/bob/dev/CorsixTH/CorsixTH/Src/sdl_core.cpp:287\n    do_frame = true\n    do_timer = true\n    fps_control = 0x81397f4\n    timer = 1\n    e = {type = 1024, common = {type = 1024, timestamp = 78786}, window = {\n        type = 1024, timestamp = 78786, windowID = 2, event = 0 '\\000', \n        padding1 = 0 '\\000', padding2 = 0 '\\000', padding3 = 0 '\\000', \n        data1 = 0, data2 = 895}, key = {type = 1024, timestamp = 78786, \n        windowID = 2, state = 0 '\\000', repeat = 0 '\\000', \n        padding2 = 0 '\\000', padding3 = 0 '\\000', keysym = {\n          scancode = SDL_SCANCODE_UNKNOWN, sym = 895, mod = 280, \n          unused = 0}}, edit = {type = 1024, timestamp = 78786, \n        windowID = 2, \n        text = \"\\000\\000\\000\\000\\000\\000\\000\\000\\177\\003\\000\\000\\030\\001\\000\\000\\000\\000\\000\\000\\377\\377\\377\\377=s\\357\\267\\000\\300\", <incomplete sequence \\373\\267>, start = 135861368, length = 895}, text = {type = 1024, \n        timestamp = 78786, windowID = 2, \n        text = \"\\000\\000\\000\\000\\000\\000\\000\\000\\177\\003\\000\\000\\030\\001\\000\\000\\000\\000\\000\\000\\377\\377\\377\\377=s\\357\\267\\000\\300\", <incomplete sequence \\373\\267>}, motion = {type = 1024, timestamp = 78786, windowID = 2, which = 0, \n        state = 0, x = 895, y = 280, xrel = 0, yrel = -1}, button = {\n        type = 1024, timestamp = 78786, windowID = 2, which = 0, \n        button = 0 '\\000', state = 0 '\\000', clicks = 0 '\\000', \n        padding1 = 0 '\\000', x = 895, y = 280}, wheel = {type = 1024, \n        timestamp = 78786, windowID = 2, which = 0, x = 0, y = 895}, \n      jaxis = {type = 1024, timestamp = 78786, which = 2, axis = 0 '\\000', \n        padding1 = 0 '\\000', padding2 = 0 '\\000', padding3 = 0 '\\000', \n        value = 0, padding4 = 0}, jball = {type = 1024, timestamp = 78786, \n        which = 2, ball = 0 '\\000', padding1 = 0 '\\000', \n        padding2 = 0 '\\000', padding3 = 0 '\\000', xrel = 0, yrel = 0}, \n      jhat = {type = 1024, timestamp = 78786, which = 2, hat = 0 '\\000', \n        value = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000'}, \n      jbutton = {type = 1024, timestamp = 78786, which = 2, \n        button = 0 '\\000', state = 0 '\\000', padding1 = 0 '\\000', \n        padding2 = 0 '\\000'}, jdevice = {type = 1024, timestamp = 78786, \n        which = 2}, caxis = {type = 1024, timestamp = 78786, which = 2, \n        axis = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000', \n        padding3 = 0 '\\000', value = 0, padding4 = 0}, cbutton = {\n        type = 1024, timestamp = 78786, which = 2, button = 0 '\\000', \n        state = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000'}, \n      cdevice = {type = 1024, timestamp = 78786, which = 2}, quit = {\n        type = 1024, timestamp = 78786}, user = {type = 1024, \n        timestamp = 78786, windowID = 2, code = 0, data1 = 0x0, \n        data2 = 0x37f}, syswm = {type = 1024, timestamp = 78786, \n        msg = 0x2}, tfinger = {type = 1024, timestamp = 78786, \n        touchId = 2, fingerId = 3843995729920, x = 3,9236357e-43, y = 0, \n        dx = -nan(0x7fffff), dy = -2,85446822e-05, \n        pressure = -3,00109386e-05}, mgesture = {type = 1024, \n        timestamp = 78786, touchId = 2, dTheta = 0, \n        dDist = 1,25416213e-42, x = 3,9236357e-43, y = 0, \n        numFingers = 65535, padding = 65535}, dgesture = {type = 1024, \n        timestamp = 78786, touchId = 2, gestureId = 3843995729920, \n        numFingers = 280, error = 0, x = -nan(0x7fffff), \n        y = -2,85446822e-05}, drop = {type = 1024, timestamp = 78786, \n        file = 0x2 <error: Cannot access memory at address 0x2>}, \n      padding = \"\\000\\004\\000\\000\\302\\063\\001\\000\\002\", '\\000' <repeats 11 times>, \"\\177\\003\\000\\000\\030\\001\\000\\000\\000\\000\\000\\000\\377\\377\\377\\377=s\\357\\267\\000\\300\\373\\267x\\024\\031\\b\\177\\003\\000\\000\\030\\001\\000\"}\n    dispatcher = 0xc9749d0\n    n = 135156344\n\n12 0xb7e6b5df in luaD_precall (L=L@entry=0x80e5278, func=,\nfunc@entry=0x8e09f40, nresults=nresults@entry=2) at ldo.c:320\n    ci = <optimized out>\n    n = <optimized out>\n    cl = <optimized out>\n    funcr = 72\n\n13 0xb7e763f4 in luaV_execute (L=L@entry=0x80e5278,\nnexeccalls=nexeccalls@entry=1) at lvm.c:591\n    b = 2\n    nresults = 2\n    i = 16826524\n    ra = 0x8e09f40\n    cl = 0x8106c68\n    base = 0x8e09f28\n    k = 0x810c2d0\n    pc = 0x810c674\n\n14 0xb7e6ba38 in luaD_call (L=L@entry=0x80e5278, func=0x80f25fc,\nnResults=nResults@entry=-1) at ldo.c:378\n\nNo locals.\n15 0xb7e675a1 in lua_call (L=0x80e5278, nargs=1, nresults=-1) at lapi.c:782\n    func = <optimized out>\n\n16 0x0809f3dd in CorsixTH_lua_main (L=0x80e5278)\nat /home/bob/dev/CorsixTH/CorsixTH/Src/main.cpp:184\n\nNo locals.\n17 0xb7e6b5df in luaD_precall (L=L@entry=0x80e5278, func=,\nfunc@entry=0x80e54b8, nresults=nresults@entry=0) at ldo.c:320\n    ci = <optimized out>\n    n = <optimized out>\n    cl = <optimized out>\n    funcr = 24\n\n18 0xb7e6b9fb in luaD_call (L=L@entry=0x80e5278, func=0x80e54b8, nResults=0)\nat ldo.c:377\n\nNo locals.\n19 0xb7e661d0 in f_call (L=0x80e5278, ud=0xbfffef28) at lapi.c:800\n    c = 0xbfffef28\n\n20 0xb7e6ad35 in luaD_rawrunprotected (L=L@entry=0x80e5278,\nf=f@entry=0xb7e661b0 <f_call>, ud=ud@entry=0xbfffef28) at ldo.c:116\n    lj = {previous = 0x0, b = {{__jmpbuf = {-1209470976, 0, 0, 135156344, \n            -234293797, -1064378421}, __mask_was_saved = 0, \n          __saved_mask = {__val = {3087006008, 135156344, 10000, 20, \n              3068870656, 3068871712, 0, 135156456, 0, 3221221140, \n              3221221000, 3221220992, 134566272, 3087006008, 0, 60, \n              3085398087, 4294967295, 60, 3085315280, 3085500416, \n              3068871712, 0, 3085496320, 3085364942, 0, 0, 0, 60, \n              3067610807, 3085496320, 20}}}}, status = 0}\n\n21 0xb7e6bbf6 in luaD_pcall (L=L@entry=0x80e5278,\nfunc=func@entry=0xb7e661b0 <f_call>, u=u@entry=0xbfffef28, old_top=24, \nef=12) at ldo.c:464\n    status = <optimized out>\n    oldnCcalls = 0\n    old_ci = 0\n    old_allowhooks = 1 '\\001'\n    old_errfunc = 0\n\n22 0xb7e67638 in lua_pcall (L=0x80e5278, nargs=1, nresults=0, errfunc=1)\nat lapi.c:821\n    c = {func = 0x80e54b8, nresults = 0}\n    status = <optimized out>\n    func = <optimized out>\n\n23 0x080752b4 in main (argc=1, argv=0xbffff074)\nat /home/bob/dev/CorsixTH/CorsixTH/SrcUnshared/main.cpp:85\n    L = 0x80e5278\n    stkCleanup = {\n      c = {<std::_Deque_base<void (*)(), std::allocator<void (*)()> >> = {\n          _M_impl = {<std::allocator<void (*)()>> = {<__gnu_cxx::new_allocator<void (*)()>> = {<No data fields>}, <No data fields>}, \n            _M_map = 0xb6eb51e0 <initial>, _M_map_size = 3068875232, \n            _M_start = {_M_cur = 0xbfffefa8, \n              _M_first = 0x809dbe3 <_GLOBAL__sub_I__ZN18FullColourRendererC2Eii()+26>, _M_last = 0x1, _M_node = 0xffff}, _M_finish = {_M_cur = 0xbac064c3, \n              _M_first = 0x8073e05 <_init+9>, _M_last = 0xb69c92c0 <sfir>, \n              _M_node = 0xb695b100}}}, <No data fields>}}\n    bRun = true\n\n```\n```\n(gdb) thread 2\n[Switching to thread 2 (Thread 0xb58d7b40 (LWP 2193))]\n0  0xb7fdd428 in __kernel_vsyscall ()\n(gdb) bt full\n0  0xb7fdd428 in __kernel_vsyscall ()\nNo symbol table info available.\n1  0xb7e9e2e8 in sem_timedwait ()\nat ../nptl/sysdeps/unix/sysv/linux/i386/i686/../i486/sem_timedwait.S:110\n\nNo locals.\n2  0xb7f7dca8 in SDL_SemWaitTimeout_REAL (sem=0x80fb5b8,\ntimeout=timeout@entry=30)\nat /build/buildd/libsdl2-2.0.2+dfsg1/src/thread/pthread/SDL_syssem.c:146\n    retval = <optimized out>\n    now = {tv_sec = 1438193151, tv_usec = 570178}\n    ts_timeout = {tv_sec = 1438193151, tv_nsec = 570178000}\n\n3  0xb7f2858c in SDL_TimerThread (\n_data=_data@entry=0xb7fbfba0 <SDL_timer_data>)\nat /build/buildd/libsdl2-2.0.2+dfsg1/src/timer/SDL_timer.c:200\n    data = 0xb7fbfba0 <SDL_timer_data>\n    pending = <optimized out>\n    current = <optimized out>\n    freelist_head = 0x0\n    freelist_tail = 0x0\n    tick = 78772\n    now = <optimized out>\n    interval = <optimized out>\n    delay = 30\n\n4  0xb7f280bb in SDL_RunThread (data=data@entry=0x8103020)\nat /build/buildd/libsdl2-2.0.2+dfsg1/src/thread/SDL_thread.c:282\n    args = 0x8103020\n    userfunc = 0xb7f28450 <SDL_TimerThread>\n    userdata = 0xb7fbfba0 <SDL_timer_data>\n    thread = 0x816abb0\n    statusloc = 0x816abb8\n\n5  0xb7f7d80b in RunThread (data=0x8103020)\nat /build/buildd/libsdl2-2.0.2+dfsg1/src/thread/pthread/SDL_systhread.c:72\n\nNo locals.\n6  0xb7e97f70 in start_thread (arg=0xb58d7b40) at pthread_create.c:312\n    __res = <optimized out>\n    pd = 0xb58d7b40\n    now = <optimized out>\n    unwind_buf = {cancel_jmp_buf = {{jmp_buf = {-1209360384, -1249019072, \n            4001536, -1249020888, 389158351, -550859829}, \n          mask_was_saved = 0}}, priv = {pad = {0x0, 0x0, 0x0, 0x0}, \n        data = {prev = 0x0, cleanup = 0x0, canceltype = 0}}}\n    not_first_call = <optimized out>\n    pagesize_m1 = <optimized out>\n    sp = <optimized out>\n    freesize = <optimized out>\n    __PRETTY_FUNCTION__ = \"start_thread\"\n\n7  0xb6df5bee in clone () at ../sysdeps/unix/sysv/linux/i386/clone.S:129\nNo locals.\n```\n```\n(gdb) thread 4\n[Switching to thread 4 (Thread 0xb095cb40 (LWP 2195))]\n0  0xb7fdd428 in __kernel_vsyscall ()\n(gdb) bt full\n0  0xb7fdd428 in __kernel_vsyscall ()\nNo symbol table info available.\n1  0xb6de6d78 in __GI_ppoll (fds=0x815c600, nfds=2, timeout=0x0, sigmask=0x0)\nat ../sysdeps/unix/sysv/linux/ppoll.c:56\n    resultvar = <optimized out>\n    _xv = -1226096640\n    resultvar = <optimized out>\n    oldtype = 2\n    tval = {tv_sec = 10, tv_nsec = -1228898304}\n    result = <optimized out>\n\n2  0xb6bdd563 in pa_mainloop_poll ()\nfrom /usr/lib/i386-linux-gnu/libpulse.so.0\nNo symbol table info available.\n3  0xb6bddd1d in pa_mainloop_iterate ()\nfrom /usr/lib/i386-linux-gnu/libpulse.so.0\nNo symbol table info available.\n4  0xb7f6a21c in PULSEAUDIO_WaitDevice (this=0x815d7e8)\nat /build/buildd/libsdl2-2.0.2+dfsg1/src/audio/pulseaudio/SDL_pulseaudio.c:240\n    h = 0x815d8b0\n\n5  0xb7ebd549 in SDL_RunAudio (devicep=devicep@entry=0x815d7e8)\nat /build/buildd/libsdl2-2.0.2+dfsg1/src/audio/SDL_audio.c:502\n    silence = 0\n    device = 0x815d7e8\n    stream = 0x8681bc0 \"\"\n    stream_len = 4096\n    udata = 0x0\n    fill = 0xb7e1afa0 <mix_channels>\n    delay = 46\n\n6  0xb7f280bb in SDL_RunThread (data=data@entry=0x8685fa8)\nat /build/buildd/libsdl2-2.0.2+dfsg1/src/thread/SDL_thread.c:282\n    args = 0x8685fa8\n    userfunc = 0xb7ebd450 <SDL_RunAudio>\n    userdata = 0x815d7e8\n    thread = 0x8687310\n    statusloc = 0x8687318\n\n7  0xb7f7d80b in RunThread (data=0x8685fa8)\nat /build/buildd/libsdl2-2.0.2+dfsg1/src/thread/pthread/SDL_systhread.c:72\n\nNo locals.\n8  0xb7e97f70 in start_thread (arg=0xb095cb40) at pthread_create.c:312\n    __res = <optimized out>\n    pd = 0xb095cb40\n    now = <optimized out>\n    unwind_buf = {cancel_jmp_buf = {{jmp_buf = {-1209360384, -1332360384, \n            4001536, -1332362200, 642913733, -550859829}, \n          mask_was_saved = 0}}, priv = {pad = {0x0, 0x0, 0x0, 0x0}, \n        data = {prev = 0x0, cleanup = 0x0, canceltype = 0}}}\n    not_first_call = <optimized out>\n    pagesize_m1 = <optimized out>\n    sp = <optimized out>\n    freesize = <optimized out>\n    __PRETTY_FUNCTION__ = \"start_thread\"\n\n9  0xb6df5bee in clone () at ../sysdeps/unix/sysv/linux/i386/clone.S:129\nNo locals.\n```\n. valgrid output on Debian 32bit\n==3307== Invalid read of size 4\n==3307==    at 0x40B35BA: GL_RenderCopy (in /usr/lib/i386-linux-gnu/libSDL2-2.0.so.0.2.0)\n==3307==    by 0x40AD904: SDL_RenderCopy_REAL (in /usr/lib/i386-linux-gnu/libSDL2-2.0.so.0.2.0)\n==3307==    by 0x409C1D4: SDL_RenderCopy (in /usr/lib/i386-linux-gnu/libSDL2-2.0.so.0.2.0)\n==3307==    by 0x807E63A: THRenderTarget::draw(SDL_Texture*, SDL_Rect const*, SDL_Rect const*, int) (th_gfx_sdl.cpp:669)\n==3307==    by 0x807EC87: THRawBitmap::draw(THRenderTarget*, int, int, int, int, int, int) (th_gfx_sdl.cpp:893)\n==3307==    by 0x807EBDA: THRawBitmap::draw(THRenderTarget*, int, int) (th_gfx_sdl.cpp:872)\n==3307==    by 0x80ABDCE: l_rawbitmap_draw(lua_State*) (th_lua_gfx.cpp:103)\n==3307==    by 0x419F61C: luaD_precall (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==    by 0x41AA34D: luaV_execute (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==    by 0x419ED92: luaD_rawrunprotected (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==    by 0x419FB20: lua_resume (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==    by 0x808CF4C: l_mainloop(lua_State*) (sdl_core.cpp:287)\n==3307==  Address 0x6fbd92c is 68 bytes inside a block of size 80 free'd\n==3307==    at 0x402A3A8: free (in /usr/lib/valgrind/vgpreload_memcheck-x86-linux.so)\n==3307==    by 0x40D1997: SDL_free_REAL (in /usr/lib/i386-linux-gnu/libSDL2-2.0.so.0.2.0)\n==3307==    by 0x40ADEF7: SDL_DestroyTexture_REAL (in /usr/lib/i386-linux-gnu/libSDL2-2.0.so.0.2.0)\n==3307==    by 0x409C288: SDL_DestroyTexture (in /usr/lib/i386-linux-gnu/libSDL2-2.0.so.0.2.0)\n==3307==    by 0x807ED26: THSpriteSheet::_freeSingleSprite(unsigned int) (th_gfx_sdl.cpp:916)\n==3307==    by 0x807EE50: THSpriteSheet::_freeSprites() (th_gfx_sdl.cpp:934)\n==3307==    by 0x807EFC1: THSpriteSheet::loadFromTHFile(unsigned char const*, unsigned int, unsigned char const*, unsigned int, bool, THRenderTarget*) (th_gfx_sdl.cpp:981)\n==3307==    by 0x80ABF10: l_spritesheet_load(lua_State*) (th_lua_gfx.cpp:135)\n==3307==    by 0x419F61C: luaD_precall (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==    by 0x41AA34D: luaV_execute (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==    by 0x419ED92: luaD_rawrunprotected (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==    by 0x419FB20: lua_resume (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==\n==3307==\n==3307== Process terminating with default action of signal 11 (SIGSEGV)\n==3307==  Access not within mapped region at address 0x4\n==3307==    at 0x40B35CB: GL_RenderCopy (in /usr/lib/i386-linux-gnu/libSDL2-2.0.so.0.2.0)\n==3307==    by 0x40AD904: SDL_RenderCopy_REAL (in /usr/lib/i386-linux-gnu/libSDL2-2.0.so.0.2.0)\n==3307==    by 0x409C1D4: SDL_RenderCopy (in /usr/lib/i386-linux-gnu/libSDL2-2.0.so.0.2.0)\n==3307==    by 0x807E63A: THRenderTarget::draw(SDL_Texture*, SDL_Rect const*, SDL_Rect const*, int) (th_gfx_sdl.cpp:669)\n==3307==    by 0x807EC87: THRawBitmap::draw(THRenderTarget*, int, int, int, int, int, int) (th_gfx_sdl.cpp:893)\n==3307==    by 0x807EBDA: THRawBitmap::draw(THRenderTarget*, int, int) (th_gfx_sdl.cpp:872)\n==3307==    by 0x80ABDCE: l_rawbitmap_draw(lua_State*) (th_lua_gfx.cpp:103)\n==3307==    by 0x419F61C: luaD_precall (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==    by 0x41AA34D: luaV_execute (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==    by 0x419ED92: luaD_rawrunprotected (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==    by 0x419FB20: lua_resume (in /usr/lib/i386-linux-gnu/liblua5.1.so.0.0.0)\n==3307==    by 0x808CF4C: l_mainloop(lua_State*) (sdl_core.cpp:287)\n. Can't reproduce it with latest release. That looks much nicer, thank you very much :)\n. override string graphs.deaths cause the origin is to long\norigin\n\nnew\n\nOverride string drug_improved cause of wrong spelling\n. Are several commits in one pull request a problem? Why should these commits need to be squashed? And how to do that? I never done something like that before.\n. @Alberth289346 helped me to squash my commits and fix some other issues i had with git, i messed it all up, but i hope everything is fine now :)\n. @Alberth289346 @spanjard Updated the commit with your recommendations, could you check again if it is okay?\n. The reported problem in #846 is fixed\nBut zooming has now the following result:\nZoom out:\n\nZoom in:\n\nCorsixTH trunk pr/851 7770fdce4f3b3488240312be0e894d1b63fc7b01 / Lua 5.1 / Debian Jessie 64 bit / CTH resolution 1024x720 window mode\n. Everything seems properly, thank you :)\n. @wolfy1339 could you have a look at the French translation and the pull request?\n. If you want to do that, follow the HowTo under the headline 'CONTRIBUTING CODE:' of the file https://github.com/CorsixTH/CorsixTH/blob/master/CONTRIBUTING.txt\nIt is a really good point to start dealing with Github and pull requests\n. I compared the English and the German strings with the debug-strings-orig.txt file.\nThere is a mismatch after the string [28,32], that string is repeated in the German translation, but not in the English strings. The strings [28,32] and [28,33] are the same in the German translation .\nThe English strings end at [28,63]\nThe German strings end at [28,64]\nLanguage files of a full game version of TH\n. I would add the following code to the function fixGermanStrings(lang_num) in Lua/languages/original_strings.lua\nif S[28][32] == S[28][33] and #S[28] == 64 then\n    for str = 33, 63 do\n      S[28][str] = S[28][str+1]\n    end\n  end\n. There are some more mismatches between the German translation and the English strings (after the strings [39,30], [44,172] and [57,37]). There are some mismatches in the French translation, too (after string [57,133]). The original_credits mismatches in all translations [43,1] , but that doesn't matter much, i guess.\nNeed to check the strings with the demo version of the game, too.\n. The language file of the demo version is not affected by the problem with the repeated string [28,32] / [28,33] in the German translation\nAlso all other mismatches i mentioned are handled already. The lines mismatches but there are blocks of strings which are separated by lines with punctuation marks, only.\nThe strings of the demo game are slightly different with the strings of the full game but i think these differences are handled by the Lua/languages/original_strings.lua file, already.\n. In Autosave3, Autosave4 and Autosave5 a patient with a hat and Uncommon Cold try to leave the pharmacy and crashes the game. Strange also: an other patient with Gut Rot was in the pharmacy before, now queuing for an other pharmacy room.\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\n./Lua/queue.lua:180: Suspected infinite loop\nstack traceback:\n    [C]: in function 'error'\n    ./Lua/app.lua:797: in function <./Lua/app.lua:794>\n    ./Lua/queue.lua:180: in function 'back'\n    ./Lua/room.lua:695: in function 'tryToFindNearbyPatients'\n    ./Lua/room.lua:558: in function 'onHumanoidLeave'\n    ./Lua/humanoid_actions/walk.lua:352: in function 'on_next_tile_set'\n    ./Lua/humanoid_actions/walk.lua:150: in function <./Lua/humanoid_actions/walk.lua:137>\n    (tail call): ?\n    ./Lua/entity.lua:218: in function 'tick'\n    ./Lua/world.lua:1121: in function 'onTick'\n    ./Lua/app.lua:878: in function <./Lua/app.lua:875>\n    (tail call): ?\n    ./Lua/app.lua:779: in function <./Lua/app.lua:774>\n. Just notices: When loading the Autosave4.sav and the patient (with a hat, enter the hospital around 14th of April, which cause a freeze when leaving the pharmacy) is waiting in or in front of the pharmacy. And i put a new hired nurse in an other pharmacy the game freeze with a different stack much more similar to #860 \nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\n./Lua/room.lua:696: Suspected infinite loop\nstack traceback:\n    [C]: in function 'error'\n    ./Lua/app.lua:797: in function <./Lua/app.lua:794>\n    ./Lua/room.lua:696: in function 'tryToFindNearbyPatients'\n    ./Lua/room.lua:558: in function 'onHumanoidLeave'\n    ./Lua/humanoid_actions/walk.lua:352: in function 'on_next_tile_set'\n    ./Lua/humanoid_actions/walk.lua:150: in function <./Lua/humanoid_actions/walk.lua:137>\n    (tail call): ?\n    ./Lua/entity.lua:218: in function 'tick'\n    ./Lua/world.lua:1121: in function 'onTick'\n    ./Lua/app.lua:878: in function <./Lua/app.lua:875>\n    (tail call): ?\n    ./Lua/app.lua:779: in function <./Lua/app.lua:774>\n. Updated the comment in the Lua code\n. Is it useful to order the translation files similar as the english.lua file?\nOther translation files don't have an original language file in the background.\nIs the order of the output of the debug-strings-new-grouped.txt file (created by 'dump strings') always the same? And could that file be a better reference for reorganize the language files in a better way? \n. Oh thanks for the hint, there was a machine_tile_y instead of machine.tile_y, this caused y of getIndexOfTask to be nil when using the callHandyman button. Using the correct value fixes the issue.\n. If a doctor is already well trained, sometimes the time to become a consultant is shorter then learning a new skill from another consultant.\n. @TheCycoONE do you think about a special lualint, maybe https://github.com/philips/lualint ? Or could it be luacheck? Something else? \nI could try to add it to the travis script, if i am sure which one to use :)\nIs there a common way to test my changes to the travis script somehow?\n. @TheCycoONE \nThere is a suggestion to fix the travis script issue https://github.com/travis-ci/travis-ci/issues/5548#issuecomment-179244964\n\nSolution is to somehow install a newer version of luarocks.\nCould you check if that fixes the issue with luasec?\n. i added luacheck to travis ci, i am not sure if it is okay like it is now\n\nThere are a lot of warnings which also could be ignored. The complete list of warnings is available here: http://luacheck.readthedocs.org/en/stable/warnings.html\nMaybe the following warnings could be ignored but fixing them could also make the code shorter and easier to read\n- 211 - 213 Unused variables / arguments\n- 421 - 433 Shadowing\nWhat do you think?\n. I could do that, but it could take some time ^^\nAlso i am not sure, if i possible start to replace several other stuff, e.g. i already found some other loops which could be easily replaced by conditions. (but of cause that could be done later)\nHow should i commit the changes? One commit per function, per file, per directory or per warning type? Should i put the changes in this pull request, in a different pull requests or all in one? Is there a common way to do a lot of small changes all over the code?\n. @TheCycoONE I will continue asap, sorry if i am a little inactive atm. There are some commits which should fix 'critical' problems like undefined global variables, i am not sure if these fixes should be moved into single pull request to commit them into the 0.60 release (but maybe they where already fixed, sorry didn't had a look at all the code changes lately). I could try to rebase that stuff to the latest code changes at the weekend. Maybe i could then say what might be critical and should be fixed in the 0.60 release.\n. Oh sorry, there was no (additional) code to detect the numlock state, but SDL should return a value now.\nI thought about enhance the keypad support at other parts of the game, too (moving with the arrow keys on the map when numlock is inactive and change the speed of the game when numlock is active, only). But for now it is for keypad interaction and text input boxes, only.\nShould i fix the other stuff in this PR, too?\n. As i said the keypad support need some changes at other parts of the game. But i will do that in a different PR.\n. Did a quick workaround \n@TheCycoONE could you test it with SDL 2.0.4?\nWould it be better to save the numlock state in a different table? Or is there a better way to handle the difference of 'permanent' modifiers (Numlock, Capslock, ..) compared to the 'only active while pressing a key' modifiers (Shift, Ctrl, Alt, ..)?\n. @TheCycoONE please check the last commit. If possible also the behavior when numlock is active before the game is started and the input to text boxes (using the latest SDL version). With SDL 2.0.2 and numlock active before game start the keypad acts as arrow keys and number keys at the same time within text boxes.\n. @TheCycoONE api version bumped, do i need to change something else? Is afterLoad required?\n. Fixed the issue @Alberth289346 mentioned.\n. Can't build CorsixTH on Debian Jessie with libav 6:11.6-1~deb8u1\ncmake -D WITH_LIBAV:BOOL=ON .\nmake\nCorsixTH/Src/th_movie.cpp: In member function \u2018void THMoviePicture::allocate(int, int)\u2019:\nCorsixTH/Src/th_movie.cpp:97:82: error: \u2018av_image_get_buffer_size\u2019 was not declared in this scope\n     int numBytes = av_image_get_buffer_size(m_pixelFormat, m_iWidth, m_iHeight, 1);\n                                                                                  ^\nCorsixTH/Src/th_movie.cpp: In member function \u2018int THMoviePictureBuffer::write(AVFrame*, double)\u2019:\nCorsixTH/Src/th_movie.cpp:291:176: error: \u2018av_image_fill_arrays\u2019 was not declared in this scope\n         av_image_fill_arrays(pFrameRGB->data, pFrameRGB->linesize, pMoviePicture->m_pBuffer, pMoviePicture->m_pixelFormat, pMoviePicture->m_iWidth, pMoviePicture->m_iHeight, 1);\n                                                                                                                                                                                ^\nCorsixTH/CMakeFiles/CorsixTH.dir/build.make:376: recipe for target 'CorsixTH/CMakeFiles/CorsixTH.dir/Src/th_movie.cpp.o' failed\nmake[2]: *** [CorsixTH/CMakeFiles/CorsixTH.dir/Src/th_movie.cpp.o] Error 1\nCMakeFiles/Makefile2:233: recipe for target 'CorsixTH/CMakeFiles/CorsixTH.dir/all' failed\nmake[1]: *** [CorsixTH/CMakeFiles/CorsixTH.dir/all] Error 2\nMakefile:107: recipe for target 'all' failed\nmake: *** [all] Error 2\n. Could compile the game on Debian 8, now.\nThank you :)\n. I restarted the map with the latest version of CorsixTH and rebuild the psych room exactly like it was in the save game. And i couldn't reproduce a crash. Had a deeper look at the save game and i missed the benches in front of the psych room. I placed some benches in front of the room and hit the crash.\nDoes the path finding has problems when there is to much stuff on both sides of a door?\n. @TheCycoONE i see the stack trace exactly when i have to choose the HOSP dir. \ncmake -D LUA_INCLUDE_DIR=/usr/include/lua5.3 -D LUA_LIBRARY=/usr/lib/i386-linux-gnu/liblua5.3.so.0 . . Hi @TheCycoONE,\nCould be reproduced on Ubuntu Xenial x86_64, too.\nUsing Lua5.3 on both systems.\nDebian: cmake . && make\nUbuntu: cmake -D WITH_LIBAV:BOOL=ON . && make\nSame on Centos 7.4 x86_64 with Lua5.1 cmake3 -D WITH_MOVIES:BOOL:OFF . && make. lgtm thx. I could reproduce the segfault with Opensuse (within Docker) and the GOG (innoextract-ed) game files. Can't reproduce the issue with demo version game files.. ```\nThread 1 \"CorsixTH\" received signal SIGSEGV, Segmentation fault.\n0x0000000000431ac2 in THMovie::load (this=this@entry=0x235cf48, \n    szFilepath=szFilepath@entry=0x704b28 \"/HOSP/INTRO/INTRO.SM4\")\n    at /usr/src/debug/CorsixTH-0.61/CorsixTH/Src/th_movie.cpp:453\n453 /usr/src/debug/CorsixTH-0.61/CorsixTH/Src/th_movie.cpp: No such file or directory.\n(gdb) bt\n0  0x0000000000431ac2 in THMovie::load (this=this@entry=0x235cf48,\nszFilepath=szFilepath@entry=0x704b28 \"/HOSP/INTRO/INTRO.SM4\")\nat /usr/src/debug/CorsixTH-0.61/CorsixTH/Src/th_movie.cpp:453\n\n1  0x0000000000432dd9 in l_movie_load (L=0x6a3c30)\nat /usr/src/debug/CorsixTH-0.61/CorsixTH/Src/th_lua_movie.cpp:55\n\n2  0x00007ffff769b3e4 in luaD_precall (L=L@entry=0x6a3c30, func=func@entry=0x23d9b50,\nnresults=nresults@entry=2) at ldo.c:320\n\n3  0x00007ffff76a5a47 in luaV_execute (L=L@entry=0x6a3c30, nexeccalls=4, nexeccalls@entry=1)\nat lvm.c:591\n\n4  0x00007ffff769b83d in luaD_call (L=L@entry=0x6a3c30, func=0x6aec30,\nnResults=nResults@entry=-1) at ldo.c:378\n\n5  0x00007ffff76977e5 in lua_call (L=0x6a3c30, nargs=, nresults=-1) at lapi.c:782\n6  0x00000000004337e9 in CorsixTH_lua_main (L=0x6a3c30)\nat /usr/src/debug/CorsixTH-0.61/CorsixTH/Src/main.cpp:179\n\n7  0x00007ffff769b3e4 in luaD_precall (L=L@entry=0x6a3c30, func=func@entry=0x6a4010, nresults=0)\nat ldo.c:320\n\n8  0x00007ffff769b7f4 in luaD_call (L=0x6a3c30, func=0x6a4010, nResults=)\nat ldo.c:377\n\n9  0x00007ffff769ab2b in luaD_rawrunprotected (L=L@entry=0x6a3c30,\nf=f@entry=0x7ffff7696580 <f_call>, ud=ud@entry=0x7fffffffebf0) at ldo.c:116\n\n10 0x00007ffff769b9da in luaD_pcall (L=L@entry=0x6a3c30,\nfunc=func@entry=0x7ffff7696580 <f_call>, u=u@entry=0x7fffffffebf0, old_top=32, \nef=<optimized out>) at ldo.c:464\n\n11 0x00007ffff769786d in lua_pcall (L=0x6a3c30, nargs=1, nresults=0, errfunc=)\nat lapi.c:821\n\n12 0x0000000000417486 in main (argc=1, argv=0x7fffffffed28)\nat /usr/src/debug/CorsixTH-0.61/CorsixTH/SrcUnshared/main.cpp:98\n\n```. CorsixTH_v0.61_Windows_Portable.zip:\nhttps://www.virustotal.com/#/url/eb28dde5938f7f8d1ba867d34b284cc1be1a0783c36a3e1d18e67f8c75ada60e/detection (url)\nhttps://www.virustotal.com/#/file/8228c30f14cf30efa119cf1709d486a904e211320f76b644f6347c2058ad0848/detection (file)\nCorsixTHInstaller.exe:\nhttps://www.virustotal.com/#/url/a8f5357cee31e2090c8ed9339188e9bfa452fbeadf3f1c28ddd5826a8213d958/detection (url)\nhttps://www.virustotal.com/#/file/5847436aac53aff7be34e30e1779223c06e9d140f2313bdbe4b0da38804dbb6c/detection (file). @B17Fan Could you provide a savegame, please? Do you have an (auto-) savegame before that stange behavior of your handymen?. It is just 'consistency', cause every other addKeyHandler is using lowercase key-names, i know addKeyHandler will lowercase all key-names, too. So this is not necessary, but i did it. I hope it does not make problems with the afterLoad stuff for old savegames\n. Would it be better to remove count1, too and use\nif #t1 ~= #t2 then return false end\ninstead of\nif count1 ~= count2 then return false end\n. Without:\n./Lua/app.lua:1089: assign to undeclared variable '_'\nstack traceback:\n    [C]: in function 'error'\n    ./Lua/strict.lua:35: in function <./Lua/strict.lua:31>\n    ./Lua/app.lua:1089: in function 'checkInstallFolder'\n    ./Lua/app.lua:114: in function 'init'\n    ./CorsixTH.lua:130: in main chunk\n    [C]: ?\n. ",
    "yyoon": "The getfield function is used here to get the translated text dynamically, by providing the name in string.\nI'll try to make it clearer and make a new commit.\n. Hope it's looking better now.\n. ",
    "skippamorgan": "i don't think billy savile should be included. i know it was in the original but due to recent revelations it would be very bad could get bad publicity.\n. ",
    "LordAro": "Sorry, what?\nFor gods sake, is the name \"Jimmy Saville\" banned now? The name isn't even the same, it's \"Billy Savile\"\nPlease revert this ridiculous change.\n. Are you both seriously suggesting that the surname \"Savile\" or any other spelling of it are not allowed to be used in programs, ever?\nOf course what Jimmy Savile did was terrible, but this is political correctness gone mad. There was absolutely no reason to make this change.\nWhy do you feel that this was necessary? I cannot think of a situation in which this could cause bad publicity\n(I'm sorry for my harsh tone, but this has made made me unnecessarily angry. :L )\n. I'm not mad, just the fact that someone went out of their way to make this change annoyed me, for some reason.\nThe whole \"Jimmy Savile was bad, therefore all references to the Savile name must be purged!\" mentality just seems ridiculous, IMO.\nBut whatever. Your game, not mine. But please make sure these 7 lines of code are really necessary :)\n. ",
    "jehoyes": "Since the name Billy Savile is a thinly-veiled joke reference to Jimmy Savile and, since this is a game about hospitals it would be a good idea to rename the VIP. What name has been chosen for the replacement?\n. I used to be able to run the mac version on my OSX 10.6.8 Snow Leopard. It's stopped working and none of the files I've downloaded from this thread will run. \nI have a version: 0.11 that will run but has a non-functioning staff appointment panel. I'm very lost as to much of what has been said here, particularly when it came to the homebrew formula link. Not sure what I should do with that information. \nDon't think this thread is aimed at people like me who generally like to plug and play. I'm happy to tinker with package contents and system files if I'm given clear instructions. I'd love to get my themeHOSPITAL up and running again. I have the original PC disc.. Scratch that. I've now found a version that works. Thanks.. It's version 0.11 \nI was being dim about the staff appointments panel and was looking at the wrong dialogue box so, as far as I can see so far, everything is working fine as usual.\nOSX 10.6.8 Snow Leopard running on a 2.66 GHz Intel Core 2 Duo iMac. . ",
    "alanwoolley": "Here's my two cents.\n@LordAro It's clearly obvious that Billy Savile is a reference to Jimmy Savile; it's not just sharing someone's surname. Consider the fact that it's set in a hospital and I think it's generally agreeable that nobody in their right mind would add it in today.\nI suppose the argument comes down to what you think CorsixTH is trying to achieve. Sure, at it's heart it's just a reimplementation of the engine, designed to make it possible to use the original TH game files on modern machines. If you stick to this definition, it would clearly be outside of our intentions (and perhaps just plain inappropriate) to want to make any modifications to Theme Hospital. But that's not what CorsixTH is anymore...\nWe've already overwritten parts of the game. There's parts we've enhanced, derived inspiration from the original game to create our own spin, added bits and removed bits too. We've fixed bugs that were in the original game, changed graphics and changed the behaviour. Whether or not you agree with this, this is the direction CorsixTH is going in. In the long run, we hope not to even need the original game files but instead bundle in our own replacement resources.\nAs the line between what is CorsixTH and what's part of Theme Hospital becomes more blurred, I think it's in the interests of the project to make these decisions. If EA released a port or remake of Theme Hospital on a new platform today, you can be pretty damn sure Billy Savile wouldn't be in it.\n. This is another issue to do with a member of staff which has been removed from the hospital for whatever reason but still has references floating about. In this case, a handyman that should no longer exist has been assigned a task.\nI've got a theory about the root cause of this. If a room explodes, all the humanoids die and so they dereference the hospital. If a handyman was in the room at the time, they also die but they can still have outstanding tasks. I don't think we take this into account.\n. Is this all sorted now? Can we close this?\n. Sorry I'm late to the party. \nI'm a bit lost in the thread, as it seems like there's multiple issues being discussed, so what exactly is the problem and what are the reproduction steps? My understanding is that saved games don't load on 0.30 RC with 32-bit XP when the update checker is enabled, but it works with the trunk - is this correct?\nHas anyone managed to reproduce this, aside from @MarkL1961. Is it just one machine that it's happening on?\n. Ok, so I can replicate this if I deliberately sabotage my core.dll file. I've submitted a pull request which seems to fix it, but I can't claim to understand this behaviour. Perhaps Peter would be best to try and explain it.\nIt doesn't explain why the module fails to load though as like I say, I had to fiddle with the .dll to force this. Either way, my commit would appear to fix it and I'd appreciate it if you could give it a test Mark. I'll leave it to you guys as to whether you think it's worthwhile including or just leaving the update checker disabled for the time being until a proper solution can be found.\n. There we go. I can't see it causing any problems, but at least it'll give us the opportunity to work out Mark's problem without having to disable the feature entirely.\n. @MarkL1961 I think by the very nature of userdata, that might be quite difficult. Best you could probably do is use getmetatable(), but I doubt it'd be that helpful. Probably better to look for some way to get the error from luasocket, but I can't find anything obvious :(\n. @MarkL1961 I like the thought and there is one thing that might be useful. \nIf you change the block in app.lua to read:\nif not success then\n    -- LuaSocket is not available, just return\n    print(socket)\n    print \"Cannot check for updates since LuaSocket is not available.\"\n    return\n  end\nthen it should output an error message.\nI suspect that the problem is trying to load the module in the first place, firewalls and network configuration shouldn't be the issue as it won't have attempted to make a connection by this point so it wouldn't know. It's more likely to be something wrong with the .dll or Windows blocking it etc.\n. And what if you temporarily rename socket/core.dll to something else - do you get the same error message?\n. See that's quite interesting, because when I do that then it at least tries to look for the .dll file.\nC:\\Program Files\\CorsixTH\\Lua\\strict.lua:66: module 'socket.core' not found:\n        no field package.preload['socket.core']\n        no file '.\\socket\\core.lua'\n        no file 'C:\\Program Files\\CorsixTH\\lua\\socket\\core.lua'\n        no file 'C:\\Program Files\\CorsixTH\\lua\\socket\\core\\init.lua'\n        no file 'C:\\Program Files (x86)\\Lua\\5.1\\lua\\socket\\core.luac'\n        no file '.\\socket\\core.dll'\n        no file 'C:\\Program Files\\CorsixTH\\socket\\core.dll'\n        no file 'C:\\Program Files\\CorsixTH\\loadall.dll'\n        no file '.\\socket.dll'\n        no file 'C:\\Program Files\\CorsixTH\\socket.dll'\n        no file 'C:\\Program Files\\CorsixTH\\loadall.dll'\nBaffling. Do you have any files in C:\\Program Files (x86)\\Lua\\5.1? Perhaps you could try renaming that directory to make sure there's nothing conflicting.\n. Very well spotted! If it comes up again then we could perhaps think about adding something to the FAQ/troubleshooting pages, but I doubt it will. I think @Lego3 is correct, yours was perhaps a bit of an odd case. Close the related issue #85 then?\n. Is this fixed now? It doesn't seem to be an issue for me with a Linux 64-bit build using the OpenGL backend.\n. @MarkL1961 Ah yes. My mistake - it's still an issue. I'll look into it.\n. I've got a fix for this, but I can't explain it as I don't know enough about the rendering process. I also suspect it's got some significant side effects, but I can't find any at the moment.\nComment out the clipping adjustment before rendering the wall shadows in th_map.cpp, and it seems to work fine:\ncpp\n   if(itrNode->iFlags & THMN_ShadowWall)\n                {\n                    /*THClipRect rcOldClip, rcNewClip;\n                    pCanvas->getClipRect(&rcOldClip);\n                    rcNewClip.x = static_cast<THClipRect::xy_t>(itrNode.x() - 32);\n                    rcNewClip.y = static_cast<THClipRect::xy_t>(itrNode.y() - iH + 32 + 4);\n                    rcNewClip.w = static_cast<THClipRect::wh_t>(64);\n                    rcNewClip.h = static_cast<THClipRect::wh_t>(86 - 4);\n                    IntersectTHClipRect(rcNewClip, rcOldClip);\n                    pCanvas->setClipRect(&rcNewClip); */\n                    m_pBlocks->drawSprite(pCanvas, 156, itrNode.x() - 32,\n                        itrNode.y() - 56, THDF_Alpha75);\n                    //pCanvas->setClipRect(&rcOldClip);\n                }\nThere's a hell of a lot of magic numbers in this function too, and it's not entirely obvious what's going on.\n. Incredibly busy at the moment, but I'll try to find time for this shortly. If you're really eager to get this merged then I think I've explained it in this thread so I'm happy for you to add one.\n. @TheCycoONE Added comments. Can we squeeze this in for the upcoming version?\n. Thanks. It'll need a couple of buttons pressing on travis-ci.org to integrate it with GitHub, but I don't have administrative access to the organisation on GitHub to do that. Will have to be something for @Lego3.\n. Travis CI automatically builds every pull request and every commit. It passes if CorsixTH can compile, the LevelEdit can compile and the individual .lua files can be compiled. It fails if any of these fail. The build for #180 has indeed been completed, and it passed meaning that these changes can safely be merged without resulting in CorsixTH being unable to be built. Obviously it can't say whether these changes are good or not, only that they don't break the build.\nExisting pull requests won't be built. Only new or updated ones.\nThere's no issue with building for a pull request that isn't merged. It's just forgotten about. The idea is that learning whether the build passes or fails should be used when deciding whether to merge it or not. Obviously you probably want to think twice about merging something which fails to build.\nI think the confusion might be to do with the purpose of Travis. The fact that the builds get uploaded is a side-effect, and only commits to this repo and pull requests from this repo are uploaded anyway. To see whether it  can be built successfully is the main point.\nEdit: and if you do want to have a pull request uploaded so that it can be tested by more people then you can merge it into a separate branch (ie. not master) and push that, then merge that branch into master (or whatever it's original destination was) when it's been tested.\n. I'm not aware of a way to do it through the website. It can be done via the git command line fairly easily though. Just make sure you get the branch name right and don't merge into master. https://help.github.com/articles/merging-a-pull-request#merging-locally\nSo the process for merging say #171 and #173 would be:\ngit checkout hell-deaths\ngit pull https://github.com/JASheppard/CorsixTH.git More_Audio_Dump_Info\ngit pull https://github.com/JASheppard/CorsixTH.git baldness_bloatyHead_fix\ngit push origin hell-deaths\nIt won't close the pull request and it won't get updated if the pull request is updated - you'd need to repeat the process again for that.\nThen if after you've tested it and it's fine, the pull requests can either be merged into master, or they can all be closed and your branch can be merged instead.\nUnless @TheCycoONE can suggest a better method? It's a bit untidy to do this for every single pull request - if they're purely LUA changes or a single request then I'd suggest just grabbing the latest compiled version of the master branch and applying the patches locally. You can download the patch for a pull request via https://github.com/CorsixTH/CorsixTH/pull/173.patch (e.g. for 173)\nEdit: Or perhaps even better - if you want to setup Travis CI on your on own fork so you can mess around with this without risking mucking up the main repo, give me a shout. I can send you a key for uploading to the server.\n. Sure. I'll send a pull request over to your fork tomorrow sometime. If I forget, give me a prod :)\n. It'll need to be done on your fork. I'll send you over a pull request tonight with details. Is https://github.com/MarkL1961/CorsixTH right?\n. Could you add me as a collaborator there please? It'd make life a bit easier.\n. Thanks. I've emailed you - should take this conversation off GitHub so that people don't keep getting notifications.\n. It should probably be done before this is merged so that it works immediately.\nI'm not sure what would happen if you updated the sdl2 branch with the latest changes from master. I suppose I could then rebase the pull request and then it'd work. \n. Looks like it's working now.\n. All sorted. I haven't squashed them entirely because I think they're all distinct changes, but it should be tidy enough to merge now.\n. I can't replicate this. Does this always happen for you? What rendering backend did SDL choose?\n. Looks good to me. Just a couple of small formatting problems that need fixing, which I've commented  in your commit.\n. I've got a branch on my fork which fixes this. I'll submit a pull request tomorrow.\n. @JASheppard We'll probably need something a bit more bespoke in places, but perhaps take a look at an established testing framework like Busted or luaunit. \nThey both effectively do what @TheCycoONE suggests and provide a nice way for running tests en masse, although I can't comment on which does it better.\nAs for the C++ side, Google Test is considered to be one of the best and lightweight. Again, never actually used it personally so I can't comment too much. I'll defer to someone more qualified on that.\n. I'm not sure what (if any) changes will be needed to make this SDL2 compatible as the branch didn't exist when I created this patch. We can probably worry about that later though.\n. @mrtnptrs The reason I chose the versions I did was because they were the latest versions I could easily find precompiled binaries for. The first few commits are fine (but you'll want to squash them later), however 9de7af0 failed due to a 404 error when it tried to download them. It's not that they're incompatible or have some breaking changes, it's simply that they don't exist! \nYou could try to find another source of precompiled libraries that'll work with mingw; compile your own (or perhaps even add that in the pre-installation stage in travis); or just stick with the versions we have and worry about it when we actually need to upgrade.\n. Looks fine to me. Could you squash this into a single commit so it's tidier? This should help if you're unsure http://blog.steveklabnik.com/posts/2012-11-08-how-to-squash-commits-in-a-github-pull-request\n. @TheCycoONE That would make sense. I was envisaging the SDL2 branch getting merged into master imminently anyway, but I suppose it may be around for a while longer.\nSDL 2.0.2 is the only one I particularly care about getting merged soon as I've a feature that relies on it which I plan to integrate over the next few weeks.\n. @TheCycoONE Perhaps there should be an SDL2 milestone or a tasklist issue to keep on top of them. I'm a bit lost in what's there, what isn't and who's working on what!\nEdit: I see there is one already. I'm an idiot.\n. Probably, but I've not got the time to try at the moment though.\n. @TheCycoONE No links to it yet, but http://www.armedpineapple.co.uk/cth/docs/\n. There's a small bit of discussion about this here: https://groups.google.com/forum/#!topic/corsix-th-dev/u-69G1fYNoA.\n. I was sure that I had fixed this before - obviously not. Should be a trivial fix though.\n. Ah yes. The missing line is:\n- cp libs/lua/bin/*.dll fresh/CorsixTH/\nand is in the SDL2 branch but not in the master. I must have only fixed it there. I'll fix that soon.\n. Good job! :thumbsup:\n. @MarkL1961 Absolutely, as far as I'm concerned.\n. Only pull requests from the project. It's for security reasons really, so whilst I could probably work around it, I don't particularly want to. \n. Thanks @TheCycoONE. It is indeed a bug, but it should be fixed already in the beta channel. If it's still an issue, could I ask that it be raised separately on the CorsixTH-Android issue tracker?\n. @TheCycoONE You don't need to close/open. If you navigate to the failing build on Travis CI, then you should find a 'restart build' button on the right. It'll pull the commit in again and retry the build. You might need to login with your GitHub account, I'm not sure.\n. @Alberth289346 Yes, the recursive flag should work fine.\n. > @alanwoolley do you have any concerns about pushing OSX builds to your server?\nThat's absolutely fine.\n. @tobylane Yes, it can only be decrypted for builds triggered by the CorsixTH/CorsixTH repo so PRs will not get uploaded. The way to test this would be to merge in to a branch on CorsixTH/CorsixTH temporarily.\n. Is this the same as #775, fixed in PR #776 ?\n. Sure. I'm not familiar at all with appveyor but as long as it can securely upload artefacts then it should be fine.\n. Even better. Thanks.\n. I don't disagree with the conclusion, but this was discussed by myself & Corsix at the time and deemed acceptable. What's changed? \nhttps://groups.google.com/d/msg/corsix-th-dev/2P9DjuL4pEk/GsUItLLdq2kJ\nhttps://groups.google.com/d/msg/corsix-th-dev/2P9DjuL4pEk/ENsut2MISicJ\n. If that's the case and there's a POC that demonstrates this as an exploitable vulnerability then that's clear - this should be disabled until it can be reworked.\n. ",
    "AntoineLemaire": "I checked all of these two files. I didn't make any difference between old or new strings.\nBut if there are others files with strings, tell me where, I will check\n. :+1: thanks ! \n. ",
    "ledowong": "The blood machine room is stuck after that. Can't even edit the room, people keep add to the queue...\nThe doctor inside is not draggable.\n. is the \"autosave\" save when there is error? coz I continues playing, I afraid the auto save is overrided.\n. Thx, I guess the issue is same as Error report 2.\n\nMarkL notifications@github.com \u00a9\u00f3 2013\u00a6~10\u00a4\u00eb21\u00a4\u00e9 \u00a4W\u00a4\u00c812:08 \u00bcg\u00b9D\u00a1G\nThere is an autosave every month, so you would have had to continue playing for a year for it to get overwritten.\n\u00a1X\nReply to this email directly or view it on GitHub.\n. \n\nx-ray!\nbtw, nice job guys, thx for this project, i can enjoy the game again!!!\n. yea, 0.21\n. Yea the blood machine too.\n. is it because too crowd outside??? I remove the chair seems solve the problem\n. autosave4:\nhttps://drive.google.com/file/d/0B05D0Cat5usfN1VlTFZad3dqeE0/edit?usp=sharing\nwhen May 1, it crash... tried all DirectX, OpenGL, SDL, same.\n. yea windows error, game close...\n. https://drive.google.com/file/d/0B05D0Cat5usfMUZQRUF5aTFNZzA/edit?usp=sharing\nthis?\n. wow, i load the save again and no crash. After a few more test, i think i found the reason...\noriginally, the game crash when the woman open the door into pharmacy. (but not due to this reason)\nif you load the save, and do NOTHING, it crash.\nif you load the game, and close the Patient popup windows (top right corner), it won't crash...\nwhat i think is, if a patient popup window is opened, and that patient leaving the map... it crash.\nhere is the video:\nhttp://youtu.be/EyrM68vvcOk\n. An error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nC:\\Program Files\\CorsixTH\\Lua\\room.lua:481: attempt to index field 'queue' (a nil value)\nstack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua: in function 'tryAdvanceQueue'\n        ...am Files\\CorsixTH\\Lua\\objects\\doors\\swing_door_right.lua:135: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1103: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function \nWarning: No event handler for timer\n. sorry, here is the save:\nhttps://drive.google.com/file/d/0B05D0Cat5usfeGJSYlZYVHlkNlk/view?usp=sharing\n. for debugging, after i modify LUA files, do I need to recompile to make it works?\nand how can i put (output) something (variables, text, etc) in console?\n. ",
    "phillipp": "The problem with the psych has recently been fixed: #365\nThat doctors don't leave the research room is expected and was the same in the original game.\nI Think this can be closed.\n. I tried both the instructions from google code and this one, but neither worked. Can you still reproduce the problem?\n. Isn't this already implemented and could be closed?\n. Ah, okay. I did see only the litter code from the drinks machines, I was not aware of other litter. But that should be a pretty easy feature. Maybe I come around to add that soon.\n. @TheCycoONE \nI think about implementing this. My plan would be:\n1. Add a new attribute for patients (like litter_probability)\n2. Being in a room with a bin reduces the probability\n3. Being outside a room or in a room without a bin would increase it\n4. If the litter_probability reaches a certain threshold, the litter_countdown would be set to anything between maybe 1 and 10, so the existing litter placement routine is used\nStep 2 to 4 would be run on every patient tick.\nThe hard thing would be to balance the magic numbers. What do you think of the plan?\n. Sure, that's a good suggestion. I will do that.\n. It may be a race condition in the Room:tryAdvanceQeue() (different patient is popped than front). And the walk action pops from the queue without handling the popped entity. I'm looking into that and have a fix that \"repairs\" the patient after sitting 5 days with a queued action without being in the doors queue...\n. It is some time ago that I dug into this problem, but I had a workaround under review. I added the following code to the patient:tickDay() method:\n``` lua\n--    if action.name == 'use_object' and next_action.name == \"queue\"\n--      and action.object.object_type.id == \"bench\" then\n    if next_action.name == \"queue\" then\n      for _, humanoid in ipairs(next_action.queue) do\n        found = found or humanoid == self\n      end\n  if not found and not next_action.queue.expected[self] then\n    if not self.noqueue_ticks then\n      self.noqueue_ticks = 0\n    end\n    self.noqueue_ticks = self.noqueue_ticks + 1\n    if self.noqueue_ticks > 5 then\n      local ui = self.world.ui\n      print('nothing to do!', next_action.is_in_queue)\n      self:dump()\n      next_action.queue:dump()\n      ui:addWindow(UIPatient(ui, self))\n\n      local room = self.next_room_to_visit\n      self:setNextAction(room:createEnterAction(self))\n      next_action.queue:expect(self)\n      room.door:updateDynamicInfo()\n      --next_action.queue:push(self)\n      --next_action:onChangeQueuePosition(self)\n      -- patient:updateDynamicInfo(_S.dynamic_info.patient.actions.on_my_way_to:format(room.room_info.name))\n      -- room.door.queue:expect(patient)\n    end\n  else\n    self.noqueue_ticks = 0\n  end\nend\n\nelse\n    self.noqueue_ticks = 0\n  end\n```\nIt basically adds a counter to the patient of ticks (=days) where the patient is queued.\nIf the patient waits in a queue, but is not in the rooms queue for 5 ticks, then a patient window is opened (for me to look into it) and the patient is re-queued into the rooms queue.\nThat worked pretty well for me. I was surprised how many times this happened (and how many deaths I had because of this bug). I wanted to find the root cause of the problem, but that was pretty hard.\nMaybe we use this first and I try to find the time to start looking into the root cause of this on the weekend.\n. No problem. I wonder if it would be a good idea to add the check anyway, for debug/integrity check purposes to check, if the problem is really fixed?\nAnd besides, savegames with the described problem will only be fixed if the fix is in place, not if the underlying problem is fixed. Or b) should that be part of a savegame version/upgrade routine or c) not be fixed at all?\n. I will try and look into the root cause tomorrow, so hopefully I can open a pull request with a fix tomorrow.\n. I don't think it's a problem directly related to the handyman. I could reproduce it with GP's office, toilets, pharmacy etc. (even without plants in it).\nI think I am near the root problem. I build some analysis functionality into the queue and got the full list of queue operations of a patient that got stuck. I will paste it here, because it may help to understand the problem and/or the queue system on related issues:\nqueue log from patient: 0x00bfbb00\nexpected: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:47: in function 'expect'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:677: in function 'tryToFindNearbyPatients'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:536: in function 'onHumanoidLeave'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:352: in function 'on_next_tile_set'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\nunexpected: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:55: in function 'unexpect'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:52: in function 'on_interrupt'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:699: in function 'tryToFindNearbyPatients'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:536: in function 'onHumanoidLeave'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:352: in function 'on_next_tile_set'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\npushed bystack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:198: in function 'push'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:359: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:343>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:648: in function 'queueAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:269: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:137>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:672: in function 'finishAction'\n        ...ram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_toilets.lua:47: in function <...ram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_toilets.lua:22>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:672: in function 'finishAction'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:209: in function <...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:201>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:672: in function 'finishAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:152: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\npopped by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:228: in function 'pop'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:487: in function 'tryAdvanceQueue'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:540: in function 'onHumanoidLeave'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:352: in function 'on_next_tile_set'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\npushed bystack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:198: in function 'push'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:359: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:343>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:648: in function 'queueAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:269: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\npopped by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:228: in function 'pop'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:502: in function 'tryAdvanceQueue'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:360: in function 'onHumanoidEnter'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:356: in function 'on_next_tile_set'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\npushed bystack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:198: in function 'push'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:359: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:343>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:648: in function 'queueAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:269: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:137>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:672: in function 'finishAction'\n        ...ram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_toilets.lua:47: in function <...ram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_toilets.lua:22>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:672: in function 'finishAction'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:209: in function <...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:201>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:672: in function 'finishAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:152: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\npopped by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:228: in function 'pop'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:487: in function 'tryAdvanceQueue'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:540: in function 'onHumanoidLeave'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:352: in function 'on_next_tile_set'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\nand another one:\nqueue log from table: 0x045a8490\n1: expected: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:47: in function 'expect'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:80: in function 'action_seek_room_goto_room'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:216: in function <...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:201>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:672: in function 'finishAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:152: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n2: unexpected: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:55: in function 'unexpect'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:227: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n3: pushed by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:198: in function 'push'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:359: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:343>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:648: in function 'queueAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:269: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n4: popped by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:228: in function 'pop'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:487: in function 'tryAdvanceQueue'\n        ...ogram Files\\CorsixTH\\Lua\\humanoid_actions\\knock_door.lua:25: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n5: pushed by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:198: in function 'push'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:359: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:343>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:648: in function 'queueAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:269: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n6: popped by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:228: in function 'pop'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:487: in function 'tryAdvanceQueue'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:540: in function 'onHumanoidLeave'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:352: in function 'on_next_tile_set'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\nthird one:\n1: expected: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:47: in function 'expect'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:80: in function 'action_seek_room_goto_room'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:216: in function <...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:201>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:672: in function 'finishAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:340: in function 'on_interrupt'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:580: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:672: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n2: unexpected: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:55: in function 'unexpect'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:52: in function 'on_interrupt'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\patient.lua:876: in function 'tickDay'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1145: in function 'onEndDay'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1060: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n3: pushed by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:198: in function 'push'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:359: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:343>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:648: in function 'queueAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:269: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n4: popped by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:228: in function 'pop'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:253: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n5: pushed by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:198: in function 'push'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:359: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:343>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:648: in function 'queueAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:269: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n6: popped by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:228: in function 'pop'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:487: in function 'tryAdvanceQueue'\n        ...ogram Files\\CorsixTH\\Lua\\humanoid_actions\\knock_door.lua:25: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n7: pushed by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:198: in function 'push'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:359: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:343>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:648: in function 'queueAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:269: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n8: popped by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:228: in function 'pop'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:487: in function 'tryAdvanceQueue'\n        C:\\Program Files\\CorsixTH\\Lua\\room.lua:356: in function 'onHumanoidEnter'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:356: in function 'on_next_tile_set'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n9: expected: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:47: in function 'expect'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:80: in function 'action_seek_room_goto_room'\n        ...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:216: in function <...rogram Files\\CorsixTH\\Lua\\humanoid_actions\\seek_room.lua:201>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:672: in function 'finishAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:152: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n10: unexpected: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:55: in function 'unexpect'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:227: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n11: pushed by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:198: in function 'push'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:359: in function <C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:343>\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:572: in function 'Humanoid_startAction'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:648: in function 'queueAction'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:269: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\n12: popped by: stack traceback:\n        C:\\Program Files\\CorsixTH\\Lua\\queue.lua:228: in function 'pop'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:253: in function 'action_walk_raw'\n        C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1105: in function 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:748>\nAt this point I'm not sure, why the patient is pushed and popped multple times and if that is to be expected.\n. I'm still working on this. Looks like the use_object action with the bench is not interrupted. I have never seen the problem with a standing patient so far.\nIt looks like the patient has another timer running. The interrupt handler of the bench can't set a new timer in the interrupt. Any ideas?\n. I managed to fix the problem (the problem was leaving the queue when using the drinks machine), but found a second one with Room:tryToFindNearbyPatients that leads to the same problem.\n@J-Shep should I add two commits to the same pull request? Bot problems manifest in the same symptom, that patients fall off the queue, but are totally unrelated in the code.\n. I opened a pull request with 2 fixes plus a workaround: #377 \n. I tried this as a fix: If the error condition matches the firdst idle is picked from the queue. I saw this many times in the console log during play but the humanoids seemed to do fine.\nIs there any problem with my solution?\n. @TheCycoONE \nI looked into this again, and also into the linked isse (#323). Both seem to be based on the same problem. The patient is queued and then going to the soda machine. When then someone else from the queue is popped and (and this is the special case, why it happens so few times) there is an orphaned idle action in the queue the onChangeQueuePosition finds that idle action and raises the error.\nI will try and see what happens if the idle action is ignored.\n. @TheCycoONE I found the root cause and explained it in the pull request.\n. I think there are two solutions:\n1. The dying part is skipped while the patient is in a room. That is, the method does nothing. If the patient is being cured if the tick sets health to 0.0 he will not die in the end. If the patient leaves the room (diagnosis, toilets) he will die after leaving the room (the death will catch him by next tick, ... final destination!)\n2. The room is \"cleaned up\" properly. That seems a lot of overhead for this :-1: \n. I implemented solution 1 and it works fine for me. I inspected the patients for this case and if they were being cured in the moment the health went to 0.0 they are counted as cured and leaving the hospital. All other patients die after leaving the room.\nTo me it is such a subtle difference that we should go for the way that is easier to implement. Maybe we use the first solution as a fix and you can change the behaviour later, but that should be a feature request then.\nI will attach a pull request with my code soon.\nEDIT: Pull request #167 \n. The pull request that fixes this is merged. If someone could please close the issue on google code:\nhttp://code.google.com/p/corsix-th/issues/detail?id=1258\nAfter that, this issue can be closed :-)\n. Is this still a thing? When I looked at the code for #372, I saw that aptients walk until they are in the hospital.\nMaybe this issue can be closed?\n. I'm still working on this. Are there any in game debug tools to see the action queue of a patient?\n. Both commits together resolve the original issue and restore the previous behaviour for dying patients.\n. Yes, I saw that, too. The mood for death is shown when the health drops below 0.1, and the patient dies at 0.0. That is another issue that we should address in an extra issue and fix.\nVon: MarkL\nGesendet: Freitag, 7. M\u00e4rz 2014 21:28\nAn: CorsixTH/CorsixTH\nAntwort an: CorsixTH/CorsixTH\nCc: Phillipp R\u00f6ll\nBetreff: Re: [CorsixTH] skip dying for patients that are in a room (#167)\nI have given this a small test against a couple of saves and it would appear to fix this issue.\nI did however notice that it was still possible for a patient close to death to enter the treatment room, show the icon for dying, but then go on to be cured (because they were in the treatment room).\nMaybe the mood icon for dying is showing too soon, showing in a room is normal if the treatment fails, so perhaps if the mood icon is dying and they are then cured at the last minute it should change to cured?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/pull/167#issuecomment-37064358.\n. @MarkL1961 yes, that would probably do it, but the \"sad6\" mood but then be deactivated in the Patient:die()\n. I removed the dead mood and changed the deactivation of the sad6 mood to the point where the patient actually dies. Otherwise there would be a tick of 1 day where the patient would show no mood. There should be no open issues with this pull request (I think).\n. This seems to be the same as #162 \n. I will start working on this soon (today or tomorrow).\n. I found and fixed one cause, but there seems to be a second one that I will continue to investigate.\n. Pull request will fix the behaviour. Tested and fix verified with the save from the google code issue.\n. Hm, interesting. I did not see that before. I will look into it.\n. @MarkL1961 Do you have any specific instructions, how I could reprduce the problem where doctors get stuck in GP's office?\n. So it is more like 'the doctor should rest, but isn't resting' instead of 'wouldn't take calls from call dispatcher'?\n. Okay, I will test that.\n. @sirlimpy  If you upload the save, I try to run it against a fix on the door queue code I'm working on right now.\n. When is 0.4 scheduled? I would like to add some other fixes that may be great to have in the next release.\nVon: J-Shep\nGesendet: Samstag, 8. November 2014 23:34\nAn: CorsixTH/CorsixTH\nAntwort an: CorsixTH/CorsixTH\nCc: Phillipp R\u00f6ll\nBetreff: Re: [CorsixTH] Update staff action before calling dealtWithPatient (#365)\n@TheCycoONEhttps://github.com/TheCycoONE Can we fix this error in 0.40?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/pull/365#issuecomment-62281586.\n. @J-Shep I didn't trace the problem through the full call dispatcher source and tested all the internals thoroughly, but it think the problem lies in the Staff:isIdle(), that the call dispatcher uses for determining the state of the doctor.\nIt looks like when the meander action is not the first action, the Staff:isIdle() is not returning true.\nI will look into your savegame right now.\n. Hm, I tried your savegame and it works totally fine with my fix. What behaviour would you expect, that you do not see?\nThe doctor is leaving the psych when the call dispatcher gets the new call for GP's/General diagnosis.\n. Yes, that is correct, but a different problem. If you open the call dispatcher you will find that there is no call to answer. So probably this is because the calls are not persisted or there is another problem, but I would prefer to handle that in an extra issue and/or pull request.\n. I checked again and think I found the exact reason. It is not the isIdle() ir something, but the action_queue:\nWhen the call dispatcher executes the sendStaffToRoom function, the queueCallCheckpointAction enqueues a call_checkpoint action. Because the meander action is set after that, it overwrittes the call_checkpoint, but the doctor is on call.\nWith the fix, the meander action is enqueued before that, so the call_checkpoint is not overwritten by it.\nAnd i can back that up by log data of the doctor:\nWithout the fix:\n89: action enqueued: walk\n90: action enqueued: walk\n91: action enqueued: walk\n92: action enqueued: walk\n93: action enqueued: walk\n94: setNextAction: walk\n95: action enqueued: use_object\n96: initializing anims: comfortable_chair / table:table: 0x0b544858\n97: setNextAction: walk\n98: action_use_object_interrupt called:use_object / comfortable_chair\n99: timer branch\n100: action enqueued: call_checkpoint\n101: setNextAction: meander\n102: action enqueued: walk\n103: action enqueued: walk\n104: action enqueued: idle\n105: action enqueued: walk\n106: action enqueued: walk\n107: action enqueued: walk\n108: action enqueued: idle\n109: action enqueued: walk\n110: action enqueued: walk\n111: action enqueued: idle\nWith the fix:\n5: action enqueued: use_object\n6: initializing anims: comfortable_chair / table:table: 0x11234a58\n7: setNextAction: meander\n8: action_use_object_interrupt called:use_object / comfortable_chair\n9: timer branch\n10: action enqueued: walk\n11: action enqueued: walk\n12: action enqueued: walk\n13: action enqueued: idle\n[... snip, some time passed ...]\n41: action enqueued: walk\n42: setNextAction: walk\n43: action enqueued: call_checkpoint\n44: setNextAction: walk\n. I don't think your privileges should be revoked.\nI tested with your savegame the whole time, and can't reproduce the problem. I spent 10 minutes fixing the bug (fix verified using your savegame \"332 occurs\") and hours for discussing the pull request. This is just frustrating.\n. The problem with \"extending the scope\" of the bug fix is that both bugs are unrelated from a code perspective.\nIf you wanted to fix the doctor that is already stuck in the psych on loading the savegame, a complete routine in the savegame-load-handler would be required. That is much more complex and more of a feature request than a bug fix. The handler would have to check every room if there should be a call, but there is none.\nMy PR fixes just a problem where the call dispatchers actions for the staff is overwritten by a meander-action in the psych after dealing with a patient.\nI don't see how that is related and should be committed and/or pull-requested together.\n. I updated the commit message with your suggestion and forxed a push into the pull request's branch. Hope that's okay.\n. Done\n. The code for the seek_reception already has the functionality that patients that just spawned walk until they are in the hospital and join the queue only then.\nIt think it may easily be changed, if the can_join_queue_at function would check if the patient is in a radius of ~30 tiles (what number would be good?) of the reception desk.\nI guess, that would be an easy fix.\n. You have a point. For long queues there may be a difference. Should I add it?\n. @TheCycoONE Sorry, I forgot to make the change. I pushed the change a few seconds ago.\n. I'm not sure if it makes a difference if tha patient sits or stands. I downloaded both saves and will start investigating now.\n. I see the problem and I have a fix, but I don't know how this is happening. It worked with the beta, so there must be some change. @MarkL1961, you saw that this was fixed in the beta, too, right?\nEdit: I tried the save with beta1 + my fix, and it works. Using the RC doesn't work.\nEdit2: Beta3 + my fix works too, so there must be a regression in the RC.\n. Yes, it is. I looked through the complete diff between beta3 and rc1, but I can see no change that would affect the queue code.\nI found out that it works in beta3 with all game speeds and with the rc1 only with max game speed (5). Can you confirm that?\n. Maybe you could check if the problem still exists with beta3 + my fix?\nTo test the fix with beta3, you have to install beta3 and then copy Lua\\rooms\\operating_theatre.lua and Lua\\humanoid_actions\\queue.lua from rc1. When I do that, the second savegame works fine at all game speeds.\n. Hm, that's interesting. But there is clearly an edge case that I missed in the first fix (see #415).\n. Ouch, hate to see that my change broke something :-(\n. ",
    "damsweb": "Sad not to see the french translation fixes in 0.30. :-(\n. ",
    "Tsbook": "Ah, yes. I can see that. Well that's just me being careless (line 3210 has no indentation at all ^_^). If this is a problem I can amend this pull request, but to me it's just a matter of readability.\n. There, it should be okay now.\n. Okay, new line added. Sorry for the trouble.\n. ",
    "lapc506": "@MarkL1961 so is there anyway I can remove that litter from my saved game?\nCan I use the level editor? Or will I have to use a text editor like Notepad?\n. ",
    "J-Shep": "@Alberth289346 Since I'm going to be changing the \"edit room\" blueprint checking code for #147, I could take over the task of fixing this for 0.50.\n. @TheCycoONE I could spend a few days investigating this, if your not currently working on this issue.\n. If no one is working on this then I will start working on this soon after I've fixed another bug.\n. @phillipp Thanks for spending some of your free time working on a fix for this problem.\n\n\nMaybe we use this first...\n\n\nAs a contributor who can merge pull requests, I personally think it would best for us to wait until you have a final fix for this problem before we add a commit for it to the trunk. The less commits there are in the trunk the better.\n. > > No problem. I wonder if it would be a good idea to add the check anyway, for debug/integrity check purposes to check, if the problem is really fixed?\n\n\nAnd besides, savegames with the described problem will only be fixed if the fix is in place, not if the underlying problem is fixed. Or b) should that be part of a savegame version/upgrade routine or c) not be fixed at all?\n\n\n@phillipp You have a point, we will need a workaround check for old saved games to fix them and by also having a fix for the root cause of this problem we can prevent this workaround check from being required for patients in new games. \nIdeally this workaround check should only need to be executed once for each existing patient in a hospital from an old saved game. Then the check could be done in the saved game upgrade routine by doing it in the Patient:afterLoad() or World:afterLoad() callback function.\nYou might be able to tweak the IF conditions for your existing workaround check to remove the need for there to be a 5 day counter which would require your check to be done for each of the first 5 days after an old hospital is loaded for each of its patients, in order to fix old saved games.\n. @Glimmer-Man Thanks for spending some of your free time helping us investigate this problem.\n\n\nI managed to fix the problem (the problem was leaving the queue when using the drinks machine), but found a second one with Room:tryToFindNearbyPatients that leads to the same problem.\n@J-Shep should I add two commits to the same pull request? Bot problems manifest in the same symptom, that patients fall off the queue, but are totally unrelated in the code.\n\n\n@phillipp Ideally issues should always be dealt with in one pull request and ideally a pull request should only have one commit. \nThe exception being when a pull request's issue requires a complicated implementation with many changes which can be logically separated into simpler separate stand alone commits like my hell deaths pull request: #229 , notice how with the exception of the last commit which actually implements hell deaths, all the other commits could be standalone commits.\n. > > I build some analysis functionality into the queue and got the full list of queue operations of a patient that got stuck.\n@phillipp Good work, if I had been working on this problem I wouldn't have created analysis functionality this sophisticated and would still be trying to debug the cause of this problem.\n. > > Ideally issues should always be dealt with in one pull request and ideally a pull request should only have one commit. \n@phillipp So please fix all of the problems which cause this bug in a single commit.\n. I'm going to investigate this bug today.\n. The problem was that a destroyed patient wasn't removed from this room's \"humanoids_enroute\" set because enroute patients aren't removed from this set when they are sent home or die. I will fix this later.\n. I will submit pull request with a fix by Saturday, I'm sorry I didn't fix this 2 weeks ago when I had identified the cause of this problem.\n. > > The problem was that a destroyed patient wasn't removed from this room's \"humanoids_enroute\" set because enroute patients aren't removed from this set when they are sent home or die.\nI intend to submit a pull request with a fix for this tomorrow.\n. Having dead and/or sent home patients in a room's humanoids_enroute list doesn't cause errors to occur when the room is edited. So I don't yet know what the cause of this issue is.\n. I've found the root problem but I don't yet know how it happens: in both the auto saves provided for #133 and #497 the patients in room.humanoids_enroute who have nil hospitals are patients who's last_room was the Research Room & the autopsy machine's use action queuing code is where the only \"patient.hospital = nil\" statement is located.\nSo patients who should have ceased to exist after using the autopsy machine have somehow ended  being referenced in the humanoids_enroute table for a treatment room they required and this problem has existed since 0.10.\n. > > So patients who should have ceased to exist after using the autopsy machine have somehow ended being referenced in the humanoids_enroute table for a treatment room they required...\nThis happens when a new treatment room is made for the first time, having had its blueprint's windows & doors confirmed, just as a patient requiring it has started using the autopsy machine and therefore can't abort this compulsory action to go to the new treatment room instead but yet an action to go to the new treatment room is added to the patient's action queue, adding them to the treatment room's humanoids_enroute table.\nI intend to submit a pull request with a fix tonight or tomorrow.\n. I would like to fix this issue this weekend if no one is already working on a fix for this issue.\n. I'm working on this now, if someone tells me they started working on this before today then I will stop working on this and if they tell me after I've submitted a pull request then I won't mind closing it.\n. My new edit room code can now detect when there's litter/vomit within a blueprint so I need to decide what the response will be.\nSuggested responses I've read:\n1. @TheCycoONE 's idea: Allow the blueprint to be built over the vomit clearing it when the room is made.\n2.  @mattmill30 's idea: Make a janitor come to clear up the vomit asap.\nPersonally I think idea 1 should be the response because:\n1) personally I wouldn't want to have to wait for a janitor to arrive and clean up all the vomit and/or litter in the blueprint.\n2) this method of cleaning up vomit and/or litter wouldn't be free when a new room is used to clean up vomit and/or litter because the player could have to pay for the new room and its objects before the vomit is permanently deleted.\n3) if a player wanted to clean up the vomit and/or litter without having to pay for a new room, by resizing an existing one they would at least have the inconvenience of needing to spend time rebuilding the room and if it has humanoids in it, waiting for them to leave. So I personally wouldn't use this method to clean up vomit and/or litter because dropping down an existing/new handyman  would be much quicker. \nWhich response do you guys prefer or do you have ideas for a better response?\n. @Alberth289346 I've not looked at my patch's code for a long time but if it won't fix the issue mentioned in #66, which allows room to be built over vomit by not doing a blueprint check just before confirm is clicked, then I will make sure it does. \n. @Alberth289346 Thanks for the good suggestion: I actually can't finish any of my CorsixTH tasks at the moment because I can't do anything on my PC without a hacker/hackers being able to interfere and he/they like to interfere with my CorsixTH work. I would like to contribute but not while hackers can get a laugh out of causing unfixable CorsixTH programming problems on my PC.\nI've reopened #708. It would be best for you to work on fixing this instead of me before the 0.50 bug fix deadline because you won't have any hackers interfering with your work.\n. Hi,\nHas anyone taken over this task during my contribution hiatus?\n. @Alberth289346 Thanks for this info, I will take a look at your work for #922 and this issue when I've finally implemented automatic error reporting soon hopefully, if I don't have any problems compiling CorsixTH like I did in the past.\n. Bloaty head patients are set to not have hell deaths because of missing animations and invisible patients are currently set to not have hell deaths because their hats disappear when they are on the ground. My WIP graphics code changes can prevent their hats from disappearing.\n\n\"... even so if people can start testing this out I am sure it would be appreciated.\"\nI would be grateful for this help.\nThanks for testing my work (and Luis's work) Mark.\n. Lava holes can spawn beneath debug patients, does anyone know why pathfinder.findIdleTile() is returning the coardinates for a tile which is being used?\n\n\nI've started making Lua code which will be able to check if a tile is occupied by a single/multi tile entity but I guess this check should be done in the C code for pathfinder.findIdleTile() because this function is meant to find an unused tile.\nThis saved game can be used with my hell death code to test this bug: http://www.mediafire.com/download/hx363gze8k581je/test.sav\n1)Open the debug console\n2)Then click on a patient in the crowd\n3) Then execute the command:  _:die() to kill a patient in the crowd (there's a bug preventing the clicked patient from being the used patient).\n. I've deleted my fork repository and then remade it, so that its master branch can be synchronised with the CorsixTH repository's master branch and my hell death code changes can be in a separate \"hell_deaths\" branch.\nI've not committed my hell death changes to the new  branch yet because I want to find the cause of a new persistence bug first.\nI will make several pull requests for some changes and bug fixes I've made today/tomorrow.\n. Does it matter if the hole appears under debug patients?\nIt doesn't, but I don't know if holes can only spawn under debug patients.\nI'm going to submit pull requests for all the stand alone changes I've made before I upload my hell death specific changes to my repository's \"hell_deaths\" branch. \nI will wait to see if all of these pull requests are accepted before I upload code to the \"hell_deaths\" branch because the code in this branch will require the code from these pull requests.\n. Perhaps you forgot to include this and perhaps others when you transferred everything to your github master?\nMaybe I didn't transfer everything to Github properly. Your hell deaths die.lua isn't correct: action_die_tick_reaper should have 4 phases with statements giving the grim reaper commands:\n\nhttp://www.mediafire.com/view/oe217lshdtm7vve/die.lua\nMy repository's master branch doesn't have any of my hell death changes in it now, it is the same as the CorsixTH repository's master branch.\n. Yes, I know the indentation for Lua code should be 2 spaces. \nI will double check all of my pull request commits to make sure that I've followed the coding conventions.\n. In the clip it looks like the bald guy gets a bloaty head when he dies. Is that what this fixes?\nYes\n. Can bald patients be killed after their treatment? I didn't consider this when I made this change, so a check may need to be added to the if statement to make sure they would otherwise have a bloaty head if their head wasn't set to 2.\nI'm going to see what happens to bald patients who die in Theme Hospital.\n. When bald patients die in TH they turn into slack tongue females and they have invisible heads when they are on the ground during hell deaths:\nhttp://www.mediafire.com/watch/55rkqg417q5jgh3/TH_baldness_death.avi\n. I suggest that on death the patient type is changed to standard male.\nAll male patients effectively die as standard male patients already because they all have the \"standard male patient\" death animations. Calling the setType() function would just change all of their animations to be the standard male animations and it wouldn't prevent bald patients from having bloaty heads when they die, so there would still need to be head changing code statements.\nThere is no head with the new hair for falling either, so the change could happen just before falling\nI think the best available solution (not requiring new graphics) for the problem of treated bald patients' heads being changed into the yellow hair bloaty head when they die, would be to just remove the \"humanoid.layers[0] == 12\" condition from this pull request's new IF statement so that bald patients will always be given the standard male black haired patient's head in the falling animation and the subsequent death animations.\n. I will implement this transformation tomorrow and then amend this pull request's commit. I will include a Chewbacca patient's gender in their class name.\n. There's a problem with the first frames of the falling transformation animation for female Chewbacca patients (1222) when they are standing: you can see their normal body before they've transformed. \nWhen changing the animation graphics code for my hell deaths on_ground missing hat bug fix, I created code to allow the start frame of an animation to be specified as a optional setAnimation() parameter. \nSo Chewbacca females could be told to stand idle for a few ticks when they die and then their falling animation could be started from a frame after the faulty frames, when they are meant to stop standing still by transforming and then falling over. \n. https://github.com/JASheppard/CorsixTH/tree/Chewbacca_Females\n. There's actually no problem with animation 1222 in CorsixTH, the problem I saw only occurs in AnimView.\nI have noticed that the Chewbacca male falling animation (4182) has missing heads in frame 30. So I'm going to create animation code which will allow the Chewbacca male transformation in 4182 to be combined with the standard male falling animation.\n. I will resume my work on this tomorrow.\n. \"I was going to suggest making one pull request for hell death rather than submitting it in piecemeal like it is now.\"\nI personally think the best and most organised way to submit a pull request for a new feature requiring many commits, is to divide it up into separate pull requests which would each only contain commits required for achieving a particular objective:\n- This would allow some commits to be pull requested before all the commits are ready to be pull requested, so pull request validators could start validating the commits earlier instead of waiting to have many commits to validate in one pull request.\n- Pull request validators can work together by each reviewing the separate pull requests.\n- Changes which could be useful for developers wanting to implement new features, can be committed sooner like: utility:table_length() and patient:isMalePatient()\n- Problems and unnecessary changes in the separate pull requests would be easier to spot since there would be fewer changes in each pull request and the changes in a pull request would be in it to achieve a particular objective.\nI was going to make one pull request for implementing the grim reaper, the lava hole and the die.lua hell death changes since these changes would only ever be required for hell deaths. But the idle_spawn action could be used for something else which is why I've created a separate pull request for it now and because its ready to be pull requested now.\n. Thanks @TheCycoONE, I will follow your advice.\n. I've fixed this:https://github.com/CorsixTH/CorsixTH/pull/185\n. This bug only occurs with debug patients.\n. I used to be able to save their deaths in hell death persistence tests. But I don't mind using normal patients now instead.\n. The only suo generated by compiling CorsixTH.exe is: CorsixTH/CorsixTH.v12.suo\n. Are all the language files encoded as UTF-8 (with BOM)?\nI've been adding translations for the new main menu \"continue game\" button (most language files already have a tooltip for it) and I've used Notepad++ to edit the language files Eclipse can't edit and it says that some files have UTF8 without BOM encoding. I've read that Notepad++ can wrongly detect the encoding type for files.\n. There's no problem with World:getPath().\nWhen it's called for the patient's and grim reaper's lava hole paths in World:getHellDeathSpawnPoints() the lava hole hasn't spawned so its tile is passable and becomes a tile in the path.\n. Hi,\nI didn't know about this pull request until I received an email about it today.\n@TheCycoONE I've been merging all of my commits into Mark's hell-deaths branch, where they can be tested and then pulled into the CorsixTH repository. \nWhere as the commits in Mark's hell-deaths branch are ready for testing and use in a CorsixTH release, the commits in my repository's hell deaths branch are WIP commits.\n. I think the implementation of hell deaths in Mark's hell-deaths branch is ready for use in a CorsixTH release. There's no more things which need to added to this implementation. \nNow that there's 4 spawn point scenarios which don't require much space, I don't think adding code to make patients walk to areas which have enough space, is necessary.\nThe only bug I know about is the missing hats and white to brown shoes on_ground animation bug. \nI've nearly fixed this bug by changing the animation playing source code but I've still not fixed the persistence problem I created a topic (https://groups.google.com/forum/#!topic/corsix-th-dev/zSVtdgQn518) for in the CorsixTH developer forum. \nI will start trying to fix this bug again soon. I've not tried to fix it since @TheCycoONE suggested fixing it in the Lua code. If I could fix this bug in the source code, then I would also be able to create a work around for the buggy 1222 female Chewbacca death transformation animation. I've created all the Lua code required for Chewbacca female deaths, but I don't want to submit a pull request for Chewbacca female deaths until there's a work around for the 1222 animation: https://github.com/JASheppard/CorsixTH/tree/Chewbacca_Females \n. I would like to have a go at merging my commits, so that Mark doesn't have to spend any more of his time trying to merge the many changes I've made.\nI can provide a better description for this pull request, with a comprehensive list of the changes I've made for hell deaths. My pull request description he's used was for a pull request I made to his repository and its description only listed changes I had made since I sent an earlier pull request to his repository.\n. # A Summary Of This Pull Request's Commits\nSource Code Change Summary\nlua_sdl.h:\n\nAdded:  define SDL_USEREVENT_SOUND_OVER(SDL_USEREVENT + 4)\n\nsdl_core.cpp:\n\nI've added code to the SDL event callback switch statement, for the case of the new SOUND_OVER event.\n\nth_lua_sound.cpp:\n\nAdded new static member variables for playing sound callbacks for the new SDL SOUND_OVER event.\n   \u2022m_a_iPlayedSoundCallbackIDs[1000]\n   \u2022m_iPlayedSoundCallbackIDsPointer = 0\n   \u2022Std:: map m_mapSoundTimers\nNew function: played_sound_callback()\nAdded new optional parameters to l_soundfx_play():\nplayedCallbackID\nsilencesPointer\n   Both parameters are  required for playing the lava hole's sound effects.\n\nLua Code Change Summary\nNew Lua files:\n\ngrim_reaper.lua\ngates_to_hell.lua\n\napi_version.lua:\n\n2037 \u2192 2673\n\napp.lua:\n\nSAVEGAME_VERSION = 82 \u2192 84\nNew SDL callback function:  onSoundOver(...)\n   This function calls audio.lua:onSoundOver() passing on the callback id for the sound which has been played.\nNew function: gameEnded()\napp.lua will call this function when games end and it in turn will call the audio.lua:gameEnded(), which will stop the lava hole's sounds.\n\ndie.lua:\n\nNew function: action_die_tick_reaper\n   This new die action function controls what happens in hell deaths.\nModified: action_die_start\n   This function can now call action_die_tick_reaper for male patients (excluding patients with bloaty heads) instead of calling action_die_tick to make them have heaven deaths. Males have a 65% chance of having hell deaths.\n\naudio.lua:\n\nNew object variables:\nself.unused_played_callback_id\nself.played_sound_callbacks = {}\nself.entities_waiting_for_sounds_to_be_played = {} : This is required for lava holes to be able to play their sound effects after the playing of sounds has been disabled and then enabled again.\nNew Function: cacheSoundFilesAssociatedWithName(name)\nModified: playSound()\n   I've moved its statements for caching the sound files associated with a name, into audio:cacheSoundFilesAssociatedWithName(name). I did this so that this code wouldn't have to be duplicated in the new sound playing function I've made.\nNew function: playSoundsAtEntityInRandomSequenceWhileFlagATrue()\n   This new function is used by lava holes to play their bubbling lava sound effects because their sound effects can't be played by the animation playing code because these sound effects are meant to be played in a random sequence, so their sound indices can't be associated with particular animation frames.\nNew function: playSoundsAtEntityInRandomSequenceRecursionHandler()\nNew query function: canSoundsBePlayed()\n   This new query function is used by the new recursion handling function.\nNew function: getRandomSilenceLengths()\n    This is used by playSoundsAtEntityInRandomSequenceWhileFlagATrue() when it plays the lava hole's sound effects so that there can be pauses with randomly determined durations between the bubbling lava sounds. It has parameters for specifying the minimum and maximum returned silence lengths and the number of lengths returned.\nNew function: tellInterestedEntitiesTheyCanNowPlaySounds()\n    This function is required to make the lava hole's sound playing code resume its sounds when the game is unpaused and/or sound effects are turned on.\nNew function: onGamePauseStateChanged(paused)\n    This new function is required to call audio.lua:tellInterestedEntitiesTheyCanNowPlaySounds() when the game is unpaused and the playing of sounds is enabled.\nNew function: entityNoLongerWaitingForSoundsToBeTurnedOn(entity)\n    This is required to prevent audio.lua: tellInterestedEntitiesTheyCanNowPlaySounds() from trying to tell lava hole's to play sounds when they no longer exist.\n\nhuamnoid.lua:\n\nNew death animation added to huamnoids: rise_hell_east\nModified: startAction()\n   So that grim reapers with no actions in their queue will be given an idle action.\n\npatient.lua:\n\nModified: afterLoad()\n   So that it will add give patients in old saved games the new rise_hell_east animation\n\nentity.lua:\n\nNew variables required to play the lava hole sound effects: \nself.FlagA = false\nself.waiting_for_sounds_to_be_turned_on = false\nself.playing_sounds_in_random_sequence = nil\nNew function: playAfterLoadSound()\n   This is required to make lava holes play their sounds effects when saved games with lava holes in them are loaded.\nAdded parameters to: playSound(name,+played_callback,+played_callback_delay)\n   These optional parameters are required to make the lava hole's sound effects be played in sequence after random length delays between these sounds.\nNew function: setFlagA()\nNew function: setWaitingForSoundEffectsToBeTurnedOn(state)\nNew function: playSoundsAtEntityInRandomSequenceWhileFlagAIsTrue()\n   This new function is required to play the lava hole's sound effects because its animation code can't play its sound effects because they are meant to be in a random sequence so each animation frame can't be associated with a particular sound effect.\n\nuse_object.lua:\n\nNew optional parameter: destroy_user_after_use\n   If used and set to true, this parameter will destroy the humanoid using the object instead of calling humanoid:finishAction() . This parameter is required to prevent patients from walking out of lava holes after they've used them.\nNew optional parameter: after_use\n   This new support for an after_use callback function is required by hell deaths to make the grim reaper start his final actions after a patient has used the lava hole.\nNew optional parameter: when_interrupted_destroy_user\n   If this isn't used a user won't be destroyed when this action is interrupted even if the destroy_user_after_use parameter is used.\n\nworld.lua:\n\nNew function: newObjectType(new_object)\n   This is used to add lava holes to old saved games.\nNew function: checkHellDeathSpawnPoints(patient,hole_x,hole_y,grim_x,grim_y)\n   This will return a boolean answer.\nNew function: lavaHoleUseTileUsable()\n   Used with the above function to check if there's enough space for a particular hell death spawn point scenario to be used.\nNew function: spawnGrimReaperAndLavaHole()\nModified: setSpeed()\n   This will now call audio.lua:onGamePauseStateChanged() when necessary.\nNew query function: isPaused()\n   This is used by the lava hole's sound playing functions.\nModified: objectPlaced()\n   This now has code for responding to the placement of lava holes, by initiating the playing of their sounds and animations.\nNew function: playLoadedEntitySounds()\n   This is required for making the lava hole sounds be played when saved games have lava holes.\n. I will try to merge my changes today.\n. I may not have my hell death commits merged until tomorrow night now because before I start merging  and squashing its commits, I want to learn more about Git by reading some important chapters in this Git documentation: http://git-scm.com/book/en/Git-Basics-Undoing-Things\n. I'm going to sort this out tomorrow now. \n\nHaving learnt what the difference between merging and rebasing is, I'm going to choose to rebase the commits instead of merging them so that the repository maintainer who accepts this pull request can just do a fast forward merge or clean apply without having to do any integration work.\n@TheCycoONE Unless you tell me you want me to do a merge instead.\n. To make sure the hell deaths pull request has a clear history of clean commits, I would like to create a new hell deaths branch containing the latest trunk code and then apply the hell death commits in Mark's branch to my local copy of this new branch, by using Meld to give this new branch the history of having a few logically segmented commits. I would then create a new hell deaths pull request for this new branch.\n@TheCycoONE Do you think I should do this?\n. @TheCycoONE This is how I intend to segment the hell death commits:\n1.  API Version 2037 \u2192 2673\n2. App.lua Commits\n3. Die.lua Commits\n4. Humanoid Commits\n5. Lava Hole Sounds: Audio.lua Commits\n6. Lava Hole Sounds: Entity.lua Commits\n7. Lava Hole Sounds: Source Code Commits\n8. New Entities\n9. Use_object.lua Commits\n10. World.lua Commits\nIf you don't think they should be segmented like this please let me know asap, I want to start working on this tonight.\n. I've asked Alan about my plan and he pointed out problems with it, so I'm going to change it and post my new plan here later. I might plan to make more than one pull request for the hell death commits.\nI won't start implementing my plan tonight, instead I will start it tomorrow so that @TheCycoONE or someone else might have time to check my new plan before I use it.\n. @TheCycoONE Alan mentioned that for each commit a person should be able to download and run it alone without the game being broken.\nSo I think there should be three separate pull requests with the third hell deaths request below requiring the first two to be accepted. This way the separate pull requests can each contain commits which can be tested and reverted independently. Though the third request can't be made until the first two have been accepted. \nPull Request 1: Lava Hole's Required: Audio Commits\nContaining one commit with all of these changes which are dependent on each other:\n- Audio.lua commits\n- App.lua commits \n- World.lua audio commits\n- Source code commits\n- API version 2037 \u2192 2673\nPull Request 2: Hell Death's Required Use_object.lua Commits\nContaining these commits with each commit being revertible without affecting the other two:\n1. destroy_user_after_use: Optional parameter commit.\n2. after_use: Optional parameter commit.\n3. when_interrupted_destroy_user_after_use: Optional parameter commit.\nPull Request 3: Hell Death Commits\nContaining one commit with all these changes which are dependent on each other:\n- Die.lua commits\n- New hell death entities\n- Humanoid & patient commits\n- World.lua hell death commits\n. I've realised now that when I planned to make 3 pull requests in my previous comment, I was thinking wrongly about what commits are. They aren't individual change sets, they are snap shots of one or more change sets which each add a new change set to the existing change sets. \nSo I will now only make one pull request for the hell death commits and I will do this tomorrow.\n. Thanks for replying @TheCycoONE \nI've been busy today, so I've not yet started working on sorting out the hell death commits. I will start working on this now.\n. I will soon be ready to make a pull request for my new hell deaths branch with its rebased code and 5 commits:\n1)  idle_spawn.lua persistence error fix\n2)  use_object.lua: +destroy_user_after_use +after_walk_in\n3)  SDL SOUND_OVER callbacks\n4)  Lava hole sound playing function: playSoundsAtEntityInRandomSequenceWhileFlagAIsTrue()\n5) Hell Deaths Implementation\n. I will finish this today and then submit a new pull request for it. I could have finished this yesterday but I was addicted to playing Civ IV.\n. This pull request can be closed now that I've opened a new pull request:\nhttps://github.com/CorsixTH/CorsixTH/pull/229\n. I will sort out this pull request tomorrow to get rid of all the extra commits.\n. I would like this pull request to be closed so that I can open a new pull request which won't have all the extra commits.\n. @TheCycoONE thanks for this helpful info.\n. Thanks for pointing out these formatting problems, I will fix them now.\n. I will do this today.\n. @TheCycoONE I've removed the dirsep comment. \n. > do you add to this function for example the functions that add the grim reaper to make him appear?\n@MarkL1961 Yes, if the hell deaths pull request included a commit which added the idle_spawn action to this game then I would provide code in App:testCommit() which would use idle_spawn to spawn a patient in order to show a tester that this action works.\nThe next commit  in this pull request could be the commit which adds the new SDL SOUND_OVER callback to this game and makes the existing sound playing functions support this callback. So for this commit App:testCommit()'s code could be changed to make it test these introduced changes by calling audio:playSound() with a print statement callback which could say \"audio:playSound() SOUND_OVER callback worked\". \nThen the final commit which adds hell deaths to this game, with the support of the already added change sets like the examples above, could make the App:testCommit() function test hell deaths by spawning a normal/debug patient and then making them have a hell death. It could also spawn a normal patient to test this new death action's persistence, with calls to the saving and load functions (debug patients can't be used for persistence tests).\n\n... A bit like a cheat to force an earthquake on demand.\n\n@MarkL1961 So this function could be used to make things introduced by individual pull request commits, happen on demand for testers and to make things happen which otherwise wouldn't (like making a test game save and then reload itself to test persistence) in order to test a new feature's ability to cope with a use case scenario.\n. > What about some sort of TestHarness.lua included in App and not persisted in saves, with a function for each unit test, and another function to run them all? (For discussion)\n@TheCycoONE I like your idea of providing a unit test storing & executing class for pull request creators to add unit tests to, so that their tests can be kept for integration testing.\n. @Lego3 told me in an email recently that he wants to start making automated unit and function tests:\n\n\nStart creating unit tests and function tests that are run automatically after each commit.\nThis is the next task on my agenda, to get some unit tests going on the Lua side. I'll also check with Alan if it can be integrated with Travis CI.\n. @TheCycoONE If no one who's read your idea has started making a TestHarness.lua class, then I want to have a go at making it today so that I can provide unit tests for my hell deaths pull request.\n. Having looked at the about pages for Busted and Luaunit, I personally think Busted would be a better unit testing framework to use because:\nBusted is provided by an open source and alive Github project where as Luaunit was made by one programmer and its development ceased years ago.\nUnlike Luaunit, Busted has a good website and good documentation.\nBusted supports more unit testing functionality with support for Mocks, Stubs and Spies. Luaunit's about page doesn't mention support for these things.\n. I think we should.\n. I'm currently working on changing how the object placement checking code works, for the last commit in my hell deaths pull request #229. When I've hopefully soon got this code to work with the changes needed to finish my pull request, I will then use my familiarity with this code to try to fix this issue.\n. \n\n\nThe setBlueprintCells() check which is failing for radiators is the World:isFootprintTileBuildableOrPassable() check. So I think the code which places double doors must be not correctly changing the buildable flag for all the footprint cells.\n. I will make some unit tests for this pull request's commits.\nI can think of one unit test for this pull request which could be automated, so this week I will try to integrate the Busted unit testing framework with CorsixTH: \nhttps://groups.google.com/forum/#!topic/corsix-th-dev/hdqFvoaN_Do\n. When @MarkL1961  first tested this code he experienced a persistence error with a few saved games he had, when the rise_hell animation was given to patients from old saved games in patient:afterLoad().\nThe error message said that the humanoid.die_anims table was nil so the rise_hell animation couldn't be added. When he moved these assignment statements to humanoid:afterLoad() he no longer experienced this error.\nI've never experienced this error with any of the saved games I've tested and yesterday I tested saved games from all of the CorsixTH releases starting from 0.01, without experiencing any errors:\nhttp://www.mediafire.com/download/ooievk9hxnxb18o/HDs-DeathSaves-Most-Releases.zip \nSo this new animation is still added to old patients' die_anims table in patient:afterLoad() because doing this in humanoid:afterLoad() requires the code for patient:isMalePatient() to be duplicated.\n. Was there a TravisCI error in #201?: the only differences between the entity.lua file in @MarkL1961 's branch and the latest file in hell-deaths2 are:\n1. I removed a duplicated function declaration for playAfterLoadSound()\n2. I've corrected the wrong parameter comment that @TheCycoONE spotted.\nhttp://www.mediafire.com/view/9c93ntn6wc1fwwt/EnityLuaComparison.txt\n. @TheCycoONE I've fixed the LuaDoc problem: playSoundsAtEntityInRandomSequenceWhileFlagATrue() had two param tags with typo mistakes.\n. Unlike the hell deaths code in @MarkL1961 's branch, the code in this pull request's branch doesn't include my heaven death sound fix for females because this commit has nothing to do with the implementation of hell deaths. The pull request @MarkL1961 merged this from is still open: https://github.com/CorsixTH/CorsixTH/pull/185   : this pull request only needs to add a single simple statement to the animation playing source code.\nShouldn't all documented function comments be preceded by \"- - -\"   ?\nThe LuaDoc \u201chow to\u201d page I read today said that:\n\nLuaDoc looks for the sequence of three minus signs (---). This sequence of characters indicates the beginning of a documented comment. The documentation ends with the first line of code found. \n\nI\u2019ve seen CorsixTH Lua functions which don\u2019t use this but instead use the multi-line comment syntax:\n\n--[[ Function description line 1\nFunction description  line 2\n@param a \n@param b]]\n\nAnd I\u2019ve seen functions which just define each @param with single line comments.\nI\u2019ve made these documentation mistakes myself, having not considered the need for proper documentation syntax to support LuaDoc generation.\nI will check the commits in this pull request for documentation syntax mistakes and I will also check all of my merged and open pull requests.\nI think the TravisCI LuaDoc check should be modified to check for function describing comments which can't be documented because they aren't preceded by: - - -\n. http://keplerproject.github.io/luadoc/manual.html : \"How to comment\"\n. I will make all the changes you want me to make tomorrow.\n. There's a persistence bug I will need to solve before I can finish changing this pull request's code.\n. There was never a persistence bug in my hell deaths code, I had forgotten that there's a persistence bug in the trunk code which occurs for debug patients when their deaths are persisted.\nI've now made all the changes @TheCycoONE asked me to make. \nI've noticed one minor graphics bug I will fix before committing my changes tomorrow: When a patient falls east they can fall through a room's west wall.\n. Yes that's the issue, I was going to make patients walk to a tile where they would have space to fall over without falling into a room.\n. I personally think issue  947 shouldn't be in the graphical issues list because it's actually a animation space issue.\n. I've changed 2 existing commits by making all the changes @TheCycoONE suggested and by making a few other changes.\nI made many changes in the \"New function: playSoundsAtEntityInRandomSequence()\" commit and a few changes in the \"Implemented Hell Deaths\" commit.\nI will start working on a new commit tomorrow for my issue 947 fix.\n\"New function: playSoundsAtEntityInRandomSequence()\" Changes\nAudio.lua:\n\nChanged playSoundsAtEntityInRandomSequenceWhileFlagATrue():\n  = name changed to: playSoundsAtEntityInRandomSequence()\n  = reduced number of parameters in getRandomSilenceLengths() call\nChanged playSoundsAtEntityInRandomSequenceRecursionHandler():\n  = Its function comment is now more detailed and uses the multi line comment syntax.\n  = Removed parameters which are no longer required\n  = Updated the names of referenced FlagA variables\n  = Removed a duplicated inner function declaration by storing its declaration in\n  sound_played_callback.\n  = Removed an unesscary tick_rate if statement\nI've made getRandomSilenceLengths()'s comment more descriptive and I've made it \n  use the multi line syntax.\nChanged onGamePausedStateChanged(boolean paused):\n  =header changed to: onEndPause()\n  =Simplified its IF statement removing the need for the paused parameter.\n\nEntity.lua\n\nvar names changed: \n  = flag_a > playing_sounds_in_random_sequence\n  = playing_sounds_in_random_sequence > random_sound_sequence_parameters\nMade playSound()'s comment into a multi line syntax comment\nRemoved function: setFlagA(state)\nChanged playSoundsAtEntityInRandomSequenceWhileFlagATrue():\n  = Shortened its name to: playSoundsAtEntityInRandomSequence()\n  = Made its comment into a more detailed multi line syntax comment\n  = Updated referenced var names and names for called functions()\n  = Removed no longer needed parameters from the \n  audio:playSounds...InRandomSequence() call.\nChanged playSoundEffects() by making its if statement check more thorough.\nChanged playAfterLoadSound() by updating its referenced var and function names.\n\nWorld.lua:\n\nChanged setSpeed() by modifying its if statement which deals with calling the\n  audio class's pause ended callback.\nChanged objectPlaced() by updating the name of a called lava hole audio \n  function.\n. I think I should make a new pull request for my issue 947 fix because it isn't required for the implementation of hell deaths and is also a fix for heaven deaths.\n. I'm currently examining UIPlaceObjects:setBlueprintCell(x, y) because it has code to perform the check I mentioned in my previous comment and I want to make sure all of its object placement checks are done for lava holes. \n\nSo I want to move all of its object footprint tile location checking code into a separate function so that this code can be called by the Place_Objects window and when objects are spawned which aren't placed by players.\n. I will try to get this done this weekend, though I'm having trouble separating the object placement checking code from the rest of the code in the setBlueprintCell() function because I'm having trouble reading this function with its 222 statements and very few comments explaining what sections of statements do.\n. I've just sent an email to Peter asking him to modify setBlueprintCell() because I presume he made this complicated function and I don't want to continue programming things for CorsixTH until I've sorted out my security problems. \nWhen I was doing CorsixTH programming a few days ago in Eclipse I saw the CorsixTH files in my Github work directory being deleted by my PC's hacker.\n. @mrtnptrs Thanks for offering to help me with my PC's security, I've made it more secure now so I'm hoping it's secure enough and if it does get hacked again I will contact you.\nToday I will start programming things for CorsixTH again and I will try to get the object placement checking code sorted out for hell deaths asap. Peter never received the email I sent because its address was wrong.\n. Thanks @Grimdoc\n. I now want to create an automated/manual unit test for the object placement checking code so that the reviewer of my new commit, which will separate this code from setBluePrint(), can use this test to help them check that this code works after my new commit as well as did before.\nIf no one is working on integrating a unit testing framework with CorsixTH, then I will make doing this asap my priority.\n. I will try to finish this pull request's final commit by next weekend.\n. > > A check needs to be added to this function to ensure that the lava hole object won't trap any humanoids when it spawns. I will do this later or tomorrow.\n\n\nI'm currently examining UIPlaceObjects:setBlueprintCell(x, y) because it has code to perform the check I mentioned in my previous comment\n\n\nI've now moved the code for this \"pathfinding broken?\" check into a separate function and I've corrected a mistake: \nThe test this check performs starts by setting the passable flag for all the map tiles in the object's footprint to false, as if the object had been spawned. It then checks if the tiles adjacent to the footprint's tiles will become isolated. The mistake is at the end of this test: instead of restoring the footprint tiles' passable flags to what they were before the test, the statement at line 756 in place_object.lua sets the passable flag for all the footprint's tiles to true: setPassable(true).\nI could possibly finish this pull request today by just using this new pathfinder testing function to perform the one lava hole spawn test that I know is missing from the current commits. But I still want to add a commit which will separate the other object spawn checks from setBluePrint() so that lava holes can use them instead of the Lua checks I created in my \"Implemented Hell Deaths\" commit, which replicate these existing place_object.lua checks.\n. The code for this new pathfinder testing function can be seen in the WIP hell deaths branch I've created in my repository:\nhttps://github.com/J-Shep/CorsixTH/commit/8b4ae87426ff920ac21dd1f84ec505e5ed786293\n. I've now separated all 4 of the SetBluePrintCell() checks for non side objects and the 3 I've tested are working correctly. \nWhen I've made sure the 4th check still works correctly, I will then squash the test seperation commits in my hell deaths WIP branch into one \"SetBluePrintCell(): Seperated Pre-Spawn Object Checks\" commit. This new commit will come before the \"Implemented Hell Deaths\" commit in this pull request's commit order.\nThen I will then amend the hell deaths implementing commit to make it use the now usable separated object pre-spawn checks in place_object.lua.\nI may not finish doing the above today because I want to spend some time today working on a fix for error #291 .\nWhen there are no more missing pre-spawn checks, the only remaining unresolved hell deaths implementation issue will be the very minor, missing animation layers, missing hat & changing shoes male on_ground animation graphical issue. I edited the graphics code many months ago to work around this animation bug by freezing the final frame of the fall animation, when the patient is on the ground. But I wasn't able to make the C++ code persist this.\nDo you guys think this graphical issue should be fixed in a commit in this pull request or should it be fixed by another pull request so that this hell deaths implementing pull request can be merged asap?\n. > > Did you get to testing the 4th case?\n@TheCycoONE No, since my previous comment in this discussion thread I've spent all my CorsixTH programming time working on issue #293. \nWhen is the  code freeze deadline for 0.40? \nNow that I know this deadline is approaching I will spend a lot more time doing CorsixTH programming to try to get my commit for issue #293 finished within the next few days and then the final commit for my hell deaths implementation. \n. @TheCycoONE I want to focus on working on bug #293 today and then after reacquainting myself with my code for the separated object placement checks tomorrow, I will tell you how long I think it will take me to finish this pull request.\n. > > For existing pull requests, particularly this and epidemics I'm willing to extend that deadline by a couple days if you're very close and need the extra time\n@TheCycoONE I might be able to finish this pull request before the 25th but I think I'm likely to need a 2 day extension to the code freeze deadline.\nI've now finished separating the fourth test for non side objects: footprint cells either need to have  passable or buildable floor tiles so this test checks the appropriate tile flag. This test is working correctly when tiles are valid but I've not yet tested it with invalid tiles:\nhttps://github.com/J-Shep/CorsixTH/commit/ea6634c7597bf353f7f4dd1181ca3b8c797081e2\nSo I've now separated all 4 checks for non side objects and setBluePrintCell() is still working correctly.\nSo when I've finished making sure the 4 checks are working properly I will then add a new function which will call all of them: UIPlaceObject:canNonSideObjectBeSpawnedAt(x, y, object, orientation) , and then I will make the lava hole spawning function call this.\n. What's the purpose of a foot print cell's complete_cell flag and its needed side flag?\n. @Lego3 @TheCycoONE Thanks for your help guys.\n\n\nIf I remember correctly complete_cell = true means that no more objects can be placed on that tile.\n\n\nThis is what this flag does.\n. I think its safe to say that this pull request will be finished by Saturday, if not Saturday then probably Sunday.\n. I've now added the commit for the place_object.lua changes but I've not yet changed the \"implemented hell deaths\" commit to make it use these changes.\n. I will finish this pull request tonight/tomorrow, I just need to modify World:checkHellDeathSpawnPoints() and the lava hole's footprint.\n. I'm sorry I've still not finished this pull request, hopefully I will be able to finish it tomorrow.\nI've still not finished this because I didn't have much free time to work on this today and I've decided to change how hell death spawn points and hole use tiles are chosen. The new process is simpler and requires less statements.\n. The new process for choosing hell death spawn points and lava hole use tiles is working well, it still works by testing spawn point scenarios but it now requires less code and this code is simpler.\nI will finish this pull request tomorrow after I've made and tested some more spawn point scenarios.\n. I've updated this pull request's commits but I've not finished it yet, there's only one spawn scenario and I've noticed that the lava hole's sound effects are no longer resumed when a paused game is resumed.\n. I've now fixed the bug which prevented the lava hole's sound effects from being played when a game is unpaused and I've added a spawn scenario which allows the lava hole & grim reaper to spawn east of the patient.\nBut I've now found a persistence problem which needs to be fixed because it prevents hell death saved games from being loaded.\n. The persistence error I've been experiencing isn't the result of my hell deaths code because it also occurs with heaven deaths in the master branch's code: #321\n. @TheCycoONE I think this pull request's code is ready to be frozen, there are no bugs that I know of and the only issue I have with the current implementation of hell deaths is that they can't happen in 1 tile wide corridors between benches/walls because the lava hole would make humanoids with blocked paths take a longer route around the blocked corridor. So I've given males a 75% chance of having hell deaths when there is enough space. Should I reduce this back to 65%?\nI've started working on changing the hell deaths code and walk action's code so that if a humanoid's path was blocked by a lava hole they couldn't walk around they would stand and wait for the hell death to finish before continuing to walk along their original path.\n. Here's some saved games which can be used for testing hell deaths:\nhttp://www.mediafire.com/download/gfnluk7f3ajfne9/Hell_Death_Test_Saves.zip\n. This debug script code can be used for testing canNonSideObjectBeSpawnedAt() with single tile objects: \n```\nlocal function test_canNonSideObjectBeSpawnedAt()\n  :setNextAction({name = \"idle\"})\n  local can_be_spawned = TheApp.world:canNonSideObjectBeSpawnedAt(.tile_x, _.tile_y - 1, \"plant\", \"north\", 0)\nprint(\"{x = \" .. tostring(.tile_x) .. \", y = \" .. tostring(.tile_y) .. \"}  \"\n                .. \"can_be_spawned?: \" .. tostring(can_be_spawned))\nend\ntest_canNonSideObjectBeSpawnedAt()\n```\nJust use it on a humanoid to make them stand idle on their tile and then you can execute the debug script when the placement of a corridor plant on the tile behind them should/ shouldn't be allowed.\n. @TheCycoONE I've made all the changes you requested and I've also:\n- Moved the world:objectPlaced() change for spawned lava holes to the hell deaths implementing commit.\n- Moved the creation of the new function: world:newObjectType() to the hell deaths commit where its used with lava holes.\n- Renamed App:gameEnded() > worldExited() : This function was created in the SDL_Sound_Over commit.\n- Reduced the probability of males having hell deaths from 75% to 65% because I think 75% might be too likely.\n- Changed some commit messages.\n. @TheCycoONE I've made the saved game version number changes you requested.\nOne test I've not done  on this code recently is trying to load old saved games, I will do tests tomorrow and I will try to find out why your saved game isn't loading.\n. @TheCycoONE I just changed the version numbers in the hell deaths implementing commit, I will change them today in the commits where I actually introduced these afterLoad() code changes.\n. The hell deaths commit and the playSoundsAtEntityInRandomSequence() commit added new world:afterLoad() statements. I've now made them use 87 as the current saved game version and I've changed App.SAVEGAME_VERSION to 87 in the playSoundsAtEntityInRandomSequence() commit.\n. @TheCycoONE  I've not been testing old saves since I said I would: I will do these tests later and I will try to fix any persistence problems I find by Monday.\n. @TheCycoONE I've fixed the old saved game persistence bug: the Humanoid.die_anims table could be nil when Patient:afterLoad() would add the new rise_hell_east animation to patients from old saved games, so I've added a \"is nil?\" check which initialises this animation table when its nil.\nThis check wouldn't be necessary if the new animation was added in humanoid:afterLoad() but then the Patient:isMalePatient() function's code would have to be duplicated.\nYour saved game can now be loaded and 0.30 heaven death saved games can now also be loaded.\n. These are the 0.30 saved games I've used to test persisting deaths from this release:\nhttp://www.mediafire.com/download/igfeom57nd6lc9y/030_Persist_Death_Saves.zip\n. @TheCycoONE I've now also updated the current saved game version number from 84 to 87 for the \"implemented hell deaths\" commit's afterLoad() changes.\n. @TheCycoONE I've added a new line to the end of gates_to_hell.lua .\n. @TheCycoONE I've removed the white spaces since only a quick fix was required.\n. @GitBranch  Hi, if your willing to give me collaborator access to your CorsixTH fork repository then I will help you clean up this pull request and I will merge this pull request when it's ready.\nTo add me as a collaborator just access your CorsixTH repository's settings on the Github website and then you will see a \"Collaborator\" link which will take you to a text box where you can input my name.\n. @TheCycoONE I will, I wouldn't want the work @GitBranch has done to not be used when I might be able finish his/her pull request.\n. If no one has fixed this problem already then I will fix it this weekend.\n. I'm working on a fix for this now.\nI will also add some buttons to the saved game menus this week to allow saved games to be deleted and renamed from these menus.\n. @TheCycoONE Thanks for offering to finish this off in May, I don't recall reading an email notification about this message, if I had known that you sent me this message then I would have replied. I never ignore messages which are sent to me, so if I haven't replied to some messages from CorsixTH developers then its because I've not noticed their messages. I will now check my inbox every day.\nI will try to finish this pull request asap.\n. @TheCycoONE I've made the improvements you've asked for, I will resolve the merge conflicts later.\n. @TheCycoONE I resolved them.\n. I've had an implementation idea which is probably a bad idea but I will mention it anyway:\n- The % level of a casebook price would not directly affect a hospital's reputation value.\n- The % level of a casebook price would directly affect the probability of a patient going to the player's hospital instead of a rival hospital. For example: if your hospital has the same reputation value as rival hospitals but a case book price for bloaty head treatments which is X% lower than your rivals, then it would make sense that bloaty head patients would be more likely to choose your hospital.\n- The % level of a casebook price would also directly affect a patient's happiness value when they are asked to pay for a diagnosis/treatment by simply reducing it by a particular amount, with only free prices not reducing their happiness.\n- There would be no patient wealth classes: instead patients would only leave a hospital because of a price being too high, when its reduction to their happiness value is what caused this value to become low enough to be <= the \"leave hospital\" constant. \n. @LeonardoGamer Hi, if you can just remove the 5 white spaces from this pull request and squash its 4 commits into 1 then this pull request will be ready for me to merge.\n. @MarkL1961 I will try to fix this bug by Saturday if your not already working on this.\n. @MarkL1961 Today I will investigate why this bug is back.\n. @MarkL1961 In your saved game the game isn't paused because for some reason world:isCurrentSpeed(\"Pause\") is returning true.\n. @MarkL1961 It also returns true in another saved game I've tested.\n. None of the commits since my #288 bug fix commit, have changed anything related to the game speed code so I don't yet know how this bug has come back after my simple commit fixed it on August 2nd.\n. @MarkL1961 Your saved game and the other saved game I've tested are both level 1 hospitals which are won after the first year: so before the annual report dialog is opened, world:winGame() is called and line 1514 pauses the game but for some reason this setSpeed() call fails to pause the game.\n. Another problem with winGame() being called at the end of the first year in a level 1 hospital is that the \"end game?\" fax message doesn't appear. winGame() works properly when its called 4 months later.\n. Fax:close() is being called before the \"end game?\" fax message has been opened and before its icon has appeared, this sets the game speed from paused to normal after the annual report dialog has been displayed.\nImo winGame() shouldn't be called at the end of a year until after the annual report dialog has been closed.\n. > > Imo winGame() shouldn't be called at the end of a year until after the annual report dialog has been closed.\nThis is the problem: the fax window and annual report window can't be displayed at the same time because they have the same window.modal_class, so the \"end game?\" fax window is deleted by ui.lua (before its icon has been clicked to make it visible) when the annual report window calls: ui.addWindow()\nI will submit a pull request later which will fix this bug.\n. @MarkL1961  Yes it was being opened automatically but the conflict this fax window had with the annual report window, would close it before it became visible.\n. @MarkL1961 @TheCycoONE  Yes I saw that function's response to the release of the \"Speed Up\" key but it can't handle the release of the \"Speed Up\" key when the game speed is in its \"Paused\" state because the current speed will be \"Paused\".\n@TheCycoONE \n\nThe difficulty is that there isn't currently a state tracking when the key is held down so you would know what speed to return to.\n\nI know, I've solved this for ASCII keyboards:\nhttps://github.com/JASheppard/CorsixTH/compare/SDL2_WIP_Commit?expand=1\nThe problem with my commit in this WIP branch is that the \"code\" parameter I've used in OnKeyUp() doesn't provide a UTF-8 key code unlike the \"rawchar\" parameter provided in OnKeyDown(). The parent UI:OnKeyUp() function's comment says:\n\n--!param code (integer) The hardware key-code for the pressed key. Note that\n-- these codes only coincide with ASCII for certain keyboard layouts.\n\nAnd the SDL switch statement for OnKeyUp events in sdl_core.cpp has a comment which says that SDL doesn't support UTF-8 key codes for OnKeyUp events:\n\ncase SDL_KEYUP:\n                lua_pushliteral(dispatcher, \"keyup\");\n                lua_pushinteger(dispatcher, e.key.keysym.sym);\n                // NB: No unicode translation done by SDL for keyup\n                nargs = 2;\n                break;\n. @TheCycoONE I see your point, so I will modify this pull request's commit later to make it use my excluded commit's changes and OnKeyUp() will set: game_ui.speed_up_key_pressed to false whenever a key is released.\n. I've now updated this pull request's commit.\n. My Github client isn't ignoring the debug script despite it being in: .GitIgnore .\n. @TheCycoONE Don't you think being able to execute debug commands by simply editing a script in an IDE tab and then pressing shift + D in game (with it in windowed mode), will always be easier than using the debug console? The debug console will never be as sophisticated as the Lua file editor in Eclipse's \"Lua Development Tools\" plugin.\n. @TheCycoONE I see. I've thought about making a debugger for CorsixTH but I'm not sure if I'm a good enough programmer to implement it properly. \n\nI might have a go at making this after I've finished implementing hell deaths and have made CorsixTH support Lua unit testing.\n. Hi @DjCoke,\nThanks for reporting this problem, I will try to fix it.\n. @DjCoke If you have an earlier saved game/auto save for this hospital please upload it so that I can use it to try to find out when and why the tile_x variable became nil.\n. I've found that there's one patient in this saved game, from the start, that has a nil tile_x value: patient 30.\nThis is the debug script code I used to find this patient in the source code for release 0.30:\nlocal world = TheApp.world\nlocal index = 0\nfor _, patient in ipairs(world.entities) do\n  if class.is(patient, Patient) then\n    if patient.tile_x == nil then\n      print(\"Patient with NIL tile_x found: \" .. index)\n    end\n    index = index + 1\n  end       \nend\nI've not yet run this debug script test in the trunk source code.\nIf any other developer wants to use my debug script running code to test bugs in the source code for release 0.30 here's the instructions I made for my self:\n```\nmenu.lua:\n731:\n:appendItem(_S.menu_debug.debug_script,       function() self.ui:runDebugScript() end)\nui.lua:\n251:\nfunction UI:runDebugScript()\n  print(\"Executing Debug Script...\") \n  local path_sep = package.config:sub(1, 1)\n  local lua_dir = debug.getinfo(1, \"S\").source:sub(2, -8)\n  _ = TheApp.ui and TheApp.ui.debug_cursor_entity\n  local script = assert(loadfile(lua_dir .. path_sep .. \"debug_script.lua\"))\n  script()\nend \n272:\nself:addKeyHandler({\"shift\", \"d\"}, self, self.runDebugScript)\n873:\nif old < 85 and self.app.config.debug then\n    self:addKeyHandler({\"shift\", \"d\"}, self, self.runDebugScript)\nend\n```\n. > > I'm so sorry, i played the level further, so i only have salvaged some saves. I hope you have enough:\n@DjCoke np, thanks for uploading these saved games.\n. DjCoke uploaded a saved game from Aug 2nd year 3 which doesn't have the patient who has a nil location, the save which does is for Aug 25th year 3. This bug doesn't reoccur between these dates.\nSo I'm going to have trouble finding out why this bug occurred before the Aug 25th hospital state was saved/ when it was saved.\n. @MarkL1961  @DjCoke This must have been the cause: the patient who has a nil location has the \"use screen\" action as their active action in their action queue but I've not found this gut rot patient in a room which has a screen and their \"use screen\" action never ends. \nThanks for your help guys: now that I know what triggered this bug, I should be able make it reoccur with printed debug statements to tell me why CorsixTH failed to correctly respond to DjCoke's room deletion request.\nI will continue working on this tomorrow.\n. @MarkL1961 Thanks for telling me about these possibly related issues, I will have a look at them.\n. @DjCoke was the patient getting undressed behind the screen when you wanted to edit the cardiogram room?\n@MarkL1961 @DjCoke Trying to edit the cardiogram room when a patient is getting undressed behind the screen, is the only situation I've found which makes the edit room response fail. So issue 1626 must be responsible for the invalid patient in this issue who caused the place bench error to occur.\nIf issue 1626 hasn't been fixed already then I will try to fix it asap.\n@TheCycoONE @Lego3 Could a small bug fixing patch be released soon to fix this severe 0.30 release error which players have a likely chance of experiencing?\n. Issue 1626 hasn't been fixed in the trunk version, in the trunk version I've tested this issue with the general diagnosis room and the cardiogram room.\n. @DjCoke I guess issue #293 may not have been responsible for the error you experienced because you would probably have remembered seeing the patient try to leave the cardiogram room without their clothes and would have mentioned this in your description of what happened. \nAfter I've fixed issue #293 and any other room use interruption bug I find when I've tested all the rooms with all the interruption causes, I will want to try to get my implementation of hell deaths finished by this weekend so that hell deaths might be included in release 0.40. I will then continue investigating this bug in case its cause wasn't issue #293.\n. > > I think I have read somewhere that the go to room order is based on the tile coordinates which are just inside the rooms door.\n@MarkL1961  This is correct: if seek_room finds a room it then calls the room's createEnterAction() function (line 76 in seek_room) which uses the room's getEntranceXY(inside) function to return a walk action with the destination coardinates being the tile on the other side of the room's door (line 92 in room). Room:createEnterAction() also (if the room is active) adds the patient to the room's humanoids_enroute[] set which associates humanoids with callbacks which are called when the room is deleted in Room:deactivate(). seek_room provides a meander action callback.\n\n\nIf it in the patients list of things to do and that room is no longer there could it result in tile_x variable becoming nil? This must work most of the time otherwise this error would be seen all the time. But, perhaps there's an edge case when combined with something else that stops the order being removed.\n\n\n@MarkL1961 I don't think this could cause the X coordinate for the patient's current tile to become nil but I will investigate this when I've finished my commit for issue 293 and the other room use interruption bugs I've found.\nThanks for suggesting this as a possible cause.\n\n\nWell what I did do was not delete the scanner room, but moved it to the cardiogram location. I did not recreate the room, what you can do is click on the blue space and hold it, then move it. Maybe that caused the error?\n\n\n@DjCoke I've not had a look at the code which moves rooms but I think its unlikely that the code for this action could make the recorded location for the room's user become invalid. Thanks for suggesting this.\n\n\nWell, what i remember what I did was deleting the cardiogram. There were people inside, but they moved. I got a lot of questionmarks and I remember that I ignored them and I moved the scanner. Between these moments before or just after I couldnt place or move benches, because of the bug.\n\n\n@DjCoke When you described here what happened here before you couldn't place benches, what did you mean by getting \"...a lot of question marks ...\" ? \n. @MarkL1961 I see, I've never seen this happen because I've not spent much time playing CorsixTH.\nI agree, I think all these fax questions should only be asked when a room which has a patient queue is deleted.\n. @TheCycoONE I don't think #293 was responsible for this nil tile_x bug because if #293 had occured when @DjCoke told the game to display the edit menu for the cardiogram room then @DjCoke would remember seeing the patient try to leave while undressed and @DjCoke would not have been able to delete the cardiogram room after the patient & doctor had exited because #293 would have crashed the game before the edit menu was displayed.\n\n\nWell, what i remember what I did was deleting the cardiogram. There were people inside, but they moved. I got a lot of questionmarks and I remember that I ignored them and I moved the scanner. Between these moments before or just after I couldnt place or move benches, because of the bug.\n. I would like to pass on the responsibility of working on this to someone else so that I can focus on #386\n. @mounirlamouri Thanks for implementing this UI improvement.\n. @Lego3 @TheCycoONE I'm going to start creating a fix for this problem using the 0.30 source code because I'm assuming a 0.31 patch will be permitted. \n\n\n@TheCycoONE If there will be a 0.31 patch, please create a repository branch for this patch so that I can submit my pull request with its release ready commit to this branch.\n. I will just submit a pull request for the master branch.\n. I will finish my hell deaths pull request asap after I've fixed this room use interruption bug and any others I find when I've tested every room with every interruption. I will create a pull request for my solution to this issue tomorrow.\nMy hell deaths pull request will possibly be finished by this weekend, though I may not have the animation bug fixed by then.\n. I'm sorry I've not made a pull request yet with my #293 fix in it, despite saying I would have it done 3 days ago. I want to make one pull request with this room use interruption bug fix along with fixes for all the bugs I've found while testing every room with every use interruption.\nMaybe I will be ready to make this pull request by Monday but I now think I won't have time to get my hell deaths pull request #229 finished this weekend.\n. I've now published my branch for my #293 fix and the other room use interruption bug fixes I will create commits for. It currently only has my #293 fix in it:\nhttps://github.com/J-Shep/CorsixTH/compare/fixedError293AndOtherRoomUseInterruptionBugs?expand=1\nI've only tested this commit with the Cardiogram room, I will test it with all the other rooms which have clothes changing screens before I make a pull request. @TheCycoONE If you would like me to create a pull request for this one bug fix today for you to check and merge, then I will do this and create a separate pull request for my other room use interruption bug fixing commits.\n. @TheCycoONE I've only thoroughly tested the cardiogram room so far and while testing it I've found 2 bugs which I've fixed in addition to #293 but I've not yet made commits for these 2 bug fixes. \nThe third issue I've found in addition to #293 is that operations can't be interrupted once the patient has undressed (I've not tried interrupting operations with earth quakes and with a explosion). \n. The cardiogram only has bug #293, the other bugs I found in this room were caused by my fix to this bug.\n. You can get them from the demo:\nhttp://www.fileplanet.com/11380/10000/fileinfo/Theme-Hospital-Demo\nJust extract the HOSP directory from this zip and put it in a directory where you want to keep Theme Hospital's data files for CorsixTH to use. Then click on the \"HOSP\" directory in the CorsixTH file browser which appears when you start it and it can't find the data files.\n. I only deleted an unnecessary function separating line space in ui.lua at line 795 but I've undone this change now.\n. @Grimdoc Thanks for contributing this translated text.\n. @benckx Thanks for working on a fix for this bug, I will review your pull request tonight/tomorrow.\n. @TheCycoONE How many commits would be best for this pull request?: 2 to separate the refactoring changes and from the #838 fix changes or just 1 commit for all the changes?\n. @benckx Thanks for testing my pull request's commit.\nHere's some saved games for the 3 rooms my changes affect, patients are about to enter them in these saved games:\nhttps://www.mediafire.com/folder/n7l47t559j35h/293_Fix\n. @benckx Sorry I forgot to mention that the scanner room didn't have this bug before I fixed it but I've provided a saved game for testing the scanner room to show that it doesn't have this bug now that its using the new code for preventing this bug. \nYou can see from the Github difference display that originally the scanner room's makeHumanoidLeave() function was overridden to make patient's dress before they exited but I've now moved this code into Room:makeHumanoidDressIfNesscaryAndThenLeave() so that it can be shared with the other rooms without duplicating it.\n. @TheCycoONE I will change this commit's message by using a shorter title and describing what this commit does in its description instead of trying to cram this sentence into its title.\n. @MarkL1961 It's with a normal patient. Thanks for spending an hour trying to reproduce this, I will try to find out why this error is happening on my PC.\n. This bug didn't occur when I persisted a death caused by a failed cure attempt. \nSo for some reason deaths caused by the call to patient:die() in Patient:treated() can be persisted but deaths caused by killing a patient with a die() call in the debug script can't be persisted (on my PC anyway) like when I couldn't persist the deaths of debug patients by calling this function in the console.\nThere are no patient entity destroying and death related statements in Patient:treated() outside of its patient:die() call so I can't see what missing statements are making a difference.\n. I've closed this issue because @MarkL1961 wasn't able to reproduce it on his PC and I've not experienced it on my PC when I've tried to persist deaths not caused by calling die() in the debug script.\n. @TheCycoONE I think I may have experienced this bug with the 0.30 code without my audio changes. I will investigate this bug now.\n. @MarkL1961  Well music certainly wasn't played while the game was paused after my audio changes, so I think this music bug must have been introduced by a commit merging mistake.\n. > > Well music certainly wasn't played while the game was paused after my audio changes, so I think this music bug must have been introduced by a commit merging mistake.\nIts possible that I introduced this bug when I started finishing my hell deaths pull request by rebasing my hell deaths 2 branch with the master branch. I had made the mistake of not keeping it up to date so there was many conflicts I needed to resolve and so I may have made a rebasing mistake when I was resolving conflicts in the audio code.\nI will continue investigating this bug now.\n. > > Well music certainly wasn't played while the game was paused after my audio changes, so I think this music bug must have been introduced by a commit merging mistake.\nOn second thoughts, maybe it was and I wouldn't have reported this bug because I would have assumed the music was meant to carry on playing when the game was paused.\nI've copied my hell deaths 2 branch and then removed all the hell death commits from the copy and the music is played when the game is paused so none of its commits are responsible for this bug.\n. > > I've copied my hell deaths 2 branch and then removed all the hell death commits from the copy and the music is played when the game is paused so none of its commits are responsible for this bug.\nIssue #331 is in the hell deaths 2 branch when it doesn't have any hell death commits.\n. I've just experienced this issue in the released 0.30 code.\nThe problem is that the game doesn't stop ticking when its paused so GameUI:onTick() will carry on occasionally making a random announcement occur with this code:\ndo\n    local ticks_since_last_announcement = self.ticks_since_last_announcement\n    if ticks_since_last_announcement >= self.random_announcement_ticks_target then\n      self:playAnnouncement(\"rand*.wav\")\n      self:setRandomAnnouncementTarget()\n    else\n      self.ticks_since_last_announcement = ticks_since_last_announcement + 1\n    end\n  end\nThis saved game can be used to test this issue:\nhttp://www.mediafire.com/download/4bgc695q1bj7643/issue331.sav\nA random announcement will be made 4 seconds after its loaded while the game is paused.\n. I will fix this issue tomorrow.\n. > > The problem is that the game doesn't stop ticking when its paused so GameUI:onTick() will carry on occasionally making a random announcement occur with this code.\nThe game is actually meant to be keep ticking when its paused.\nI've fixed issue #331 by just changing the do statement into an if statement which checks if the game is paused:\nif not self.app.world:isCurrentSpeed(\"Pause\") then\n    local ticks_since_last_announcement = self.ticks_since_last_announcement\n    if ticks_since_last_announcement >= self.random_announcement_ticks_target then\n      self:playAnnouncement(\"rand*.wav\")\n      self:setRandomAnnouncementTarget()\n    else\n      self.ticks_since_last_announcement = ticks_since_last_announcement + 1\n    end\n  end\nend\n. I will spend some time investigating this bug today if no one is already trying to find a fix for it.\n. I can't investigate this bug now because my Windows PC will be unusable until Friday and the Ubuntu 14.04 PC I can sometimes use is currently not set up to compile CorsixTH.\n. @mpmc If you have a saved game  with this stuck psychiatrist in it please upload it.\n. > > Unfortunately I don't have the SAV anymore, I have tried to get it to happen again but no luck I'm afraid.\nNo problem, thanks for trying to reproduce this error. There's an ancient beta 8 saved game which has the same problem so if I can fix this error in beta 8 then maybe I won't have to change my fix too much for it to be compatible with 0.40 .\nI will try to fix this error asap.\n. I've just discovered this open issue so I will try to help you guys fix this bug because I'm familiar with setBluePrintCell() having recently created its World:willObjectsFootprintTileBeWithin...() check and its the other placement check functions. @SupanovaHS I didn't create the code for these functions, I just took the code for these function from setBlueprintCell(). I did learn how these tests work and I made a few improvements.\nMy Windows PC still doesn't work and the Ubuntu PC I can sometimes use still isn't set up for me to do CorsixTH programming. @MarkL1961 Thanks for pointing out that I don't need to compile the latest CorsixTH version's source code in order to work on Lua code. There are no Ubuntu install packages for the 0.40 beta releases so until I can compile my own Ubuntu packages, I will only be able to work with the latest Lua files which are compatible with the released 0.30 Ubuntu package.\nI will read all the comments in this topic now and then I will post another comment.\n. > > The problem with adding object.corridor_object = 7 to bin.lua then makes the bin a corridor object. \n@SupanovaHS Because Object.corridor_object is meant to be a boolean variable which should either be true or false:\n```\nif variable_a then\nend\n```\nIn Lua this IF statement's condition expression will evaluate to true if variable_a is not nil and not equal to  false. So if variable_a is equal to a number, this expression will evaluate to true.\n\n\nplace_objects.lua line 644 begins to check objects on a per room basis, however, some corridor objects, eg fire_extinguisher, plants and radiators can effectively be placed in any room...\n\n\nCalled at 644, \ufeffWorld:canNonSideObjectBeSpawnedAt() is called for each tile within an object\u2019s footprint to check that each tile is within the object\u2019s allowed room. So this call is within the for \"each tile in the object's desired footprint\" loop declared at line 620.\nThe allowed_room_ID parameter is optional and setBluePrintCell() does sometimes make this parameter equal false instead of a room ID number. \nWhen this test function is not given a allowed_room_ID number and the tile isn't in a corridor, this function's final else statement will be used to check if the room the footprint tile is in, has the tile's object in its allowed objects list:\n```\nfunction World:willObjectsFootprintTileBeWithinItsAllowedRoomIfLocatedAt(x, y, object, allowed_rooms_id_parameter)\n  local xy_rooms_id = self.map.th:getCellFlags(x, y, {}).roomId\n//If the room id parameter is not nil and not false:\n  if allowed_rooms_id_parameter then\n    ...\n  //Else if the tile is in a corridor this simple check statement can be used:\n  elseif xy_rooms_id == 0 then\n    ...\n  //Else this code has to be used to find out if the tile is in the object's allowed room\n  //by checking if the room the tile is in, has the object in its allowed objects lists:\n  else\n    for _, object in pairs(self.rooms[xy_rooms_id].room_info.objects_additional) do\n      if TheApp.objects[object].thob == object.thob then\n        return {within_room = true, roomId = xy_rooms_id}\n      end\n    end\n    for object, _ in pairs(self.rooms[xy_rooms_id].room_info.objects_needed) do\n      if TheApp.objects[object].thob == object.thob then\n        return {within_room = true, roomId = xy_rooms_id}\n      end\n    end\n    return {within_room = false, roomId = xy_rooms_id}\n  end\nend\n```\nSo when an object can be placed in more than one room setBluePrintCell() should make the optional allowed_room_ID parameter equal nil or false.\nI will post another comment later.\n. > > -- Check2a: some corridor objects are allowed in any room.....\n\n\nSo this check is not required.\n\n\nOops, Check 2 is required. I meant there doesn't need to be a check 2b because check 2 doesn't need to be changed because @SupanovaHS didn't actually notice a problem with it.\nI will post another comment later.\n. > > As you can't test at the moment. If you have any suggestions for a fix that you want tested you can either email them to me or post here and I will test for you.\n@MarkL1961 Thanks, if I find a potential fix tonight I will post it here for you to test. \n\n\nWhat method was being used before 0.40? Until 0.40 this was working fine, you could pick up such objects from a room, move them, you could even take radiators from the corridor and put them into a room. \n\n\n@MarkL1961 @TheCycoONE @SupanovaHS I will spend at least an hour now trying to find out why this bug is occuring.\n. > > Personally I think having bins in corridors is of more use than in a room (it is where you would expect to seem them, near drinks machines), but they were not corridor objects in TH. If we were to have them in corridors it might be an idea for them to have some effect on littering too.\n@MarkL1961 Personally I think Theme Hospital's gameplay mechanics were perfect and we shouldn't risk making changes which some players may like and others may not.\n. The Ubuntu PC I can sometimes use is now setup for compiling and programming CorsixTH.\n@SupanovaHS Do you mind if I start working on this issue you've already spent some of your free time working on or do you want to try to fix this bug yourself alone so that you can finish what you've started and make your first contribution to this project?\n. @SupanovaHS If you want to have a go at fixing this bug alone then I will keep a close eye on this bug's discussion topic and I will try to promptly answer any questions you ask.\n. If I don't fix this bug I've caused today then I will try to fix it by Monday.\n. I've fixed this bug, it was simply caused by a variable name scope problem:\nfunction World:willObjectsFootprintTileBeWithinItsAllowedRoomIfLocatedAt(x, y, object, allowed_rooms_id_parameter)\n  ...\n  //Else this code has to be used to find out if the tile is in the object's allowed room\n  //by checking if the room the tile is in, has the object in its allowed objects lists:\n  else\n    for _, object in pairs(self.rooms[xy_rooms_id].room_info.objects_additional) do\n      if TheApp.objects[object].thob == object.thob then\n        return {within_room = true, roomId = xy_rooms_id}\n      end\n    end\n    ...\n    return {within_room = false, roomId = xy_rooms_id}\n  end\nend\nThe value returned by pairs(self.rooms[xy_rooms_id].room_info.objects_additional) shouldn't be stored in a variable called \"object\" because this name is used for a parameter.\nI've renamed this pairs() value variable: additional_objects_name\n\n\n@SupanovaHS Because Object.corridor_object is meant to be a boolean variable which should either be true or false:\n\n\n@SupanovaHS  I see I was wrong and you were right, this variable is meant to be a number and not a boolean \"is corridor object?\" variable. So I've now also corrected the returned value of within_room for the \"xy_room_id == 0\" else block so that it will now be true/false instead of the corridor object's number.\nI will submit a pull request later.\n. Before I could submit a pull request yesterday my internet connection stopped working and then it didn't start working again until this morning.\n. @Lego3 :)\n. Before I make a pull request I want to try to make Eclipse recognise CorsixTH's Lua classes so that class functions will be easy to navigate to by appearing in the outline view and by allowing users to jump their view to a function by holding CTRL and clicking on a reference to it in a displayed script.\n. I will submit a pull request for an Eclipse workspace today/tomorrow because I'm working on some CorsixTH Lua beginner tutorials for Eclipse users: #396\n. I will submit a pull request later with a Eclipse work space configuration in it.\n. I have a work space configuration ready but I've not been able to submit a pull request for it yet because I've not been able to untrack its files after they've been created by a commit. Adding a rule to .gitIgnore to ignore files doesn't prevent existing tracked files from being tracked.\nI've tried creating a second commit to untrack the work space files after the first commit tracked them so that they could be created, but git won't allow me to commit the staged changes which would untrack these files because it says the commit is empty. I've untracked these files with the command: \ngit rm -r --cached .\\Eclipse\n. I've made this work now, I will submit a pull request later if I don't find any more problems to fix first.\n. > > - Separate from the source files\n\n\n\nOrganized so things wouldn't get cluttered if we needed projects for multiple versions of Eclipse * and/or Visual Studio.\n\n\n\n@TheCycoONE The workspace configuration I have meets all of your requirements but your last two requirements require all of the referenced code folders to be referenced as \"linked resource\" folders instead of source code folders. \nThis causes some UI limitations such as: errors from files in linked resource folders are not listed in the problems view and the files containing these errors don't have an error icon when they are displayed in views which display the code files in a directory. So there's no way to see that a file from a linked resource folder contains errors until you've opened it in the file editor view.\n\n\n\nOrganized so things wouldn't get cluttered if we needed projects for multiple versions of Eclipse and/or Visual Studio.\n\n\n\n@TheCycoONE I don't think we will need to have multiple workspace configurations for different Eclipse versions because I think new Eclipse versions are always backwards compatible with workspaces created with older versions: when I loaded a Eclipse Indigo workspace in Eclipse Luna (the latest version) a message was displayed saying that it would be updated.\nBeing a Java program, installing Eclipse on any Java supporting OS is as simple as extracting the latest Eclipse version's folder to its install location and then running it. So I don't think providing Eclipse configurations for older versions would be worthwhile.\nI would guess that we won't need to have more than one Eclipse workspace configuration to support different Visual studio versions.\n\n\nSeperate from the source code.\n\n\n@TheCycoONE Would mixing Eclipse files with the source code be an issue if:\n- The workspace configuration would just require a .metadata folder to be added to the root CorsixTH directory.\n- A project configuration would just require these things to be added to a source code folder :\n  1. + .settings folder\n  2. + .buildpath file\n  3. + .project file\n     ?\n. > > My own eclipse workspace is setup like that...\n@TheCycoONE I see, so Eclipse projects can have source folders which are outside of their root directory but I wonder if the paths to these external source folders can be relative to make a project's configuration system agnostic. I know workspace configurations can't have relative paths to external projects.\n. @TheCycoONE Thanks for the link but this web page is referring to \"Linked resource\" folders which I have configured with paths relative to the CorsixTH root directory. The two other types of folders a project can have are source folders and virtual folders.\nThere's no official support for the use of variables in source folder paths.\n\n\nI don't mind a single eclipse version for now...\n\n\nSo if the workspace and project configurations can't be tidely contained in a root/Eclipse/version/ directory because of relative path limitations then for now there could be one workspace & project configuration in the CorsixTH root folder, without a need for Eclipse files to be in source code directories.\nI would be willing to implement Eclipse support for relative source folder paths if its developers would accept my pull request. Java is the programming language I was taught to program in and is the language I have the most experience of using.\n. @TheCycoONE Thanks for telling me this, I've just found this out.\nI will submit a pull request later when I have time.\n. I've updated my instructions to make them clearer.\n\n\nthe walls don't persist when loading a save with a part built room?\n\n\nYes, while the unfinished room is in one of the blueprint changing modes.\n\n\nI can only get the persistence error message sometimes...\n\n\nAre you quitting CorsixTH and then starting CorsixTH again before loading the saved game?\n. > > Are you quitting CorsixTH and then starting CorsixTH again before loading the saved game?\nI'm not getting the persistence error message now when I'm loading a blueprint saved game with 0.30 .\n. I now don't think this bug has ever prevented me from loading a saved game.\n\n\nAre you quitting CorsixTH and then starting CorsixTH again before loading the saved game?\nI'm not getting the persistence error message now when I'm loading a blueprint saved game with 0.30\n\n\nWhen I stated the above statements I was thinking of another persistence error I experienced today which was caused by me spawning litter in an incorrect way.\n. > >  Does this depend on #342\nNo, except that I wouldn't include the Lua debugger in the default CorsixTH perspective until it could be used with CorsixTH's Lua code at runtime. \nI want to get #342 done and I want to make Eclipse recognise CorsixTH class functions before I start working on making a Eclipse Lua debugger work with CorsixTH. Or someone else could start working on this enhancement while I work on making Eclipse recognise CorsixTH Lua classes.\n@droidmonkey Hi, when you have time please help us by posting a message in this discussion with an explanation of how GE:S mode scripts can be controlled by PyDev's Python debugger.\n. > > ...I wouldn't include the Lua debugger in the default CorsixTH perspective until it could be used with CorsixTH's Lua code at runtime. \nActually I will just include it even if CorsixTH isn't ready to be used with it.\n. > > python debugging through pydev is rather simple. I incorporated the pydev debugging script into the python code and when you enter the command in the terminal to initiate the debugging it simply calls the function in that pydev code that connects to the waiting listen server.\n@droidmonkey Thanks for explaining how this works.\n. @droidmonkey Thanks I will.\n. > > I would be willing to have a go at implementing this in the near future...\n386 is going to keep me busy for a long time and is going to be my priority so I now don't think I will start implementing a Lua debugger in the near future.\nSo someone else could work on this way/another way of making a Lua debugger for CorsixTH because the sooner CorsixTH has a Lua debugger the sooner it can reduce the time developers have to spend debugging problems.\n. The Lua Development Tools plugin's debugger could be attached to CorsixTH:\n\n\nAttach Debug\nYou want to monitor an application running in a specific context that makes it impossible to be launched by LDT (for instance a Lua VM embedded in a larger C/C++ application). In that case, your application can connect to the IDE at startup and then be monitored.\nThis way of debugging is called attached debug, uses DBGp and is composed of two parties.\n- DBGp Server: In our case it is LDT waiting for an application to connect.\n- DBGp Client: In our case, it is the debugger.lua file executed in your debugged application which sends information about its run to LDT.\nThis way is more flexible, but you are on your own to manage the whole runtime configuration (LUA_PATH, debugger bootstrap, ...).\n\n\nSee this wiki page for instructions:\nhttps://wiki.eclipse.org/Koneki/LDT/Developer_Area/User_Guides/User_Guide_1.2#Attach_Debug\n. I will try to get this debugger working with CorsixTH asap.\n. CorsixTH's Lua scripts can already be debugged with the Decoda Lua IDE's debugger (I've not tried using it):\nCorsixTH.lua:\n-- If being debugged in Decoda, turn off JIT compilation (as it cannot debug\n-- machine code). Note that this file cannot be debugged, but all other files\n-- can be. See http://www.unknownworlds.com/decoda/ for Decoda info.\nif decoda_output then\n  _DECODA = true\n  if jit then\n    jit.off()\n    decoda_output \"JIT compilation disabled\"\n  end\nelse\n  _DECODA = false\nend\n. I will try to make the Eclipse LDT plugin's debugger work with CorsixTH because I personally think Eclipse will be a better IDE than Decoda for CorsixTH Lua scripting once it can outline class methods (#417) and can debug CorsixTH Lua scripts at runtime.\nI will now make this my priority CorsixTH programming task and when it's finished I intend to resume my work on trying to design & then implement a LAN multiplayer system (#386).\n. I've almost finished working on this.\n. When I run my PC's Lua interpreter with the Windows command prompt it finds the LuaSocket module but when CorsixTH runs it doesn't.\nWith the command line I run debug_script.lua with this command: \n\n\nlua debug_script.lua\n\n\ndebug_script.lua:\n```\nlocal success, socket = pcall(require, \"socket\")\nif not success then\n  -- LuaSocket is not available, just return\n  print \"LuaSocket is not available.\"\n  return\nelse\n  print \"FOUND\"\nend\n```\nMy LUA_PATH:\n\n\nC:\\Program Files (x86)\\Lua\\5.1\\lua\\?.luac;C:\\Program Files (x86)\\Lua\\5.1\\lua\\?.lua\n. socket.lua is in:\nC:\\Program Files (x86)\\Lua\\5.1\\lua\\\n. \n@TheCycoONE The paths are the same.\n. @TheCycoONE I will try to fix this problem by reinstalling everything tomorrow.\n. > > Oh, lua sockets is a dll, so it would use package.cpath, you could check that. Other than that I don't know.\n\n\n@TheCycoONE Thanks : the problem was that my PC didn't have a LUA_CPATH environment variable and instead of using the default CPATH CorsixTH was using a different path which was missing the directory containing the required \"core.dll\".\n. I have Eclipse debugging CorsixTH's Lua scripts at runtime :) \nI will submit a very simple pull request later: connecting CorsixTH's runtime interpreter to the LDT plugin's DBGp server simply requires this statement to be executed for debugger.lua:\ndofile('debugger')()\nI'm sorry I didn't make a pull request with this simple change days/a week ago because I only started working on this enhancement properly yesterday. If this had been merged days/a week ago developers debugging 0.40 blocking problems could have been using Eclipse's debugger to help them quickly find and fix problems.\n. Although this is an enhancement and not a bug fix, I personally think this simple enhancement should be merged with 0.40 to help debug it before and after its released.\n. @MarkL1961 Sorry I caused this when I fixed #341, I will fix this now.\n. else\n    for _, additional_objects_name in pairs(self.rooms[xy_rooms_id].room_info.objects_additional) do\n      if TheApp.objects[additional_objects_name].thob == object.thob then\n        return {within_room = true, roomId = xy_rooms_id}\n      end\n    end\n    for needed_objects_name, _ in pairs(self.rooms[xy_rooms_id].room_info.objects_needed) do\n      if TheApp.objects[needed_objects_name].thob == object.thob then\n        return {within_room = true, roomId = xy_rooms_id}\n      end\n    end\n    return {within_room = false, roomId = xy_rooms_id}\n  end\nend\nI can't see why Lua is complaining that this variable is undeclared sometimes from its simple use shown above and when I force the else room object list searches to occur by setting allowed_rooms_id_parameter to nil, the needed objects list search works.\n. I guess pairs() must be returning nil sometimes for needed_objects_name's value so this variable isn't declared when there's no value to assign to it.\n. > > I have loaded the auto save several times and cannot reproduce the error\nIf you can't reproduce this error with the same saved game then I guess there's no code for me to fix. I can't see how the pairs() call could ever return nil for the needed_object's value.\n. @TheCycoONE @Lego3 Do you guys have any ideas for how MarkL could have experienced this error?\n. The only changes I made in my #341 fix, was renaming the two search loop variables from object to additional_objects_name and needed_objects_name.\n. I will try to fix this asap.\n. @ghidosoft Thanks for reporting this bug, I will try to fix it asap.\n. > > You are welcome. I kept a savegame just before the crash, let me know if you need it.\n@ghidosoft I don't need it to find the cause of the crash but I only have a saved game with a complete hospital for level 1, so a saved game with a running hospital from a later level would be useful for bug tests. Please upload your saved game when you have time.\n. @ghidosoft Thanks for uploading your saved game.\n. I've found the cause of this bug and will submit a pull request later when I've fixed it.\n. > > What about removing the handler when debug is disabled?\n\n\nIt may be simpler to always add the handlers and return immediately in the callback if debug is not enabled.\n\n\n@TheCycoONE I've updated this commit to make it simpler by removing the need for there to be a debug key adding function in UI and I've updated it to remove debug key handlers when saved games are loaded with debug mode disabled.\n. > > For locality of reference (putting related code together), the debug key handler should be in the afterLoad of ui.lua with the rest of the key handlers. Otherwise I'm happy with it.\n@TheCycoONE I couldn't move the new code in this commit into UI:afterLoad() because this afterLoad() function isn't called when the loaded saved game is from the current CorsixTH version. So I've moved this commit's code into UI:addOrRemoveDebugModeKeyHandlers().\n. > > @J-Shep your previous comment isn't true, ui:afterLoad is called every time App:afterLoad is called. You can see the call to ui:afterLoad in app:afterLoad with no condition.\n@TheCycoONE  This App:afterLoad() code below will abort this callback function with its return statement before UI:afterLoad() is called: \nlocal first = self.world.original_savegame_version\n  if new == old then\n    self.world:gameLog(\"Savegame version is \" .. new .. \" (\" .. self:getVersion()\n      .. \"), originally it was \" .. first .. \" (\" .. self:getVersion(first) .. \")\")\n    self.world:playLoadedEntitySounds()\n    return\n. > > ah, sorry about that.\n@TheCycoONE No problem.\n. This debug script code can be used to test this pull request's commit by making an inflation machine explode:\n```\nlocal world = TheApp.world\nfor _, room in pairs(world.rooms) do\n  if room.room_info.id == \"inflation\" then\n    room:crashRoom()\n    return\n  end\nend\n```\n. @sirlimpy Before he got stuck did he try to use the room's door when a patient was using it to leave? If so there could be a problem with the door queue code.\n. > > I have a save file with it as well\n@sirlimpy Please upload this save file.\n. I only made changes to Room:crashRoom() in my #356 pull request, so the changes I made couldn't have caused this error because only room explosions call crashRoom() making my changes have an effect.\n. \"While I was moving a room I was somehow able to click on the doctor currently leaving the room...\"\n@mpmc So you clicked on the room with the scissors cursor and then you didn't have to wait for the doctor using it to leave before the edit room controls were displayed? (was the \"zzz\" wait cursor never shown?). Then you used the X button to turn the room into its moveable blueprint and while dragging its blueprint you accidentally clicked on the doctor who  was leaving it displaying his information popup and when you completed this room you experienced this error.\n. @mpmc Thanks for answering my question. \nI see that @MarkL1961 experienced this same error without the staff dialog being open so this dialog being open didn't cause @mpmc to experience this error.\n. Both errors occur in the after_use call backs for multi_use_object machines when finishAction(staff_idle) is executed.\nCardiogram 94:\nafter_use = --[[persistable:cardiogram_cardio_after_use]] function()\n          if #staff.action_queue == 1 then\n            staff:setNextAction{name = \"meander\"}\n          else\n            staff:finishAction(staff_idle) -- 94\n          end\n        end,\ngeneral_diag 72:\nafter_use = --[[persistable:general_diag_trolley_after_use]] function()\n          if #staff.action_queue == 1 then\n            staff:setNextAction{name = \"meander\"}\n          else\n            staff:finishAction(staff_idle) --72\n          end\n        end\n. Both of these after_use callback functions belong to mult_use_object actions which don't have to happen so I think this error could happen when:\n1. The patient has reached the machine, starting their multi_use object action which will wait for the staff member to walk to their use tile.\n2. The staff member hasn't finished walking to their use tile when the patient's multi_use_object action isn't ended early, so the staff member's current action is their walking action not the idle action they would have used when using the machine.\nI think I may have caused this bug with my use_screen bug fix because I may have made the use of these machines optional.\n. I was going to leave this bug for someone else to fix but I guess I should fix it since I caused it. I don't have time to fix it now, I will submit a pull request with a fix by tonight.\n. > > Both of these after_use callback functions belong to mult_use_object actions which don't have to happen so I think this error could happen when:\n\n\n\nThe patient has reached the machine, starting their multi_use object action which will wait for the staff member to walk to their use tile.\nThe staff member hasn't finished walking to their use tile when the patient's multi_use_object action isn't ended early, so the staff member's current action is their walking action not the idle action they would have used when using the machine.\n\nI think I may have caused this bug with my use_screen bug fix because I may have made the use of these machines optional.\n\n\nThis idea I had can't be the cause of this error because the multi_use_object action's after_use callback is only called when both users of a machine have reached their use tiles. So the staff member's current action should always be idle when the after_use callback is called.\nSo my use_screen fix didn't cause this bug.\n. I will try to fix this problem this weekend.\n. > > What I'll do tomorrow using the auto save is try and reproduce it.\n@MarkL1961 When you have time please do this, I've not yet found a way to reproduce this error.\n. Maybe a staff member's current action is sometimes not idle when it should be because occasionally their walk action doesn't finish when they have reached the final tile in their path, which is the secondary use tile for the general diagnosis trolley / cardiogram, causing the patient's mult_use_object action to begin. \nIf so this issue could be related to the other issues which are/ are possibly being caused by pathfinding problems: #357 , #358 and #332 .\n. I now want to have a go at fixing #332 before I fix this error because I have a saved game for this error and fixing this first might help me to fix this issue's error if it is being caused by a pathfinding problem.\nI will reassign myself to this issue after I've fixed #332 if no one is working on a fix for this issue then.\n. I've not reproduced this error yet but I have a new idea for its cause: in the screenshot provided by @mpmc a doctor can be seen walking away from the cardiogram room where the \"staff cardiogram user not idle after_use\" error took place. So he may have been the doctor working in this room when the patient started using the cardiogram and then when he was standing idle using it calls_dispatcher:verifyStaffForRoom() would have seen he was idle and may have concluded that he was available to send to another room which required a doctor & then made him start walking there before the patient had finished using the cardiogram.\n. The calls dispatcher does conclude that the staff member is available when they are actually using the cardiogram / general diagnosis trolley but this just ends the use of the room's object early for both the patient and doctor so no error occurs. But this issue's error occurred in 0.40 so perhaps changes since this release have prevented this error from occurring.\nIf the calls dispatcher was responsible it would explain why after editing rooms @mpmc  and @MarkL1961 experienced this error in their hospital's cardiogram/general diagnosis room (the only multi_use_object rooms which have the patient running this action while the staff member is idle) because when the edited rooms were finished patients' room built callbacks could have sent them to these rooms which had no staff, making the calls dispatcher request staff and making the doctor using the cardiogram/general diagnosis trolley leave to answer the call.\n. > > But this issue's error occurred in 0.40 so perhaps changes since this release have prevented this error from occurring.\nI've tried 0.40 and my idea doesn't cause this error.\n. If anyone experiences this error again and can provide a saved game from just before it happened or afterwards then please upload your saved game and post a link to it here.\nI've not been able to reproduce this error and I don't have any more ideas for what its cause could be so I can't make any progress with investigating it.\n. Thanks for your helpful suggestion @bobcanthelpyou I will have a look at these issues & try using their saved games.\n. If you have a saved game with this error in it please upload it so that it can be used to investigate this error.\n. @Glimmer-Man Thanks for reporting this error and testing beta 2.\n. I will close this issue because its a duplicate of issue #127.\n@Glimmer-Man a saved game has already been uploaded for this bug.\n. > > Yes, it's a duplicate... sorry. I have not noticed.\nNo problem.\n\n\nRemoving his bench is not a solution, patient will be standing alone, after he gets a drink...\n\n\nThanks for helping us investigate this.\nPlease post comments about this issue in #127.\n. @phillipp Thanks for fixing this long standing error, I will review this pull request tomorrow if no on else reviews it first. \n. @TheCycoONE Can we fix this error in 0.40?\n. > > When is 0.4 scheduled? \n@phillipp I don't know what the schedule is but I do know that the code for it is frozen meaning that changes to it are restricted to bug fixes because adding other improvements would risk introducing new bugs to be fixed, delaying the release.\n. @phillipp I'm sorry I didn't review your pull request today when I said I would, I will now review it tomorrow morning and merge it with the trunk if no changes are required.\n. I'm reviewing this pull request now.\n. > > Before this commit, the action of the doctor was set to 'meander'\n\n\nafter the dealtWithPatient() function was called (which, in turn,\ncalled findWorkForStaff()). The call dispatcher then skipped that doctor.\n\n\n@phillipp  How did the position of this meander action queuing statement make the call dispatcher skip this doctor in dealtWithPatient():findWorkForStaff()? I can see how the old position of this meander call could make it interfere with the sequence of actions queued by CallDispatcher:sendStaffToRoom() in findWorkForStaff().\nThis bug still occurs with your fix in this saved game when the psychiatrist finishes dealing with a patient:\nhttp://www.mediafire.com/download/vv0tzztjk7djxu1/332_occurs.sav\n. #332 is occurring in the saved game I mentioned above because Staff:isIdle() thinks the patient is not leaving.\n. > > Hm, I tried your savegame and it works totally fine with my fix. What behaviour would you expect, that you do not see?\n\n\nThe doctor is leaving the psych when the call dispatcher gets the new call for GP's/General diagnosis.\n\n\n@phillipp He does leave when there's a new call at the reception but he doesn't leave after he has dealt with the male patient to answer the queued call for the female patient who is waiting outside the GP's office.\n. > > It looks like when the meander action is not the first action, the Staff:isIdle() is not returning true.\nWhen I had a look at the meander action and Staff:isIdle() yesterday I didn't notice any way that the result of Staff:isIdle() will be influenced by the staff member having a meander action in their queue.\nI think Staff:isIdle() could be simplified by making it use the staff member's \"dealing_with_patient\" attribute which is set to false in dealtWithPatient().\n. > > Yes, that is correct, but a different problem. If you open the call dispatcher you will find that there is no call to answer. So probably this is because the calls are not persisted or there is another problem, but I would prefer to handle that in an extra issue and/or pull request.\nI see, personally though I would say its another problem which can cause issue #332 so a fix for this problem should be included in this pull request's commit which has the purpose of fixing #332. \nI could fix this problem and then you give you my code to add to this commit, if you don't have time to work on this other problem now/ feel like working on something else.\n\n\nSo probably this is because the calls are not persisted...\n\n\nIf this problem was this bad I think players would be experiencing it all the time with any room not just the psychiatrist's room.\nI've tried running my saved game without your fix and I've not noticed a difference, the psychiatrist can still leave his room to answer a new call at the reception.\n. > > With the fix, the meander action is enqueued before that, so the call_checkpoint is not overwritten by it.\n@phillipp Thanks for fixing this problem but fixing this problem alone will unfortunately not fix issue #332\n@phillipp Maybe you and/or @TheCycoONE  will disagree but I personally think we should not merge a fix for this #332 problem alone unless we haven't found a fix for the other problem before the 0.40 bug fix deadline. Having one commit fix this issue would be tidier than having more than one commit fix it. \n. @phillipp I've deleted your comment because it was disrespectful towards me and I would delete any disrespectful comment directed at any of this project's contributors. \nI'm sorry I've made you angry and if you want @TheCycoONE to take away my privileges then you should send him a private message.\nYour question: Why do I think this pull request does not fix #332?\nBecause it doesn't fix the issue in the saved game I uploaded and I would say this issue is issue #332: the Psychiatrist stays in his room when he should be answering a staff call.\n@MarkL1961 @TheCycoONE I no longer want to be responsible for dealing with this pull request, clearly @phillipp isn't happy with the job I'm doing.\n. I will add a colon to the heading: \"TELL OTHER DEVS WHAT YOUR WORKING ON\" tomorrow.\n. @phillipp Thanks for fixing another bug, I will review this pull request tomorrow morning and merge it with the trunk if no changes are required, after I've reviewed your other pull request. @TheCycoONE Could then merge your pull requests into 0.40 .\n. I'm going to review this pull request now.\n. @phillipp I've not finished reviewing this pull request but I will comment now that I think your commit's message could be clearer, it could be like this:\n\n\nSome patients from a queue would go to a drinks machine by adding a use_object action when:\n-  A drink machine was placed near a queue \n  OR:\n- A reception desk was placed (when there was none) near a drinks machine and patients seeking a reception.\nWhen the onChangeQueuePosition() handler of the queue then fired, action_queue_find_idle() could not find an idle action while that use_object action was enqueued for any of this queue's patients.\nThat idle action would be enqueued after the patient had used the drinks machine.\n\n\n@phillipp Please makes this commit's message clearer and please also shorten its title so that its last words don't appear in its message.\n. @phillipp This commit could just have a short message like this:\n\n\nThe queue action's action_queue_find_idle() function would wrongly announce an error when it could not find an idle action in its user's action queue because they were using a drinks machine with a use_object action. This commit makes this function announce a warning instead.\n\n\nOnly this commit's message and title needs to be changed before it can be merged.\n. @phillipp Please also shorten this commit's title so that Git doesn't truncate it.\n. @phillipp thanks for making the changes I requested.\n@TheCycoONE As you will notice I've accidentally set a message to @phillipp as the description for this merge commit please correct this because I don't know how to.\n. I'm not going to work on this now because I want to focus on my task of working on a LAN multiplayer system and mode: #386\n. In issue #147 @MarkL1961 mentioned that rooms can be built over litter in TH.\nThis debug script code can be used to test this commit by making a humanoid drop litter (it can't be persisted):\nlocal trash = math.random(1, 4)\nlocal litter = TheApp.world:newObject(\"litter\", _.tile_x, _.tile_y)\nlitter:setLitterType(trash, math.random(0, 1))\n. I've not yet tested persisting buildable litter.\n. I've now tested a saved game which has litter in a blueprint and there's no persistence problems with this commit's changes.\n. > > Did you include dead rats as litter as I suspect it won't be long before we start seeing them running around. They are after all also litter as is the other mess some patients do on the floor when they can't find a loo.\n@MarkL1961 I included all litter types.\n. @Glimmer-Man Thanks for testing my commit, I will fix the problem you found.\n\n\n...for some reason it is sometimes ignoring the check that the tile is free of other objects.\n\n\n@MarkL1961 I will fix this.\n. @TheCycoONE I've not done any work on this for a long time, I will try to get this and few other unfinished tasks I have done before the freeze deadline. I will remove the milestone though because this isn't an important gameplay change.\n. > > As far as I know, no one is actively working on this. There was a mention on the mailing list that someone would but I haven't heard from them in a year.\n@TheCycoONE I will try to contact them, I wouldn't want to ignore their hard work and give myself more work to do.\nImplementing a multiplayer system and gameplay mode is the most fun CorsixTH dev task I can think of and accomplishing it would be very satisfying for me. If there is other CorsixTH dev's who would also enjoy working on this task, we could try to work on it together to share the work load and  get this task finished asap.\n\n\nI guess you're going to try to implement the missions net levels from the original game?\n\n\n@TheCycoONE I never played Theme Hospital's multiplayer mode, so I don't know anything about its missions. I will try out its multiplayer mode.\n. > > Good luck?\n@TheCycoONE If I work on this task alone without being able to share its work with better programmers than me, then I don't think I will need good luck to accomplish this task, just enough time. And if other programmers do want to work on it with me then I certainly think we won't need good luck to accomplish this task.\n. > > If you want to try out Theme Hospital in multiplayer (To see what the maps and the gameplay looks like), just shout. :-)\n@Lego3 I will need to get some practice with CorsixTH's single player mode before I'm ready to show you how Theme Hospital should be played  :)\n. I think the LAN multiplayer system should be designed before code is created for it, even if this system will be continued from someone's existing code.\nSo I will create some design diagrams and then post links to them here so that other CorsixTH developers can see overviews of how the finished system will work and can then suggest improvements/ a better approach for how it should work, before I spend any time creating new code for it.\n. > > I think the LAN multiplayer system should be designed before code is created for it...\n\n\nSo I will create some design diagrams and then post links to them here so that other CorsixTH developers can see overviews of how the finished system will work and can then suggest improvements/ a better approach for how it should work...\n\n\nI have an idea for what I think would be a simple client-server design but I want to wait at least one week before I post a design here for other devs to see and comment about because I want to make sure the design I post here is the best design I can think of and I want to wait and see if the developer who wanted to work on a LAN system in the past will contact me and give me their work to reuse if they don't want to continue it by working with me.\nIdeally I would want to reuse all of their hard work by just continuing the approach they were using but I don't want to reuse their approach if it will make the LAN system significantly more complicated and less elegant than a system I could make with a different approach.\nSome features I would like the first committed version of this LAN system to support:\n- It might only require 2 existing Lua classes to be changed in order to allow existing single player scenarios to be played as multiplayer scenarios: the App class and the class for the main menu.\n- More than 2 players in a multiplayer game.\n- Saving and loading multiplayer games.\n- Pausing multiplayer games.\n- Bot hospitals (If this feature won't require too much work)\n- Viewing the hospitals of your human opponents - I know that having this superfluous feature will add a lot of work to the first committed version but I might include it so that I and devs testing this system's first commit can use the view of a remote computer's hospital to help make sure that there's no game state synchronisation problems.\nI currently don't intend to start working on a text chat system until after I've finished the LAN system and have made a playable LAN mode, because most players who will have LAN games with opponents who aren't in their room will prefer to have Skype conversations. Someone else could  work on this LAN text chat system so that it can be finished sooner.\n. > > I have an idea for what I think would be a simple client-server design...\nMaybe it won't be simple but I think the idea I have at least won't be too complicated.\nI know there normally won't be more than two players in a LAN mode game and having a client-client system would be simpler for 2 player games. But I think the LAN multiplayer system should be a client-server system so that it will be easier to turn it into an online multiplayer system in which game's will be more likely to have 4+ players and a client-client system would therefore often require a lot more connections than a client-server system.\n\n\n@J-Shep I'm not sure if you've had a chance to play the multiplayer built into the original game.\n\n\n@TheCycoONE I've never played Theme Hospital's multiplayer mode so thanks for describing it, it sounds like fun. I think the first multiplayer mode to be created should be the simplest to make and I think a multiplayer single scenario mode might be the simplest to make.\n. I might now first release/commit a LAN multiplayer system which won't allow players to see their opponents' hospitals because this would be a lot simpler since there would be a lot less world game state data to pass around and synchronise. For example, you wouldn't need to have any game state data on your computer about what staff and patients are doing in your opponents' hospitals.\nSo the first version of the LAN multiplayer system I would release wouldn't be able to support multiplayer modes in which players would share a town map, like a remake of Theme Hospital's multiplayer mode. \nI do want to make a LAN system which would  allow me or someone else to remake Theme Hospital's multiplayer mode. So for this issue I might make multiple pull requests in a plan like this:\nPhase 1 - Pull requests for a simpler LAN system:\n1) Pull request for version 1 of my LAN multiplayer system which will support multiplayer modes in which each player would have their own town map and not be able to see their opponents' hospitals.\n2) Pull request for a multiplayer single scenario mode.\nPhase 2 - Pull requests for a more complicated LAN system:\n3) Pull request for version 2 of my LAN multiplayer system which will add support for multiplayer modes in which players share a town map with their opponents and multiplayer modes which give each player their own town map while allowing them to see their opponents' hospitals.\n4) Pull request for a remake of Theme Hospital's multiplayer mode.\n5) Pull request to enhance phase one's multiplayer scenario mode by making it allow players to see their opponents' hospitals.\n. Here's the Google code CorsixTH dev forum topic in which Darrell said he would work on this in 2012. I've sent him a message asking him if he still wants to work on this.\n. Darrell told me yesterday that he never had time to work on making CorsixTH into a multiplayer game and he no longer has time to program things as a hobby, so he doesn't mind me working on this task.\n@lbakyl Thanks for helping me by posting your suggestions and ideas.\n\n\nConsidering the manpower available for this project (1 able programmer), I would go with the easiest-to-implement design, which would be to have just 2 players. Each player would be running the same map with the syncing of certain information taking place, without the ability to view the other person's hospital.\n\n\n@lbakyl A 2 player LAN multiplayer system could simply be a client-client system and would be the easiest to implement with the benefit of being playable sooner but I would then want to replace it with a client-server system. \nI would prefer to design and implement a 2+ player client-server system from the start instead of a temporary simpler system which I would then want to replace. In the plan I've posted to maybe release a simpler system first and then a more complicated version later, the more complicated system would just be an extension of the existing system.\nI have experience of creating simple client-server systems and I don't think creating such a system for CorsixTH's LAN multiplayer will be too difficult and take me too long even if I can't share the workload with other programmers.\n\n\nApart from menu changes and a network layer being added, some new variables may need to be created for the exchange. Based on the post from BvDorp, the variables would include:\n\n\n@lbakyl Thanks for reading BvDorp's helpful post and then making a good list which will be useful for me.\nI've not yet read all of the comments in existing discussions about making CorsixTH into a multiplayer game.\n\n\nJoe, are you familiar with the SDL_threads library, or would you like to look into implementing your own, like Darrel desired two years ago? Personally, I would recommend using the already made library, as it may help programmers to work with it, in future.\n\n\n@lbakyl I will use the SDL_threads library for the reason you suggested and also because I wouldn't want to have the difficult time consuming task of creating a new threads library when there's an existing one which does everything I need it to, is cross platform, has a good license and is open source.\n. > > While I am not a programmer, I wonder in what ways you would benefit from support - donations, testing, documentation, engaging with ideas...just say. I will be happy to work with you on this as a non-developer, if it would be productive.\n@lbakyl Thanks for offering to support my work on this task with donations, personally I would never want to program something as a hobby task and accept donations for my work because then it would cease to be a hobby task for me and become a job. Plus I would feel bad about accepting donations for work I would be willing to do without donations because I would enjoy doing it.\nIf your interested in learning to program things for CorsixTH I could introduce you to programming things with Lua by delegating some easy Lua programming tasks to you which you could have a go at with my guidance available when you need it. We could pair program a simple Lua task, you would be doing the programming while I would watch your screen and chat with you in Skype, giving you suggestions and guidance when you require it.\nI would be grateful if you could help test the work I've finished after phase one and/or two by trying to play a LAN mode game with someone. The more testers there will be the better because occasional problems will be more likely to be noticed by a tester.\n. > > Feel free to PM me directly, instead! Jan\n@lbakyl I've just read that Github's developers removed the ability for users to send private messages to each other.\n@lbakyl I have two design tasks you could do if your interested:\nA. Design the user interface layout for a \"Available LAN Servers\" screen, my requirements:\n- It should have a list box for listing found LAN servers, this will be automatically updated.\n- There should be a \"Host Game\" button.\n- There should be a \"Join Game\" button.\n- Text chat boxes and controls.\n- This user interface should be contained within a window which doesn't take up the whole screen so that the main menu background can be seen around it.\nB. Design the user interface layout for a LAN game's pre-launch room, my requirements:\n-  There should be controls to allow the host to:\n  -  Change their game's name.\n  -  Select the mode they want to play.\n  -  Change the selected mode's settings: different modes will require different controls so please\n    just draw a expandable space in the menu to represent a panel which mode's could customise\n    with the appropriate controls for their available settings.\n-  There should be a list box for listing the players who have joined the game: this will be automatically updated.\n-  There should be a \"Start Game\" button which could be a \"Ready \"button for all the players except the host.\n-  Text chat boxes and controls.\n- This user interface should be contained within a window which doesn't take up the whole screen so that the main menu background can be seen around it.\n@lbakyl If you do one or both of these tasks, feel free to include things I've not listed as requirements.\n@lbakyl  You could use this image as a background and then create boxes over it for the UI components using a program like LibreOffice Draw.\nI think I will now include a text chat system in the phase one release even though most players will prefer to use Skype because it would need to be implemented sooner or later for deaf players and for when the LAN multiplayer system is turned into an internet multiplayer system.\n. > > I have two design tasks you could do if your interested: ...\n@lbakyl I would enjoy designing these user interfaces myself, so if you wouldn't enjoy spending some of your free time designing them then I could design them.\n. I'm going to stop working on this pull request for a few days to try to get these tasks done:\n- Integrate CorsixTH with the LDT Eclipse plugin's Lua debugger: #346 (Done)\n- Make the Eclipse LDT plugin outline CorsixTH's Lua classes #417 (Done)\n- Add a Eclipse CorsixTH configuration to the trunk: #342 (Done)\n. I've not done everything I wanted to do before focusing on this task again but I'm now not going to:\n- Make programming tutorials\n- Integrate CorsixTH with a Lua unit testing framework because @Lego3 has been working on this.\nSo I may still make the Eclipse improvements I wanted to make before I resume my work on this issue.\n. Having made all the Eclipse support changes I wanted to make to CorsixTH before continuing my work on this issue, I now want to spend my Christmas week programming some other things before resuming my work on this issue from January 1st. \nFrom this date I will spend at least an hour or two every day working on this issue.\n. As my first implementation task for the LAN multiplayer system I'm going to start working on making CorsixTH support in game IRC text conversations for singleplayer games.\n. I will aim to have a design done for this task by February 1st and when I've finished a design I will post it here.\n. > > I will aim to have a design done for this task by February 1st and when I've finished a design I will post it here.\nI'm going to need another week to design what I'm going to implement for this task because I've been spending all of my free time at home this week playing PC games and not working on my CorsixTH tasks including my task of designing what I'm going to do for this issue.\nIf I've not been committed enough to this task to have at least an acceptable design done for it in the near future then I wouldn't mind passing on this task to a CorsixTH developer who would be more dedicated to working on it and getting it finished asap.\n. I will spend all of my CorsixTH development time tomorrow designing what I'm going to implement for my phase one release and then I will probably post at least the start of a design here by Monday.\n. I expect to finish implementing #445 soon, once this important task is done I will finish designing what I'm going to do for this task. \nI'm sorry I've not worked on this task for a long time despite this being a feature which all players must being looking forward to: the other tasks I've worked on instead will make implementing anything for CorsixTH and debugging its errors easier. \n. @Cach54 I'm sorry to say that I've never actually started working on this despite saying that I would and making players excited including the player who sent me an email to thank me. I've worked on other things instead to help other developers find and fix problems, like implementing DBGp debugger support because I felt these tasks were more important to get done first and would help to make the task of implementing multiplayer support easier.\nI don't mind if someone who's a better more committed CorsixTH developer than me, who unlike me can be trusted to actually work on the things they promise to work on, wants to take over the responsibility of implementing multiplayer support.\nI will work on this if no one else does, after I've finished implementing automatic error reports. If anyone starts working on this please post a comment here so that I will know not to spend time working on it myself.\nIf I ever decide to not work on this task or any other I will post a comment to announce this so that someone else can take it over.\n. @Cach54 I'm still in favor of using a design driven approach for the implementation of this task, so even if you have no programming experience you could help me decide how it should be implemented in the design stage without having to be able to make programming level implementation decisions. We could use UML diagrams.\nI'm going to make a promise which I'm going to try to keep: I will start working on a design by Monday and by the following Sunday I will have a finished design/ at least some ideas to post here for @Cach54 and other CorsixTH developers to critique. \n. @Cach54 When what will be implemented has been designed and agreed on in this issue discussion, I will make a programming task todo list so that you and other programmers could volunteer to do some of these tasks so that this programming work can be shared and multiplayer support can be implemented sooner.\nWhen I created this issue discussion I intended to make a multiplayer system which would support a multiplayer single scenario mode like the singleplayer single scenario mode: in which players would compete to win a scenario by either achieving its objectives before the other players or having a better hospital score after X years had passed. \nSo each player would have their own town map and they wouldn't have to be able to see their opponent's hospitals like they would in TH's shared town map multiplayer mode, so very little game state data would have to be shared between players and I don't think lag would be a coding issue for making this multiplayer mode playable over the internet. Support for allowing players to see their opponent's hospitals, and use litter bombs in them like in TH, could be added later after the simpler implementation of this mode had been done.\nDoes anyone think the first multiplayer mode to be implemented should be the shared town map mode from TH instead? it would be much more complicated to implement.\n. > > @Cach54 When what will be implemented has been designed and agreed on in this issue discussion, I will make a programming task todo list so that you and other programmers could volunteer to do some of these tasks so that this programming work can be shared and multiplayer support can be implemented sooner.\nI think it would be awesome to have lots of CorsixTH programmers working together on getting multiplayer support implemented asap by each working on a task from this todo list and sharing a \"multiplayer\" repository branch which @TheCycoONE could create in the CorsixTH repository. \nThough with lots of developers working together I think someone would need to manage everyone to avoid teamwork coordination problems & conflicts. I would be a terrible project manager so someone else would have to take on this role. @Cach54 @lbakyl @Lego3 Being experienced and professional software project managers would any of you guys be willing and have time to help with this?\n. > > I'm going to make a promise which I'm going to try to keep: I will start working on a design by Monday and by the following Sunday I will have a finished design/ at least some ideas to post here...\nI've been too busy this week to spend much time working on this so I will need more time to work on this before I post ideas/a design here. I might be ready to post ideas/ a design here on Friday.\n. @Alberth289346 I'm sorry for my late reply, I've read every word you've taken the time to write in your helpful comment.\n\n\nIf you are struggling to find a good form, allow me to suggest one. If you don't like it, again, feel free to ignore me. Otherwise, read it, think about it, and use what you see as useful.\n\n\nI've not been making progress with this task and my other CorsixTH tasks because of being busy doing other things and because of a lack of dedication to spending some of my free time contributing to CorsixTH. My lack of dedication hasn't been helped by having a hacker interfere with my CorsixTH work in the past and possibly recently by creating unfixable errors to waste my time. I do enjoy programming but I don't enjoy trying to fix unfixable compile & runtime errors. I know a hacker did this at least once in the past because they contacted me afterwards.\nI agree that I should start with a high level conceptual design before trying to make a more detailed implementation design. I will consider using the diagram method you've described when I spend  tomorrow designing how I think multiplayer support should be implemented. I will probably post a design here by Sunday.\nThanks for kindly trying to help me make progress with this task. I think seeing the long post you've taken the time to write in order to help me, might motivate me to become a more committed and reliable CorsixTH contributor than I've been thus far this year.\n. I've started making a design document using Google Docs and I will make it public tonight or tomorrow.\n. > > I've started making a design document using Google Docs and I will make it public tonight or tomorrow.\nI'm not going to post a link to it here today now because I still have a lot of work I want to do for it before anyone takes the time to read it and make comments about it.\n. I will do a bit more work on my design document this weekend and then I will post a link to it here but it won't be finished by then. \nI then want to focus on getting my \"Automatic error reports\" feature implemented for 0.50 before its July 12th feature freeze deadline. So I may not resume working on my multiplayer design document until after July 12th.\n. > > A. Design the user interface layout for a \"Available LAN Servers\" screen\n\n\nB. Design the user interface layout for a LAN game's pre-launch room \n\n\nHi @zsolmanz thanks for offering to help by designing what these dialogues will look like.\nI think including layouts designs for these new UI windows in the detailed design document I'm making would be worthwhile, so if you would like to design these windows for me then be my guest. \nYou don't need to create mockup images depicting exactly what you think these windows should look like, just having basic black & white UI layout boxes drawings would suffice:\n\nSo you could just make layout drawings with text boxes for window components in Libre Office Draw or Google Drawings.\nI would prefer you to make these layout drawings with Google Drawings because I'm making the design document in Google Docs, so I could import your \"Google Drawings\" diagrams in an editable way and then you could edit them in this document by just visiting it in a web browser with Google Docs. Or this document could have links to your drawings in your Google web space where anyone with a web browser could view them and edit them with the \"suggestions\" editing mode allowing you to accept or decline their suggested changes.\nAs well as taking you a lot less time to make, the text box components in these simple layout diagrams could quickly & easily be rearranged and reshaped. So if you do want to design these windows I think you should use this quick & malleable design drawing method.\nI would recommend you try out GIMP and learn how its layers feature works. I've always used it to create CorsixTH dialog mockup images:\n- I have a background screenshot layer, like the view of a hospital if I'm creating a mockup image of an in game window.\n- Above this I have a layer depicting the Window's background with its borders.\n- And then I have layers for each image of a UI component & for groups of components when I want to edit & move them together.\nMy priority for contributing to the development of CorsixTH right now is to help fix bugs for 0.50 because players will be able to benefit from this work when this next version is released where as they won't benefit from any of my work on implementing multiplayer support until its finished for a future release.\nI intend to resume my work on my design document soon though and when I think its ready, I will make it public by posting a link to it here so that other developers can review my design ideas.\n. I think a good minimum size these windows should support is 1024x768 because I think all netbook screens support this size as a supported screen resolution.\nHaving information like player pings displayed in game lobbies and a button for filtering listed servers wouldn't be necessary for LAN multiplayer gaming but by including UI information and components which would be useful for internet games, these windows would be usable as windows for internet gaming as well.\nThe chat box section of each window\n- The fax machine TH image is pretty cool imo so I can appreciate your idea of using it as a chat history background below the chat message input box, with players being able to use its button to control who they chat with in a game/servers lobby if they don't want to chat with everyone. If it will look eye pleasing  rather than intrusive amongst all the other UI components then I would personally be in favour of using this image in this way.\nThe multiplayer/servers lobby window\n\n- For use as a LAN & internet multiplayer servers window, I personally  think all the information table columns you've chosen would be worth having though the player name column isn't essential and so could be removed to save screen space on smaller screens.\n- If there will be a \"Player Name\" column I personally think \"Host\" would be a better name for it.\n- The options button: players could use the main menu settings window to change their multiplayer name and then this multiplayer button could be named \"Filters\".\n- One UI component your design doesn't have to go along with your inclusion of chat UI components in this window, is a list of the players who are available to chat with.\n- A missing button which would be essential for internet gaming is a friends list button which when clicked could display a friends list window with UI components for adding & removing players from this list. It could be located in the chat section of each window you've designed\nThe game lobby window\n\n- I think a host should be prompted to choose a game name after clicking the \"host game\" button and before the game lobby window is displayed but being able to change a game's name in its lobby window could be useful.\n- I think there will end up being at least two multiplayer gameplay modes game hosts will be able to choose to host games for: the multiplayer mode from TH where players share a town map and a multiplayer single scenario mode which would work like its singleplayer counterpart except that a player would be competing with other players' hospitals instead of bot hospitals. The multiplayer single scenario mode is what I intend to design and implement first because I think it would be easier to implement as both a LAN & internet playable mode.\n-  I personally think having the connected players info table take up as much vertical space as you've planned would make it take up a lot more vertical space than necessary and I think this space would be better used for a different purpose such as providing a description of the selected scenario along with an image of its map.\nIn case it provides inspiration here's a mockup image I once created in GIMP for a layout idea I had for the singleplayer single scenario window, I've lost its GIMP source file:\n\n. I've been responsible for working on this task for nearly a year now and regrettably I've not gotten around to actually properly starting work on this mainly because when I've had free time to spend doing programming, I've distracted myself with other CorsixTH tasks and programming tasks for other free games. \nFrom now on I'm going to have a lot less free time and I want to spend more of my free time doing other hobbies besides programming things for free games. \nSo I've decided that I no longer want to have the big responsibility of being the CorsixTH programmer responsible for working on this time consuming difficult task which all CorsixTH players would want finished asap.\nI've not made any code for this task and I don't want to give the design document I worked on to the developer who will take over this task because my design document is rubbish.\n. > > Thanks for the update @J-Shep, good luck in your future endeavors.\n\n\n@TheCycoONE \nGood luck from me too\n@Alberth289346 \n\n\nThanks guys.\n. @TheCycoONE Yes, I've created a developer topics \"Tutorials\" page link already but there's no page yet.\n. Another enhancement idea someone could work on: adding rotation buttons to the edit room dialog so that a room and its items can be rotated by making a rotatable blueprint appear over the room. \n. > > So, it will be much better to make it playable without boring stucks, errors or unexpected behaviors.\n@Glimmer-Man I also personally think that making new releases of CorsixTH more error and bug free than previous releases is more important than introducing new enhancements, particularly enhancements which add things which weren't in the original game.\n\n\nWhat good is on that function? I see none... Another unnecessary \"button\"\n\n\n@Glimmer-Man I personally disagree with your opinion that this new in-game UI button would not be useful enough to be worth adding to a release of this game at some point (an enhancement created now doesn't have to be included in 0.40/0.50) because being able to just move a room without having to rebuild it and then relocate its objects would be a convenient way of moving rooms so I think players would find this new edit room button useful, as long as the implementation of its method for moving rooms doesn't restrict too much/at all where players can move rooms to.\n\n\nA new \"move room\" button could be added to the edit room controls and clicking on it could make a blueprint appear over the room to be moved and then players could move the room by dragging this blueprint and then confirming its new position by clicking the confirm button in the edit room controls.\n\n\nThis initial idea I had for how this button could allow players to move rooms is too simple because it would not giving them the essential option of re-positioning a room's door.\nSo I now think that the blueprint should be as modifiable as possible, while not requiring a blue print stage to be configured from scratch if its existing configuration for the room is acceptable.\n@Glimmer-Man In future when you want to post an opinion about the value of an enhancement one of this project's unpaid developers has/may have spent some of their free time working on (this issue had a started label assigned to it) please don't tell them you personally think their work is a \"waste of time\".\n. > > I would like to see a mockup of the edit room dialog with this new button. As an alternative, I was thinking shift+right click, and caps lock + right click (for people that can only use one hand) could move a room instead of an object. This would avoid any additional UI clutter and save mouse clicks which I understand is the entire intention of the enhancement.\n@TheCycoONE good idea. \nI will create a mockup of the edit room dialog for an idea I have, when I have time later.\n. Changes which could be made for a separate edit room dialog enhancement:\n\nIn addition to having the keyboard shortcut for moving a room @TheCycoONE suggested, the edit room dialog's cancel & confirm edit phase buttons could be modified to:\n1) Not forget what's been done in the current phase so that it can be restored if a user re-enters it.\n2) Not delete the items placed in a room until the creation of a new room is cancelled or an existing room is deleted. If when a room is re-sized a placed object's footprint tile is removed from the room, then the object can be removed from the room and queued to relocated.\nAs shown in the screenshot the windows & doors phase could have a button for resetting this phase so that the room's door and windows are removed to be relocated.\n. > > It sounds like major scope creep...\n@TheCycoONE I guess it is and I know @lbakyl doesn't have much free time to spend doing programming so the smaller his first Lua task is the better.\n. @TheCycoONE Its finished on my PC. I tried to untrack the workspace files by removing them from a repository's cache with the second commit while still having them be created by the first commit. But I guess removing these files from the cache with the second commit might make them not be created in a repository these two commits are merged with.\nI used this command to untrack them:\ngit rm -r --cached Eclipse\ngit add Eclipse/Luna_Workspace/CorsixTH/Setup_README.txt\nI will check that my uploaded commits work properly tomorrow. \n. > > You want clones of the repository to create files but not to track them after they're created?\n@TheCycoONE Yes, when I saw my Github client's list of the file changes in the second commit it said the files were being deleted but I assumed this wasn't accurate because they weren't being deleted from my PC's repository folder just being untracked by being removed from the cache but not the working tree. \nWeb page: Untrack files in Git Repos Without Deleting Them\n@TheCycoONE If you can get my Eclipse configuration or a better Eclipse configuration properly setup with the trunk then please do so if you have time.\n. @TheCycoONE The web page I've provided a link to mentions that:\ngit rm --cache FILE_NAME\nShould delete the history of a file but not the file itself and this is necessary after a tracked file has been added to .gitIgnore .\n. @TheCycoONE I guess including a workspace configuration in the Eclipse folder with its .metadata, folder which always changes when the workspace is opened, isn't worthwhile.\n. @TheCycoONE I will now simply provide a Luna project configuration: I don't think Git will need to be told to not track the project's files because they will only change when a user changes this project's settings.\n. @TheCycoONE I think this pull request's commit is now ready to be merged.\n. @TheCycoONE I need to just change the setup README file.\n. > > I need to just change the setup README file.\n@TheCycoONE I've changed it now.\n. I've now added a \"Test Lua Only Code\" source folder to the CorsixTH Luna Project so that it can store test scripts for Lua only code which can be executed and tested in Eclipse. \nThis new folder is in this project's directory and is ignored by Git.\n. I guess the \"Test Lua Only Code\" source folder isn't worth having, so i will remove it.\n. @TheCycoONE If I do decide to no longer work on making Eclipse outline classes & their methods and on making CorsixTH support the LDT plugin's debugger, then I think this pull request should be closed and CorsixTH devs should be encouraged to use the Decoda Lua IDE instead since this can outline CorsixTH classes & their methods and its debugger might still work with CorsixTH.\n. > > If I do decide to no longer work on making Eclipse outline classes & their methods and on making CorsixTH support the LDT plugin's debugger...\nI've now finished working on making CorsixTH support these Eclipse features: so Eclipse can now do everything that Decoda can do.\n. @TheCycoONE I will remove all the project links for 3rd party Lua library folders because I think only CorsixTH directories a developer might want to modify should be linked to and listed.\nI don't have any ideas regarding this builder change.\n. > > I will remove all the project links for 3rd party Lua library folders...\nI've done this now.\n. > > The support for encoding in the workspace is based on what is available from Java.\n\n\nFor Java encodings, except for the 'UTF-16' encoding, BOMs are not inserted (when writing) or discarded (when reading) for free.\nIf applications want to support creating UTF-8 files with BOMs to match their users' expectations, they need to provide such capability on their own (as neither Java nor the Resources model will help with that).\nEclipse does provide some improvements towards detecting BOMs, but not with generating or skipping them.\n\n\nQuote Source\nI don't think there's a way to suppress the \"unexpected symbol\" error for the BOM character at the start of these files.\nSo until there's a way to suppress these wrong errors/Eclipse has support added for \"UTF-8 with BOM\" encoding, I think these language files should be ignored by this project so that it won't display them in the project tree and errors won't be reported for them.\nSo I will apply a resource filter to the languages folder.\n. > > So I will apply a resource filter to the languages folder.\n@TheCycoONE I've now done this and I've added instructions to the project README for disabling this filter.\n. I've now added the CorsixTH folder to this project, I've filtered everything except CorsixTH.lua and changelog.txt. If every other file and folder was linked to then Eclipse would want to include them in file searches.\n. And I've now removed \"LFS\",\"LPG\" & \"AGG\" from the build path.\n. > > Ok, so the language files should be added back.\n@TheCycoONE I've now done this.\n\n\nThere isn't really sufficient instructions in the README or any links on how to use this project or what it's for.\n\n\n@TheCycoONE I've now replaced the README's setup instructions with a link to the WIP wiki \"Eclipse Project Setup\" tutorial, I will change the anchor link. I will add the other information you've asked for to the README & wiki tutorial.\n\n\nIt isn't suitable for building CorsixTH without a lot of steps.\n\n\n@TheCycoONE When I want to compile CorsixTH in Windows with Visual Studio Express 2013 I simply have to open its .sln and then tell it to build the \"CorsixTH\" solution. In the tutorial I've made only Step 9 needs to be done every time CorsixTH is compiled since the settings configured in the other steps are remembered.\nFor Linux I could make a simple Eclipse button plugin which would execute a Linux compile script I've made when its clicked.\n. > > @TheCycoONE When I want to compile CorsixTH in Windows with Visual Studio Express 2013 I simply have to open its .sln and then tell it to build the \"CorsixTH\" solution. In the tutorial I've made only Step 9 needs to be done every time CorsixTH is compiled since the settings configured in the other steps are remembered.\nI will find out how to setup Eclipse to compile CorsixTH's C++ source code in Windows.\n. > > If I would be allowed to make the class script support the LDT plugin...\nI guess the changes may only need to be simple and only effect the code in class.lua .\n. > > I guess the changes may only need to be simple and only effect the code in class.lua\nEvery class script would need to be modified to make at least a class's methods be detected by the LDT plugin. But I have an idea which, if it works, will only require one table declaration statement to be added to the top of a class script in order to make the LDT plugin detect the declaration of its methods.\n. My idea nearly works: having modified the Entity class CorsixTH runs properly and the LDT plugin sometimes detects this class's method declarations and lists them in the outline view, allowing the text editor view to be jumped to these declarations by clicking on them in the list:\n\nI've simply added these statements:\n---@type Entity\nlocal Entity = _G[\"Entity\"]\n. > > Have you checked to see how it interacts with our persistence system?\n@TheCycoONE I will try this later. \n\n\n...the LDT plugin sometimes detects this class's method declarations...\n\n\nThe LDT plugin isn't outlining scripts in my CorsixTH project until one of its scripts is modified.\nIs there already a Lua programming IDE which can create a script view jumping UI list of method declarations for a CorsixTH class's script?\nI've never tried finding a different Lua programming IDE which can do this, I guess I should have done this a long time ago because of how inconvenient not having this UI feature is.\n. > > Is there already a Lua programming IDE which can create a script view jumping UI list of method declarations for a CorsixTH class's script?\nThere is: the ZeroBrane studio Lua IDE I've just tried can. \nSince @TheCycoONE doesn't mind me changing all of the class scripts to allow Eclipse's LDT plugin to list their functions, then I will do this because Eclipse is one of the most popular multi language,open source and cross platform programming IDEs there is and it will be my personally preferred Lua IDE when it can outline CorsixTH class functions. \nAnd I still want to make the LDT plugin's debugger work with CorsixTH instead of making another Lua IDE's debugger work with CorsixTH.\n. By adding only 4 statements to a class and declaring its fields with its name before adding them to the self table, both its functions and fields can be listed in the Eclipse LDT plugin's outline view:\n\nThe current way of declaring a class with no parent class:\n```\nclass \"Car\"\nfunction Car:Car(name, man, mpg)\n  self.name = name\n  self.manufacturer = man\n  self.mpg = mpg\n  self.distance_travelled = 0\nend\nfunction Car:setDistanceTravelled(newDistance)\n  self.distance_travelled = newDistance \nend\n```\nThe new way:\n```\nclass \"Car\"\n---@type Car\nlocal Car = {}\nfunction Car:Car(name, man, mpg)\n  Car.name = name\n  Car.manufacturer = man\n  Car.mpg = mpg\n  Car.distance_travelled = 0\n  copy_fields(Car, self)\nend\nfunction Car:setDistanceTravelled(newDistance)\n  self.distance_travelled = newDistance \nend\ncopy_methods(Car, _G[\"Car\"]) -- Class functions are called methods.\n```\nThe 2 new function calls are for two of the four new functions I've added to Util.lua:\n```\n-- Copies the source table's key-value pairs into the destination table\n-- excluding pairs which have a value of the specified variable type.\n-- @param source\n-- @param destination\n-- @param type\nfunction table_copy_pairs_exclude(source, destination, type_p)\n  for key, value in pairs(source) do\n    if type(value) ~= type_p then\n      destination[key] = value\n    end\n  end\nend\n\n-- Copies the source table's key-value pairs into the destination table\n-- only for pairs which have a value of the specified variable type.\n-- @param source\n-- @param destination\n-- @param type\nfunction table_copy_pairs_only(source, destination, type_p)\n  for key, value in pairs(source) do\n    if type(value) == type_p then\n      destination[key] = value\n    end\n  end\nend\n\n-- Copies functions from the source table to the destination table.\n-- @param source\n-- @param destination\nfunction copy_methods(source, destination)\n  table_copy_pairs_only(source, destination, \"function\") \nend\n\n-- Copies field values from the source table to the destination table.\n-- @param source\n-- @param destination\nfunction copy_fields(source, destination)\n  table_copy_pairs_exclude(source, destination, \"function\") \nend\n```\n. > > How much have you looked at class.lua. It seems like a lot of what you're doing is redundant to what it's doing when it encounters class \"name\". If Eclipse could recognize that ...\n@TheCycoONE I've looked closely at class.lua and mostly understand what it does to implement classes with support for inheritance.\nIdeally the function call statement: class \"Name\" / class(\"Name\") would be the only statement needed for Eclipse to recognize that a Lua class was being declared in a script but I think making Eclipse recognize this would involve making a new Eclipse plugin which would require a lot more work than simply using a class table local to the script to declare a class's fields and methods so that the LDT plugin can then recognize this table class and recognize its value declarations as its field & method declarations. \nWith my suggested new way of declaring classes a class would be declared twice: \n1. In a table local to its script so that the LDT plugin can make Eclipse's outline view list its methods & fields when its script is viewed in the text editor view.\n2. And in class.lua so that the way CorsixTH classes are implemented isn't changed, making my suggested change a bolierplate change instead of a more drastic change.\n. I think the original creators of CorsixTH developed its Lua support with the Lua Decoda IDE in mind because they made CorsixTH support this IDE's Lua debugger and its script outline can identify CorsixTH's classes & their functions. It can't outline class fields though:\n\nI guess if this IDE has a working debugger for CorsixTH and can outline a script's classes and their methods, then maybe I shouldn't spend any more time working on making Eclipse support these things especially since making its outline view outline class functions alone would involve changing all the classes and getting fields to be outlined would require even more changes.\n. Though I personally would prefer to use Eclipse if it could at least outline class functions and had a CorsixTH compatible debugger. And having a class's fields in its outline would be useful.\nSo I might still work on making Eclipse into a good CorsixTH Lua IDE.\n. @TheCycoONE @Lego3 Should I change how classes are declared to make Eclipse a better IDE for Lua scripting? If so should I make the changes I've proposed to make Eclipse's LDT plugin outline fields and methods or should I just make the change for outlining methods?\nMethods & Fields:\n```\n---@type Car\nlocal Car = {}\nclass \"Car\"\nfunction Car:Car(name, man, mpg)\n  Car.name = name\n  Car.manufacturer = man\n  Car.mpg = mpg\n  Car.distance_travelled = 0\n  instance(Car, self)\nend\nfunction Car:setDistanceTravelled(newDistance)\n  self.distance_travelled = newDistance \nend\ndeclared(Car, \"Car\")\n```\n- instance(Car, self) :  copy_fields(Car, self)\n- declared(Car, \"Car\") : copy_methods(Car, _G[\"Car\"])\nJust methods:\n```\nclass \"Car\"\n---@type Car\nlocal Car = _G[Car]\nfunction Car:Car(name, man, mpg)\n  self.name = name\n  self.manufacturer = man\n  self.mpg = mpg\n  self.distance_travelled = 0\nend\nfunction Car:setDistanceTravelled(newDistance)\n  self.distance_travelled = newDistance \nend\n```\n. > > We could start out with methods and try it for a while, since it implies less changes.\nI will make a pull request for these changes soon.\n\n\nIt should only need to take the string argument to mirror the class method. (assuming eclipse could handle that), since the object would just be _G[name_string].\n\n\n@TheCycoONE The purpose of the end_class function call after all of a class's methods would have been declared in a table local to its script, would be to copy all it methods from its script's local table to its global methods table in: _G[ClassName]. So the table local to the script containing all the declared methods would need to be provided in addition to the class's name/a reference to its global methods table.\nMaybe the class function could be modified to return the table for a class's script which could be provided with the class's name as a value and because the name would be added to the table in class.lua instead of the script it will be local to, the LDT plugin wouldn't display the class name value as a field in the class table's outline when its script is viewed:\n```\n---@type Car\nlocal Car =\nclass \"Car\"\nfunction Car:Car(name, man, mpg)\n  Car.name = name\n  Car.manufacturer = man\n  Car.mpg = mpg\n  Car.distance_travelled = 0\n  instance(Car, self)\nend\nfunction Car:setDistanceTravelled(newDistance)\n  self.distance_travelled = newDistance \nend\nend_class Car\n```\n. > > What would the LDT do, if instead of local Car = {} you defined the global Car there...\n@TheCycoONE This is the only change which would need to be made to every class to make the LDT plugin outline just their methods (I've found 3 minor CorsixTH classes which already do this). The example I provided in my comment, which asked you and @Lego3 what I should do, was wrong. I will correct it in this comment to be this:\n```\nclass \"Car\"\n---@type Car\nlocal Car = _G[Car]\nfunction Car:Car(name, man, mpg)\n  self.name = name\n  self.manufacturer = man\n  self.mpg = mpg\n  self.distance_travelled = 0\nend\nfunction Car:setDistanceTravelled(newDistance)\n  self.distance_travelled = newDistance \nend\n```\nWith this global table only being meant to contain a class's methods a reference to it can't be used for declaring a class's fields locally in its script, so that they can appear in the LDT plugin's outline for this locally referenced table. \nThe \"self\" table which can be referenced in a class's constructor method & its other methods, is the table created for a class instance at runtime which stores its fields as values and references its global methods table as a Metatable with a _index Metamethod calling methods using their table keys when these keys aren't found in \"self\" tables. \nThis Lua guide explains how Metatables and the _index Metamethod can be used to implement classes with support for inheritance.\n. There is a problem with the test script's regular expression, I will fix it.\n. > > There is a problem with the test script's regular expression, I will fix it.\nI've fixed this regex now and updated it in my first comment.\n. Travis CI build error for 2nd commit at line 887:\n\n\n/home/travis/build.sh: line 41: /home/travis/build/CorsixTH/CorsixTH/scripts/check_lua_classes.py: Permission denied\nThe command \"${TRAVIS_BUILD_DIR}/scripts/check_lua_classes.py\" exited with 126.\n. > > You need to give your new python file execution rights. On Windows I don't know how it works exactly, but on Linux you just do chmod 755 file.py\n\n\n@Lego3 Thanks, I've done this now and the edited build script now works.\n. > > An alternative solution is to explicitly state you want to run Python:\n\n\npython ${TRAVIS_BUILD_DIR}/scripts/check_lua_classes.py\n\n\n@Alberth289346 Thanks for posting this tip: I've updated the build script to use this solution.\n. I will try to fix this bug today.\n. With Room:commandEnteringPatient() and Room:commandEnteringStaff() being sensitive to race conditions how about we make these functions execute their statements in interruptible protected call coroutines?\n. @TheCycoONE  Your right, my idea wouldn't have worked, I didn't think through my idea before posting it.\n. I will create a tutorial for debugging CorsixTH with the Eclipse LDT plugin's debugger later/tomorrow.\n. Oops: I guess distributing debugger.lua with CorsixTH would be illegal. I will remove it. \nDevelopers will have to download it and place it in their Lua directory when they want to setup CorsixTH for Lua debugging. I will add an error check for the existence of debugging.lua when connectDebugger() is called.\n. I've deleted debugger.lua but haven't yet modified connectDebugger() to make it handle the problem of this script not being available in the Lua directory.\n. @TheCycoONE I've finished this pull request: connectDebugger() will now check if Lua/debugger.lua exists and if it doesn't the displayed error message will mention that devs are required to download this  file.\n. > > @J-Shep is there a reason you opted for a connect debugger menu entry over a connect debugger config option? Just looking for a pro/con list.\n@TheCycoONE Clicking a menu button for starting & connecting the debugger client when its required & a server is running, is quicker and more convenient than having to navigate a file explorer to the config file and then modifying a config option in order to enable/disable the debugger client.\n. Here's my instructions for setting up CorsixTH & its Eclipse project for Lua debugging:\n1. Start Eclipse\n2. Right click on your CorsixTH project then click: \"Debug As\">\"Debug Configurations\"\n3. Double click: \"Lua Attach To Application\"\n4. Name your CorsixTH debugging configuration.\n5. Set \"Timeouts\" to 180+ seconds.\n6. Click on the link for the \"Lua Debugger Client\"\n7. Download it to your CorsixTH repository's Lua directory.\nI won't add these instructions to a wiki page until this pull request has been merged, with its .gitIgnore statement for ignoring debugger.lua .\n. > > @J-Shep Curious, you mention this is only supported on Windows & Linux. Is there any particular reason why OS X is not supported? I'd be happy to help get this up and running with OS X as well.\n@admdly I thought I had read somewhere that debugger.lua wasn't compatible with OS X but I've just searched this lua file and the LDT guide for a OS X reference and its not mentioned. Debugger.lua is said to be compatible with Unix operating systems and I see that OS X operating systems are based on Unix like Linux operating systems.\nI've only tested debugger.lua with my CorsixTH changes on my PC's Windows 8.1 operating system but I guess this pull request's commit should also be tested in a Linux & OS X operating system before its merged. I have a Ubuntu 14.04 PC I could test it on.\nI guess debugger.lua's client initialization parameters like PLATFORM (can be auto detected normally) should be changeable in the CorsixTH config file in case some Unix operating systems devs might use would not support the default parameters.\n@admdly Thanks for offering to help with making my changes support OS X debugging, there's no OS X computer I can use so please help me by trying to run this debugger in a OS X operating system.\nI will make the debugger.lua parameters changeable tomorrow.\n. > > @J-Shep It seems the debugger is available via luarocks on OS X. I'll install it and do some testing after the Christmas period. Once I have some more information I'll post back here with my findings.\n@admdly Thanks, I will test this with Linux soon.\n. The CorsixTH config file can now change the initialization parameters for the DBGp client.\n. @Lego3 Thanks for reviewing my changes, I've made all of the changes you requested but my change for allowing the debugger to be started asap is a WIP. \nI've moved the connectDebugger() code into its own Lua script called \"run_debugger\" so that a) this code isn't coupled to any Lua script it can debug and b) Lua & C++ code can start the debugger by just executing this file.\nI'm working on allowing run_debugger.lua to be executed before the CorsixTH.lua boot strapping script is executed by making srcUnshared/main.cpp:main() execute this script with a luaL_dofile(L, filename) call when CorsixTH is started with this parameter: -debugger\n. @Lego3 I've now updated this pull request's commit to include all the changes you asked for. \nCorsixTH can now be started with a: -debugger parameter to make CorsixTH.lua start a Lua DBGp client before most of this bootstrap script's code has been executed. \n. @Lego3 I've removed the tabs you found.\n. > > ...if I click to skip the introduction movie I get a \"CorsixTH has stopped working\" Windows message. Do you get this too? Is it because of some timeout?\n@Lego3 I will try this later. Thanks for reviewing & merging my other pull requests.\n. > > ...if I click to skip the introduction movie I get a \"CorsixTH has stopped working\" Windows message. Do you get this too? Is it because of some timeout?\n@Lego3 If I can get CorsixTH to compile today with support for movies then I will test this.\n. This is the compile problem I'm having:\nhttps://groups.google.com/forum/#!topic/corsix-th-dev/1gXQURGYNaA\n. @TheCycoONE The debugger isn't working for me now as well, I will investigate this problem.\n. > > For some reason the debugger picks the wrong location for my scripts ...\n@TheCycoONE I think the problem your experiencing might be being caused by your Eclipse project setup and the \"Source Mapping\" option your using for your \"Lua attach to application\" debug configuration for CorsixTH:\n1. Local resolution (What I use, which isn't working now):\n\n\nRecommended if the source files loaded by your Lua VM are physically the same than the files in your workspace (in your project buildpath)\n2. Module resolution\n3. Replace path resolution\n. @TheCycoONE I was wrong, your problem is the same as my problem: the \"Lua attach to application\" configuration window has an option to enable DBGp logging and Eclipse's debugging perspective has a \"Script Debug Log\" view.\n. > > @J-Shep did you figure out a solution / do I need to enable both of those logs?\n\n\n@TheCycoONE No I mentioned that logging could be enabled because that's how I found out that I have the same problem. The quote below is from the log message which occurs after I connect CorsixTH's DGBp client to Eclipse's DBGp server:\n\n\ninit fileuri=\"file:///c:/users/j_she_000/programming/github/corsixth/build/corsixth/corsixth/lua/app.lua\" \n. @Lego3 Do you have a working DBGp_Support commit testing branch from before whatever change to this commit/CorsixTH's trunk  prevented this commit from making Eclipse's debugger work?\n. @TheCycoONE Thanks for finding the solution to this problem, I will still need to modify this code to make it push the --connect-lua-dbgp parameter into the Lua stack before the dofile(CorsixTH.lua) call. I  will add this start up parameter to the README file instead of having a \"Startup Args\" text file.\n. I've changed this commit:\n- I've changed its commit message.\n- I've fixed the path problem.\n- I've renamed the -debugger variable to : --connect-lua-dbgp\n- The --connect-lua-dbgp argument is now searched for in the same loop which searches for the --intepretter command.\n- I've added: --connect-lua-dbgp and the other startup arguments I've found to a list of startup arguments in the README file and I've deleted \"Startup Args.txt\".\n- I've reverted the main menu because I now think a \"connect debugger\" main menu button isn't worth having now that the debugger can be started before the main menu and App class have been loaded, using the --connect-lua-dbgp startup argument.\n. > > I'm not 100% what's happening with the lua_State here though.\n\n\n@TheCycoONE What I know: the protocol for calling a Lua State Stack function is to first push it on to  the stack and then its parameters in order.  When its been executed by a LuaL_call(), it and  its parameters will be removed from the stack and the result will be pushed on to the stack.\nThe command line arguments are pushed onto the top of the stack after the Lua State has been declared in: SrcUnshared/main.cpp . They are still the top stack values when the argument search loop in Src/main.cpp is executed. \nSrc/main.cpp:CorsixTH_lua_main_no_eval() finishes by either calling:\n- assert(LoadFile(--interpeter=value))\nlua_getglobal(L, \"assert\"); \n  lua_getglobal(L, \"loadfile\");\n  lua_pushlstring(pushes the interpreter command's value);\n- or assert(LoadString(\"Chunk string for executing CorsixTH.lua\"))\nlua_getglobal(L, \"assert\");\nluaL_loadbuffer(L, sLuaCorsixTHLua, strlen(sLuaCorsixTHLua),\n                          \"@main.cpp (l_main bootstrap)\");\nParameters then pushed...\n\n\nb. I think this block could be pulled outside of the if(!bGotScriptFile) block so that it would be pushed regardless of whether the interpreter was specified on the command line?\n\n\n@TheCycoONE @Lego3 If the purpose of the --interpreter= command is to specify which Lua interpreter should be used to execute CorsixTH's scripts then why does the use of this argument need to prevent the CorsixTH.lua boot strapping script from being called by: Src/main.cpp:CorsixTH_lua_main_no_eval()?\n. > > When I run it using -debugger I am able to e.g. set a breakpoint on the first line of App:App. However, if I click to skip the introduction movie I get a \"CorsixTH has stopped working\" Windows message. Do you get this too? Is it because of some timeout?\n@Lego3 I've still not tried this myself because I've not yet compiled CorsixTH with support for movies. But I've noticed that CorsixTH crashes when its running a Lua DBGp client connected to a DBGp server and its audio is turned on in the main menu's options. The error message is about a memory access problem. So maybe the movie crash you experienced was caused by this problem.\n. I've changed Utility:is_file_unreadable(...) . \n. @TheCycoONE I've made all the changes you asked for thanks for helping me improve this pull request.\n. I need to correct one mistake.\n. > > I need to correct one mistake.\nCorrected: I had committed debug script test code. \n. I've made the README changes @TheCycoONE asked for and I've also now created a CTRL + C global key handler for calling App:connectDebugger().\n. As well as adding the new CTRL + C global key handler, the DBGp implementing commit now also makes the debug console and debug script executing key commands usable in CorsixTH's pre-game menus when debug mode is enabled.\n. @TheCycoONE Thanks for reviewing my pull request.\n. > > ... have you looked at the Zerobrane Lua IDE (http://studio.zerobrane.com/). It appears to support a somewhat similar remote debugging mechanism, as well as live code updating, and support for debugging any lua interpreter luasocket works with (lua 5.1/5.2/5.3, luajit 2.0+)\n@TheCycoONE I've tried this IDE before but I can't remember my experience of using it. Live code updating does sound useful.\n. I will try to fix this issue.\n. @Glimmer-Man Thanks for reporting this problem last year and providing us with lots of information to help us investigate it.\nHaving loaded the saved game you provided I can see that patient 3 isn't expected for room 1 in your screenshot because their \"queue\" action for this room has been started removing them from this room's list of expected patients and then setting their dynamic info to \"Ve front pro GP's office\": Czech for \"queueing for...\":\n\n. I've been able to reproduce this problem in 0.60 using the saved game @Glimmer-Man provided and patient 3: having emptied the hospital of all humanoids except patient 3, I hired one doctor and then deleted the GP's office she was queuing for. When she goes to a different GP's office the one doctor in the hospital isn't called to it.\n. Actually I had some how managed to accidentally delete the statement in CallsDispatcher:callForStaffEachRoom(..) which sends staff to rooms when they are called so I've not managed to reproduce this error yet.\n. I'm encountering problems with doctors not answering calls in a simple level 1 0.60 hospital I've made which just has 2 GP offices, 1 General Diagnosis and one idle doctor in the general diagnosis room with 2 patients waiting for doctors to attend each GP office:\n1) Patient A is waiting for a doctor to attend GP office A, there are currently no doctors.\n2) Patient B walks from reception to GP office B before they reach it I hire a doctor dropping him in the general diagnosis room, despite this room having no queue of patients this idle doctor does not go to GP office A to answer the first doctor call for patient A.\n3) Patient B arrives at GP office B and the doctor still doesn't leave the general diagnosis room to answer this new staff call.\n\nI've used the \"Meld\" file comparison program to compare the staff call related scripts (calls_dispatcher.lua, seek_room.lua & room.lua) from the trunk with the scripts from 0.40 and I can see that only a few very minor changes have been made to the code related to staff calls: removed white spaces, coding convention changes and one \"if\" statement being used slightly differently to make the code in its parent function more readable.\n. Staff are allowed to leave rooms. \nI will fix this problem I've found but I don't think it could have caused the problem @Glimmer-Man experienced because in his saved game he had idle doctors outside the staffroom and idle doctors not in rooms do always answer staff calls .\n. I've realised that what I thought was a problem is actually an intentional decision: if a player puts a doctor/nurse in a room they will want them to stay there until they've treated at least one patient which is the case now: doctors in a room only check for calls to answer after they've dealt with a patient where as when they are outside a room they check for staff calls to answer whenever they start a meander action.\n. @Lego3 I've changed this in my new pull request: #1077\nRegarding this issue @Glimmer-Man opened, having spent a lot of time investigating it I've still not been able to reproduce this problem he experienced in 0.40, using 0.60.\nAs I've mentioned in an earlier comment, I've used a file comparison program to compare the 0.60 scripts related to staff calls (calls_dispatcher.lua, meander.lua, room.lua and seek_room.lua) with their 0.40 earlier versions and no changes have been made to staff call related code besides white space removals, coding convention changes and one if statement having been modified to make its parent function more readable.\nHaving closely examined the staff calling code I can't find anything wrong with it to explain why the patient in @Glimmer-Man 's saved game has gone to an empty GP office  without the seek_room action they would have used calling a doctor to this room or if it didn't because there was a doctor in the room who then exited before patient 3 arrived: how Room:onHumanoidLeave(humanoid) failed to call a new doctor to this room.\n\nUsing debug script code I can see that the calls dispatcher has no queued call for this room, I can see that there's no doctor with a queued action to bring them to this room and I can see that there's no doctor going somewhere who's last room was this room.\nWhen I make patient 3 go to another empty GP's office seek_room successfully calls for a doctor to attend this office.\n. > > What happens if the doctor that was called when the patient arrives is diverted (fired or moved to another room)?\nThanks for asking I hadn't considered this. The interrupt CallsDispatcher:staffActionInterruptHandler() is setup when CallsDispatcher:answerCall(humanoid) is called: this creates a new staff call if a staff member enroute to a room is fired, goes to a staffroom instead or is picked up and dropped in another room.\n. I think I will start working on this during my Christmas week as my first implementation task for #386 since the IRC text chat support could be used for LAN multiplayer games as well, though it would take me longer to implement a IRC protocol compliant chat system instead of a simpler LAN only system.\n. @TheCycoONE I know you want CorsixTH to be distributed with less 3rd party libraries and I know that having to use 3rd party licenses with code CorsixTH devs may want to modify must be inconvenient.\nI would like to use a 3rd party IRC library though if not using a 3rd party IRC library would require alot of additional work.\n. > > I'm not sure why an IRC client should be included in the game. I just can't see it being something many will use or there being much utility in it for most people.\n@admdly I think it would be good if players playing the single player mode could have the option of chatting with other CorsixTH players while they play and CorsixTH will need to have an internet chat system one day for internet multiplayer games, so why not make an IRC system now for at least this future use?, this is a good old tried & tested chat system protocol.\n. > > What you're suggesting can be achieved by running the game in windowed mode and running an IRC client\n@admdly You've made an important point, though I personally would prefer to play CorsixTH in full screen mode with internet multiplayer & singleplayer internet chat text appearing in-game. \nFor internet multiplayer games I guess most players will prefer to use an external/integrated voice chat system (certainly for LAN games), with the exception of deaf players who I would be willing to implement a text chat system for. I guess Mumble will suffice for voice chat.\nI will reconsider whether or not working on an IRC chat system would be worthwhile.\n. I've had some more ideas for changes which could help developers repeat & debug errors:\n1) The autosave rate could be changeable from the settings menu or config file: so when a player's computer can make an auto save every 10 seconds or less without performance problems they could make this their auto save rate giving them more protection against losing progress because of errors. This would also help beta testers and this would help developers by giving them an autosave nearer the time of error giving them a shorter wait for the error to reoccur and reducing the chance of random events occuring which could prevent the error from being repeated.\n2) CorsixTH could run a timer between auto saves so that if an error occurs the report could tell the developer working on a fix for this error when it  took place after the most recent auto save.\n3) Between autosaves CorsixTH could also record the sequence of SDL input events & when they occurred,  so that if an error occurs this event sequence could be saved to a file which a developer could use to help them recreate the error. Using this file and my second idea, CorsixTH could replay the player's actions for the developer at the speed these actions occurred at or at a faster or slower speed until X seconds before the error occurred, when the game could then be paused to allow the developer to insert breakpoints for their debugger, before its unpaused to continue the input sequence replay. Plus this change could be the first step for implementing game replays.\nI would be willing to implement all these changes but someone could work on change one for a separate pull request while I work on a pull request for the automated Lua error reports with commits for the other two changes since they will create new things which should be included in the report emails.\n. Here's my repository branch for this issue, I've not yet pushed my latest changes:\nhttps://github.com/J-Shep/CorsixTH/tree/autogenerated_lua_error_email_reports\nI've now implemented everything except my 3rd idea so I will try to have this implemented by around January 1st. I will work on adding autosave options to the game settings menu if no one else does, after I've submitted a pull request for this issue.\nThanks to LuaSocket's support for the SMTP protocol I have CorsixTH sending error report emails to the email server I'm running on my PC which included an attached autosave and two image attachments: for the user's view & a screenshot of the entity an entity error occurred for. \nHere's the current report message:\n```\nlocal trace_heading = \"Error Trace:\\n\"\nif self.last_dispatch_type then\n  trace_heading = \"Error in \" .. self.last_dispatch_type .. \" handler: \\n\"\nend\nlocal report =    \"----   Error:    ----\\n\"\n                 .. \"Version: \" .. self:getVersion() .. \"\\n\"\n                 .. \"OS: \" .. getOS() .. \"\\n\"\n                 .. \"Map: \" .. convert_localised_string(self.map.level_name) .. \"\\n\"\n                 .. \"Game Ticks Since Saved/Loaded:\" .. self.world.game_ticks_since_saved_or_loaded .. \"\\n\\n\"\n                 .. \"Error Message:\" .. error .. \"\\n\"\n                 .. (\"Entity:\" .. tick_entity.id and tick_entity or \"\")\n                 .. trace_heading\n                 .. trace .. \"\\n\\n\"\n                 .. \"Message From Victim (\" .. self.config.language .. \"):\\n\"\n                 .. (victims_message and victims_message or \"\")\nlocal email = {\n    headers = {\n      to = \"Error Reports \" .. destination,\n      subject = self:getVersion() .. \": \".. \"<\" .. IP .. \"> <\" .. date .. \">\"\n    },\n   ...\n}\n```\nAs you can see, I've given every entity a new ID field to help find them in saved games from before an error occurred.\nI would be willing to configure the email sorting rules for the CorsixTH email account which will receive Lua error reports. @Lego3 You could email me the login details for this new email account.\n. I'm now going to include support for the source code to report some of its errors by calling this report email sending Lua code.\n. I will probably submit a pull request for this issue in a few days time. \nError replays probably won't be included because I think I will need to spend at least one more week working on making them work.\n. I'm nearly ready to submit a pull request.\n. I think I will be able to finish working on this issue this weekend.\n. I expect my work on this issue to be finished soon.\nThe latest error report dialog:\n\nA error report message for an in game error:\n```\n*  In Game Error:    *\nVersion: Trunk\nOS: Microsoft Windows [Version 6.3.9600]\nWorld previously recovered from error?: false\nWorld Date: 8/1/1:12 (D/M/Y:H)\nMap: TOXICITY\nTick Entity: 3\nError message \nOccurred In keydown handler: \nTrace L1\n Trace L2\n Trace L3\n1) aaa\n2) bbb\n3) ccc\nfullscreen = false\nallow_user_actions_while_paused = false\ncheck_for_updates = true\nplay_announcements = true\nsound_volume = 0.5\nenable_avg_contents = false\n...\n```\nI've also added 2 new debug menu commands:\n- Pause Game After Date\n- Center View On Entity (Given its ID)\n. Hi @sadger ,\n\n\nDoes this come up automatically when an error is detected or does the user have to click a button to \"send error report\" bring this up? The later approach would be better I think based on how much corsix crashes.\n\n\nIt comes up automatically when an error is detected. But the later approach you've mentioned sounds like it would be worth including as a drop down menu option for when a player experiences a bug which doesn't throw a Lua error and doesn't crash the game, like an unexpected behavior bug.\nI personally think this error report dialog should be shown automatically when an error occurs so that a player will be more likely to use it when an error occurs.\n. > > I was thinking it should work much like Windows reporting. You get a small popup with 2 buttons 1) Ignore 2) Report Error then when you select the second option you get your nice error reporting dialog. That way it's not too intrusive.\n@sadger Thanks for this suggestion: personally I don't think having a simple, small and unobtrusive  \"ignore or report\" dialog appear before a bigger \"send report\" form dialog would be worthwhile because unless the player is a developer testing their code then they won't want and shouldn't ignore the error which would have crashed their game and, with the current error recovery attempt code, probably won't be recoverable. \n@sadger If there was no need to ask the player to specify error reproducing steps then I could make a error report dialog like you've suggested with no text boxes (a prompt could appear to ask them for contact details when they've not provided this info before). However my code for error reproducing replay files is a long way from being usable but when this code does work I will create an error report dialog like you've suggested to replace the big intrusive form dialog I'm going to commit first. \nI will give it a save button though in addition to the ignore and send buttons because ideally a player should save the report and then attach it to a Github issue instead of telling CorsixTH to email the report to devs who would then have the task of doing this themselves when this email address will be receiving countless error report emails for developers deal with.\nI'm sorry I've still not finished this important task: I've not spent much time doing CorsixTH programming in the last 5 days but my branch for this enhancement is almost ready to be pushed.\n. > > @sadger If there was no need to ask the player to specify error reproducing steps then I could make a error report dialog like you've suggested with no text boxes (a prompt could appear to ask them for contact details when they've not provided this info before). However my code for error reproducing replay files is a long way from being usable but when this code does work I will create an error report dialog like you've suggested to replace the big intrusive form dialog I'm going to commit first.\nThere will actually have to be two separate dialogs: \n1) A small & simple dialog like @sadger suggested for reporting game crashing errors which would have no text boxes. This dialog will be automatically displayed when Lua errors occur and when source code error checks detect that a source code error has occurred which should be reported.\n2) A bigger dialog with a text box for reporting unexpected behavior bugs which won't give developers a stack trace to work with. A player would use a drop down menu command to display this dialog.\n. I might submit a pull request tomorrow.\n. I will try to finish this my work on this issue weekend.\n. I've had an idea I could implement in a commit for this issue's pull request: beta testers could give CorsixTH permission to use a game state copy which would only be updated after the successful execution of the other game state with App:run(). \nSo when an error occurs the copy could be saved and attached to an error report email along with the dispatch event which caused the error so that a developer could then repeat the error by simply loading this game state and then having app:run() respond to the dispatch event.\n. I've finished implementing the code for generating crash error reports and emailing them with useful attached files. \nI'm now going to work on one last commit which will use a separate report dialog to report problems which don't crash games like unexpected behavior bugs. A \"Report problem\" drop down menu command will display this dialog. I will probably finish this commit tomorrow.\n. Here's the dialog for the drop down menu \"Report Problem\" command:\n\n. > > Have you looked at the github api? It would certainly be feasible to send the issue to github on the user's behalf.\n@TheCycoONE I've not, now that I know it supports programs opening Github issues for their errors I will make CorsixTH open issues for Lua crash errors. \nHowever I don't think errors which can't provide stack traces should be posted to Github because making CorsixTH check for an existing issue wouldn't simply involve making it look for an identical stack trace in an open issue's comment. Unless the \"Report Problem\" dialog asks players to check themselves before clicking \"Send To Github\" but some players would click this sometimes without checking.\n\n\nNot so sure on the severity option as users won't really know how severe their crash is. Maybe just behind the scenes say if it's a crash or something else?\n\n\n@sadger This dialog isn't meant to be used for reporting crash errors because there's the new \"An error has occurred\" dialog I've made for this purpose which automatically appears when Lua crashes occur. \nMaybe this \"Report Problem\" dialog shouldn't have a severity question (to allow the checking of received emails to be prioritized as they could be auto sorted into inbox folders for the severity of their problem) which a player may not accurately answer but instead should  simply ask \"Did this error crash your game?\" for when this dialog is used to report source code game crashing errors which can't display the \"An error has occurred\" dialog and auto report their errors.\n. > > I kinda don't think the user should be asked to choose how they want to report the error (email or github) we should make the choice for them based on what we know. My feeling is that they shouldn't be expected to learn our processes just because their game crashed, and the choice might intimidate people into not filing at all. I'm not sure if that's reasonable or not, so I'm just putting the idea out there, not making a requested change.\n@TheCycoONE Thanks for posting your idea. If players had no choice to simply click a send button to make CorsixTH report their problem on their behalf,  then I think a lot of players wouldn't use Github to report problems because they wouldn't have the time/inclination/would be too intimidated to want to get involved in our processes by registering at Github, opening an issue and then chatting with developers about the problem they experienced.\nFor crash errors I now won't ask players to consider opening Github issues since this can be done without their involvement. When a new issue is opened for a crash error a player's game has reported I will make it tell them the address of the opened issue so that they can get involved in their problem's discussion if they are willing and have time to register and chat with developers.\n. Having not done any CorsixTH programming for a month I now have my PC setup for Lua 5.3 and I can compile CorsixTH.exe and run it without the graphics problem I mentioned in the developer forum. So I now want to start contributing again.\nHowever I've not yet been able to setup Luasec which would be required for making CorsixTH use the Github HTTPS API for opening error tickets and with its latest release being a year old, the Visual C++ project which comes with it is setup for Lua 5.2: I don't know how to reconfigure it for Lua 5.3. This libraries LuaRocks rock is also currently unusable for Windows users.\n@TheCycoONE @Lego3 Do you want me to wait until I can submit a pull request for a complete commit with Github support or would your prefer me to submit a commit with just email error reporting functionality asap and then submit a second commit for adding Github issue support later? I would prefer to do the latter so that there could be a patch released for #588 asap which could also introduce this error reporting functionality.\n. > > It may be easier to implement the github API connection in the C++ code since luasec appears to be quite a problem. There are definitely mature portable libraries for C/C++ for sending https traffic. (libcurl for instance).\nI think Luasec should be used so that the Lua code I've made for email reports can just be modified to include code for opening error tickets after checking that no tickets are already open for an error.\n. @TheCycoONE Thanks for your suggestion. I will use libcurl if the most recent Luasec release (released in January 2014) isn't compatible with Lua 5.3 and there won't be a new release compatible with it soon.\n. Hi, \nHaving not contributed to the development of this game for a long time I want to start contributing again by finishing my unfinished tasks I assigned myself to and then didn't unassign myself from during my contribution hiatus (I guess I should have considering how long its been).\nHas anyone taken over this task? I've not compiled the latest master version yet so I don't what features have been added to this game since I last played it a long time ago.\n. Thanks for welcoming me back @Alberth289346 , I will read about the latest Lua code style.\n. I'm now going to actually start contributing to this game's development again by finishing this important task asap and then the other tasks I assigned myself to many months ago.\n. My pull request will include a commit for making new Window component adding functions and another commit for implementing Window layout managers to remove the need for components to be placed with absolute screen coordinates which has made creating the error report form dialog much easier.\nHowever my new functions for adding components to windows require lots of optional parameters, for example:\nfunction Window:addTextBox(x, y, width, height, is_multi_line, tooltip, col_textbox, col_highlight, col_shadow, font, allowed_input, confirm_callback, abort_callback)\nSo would it be acceptable for me to request the optional parameters for a function like this with so many of them be provided in an optional parameters table like so:\n--!param width  (integer)\n--!param height (integer)\n--!param optional_params (table)\n--!param optional_paramas-x (integer) Not required if a Layout Manager will provide it.\n--!param optional_paramas-y (integer) Not required if a Layout Manager will provide it.\n--!param optional_paramas-is_multi_line (integer) Default: false\n--!param optional_paramas-tooltip (string)\n--!param optional_params-col_textbox (table) {red = ?, green = ?, blue = ?}\n--!param optional_params-col_highlight(table) {red = ?, green = ?, blue = ?}\n--! etc ...\nfunction Window:addTextBox(width, height, optional_params)\nThen they could be provided in any order and no nil parameters would have to be included in the call statement. Also the call statement would be more readable with each optional parameter being labelled in it.\n. @Alberth289346 Thanks for your helpful reply. I will make the changes you've suggested and split this feature away from the error reporting system.\n. I'm currently finalising my commits for Layout Managers and for the new Window methods I've created to support the use of Layout Managers and also to allow components to be added to windows with single simple function calls instead of a Window's creator having to issue a sequence of calls in order to create a single: Button, Label, Drop Down Menu, Textbox or Toggle Button for example:\n```\n-- Textbox for entering code\nself.textbox = self:addBevelPanel(20, 20, 280, 140, col_textbox, col_highlight, col_shadow)\n    :setLabel(\"\", app.gfx:loadBuiltinFont(), \"left\"):setTooltip(_S.tooltip.lua_console.textbox):setAutoClip(true)\n    :makeTextbox():allowedInput(\"all\"):setText({\"\"})\n-- Can now be made as follows:\n-- Textbox for entering code\nself.textbox = self:addTextBox(280, 40, {x = 20, y = 20, ttip = _S.tooltip.lua_console.textbox})\n-- Or with a LayoutManager providing the screen coordinates for its position:\n-- Textbox for entering code\nself.textbox = self:addTextBox(280, 40, {ttip = _S.tooltip.lua_console.textbox})\n```\nMy Report_Problem Window is up to date with the latest LayoutManager and Window code. So since the Report_Error window will reuse most of this window's code, most of the GUI code which will be required by my \"error report system\" pull request has been done. \nLeaving me with the coding tasks of finalising my error report generating code and creating new code for making CorsixTH report errors by opening Github issues instead of reporting them via email as I originally intended.\nI will submit a separate pull request for implementing Layout Managers and for my Window changes  either before or after this weekend when I won't be able to do any programming.\n. Its been more than a week since I've done any programming for CorsixTH but I will resume my work on this enhancement now.\n. I think I will be ready to submit a pull request for my implementation of layout managers by Monday.\nI made this window today to test and demonstrate Window support for having multiple layout managers working together to group window components in separate bevel panels with each layout manager having a bevel background enabled for its area:\n\n```\nfunction UIMultiplayerLobby:UIMultiplayerLobby(ui)\n  self:UIResizable(ui, 640, 480, col_bg)\n  self.esc_closes = true\n  self.on_top = true\n  self:setDefaultPosition(0.5, 0.25)\n-- Add window components:\n  local main = self:setLayoutManager(\"main\", TabularLayout(nil, self.width, self.height, {5, 5, 5}, 2, 5, 5))\n  self:addButton(\"Join\", 50, 25)\n  self:addButton(\"Host\", 50, 25)\nlocal layout = TabularLayout(main, main.space_w, 275, {6,5}, 2, 5, 5)\n  self:setLayoutManager(\"games_panel\", \n                        layout,\n                        \"bevel\",\n                        {red = 134, green = 126, blue = 178})\nself:addLabel({\"Joe's Game\", \"Dave's Game\"}, \"64%\", \"98%\", {font = \"Font04V\", bg_c = {red = 0, green = 0, blue = 0}})\n  self:addLabel({\"Paul\", \"Mike\", \"Emma\", \"Steve\"}, \"34%\", \"98%\", {bg_c = {red = 0, green = 0, blue = 0}})\nmain:skipRow()\n  layout = TabularLayout(main, main.space_w, 160 , {5,4,5,4}, 1, 0, 5)\n  self:setLayoutManager(\"chat_panel\",\n                        layout,\n                        \"bevel\",\n                        {red = 134, green = 126, blue = 178})\n  self:addTextBox(\"100%\", 25)\n  self:addLabel({\"Steve: Does anyone want to play the original TH multiplayer mode with me?\", \"Emma: I do!\"}, \"100%\", 120, {bg_c = {red = 0, green = 0, blue = 0}})\nend\n```\n. @TheCycoONE I could submit a pull request for a email crash reporting system for 0.60 within the next few days which would just use the existing Window code for the error report dialog, if this enhancement would be allowed with this release being in its beta stage. \nI know I would have to be frugal with the amount of new code I would add to 0.60 and I would keep it as simple as possible.\n. I've almost finished making an error report dialog for 0.60 using the existing Window code, I just need to correct some spacing inconsistencies:\n\nHaving already implemented Lua code for generating error reports and sending  error report emails a long time ago when I first started working on this enhancement before my long hiatus, I think I could probably have a barebones email error reporting system implemented by Monday for 0.60.\nIf 0.60 had an auto error reporting system it would help us strive to make 0.70 error free.\n. > > If there's no way to commit an ignore command for this script, then I think a commit should delete debugger.lua and then if a developer uses the run debug command when there's no debug script an error message can appear to tell them that they need to create debug_script.lua in their Lua directory.\nGit would ignore the script when it was recreated because its in .gitIgnore.\n. > > That said I don't mind at all removing the file, putting it in the ignore list, and putting in a detailed error message when trying to run debug without the file - it does sound like a cleaner way to go.\n@TheCycoONE Unless you want me to commit this change, I'm now just going to close this issue because its not a problem for developers since this is meant to be a script for temporary debugging code and because developers should be able to share permanent changes they make to their debug script with other developers: like useful debugging functions.\n. I will try to fix this bug today.\n. > > The lava sounds do look correct in all the files, but only 5 crashes for me.\nThis crash occurs for SOUND-5.dat when LAVA004.WAV is played.\n. > > Did you got the crash with SOUND-1.dat like me ?\n@Sigzegv No, like @MarkL1961 only SOUND-5.dat is crashing my CorsixTH. My TH sound .dat files are from a gog.com TH install.\n. > > It might be worth including some fallback if possible. There might be some versions of Theme Hospital that lack certain sounds. We have had that issue before (I think it was the Italian original release or something that lacked a certain \"idle\" sound)\n@Lego3 I will create a fallback response and error print statement for when a sound is missing from a releases's active SOUND-X.dat. LAVA004.WAV isn't missing from my SOUND-5.dat.\nThere's no response for SDL.Mix_PlayChannelTimed() returning an error, so I will add a print call for Mix_GetError():\nvoid THSoundEffects::_playRaw(size_t iIndex, int iVolume)\n{\n    int iChannel = reserveChannel();\n    Mix_Volume(iChannel, iVolume);\n    Mix_PlayChannelTimed(iChannel, m_ppSounds[iIndex], 0, -1);\n}\n. SDL.Mix_PlayChannelTimed() is returning a channel number instead of -1 (critical error) when it plays LAVA004.wav.\n. The error is occurring in th_lua_sound.cpp:l_soundfx_play() after its playRaw() call, in this IF statement closure I created for playing lava sound sequences:\n```\n//SDL SOUND_OVER Callback Timer:\n    //6: unusedPlayedCallbackID\n    if(lua_isnil(L, 6) == false)\n    {\n        //7: Callback delay\n        int iPlayedCallbackDelay = 0; //ms\n        if(lua_isnil(L, 7) == false)\n            iPlayedCallbackDelay = luaL_checknumber(L, 7);\n    if(m_iPlayedSoundCallbackIDsPointer == sizeof(m_a_iPlayedSoundCallbackIDs))\n        m_iPlayedSoundCallbackIDsPointer = 0;\n\n    m_a_iPlayedSoundCallbackIDs[m_iPlayedSoundCallbackIDsPointer] = luaL_checkint(L, 6);\n    SDL_TimerID timersID = SDL_AddTimer(pArchive->getSoundDuration(iIndex) + iPlayedCallbackDelay,\n                                        played_sound_callback,\n                                        &(m_a_iPlayedSoundCallbackIDs[m_iPlayedSoundCallbackIDsPointer]));\n    m_mapSoundTimers.insert(std::pair<int, SDL_TimerID>(m_a_iPlayedSoundCallbackIDs[m_iPlayedSoundCallbackIDsPointer], timersID));\n    m_iPlayedSoundCallbackIDsPointer++;\n    cout << \"DONE: SDL SOUND_OVER Callback Timer.\" << \"\\n\";\n}\n\n```\nThe \"DONE: SDL SOUND_OVER Callback Timer\" print statement isn't being printed.\n\n\n@J-Shep I think by fall back @Lego3 means that it should not crash at all, perhaps skips that sound on error?\n\n\n@MarkL1961 Well I don't think SDL failing to play a sound would actually crash a game using it and would only result in the sound not being played. \nBut if a sound can't be played because its missing then I think a error/warning message should be printed & this error should be auto reported by my WIP Error report email sending code and I think CorsixTH should try to find the sound in at least the English sound data archive.\n. The crash is being caused by an infinite loop in: th_lua_sound.cpp:THSoundArchive:getSoundDuration()\nI will find out why this is happening and then fix this later.\n. I will try to fix this today.\n. I've fixed this error. I will make a pull request soon.\n. As @admdly and other devs have told me I should really finish implementing my existing enhancement tasks before I give myself new ones to work on, \"striking while the iron is hot\". So I will now spend only a few days seeing how much progress I can make with this task and then if I'm not close to finishing it I will pause my work on it to get my more important auto error reports task finished.\n. > > Sorry to disrupt the party, but wouldn't you need a proper savegame first before this is of any use?\nIf you have no automatically and manually saved games for a hospital your running then you've started a new hospital so to run a replay for this hospital CorsixTH would create a new game for this hospital's scenario and then modify it by replaying your sequence & timing of input events.\n. Well while the hospital is closed with the gameplay being in its event less \"build time\" state obviously nothing will change regardless of the difficulty setting except for the value of the countdown timer. But once this timer has expired & the hospital's forced to open world & gameplay events would happen randomly sometimes despite there being no entities (such as earthquakes & VIP requests) because of \"should they happen at this moment with the set difficulty?\" World:tick() checks with calls to Lua's pseudo random number generating function:  math.random(...). \nI think it would best to create a wrapper Util.lua:random() function to replace these math.random() calls with an if statement check inside of it to check if TheApp.replay_active is true in order to decide whether to return a number from math.random(...) with the provided parameters or to pop a number off the replay stack.\n. > > Storing a table of generated random numbers from a deterministic random number generator would be wasteful.\n@TheCycoONE Are you against the idea of storing data for even short replays for what happens between autosaves in order to always be able to reproduce Lua errors without having to know what  events caused them? If you or @Lego3 don't want me to implement this then I won't. \nThis could be disabled by default in the settings.\n. @TheCycoONE I see. Well if you and @Lego3 have no objections to me implementing game replays in order to help with reproducing errors and running automated beta tests then I will definitely work on this. \nWould you object to \"Black Box\" replays being enabled by default with this feature increasing how much memory CorsixTH would use?\n. @Alberth289346  When you've loaded saved game X:\n1) CorsixTH will begin recording a new black box replay, marking for deletion any previously referenced black box replay: by making TheApp.black_box_replay reference a new Replay object, giving this Replay object the current game state for its prior_game_state field and then telling it to start recording input events.\n2) Lets say an autosave occurs before you create saved game Y: so CorsixTH will repeat step 1 this time creating a fresh black box replay for this new autosave and discarding the blackbox replay created for savegame X.\n3) Then you create saved game Y, so CorsixTH will repeat step 1 again.\n4) Now you continue playing and as you play TheApp will record each SDL input event in:\n\n\nTheApp.black_box_replay.events{1:{time, playback_callback}, 2: time, playback_callback} etc}\n\n\nEach event is recorded before its executed and could potentially cause a Lua error. An event's playback_callback will simply be its App:on...() handling callback with its occurrence parameters.\n5) Then before any new saved games are created, an event handled by a call to one of TheApp's SDL event handling callback functions causes a Lua error to occur.\n6) TheApp.run() will now begin responding to this Lua error in its CorsixTH executing coroutine, by creating a new saved game for the black box replay: creating this new saved game from the game state table referenced by TheApp.black_box_replay.prior_game_state and then persisting this replay by including a reference to its Replay object's table, in the table which will be written to the saved game file.\n7) Now a developer wants to reproduce your error so you give them your black_box.rsav file to load from their \"load saved game\" menu.\n8) When CorsixTH loads this saved game it notices that this saved game's state table doesn't have a nil replay field so after initialising its game state, CorsixTH will pause itself and the prompt developer user to confirm if they want it to run the replay.\n9) The developer clicks yes: so a reference to this Replay object's loaded table is assigned to TheApp.replay, the variable for referencing a replay being recorded/played which isn't the black_box replay being recorded.\n10) Then CorsixTH begins the replay by calling: TheApp.replay:play() making this object create  a SDL countdown timer for the first \"playback\" event's execution delay.\n11) This countdown timer expires making SDL call sdl_core.cpp which passes a new replay_timer_expired event to the App class which has a onReplayTimerExpired() handler which in turn calls: TheApp.replay.countdown_timer:onExpired().\n12) CountDownTimer:onExpired() replays the event by simply executing TheApp.replay.events[TheApp.replay.pointer].callback. Then incrementing the pointer. Its response finishes by calling TheApp.replay.play() which will be called recursively to reset the countdown timer for triggering the execution of the next playback event until there's no more events when it finish the replay's execution by calling TheApp:onReplayFinished().\n13) But because the last replay playback event will be the one which caused the error to occur, the final TheApp.replay:play() call would never be reached for this replay. With this being a black_box.rsav replay the developer and CorsixTH will know that the last replay event will cause an error to occur so CorsixTH can avoid executing this instruction until the developer tells it to allow this this event's Lua error to occur.\nI've created the essential code for recording, playing and persisting replays. Now I need to debug this code.\nI want to make a Busted Lua script to include in my pull request which will make use of replay execution calls to perform a useful runtime test. This way I can find out what the functional requirements will be for making my implementation of game replays support effective integration with Busted Lua script tests.\nI have in mind a Busted script which would use one or more game replays to construct & thoroughly test any room (provided as a parameter) with all its objects  and patients, to see if any Lua errors occur.\n. I've realised that having TheApp.black_box_replay.prior_game_state refer to a game state copy in memory is an unnecessary waste of memory space. It should instead refer to the saved game created before the black box replay.\n. Hi,\nHas anyone taken over this task during my contribution hiatus?\n. @xuancong84 Thanks for reporting this problem. I've not experienced your problem in Windows 8.1. I will try to reproduce your problem on a Ubuntu 14.04 PC tomorrow.\n\n\nThe saved game file might be slightly different in different OS...\n\n\nThe contents of a saved game file is not affected by the OS it was saved in.\n. I think this fix should be given to players asap because this error will always crash the game when hell deaths occur for players who are using sound effects from an affected language's SOUND-X.dat.\n. > > I'm a little confused how this gets into an infinite loop unless iChunkLength is negative. It should keep reading until it hits EOF and break.\n@TheCycoONE Well whatever causes this loop to get stuck, the break statement I've added ends this WAV duration data parsing immediately after its parsed all the required data and it prevents this game crash error from occurring.\n\n\nI can share my Sound-1.dat if needed.\n\n\n@Sigzegv If your using Windows 8.1 64bit I could give you a CorsixTH.exe to test and if it fixes the crash error you've experienced you could carry on using it with your language set to French.\n. > > I would just like to know what condition causes it to be a continuous loop and what this means for the actual result and the wav.\n@TheCycoONE I will investigate this when I have time.\n. I've nearly finished implementing layout managers.\n. I've finished implementing layout managers and will include a commit for them in my pull request for issue: #445\n. No cmake file changes will be required, I think a Windows developer just needs to use these two Cmake environment variables with the path to their libraries directory:\n- CMAKE_INCLUDE_PATH\n- CMAKE_LIBRARY_PATH \nI will add instructions to the \"Setting Up Windows Dev Software\" wiki page.\n. > > No cmake file changes will be required, I think a Windows developer just needs to use these two Cmake environment variables with the path to their libraries directory:\nThe paths provided have to be to the directories which contain the include/library files, but you can use * in the paths to mean \"any directory name\", so a include path could be:\n\n\nC:/Users/Joe/Documents/Github/Libraries/*/include\"\n\n\nThis would work as long as there's only one directory before the include directory.\n. > > ... but you can use * in the paths to mean \"any directory name\", so a include path could be: ...\nI was wrong: \n\n\n.../Libraries/*/include \n\n\nIs not valid.\n. > > Seems to me this is the sort of thing that needs to be solved upstream at CMake.\n@TheCycoONE I will see what changes would need to be made and if they are changes which should be made upstream at CMAKE then I will send them a pull request.\n. @MarkL1961 I'm sorry you've had trouble following the Wiki instructions I've made, I will make them clearer.\nI want to add a few statements to a cmake script so that if a dev follows the Windows setup wiki they won't need to edit, copy & paste any library paths into the CMake GUI program. CMake could instead detect the presence of a  .../Documents/Github/Libraries directory and then work out what the paths are to CorsixTH's required libraries.\nI'm also going to add instructions for compiling an exe with support for movies, using the find_ffmepg CMake find module to remove the need for FFMPEG's many library paths to be provided. And I will add instructions for Freetype 2 support so that this is a complete setup guide. \n. There are problems with the provided library directory paths I will correct them now.\n. A quick way of checking that a library path is valid is to copy & paste it into a Windows command prompt and then use it with the change directory command: cd\nI've corrected all the SDL paths, @TheCycoONE made a few mistakes when he updated these paths recently for SDL 2.\n. @TheCycoONE Well I guess it wasn't your fault: your zip program didn't just extract the contained folder for SDL 2 and the SDL 2 mixer libraries, it stored them in folders with their zips' names. I've added an instruction now to say that each zip's library folder should be the top level folder. I will add a screenshot of what the libraries directory should look like when all the zips have been extracted.\n. @TheCycoONE What should be done with: msinttypes-r26.zip when its been downloaded? I don't need to do anything with it to compile a CorsixTH exe without movie and Freetype 2 support.\n. > > A quick way of checking that a library path is valid is to copy & paste it into a Windows command prompt and then use it with the change directory command: cd\nAnd for library file paths you could use the command for: notepad\n. I've finished fixing the library paths having checked that every include directory & library file path is valid.\n. @MarkL1961 CMake saves the paths you give it in: .../Github/CorsixTH/build/CMakeCache.txt\n. @MarkL1961 I don't have time to help you now, I will try to spot what the problem is later and reply then.\n. The warnings don't matter and are to be expected, so the only error you have now preventing Visual Studio from compiling a CorsixTH.exe is that it can't find SDL_mixer.h . Your path to the SDL_mixer's \"include\" source files directory is valid. \nI guess you've done this already but if you haven't please make sure that SDL_mixer.h is in: .../Libraries/SDL2_mixer-2.0.0/include . If you downloaded \"SDL2_mixer-2.0.0.zip\" instead of \"SDL2_mixer-devel-2.0.0-VC.zip\" then your \"SDL2_mixer-2.0.0\" library directory won't have a \"include\" folder. \"SDL2_mixer-devel-2.0.0-VC.zip\" is required instead.\n. > > msinttypes-r26.zip\n@MarkL1961 You don't need this to compile a 32 bit CorsixTH.exe which doesn't support movies , Freetype 2 fonts (required for non English fonts which weren't supported by TH) & LuaJit.\n. @MarkL1961 I will add the paths for these files now.\n. > > That might also explain why in cmake it was defaulting the lua to a different location (in program files) than the one in the wiki page\n@MarkL1961 Yes, using this Lua setup program installs it so that cmake & CorsixTH.exe can find its libraries.\n. Because the instruction to use the \"Lua for Windows\" setup program has been removed I've now added instructions to copy the Lua dynamic link libraries into the debug executable's folder so that it can find them now that they won't be in a Windows system's search path.\n. @MarkL1961 I'm glad I've helped you by creating this wiki page. \n@TheCycoONE @Lego3 @wolfy1339 Thanks for improving it.\n. > > This pull request doesn't handle updating save games.\n@TheCycoONE I will add code for this.\n. I've pushed my latest code for this commit I will test it now.\n. I've tested my afterLoad() changes with each affected dialog with 0.40 saves and they all work except for the \"edit room\" dialog which crashes the game when return is pressed but this crash isn't being caused by my simple changes because it also occurs in 0.40 when I try to load this 0.40 saved game (with its room blueprint & edit room dialog) and then press return to confirm the blueprint's shape phase.\n. @admdly While working on two new buttons for saved game UI dialogs #369, have you done any work for one/both of these saved game enhancement ideas?\n. > > If we're going to have globally unique hospital identifiers for email they almost certainly have to be guids.\n@TheCycoONE Thanks for this suggestion I will do this.\n\n\nYour hierarchy probably doesn't have unique enough names...\n\n\n@TheCycoONE  I now think this should be the hierarchy:\n- Campaign:\n   -  Level 4:\n        - Auto:\n          * (2) 23/1/2015: 15:01:00\n          * (2) 23/1/2015: 15:00:30\n          * (2) 23/1/2015: 15:00:00\n        - Manual:\n          * (2) 23/1/2015: 15:01:25: My second manually saved game.\n          * (2) 23/1/2015: 15:01:15: My first manually saved game.\nSo a level's/scenario's different hospitals wouldn't each have their own saved games directory because a player is unlikely to want to keep saved games for a hospital they've won a level/scenario with or abandoned. \nA saved game's hospital's ID would be shown in brackets in its description and I think there should be a new saved game cache directory containing .cache text files for each saved game, having the name of an associated saved game and containing the value of its ID field so that this can be obtained without first having to deepersist all the other variables for its game state . These cache files could have other saved game fields and/or meta data added to it in future if required.\n\n\nIf we're going to save games that way automatically there needs to be a way or mechanism to clean up old games.\n\n\n@TheCycoONE Well I think all of a hospital's auto saved games should be deleted when a player has won the hospital's level/scenario and I guess there will have to be a maximum number of auto saves kept for each hospital. \n@admdly If your saved game deletion button will delete one or more selected saved games, I could implement a button to delete all the saved games for a hospital which has a given ID number.\n. > > Would it not be simpler to allow the player the chance to select which save or saves they send?\nFinishing the implementation of this auto error reports enhancement would be simpler and quicker if no saved games changes had to be included but I don't want players to have the inconvenience of having to do an extra input step which could be automated instead, in what is meant to be a quick and convenient to use automatic error reporting process.\n\n\nThere is also privacy laws to think about, even windows reporting gives you the option to not send information.\n\n\n@MarkL1961  Thanks for raising this important issue, I will remove the only 2 personal details which are in my current implementation of auto error reports.\nThe error report dialog will have a button for choosing not to send a report:\n\nThe only personal information which my current implementation of reports includes is contact information and the IP address a player had (they may have dynamic IP address) when they sent a report:\n\nI will remove this personal information so that then all the data which will be included in a error report email will only be about the responsible code and the game state when the error occurred. Plus the identity of the player who's game created this data would be anonymous. \nSo I think its safe to say there would be no potential privacy law issues when I've removed the personal information currently in error reports.\n. I will try to have my code for this issue ready to be submitted in a pull request by Tuesday.\nI'm sorry I've spent very little time doing CorsixTH programming this week despite having some important tasks to do because I've spent most of my free time at home playing PC games. Otherwise I could have submitted a pull request for this issue days ago.\nI know I'm responsible for two important tasks: this task and implementing a LAN multiplayer mode #386 . I will spend a lot more time doing CorsixTH programming next week.\n. > > Possibly we could suggest an e-mail address as contact info?\n@Lego3 I wasn't going to ask for any personal information after @MarkL1961 raised the issue of personal data protecting privacy laws, like my country's Data Protection Act and its data protection principles. But I guess just asking for an email address shouldn't cause any legal issues.\n\n\nAnd also possibly say somewhere that it's still good to create an issue in our issue tracker anyway.\n\n\n@Lego3 I will add this.\n@Lego3 @TheCycoONE As leaders of the development of CorsixTH feel free to tell me what you want me to do and not do when I'm working on something for it. Maybe my pull request for this issue shouldn't include any saved game changes: players could just be asked to manually select a saved game to be attached. But I still intend to make CorsixTH auto attach all the saved games for a hospital which has experienced an error unless you guys tell me this isn't worth working on.\n. I'm not going to have time to implement any of these improvements myself in the near future because I have lots of other more important enhancements I want to work on first like the  auto error reporting feature, an auto Lua error patching feature and my long term task of implementing multiplayer support.\nSo someone else could work on implementing improvements for this issue if they want.\n. @TheCycoONE I will make a wiki page for this now.\n. I will try to have this page ready to be published before tomorrow.\n. > > As an aside, @J-Shep would you mind putting together a wiki page on how to debug lua\nI've finished this page and I've finished another page about setting up Eclipse for CorsixTH programming and for debugging Lua scripts at runtime.\n. I will improve this commit later:\n1) I will make RestartSave.sav be auto loaded after CorsixTH has been restarted.\n2) When CorsixTH is restarted to view the new layout of a pre-game dialog I will make this dialog be auto displayed after CorsixTH has been restarted.\n. > > It depends how much functionality goes into the new shortcut. You dont always want to reload an open game etc.\n@Lego3 I will make SHIFT + F10 still call UI:resetApp() directly if you want this key command to be kept.\n. @MarkL1961 @TheCycoONE Thanks for reviewing my pull request. I've decided to close it because I now think the changes I've made should not be pulled.\n. This error was also reported in October 2013 : #66\n. I will close this issue because it a duplicate of #66.\n. @MarkL1961 In #66 @mrtnptrs mentions that there is a way: if a patient vomits in the room's blueprint just before the confirm button is pressed to enter the \"doors & windows\" phase because the litter/vomit check must only be occurring once when a blueprint has been moved/resized.\n. If they don't do this already: the install wizards and packages for the operating systems supported by CorsixTH releases could just make the Lua scripts directory a \"read only\" directory.\n. I've made a few UML diagrams to depict how this game works for singleplayer games for the analysis section of my multiplayer design document #386. I will post links to them when they are finished.\n. @TheCycoONE I've removed the C++ project.\n. He reported this 3 weeks ago by posting a comment in #362 because he thought this error may have been related but these errors have different stack trace error messages and the cause of #362 isn't actually related to a room being moved. I've now deleted that comment and posted it here.\nThe stack trace says its from a trunk version with save game version 102.\n. I will try to fix this error today.\n. @bobcanthelpyou I think this error may have been caused by your Theme Hospital data files, where are they from? an English demo? (if so please provide a download link for it)\n. > > What could be wrong with the data files of the game?\nWell in the past there was a problem with one of the lava hole sound effects in the sound DATs for some non English versions which would crash the game when it was played and as the developer who took on the task of fixing this I never found out exactly what the problem was but I did manage to fix this error by finding a way to prevent CorsixTH from getting stuck in an infinite loop when it would try to find the end of this sound effect's audio data.\nYour error resulted from the cast removal machine in your saved game having none of its animations for \"Alternate Male Patients\" so something went wrong with your game when it tried to load these animations from your TH .DAT files and the animation loading code is tried & tested so its unlikely to be at fault.\nPlease create a fracture clinic in a new closed hospital on the same map so you or I can check to see if its cast_remover machine successfully obtains all the animations for \"Alternate Male Patients\".\nLua/objects/machines/cast_remover.lua:\nobject.multi_usage_animations = {\n  [\"Alternate Male Patient - Nurse\"] = copy_north_to_south {\n    north = {\n      begin_use    = 2720, -- Patient invited onto machine\n      begin_use_2  = 2696, -- Machine closes\n      begin_use_3  = 2692, -- Nurse introduces the almighty black bucket\n      in_use       = 2688, -- The machine spits in the bucket\n      finish_use   = 3662,  -- Nurse takes the bucket again (different tile than 3658!)\n      finish_use_2 = 3658, -- The machine opens and the patient stands up\n    },\n  },\n  [\"Standard Female Patient - Nurse\"] = copy_north_to_south {\n    north = {\n      begin_use    = 4658, -- Patient invited onto machine\n      begin_use_2  = 4666, -- Machine closes\n      begin_use_3  = 4670, -- Nurse introduces the almighty black bucket\n      in_use       = 4674, -- The machine spits in the bucket\n      finish_use   = 5112,  -- Nurse takes the bucket again\n      finish_use_2 = 4682, -- The machine opens up and patient leaves\n    },\n  },\n}\n. > > Your error resulted from the cast removal machine in your saved game having none of its animations for \"Alternate Male Patients\"...\nI'm now repeating the test I did yesterday with the saved game from after the error and the cast remover does have all its animations for alternate male patients but when I tested this yesterday I was shown the same error message that was printed in your stack trace. I will find out why I'm now not experiencing this error. \n. I'm not able to reproduce your error myself now and maybe in my debug script test with your \"after error\" saved game before when I did experience an error it could have been caused by a mistake in my testing code. This is the debug script code I'm using now:\n```\nlocal fracture_clinic = nil\nfor _, room in pairs(TheApp.world.rooms) do\n  if room.room_info.id == \"fracture_clinic\" then\n    fracture_clinic = room\n    break\n  end\nend\nlocal object = nil\nfor current_object,_  in pairs(fracture_clinic.objects) do\n  if current_object.object_type.id == \"cast_remover\" then\n    object = current_object\n    break\n  end\nend\nlocal orient = object.direction\nlocal flags = 0\nif not object.object_type.multi_usage_animations[\"Alternate Male Patient - Nurse\"][orient] then\nend\n```\nThe last if statement is a copy of the if statement in the multi_use_object script which experienced your error but when I run this script now with your \"after error\" saved game no error occurs and I can see with my Eclipse debugger that there's no problems with the cast remover's mult_usage_animations table.\nPlease try to reproduce this error yourself and if you can then I would like you to provide me with a saved game from just before the use of the cast remover causes this error to occur. \n. Thanks for reproducing this error and providing a saved game, I will investigate this asap. \nI've not been able to do any CorsixTH programming recently because my PC's hacker hacked my Ubuntu 15.04 install to interfere with my CorsixTH programming. I have a fresh Windows 10 install now so I hope I will be able to do CorsixTH programming for a while without interference. I will try to find a solution for my security problem.\n. Hi,\nHas anyone taken over this task during my contribution hiatus?\n. @Alberth289346 Thanks for the info and for replying to all my other posts today.\n. I opened a issue with the same autosave improvement ideas that you've suggested in the past but its closed now, I think I may have closed it. But I now think this issue should be reopened because the ideas you've suggested would be worthwhile improvements imo.\nHowever one minute auto saves would be very unlikely to be able to reproduce errors without testers doing anything and auto saves may already be being made in less than one minute intervals because they happen every X game months, so the auto save rate is related to the game speed.\nI personally think most people would have computers with modern enough hard drives & SSDs to easily handle autosaving CorsixTH every 5 seconds because this simple 2D game doesn't have much data to write to its saved game files compared to more complicated 3D games. And players who don't have modern enough hardware could change their blackbox auto save rate in their settings or could just disable this autosave.\nI will test how different computers I own cope with autosaving CorsixTH every 5 seconds.\n\n\nSave interval 1 second, for one hour, autosave size 0,5 MB:\n60 * 60 * 0,5 = 1800 MB\n\n\nFor a single \"black box\" autosave being overwritten every X seconds when its updated, this wouldn't be a problem. \n. > > This is only a single savegame? And this is only for detecting crash errors? Not for other problems that don't crash the game?\n@bobcanthelpyou Yes, my idea is for there to be a single \"black_box.sav\" autosave feature which would have a different purpose than the existing autosave feature: to help developers reproduce crash errors without having to know what input events caused them in order to reproduce them. \nThe CorsixTH dev investigating the crash would load the black_box saved game and then freeze CorsixTH with their programming IDE's debugger so that they can then execute it Lua statement by Lua statement in the 1 - 5 seconds recorded by the black box saved game before the crash, being able to see what values variables have before they press a key to execute the next statement or skip ahead by executing multiple statements.\nSo the save rate for this new & seperate autosave feature shouldn't be related to the game speed because its purpose wouldn't be to allow players to restore a hospital to the state it was in at a previous point in its world's history for the purpose of undoing gameplay decisions.\nSo there should a separate Github issue for discussing improvements to the existing autosave feature while #836 is for discussing how the new \"black box\" autosave feature should operate if it's implemented.\n\n\nI wonder if you could save to memory instead of disk. In my experience, while Lua may crash, the program itself usually keeps on running. When a crash is detected, you can save to disk whatever was saved last.\n\n\n@Alberth289346 Thanks for posting this good suggestion: saving black box data to RAM instead of the disk would be ideal because the biggest and busiest of hospitals CorsixTH allows players to make requires few MB of data and buying GB of RAM is cheap nowadays.  I bet even players with old computers & slow old hard drives would have no problem having a 5 seconds or quicker black box save rate if its data was stored in RAM and then only written to their hard drive when the game has crashed, so that crash victim can post this saved game in a Github issue for their problem or the WIP auto error reporting system can do this for them along with all the other saved games their hospital would have from before the error.\n\n\nBtw maybe you want 2 copies, and alternately save to the other copy. That way you still have a copy if the save itself crashes.\n\n\nYes your right, thanks for pointing this out.\n. > > I wonder if you could save to memory instead of disk. In my experience, while Lua may crash, the program itself usually keeps on running. When a crash is detected, you can save to disk whatever was saved last.\nI think the default save location should be in RAM and then in the settings players/beta testers could choose to allow CorsixTH to save black box data to their fast hard drive/SSD instead to ensure that CorsxTH can always save its state from a few seconds before any crash.\n. @bobcanthelpyou I've reopened issue #662 about improving how games are saved automatically with the existing autosave feature and how they are saved manually.\n. I think a much more hardware efficient way to ensure that Lua errors can be reproduced would be to just log game state & view changing input events in a replayable way. So black box replays could be recorded between autosaves made by the existing autosave feature in case a Lua error occurs.\nI had this idea in the past and opened an issue for it but then I decided this feature wasn't worth implementing so I stopped working on it and closed this Github issue I had opened. But I now think this feature would be worth implementing to help reproduce Lua errors. #589\n. On second thoughts I guess caching these CMake variables wouldn't be worthwhile when the CorsixTH wiki guide for compiling it could just be modified to recommend using these variables, mentioning that their paths can be specified in the CMake GUI by using the \"Add Entry\" button.\n. @TheCycoONE Hi, thanks for helping me, I will try to make CorsixTH compile in Eclipse now. \nI was going to compile CorsixTH without Freetype support, I'm sure I disabled it in CMake.\n. > > It seems that for whatever reason _MSC_VER is defined in your setup.\n@TheCycoONE MinGW has to use MSVCRT.DLL. Do you have any ideas for why the existing preprocessor directives for dealing with stricmp aren't suitable for MinGW despite it using the same runtime library as Visual Studio?\n```\ninclude \"config.h\"\ninclude \"lua_sdl.h\"\ninclude \"th_lua.h\"\ninclude \ninclude \nifndef _MSC_VER\ndefine stricmp strcasecmp\nelse\npragma warning (disable: 4996) // CRT deprecation\nendif\n```\n. I guess MinGW must be unable to define stricmp with strcasecmp.\n. MinGW must still not support strcasecmp, there's a Google groups discussion mentioning this from 2014.\n. @TheCycoONE Would you mind if I make a CorsixTH stricmp / strcasecmp function now so that it at least no longer has to use these non standard C++ functions from third party libraries and can support MinGW compiling in Windows?\n. Thanks @Alberth289346 and thanks @TheCycoONE for helping me today.\n. I see @TheCycoONE you've commented about 3.0rc1 being broken before.\n. @TheCycoONE Thanks for your help.\n. @TheCycoONE Staff:isIdle() actually does all the checks necessary for making sure a staff member is idle and available for answering staff calls so I've updated this \"if\" statement accordingly.\n. Don't merge this yet, I need to make a doctor's dynamic info mention that they are on their way to the room where they are needed.\n. @TheCycoONE ok, I thought this commit was ready to merge when I submitted this pull request.\n. I think table_length would be a better name and I can see how having the for loop span multiple lines will make it more readable.\n. I will, when I made that row I didn't consider that the Corisx code max line width convention is 80 characters.\n. Does anyone think a 65% chance of hell deaths happening instead of heaven deaths is too likely or not likely enough?\n. @TheCycoONE I've made the improvement you suggested.\n. @TheCycoONE  : \"Haven't tested this, but what happens if the west or north tile is not available now?\"\nI've fixed this issue by adding the \"and westTileAccessible\" check.\n. @TheCycoONE: \"Haven't tested this, but what happens if the west or north tile is not available now?\"\nI've fixed this issue by adding the west tile accessible check:\n\"and humanoid.world:isTileEmpty(humanoid.tile_x - 1, humanoid.tile_y, true)\"\n. @TheCycoONE: \"Haven't tested this, but what happens if the west or north tile is not available now?\"\n I've fixed this issue by changing this if condition to check that the west tile is accessible, if it isn't then the north tile will be.\n. I can't remember what this number is for, I will remove it from this comment.\n. I've removed the number 3320 from this comment, I can't remember what it was for.\n. 3320 is a null animation, I probably pasted its number there when I was searching for an animation and wanted to record which animation I had reached so that I could then resume my search at a later time.\n. I've improved this commit by making it use the appropriate OS path separator and I've rebased it with the current master branch.\n. Resolved: \"For consistency there should be a space between ]] and function\" @TheCycoONE\n. @MarkL1961 The purpose of the afterLoad() callback function is to allow the code statements it contains to be executed after a saved game been loaded. The main use of these code statements has been to add new values to old saved games. \nThe statement I've added has a different use: to make CorsixTH start playing sounds for loaded entities which require sounds to be played.\n. @TheCycoONE UI:addOrRemoveDebugModeKeyHandlers() removes them but then adds them again when debugging is enabled to make sure duplicate table entries aren't added.\n. @TheCycoONE if addKeyHandler() can add duplicate key modifier response entries in a key's table, then the call to self:setupGlobalKeyHandlers() for version 63 saved games will add duplicate entries for all the key handlers but maybe having duplicate key handler entries doesn't matter.\n. @TheCycoONE I could modify addKeyHandler() in this pull request to make sure it can't add duplicate key handler responses.\n. @Lego3 I was thinking of LuaDoc conventions when I chose this type of function comment, from now on I will use the LDocGen conventions. With the LDT plugin installed Eclipse can recognize any Lua comment type.\nEclipse has a good DoxyGen plugin with support for Graphviz comment diagrams:\nhttp://mcuoneclipse.com/2012/06/25/5-best-eclipse-plugins-1-eclox-with-doxygen-graphviz-and-mscgen/\n. I could make a regular expression script to make all function comments abide by the LDocGen function comment conventions.\n. I personally think the LDocGen function comment convention should be changed to be the same as the LuaDoc convention I've used here because a) Eclipse makes these multi-line comments blue where as all other Lua comments are green and b) a CorsixTH programmer could start a new comment line by pressing return without having to type: --!\n. @sadger Thanks for posting your fix for this mistake, I will submit a pull request for it.\n. I see this mistake has already been fixed.\n. A patient can leave the research room to go to the created treatment room until the staff member has started their multi_use_object action.\n. ",
    "mounirlamouri": "I had an issue very close to what has been described here but unfortunately, it happened with a doctor I fired so I was not able to kick him out of the room and no one was able to go in. Weirdly, sometimes the doctor had the sign of being in queue above his head. He was not in the room's queue list though.\n. Unfortunately, I do not compile with ffmpeg enabled. I have tried to do a blind fix (let see what travis says) otherwise I will look into doing a build with ffmpeg.\n. Ok, seems like my forward declaration were enough :)\n. Let me update the issue with the commit squashed.\n. There is only one commit now. Ready to be merged I guess.\n. I have updated the commit message. I could also do PR to fix all the trailing whitespaces. Is there any presubmit checks made by Travis? We could probably add that. It could help.\n. I will update that PR and look into Travis to see how I can make this happen.\n. Just updated the PR. The conflict should be fixed. Could you try to merge?\n. I have created a PR for the automated checks in Travis: #238 \n. @mrtnptrs @TheCycoONE could one of you merge this?\n. @TheCycoONE can you have another look? Travis seems to be happy with the change now.\n. I've fixed the usage comments.\n. My pleasure :)\n. ",
    "Grimdoc": "That is true.\n. I think the wiki explains it very well.\nIt doesn't say you can have the H flipped (like in your first pic).\nhttp://code.google.com/p/corsix-th/wiki/MapEdit#Helipads\n- Grimdoc\nOn Fri, Jan 17, 2014 at 9:56 PM, MarkL notifications@github.com wrote:\n\nIt seems to make a difference depending on which way you orientate the \"H\"\n[image: 6]https://f.cloud.github.com/assets/4965487/1944370/38806d02-7fb9-11e3-86c3-9e9f8f3dd4d5.png\nIs this something we can change or should we update the wiki on map making?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/issues/150#issuecomment-32645483\n.\n. It says \"... as in the following image\".\nBut of course even more specific text could be added.\n\nOn Sat, Jan 18, 2014 at 10:02 PM, MarkL notifications@github.com wrote:\n\nIt doesn't say it can't be that way either, I think it gives the\nimpression that so long as you have a 5x5 box with an H in a different\ncoloured tile that it will work and be seen as an heliport. I think it\nshould either mention that the orientation makes a difference or alter the\ngame so that it doesn't.\nI think there should be some mention that it must be accessible from the\nstart of the game (I have seen an issue where if it is not accessible from\nthe start it is never seen as an heliport).\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/issues/150#issuecomment-32693051\n.\n. This is working quite well. I think I invited 8 VIP's and 2 showed up uninvited after a while.\n\nDo you think one should get a warning when declining too many visits, or should one get a warning when the VIP actually turns up?\n. MarkL: Yes, I read those comments.\nBut I just \"aired the idea\" of getting a notification when an uninvited VIP arrives.\nAnd you hit the nail with \"a VIP is about to visit you un-invited, they can do that you know!\".\nBut as you said, this should be dealt with in another pull.\n. Great that you are back programming :)\n. Hi. Thanks for trying to implement this!\nI have tested this a little.\n1. All of my patients were almost maxed on happiness.\n2. Changed the prices to max.\n3. X % of the patients got sad right away.\nIs this how the original TH worked?\nI think the prices didn't affect the happiness before they were to pay for the treatment (and sometimes some of them would refuse paying the bill if the price was too high!).\nI noticed this, using you patch. Might not be relevant, but it shouldn't be possible for a patient to show the \"sad icon\" while he is perfectly happy?\n\n. Unless that icon is misplaced, from the patient to the right.\n. Yes, if I had the patch implemented, and a save, I would.\nBut that observation was just a side note.\n. Ok. Then I assume this is one of the many \"skewed icon\" bugs. This icon probably belongs to the on to the right.\nI forgot about those bugs myself :)\n. mrtnptrs, if you were in the IRC channel you would know.\nLong story short: Git is the devils tool.\n. He is using OpenGL, 64 bit, if the window caption is correct.\nOn Fri, Sep 12, 2014 at 8:43 PM, MarkL notifications@github.com wrote:\n\nSDL, DX or OGL? Which exe or system are you using?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/308#issuecomment-55444069.\n. If I remember right you could place drinking machines in front of the rat\nholes, and this would either just stop the rat from using that hole, or\nremoving the hole.\n\nOn Sun, Oct 19, 2014 at 9:27 PM, MarkL notifications@github.com wrote:\n\nAlso, if I remember correctly, in TH, rat holes don't appear behind\nradiators (or drinking machines) and placing such an object in front of a\nhole was even a way to get rid of it. Can somebody confirm?\nYou are right on the second part, not the first though. I remember picking\nup a radiator or drinks machine to delete rat holes to find that there was\none behind the radiator or drinks machine as well.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/328#issuecomment-59661586.\n. I have seen it too. Maybe before v0.2 too.\n\nOn Wed, Nov 12, 2014 at 2:01 AM, Stephen E. Baker notifications@github.com\nwrote:\n\nI've seen this too, at least as far back as 0.20. Likely errors with\nuninitialized memory but I haven't traced them down.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/379#issuecomment-62653075.\n. Great job!\n\nOn Mon, Mar 23, 2015 at 5:21 PM, William Gatens notifications@github.com\nwrote:\n\nLooks good. +1 on the github integration if you can work it in. Not so\nsure on the severity option as users won't really know how severe their\ncrash is. Maybe just behind the scenes say if it's a crash or something\nelse?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/445#issuecomment-85073993.\n. Suggestion: Make an option to place the entire helipad, so that the user\ndon't have to place all the tiles himself.\nWe have seen maps where the users have been unable to get helicopters\n(because they placed some tiles wrong, or used wrong tiles).\n\nOn Mon, Dec 29, 2014 at 3:57 PM, koanxd notifications@github.com wrote:\n\nI'm planning to do extensive changes to the level editor, primarily adding\nmissing features such as epidemics and the remaining awards and trophies,\nalso fixing some minor issues. Refactoring is badly needed as well.\nSince nobody else is currently working on it, I will do several commits in\na single pull request when I'm finished.\nPlease tell me if there is anything to discuss, or if you have suggestions.\nI have some questions myself: will all the level variables eventually be\nadded into the game? If yes, I might also add them to the editor, but with\na note that they may not be implemented.\nI am especially interested in the disease ratios, which are to be saved in\n'visuals' and 'nonvisuals'. Would the result be the same if every number is\nmultiplied by 10, as it is the same ratio? Just to figure out how it would\nwork.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/586.\n. I saw it, thank for the help.\nBut I thought it didn't matter that my repo was outdated, since the file I added was updated (compared to v0.6).\nBut you have to follow this system very systematically I guess. Will update my repo and add it again sometime.\n. Sure.\n\nWith SVN I actually had control of what I was doing.\nTo be able to use GitHub effectively you have to use it often. But only programmers have the desire/need to use it often. I think this is the biggest barrier for the translators.\n. Sounds ok.\nUnfortunately this means more work for the coders.\n. Is it best to use one permanent issue for all languages, one permanent for each language, or one new issue for each single language update?\n. @Alberth289346 Yes, that is intended.\nRemoved all the superfluous strings in the file (according to debug-strings-diff-norwegian.txt.\n. It should be located in the same folder as config.txt. On windows 7 it is\nlocated in C:\\Users\\AppData\\Roaming\\CorsixTH\nBut if there haven't been any errors, I don't think it is created.\nOn Sun, Jun 19, 2016 at 11:06 AM, Burningfeetman notifications@github.com\nwrote:\n\nHowdy TheCycoONE,\nWhere is the gamelog.txt located? I had a look within the install\ndirectory and under appdata, but couldn't find a gamelog.txt file.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/1094#issuecomment-226987122,\nor mute the thread\nhttps://github.com/notifications/unsubscribe/AFD-v4TwSSMcMzIs_X1tWYnPxI75EZU9ks5qNQaqgaJpZM4I46C_\n.\n. No, I don't think the changes by AdamFx990 is worth rescuing.\nIf I recall right, some of it was even wrong.\n\nThanks for the help :)\nOn Wed, Aug 8, 2018 at 6:27 PM, Alberth289346 notifications@github.com\nwrote:\n\n@Grimdoc https://github.com/Grimdoc\nHi, I just converted your zip above to a commit in #1437\nhttps://github.com/CorsixTH/CorsixTH/pull/1437\nI removed the BOM marker from the start of the file, and deleted all\nwhitespace at the end of the lines.\nNo idea what you actually changed, you moved so many lines around, git\ncan't make head or tails from it. Basically it says \"these 35 pages of text\ngot replaced by those 35 pages\".\nAnyway, above, AdamFx990 tried some other changes as well, but those never\ngot merged. Is there anything worth rescuing in those changes?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/1373#issuecomment-411468205,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AFD-v5f1hcT1XNcrBjebUX1GIbrnwwdxks5uOxF7gaJpZM4TDeq5\n.\n. Sorry for the late reply, haven't been online for a while.\nYes, just add this :+1: . But then again this would make it pretty annoying for everyone else..\n\nIdeally the autosave period could be set manually in the settings, so that\neveryone could have their way.\nOn Thu, Jul 19, 2018 at 3:53 PM, ElvarT notifications@github.com wrote:\n\nHi,\nIs there some relatively easy way of shortening the autosave period?\nWhy I ask: This would make it easier when trying to reproduce a crash and\nto generate a save game just before. If possible I would set it to autosave\nevery 1 or 2 minutes.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/1426, or mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AFD-vzDxJUqoGu_8MvCIht8CZopv0i2Yks5uII9ZgaJpZM4VWcHr\n.\n. \n",
    "benckx": "I think it might be fun to keep the cheat to spawn an infected patient. In Sim City I remember you could trigger catastrophes with codes (or was it in a game menu?). Maybe a code to heal all the currently infected patients would be nice too.\nBy the way, is there already a debug mode or something for testing? That could be interesting to keep all the testing features there.\nFor people who are new to the game, if epidemics don't appear until the 5th or 6th level , it sounds like plenty of time to get familiar with the game and be able to deal with this new problem.\n. What's the current status for this feature? I suppose it's idle?\nTo summarize the conversation above: So far prices have no impact whatsoever. So player can increase all prices up to 200% without any consequence. In my opinion, it provides an unbalanced and undeserved advantage (it's almost a cheat).\nHow it works now:\n- Charges increase as reputation for a given disease is higher (see function Hospital:getTreatmentPrice(disease)).\n- Does patient happiness impact hospital reputation? (in this case I suppose there should be a patient parameter in function Hospital:changeReputation(reason, disease, valueChange) or something)?\nHow it could get improved:\n- Price of a given disease impacts patient happiness when paying the bill, which in turn impacts hospital reputation.\n- Patients sometimes leave without paying if price impact is really high.\n- It's a bit weird that patients pay more than the displayed price when reputation is higher. Maybe they should rather complain if price is high while reputation and/or service quality is low (i.e. if price doesn't \"match\" reputation and/or service quality).\n- I'm not sure patient should have a \"wealth class\", because even rich people don't like spending money. The randomness here should rather happen when we compute the price impact on patient happiness.\n- If insurance covers the bill, there is no price impact on the patient.\n- Diagnostic prices have a similar impact on patient happiness.\n@J-Shep: I'm not sure I understand your second point. Do patients know their decease before being diagnosed? Are they able to choose an hospital based on their decease?\nIf we agree on these changes, I'll maybe implement that one as my next contribution. Before coding anything, do we already have a Wiki page where we could document the changes?\n. I agree with most of your comments, @MarkL1961.\nI suppose higher interest rates are just attended to make the game a bit more challenging, as the price for borrowing money is higher?\nI think I'd implement this based on:\n- Decease price varies between 50% and 200%\n- Decease reputation varies between 0 and 1000\n- I would add a third measure: service quality, which would depend mostly on staff state (happiness, fatigue, skills, etc.) and cure effectiveness when available, ranging from 0 to 100. Is there already something like this in the code we might re-use?\nI would merge decease reputation and service quality into a single measure, something like (decease.reputation / 10 + service_quality()) / 2 that would range from 0 to 100. This average could be weighted (e.g. 40% for reputation and 60% for quality).\nI would map this [0-100] scale on the [50%-200%] price scale. If the delta between the actual price and the expected price is quite big, then the bill would be considered under- or overpriced and the patient would get an happiness bonus or malus. An adviser message would appear accordingly (for that specific decease, not in a generic way as it's been proposed in this pull request).\nFor the reputation impact: if patient is more than 85% happy when he leaves, reputation would go +1. If he's less than 40% happy, reputation would go -1.\nI'm not quite familiar with all the engine variables and behaviour. I propose this from what I've seen in the code and from my player experience. I feel it wouldn't have such a chaotic impact but would still make the game somewhat responsive to pricing. Also, as some levels focus rather on the bank account and some of patient happiness, it makes sense to add this lever.\nExact numbers are indeed subject to changes. They might also depend on difficulty level.\n. I tested on my laptop (which has a large keyboard with numpad). I also tested with an external USB keyboard. Both Belgian azerty keyboards.\n. Thanks for your feedback @J-Shep.\nYour comments are referring to my first commit (https://github.com/benckx/CorsixTH/commit/a30022a6739da7a5f2b00e6ef06e43a714b7935f), but I did two other commits after that to improve naming and clean up debug prints and things like that. Most of your comments had been addressed in these already, expect for switchXRay function and the white spaces because I didn't really pay attention to that.\n. Is that good?\n. Sorry about the final newlines, I had removed them manually, I didn't know this was important.\n. I added two little things, which could have been part of another patch but since they're tightly related to that one, I thought there were some consistency in proposing them in a single one:\n- Make the spawn rate varies with reputation.\n- As the reputation goes really high, it becomes more difficult to gain reputation. It's a bit like in RPG where it's more and more difficult to pass a new level as character has a higher level. It doesn't change a lot while we're still in middle reputation range (you still have more than 80% chance to get the gain under 720). But it's now more difficult to reach the extreme values of the reputation cursor. Implementation is based on this quadratic function:\n\nSo when I re-run the simulations for one year in the same conditions:\nInit\nReputation: 582\nBalance: 44,000\nCured: 131\nAll prices at 50%\nReputation: 732 (+150)\nBalance: -8,000 (-36,000)\nCured: 263 (+132)\nReputation: 728 (+146)\nBalance: -13,000 (-31,000)\nCured: 254 (+123)\nReputation: 729 (+147)\nBalance: -11,000 (-33,000)\nCured: 256 (+125)\nAll prices at 200%\nReputation: 566 (-16)\nBalance: 232,0000 (+188,000)\nCured: 251 (+120)\nReputation: 565 (-17)\nBalance: 232,000 (+188,000)\nCured: 245 (+114)\nReputation: 531 (-51)\nBalance: 197,000 (+153,000)\nCured: 236 (+105)\nWe can now feel a relation between the pricing level, the reputation and the number of patients coming, although this certainly still needs adjustments to reach the optimal settings.\n. No, not yet. But that could be interesting.\n. Here it is, @Lego3. Once in a while, if overpriced, the patient leaves without paying and an Adviser warning is displayed accordingly. I excluded diagnostic payment, as the warning message is \"patient left without paying\". It makes sense as we wouldn't offer the patient further treatment if he doesn't pay for diagnostic.\nI moved the price distortion threshold variables at the hospital object level as I use them from several places now and as it could depend one day on the difficulty level; so I had to increase SAVEGAME_VERSION to 86. I hope it's all right?\nBy the way, I'm not able to display the Adviser message properly. When calling:\nadviser:say(_A.warnings.patient_not_paying:format(casebook.disease.name, amount))\nwith message:\npatient_not_paying = \"A patient left without paying for %s, because it's too expansive! We lost %d $ !\"\nit doesn't display the amount value properly:\n\nCan somebody tell me what's wrong there?\n. When I display only the amount it works, even with the $ sign. The problem arises when there are two place-holders.\nI removed the amount thing, it's not really necessary anyway.\n. I tried with the two variables and without the $ and it didn't work. I tried with one variable and the $ and it worked. I'll check your trick on the occasion though, but I'm still doubtful the amount is necessary.\n. After all, it's kinda weird to warn the player the price is too high and at the same tell him how much he lost, with this price he shouldn't use.\n. Done. I kept the place-holder for disease name though, as you can adjust the price for each individual treatment.\n. Oh I didn't know we could actually call the strings directly from the original files. However, it's better to add the treatment name in this case, as the price can be adjusted individually for each treatment. Otherwise it's confusing for the player, as he doesn't know what treatments are too cheap and what treatments are too expansive (it's also possible that some treatments are be too cheap while other are too expansive).\nNo, I didn't add the mood icon. Is it already provided in the original files as well? I'll have a look into that.\n. I renamed the mood \"sad_money\" as it sounds more descriptive. I double-checked it wasn't used anywhere else, just to be sure.\n\nWhile adding the icon, I've realised that the message \"a patient left without paying\" is actually misleading because a patient can still have to go to other rooms after that. I should probably find a way to do that only when it's the very last bill being paid (or maybe just change the message?).\n. All right then: now the patient goes home directly if he refuses to pay. In that case Adviser message is always displayed (\"A patient left without paying\"). As I use function patient:goHome() for that, the icon is set to \"exit\". If he pays however, he gets the \"sad_money\" icon.\n. Okay I'll do it this way.\n. I extended goHome() as you suggested @TheCycoONE. This commit is a bit more significant, I hope it doesn't break anything. I moved some code from treated() to goHome(), so \"cured\" is consistent with the other \"go home\" reasons.\nRegarding statistics: a patient who leaves without paying could be counted either as \"cured\" or as \"not_cured\", depending if the treatment he refused to pay is the last one (I used attributes[\"health\"] to be able to distinct, which is maybe a bit kludgy).\n. Hi @sadger! Thanks for reaching out. Indeed I've been quite busy with my real developer job for the past few months. However I'd really love to finish this properly and see it included in the project.\nI'll try to have a look at it within the coming weeks.\n. I've been discussing with @sadger for the past few weeks about the best way to finish this properly.\nHe proposed that I create a new branch from his branch so I can work from there, open a new PR and close this one.\nBeside some minor edits, we agreed that the code doesn't need much work. But we still have to test and find the best value for each new parameter in order to find a good balance. Here is a summary of these parameters, with their current values:\nThresholds\n\nUnder-pricing threshold: -0.3\nOver-pricing threshold: 0.3\nFair and well adjusted pricing: [-0.15, 0.15]\n\nFrequencies\nEvery time a patient has to pay and feels like the price is distorted, we must decide how often the patient leaves without paying, how often this changes the reputation and how often the adviser warns the player.\n- Frequency of patient leaving without paying when over-priced: 1/5\n- Frequency of adviser warning (distortion): 1/10\n- Frequency of adviser warning (fair prices): 1/20\n- Frequency of reputation change: 1/5\nWeights\nExpected price level\n\nStaff service quality weight: 0.40\nReputation weight: 0.35\nEffectiveness weight: 0.10\nRandomness weight: 0.15\n\n(I consider dropping the latter as there's already some randomness introduced with the frequencies.)\nStaff service quality\n\nSkill weight: 0.7\nFatigue weight: 0.2\nHappiness weight: 0.1\n\nReputation changes\n\nUnder-priced: +1\nOver-priced: -2\n\nRegarding reputation influence on the spawn rate, I made it linear so there isn't really any declared parameter to adjust, although the effect should maybe get weighted as well.\nSo there're about 15 parameters to adjust, knowing that the thresholds and the frequencies are more impacting than the weights.\nI'll run a few simulations later and provide the results here.\n. I tested with GD and Cardio. The fix works fine for me.\n. I can't reproduce the problem with the Scanner Room (with the trunk master branch). It's like it's fixed already. Maybe I'm missing something...\n. I see. Code looks better this way.\n. For the first problem, I suppose disabling the \"Take a chance\" button when the required equipment is missing would be a sufficient fix?\n. - \"les patients devraient commencer \u00e0 appara\u00eetre\" kind sounds too literal to me. What about \"arriver\" instead of \"appara\u00eetre\"? (even if - admittedly - \"spawn\" literally means \"appara\u00eetre\")\n- \"Vous n'aurez pas de patients jusqu'\u00e0 ce que vous l'aviez fait\" has a grammar mistake. What about \"vous n'aurez pas de patient avant de l'avoir fait\" ?\n- \"Une r\u00e9ceptionniste aura besoin d'un bureau qu'elle peut accueillir les patients\" is wrong. What about \"o\u00f9 elle pourra accueillir\"?\nThe translations sometimes sound too \"word-by-word\". I think it's better to focus on a nicely translated sentence rather than on the literal word-by-word translation. Another example: \"Si vous voulez plus de chercheurs actifs en m\u00eame temps, ils ont besoin chacun d'un bureau\", the sentence is correct but I would rather say \"Si vous voulez que plusieurs chercheurs puissent travailler en m\u00eame temps\".\n. I remember I had spotted a few weird translations. I'll try to review that on the occasion, but for example:\n- \"Vous ne pouvez pas mettre cet objet ici.\" \u2192 \"mettre\" is quite a generic, ugly word. \"Placer\" is better.\n- \"coeur\" \u2192 c\u0153ur\n- \"Diagnose\" is sometimes translated \"ausculter\", but it doesn't really mean the same.\n- \"Placer la pi\u00e8ce \u00e0 cet endroit va emp\u00eacher des parties de l'h\u00f4pital d'\u00eatre atteintes\" sounds really weird.\n- In the tooltip.cheats_window section, I suppose the verbs should be infinitive.\n. Maybe this will help: https://github.com/CorsixTH/CorsixTH/wiki/Localization\n. @TheCycoONE I'd like to do a final review of it, just to be sure we didn't forget something weird. I'll try to do that within the next few days.\n. - I think everything in the tooltip.cheats_window section should be infinitive verbs. It's true that in the English translation, 3rd person is used, but it sounds really \"artificial\" in French.\n- no_games_to_contine should probably be singular (in English as well?)\n- \"les machines de diagnostiques\" \u2192 \"de diagnostic\"\n- \"Placer la pi\u00e8ce \u00e0 cet endroit va emp\u00eacher des parties de l'h\u00f4pital d'\u00eatre atteintes\" sounds really weird. I would propose: \"placer la pi\u00e8ce \u00e0 cet endroit rendrait inaccessibles certaines parties de l'h\u00f4pital\"\n- \"Vous voudrez peut-\u00eatre plusieurs personnes de travailler dans le service? De cette fa\u00e7on, elles ont leur bureau.\" is not correct. I would propose: \"Si vous comptez y faire travailler plusieurs personnes en m\u00eame temps, vous devez leur construire un bureau \u00e0 chacune.\"\n- casebook = \"  (F5) MALETTE  \"  \u2192 \"mallette\" means \"suitcase\" (with double L, by the way). I don't think it's a correct translation but I don't know what other word we could use. \n- \"Une r\u00e9ceptionniste aura besoin d'un bureau o\u00f9 elle pourra accueillir \u2192 what about \"pour accueillir des patients\"?\n- researcher_needs_desk_1 and researcher_needs_desk_2 \u2192 we should use \"chercheur\" instead of \"scientifique\" in every case, for the sake of consistency.\nBy the way, while in English we stick the question mark to the word (like that?), in French we must leave an empty space (comme \u00e7a ?). I found confirmation of this rule on Wikipedia:\nhttps://fr.wikipedia.org/wiki/Point_d'interrogation\nOtherwise that looks more or less okay.\n. Next changes I'm planning to do:\n- SAVEGAME_VERSION flag will have to be updated (the current value is 108, and our checks are at 102).\n- I think it would be nice to be able to shift all prices to 50% or to 200% from the cheat UI or something, so it can be tested more easily. Doing so via the normal UI is bit a tedious.\n- Move the go_home_reasons enum to class level.\nI'd also like to run a few simulations and post the results.\n. - Moved all payments logic out of treated(), so everything is handled consistently within dealtWithPatient().\n- dealtWithPatient() now decides whether patient goes home (either because he's cured, either because he refuses to pay).\n- Handle all statistics in goHome() rather than in treated() for the sake of consistency.\nI think this way the role of each function is a bit more clear.\n. I was considering one last commit:\n- The name Patient:getDiseaseId() bothers me a bit. I was thinking getCasebookId() or something (sometimes it returns \"Invisiblity\", sometimes \"General Practice\").\n- Move Patient:computePriceDistortion() as a local method.\n- Review the documentation.\nOtherwise it looks good to me.\nRegarding the balance I think it's already quite consistent.\n. This is the last commit I wanted to do. In my opinion, after all feedback I got in the previous PR and more recently from @sadger, it's now ready for merging. However I remain open to further suggestions.\n. @sadger Maybe I should have used top-level local functions indeed. My goal was to make them \"private\" for encapsulation purpose.\n@TheCycoONE Thanks for your support with that. We can proceed any way your prefer.\nSo if I understand correctly, the 26 commits need to be regrouped into a smaller number of little features (for example: \"French translation\", \"Cheats\", \"treat() refactoring\", \"dealtWithPatient() integration\")?\nIs there any guideline page somewhere that specifies the commit policy?\n. I used the name casebookId instead of diseaseId as it returns a casebook ref., not always a disease (it can be a disease id if patient is diagnosed, or a diagnostic room id).\nI moved the logic out of hospital to patient because I needed the same logic within patient:\n- To compute the distortion (needs the actual price level of the last treatment)\n- From goHome(), to build the Adviser message in case patient leaves without paying\nThe printed message in the middle of getCasebookId() is not consistent anymore, it should have been removed.\nI hope it clarifies.\n. I don't have anything to add since my last commit. I'll try to remain available in the coming days, in case you need more input from my side.\nIt looked kind of odd to me that the term \"disease\" was used for two different things (diseases and diag rooms). I actually had mentioned it in a comment before committing it and had had a quick word with @sadger on the IRC about it. Anyway I don't have such a complete view of the codebase as you do, so I'd trust your judgement on that.\nI took note of your feedback regarding the documentation, local functions, commit conventions, etc. I'll take that into for my next contributions.\n. This all looks good to me.\n. It returns false when the key code isn't from numpad. I don't know what's the most common way to treat this in Lua. In Java I would probably return null or -1.\nWould nil be a good choice?\nAnyway I'll add documentation for that.\n. Admittedly from where we call it now, it will never happen. But it could still happen one day if someone else re-uses it with a wrong key-code (although it seems unlikely).\nThanks for the input, William.\n. Wouldn't be more consistent to have everything in infinitive?\n. @sadger: Can we drop this variable now? It looks like it's only there for test/log purpose?\n. Haha, no it didn't. I'm just reviewing the code right now.\n. It's a good point. That would be more consistent.\nMaybe Hospital:receiveMoneyForTreatment(patient) should return a boolean, so we know whether the patient paid or not and hence for which reason he's sent home.\nAlso, I'm wondering if statistic handling (hospital.num_cured + 1) shouldn't be managed in one place only (in goHome() only and not in treated() anymore).\n. I see. I'll drop this then.\n. Looks like dealtWithPatient() would be impacted as well (it calls receiveMoneyForTreatment()); so we could also possibly send patients home from there?\nIt's actually quite a big change, I'll have a look at it later and see if we can clarify the workflow and the encapsulation.\n. ",
    "therealgreenpower": "\nScreenshot\n. I confirm this. Sorry for my late response, I don't check my mail often enough. I'll test the changes ASAP.\n. ",
    "tobylane": "A 10x5 research room in the demo level works (researcher sits at desk, takes/kills patients, new room learned, reputation affected).\n. Fixed by #946.\n. I put a (corridor) radiator down then built toilets with the door in the adjacent block. The radiator was on the door side of its block. The room built fine with no warnings. On each patient use I get the following error as soon as he starts towards the toilets. Patients pass fine with any other radiator orientation.\n\nEmpty action queue!\nLast action: walk\nstack traceback:\n    ./Lua/entities/humanoid.lua:546: in upvalue 'Humanoid_startAction'\n    ./Lua/entities/humanoid.lua:672: in local 'timer_function'\n    ./Lua/entity.lua:219: in method 'tick'\n    ./Lua/world.lua:1064: in method 'onTick'\n    ./Lua/app.lua:979: in function <./Lua/app.lua:976>\n    (...tail calls...)\n    ./Lua/app.lua:880: in function <./Lua/app.lua:875>\n. No longer happens, everyone path finds around the solid objects (plants) and through the non-solid (radiators turned to be on one side of the tile rather than the front or back from the person's point of view).\n. This patch is inaccessible and was for the previous Map Editor. On the current Map Editor floors aren't affected by toggling wall transparency.\n. This doesn't happen in the new Map Editor.\n. I can't replicate this with a nurse and pharmacy, doctor and x-ray, doctor and psychiatrist, or patient and toilets. This appears to be fixed for all rooms.\n. Can't recreate this, after confirming it is playing from a folder with the .DS_Store file.\n\nWorth noting, and it is now in the wiki, that homebrew installs SDL2_mixer without smpeg by default, brew install sdl2_mixer --with-smpeg2 is necessary for mp3 playback.\n. This was merged.\n. Midi and MP3 songs start playing from the start of the songs. MP3 continues to play as long as the music lasts and loops around, I just tested an hour long album.\n. The game doesn't now pause/lag while music from a spun down external hard drive is accessed.\n. Cannot replicate this in a operating theatre with over 100 patients operated on.\n. DirectX is gone, and this doesn't happen with SDL (with any combination of lock windows and edge scrolling).\n. The music now loops around, so there is no way to recreate this.\n. This is mostly fixed, if you have a doctor behind a menu then the tooltip of the doctor is used. Clicking on that spot will do the menu action. Same for the edit room scenario.\nIf the intended behaviour is that the GUI part at the top dictates the tooltip then this issue could be narrowed down to that.\n. Fixed. In this save the operating theatre double door is right next to the green double doors with no problem, even when both doors are in use at the same time. http://cl.ly/2O3a1r2H281p\n. Fixed. In this save a patient exits the toilets as a handyman attempts to enter on Feb 5th. The handyman circles around to enter the next day. http://cl.ly/1Y2i2U252Z2c\n. It's now possible to save a game while the jukebox window is open.\n. Still happens. In this autosave from March there's an earthquake on the 8th. http://cl.ly/0m0h212t403f\n. This bug was DirectX only, no such problem with SDL now.\n. The save game is no longer available.\n. Can't replicate in 0.60 beta2\n. Fixed, the awards (and winning fax) can be interacted with while a room is being built. Savegame https://cl.ly/pXwK. The ifs need to be linux, I've changed all other references to mingw, and the OS in the zipname to windows.\nI can commit to that. It is building for OSX 10.9 with Lua 5.1, the newer versions (OSX 10.10, Lua 5.2, Lua 5.3) all work within this script. The only other possible complication I could expect is differences between gcc and clang, which is unlikely and would be widely known.\nLuac and Luarocks are supposed to have version independent paths like linux, they do on my system and on the linux. I added in ln to do that.\nI kept the linux cmake and make in the section they were previously in but I'll switch to symmetry.\n. Sorry for the reopening, an unexpected outcome of rebasing.\nBrought up to date and re-tested.\nLinux can be brought up to lua 5.2 easy, less easy for 5.3 as it's not in the official repos yet. Mac can be brought up to 5.3 easy as it's in homebrew.\n. Changes per requests (moved docs upload to cross platform scripts, fixed whitespace, added the extra upload to commit message).\n. The sshpass commands are unchanged, so I suspect the error is because Travis doesn't decrypt the variable in forks and PRs, but that if statement can be triggered by PRs.\n. Problem a) I am using master branch in my fork, and the travis way of doing things means it is both in master branch and in CorsixTH/CorsixTH despite only being a PR. The same commit, d6866b5, passes in tobylane/CorsixTH, https://travis-ci.org/tobylane/CorsixTH/builds/75924603.\nProblem b) As identified by you and issue #879 this doesn't include dependancies. I believe @darrylblake or @admdly know something helpful.\n. I was expecting what I have done in my fork to include the dependancies but it's not. You're welcome to take over, but if you don't have the time for it and can point out how to do it I can try.\n. Upstream's PR on the matter: https://bugzilla.libsdl.org/show_bug.cgi?id=3127.\n. It's planned, but we don't have people with the skills. We're close (#771), and the current best effort works if you personally install the dependancies (eg with homebrew). With that unideal requirement this will work https://transfer.sh/Z9hhi/cth-20150906-containers-d1bd734a6e-mac.zip\n. I'm not sure why it was set, but I bumped it up because it was the only way I found to build C++ as C14 without also building the ObjC as C14. It works for both of us to not specify a target so it seems redundant.\nI don't get that matching SDK warning, it just falls back to the only one avaliable - 10.11.\n. That works for me, 10.10.5 and Xcode 7.0. It works for Travis on Xocde 6 https://travis-ci.org/tobylane/CorsixTH/jobs/99822377 (expand line 2571 for details).\n. The findlua.cmake doesn't look in the directory (/usr/local/) that homebrew uses. I need to specify the location like cmake . -G Xcode  -DLUA_PROGRAM_PATH=/usr/local/bin/lua5.3 -DLUA_INCLUDE_DIR=/usr/local/include/lua5.3/ -DLUA_LIBRARY=/usr/local/lib/liblua.5.3.dylib\nPlease do make new PRs. We're finding various issues with OSX and that Travis PR doesn't have a solution to the specific problem of including dependancies yet.\n. It works for me locally just as it does on Travis. In terms of malloc being required, it appears to not find it and use alloca instead (https://travis-ci.org/tobylane/CorsixTH/jobs/99822377 line 2834) and works after 963 (https://travis-ci.org/tobylane/CorsixTH/jobs/100076227 same lines don't appear at 2837). Both builds can be opened.\n. Per IRC conversation this has been reduced to the sshpass commit.\n. What's the error that this fixes? I use lua53 and specify luarocks-5.3 to add lfs, lpeg and luasocket.\n. CMake doesn't look in the homebrew directory by itself. Try both of these separately, deleting CMakecache.txt before each.\n1. Add this to your cmake command -DLUA_PROGRAM_PATH=/usr/local/bin/lua5.3 -DLUA_INCLUDE_DIR=/usr/local/include/lua5.3/ -DLUA_LIBRARY=/usr/local/lib/liblua.5.3.dylib\n2. In CMakelists change opt to usr on line 121.\n. That change just adds the newer folders, it will help any platform that uses the filter file. It's not necessary for the OS X app to work.\n. Done.\n. Done.\n. I believe it would have to be a duplicated CorsixTH sub project definition as CMake projects can't be cloned/extended, or the user would run CMake a second time after Xcode.\n. Added a third commit that does the dylib change for AnimViewer. Output https://travis-ci.org/tobylane/CorsixTH/jobs/120023001#L1488\n. Changes per request. Install as a target is already taken and can't be reliably reclaimed so they are named IncludeDylibs and IncludeAnimViewDylibs. They can be chained in a command with the app build like xcodebuild -configuration Release -target CorsixTH -target IncludeDylibs\nedit: Improvements planned.\n. @TheCycoONE: Will do.\n@maki-chan: I started off doing that but found it wasn't necessary. I renamed the share folder in your build, removed my local copy of luafilesystem and the game works fine. We can investigate this further, would you like to use IRC? We're at FreeNode #corsix-th.\n. Redone to be a part of the install process, simplified the lua part.. Clobber and James are both on 10.11, I'm on 10.10, Travis CI is on 10.9. I don't think that should matter. Clobber is on Core Duo, James and I are on i7, Joe on i5.\nhttp://cl.ly/fi0A This build has been made following Cyco's advice. If this works I'll make another beta with this procedure. I can't find the recipes for the homebrew bottles but it's a reasonable assumption that they aren't Core Duo friendly.\n. The deprecated part is an upstream problem. The illegal instruction is probably something that even when I compile locally it is a optimisation that isn't back compatible or safe. I can't identify the right way to be backwards compatible on CPUs, the closest thing I can see is \"Enable Additional Vector Extensions\" which is SSE 4.2 in these builds.\n. Yes, it's -march=core2\n. Thank you, I've made the change. Our wiki can be edited by anyone on Github, feel free to correct anything else you find.\n. Your latest link works for me. The problem I'm stuck on is building the dylibs for an older architecture than I am currently on, e.g. core2 rather than native. Sorry, I don't appear to have documented this before now.\n. Each set of Intel CPU releases (yearly?) is an architecture within x86_64. Xcode lets you pick between native, x64 and x86+x64, but I couldn't work out the non Xcode way (make -march) for lua/etc.\nI built 0.60 with Lua 5.1 on my old iMac, with OS X 10.7.5 and Core 2 Duo (E8135) cpu. I include dylibs and luarocks for all lua versions and the CorsixTH.lua change from 1016. Please try this Archive.zip.\n. Yes, I believe they aren't required, I can't find any difference when they are or aren't included. Here's just the app with the luarocks/share from /usr/local/share/lua/5.1 for testing this theory - CorsixTH.zip\n. Try brew ffmpeg and copy that dylib from /usr/local/Cellar/ffmpeg/3.0.1/lib (number may vary) into the Contents folder to see if a locally made version fixes this.\n. @JohnnyWalkerDesign That is an unrelated error, I've had it in other programs. Just trying it again fixes it for me.. Now when recreating this it changes the language to English. Do we want it to tell the user what they need?. The Traditional Chinese language file hasn't been updated in a while. Are you able to help us update it, by this method set out on the wiki?\nThis line from the language file may be the text that caused a problem. Does it look correct?. Built the staff room, added a radiator and fire extinguisher against the wall then built the pharmacy. I moved the pharmacy away (along the long wall of the staff room), before editing the staff room I think.. You should be able to make what you want, by editing one of the custom maps you've found (e.g. Biggen) with increased staff, expertise, popn in its levels file. I like your plan and would be interested in what you make.. After the cloning is complete, original ideas like this will become more important. It requires coordination of graphics and code. For now there is a forum thread on disease suggestions.\n. The debug menu lets you do unnatural things. Concurrent emergencies or VIP visits create bugs that won't be fixed, but you have a good point about crashes.\nIf you're looking for extra difficulty in a custom level look into increasing earthquakes and epidemics.. I've had this error a few times but couldn't reproduce it. Your savegame doesn't work for me -\n game_ui.lua:698: attempt to index a nil value (field 'multigesturemove'). Do you have another example?. We can remove RequiredResources.txt, these changes make it unused.. Could the three new files go in the CMake folder? \ud83d\udc4d on everything else.. You're $5500 short of the target value. If you put 11 drinks machines (or anything of that value) in the hospital there's a winning fax at the end of the quarter. Winning by the cheat menu works, before making any changes to the hospital.. When there are no functioning rooms in the hospital the loop though self.world.rooms will cause a crash (It doesn't get this far if there haven't been any rooms built). In testing this I made it print the name of each room looked at and the numbers in the ratio calculation, it was the whole hospital minus two crashed rooms.. Thanks. I don't remember how I caused the problem (bad argument #1 to 'for iterator' (table expected, got nil)) needing that check but all the test savegames run fine now.. I messed up my testing. This is already fixed.. lua\nlangs[#langs + 1] = {text = lang, font = font, tooltip = _S.tooltip.options_window.language_dropdown_item:format(lang, eng_name)}\nThat would look like this. I don't get that tooltip, not even with a new config.txt or without my changes.. The third comment removes a persistable function. I haven't done this before, is there something extra in removing them, or is that only for functions in a savegame?. I've removed the other commit and rebased. Ready now.. Can you try some older releases? Are there any relevant messages in the event viewer?. The file is run-corsix-th-dev.sh.in with a dash in corsix-th.. This is set to \"/Contents/MacOS/CorsixTH.lua\" which is correct relative to the app folder, but the working directory of an app is $home.. TIL, corrected.. It would, reverted back to an earlier version of the loop.. ",
    "craigbarnes": "The .md extension is required for GitHub to recognize it and process it into HTML, yes. No worries if you think it's a bad idea. I just thought I'd suggest it in case it seemed useful.\n. There are a few tools available to convert Markdown to HTML. I guess if releases are done as tar/zip archives, it could be shipped as HTML. I would suggest a way to do it automatically via the build system, but I don't know a whole lot about CMake.\n. ",
    "Piratmac": "OK, thanks for the tip :)\n. ",
    "pwaller": "Full stack trace\n```\nTHLinkList::getDrawingLayer (this=0xffffffffffffffff)\n    at /home/pwaller/.local/src/CorsixTH/CorsixTH/Src/th.h:37\n37      int getDrawingLayer() {return m_drawingLayer;}\n(gdb) bt full\n0  THLinkList::getDrawingLayer (this=0xffffffffffffffff)\nat /home/pwaller/.local/src/CorsixTH/CorsixTH/Src/th.h:37\n\nNo locals.\n1  0x000000000045fd9e in THMap::draw (this=0x418f8400, pCanvas=0x40050220,\niScreenX=705, iScreenY=390, iWidth=75, iHeight=76, iCanvasX=1726, \niCanvasY=246)\nat /home/pwaller/.local/src/CorsixTH/CorsixTH/Src/th_map.cpp:892\n    bTileNeedsRedraw = false\n    bNeedsRedraw = false\n    iBlock = 0\n    pItem = 0xffffffffffffffff\n    iH = 3519882330\n    bRedrawAnimations = true\n    itrNode = {m_pNode = 0x51dda48, m_pNodeFirst = 0x51e29a8, \n      m_pNodeEnd = 0x51db298, m_iNodeStep = -127, m_iXStep = 64, \n      m_iXs = 1789, m_iYs = 240, m_takenSteps = 2}\n    bPreviousTileNeedsRedraw = false\n    itrNode2 = {static ms_iMarginTop = 150, static ms_iMarginLeft = 110, \n      static ms_iMarginRight = 110, static ms_iMarginBottom = 150, \n      m_pNode = 0x51dda48, m_pMap = 0x418f8400, m_iXs = 63, m_iYs = -6, \n      m_iScreenX = 705, m_iScreenY = 390, m_iScreenWidth = 75, \n      m_iScreenHeight = 76, m_iBaseX = 0, m_iBaseY = 24, m_iX = 24, \n      m_iY = 0, m_iScanlineCount = 3, m_eDirection = ScanlineForward}\n\n---Type  to continue, or q  to quit---\n        rcClip = { = {x = 1726, y = 246, w = 75, \n            h = 76}, }\n        bFirst = false\n        formerIterator = {m_pNode = 0x51db248, m_pNodeFirst = 0x40a404e0, \n          m_pNodeEnd = 0x51db248, m_iNodeStep = -127, m_iXStep = 64, \n          m_iXs = 1821, m_iYs = 224, m_takenSteps = 6}\n2  0x0000000000431d4c in l_map_draw (L=0x41580428)\nat /home/pwaller/.local/src/CorsixTH/CorsixTH/Src/th_lua_map.cpp:768\n    pMap = 0x418f8400\n    pCanvas = 0x40050220\n\n3  0x00007ffff7651a9b in ?? ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\nNo symbol table info available.\n4  0x0000000000467e1f in l_mainloop (L=0x40000378)\nat /home/pwaller/.local/src/CorsixTH/CorsixTH/Src/sdl_core.cpp:287\n    do_frame = true\n    do_timer = true\n    dispatcher = 0x41580428\n    fps_control = 0x40047a30\n    timer = 1\n    e = {type = 32768, common = {type = 32768, timestamp = 12318}, \n      window = {type = 32768, timestamp = 12318, windowID = 72260224, \n        event = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000',\n\n---Type  to continue, or q  to quit---\n            padding3 = 0 '\\000', data1 = 0, data2 = 0}, key = {type = 32768, \n            timestamp = 12318, windowID = 72260224, state = 0 '\\000', \n            repeat = 0 '\\000', padding2 = 0 '\\000', padding3 = 0 '\\000', \n            keysym = {scancode = SDL_SCANCODE_UNKNOWN, sym = 0, mod = 12288, \n              unused = 0}}, edit = {type = 32768, timestamp = 12318, \n            windowID = 72260224, \n            text = '\\000' , \"\\060\\000\\000\\000\\000\\000\\000\\275\\264\\340\\364\\377\\177\\000\\000\\242\\357\\334T\", start = 0, length = -138829803}, \n          text = {type = 32768, timestamp = 12318, windowID = 72260224, \n            text = '\\000' , \"\\060\\000\\000\\000\\000\\000\\000\\275\\264\\340\\364\\377\\177\\000\\000\\242\\357\\334T\"}, motion = {type = 32768, \n            timestamp = 12318, windowID = 72260224, which = 0, state = 0, \n            x = 0, y = 12288, xrel = 0, yrel = -186600259}, button = {\n            type = 32768, timestamp = 12318, windowID = 72260224, which = 0, \n            button = 0 '\\000', state = 0 '\\000', clicks = 0 '\\000', \n            padding1 = 0 '\\000', x = 0, y = 12288}, wheel = {type = 32768, \n            timestamp = 12318, windowID = 72260224, which = 0, x = 0, y = 0}, \n          jaxis = {type = 32768, timestamp = 12318, which = 72260224, \n            axis = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000', \n            padding3 = 0 '\\000', value = 0, padding4 = 0}, jball = {\n            type = 32768, timestamp = 12318, which = 72260224, \n            ball = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000', \n            padding3 = 0 '\\000', xrel = 0, yrel = 0}, jhat = {type = 32768, \n---Type  to continue, or q  to quit---\n            timestamp = 12318, which = 72260224, hat = 0 '\\000', \n            value = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000'}, \n          jbutton = {type = 32768, timestamp = 12318, which = 72260224, \n            button = 0 '\\000', state = 0 '\\000', padding1 = 0 '\\000', \n            padding2 = 0 '\\000'}, jdevice = {type = 32768, timestamp = 12318, \n            which = 72260224}, caxis = {type = 32768, timestamp = 12318, \n            which = 72260224, axis = 0 '\\000', padding1 = 0 '\\000', \n            padding2 = 0 '\\000', padding3 = 0 '\\000', value = 0, \n            padding4 = 0}, cbutton = {type = 32768, timestamp = 12318, \n            which = 72260224, button = 0 '\\000', state = 0 '\\000', \n            padding1 = 0 '\\000', padding2 = 0 '\\000'}, cdevice = {\n            type = 32768, timestamp = 12318, which = 72260224}, quit = {\n            type = 32768, timestamp = 12318}, user = {type = 32768, \n            timestamp = 12318, windowID = 72260224, code = 0, data1 = 0x0, \n            data2 = 0x3000}, syswm = {type = 32768, timestamp = 12318, \n            msg = 0x44e9a80}, tfinger = {type = 32768, timestamp = 12318, \n            touchId = 72260224, fingerId = 0, x = 1.72191555e-41, y = 0, \n            dx = -1.42424354e+32, dy = 4.59163468e-41, \n            pressure = 7.59130541e+12}, mgesture = {type = 32768, \n            timestamp = 12318, touchId = 72260224, dTheta = 0, dDist = 0, \n            x = 1.72191555e-41, y = 0, numFingers = 46269, padding = 62688}, \n          dgesture = {type = 32768, timestamp = 12318, touchId = 72260224, \n            gestureId = 0, numFingers = 12288, error = 0, x = -1.42424354e+32, \n---Type  to continue, or q  to quit---\n            y = 4.59163468e-41}, drop = {type = 32768, timestamp = 12318, \n            file = 0x44e9a80 \"\\001\"}, \n          padding = \"\\000\\200\\000\\000\\036\\060\\000\\000\\200\\232N\\004\", '\\000' , \"\\060\\000\\000\\000\\000\\000\\000\\275\\264\\340\\364\\377\\177\\000\\000\\242\\357\\334T\\000\\000\\000\\000\\025\\240\\271\\367\\377\\177\\000\"}\n        n = 0\n5  0x00007ffff7651a9b in ?? ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\nNo symbol table info available.\n6  0x00000000004776c5 in CorsixTH_lua_main (L=0x40000378)\nat /home/pwaller/.local/src/CorsixTH/CorsixTH/Src/main.cpp:188\n\nNo locals.\n7  0x00007ffff7651a9b in ?? ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\nNo symbol table info available.\n8  0x00007ffff7694d00 in lua_pcall ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\nNo symbol table info available.\n9  0x00000000004270da in main (argc=1, argv=0x7fffffffde28)\nat /home/pwaller/.local/src/CorsixTH/CorsixTH/SrcUnshared/main.cpp:85\n    L = 0x40000378\n    stkCleanup = {\n      c = {<std::_Deque_base<void (*)(), std::allocator<void (*)()> >> = {\n\n---Type  to continue, or q  to quit---\n              _M_impl = {> = {<__gnu_cxx::new_allocator> = {}, }, _M_map = 0x2, \n                _M_map_size = 140737488346352, _M_start = {_M_cur = 0x6a1d30, \n                  _M_first = 0x426ea2 <__cxx_global_var_init()+50>, \n                  _M_last = 0x1, _M_node = 0xf50c16c8}, _M_finish = {\n                  _M_cur = 0x7fffffffdd00, \n                  _M_first = 0x426eb9 <_GLOBAL__I_a+9>, _M_last = 0x3, \n                  _M_node = 0x47921d <__libc_csu_init+77>}}}, }}\n        bRun = true\n```\n. I'm slowly working at fixing this bug.\nMore details: it is very easy to reproduce reliably, the main way I've observed it seems to be that the patient walks off of the top right side of the diamond. It doesn't happen if they walk of the bottom right, for example. But I haven't tested many levels, but given that I found it immediately when I was looking for it it seems like it's probably fairly frequent.\nI've got a fix which prevents the crash, but I'm not sure it solves the underlying cause. The fix which prevents the crash just checks for pItem = 0xffffffffffffffff and skips the loop.\n. Yeah, I couldn't figure out where that value came from, which is one of the reasons I was worried about it. The draw code takes some reading to make sense of. I could do with chatting to someone about it on IRC I think.\n. I believe I've hit this running master c09f5a0. It's not reproducible easily.\nIt occurred after going to the save menu with the mouse, and whilst the save dialog is open the map scrolled up until the game crashed. I took a screenshot from the moment of the crash, and I observe that it is not possible with a fresh load of the game to scroll up as far as the view captured in the screenshot (even with some trying).\nI managed to capture this stack trace.\n```\n0  0x0000000000436956 in THLinkList::getDrawingLayer (this=0xff929e71ff8e9675)\nat /home/pwaller/th/CorsixTH/Src/th.h:37\n\nNo locals.\n1  0x0000000000443864 in THMap::draw (this=0x406f8778, pCanvas=0x400212d8,\niScreenX=-505, iScreenY=340, iWidth=1182, iHeight=664, iCanvasX=0, \niCanvasY=0) at /home/pwaller/th/CorsixTH/Src/th_map.cpp:892\n    bTileNeedsRedraw = false\n    bNeedsRedraw = false\n    iBlock = 0\n    pItem = 0xff929e71ff8e9675\n    iH = 0\n    bRedrawAnimations = true\n    itrNode = {m_pNode = 0x8b50c48, m_pNodeFirst = 0x8b7fe58, \n      m_pNodeEnd = 0x8b4e498, m_iNodeStep = -127, m_iXStep = 64, \n      m_iXs = 1145, m_iYs = -20, m_takenSteps = 19}\n    bPreviousTileNeedsRedraw = false\n    itrNode2 = {static ms_iMarginTop = 150, static ms_iMarginLeft = 110, \n      static ms_iMarginRight = 110, static ms_iMarginBottom = 150, \n      m_pNode = 0x8b50c48, m_pMap = 0x406f8778, m_iXs = 1145, m_iYs = -20, \n      m_iScreenX = -505, m_iScreenY = 340, m_iScreenWidth = 1182, \n      m_iScreenHeight = 664, m_iBaseX = 0, m_iBaseY = 20, m_iX = 20, \n      m_iY = 0, m_iScanlineCount = 20, m_eDirection = ScanlineForward}\n    rcClip = {<SDL_Rect> = {x = 0, y = 0, w = 1182, \n        h = 664}, <No data fields>}\n    bFirst = false\n    formerIterator = {m_pNode = 0x8b4e448, m_pNodeFirst = 0x40080000, \n      m_pNodeEnd = 0x8b4e448, m_iNodeStep = -127, m_iXStep = 64, \n      m_iXs = 1177, m_iYs = -36, m_takenSteps = 20}\n\n2  0x0000000000471284 in l_map_draw (L=0x41517898)\nat /home/pwaller/th/CorsixTH/Src/th_lua_map.cpp:769\n    pMap = 0x406f8778\n    pCanvas = 0x400212d8\n\n3  0x00007ffff7651a9b in ?? ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\nNo symbol table info available.\n4  0x000000000042e6db in l_mainloop (L=0x40000378)\nat /home/pwaller/th/CorsixTH/Src/sdl_core.cpp:286\n    do_frame = true\n    do_timer = true\n    fps_control = 0x40047b08\n    timer = 1\n    e = {type = 32768, common = {type = 32768, timestamp = 5632356}, \n      window = {type = 32768, timestamp = 5632356, windowID = 0, \n        event = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000', \n        padding3 = 0 '\\000', data1 = 5632326, data2 = 0}, key = {\n        type = 32768, timestamp = 5632356, windowID = 0, state = 0 '\\000', \n        repeat = 0 '\\000', padding2 = 0 '\\000', padding3 = 0 '\\000', \n        keysym = {scancode = 5632326, sym = 0, mod = 45997, \n          unused = 32767}}, edit = {type = 32768, timestamp = 5632356, \n        windowID = 0, \n        text = \"\\000\\000\\000\\000F\\361U\\000\\000\\000\\000\\000\\255\\263\\340\\364\\377\\177\\000\\000\\024D\\315T\\000\\000\\000\\000\\025\\240\\271\", <incomplete sequence \\367>, start = 32767, length = 5764}, text = {type = 32768, timestamp = 5632356, \n        windowID = 0, \n        text = \"\\000\\000\\000\\000F\\361U\\000\\000\\000\\000\\000\\255\\263\\340\\364\\377\\177\\000\\000\\024D\\315T\\000\\000\\000\\000\\025\\240\\271\", <incomplete sequence \\367>}, motion = {type = 32768, timestamp = 5632356, windowID = 0, which = 0, \n        state = 5632326, x = 0, y = -186600531, xrel = 32767, \n        yrel = 1422738452}, button = {type = 32768, timestamp = 5632356, \n        windowID = 0, which = 0, button = 70 'F', state = 241 '\\361', \n        clicks = 85 'U', padding1 = 0 '\\000', x = 0, y = -186600531}, \n      wheel = {type = 32768, timestamp = 5632356, windowID = 0, which = 0, \n        x = 5632326, y = 0}, jaxis = {type = 32768, timestamp = 5632356, \n        which = 0, axis = 0 '\\000', padding1 = 0 '\\000', \n        padding2 = 0 '\\000', padding3 = 0 '\\000', value = -3770, \n        padding4 = 85}, jball = {type = 32768, timestamp = 5632356, \n        which = 0, ball = 0 '\\000', padding1 = 0 '\\000', \n        padding2 = 0 '\\000', padding3 = 0 '\\000', xrel = -3770, \n        yrel = 85}, jhat = {type = 32768, timestamp = 5632356, which = 0, \n        hat = 0 '\\000', value = 0 '\\000', padding1 = 0 '\\000', \n        padding2 = 0 '\\000'}, jbutton = {type = 32768, \n        timestamp = 5632356, which = 0, button = 0 '\\000', \n        state = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000'}, \n      jdevice = {type = 32768, timestamp = 5632356, which = 0}, caxis = {\n        type = 32768, timestamp = 5632356, which = 0, axis = 0 '\\000', \n        padding1 = 0 '\\000', padding2 = 0 '\\000', padding3 = 0 '\\000', \n        value = -3770, padding4 = 85}, cbutton = {type = 32768, \n        timestamp = 5632356, which = 0, button = 0 '\\000', \n        state = 0 '\\000', padding1 = 0 '\\000', padding2 = 0 '\\000'}, \n      cdevice = {type = 32768, timestamp = 5632356, which = 0}, quit = {\n        type = 32768, timestamp = 5632356}, user = {type = 32768, \n        timestamp = 5632356, windowID = 0, code = 0, data1 = 0x55f146, \n        data2 = 0x7ffff4e0b3ad <__GI___clock_gettime+29>}, syswm = {\n        type = 32768, timestamp = 5632356, msg = 0x0}, tfinger = {\n        type = 32768, timestamp = 5632356, touchId = 0, \n        fingerId = 5632326, x = -1.42421723e+32, y = 4.59163468e-41, \n        dx = 7.05288366e+12, dy = 0, pressure = -7.52985756e+33}, \n      mgesture = {type = 32768, timestamp = 5632356, touchId = 0, \n        dTheta = 7.89256977e-39, dDist = 0, x = -1.42421723e+32, \n        y = 4.59163468e-41, numFingers = 17428, padding = 21709}, \n      dgesture = {type = 32768, timestamp = 5632356, touchId = 0, \n        gestureId = 5632326, numFingers = 4108366765, \n        error = 4.59163468e-41, x = 7.05288366e+12, y = 0}, drop = {\n        type = 32768, timestamp = 5632356, file = 0x0}, \n      padding = \"\\000\\200\\000\\000d\\361U\\000\\000\\000\\000\\000\\000\\000\\000\\000F\\361U\\000\\000\\000\\000\\000\\255\\263\\340\\364\\377\\177\\000\\000\\024D\\315T\\000\\000\\000\\000\\025\\240\\271\\367\\377\\177\\000\\000\\204\\026\\000\\000\\000\\000\\000\"}\n    dispatcher = 0x41517898\n    n = 4373264\n\n5  0x00007ffff7651a9b in ?? ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\nNo symbol table info available.\n6  0x000000000045219f in CorsixTH_lua_main (L=0x40000378)\nat /home/pwaller/th/CorsixTH/Src/main.cpp:192\n\nNo locals.\n7  0x00007ffff7651a9b in ?? ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\nNo symbol table info available.\n8  0x00007ffff7694d00 in lua_pcall ()\nfrom /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2\nNo symbol table info available.\n9  0x000000000042bd5a in main (argc=1, argv=0x7fffffffe028)\nat /home/pwaller/th/CorsixTH/SrcUnshared/main.cpp:85\n    L = 0x40000378\n    stkCleanup = {\n      c = {<std::_Deque_base<void (*)(), std::allocator<void (*)()> >> = {\n          _M_impl = {<std::allocator<void (*)()>> = {<__gnu_cxx::new_allocator<void (*)()>> = {<No data fields>}, <No data fields>}, \n            _M_map = 0x7fffffffdeb0, _M_map_size = 4639604, _M_start = {\n              _M_cur = 0x6a8a48, _M_first = 0x46e13a\n <std::map<int, int, std::less<int>, std::allocator<std::pair<int const, int> > >::~map()>, _M_last = 0x6a8a48, \n              _M_node = 0x7ffff4d3e3c9 <__cxa_atexit+25>}, _M_finish = {\n              _M_cur = 0x2, _M_first = 0x7fffffffdef0, _M_last = 0x6a7d30, \n              _M_node = 0x46c7a4 <__static_initialization_and_destruction_0(int, int)+59>}}}, <No data fields>}}\n    bRun = true\n\n```\n. I just hit this on master (Ubuntu 14.04 x64).\n. I've hit it too. Linux Ubuntu 14.04 x64 d61335421a5c0a9e3121c868e033d5f33279296b.\n. PR #632 fixes the problem for me, at the expense of making the objects being built the wrong size.\n. I've cracked it, and I've got a branch which doesn't seem to exhibit this bug! Please take a look at #687 :grinning:\n. Is this #370? If so, I've made a pull request with a potential fix for this here: https://github.com/CorsixTH/CorsixTH/pull/687\n. Done @TheCycoONE \n. FWIW, the error I get is now:\nUnable to take screenshot (pWindowSurface == NULL): No hardware accelerated renderers available\n. Could we merge this even if it doesn't do the ideal thing? It seems switching to RenderReadPixels is a bigger task that deserves its own issue/pull request.\nI don't have time to take a crack at this any time soon and it's cluttering my pull request queue :(\n. @TheCycoONE I'm a bit disappointed there, since I did my duty and hunted down and plugged the crash after playing the game and being bitten by it. Bear in mind it crashed when I was trying to save the game(!) after playing for some time, so I experienced unhappy data loss. I don't see why you don't see the value, but I respect your choice.\nMoved to issue #739.\n. So my attempt at fixing this doesn't solve the bug I was complaining about (graphics cease updating after some minutes of gameplay).\nHowever, disabling the clipping entirely does fix the bug!\n. @jorgenpt so we have to solve this mystery, why doesn't #629 fix the problem, but disabling clipping entirely does?\n. I've made the change whilst from my mobile connection through the github UI, so I haven't even tested if it compiles, but I think it's straightforward enough. PTAL @jorgenpt \n. Great to see it fixed! Good work @Andy51\n. @sadger, you said it doesn't work for you on #370, let's bring that conversation over here.\nThis change doesn't actually fix all cases. Does the patch improve things for you even a little bit? Under what circumstances do you hit the zoom issue?\nThe main remaining problem that I'm aware of is when employing staff, the screen still goes blank, presumably due to some analogous code for them which I haven't commented out yet.\n. Interesting.\n. Do the sounds continue to function, or does everything freeze?\nI strongly suspect this is fixed by #656 - for me, the game freezes if #656 is not applied, and it does not freeze with it.\n. Ah, apologies @MarkL1961.\n. @MarkL1961 you should be aware, the game appears to crash when the clipping is broken.\n. I apologise if I seemed like I came out of nowhere. I was trying to be helpful - specifically went to the effort of searching the bug tracker for crashes which seemed like they might be related to the clip bug and I went to the trouble of testing this particular savegame and it froze/didn't freeze with the patch. Without the settings on French. I accept though that this may not look like this crash with the knowledge that the clip bug was new. Sorry for the noise!\n. Ubuntu 14.04, x64. Clang 3.5.\nOn 1 February 2015 14:46:14 GMT+00:00, Andy51 notifications@github.com wrote:\n\n@pwaller on what OS did you do the research?\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/CorsixTH/CorsixTH/issues/654#issuecomment-72367418\n\n\nSent from my Android device with K-9 Mail. Please excuse my brevity.\n. Only once, so far. I'm happy to close this for now and reopen it if it happens again.\n. I just tried this branch on a case where I could easily reproduce the game freeze, and this fixes it!\n. I think this may be related to or the same as #370 and #616.\n. I don't know. I figured it out and then called it a day pretty quickly.\nI observe that a lifted doctor seems to look (perception-wise) pixel perfect when you drop him. It's just the red square where I notice any difference.\n. ",
    "Glimmer-Man": "I tried to find a reason. But it's very hard to catch the one moment. Handyman is not a source of problem.\nI found this:\nIt happens in situation when more patients try to \"register\" to queue at same time. They go in front of door and after that they try to sit down, and they go in front of door again, and again try to sit down.\nI think there is connection with benches. Or with registering to the queue, when more patients tries it too.\n. I can kick this patient out from hospital or - if diagnosis is not set, I can send patient directly to cure. I din't find any other way.\nI can confirm, that I never saw standing patient with no queue.\n. Yes, it's a duplicate... sorry. I have not noticed.\nNew facts:\nRemoving his bench is not a solution, patient will be standing alone, after he gets a drink...\n. Tested on #388, and it works in ideal moment to build new room = no patients around and no fresh vomit on target place.\nBut when I try to build a room on vomit, which cannot be cleaned and other patient will place a new vomit in that area I try to build that room on, game will crush or stuck.\nAnyway, if I wait for the right moment, it's a working solution to #388 . :+1: \n. @TheCycoONE \nYes, same problem is in 0.30 . Just tried.\n. @TheCycoONE \nmy config.txt\n----------------------------------------- CorsixTH configuration file -------------------------------------------\n-- Lines starting with two dashes (like this one) are ignored.\n-- Text settings should have their values between double square braces, e.g.\n--  setting = [[value]]\n-- Number settings should not have anything around their value,\n-- e.g. setting = 42\n--------------------------------------------  SETTINGS MENU ---------------------------------------------\n-- These settings can also be changed from within the game from the settings menu\n-- Screen size. Must be at least 640x480. Larger sizes will require better\n-- hardware in order to maintain a playable framerate. The fullscreen setting\n-- can be true or false, and the game will run windowed if not fullscreen.\nfullscreen = true\nwidth = 1680\nheight = 1048\n\n-- Language to use for ingame text. Between the square braces should be one of:\n--  Chinese (simplified)  / zh(s) / chi(s)\n--  Chinese (traditional) / zh(s) / chi(s)\n--  Danish                / da / dk\n--  Dutch                 / Nederlands / nl / dut / nld\n--  English               / en / eng\n--  Finnish               / Suomi / fi / fin\n--  French                / fr / fre / fra\n--  German                / de / ger / deu\n--  Italian               / it / ita\n--  Norwegian             / nb / nob\n--  Portuguese            / pt / por\n--  Russian               / ru / rus\n--  Spanish               / es / spa\n--  Swedish               / sv / swe\nlanguage = [[\u010ce\u0161tina]]\n\n-- Audio global on/off switch.\n-- Note that audio will also be disabled if CorsixTH was compiled without the\n-- SDL_mixer library.\naudio = true\n--------------------------------------------- CUSTOM GAME MENU ----------------------------------------------\n-- These settings can also be changed from the opening menu screen in the custom games menu\n-- Free Build or Sandbox mode\n-- You cannot win or lose custom made maps if this is set to true.\n-- You also don't have to worry about money.\n-- This setting does not apply to any of the campaign maps.\nfree_build_mode = false\n----------------------------------------------- OPTIONS MENU ---------------------------------------------------\n--These settings can also be changed from within the game from the options menu\n-- Sounds: By default enabled and set at level 0.5\nplay_sounds = true\nsound_volume = 0.5\n\n-- Announcements: By default set at level 0.5\nplay_announcements = true\nannouncement_volume = 0.5\n\n-- Background music: By default enabled and set at level 0.5\nplay_music = false\nmusic_volume = 0.5\n\n-- Edge scrolling: By default enabled (prevent_edge_scrolling = false).\nprevent_edge_scrolling = false\n\n-- Adviser on/off: If you set this to true the adviser will no longer\n-- pop up.\nadviser_disabled = false\n\n-- Scrolling Momentum.\n-- Determines the amount of momentum when scrolling the map with the mouse.\n-- This should be a value between 0 and 1 where 0 is no momentum\nscrolling_momentum = 0.8\n\n-- Top menu clock is by default is always on\n-- setting to true will give you a twentyfour hours display\n-- change to false if you want AM / PM time displayed.\ntwentyfour_hour_clock = true\n\n-- Automatically check for updates.\n-- If set to true, CorsixTH will automatically check for and alert you to newer\n-- versions on startup.\ncheck_for_updates = true\n\n-- Warmth Colors display settings.\n-- This specifies which display method is set for warmth colours by default.\n-- Possible values: 1 (Red), 2 (Blue Green Red) and 3 (Yellow Orange Red).\nwarmth_colors_display_default = 1\n--------------------------------------------- CUSTOMISE SETTINGS --------------------------------------------\n-- These settings can also be changed from the Customise Menu\n\n-- Wage increase request settings.\n-- If set to true when wage increase requests expire automatically grant them\n-- otherwise let the staff member quit.\ngrant_wage_increase = false\n\n-- Movie global on/off switch.\n-- Note that movies will also be disabled if CorsixTH was compiled without the\n-- FFMPEG library.\nmovies = true\n-- Intro movie: By default enabled\nplay_intro = true\n\n-- Allow user actions while game is paused\n-- In Theme Hospital the player would only be allowed to use the top menu if\n-- the game was paused. That is the default setting in CorsixTH too, but by\n-- setting this to true everything is allowed while the game is paused.\nallow_user_actions_while_paused = true\n\n-- VOLUME CONTROL IS OPENING THE DRUG CASEBOOK?\n-- If your keyboard volume control opens the Drug Casebook at the same time\n-- then change this to true.  From then on you will have to use Shift + C to open\n-- the Casebook and volume down will not open it.\n-- For example for shift + C to open casebook change the setting below to = true\nvolume_opens_casebook = false\n\n-- To allow patients with Alien DNA to visit your hospital other than by an emergency change\n-- the settings below.  Understand that there are no animations for sitting down, opening\n-- or knocking on doors etc.\n-- So, like with Theme Hospital to do these things they will appear to change to normal\n-- looking and then change back.\nalien_dna_only_by_emergency = true\nalien_dna_must_stand = true\nalien_dna_can_knock_on_doors = false\n-- To allow female patients with fractured bones, which are by default disabled due to poor\n-- animation that skips and jumps a bit\ndisable_fractured_bones_females = true\n\n-- By default the player selects any extra objects they want for each room they build.\n-- If you would like the game to remember what you usually add, then change this option to true.\nenable_avg_contents = true\n----------------------------------------------- FOLDER SETTINGS ----------------------------------------------\n-- These settings can also be changed from the Folders Menu\n\n-- Theme hospital install folder: original game data files are loaded from this\n-- folder. Between the square braces should be the folder which contains the\n-- original HOSPITAL.EXE and/or HOSP95.EXE file. This can point to a copy of\n-- the Theme Hospital demo, though a full install of the original game is\n-- preferred.\ntheme_hospital_install = [[X:\\Hry\\Theme Hospital]]\n\n-- Font file setting. Can be changed from main game menu\n-- Specify a font file here if you wish to play the game in a language not\n-- present in the original game. Examples include Russian, Chinese and Polish.\nunicode_font = nil -- [[X:\\ThemeHospital\\font.ttc]]\n\n-- Savegames. By default, the \"Saves\" directory alongside this config file will\n-- be used for storing saved games in. Should this not be suitable, then\n-- uncomment the following line, and point it to a directory which exists and\n-- is more suitable.\nsavegames = nil -- [[X:\\ThemeHospital\\Saves]]\n\n-- Screenshots. By default, the \"Screenshots\" directory alongside this config\n-- file will be used for saving screenshots. Should this not be suitable, then\n-- uncomment the following line, and point it to a directory which exists and\n-- is more suitable.\nscreenshots = nil -- [[X:\\ThemeHospital\\Screenshots]]\n\n-- High quality (MP3 rather than MIDI) audio replacements.\n-- If you want to listen to high quality MP3 audio rather than the original XMI\n-- (MIDI) audio, then follow these steps:\n--  1) Find MP3 versions of the original tracks (for example the remixes by ZR\n--     from http://www.a-base.dds.nl/temp/ThemeHospital_ZRRemix.zip ) or any\n--     other music you want to listen to.\n--  2) Ensure that SMPEG.dll (or equivalent for your platform) is present.\n--  3) Uncomment the next line and point it to where the mp3s are.\n--  4) If you want to change the names of songs ingame, make a file called\n--     \"names.txt\" and write the file name on one row, followed by the desired\n--     ingame name on the next row.\naudio_mp3 = nil -- [[X:\\ThemeHospital\\Music]]\n----------------------------------------------- SPECIAL SETTINGS ----------------------------------------------\n-- These settings can only be changed here\n-- Audio playback settings.\n-- These can be commented out to use the default values from the game binary.\n-- Note: On some platforms, these settings may not effect MIDI playback - only\n-- sound effects and MP3 audio. If you are experiencing poor audio playback,\n-- then try doubling the buffer size.\naudio_frequency = 22050\naudio_channels = 2\naudio_buffer_size = 2048\n\n-- Debug settings.\n-- If set to true more detailed information will be printed in the terminal\n-- and a debug menu will be visible.\ndebug = false\n-- If set to true, the FPS, Lua memory usage, and entity count will be shown\n-- in the dynamic information bar. Note that setting this to true also turns\n-- off the FPS limiter, causing much higher CPU utilisation, but resulting in\n-- more useful FPS values, as they are not artificially capped.\ntrack_fps = false\n\n-- Zoom Speed: By default this is set at 80\n-- Any number value between 10 and 1000, 10 is very slow and 1000 is very fast!\nzoom_speed = 80\n\n-- Scroll Speed: By default this is set at level 2\n-- Any number value between 1 and 10, 1 is very slow and 10 is fast!\n-- Press shift when you are scrolling and it will be a lot quicker\nscroll_speed = 2\n------------------------------------------------ CAMPAIGN MENU -----------------------------------------------\n-- By default your computer log in will be your name in the game.  You can change it in the\n-- campaign menu or between the brace brackets below [[YOUR NAME]].\n-- Note: space is limited in the game, so don't enter a name that is too long!\n-- If you have specified any other locations for things like saves, music or screenshots you will find these below.  If\n-- you change your mind and wish to go back to the default folders, just delete the relevant line.\n-- If you wish to go back to the default settings for everything, you can delete this text file and it will be re-created\n-- you play the game.\nplayer_name = [[Pavel]]\n. @TheCycoONE \nTested, now it's OK. Great.\n. Same problem in 0.40 beta 3 in a new game.\n. @MarkL1961 No Mark, this vomits are fixed and no handyman is trying to clean them.\n\nHere you see. Handymen are standing, because there is no work to do (empty hospital), but you can see many vomits on floor.\nFact is: there are near enter to the hospital which I call \"vomiting place\". Maybe so much layers makes that crash.\nBTW: trick with placing new room will be good, but it's not solution of this problem.\n. What good is on that function? I see none... Another unnecessary \"button\". It brings no real improvement for a game. Waste of time, I think...\nI like Theme Hospital. I found CorsixTH - 0.20 and I was happy. But it wasn't playable. Much errors. 0.40 is much better, but it's not optimal. Almost playable I would say.\nSo, it will be much better to make it playable without boring stucks, errors or unexpected behaviors.\nAnd after that it will be better to make game more chalenging. \nFew ideas:\n- make harder to get money... machines are very cheap and incomes are \"dream\". It needs short time to be a millionare.\n- patient who die still pay... it makes no sence. How about I must pay compensation?\n- new diseases, new machines ... (hardest - needs a new graphic)\n- patient with more diseases... I cure bloaty head and he's still not cured completely\n- hard diagnosed patient\n- more chalenging emergency\n- random number of patients which will come, now I set the number and increase or decrease number per month. No surprise with that. Certainty is not good.\n. @lbakyl \nAnd I believe that my english is good enough for someone to understand... :-)\nBut I wrote just an opinion. And I tried to bring some new ideas. And I believe that idea is everything. It doesn't matter how it's written. \nP.S.: M\u016f\u017eeme to probrat i \u010desky.\n. I think it could be same as #385.\n. \nAnother one...\n. 0.40 beta3\nIt's a common bug, but it's not crashing the game. If you pick that doctor and drop him to staff room or else, it will be OK.\n. It's very weird, but I have noticed that this comes after I removed any room. I played almost 3 hours and nothing... but after I removed two rooms and build them again in different place, then I found 3 or 4 rooms (different type and different parcel) with this bug.\nMaybe this will help, maybe it's coincidence.\n. I'm 100% sure, that reason is removing another room. I'll tested it - just click on \"?\" icon and and then with scissors click on some room... Now I see doctors in other rooms changeing their dress (surgeons) and staying in that room. \n. Old save, new patients. Two years played in hospital time.\n. Yes, there are lot of benches.\nDynamic menu is same as before: \"waiting for ....\"\nHere is save game: \nhttps://drive.google.com/file/d/0B22eJ2vI7RgLZUU0My02N3lRZUE/view?usp=sharing\n. I will try to get some save just before this stuck. Please wait...\n. I got it:\nhttps://drive.google.com/file/d/0B22eJ2vI7RgLckQyclI1MDVuXzA/view?usp=sharing\nPatient: in center of screen, brown hat, heading for GP's Office on right side. Just wait few second...\n. I've made a short test and it seems OK. Good job! \n. Yes, I had this issue. Patient with king complex stuck in psychiatry, when he changes dress.\nIt started after I rebuild \"psychiatry block\" (more rooms at same parcel, smaller benches area), but happennig long time after, not immediately after rebuild.\nI don't have any other clue.\n. I have find some clue:\nLook at this screen:\n\nRoom (1.) has zero patients expected (2.), but marked patient (3.) is going to that room.\nSo problem is, that patient si not set as expected, and that causes doctor is not called.\nIf save at this moment helps, here it is.\nhttps://drive.google.com/file/d/0B22eJ2vI7RgLSmhuZHgwMHFaV00/view?usp=sharing\n. @MarkL1961 I tried it too (edit staff room) and everything is fine.\nBut I'll try a new game.\n. New game makes no difference - still patients dying or leaving angry beacause they waiting alone for room very, very long time.\nThe mystery is that expected zero even if patient heading to that room. There must be a situation, which is not running expected() function...\nAnd as well there must be a situation which is not running unexpected() function for #444 \n. Yes, I know, but it's not good solution. \n. Look on this save - doctor is trying to get out of room, and there are two patients expected, but no one is coming and nearest toilets are empty.\nhttps://drive.google.com/file/d/0B22eJ2vI7RgLT3h5aHQwQlFRUlk/view?usp=sharing\nAll autosaves are here:\nhttps://drive.google.com/file/d/0B22eJ2vI7RgLNG1MNDNwMGJQaGM/view?usp=sharing\nMaybe it will help.\n. ... and if you remove that doctor, other one cannot enter. He will be waiting for a long time in front of door.\n. Small tested and updating: I can confirm, that this is not relic from old save game.\n. Update 2: Tested in a new game. Problem remains.\n\nMaybe it's connected with message about \"patient has empty action queue\". When I kick him, he's not subtracted. But I have no proof.\n. New clue: I think it's happening when there are lot of patients waiting for all GP's Office (for example) and walking from one room to another trying to reach better position in queue.\nEDIT: I have noticed, that this group of patients (which walk from one room to another) is not in target room in expected number. It's about 20 - 30 patient and that room has expected only 1 or 2 patients.\n. My clue: this will happen when there are more patients trying to get on toilet then number of toilets in the room.\nNext clue: ...maybe it's connected with pateints which will pee outside while they are in toilet queue.\nI've made my own game change, so I'm playing with random number of spawn patients (1, 1500). So there are moments, when I have 1000 - 1300 patients in hospital, and moments when almost nobody is there.\nAnd this issue happens only when big crowd is everyvere...\nVersion: 0.40\n. New final (I hope) clue:\nExample: 5 patients arrive to toilet and they makes queue outside of door. If the first one pee on floor, it's OK, nothing happen. But if second one (or other after) pee on the floor, it makes him try to find another toilet room. And that's the source of problem because he will spend rest of his life finding toilet room (if I will not kick him out from hospital).\nFact 1) \nIt's happenig only when there is a long queue.\nFact 2)\nPatient with toilet paper above his head when he's entering toilet room will not do that. So It must be connected with peeing on the floor.\nI hope that my clue it The One. :-)\n. No difference. It will be just one vomit same as the normal one.\nThe points is in not making layers.\n. 1.\nIn emergency setting - option semi-random - there is issue about two emergency in one month. Look at #422. So it will be great, that wouldn'n be possile to set result <31 days.\n1. Population number - when I set 0 to \"change per month\" in last row, I still see \"patients count will increase infinitely after month\", I must add and remove row if I want that disappeared.\n2. Option to disable earthquakes.\n. @Lego3 Yes, right. \nI don't remember original, but why should I care about original? :-)\n. If you are using pull request #381, then read my post there.\n. ",
    "rallymoose": "just a tip... take a look at: https://github.com/bkaradzic/bgfx#what-is-it \nor maybe https://github.com/Olivier-Boudeville/OSDL-Heavy\nmight help?\n. I shall see if i maybe can improve a bit of this later, but here is the general idea...\nFirst, find out desktop resolution and set borderless if they are the same:\n```\nSDL_DisplayMode current\nint displaynr = 0\nint topleft = 0\nint topright = 0\nint should_be_zero = SDL_GetCurrentDisplayMode(displaynr, &current);\nif (should_be_zero == 0 && current.w == m_iWidth && current.h == m_iHeight)\n(\nuse SDL_WINDOW_BORDERLESS flag to set borderless window or use:\nSDL_SetWindowBordered(m_pWindow, SDL_FALSE)\n)\nend if\n```\nSecond, move window to the top left of the display\nif (should_be_zero == 0)\n(\n   SDL_SetWindowPosition (m_pWindow, topleft, topright)\n)\nYou might wonder why i am using variables for windowpos and monitor number...\n```\nIts because that maybe there could be an option to put the window on second monitor (later)\n```\nAnd why move the window?\n```\nWell thats because on my dual monitor system, when going from fullscreen to windowed,\nthe window places itself in the middle of my screens (half on monitor one, and half on monitor 2)\n```\nHope this could be somewhat helpful...\nBtw, syntaxes for IF's are written from memory, but they should be okay.\nA place to put it (those two) might be between line 209 and 210 (if i haven't misread that).\nSetting a comment sign apparently equals bold text... nice.\n. ",
    "jarreboum": "Wouldn't /usr/share/corsix-th and /usr/local/share/corsix-th be more for corsix-th specific files, whereas /usr/share/games/corsix-th and /usr/local/share/games/corsix-th would keep HOSP? ie files that would tend to be installed and updated be in /share/ and static original data in /share/games/ .\nAt least it seems to be common practice among the various source ports out there to separate it that way. But you're right, all four paths should be included as default. \nI would also name the directory /usr/local/share/games/themehospital or a similar generic name as opposed to [...]/corsix-th. These files really are data from Theme Hospital, they are not exclusive to Corsix-TH. Even though Corsix-TH is the only relevant port of Theme Hospital, it may not be in the future and HOSP is shared data. And in the future, we may not even need HOSP at all.\n. ",
    "mattmill30": "V0.30\nOn 16 Jan 2014 06:09, \"Maarten Peters\" notifications@github.com wrote:\n\nWhich version of CorsixTH do you use?\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/issues/146#issuecomment-32444681\n.\n. \n",
    "McSlurryHole": "link to savefile and gamelog.\nhttps://drive.google.com/folderview?id=0B0HUYrWk9OBjbE43M3BZT1ZuQnM&usp=sharing\nscreencap of console \n\n. rectified.\n. ",
    "petrpulc": "Hi,\nI was trying to reproduce it for several days (damn this game was and is\ncatchy) but was unable to. So sadly, no more information to provide. But I\nassume it can be connected with my data folder, as it have been copied\nmultiple times across multiple users and is also partially localized.\nYet there are lot of details to fix (image ordering on a z-axis) and I will\nfocus on that, trying to help a tiny bit... But after finishing my thesis :P\nPetr\n2014-02-02 Maarten Peters notifications@github.com:\n\nCan you reproduce this issue? What exactly were you doing when this\nhappened? I think a new Mac packager should look at this? As Darrell has no\nMac anymore (only VM).\n\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/issues/151#issuecomment-33901570\n.\n. Sorry, with reinstall of OSX, my CorsixTH setup is gone as well. However I am sure it was 0.30 without modifications. I had to finish my thesis :/\nHowever I will try 0.40 in next week if the z-axis problem is gone :)\n. \n",
    "admdly": "Personally, I believe this should be closed unless it can be reproduced as of 0.40. If anyone is suffering a similar issue with 0.40 on OS X, please update this and I'll gladly look into the issue.\n. As all sounds seem to be working fine as of 0.40, I can only assume this issue is resolved.\n. My bad, I thought this existing issue was only about a delete button. Is anyone currently working on this? I won't have any time myself to look into it for the next 10 days or so, but after that if nobody else is working on this I wouldn't mind taking this on as a way to jump into the code. \n. FYI:\nAfter following: https://github.com/CorsixTH/CorsixTH/wiki/How-To-Compile\nand taking MANY reasonable steps to resolve issues, I've yet to create a distributable binary myself. Granted, I can make a CorsixTH.app that works on my system ONLY.\n. The instructions on the wiki do permit building a copy for your own machine, but there are some steps missing and it goes the long way about it. Personally, I'd edit it to be much simpler by using something like brew to install the libraries rather than having to install each one by hand and compile custom packages. If that's something you'd be interested in my doing let me know and I'll give it a go. \nOne question: are the prerequisite libraries at the top of the wiki page up to date and are the versions correct?\nI have some time later today to look into this and I think I know what the issue is. I'll follow up once I have fixed the issue. \n. I have resolved this issue (tested on a fresh install and works) but my solution is messy at this time. It involves copying over the libraries and remapping the executables and libraries to look in the new location. I'm going to clean this up and create a script to do this and integrate it into the Xcode build process. Hopefully this will be complete later today.\nI'm not sure how it was done for the 0.30 release, but that doesn't seem to bundle any libraries. The size of the app has increased a bit, mainly due to bundling of the libraries but also due to there being more code as it's a newer release. I hope that this won't be a problem and I'll look into further compressing the end product.\nAs for SDL; should I be compiling against this now or is that requirement for a later release?\nI see what you mean about the wiki, when I get some time after the above issues are resolved I'll start a new page with the build process for OS X and link to it from the current page.\n. I have built a working CorsixTH.app which can be downloaded here. It should work on any machine (OS X 10.7+ / 64bit) and I have tested it on a fresh install and all looks good. Let me know if you have any issues.\nHowever, the whole build process is a mess requiring a lot of manual intervention at this time. I'm tempted to dive into the cmake files to get this fixed up for OS X to automate the build better, and I will likely look into this shortly. I can only assume the 0.30 version statically linked the libraries to avoid the dynamic library linking hell.\nIf you'd like me to generate a fixed 0.40 beta 3 release, let me know. MapEdit is not working at this time, which could be down to my using of a newer version of WxWidgets, but I'm looking into this now.\n. I didn't statically link the libraries, I compiled as is and then copied the libraries into the app package  and used install_name_tool to update the references to the libraries so it looks inside the application package. This was complicated by the fact the libraries reference other libraries and also need updating and having their dependencies copying in. \nHowever, I can see a simpler way of doing this and I am writing a script to do this automatically and more reliably. \n. I can now build the game itself reliably and have a script that can fix the dependencies automatically. However, MapEdit and AnimView crash on running (even after the libraries are fixed). I suspect this could be down to my using WxWidgets 3.x rather then 2.x but unfortunately the 2.x release won't build on OS X 10.10. \nI'll have to look into this further before an entire package can be built for release. \n. @2bethere that will only fix the issue on your own machine. If you compile with the brew installed libraries then the resulting app is not redistributeable as it will be looking for the libraries in /usr/local/lib and most users won't have those installed. Copying the libraries into the app and updating the install names fixes most issues, but unfortunately the libraries also need updating as they refer to each other. \nThat said, I have resolved those issues and can now build a redistributable CorsixTH app using my build scripts. My only issues remain with MapEdit and AnimView due to some issues with WxWidgets, which I'm going to look at today. \n. @JamesWP I agree it 'feels' hacky, but unfortunately it is common issue with dynamic libraries on OS X. Statically compiling them in would solve the issue and there may be a way to do some of the fixes with cmake, that I haven't looked into. \nThe methods I'm using for the dylib fixes are from the OS X dev guide and using tools that come with OS X. It's a commonly documented problem and I seem to be using the same method that most are to fix it. \nNow is there a better way to do it? Probably, hopefully. I may dive into it when I find more time or someone else with more time and experience could come along and provide a better solution. To be quite honest I hope they do as the Mac build process is a mess and I'd rather create a build for Linux than deal with this. \n. I'm done with this for now as I have a rather busy schedule coming up and I won't have any time to work on it for a while. I can build a redistributable CorsixTH without any issue in an automated way and I am more than happy to create releases including JUST CorsixTH until I get more time to look into this or someone else comes along with a better solution.\nHowever, I haven't gotten around to fixing the issues fully with WxWidgets to make AnimView or MapEdit redistributable so I can't provide those. The issue with MapEdit is also deeper than just a build/release issue as this crashes even on my own machine with all libraries installed (I noted this in #411 and will follow up with that specific issue there).\n. @JamesWP with all due respect, I'd appreciate a less expectant tone. This is an open source project we're all working on as a hobby. I am not comfortable with the quality of the code to commit it (not that I could, as I don't have that permission on this project). Once I have script that builds a full release and has been polished and checked, I'll submit it in a pull request should the project leaders want it.\nYou're more than welcome to spend the time to solve the issues and create your own script also. Perhaps your solution will be better than mine.\n. Nothing negative intended. It's not a matter of time, it's a matter of I'm not comfortable with the quality of the code yet to put it out there. To be quite honest, I'm likely going to just move on to Linux builds as it's a better use of my time. And no hard feelings indeed. :-)\n. My build of 0.40-rc1 is available from here.\nI won't have much time to work on this over the next week or so, but once I find some free time I will look into the other issues and also into modifying the CMake files as a better solution to the problem. In the mean time I'm more than happy to keep generating CorsixTH only (no MapEdit or AnimView) releases if anyone is interested.\n. @TheCycoONE Feel free to use it however you like. Mac apps are usually distributed as dmg files though, if you like I can create a 'proper' release for you to use. \n. @TheCycoONE that's fine. I can keep generating releases no problem. Do you have a way to stay in contact so I can be notified prior to a release to generate it ready for the announcement. \n. I believe I have now found the proper way of doing this using CMake (sadly it is MUCH easier than the solution I created, I guess I overlooked the simplest solution). If I was to update the CMake files to fix this, should I just create a pull request?\n. I've submitted #420 to fix this issue, however it does NOT fix the issues with AnimView/MapEdit crashing on OS X due to some issue with WxWidgets. I will need to look into that and will follow up in #411 when I have more information.\nWith these changes all the apps build fine, and CorsixTH is now distributable. It may be wise to update documentation/release notes that this now requires OS X 10.7+ and a 64bit system (not really an issue as all modern Macs are 64bit).\n. AnimView is fixed by using a static version of WxWidgets when building. The compiling guide will need updating to reflect this as cmake by default picks up and links the dynamic libraries if installed. The resulting apps when using the dynamic libraries is NOT redistributable as issues with the WxWidgets libraries causes a crash.\nThis means that both AnimView and CorsixTH can now be built and released for future releases. The issue with MapEdit remains.\n. I'm pleased to say that all OS X build issues have been resolved. Once #420 is merged it will be possible to build OS X redistributable apps for release with ALL applications working.\n. This same issue occurs with version 0.40 rc1 on OS X 10.10 and 10.9. It is unrelated to the Mac build issues referenced in #409.\nError dump can be found here\n. A quick update on this:\nThe windows for this are created/drawn fine, the crash occurs several seconds after drawing the windows (loading the embedded game?). Perhaps someone with more experience could look into what would be making the LuaJIT panic at this stage?\n. I will compile a version of LuaJIT with debugging if that will help. While I don't have access to a Mac right now I wonder if this could be down to the 64bit issue with LuaJIT as the fix for this appears to have only been applied to CorsixTH. \n. @TheCycoONE Applying the fix for LuaJIT on OS X 64bit to the MapEdit cmake file has fixed this. I have included it in the #420 pull request as it was a build issue on OS X. With this all OS X related build issues are now resolved and all applications can be built and redistributed.\n. I updated this to remove the libc++ requirement as this was breaking building with a static version of WxWidgets on OS X. Currently the only way to build a working AnimView (and MapEdit - though that has another unrelated issue) is to use a static version of WxWidgets, and indeed this is the recommended way to use it.\n. I have now applied the fix for MapEdit to resolve #411. This was caused by missing linker flags for LuaJIT on 64bit OS X. The change basically copies over the Lua find package code from the CorsixTH CMakeLists.txt into the MapEdit CMakeLists.txt replacing the old Lua find package code.\n. @TheCycoONE No problem, I've done that now.\n. In my personal opinion maintaining a copy of this in the CorsixTH repository is unnecessary and increases the workload on the maintainers. I would like to see this be treat as just another external dependancy which would allow builders to update to newer versions faster and also due to the aforementioned issues.\n. @TheCycoONE While I haven't looked into it deeply, are LPEG and LFS not available via the luarocks package manager? It would seem they are from my homebrew installed version of luarocks.\n. I understand the problem here but I don't think this should be changed without it being a switchable option. Shouldn't scrolling stop once you leave the window? That's how I understand it should work and how other apps work. \nPerhaps it could do this while the app has focus only? Otherwise there is going to be a lot of unintended scrolling going on which could get quite annoying. \n. @MarkL1961 is there any particular reason why #213 was not merged? It seems like pause on lose focus would be a useful option to have. Is it simply a matter of rebasing the code around the current master and resubmitting a pull request or was it rejected on other grounds?\nI agree that the issues around crashing at the map edge and scrolling continuing after loading a saved game should also be corrected if this is implemented. \n. I've created a pull request (#434) which removes the outdated check and advice.\n. I have rebased this branch around new master and recommited the changes.\n. Yeah, I noticed that once I'd already done the rebasing. Noted for the future. :-)\n. I agree with what you've said. I need to look at this again as it is build issue. I could perhaps create a script to set the version for OS X before building. Though it isn't to hard to set the version manually in Xcode either. \nI'm sure a more logical and automated solution can be achieved. \n. I'm closing this as a build issue, with the hope that I/someone finds a way to unify specifying the build versions across platforms.\n. @J-Shep Curious, you mention this is only supported on Windows & Linux. Is there any particular reason why OS X is not supported? I'd be happy to help get this up and running with OS X as well. \n. @J-Shep It seems the debugger is available via luarocks on OS X. I'll install it and do some testing after the Christmas period. Once I have some more information I'll post back here with my findings.\n. I'm not sure why an IRC client should be included in the game. I just can't see it being something many will use or there being much utility in it for most people. \n. @J-Shep I'm still unsure about this personally. What you're suggesting can be achieved by running the game in windowed mode and running an IRC client, which is dedicated to the task and has much more functionality. I don't really know of any other games which include an IRC client and it really does seem like overkill to me.\n. To be honest I don't see why it should be nessecary for the app itself to 'read' inside a DMG. Opening the DMG automounts it and it should suffice to point the app to the mounted drive.\nWhile I don't have a DMG copy of the original game to check with, it should work. If it doesn't then it's just a matter of fixing the directory searching algorithm. \n. Actually, quick update. To make the process smoother we could add code to mount the DMG before looking inside it. That would make the process more seemless and require very little new code. \n. Does anyone have a GOG or DMG version of the game available to test a solution for this with? I personally have an original CD of the game, so I've never bothered with GOG.\n. This issue is fixed as of 0.40 as far as I am aware. It should probably be closed. \n. I'm unsure how these imported issues should be handled/responded to, but this does not appear to be an issue in the current version (0.40) and thus should probably be closed. \n. Potentially unrelated, but I can see an issue with the distribution of LevelEdit as 'first-party' app given it requires Java. I know it has been suggested that at some point LevelEdit will ship with the standard distribution, but as this will require Java on the users' machine I can't see this being viable (and certainly not something I'd be interested in for OS X).\nI'd much prefer to see this be coded in a way which does not require something like Java (nothing against the original developer, as someone who also 'has' to use Java). I just can't, personally, justify pulling in Java as a requirement for a standard build of CorsixTH.\nThat said, I also don't use Lua on a daily basis either. This project is my entry to Lua per se. However, it does not require any third party frameworks on the user's computer.\nUsually, I'd be interested in porting the LevelEdit app to be more cross platform (Python or C++/Lua) but I'm extremely busy at the moment, so I'm not complaining. My overall comment is that I can't see justifying requiring Java just for LevelEdit for a standard distribution of CorsixTH (and it is not something I will ever, personally, support with OS X builds).\n. @J-Shep No offence intended, but as a fellow 'idea flitterer', would it not be a good idea to complete your existing proposals before starting new ones? :-/\n. Nice to see things moving along on this front; the multiple executables never made much sense imho. I'll be glad to see this merged and naturally support this.\n. I'll have a look at this later this evening. I had previously planned to arrange removal myself but hadn't gotten around to it. \n. Apologies for the delay, I have been extremely busy and will be for a little while longer. My understanding is the file can be removed, but I have not checked that it builds correctly without the file as of yet. Due to the large amount of changes to dependencies I am not even sure if the build completes at all at this point for the Mac.\nI hope to look into this as soon as possible to see what, if anything, is broken and if the file can be safely removed. I will report back once tested.\n. I've quickly checked this and this file can be safely removed. There is a host of other CMake issues and an issue preventing a build, but these are not related in any way to SDL.\nI'll keep looking into these as time allows and create PRs to correct these issues where appropriate.\n. ",
    "tonihele": "I have Kubuntu 15.04. I installed all the ffmeg-dev packages, and still I get:\nCMake Error at /usr/share/cmake-3.0/Modules/FindPackageHandleStandardArgs.cmake:136 (message):\n  Could NOT find FFmpeg (missing: AVFORMAT_LIBRARIES AVFORMAT_INCLUDE_DIRS\n  SWSCALE_LIBRARIES SWSCALE_INCLUDE_DIRS)\nCall Stack (most recent call first):\n  /usr/share/cmake-3.0/Modules/FindPackageHandleStandardArgs.cmake:343 (_FPHSA_FAILURE_MESSAGE)\n  CMake/FindFFmpeg.cmake:89 (find_package_handle_standard_args)\n  CorsixTH/CMakeLists.txt:136 (FIND_PACKAGE)\n. I assume the libswscale-ffmpeg-dev is the package that is referred by the error. Package manager has this to say about its directories:\n/usr/include/x86_64-linux-gnu/libswscale/swscale.h\n/usr/include/x86_64-linux-gnu/libswscale/version.h\n/usr/lib/x86_64-linux-gnu/libswscale-ffmpeg.a\n/usr/lib/x86_64-linux-gnu/libswscale-ffmpeg.so\n/usr/lib/x86_64-linux-gnu/libswscale.a\n/usr/lib/x86_64-linux-gnu/libswscale.so\n/usr/lib/x86_64-linux-gnu/pkgconfig/libswscale-ffmpeg.pc\n/usr/lib/x86_64-linux-gnu/pkgconfig/libswscale.pc\n/usr/share/doc/libswscale-ffmpeg-dev/changelog.Debian.gz\n/usr/share/doc/libswscale-ffmpeg-dev/copyright\n. I'm unable to determine where this cmake logs these. I found some logs. But I was not able to say where is tells the needed info. Could you point me in right direction?\n. Yeah, I'm glad the same cheat works in your reimplementation :) Quite a tough level. It's not the reception desk that is causing it.\nI can try to play it in Windows as well. As well as try disabling the music & sounds. @TheCycoONE suspected LUA as the cause.\n. I'll try when I get home. To contact them, you/we need to file a issue to the launchpad. I have credentials somewhere at least, so ultimately I can be a middle man:\nhttps://bugs.launchpad.net/getdeb.net/\n. I removed the luajit, added reception desk. Still segfaults. The window says indeed that opengl,Lua 5.1, 64-bit. Could it be the LUA version?\n. I do seem to have Lua 5.2 installed as well, but CorsixTH doesn't use it apparently. I don't know how these get linked. Just FYI.\n. I can try. I think I still have it configured in KDevelop. Not sure if it points to Google code, shouldn't be too hard to change it. But help I need most likely, I'm a JAVA developer, it has been 10 years since I last touched C stuff.\n. Ok, I compiled it. Master version. I was unable to switch to 0.5 release. The window still said that  opengl,Lua 5.1, 64-bit. I do have LUA 5.2 dev installed. So I don't know what this is going to prove, but, IT WORKS :)\n. I already went ahead, the impatient man I am....\nhttps://bugs.launchpad.net/getdeb.net/+bug/1494587\n. Sadly it didn't solve the problem. The GetDeb version reads LUA 5.2, but it still crashes. So it is not LUA. It is something else in that build.\n. Hmm, no difference :(  Except I have liblua5.1.so.0 and the GetDeb now has 5.2.\n. Yes. I have few commits over the tagged release. Ill try to identify what\nfixed it then\nOn 30 Sep 2015 23:04, \"Stephen E. Baker\" notifications@github.com wrote:\n\nWell now I'm running out of ideas. I guess you are not using the exact\nsame code version, so you could git checkout v0.50 to verify.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/893#issuecomment-144523982.\n. No news. I haven't had the time to test it. Ill try to test it in December\n(this year :) ).\n. Happens with 0.6 GetDeb version & Kubuntu 16.04... :(\n. \n",
    "SimplyRyan": "I think its conflicting as I re-ordered the entire file as it was getting a\nlittle messy.  Feel free to roll this in, I will review it later for the\nmissing strings.\nOn 20 March 2014 15:47, MarkL notifications@github.com wrote:\n\nI think the polish file has had an update recently, so perhaps this\nconflicts with the above changes. If it is that, then simplyryan will need\nto include that recent change - I think it was only one line anyway, so not\na big change to do.\n\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/pull/158#issuecomment-38183593\n.\n. Perfect, thanks Mark.\n\nOn 20 March 2014 15:54, MarkL notifications@github.com wrote:\n\nThe change was in issue #192https://github.com/CorsixTH/CorsixTH/pull/192and was only new_game = \"Zacznij gr\u0119 od samego pocz\u0105tku\u200f\", So it will be\nsimple enough for you to add this again if that line gets lost when this is\nmerged\n\u2014\nReply to this email directly or view it on GitHubhttps://github.com/CorsixTH/CorsixTH/pull/158#issuecomment-38184526\n.\n. I will close this out and submit a new pull request this week as I'm currently updating translations at the moment.\n. The standard so far has been to keep it under Encoding(). \n. Working on getting out Transifex.com site up to speed, this will allow alerts to go out when new strings are added. Workflow should be ready sometime after 0.40.\n. On my honeymoon at the moment, will take a look at this when I get back. Creating a workflow and adding administrators to transifex is on my todo list.\n. Hello, I just started to get back into the swing of things actually, had a busy year (moved house, got married etc.). Will get moving on things in the coming weeks. Had a few people contact me via the forums, helped where possible and pointed them in the right direction so that's encouraging on the translation front.\n\nAnd a final note, @bobcanthelpyou its important to note we can't host the full core languages online due to copyright issues (then obviously Transifex would be a doddle! ). \n. Taken from our transifex site. \nCredit:\nRoflJOE for Danish.\niltrof for Russian.\nlmfsilva for Portuguese.\n. Added Chinese (traditional) overwrite_install translation (thanks fak-e). Corrected two blank lines.\n. This has been added #698\n. @TheCycoONE this can be closed as #698 resolved this.\n. I can't speak for the file in question but if you could play CorsixTH without this modification and report any issues then we can make the required fixes (Its also worth noting that the original game had this bug and CorsixTH simply doesn't replicate the issue.). We already correct a few text issues with the orignal game by using overrides in the French lanauge file, you can see these here - https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/languages/french.lua\n. #666 &  #682 look to be the same issue.\n. I suggest you re copy the files from the CD or digital release, if you found the files online then I would say try and obtain a legit copy that you can be sure isn't corrupt. \n. #666 &  #682 look to be the same issue.\n. Do you have any error reports or a save game? If so please provide them here so we can look into the issue further.\n. Thanks for the feedback, while the game didn't crash you should see some text on the window that opens with the game e.g. like this issue #682\n. Apologies for my previous comment I read the issue as the window had frozen and the game hung. Sorry about that.\n. Good idea! I shall add that now.\n. Happy to merge this @TheCycoONE ?\n. Adding the text to the issue to preserve it and allow searching for similar problems across all issues.\nCreated game with savegame version 91.\nSavegame version is 91 (0.40), originally it was 91 (0.40)\nWarning: Trying to remove nonexistant room build callback (function: 0x0e64edc8) from humanoid (table: 0x0e72a010).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0c184b08) from humanoid (table: 0x0e72a010).\nSavegame version is 91 (0.40), originally it was 91 (0.40)\nWarning: Trying to remove nonexistant room build callback (function: 0x102cc080) from humanoid (table: 0x0d2833e0).\nWarning: Trying to remove nonexistant room remove callback (function: 0x102cc0e8) from humanoid (table: 0x0d2833e0).\nWarning: Trying to remove nonexistant room build callback (function: 0x101fb0a8) from humanoid (table: 0x0d28a100).\nWarning: Trying to remove nonexistant room remove callback (function: 0x10463718) from humanoid (table: 0x0d28a100).\nWarning: Trying to remove nonexistant room build callback (function: 0x0c6b0388) from humanoid (table: 0x0d28b3c0).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0ddbe968) from humanoid (table: 0x0d28b3c0).\nWarning: Trying to remove nonexistant room build callback (function: 0x06aafbb0) from humanoid (table: 0x10445678).\nWarning: Trying to remove nonexistant room remove callback (function: 0x06ab8ec0) from humanoid (table: 0x10445678).\nWarning: Trying to remove nonexistant room build callback (function: 0x079edba0) from humanoid (table: 0x102e6e88).\nWarning: Trying to remove nonexistant room remove callback (function: 0x102e4900) from humanoid (table: 0x102e6e88).\nWarning: Trying to remove nonexistant room build callback (function: 0x06ac5ff0) from humanoid (table: 0x0dc9f7d0).\nWarning: Trying to remove nonexistant room remove callback (function: 0x079ed690) from humanoid (table: 0x0dc9f7d0).\nWarning: Trying to remove nonexistant room build callback (function: 0x0ddc7a00) from humanoid (table: 0x07a35b78).\nWarning: Trying to remove nonexistant room remove callback (function: 0x163ed078) from humanoid (table: 0x07a35b78).\nWarning: Trying to remove nonexistant room build callback (function: 0x105009a0) from humanoid (table: 0x03cc3c40).\nWarning: Trying to remove nonexistant room remove callback (function: 0x102eadc8) from humanoid (table: 0x03cc3c40).\nSavegame version is 91 (0.40), originally it was 91 (0.40)\nWarning: Trying to remove nonexistant room build callback (function: 0x160ab150) from humanoid (table: 0x16070fc0).\nWarning: Trying to remove nonexistant room remove callback (function: 0x161b62c8) from humanoid (table: 0x16070fc0).\nWarning: Trying to remove nonexistant room build callback (function: 0x034dbd00) from humanoid (table: 0x0e1d97e8).\nWarning: Trying to remove nonexistant room remove callback (function: 0x16119678) from humanoid (table: 0x0e1d97e8).\nWarning: Trying to remove nonexistant room build callback (function: 0x163ee000) from humanoid (table: 0x16357308).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0cc8c000) from humanoid (table: 0x16357308).\nWarning: Trying to remove nonexistant room build callback (function: 0x0e22f860) from humanoid (table: 0x162f5018).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0e224760) from humanoid (table: 0x162f5018).\nWarning: Trying to remove nonexistant room build callback (function: 0x162b8c50) from humanoid (table: 0x16357308).\nWarning: Trying to remove nonexistant room remove callback (function: 0x10804880) from humanoid (table: 0x16357308).\nWarning: Trying to remove nonexistant room build callback (function: 0x1633dc48) from humanoid (table: 0x0804c2a8).\nWarning: Trying to remove nonexistant room remove callback (function: 0x1608a080) from humanoid (table: 0x0804c2a8).\nWarning: Trying to remove nonexistant room build callback (function: 0x0ccca4d0) from humanoid (table: 0x162ad158).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0a38bf40) from humanoid (table: 0x162ad158).\nWarning: Trying to remove nonexistant room build callback (function: 0x0ccdf2e0) from humanoid (table: 0x16471e80).\nWarning: Trying to remove nonexistant room remove callback (function: 0x01255e98) from humanoid (table: 0x16471e80).\nSavegame version is 91 (0.40), originally it was 91 (0.40)\nWarning: Trying to remove nonexistant room build callback (function: 0x00b6dbf8) from humanoid (table: 0x0c35ac30).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0cec8020) from humanoid (table: 0x0c35ac30).\nError in timer handler: \nC:\\Program Files\\Hospital\\CorsixTH\\Lua\\map.lua:46: bad argument #1 to 'getCellFlags' (number expected, got nil)\nstack traceback:\n    [C]: in function 'getCellFlags'\n    C:\\Program Files\\Hospital\\CorsixTH\\Lua\\map.lua:46: in function 'getRoomId'\n    C:\\Program Files\\Hospital\\CorsixTH\\Lua\\world.lua:2246: in function 'getRoom'\n    C:\\Program Files\\Hospital\\CorsixTH\\Lua\\room.lua:69: in function 'getEntranceXY'\n    C:\\Program Files\\Hospital\\CorsixTH\\Lua\\room.lua:666: in function 'tryToFindNearbyPatients'\n    C:\\Program Files\\Hospital\\CorsixTH\\Lua\\room.lua:456: in function 'commandEnteringStaff'\n    C:\\Program Files\\Hospital\\CorsixTH\\Lua\\room.lua:354: in function 'onHumanoidEnter'\n    ...am Files\\Hospital\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:356: in function 'on_next_tile_set'\n    ...am Files\\Hospital\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function 'timer_function'\n    C:\\Program Files\\Hospital\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n    C:\\Program Files\\Hospital\\CorsixTH\\Lua\\entities\\staff.lua:146: in function 'tick'\n    C:\\Program Files\\Hospital\\CorsixTH\\Lua\\world.lua:1103: in function 'onTick'\n    C:\\Program Files\\Hospital\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n    C:\\Program Files\\Hospital\\CorsixTH\\Lua\\app.lua:753: in function \n. Adding the text to the issue to preserve it and allow searching for similar problems across all issues.\nCreated game with savegame version 101.\nWarning: Trying to remove nonexistant room build callback (function: 0xa49c3848) from humanoid (table: 0x983adb60).\nWarning: Trying to remove nonexistant room remove callback (function: 0xa49c3798) from humanoid (table: 0x983adb60).\nSavegame version is 101 (Trunk), originally it was 101 (Trunk)\nWarning: Trying to remove nonexistant room build callback (function: 0xaabbdf58) from humanoid (table: 0xaac5ede8).\nWarning: Trying to remove nonexistant room remove callback (function: 0xaa8df088) from humanoid (table: 0xaac5ede8).\nWarning: Trying to remove nonexistant room build callback (function: 0xab3dbcf8) from humanoid (table: 0xaabba8d8).\nWarning: Trying to remove nonexistant room remove callback (function: 0xaac42990) from humanoid (table: 0xaabba8d8).\nWarning: Trying to remove nonexistant room build callback (function: 0xaa187fa8) from humanoid (table: 0xaa868ce8).\nWarning: Trying to remove nonexistant room remove callback (function: 0xaa187f68) from humanoid (table: 0xaa868ce8).\nWarning: Trying to remove nonexistant room build callback (function: 0xaaa02ca0) from humanoid (table: 0xaac52af0).\nWarning: Trying to remove nonexistant room remove callback (function: 0xa6cc1f38) from humanoid (table: 0xaac52af0).\nWarning: Trying to remove nonexistant room build callback (function: 0xa5f7b198) from humanoid (table: 0xaac8cbf8).\nWarning: Trying to remove nonexistant room remove callback (function: 0xa5f7b158) from humanoid (table: 0xaac8cbf8).\nWarning: Trying to remove nonexistant room build callback (function: 0xa5f806a8) from humanoid (table: 0xa4fc3e50).\nWarning: Trying to remove nonexistant room remove callback (function: 0xa5f80768) from humanoid (table: 0xa4fc3e50).\nWarning: Trying to remove nonexistant room build callback (function: 0xab408558) from humanoid (table: 0xab3fc700).\nWarning: Trying to remove nonexistant room remove callback (function: 0xa4331930) from humanoid (table: 0xab3fc700).\nSavegame version is 101 (Trunk), originally it was 101 (Trunk)\nError in buttonup handler: \n...le/Games/CorsixTH/CorsixTH/Lua/dialogs/place_objects.lua:230: attempt to index field 'orientations' (a nil value)\nstack traceback:\n    ...le/Games/CorsixTH/CorsixTH/Lua/dialogs/place_objects.lua: in function <...le/Games/CorsixTH/CorsixTH/Lua/dialogs/place_objects.lua:229>\n    [C]: in function 'sort'\n    ...le/Games/CorsixTH/CorsixTH/Lua/dialogs/place_objects.lua:229: in function 'addObjects'\n    ...uirtle/Games/CorsixTH/CorsixTH/Lua/dialogs/edit_room.lua:606: in function 'returnToDoorPhase'\n    ...uirtle/Games/CorsixTH/CorsixTH/Lua/dialogs/edit_room.lua:190: in function 'callback'\n    /home/squirtle/Games/CorsixTH/CorsixTH/Lua/window.lua:664: in function 'handleClick'\n    /home/squirtle/Games/CorsixTH/CorsixTH/Lua/window.lua:1439: in function 'onMouseUp'\n    ...le/Games/CorsixTH/CorsixTH/Lua/dialogs/place_objects.lua:452: in function 'onMouseUp'\n    /home/squirtle/Games/CorsixTH/CorsixTH/Lua/window.lua:1423: in function 'onMouseUp'\n    /home/squirtle/Games/CorsixTH/CorsixTH/Lua/ui.lua:622: in function 'dispatch'\n    /home/squirtle/Games/CorsixTH/CorsixTH/Lua/app.lua:768: in function \n. Hello Vincent,\nAre you playing in full screen or in a window? \n. Any screenshots would be very useful, please add them here and we can review. \n. ",
    "Towncivilian": "Furthermore, if one fires the doctor (he eventually complained of wanting a raise, so I fired him) and then repeatedly clicks the \"pick up\" button in his status window, advancing his path by one unit until he leaves the map, the game crashes.\n. ",
    "adrianopol": "Hello, the same situation has appeared to me. Here is the saved state: https://yadi.sk/d/hppaL_k6bcwQN\n. Reproduced in 0.40-rc3.\n. Oh, sorry, I didn't notice the release has been already published! I will update the ebuild and try this version (0.40) in a few days.\nThank you.\n. Hello, the same problem (v0.40; Gentoo GNU/Linux; game was loaded from v0.40-rc3).\nWarning: A patient supposedly sitting down was not, trying to recover assuming he/she is standing.\nDestroying Inspector\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nLua/humanoid_actions/walk.lua:227: attempt to index field 'queue' (a nil value)\nstack traceback:\n  Lua/humanoid_actions/walk.lua: in function 'action_walk_raw'\n  Lua/humanoid_actions/walk.lua:187: in function 'timer_function'\n  Lua/entity.lua:215: in function 'tick'\n  Lua/entities/staff.lua:146: in function 'tick'\n  Lua/world.lua:1103: in function 'onTick'\n  Lua/app.lua:852: in function 'dispatch'\n  Lua/app.lua:753: in function <Lua/app.lua:748>\nSaved game: https://yadi.sk/d/ToyvUoGlgfHns.\n. ",
    "wolfy1339": "Ok, yes.\nAlot of the files added are all of the lua files.\n@Lego3 I'm not sure how to link though.\nI have contacted the old maintainer and is awaiting his response for his source.\n. I have tried making a simlink, but i keep getting the same error message:\nln: failed to create symbolic link \u2018./Bitmap\u2019: No such file or directory\nI have tried moving the repo from my exfat partition to my desktop, but the same happen\n. Thanks, that worked.\nI wasn't trying to move the symlink but move my local repo onto my Desktop\n. All that is left is making the rules (makes it compile), and updating the how-to package readme to use debhelper.\nOr should the packager make the builds himself manually (Easiest option for now) ?\nSince it would require quite some work to get it to compile using cmake.\n. Ok. THX.\nIt Packages but doesn't install.\n. @mrtnptrs i'll rebase against latest master revision. And squash the commits\n. Because of #237 i'm unable to rebase against master.\n. I can't really figure the rest out and i've moved on to other projects\n. Ok, well it still plays the music. Weird though, i have it on one computer and the other i dont't\n. Yes, you may close this\n. I understand your reasoning.\nI was talking on IRC and some were wondering, and so am I, is this just a \"quebecism\" or is this for the whole French language? \n. Thanks\n. Would it be possible to post the lua console output of when the crash happens?\n. Thanks for the feedback. I'll check to fix those. Also where do i find the original strings?\n. I'll try to get this finished but i could use some help too\n. I've fixed those. Is there a due date for this?\n. Not very long... I will work more on this on Monday\n. I've finished the translations and squashed the commits\n. @benckx \nCould you do a final review since I have added all the missing strings\n. Thanks for your commit with fixes to the translations, i will add it to this PR, if you don't mind.\n. The first two (2) commits are already merged into master, from my PR.\nAlso Audio Global is wrong, it's Audio Globale\n. Well, i don't know how to proceed... One problem is you forked my repository (wolfy1339/CorsixTH) instead of CorsixTH/CorsixTH. I would just close this pull request, delete Suisse00/CorsixTH and clone CorsixTH/CorsixTH, and then open a pr with the changes you made\n. I see the problem, here's how to fix it (something like this, from the command line)\n- git checkout master\n- git branch -d translation-french\n- git checkout -b translation-french\n- Update french.lua\n- commit it\n- push the new branch to github\n. I'll have to do the further testing on the SDL version, to determine if it has that problem too. I produced it on a fresh install of CorsixTH. It is definately a duplicate of that bug on Google Code.\n. I have a Surface Pro (1st gen)! I could do testing if you need it, and compile on Linux (Ubuntu) but not Windows.\n. I can reproduce using the touch screen and mouse using OpenGL, on rc 2. Will do further testing on RC 3 and using the pen later.\n. I haven't been able to reproduce this myself lately.\n. Haven't tested on SDL2 (I haven't been able to compile) only 0.40 but on a different save.\nDoes anyone have a copy of the save or know how to get it?\n. I have downloaded all the attachments onto my server,\nthomas01.sav: http://vps3.wolfy1339.tk/~wolfy1339/CorsixTH/issue555/thomas01.sav\ngamelog.txt: http://vps3.wolfy1339.tk/~wolfy1339/CorsixTH/issue555/gamelog.txt\nconfig.txt: http://vps3.wolfy1339.tk/~wolfy1339/CorsixTH/issue555/config.txt\nI can do the same for the other issues too, if needed.\n. The famous level 5 bug has been fixed in a later release.\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/languages/french.lua#L26\n. Moved to #601\n. Unfortunately I don't have one from before the game froze.\nBut, I remembered that it was after an earthquake\n. No, all the room were intact.\nI picked him up from a gp's office to place him in the operating theatre, which was intact\n. There was already one surgeon in the room before I placed the one that caused the .\nSo I don't think it was needing repairs\n. Not that i'm aware of\n. Can anyone still reproduce this? As there have been a lot of updates from 0.50 through to the latest git revision and maybe some commits fixed this bug\n. I can try and test it on latest master and SDL version on my tablet\n. Sorry, i have forgotten about this.\nHas anyone managed to compile the latest SDL snapshot archive?\n. I can confirm this on Windows 10, latest master revision with SDL 2.0.4 from deps repository\n. @TheCycoOne is right here. I can say that on a similar device touch gestures dont work.\n. Do you have the ffmpeg libraries installed? That's what that error points to; it can't find the FFMPEG development libraries.\n. Remove the versions numbers from your CMakeCache.txt, they are not needed.\nPlease try without the version numbers, and post the output.\n. I would try to use stable releases, instead of git revisions.\nThis PPA seems to work for Ubuntu Trusty when compiling.\n. I'm using Visual Studio Express 2013 for Windows Desktop.\nWindows Version: 8.1\nI followed this wiki\n. Weird, I could compile it before SDL2 got merged using that same version before.\n. If you are using Windows, I highly recomment to download MSYSGit.\nInstal it, then open Git Bash (Termainl containing Git), then you may enter the commands TheCycoOne gave you.\nAnd also read some more about Git at http://git-scm.com/doc\n. Can you post some your gamelog.txt?\n. Yes, please post the save. It will help the developers recreate the situation and find out how it's caused.\n. This doesn't seem to be the same (maybe I'm wrong). Please post the savegame right before the issue happens. Press the Windows Key + R\nand enter %AppData%\\CorsixTH and open the config.txt file, then look for a setting asking for the TH source directory\n. Ok, I see now.\nPlease open up that path in Windows Explorer, and browse through the sub-folders to find the DATA, LEVELS, etc directories. Once you found that directory, copy it and paste it in CorsixTH's config.txt file\n. :+1:\nMaybe indclude the TravisCI build status for the master branch?\n. From what I understood from the pull request that implemented LibAV support, it was that some Linux distroes use FFMPEG and some others use LibAV\n. I think you did something wrong here.\nYou probably meant to rebase the upstream master branch onto your branch and not merge it.\nI would create a new branch and then cherry-pick the commit into the new branch and start over the pull request\n. git rebase -i HEAD~2\nonce the text editor shows up, change all the pick's except for the first one to s.\nhttp://git-scm.com/docs/git-rebase\n. I will look at that later\n\nOn Aug 7, 2015, at 14:30, Stephen E. Baker notifications@github.com wrote:\nThere are quite a few grammar errors in that block of text too. I don't suppose you feel like cleaning up more of it?\n\u2014\nReply to this email directly or view it on GitHub.\n. There were some other fixes too mixed in there.\nIs the order of the output of the debug-strings-new-grouped.txt file (created by 'dump strings') always the same?\n\nI'm not sure about that, but I think so.\n\nAnd could that file be a better reference for reorganize the language files in a better way?\n\nWell, I would agree with you. the language files should be prganized the same\n. I can try\n. I just pushed the fixes and will push the reordering later\n. @TheCycoONE All done\n. Is your game on pause?\n. You can put the savegame anywhere that you can share it publicly (ex: Google Drive, Dropbox, Onedrive, etc.)\n. Closed by #878 (I beleive)\n. I believe it's here that you report bugs for Playdeb packages\n. Sorry for not replying. I will take a look\n. I am fine with the patch. Haven't seen anything abnormal\n:+1:  from me\n. I know that Windows builds are stored on the AppVeyor servers, an included feature of AppVeyor\n. Should've been closed by #962.\n. Done.\n. I believe it was working before in version 0.40. Which would make this a bug report\n. @TheCycoONE\nYou can use Ubuntu Trusty containers on TravisCI\nDocs: https://docs.travis-ci.com/user/trusty-ci-environment/\nOther project using Trusty: ZNC, \n. Please rebase against the latest revision of the master branch.\n. Do you have a save game?\nAlso, what version of CorsixTH and Windows are you running?\n. I wasn't thinking of anything in particular, just in general\n. I guess so\n. This was fixed in the latest revision\n. It just happened again. I don't know... I haven't reproduced it in the same circumstances\n. Going to try and debug in Visual Studio\n. Nothing yet\n. > Otherwise it probably wrote a dump file somewhere for sending to Microsoft, but I'm not sure where you'd find it.\nI did find this in Control Panel > All Control Panel Items > Security and Maintenance > Reliability Monitor when you right click on CorsixTH.exe and select View technical details:\n```\nDescription\nFaulting Application Path:  C:\\Program Files\\CorsixTH\\CorsixTH.exe\nProblem signature\nProblem Event Name: APPCRASH\nApplication Name:   CorsixTH.exe\nApplication Version:    0.0.0.0\nApplication Timestamp:  55d13487\nFault Module Name:  ntdll.dll\nFault Module Version:   10.0.10586.240\nFault Module Timestamp: 5716d0a8\nException Code: c0000005\nException Offset:   000000000002fe34\nOS Version: 10.0.10586.2.0.0.256.48\nLocale ID:  4105\nAdditional Information 1:   2617\nAdditional Information 2:   26175b701b13bc996149ee5ad6987af6\nAdditional Information 3:   23ec\nAdditional Information 4:   23ecec2fc93c56524add5d2b4f78f546\nExtra information about the problem\nBucket ID:  94a1bef2f1b4f4c398a8ddcd68e65619 (120466493486)\n``\n. I did have updates to Windows a couple days ago.\nAnd a quick Windows Explorer search reveals that some of thentdll.dll` files were modified a couple days ago, which probably means they were updated.\nFull version of Windows 10: 10586.240\nIt seems as though this version is a Windows Insider Build from the Release Preview ring.\nAfter a little bit of research, KB3147458  included an updated ntdll.dll file\n. I believe that the URL and name should be adjusted per language\ne.g. in French the name would be 'Redistribuable Visual C++ pour Visual Studio 2015' and the URL would be https://www.microsoft.com/fr-fr/download/details.aspx?id=48145 (France - French)\nHere is the French translation:\nCorsixTH exige le '$ {vcredist STRING}' pour fonctionner, mais il n'a pas \u00e9t\u00e9 trouv\u00e9 sur cet ordinateur. S'il vous pla\u00eet le t\u00e9l\u00e9charger \u00e0 partir de $ {VC_REDIST_URL}\n. @Lego3 Here's the french text: CorsixTH exige le '${vcredist STRING}' pour fonctionner, mais il n'a pas \u00e9t\u00e9 trouv\u00e9 sur cet ordinateur. Voulez-vous le t\u00e9l\u00e9charger ?\n. As per the release info, \n\nNote: CorsixTH 0.60 for Windows requires the Visual Studio 2015 Redistributable which is not included in the installer. This is not the same version that was required for CorsixTH 0.50\u2019\n. Just a note, you can squash commits and rebase them on the latest master when you merge pull requests from the GitHib web interface.\nAlso, @ecrips change the RFC to RDY to mark this as ready to merge\n. Could you post the values in English. If you zoom back in you will be able to move around again. If you are good at translating, maybe you could translate it and post it here so someone can update the language file with the translation. The appveyor build failed. When the build passes and there's a downloadable build i'll test this. @TheCycoONE As #1274 was merged can we start testing this?. I don't have my Surface anymore. I now have a laptop with a touch screen (Razer Blade Stealth)\n\n\nFrom: Stephen E. Baker notifications@github.com\nSent: Thursday, November 2, 2017 8:37:24 PM\nTo: CorsixTH/CorsixTH\nCc: wolfy1339; Mention\nSubject: Re: [CorsixTH/CorsixTH] [RFC] Touch support for pinch zoom and move map (#1260)\nI'd still like to see this one tested more before it lands. I'll see if I can get my hands on any devices. I think @wolfy1339https://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fwolfy1339&data=02%7C01%7Cwolfy1339%40outlook.com%7Cbb0359f48b25449a829308d522530dd7%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636452662476453484&sdata=EwkpOApfO4Z8ZKeeSWpn0PJhgNCn4AB7EuV1ZPvpMu0%3D&reserved=0 has one?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHubhttps://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FCorsixTH%2FCorsixTH%2Fpull%2F1260%23issuecomment-341598097&data=02%7C01%7Cwolfy1339%40outlook.com%7Cbb0359f48b25449a829308d522530dd7%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636452662476453484&sdata=x6KTZYYsZX53l7bgCKGtgQzBzUzeF5WJ%2FSbqezPDzzo%3D&reserved=0, or mute the threadhttps://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fnotifications%2Funsubscribe-auth%2FAEYfFZf6bv4MwJIVri9fnoWcKXTOxZVnks5symBEgaJpZM4P5tyc&data=02%7C01%7Cwolfy1339%40outlook.com%7Cbb0359f48b25449a829308d522530dd7%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636452662476453484&sdata=K3JgFu0acE8K1gQ3LUxfXgi8BE%2FHlY6Q1TAyxkO5S5c%3D&reserved=0.\n. Just tested it\n\ud83d\udc4d \ud83d\udce6  . It seems you reset all localization to English. Would it not be possible to only change 2015 to 2017 using a simple find and replace? As to not replace the localized text. I did find this, it is some sort of a landing page: https://support.microsoft.com/en-us/help/2977003/the-latest-supported-visual-c-downloads. Would this be what were looking for: https://www.visualstudio.com/downloads/#microsoft-visual-c-redistributable-for-visual-studio-2017. Does this apply to psychiatrists that are also surgeons or researchers or both?. The way the installer currently works is that it's requesting Elevated Privileges (Admin) when you run it. Doesn't matter what folder or anything else.. That still wouldn't help the use case describes\n\nplayers without admin rights\nSince they don't have admin rights, they won't be able to install Microsoft Visual C++ Redistributable.\n\nThe Visual Studio C++ Redistributable could be statically linked instead, removing the dependency altogether. That would actually completely fix their use case.\nObviously, that won't be in this version, since it's in RC right now, but maybe a future version.\nBut, I agree stand-alone binaries (ones from TravisCI and AppVeyor) should be linked to/copied over to the release page. \ud83d\udc4d. I just noticed that you aren't using the right logo. Please use the one included in the repo. This commit SHA doesn't seem to work. Yes, I have checked\n\nFrom: Stephen E. Baker notifications@github.com\nSent: Tuesday, January 2, 2018 9:56:42 PM\nTo: CorsixTH/CorsixTH\nCc: wolfy1339; Author\nSubject: Re: [CorsixTH/CorsixTH] Bump vcpkg SHA to support space in directories (#1319)\nYou can use ebe81932c323b6437eea7d77ef6860024508f5e4 now.\nHave you verified that this issue affected us? I see a space issue affecting boost, and another one that says some perl scripts - haven't tested it myself.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHubhttps://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2FCorsixTH%2FCorsixTH%2Fpull%2F1319%23issuecomment-354928208&data=02%7C01%7C%7C7ced799dc32b49458e2008d552559f00%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636505450044413938&sdata=vzyatcfnmr4HJZccI1SMvK8HegYkIB3pzLb82bQ98A8%3D&reserved=0, or mute the threadhttps://nam01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fnotifications%2Funsubscribe-auth%2FAEYfFdMcscqIZ74VcZi-ce-I3y-cOz6-ks5tGuxqgaJpZM4RQQ0-&data=02%7C01%7C%7C7ced799dc32b49458e2008d552559f00%7C84df9e7fe9f640afb435aaaaaaaaaaaa%7C1%7C0%7C636505450044413938&sdata=6X6RO%2FSiPh9HsZ9Z48XsAl0F7avIQPByVAAS04hgauo%3D&reserved=0.\n. It's for when you have a space in your user profile. Done. My Windows User Profile path has a space in it, ex: C:\\Users\\Joe Brown\\ and it woudn't correctly be escaped. @stavrossk yes it completely is. It's stable and is very good. I would move the code relocation/reorganization/fixes (commits 19de544 b343d22 02fd0f3 d532b28) to another PR as they aren't really related to adding unit tests.\nJust my opinion, better wait for a team member to say wether it's fine. Thanks for the report. Is it like that in the original game?. This was closed by #1367. The first 3 commits are unrelated to this PR, and have already been merged in a different PR, they should be dropped.. Are you able to do a rebase and remove those unrelated commits (first 3 and last 2). What version of Windows 10?. If you know how to compile it, you could try making a debug build, and running it through a debugger until it crashes, that will probably give much more information. The error suggest that it can't find the OpenGL library.. Strange. I run it on Windows 10 and haven't experienced that problem. I think this could be left open, as a tracker for updating the wiki pages with new build information from 0.62. You don't have to install their software.\nIn fact, if you create a zip file with the requested file inside, you can upload it directly to GitHub, and attach it to this issue.\nhttps://help.github.com/articles/file-attachments-on-issues-and-pull-requests/. Yes... just a small error. I will fix that\n. Shouldn't \"folmkontrol\" be \"filmkontrol\"?\n. Thanks, I have fixed that in a15542ea550a02d4ad94b14f8a53c91cd5490478\n. Could you please fix the indentation on this line. Why are you removing the space before the punctuation here? And the other lines below.\nThe spaces are intentional. Missing an E at the end there. not M\u00c9DECINE but SP\u00c9CIALISTE.. This should be reverted. It was already fixed. Depending on what version of Python you want to target, there's f-string templates (3.6+):\npy\nprint(f\"*{path}\\\\{script}:{found_class}\"). ",
    "siucu": "Hi. I used 0.11. I just downloaded and installed 0.30 but then it always crashes on start. Read your FAQ, I checked my TH source and it is likely corrupted, only 20MB and not over 150MB.\nThanks for your response, I will try to copy from the complete source. Will let you know whether or not it is later resolved.\n. Hi. I used 0.11. I just downloaded and installed 0.30 but then it always crashes on start. Read your FAQ, I checked my TH source and it is likely corrupted, only 20MB and not over 150MB.\nThanks for your response, I will try to copy from the complete source. Will let you know whether or not it is later resolved.\n\nOn Sun, 2/16/14, Edvin notifications@github.com wrote:\nSubject: Re: [CorsixTH] No sounds at all on Mac OS X 10.6.8 except the music (#190)\n To: \"CorsixTH/CorsixTH\" CorsixTH@noreply.github.com\n Cc: \"siucu\" siu_cu@yahoo.com\n Date: Sunday, February 16, 2014, 5:11 PM\nHi! Are you using the OSX package of the\n 0.30 version?\n\u2014\n Reply to this email directly or view\n it on GitHub.\n. Hi Edvin/Lego3,\nI've had the complete game of TH (200 MB), but when I installed Corsix 0.30 and 0.21, it still crashed on start. I eventually went back 0.11 and the game runs well, with sounds.\n. ",
    "timdiels": "Ah hang on, it's not LDocGen, it's the comment itself that's broken\n. I added lua doc generation to make doc command\n. The third commit can be omitted for this change set. Difference being that lua docs will not be generated when running make doc\n. I merged to the current head of branch, then adjusted the offending line in travis but I'm getting build/compile errors unrelated to the change. I haven't pushed these last changes and may pop by in chat to figure out those errors\n. ",
    "ckorn": "--amend should only be used for unpublished commits. Will just create a new branch next time.\n. ",
    "iMiKED": "Did you use full link?\nDo you have MEGA browser plugin installed?\nPlease, use modern browser.\nAlternatively I've uploaded files to Google Drive, take a look: https://drive.google.com/folderview?id=0B5wa6TO0a4ZHc2l4SC1LTmNCa0U\n. ",
    "Frassle": "Game was started in 0.40, was the first version of Corsix I've used. Using the downloaded installer not built from scratch.\n. Also using 0.40 SDL on Win7x64. Some autosaves load ok, but this one crashes fairly soon after loading it. No gamelog.txt is generated and no console output appears.\n. Ah yes, freeze not crash. I should get my terminology correct.\n. Unfortunately not. I can't find a gamelog.txt anywhere. I had to process kill Corsix due to the freeze is there a chance gamelog wasn't written due to process termination?\n. Thanks! Will keep an eye out to not place objects like that from here on.\n. ",
    "mugmuggy": "Pulling out an old issue, as I've been digging into TH a bit and can see somethings that could be addressed here and not sure if it is still an issue but we can have the discussion here.\nDrug research - I've found that the original game, would randomly improve an aspect - effectiveness or cost, rather than alternate between the two. So you might improve effectiveness more often than cost. The original game also has a 1/7 chance that you also improve the other aspect at the same time. Original reduces the cost in 5% steps (of the current cost) - Corsix has this fixed at $10 (about 10% in earlier levels) - so Corsix tends to lower cost greater and potentially faster. In original the price for drugs varies between drugs because of the more random nature and Corsix looks like all drugs are researched and cost the same. From an early look at it, I haven't checked how long if at all a drug is cost improved after reaching 100% effectiveness.\nAs for machine improvements, it does alternate between improvements. Original though, from my analysis so far, 1/3rds of the time, there is no improvement at all, and it improves strength over cost. It appears it stops improving machines after 6 cycles of nothing/strength/cost improvements, but I need to verify that.\nThough I don't believe there are any issues with the normal game levels, drug cost in corsix could go negative, original has a minimum of $10, machine cost calculations look correct, except they also have a minimum of 1/3 the original cost in the original. I've come across this one a few times in testing other things, but hadn't devoted anytime to it. Whilst brainstorming another issue I believe I stumbled on at least one root cause. Sort of related to 1233 but a little different.\nI believe what occurs in this instance is the doctor/patient are finished with the general diagnosis. Doctor is leaving for another room. Patient is sent to dress as normal, patient is leaving the room, but again, a handyman is using the door, the patient then must be queuing, and loosing the is_leaving flag state.\nThe handyman then exits the room. And the following code dealing with patients isn't guarded for handymen\nhttps://github.com/CorsixTH/CorsixTH/blob/627a5e251e07d6a6c4d4cce1af5df523be0a62cd/CorsixTH/Lua/room.lua#L560-L578 \nThe shouldHavePatientReenter checks for anything in the action queue with is_leaving = true and theoretically guard against the patient_needs_to_reenter flag being set to true. When I got this error I had just inserted some logic to record everytime, the above snippet of code was called and that flag was true for a handyman. I assume the easiest fix is to check for handyman on the outermost if. When I have some more time I will try and replicate it based on this. I had replicated it once or twice before manually (in many many attempts) but didn't understand the potential why and it still could be timing related for the patients state.. Took the save from the 2nd comment, and loaded in 0.62 with a few tweaks (the deterministic random changes) and can reproduce what I suspect is the scenario.\nThe issues stem from Room:tryToFindNearbyPatients, which calls Room:tryMovePatient.\nMy scenario has a patient enter the GP office, whilst the staff member is leaving, they sit in the chair then vacate the room. Patient receives instructions to reenter the room, and joins the end of the queue, (gets walk, use_object (bench), queue, walk (old room) at leat one patient is in front otherwise and they can't be 'stolen'.\nThis patient is then picked up as a candidate to move to another room. The patient receives the enter action for the new room and is Queue:expected for that door. Just before this the patient.next_room_to_visit has been updated to the new_room.\nThe patient has walk instruction to the old room at this stage, I guess that this walk instruction should be interrupted and replaced but doesn't necessarily occur as expected, thus when it does, the walk action unexpects the patient, but this is from the new room not the old one.\nThe patient still proceeds with the walk action to the new room. At this point though the Dr has finished with a patient, and checks if they can answer calls (checking Queue:getPatientSize() (in Room:onHumanoidLeave), but as the patient has unexpected again, against the new room, this results in the call for staff being skipped (no patients in queue and expected is zero).\n. Digging this issue out from the grave.\nThis commit original tried to address the old Issue 480.\nIt has a logic bug that partialy accounts for the above. In TH, if the room is buildable (ie discovered) but doesn't exist in the hospital then you should have the option to send to research still if research exists, currently its disabled in this case.\nIn the original it has a bug, in that an unoccupied research room will allow patients to 'go there', but when you start, and remove the researcher (sack them), it will disable the button again.\nThe other issue is also with the content of the faxes. Emergency does it correctly:\nhttps://github.com/CorsixTH/CorsixTH/blob/f16a51011a611c1a66ba91bea8fa640739905ccf/CorsixTH/Lua/hospital.lua#L1232-L1240\nBut the seek room doesn't, as the build callbacks exist only for a room build. The original would only 'open' a room for use when a suitable staff member was also in the room. CorsixTH doesn't really allow that. And its complicated as the room build call back gets called, but then you also sort of need a staff notification as well to successfully implement the seek actions to populate the fax correctly.\nThe build callbacks call updateMessage to enable the button, but not for the notification of the staff member.. I can attest to the slowness/variability of reputation. I have a fairly good understanding of the reputation process, just not of what applies specifically for each of the scenarios. As reputation depends on the ratio of a positive (dividend) and negative (divisor) factor, times 500 - noting its using integer only math. Reputation changes might be +25 for a cure at the very start, but some dilution applies aswell, and this is done by altering the factors independently of a percentage.\nFor example the first cured patient would be +25, then its diluted to be +23. This is worked out as\nat start of game 500 * 20 / 20 initially,\nThen the cured patient is actually 2 steps of calculations - denoting positive as (p) and negative as (n).\n\n20(p) + 10 * 20(n) / 100 - the 10/100 is just for integer math for 10%.\n20(n) + 1\nResults in 500 * 22(p)/21(n) = 523\n\nKicking just the first patient only peforms the second step\n1. 20(n) + 1\nResults in 500 * 20(p)/21(n)  = 476\nCombing the two, above, cure the first, kick the 2nd results in 500 * 22(p)/22(n) = 500.\nThen curing the next patient\n1. 22(p) + 10 * 22(n) / 100\n2. 22(n) + 1\nResults in 500 * 24(p)/23(n) = 521\nThe positive and negative factors vary by fixed percentages, multiples of fixed percentages, or individually incremented/decremented, ie (p)\u00b11. (n) only increments from what I've found. Note reputations for the drug casebook follow the same sort of pattern, as the diseases use separate positve/negative factors\nAs an example, empty hospital, no patients etc, and a single room (inflation for example), destroyed in an earth quake is exactly 50 reputation points first time. 2 rooms exactly 100 reputation. 3 rooms 150. This is just 20(p) - 10% of 20(n)\n500 * 18(p)/20(n) =  450 - 1 room\n500 * 16(p)/20(n) = 400 - 2 rooms\n500 * 14(p)/20(n) = 350 - 3 rooms\nnote no change to the negative factor, however as the original uses integer math, values like 29(n) will result in the same subtraction from the (p) values, ie if you had values like 20(p) and 29(n) and performed the same calculation the different would be 34 and not 50.\nReputation changes in trophy/awards, might (they do, I just can't say for all or which) account for the scenario where the change in the factors, doesn't result in a net change of reputation, to award cash instead.\nReputation also affects value, which alludes to some more of this discussion.\n\nOn Value. both start off the same with an empty building, but CTH adds the full cost of the rooms whilst TH only counts 2280 + 100 on a GP - is the 100 the filing cabinet, as desk would include the chair?\n\nThere is a bit more metadata involved with objects and one of these controls how the objects contribute to the value. In the example above with GP. The desk value contributes to the hospital value, cabinet and chair do not. Likewise no corridor objects add any value. All rooms contribute value, just not all objects, ie the base cost of the room, plus staff use objects (training and staff rooms too) and patient diagnosis/treatment essentially contribute to the value. \nReputation affects the value, as currently Corsix currently uses a 20k constant in the initial value but this is really 10k + 1000 per 50 reputation. For example the scenario of inflation costing 4k and the earthquake.\nStart value = 43525 - rep 500 / 50 = 10, * 1000\nBuild Inflation = 47525 - no change to rep\nAfter quake destroys inflation = 42525 - room destroyed and 450 / 50 = 9, * 1000 9000 rep\nLikewise\nHospital with visiting patients and some build, rep = 500,  value = 45905\nKicked first patient, rep = 476, / 50 = 9, * 1000, value = 44905.\n. Retrieved the save from https://github.com/CorsixTH/CorsixTH/issues/473#issuecomment-67916943 using wayback machine, the x-ray handyman_position is (1,0) and not passable like in #1013.. In the original, disasters are controlld by gbv.DisasterLaunch from what I can observe - this is days between disasters. When that ticks over, there is 25% chance of nothing happening, 50% chance of boiler breakdown (low or high heat) and 25% chance of a vomit wave, you can only get hit with one at a time.\nBoiler breakdown and duration of breakdowns is affected by handyman/radiator ratios. A ratio of 1 handyman per 8 radiators or better appears to veto all of the breakdowns. Vomit waves get vetoed by some variable also.\nSo its possible to avoid breakdowns, and possible the game randomly doesn't give you the opportunity.\nIf a boiler breakdown is active, its duration is also affected by that ratio, if it goes 1 to 8 or better, then the remaining duration ticks down at twice the rate, if 1 to 5 or better, 3 times the rate.\nBoiler breakdowns last randomly between 10-30 days.\n. How often is in the level configuration, but its every 150, 200, 300 days depending on difficulty. The original literally translates as; if 8 * handymancount < num_radiators then do setbreakdownparameters. The other code paths, just clean up the state so it doesn't interfere next time the function is called, as it is called to count down the duration of the breakdown also.. Appears to be duplicate of #1105. Taken the save that MarkL1961 has, let it run it goes into infinite loop. Put the 'fix' in that I have in 1105 comment, and immediately pause game, build and move an object, resume game no infinite loop.\nDodgy tile here is 68,76 in the SW corner of general diagnosis. I found the issue with the walk is from Room:crashRoom\nhttps://github.com/CorsixTH/CorsixTH/blob/9de46b728c61fedf96cd1120a8040af328a55fa8/CorsixTH/Lua/room.lua#L759-L771\nThe entering patient was 'reserved_for' the door. They get the IdleAction and SeekRoom actions queued on the end of the action queue. The finishAction call removes the 1st action, alas, these patients probably (like in the instance I can replicate reliably) have use_object, queue, walk actions to enter the room. This leaves the queue and walk actions to complete and the door navigation is attempted anyway.\nI changed the queueAction for the Idle to a setNextAction and that bypassed the issue for this particular instance.. Can replicate the issue. As @DoctorToboggan indicates, placing a plant back there it dies off in the original. Putting a footprint tile of {-2, 0, invisible = true} in north and {0, -2, invisible = true} in west orientations for the desk seems to do the trick. The other orientations already cover 6 tiles, but have 2 as passable each and from a quick look align with TH.\nThe issues stems from World:wouldNonSideObjectBreakPathfindingIfSpawnedAt failing on the extra tile as its not part of the footprint therefore its adjacent and would need to be connected to the rest of the hospital.. I had a search and couldn't find the handyman_position being updated anywhere besides the Machine constructor. You have to go back to door phase in editing a room to be able to update the handyman_position.. I can see this in trunk, as I was looking at the patients dying issues #1268 (has active epidemic luckily) and #1285 and was experimenting, calling this function and found the bug.\nhttps://github.com/CorsixTH/CorsixTH/blob/fe1a526b5f1da2439b71d9641165bd2dcbf1bbc3/CorsixTH/Lua/entity_map.lua#L183-L195\ngetHumandoids/getObjectsAtCoordinate returns an empty table, not nil, so the function is always returning an empty table.\nI have fix for this in a branch currently with some cpp things from a static analysis I ran.\n. I think you'll have edge cases relying on that function when called from Epidemic:getBestVaccinationTile. \nAs an example, the bench case that cuts short processing is unaffected by a human/object in the tile in front of the bench (ie a radiator placed on the tile) doesn't affect it, but to vaccinate a queued patient standing up it does. \nYou could have a patient in a corner that only has one passable tile which has a side object on it, but you'll never get there as its not a candidate because of this function, or, Like in #1284 the door (I said humanoid in that analysis but it's the door) will prevent you getting to a patient at the end of a 1 tile wide path.. Probably wasn't worth merging my fix in as this is still a little buggy. If the take is to ignore the objects/humanoids next to the patient, you'd just call getAdjacentSquares from Epidemic:getBestVaccinationTile instead as your checking the path distance anyway.\nEither way I think we would have just introduced another bug, in that there is now potential for the nurse to vaccinate through walls and doors. You'd need to check room/path distance (between vaccination point and patient), to find the most correct usable tile. I think that is why maybe you were checking humanoids/objects, but would have had to exclude side objects if the tile was passable.\nSo it probably still needs to be tweaked. As I said I came across this issue, when I was looking at the stuck dying patients, that were receiving invalid walk instructions as that was trying to find 2 tiles side by side for the fall animation and the save in #1268 just happens to have a lot of dying patients stuck at the psych when running and some rocking up are contagious.. Should cover that case, the only one then would be, over the top of side objects but I don't know if that was possible in TH or not.. CorsixTH spawns on edge of map, whereas the original as the view is limited, spawns much closer to the entry of the hospital. The original allows for up to 4 spawn points on each level (for each player in multiplayer) from what I can ascertain and there is a handful of levels where there is more than 1 spawn point.\nHere this screen shot is the original level file altered to allow more camera movement, capturing the position of the spawn point for level 1 - this patient just spawned. The lamps are the ones that are just visible in bottom left corner of the earlier screen capture in this issue, this was a subsequent spawn and not the first, but they all use the same point.\n\nThe spawn date, is also controlled differently than in the original, and this probably has some affect also. How Corsix calculates the dates of a spawn is slightly flawed. World:updateSpawnDates uses math.n_random, which can produce very low (negated with ceil) and even negative numbers. When its negative, ceil doesn't help, as that will move the first spawn to the next month.\nlua\n  local no_of_spawns = math.n_random(self.spawn_rate, 2)\n  -- Use ceil so that at least one patient arrives (unless population = 0)\n  no_of_spawns = math.ceil(no_of_spawns*self:getLocalPlayerHospital().population)\n  self.spawn_dates = {}\n  for _ = 1, no_of_spawns do\n    local day = math.random(1, month_length[self.month % 12 + 1])\n    self.spawn_dates[day] = self.spawn_dates[day] and self.spawn_dates[day] + 1 or 1\nThen if it does get a count 1 or greater, when it randomly chooses the date for that spawn, it could be the end of the month, leaving the patient arriving well into the next month. This combined with a -ve no_of_spawns initially leads to first patient potentially much later, like in March. Corsix uses the population allocation factor (default 0.25) where as whilst the game month is less than gbv.AllocDelay, the original would round robin\nThe original more evenly spreads the spawn dates around, at least for local player, as it occurs when 2 conditions are met and its located closer to the hospital entry so is more predictable also, I'm still finalising that analysis.\nThe other spawn issue, which isn't yet an issue as much is when gbv.AllocDelay has passed and it becomes reputation based. To ensure the ai hospitals stay active and potential for the player to recover, I assume, gbv.AllocRand starts to be used. When it is used, it will randomly - given by random() % gbv.AllocRand == 0) - choose a random hospital given by random() % hospitalcount - 0 being local player.. I've also found the spawn_rate calculation to be off. When the popn.Change value takes affect is at the end of that index month, not the end of the next month.\n```\npopn[0].Month.Change       0       3\npopn[1].Month.Change       1       1\n```\nWith the above example, start of level, 3 spawns will occur in Jan, at the end of month processing for Jan, the calculation currently takes the '1' value and adds to 3 totalling 4 spawns in Feb, when it should take the '0' value again, and have a total of 6 spawns for Feb, then when end of month for Feb, comes in, add 1 for 7 total spawns in Mar.\nThe original TH has potentially less spawns in Feb, as the spawn interval is calculated from a static 30 days - 1500 ticks, and there is only 1400 in Feb and likewise on the 31 day months, 1550, you can get extra spawns in depending on the calculations.. > or the room cleaned up the pukes while he was sweeping it?\nProbably the same issue in #1329/#1344, having removed the litter through some other process before the sweep action finished.. GameUI:onKeyDown checks UI components key handlers, but that drops out when the 2 keys are pressed and one released. When you return to just one key being pressed the onKeyDown doesn't fire again so the staff managment (or other windows) can't receive the event and the keys state is unchanged until the KeyUp is fired.\nGameUI:onKeyDown and GameUI:onKeyUp methods have this wrapper around the updateKeyScroll (after calling the key handlers in onKeyDown, if its handled it will veto the scroll action) and this just updates based on the button state which starts the scrolling action.\nif scroll_keys[key] then\nthis could be changed to detect modal fullscreen windows\nif scroll_keys[key] and self.app.ui.modal_windows[\"fullscreen\"] == nil then\nThat will veto the scroll event.\nProblem would then be running at a higher resolution you technically can see much of the map and its probably nice to scroll around still, but the lower resolutions not so much.. GameUI:onCursorWorldPositionChange isn't hit testing the UI components for the queuing over room logic, pretty simple fix this one.\n. AI Hospitals, I have a cut of my code in progress https://github.com/CorsixTH/CorsixTH/compare/master...mugmuggy:aihospitals\nAnd a build\nI do know it crashes sometimes on annual report and I still have to validate all the patient/hospital processing. I'm yet to play through part of every level yet to see if it's as competitive as the original.. I thought I would just add a few more issues here to this one around the annual report.\n\nCharts title year is year + 1, ie first year should be 2000, not 2001\nWhen statistics are implemented for other hospitals, the getIndex function fails to accurately retrieve the index (I forgot to include my fix in the above build/branch - which won't crash, it gives this index issue)\nit is possible to be awarded trophies in an opened but inactive hospital - run a full year and don't build/hire or do anything you get rewarded\nreputation awards are percentage, based not fixed value + some randomness value - see #1222 for similar discussion\nsome awards are given incorrectly or not at all when they should be possible for example TrophyMayorBonus depends on num_vip_ty and pleased_vip_ty, but pleased_vip_ty is never reset whereas num_vip_ty is reset to 0 in Hospital:onEndYear - this makes sense only if you can get it once ever uptil the year of the first vip visit\n. From what I can gather there is a race for the door with the arriving and leaving surgeon. Arriving gets there first and enters the room, never gowns up. The leaving surgeon has enqueued an immediate walk action in the room, circles back to the door and leaves. The state just so happens to allow a patient to enter.\n\nRoom:getMissingStaff\nif class.is(humanoid, Staff) and humanoid:fulfillsCriterion(attribute) and not humanoid:isLeaving() and not humanoid.fired then\nhumanoid.isLeaving() checks the first action item in the queue only, which is now the walk action for the leaving surgeon. So him being in the room, accounts for the need for the entering surgeon to not gown up.\nFor demonstration purposes as it's not the right way to go about it, replace humanoid:isLeaving() with humanoid:hasLeaveAction() will have the surgeon gown up, but no patients arrive. This is because hasLeaveAction() picks up the, walk/use_screen action for when the surgeon does actually leave and blocks further tests of Room:staffFitsInRoom(staff) from being effective.\nAs hasLeaveAction() isn't an option, I though maybe adding in a check for just going_to_staffroom instead would be sufficient\nif class.is(humanoid, Staff) and humanoid:fulfillsCriterion(attribute) and not humanoid:isLeaving() and not humanoid.going_to_staffroom and not humanoid.fired then\nThis appears to work around this issue, but again, I don't quite know enough to ascertain if that is the case or best option.. I just hunted that down.\nChanging\nhttps://github.com/CorsixTH/CorsixTH/blob/099db386fcfe3ea592ce0d13af50c432c0308300/CorsixTH/Lua/humanoid_actions/queue.lua#L278\nto\nhumanoid:queueAction(WalkAction(ix, iy):setMustHappen(true):setIsLeaving(humanoid:isLeaving()), idle_index - 1)\nI believe that does the trick, I just don't know if it will break anything else.. Somehow the handyman_position of the x-ray machine didn't match the standard use_position. Its set as (1,0) instead of what I expect would be (-1,1). The (1,0) leads to a non-passable tile and the pathfinder I assume aborts early in the code with !pMap->getNodeUnchecked(iEndX, iEndY)->flags.passable) as passable is false. The handyman is then teleported rather than walking there as the tile positions are updated still. Rebuilding the room corrects the problem.. Here the door is reserved by the patient that I assume just used the door. They show up as having left the hospital and checking the previous_action (on trunk), the last action appears to be leaving the map (walking to the edge of the map), but they still have the door reserved.\nThe hack I guess it to update the hack in Door:checkForDeadlock to account for despawn actions\nif action.name == \"queue\" or action.name == \"spawn\" and action.mode == \"despawn\" then. From some experimentation this bit of code appears to be contributing to the patients and potentially staff reserving the door.\nhttps://github.com/CorsixTH/CorsixTH/blob/e14d4ffa993a1d3fa71b6bca293d77602f388c74/CorsixTH/Lua/humanoid_actions/walk.lua#L427-L429\nI put an \n\nif action.is_leaving then\n\ncheck in place wrapping the assignment of the humanoid to the reserved_for and so far it seems fairly reliable in preventing the patient holding the door.\nAs the QueueAction and the Walk action both have reservations set.\nhttps://github.com/CorsixTH/CorsixTH/blob/e14d4ffa993a1d3fa71b6bca293d77602f388c74/CorsixTH/Lua/humanoid_actions/walk.lua#L310-L313\nThe door is reserved when a patient leaves the queue, and I assume that the walk action after the queue action from above is reserving it again. Not to say this will fix it, just that I haven't happened upon it since I put that change in and a tweak elsewhere will probably be better.\n. When staff are stuck and get tired in a room, they start a loop of trying to use the door, walk, idle queue, walk. But when that occurs the walk reserve_on_resume is actually droppped, as by this time, the Staff has ticked again, calling Staff:goToStaffRoom which upon doing so creates a new leave action I assume and we rinse and repeat.\nAs the reservation is then lost on the walk action the door doesn't get reserved on that walk action resumption. I assume then there is still a race of another humanoid reserving the door, ie the patient leaving, but the staff can't as the walk has been removed by this point. Putting a guard to just not do the guts of goToStaffRoom again as just an example;\nlua\n  if self.going_to_staffroom then\n    return\n  end\nWill stop the walk loop and the staff member stands idle in the queue. Then it should just be a matter of finding why the reservation of the other leaving humanoid isn't lifted. Instead of the blunt check from previous comment. EDIT: Can't do the abort it appears as staff members seem to get interrupted on the seek/walk, and don't attempt again.. I've taken a look at the save and sometimes get some other scenarios happening but replicate the freeze. My experience generally has the Doctor enter and freeze when he attempts to 'meander' in the room. The Dr is given Walk action sending him to (86,70), outside the room. The Walk action path is something like (85,68),(86,68),(86,69),(86,70) which is straight through the wall. \nChecking the cellFlags for (86,68), shows that the cell is completely passable, travelSouth/East/West/North all true.  #1105 refers to walking through walls as well for a tile next to a door. I confirmed the issue in #1105 is also that the tile is passable when we expect travelWest to be false.\nFor this issue, placing a radiator against the wall for example updates the travelSouth and prevents the crash from occuring, remove it again and its entirely possible to have the issue occur again. The Dr will meander out of the room after treating patient and then back in (not sure why), and if you remove the radiator at this point it probably will freeze again. Unsure of what circumstances can lead to this state.. I have knocked together a routine that handles this type of scenario and added it to the Room class, which I called from afterLoad, like a generic 'fixer', alas afterLoad isn't called if the savegame version is the same, though we don't have an identified cause of the glitch.\nThe Door PR I believe you mean that scenario around the bench which would have the old footprint from the previous save (as these are persisted) and not the 'new' instance. Adding an afterLoad routine there to bring it up to date with the new footprint works too.. Just double checking this one after looking at #1094. I can reproduce the circumstances with the saves, and when loading Autosave6 the issue has already occured but the cause was right there. Autosave5 has at (52,74) objects a bin and a radiator.  Move the radiator and the travelWest flag is reset to true on (53,74) (and on 52,74 travelEast), effectively creating a path through the wall. Loading Autosave6 I assume that the radiator we've picked up is the one from the (52,74) tile.\nWhat I haven't been able to do is replicate it away from this save, but could replicate the same issue at (48,80)(49,80), where on (49,80) is another radiator and bin but this doesn't have a negative affect on path finding it seems.. Appears so. Wall tile flags are punching a hole in the walls with both instances. I'm speculating on #1094 as I don't have before save but in that one there is a radiator placed a little weirdly, which could have been moved away from the wall resulting in the same issue.. Can replicate it now. Place radiator first, build room up to radiator, move radiator away from wall.\nBelieve the issue llies in Object:setTile. It calls the local function setPassableFlags, only for side objects, which updates the flags either side on remove. When the object is placed against the wall after the room is built, the placement logic skips calling setPassableFlags as the passable_flag is already false\nif xy.only_side then\nif map:getCellFlags(lx, ly)[passable_flag] == true then\nself.set_passable_flags = true\nsetPassableFlags(passable_flag, lx, ly, next_tile_x, next_tile_y, false)\nSomething like this in setPassableFlags, will detect the wall boundary and prevent the issue from occuring. with the infinite loop, due to paths being cut through walls.\nlocal room_pos = self.world.map:getRoomId(xpos, ypos)\nlocal room_next = self.world.map:getRoomId(next_x, next_y)\nif room_pos ~= room_next then\nreturn\nend\nBut this also leaves any back to back side objects, also becoming completely passable if one object is removed, allowing humanoids to pass straight through the remaining object.\nHere I blocked off a path. Don't think this should be possible, but path finding sends them through the other door.\n\nAnd here I removed one of the radiators and captured a patient walking through the radiator can be either one depending on which one you place first.\n\nSo there is this deeper issue, but this doesn't cause an infinite loop or anything\n. By the looks of it, we can conditionally if so desired call\nself.world.map.th:updatePathfinding()\nself.world:resetSideObjects()\nin Entity:onDestroy after the setTile\nMy understanding is updatePathfinding appears to rebuild the broken wall flags that setTile(nil) breaks in setPassableFlags\nresetSideObjects fixes the back to back side objects becoming a path leak, if the first placed one is removed.. Resolved with #1270. I couldn't replicate the layout in TH with the cardiogram in that position with the door, this is one of the rooms with minimum size the layout restricts you depending on the orientation. With door and cardiogram in those positions you can't build a room in TH.\nTo get that same sort of layout, door and window position swapped, cardio on otherside of room, will give the screen 3 possible positions. The patient/doctor would have been unable to find a path to the use_position of the machine. So something was broken to be able to build that room.. Check 4 for example, Bench has invisible tile, if you place a bench 90 degrees to a tile adjacent to a door, facing the door, without this check, it prevents you from placing the object, however in TH it does allow you to.\n. Check 5 in  place_objects needs some tweaking though. I'll double check on that one as it prevents placing side objects in front of a bench. Doesn't copy TH faithfully.\n. No probs I'll close this one and raise a new one\n. Reopened this for discussion on the changes proposed, with additional commits after more testing. Most changes are for aligning CorsixTH with original TH behaviours mainly with swinging doors. Blocking object detection I feel might be a bit rough (invisible of bench doesn't block doors, but passable of drink machines does). Door positioning on walls could have a bug in original TH on north walls. Added the floor blueprint for swing doors, and corrected the single doors to match TH.\n. In the instance of MarkL1961 last save I believe the first handyman arriving is getting gotoStaffRoom call, whilst performing the sweep floor action.\nThis removes him as an assigned handyman\nhttps://github.com/CorsixTH/CorsixTH/blob/fe1a526b5f1da2439b71d9641165bd2dcbf1bbc3/CorsixTH/Lua/entities/staff.lua#L639-L644\nAs the task is still active at this point, the other handyman gets assigned andt he walk/sweep actions, but doesn't detect that it needs to interrupt (which it shouldn't as the task is in progress) so it doesn't call the existing handymans interruptHandymanTask, which it would be too late anyway, as you don't want that handyman servicing the call either.. I've found a few other quirks which probably fix a few of the other litter clean up issues.\nHere task.objects.ticks is true from the Entity constructor on litter I assume - so building over litter doesn't call interruptHandymanTask.\nhttps://github.com/CorsixTH/CorsixTH/blob/fe1a526b5f1da2439b71d9641165bd2dcbf1bbc3/CorsixTH/Lua/hospital.lua#L2160-L2167\nI've had some reliability in altering the above (just for testing the litter behaviour, didn't consider repairing/watering actions yet), and including removing the cleaning task in the action_sweep_floor_start, rather than relying on action_sweep_floor_remove_litter - which calls Litter:remove() to do the cleanup.\nLitter:remove() still has to call the removeHandymanTask for when you build over.\n. Seeking more feedback on this as I've combined 1164 changes here as they use the same refactored function now and that bit of code is more less complicated than the greater change. Only thing I can think of is fa38fca was missed but then you couldn't build the one next to the radiator either if that was the case.. I haven't looked into it too much, as early investigations appeared to cause other logic to break, like building the bench facing a wall. It might be possible as I'm completely new to Lua as well as new to CorsixTH. I guess from what I've gathered so far, is that the passable tile (within the footprint), will still be needed within the footprint to prevent objects being placed in front of it anyway. It doesn't completely own it, but it is still required I guess from a navigation point of view too, unless there is a way to ensure passable into the tile in front another way.  #1163 includes the same sort of check for benches near the doors walkable tiles, where it seems passable has an effect.. For the bench case, I'm aligning with the original TH for placement of objects. For example in the original you could not have 2 or 3 drinks machines sharing the same 'passable' tile. However, you can have 2 benchs and a drinks machine, all facing the one passable tile.\n\nThese are from Origin TH\nLikewise the similar code in the door PR, A bench passable tile (for a doors walkable tiles) does not block a door, but a drinks machine/reception desk should or any other object should.\n\n\nThese are actually with the PR applied. (door tile in corsix is the centre door, th uses an end tile - lower x/y depending on wall direction) but are duplicating what you would see in TH.\nAnd again with objects, the walkable tiles are checked to prevent the SideObjects being placed on a walkable tile except with the bench. Again Origin TH. \n\nHopefully this clears up why bench is different.. Just took a look at this one. Kill 'em twice\nhttps://github.com/CorsixTH/CorsixTH/blob/63afae1554a2abeba225d5865f5ea77b18e73c78/CorsixTH/Lua/hospital.lua#L1286-L1291\nAlready dead patients from emergency_patients will retrigger the patient:die() call upon end of emergency as they aren't in a room - like patients waiting to be treated which is the intent obviously here. Maybe we just need to check not patient.dead as well. See #1032/#1050 where this seems it was changed to be more narrowed to not cured as it was using the patient.hospital before that.. This last issue, I just seen happen when I was mucking about so took a deeper dive - World:onEndDay calls Patient:tickDay.\nIt has this bit of code\nhttps://github.com/CorsixTH/CorsixTH/blob/a549a809217a135d51214eba8f33d263178d90e6/CorsixTH/Lua/entities/patient.lua#L637-L646\nI'm guessing as onEndDay gets called in World:onTick, whilst the treatment in this case Pharmacy is underway when health meets that criteria and that random value condition is also true. This sets the mood to exit.\nThe treatment is finished in the Room:dealtWithPatient is being called updating the cured state etc. When it calls Patient:goHome again, its already set to the onEndDay/tickDay mood and not updating the value as the patient is already going_home.\nhttps://github.com/CorsixTH/CorsixTH/blob/a549a809217a135d51214eba8f33d263178d90e6/CorsixTH/Lua/entities/patient.lua#L526-L533\nIt doesn't make much sense for a patient to leave a diagnosis/treatment room. Maybe only allow them to make that decision outside a room.\nif not self:getRoom()  and math.random(1,30) == 1 then. I was able to reproduce this but with #221 being resolved now, it shouldn't be possible.\nThe bit of code here explains it\nhttps://github.com/CorsixTH/CorsixTH/blob/a549a809217a135d51214eba8f33d263178d90e6/CorsixTH/Lua/dialogs/edit_room.lua#L604-L611\nWhen a radiator/extinguisher/bin was on the door tile and the door object was associated with the tile in the room, the door was found first and breaking out of the while loop and leaving the other object behind.. Is resolved with fixes in #221.. I came across this issue doing the default mouse capture, if there was a new option to be persisted and, in this case capture_mouse, in the config file, the first time it ran track_fps behaivour is enabled. Likewise if no file exists.. Looks like a recurrence of #133/#497. That patients last trip was to the Research Dept.. After the operating table is finished being used, the room is being crashed. Room:crashRoom is calling the local function remove_humanoid. Which in turn calls World:destroyEntity and Staff/Humanoid/Entity :onDestroy. Entity:onDestroy is calling SetTile(nil).\nThen somehow at least one of the surgeons is getting a call to Staff:tick() which is trying to find nearby litter and failing as his tile positions are nil.\nTrunk behaves differently, and breaks the room. So that needs to be analysed also.. Trunk behaves differently due to a change which I believe came after 0.60. In OperatingTheatreRoom:buildTableAction1 the local after_use persistable:operatring_theatre_table_after_use was changed, and as this is persistable but the parent changed, the self attribute doesn't appear to be in the scope. putting a local room = self back in and changing self to room on dealtWithPatient, and the game doesn't crash. And the room doesn't get destroyed either which could just be some other factor (table is about half strength). I haven't tried to replicate the 0.60 bug in trunk.\nMaybe @Alberth289346 can elaborate as I only have taken a glance at the persistable side of things to understand the mechanism. So there could be some breakages in trunk with saves from 0.60, but need another opinion.\nThe save in #1265 also has the operating theatre crash but leaves a bin in the room.. Resolved with #1451. Happy to not worry about the persistence thing for now.. I happened upon an invisible soda machine in #867 and that was on 0.50 and this one is post 0.60.\nLooking at both the soda machine issues, the user_list of the object has a user that is going/has gone home, and they are in the user_list still. This prevents Object:removeUser from making the Soda machine visible again. I'm assuming sending a patient home whilst using the machine is interrupting the action leaving the soda machine invisible.. I can't get this save to load but there appears it could be related to one https://github.com/CorsixTH/CorsixTH/issues/444#issuecomment-67879296 with a similar outcome, And I have happened on the possibility in some other saves as well.\nWhen a patient is in a queue, and they say for instance they are about to access the drinks machine and the room is destroyed (even with editing as in #444), the Queue:rerouteAllPatients call doesn't interrupt the drinks machine actions and thus finishes whatever action is currently runnning and continue with the rest of the actions. Leaving the patient to rejoin the queue with an idle and seek room action afterwards.\nPatient:tickDay handles a similar issue already:\nhttps://github.com/CorsixTH/CorsixTH/blob/9de46b728c61fedf96cd1120a8040af328a55fa8/CorsixTH/Lua/entities/patient.lua#L909-L936\nFor my particular case I added a check for the destination room and its queue existing which sent them on to the reception desk. The 444 case, actually has the action referring to the old queue and the next room is valid with a valid queue. Additional checks to ensure the queue action queue and the next room queue is also the same queue should fix the 444 case, but I haven't yet reproduced the circumstances that triggered that one.\n. Option labels are set with no font specified to the lower level functions\n:setLabel(_S.folders_window.screenshots_label):setTooltip(_S.tooltip.folders_window.screenshots_location)\nBut the values are set with the 'built_in' font on the values\nlocal built_in = app.gfx:loadBuiltinFont()\nself.screenshots_panel:setLabel(app.config.screenshots and app.config.screenshots or tooltip_screenshots, built_in):setAutoClip(true)\nRemoving built_in gives this\n\nYou can see the effect by searching ', built_in' and replace with nothing in folder_settings.lua and then hitting the 'X' on the screen (this resets the font label in say resetScreenshotDir back to the built_in. It seems there is a preference of the language font, then built-in, then original TH font. I can see that setLabel is probably calling lots TheApp.gfx:LoadFont(\"QData\", \"Font01V\") when loading these dialogs , which would be the default TH font with those missing symbols.\nBut that function actually encapsulates checks for language_font if its isn't a specific symbol one for the bitmap_font, and uses that. Chuck in Font(\"unicode\") into the English or other translations where it maybe missing and you get the symbols visible again.\nThe issue then is it affects the entire game so we probably want to pass in the font itself still, just the built_in value needs to be selected.\nSomething like this for example would ensure language_font was selected over the builtin, keeping say English working fine.\nfolder_settings.lua\nlocal built_in = app.gfx:menuFont()\ngraphics.lua\nfunction Graphics:menuFont()\n  local font\n  if self.language_font then\n    font = self:loadFont(\"QData\", \"Font01V\")\n  else\n    font = self:loadBuiltinFont()\n  end\n  return font\nend. Similar issues #500, #362, #858 and #650 and can be symptomatic as shown in #1104.\nCardio and General Diag both have multi use object 'controlled' by patient. Both very much the same.\nhttps://github.com/CorsixTH/CorsixTH/blob/9de46b728c61fedf96cd1120a8040af328a55fa8/CorsixTH/Lua/rooms/cardiogram.lua#L87-L97\nThe last part of the code above is queuing the walk to screen and setIsLeaving(true), also a UseScreen with setIsLeaving(true) to get dressed again.\nsetIsLeaving(true) will allow the staff member in the room to be seen by isIdle() in particular circumstances as idle, this leads to CallDispatcher when CallDispatcher:enqueue runs to findSuitableStaff which picks up this doctor as being idle. Below snippet already assumes the staff is in a room.\nhttps://github.com/CorsixTH/CorsixTH/blob/9de46b728c61fedf96cd1120a8040af328a55fa8/CorsixTH/Lua/entities/staff.lua#L781-L796\nI wonder if removing that for loop and only checking room:getPatient():getCurrentAction():isLeaving() would be enough, the difference is, 'is leaving' or 'will be leaving'. Tested that change on save from https://github.com/CorsixTH/CorsixTH/issues/500#issuecomment-111854603 running on 0.5 and the call is passed to a different doctor and this doctor meanders in the room, as there are no other calls they are suitable for. I haven't yet replicated myself on something newer (fairly sure I've hit the issue though before but knew of the issues), but there is evidence it may occur still.\n. To replicate is a bit of hassle.\nMust have a gowned patient in the room you want to break and meeting the requirements to hit that for loop. Doctor must receive a call to another room before using the trolley, easiest way is to edit and finish an adjacent room with waiting patients.\nThe doctor should pick up that call, and start leaving.\nTo get the issue you need another humanoid, naturally a handyman is most obvious to be using the door, when the doctor is about to leave, place a handyman that should leave immediately and they reserve and uses the door, the doctor then will need to 'queue' creating an idle action at the start of the action queue.\nMulti use object action will start 'incorrectly'. Resulting in the patient crashing, and the doctor can leave and other doctors can leave and enter the room but it remains unfunctional unless you to attempt to recover it.. I think it is these types of lines\nI haven't fully checked why its going in an infinite loop, but I believe it is because there is no spaces in those lines I linked to, no new lines, and no '//' for line break.\nThe line above the ones I linked to has a '//' break in it. I think then we end up with a state in THFontDrawArea THBitmapFont::drawTextWrapped of:\nAfter the '//' is found\nsMessage = sBreakPosition;\nthen at the top of the while loop\nconst char* sLastGoodBreakPosition = sBreakPosition;\nwhich after the processing of the string which has no spaces,'\\n' or '//', its wider than the dialog window.\nif(iMsgWidth > iWidth)\n{\nsBreakPosition = sLastGoodBreakPosition;\nbreak;\n}\nwhich then leads us back to start, forever not moving sBreakPosition.\nie we do this again\nsMessage = sBreakPosition;\nPutting appropriate spaces or // in those Chinese translations would prevent the issue. I put a space at the end of L2874s text and the information dialog is opened correctly.. @TheCycoONE I just pulled out an example I could find of where the lua pair ordering affects random state.\nhttps://github.com/CorsixTH/CorsixTH/blob/e14d4ffa993a1d3fa71b6bca293d77602f388c74/CorsixTH/Lua/research_department.lua#L377-L387\nBetween a save and reload the research_policy can result in reordering when processing over a pairs loop and math.n_random calls math.random twice.\nYou'd want something like this to help make it deterministic.\nhttps://github.com/CorsixTH/CorsixTH/blob/e14d4ffa993a1d3fa71b6bca293d77602f388c74/CorsixTH/Lua/research_department.lua#L163-L165\nThere is probably some effort in ensuring the deterministic nature. Found probably one of the main culprits of ruining the deterministic nature also.\nhttps://github.com/CorsixTH/CorsixTH/blob/e14d4ffa993a1d3fa71b6bca293d77602f388c74/CorsixTH/Lua/game_ui.lua#L198-L201\nEvery GameUI:draw call, two calls to math.random - even whilst paused and no active quake.. I put some logic in to check shake_screen_intensity, with a hospital it did have a research dept actually researching so that surpised me a little - but only specialisation/improvements were running - so a bit of luck there.\nRan for 3 months logging every math.random call. The level was completed so the offers were coming every 3 months, when the current 3 month period ended, and game was paused with offer letter I took a save. Then reloaded that twice in 2 different sessions and just resumed it until the next 3 months. all 40k plus calls matched - ie returned value, source file called from, line of the calling function and function name if possible. Obviously I didn't interact with the game (music was disabled), but announcements/sounds were set to play and obviously no quake.\nSo yes isolating those math randoms for ui/visuals/music randomisation etc, should assist in tracking issues between 2 autosaves as long as the game has run with no user input for the period between 2 autosaves and an issue arose.. I made a simple change to test the separation out\nc\nint luaopen_random(lua_State *L)\n{\n    lua_getglobal(L, \"math\");\n    lua_pushliteral(L, \"lua_random\");\n    lua_pushliteral(L, \"random\");\n    lua_gettable(L, -3);\n    lua_settable(L, -3);\n    lua_pushliteral(L, \"random\");\n    lua_pushcfunction(L, l_random);\n    lua_settable(L, -3);\n    lua_pushliteral(L, \"lua_randomseed\");\n    lua_pushliteral(L, \"randomseed\");\n    lua_gettable(L, -3);\n    lua_settable(L, -3);\n    lua_pushliteral(L, \"randomseed\");\n    lua_pushcfunction(L, l_randomseed);\n    lua_settable(L, -3);\n    lua_pushliteral(L, \"randomdump\");\n    lua_pushcfunction(L, l_randomdump);\n    lua_settable(L, -3);\n    return 0;\n}\nThen just changed app.lua to seed it with math.lua_randomseed and changed GameUI:draw to use math.lua_random instead and I got some repeatability occuring. I also picked up on some more diversion.\nThere is this in World:onTick\nhttps://github.com/CorsixTH/CorsixTH/blob/9de46b728c61fedf96cd1120a8040af328a55fa8/CorsixTH/Lua/world.lua#L997-L1003\nWhich calculates the after 'ticks' date, and if the world we be in a future day (month and year processing also) does related processing. Hospital:onEndDay at least has some calls to random, one not really deterministic, (ui message) the other might be a little more (boiler breakdown) and subsequent function calls refer to random.\nThis means the speed of the game changes the outcome of the random processing. My earlier comment, the game was let run with no inteference at \"And then some more\", but a period of processing at \"And then some more\" and \"Speed up\" at the end of a day will result in changes to the order of the random calculations.\nLikewise the other one is onEndMonth calculating the future spawn dates. And individual spawn hours are affected as the date is advanced with each onEndDay call.\nhttps://github.com/CorsixTH/CorsixTH/blob/9de46b728c61fedf96cd1120a8040af328a55fa8/CorsixTH/Lua/world.lua#L1022-L1024\nAt the faster speeds, the 'hours' on occasion can skip a spawn as the date will be advanced 3 or 4 hours, if onEndDay is say run at the 49th hour (actual end of day), at speed \"And then some more\", the current hour leading into the above loop will be 2, and if onEndDay calcuates one at 1st (currently there is a bug around the spawn hour too, 0 to 49 are valid spawn hours, but Corsix currently uses a 1 to 50 range) the spawn will not occur. So running at the lower speeds is really the only way to ensure repeatability with the current build.\nI'm guessing it was done to simplify some things, but means all onEndDay/Month/Year processsing occurs before all the ticks for those entities that day have completed.\n. And there is some other code dependent on the hours_per_tick in World:tickEarthquake along with random calls, and since a high game speed calls random in a different order, it alters the outcome. Outcomes like machine damage, might be added before the ticks of other entities would process when run at the lower speeds.. Any preference to squash or drop the #1263 related commit and its revert. Otherwise you can cover it as part of the merges. Also switching full screen<> window after opening the folder settings dialog also corrupts the builtin font, fix is proposed in #1262 to nil the built in font so next time loadBuiltinFont is called it reconstructs the font. Just covering off one thing I noticed when the room crasheds, a bin was left in the room.\nRoom:crashRoom \nfor object, _ in pairs(self.world:findAllObjectsNear(fx, fy)) do\nfindAllObjectsNear appears only to return the first object on a tile at least in this build. Bin was under the xray viewer and was left behind. I put a bin and radiator under the xray viewer and that left 2 objects in the room.. My last commit into #1270 was to fix the 2 objects 1 tile issue, that I broke when fixing the objects on litter. So that will prevent this issue from occuring in future builds once merged. Logic bug contributing to this?\nUint32 iRendererFlags = (pParams->bPresentImmediate ? 0 : SDL_RENDERER_PRESENTVSYNC);\n...\nif (info.flags != iRendererFlags)\nIts probably impossible for VSYNC to be returned by itself and SDL_GetRendererInfo is always going to return a non-zero value right in normal operation?\n. Yeah I mean that logic is always destroying the renderer, when I think it only wants to destroy if bPresentImmediate has changed. I just changed out that setting builtin to nil, confirmed I had the bug again, and modified the logic a bit to not destroy the renderer and the bug is lifted in the menu.\nIf iRendererFlags is 0 and GetRendererInfo returns VSYNC, destroy renderer I think is the goal, and the other way. If iRendererFlags has VSYNC and GetRenderInfo doesn't - recreate the renderer.\nAnd this means the latter of your analysis is probably taking place. But the issue will persist if you can change bPresentImmediate in game/through menu.. This is ready, not sure why Appveyor idn't pick it up and report it back. But as this is a lua change only should be ok, to take the travis-ci as an indicator its passing.. Litter has no footprint, so getWalkableTiles will be called, so with this check in isTileExclusivelyPassable, I'm basically saying ignore checking litter - which really means check for doors in object placement and check doors for opposing entrances in room construction. Could guard the for loop with an if statement checking if the type is litter to make it a little more obvious that we don't want to do it.\nRathole has an empty footprint table so basically skips over the first loop in isTileExclusivlePassable and a door can't be placed on an existing wall so not required in edit_room.\nThe check in edit_room you've highlighted, is to prevent say the drink machine actual tile, blocking a door and object physically in front of it,  the isTileExclusivelyPassable checks only the passable tile of the drinks machine is also not blocking the door. And there is the same process in placing an object. In Place Object I check to ensure that the only object on the tile is currently litter/rathole and if so check passable tiles of nearby objects.. For the diagnosis progress\nCode is precalculating the length of stay based on nursecount at the time patient enters\nhttps://github.com/CorsixTH/CorsixTH/blob/6e81bda1485e9ab40053623394d84f64e1544bff/CorsixTH/Lua/rooms/ward.lua#L140-L141\nIf we removed the division then in the loop_callback decremented length by the nursecount, which has to be recaculated (ie this breaks old save) the same thing is achieved, just it allows the diagnosis to stop/start/increase/decrease\nself:countWorkingNurses()\nlength = length - self.nursecount\nThen for not having patients leave until the end.\nhttps://github.com/CorsixTH/CorsixTH/blob/6e81bda1485e9ab40053623394d84f64e1544bff/CorsixTH/Lua/room.lua#L569\nto\nif not self:testStaffCriteria(self:getRequiredStaffCriteria()) and self.room_info.id ~= \"ward\" then\nThen it would be just allowing tired nurses to leave which I haven't looked at yet.\n. I checked the Origin one, nurses are allowed to leave (either picked up or tired) and diagnosis continues. With 0.60 and trunk, you pick up the nurse and all patients will leave paying for the service, even though they didn't stay the full length of the stay. Patients can't enter the ward unless its occupied by a nurse as expected.\nWith the Origin one, if you have a pharmacy and ward, and only one nurse eventually the nurse can leave and attend to the queue in pharmarcy also whilst patients are still in the ward and there is a queue.\nHowever, I believe the nurse may have a tendency to only change rooms when all the beds are full or the queue for ward is empty.. I've already ascertained this was at least a 'feature' in the original. I just happened to pick up the nurse in CorsixTH, patients leave and pay up. Effectively a cheat mechanism if you want to look at it that way, allowing you to build a smaller ward than you might normally need to cater for, pick up the 'last remaining' nurse and everyone disappears and pays up a little for your effort too.\nWhen I went to replicate in TH they stay and diagnosis finished and they leave even without the nurse there. I also ascertained the nurse will leave when tired - when beds are full or if queue is empty (beds can be used), to deal with other calls - they'll return to ward when the next room they are in has no queue, and are called to the ward again.\nLikewise dropping another nurse into the room as a patients stay is about to start, counts the nurse, when the count should be the lesser of nurses and desks (this is just a timing thing, with onHumanoidLeave not executing at that point).\nLikewise there is also this comment\nhttps://github.com/CorsixTH/CorsixTH/blob/b9339ffcd37aa3e50e85e3aefe62d7dd4652af74/CorsixTH/Lua/rooms/ward.lua#L127-L128\nAnd that behaviour is inconsistent with the original, and obviously not what happens now. As pointed out https://github.com/CorsixTH/CorsixTH/issues/1277#issuecomment-343266286 and my following comment, there is potential for a medium here. Noting the difference between the ward and the other nurse rooms, is that the nurse doesn't interact with the object the patient is using - which probably does allow them to leave.. Yes, diagnosis can continue without a nurse present. Patient leaves at the end. No new patients can enter of course. Fairly simple for the tiredness/pickup scenario, I've already played with that with a few edits. Handling calls to say pharmacy, and upon leaving ward, getting that call to stay in ward tripped me up at the moment. For your points, only the first one holds true to the original. Second and third points don't hold true to the original and for 4th I haven't confirmed either way the case. When I was mucking about with this, I had issues with the calls dispatcher where I had a pharmacy and ward, one nurse and enabled the nurse to leave. The calls dispatcher was always attempting to recall the nurse (as it is also the closest room once she leaves and gets a higher score) and she wasn't allowed to return to the room she was leaving or something like that.\nI've noticed that potentially the stays in a ward are too short also in Corsix than the original - I'm thinking that time in the ward is not linked to the quality of your staff member, but only diagnosis progress see #1340. I just haven't gotten around to testing this theory as yet.. I had assumed from https://github.com/CorsixTH/CorsixTH/issues/1277#issuecomment-347523238 that the original behaivour would be the favoured approach here, as there isn't yet a clear consensus. Your changes cover the nurse leaving when tired, but not the answer another call scenario necessarily - ie Beds full, nurse can leave to go to pharmacy, patients finish in ward and leave once their time ticks down, nurse will return if there is a call dispatch to return to the room and the pharmacy queue size is 0.\nI originally found the exploit of picking up the nurse and having the patients leave immediately, then started checking what the original did and found this other behaivour. At worst then the original ticks down the healing_amount at the rate of 1 per tick, but I have a feeling the original just does this no matter what - just I haven't got around to trying to track it down.. I meant more that the original behaivour would be the likely outcome as concensus hadn't been reached. Everything I've noted in this issue is observed, besides the reference to the Improving diagnosis process.\nThere are a few downsides to not progressing the diagnosis.\n- patients health continues to decline\n- staff have to respond to calls, could be issues as staff sometimes seem to wander\n- need to then check a staff member is in the room, whereas an empty room will indicate that no staff or no queue - admittedly there are other cues given\nThe nurses leaving probably wasn't noticed as much as the early levels you could cover it easily and probably have enough staff - a lot of the game is easily ignored and just continue. Later levels,  management goes up and its probably advantegous not to have to additionally micromanage the wards in addition to the doctors.\nFor example, diagnosis progress could continue but patient unable to leave until room is staffed again, slightly different to pausing progress, but still suffers from the downsides.\nAs Brainsample includes the getServiceQuality and mentions fatigue, fatigue in that regard impacts it linearly but you don't linearly become tired, hence in the diagnosis progress, the gbv.Tired limit is used to start to have that negative influence. Then do you double (reducing the remaining tick times by a half or some other patient related factor) ensuring the patients do leave and continue on but given a penalty still without having the micromanagement.. TheCycoOne refers to appveyor builds\nie latest master https://ci.appveyor.com/project/TheCycoONE/corsixth/build/201/artifacts. Sure. Pretty sure #1270 addresses this, depending on the orientations of the radiator and fire extinguisher. If they were on adjacent cells and back-to-back, the passable flags would  be reset to 'passable'. Then from memory, I think if you edit a room it calls World:resetSideObjects, which will restore the passable flags setting the passable flags to false, effectively blocking off part of the hospital in the process.\nDoing the above I replicated the issue on the beta, but with some code with #1270 already implemented I was unable to do that and TheCycoONE has already merged it.\nOn beta I deleted the pharmacy, placed the back-to-back objects again, moved the first one placed (makes tiles passable). Rebuilt the pharmacy up to that object (calls World:resetSideObjects)., now blocks the path.\n. For the ticks thing, I should have set it correctly as\nself.ticks = object_type.ticks - which is false - like all other Objects do\nhttps://github.com/CorsixTH/CorsixTH/blob/f539713e462821df8f793166912a737e57fd953f/CorsixTH/Lua/entities/object.lua#L40-L53\nA quick dive into the history and the context I believe is the 'soot' in a crash room was invoking an addHandymanTask call in the litter constructor. The afterLoad version < 54 check was added to remove the existing tasks for soot in crashed rooms, calling removeHandymanTask and in doing so, to interrupt handyman assigned to clean soot in rooms, the ~= \"cleaning\" was removed, with the upside it should fix the tasks, but alas I don't think it was due to the Entity constructor setting it ticks to true.\nYep currently must_happen prevents disrupting the task.\nFor cleaning up tasks already assigned, the minimum required is, but not necessarily providing coverage to potentially all edge cases litter afterLoad.\nif old < 121 then\nself.ticks = object.ticks\nend\nAs Litter:remove() still needs to call removeHandymanTask for when placing objects over litter, there is cleanup being done still there and that will remove the handyman task also. I'll look into the staff change to remove the task earlier as there could be edge cases I'm just not hitting.. Yup. I'll simplify this up to just drop dead in either direction where the patient is I think.. Without looking at any saves and ignoring the MaxDiagDiff and looking only at the 'kicked' issue, I think normal behaviour is as follows;\nBy default alien patients are only enabled for emergency.\nalien_dna_only_by_emergency = true,\nThe alien dna disease has\ndisease.only_emergency = TheApp.config.alien_dna_only_by_emergency -- TODO implement (there are no normal door animations, so they cannot go to GP)\nWhen a patient is spawned it checks to see if a patient can have that disease.\nlocal function isDiseaseUsableForNewPatient(self, disease, hospital)\nif disease.only_emergency then return false end\nIf its an emergency patient, the patient is diagnosed already and can go to treatment room directly not ever visiting the GP.\nGoing back to the initial post,\n\n2.wait for an alien patient to arrive (if it is not enabled to have random alien patients then wait untill a emergency is triggered?)\n\nThat would would mean alien_dna_only_by_emergency = false.\nI assume then, the patient then goes into the dealtWithPatient process ending up in this if statement\nhttps://github.com/CorsixTH/CorsixTH/blob/63afae1554a2abeba225d5865f5ea77b18e73c78/CorsixTH/Lua/rooms/gp.lua#L130-L150\nSkipping to the else at the end, as diagnosis is in progress which does this.\nhttps://github.com/CorsixTH/CorsixTH/blob/63afae1554a2abeba225d5865f5ea77b18e73c78/CorsixTH/Lua/rooms/gp.lua#L167-L172\nAs alien dna doesn't have any diagnosis rooms, this is taken and the patient is kicked.. I've taken a bit of a look at how TH does some of this logic, around the diagnosis progress.\nPatients are initialised with a diagnosis difficulty randomly between 1 and expertise.MaxDiagDiff for their disease\nlua\ninitialdiagnosisdifficulty = random(1, expertise.MaxDiagDiff)\nThen for each diagnostic step:\nThis difficulty value is subtracted away from the calculated diagnosis progress value each step\nlua\ndiagnosticdiff = currentdiagnosislevel - initialdiagnosisdifficulty\nThen there is a random factor calculated as: \nlua\nrandomSkill = 250 - randomRange(0,500)\nFollowed by what I'm pretty sure is\nlua\nstaffSkill = 200\nif 'staff' is Junior\n  staffSkill = -100\nThen a tiredness factor\nlua\nif staff.fatigue > gbv.VeryTired then\n  tired = -200\nelseif staff.fatigue > gbv.Tired then\n  tired = -100\nelse\n  tired = 100\nend\nI then think if the staff member is crazy tired\nlua\nquacDoc = -400\nThe room also has an influence, many have no influence, some have positive and some have a negative value, ie x-ray on invis patients. GP doesn't influence it.\nThe room factors that I can see are with values -400, -200, 0, 200, 400\nlua\nroomAdd = roomFactor(disease, room)\nAdd all these values up then add the the staff members ability level, then if that is greater than the current diagnosis level, increase diagnosis progress.\nlua\ndiagnosticdiff = diagnosticdiff + randomSkill + staffSkill + tired + quacDoc + roomAdd + staff.ability\nif diagnosticdiff > currentdiagnosislevel  then\n  currentdiagnosislevel = diagnosticdiff\nend\nIf it ever reaches 1000, they can be diagnosed.. A lot of reverse engineering :wink: and deducing information from other information, ie I started from looking at the 'hospital' data in the original saves, that lead to some information, then that leads to more information, then you can lean off that to extrapolate to other functionality, sometimes incorrectly.. Disease|Scanner|Blood|Cardio|Xray|Ultra|General|Ward|Shrink\n---:|---|---|---|---|---|---|---|---\nBLOATY_HEAD|400|0|0|0|0|0|200|0\nHAIRYITUS|200|0|0|0|0|0|400|0\nELVIS|0|0|0|0|0|0|200|400\nINVIS|0|400|0|-200|0|0|0|0\nRADIATION|-200|400|0|-400|0|0|0|0\nSLACK_TONGUE|400|0|200|0|0|0|0|-200\nALIEN|200|400|0|200|200|0|0|-400\nBROKEN_BONES|0|0|200|400|0|0|0|0\nBALDNESS|0|400|0|0|0|0|200|-200\nDISCRETE_ITCHING|0|400|0|0|0|0|0|0\nJELLYITUS|0|0|0|0|0|400|0|0\nSLEEPING_ILLNESS|400|0|0|0|0|0|200|0\nPREGNANT|0|0|0|0|0|0|0|0\nTRANSPARENCY|0|0|0|0|0|0|400|0\nUNCOMMON_COLD|0|0|0|0|0|400|0|0\nBROKEN_WIND|0|0|0|0|400|0|0|0\nSAPRE_RIBS|0|0|0|400|0|0|0|0\nKIDNEY_BEANS|0|0|0|200|400|0|0|0\nBROKEN_HEART|0|0|400|0|200|0|0|0\nRUPTURED_NODULES|400|0|0|0|200|0|0|0\nMULTIPLE_TV_PERSONALITIES|0|0|0|0|0|0|0|400\nINFECTIOUS_LAUGHTER|0|200|0|0|0|0|0|400\nCORRUGATED_ANKLES|0|0|400|0|0|0|0|0\nCHRONIC_NOSEHAIR|400|0|0|0|0|0|200|0\n3RD_DEGREE_SIDEBURNS|0|0|0|0|0|0|0|400\nFAKE_BLOOD|0|400|0|0|0|0|0|0\nGASTRIC_EJECTIONS|0|0|0|0|0|0|400|0\nTHE_SQUITS|0|0|0|0|0|400|200|0\nIRON_LUNGS|200|0|0|400|0|0|0|0\nSWEATY_PALMS|0|0|-400|0|0|0|0|400\nHEAPED_PILES|0|0|0|0|0|0|400|0\nGUT_ROT|0|0|0|0|400|0|0|0\nGOLF_STONES|0|0|0|200|400|0|0|0\nUNEXPECTED_SWELLING|400|0|0|0|0|0|0|0\n. I'm working on a big feature, just that this conversation I had just looked at this information the day before and thought I would let everyone know what I had found.. Sorry comments are probably a bit confusing, as I refactored and changed my mind a couple of times on the functionality, I'll fix that up with the commit being fixed up. Maybe I should have created an issue for discussion. I originally had one function, which I was going to call with true, false or nil parameter to set/recall/unset - unset is overkill.\nWithout the zoom, you could have 2 or more camera positions that are close and when you zoom right out it won't move, as the camera is limited, however with zoom, you can store a view that is zoomed all the way out, but just in typing that, sounds like a useful hotkey, a bit like transparent walls.\nBut with zoom feels better to me, but I haven't played much with the feature, as the intent really is to have a particular view that you can go back to easily.. It functionally works with the zoom, and it plays ok as it is so it is 'ready'. Opened as RFC and have rebased. onHumanoidLeave is called from the pickup action, and this is setting staff_member to nil. Then that leads to the staff:walkTo(trolley:getSecondaryUsageTile()) action call failing. Not sure exactly how this would differ from other rooms. But scanner seems to do more of the actions not through the callbacks which may allow for a cleaner interrupt.. Would be nice to see the save before the handyman issue as I worked a bit on improving that in 0.61.\nFor the stuck Reaper, that is a result of #1165 and fixed in latest master. Evidenced by the grims patient and the hospitals last emergency details - victims =5, cured = 3, killed = 4. Existing issue the handyman arriving in the wrong room see #624.\nI commented a little before with a different explanation but alas, taken a look and can see the slicers handyman position appears to be -1,1 pushing that tile into the pharmacy. Appears to be some sort of problem with the orientations handyman position not updating when orientations are changed.\n. With some more analysis and some more info, vomit waves appear to be vetoed when there is <=10 tiles with litter.\nA vomit wave duration lasts 5-10 days, reduced at twice the rate once <= 10 tiles are littered. However, in the original if more litter is dropped and it goes above 10 tiles, a new vomit wave will start.\n'Litter' excludes rat holes... Same issue as discussed in #1087, as its another doctor that has reserved the door (Dr in general diagnosis). To be honest I haven't looked at it much since raising the PR, which was more as I reminder for me to revisit it. I was going to push it again with a series of smaller commits, addressing particular aspects also so I can comment functions and more accurately comment some of the code. \nMost of my testing has just been in the first year also at one difficulty setting, so if you played it a bit more than that and across a couple of levels, it would be nice to know how that compares to the original.. That was the plan originally, I think I started putting some comments on some existing issues as well for that plan to be realised. Just if you had the other changes missing the corrupted annual report screen wouldn't make for a nice comparison for demonstration purposes and tuning the spawn logic was also done for comparison sake here.. Added log spam. dupe of #1156 . Ping @pschoffer . Looks good. Patient is 'insured' so the payments come later.\n-- All payment that goes through an insurance company a given month is paid two\n  -- months later. For example diagnoses in April are paid the 1st of July. I've seen something that might be related to this but haven't actually been able to get a build working again since vcpkg switch. However, for me I'v never been sitting there when its happened. I'd be running a hospital, walk away, come back (sometimes much later) on annual report screen so game is paused and there has been a crash. I believe it was audio related from stack trace I pulled once, and still haven't got around to the debug build since.. Admittedly it might not be the most elegant. I switched a more normal button call back I guess, and used  setToggleState calls, as if you engage looping, then click a toggle it becomes enabled, then undo the loop it was toggling the state again and combined with the possibilty of going back to a save the ui became inconsistent, but the update in draw probably would have corrected that anyway.\nI must admit these persisted funtions and the use of them confuses me a little but I guess one of the additional parameters was preventing it working.. The 'draw' changes effectively take the audio.background_playlist and updates the UI state to match.\nSo if you open in a separate run - background_playlist is reset to all tracks, ui will reflect that. Another happy accident was that if just before the end of month, and it saves state, then you modify it the next month, then revert to the save, it will update the playlist to match the latest. But yeah not persisting the jukebox entirely is probably an ok idea too.. I wrote a function to call the same code as Epidemic:evacuate. In doing so I was able to replicate the issues without having an active Epidemic.\nThe loop_callback in PsychRoom:commandEnteringPatient is executing endlessly, as the patient had kings_complex, the walkTo and UseScreen actions are added to the end of the action queue - repeatedly, so as the patient leaves the room, the walkTo is again being called but this time no object could be found.\nChanging just https://github.com/CorsixTH/CorsixTH/blob/b8e9d7ff500f357b8e7a6562e4aaec22c48ee102/CorsixTH/Lua/rooms/psych.lua#L97 to an equality check will prevent the repeatedness and fixes the issue.\nHowever will leave the doctor in processing the callback until another patient arrives.. Just took a look at this one and it appears the same issue as #1081. A despawned patient has the lock on the door. then it would appear that the rest comes from the edit room attempt/leave action, leaving the nurse trying to go to staff room, patient trying to walk to the next nearest pharmacy etc.\nAnd then there is litter somehow in the room at 68,30 which appears to come about due to some sequence of events that has allowed the patient to appear not in a room, ie Room:onHumanoidLeave called for the patient, but then unable to leave, maybe due to the truncate.\nThe reason the litter removal fails is due to a bug in the call to the remove method. Though I think litter in room (pee/poop too) would not be normal and the code that was changed was probably to support older releases where at the time, you just built over with no removal.. Surgeon door thing is probably the door reservation bug - CRABWICK in front of drinks machine has it reserved but he isn't on his way to the operating theatre.\nThat second one is 'same as #372'.\nAnd the original issue - patient navigates a door other than reserved. The door position is on the path to hair restoration, I assume then that the patient navigates the door, no staff, and leaves and reserves the door (reserve_on_resume) as part of the walk action, when it probably should interrupt and recaculate the path before entering or should realise it was the wrong room and recalculate. I was able to replicate on 0.62-rc2.. I was taking a look at the navigating door issue:\nhttps://github.com/CorsixTH/CorsixTH/blob/47b9ed6c3402f0bd9d63eb177ae6e7126237b6c1/CorsixTH/Lua/humanoid_actions/walk.lua#L203-L212\nSeem to be checking for walls only and then relies on the logic in navigateDoor to correct the situation where it might be more reliable to only continue if there is a door between and the destination room is the same as the room about to be entered.\nQuite easy to replicate the issue, put reception at back of hospital, wait for patient to enter, build room on path, walls it will recalculate, doors will knock and queue.. Something along the lines of the following works. I rewrote it as my tilde key is broken at the moment so all negation changed but I think it's a little more readable.\nThe first if statement establishes if there is difference in the rooms -ie at a wall or door - this is unchanged.\nflags_there.room will be true if the destination is in a room, false if in the corridor - \nI made the assumption if we are leaving a room, then we are at the door so we won't want to reroute to enter the corridor anyway and therefore set it recalc_route to true if there is a room on our path.\nThen the later predicate becomes:\nif about to enter room, and we are at a door and it so happens that the roomId is the same then cancel the reroute so human will enter the room.\nlua\n  if not recalc_route and flags_here.roomId ~= flags_there.roomId then\n    -- if going to the corridor we don't care as we are at the door\n    -- as this will be false we won't bother checking for rerouting\n    recalc_route = flags_there.room\n    local door = TheApp.objects.door.thob\n    local door2 = TheApp.objects.swing_door_right.thob\n    -- but we should see if this is the same room id we might want to go to and cancel the reroute\n    if recalc_route and (flags_here.thob == door or flags_here.thob == door2 or --is there any door\n        flags_there.thob == door or flags_there.thob == door2) and -- is there any door\n        map:getCellFlags(path_x[#path_x], path_y[#path_y]).roomId == flags_there.roomId then -- is it still same room id humanoid is going to\n      recalc_route = false\n    end\n  end\nShould point out #865 and I guess a few others (#655) may stem from something similar. This patch applied to 0.50 'fixed' #865.. I found an issue with my fix on this one, working on another fix.. Custome level file that you had on 0.61 not installed with this build?. That helps. Patient using the decontamination shower is 'going home' for some reason, but the room can't finalise the processing and make him leave in that instance.\nhttps://github.com/CorsixTH/CorsixTH/blob/b8e9d7ff500f357b8e7a6562e4aaec22c48ee102/CorsixTH/Lua/rooms/decontamination.lua#L106-L108\n. Brand new process, new game would work fine.\nNew process, load bad save game, exit that game/restart/load another working save (as its not working) - new game not working.\nMain menu can get a choppy - hence the: Then I manually have to click my way through the cutscene one frame pr. click.\nIts hard to guess the state before the save, but as the patient.going_home flag is true, the startAction handler for an empty action queue will not run either.\nhttps://github.com/CorsixTH/CorsixTH/blob/b8e9d7ff500f357b8e7a6562e4aaec22c48ee102/CorsixTH/Lua/entities/humanoid.lua#L462-L467\nBut in this case its like it already has done the startAction previously, kicked the patient but ended up wiht an empty queue again, though the patient does only appear to be finishing using the shower on loading the 6 savegame.\nGeneral diagnosis for example handles soon to be empty action queues:\nhttps://github.com/CorsixTH/CorsixTH/blob/b8e9d7ff500f357b8e7a6562e4aaec22c48ee102/CorsixTH/Lua/rooms/general_diag.lua#L76-L80\nI hacked in an idle action and then followed up with a dealtWithPatient call through debug scripts and the game continues as normal.\nBut knowing why the whole system appears to breakdown at this point, would be good to know also, I haven't dipped my feet in on that side that much yet. But suspect that the error processing isn't getting an entity passed to it, to turn off the 'ticks' of the patient leaving the shower. Re-enabling the timer, and then disabling ticks on the patient and things 'resume' there also, just with the patient broken. Ie norecovery window pops up as:\nhttps://github.com/CorsixTH/CorsixTH/blob/b8e9d7ff500f357b8e7a6562e4aaec22c48ee102/CorsixTH/Lua/app.lua#L961\nself.world.current_tick_entity is null and the handler isn't ever reattached, leaving eventHandlers[\"timer\"] = nil and therefore no app:onTick() calls are made. Or something like that. \n. Sure. Found another case where a patient has died, fallen, lava hole and grim reaper has spawned, grim has walked to lava and patient has stood up but then evacuate hospital has been called and patient proceeds to walk out of the hospital. This leaves the grim reaper stuck in hospital.. The decision to vomit appears to be when within the hospital itself, and the action is queued. However i don't think a leaving patient was supposed to vomit even within the hospital. Patient:canPeeOrPuke guards the vomit call.\nThis guards it:\nlua\nfunction Patient:canPeeOrPuke(current)\n  return ((current.name == \"walk\" or current.name == \"idle\" or\n           current.name == \"seek_room\" or current.name == \"queue\") and\n      not self.going_home and self.world.map.th:getCellFlags(self.tile_x, self.tile_y).buildable)\nend\nFor example: Patient at (65,64) in hospital has action queue [walk (128,64) must_happen, vomit, walk (128,64) must_happen, spawn]\nPatients previous action was use_object. So here it appears that the patients initial 'despawn' ran, it queued the walk action then tickDay with vomit appears to have 'interrupted' it without truncating the path.\nJust setting going_home in epidemic evacuation and then also only evacuating those that are not already going_home avoids this issue. You still get some 'goHome when patient already going home' as, I guess, 'Stripped' patients have the walk/use_screen actions 'disableTruncated'/must_happen and therefore the callbacks complete for 'dealtWithPatient'. However tickDay won't complete and initiate the vomit call anyway, as the patient will already be going_home (guarded by Humanoid.tickDay()). Patient is queued for decontamination shower. Health as in the dump is 0 so they were to die.\nThey are using bench, have a walk action to the decontamination room, and a meander and die action in the queue.\nUpon entering the room the queue changes to only; walk to shower, idle and use object. \nWhilst on the bench the patient already has self.going_home = true and therefore repeats the issue in #1431 of an empty action queue. This is loading the 0.60 save into master.\nNote clicking the patient doesn't bring up the UI, whereas other patients it does because\nhttps://github.com/CorsixTH/CorsixTH/blob/47b9ed6c3402f0bd9d63eb177ae6e7126237b6c1/CorsixTH/Lua/entities/patient.lua#L69-L73\nI'm not sure on a few other things, like the patient is infected, and diagnosed but hasn't met diagnosis policy, and not all diagnosis rooms yet visited, epidemic counter has counted down, and the announcement is about to come through of epidemic discovery. Not sure if any of these items contributed.. I believe I can replicate circumstances around this. Place bench in front of door ( immediately in front, ie closest that you can place it, facing the door)\nFor now I don't understand the when and how exactly a use object, queue, walk (which is must_happen = true, this could be a 0.60 thing, could be something else that affects it but haven't so far replicated the must_happen in master from a new game) circumstance arises but thats what is needed. Wait til a patient is queued and seated. I just set attributes[\"health\"] to just above the threshold and let it count down, and if needed tweak must_happen, can also call Patient:die as attributes only count down on endDay.\nPatient receives meander and die actions. Health is at 0. Place doctor in room, patient will leave bench and enter room, meander and die actions are dropped from action queue. Patient then continues to be processed as normal, but comfort stats will not as the die method set going_home to true and tickDay no longer processes.\nThe difference here is that the decontamination shower hits the error as they are supposed to be dying (going_home).\nPicking up the bench in this case and having the patient move to another bench, you can set going_home to false and call Patient:die and they will die (even with must_happen == true). It's only if the patient is using the bench in front of the door, that causes them to not move on (with the must_happen walk). I was able to replicate in the same save with different rooms/patients on master just not new.. Think I worked out the circumstances that leads to the must_happen. When the patient is say walking to the room and a check of patient thirst results in the heading to drinks machine, the original walk action is interrupted. That results in the truncation of the current walk, walk to drinks machine, use drinks machine and requeue of the current walk action. The original walk action to the room will have action_walk_start run with\nlua\n  action.saved_must_happen = action.must_happen\n  action.must_happen = true\nSo the must_happen was false to start with (from Room:createEnterAction), but once started will be true. When the drinks machine tasks interrupts the walk its not referring to the saved_must_happen, but must_happen which is now true and the requeue of the walk action to the room copies that.\nWhen the QueueAction and the walk to enter room is requeued the walk action specifically uses saved_must_happen, hence if not interrupted by the drinks machine, the queuing gets must_happen = false.\nOnce in the incorrect state and the proximity of the door in the process, the original issue just requeues the patient, even though the patient is 'dead' and should wander off and die. If a patient is one more tile away, logic somewhere allows them to wander off and die instead when they reach the next tile.\n. Just making note here that in the PR it was noted there was some code in need of a refactor. I believe I have another issue that could be addressed at the same time with that refactor and documenting it here for the future.\nAny interrupted walk, like those original ones here will also unexpect the humanoid from the target room.\nhttps://github.com/CorsixTH/CorsixTH/blob/9de46b728c61fedf96cd1120a8040af328a55fa8/CorsixTH/Lua/humanoid_actions/walk.lua#L90-L97\nWe probably need to alter the current actions is_entering after requeuing the original entering walk and modifying that if next room check to include an is_entering check. That probably includes some other cases, like already handled with SeekToilets elsewhere.. Similar to 1436 but different enough. Patient:canPeeOrPuke and Patient:setTile are checking buildable flags already to determine if in the hospital - except the external tiles against the wall of the hospital are buildable. Nearly every other map I've found includes a section of non-walkable tiles around the perimeter of the external walls which avoids this issue.\nSo this might be more of a map issue. The hospital/buildable/owner/parcelId flags are all set as if they were inside the hospital as the tile is part of constructing that wall.. Holby in this case which we are shipping in the custom campaigns. I haven't checked if there are any others with the same sort of issue.. Same as #1240. Seems only demo text in Simplified was updated in that one.. Appears the level file is incorrect, it is configured to lose if reputation is above 200.\ngoal.max_min_lose == 1, therefore 569 - 200 * 1 > 0, needs to be set to 0 to lose when rep falls below 200.\nhttps://github.com/CorsixTH/CorsixTH/blob/553adf362dc8c1cf5e21fc386b961f49852095eb/CorsixTH/Lua/world.lua#L1360-L1375. interwebs. Yep, I didn't update the issue, but I realise I made a mistake in that - the staff:despawn was being called - but it was the Staff:tick and the action being called that was stuffing it all up.\nI haven't been able to find an obvious issue with destroyEntity, ie litter removal is also called from an action and happens all the time but we are probably only talking about 1 or 2 animation ticks when they are skipped because of that removal.. I've done 3 solutions to this problem, as I noticed it before but got side tracked. I implemented a fix to change destroyEntity to set e.destroyed = true and processed in a loop after the enitity:tick() avoiding the 'tick' also within that loop.\nAnd I believe with the additional check in entity:tick anyway, it would be just as good to process self.entities in reverse.\n```\n  for i = #self.entities, 1, -1 do\n    if self.entities[i].destroyed then\n      table.remove(self.entities, i)\n    elseif self.entities[i].ticks then\n      self.current_tick_entity = self.entities[i]\n      self.entities[i]:tick()\n    end\n  end\n. I've noticed the same logical bug in Patient:falling, vomit and pee methods, I'll push another commit to cover them also.. I assume on the cleanup - there being 4 bits of code that basically do the same thing - that a refactor is in mind into a single function call. In preparing another PR I found some minor cosmetic issues in game around how that bit of code functions, so I plan to include it there, if that PR doesn't get up, then I can pull it out from there.. a) It will increase by the last increment each month, it needs to be set to 0 to keep population growth steady\nb) that population playerhospital.population is ratio of local player spawns, ie from 0.25 initially of total spawns, not a count of the total patient population.\nCoffalot level file is missing the popn entries in level file, so it is going to be working differently compared to a file with them populated. I haven't observed what that would do but the monthly spawn increase appears to be 1. So with nothing to stop it appears it will forever increase. And in this case also spawn_rate is 89, and population is 0.699\n. Just checked the code, base_config.lua initiates and levels are to override. As coffalot.level doesn't this stay in affect.\n  popn = {\n    [0] = {Month = 0, Change = 4}, -- Standard: 4 patients the first month.\n    [1] = {Month = 1, Change = 1}, -- Then increase by one per month.\n  },\n. I used this save for some testing and found the rooms were broken from #1104 which may have exacerbated the ability to process patients leading.. Original looks something roughly like this:\nThey appear most effective in training 3 or less (count of occupied lecture chairs).\nThey impart ability at the rate of gbv.TrainingRate / (number of skills being taught *class-effectiveness) to each trainee or 1 if the maths results in < 1. The number of skills is related to each individual trainee. Ie a trainer with surgeon and research, training a surgeon, will only impart 1 skill. A trainee with no specialist skills, will have a number of skills being taught = 2. Number of skills being taught I believe is also always set at 1 to start with an incremented for each specialist skill. So values can range from 1 to 4 and the examples above should be incremented.\nThe opportunity for training appears to happen most ticks, however it seems to be controlled via a check. Result of random() % trainer_ability (trainer ability is the scale of 30-1000 junior/doctor/consultant levels driven by this) is greater than each individual trainees ability - they gain ability. As that modulus check is done, in theory, a junior doctor will be more likely to gain ability than a doctor.\nThe specialist skill set is a bit more complex, but is done at the same time for each individual doctor.\n3 different cases\n10% of chance using the bookcase: #gbv.TrainingValue[2]     20      Bookcase\n10% of chance using the skeleton: #gbv.TrainingValue[1]     15      Skeleton\nsome other factor which does nothing\nand the rest is project: #gbv.TrainingValue[0]      10      Projector\nThe training value goes through the same reduction ie training_value / (number of skills being taught * class-effectiveness)  for each trainee, with a minimum of 1. This is added to each skill level until the trainee exceeds the threshold.\ngbv.AbilityThreshold[0]    75      Threshold at which skill is granted - SURGEON\ngbv.AbilityThreshold[1]    60      Threshold at which skill is granted - PSYCHO\ngbv.AbilityThreshold[2]    45      Threshold at which skill is granted - RESEARCHER\nI use class-effectiveness as being 1 for 3 or less trainees and > 1 as class sizes go up.\n. Appears to be deterministic as its incremented each time until surpasses the threshold for the specialty. Still encapsulated in that random mod check. Note this is roughly what is going on.. They are the same basic formula - variable / (specialties * effectiveness). Variable changes. When I find the time I'll trace through to confirm. TrainingRate only applies to the ability, and TrainingValue only applies to the specialist skills.\n. Taking a look at Corsix, a training room (minimal room will have a training_factor of 5.0).\nStaff:tickDay called everyday initiates the training calculations.\nBelow assumes 1 trainee and 1 consultant surgeon.\nFor general skill, say with 1 trainee and 1 consultant (minimal room, no bookcase/skel) a delta factor of: 5.0 / (200 * 12.0) ~ 0.0021, that would appear then, that it takes 1/delta = 480 days to actually go from 0 to 1000 ability, with the threshold at 0.8, only 390 days. If trainee is a doctor (just at 300), its only 240 days.\nNow lets look at surgeon threshold of 75.\n5.0 / (75 * 12.0) ~ 0.0056, that would result in 180 days to go from 0 to 1. So a doctor with general skill of > 0.425 would promote to consultant (0.8) faster than gaining the surgeon skill.\nWith bookcases/skeletons those delta values grow and considerably speed up the process.\nBack to my rough calculations from the original, generalist skill will increase 20 at a time = 40 / (2 * 1) (this is a bit different to my earlier analysis). or 50 'training ticks' to go from 0 to 1000. For specialist skill, with just projector that is 10 / (2 * 1) = 5, and the threshold for surgeon is 75, therefore '15 training ticks'.\nFor the minimal doctor scenario, (800-300) / 20 = 25 'training ticks' and therefore the maximum doctor ability to ensure skill gained is 800 - (20 * 15 'training ticks) = 500.\nTraining in the original is guarded by a skill level check also so some trainees gain a skill when others don't, hence 'training ticks' and also the threshold changes per difficulty so there are different scenarios.\nYet to confirm both lots of analysis.. Debugged the original. The skills are updated as above. The 'training ticks' in the original vary in time. The cycle of animations controlled I guess by some random number generator. This controls how many times the training doctor, gets his pointer out, puts it away, pulls it out again, puts away and then finally gestures to turn 'off' the project. At this point the 'training tick' occurs and the cycle resumes with a turn 'on' gesture to start the process.\nThe formula 40 / (2 * 1) might be the maximum for teaching 1 or more skills (2 as 1 is general, and 1 is specialist), I'll have to confirm this. So in my test it would tick up by 20 on the general ability, and 5 on the specialist skill. Once surgeon capability was gained, the general ability ticked up to 40. Some 'training ticks' like reported don't modify unless the random() % trainer_ability > trainee_ability.. There appears to be a few annoying gremlins with timing here. This error is thrown when the swing door is ticking at the time of the room crash. Easy fix is to put a guard in Room:tryAdvanceQueue for example to check that queue is not nil. Like so\nlua\nfunction Room:tryAdvanceQueue()\n  if self.door.queue and self.door.queue:size() > 0 and not self.door.user and not self.door.reserved_for then\nBut I'm unable to reliably hit this one issue. If the door is in use a bit more, the swing animation is still in progress after the objects in the room are destroyed. So maybe also in closeDoor if its ticking, set timer so door animations can switch back on next tick.\nSometimes I get another one where the patient tries to enter the room after the crash. As a work around I just put in Door:closeDoor() which will interrupt the walk. Hunch is this is related to the drinks machine/must_happen issue.\nlua\n  local map = self.world.map\n  local x, y = self.room:getEntranceXY(true)\n  map:setCellFlags(x, y, {passable = false})\nBut I also see some weird walk behaviour from patients - for example the bench near the drinks machine. Patients will enter from the west side and 'into' the bench tile. But after the crash room, they may also go out the same way, then 'teleport' to in front of doors or benches further up.. That is probably #1487, the easiest workaround is to pick them up and place the handyman in the room, but that room is exploding so you probably want to replace the machine to prevent the room crash.. Sounds like the door reservation bug, and they might be coming in to water plants. It is how I replicated #1487. In that instance editing the room and destroying the door, destroys the reservation. Feel free to upload save to #1487 and I can take a look.. Dupe of #1104. yeah I also removed magic numbers from the rest of it, tested it and it looked ok still.. Thats if any object but not if its litter prevent the door being placed. Litter is removed from all tiles inside a room, so its only outside where this becomes an issue. The other thing is that as it is an 'or' it only breaks on particular room orientations as it may check inside the room first, find the door and skip the rest of the statements.\nNothing stopping you building a room with a door where the adjacent tile in corridor has litter. Unfortunately when I was testing the other future pr, I had vomit everywhere that then resulted an in infinite loop of recalculating routes, and upon checking the thob found the it was 62 instead of 3.\nThe old walk code would redirect only where there was a wall found, so it could have also been entirely possible at one stage to build a room on the path with a door and therefore just walked over litter as it was never rerouting unless it hit that wall.. I realise that I don't need that check, around updatePercentages as I have excluded in the code updateNotCuredCounts which has the rep hit. So I do think I can get away with just removing that if, it doesn't do anything anyway.. There are some issues here I need to address, one - ipairs as Patient:despawn calls Hospital:RemoveByValue via RemovePatient the other is I bad copy pasted from another branch where I was side by side testing this with updates and bungled the update/setDynamicInfo.\nFor the Patient:despawn issue I could call Humanoid.despawn(self) which enqueues the despawn action eventually and have that then call the Patient:despawn method as it currently does to finally remove the patient. But this then delays the patient from affecting warmth/thirst attributes as it currently also does with epidemic evacuations, but for everyone 'going_home' this would be the case.. I was just checking the original and how the stats progress dialog looks, when a patient is outside the bounds of the hospital - they don't count to the patient count (on town map) or affect warmth/thirst/happiness status.\nHowever, if you send someone home and they are within the bounds of any walls, then they contribute to the statistics, if they reenter a building they recontribute to the statistics. They leave a building they drop from the statistics. So patients 'going_home' now, are dropped early as Patient:despawn calls RemovePatient. Which might give me scope to use the Humanoid.despawn(self) option and leave the removal from the hospital to the SpawnAction, however then adjusting stats to deal with patients between buildings outside the hospital.\nLikewise they are also added too early to the stats, before they enter the bounds of the hospital. Which I thought I mentioned in another Issue but may not have got to it.. This should be all ok now. In some testing I think there might be an issue with the latest changes, I'll mark it RDY again once I can hopefully confirm the issue, just I have a few changes to fix other issues that cause my other changes to break.. Merged. I can recall testing each of the individual fax changes, by removing/adding rooms and hiring/firing staff. There are a few minor things, like a commented out assert that should probably just be removed, and the other concern I had at the time was around translated strings which I didn't switch languages on to check either.\nAnd I included the unregister callback warnings, which makes for ugly game logs when executed which I think is the reason I haven't marked as RFC/RDY as yet. Getting a review on the current implementation and I'll rebase, fix app version, the commented assert and run it through some tests again.. Change back all the addKeyHandlers in afterLoad functions\nCreate a new 'handler' for afterLoad functions to remove all the old key bindings, then also register your new addKeyHandlers. This will be guarded by the oldversion < newversion check and and you change the SAVEGAME_VERSION see my previous PR #1314 just this isn't unregistering the old keyHandlers This covers your last 2 points. Old saves remove and register the new hotkeys binding, and new games, ignore the afterload change.. Thanks @TheCycoONE I was coming back to fix up some of my comments. Question though as the key configs will be centralised to the file is it worthwhile passing the table still to add/removeKeyHandler rather than just the 'key' for the app.hotkeys lookup.\nlua\nself:addKeyHandler(self.app.hotkeys[\"global_fullscreen_toggle_alt\"], self, self.toggleFullscreen)\nto\nlua\nself:addKeyHandler(\"global_fullscreen_toggle_alt\", self, self.toggleFullscreen)\nand have the keyHandler routines deal with the lookup?. Yes state is persisted in the save. Hence unregister all handlers and reload the latest key mappings is required, otherwise the old mappings will work and not the new ones. Which is what your comment regarding https://github.com/CorsixTH/CorsixTH/pull/1486/commits/db9ad369d8affe396aef885517564ed88fc9e9fc might have been talking about here. App:afterLoad prevents afterLoads running again\nhttps://github.com/CorsixTH/CorsixTH/blob/e14d4ffa993a1d3fa71b6bca293d77602f388c74/CorsixTH/Lua/app.lua#L1419-L1423. Probably as we're just talking UI elements, call, ui:afterLoad within that block. Most should just be registering keyHandlers which you need to do. This would then avoid the map/world afterLoads running. @TheCycoONE might have a different opinion as he is more familiar with persistence. I normally do a check (well I moved to vs2017 and now have the hook to check), but as I use notepad++, I just search the same reg expressions [ \\t][\\r\\n].\nAs for .luacheck, its not part of the PR (yet).. When numlock is on, modifier numlockactive is true. UI:onKeyDown I think is where you need to take a look and initKeyAndButtonCodes where they get remapped.. Appveyor cache appears to have been invalidated, and the vcpkg version we are pulling refers to a now invalid bzip2 domain for the package. Happened on my local vcpkg builds too a while back but I sat on raising an issue in case the domain came back - and time slips by.\nProbably just need a separate issue to bump the vcpkg commit like #1415 ( I know a github mirror has been setup for bzip2).. I got the same on an x86-windows triplet here. I made a small tweak in ffmpegs configure to avcodec_suggest to add ole32 but see you added the upstream defect.. Believe that is 0.60 and not 0.62, 0.61 introduced some changes around handymen, maybe or maybe not that would help. Though a good chance it wouldn't restore the current save to an operational state.. Thanks for the hint I found that the wiki actually had a hasbit sample routine, and implemented that. Just to cover this off - I've updated the code to support the 3 tile blueprint for swing doors.\nThe doorWallOffsetCalculations function returns nil for oldx_mod/oldy_mod depending on orientation and the (i -oldx(y)_mod) calculation performed within.\nThe old code would end that loop and then call\nmap:setCell(self.blueprint_door.floor_x, self.blueprint_door.floor_y, 4, 24) which would be the centre tile of the door.\nBut that is just one blueprint tile being reset. So upon adding the support for the blueprint for the entire 3 tiles of the swing door, all 3 tiles need to be cleaned up, and the supporting calculation is done on the orientation.. I have another push for comment, as this actually needed to be a bitwise operation and due to lack of 5.1 support for bitwise operations I've got a bit of a workaround in place to deal with that.. I have 5.3 supported syntax for the bitwise operators in utility.lua - specifically bitOr and the value1 | value2\nlua_tokenise needs a slight alteration to include them \noperator = Ct(C(P\"..\" + P\"<=\" + P\">=\" + P\"==\" + P\"~=\" + P\">>\" + P\"<<\" + S\"+-*/^%<>#&|~\") * Cc\"operator\"),\nTravis still fails as it doesn't use lua 5.3 (yet) - luacheck on utility.lua fails for the same reason, thats not too much more work to build lua in the travis build.. Ok, I see the issue now. Just my misunderstanding.\nI could do something like the following for those functions and as long as 5.3 was compiled with compatability on it would use the bit32 stuff, else fall back to the old stuff or just use the old stuff (which is probably the way to go). Just that bitOr routine isn't a real Or - it Ors a single bit only effectively\nbitOr = bit32 and function(value1, value2) return bit32.bor(value1, value2) end or function(value1, value2)\n  return value1 % (value2 + value2) >= value2 and value1 or value1 + value2\nend\nhasBit = bit32 and function(value, bit) return bit32.btest(value, 2^bit) end or function (value, bit)\n  local p = 2 ^ bit\n  return value % (p + p) >= p\nend. I have found a defect with this logic that I will push out.\ntile_flags.buildable will be false for every door when a bench footprint 'passable'/shareable tile is in front of the door, it basically only needs to check its owned by the player, as the rest of the code would check the object footprints for built on tiles. I'm not up to scratch on lua/c integration so I took my lead from an existing routine (l_surface_set_blue_filter_active) which is another void method call with same argument type, not doing a push back to lua and returns 1. I see others that have a lua_settop(L,1) return 1 when there is no explicit push. Maybe that is another bug.. dang it, I was testing it, and did undo but must have did it on my repo instead of my test folder. self.world.map.level_config.gbv.DisasterLaunch, to source the configured level value, ignoring difficulty requirement then.. spacing around operators. This change I believe fixes the last issue in #133. Believe in this issue the callback may still be registered so when the edited room exists again the callback was executed requeuing the seek to the room. Yet to attempt to verify. Calling the bottom_panel:removeMessage calls UIMessage:removeMessage twice and the onClose is nil.. Recalculating message content, only issue here is I need to validate if getRoomNameAndRequiredStaffName will return a ward message, if checkDiseaseRequirements returns just it, if op theatre exists, I just can't recall seeing a fax with 'ward' and nurse on it. The staffclass_to_string was just taken from some other code. The callbacks for hiring and firing.. Believe I had to do this for the callbacks to persist correctly. Like Patient:updateMessage except we have a room type to get the staff string for this time.. Restructuring the code a bit here as one of the 'differences' between corsix and th. Seek diagnosis or research rooms, and remove the message if it exists (this cleans up interrupted seeks). Similar logic for treatment as diagnosis, just checking if we alos have outstanding treatment requirements. If the room exists and it crashes or edited the room or deleted the room - we also want to update the message so removed the research check.. Callback for when a staff member is hired/fired to update the message will also enable the Research button on the fax, not just the change in message. I haven't yet pulled this down to give it a try to visualise the change, but these image_storePosition/recallPosition are a list alt and ctrl modifiers for, 0 through 9. The change as it stands can only alter the default modifiers and leaving the numerical string as the 2nd element. I don't have an alternate suggestion.. Yes ingame_storePosition_0 etc is the solution, but if moving from the defaults to something else and a choice is made to rebind a subset. Say 0 to 4 is rebound to shift, QWERT, but 5-9 is not included and use the default.\nDo we just leave the defaults for 6-0 or unbind them. I'm probably over thinking it and leaving defaults is fine and having them potentially disjoint is fine. As you could just want to remap a subset like the 6-0 to QWERT under the 1-5 row and then there is no need to explicitly set all of them.. ",
    "alfaproject": "Sorry, no save game. The last auto save is already of the next level. ):\nBut the issue from googlecode seems accurate though.\n. ",
    "treo": "You can ignore whitespace when merging.\nSee:\nhttp://stackoverflow.com/questions/9776527/git-merging-without-whitespace-conflicts\nhttps://github.com/blog/967-github-secrets\n. ",
    "GitBranch": "Yes, I am interested to clean it up.\n. Should I start from scratch?\n. ",
    "Zebediejus": "BTW, most patients get stuck when I discharge them from hospital.\n. ",
    "JoeButler99": "I was rushing, mostly because I wanted to play! But yes a branch would have been better.\nI don't know what's causing it, I'd guess an inconsistency with concatenation in Lua or Windows line feeds - Although I just looked and I don't see bad line feeds\n. @MarkL1961 @TheCycoONE Made a new pull request:\n251\nChanged the way the config_finder concatenates\nI went with the suggested concatenation and used the multiline for the bits inbetween. Its working ok for me on Ubuntu 13.10 Lua 5.1.5, but I've changed many lines so well worth testing\n. ",
    "romy4": "Linux mint 16, i86_64, g++ v.4.8.1, SDL2 headers are present in /usr/include/SDL2\n. I've also made changes in system FindSDLPackage.cmake: added include/SDL2 prefix and added SDL2 name, but it had no effect\n. Okay I have installed SDL-dev v.1.2.5 simultaneously and the result is same\n. ",
    "ghost": "No save game, sorry. While I remember, after loading from the autosave (which is now gone), I was able to click away from it and keep playing.\n. Tutorial was on. Version is latest, OS is WIndows 7 x64.\n. No, sorry! I wish I did as I know that makes it a lot easier to fix it.\n. I'm now on 0.30, the old version was in a Debian package I found. I loaded my save; the queue size for the room is 0 yet the man is still standing outside dying!\n\n\n. Will this happen again in the new version?\n. No, sorry.\n. Right clicking is the edit/move shortcut for items. If it's still not working could you please post some details such as: Your CorsixTH version, Rendering Version (SDL, OpenGL or DirectX) and perhaps a save file?\n. No problem. It's a bit misleading that the edit button says \"Edit rooms AND items\"\n. Thanks for the reply guys. I have fixed this now to affect patients with the specified disease so if they have something like \"bloaty head\" and your prices for that disease are high then their happiness will be affected. To make it seem less direct I have also made the process slightly more random because not all patients will be upset with high prices (only most will). \nBut I completely agree, this feature will need to be examined a bit further as it affects more than just happiness and reputation. Anyhow I hope to make more commits to new features in the near future :)\n. You bring up a lot of good and necessary points Mark and I can't wait to further implement this feature. I think the first step would be to compare prices with the reputation of the hospital as you stated and then check if the patient has insurance. Do you think it would be wise to implement a \"wealth\" attribute to determine how wealthy the patient is and use this to determine how willing they are to pay? \nAs for how this affects the other hospitals I will need to look further into this. Thanks for the comments again guys :)\n. Thanks for the comments again guys. I have made some changes based on @MarkL1961 comments. Each patient now has a wealth value that is randomized on spawn (low, mid and high wealth) and these now affect how the patient reacts to the increase of prices. In addition patients with insurance will overlook all changes. Here is a rundown of my new changes:\nLow Wealth Patients - These guys are very unhappy with most price increases.\nMid Wealth Patients - These guys vary in their opinions about prices (some dislike them and some don't)\nHigh Wealth Patients - These guys generally don't really care about price increases or decreases.\nAlso, @mrtnptrs my code has no input on what the hospital reputation should be anymore as it solely affects patient happiness. Thanks again guys, I would love to hear your input.\n. I have made some more (finalized) changes. Each patient will now feel more/less inclined to pay for a cure based on the hospital's reputation for dealing with the disease. These changes till need to be stabilized and extensively tested.\n. Hey @Grimdoc, thanks for pointing out some flaws - I will get on them right away. The patient's refusing to pay is next on my to-do list but I'm not sure about the icon bug: my code does not handle that.\n. no I haven't use any new font file :(  look how is it ? I can't see \n\n\n@MarkL1961 \n. I didn't find config.txt !!!\n\n@MarkL1961 \n. I couldn't find it. i'm tired. i'm using OS X 10.10 i have theme hospital files and I use CorsixTH.app to play. any help !!!!! with fonts issue\n. unfortunately,  I've installed from somewhere :(\n@MarkL1961 \n. Guessing we'll want to eventually update Corsix's keyhandler to use SDL_Keycode Values so that this kind of issue is automatically handled.\n. Wow, this editor has really come along, great job!\nAs to the slow performance comment, I only notice it when trying to create a large area with the selected tile. (Although, as I am typing this, I'm noticing lag while I type, which may be related as the map editor is running in the background...)\nAnyways, awesome work!\n. Thanks Ryan.\nI appreciate your reply, but I've done it once. After a few times of running the game, I got the issue)\nThank you again!\nP.S. I really was surprised to play a game I got in childhood: seems I'm getting old, as it was just 15 years ago! Good for you for that stuff! \n. @Alberth289346 \nDebian stable does not have the packages that the compile instructions offer me to install.\nI've received several dependency errors trying to get all packages installed, mainly when trying to install the LibAV packageset.\n. @emorrp1 The stretch version depends on a lot of things that Debian stable does not have, nor wishes to install due to a bunch of broken dependencies. Is there anything you could do to make the package more stable-friendly?\nI do have backports enabled, but have never found corsix-th in the list of available packages.\n. I was more thinking about using libraries that exist within Debian Jessie stable rather than Debian Stretch testing.\nOr packaging local versions of such libraries where possible.\n. @TheCycoONE Squashed.\n. I tested for this behavior a few days ago on a machine running Fedora 23, but I was not able to reproduce the issue. Of course, this was while using the demo data, so there is that difference, at least.\nAside from that, I've noticed Gnome (or possibly Fedora itself) having some drawing/refreshing issues from time to time, so maybe this could be related to that type of thing as well.\n. I'm having this problem too. The version of luasocket is 3.0~rc1+git+321c0c9-1\n. Yes\n. I'm afraid I can't seem to be able to get any version of luasocket to compile. There is however a bug filed against the luasocket Debian package which looks like the problem to me\nhttps://bugs.debian.org/cgi-bin/bugreport.cgi?bug=822825\n. Done\n. Thanks to you both for the feedback. I think the repeat room bothered me, but I definitely see its value over something generic like data.\nI will look into more important issues/features to address in the codebase/project.\nThanks again. \n. My apologies, this is already in another PR. :)\n. This issue is blocking and prevents me from ending the game :-(. Thank you very much, I removed these  rooms and now it seems Ok. What is weird is that there is another entrance in the building, which would allow to access the new room.. @TheCycoONE : I did exactly what @MarkL1961 explains: I first built the room close to the \"curtain\" (false wall), then I extended the hospital.\nThanks to your advice I am not stuck anymore :-). I fixed this issue in PR #1405 , when \"staff leave rooms\" is disabled the staff will stick to their rooms. Further enhancements could be done so specialists may return to their preferred posts even when the option is enabled, but that will reduce the micromanagement, so it's debatable.. With the grim reaper stuck it's a more serious problem, because when he's spawned again for another dead patient, the game crashes without any output whatsoever. Until a fix is found, people who want to play without this bug can find Lua/humanoid_actions/die.lua in the CorsixTH folder, and replace\n```\n  -- Bloaty head patients can't go to hell because they don't have a\n  -- \"transform to standard male\"/\"fall into lava hole\" animation.\n  if humanoid:isMalePatient() and humanoid.disease.id ~= \"bloaty_head\" then\n    if math.random(1, 100) <= 65 then\n      humanoid:setTimer(fall_anim_duration, action_die_tick_reaper)\n    else\n      humanoid:setTimer(fall_anim_duration, action_die_tick)\n    end\n  else\n    humanoid:setTimer(fall_anim_duration, action_die_tick)\n  end\nwith just\nhumanoid:setTimer(fall_anim_duration, action_die_tick)\n```\nwhich will permanently disable the grim reaper.. I'm not familiar with the project so I can only suggest a pseudo-code. Each room should have a \"coverage\". Every time the player changes the max queue or a new room is created, the coverage is recalculated:\nrecomputeCoverage()\n{\n  foreach room\n    total += room.max_queue;\n  foreach room\n    room.coverage = room.max_queue / total;\n}\nWhenever a patient has queued for a room, the room's usage is recalculated:\npatient::queueRoom(room)\n{\n  room.queue++;\n  room.usage = room.queue / total_patients_for_this_disease;\n}\nNow when a patient wants to queue, it will check what room has the smallest queue:\nforeach room\n{\n  if room.usage < room.coverage\n  {\n    current_patient.queueRoom(room);\n    break;\n  }\n}\nif current_patient still not queued\n  queueRoom(last_room)\nThis should also fix the bug where max queue being set to 0 is ignored and patients are still queuing at the door.. Same or maybe another bug related to this issue: it seems that in some rare conditions a patient is invited to leave the room and requeue, like when a doctor or nurse is too tired and wants to go to the staff room, but the Room:createLeaveAction seems to be interruptible in some special cases, in walk.lua at line 64!\nSo a patient tries to leave the room, that action is somehow interrupted, and then the patient ends up trying to requeue while still inside the room, which is not covered by a case, therefore the patient gets stuck waiting for Christmas and getting the whole room stuck with them.\nMy quick fix for now is to comment out \":truncateOnHighPriority()\" on line 89 in function Room:createLeaveAction found in the room.lua file. I don't see a reason why the leave action should be interruptible as it only invites to create hidden bugs, I think someone was overzelous about it.. It seems it's the same as #1329 so I closed it.... Yes, if the staff are not allowed to leave their rooms, they shouldn't just jump and help if they are already allocated to a post. The old code rendered the \"staff leave rooms\" option useless by:\n\nallowing free staff to help already occupied stations when their owners were resting, taking them as their own\nallowing staff that owned a room to answer calls right after leaving the staffroom, abandoning their old posts\n\nSo for now I fixed the \"staff leave rooms\" option, but further code can be added to enhance behaviour.\nThe simplest enhancement would be to update how the priority works so that specialists will favor their own skills, plus a small change in the code so that the staff will also check for calls in between consults. Therefore, a surgeon that works in the GP's office would leave for OT if needed there, even if there are still patients waiting outside GP's office, because that's his specialty, then another doctor would naturally come in and help with the GP too. I think this would require the least changes to the existing code and with very cool effects.. Fixed a code inconsistency that allowed staff to be rerouted while on their way back to their room. Now the \"staff leave rooms\" option should be respected 100%.. @Alberth289346 : Having the staff shuffled to allow micromanagement when \"staff leave room\" is enabled is one thing, but if it's disabled then it's a bug. What's the point of that option if the staff can leave their rooms at the first call? Even if the original game somehow allowed that, then it's still a bug and the purpose of CorsixTH is to fix those bugs and enhance the original. Looking back at issue #1290 there are lots of people bothered by that behaviour, me included :) Since now we can have custom maps, think about very large maps with 3+ OT, where all you do is bringing back surgeons to their OT... not fun.. I've included this changes in the \"Private Clinic\" patch, available on the CorsixTH website, if you are going to use my code, please include my pseudonym \"LeDocteur\" in the copyright list of each modified file.. I've included this changes in the \"Private Clinic\" patch, available on the CorsixTH website, if you are going to use my code, please include my pseudonym \"LeDocteur\" in the copyright list of each modified file.. @TheCycoONE : I think it would be a good idea to also have a \"night build\" available for download, at least from time to time, many people posting issues here are not developers and only come here from the main CorsixTH webpage to report bugs.. It must be something with your installation, if the game would just fail to run it would be obvious to everyone lol.\nTry to uninstall the previous version, delete the CorsixTH data folder from the Documents and Settings/\"user name\"/AppData/Roaming, and then reinstall the 0.61 version. Avoid overwriting versions.\nYou can also try to download the portable version, I am personally running the portable version of CorsixTH in Sandboxie to be sure it's not messing stuff on my computer and I didn't see any problems so far, but I'm using Windows 7, not 8.\nIf there really is a problem with the Windows 8, then you should be able to run CorsixTH 0.61 in compatibility mode:  http://www.dummies.com/computers/operating-systems/windows-8/how-to-run-older-programs-under-windows-8/\n. ",
    "lgdolman": "https://dl.dropboxusercontent.com/u/94371916/Autosave2.sav\n. Step by step is to simply follow the steps in campaign mode and when asked to finalise the GP office nothing happens. \nYou can make a GP office normally in the same level without issue it is just that dialogue window that causes an issue.\n. Looks like it i'll update there.\n. ",
    "voidnothings": "Yes but it's disabled. I tried recreating the research room but still the same.\n. Thanks Mark. \n. Thanks for pointing out the right click trick. It works as you stated. \n. ",
    "nicolaselie": "Hi,\nI'm the original author of the translation (chrystalyst). Thank you for your correction.\nHowever, I disagree with your changes for \"diagnostic\" and \"clic\". In fact, \"diagnostic\" is a noun and \"diagnostique\" is a conjugated verb : http://www.cce.umontreal.ca/capsules/2567.htm\nSame thing apply for \"clic\" and \"clique\".\nFor me, the correct spellings here is \"diagnostic\" and \"clic\"\n. I would say this is for the whole French language. I'm from France so I don't know what is used in Quebec.\n. OK, done in #274.\n. The original string is \"Left click to open message\". So, for me, \"click\" is a noun here. I used the same pattern to translate. It has the advantage of preventing us to choose the conjugation (\"vous\" or \"tu\"), if you see what I means.\n. ",
    "Fistynuts": "I'm having trouble reproducing it too. It definitely happened, honest...\nUnfortunately the relevant save has been overwritten.\n. ",
    "marcelhbertonzzin": "I just tried to build another Research Dept. and now I can set the research priorities... seems that the bug wen't away after that.\n. Hi everyone.. this is indeed what happened!\nI created myself a game using the demo version and later used the full\nversion to play it.\nYou sir are very insightful.... =)\nEm 25/08/2014 15:56, \"MarkL\" notifications@github.com escreveu:\n\nI have been able to recreate this issue. It occurs if you switch between\nfull data and demo data. Build the research room with the demo data, save\nand then load this save with the full data and the game does not recognise\nyou already have the research room and disables the research screen. You\nwill even get messages from the advisor.\n@marcelhbertonzzin https://github.com/marcelhbertonzzin is it possible\nthat this is what you did? Perhaps you loaded a game created by someone\nusing the demo.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/279#issuecomment-53310748.\n. \n",
    "vikkiesingh": "Yes, I'm pretty sure I have the full version. I'm currently playing level 8. Also, the issue does not exist with version 0.21. Only experiencing it with 0.30.\nWhat I did was to copy the \"HOSP\" folder from the Theme Hospital CD's image into the CorsixTH installation folder. During the very first launch, I pointed CorsixTH towards that HOSP folder. I'm not sure if that perhaps affects the choosing of difficulty.\n. That's right. Could select it earlier but cannot select it in ver 0.3.\n. Hi. Yes that did the trick for me. Sorry for the late reply. Thought I had posted the reply earlier.\n. ",
    "mpmc": "Just thought I'd comment and say how awesome these are!\n. @MarkL1961 You are mistaken in assuming it's identical, It's not. in the original you do not need to hold shift or ctrl while holding the mouse button to increase/decrease values. (double check if you like.)\nAdding such a feature would help those of us who are not able to use a keyboard and a mouse at the same time (yes we do exist!).\nEven when using sticky keys you are only able to do this once to add -/+10 without having to press shift/ctrl again.\n. I've just tested the original game (not the updated version) on both Windows 95/98 on a live machine (not a VM) and it increases values by just holding the mouse button*, it however does not work with newer systems or a VM! Go figure!\n. @MarkL1961 Apologies for my rather snappy reply to your response unfortunately I've heard it so many times before (\"use shift/ctrl\") it makes my blood boil because most of the time people (in general) assume everyone has full usage of their limbs (I have Cerebral Palsy). \nI've contacted many developers in the past requesting simple changes in their software only to be given the above line or be given some other nasty response (I've once had an e-mail posted to a forum to which forum members have mocked). However most developers are more than happy to add reasonable changes where possible. \nLike the saying goes.. \u201cSometimes, little things make a big difference...\u201d.\nSorry I've gone on a bit, but I hope you now understand why I'm requesting this change.\n:)\n. Hmm, It does sound familiar but I can't be sure.\n. Split these into separate issues #331 and #332\n. :| That is confusing as hell and it makes no sense, maybe I'm being thick?\nSo the name of the illness is already known before it's discovered and they want to take a chance at a possible cure before discovering it.. wtf?\n\"Oh you have slack tongue! I don't know what it is yet but I already have a name for it and a possible cure..\"\n:confounded: :confused: \n. @J-Shep Unfortunately I don't have the SAV anymore, I have tried to get it to happen again but no luck I'm afraid.\n. @J-Shep I used the edit/scissors to move the GPs office but I double clicked whilst my mouse cursor was over the doctor in the room bringing up the info dialog (the zzz cursor was shown), \nHe and the patient left and I finished moving the room to another recently purchased section of the hospital then I got that error.\n. Yes, the one before it loads fine.. here it is.. \nhttp://www.markclarkstone.co.uk/Autosave4.sav\nHave at it ;)\n. I was told by tobylane on IRC to post my graphics info on here as I'm getting similar glitches.\n\nSystem: Xubuntu 1604 x64.\nCorsix Build git ab8ad632759bbfd6e7c8d961be99fc01be03a3c5 / LUA 5.3.\nGraphics info:\n```\n01:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Redwood PRO [Radeon HD 5550/5570/5630/6510/6610/7570] [1002:68d9] (prog-if 00 [VGA controller])\n    Subsystem: PC Partner Limited / Sapphire Technology Radeon HD 5570 [174b:e142]\n    Flags: bus master, fast devsel, latency 0, IRQ 30\n    Memory at e0000000 (64-bit, prefetchable) [size=256M]\n    Memory at f7e20000 (64-bit, non-prefetchable) [size=128K]\n    I/O ports at e000 [size=256]\n    Expansion ROM at f7e00000 [disabled] [size=128K]\n    Capabilities: \n    Kernel driver in use: radeon\n    Kernel modules: radeon\n01:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Redwood HDMI Audio [Radeon HD 5000 Series] [1002:aa60]\n    Subsystem: PC Partner Limited / Sapphire Technology Redwood HDMI Audio [Radeon HD 5000 Series] [174b:aa60]\nOpenGL vendor string: X.Org\nOpenGL renderer string: Gallium 0.4 on AMD REDWOOD (DRM 2.43.0, LLVM 3.8.0)\nOpenGL core profile version string: 3.3 (Core Profile) Mesa 11.2.0\nOpenGL core profile shading language version string: 3.30\nOpenGL core profile context flags: (none)\nOpenGL core profile profile mask: core profile\nOpenGL core profile extensions:\nOpenGL version string: 3.0 Mesa 11.2.0\nOpenGL shading language version string: 1.30\nOpenGL context flags: (none)\nOpenGL extensions:\nOpenGL ES profile version string: OpenGL ES 3.0 Mesa 11.2.0\nOpenGL ES profile shading language version string: OpenGL ES GLSL ES 3.00\nOpenGL ES profile extensions:\n```\n. ",
    "excpt": "Adding these tracks directly into the game will cause trouble. Copyright stuff in the music business is very confusing and can be complicated. \nComposers (Scroll down to Audio): http://www.giantbomb.com/theme-hospital/3030-12188/credits/\nThe best solution would be to integrate an audio player into the game where you can add tracks to a playlist by selecting a folder or file from your machine. Open Transport Tycoon Deluxe has this feature. So you can still play the original music of Transport Tycoon in-game if you want to.\n@mpmc Thanks for the positive feedback. :)\n. I will have a look at this and if it works I will provide a zip/tar file on my server including a little tutorial how to add the files. So everyone who wants the rearranged music instead of the original midi/mus sound can download and add the files. I think this should be a workaround for the licensing/copyright-issue on this topic.\nYou (the project owner, @corsix) may promote this on the socialmedia-thingies so everyone will know about this. :)\n. ",
    "DjCoke": "I'm so sorry, i played the level further, so i only have salvaged some saves. I hope you have enough:\nhttps://www.dropbox.com/s/7ejmsh7514je407/Saves.zip\n. Well, what i remember what I did was deleting the cardiogram. There were people inside, but they moved. I got a lot of questionmarks and I remember that I ignored them and I moved the scanner. Between these moments before or just after I couldnt place or move benches, because of the bug.\nMaybe they were send home? \n. @J-Shep I can not confirm if the patient was getting undressed... But it seems likely though... Otherwise to much coincidence? I am glad that I can help...\n. Well what I did do was not delete the scanner room, but moved it to the cardiogram location. I did not recreate the room, what you can do is click on the blue space and hold it, then move it. Maybe that caused the error?\n. Well the fax machine gives me question marks, green, when i move or delete a diagnosis room. I just played today and I noticed it happens alle the time, especially with a busy hospital.\n. ",
    "Ep0na": " DIV {margin:0px;} \nWhat level file do you need to see? \u00a0Where can I find it? \u00a0What do you mean by \"the win lose criteria to this issue\"?-----Original Message-----\nFrom: MarkL Sent: Aug 12, 2014 5:15 AM\nTo: CorsixTH/CorsixTH Cc: Ep0na Subject: Re: [CorsixTH] Mouse button and gui stops responding after \"Status\" clicked (#294)\n@Ep0na  I think it has something to do with the level file, perhaps something is missing.  Can you link to a copy of the level file or copy the win lose criteria to this issue?\n\u2014Reply to this email directly or view it on GitHub.\n. ",
    "hedcase1": "Just had this same error as well.  Fresh install of Theme Hospital and CorsixTH 0.30.  Started a brand new campaign and was on the tutorial level - built a GP's office then a second one and when I went to confirm to build the second room after I had placed everything, the GUI stopped responding to clicks.  Mouse still moves though.\nYou are running the latest version of CorsixTH.\nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help th\ne developers find the source of the error.\nRunning: The buttonup handler.\nA stack trace is included below, and the handler has been disconnected.\nB:\\Theme Hospital\\CorsixTH\\Lua\\game_ui.lua:800: attempt to index a nil value\nstack traceback:\n        B:\\Theme Hospital\\CorsixTH\\Lua\\game_ui.lua: in function 'callback'\n        B:\\Theme Hospital\\CorsixTH\\Lua\\game_ui.lua:897: in function 'tutorialSte\np'\n        B:\\Theme Hospital\\CorsixTH\\Lua\\dialogs\\edit_room.lua:247: in function 'c\nallback'\n        B:\\Theme Hospital\\CorsixTH\\Lua\\window.lua:645: in function 'handleClick'\nB:\\Theme Hospital\\CorsixTH\\Lua\\window.lua:1406: in function 'onMouseUp'\n    B:\\Theme Hospital\\CorsixTH\\Lua\\dialogs\\place_objects.lua:449: in functio\nn 'onMouseUp'\n        B:\\Theme Hospital\\CorsixTH\\Lua\\window.lua:1390: in function 'onMouseUp'\n        B:\\Theme Hospital\\CorsixTH\\Lua\\ui.lua:703: in function 'dispatch'\n        B:\\Theme Hospital\\CorsixTH\\Lua\\app.lua:739: in function \nWarning: No event handler for buttonup\n. ",
    "daiscog": "The original TH docs describe the \"Patient Not Cured\" mood icon thus:\n\n\"Treatment has been unsuccessful. The Patient must be re-admitted to a GP\u2019s Office to start the procedure again.\"\n\nHowever, I have never actually seen the game behave this way;  whenever a patient has an unsuccessful cure (and is adorned with this icon) they have in my experience always died shortly after leaving the treatment room.\n. An alternative approach is to use wine to run the GOG installer, then point CorsixTH to ~/.wine/drive_c/Program Files/GOG.com/Theme Hospital (or wherever the game was installed).\n. @MarkL1961, I know that the original CD distribution has the necessary files uncompressed on the CD, but as bennuttall stated, the GOG distribution has all the game files contained within the installer exe, so you either need to extract them with a 3rd-party tool (as he suggested) or run the installer to get them out.\n. I've just experimented with the original game and can confirm that a nurse was only needed in a ward for the patient to be admitted.  Once in, the nurse can be removed and the patient still completes their visit as normal, including paying before leaving.\nGiven a ward can have many patients in it at once, including those preparing for operations, this makes sense to me, otherwise the nurse might never get the opportunity to leave.  The nurse shouldn't have to wait for all beds to be vacated before she can go to the staff room, chase epidemic patients, or whatever.. ",
    "Stefan1200-de": "I support this, also looking for a way to disable earthquakes in custom levels (not playing campaign). Is that already possible?\n. Well, unfortunately I don't have a save game of it just before it happens. But I have the current save game of that game (game continued running after clicking away that error message and loading a save game again). And I guess I know the guy producing that error message. Because I have one guy in my hospital, which is not moving since years (in hospital time). See the following screenshot (of course the big red arrow was added by me ;)):\n\nSave Game: http://www.stefan1200.de/downloads/Stefan.sav\n. ",
    "CzBiX": "Yes, it's a typo. I already fixed it, and add more translations.\n. thanks for your advice, updated.\n. I was follow wiki in here,\nIn debug-strings-diff.txt, these strings show as SUPERFLUOUS STRINGS, so I deleted them.\n. ",
    "docucci": "no, I'm sorry but I can't get it, 'cause when the game freezes, even the console freezes..\nI can't exit from the game (I forgot to mention that I'm playing full screen), even if I try to switch from other processes, the screen remains in the game .. \nthen when I stop the Theme Hospital process, automatically also closes the console.. :(\n. \nthen guys.. \nto see the Lua console I've just adopted the \"window view\".\nbut I can't find my save file and even the default folder for saves (set as default).\nso I have created a new saves folder in my Documents folder and I started a new level. ;)\nthis is a crash just happened:\nafter a few minutes of play, I'd put Them in Hospital \"reduce to an icon\" and after a few minutes I reopened. It was in crash and this is the screen. \nI can't tell you if it is the same \"freeze situation\" that I reported.\nin case of a new freeze I will save another screen! ;)\nthanks, guys\n. thanks a lot @MarkL1961. now I found my foders and I know where i save my hospitals! :+1: \nand thanks a lot @TheCycoONE. :+1: :100: \nprobably you're right: my old Theme Hospital copy could be damaged or corrupted. ;)\nBut now it really flows! YES!\nI just bought Theme Hospital from GOG.com!!! :tada:  :tada:  :tada: \nI installed it, and it's perfect! :8ball: \nnow I hope don't encounter other crashes! ;)\n. GUYZ!!!!! has just frozen !!!!! \nunexpected crash while I was building psychiatry. \nhere is the screen.\nWHY?! WHY???! :)\n\n. Created game with savegame version 78.\nSavegame version is 78 (0.30), originally it was 78 (0.30)\nSavegame version is 78 (0.30), originally it was 78 (0.30)\nSavegame version is 78 (0.30), originally it was 78 (0.30)\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:71: Proper idle not in action_queue\nstack traceback:\n    [C]: in function 'error'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:71: in function 'action_queue_find_idle'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\queue.lua:225: in function 'onChangeQueuePosition'\n    C:\\Program Files\\CorsixTH\\Lua\\queue.lua:194: in function 'pop'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:476: in function 'tryAdvanceQueue'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:528: in function 'onHumanoidLeave'\n    C:\\Program Files\\CorsixTH\\Lua\\rooms\\gp.lua:177: in function 'onHumanoidLeave'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:343: in function 'on_next_tile_set'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:142: in function 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:166: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1035: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:838: in function 'dispatch'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:739: in function \n. ",
    "Vzor": "The freezes and crushes happened sometimes when the doctor \"overworked\", but some times I've not seen any reason it just freeze and I cannot swith to other window.\nI 'm playing in fullscreen mode with DirectX render on windows 7\nmoybe this screens can help\n\n\nBoth screens are the same log (start and finish)\n. Looks similar\n. ",
    "marc-cairo": "The eventlog (application + system) shows no errors and no warnings at this time.\nMy appdata folder doesn't contain the gamelog.txt\n\nIn the config file, I see that there is a debug option. \nI will turn this on the next time I play. Maybe this will show more?\n. @MarkL1961 it is not specific to any map.\n@TheCycoONE  I tried to start the game in DirectX, but this doesn't work at all. I cannot even see the main menu:\n\n\n\nthe windows error report can be seen here: \nhttps://www.dropbox.com/s/kl8rrspil2ut412/Report.wer?dl=0\nI also tried OpenGL and this seems to work without any problems... I played two levels today and playing a whole level was not possible before.\n. ",
    "Suisse00": "Hi, I noticed a couple of mistakes in the latest commit of @wolfy1339 (see https://github.com/Suisse00/CorsixTH/commit/cc58b69fc4da530067b86d4db3513996ecf73e44).\nHere is some comment/questions/suggestions about some changes:\nOriginal: movies = \"Contr\u00f4le de film globale\",\nNew: movies = \"Contr\u00f4le de film globale\",\n- Shouldn't we use \"vid\u00e9o\" instead of \"film\" everywhere instead? (this include in english as well).\n- Just a suggestion, I think the plural involve every movies so it is useless to use \"global\" (which I think it is wierd to use anyway) - In my commit I do use the plural form.\n- If you don't like at least change \"globale\" to \"global\"... except if you use \"vid\u00e9o\"\nOriginal: volume = \"Si vous arriv\u00e9 \u00e0 avoir la touche qui r\u00e9duit le volume qui ouvre \u00e9galement le journal de m\u00e9decine, activer cette option pour modifier le raccourci de dossiers m\u00e9dicaux \u00e0 Maj + C\",\nNew: volume = \"Si la touche de r\u00e9duction du volume ouvre \u00e9galement le journal de m\u00e9decine, activer cette option pour modifier le raccourci des dossiers m\u00e9dicaux \u00e0 Maj + C\",\n- The orignal english version use \"casebook\" to refer to \"le journal de m\u00e9decine\" and \"des dossiers m\u00e9dicaux\", shouldn't we use the same word (\"MALLETTE\" in the @wolfy1339 commit) instead?\n      (At least we should use the french equivalent of \"casebook\" at least once to create a link between the feature and the window. Otherwise the user may be lost and have no clue what we are talking about)\nOriginal: average_contents = \"Teneurs moyennes\",\nNew: average_contents = \"Achats m\u00e9moris\u00e9s\"\n- The original (french version) doesn't mean anything so here an alternative suggestion (I would suggest \"Construction m\u00e9moris\u00e9es\" but I guess it will not fit on the UI, I'm not even sure if \"Achats m\u00e9moris\u00e9s\" will be fine...)\nOriginal: intro = \"Passer le film d'introduction lorsque vous d\u00e9marrez le jeu. La contr\u00f4le de film mondial doit \u00eatre activ\u00e9e si vous jouez le film d'introduction \u00e0 chaque fois que vous chargez CorsixTH\",\nNew: intro = \"Passer le film d'introduction lorsque vous d\u00e9marrez le jeu. Le contr\u00f4le des films doit \u00eatre activ\u00e9 si vous jouez le film d'introduction \u00e0 chaque fois que vous chargez CorsixTH\",\n- At first I changed \"film mondial\" to \"film global\" (to match how we use it elsewhere)\n          then I applied one of my suggestion to change \"film global\" by his plural form (\"des films\")\n\"MALETTE\" hasn't been fixed yet (both in my commit and in the latest commit of @wolfy1339 ), also I have other suggestions :\n- \"bagage\" or \"valise\" (if we want to stay close to the initial idea of \"MALLETTE\")\n- Maladies (I think we should use this instead, this is much more user-friendly), Livre des maladies?\n- R\u00e9gistre (I don't know where it came from at first, but I think it still a better idea than \"MALLETTE\"/\"Bagage\"/\"Valise\" (but not as good as \"Maladies\")\nNOTE1: I downloaded 0.40 beta 2 and I noticed that in the bottom toolbar you use \"Registre\", but I can't find it either in the french nor in english so... Is that possible you now use the same label for both the menu and toolbar?\n  NOTE2: I'm a French from Quebec (Canada) and I think \"valise\" isn't likely to be use by French from France so it may be a bad idea - but I may be wrong !\nOriginal: savegames_location = \"Par d\u00e9faut, le r\u00e9pertoire de sauvegardes est \u00e0 c\u00f4t\u00e9 du fichier de configuration et sera utilis\u00e9 pour stocker les sauvegardes. Si cela ne serait pas appropri\u00e9, alors vous pouvez choisir votre propre, suffit juste de parcourir le r\u00e9pertoire que vous voulez utiliser.\",\nNew: savegames_location = \"Par d\u00e9faut, le r\u00e9pertoire de sauvegardes est \u00e0 c\u00f4t\u00e9 du fichier de configuration et sera utilis\u00e9 pour stocker les sauvegardes. Si cela n'est pas appropri\u00e9 vous pouvez modifier ce r\u00e9pertoire.\",\n- Ok overall tooltip.folders_window labels are long so I just wiped half of tooltip.folders_window textes which I think are useless.\nOriginal: music_location = \"S\u00e9lectionnez un emplacement pour vos fichiers MP3. Vous devez avoir cr\u00e9\u00e9 le r\u00e9pertoire d\u00e9j\u00e0, puis naviguez vers le r\u00e9pertoire que vous venez de cr\u00e9er.\",\nNew: music_location = \"S\u00e9lectionnez un emplacement pour vos fichiers MP3.\",\n- I can't test but will it override the default ingame audio? If so it may be a good idea to add this in the label\nOriginal: emergency = \"Cr\u00e9er une urgence\",\nNew: emergency = \"Cr\u00e9er une situation d'urgence\",\n- The english version try to be short as much as possible so I may be wrong adding more word\nI hope it will help !\n. Ah... I forgot to merge the master branche before doing the change/pull\nrequest.\nWhat should I do? (I would like to know for future usage. Would a merge\nfrom master to my repository will be display in this pull request too?)\nLe 13 nov. 2014 12:24, \"wolfy1339\" notifications@github.com a \u00e9crit :\n\nThe first two (2) commits are already merged into master. From my PR\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/382#issuecomment-62930869.\n. It was supossed to be a commit from the CorsixTH/CorsixTH branch.  (I mean,\nafter the commit in your branch I deleted the repository to fork the right\none)\n\nI will have to check where it messed up.\nAh the fun you have to learn new tools ...\nLe 13 nov. 2014 12:32, \"wolfy1339\" notifications@github.com a \u00e9crit :\n\nWell, i don't know how to proceed... One problem is you forked my\nrepository (wolfy1339/CorsixTH) instead of CorsixTH/CorsixTH. I would just\nclose this pr, delete Suisse00/CorsixTH and clone CorsixTH/CorsixTH, and\nthen open a pr with the changes you made\n\u2014\nReply to this email directly or view it on GitHub.\n. \n",
    "SupanovaHS": "Ok, so I'm new to using Lua, it's not my native language, so I thought I'd take a stab at it, I am the original issue poster btw...\nAfter messing about trying to get Decoda to work, I got it going, and found out where the issue was for this bug...\nplace_objects.lua line 644 begins to check objects on a per room basis, however, some corridor objects, eg fire_extinguisher, plants and radiators can effectively be placed in any room...\nI don't know the ins and outs of how everything works, but, I added 3 lines and I got expected behavior\nlua\n--Check2a: some corridor objects are allowed in any room.....\n        if object.corridor_object and object.corridor_object > 3 then\n         is_object_allowed = true\n        end\nWill need testing by someone that knows what they are doing....\n. Also realized bins were missing, and needed \nlua\nobject.corridor_object = 7\nassigned to bin.lua\n. I always assumed bins reduced litter in the original, not sure if it's been implemented here yet.  Chance to drop litter increases with difficulty, and time since patient last saw a bin......\nAs regards to .thob, no idea what that does yet, only got the source the other day, still working my way around it\n. I apologize for the lack of response on my part, swamped with work atm...\n@J-Shep  I have no issues with you taking over, as it would seem you may of been the cause?? ::P\n@MarkL1961 Not sure what possessed me to think bins were able to be placed everywhere, my bad.  As regards to litter, I'll take a peek at what litter code there is, and look at implementing the things we discussed briefly.\nI do need some direction, however.  Mainly regarding improvements, is the main goal of this project to produce an identical clone, or ultimately to improve upon the original?  I am more than aware that some improvements will not be suited to everyone, I know this from experience developing my own project over the past 4 years.  Iv'e come to the conclusion ALL improvements, no matter how beneficial to the community they are, there will ALWAYS be people that don't agree.  Most of the time, when I set my mind to changing something, we will discuss it as a community, and the majority vote wins.\n. ",
    "droidmonkey": "python debugging through pydev is rather simple. I incorporated the pydev debugging script into the python code and when you enter the command in the terminal to initiate the debugging it simply calls the function in that pydev code that connects to the waiting listen server.\n. Take a look here (C++): https://github.com/goldeneye-source/ges-code/blob/ges/game/server/ges/py/ge_pymanager.cpp#L235\nAnd here (Python): https://github.com/goldeneye-source/ges-python/blob/master/lib/ge_debugger.py#L19\n. ",
    "ghidosoft": "It looks like the same thing, however I was using the SDL version, here the Windows error log:\nFaulting application name: CorsixTH_SDL.exe, version: 0.0.0.0, time stamp: 0x54511863\nFaulting module name: CorsixTH_SDL.exe, version: 0.0.0.0, time stamp: 0x54511863\nException code: 0xc0000005\nFault offset: 0x000000000004395c\nFaulting process ID: 0xccc\nFaulting application start time: 0x01cff46647ba306b\nFaulting application path: C:\\Program Files\\CorsixTH\\CorsixTH_SDL.exe\nFaulting module path: C:\\Program Files\\CorsixTH\\CorsixTH_SDL.exe\nReport ID: 73faf04c-605a-11e4-beb9-0c54a556707c\nFaulting package full name: \nFaulting package-relative application ID: \n. If I remember correctly you are right, both patients were going to hell.\nThe game does not crash all times, in another occasion both animations played and two patients went to hell however one grim reaper stayed there indefinitely and no errors went to the console (there aren't another dead patient in the hospital walking to hell, if you need it I have a savegame).\n\n\n. You are welcome. I kept a savegame just before the crash, let me know if you need it.\n. @J-Shep here it is: https://www.dropbox.com/s/bpuolwla7xjy3yj/ErrorEarthquake.sav?dl=0 \nIt's some seconds before the earthquake that will (usually) destroy the operating theater on level full Eggsenham.\n. It doesn't happen to me neither, I tried multiple times. However can it be the same as #352?\n. @MarkL1961 no, I'm using the vanilla 0.40 beta2 but I cannot reproduce the issue.\n. ",
    "auguster": "I fired each nurse after their bug to free their designated room so another nurse can use it and to save salary money.\nMaybe I should restart this level again and see if the error occurs again and if it's linked to an epidemic.\n. Ok, I will have to play carefully. I remember that the bug seemed to appear out of nowhere. I will try to pay attention to the course I action I make just before this bug appears.\n. I've provided the gamelog.txt along with the save in the first message of this issue. I'm not familiar with CorsixTH yet so I'm having difficulties interpreting it.\n. ",
    "sirlimpy": "This time, he quit because I did not increase his wages.\nAnd no I did not see anything in the console.\n. ",
    "b2042282": "Thanks! CorsixTH0.40b2 and CorsixTH_OpenGL did well, I just missed /releases link before.\n. ",
    "crowbarsolutions": "I was using vanilla beta 2, even though I was killing the application in between retries and able to reproduce it, is seems a computer restart has fixed it.\n. ",
    "Andy51": "Some additional info on various zoom glitches.\n1. Do some zooming\n2. Start placing a room -> Bottom GUI panel disappears\n3. Place the door and press \"Confirm\" -> The whole screen blinks black\n4. Press \"Cancel\" -> The room still displayed in furnishing mode, ground cursor gets duplicated\n   \nAnd in fullscreen mode additional to listed above:\n1. Do some zooming -> bottom GUI panel jumps to the center of the screen\n\n2. Start placing a room -> notice the ground cursor position vs mouse cursor:\n\nGame version: fc3eb277 buit with MSVC2013CE, SDL 2.0.3, SDL_mixer 2.0.0, Lua 5.1.5, all defaults\nOS: Win7 x64\n. Oh, just noticed #616 has exactly the same sympthoms as reported above, so it must be the same one\n. @pwaller after some research i know why your fix is not correct:\nit only handles\nc++\nTHClipRect rc = {};\npCanvas->getClipRect(&rc);\npCanvas->setClipRect(&rc);\ncase, but not the\nlua\nlocal x_, y_, w, h = canvas:getClip()\ncanvas:setClip(x_, y_, w, h)\nso in order to have correct mapping of SDL behavior to TH expected behavior, we have to return nonempty clip rect when clipping disabled, like canvas size.\n. I can confirm that most of the bugs went away with you patch applied, but not with fullscreen mode.\nAnd it introduces one more bug not mentioned before - there is no ground cursor when starting to place a room\n. Yes, i confirm it unfreezes when pressing alt+enter as well\nI have also merged @pwaller #631 but that did not fix the freeze. I guess i would try to find what is going on in the code then..\n. @xuancong84 that helped avoiding the freeze for me too. So it actually is a clipping issue.\n. @xuancong84 because the old code was mapped 1:1 to SDL API, which is not the case right now\n. OK, after some meddling with the code i have an idea this is most probably just a texel bleeding issue. Conclusion is, we should never ever render any sprites with SDL_RenderSetLogicalSize not equal to the render target, as happens in our case when we use fake fullscreen resolution (we dont actually chage the screen resolution when going fullscreen) so even though my SDL logical size is set to 720p, it actually renders on 1080p sized render target for my desktop.\nConsidering all the above is correct, the simple solution would be to switch to 'real' fullscreen mode, plus that would solve some of the zooming artifacts in fullscreen. Or alternatively we might apply the same rendering technique as when zooming (right now the issue is present only with zoom=0)\n. Yes, just checked on ee23df1f and there were no artifacts. Probably zooming changes fixed that (eliminated rendering fastpath when zoom=0)?\n. @pwaller on what OS did you do the research? I think the important bit is which backend renderer is used\n. Did that happen only once or you can reproduce it?\n. I can only suspect it stopped working because of different busted andor luafilesystem compared to initial build in PR:\nluafilesystem 1.6.2-2 -> 1.6.3-1\nbusted 2.0.rc3-0 -> 2.0.rc5-0\n. Fixes the issues for me too, gj @pwaller !\nColor issues are definitely because of blending, you can check it by zooming in maximum, but i believe we would find how to workaround this eventually.\n. ",
    "bennuttall": "Looks good, thanks guys.\n. ",
    "lbakyl": "Hello Stephen, thank you VERY much for volunteering and taking a point on this project. If successful, you will bring joy to many people here at the Corsix community, as well as bring new interested gamers in :) \nWhile I am not a programmer, I wonder in what ways you would benefit from support - donations, testing, documentation, engaging with ideas...just say. I will be happy to work with you on this as a non-developer, if it would be productive.\nConsidering the manpower available for this project (1 able programmer), I would go with the easiest-to-implement design, which would be to have just 2 players. Each player would be running the same map with the syncing of certain information taking place, without the ability to view the other person's hospital. \nApart from menu changes and a network layer being added, some new variables may need to be created for the exchange. Based on the post from BvDorp (see http://forums.corsixth.com/index.php/topic,5359.msg7120.html#msg7120 ), the variables would include:\n- Emergency refusal would go to the other player\n- Invitation of a VIP visit would come at the same time to all players\n- Refused patients go to the other hospital\n- Parcel ownership and prices, that can be used for auctions\n- Players would share the same goals to win (as defined by the map)\n- Optional: Same pool of patients and their conditions\n- Optional: Same pool of staff members (or two pools with the same parameters of each staff member)\n- Optional: If one is more advanced with research, the possibility of buying the research from the other person (a simple auction screen, only a few variables would be exchanged for the starting price and the current price; in two players the starting price set by the seller would be the selling price).\nJoe, are you familiar with the SDL_threads library, or would you like to look into implementing your own, like Darrel desired two years ago? Personally, I would recommend using the already made library, as it may help programmers to work with it, in future.\n. Hello Stephen, your suggestions sound reasonable. Please, let me know if there is any way that I or anyone else can support your development as a non-developer. Feel free to PM me directly, instead! Jan\n. Sorry about that, my apologies :)\n. Thank you for your suggestion and dedication, @J-Shep . I would like to give it a go. Please add me on Skype - jan.bakalar , it will be easier to communicate. I have previous programming experience from QBasic and Pascal (a hobby) and recently I did some scripting stuff in Bash, PHP and AutoHotKey, so let's see how Lua would work :)\nWe can then keep this page updated for those who may be interested or would decide to join our efforts.\n. Hello Glimmer-Man,\nI believe that your post was written in an unnecessary harsh and unappreciative way. It is easy to criticise, but harder to actually join the team and develop some effort to make a difference. The usability of this task for the end user may not be as high, but it is a good case on which a programmer can learn the source code while making some contribution and then progress to more difficult tasks.\nConsider the fact that none of the developers here are paid for their work. Not everyone has the time or abilities to make larger changes to the code. We are learning from one another - as you yourself mentioned, things are improving and the game is more stable than before.\nAs per your suggestions, things like a compensation for death of a patient and having less income from the machines would be fairly simple to create, I believe. More challenging emergencies are a matter of the mission set up. On the other hand, to create new diseases & machines would be more challenging, but not impossible - it's all a matter of priorities. I agree with you that making the game more stable is important.\nOverall, it is not what you write but how you write it that makes the difference :) Thank you.\n. ",
    "Cach54": "Is somebody still working on Multiplayer ?\nI am new to CorsixTH but I could probably help a bit, I am a Web Project Manager/Developper.\n. @J-Shep That is pretty awesome.\nI actually have programming experience, I program almost everyday. But I am a web developper, PHP most of the time. I have C basis but I never heard about LUA. Which means I can implement functions if needed, but I would not be able at the moment to design or to take choice on architecture.\nI already followed this repo, which means I am notified when there is activity.\nI am looking forward to your designs.\nGood luck.\n. ",
    "zsolmanz": "\nA. Design the user interface layout for a \"Available LAN Servers\" screen\nB. Design the user interface layout for a LAN game's pre-launch room\n\nHey @J-Shep, do you still want these done?\nI just knocked up a super basic main menu 'multiplayer' button addition to test out libraoffice (to be honest, I found MS paint to be easier), you can find it here.\nBiggest issue I came up with is:  What font does Theme Hospital (or Corsix) use as the main menu font?  I had to manufacture the word 'multiplayer' in the above picture from individual letters (hence no capital M), but that'd be a pain for the more complicated designs you've asked for.\n. Unfortunately the TH font file is a .dat or a .tab that I can't yet open - does anyone know the name of the font?\n. Are these any good?\nIf they are, I'll chuck them into GIMP with a background image and a little more formatting.\n. The stuck handyman was repairing the decontamination unit when he became stuck - hence he's in the middle of the hospital.  I fired him anyhow, so he shouldn't really be interacting with much.  Anyway, I've yet to find a way to block off parts of the hospital - the game prevents placement of objects that would do this.\nI would say the error is related to the Operating Theatre patient queue, since it's the only room that produces this error, but since it doesn't occur when you build the OT in a different plot I'm at a loss.\n. The partial stack traceback:\nSavegame version is 102 (Trunk), originally it was 91 (0.40)\nError in frame handler: \nC:\\Program Files\\CorsixTH\\Lua\\map.lua:438: bad argument #3 to 'draw' (number has no integer representation)\nstack traceback:\n    [C]: in method 'draw'\n    C:\\Program Files\\CorsixTH\\Lua\\map.lua:438: in method 'draw'\n    C:\\Program Files\\CorsixTH\\Lua\\dialogs\\patient.lua:136: in method 'draw'\n    C:\\Program Files\\CorsixTH\\Lua\\window.lua:1277: in field 'draw'\n    C:\\Program Files\\CorsixTH\\Lua\\game_ui.lua:153: in method 'draw'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:897: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:890>\n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:779: in function <C:\\Program Files\\CorsixTH\\Lua\\app.lua:774>\n. Upon further testing, editing the Blood Machine Room (without actually doing anything except making it zzZZZ) prevents this error.  The same cannot be said for editing any other room (I checked).\n. ",
    "Yehonal": "solved with -DWITH_MOVIES=OFF , aren't movies working on linux?\n. ",
    "honux": "None, just changed the \"debug = true\" on the config file and tested the debug menu, probably that's why it appeared there :P\n. Well, that's wrong, because I just selected to try to run the debug because it crashed, not the other way around.\nSince the original window didn't display any error after the crash, I've tried to turning up the debug info, that's why the debug error displays there.\nAnyone that uses Visual Studio and compile the game could run it on debug and find out why it crashed exactly, that's why I've posted it here.\n. @MarkL1961 \nIt crashes here without any action at all, just loading the saved game and waiting some, it usually takes ~7 seconds to crash.\nHow can I check this event log?\nThe errors about the debug/user function was me trying to activate an \"extreme detailed run\" or something like that after the game crashed several times. Usually some programs do this kind of run available to detect bugs.\nJust re-downloaded and re-tested, it still crashes without any action.\n. The game files are from GoG.com.\nThe gamelog.txt is empty!\n. Yes, I am. I'm currently using windows 8.1 x64.\nThis is what displays on the event viewer:\nxml\n <Event xmlns=\"http://schemas.microsoft.com/win/2004/08/events/event\">\n- <System>\n  <Provider Name=\"Application Error\" /> \n  <EventID Qualifiers=\"0\">1000</EventID> \n  <Level>2</Level> \n  <Task>100</Task> \n  <Keywords>0x80000000000000</Keywords> \n  <TimeCreated SystemTime=\"2014-11-28T19:08:38.000000000Z\" /> \n  <EventRecordID>762936</EventRecordID> \n  <Channel>Application</Channel> \n  <Computer>ADRIANO-PC</Computer> \n  <Security /> \n  </System>\n- <EventData>\n  <Data>CorsixTH_OpenGL.exe</Data> \n  <Data>0.0.0.0</Data> \n  <Data>54625319</Data> \n  <Data>CorsixTH_OpenGL.exe</Data> \n  <Data>0.0.0.0</Data> \n  <Data>54625319</Data> \n  <Data>c0000005</Data> \n  <Data>000000000003806c</Data> \n  <Data>24a0</Data> \n  <Data>01d00b3eaf092347</Data> \n  <Data>D:\\Program Files\\CorsixTH\\CorsixTH_OpenGL.exe</Data> \n  <Data>D:\\Program Files\\CorsixTH\\CorsixTH_OpenGL.exe</Data> \n  <Data>f4cd9ac3-7731-11e4-bfe5-50e549eec613</Data> \n  <Data /> \n  <Data /> \n  </EventData>\n  </Event>\nAnd this one after:\nxml\n- <Event xmlns=\"http://schemas.microsoft.com/win/2004/08/events/event\">\n- <System>\n  <Provider Name=\"Windows Error Reporting\" /> \n  <EventID Qualifiers=\"0\">1001</EventID> \n  <Level>4</Level> \n  <Task>0</Task> \n  <Keywords>0x80000000000000</Keywords> \n  <TimeCreated SystemTime=\"2014-11-28T19:08:43.000000000Z\" /> \n  <EventRecordID>762937</EventRecordID> \n  <Channel>Application</Channel> \n  <Computer>ADRIANO-PC</Computer> \n  <Security /> \n  </System>\n- <EventData>\n  <Data>85979773184</Data> \n  <Data>4</Data> \n  <Data>APPCRASH</Data> \n  <Data>N\u00e3o dispon\u00edvel</Data> \n  <Data>0</Data> \n  <Data>CorsixTH_OpenGL.exe</Data> \n  <Data>0.0.0.0</Data> \n  <Data>54625319</Data> \n  <Data>CorsixTH_OpenGL.exe</Data> \n  <Data>0.0.0.0</Data> \n  <Data>54625319</Data> \n  <Data>c0000005</Data> \n  <Data>000000000003806c</Data> \n  <Data /> \n  <Data /> \n  <Data>C:\\Users\\Adriano\\AppData\\Local\\Temp\\WERA7A8.tmp.WERInternalMetadata.xml</Data> \n  <Data>C:\\Users\\Adriano\\AppData\\Local\\Microsoft\\Windows\\WER\\ReportArchive\\AppCrash_CorsixTH_OpenGL._1ee17cac45f8cac5d5bd14de9f3bcb7917193_a284a883_017fbad3</Data> \n  <Data /> \n  <Data>0</Data> \n  <Data>f4cd9ac3-7731-11e4-bfe5-50e549eec613</Data> \n  <Data>0</Data> \n  <Data>de919b46229decfab43256a9d7236149</Data> \n  </EventData>\n  </Event>\n. It crashes no mater the version.\nhere are the event viewer for them:\n``` xml\n- \n- \n\n1000\n2\n100\n0x80000000000000\n\n762938\nApplication\nADRIANO-PC\n\n\n- \nCorsixTH_SDL.exe\n0.0.0.0\n5462537e\nCorsixTH_SDL.exe\n0.0.0.0\n5462537e\nc0000005\n000000000004395c\n12f8\n01d00b45cc8fe874\nD:\\Program Files\\CorsixTH\\CorsixTH_SDL.exe\nD:\\Program Files\\CorsixTH\\CorsixTH_SDL.exe\n127b55d9-7739-11e4-bfe5-50e549eec613\n\n\n\n\n\n- \n\n1001\n4\n0\n0x80000000000000\n\n762939\nApplication\nADRIANO-PC\n\n\n- \n85981850467\n4\nAPPCRASH\nN\u00e3o dispon\u00edvel\n0\nCorsixTH_SDL.exe\n0.0.0.0\n5462537e\nCorsixTH_SDL.exe\n0.0.0.0\n5462537e\nc0000005\n000000000004395c\n\n\nC:\\Users\\Adriano\\AppData\\Local\\Temp\\WER4A32.tmp.WERInternalMetadata.xml\nC:\\Users\\Adriano\\AppData\\Local\\Microsoft\\Windows\\WER\\ReportArchive\\AppCrash_CorsixTH_SDL.exe_882025afce79465f46c1ab421594464de39130ab_a8b7294a_0856552e\n\n0\n127b55d9-7739-11e4-bfe5-50e549eec613\n1\nf41b62e40181d2e0f8208508cc9b5175\n\n\n```\n``` xml\n- \n- \n\n1000\n2\n100\n0x80000000000000\n\n762940\nApplication\nADRIANO-PC\n\n\n- \nCorsixTH_DirectX.exe\n0.0.0.0\n546253c2\nCorsixTH_DirectX.exe\n0.0.0.0\n546253c2\nc0000005\n00000000000395cc\n26fc\n01d00b45f3aafcca\nD:\\Program Files\\CorsixTH\\CorsixTH_DirectX.exe\nD:\\Program Files\\CorsixTH\\CorsixTH_DirectX.exe\n39023993-7739-11e4-bfe5-50e549eec613\n\n\n\n\n\n- \n\n1001\n4\n0\n0x80000000000000\n\n762941\nApplication\nADRIANO-PC\n\n\n- \n85979991560\n4\nAPPCRASH\nN\u00e3o dispon\u00edvel\n0\nCorsixTH_DirectX.exe\n0.0.0.0\n546253c2\nCorsixTH_DirectX.exe\n0.0.0.0\n546253c2\nc0000005\n00000000000395cc\n\n\nC:\\Users\\Adriano\\AppData\\Local\\Temp\\WER4839.tmp.WERInternalMetadata.xml\nC:\\Users\\Adriano\\AppData\\Local\\Microsoft\\Windows\\WER\\ReportArchive\\AppCrash_CorsixTH_DirectX_536c5c8025ff8a846aa564ac3d9da868bd3a30_b80fc9cc_27cb4f5d\n\n0\n39023993-7739-11e4-bfe5-50e549eec613\n1\nc90b92ee4199ed8147b6db4eb429f777\n\n\n```\n. It crashes, no matter the speed. Trying to compile it here to see if I can debug it, but can't guarantee anything :p \ngetting tons of errors on lua stuff :(\n. Closing the patient dialog works, that might be the cause :p\n. ",
    "JamesWP": "OK well I'd be glad to try and find this myself however I can't build the source because of an issue with lua versions and other errors, where am I best getting help with this?\n. fyi if its helps here is another\n. yeah my bad i just noticed this? :/ sorry\n. Sure I will take a look into the version used \n. Yes ok, I'll take a look now\n. Yes it took me a day to get it to build on my system without changing the code, I'll take a look at statically linking the libraries in now, although this should be the default for the release configuration but obviously it is not \n. i have just spent hours trying to figure this out, im off to bed cant work out why it dosent statically link the libraries ive looked through th cmake file and the xcode project there is nothing to explain how or why it is supposed to do this :(\ndoes anyone know how we can get in touch with someone who has previously built this for mac? the 0.3 Beta for example\n. Well it is correct however there are some things it leaves behind that do need updating and while if you fiddle around you can build for your system, there are no release build instructions and packaging instructions for distribution\n-James\n. oh fantastic how / what did you have to change to get a build to statically link?\n. That's all fine but that does not sound like the \"proper\" way it sounds like a horrible hack, and hacks are almost never worth it we should have the tools do this for us really, whoever knows about cmake should be able to fix this really, but all said and done this is a good temporary measure for now\n. ok so can we have a commit with this script in please as id like to take a look etc...\n. expectant tone? it is an open source project so it shouldn't come as a surprise that other people who want to work on the project might want to view your code, especially when you are/were working on the same issue. and yes of course im not just expecting you to push your code to master (no on\u00a7e is) but for the time you invested writing your message you could have just done a gist..... no hard feelings its a game :P\n. ",
    "t0mtaylor": "I might take a look at this, i'm running this on MAC and have also experienced same issue\n. ",
    "colinjmatt": "This doesn't appear to be an issue on v0.62 and running MacOS 10.14.3.\nI've put my Mac to sleep and woken it up ~10 times whilst playing without a single crash.. What's needed to resolve lfs/lpeg missing on build so that I can distribute a MacOS build? For now, I can manually copy lfs.so and lpeg.so from /usr/local/lib/lua/5.3/ to /Applications/CorsixTH.app/Contents/Resources/ and the build will then work correctly on my other Mac without any initial errors.\nMy coding abilities aren't the greatest, but I'm more than happy to try and help anywhere I can.. For anyone that would like to try my build out, I've put my build of 0.62 here.. Everything has been built manually from source at the command line. The machine I'm using does not have Mac Ports / Homebrew installed.. Right now, I've built for 10.13.6 (latest MacOS build) but if this initial build is good and there's need for me to change the min version to something lower then I can happily do that.. What I've compiled doesn't seem to function outside of /Applications. I presume this is something relatively simple that I haven't accounted for?. Right now, I've packaged it as a .dmg with a symlink to /Applications similar to previous Mac releases. Is this acceptable or were you meaning to package it as a .pkg installer?. I'll research relative file paths to see if this is anything I can do. Perhaps not as simple as I once thought.. That's exactly what it does - I've even gone so far as to add an icon and background much like the previous Mac packager did.. You mean the flags set when ffmpeg is compiled? I can indeed disable everything and give it a try. Although compile time for CorixTH for me is already at about 15 seconds, so this would be purely to get a size reduction.. Ah! That makes more sense now. I'll give that a try shortly, just trying to resolve an issue with wxWidgets and AnimView so I can get that built and included too.. I've managed to build it, so if anyone wants/needs it on MacOS I can supply it if needed. For now I'll leave it out.. 6mb .dmg file here :D. This looks to be a compatibility issue where .dmg images created on High Sierra as APFS are not compatible with El Capitain that uses HFS+.\nLet me look into creating a .dmg with HFS+ support - it hopefully shouldn't take too much to force High Sierra to create that.. Please can you try this one?. The 10.13 requirement is my fault - I built for 10.10 but may have bundled the original .app that requires 10.13. I'll rectify that when I am at home.\nTime spent rectifying this is time spent enabling more users to download the Mac .app :)\nAs for the files, I've just bought Theme Hospital on GOG (it's 99p right now) so I'll see if I can recreate this issue.. Did you extract the C.harddisk folder from the GOG package found here:\n./Theme Hospital.app/Contents/Resources/game/Theme Hospital.app/Contents/Resources/Theme Hospital.boxer/C.harddisk. It's a known issue that the .app will not work unless it is placed in /Applications. Earlier in this thread the main developer talks about.\nI'll have a build that targets 10.10 for you shortly.. This package was built with a target of 10.10 (I have double checked), so I hope this works without you having to launch from the command line.\nIf the .app opens from the GUI, we can work through the other issues you're having next.. How did you install SDL2 and SDL2_mixer? Did you specify libsdl2-dev and libsdl2-mixer-dev?\nWhat happens if you try to install libsdl-dev and then compile?. The reason this happens is explained here.\nYou can download a .dmg that will open on your OS from this post here. The .dmg on the releases page has now been updated.. I've used the version built for 10.10 and 10.13.6 and they both exhibit the same behaviour.. This may be the issue - happens when scrolling using 2 fingers on the touchpad:\nAn error has occurred!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The multigesture handler.\nA stack trace is included below, and the handler has been disconnected.\n/Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:1106: attempt to call a nil value (method 'onMultiGesture')\nstack traceback:\n    /Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:1106: in function \n    (...tail calls...)\n    /Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:915: in function \nWarning: No event handler for multigesture. A further stack trace occurs for when it freezes:\nError while fetching children for /Applications/Calendar.app: cannot open /Applications/Calendar.app: Too many open files\nError while fetching children for /Applications/Chess.app: cannot open /Applications/Chess.app: Too many open files\nError while fetching children for /Applications/Contacts.app: cannot open /Applications/Contacts.app: Too many open files\nError while fetching children for /Applications/CorsixTH.app: cannot open /Applications/CorsixTH.app: Too many open files\nError while fetching children for /Applications/Dashboard.app: cannot open /Applications/Dashboard.app: Too many open files\nError while fetching children for /Applications/Datakam Player.app: cannot open /Applications/Datakam Player.app: Too many open files\nError while fetching children for /Applications/Diablo II: cannot open /Applications/Diablo II: Too many open files\nError while fetching children for /Applications/Dictionary.app: cannot open /Applications/Dictionary.app: Too many open files\nAn error has occurred!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The frame handler.\nA stack trace is included below, and the handler has been disconnected.\n...rsixTH.app/Contents/Resources//Lua/dialogs/tree_ctrl.lua:369: cannot open /Applications/Authy Desktop.app: Too many open files\nstack traceback:\n    [C]: in function 'lfs.dir'\n    ...rsixTH.app/Contents/Resources//Lua/dialogs/tree_ctrl.lua:369: in method 'checkForChildren'\n    ...rsixTH.app/Contents/Resources//Lua/dialogs/tree_ctrl.lua:407: in method 'getChildCount'\n    .../Resources//Lua/dialogs/resizables/directory_browser.lua:83: in method 'getHighlightColour'\n    ...rsixTH.app/Contents/Resources//Lua/dialogs/tree_ctrl.lua:673: in method 'draw'\n    ...ications/CorsixTH.app/Contents/Resources//Lua/window.lua:1310: in field 'draw'\n    ...rsixTH.app/Contents/Resources//Lua/dialogs/resizable.lua:111: in field 'draw'\n    .../Resources//Lua/dialogs/resizables/directory_browser.lua:199: in method 'draw'\n    ...ications/CorsixTH.app/Contents/Resources//Lua/window.lua:1310: in field 'draw'\n    /Applications/CorsixTH.app/Contents/Resources//Lua/ui.lua:342: in method 'draw'\n    /Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:1033: in function \n    (...tail calls...)\n    /Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:915: in function \nWarning: No event handler for frame\nAn error has occurred!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The multigesture handler.\nA stack trace is included below, and the handler has been disconnected.\n/Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:1106: attempt to call a nil value (method 'onMultiGesture')\nstack traceback:\n    /Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:1106: in function \n    (...tail calls...)\n    /Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:915: in function \nWarning: No event handler for multigesture. So I believe we have 2 issues:\n* One where mutli gesture isn't handled correctly, and as a result may be stopping a user from selecting the game data folder after the first stack trace is generated.\n\nAnother where the lua can't handle large numbers of sub-directories in a directory which causes CorsixTH to stop responding to input.. Will that be the source of the lock up if you expand /Applications since every .app is basically a directory with many sub directories/files within?\n\nI can try file picking from /Users to see if the same issue is experienced.. Bumped the file limit which seemed to help. However, the game still sometimes does not detect the game data folder correctly. I think this is due to the open file limit, rather than multi gesture though.\nOpening the game and using the picker 20 times - 10 times scrolling using the in game bar and 10 using a multi touch gesture to scroll - resulted in roughly the same frequency of the game data folder not being correctly detected when hovering over it.\nThis behaviour occurrs even without the file limit error generating, but directories also could not be expanded correctly which makes me believe this issue is related.. The file picker issue seems to be fixed with this code change, but now it appears another issue has been introduced when attempting to choose a font from the folder locations menu:\n...rsixTH.app/Contents/Resources//Lua/dialogs/tree_ctrl.lua:284: attempt to concatenate a nil value (global '_f')\nstack traceback:\n...rsixTH.app/Contents/Resources//Lua/dialogs/tree_ctrl.lua:284: in method 'hasChildren'\n...rsixTH.app/Contents/Resources//Lua/dialogs/tree_ctrl.lua:684: in method 'draw'\n...ications/CorsixTH.app/Contents/Resources//Lua/window.lua:1310: in field 'draw'\n...rsixTH.app/Contents/Resources//Lua/dialogs/resizable.lua:111: in method 'draw'\n...ications/CorsixTH.app/Contents/Resources//Lua/window.lua:1310: in field 'draw'\n/Applications/CorsixTH.app/Contents/Resources//Lua/ui.lua:342: in method 'draw'\n/Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:1033: in function </Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:1026>\n(...tail calls...)\n/Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:915: in function </Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:910> . @TheCycoONE  that seems to do the trick. I'm not getting any errors fed back into the console now.. This sounds like it may be https://github.com/CorsixTH/CorsixTH/issues/1460.\nIf you start the game using Terminal and recreate the issue, there should be an error generated in Terminal relating to \"Too many open files\".\nTo start the game using Terminal:\ncd /Applications/CorsixTH.app/Contents/MacOS\n./CorsixTH. ",
    "2bethere": "Assuming you are using homebrew, here are the things you need to install\nbrew install sdl luajit sdl_mixer ffmpeg\nIt fixes a lot of the dependency issues.\n. @admdly You are correct. I've only figured out how to play it on my machine and thought I would share.\nI came over this thread on a Google search for crash on mac. \n. ",
    "azayrahmad": "I play with the newest version (I just downloaded it yesterday).\nI just play the campaign once, but I load the autosaves multiple times and it's still the same bug.\nBy the way, how to upload the savefile?\n. ",
    "ReynoldsCahoon": "I attempted to launch the game again after closing this error, and it runs fine. Will leave this here in case there's some kink that needs to be worked out.\n. I am running 1920x1080, and as I mentioned, the game ran without a hitch as soon as I launched it again.\n. 1920x1080 is my default resolution. I was given no option to select a resolution before this occurred. Upon loading the game after the error, my resolution was set to 1920x1080 and didn't seem to have any issues.\nPerhaps it has nothing to do with the demo files.\n. Perhaps it had something to do with my monitor orientation? I have a dual monitor setup, one of which is landscape, and the other is portrait, both at 1920x1080. Not sure how to test if that's the case.\n. I am not a developer, but from a usability standpoint, even if you aren't currently supporting multi-monitor displays, it seems reasonable to expect the application to not crash. Perhaps the assert function, or one of the subfunctions being called on that line, could be changed to check the desktop width and height of the primary monitor, if that isn't how it's doing it currently, just to prevent the error from interfering with the setup.\n. ",
    "ArcticRavine": "Everything seems to work just fine in windowed. The only resolution I'm able to use in full screen is 1920x1080, if I try to choose another setting it says 'The screen size you requested is not available in fullscreen mode'. I've tried both OpenGL (Doesn't track the pen properly) and SDL, which I can actually use however it lags more than DirectX.\n. ",
    "Dinnerbone": "I can reproduce this issue on my surface pro 3 using either DirectX or OpenGL rendering, but SDL rendering is fine. SDL doesn't seem to lag for me though, so I have no issues using it.\nThe sdl2 branch works too, but comes with a range of its own rendering issues that I shan't spam here (I can reproduce those on my main pc, though, so they're not relevant to this issue.)\n. Confirmed. You can work around it by switching to windowed mode and pulling up the keyboard manually, but that kinda sucks.\nI took a look into SDL 2's touch support, and whilst they do support access to on-screen keyboards where applicable, the SDL_HasScreenKeyboardSupport() method returns SDL_FALSE for windows 8 (I checked on my tablet to make sure, same deal). It also doesn't bring up the on-screen keyboard when you call SDL_StartTextInput().\nI think if this is to be solved, it's either by figuring out how to manually bring up the keyboard or to fix SDL (... by figuring out how to manually bring up the keyboard, and then sticking it in there).\n. ",
    "xuancong84": "Hi MarkL and Stephen,\nThanks for your reply!\nYes, currently you can scroll in windowed mode. However, if the mouse\nleaves the window, the scroll will stop (at least for Linux 0.40rc2).\nDuring playing, it is quite often that the player will move the mouse\nbeyond the window's boundary if he intends to scroll.\nI have already submitted the modified code in my previous email. Didn't you\nsee that?\nxuancong\nOn Mon, Dec 15, 2014 at 8:40 AM, Stephen E. Baker notifications@github.com\nwrote:\n\n@MarkL1961 https://github.com/MarkL1961 It's finicky to get the mouse\nin precisely the right spot. This change makes it easier to scroll because\nit captures how far the mouse moves each tick and repeats for scroll speed\nwhen the mouse leaves the window so you don't need to hover on the border.\nI'm not yet 100% sold on the idea but I would be curious to try it out\n@xuancong84 https://github.com/xuancong84 Would you mind to submit the\npatch you described?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/431#issuecomment-66937966.\n. > What if you want to leave the game window, to open an email for example, will you still be able to do that?\n\nI think it will not hurt. The screen will just scroll all the way until the map boundary while you are doing something else in another window.\nBy the way, please change:\nif gain == 0 then\ninto\nif gain == 0 and self.dx~=nil and self.dy~=nil then\nBecause the dx dy is not initialized when a new level starts. Otherwise, it may cause exception when entering a new level.\n. Hi, @MarkL1961 @admdly @TheCycoONE \n1)\nI think it might be a better idea to combine #431 and #213, so that if the mouse leaves window, the screen keeps scrolling, but if the mouse activate another window or the player alt-tab to another window, the game will suspend instead of pause. The difference is that when paused, you can still scroll and place objects; when suspended, no more scrolling, you cannot do anything.\n2)\nBtw, the scrolling crash issue has nothing to do with this enhancement because I encounter that crash when scrolling in full screen Ubuntu, that is why I switch to windowed mode because in Ubuntu full screen once crash, I cannot even quit the game or alt-tab out, I have to switch to TTY to kill x-window. In windowed mode, at least I can see the error msg in console and force quit.\n. Yes, middle button can scroll. But it will be more convenient to scroll without pressing any mouse button\n. Another same problem here, very easy to fix:\n./Lua/rooms/psych.lua:105: attempt to index a nil value\nstack traceback:\n    ./Lua/rooms/psych.lua: in function 'after_use'\n    ./Lua/humanoid_actions/use_screen.lua:29: in function 'timer_function'\n    ./Lua/entity.lua:215: in function 'tick'\n    ./Lua/world.lua:1103: in function 'onTick'\n    ./Lua/app.lua:852: in function 'dispatch'\n    ./Lua/app.lua:753: in function <./Lua/app.lua:748>\n. We can find all these problems by searching for the keyword 'staff' or 'Staff'  in the Lua scripts, i.e.,\ngrep '[Ss]taff' -R Lua/\nHere is the compiled list of files:\nLua/rooms/inflation.lua:56:\nLua/rooms/x_ray_room.lua:69:\nLua/rooms/electrolysis.lua:57:\nLua/rooms/blood_machine_room.lua:56:\nLua/rooms/ultrascan.lua:56:\nLua/rooms/decontamination.lua:52:\nLua/rooms/dna_fixer.lua:58:\nLua/rooms/hair_restoration.lua:56:\nLua/rooms/fracture_clinic.lua:56:\nLua/rooms/jelly_vat.lua:56:\nLua/rooms/general_diag.lua:58:\nLua/rooms/ward.lua:137:\nLua/rooms/slack_tongue.lua:56:\nLua/rooms/scanner_room.lua:61:\nLua/rooms/operating_theatre.lua:111: and 139\n. writing text over video is very tough, I have encountered that when implementing Project Diva PC HD. To make it simpler, can we first play the video and then display the last frame of the winlevel video as a still image and write text over that image?\n. Try to copy and paste the link text, don't click on the link.\nor try this one:\nhttps://sites.google.com/site/xuancong84/02.sav?attredirects=0&d=1\n. What OS are you running?\nI have played the same game in both Windows and Ubuntu 14.04, saved the game in one OS and loaded the game from the other OS and continue playing. Maybe that's the cause. The saved game file might be slightly different in different OS, causing data corruption.\n. Hi, thanks!\nI have solved the problem. It does not seem to be an OS compatibility problem. I feel that it is like a game crash has corrupted the game binary file in Ubuntu. After that, the game has problem in saving and loading. Reinstalling CorsixTH solves the issue.\n. Sorry, I got messed up in the beginning. Actually, I reverted back some of\nmy earlier commits. So there are in total 2 modifications:\n1. dynamic information display during pause\n2. spacebar to center view\nSince I am using eclipse egit, I am not sure how to \"checkout -b\" and\nrevert back properly.\nIf there are no conflicts, please accept this pull request. Next time I\nwill do it correctly. Thanks!\nxc\nOn Fri, Jan 30, 2015 at 10:28 PM, Stephen E. Baker <notifications@github.com\n\nwrote:\nI strongly recommend you don't work out of your master branch. There is a\nlot of history in this pull request that doesn't belong with it.\nStart by closing this pull request, then:\ngit checkout -b currentwork\ngit checkout master\ngit reset --hard origin/master\nAt that point it's a matter of straightening out your current work. Maybe\njump on #corsix-th or read some git guides.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/644#issuecomment-72208741.\n. Thanks! But I am using Linux/Ubuntu Eclipse egit.\nI have figured out how it works. I will re-commit everything.\n\nxc\nOn Sat, Jan 31, 2015 at 1:28 AM, wolfy1339 notifications@github.com wrote:\n\nIf you are using Windows, I highly recomment to download MSYSGit\nhttps://github.com/msysgit/msysgit/releases.\nInstal it, then open Git Bash (Termainl containing Git), then you may\nenter the commands TheCycoOne gave you.\nAnd also read some more about Git at http://git-scm.com/doc\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/644#issuecomment-72237704.\n. Thanks! I have figured out how it works. I will re-commit the two changes\nand issue a single pull request.\n\nCheers,\nxc\nOn Sat, Jan 31, 2015 at 3:08 AM, Stephen E. Baker notifications@github.com\nwrote:\n\n@xuancong84 https://github.com/xuancong84 you run these commands in the\nterminal. The instructions in CONTRIBUTING.txt are detailed step by step.\nOnce you have clean pull requests we can go over any changes needed.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/644#issuecomment-72253072.\n. Oops, I did not realize that spacebar is also used in rotating objects when setting rooms. \n\nIn principle, the key handler should be stored and disabled, then after finishing the room, restore the old key handler for center view. \nCheers,\nXuancong\n\nOn 31 Jan 2015, at 10:16 pm, MarkL notifications@github.com wrote:\nWhat happens if you are editing a room when one of these announcements happen?\nWill my object rotate or will my view centre on the cause of the announcement?\nhttps://github.com/CorsixTH/CorsixTH/wiki/Hotkeys#edit-room--place-objects-window\n\u2014\nReply to this email directly or view it on GitHub.\n. Yup, I also encounter the same problem, on the newest master branch (2015.1.29). Essentially, the fax sliding icon cannot appear.\nThis bug is fatal.\nHowever, you can continue playing the game by pressing alt+enter.\n. Hi, @Andy51 and @TheCycoONE \nI have worked around it successfully!\nIn Lua/dialogs/message.lua, comment out the two lines of canvas:setClip(...)\nSince this animation is very short and fast, the imperfection is hardly perceivable, at least to me.\n\n-->\"I guess i would try to find what is going on in the code then\"\nHowever, it seems that the bug lies in the SDL library function SDL_RenderSetClipRect, but not in our source code (including both LUA and C++), so we cannot actually fix the bug. Nonetheless, we can inform the SDL library developers to fix the bug.\nGood luck!\n. Maybe you are right. The old code also does clipping. Why doesn't it cause any problem then?\nCheers,\nXuancong\n\nOn 31 Jan 2015, at 11:16 pm, Stephen E. Baker notifications@github.com wrote:\nThanks for that @xuancong84 \nIt's still very likely the problem is in our own code, but that helps us focus.\n\u2014\nReply to this email directly or view it on GitHub.\n. I don't think that is efficient as I have made further commits. Maybe when @CycoOne merging my branch, you add an additional condition that the allow-edit-during-pause option must also be enabled as well. \n\nCheers,\nXuancong\n\nOn 31 Jan 2015, at 3:32 pm, Edvin notifications@github.com wrote:\nFor the pause thing: The game is not meant to be playable while paused (a kind of difficulty mechanism). However, there is an advanced setting in the options menu that let's you tick \"play while paused\" to on. When on we should indeed show info in the dynamic bar.\nI would suggest to create two pull requests, one for each change.\n\u2014\nReply to this email directly or view it on GitHub.\n. I see. I think things are a bit messed up because the CorsixTH/CorsixTH\nmaster branch is now full of dirt:\n1. the clip bug\n2. background music speed sometimes faster\n3. screen flashed black and white if you zoom during right-click picked\n4. ghost images: so many humanoids while right-click picked\n\nI have created branch 0.40 and 0.45 in my fork. When the time comes, you\njust watch the difference between 0.40 and 0.45 while patching up the\nmaster.\nxc\nOn Sun, Feb 1, 2015 at 11:47 AM, Stephen E. Baker notifications@github.com\nwrote:\n\n@xuancong84 https://github.com/xuancong84 this is why it's important to\nmake your changes in different branches.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/647#issuecomment-72350046.\n. hi Stephen,\n\nIt seems that both the \"scale\" function and \"setClip\" function in SDL has\nproblems, they cause blackout and flicking during rendering. Or should we\nfall back to the old SDL?\nxc\nOn Sat, Jan 31, 2015 at 7:47 PM, Stephen E. Baker notifications@github.com\nwrote:\n\n@xuancong84 https://github.com/xuancong84 this is why it's important to\nmake your changes in different branches.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/647#issuecomment-72350046.\n. I confirm that it is identical to  #370\nSo did you encounter the same problem? And how to solve the problem?\n. \n",
    "geordish": "I never edited the rooms at all. They are exactly as first built.\nIt has happened several times, in different levels. I'm quietly confident that if you let that save game run a little longer, the same thing will happen to the last remaining psychiatry!\n. @TheCycoONE The multiple screens were not added by me (I'm unsure its even possible to place them that close)\nI do have a save from before the problem happened, however its right at the beginning of the level. I'm unsure how useful that would be.\nFor reference, this has happened several times on several levels.\n. Even my oldest autosave has it in the broken state!\n. ",
    "da4id": "Im new in CorsixTH, but i know very well the orignal game. I've made some thougs about this issue which i want to discuss.\nBoiler Breakdown should depend on \n- number of Handymens\n- number of Radiators\n- heating level\n- some random\nMy idea ist to have a breakdown score. Each day this score will be increased by some value depend on heating level, ratio radiators/handyman and some random value. If score reaches critical level boiler breaks down. But there should be some independent random part too. \nThe decision if boiler breaks down is now implemented with\nlocal breakdown = math.random(1, 240)\nif breakdown == 1 and not self.heating_broke and self.boiler_can_break and self.world.object_counts.radiator > 0 then\nthis gives average brekdown every 3 Months.\nWhat do you think about having something like:\nlocal breakdown = math.random(1, 10000)\nself.boiler_breakdown_score += math.random()*self.radiator_heat*nb_radiators/nb_handyman\nif (self.boiler_breakdown_score > criticalLevel or breakdown == 1) and not self.heating_broke and self.boiler_can_break and self.world.object_counts.radiator > 0 then\nwith a very low probability it is possible that you have multiple breakdowns within short time, because there is still some random part. \ncriticalLevel should be something like:\nif you have 5 Radiators per Handyman and a heating level of 50% the boiler should breakdown in average after 5 years. This gives critical level = 5 years * 365 * 5 radiatorsPerHandyman / 4 = 2281.2\nI've tested this algorithm in Matlab with 1000 runs and the boiler will breakdown between 58 and 63 months. If you run the same values but with 100% heating rate breakdown will occur every 28 to 32 months.\nIm not sure about a good ratio radiators/handyman and average time for breakdown.\nDo you think 5 years with 5 Radiators per Handyman is a good choice? Or should there be more Radiators per Handyman? Are 5 years to much? Is one or two years better?. Played yesterday the original game level 1 and 2. \nLevel 1 one year and boiler never broke down. Level 2 five years and it happened one time after 2 years. It was possible to finish layer 1 and 2 without any boiler break down. In level 2 i denied the next level message multiple times.\nI build 30 radiators and employed 3 handymans. \nAnother thing that i noticed which could be related to this topic is that the stuff ask much more for salery  in corsixTH than in the original game. . Thank you for your analysis. \nHow often is this disasterLaunch called? \nWith a ratio higher than 8 is it still possible to get hit by boiler breakdown?. I have now implemented it as in the original game.\nBoiler will now breakdown every 200 days. This should depend on difficulty. how can I get the difficulty level in lua?. Ive added it now. On the custom maps this value is not available therefore i added 200 days per default if not defined. I will implement this function later. \nI know, on the orignal game this was really hard to control and you had to hire all handymans. This made the game much much more difficult. \nI started a new Issue #1347. The trigger is gbv.disasterLaunch with 50% chance of boiler breakdown, 25% chance of vomit wave and 25% chance that nothing happens. This makes shure that the player dont get hit by both at once.. I don't know how its implemented in the original game.\nI think it could be something similar to epidemics. If a person vomit the persons next to this persons get infected by this and do the same after infection time or something. This is more a self running chain reaction which get triggered by disaster launch and keep going until infection stopped by some criteria like people have enough space between each other, handyman's cleans mess up or people get cured.\nmaybe there is some other criteria to stop\nThats what i observed from the original one\n@pschoffer \nGood point, another name could be HeatingController including breakdown, costs, heat spread and so on. Maybe a second class disasterLauncher for breakdown trigger and vomit waves.. I moved all the boiler code from hospital.lua to new heatingController class. Some variables like self.radiator_heat or self.heating_broke are accessed from outside hospital.lua to control the radiator heat or to see if the heating works. From which class is this controlled? Another problem is that these variables are restored after saved game is loaded. What is the nicest way to pass these variables after load from hospital.lua to heatingController in order to keep it compatible with older save games? New safegames does not need this because they can store it directly in heatingController. When is Hospital:afterLoad(old, new) called? What is stored in old and new?\nI think its not a good solutions to keep these variables in hospital.lua because they need to get passed from and to heatingcontroller all the time. Wow nice feature. Another question: In which class is the heat spreading implemented (Temperature of Field xy)? How does this class know what the actual radiators_heat is?. Alright. So i dont need to move this code to heatingController.lua. When i update the line in world.lua it should work. Checking CorsixTH/Lua/HeatingController.lua       1 warning\n    CorsixTH/Lua/HeatingController.lua:85:42: (W212) unused argument new\nChecking CorsixTH/Lua/hospital.lua                2 warnings\n    CorsixTH/Lua/hospital.lua:97:28: (W113) accessing undefined variable HeatingController\n    CorsixTH/Lua/hospital.lua:640:30: (W113) accessing undefined variable HeatingController\nTotal: 3 warnings / 0 errors in 288 files\nHow can i fix these warnings?. @TheCycoONE Ou sorry, I was very busy the last months and forgot this pullrequest. I will do the refactoring this week.. Intresting, but if you have a very large hospital or a very small 10 tiles with litter is not the same. I think it should be more like a density (eg. 1 litter per 10x10 tiles or so). But only floor tiles are counted.\nAnother idea is that it could be something similar to epidemics. If a person vomit the persons next to this persons get infected by this and do the same after infection time or something. This is more a self running chain reaction which get triggered by disaster launch and keep going until infection stopped by some criteria like people have enough space between each other, handyman's cleans mess up or people get cured.\nHow did you figure this out? Disasembler?. What events could trigger the calculation of how many tiles are available and how much litter is on the floor? \nOne idea is to do this calculation every tick or day or so. Another idea is to do it after some actions are complete like: vomit, sweep_floor, pee or litter (i cant find this), build room finished, room removed\nI am little concerned about performance issues in larger hospitals. To simplify the calculation there could be two counters for free tiles and litter + vomit + pee. These counters get incremented decremented each time.\nHow does the vomit wave itself run? At end of each day: x percent of all waiting and walking persons receive vomit action?\n. Seems to be related to #1104 . Eclipse projekt data\nyou can ignore this. I created a function for calculating the expected heating costs. I need the same calculation in the onEndDay and town_map. They need isPlayerHospital otherwise adviser will show messages. ",
    "mrbenjamin1": "From my issues #641 I can also add I had manually asked janitor to fix the now exploded rooms. This is useing the latest version.\n. after looking at the error again (it has happened a number of times now) it seems that if you set a room to be repaired and then it blows up before the janitor gets to fix it. the Icon still remains over the top of the machine saying it due to be fixed and the janitor still heads to fix the room and gets stuck. im guessing he gets stuck as he is trying to enter a broken room.\nCould that be the \"Map Co-ordinates out of bounds\" error as he is trying to access a part of the map that is no longer accessible?\n. ",
    "martenson": "@admdly I have the gog version and can test.\n. ",
    "fusionstream": "Setting #quake_control[0].StartMonth.EndMonth.Severity 0 0 0 still produces random high severity earthquakes with no pre-tremors... This was present since 0.40 (iirc).. Sorry, forgot to mention that now I'm posting for 0.60. Definitely created when the room was created. Also it is evidently more than just bins. Have just seen radiators and fire extinguishers too. I've had it happen 3 more times so far, I have 1 screenshot and 2 phone camera shots... I will save the game if I come across it again. . \n\n\nMy autosaves are all after this event. I will try now to get more evidence.\n. ",
    "tmarplatt": "I've got a 0.50 savefile of the \"GP doctor wandering in the room-bug\", but it happened spontaneously (I didn't have to replace any doctor).\nNot sure what triggered this but I've seen it happen spontaneously as well a few times.\nwalkingGP.zip\n. Sadly I don't have one, I'm sorry :/ There's one from that same level but saved a few hours later.\n. I'm sorry for the dupe issue, but before I did so I searched and found this one first, and it did not seem like the same issue at all (submitter comments on hospital being cold, while I can avoid that by placing all radiators generally in southeast corners). \nIn fact nowhere before this comment it's mentioned that radiators irradiate heat diagonally northwest, ignoring their immediate southeast area.. ",
    "mrjono1": "I have also had this same error in the console multiple times today each time the same things occurred.\nI have created this game with the latest version of CorsixTH and have not had any previous versions installed.\nThere was an earthquake which caused the rooms to explode. After the explosion I noticed that there was a janitor stuck just outside the room. No matter what I do I cannot move the Janitor, some times I can sack him. I am also getting 'Sorry, but an error has occured. There can be many reasons - see the log window for details. Would you like to attempt a recovery?\"\nI was also unable to use the in game menus after this error occurred.\nI think it has something to do with Janitors going to repair the room just before it explodes. I know I set the room on the left(X-Ray) to be repaired just before the earthquake, and the room on the right(Operating Theater) during the earthquake.\nOff the pic is another X-Ray that has a stuck janitor after the explosion\nAttached pic contains janitors waiting outside rooms\n\nAttached pic contains console errors. I think the second error here is when i tried to fire the stuck janitor\n\n. ",
    "ChrisPre": "I've had a similar issue but where a handyman entered the Operating theatre, watered a plant and got stuck trying to leave (seemingly as if he's joined the queue for the room). This prevents any patients or even doctors from entering the room.\nI have a save I could provide if required (although I can't find a way of uploading a .sav to this report!).\n. ",
    "fangxianfu": "I reconstructed the patch, I'll make a PR :). To get this working properly, it seems like the room.readiness_bonus needs reducing. 5 patients in queue is a lot of penalty - it effectively means that if you have one room open (max queue size > 0) and one closed (max queue size 0), the closed room is ignored until the number of patients in the queue for the open room is > 5, even if the max queue size for that room is less than 5. So this new ability to \"soft close\" rooms isn't useful if you wanted to set the max queue size of the open rooms to less than 5 - which, personally, I usually do.\nIt also seems quite weird even without this change, though. The current readiness_bonus means that if you have, say, two Pharmacies, both with max queue size >5, and one has a nurse already and the other doesn't, that patients won't choose the staff-member-less room until the queue of the room with a staff member is 5 or more. The weird part about this for me is that because patients will reject ever going to the room without a staff member, a staff member will never be requested for it. So you get the kind of odd result of two open pharmacies, one with a 5 patients waiting and one with 0, and no call being sent for another nurse. It's kind of a catch-22 since the bonus happens because there is no nurse, and no nurse is called because it has the bonus.\nI'm going to experiment with some different values for readiness_bonus; has it been studied before?. ",
    "saprys": "Hi, after installing under mac os High Sierra in the settings there is no Russian language, I run the version from gog\n\n. ",
    "koanxd": "Sorry, I wasn't talking about the map editor, I wouldn't want to mess with that yet. I meant the one for editing the .level textfiles.\n. Thanks, I will address all your points. Regarding semi-random, I think the best way is to display a warning that it may cause issues if the values are set too low.\n. I realize that it's not pretty, and I'm not a fan of java eiter. So I don't mind if or how this ends up being used..\n. I read that leveledit will not be making it to 0.50, which is reasonable. I know it has been too long, but I haven't abandoned this project. Is a replacement planned? Otherwise, I will continue working on this, even though motivation is an issue since I am rewriting the whole thing.\n. Sounds good to me.\n. Not that I know of. It's been in a state of \"almost done\" for a while now, but it wouldn't make sense to do a commit due to the extensive and still ongoing changes. Sorry about that. Most notably, language can now be changed during runtime, and the writing process will now leave the file as it was, except where the user made changes. I'm also getting rid of the copypaste-code, in the hopes of creating something that is maintainable.. which it still might not be, but at least it will be documented.\nAs I said before, if someone else wants to step in, please go ahead. For me, this started as a personal learning project, but yes I do still work on it occasionally.\n. To be honest, after a while I was too embarrassed to post here since I was never able to show any good work. I underestimated the amount of effort and got frustrated.\nSince there is still interest, I'm giving it another try. If I don't reply by the end of next month I will have quit for good, though.\n(In case anyone wants to see the latest source, let me know. I just don't think it would be of much use.). It just means I'm the type of person to draw things out until the last minute. I plan to upload on the 28th or the day after. I'll be taking Alberth's advice to reduce the scope as well.. I've uploaded a new version under a separate repository: https://github.com/koanxd/corsixTH-LevelEdit\nNote that this commit is based on an out-dated version, so the most recent LevelEdit changes by Alberth are not included.\nI am also not familiar with build tools, so I have included an executable .jar file.\nA full changelog is included as a commit message. In hindsight, this patch should have been done in much smaller steps. I am sure there are new bugs introduced in this version, so further testing is needed before using it. Regardless, I hope something can be gained from this eventually.. I don't know what could be causing it. I suspect it may be related to Windows permissions. Can anyone else reproduce the error?\nI've opened an issue here: https://github.com/koanxd/corsixTH-LevelEdit/issues/1. ",
    "LloydJara": "Is leveledit still under dev or snowblind has ceased to work on it? (As it have been two years since the last post here)\nIm interested since its a real hell to edit manually everything.. Then probably dead, as snowblind was active when i made my acc at the forums but its no longer active.\nReally bad, as LevelEdit just makes everything easier.. Glad to hear (actually read haha) that you're giving another try to this tool, snowblind. Hope i see some progress. Don't give up on it, It's a really helpful tool man!\nAnd as Alberth said, it's better a working small patch than an unfinished full version.. February is almost over and we have no news from snowblind. Does this mean he may have ceased developing LevelEdit? (Since he said if he didn't reply by the end of this month he would have quit for good). Oh, i see. Sorry if my message sounded a bit rude. :p Looking forward for your update.. https://prnt.sc/indyan Ok, i can't save nor load files, not good.. Personally i haven't tried to replicate this error since it first happened. I was waiting for someone besides you to do so. But since no one has I'll probably retry tomorrow.. Sadly i dont have the save right before the Handyman got suck. Not sure if i can replicate if perfectly but i could try.. It is, but im pretty sure the stuck handyman is still getting his salary paid (and even if i fire him, he would make space blocking any room to be build over him, which is annoying)\nWhen this same problem happened with the Grim Reaper it got stuck on a vital spot, blocking me from building rooms there and.,. ironically, making me lose the scenario shortly after because i run out and space and i filled the Money losing condition.\nI guess if this bug happens once again i'll try to keep the pre-save as well as the post-save.. ",
    "sigzegv": "I managed to make a save juste some seconds before patient dies (near the drugstore) and pops the lava hole (We can see the lava hole form, and then after 1 or 2 seconds game freezes)\nhttps://drive.google.com/file/d/0Bx4ES5LbaH1mT2w2MTFudHFyR2M/view?usp=sharing\n. You are right Mark, I switched the game to english ( I was using French ) and it didn't freezed. \nSo it is a locale issue.\n. Which Sound files are supposed to be present ? I only have Sound-1.dat but the CD has 0 to 5 ( and they have not been installed by initial setup )\n. Did you got the crash with SOUND-1.dat like me ?\n. I can share my Sound-1.dat if needed.\n. Sorry I'am under linux :) I will be able to rebuild when the patch is commited\n. ",
    "ms609": "I am finding that the game often crashes when I move a staff member whilst they are completing a task, then perform another action before they have been relocated.\nFor example: right click a surgeon whilst he is performing surgery; click the intended destination, press F3 to open the Staff dialog; close the staff dialog.  When surgery is completed, two instances of the transported staff member are briefly visible; often, the instance that finally becomes the staff member becomes frozen and will not move further.\n. ",
    "legluondunet": "Ubuntu does not use FFMPEG but libav fork...FFMPEG is no more available in the Ubuntu official depot.\nhttp://en.wikipedia.org/wiki/Libav\n. Thank you Lego for your answer. But I don't think it's a good idea to install ffmpeg on a distribution that took the decision to use a fork of it: it could appear incompatibilities or others non yet unidentifed bugs...Another idea: use the libav fork. I don't know how adapt the corsix code to use the libav, but libav code's similare to ffmpeg code and has same librairies name. \nSomewhere in the Corsix code:\nIf distribution=Ubuntu\nuse libavfork\nthen use ffmpeg\nend;\n. You are right, ffmpeg will return in the 15.04. But to not interfer with libav librairies, ffmpeg files will be renamed.\nFor example:\ndpkg -L libswresample-ffmpeg1\n/.\n/usr\n/usr/share\n/usr/share/lintian\n/usr/share/lintian/overrides\n/usr/share/lintian/overrides/libswresample-ffmpeg1\n/usr/share/doc\n/usr/share/doc/libswresample-ffmpeg1\n/usr/share/doc/libswresample-ffmpeg1/copyright\n/usr/share/doc/libswresample-ffmpeg1/changelog.Debian.gz\n/usr/lib\n/usr/lib/x86_64-linux-gnu\n/usr/lib/x86_64-linux-gnu/libswresample-ffmpeg.so.1.1.100\n/usr/lib/x86_64-linux-gnu/libswresample-ffmpeg.so.1\nWill Corsix-th find this renamed librairies?\nAnd for the moment ffmpeg dev package are not planned...\n. Another point, like said here http://www.webupd8.org/2014/11/ffmpeg-returns-to-official-ubuntu.html:\n\"Jon Severinsson's FFmpeg PPA was pretty popular but:\n- FFmpeg from this PPA uses the same library names as Libav so it might break stuff;\"\nUbuntu softwares are compiled to use libav instead of ffmpeg, if you break Ubuntu libav, a lot of software could no more be runnable.\n. I tried to compile it without video option, compilation finished ok.\nNow since the game is more funny with video, I'm trying to find a workaround for Ubuntu.\nLike TheCycoONE suggested me, I just downloaded ffmpeg from git, compiled it (OK) and launched cmake-gui to point ffmpeg include dirs option to my ffmpeg git folder root.\nThe compile failed just at the end...grrr\nPlease take a look here:\nhttp://pastebin.com/N6Yaue0z\n. this is my CMakeCache.txt\nhttp://pastebin.com/xDmDcSUh\n. This is my new CMakeCache.txt, now I think all FFMPEG dirs are right:\nhttp://pastebin.com/AbH767et\nCompile still failed at 100 % but the errors messages changed:\nhttp://pastebin.com/Mt635DWb\n. Done, but I obtained the same errors messagest:\nhttp://pastebin.com/gwp4nC3V\nMy last CMakeCache.txt:\nhttp://pastebin.com/KJmGshe5\nIs Corsix-th compatible with last ffmpeg git?\n. too difficult for me to link static FFMPEG librairies to Corsix-th. I think my FFMPEG compilation is not entirely static and ask for zlib librairies wich is external...and I don't know how to add zlib librairie in FFMPEG (and if it is possible...). But I don't have the level to go further...So I will install the Jefferson PPA when I would like to play Corsix-th and do a ppa-purge when I don't play...But it's a pity to penalize/annoying all Ubuntu/Debian users who want to use Corsix-th.\n. Another good project like Performous, a Karaoke app for Linux, found a way to have compatibility for FFMPEG and LIBAV: https://github.com/performous/performous/issues/115\nRetroarch use FFMPEG and is Ubuntu compatible too. \nPerrhaps you could contact to know if you could add libav compatibility without a big change in the code?\n. Hello TheCycoOne,\nhappy to read you :)\nI just tried:\nconfigure OK\ngenerate OK\nbut I have an compilation error:\nhttp://pastebin.com/nPzhVPvU \n. I tried to compile CorsixTH on another computer where I have never installed FFMPEG ppa (or other fmmpeg packages), same Ubuntu version (14.04 LTS), I obtain a similar error message:\nhttp://pastebin.com/Ss4hMRJ0\n. My CMakeCache.txt:\nhttp://pastebin.com/mFDbSvNE\nMy libavutil package version:\nlibavutil51:am 6:0.8.7-1ubu amd64\nlibavutil52:am 6:9.16-0ubun amd64\nlibavutil-dev  6:9.16-0ubun amd64\n. Just tested your theory:\n....\n[ 87%] Building CXX object CorsixTH/CMakeFiles/CorsixTH.dir/Src/th_sound.cpp.o\n[ 90%] Building C object CorsixTH/CMakeFiles/CorsixTH.dir/Src/random.c.o\n[ 93%] Building C object CorsixTH/CMakeFiles/CorsixTH.dir//LFS/lfs.c.o\n[ 96%] Building C object CorsixTH/CMakeFiles/CorsixTH.dir//LFS/lfs_ext.c.o\n[100%] Building C object CorsixTH/CMakeFiles/CorsixTH.dir/__/LPEG/lpeg.c.o\nLinking CXX executable CorsixTH\nmake[2]: AVERTISSEMENT\u00a0: d\u00e9calage d'horloge d\u00e9tect\u00e9. La construction peut \u00eatre incompl\u00e8te.\n[100%] Built target CorsixTH\nThis message means (google translation): WARNING: clock skew detected. The construction may be incomplete.\nAnyway I obtained an executable and I can launch it.\nI will tell you later if the video playing ok with this version, I don't have TH on the hard disk of my working office, it is better for my productivity ;).\n. I just compiled CorsixTH-54e392b7b3a08b6c8169661972f1377c08fdae1c at home:\n--> compilation ok with no error message\n--> launch CorsixTH OK\n--> first video: sound OK but no video, black window instead of video\n--> aim screen with menu, choose new game OK\n--> second video, only the first image, sound OK, then CorsixTH freeze, no active key, can not close it or interact anymore\nTerminal log:\nhttp://pastebin.com/KwG5TD14\n. I changed the option in config.txt:\nmovies = false\nand I can play the game.\nI'm a little curious, what OS are you using? :)\n. /Theme Hospital/HOSPITAL/ANIMS\n$ md5sum *\n4d0c496b10b1b451e91775b11d836f75  320X2401.SMK\n2482104ac9d185994dc31ac4eecb1fb1  320X2402.SMK\n241a38b84de945e52af66acfceeeb4ea  320X2403.SMK\ncac991cb86962b70401a3c6722911c10  320X2404.SMK\n3abafe170e38df1328b46de6d8b5557a  320X2405.SMK\ndc28d06cc94511eb60e2991dce8055c3  320X2406.SMK\n418c37b21abb838da7ed177dc58cfc45  AREA01V.SMK\ncd37e94f786a8e93c55be2f8ae0d7b0c  AREA02V.SMK\n703f95bd357c7def52fd685248a1b1fb  AREA03V.SMK\n369b93f872b7be880160fd5441580058  AREA04V.SMK\n1ef9f28b07a2f328aba7cee63b5e872d  AREA05V.SMK\n234ea556ba5f3a683233dedaa3ef497b  AREA06V.SMK\ndd0b8e9b3cfd545c9dade86973f7e232  AREA07V.SMK\n582ed9b17ddeea60e0f537f89a552185  AREA08V.SMK\na7869a354753214290a0ac1d1b62f442  AREA09V.SMK\n2a5a9406a3594d3c30cb95a3be88e378  AREA10V.SMK\nb8e7d45a3b0173444d259177e10ec130  AREA11V.SMK\ned46f581d2aca167dafe2caa114baae0  AREA12V.SMK\nfd49324840bcf4e0bb24bff094cee059  AREA13V.SMK\n625ade4e866efdaeb9d8a1e169fcc46c  AREA14V.SMK\nf5012250aab9844ca41346a8651dcf94  ATTRACT.SMK\n48cb59596caed2e4a309686f6bc53394  LOPAPER.SMK\n844be5d66f842101d96726f1a69e10c3  LOSE1.SMK\nfe3010b2a74822d1fca46be00d4db307  LOSE2.SMK\n92dd1273563847e2d8345f406a1e0fd2  LOSE3.SMK\n35653bec56aac35006ea50ea7e143218  LOSE4.SMK\n8976d0f82938281498e9d1eab50a33d2  LOSE5.SMK\nb30fcad0a7ca654e74d5825bdd5d449a  LOSE6.SMK\ne6923850b74703c48a056fbc9c52431f  MMENU1-0.SMK\n7594c2c37bec795e4f89f19fb415fe98  MMENU2-0.SMK\n8fd881cf9f39cbf4923e4d331ef1b2ef  WINGAME.SMK\nad06e8010536d1776bf83e1b7d5a8a13  WINLEVEL.SMK\n/Theme Hospital/HOSPITAL/INTRO\n$ md5sum *\nad4bff04dfb64bc4216d821b4cf3d303  attract.smk\nad5a79ad8df98292220b16e6a29422c1  intro.sm2\n93eeb6c1bb704b976268e87d2a72067d  intro.sm4\n. I just trying to play intro.sm4 with avplay:\nvideo and sound play good untill the frog fully drawed, then video freeze.\nI can hear the sound until the end of the video.\n. Good news, you done a very nice work! :+1:  I will submit a bug to Ubuntu and ask them to update libav on last LTS.\n. this is my bug report on launchpad: \nhttps://bugs.launchpad.net/ubuntu/+source/libav/+bug/1415878\ncould you click on \"this bug affect me too\", thank you.\n. This patch seems heavily used by TH french gamers. \nSo I opened this issue for several reasons:\n-    let a trace on the internet of incompatibility between this patch and Corsixth\n-    inform Corsixth team A crash give only one information to the user: that software doesn't work. Perhaps you could add to corsixth a file verification that prevent users to use modified files? Or inform them, at the corsixth launch, that they are using a patch that is not supported by corsixth and could crash it.\n. MarkL1961, I'm using the last CorsixTH git, so your update does not work with this sound file. Perhaps you could test it?\n. you tested it with the last corsixTH version from git?\n. ok thank you Mark :).\n. @MarkL1961 Mark I just compiled the last git version, applied the patch and CorsixTH crash at start, without another message than \"segmentation fault, core dumped\". But If I replace the \"sound-1.dat\" by the original one, CorsixTH no more crash. I closed this issue because I don't want to annoying dev with bugs from an unofficial patch.\n. Mark I gave you a link to the wrong file, it's sound-1.dat from the patch wich make CTH crash, not LANG-1.DAT. In the TH french version, some speechs from the receptionist are not correct or missed, this modified sound-1.dat file corrects that.\n. ",
    "TobiX": "No, we spend 3 month porting from a state before there was any dedicated resample library (audio_resample in libavcodec) to libavresample. IIRC XBMC/Kodi has a shim that translates between avresample and swresample since they are very similar in interface. We just used libavresample since at that time both projects provided it and only ffmpeg has libswresample...\nOTOH, both Debian and Ubuntu have ffmpeg back in their repository...\n. ",
    "DoctorToboggan": "I'll do some more testing and see what happens.  I usually shove the fire extinguisher back there, cause safety and all that.  I know off my head that using that 4x4 with the door where it is, that is the only place the desk can go, but isn't the only 4x4 that works.\nEdit: Tested with a plant back there, and it dies.  The handymen seem to ignore it for a long time too even after you pull it out, but eventually they end up watering it again.\n. ",
    "hishamhm": "Hi, the MoonRocks website indeed took over the role as the LuaRocks.org website. The download URLs still work as always, but we still need to convert the documentation (raw files currently at https://github.com/hishamhm/luarocks-docs ). Note that even during the luarocks.org downtime, the default repository for rocks was already rocks.moonscript.org and it stayed up all the time \u2014 if you got build errors during the luarocks.org downtime, maybe you were using an old version that still fetched rocks via luarocks.org? This can be fixed via configuration.\n. ",
    "readingsnail": "ah, i wrong think... so i closed this issue :)\n. ",
    "Ben22640": "Hello,\nI got the same error too (Windows 10, CorsixTH 0.50, game was loaded from 0.50) :\nCreated game with savegame version 105.\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\room.lua:317: Handyman arrived is on call but not arriving to the designated room\nstack traceback:\n    [C]: in function 'assert'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:317: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:356: in local 'on_next_tile_set'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:190: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:218: in field 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:149: in method 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1121: in method 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:878: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:779: in function \nIs there any known solutions ? I'm totally blocked in my game.\nSave.zip\n. ",
    "ElvarT": "@TheCycoONE : Yes, moving the \"slicer\" one tile away from the pharmacy wall, from (55-56,95-96) to (56-57,95-96), seems that both the pharmacy plant and the slicer are serviced without problems.. Regarding the handyman crashes. I have also seen them happening a couple of times. If you would be interested, this is a savegame just a couple of seconds before one of them:\nhttps://nofile.io/f/CPpw3vms82f/before+crash.sav.7z\nThis was the log:\nCreated game with savegame version 122.\nWarning: Trying to remove nonexistant room build callback (function: 0x55d2e110e780) from humanoid (table: 0x55d2c4609100).\nWarning: Trying to remove nonexistant room remove callback (function: 0x55d2c5f126f0) from humanoid (table: 0x55d2c4609100).\nSavegame version is 122 (v0.61), originally it was 122 (v0.61)\nWarning: Trying to remove nonexistant room build callback (function: 0x5570abeafcb0) from humanoid (table: 0x5570505a61f0).\nWarning: Trying to remove nonexistant room remove callback (function: 0x5570abeb7d70) from humanoid (table: 0x5570505a61f0).\nWarning: Trying to remove nonexistant room build callback (function: 0x557068843e40) from humanoid (table: 0x5570510a6290).\nWarning: Trying to remove nonexistant room remove callback (function: 0x557068843e10) from humanoid (table: 0x5570510a6290).\nWarning: Trying to remove nonexistant room build callback (function: 0x55715ff9ee30) from humanoid (table: 0x55704ef0ed50).\nWarning: Trying to remove nonexistant room remove callback (function: 0x55704e6e32a0) from humanoid (table: 0x55704ef0ed50).\nWarning: Trying to remove nonexistant room build callback (function: 0x557160b85b30) from humanoid (table: 0x55704fa59d80).\nWarning: Trying to remove nonexistant room remove callback (function: 0x55705114c320) from humanoid (table: 0x55704fa59d80).\nWarning: Trying to remove nonexistant room build callback (function: 0x5570abece300) from humanoid (table: 0x55714d34f420).\nWarning: Trying to remove nonexistant room remove callback (function: 0x55704eb36b70) from humanoid (table: 0x55714d34f420).\nWarning: Trying to remove nonexistant room build callback (function: 0x55705031da70) from humanoid (table: 0x55704e97a540).\nWarning: Trying to remove nonexistant room remove callback (function: 0x557067068fe0) from humanoid (table: 0x55704e97a540).\nWarning: Trying to remove nonexistant room build callback (function: 0x55704f761440) from humanoid (table: 0x5570688a5450).\nWarning: Trying to remove nonexistant room remove callback (function: 0x5570af76bc50) from humanoid (table: 0x5570688a5450).\nWarning: Trying to remove nonexistant room build callback (function: 0x5571628a33a0) from humanoid (table: 0x5570688a5450).\nWarning: Trying to remove nonexistant room remove callback (function: 0x55704f64a650) from humanoid (table: 0x5570688a5450).\nSavegame version is 122 (v0.61), originally it was 122 (v0.61)\nWarning: Trying to remove nonexistant room build callback (function: 0x5625f606f960) from humanoid (table: 0x5625df748850).\nWarning: Trying to remove nonexistant room remove callback (function: 0x5625e11f06b0) from humanoid (table: 0x5625df748850).\nSavegame version is 122 (v0.61), originally it was 122 (v0.61)\nSavegame version is 122 (v0.61), originally it was 122 (v0.61)\nSavegame version is 122 (v0.61), originally it was 122 (v0.61)\nSavegame version is 122 (v0.61), originally it was 122 (v0.61)\nSavegame version is 122 (v0.61), originally it was 122 (v0.61)\nSavegame version is 122 (v0.61), originally it was 122 (v0.61)\nError in timer handler: \n./Lua/room.lua:316: Handyman arrived is on call but not arriving to the designated room\nstack traceback:\n    [C]: in function 'assert'\n    ./Lua/room.lua:316: in function 'onHumanoidEnter'\n    ./Lua/humanoid_actions/walk.lua:383: in function 'on_next_tile_set'\n    ./Lua/humanoid_actions/walk.lua:232: in function <./Lua/humanoid_actions/walk.lua:178>\n    (...tail calls...)\n    ./Lua/entity.lua:216: in function 'tick'\n    ./Lua/entities/staff.lua:149: in function 'tick'\n    ./Lua/world.lua:1051: in function 'onTick'\n    ./Lua/app.lua:1008: in function <./Lua/app.lua:1005>\n    (...tail calls...)\n    ./Lua/app.lua:909: in function <./Lua/app.lua:904>\nThank you very much for creating and maintaining CorsixTH. The crash case in that savegame seems to have a few things to it: If you pick the handyman who is going to crash, the next handyman (which claims to be heading for the slicer) will a few seconds later go for the same pharmacy plant and cause the same crash.\nEven more confusingly, if I reply and take both of those handymen out of the way, edit the pharmacy to remove the plant, a couple of minutes later another (or the same?) handyman will enter the room to water the now nonexistant plant, and cause the crash :).\nSeems that pharmacy is a magnet for confusing handymen.\nIt would seem that this crash would be related to the handyman trying to go to repair the slicer next door, but landing on the pharmacy instead. While the slicer is in good repair the problem disappears. But if the slicer needs a handyman (even 1 hour later in that same game run the handyman will go to the pharmacy and cause the same crash).. If in case (A) above, I send that patient to the reception desk (from the GP's office queue) he will go to the reception, then go to the hair restoration directly, and complete treatment without problems.\nNote: In this workaround you can see a small issue (maybe worth its own GH issue?). The patient is placed in the reception desk queue as soon as he is routed manually from the UI. This blocks the reception desk until that patient is handled.. In that same savegame you can observe an unrelated issue (should I create another GH issue for it?)\nIn the Operating Theater shown in the picture, there is a \"confused\" surgeon (circled in red), undressed and ready to get out, while at the same time waiting for the next patient (circled in blue). This patient cannot go in as the surgeon is not dressed. At the same time there is another surgeon (green) waiting to replace the 1st surgeon.\n\nThat 1st surgeon will not get out, the queue will just grow while the surgeon keeps tiring.\n[Be sure to dismiss the bold patient 1st to avoid its crash]\nNote that if you try to workaround this by removing the 1st surgeon by hand, the surgeon waiting out does not enter. Placing that waiting surgeon after inside, he gets dressed, but then the patient does not enter. After, reordering the queue of the OT does not seem to help getting anybody patient in.. @TheCycoONE : I just fetched master, compiled it and it runs without problems. (It is very nice when a project lists all its packages dependencies and build steps ready to copy paste). Here you can see, starting from the red line:\n\nA set of runs:\n1 leaked\n2 did not leak\n3-6 did leak\n7-9 no leak\n10 leak (which I stopped by pressing continue game after it reached about 2.5GB). @TheCycoONE : Can you reproduce it in your side?\n\nDo you know if this is a regression? \n\nI have just run about 20 times 0.61 tryign to reproduce it and although the memory usage in the menu can be quite different between runs (280MB - 1.4GB) I did not see it growing non stop.\nSomehow the fact that memory usage changes so wildly would seem an indication of some kind of problem(?).. ~Note also that in the year end window the \"Richest\" amounts are displayed with 1 decimal.~ Please ignore that. I thought normally it was not the case, but it seems to be.. > Custome level file that you had on 0.61 not installed with this build?\nIndeed that was the problem. I had assumed the level was kept in the savegame (like the map?), and did not bother moving it to the new build. Thanks :). ",
    "DuckyDM": "a new error box came up today\n\n. ",
    "eeerlend": "After reading the wiki, it seems like the patients should not be vaccinated when in que standing/walking. Tested again, and the nurses do vaccinate if the patient is sitting - so not sure if this really is a bug or not...\n. ",
    "ezeenova": "My (extremely particular) usecase is that I'm writing an install script for TH for Lutris, an open source gaming platform (think open source Steam, sorta). The install script would download the corsix-th binary for the user, ask them to point the installer at the TH data files, and then handle the rest of the installation automagically. We can build and host the binary ourselves, but using one provided by the project in question is preferable. Anyway, I'm looking into setting up a build environment for corsix-th right now, so if I'm able to build something portable enough for Lutris, maybe you'd be interested in adding it to your official downloads?\n. I added the binary to my fork: https://github.com/ezeenova/CorsixTH/raw/master/CorsixTH-0.40-GNU-Linux.tar.gz\nI'm not going to send a pull request since you don't keep the other binaries in the tree, it's just a convenient place to put it.\nIt's built with GCC 4.7 on Debian Wheezy, with statically linked FFmpeg, SDL, and SDL_mixer. FFmpeg is stripped down to only support the codecs CorsixTH needs (smacker and smackaud), and with lots of unnecessary components disabled, so both size and number of dependencies is kept to a minimum. It should run on any Linux Standard Base compliant distro with GCC >= 4.7. I've only compiled it for amd64 architecture, but if there is demand for a i386 version I can build that as well.\nI'll document the build process on the Wiki, if you do add it to your release downloads.\n. Caveat: If the user has Libav installed on their system (in /usr/lib/ and usr/include), and additionally downloads CorsixTH/deps and runs\ncmake -DCMAKE_PREFIX_PATH=pathtodeps -DWITH_LIBAV=ON\nCMake will use ffmpeg from deps instead of libav from /usr (except for libavrescale, obviously). Is that acceptable?\nAlso, the old pkg-config implementation set a FFMPEG/LIBAV_DEFINITIONS variable, which contained the package's cflags. We didn't use it, so this implementation doesn't set that variable.\n. ",
    "misslolab": "This is what the game log says: reated game with savegame version 91.\nSavegame version is 91 (0.40), originally it was 91 (0.40)\nWarning: Trying to remove nonexistant room build callback (function: 0x12165b80) from humanoid (table: 0x0b775908).\nWarning: Trying to remove nonexistant room remove callback (function: 0x1247e378) from humanoid (table: 0x0b775908).\nWarning: Trying to remove nonexistant room build callback (function: 0x0b71e0d8) from humanoid (table: 0x0ff6efc8).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0b71df30) from humanoid (table: 0x0ff6efc8).\nWarning: Trying to remove nonexistant room build callback (function: 0x12194f68) from humanoid (table: 0x120771a8).\nWarning: Trying to remove nonexistant room remove callback (function: 0x044f7098) from humanoid (table: 0x120771a8).\nWarning: Trying to remove nonexistant room build callback (function: 0x0c75fa48) from humanoid (table: 0x0b777690).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0c75fa08) from humanoid (table: 0x0b777690).\nWarning: Trying to remove nonexistant room build callback (function: 0x12212188) from humanoid (table: 0x12131a60).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0b6456f8) from humanoid (table: 0x12131a60).\nWarning: Trying to remove nonexistant room build callback (function: 0x12391e90) from humanoid (table: 0x12475e30).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0b6bfd48) from humanoid (table: 0x12475e30).\nWarning: Trying to remove nonexistant room build callback (function: 0x12283040) from humanoid (table: 0x045d5068).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0b9dd628) from humanoid (table: 0x045d5068).\nWarning: Trying to remove nonexistant room build callback (function: 0x122e7f48) from humanoid (table: 0x0ba49588).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0b982f00) from humanoid (table: 0x0ba49588).\nWarning: Trying to remove nonexistant room build callback (function: 0x0b9cc220) from humanoid (table: 0x1235beb0).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0b790d10) from humanoid (table: 0x1235beb0).\nWarning: Trying to remove nonexistant room build callback (function: 0x0fe6e080) from humanoid (table: 0x12152d60).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0b7fc078) from humanoid (table: 0x12152d60).\nWarning: Trying to remove nonexistant room build callback (function: 0x0c7383d8) from humanoid (table: 0x0b66f448).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0b98da98) from humanoid (table: 0x0b66f448).\nWarning: Trying to remove nonexistant room build callback (function: 0x0b9cc3d8) from humanoid (table: 0x045cfea8).\nWarning: Trying to remove nonexistant room remove callback (function: 0x06d4af20) from humanoid (table: 0x045cfea8).\nWarning: Trying to remove nonexistant room build callback (function: 0x0b9b28c0) from humanoid (table: 0x0ba43090).\nWarning: Trying to remove nonexistant room remove callback (function: 0x1224f608) from humanoid (table: 0x0ba43090).\nWarning: Trying to remove nonexistant room build callback (function: 0x0b78d3b8) from humanoid (table: 0x12484a28).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0b7bba00) from humanoid (table: 0x12484a28).\nWarning: Trying to remove nonexistant room build callback (function: 0x0b71ba90) from humanoid (table: 0x0c701a80).\nWarning: Trying to remove nonexistant room remove callback (function: 0x1203fa10) from humanoid (table: 0x0c701a80).\nWarning: Trying to remove nonexistant room build callback (function: 0x124ca4e0) from humanoid (table: 0x0c75f190).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0b85d778) from humanoid (table: 0x0c75f190).\nWarning: Trying to remove nonexistant room build callback (function: 0x0c753810) from humanoid (table: 0x121dd2b8).\nWarning: Trying to remove nonexistant room remove callback (function: 0x083f7ec8) from humanoid (table: 0x121dd2b8).\nSavegame version is 91 (0.40), originally it was 91 (0.40)\nWarning: Trying to remove nonexistant room build callback (function: 0x0ff74550) from humanoid (table: 0x12fc6980).\nWarning: Trying to remove nonexistant room remove callback (function: 0x13036540) from humanoid (table: 0x12fc6980).\nWarning: Trying to remove nonexistant room build callback (function: 0x0c2634c0) from humanoid (table: 0x0ffb3078).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0fc7cb20) from humanoid (table: 0x0ffb3078).\nWarning: Trying to remove nonexistant room build callback (function: 0x1304e0b8) from humanoid (table: 0x0d368f90).\nWarning: Trying to remove nonexistant room remove callback (function: 0x066d3cb8) from humanoid (table: 0x0d368f90).\nWarning: Trying to remove nonexistant room build callback (function: 0x0c552318) from humanoid (table: 0x0fcb2880).\nWarning: Trying to remove nonexistant room remove callback (function: 0x12feb170) from humanoid (table: 0x0fcb2880).\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:304: Humanoid (Stripped Female Patient) without door animations trying to walk through door (from cardiogram to corridor)\nstack traceback:\n    [C]: in function 'error'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:304: in function 'action_walk_raw'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:187: in function 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1103: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function \nRecovering from error in timer handler...\nWarning: Trying to remove nonexistant room build callback (function: 0x0f9da098) from humanoid (table: 0x0fc672e0).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0fab7df8) from humanoid (table: 0x0fc672e0).\nWarning: Trying to remove nonexistant room build callback (function: 0x03ad1918) from humanoid (table: 0x0fbb6b08).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0fbcb610) from humanoid (table: 0x0fbb6b08).\nWarning: Trying to remove nonexistant room build callback (function: 0x0cc05768) from humanoid (table: 0x0c571ff8).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0c419870) from humanoid (table: 0x0c571ff8).\nWarning: Trying to remove nonexistant room build callback (function: 0x0fd30c30) from humanoid (table: 0x0fe39ca0).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0facabe8) from humanoid (table: 0x0fe39ca0).\nWarning: Trying to remove nonexistant room build callback (function: 0x0fea0000) from humanoid (table: 0x0c094960).\nWarning: Trying to remove nonexistant room remove callback (function: 0x1306ff68) from humanoid (table: 0x0c094960).\nWarning: Trying to remove nonexistant room build callback (function: 0x0c500250) from humanoid (table: 0x0c4f4150).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0c070bc0) from humanoid (table: 0x0c4f4150).\nWarning: Trying to remove nonexistant room build callback (function: 0x0c25eba0) from humanoid (table: 0x0feb7cc8).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0c25eb60) from humanoid (table: 0x0feb7cc8).\nWarning: Trying to remove nonexistant room build callback (function: 0x0ff3a200) from humanoid (table: 0x0fc4e448).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0fdf6378) from humanoid (table: 0x0fc4e448).\nWarning: Trying to remove nonexistant room build callback (function: 0x0fba5d68) from humanoid (table: 0x0d37eb00).\nWarning: Trying to remove nonexistant room remove callback (function: 0x13013558) from humanoid (table: 0x0d37eb00).\nWarning: Trying to remove nonexistant room build callback (function: 0x0fa042d8) from humanoid (table: 0x0fbde480).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0fa028c8) from humanoid (table: 0x0fbde480).\nWarning: Trying to remove nonexistant room build callback (function: 0x0fedab90) from humanoid (table: 0x0d348780).\nWarning: Trying to remove nonexistant room remove callback (function: 0x0fedab50) from humanoid (table: 0x0d348780).\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:659: Can only finish current action\nstack traceback:\n    [C]: in function 'assert'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:659: in function 'finishAction'\n    C:\\Program Files\\CorsixTH\\Lua\\rooms\\cardiogram.lua:94: in function 'after_use'\n    ...Files\\CorsixTH\\Lua\\humanoid_actions\\multi_use_object.lua:264: in function 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:215: in function 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1103: in function 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:852: in function 'dispatch'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:753: in function \nHowever I don't know if it records it. \nhere is a save file: https://www.dropbox.com/s/cneb41935udbdqe/2.sav?dl=0\n. Any ideas? It happens on future levels as well.\n. ",
    "awong728": "I have a similar bug. When it is supposed to show the end of year awards, somehow I fail and the game plays the failed movie, but results in a black screen and it crashes.\nGamelog: https://www.dropbox.com/s/ofs11204xb66r3f/gamelog.txt?dl=0\nAutosave: https://www.dropbox.com/s/co74fqmev5ud32u/Autosave12.sav?dl=0\n. ",
    "castarco": "I'm @8mikelx8 's brother. I can confirm the game was running the Spanish language . I've tried to execute CorsixTH from the command line and logging its console output using tee, but I've obtained an empty log file.\nI don't know if there are more log files generated automatically by CorsixTH in some place.\nI don't think it's important, but we're using the original Theme Hospital assets, obtained from the \"free\" Origin's distribution.\n. ",
    "Waxime64": "https://mega.co.nz/#!jNdh2aSB!4m7PaAWwAYHDKZwh2qsLva09x775mAU_cmdqH5-pWf0\n. ",
    "obama": "\nwhile i was building the room the janitor crashed.\nhe stood next to a door, so it might be the door issue, or the room cleaned up the pukes while he was sweeping it?. i was just building in pause mode (i paused by hand with P) and when i moved a plant near a bench it crashed!. where is that file? also when i tried again the \"same thing\" i did before, it didnt crash again :/. it does only contain the trace to some other bug i encountered. that one is not contained (windows asked if i want to debug or close the app). a bench was in the way. ",
    "wiolen": "G:\\Program Files (x86)\\Origin Games\\Theme Hospital\\data\\Game\\DOSBox\\LAUNCHER.exe\nNo, origin is installed. Normal game (themeHospital) working with no issues.\n. Where I can find this ?\n. -- preferred.\ntheme_hospital_install = [[G:\\Program Files (x86)\\Origin Games\\Theme Hospital]]\n. Yes, now its working !\nThaks man.\nUnfortunetly saves from \"non mod\" game are not working, even if i place save files in save directory (...)\\AppData\\Roaming\\CorsixTH\\Saves.\nMaybe there is a solution ?\n. Ok, thanks a lot !\nClose.\n. ",
    "Oleander29": "Well, I will very happily make a realistic disease pack once I figure out exactly how. The big negative is the clinics - I can't very well use, for example, the inflator room to simulate cardiac catheterization, now can I? :P But it's an awesome start, thank you!!\n. ",
    "Necrobare": "Hi !\nForget about the first thing. I read the link you shared and it appears I\nwas not aware of this new way of working for contagious disease (compared\nto what I knew of original TH).\nI'm glad you managed to fix the bug for undressed patient. Thanks for your\nhard work !\nNecrobare\n2015-02-07 16:39 GMT+01:00 William Gatens notifications@github.com:\n\nThe patient trying to evacuate whilst not dressed is definitely a bug\nafter some testing. This would go for any diagnostic step that needs the\npatient to undress.\nhttp://i.imgur.com/pJVgh2t.png\nError in timer handler:\n./CorsixTH/Lua/humanoid_actions/walk.lua:304: Humanoid (Stripped Male Patient 3) without door animations trying to walk through door (from scanner to corridor)\nstack traceback:\nI'll try and fix it!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/674#issuecomment-73369070.\n. In fact, in original version of TH, I never noticed that once the patient is marked it requires a nurse to perform the vaccination. I thought that when you mark the patient, some times later the vaccination is automatically performed.\n\nHowever, it can be because I did not noticed it before so I always thought it was this way. \n. I managed to get a save at the last step of room construction:\nhttp://www.filedropper.com/test_25\n. ",
    "RichUK5": "The game just froze, no error messages i'm afraid.\n. ",
    "mortengormmadsen": "The game does not crash, hence no log.\nThe problem occurs because of lost dialog focus. Savegame attached for convenience.\nReproduction of the problem\nResolution higher than standard game such the yearly report doesnt cover 100% of the window.\nFast forward to december 30'ish.\nEdit an existing room.\nClear interior to place doors/windows.\nWait for the yearly report.\nThe yearly report comes up.\nClicking buttons/trophies works.\nClicking outside the report (not in the Edit room dialog) causes no problems\nClick the Edit room dialog causes a problem\nProblem\nClicking buttons/trophies doesnt work - the yearly report no longer has focus and cant get it back before the edit dialog has been closed.\nRelated\nThe Hire employee dialog can also take focus while the yearly dialog is open. Focus is not kept though.\nSuggestion\nYearly report should be modal (heavy/blocking/keeping focus)\nSavegame at dec 30\nhttp://bit.ly/1D48mHl\n. @SimplyRyan @MarkL1961 is right - it's not a crash, hence no console output. Can I enable more logging somehow?\nThe problem can be fixed by making the yearly report modal.\n. Hitting ESC closes all popups and deletes the room. It's a workarround but not any better than manually clicking the X of Edit room.\n(Updated  Reproduction of the problem - popups in general takes focus although only the Edit dialog does not allow the yearly report to get it back. Added my suggestion).\n. In my case I edited a room near the edge of the screen which caused the Edit room dialog to appear also near the edge of the screen. The problem occured because I clicked the edit room dialog something like \u00bds after the yearly report appeared, leaving me in the unwanted situation.\n. http://bit.ly/18nQuQ4\nMade a video.\nSDL. v0.4\n. That is still a workarround. Yearly report should be a modal dialog in my oppinion. For the reference, the game is paused while the yearly is up (as it used to be in the original game).\nAlso you shouldn't be able to alter rooms while the game is paused but that is another discussion.\n. Exactly =)\n. ",
    "ggppjj": "Trunk version compilation (all flags default) notes:\nNote: SDL audio is enabled (default)\nNote: FFMPEG video is enabled (default)\nNote: FreeType2 is enabled (default)\n-- Looking for include file stdint.h\n-- Looking for include file stdint.h - found\n-- Looking for include file malloc.h\n-- Looking for include file malloc.h - found\n-- Looking for include file alloca.h\n-- Looking for include file alloca.h - found\n-- Looking for include file inttypes.h\n-- Looking for include file inttypes.h - found\nBuilding CorsixTH\n-- Looking for include file pthread.h\n-- Looking for include file pthread.h - found\n-- Looking for pthread_create\n-- Looking for pthread_create - not found\n-- Looking for pthread_create in pthreads\n-- Looking for pthread_create in pthreads - not found\n-- Looking for pthread_create in pthread\n-- Looking for pthread_create in pthread - found\n-- Found Threads: TRUE\n-- Found SDL: /usr/lib/x86_64-linux-gnu/libSDL2main.a;/usr/lib/x86_64-linux-gnu/libSDL2.so;-lpthread (found version \"2.0.2\") \n  SDL found\n-- Found LuaJIT library: /usr/lib/x86_64-linux-gnu/libluajit-5.1.so\n-- Found Lua: /usr/lib/x86_64-linux-gnu/libluajit-5.1.so\n  LuaJIT found\n-- Found SDL_mixer: /usr/lib/x86_64-linux-gnu/libSDL2_mixer.so (found version \"2.0.0\") \n  SDL_mixer found\n-- CMAKE_MODULE_PATH=/home/gabriel/.corsixth/CorsixTH/CMake\n-- Found PkgConfig: /usr/bin/pkg-config (found version \"0.26\") \n-- checking for module 'libavcodec'\n--   found libavcodec, version 54.92.100\n-- checking for module 'libavformat'\n--   found libavformat, version 54.63.104\n-- checking for module 'libavdevice'\n--   found libavdevice, version 53.5.103\n-- checking for module 'libavutil'\n--   found libavutil, version 52.18.100\n-- checking for module 'libswscale'\n--   found libswscale, version 2.2.100\n-- checking for module 'libpostproc'\n--   found libpostproc, version 52.2.100\n-- checking for module 'libswresample'\n--   found libswresample, version 0.17.102\n-- Found FFmpeg: /usr/lib/x86_64-linux-gnu/libavformat.so;/usr/lib/x86_64-linux-gnu/libavcodec.so;/usr/lib/x86_64-linux-gnu/libavutil.so;/usr/lib/x86_64-linux-gnu/libswscale.so;/usr/lib/x86_64-linux-gnu/libswresample.so\n  FFmpeg found\n-- checking for module 'freetype2'\n--   found freetype2, version 17.1.11\n-- Found Freetype: /usr/lib/x86_64-linux-gnu/libfreetype.so (found version \"17.1.11\") \n  FreeType2 found\n-- Configuring done\n-- Generating done\n-- Build files have been written to: /home/gabriel/.corsixth/CorsixTH\n. Is there a build flag to change SDL Mixer to the old version so I can test for you?\n. After downloading and compiling version b28b41b93ba7 of SDL2, then running make install on it, then clearing CorsixTH's CMakeCache, and remaking it, the problem persists.\n. (Also, I'm having difficulty finding a bug tracker for SDL_mixer.)\n. Doesn't seem to relate to that bug, although I could be completely wrong. I was able to play both of the attached midi files with no errors that would break timidity. Again, could be wrong. I know just enough to compile things, and not much more.\n. It does, although with a fair amount of crackling.\n. I have no idea what was happening, but I decided to move to a soundfont that supposedly is more FM sounding, as I liked the sound of the music through Adlib emulation that the GOG version run through Playonlinux supported better. I tried this soundfont, which had to be converted with this program, and it works now. Seems to be either a problem with the specific soundfont or my ineptitude. I'll close the issue, and you can reopen if you end up testing and don't come to the same conclusion. \n. OK. So I was wrong. I had accidentally not told Timidity to load any of the soundfonts I was trying to run. Seems as though the ONLY soundfont CorsixTH supports is freepats. Hum.\n. Using the DOS program XMI2MID, I was able to convert and play CANDY.XMI, and it works. Maybe a problem with the XMI conversion? \n. OK. Two of my soundfonts were corrupt, but there's one that should definitely work that isn't. I can provide it to you if it helps.\n. ",
    "trumpetporvida": "I can confirm. Have the same issue on my nexus 9. Game crashes to home screen with no error message.\n. ",
    "mshine": "@alanwoolley  Silly question... whats the beta channel?\n. ",
    "vince0018": "Thanks for the replies.\nI've tried both Windowed and Fullscreen, both with the same issue.\nI've tried lowering the resolution as well.\nI tried shift+arrow as well as changing the scroll speed higher and lower but it's still stuttery.\nI tried disabling the camera smoothing too, to no avail.\nAlso tried enabling/disabling Vsync.\nAnd again, the game isn't laggy at all, except when scrolling with the arrows.\nHolding the mouse wheel it's very smooth.\nAny further help would be much appreciated.\n. I am definitely willing to try the latest master build.\nHowever call me an idiot but i followed the link and have no idea where to go from there.\nThere's a page full of further links, and I don't know which one to click :P\nI see they're dated so do I use the one near the bottom\nCTH-20150301-master-ded32b7469.zip ?\n. Hmm.. really hate to say it but it doesn't seem to fix it :/\nI downloaded that Master that I listed above, extracted it, then ran the CorsixTH .exe.\nI loaded my save and scrolling is still jerky (and middle mouse smooth) :(\nIt's probably expected since it's a 'trunk' build but there were also a lot of graphics artifacts.\nOne good thing though lol, is that during the intro cutscene there's no longer a glitchy 'clicking' noise in the background, which was prevalent in previous versions.\nReally don't know what's causing this, sometimes weird things just happen.\nI had a relatively similar issue on Rollercoaster Tycoon 3 where the arrow key scrolling was very\njerky and laggy but the game ran smooth.. turns out I just had to unplug my 360 Controller.\nBut in this case I don't have one plugged in.\n. ",
    "leaveboss": "Got this. Is there a way to accelerate the scroll speed by mouse?\n. ",
    "elfring": "Thanks for your small source code improvement.\n. ",
    "driverpt": "Well yeah, sorry for that :-(, forgot to explain what moonscript was.\nWell, I did some code snippets with moonscript and Lua, and trust me. The\ncode becomes much cleaner.\nMoonscript is like Coffeescript (compiles to javascript).\n. Hello Alberth,\nThank you for explaining in detail how CorsixTH works.\nThe point of this issue, was more like a suggestion. I don't want to ruin\nanyone's work. All i want is to have a Theme Hospital Remake, since it's a\ngame i liked a lot and contributed to it (See Grim Reaper feature).\nYou don't need to go aggressive on me, as i won't be feeding a flame war\nwith anybody.\nI hope you understand that this was a mere suggestion to try to enchance\nthe product. i'm sorry if i ofended you in anyway, as it was not my\nintention.\n. Hello Alberth,\nI'm not saying do it quickly. I'm just suggesting because it will make it\nfaster for the developers to \"catch the train\".\nI'll analyze the code and try to extract a block diagram on draw.io\nOn Jul 4, 2015 05:57, \"Alberth289346\" notifications@github.com wrote:\n\nThere is no diagram, and I wouldn't be able to make one quickly either.\nC++ side of things is in CorsixTH/Src. Lua interface is in _lua_cpp\nfiles, with gfx, anims, and sdl being obvious candidates. Lua instantiates\nthe class, and manages its lifetime.\nAt the CorsixTH/Lua side, everything is an animation, app or world.lua\ninstantiates the class, and manages (I don't know how exactly) the running\nanimations.\nFor further detail questions, I'd suggest you use the google forum or\nperhaps IRC, as that is a better place to discuss such topics.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/782#issuecomment-118461944.\n. \n",
    "SteveVaneeckhout": "It's not because he refutes your point with a good explanation that he's suddenly agressive.\nSee also: Things You Should Never Do\n. ",
    "p-bo": "In game (language list pull up menu): English, Castellano, Dansk, Deutsch, English, Francais, Italiano, Nederlands, Norsk, Portugues, Portugues do Brasil, Suomi, Svenska\nAnd regarding possible packaging deficiency (good point indeed) - tried\nhttps://github.com/CorsixTH/CorsixTH/releases/download/v0.40/CorsixTH-0.40-GNU-Linux_amd64.tar.gz\n...and language is missing in menu there too. So it is reproducible error directly in official release.\nMaybe there are two problems - one missing entry in menu, the other with fonts. Sorry for mixing it in one report. So maybe just now lets concentrate on missing entry, then on font problem?\n. Thanks for hint, but still no luck :(\nInstalled package fonts-arphic-uming, which resulted in file /usr/share/fonts/truetype/arphic/uming.ttc\n(libfreetype package installed already)\nThen in game settings menu, folders, font pointed on that .ttc file.\n(resulted in unicode_font = [[usr/share/fonts/truetype/arphic/uming.ttc]] in config.txt)\nQuieted from game and reruned - in language settings still no entry for Czech language.\nManually edited config.txt file according #383 (language = [[\u010ce\u0161tina]]). Started game - still complaining about font (why???) and defaulting to English.\nThe same behaviour is with getdeb.net package and binary release from there (github).\nAny ideas?\n. You are right - now language menu is complete and switching to additional languages works! Thanks :)\nBut reason, why this omitted \"/\" before \"usr\" was overlooked is, that it was generated by game itself (so supposed to be correct)!\nIn another words, there still is a bug: when one selects patch to .ttc file from game settings interface, it is written to config.txt incorrectly!\n. Great!\nAnd may I share some thoughts about user experience there\n(As a feedback, by no means instructing you what to do - it would be inappropriate.)?\nIn case when yes:\nIn case of game data, it is solved very well. Want to play? Point where game data are (In basic game description there is clearly stated, that you need it, so you know, what to do). Done - playing. Perfectly handled, no confusion there.\nBut what about language select?\nUser even isn't informed, that translation for his/her language exists - it isn't in menu. Result is, that majority of users conclude, that translation simply doesn't exists and will not solving any more about it.\nSo idea - what about display in menu always all languages and in case of attempt selecting one, requiring additional font, react analogically as with game data: Want this language? Point where necessary font is! And for better understanding sake, in this message there would be link https://github.com/CorsixTH/CorsixTH/wiki/Fonts mentioned, so all is clear (or at least more clear).\nAnd maybe what about overall out-of-box experience? It would be possible to ask packagers (I volunteer for asking getdeb.net packagers) for adding dependency on package fonts-arphic-uming and add into game code built-in check, which will check presence of /usr/share/fonts/truetype/arphic/uming.ttc and places it into config.txt, wouldn't it? It would made possible to autoconfigure language according user environment variables (LANG)!\nIn another worlds, to have there sane defaults and don't let all translators hard work to be unrevealed ;-)\n(disclaimer: I'm not involved in any translation in this project, but as I do in many others, I know, how frustrating it is to have obstacles there, which are preventing your work to be actually useful for users).\nThanks for reading this :)\n. ",
    "a-detiste": "yup :smile: \n. It's in Debian since yesterday.\nIt also turns out quite a lot of people was using this upstream-provided package;\nbut changed their mind when it became outdated.\n(the ones with corsix-th but without platform-indepedant corsix-th-data)\nhttps://qa.debian.org/popcon.php?package=corsix-th\n. P.S.: that makes sense, the LICENSE.TXT is dated 2014; so years after inclusion of this code into Corsix-TH.\n. It has been fixed in Doxygen on 2014/1/12\nhttps://github.com/doxygen/doxygen/blob/master/src/config.xml#L3021\nhttps://github.com/doxygen/doxygen/commit/4b51e6113f1e9e20a5700840d83f1c3928d84825\n. > but it built fine with ffmpeg 3.0 for me\nThanks for testing.\nWell, build deamon did failed to rebuild 0.50, not the current git master; but all the deprecated \"av_free_packet()\" are still there. \nSome other deprecated API have already been updated in the 0.50 -> 0.60 timeframe:\nhttps://github.com/CorsixTH/CorsixTH/commit/5710f1c38467e6c0664fc62220ee390ed37bdebc\nSo there are two issues there:\n- replace the deprecated API before 0.60 release to silence all these warnings\n- have something that can build with FFmpeg 3.0 for Debian:\n  - we could just wait on 0.60 release\n  - or upload a build with videos temporary disabled if there's a hurry\n  - or even write a verry short-lived patch, but that would be a waste of time.\n@emorrp1 \n. I confused the depreciation warnings with actual errors. I need more sleep :sweat: :smile: \n. > Indeed, we already had installed this one in the initial release\nI found this one in Arch Linux packaging.\n. there's now 0.50-2 in Debian; 0.50-1 got accepted after the Ubuntu import freeze and thus hasn't been imported yet, so there's nothing to fix there\n. ",
    "QTurtle": "I am using top of tree DirectX build. litter_countdown is already 0 but self.world.map.th:getCellFlags(x, y).buildable is always false. Also, even if the function is actually triggerd no litter was actually drawn on the screen.\n. ",
    "GregPK": "@TheCycoONE Yup - that was the problem. I have not yet needed midi on this machine. Still is seems strange that there are no errors during startup.\nFor the record for Ubuntu/Mint users: if you want MIDI working on your system run\napt-get install timidity freepats\nIf you're still having problems download a sample MIDI and run timidity sample.midi\n. ",
    "ajdlinux": "I'm having the same issue - first saw it today as I was playing the Greenpool level, nothing in particular which seems to trigger it. Not sure if it occurs on other levels. Running Debian unstable, my dpkg logs don't seem to indicate any changes to relevant libraries in the past couple of days. Will play again under gdb to get a backtrace for you.\n. Unfortunately couldn't reproduce the crash under gdb :(\n. ",
    "triceo": "How could a research in \"Specialization\" be carried out, when all drugs have already been researched? What further research is there to be done?\n. ",
    "ihithim": "Hiya, sorry: it is indeed 0.50 beta 1. \nFor reference, I am on a unusual resolution of 3440x1440 (one of those superwide screens)\n. ",
    "TheMatia": "Ok thanks. I deleted it and started again. It does this every time I try to use the 1366x768 resolution, but I've tried the next one down (1280x720) and that works fine. Don't know if my computer's just messing up or there's something I'm not seeing.\n. Update: The frozen smoke does go away the next time a handyman repairs the machine.\n. ",
    "adam900710": "I set the font path to wqy-microhei.ttc, which is my daily use font.\nBut still not work.\nOS is linux, distribution is Archlinux.\nThanks\nStephen E. Baker wrote on 2015/07/05 15:46 -0700:\n\nHave you set the font in the config file to one that supports Chinese.\nAlso what OS is this?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/785#issuecomment-118673069.\n. Thanks Stephan, but that's what I did first, and then I still can't \nselect Chinese.\n\nAnd if I choose Chinese through config by force, it just tells me that \nit can't load the font.\nAnyway, I'll try it again later.\nThanks\nStephen E. Baker wrote on 2015/07/08 18:58 -0700:\n\n@adam900710 https://github.com/adam900710 To address your concern,\nonce pr #787 https://github.com/CorsixTH/CorsixTH/pull/787 is in place\nyou should be able to set |unicode_font =\n[[/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc]]| and see\nthe Chinese language options. Tested in Arch Linux x86_64.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/785#issuecomment-119781795.\n. Thanks for the hint from Alberth.\nI thought I found the problem.\n\nIf I edit the config file and set the font option to absolute path of the font, it works without problem.\nThe real cause is, if you goes in-game font file selector , which I did at first, then font path in\nconfig file will lose the leading '/', causing CorsixTH consider it as a relative path, and fail to load the font.\n. ",
    "IlDucci": "Yes, sorry, I was testing the Windows client and I messed up quite a bit. There was a double revert.\n. That's likely. I'm still trying to get used to Github for Windows. If the new strings are synched with the English ones, this can be closed.\n. OK; strange that those were gone, my copy had them. Anyways, I've updated the Spanish file with a lot of changes and fixes to the original translation. I've also made the Options strings smaller so they could fit into their boxes.\n. Please help me out with this one. Haven't touched Github in months and I did a few messups on my way back.\n. It is ready.. ",
    "Krutonium": "0.50 b2, And if I manually specify the folder in the config it works fine, but I can't navigate to it via the UI.\n. ",
    "caoli5288": "\nDid you specify a font file with unicode support for Chinese characters in the settings-folders game menu or the config.txt-file?\n\nYes, I specify adobe-source-font in settings, but there is no chinese lang to select.\n. I see this is a origin bug, I select font file what path is [[/usr/share/fonts/...]] but what store in config.txt is [[usr/share/fonts/...]].\nAfter change it everything works.\n. A in-game message is needed, or select system default font automatic.\n. Fedora's repos not contains this package.\n. > yum install timidity-freepats\n\ndoes not work?\n\nYes, this package not exists in Fedora.\n. Also not exists. Fedora 22.\n. Oh my god this is a 120MB+ package!\n. Why not pack a simple program that can handle MIDI?\n. So how to resolve this problem? The fluid-soundfont package is too big(120MB) I do not want to try it. If install this package is a solution then it's also a stupid solution.\n. I see the in game message mp3 BGM dont support x64 platform yet? I get some error output like\nError in async music load callback: ./Lua/audio.lua:594: Could not load music file '/home/yiwan/Sounds/M01.mp3' (Unrecognized music format)\nI see it load audio by SDL directly. \n\nSDL.audio.loadMusicAsync(data, function(music, e)....\n\nSo why not handle it by ffmpeg or other generic function?\n. :-)Sorry for my rude words.\n. Hey dear developers I found some interesting things.\nDo you know OpenTTD? Yes this game play MIDI music also and when I try to install it by yum install openttd it depend the package fluid-soundfont(120MB).\nBut if I get the bin file from its website(about 11MB tarball file) It can play MIDI music directly! Not need install other package anymore.\n\n\n\nEdit\nSo I think a build-in MIDI handler is possible, right?\n. > The only reason your 11MB file works is because you already installed soundfonts previously, eg with your 'yum' command to install the openttd version from the distribution.\n\n\n\nIt's a great pleasure to talk to you. I like the game OpenTTD very much. But I'm sure I haven't done it. I can not install a more than 100M dependent library for a less than 15M game.\n. I found the newest version is 0.4.7 :-) I'll try ogg format.\n. I found http://wiki.libsdl.org/FAQDevelopment?highlight=%28mp3%29\nand http://www.icculus.org/SDL_sound/\nThe SDL_sound can handle MP3 audio file through libmpg123(a 200k lib).\nCan you support this lib?(Sorry I can't found a pre-packaged smpeg 2.0.0 and does not want to convert my MP3 music to OGG to lose quality).\n. > I think your path of least resistence if you don't want to compile packages yourself is going to be getting timidity-patch-freepats from another rpm distro\nI still not want a 33MB lib.\n\nI believe it would also be trivial to support other formats supported by SDL_Mixer2 such as ogg vorbis which could play in fedora without third party repo libs (possibly as simple as changing this one line\n\nI replace all \"MP3\" with \"OGG\" and put some ogg file on folder (convert by ffmpeg), get such error out put \nAn error has occured!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The callback handler.\nA stack trace is included below, and the handler has been disconnected.\nError in async music load callback: ./Lua/audio.lua:594: Could not load music file '/home/yiwan/Softwares/CorsixTH/HOSP/MUSIC/Theme Hospital - Steady (ZR Remix).ogg' (Unrecognized music format)\nstack traceback:\n    [C]: in function 'yield'\n    ./Lua/app.lua:753: in function <./Lua/app.lua:748>\n. > I said that it would require a change in CorsixTH and pointed out the line (#818 (comment))\nI done it.\n. I sure libvorbis installed and it not be supported. Maybe you can test and add support to some free audio format.\n. \n. Pre-build package have no libvorbis support? \n. ",
    "juef17": "Of course, sorry I didn't do this initially. In this example, I don't think the last two paragraphs should be separate.\n\n. Of course! It appears the same is true for the bank balance, also.\n\n\n. ",
    "l29ah": "On Tue, Apr 04, 2017 at 05:11:10AM -0700, Stephen E. Baker wrote:\n\n1201 has the same stack trace and also involves the cast remover. I'm not sure if a hell death was involved. @l29ah can you clarify?\n\nI'm not sure, i don't have an earlier save and don't pay attention to such things.\n-- \n()  ascii ribbon campaign - against html mail\n/\\  http://arc.pasp.de/   - against proprietary attachments\n. The bug have just occurred to me at ea0e6df.. https://dump.bitcheese.net/files/pyrizyk/f8.sav. The soda machine is next to them but it turns visible only when someone uses it.. On Fri, Apr 07, 2017 at 06:20:40AM -0700, Stephen E. Baker wrote:\n\nWhich SDL version?\n\nlibsdl2-2.0.5\n-- \n()  ascii ribbon campaign - against html mail\n/\\  http://arc.pasp.de/   - against proprietary attachments\n. ",
    "malkavi": "Ok. I have installed luafilesystem + lpeg from OpenSuse repo but they aren't working. Using luarocks CorsixTH starts, but I don't know why, luarocks compiles libraries to lib instead of lib64 (I have copied manually).\nNow I can see the splash screen but after that CorsixTH exit without any error.\nI have tried removing the config folder and selecting the ThemeHospital folder again, with the same result.\n. Sorry, now there is all the info:\nFull build log:\nhttps://build.opensuse.org/build/home:malkavi/openSUSE_13.2/x86_64/CorsixTH-beta/_log\ncmake . -DCMAKE_INSTALL_PREFIX=/usr/lib64\n[   58s] -- The C compiler identification is GNU 4.8.3\n[   58s] -- The CXX compiler identification is GNU 4.8.3\n[   58s] -- Check for working C compiler: /usr/bin/cc\n[   58s] -- Check for working C compiler: /usr/bin/cc -- works\n[   58s] -- Detecting C compiler ABI info\n[   58s] -- Detecting C compiler ABI info - done\n[   58s] -- Check for working CXX compiler: /usr/bin/c++\n[   58s] -- Check for working CXX compiler: /usr/bin/c++ -- works\n[   58s] -- Detecting CXX compiler ABI info\n[   58s] -- Detecting CXX compiler ABI info - done\n[   58s] -- Performing Test COMPILER_SUPPORTS_CXX11\n[   58s] -- Performing Test COMPILER_SUPPORTS_CXX11 - Success\n[   58s] -- Performing Test COMPILER_SUPPORTS_CXX0X\n[   59s] -- Performing Test COMPILER_SUPPORTS_CXX0X - Success\n[   59s] Note: SDL audio is enabled (default)\n[   59s] Note: FFMPEG video is enabled (default)\n[   59s] Note: FreeType2 is enabled (default)\n[   59s] -- Looking for include file malloc.h\n[   59s] -- Looking for include file malloc.h - found\n[   59s] -- Looking for include file alloca.h\n[   59s] -- Looking for include file alloca.h - found\n[   59s] -- Looking for include file inttypes.h\n[   59s] -- Looking for include file inttypes.h - found\n[   59s] \n[   59s] Building CorsixTH\n[   59s] -- Looking for include file pthread.h\n[   59s] -- Looking for include file pthread.h - found\n[   59s] -- Looking for pthread_create\n[   59s] -- Looking for pthread_create - not found\n[   59s] -- Looking for pthread_create in pthreads\n[   59s] -- Looking for pthread_create in pthreads - not found\n[   59s] -- Looking for pthread_create in pthread\n[   59s] -- Looking for pthread_create in pthread - found\n[   59s] -- Found Threads: TRUE  \n[   59s] -- Found SDL: /usr/lib64/libSDL2main.a;/usr/lib64/libSDL2.so;-lpthread (found version \"2.0.3\") \n[   59s]   SDL found\n[   59s] -- Found Lua library: /usr/lib64/liblua.so\n[   59s] -- Found Lua: /usr/lib64/liblua.so  \n[   59s]   Lua found\n[   59s] -- Found SDL_mixer: /usr/lib64/libSDL2_mixer.so (found version \"2.0.0\") \n[   59s]   SDL_mixer found\n[   59s] -- CMAKE_MODULE_PATH=/home/abuild/rpmbuild/BUILD/CorsixTH-0.50-rc1/CMake\n[   59s] -- Found AVCODEC: /usr/lib64/libavcodec.so (found version \"55.39.101\") \n[   59s] -- Found AVFORMAT: /usr/lib64/libavformat.so (found version \"55.19.104\") \n[   59s] -- Found AVDEVICE: /usr/lib64/libavdevice.so (found version \"55.5.100\") \n[   59s] -- Found AVUTIL: /usr/lib64/libavutil.so (found version \"52.48.101\") \n[   59s] -- Found SWSCALE: /usr/lib64/libswscale.so (found version \"2.5.101\") \n[   59s] -- Found POSTPROC: /usr/lib64/libpostproc.so (found version \"52.3.100\") \n[   59s] -- Found SWRESAMPLE: /usr/lib64/libswresample.so (found version \"0.17.104\") \n[   59s] -- Found FFmpeg: /usr/lib64/libavformat.so;/usr/lib64/libavcodec.so;/usr/lib64/libavutil.so;/usr/lib64/libswscale.so;/usr/lib64/libswresample.so  \n[   59s]   FFmpeg found\n[   59s] -- Found Freetype: /usr/lib64/libfreetype.so (found version \"2.5.3\") \n[   59s]   FreeType2 found\n[   59s] -- Could NOT find Doxygen (missing:  DOXYGEN_EXECUTABLE) \n[   59s] -- Configuring done\n[   59s] -- Generating done\n[   59s] -- Build files have been written to: /home/abuild/rpmbuild/BUILD/CorsixTH-0.50-rc1\n```\n\nldd CorsixTH | grep lua\n        liblua.so.5.2 => /usr/lib64/liblua.so.5.2 (0x00007f603211b000)\n```\n\n```\n\nCorsixTH \n\n\nWelcome to CorsixTH 0.50 rc1!\n\nThis window will display useful information if an error occurs.\n\n/usr/lib64/CorsixTH\n```\nExit from CorsixTH after that.\n```\nCONFIGURATION\n        Lua version: 5.2\n        Configuration files:\n                System: /etc/luarocks/config-5.2.lua (ok)\n                User  : /home/malkavi/.luarocks/config-5.2.lua (failed)\n    Rocks trees in use: \n            /home/malkavi/.luarocks (\"user\")\n            /usr (\"system\")\n\n```\n. There is no output for \"lua -e 'require(\"lfs\")'\"\n```\n\nlua -e 'require(\"lfs\")'\n```\n\n[  165s] + cat CMakeCache.txt\n[  165s] # This is the CMakeCache file.\n[  165s] # For build in directory: /home/abuild/rpmbuild/BUILD/CorsixTH-0.50-rc1\n[  165s] # It was generated by CMake: /usr/bin/cmake\n[  165s] # You can edit this file to change values found and used by cmake.\n[  165s] # If you do not want to change any of the values, simply exit the editor.\n[  165s] # If you do want to change a value, simply edit, save, and exit the editor.\n[  165s] # The syntax for the file is as follows:\n[  165s] # KEY:TYPE=VALUE\n[  165s] # KEY is the name of a variable in the cache.\n[  165s] # TYPE is a hint to GUIs for the type of VALUE, DO NOT EDIT TYPE!.\n[  165s] # VALUE is the current value for the KEY.\n[  165s] \n[  165s] ########################\n[  165s] # EXTERNAL cache entries\n[  165s] ########################\n[  165s] \n[  165s] //Path to a file.\n[  165s] AVCODEC_INCLUDE_DIRS:PATH=/usr/include\n[  165s] \n[  165s] //Path to a library.\n[  165s] AVCODEC_LIBRARIES:FILEPATH=/usr/lib64/libavcodec.so\n[  165s] \n[  165s] //Path to a file.\n[  165s] AVDEVICE_INCLUDE_DIRS:PATH=/usr/include\n[  165s] \n[  165s] //Path to a library.\n[  165s] AVDEVICE_LIBRARIES:FILEPATH=/usr/lib64/libavdevice.so\n[  165s] \n[  165s] //Path to a file.\n[  165s] AVFORMAT_INCLUDE_DIRS:PATH=/usr/include\n[  165s] \n[  165s] //Path to a library.\n[  165s] AVFORMAT_LIBRARIES:FILEPATH=/usr/lib64/libavformat.so\n[  165s] \n[  165s] //Path to a file.\n[  165s] AVUTIL_INCLUDE_DIRS:PATH=/usr/include\n[  165s] \n[  165s] //Path to a library.\n[  165s] AVUTIL_LIBRARIES:FILEPATH=/usr/lib64/libavutil.so\n[  165s] \n[  165s] //Build the animation viewer as part of the build process\n[  165s] BUILD_ANIMVIEWER:BOOL=OFF\n[  165s] \n[  165s] //Build the map editor as part of the build process\n[  165s] BUILD_MAPEDITOR:BOOL=OFF\n[  165s] \n[  165s] //Path to a program.\n[  165s] CMAKE_AR:FILEPATH=/usr/bin/ar\n[  165s] \n[  165s] //Choose the type of build, options are: None(CMAKE_CXX_FLAGS or\n[  165s] // CMAKE_C_FLAGS used) Debug Release RelWithDebInfo MinSizeRel.\n[  165s] CMAKE_BUILD_TYPE:STRING=\n[  165s] \n[  165s] //Enable/Disable color output during build.\n[  165s] CMAKE_COLOR_MAKEFILE:BOOL=ON\n[  165s] \n[  165s] //CXX compiler.\n[  165s] CMAKE_CXX_COMPILER:FILEPATH=/usr/bin/c++\n[  165s] \n[  165s] //Flags used by the compiler during all build types.\n[  165s] CMAKE_CXX_FLAGS:STRING='-fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables '\n[  165s] \n[  165s] //Flags used by the compiler during debug builds.\n[  165s] CMAKE_CXX_FLAGS_DEBUG:STRING=-g\n[  165s] \n[  165s] //Flags used by the compiler during release builds for minimum\n[  165s] // size.\n[  165s] CMAKE_CXX_FLAGS_MINSIZEREL:STRING=-Os -DNDEBUG\n[  165s] \n[  165s] //Flags used by the compiler during release builds.\n[  165s] CMAKE_CXX_FLAGS_RELEASE:STRING=-O3 -DNDEBUG\n[  165s] \n[  165s] //Flags used by the compiler during release builds with debug info.\n[  165s] CMAKE_CXX_FLAGS_RELWITHDEBINFO:STRING=-O2 -g -DNDEBUG\n[  165s] \n[  165s] //C compiler.\n[  165s] CMAKE_C_COMPILER:FILEPATH=/usr/bin/cc\n[  165s] \n[  165s] //Flags used by the compiler during all build types.\n[  165s] CMAKE_C_FLAGS:STRING='-fmessage-length=0 -grecord-gcc-switches -O2 -Wall -D_FORTIFY_SOURCE=2 -fstack-protector -funwind-tables -fasynchronous-unwind-tables '\n[  165s] \n[  165s] //Flags used by the compiler during debug builds.\n[  165s] CMAKE_C_FLAGS_DEBUG:STRING=-g\n[  165s] \n[  165s] //Flags used by the compiler during release builds for minimum\n[  165s] // size.\n[  165s] CMAKE_C_FLAGS_MINSIZEREL:STRING=-Os -DNDEBUG\n[  165s] \n[  165s] //Flags used by the compiler during release builds.\n[  165s] CMAKE_C_FLAGS_RELEASE:STRING=-O3 -DNDEBUG\n[  165s] \n[  165s] //Flags used by the compiler during release builds with debug info.\n[  165s] CMAKE_C_FLAGS_RELWITHDEBINFO:STRING=-O2 -g -DNDEBUG\n[  165s] \n[  165s] //Flags used by the linker.\n[  165s] CMAKE_EXE_LINKER_FLAGS:STRING=' '\n[  165s] \n[  165s] //Flags used by the linker during debug builds.\n[  165s] CMAKE_EXE_LINKER_FLAGS_DEBUG:STRING=\n[  165s] \n[  165s] //Flags used by the linker during release minsize builds.\n[  165s] CMAKE_EXE_LINKER_FLAGS_MINSIZEREL:STRING=\n[  165s] \n[  165s] //Flags used by the linker during release builds.\n[  165s] CMAKE_EXE_LINKER_FLAGS_RELEASE:STRING=\n[  165s] \n[  165s] //Flags used by the linker during Release with Debug Info builds.\n[  165s] CMAKE_EXE_LINKER_FLAGS_RELWITHDEBINFO:STRING=\n[  165s] \n[  165s] //Enable/Disable output of compile commands during generation.\n[  165s] CMAKE_EXPORT_COMPILE_COMMANDS:BOOL=OFF\n[  165s] \n[  165s] //Install path prefix, prepended onto install directories.\n[  165s] CMAKE_INSTALL_PREFIX:PATH=/usr/lib64\n[  165s] \n[  165s] //Path to a program.\n[  165s] CMAKE_LINKER:FILEPATH=/usr/bin/ld\n[  165s] \n[  165s] //Path to a program.\n[  165s] CMAKE_MAKE_PROGRAM:FILEPATH=/usr/bin/gmake\n[  165s] \n[  165s] //Flags used by the linker during the creation of modules.\n[  165s] CMAKE_MODULE_LINKER_FLAGS:STRING=' '\n[  165s] \n[  165s] //Flags used by the linker during debug builds.\n[  165s] CMAKE_MODULE_LINKER_FLAGS_DEBUG:STRING=\n[  165s] \n[  165s] //Flags used by the linker during release minsize builds.\n[  165s] CMAKE_MODULE_LINKER_FLAGS_MINSIZEREL:STRING=\n[  165s] \n[  165s] //Flags used by the linker during release builds.\n[  165s] CMAKE_MODULE_LINKER_FLAGS_RELEASE:STRING=\n[  165s] \n[  165s] //Flags used by the linker during Release with Debug Info builds.\n[  165s] CMAKE_MODULE_LINKER_FLAGS_RELWITHDEBINFO:STRING=\n[  165s] \n[  165s] //Path to a program.\n[  165s] CMAKE_NM:FILEPATH=/usr/bin/nm\n[  165s] \n[  165s] //Path to a program.\n[  165s] CMAKE_OBJCOPY:FILEPATH=/usr/bin/objcopy\n[  165s] \n[  165s] //Path to a program.\n[  165s] CMAKE_OBJDUMP:FILEPATH=/usr/bin/objdump\n[  165s] \n[  165s] //Value Computed by CMake\n[  165s] CMAKE_PROJECT_NAME:STATIC=CorsixTH_Top_Level\n[  165s] \n[  165s] //Path to a program.\n[  165s] CMAKE_RANLIB:FILEPATH=/usr/bin/ranlib\n[  165s] \n[  165s] //Flags used by the linker during the creation of dll's.\n[  165s] CMAKE_SHARED_LINKER_FLAGS:STRING=' '\n[  165s] \n[  165s] //Flags used by the linker during debug builds.\n[  165s] CMAKE_SHARED_LINKER_FLAGS_DEBUG:STRING=\n[  165s] \n[  165s] //Flags used by the linker during release minsize builds.\n[  165s] CMAKE_SHARED_LINKER_FLAGS_MINSIZEREL:STRING=\n[  165s] \n[  165s] //Flags used by the linker during release builds.\n[  165s] CMAKE_SHARED_LINKER_FLAGS_RELEASE:STRING=\n[  165s] \n[  165s] //Flags used by the linker during Release with Debug Info builds.\n[  165s] CMAKE_SHARED_LINKER_FLAGS_RELWITHDEBINFO:STRING=\n[  165s] \n[  165s] //If set, runtime paths are not added when installing shared libraries,\n[  165s] // but are added when building.\n[  165s] CMAKE_SKIP_INSTALL_RPATH:BOOL=NO\n[  165s] \n[  165s] //If set, runtime paths are not added when using shared libraries.\n[  165s] CMAKE_SKIP_RPATH:BOOL=NO\n[  165s] \n[  165s] //Flags used by the linker during the creation of static libraries.\n[  165s] CMAKE_STATIC_LINKER_FLAGS:STRING=\n[  165s] \n[  165s] //Flags used by the linker during debug builds.\n[  165s] CMAKE_STATIC_LINKER_FLAGS_DEBUG:STRING=\n[  165s] \n[  165s] //Flags used by the linker during release minsize builds.\n[  165s] CMAKE_STATIC_LINKER_FLAGS_MINSIZEREL:STRING=\n[  165s] \n[  165s] //Flags used by the linker during release builds.\n[  165s] CMAKE_STATIC_LINKER_FLAGS_RELEASE:STRING=\n[  165s] \n[  165s] //Flags used by the linker during Release with Debug Info builds.\n[  165s] CMAKE_STATIC_LINKER_FLAGS_RELWITHDEBINFO:STRING=\n[  165s] \n[  165s] //Path to a program.\n[  165s] CMAKE_STRIP:FILEPATH=/usr/bin/strip\n[  165s] \n[  165s] //If true, cmake will use relative paths in makefiles and projects.\n[  165s] CMAKE_USE_RELATIVE_PATHS:BOOL=OFF\n[  165s] \n[  165s] //If this value is on, makefiles will be generated without the\n[  165s] // .SILENT directive, and all commands will be echoed to the console\n[  165s] // during the make.  This is useful for debugging only. With Visual\n[  165s] // Studio IDE projects all commands are done without /nologo.\n[  165s] CMAKE_VERBOSE_MAKEFILE:BOOL=FALSE\n[  165s] \n[  165s] //Value Computed by CMake\n[  165s] CorsixTH_BINARY_DIR:STATIC=/home/abuild/rpmbuild/BUILD/CorsixTH-0.50-rc1/CorsixTH\n[  165s] \n[  165s] //Value Computed by CMake\n[  165s] CorsixTH_SOURCE_DIR:STATIC=/home/abuild/rpmbuild/BUILD/CorsixTH-0.50-rc1/CorsixTH\n[  165s] \n[  165s] //Value Computed by CMake\n[  165s] CorsixTH_Top_Level_BINARY_DIR:STATIC=/home/abuild/rpmbuild/BUILD/CorsixTH-0.50-rc1\n[  165s] \n[  165s] //Value Computed by CMake\n[  165s] CorsixTH_Top_Level_SOURCE_DIR:STATIC=/home/abuild/rpmbuild/BUILD/CorsixTH-0.50-rc1\n[  165s] \n[  165s] //Graphviz Dot tool for using Doxygen\n[  165s] DOXYGEN_DOT_EXECUTABLE:FILEPATH=DOXYGEN_DOT_EXECUTABLE-NOTFOUND\n[  165s] \n[  165s] //Doxygen documentation generation tool (http://www.doxygen.org)\n[  165s] DOXYGEN_EXECUTABLE:FILEPATH=DOXYGEN_EXECUTABLE-NOTFOUND\n[  165s] \n[  165s] //The FFmpeg include directories.\n[  165s] FFMPEG_INCLUDE_DIRS:STRING=/usr/include\n[  165s] \n[  165s] //The FFmpeg libraries.\n[  165s] FFMPEG_LIBRARIES:STRING=/usr/lib64/libavformat.so;/usr/lib64/libavcodec.so;/usr/lib64/libavutil.so;/usr/lib64/libswscale.so;/usr/lib64/libswresample.so\n[  165s] \n[  165s] //Path to a file.\n[  165s] FREETYPE_INCLUDE_DIR_freetype2:PATH=/usr/include/freetype2\n[  165s] \n[  165s] //Path to a file.\n[  165s] FREETYPE_INCLUDE_DIR_ft2build:PATH=/usr/include/freetype2\n[  165s] \n[  165s] //Path to a library.\n[  165s] FREETYPE_LIBRARY:FILEPATH=/usr/lib64/libfreetype.so\n[  165s] \n[  165s] //Path to a file.\n[  165s] LUA_INCLUDE_DIR:PATH=/usr/include\n[  165s] \n[  165s] //Path to a library.\n[  165s] LUA_LIBRARY:FILEPATH=/usr/lib64/liblua.so\n[  165s] \n[  165s] //Path to a program.\n[  165s] LUA_PROGRAM_PATH:FILEPATH=/usr/bin/lua5.2\n[  165s] \n[  165s] //Path to a file.\n[  165s] POSTPROC_INCLUDE_DIRS:PATH=/usr/include\n[  165s] \n[  165s] //Path to a library.\n[  165s] POSTPROC_LIBRARIES:FILEPATH=/usr/lib64/libpostproc.so\n[  165s] \n[  165s] //Path to a library.\n[  165s] SDLMAIN_LIBRARY:FILEPATH=/usr/lib64/libSDL2main.a\n[  165s] \n[  165s] //Path to a file.\n[  165s] SDL_INCLUDE_DIR:PATH=/usr/include/SDL2\n[  165s] \n[  165s] //Where the SDL Library can be found\n[  165s] SDL_LIBRARY:STRING=/usr/lib64/libSDL2main.a;/usr/lib64/libSDL2.so;[  127.885444] serial8250: too much work for irq4\n[  165s] -lpthread\n[  165s] \n[  165s] //Path to a file.\n[  165s] SDL_MIXER_INCLUDE_DIR:PATH=/usr/include/SDL2\n[  165s] \n[  165s] //Path to a library.\n[  165s] SDL_MIXER_LIBRARY:FILEPATH=/usr/lib64/libSDL2_mixer.so\n[  165s] \n[  165s] //Path to a file.\n[  165s] SWRESAMPLE_INCLUDE_DIRS:PATH=/usr/include\n[  165s] \n[  165s] //Path to a library.\n[  165s] SWRESAMPLE_LIBRARIES:FILEPATH=/usr/lib64/libswresample.so\n[  165s] \n[  165s] //Path to a file.\n[  165s] SWSCALE_INCLUDE_DIRS:PATH=/usr/include\n[  165s] \n[  165s] //Path to a library.\n[  165s] SWSCALE_LIBRARIES:FILEPATH=/usr/lib64/libswscale.so\n[  165s] \n[  165s] //Activate Sound\n[  165s] WITH_AUDIO:BOOL=ON\n[  165s] \n[  165s] //Enhanced Font Support\n[  165s] WITH_FREETYPE2:BOOL=ON\n[  165s] \n[  165s] //Use LibAV instead of FFmpeg\n[  165s] WITH_LIBAV:BOOL=OFF\n[  165s] \n[  165s] //Use LuaJIT instead of Lua\n[  165s] WITH_LUAJIT:BOOL=OFF\n[  165s] \n[  165s] //Activate in game movies\n[  165s] WITH_MOVIES:BOOL=ON\n[  165s] \n[  165s] //Activate SDL Renderer\n[  165s] WITH_SDL:BOOL=ON\n[  165s] \n[  165s] \n[  165s] ########################\n[  165s] # INTERNAL cache entries\n[  165s] ########################\n[  165s] \n[  165s] //ADVANCED property for variable: CMAKE_AR\n[  165s] CMAKE_AR-ADVANCED:INTERNAL=1\n[  165s] //This is the directory where this CMakeCache.txt was created\n[  165s] CMAKE_CACHEFILE_DIR:INTERNAL=/home/abuild/rpmbuild/BUILD/CorsixTH-0.50-rc1\n[  165s] //Major version of cmake used to create the current loaded cache\n[  165s] CMAKE_CACHE_MAJOR_VERSION:INTERNAL=3\n[  165s] //Minor version of cmake used to create the current loaded cache\n[  165s] CMAKE_CACHE_MINOR_VERSION:INTERNAL=0\n[  165s] //Patch version of cmake used to create the current loaded cache\n[  165s] CMAKE_CACHE_PATCH_VERSION:INTERNAL=2\n[  165s] //ADVANCED property for variable: CMAKE_COLOR_MAKEFILE\n[  165s] CMAKE_COLOR_MAKEFILE-ADVANCED:INTERNAL=1\n[  165s] //Path to CMake executable.\n[  165s] CMAKE_COMMAND:INTERNAL=/usr/bin/cmake\n[  165s] //Path to cpack program executable.\n[  165s] CMAKE_CPACK_COMMAND:INTERNAL=/usr/bin/cpack\n[  165s] //Path to ctest program executable.\n[  165s] CMAKE_CTEST_COMMAND:INTERNAL=/usr/bin/ctest\n[  165s] //ADVANCED property for variable: CMAKE_CXX_COMPILER\n[  165s] CMAKE_CXX_COMPILER-ADVANCED:INTERNAL=1\n[  165s] //ADVANCED property for variable: CMAKE_CXX_FLAGS\n[  165s] CMAKE_CXX_FLAGS-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_CXX_FLAGS_DEBUG\n[  166s] CMAKE_CXX_FLAGS_DEBUG-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_CXX_FLAGS_MINSIZEREL\n[  166s] CMAKE_CXX_FLAGS_MINSIZEREL-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_CXX_FLAGS_RELEASE\n[  166s] CMAKE_CXX_FLAGS_RELEASE-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_CXX_FLAGS_RELWITHDEBINFO\n[  166s] CMAKE_CXX_FLAGS_RELWITHDEBINFO-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_C_COMPILER\n[  166s] CMAKE_C_COMPILER-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_C_FLAGS\n[  166s] CMAKE_C_FLAGS-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_C_FLAGS_DEBUG\n[  166s] CMAKE_C_FLAGS_DEBUG-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_C_FLAGS_MINSIZEREL\n[  166s] CMAKE_C_FLAGS_MINSIZEREL-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_C_FLAGS_RELEASE\n[  166s] CMAKE_C_FLAGS_RELEASE-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_C_FLAGS_RELWITHDEBINFO\n[  166s] CMAKE_C_FLAGS_RELWITHDEBINFO-ADVANCED:INTERNAL=1\n[  166s] //Path to cache edit program executable.\n[  166s] CMAKE_EDIT_COMMAND:INTERNAL=/usr/bin/ccmake\n[  166s] //Executable file format\n[  166s] CMAKE_EXECUTABLE_FORMAT:INTERNAL=ELF\n[  166s] //ADVANCED property for variable: CMAKE_EXE_LINKER_FLAGS\n[  166s] CMAKE_EXE_LINKER_FLAGS-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_EXE_LINKER_FLAGS_DEBUG\n[  166s] CMAKE_EXE_LINKER_FLAGS_DEBUG-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_EXE_LINKER_FLAGS_MINSIZEREL\n[  166s] CMAKE_EXE_LINKER_FLAGS_MINSIZEREL-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_EXE_LINKER_FLAGS_RELEASE\n[  166s] CMAKE_EXE_LINKER_FLAGS_RELEASE-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_EXE_LINKER_FLAGS_RELWITHDEBINFO\n[  166s] CMAKE_EXE_LINKER_FLAGS_RELWITHDEBINFO-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_EXPORT_COMPILE_COMMANDS\n[  166s] CMAKE_EXPORT_COMPILE_COMMANDS-ADVANCED:INTERNAL=1\n[  166s] //Name of generator.\n[  166s] CMAKE_GENERATOR:INTERNAL=Unix Makefiles\n[  166s] //Name of generator toolset.\n[  166s] CMAKE_GENERATOR_TOOLSET:INTERNAL=\n[  166s] //Have symbol pthread_create\n[  166s] CMAKE_HAVE_LIBC_CREATE:INTERNAL=\n[  166s] //Have library pthreads\n[  166s] CMAKE_HAVE_PTHREADS_CREATE:INTERNAL=\n[  166s] //Have library pthread\n[  166s] CMAKE_HAVE_PTHREAD_CREATE:INTERNAL=1\n[  166s] //Have include pthread.h\n[  166s] CMAKE_HAVE_PTHREAD_H:INTERNAL=1\n[  166s] //Start directory with the top level CMakeLists.txt file for this\n[  166s] // project\n[  166s] CMAKE_HOME_DIRECTORY:INTERNAL=/home/abuild/rpmbuild/BUILD/CorsixTH-0.50-rc1\n[  166s] //Install .so files without execute permission.\n[  166s] CMAKE_INSTALL_SO_NO_EXE:INTERNAL=0\n[  166s] //ADVANCED property for variable: CMAKE_LINKER\n[  166s] CMAKE_LINKER-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_MAKE_PROGRAM\n[  166s] CMAKE_MAKE_PROGRAM-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_MODULE_LINKER_FLAGS\n[  166s] CMAKE_MODULE_LINKER_FLAGS-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_MODULE_LINKER_FLAGS_DEBUG\n[  166s] CMAKE_MODULE_LINKER_FLAGS_DEBUG-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_MODULE_LINKER_FLAGS_MINSIZEREL\n[  166s] CMAKE_MODULE_LINKER_FLAGS_MINSIZEREL-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_MODULE_LINKER_FLAGS_RELEASE\n[  166s] CMAKE_MODULE_LINKER_FLAGS_RELEASE-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_MODULE_LINKER_FLAGS_RELWITHDEBINFO\n[  166s] CMAKE_MODULE_LINKER_FLAGS_RELWITHDEBINFO-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_NM\n[  166s] CMAKE_NM-ADVANCED:INTERNAL=1\n[  166s] //number of local generators\n[  166s] CMAKE_NUMBER_OF_LOCAL_GENERATORS:INTERNAL=2\n[  166s] //ADVANCED property for variable: CMAKE_OBJCOPY\n[  166s] CMAKE_OBJCOPY-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_OBJDUMP\n[  166s] CMAKE_OBJDUMP-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_RANLIB\n[  166s] CMAKE_RANLIB-ADVANCED:INTERNAL=1\n[  166s] //Path to CMake installation.\n[  166s] CMAKE_ROOT:INTERNAL=/usr/share/cmake\n[  166s] //ADVANCED property for variable: CMAKE_SHARED_LINKER_FLAGS\n[  166s] CMAKE_SHARED_LINKER_FLAGS-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_SHARED_LINKER_FLAGS_DEBUG\n[  166s] CMAKE_SHARED_LINKER_FLAGS_DEBUG-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_SHARED_LINKER_FLAGS_MINSIZEREL\n[  166s] CMAKE_SHARED_LINKER_FLAGS_MINSIZEREL-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_SHARED_LINKER_FLAGS_RELEASE\n[  166s] CMAKE_SHARED_LINKER_FLAGS_RELEASE-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_SHARED_LINKER_FLAGS_RELWITHDEBINFO\n[  166s] CMAKE_SHARED_LINKER_FLAGS_RELWITHDEBINFO-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_SKIP_INSTALL_RPATH\n[  166s] CMAKE_SKIP_INSTALL_RPATH-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_SKIP_RPATH\n[  166s] CMAKE_SKIP_RPATH-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_STATIC_LINKER_FLAGS\n[  166s] CMAKE_STATIC_LINKER_FLAGS-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_STATIC_LINKER_FLAGS_DEBUG\n[  166s] CMAKE_STATIC_LINKER_FLAGS_DEBUG-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_STATIC_LINKER_FLAGS_MINSIZEREL\n[  166s] CMAKE_STATIC_LINKER_FLAGS_MINSIZEREL-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_STATIC_LINKER_FLAGS_RELEASE\n[  166s] CMAKE_STATIC_LINKER_FLAGS_RELEASE-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_STATIC_LINKER_FLAGS_RELWITHDEBINFO\n[  166s] CMAKE_STATIC_LINKER_FLAGS_RELWITHDEBINFO-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_STRIP\n[  166s] CMAKE_STRIP-ADVANCED:INTERNAL=1\n[  166s] //uname command\n[  166s] CMAKE_UNAME:INTERNAL=/usr/bin/uname\n[  166s] //ADVANCED property for variable: CMAKE_USE_RELATIVE_PATHS\n[  166s] CMAKE_USE_RELATIVE_PATHS-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: CMAKE_VERBOSE_MAKEFILE\n[  166s] CMAKE_VERBOSE_MAKEFILE-ADVANCED:INTERNAL=1\n[  166s] //Test COMPILER_SUPPORTS_CXX0X\n[  166s] COMPILER_SUPPORTS_CXX0X:INTERNAL=1\n[  166s] //Test COMPILER_SUPPORTS_CXX11\n[  166s] COMPILER_SUPPORTS_CXX11:INTERNAL=1\n[  166s] //Have include alloca.h\n[  166s] CORSIX_TH_HAS_ALLOCA_H:INTERNAL=1\n[  166s] //Have include inttypes.h\n[  166s] CORSIX_TH_HAS_INTTYPES_H:INTERNAL=1\n[  166s] //Have include malloc.h\n[  166s] CORSIX_TH_HAS_MALLOC_H:INTERNAL=1\n[  166s] //ADVANCED property for variable: DOXYGEN_DOT_EXECUTABLE\n[  166s] DOXYGEN_DOT_EXECUTABLE-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: DOXYGEN_EXECUTABLE\n[  166s] DOXYGEN_EXECUTABLE-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: FFMPEG_INCLUDE_DIRS\n[  166s] FFMPEG_INCLUDE_DIRS-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: FFMPEG_LIBRARIES\n[  166s] FFMPEG_LIBRARIES-ADVANCED:INTERNAL=1\n[  166s] //Details about finding AVCODEC\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_AVCODEC:INTERNAL=[/usr/lib64/libavcodec.so][/usr/include][v55.39.101()]\n[  166s] //Details about finding AVDEVICE\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_AVDEVICE:INTERNAL=[/usr/lib64/libavdevice.so][/usr/include][v55.5.100()]\n[  166s] //Details about finding AVFORMAT\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_AVFORMAT:INTERNAL=[/usr/lib64/libavformat.so][/usr/include][v55.19.104()]\n[  166s] //Details about finding AVUTIL\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_AVUTIL:INTERNAL=[/usr/lib64/libavutil.so][/usr/include][v52.48.101()]\n[  166s] //Details about finding FFmpeg\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_FFmpeg:INTERNAL=[/usr/lib64/libavformat.so;/usr/lib64/libavcodec.so;/usr/lib64/libavutil.so;/usr/lib64/libswscale.so;/usr/lib64/libswresample.so][/usr/include][/usr/lib64/libavformat.so][/usr/include][/usr/lib64/libavcodec.so][/usr/include][/usr/lib64/libavutil.so][/usr/include][/usr/lib64/libswscale.so][/usr/include][/usr/lib64/libswresample.so][/usr/include][v()]\n[  166s] //Details about finding Freetype\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_Freetype:INTERNAL=[/usr/lib64/libfreetype.so][/usr/include/freetype2][v2.5.3()]\n[  166s] //Details about finding Lua\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_Lua:INTERNAL=[/usr/lib64/liblua.so][/usr/include][v()]\n[  166s] //Details about finding POSTPROC\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_POSTPROC:INTERNAL=[/usr/lib64/libpostproc.so][/usr/include][v52.3.100()]\n[  166s] //Details about finding SDL\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_SDL:INTERNAL=[/usr/lib64/libSDL2main.a;/usr/lib64/libSDL2.so;-lpthread][/usr/include/SDL2][v2.0.3()]\n[  166s] //Details about finding SDL_mixer\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_SDL_mixer:INTERNAL=[/usr/lib64/libSDL2_mixer.so][/usr/include/SDL2][v2.0.0()]\n[  166s] //Details about finding SWRESAMPLE\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_SWRESAMPLE:INTERNAL=[/usr/lib64/libswresample.so][/usr/include][v0.17.104()]\n[  166s] //Details about finding SWSCALE\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_SWSCALE:INTERNAL=[/usr/lib64/libswscale.so][/usr/include][v2.5.101()]\n[  166s] //Details about finding Threads\n[  166s] FIND_PACKAGE_MESSAGE_DETAILS_Threads:INTERNAL=[TRUE][v()]\n[  166s] //ADVANCED property for variable: FREETYPE_INCLUDE_DIR_freetype2\n[  166s] FREETYPE_INCLUDE_DIR_freetype2-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: FREETYPE_INCLUDE_DIR_ft2build\n[  166s] FREETYPE_INCLUDE_DIR_ft2build-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: FREETYPE_LIBRARY\n[  166s] FREETYPE_LIBRARY-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: LUA_INCLUDE_DIR\n[  166s] LUA_INCLUDE_DIR-ADVANCED:INTERNAL=1\n[  166s] //ADVANCED property for variable: LUA_LIBRARY\n[  166s] LUA_LIBRARY-ADVANCED:INTERNAL=1\n[  166s] SDL_LIBRARY_TEMP:INTERNAL=/usr/lib64/libSDL2main.a;/usr/lib64/libSDL2.so;-lpthread\n. The packages are:\nlua-5.2.3-2.2.1\nlua-devel-5.2.3-2.2.1\nI have tried removing config folder and that way I can see the screen for select the TH folder, but after selecting the folder I'm again in the same situation.\nEdit: I have tried in a VM with Opensuse 13.1 32bit and It works. I will try to reextract the TH files again in my system.\n. At last I have fixed the compilation... I have changed to libAV. Thanks for all!\n. ",
    "spanjard": "I agree, on both changes maybe weergeven should be 'weergave'\n. I think it's okay, thnx Bob\n. ",
    "User5981": "@bobcanthelpyou I will try to (I'm new to Github).\n. Done!\n. Yes, Regis, That's My Final Answer. (tested in game : perfect)\n. ",
    "corsix": "I actually care a lot about grammar and about the correct capitalisation of Lua, so :+1: from me, merging. (Who knew I had merging rights on GitHub?)\n. Nice sleuthing, and nice to see licensing/copyright status resolved. Merging.\n. Although it seems that past-me considered this in 2009 (see https://github.com/CorsixTH/CorsixTH/commit/7af98d5e1df814d3cafa276ff55ecd1e12ab6c01). Good past-me. It would also seem that past-me duplicated the RNC code to two places, and only updated the licensing notes in one of those places. Bad past-me.\n. No.. ",
    "hulagutten2": "@TheCycoONE Yes, it seems to be a duplicate. Please close this issue if it is best, but it contains an additional save game.\n. ",
    "Huppi": "Game Speed is set on 5\nIn Pause the screen would be in a different color\n. \nI've set the language back to English to made another Screenshot with the Game-Speed menu. You can also see that all are in the same position as above...\n. Where can I put the savegame? I'm using 5.0 RC3 with Windows 10.\ngamelog.txt Output:\nCreated game with savegame version 105.\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\dialogs\\bottom_panel.lua:486: bad argument #1 to 'format' (number has no integer representation)\nstack traceback:\n    [C]: in function 'string.format'\n    C:\\Program Files\\CorsixTH\\Lua\\dialogs\\bottom_panel.lua:486: in method 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\window.lua:1634: in field 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\ui.lua:708: in field 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\game_ui.lua:592: in method 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:880: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:779: in function \n. Savegame: https://dl.dropboxusercontent.com/u/7209172/Huppi-1.sav\nI can only find the \"track_fps\" Option in the config.txt which is already set to \"false\":\n-- If set to true, the FPS, Lua memory usage, and entity count will be shown\n-- in the dynamic information bar. Note that setting this to true also turns\n-- off the FPS limiter, causing much higher CPU utilisation, but resulting in\n-- more useful FPS values, as they are not artificially capped.\ntrack_fps = false\n. Ok, don't know what it was, but it's working now confused ... ok, thanks for all, but I there is no more issue ;)\n. ",
    "halapli": "0.50-rc3\n.  ATI Radeon HD 2600 XT. Yes it's 64bit. \n\n. Videos work in 0.40. Happens in windowed mode too but it kinda works with OpenGL. The videos play but they are choppy.\n. Yes and the music finishes then its quiet.\n. Totally forgot about this sorry. I'm using a different pc now so it's not an issue for me anymore.\n. I'm not using that PC anymore so I can't, sorry.\n. ",
    "janejohn": "Same probleme here. After starting the game (version 0.50)  the intro freezes but the sound continues. \nCard ist ATI Mobility Radeon HD 5470, Windows 7, 64 bit.\nIs there any solution so far?\nEdit: Version 0.40 works correctly \n. thanks for the quick answer :)\n. ",
    "Oberalp": "Hi there,\nI have exactly the same problem with an ATI FirePro M7820, running Windows 7 64bits. But for me it doesn't crash every time!\nIt seems it is less likely to crash with the resolutions 800x600, 1366x768, 1920x1080 and 1920x1200 (crashed sometimes though). The other resolutions usually crash. Seems to be the same on both windowed and full screen mode...\nWhen I change the resolution, the console displays 4 times the line\n\"Problem creating overlay: Texture dimensions can't be 0\"\nSometimes when it crashes, the console also displays the warning\n\"*Warning: data is not aligned! This can lead to a speedloss\"\nI don't know if it is actually related.\nHope this info can help...\n. I'm already using Release 0.50 (Aug. 30th) that I downloaded on Oct. 3rd.\n. ",
    "suipaste": "I'm getting some very similar problems occurring. I seem to get the issue in all video sections like the opening video and the level progression video. I'm running Windows 7 64 bit with a ATI Radeon 5700 series GFX card.\nThe crashes don't happen 100% of the time but don't seem that hard to recreate. I'm a Java programmer by trade but I'd be interested in helping. I don't have eclipse for C++ set up but if you could give me some advise of what I'd be looking to do once I'm set up I'd be happy to give it a shot.\n. Yeah it's v0.50 I saw your message yesterday but wasn't home until now to have a look at the installer to double checker the version number.\n. ",
    "emorrp1": "Came here to report a (related) issue in 0.50 on Debian having rendering issues for the videos (stuttering, initial blockiness) on Radeon HD 7560D. Rebuilt with the latest master (g7d886f3) and can confirm the videos play smoothly.\n. Hi @Makitk, corsix-th 0.60 is now in stretch (I will try to be quicker with future releases). I normally install it on Jessie by enabling backports and following the steps in SimpleBackportCreation. Unfortunately official backports need a \"notable userbase\", which seems unlikely, so you'll need to re-follow these steps on each new release.\nThere's also a nice easy way to create a .deb for the Game Data files (e.g. from GOG): game-data-packager theme-hospital setup_theme_hospital_*.exe.\n. Hi @Makitk, the only dependency not in Jessie is FFmpeg rather than libav, but it is in jessie-backports. You are right that the \"simple\" backporting steps I linked to was probably a bad suggestion, here's a much simpler method I've just tested on a fresh jessie install:\nsudo apt edit-sources to ensure it contains at least these three lines (note the -src that will prevent actually installing anything from unstable):\ndeb http://ftp.uk.debian.org/debian jessie main\ndeb http://ftp.uk.debian.org/debian jessie-backports main\ndeb-src http://ftp.uk.debian.org/debian unstable contrib\nsudo apt update\nsudo apt install devscripts\nsudo apt install -t jessie-backports libavdevice-dev # only ffmpeg needed from backports\nsudo apt-get build-dep corsix-th # all other libraries exist in jessie\napt-get source --compile corsix-th\nsudo gdebi corsix-th-data_0.60-1_all.deb\nsudo gdebi corsix-th_0.60-1_amd64.deb\nYou'll note it builds cleanly in Jessie, but unfortunately as I mentioned, corsix-th itself will unlikely be in the official backports unless there's more demand.\n. @TheCycoONE I assume so, I simply haven't tested it as Debian has switched back to ffmpeg for the next release, so the build file (and dependencies) would need to be edited to configure WITH_LIBAV=true, making the install steps marginally more complicated.\n. I've looked into the build log (search \"Building CXX object\") and while there are deprecation warnings (see below), that's not the actual build error.\n\nCorsixTH/Src/th_movie.h:69:5: error: 'PixelFormat' does not name a type\n\nWhich looks like it was fixed cleanly in v0.60-beta1 (9260930bd1e4721736859bee9c86aa70ecd3ddba) so apologies for bothering you and we should just be able to cherry-pick the patch for compatibility (or wait for the v0.60 release). I think this issue can be closed.\n\nUse AVPixelFormat and related\nNon AV prefixed PixelFormat and PIX_FMT_* enums have been deprecated for years.\nThey have been removed in git for both libav and ffmpeg. This patch uses the newer replacements while retaining compatibility for old ffmpeg and libav versions.\n\nFull list of deprecations from build log (which would be nice to fix anyway):\n- avpicture_get_size\n- avpicture_fill\n- av_dup_packet\n- av_free_packet\n@a-detiste FYI, I've begun preliminary changes for v0.60 in the \"debian/experimental\" git branch\n. I see our messages got crossed, thank you for looking into it and for your dedication to quality.\n\n9260930 is probably the one you needed\n\nThanks, I've backported this commit to v0.50 which will hopefully be uploaded at some point\n\n4ae56e1 is also a required patch (or else movies will segfault on newer ffmpeg)\n\nIndeed, we already had installed this one in the initial release\n\n5e1ea3a is required for AMD users.\n\nYes, I was affected by this, but I've not backported it as the change is non-trivial (to me), the game otherwise runs fine and v0.60 will be out soon enough.\nFor the record, this was also reported as Debian bug #821415\n. Thanks, I wasn't sure if the reverse ordering between the two lines was significant. I've rebased on latest master.\nI looked into the alternative FindLua you linked and it does look more thorough. It's also provided in the CMake main Modules directory (in debian /usr/share/cmake-3.0/Modules/FindLua.cmake). I got it to build with the below patch, but I'm not confident in how to make the necessary changes cross-platform:\n0001-global-FindLua.cmake.txt\n. Ah, I see Travis uses Ubuntu LTS, but according to travis-ci #5821: \"At the moment, it is unlikely that we'll be supporting 16.04 as a native environment this year.\". So it looks like CMake 3(.5) won't be available until 2017, unless you enable TravisCI's docker integration.\n. For future reference, it looks like lua-5.x and lua5x are used in freebsd\n. Ahh, I'm sorry, I should have commented on the issue to say I was about to do it. I spent more time testing the behaviour was truly fixed than the patch itself.\n. Awesome, I was able to retrieve your public key from the Github API: https://api.github.com/users/TheCycoONE/gpg_keys\nI can verify the signed tag locally, but please can you attach a CorsixTH-0.61-beta1.tar.gz.asc file (see below) to the release notes? Unfortunately, Debian doesn't yet have a mechanism for directly uploading tagged releases, so it still uses the tarball.\nname=CorsixTH-0.61-beta1 # don't ask me why there's no v, it's just what GitHub does\ngit archive --prefix=$name/ -o ../$name.tar.gz v0.61-beta1\ngpg --armor --detach-sign ../$name.tar.gz\nThanks for going out of your way to learn the linux processes, I understand most downloads are presumably from Windows.. -----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA256\n\nSo what we are trying to prevent seems to be github.com turning malicious (or being hacked) and providing tarballs that don't match the tagged source code.\n\nYes, that's exactly right, it forms a verifiable chain from your machine to mine or any other Debian Developer's. The chain of trust is then maintained through the upload, build, distribution and download to a users machine. Our tooling needs to be improved to supported signed git tags directly.\n\nAn issue arises because you've downloaded my public signature from github, and the release tarball from github. A malicious party could replace my public signature with another one in my name for which they have the signing key, and then put out their own 'evil' tarball.\n\nOnly a bootstrapping issue. Since I've never met you, having your signature doesn't prove the release is from you. However, I'm only going to download your key once into my keyring (and the debian package), so it does prove the release is from the same \"controller of the corresponding secret key\" from now on. This practice does prevent the attack you described and for the record, the fingerprint of the key I received is DB147D8CD6737D34210D 20235C251992033D3D7C (a statement which anyone who trusts my key can verify, since I've signed this markdown message).\n\nunless you want to obtain my key in some other way?\n\nGPG provides a number of mechanisms for obtaining public keys, you can choose to publish to keyservers e.g. mine is, Web Key Directory, dns, debian packages, in person etc. For proper web of trust, you'd have a keysinging party giving someone your fingerprint in person and proving your identity to them, then it really doesn't matter how the actual key is retrieved.\n-----BEGIN PGP SIGNATURE-----\niQIzBAEBCAAdFiEEXDaX1B65I75FAped34XHDtO9S4wFAloNvWYACgkQ34XHDtO9\nS4xZog//dHcOL2HbVirD5FVtr/MsOtY6aEix4UPzIn29+OIgE0ljDOOO94zRgmLf\nNyZj/NukGt6MpGEV9jHtSZg+HhQOiHIxGjPBlTun/GDQ1PQm7o4sbRPtFjg4KEga\nTENi5N/6WDAQDWKYuoT/XF93ONVTpMbCibfIYMPJDnPYsuu5lkBnQ4gr4CeTxtsD\nHAYgE25kGHL75cN6IxBImKiwc0bOWKzKvbwFeJPkNvpn2gTg7GmEtX/E2zU1AmQB\nPn/v+0q119YOkqPFwpcXEA/44npdeAIPkqnj1Ck0+us82Jw/tAKLCyHjm3vxd1rX\nPQrzQrbo8lO8rlWBH7doBRm/m0WKQHsN1n4sfRJQfAkPAjxKMnOi3OZB8HtUmlqC\nrnftMYrwy+ezEu9UdpTGWG9zeDwZV0kYo1wDdw3EEkaAz6ukXg5kbGZ4y2R4oRmz\nhfDZV63GLr8G8MzSL6ublrVPnNi6e16Td+0FpnqJ667BLrRDhu6+Tp5bndkAlWVx\nouOZhlT+YCJmexnXrCd8Fe8n2TDanf0VggFY5KcKEokixdDlB0Ggka0r8UH2qg1p\nIduE4LqKWR9T9dCVVz+5TitPgv08mrXl5ngVKR14zE8ZK5SKWBwGIGmbhO0VnQWo\nK/ReZwJVQB1QW2a4Sj2qy2PaR5Co5gmm1qcEIMh3JcRFX3wPHFQ=\n=KLE/\n-----END PGP SIGNATURE-----. And I've realised I massively overcomplicated it:\n\nI gave a really long-winded description of Trust on first use, aka SSH-like security\nYour public key can't be changed without also invalidating the signed tag for anyone who has cloned. For the record, while this file was originally created by/for the Debian project, the original author and subsequent contributors did so under the same MIT/Expat license as the main CorsixTH project -- source (see debian/*). Yes, I'll look into this at the weekend. I suspect \"latest\" is probably fine.\n\nOn 24 December 2018 02:05:52 GMT, \"Stephen E. Baker\" notifications@github.com wrote:\n\nI'm not personally experienced enough with Docker to review this, but I\ndon't see the harm in including it as long as it's maintained, and the\ndocumentation on how to use it is added either to this file (comments)\nor the wiki.\n@emorrp1 are you able to look at this?\nShould we specify a particular version of Ubuntu? latest makes me\nnervous.\n. \n",
    "ntapiam": "Ok, thanks. So it's related to SDL2 then.\n. Resolved upstream. ",
    "joewestcott": "~~*As far as I can tell, the first patient chosen is the one nearest you at the time.~~\nPlaying it though again, I'm uncertain on the order of cycle or which patient comes first.\n. > Is the countdown timer a button?\nNope, the timer itself shows no visual difference. (Only the vaccination button above it does, for epidemics)\nHere's a video showing the process during an Emergency.\n(30mb) https://www.dropbox.com/s/59r4wv8tacnpl6w/timer_functionality.mp4\n. I'm not entirely sure what you're asking, swapping 'left' and 'right' makes more sense, did you mean that?\nIn which case the answer is nothing.\n- Right click will always show the next patient's information window. Even if the open one is closed, it will reopen on the next patient.\n- The first left click of the timer does nothing.\n- After the first right click, the next left clicks will centre on the last patient shown with a right click.\n. > in your video you only right click after you have left clicked.\nThe first click in my video is a right.\n. > Oh I see. Right ok. So left does nothing until you have right clicked?\nCorrect, yes :)\n. Awesome. It's great that you've decided to implement this! I'm on IRC this afternoon (gmt) if you've got anymore questions. :)\n. Awesome! Just a few changes:\n- The timer inside ring appears to have moved a bit off centre.\n- The timer clicking functionality applies to the whole timer graphic, not just the inside ring.\n- If I close a patients information window, I can no longer left click to centre.\n- camclick.wav should play for each click.\n. In TH, right clicking during an epidemic timer will only show one patient, not cycle though like emergencies. I'm not sure if this is deliberate, or a TH bug. Other than that, it looks really good and functions perfectly - great work! :+1:\n. > Which patient does it show?\nI couldn't determine how the patient was chosen, at the time I played there were about 3 needed to be done.\n. I have the same issue with 0.60B1 crashing on startup, barely making the dock. It does produce a .crash file in ~/Library/Logs/DiagnosticReports/, I can attach if desired.\n. On further inspection it does seem to be related to my ~/.config/CorsixTH directory, as renaming it lets me get to the find the HOSP screen. On selecting my HOSP (on disk version) it crashes straight after.\n. @clobber Sure, hope it's useful. Let me know if you need any more details. https://gist.github.com/joewestcott/f6afd79aeb19152a315e5c58b417c2cd\n. Do you think it's anything to do with the HOSP version? James' had no issue using the GOG distribution and you and I are using files from the disk. Plus the fact the game crashes for me the instant I choose the folder. Not sure if you picked up on that :) I'm using a late '13 MP. \n. Tried it on another mac (same HOSP folder) and I can get one stage further, this time to the circle with the Doctors/Nurses in before it crashes. He's the crashlog (with extra mac detail at the end) https://gist.github.com/joewestcott/8a47e8a01fb55ceb26e13f7ba328f95e\n. No difference with that build Toby, tried on both machines. The error both times is the same: This application, or a library it uses, is using the deprecated Carbon Component Manager for hosting Audio Units. Support for this will be removed in a future release. Also, this makes the host incompatible with version 3 audio units. Please transition to the API's in AudioComponent.h.\nIllegal instruction: 4\n. I'm getting module lfs not found (strict.lua:66)\n. Latest link works great for me, it's nice to have all the v0.60 features!\n. ",
    "morphine00": "Yep, every time.\n------ Original Message ------\nFrom: \"Stephen E. Baker\" notifications@github.com\nTo: \"CorsixTH/CorsixTH\" CorsixTH@noreply.github.com\nCc: \"morphine00\" bruno.mgf@gmail.com\nSent: 01-09-2015 00:16:58\nSubject: Re: [CorsixTH] Can't get into game, mouse clicks not \nfunctioning properly in Win7 x64 (#886)\n\nIt sounds like mouse up isn't being registered. That's not something \nI've seen. Does this happen every time?\n\u2014\nReply to this email directly or view it on GitHub.\n. I have two mice plugged in, and thinking that may had something to do \nwith it, I unplugged one of them. (This dual-mouse setup has no issues \nwith any apps or games.)\n\nOn the next startup, CorsixTH said it can't write to its config file, \nsomething that it's still doing unless I run it with Administrator \nprivileges. I managed to play the game for a few hours now, albeit with \nsome other unrelated bugs.\nPlugged the second mouse back in, and tried running CorsixTH again. Now \nit works, and I can't fathom why.\nAs a possibly related note, I did have an issue with the mouseup handler \nafter changing levels. Screen went black after the video, had to hit \nEsc, entered the level, then the mouseup handler wasn't being \nregistered. Could not reproduce that, though.\n------ Original Message ------\nFrom: \"Stephen E. Baker\" notifications@github.com\nTo: \"CorsixTH/CorsixTH\" CorsixTH@noreply.github.com\nCc: \"morphine00\" bruno.mgf@gmail.com\nSent: 01-09-2015 02:35:24\nSubject: Re: [CorsixTH] Can't get into game, mouse clicks not \nfunctioning properly in Win7 x64 (#886)\n\nYou should also post your gamelog.txt file or any console output from \nwhen this happens.\n\u2014\nReply to this email directly or view it on GitHub.\n. \n",
    "chaosink": "I have already installed liblua5.2-0 and liblua5.2-dev using apt-get.\n\u279c  ~  ls /usr/include/lua5.2/ \nlauxlib.h  luaconf.h  lua.h  lua.hpp  lualib.h\n. Now cmake works, but make reports an error:\nmake[2]: *** No rule to make target `/usr/lib/lua5.2', needed by `CorsixTH/CorsixTH'.  Stop.\nmake[1]: *** [CorsixTH/CMakeFiles/CorsixTH.dir/all] Error 2\nmake: *** [all] Error 2\n. I used the correct path:\ncmake -DLUA_INCLUDE_DIR=/usr/include/lua5.2/ -DLUA_LIBRARY=/usr/lib/x86_64-linux-gnu .\nAnd then:\n\u279c  CorsixTH-0.50  make\nLinking CXX executable CorsixTH\n/usr/bin/ld: /usr/local/lib/libavformat.a(http.o): undefined reference to symbol 'inflateInit2_'\n//lib/x86_64-linux-gnu/libz.so.1: error adding symbols: DSO missing from command line\ncollect2: error: ld returned 1 exit status\nmake[2]: *** [CorsixTH/CorsixTH] Error 1\nmake[1]: *** [CorsixTH/CMakeFiles/CorsixTH.dir/all] Error 2\nmake: *** [all] Error 2\n. Do you mean cmake -DLUA_INCLUDE_DIR=/usr/include/lua5.2/ -DLUA_LIBRARY=/usr/lib/x86_64-linux-gnu/liblua5.2.so .?\n```\n\u279c  CorsixTH-0.50  cmake -DLUA_INCLUDE_DIR=/usr/include/lua5.2/ -DLUA_LIBRARY=/usr/lib/x86_64-linux-gnu/liblua5.2.so .\nNote: SDL audio is enabled (default)\nNote: FFMPEG video is enabled (default)\nNote: FreeType2 is enabled (default)\nBuilding CorsixTH\n  SDL found\n-- Found Lua library: /usr/lib/x86_64-linux-gnu/liblua5.2.so\n  Lua found\n  SDL_mixer found\n-- CMAKE_MODULE_PATH=/home/lin/CorsixTH-0.50/CMake\n  FFmpeg found\n  FreeType2 found\n-- Configuring done\n-- Generating done\n-- Build files have been written to: /home/lin/CorsixTH-0.50\n\u279c  CorsixTH-0.50  make                                                                                             \nLinking CXX executable CorsixTH\n/usr/bin/ld: /usr/local/lib/libavformat.a(http.o): undefined reference to symbol 'inflateInit2_'\n//lib/x86_64-linux-gnu/libz.so.1: error adding symbols: DSO missing from command line\ncollect2: error: ld returned 1 exit status\nmake[2]:  [CorsixTH/CorsixTH] Error 1\nmake[1]:  [CorsixTH/CMakeFiles/CorsixTH.dir/all] Error 2\nmake: *** [all] Error 2\n\u279c  CorsixTH-0.50\n```\n. It seems that I still can't play CorsixTH... :pensive:\nThanks anyway!\n. With -DWITH_MOVIES=off the compilation succeeds !\nAnd after installing lua-filesystem and lua-lpeg, it runs ! :smiley: \n. ",
    "amit2103": "@Alberth289346  Many thanks for the reply. I understand things like game loop. Essentially I want to build a game. I wanted to avoid using any engine and build one from scratch. I was going through some open source projects, I found the CorsixTH code easiest to understand (also TH used to be one of my all time favorite games) . I am having a hard time understanding how are the levels defined for CorsixTH. The .level file seems to contain some information but how is the data for level 1 and the flow different from that of the level 2. Is this mentioned in code or is it somehow rendered by the system generically from the config files?\n. Went through the code...after your comment...Got a better idea...Will try to take up some beginner level work, so that I can contribute more.\nMany thanks for the replies.\n. ",
    "JoshKeegan": "Thanks, I've followed the appveyor script & using the libs from CorsixTH/deps repo rather than following the \"Setting Up Windows Dev Software\" wiki page & no longer need to #undef main.\nI came across another minor problem that I'll leave here for anyone else that has it:\nSince I last ran cmake I'd installed VS2015. Cmake would no longer work out of the box for \"Visual Studio 12 2013 Win64\", giving the following errors:\nNo CMAKE_C_COMPILER could be found.\nNo CMAKE_CXX_COMPILER could be found.\nI thought I'd give compiling with VS2015 a try, so ran cmake with \"Visual Studio 14 2015 Win64\" which worked fine.\nThe current version of SDL (2.0.3) caused a couple of issues when trying to compile the CorsixTH project:\nunresolved external symbol __imp____iob_func\nunresolved external symbol _imp_sprintf\nThese workarounds shouldn't be necessary for future versions of SDL (as they'd hopefully be compiled for the VS2015 toolset), but for now add somewhere in the src:\n```\n//Fix SDL for VS2015\nFILE _iob[] = { stdin, stdout, *stderr };\nextern \"C\" FILE * __cdecl __iob_func(void)\n{\n    return _iob;\n}\n```\n(Credit to http://stackoverflow.com/a/32449318)\nAnd then add legacy_stdio_definitions.lib as an additional linker dep (see https://connect.microsoft.com/VisualStudio/feedback/details/1134693/vs-2015-ctp-5-c-vsnwprintf-s-and-other-functions-are-not-exported-in-appcrt140-dll-breaking-linkage-of-static-libraries).\nWith those small changes, it will then build successfully under VS2015 targeting the latest toolset.\n. I should be able to sort it tomorrow evening.\n\nOn 11 Oct 2015, at 18:45, Stephen E. Baker notifications@github.com wrote:\nThe second commit (Merge branch 'master'...) shouldn't be there. Are you familiar enough with git to fix this yourself or would you like one of us to fix it on merge?\n\u2014\nReply to this email directly or view it on GitHub.\n. done\n. Made a small change to make smoke still show if the room was edited & the machine moved (without having to wait for the machine to be used again).\n. Method for recalculating smoke now extracted from machineUsed & added comments, so comments on that are welcome.\n\n@MarkL1961 I haven't looked at the machine usage being reset yet, but I intend to keep that as a separate PR anyway (and as @TheCycoONE says it will probably tie in with #913), so if everyone's happy I think this should be almost there.\n. Thanks :)\nSo going back to the original point, the fn currently gets called from outside of the Machine class. Are you saying that you'd like that call to be removed (as it might not be needed once the behaviour of moving a machine has changed)?\n. I had a quick play around with local whilst renaming calculateUsesLeft() to getRemainingUses() and by making the function local, I was unable to access the object (with self.). Will recalculateSmoke not have the same problem if made local, or is there some way of accessing self from within a local function?\nI suppose you could pass self as a parameter, but that seems more clunky than leaving it as is. I'm guessing I've missed something here!\n. @TheCycoONE Fair enough, I just thought I'd missed something because I expected there to be a way of not having to pass self.\nI'm still unclear on what you wanted though, as recalculateSmoke is currently called from outside of the Machine class. \nThat call might not be necessary in future once the behaviour of moving a machine is changed, but for now that call is necessary to make sure smoke shows again after a machine is moved.\n. Sounds good, I'll make the change but it might have to wait until next week now.\nAre you happy with the method name recalculateSmoke? I'm not a fan, but couldn't think of something more descriptive.\n\nOn 29 Oct 2015, at 23:28, Stephen E. Baker notifications@github.com wrote:\nI see, it's setSmoke(bool) that's the helper method not used elsewhere. place_object unfortunately needs to be aware of recalculateSmoke (no way around that without refactoring so that objects are notified when they are placed - which is a good idea, but out of scope for this PR). I'm ok with it then.\n\u2014\nReply to this email directly or view it on GitHub.\n. Thanks guys, apologies for the delay.\n\nI've made setSmoke local, fixed a typo, rebased & squashed the commits.\nI've only tested this very quickly (after rebasing) but appears to work, so I think this is now ready to be merged.\n. Made changes requested in comments on https://github.com/JoshKeegan/CorsixTH/commit/bc03e734a3a52305d7b3b20ecf679bfc06845997 & squashed commits\n. Sorry, I doubt I'll be able to look at re-implementing moving machines any time soon, which is why this is still marked as WIP.  \nIf nobody else is going to be working on it either though, this change did fix the bug so might be worth merging.\nIf so though, it would be technical debt & should to be noted in the bug report for re-implementing moving machines as it's otherwise an unnecessary change.. Done, although I wasn't sure if documentation comments should start with --! or just -- as there seems to be a mixture used.\n. More than happy to sort this, but it might be a week or two before I get around to it.\nIs there any date set for the 0.6 release yet?\n. Got to look at it today, see PR #1070 \n. done :)\n. ",
    "pietrondo": "solved.. I need to compile it with\n-DLUA_PROGRAM_PATH=/usr/bin/lua -DLUA_INCLUDE_DIR=/usr/include -DLUA_LIBRARY=/usr/lib/liblua.so\n. ",
    "Wuzzy2": "Well, in the wiki you could simply a link to the readme or whatever file from the wiki.\n. Seriously, what is wrong of having all neccessary documentation readily available in the project itself? I don't see any harm done by that, only benefits.\nI also don't see the point in having documentation exclusively on the wiki.\nDevs are not online 24/7. There can be many reasons why one can be offline: You are traveling with laptop and there are no WiFi access points, the Internet access at home broke down, you broke your configuration files, etc.\nAlso, compiling is not neccessarily a one-time process. Maybe someone already compiled it a long time ago, but now it is outdated. One got the source, then lost Internet connection and now wants to compile it. Then one goes through the readmes, only to learn that they are useless without Internet access.\nEtc. etc. etc. There are any possible scenarios where devs would be glad to have the docs available without Internet access. Saving the wiki page would be a smart move, but then I just point out another scenario in which one dev did not so. Maybe didn't know it is only available online or even just simply forgotten.\nLong story short: It is more convenient and more fool-proof to have all neccessary documentation distributed with the game itself.\n. ",
    "fosils": "Thank you! That got me to this page: http://www.armedpineapple.co.uk/cth/builds/ Which seems to contain fairly recent builds, but not based upon the very latest commit. Am I missing something?\n. ",
    "Develop3r": "Sure thing, here you go:\nhttp://www.mirrorcreator.com/files/1VNU1APQ/TH_Saves_Level12_Repair_Bug.rar_links\nI also added the last Level11 Savegame although I doubt that it has anything to do with it.\nUsing the \"Level12in201510drei0.5.sav\" you will see that no1 is coming to repair and the machine will blow up. \nWhat I noticed is that the cardiogram also causes some graphical glitches when in use... like you can see it through the wall for example. This I experienced before but I never had any problems with it...\n. The latter, plus: simple observation.\n. Hell you're right, that really solves it. Thanks mate! \n@MarkL1961:\nYeh I know, thats because in the beginning there were no machines. I thought they would still respond to calls of repairs, but not with a big priority. As in: They do not attend the machines themselves as handymen that were assigned to machines, but would do so if I manually call for repair.\n. ",
    "mfukar": "No I did not. I reproduced it just now without clicking anything at all after restoring the saved game.\n. Thanks for correcting me on that. The save is correct, but there's no need to unpause - will edit my initial comment.\n. ",
    "NerosTie": "The package has been updated on AUR and it works! It was really fast, thank you! \n. https://wiki.archlinux.org/index.php/Timidity#Freepats\nI didn't know I had to do this but it was easy. Again, thank you!\n. ",
    "msmollin": "@tobylane CMake seems to indicate according to it docs (https://cmake.org/cmake/help/v3.0/variable/CMAKE_OSX_DEPLOYMENT_TARGET.html) that not specifying that variable will cause CMake to compute it. If I comment out both of those lines:\nIF(APPLE)\n  #SET(CMAKE_OSX_DEPLOYMENT_TARGET 10.9)\n  #SET(CMAKE_OSX_ARCHITECTURES x86_64)\nENDIF()\nThen it seems to do just that. However I'm unsure how to test the success of this given the other issues I'm running into? \n. @tobylane Please see PR https://github.com/CorsixTH/CorsixTH/pull/962 for the fix.\n. Thanks for looking at this, @TheCycoONE. I figured it was probably more involved than just changing it to stdlib.h (since using cstdlib I think changes how you call those functions into a namespace with a prefix of std::). I'll work on getting the other PR's in for the other two issues and then maybe we can see if we can resolve this guy. \n. @tobylane have you noticed the xcodeproj bundle not being produced? I know the travis project manually calls xcodebuild but I figured it would hit this as well. \n. +1 for modern C++ code :+1: \n. ",
    "N3XUS12": "I should be more clear.\nI still get the charts, however only my own stats are recorded. Nothing is recorded for the other hospitals\n. Ah, that's cool then.\nIs there a estimated timeframe for when this will be implemented?\nAs I said it is only a minor issue, so thankyou for the swift reply. At least I know it isn't a bug now\n. ",
    "ssleahcar": "It happens with every doctor I try to train in the class. I've tried training about 6, but they all only become consultants.\n. ",
    "houqp": "@TheCycoONE , if you still want to use container build, try https://github.com/torch/luajit-rocks. That's what KOReader uses to install the new luarocks.\n. ",
    "simonsan": "You mean I've got to play with administrator privileges? Yeah, there are some kind of \"double doors\", and people cannot enter or leave a room cause they get stuck at the door trapping everyone inside and creating a bunch of waiting guys outside. Cannot edit the room either, \"zZz\" won't disappear cause nobody can leave. Picking up the doctor inside creates only another copy of that doctor, that cannot move.\n. ",
    "agolsby": "Ah ok I'll handle the android issue separately then.\nNo gamelog.txt gets generated. When I run the game from the terminal, all I see is this:\nWelcome to CorsixTH 0.50!\nThis window will display useful information if an error occurs.\nAt that point the game is frozen, and I have to force-kill it to close the window. It's running CPU1 at 100% but not doing anything on CPU0. I've tried disabling the intro movie in the config file, since some comments on the AUR page suggested an upstream issue with ffmpeg was causing the freeze, but that didn't work. \nAs for which build it is, 0.50-2 as built from AUR.\n. Ok, here's the stack trace from gdb. \nhttp://pastebin.com/60BhtYN3\nAlso, the arch wiki suggested running strace -eopen, so in case that's useful to you, here it is. It seems to indicate what file is being processed when the crash occurs.\nhttp://pastebin.com/1WMmWqZe\n. Found the problem -- the CD was scratched and apparently it had corrupted files. I tried again pointing to the HOSP directory taken from an ISO file from a different source, and it works flawlessly. Marking this closed. Thanks for your help tracking the problem down!\n. ",
    "shazoo1": "Yep, it was caused by pirated version. Thank you!\n. ",
    "Cyram": "Yes, I have a save game, but I not be aware of until the game is very avanced. About the version, I have the last one. An message in the game in the menu screen send me to the page of Corsix to download it. Version of Windows: 7\nThx ^^\n. ",
    "scorchsoft": "Hi Alberth,\nYeah that's right, an exploded room.\nA penalty is a good idea, maybe you can have a handyman repair the whole room and it take 100% of their time plus cost the original rooms building fee again. Assuming that can even be coded to work that way as the typical process if for a handyman to repair equipment and not whole rooms.\nAnother option would be to immediately delete the broken room but have the cost implication as described above. \nThe game has some metrics around hygiene right? Maybe whilst the room is being repaired the hygiene level drops for a period. I mean, in theory demolishing a room is a dirty task right?\nAnother option is that you can delete the room but all rooms of that type will also be deleted and you will have to re-research the room. Though maybe that is a bit too harsh.\nAndrew\n. Awesome thanks. Yeah no hurry, thought it was a good idea so worth mentioning at least :0)\n. Yeah it definitely shouldn't be a default. It is just a nice to have extra setting for those who would like to use it. Part of the Corsix project is about staying true to the original game, but part of it is also about extension and improvement around player feedback (which is why I'd like to see it in if at all possible).\nThanks again guys!\n. ",
    "voodoo070": "I think the original game used the exploded rooms as a mechanic to limit players' time\nAnd to make them use the full number of rooms in the hospital instead of just sticking to 1 corner (just look at the later levels.. you don't need all that space unless you get space taken from you)\nOnce a room explodes you cannot use the space anymore, but the levels are designed in such a way that you'll always have space if the game wants you to have the time\nyou can extend time by taking care of your machines well\njust my 2 cents, it shouldnt be default anyway\n. http://i.imgur.com/cCUqm1T.jpg\nyou just keep paying for him\nhe also remains on the staff list but since he walked off the level that just shows where he walked off\n. Makes it very hard to do some levels since you basically have to decline every single emergency\nI only took the King Complex emergencies once i had a cure buffer since they pay out twice ;)\n. well i loved the game as a kid and i do a playthrough every few years\nwas surprised with the bugs to be honest.. makes it quite difficult to get through the campaign :(\nthanks for doing this high res open version tho :)\nappreciate it a lot\n. well i got a couple levels to do, i've run into a bunch of other bugs like the game crashing when rooms explode with people inside tho\ni just dont know when it happens exactly and how to reproduce\ni'll start saving a few savegames\ni've also noticed doctors getting stuck in GP offices and not taking new clients\nor a VIP just standing in front of a room and not moving anymore\ni'll save those games from now on if i think of it :)\n. yeah ill grab the save from before it happens and after\nif i notice quickly enough for the autosave to still exist that is\ni've posted the ones that are kinda game breaking for me tho at times\ni dont mind the game crashing every now and then since i got autosave anyway\nthe doctor cost really got to me after a while tho :)\naltho it is fun trying to complete the game without being able to fire any staff since that would just add to costs anyway :)\n. ",
    "maverique": "This would be a very welcome decision IMO. Make it optional. Best of both worlds. You don't want it? You don't have to play with it. You want it? Have it! I'm all for playing with more of the gameplay decisions on my end of things.\n. Yeah I posted on that one but I'm not entirely sure that me and the original poster are referencing the exact same thing so I made this issue here. To clarify, I deleted that post. My apologies.\n. If there's anything I can do to help you track down and kill this nasty bug, just ask.\n. ",
    "lewri": "I believe something to add would be the placement of fire extinguishers seems rather useless in the game, rather more a 'vision' thing.\nI would rather propose the fire extinguishers could do something to prevent rooms exploding, e.g. if there is a doctor/nurse in the room at the time and the room is near explosion the fire extinguisher could be used to put out the 'smoking' the machine causes.\nChecking an original game wiki says the extinguisher is meant to help with this purpose, but the wiki itself doesn't know if it actually happens: \n\nSupposed to reduce the chances of your machine breaking down or blowing up.\n\nHowever, I do also endorse the option to rebuild/repair the room at a penalty/long repair time as an optional component.\n. Hi, new here.\nJust thought I'd add my comments here.\nI noticed this bug occurring both in Operating Theatre (sometimes one doctor wandered round the room and not getting changed, can fix by dragging him out and he re-enters as normal); and in my X-ray room.\nMore info on X-ray:\nThe doctor (and a handyman also trying to enter) would get stuck 1 block away from the door and unable to move. Tried removing items each side of door but didn't fix. Also trying to edit room and didn't fix. Dragging stuck doctor into room didn't fix (wandered round room and not seeing patients), then dragging him out again didn't fix (stuck in same place, same when trying to do it with handyman).\nEventually another doctor appears and enters room. Handyman gets unstuck and enters room. No errors was logged in the error command line screen, but have included the save it happened in. Should occur soon after.\nEdit: Just reloaded playthrough, now no doctor comes to unstuck door, perpetual loop of trying to enter room.\nplaythrough.zip\n. I managed to pull the following from turning on debug:\n\nCreated game with savegame version 111.\nWarning: Trying to remove nonexistant room build callback (function: 000000001A1D9C90) from humanoid (table: 000000001A69FC00).\nWarning: Trying to remove nonexistant room remove callback (function: 0000000019106FE0) from humanoid (table: 000000001A69FC00).\nWarning: Trying to remove nonexistant room build callback (function: 0000000011C4DE80) from humanoid (table: 000000001AC0B8F0).\nWarning: Trying to remove nonexistant room remove callback (function: 0000000018B501F0) from humanoid (table: 000000001AC0B8F0).\nSavegame version is 111 (v0.60), originally it was 111 (v0.60)\n\nThis was just before the freeze. Where the game breaks looks like it fails just because the doctor is waiting for the patient to arrive (the waiting emoticon should appear)\nI managed to get the console up while the game crashed. See errors below.\n\nError loops\n\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\entity_map.lua:72: Suspected infinite loop\nstack traceback:\n    [C]: in function 'error'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:919: in hook '?'\n    C:\\Program Files\\CorsixTH\\Lua\\entity_map.lua:72: in local 'remove_entity_from_table'\n    C:\\Program Files\\CorsixTH\\Lua\\entity_map.lua:88: in method 'removeEntity'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:119: in method 'setTile'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:174: in method 'setTilePositionSpeed'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:176: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:219: in field 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\staff.lua:149: in method 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1075: in method 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:1000: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:901: in function \n. Sorry for lack of clarity:\n\nThe information about types of room only appeared once when you first built said room for the entire playthrough (original). Now they appear when first building said room for each level (corsix).\nExample may help: At the start of a level you need to build your GPs office. On Level 1 you get an information screen after building it telling you what it is and does etc. In the original this screen didn't appear again for that playthrough (i.e. Savegame). However, in the remake this diagloue appears the first time you build a GPs office for each level (i.e. Level 1, 2, 3 etc...)\nI assume in the original a flag was made in the savefile to say whether the information screen for a room had already appeared before, to suppress it coming up again.\nDoes that help?\n. I'm not sure what happened. But once I reached Evergeen Hospital (might be wrong) level the dialogues stopped coming up. Synopsis for level: \u00a3200k in bank, rep of 600 (on playing board its the burning building)\n.  Here's the savegame I have before it broke. However, speeding through the game (10 months) it did not break again.\nI think the break occurred when I moved the pharmacy above the cardio machine to where the staff room is in the block with GP Offices (had 2 pharmacies at the time). At this point I imagine the error from the gamelog occurred. \nbuglogautosave4.zip\nNo output in gamelog for that autosave.\nI'll fix my game by overwriting the playthrough with the autosave, but if you can dig anything from that hope it helps.\n. I think I found the steps that caused the bug to happen. It affects Doctor HIGHSMITH (at least to start with)\n~~When editing the Staff rooms, he was ejected from it while deleting it (the one with the 4 GP Offices). After that he seems to be stuck in meander (his position to go to is in his GP Office though). I imagine deleting the staff room while a staff  member was resting led to the bug. But not sure how.\nIf someone can reproduce this (might need to edit the other staff room after deleting the mentioned one) then it could be a confirmation.~~\nI was wrong. Simply the action of editing the staff room directly affects any doctors in the 4 GPs offices (but not all of them). After this any affected ones meander in the room. Any doctors in the staff room are actually unaffected.\nAffected doctors acquire the following actions:\nidle must_happen\nmeander\nCan confirm that removing doctors from the GP Offices before editing staff room stops the meander happening. They can happily re-enter the GP Office after and be unaffected if the staff room is edited again.\nEdit (again): Issue affects when either staff room is edited, doctors in GP office flip out\nNB: The staff room in question is the one with the GP Offices\nAdditonal:\nSo after editing the staff room a few times the Cardio room suddenly broke (stuck patient again, can't be dismissed). Here's the error output:\n\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:667: Can only finish current action\nstack traceback:\n    [C]: in function 'assert'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:667: in method 'finishAction'\n    C:\\Program Files\\CorsixTH\\Lua\\rooms\\cardiogram.lua:97: in field 'after_use'\n    ...Files\\CorsixTH\\Lua\\humanoid_actions\\multi_use_object.lua:264: in local 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:219: in method 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1075: in method 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:1000: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:901: in function \n. While I can't write in Lua, I can at least make some understanding of the code. Looks like you've made good progress @Brainsample! \nI suppose trying to work out why editing a room causes doctors in different rooms to 'meander' in the first place could be addressed. If it's specific to staff rooms (perhaps building multiple staff rooms causes the breakage) then maybe something in the code there needs addressing too.\n. Hi Brainsample,\n\nI started up my game again today. Trying to find a workaround for the error, I rebuilt problematic rooms. However, on rebuilding the 4 GP Offices I got this:\n\nWarning: Could not find a humanoid to remove from the reserved user list\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\map.lua:60: bad argument #1 to 'floor' (number expected, got nil)\nstack traceback:\n    [C]: in function 'math.floor'\n    C:\\Program Files\\CorsixTH\\Lua\\map.lua:60: in method 'getRoomId'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:2270: in method 'getRoom'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:75: in method 'getEntranceXY'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:692: in upvalue 'tryMovePatient'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:754: in method 'tryToFindNearbyPatients'\n    C:\\Program Files\\CorsixTH\\Lua\\room.lua:554: in field 'onHumanoidLeave'\n    C:\\Program Files\\CorsixTH\\Lua\\rooms\\gp.lua:199: in method 'onHumanoidLeave'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:352: in field 'on_next_tile_set'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:219: in method 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1075: in method 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:1000: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:901: in function \nRecovering from error in timer handler...\n\nHope it helps!\n(NB: If just rebuilding the room doesn't work, try rebuilding the following first: Pharmacy (near research lab), cardio, staff room (both))\nEdit: On a side note, man got stuck from rebuilding room\n\n. Yeah I have completely lost the save now for any reference (though, the autosave I uploaded might work from earlier). Just clicking 'X' once on editing the GP Office caused this bug. After I completely rebuilt the 4 GP Offices the problem above did stop, for a while.\nI'll make a new report if needed, when I can. Thanks for instructions on testing out the code!\n. Do you have an autosave of before the woman enters the toiletroom? Looks like something has broken earlier than autosave 6, which could contribute to the handyman walking through the wall.\nI did manage to stop the error but picking up the handyman and taking him out the room before using the door to exit. Looks like it freezes as soon as the handyman tries to exit in correct fashion. Will continue investigating.\nUpdate:\nIt's definitely something to do with that plant by the door, but I don't know what. Moving the plant clears the 'walking through wall' issue and is no longer attempted.\nHowever, the toilet room now forms a queue of patients waiting to go in. Someone (I expect the stuck woman) is holding the door. Out of interest I dragged a handyman inside, he left, and released the door. The next patient tries to go inside and results in this error:\n\nEmpty action queue!\nLast action: walk\nstack traceback:\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:546: in upvalue 'Humanoid_startAction'\n    C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:672: in method 'finishAction'\n    C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:152: in local 'timer_function'\n    C:\\Program Files\\CorsixTH\\Lua\\entity.lua:219: in method 'tick'\n    C:\\Program Files\\CorsixTH\\Lua\\world.lua:1075: in method 'onTick'\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:1000: in function \n    (...tail calls...)\n    C:\\Program Files\\CorsixTH\\Lua\\app.lua:901: in function \n\nHowever, now we have an interesting development. If we make the patient leave he gets 'stuck' (like other bugs from recent) and queues to leave the room. The handyman drop actually releases the door again (though patient still can't leave) and a patient now enters through the wall. Although, now we no longer have a door.\nNote: Handyman also now stuck, but we can drag him out.\nNo other interesting developments, game just gets more and more broken.\n\nUpdate 2: This is the stats of the stuck woman in the toiletroom. Maybe of use? The walk action appears twice...\n\n. I'm pretty sure I saw this happen in the original. Or that the wall used to flicker in and out repeatedly while someone went past.\nI did reproduce the error though, but gamelog had nothing useful.\nAnd map overlays showed nothing.. After a bit of further digging, the part of the bed coming through the wall is a sprite that changes when a patient is in the bed. I can only guess the game doesn't know what to do when\n1 - the sprite is obscured by a wall\n2 - a person walks by said wall\nI noticed flipping the bed 180 stops the problem. So I would my money on that.\nHave you noticed if the problem happens when someone is in the bed? And if it does does the bed appear empty or occupied?. Excuse my oversightedness as I recently went back to try and debug more (because I don't know Lua or how to use its console to query the affected tile, didn't get much further) but the affected tile isn't actually next to the part of bed that changes.\nAll I could decipher is something by tick.\nExample:\nTick 0 - No patient on tile\nTick 1 - Patient now on tile\n--Some script must be run here in regards to anything using the tile when the patient steps on it (bed.lua, ward.lua I couldn't see anything of an obvious conflict). The output of the script must (in English) say something like: This tile is occupied by a humanoid, the tile on the left is occupied by a bed, the wall on the left can't exist. I will remove the wall.\nTick 2 - Patient leaves tile\n--I don't think the same script is triggered as they leave...\nTick 3 - Patient leaves adjcaent tile\n--Whatever script happened on tick 1 now puts the wall back.\nI'm not sure what part of the code is saying a wall can't exist in this certain circumstance...  Maybe it's similar to the radiator bug. But I'm at my limit with how much I can help, @TheCycoONE . > Rendering is done in a 2D manner, and no depth sorting is performed, so things appear on-screen in the order in which they are rendered - if two things overlap, then the one which was rendered last will be the one appearing on-screen.\nThinking about that... what would make the bed render after the wall? Are there values set for these things somewhere?. Moving forard for Bug 2... it should probably create a message telling the user 'You haven't discovered this disease yet'. Or make it so only debug patients can be made where their disease has been discovered.. Mark is right. They will move once you right click something for it to go to.\nFollowing that, bug 2 would be the only issue remaining. Going with @TheCycoONE said, I would move a suggestion of a visual indication of diseases. Perhaps diseases not discovered should create the debug patient undiagnosed (to test diagnosis processes).. I wonder if this issue could be caused by the savegame change. But nonetheless I tried to dig around. \nThe log doesn't seem to provide anything useful so I'll glaze over that.\nAre you able to provide a save before this step (i.e. before our dying patient entered the room)?\nWhen I clicked onto our patient he seemed to have the 'guess at cure' and 'queue status' buttons despite being in the room. I was able to send him home, which resulted in an error.\n\nWarning: goHome called when the patient is already going home\nSavegame version is 111 (v0.60), originally it was 111 (v0.60)\nSavegame version is 111 (v0.60), originally it was 111 (v0.60)\nSavegame version is 111 (v0.60), originally it was 111 (v0.60)\nSavegame version is 111 (v0.60), originally it was 111 (v0.60)\nError in timer handler: \nC:\\Program Files\\CorsixTH\\Lua\\world.lua:1804: attempt to index a nil value (local 'humanoid')\nstack traceback:\n  C:\\Program Files\\CorsixTH\\Lua\\world.lua:1804: in method 'findObjectNear'\n  C:\\Program Files\\CorsixTH\\Lua\\rooms\\psych.lua:134: in method 'commandEnteringPatient'\n  C:\\Program Files\\CorsixTH\\Lua\\room.lua:400: in method 'onHumanoidEnter'\n  C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:356: in field 'on_next_tile_set'\n  C:\\Program Files\\CorsixTH\\Lua\\humanoid_actions\\walk.lua:150: in function \n  (...tail calls...)\n  C:\\Program Files\\CorsixTH\\Lua\\entity.lua:219: in method 'tick'\n  C:\\Program Files\\CorsixTH\\Lua\\world.lua:1075: in method 'onTick'\n  C:\\Program Files\\CorsixTH\\Lua\\app.lua:1000: in function \n  (...tail calls...)\n  C:\\Program Files\\CorsixTH\\Lua\\app.lua:901: in function \nRecovering from error in timer handler...\n\nIf I am guessing correctly, @TheCycoONE will need to confirm, the 'goHome' action is somehow linked to a patient dying. I don't know the code side but it looks like when our patient \"died\" it executed a goHome command that was either: already called -or- never completed.\nAdditionally, this is what our patient's current action was while being stuck:\n\n. It could be a carryover bug from Beta 8 too. I dug through the old issues and found comment that bugs present in a savegame aren't automatically fixed when loading a new version of CorsixTH. Because we have a savegame before the bug happened... the bug shouldn't ever happen in a new version. If that makes sense.. Hi!\nI think you might be looking for @alanwoolley's port of CorsixTH to Android. The Github page is here.\nhttps://github.com/alanwoolley/CorsixTH-Android\nLooking here it appears to be a documented issue, however: https://github.com/alanwoolley/CorsixTH-Android/issues/109. This is normal behaviour as far as I remember. If a room becomes unstaffed the patient (or patients) will leave the room until it is staffed again (like a forced interrupt). However, I wouldn't expect the nurse to leave at her own accord if a patient was present (instead wait until diagnosis completes and do not allow new patients to enter).  \nAre you saying the nurse just gets up and leaves while people are present? This shouldn't happen... And worth looking at if it's the case. In a real world scenario, you wouldn't leave a ward occupied by patients if no nurse was assigned to manage it right? How would they call for help if urgently needed, or be helped to get up/move/eat/medicate?\nPausing diagnosis is a nice alternative however, until a nurse returns. But surely if you were picking up a nurse and putting her somewhere else it was for a reason right? I think it would be normal in that case to interrupt any diagnosis happening. . I know it's rather late but maybe I should weigh-in again. If the ward is a diagnosis procedure (in this case an observation), we would expect the results of our observation to be recorded by the nurse. Instead, I don't think a patient should leave without a nurse present so the nurse emulates signing-off the patient. The only bug bear of this is if we end up with patients stuck at the ward because no nurse is available.\nHowever, I  will back down about the other issue, it makes sense for a nurse to come/go while operating the ward.. Actually I think might be normal behaviour of the game.\nWhen 'stick to your room' policy applies, doctors and nurses in the first instance should go back to their original rooms. Only if someone else took over the room when they rested would they roam.\nWhen this policy is off, doctors and nurses will wait for a page/call to go to a specific room. The idea of this is to allow everyone to go where they are needed rather than having something permanently stationed.\nThe idea of this enhancement, if I understand, is that 'stick to your room' policy should always apply but with loose and strict elements. Such that:\nStrict condition: Behaviour like old game's mechanic, staff always stick to their rooms unless occupied by another staff member in their absence.\nLoose condition: Staff prioritize the same room they were in after resting, but can be called to another room while heading to their room (or meander if not needed)\nWhile I do not think this is a bad idea I believe the dichotomy of this policy's effect is lost. We could create a 3-step slide to include: Off, Loose, Strict if it is really favoured, however.\n--\nEdit: I realised there is one exception to this rule, and that is the Training Room and Research Room.\nStaff will always go back to these room after rest (until they become consultants(TR) or are picked up).. I decided to query the license terms for Visual Studio 2017 and looks like Microsoft has no problem with you including those redist DLLs in the game files (albeit they can't be modified in any way).\nA query put into stackoverflow has pointed out using 'locally deployed' files however, can get messy because it would mean CorsixTH has to maintain them. Again, it suggests using static links. I'm not sure why you can't static link though, I have no idea and trying understand why you can't hasn't really helped.\nhttps://stackoverflow.com/questions/35097193/can-i-bundle-the-visual-studio-2015-c-redistributable-dlls-with-my-applicatio\n  . What is the time frame since opening you are seeing 10 patients? If it is April of year 1 it would be pretty normal to only see a few patients. Between year 1 and year 2 it usually ramps up a bit more. \nEither that or your doctors are so efficient at their job nobody's ever waiting around long!. Was this part of the original game? \nOkay I am clearly blind :stuck_out_tongue:  it is part of the original game.\n\nThe Insurance Buttons on the right of the screen show you how your Patients\u2019 Insurance companies are paying you. Some Patients pay you in cash but others let you bill their Insurance companies. Some Insurance companies take more time to pay than others do. Left-click on their graphs to find out how efficiently your cash is flowing in.\n\nKnowing insurance is a part of this game encourages me to support this idea, albeit only for aesthetics. Could there be any additional changes to the way a patient pays?. Is there another copy of the savegame? It seems to not be attached to the issue :(. ",
    "AVeryFatElf": "Hey guys, probably the wrong section but as i think there might be a dev following this, I didn't realise about the blown up rooms not being removeable and after clicking \"Edit Room\" it caused an error signified by a window in-game which eventually after about 20 seconds caused the game to crash.\n. @TheCycoONE Will do! New to the forum but after work if I get a chance to I'll do just what you've said. Thanks and enjoy your weekend!\n. ",
    "overlordchaos": "i agree to have a non-default option to remove the exploded room. this also happens on small hospitals not just big ones. plus is stupid. a hospital would not leave a exploded room shut down forever. it could damage the structure over time as well (collapse the next or previous floor on real hospitals)\nput a non-default option where you can remove the room, (as if you where deleting it) but put 50% of the build cost + loss of 30 rep points. . i must agree with lewri. this is normal. its a game wide rule. if the staff member leaves the room (or you pick him up) the patient leaves. the theory is that once the staff member goes away untill a new one comes along, the room its closed down. its like closing down/opening a store. once it closes it closes once it opens, it opens. this was made most likely to avoid bugs such as a doctor/nurse leaving while the patient remains. maybe the new staff member would come and the person would not leave (maybe stuck) so you cannot delete the room. i am guessing it is something in that area. fixing a complicated bug with a simple solution.\nmy personal opinion its that is fine. thats how the game always worked and its not an issue to me its a mechanic i am used to. plus maybe if corsix tweaks it, may create a bunch of new bugs such as the one i just mentioned.. i think the ward NEVER did anything. it was truly a time waster for the game. EXCEPT diseases that got cured in the ward. but in cases when the cure is for example, ward then surgery, the TRUE cure is the surgery NOT the ward. it would require someone to play the original on the final level (since you have all diseases on) and obserb if my theory is correct. i do remember on the original the nurses only where seated on the desktop OR walking around the beds. but they did not have an animation to check actively on patients. so yeah i think the nurse ignores the patient they are \"decorative\" at best.. i think this happens near the final levels of the quest mode. in free mode in the 0.61 version has not happened again atm. still there are months i give up corsixTH cause i wanted to do a custom level and every time i tweaked more the level values more it break.. yes aldo if you force them to stick to your room, you will have to manually replace the doctor/nurse and when they are rested switch them back. it is quite tedious if you have 30+ staff members and you need to be tracking down each one. aldo i am sure its an original game bug to have with or without the room policy to doctors/nurses roaming around while the recepcionist asks for a replacement in a room and they ignore it while patients wait untill death or leaving angry. its a mix of game mechanic/glitch if you ask me ^_^. i am making a huge hospital witch its ALL the map as a single hube box. no corridors or strange shapes. so you can have 30 GP's, 10 OR's, 20 infirmaries etc. not sure how to actually do all the level editions like good staff. edit the .level as edsilmon says.. @edsilmon yes my idea is more on to make huge rooms. such like an infirmary for 40 patients (one for diagnosis and another for recovery) the GP's would be independent since the game wont allow more than 1 doctor per room. but putting those cases aside, yeah i think to do huge comfortable and usable rooms.\ni would need a big staff room considering the kind of hospital i would do will have over 50 staff members, considering doctor's/nurses/handymen's i would need to take care of this kind of facility.\nalso the big rooms would let you on the fly to choose what corners, and corridors to create. what waiting areas you wanna build. its not just a big box hospital without shape, you give the shape you want making rooms.\nedit: i managed to do the custom level, but the camera only lets me see the center of the hospital. is there some tweaking allowed so i can zoom out the level without restriction? if not i need to redo the map.. @Alberth289346 i am sorry to tell you, you are WRONG. i am running this hospital at the moment and its insanely complicated. i have over 50 staff members, need to check every time they go to rest there is a replacement, then do more rooms to fit the excess of doctor's/nurses running around once they rest and they location its filled. managing the patients try not to kill them. just because the game does not force  on you \"keep low deaths\" you can do so by yourself without lossing the level.\ni also use the cheats to create 20+ patients at once and one or two emergencies at the same time.\ninviting several VIP members to visit the hospital while its clean and running at the top of the charts.\nso you see, its not just a stupid idea. i agree its way too big. we need more deceases so we get more exam/consults rooms to use the insane space. but i have used 1/3 of the entire mega hospital and i have 2 of each consult/exam room and like 5 GP's offices plus a HUGE staff room, a big research center (even its not really necesary) and a training room where all my doctor's become consultants before they start working in my hospital. so as you see i am running the game at insane difficulty, set by my own standards.. @Alberth289346 will leave a copy here. would love some feedback. from the start i must say there is too much space. i did it in 4 wings and you can purchase them if you need them. this is done when we get new deceases to fit new exam/consultation rooms. any feedback will be enjoyed.\nbtw this is a map EXCLUSIVELY done to have fun on freemode (sandbox) mode. i always hated the rules of number of patients alive/dead get + or - amount of money, etc. as long as you dont kill too much people on real life you dont get insane rules like \"expand your hospital and raise the price tag on it afterwards\"\nhttps://drive.google.com/open?id=1gNAVAWCdxqDbzme23Qm4H66zfu0ljCJh. @TheCycoONE would love some number that makes the patient go to many diagnosis but not more than once cause this hospital will be able to have 200 patients at once (even if you need to use the cheat to create patients) and even if you have several rooms you will be overloaded eventually.\nso any suggestions for maxdiagdiff will be appreciated. i dont trust on default values i remember on the original games having 5 patients visit 5 times each diagnosis.. @edsilmon i was asking suggested numbers like this range xxx - xxx will go to all the diagnosis rooms but just once not twice or three times. not exact numbers.\ni detected a small issue with my original map and the emergencies. anyone willing to test do so with this one. also tweaked with some values the .maxdiagdiff settings.\nhttps://drive.google.com/open?id=1mSB0ZlPpAear5yyPxDuoE7XUOo02tvaB. @TheCycoONE is there any way to make my level (chaos hospital) not to auto open the doors? aka to disable the timer? so i can open it when i want to? and not before?. @TheCycoONE this has been quiet for some time... i can add my level as a crazy mega sandbox mode or someone else can submit one to add to the distribution if you like.\ni have stopped work&play on corsix first i have daily life issues so i dont have the time, plus i got piss off that after a few minutes errors pops out and i get frozen stuck patients/doctor's and loosing rooms. i understand this will take a LONG time to fix and make it playable. i would just wish for a new theme hospital made from scratch in HD with all this functions + way more. the game always struck me as unfinished for all the bugs the original game has (clear example when a machine room blows up the fix from the original devs was \"here you have a 10x times bigger hospital you will ever need\" as the final original campaign level is). ty tobylane but after 10 or 15 times i could not register for that forum. it says that the letters does not match and wont let me register there. i guess its a glitch?. @TheCycoONE i just finished the map. not sure why there are random crashes like the one i reported.\nand yeah i am using 0.61 beta 1. yes. can you give me a link for the beta 6.1? cause i cannot play my mega hospital :(. @TheCycoONE bad news, did the change as you showed me and i got an error on the start menu. you need to do some sort of savbe game conversion if you ask me at least on the first load to \"update\" the save game up to newer releases. in the screenshot the error:\nhttps://imgur.com/a/wBfNF. @TheCycoONE i never meant to delay the release. just put a warning that beta 0.61 players MIGHT have a issue with the save files. if you can find an easy way to tweak the game (as you previously tried) and fix all the issues its fine by me. its just anyone using beta 0.61 will have this same issue as me probably.. @MarkL1961 sorry but corsixTH IS on beta level. there is no release just yet, only RC. so if you tell me \"well if you use a beta you know what to spect\" sure but i dont have the option to go for the stable version.\nanyways i never desire to delay the release. just find a solution to this issue OR in the worst case a warning that anyone uphrading from 061 beta to RC may lost all their save games.. @TheCycoONE i added 100 (i want all the deceases from the start of the level) as it was previously, started over and i am having the same issue. not to mention every time i see more and more errors. please take a look again at this. in fact mod the .level file at your will and you will see its not just those values.. @wolfy1339 up to my understanding, if it is a psychiatrist wont matter if they are surgeon's/researcher's as long as if it a psychiatrist, with or without other specialty will kick the patient out cause \"there are no more diag rooms avaidable\" at least thats the reason if you put the cursor over the kicked alien every time.\n@wolfy1339 EDIT: on the RC version, ALL the doctor's on the GP office will send away to the alien patients with the excuse that there are no more avaidable exam rooms.... @TheCycoONE changed some values in the range of 100 to 1000 for maxdiagdiff. i will copy and paste to see the updated values:\nexpertise[1].Known.RschReqd 1 0 GENERAL_PRACTICE\nexpertise[2].Known.RschReqd.MaxDiagDiff 1 0 150 BLOATY_HEAD\nexpertise[3].Known.RschReqd.MaxDiagDiff 1 0 350 HAIRYITUS\nexpertise[4].Known.RschReqd.MaxDiagDiff 1 0 100 ELVIS\nexpertise[5].Known.RschReqd.MaxDiagDiff 1 0 100 INVIS\nexpertise[6].Known.RschReqd.MaxDiagDiff 1 0 900 RADIATION\nexpertise[7].Known.RschReqd.MaxDiagDiff 1 0 150 SLACK_TONGUE\nexpertise[8].Known.RschReqd.MaxDiagDiff 1 0 900 ALIEN\nexpertise[9].Known.RschReqd.MaxDiagDiff 1 0 350 BROKEN_BONES\nexpertise[10].Known.RschReqd.MaxDiagDiff 1 0 750 BALDNESS\nexpertise[11].Known.RschReqd.MaxDiagDiff 1 0 650 DISCRETE_ITCHING\nexpertise[12].Known.RschReqd.MaxDiagDiff 1 0 800 JELLYITUS\nexpertise[13].Known.RschReqd.MaxDiagDiff 1 0 500 SLEEPING_ILLNESS\nexpertise[14].Known.RschReqd.MaxDiagDiff 1 0 150 PREGNANT\nexpertise[15].Known.RschReqd.MaxDiagDiff 1 0 100 TRANSPARENCY\nexpertise[16].Known.RschReqd.MaxDiagDiff 1 0 250 UNCOMMON_COLD\nexpertise[17].Known.RschReqd.MaxDiagDiff 1 0 300 BROKEN_WIND\nexpertise[18].Known.RschReqd.MaxDiagDiff 1 0 950 SPARE_RIBS\nexpertise[19].Known.RschReqd.MaxDiagDiff 1 0 750 KIDNEY_BEANS\nexpertise[20].Known.RschReqd.MaxDiagDiff 1 0 700 BROKEN_HEART\nexpertise[21].Known.RschReqd.MaxDiagDiff 1 0 850 RUPTURED_NODULES\nexpertise[22].Known.RschReqd.MaxDiagDiff 1 0 990 MULTIPLE_TV_PERSONALITIES\nexpertise[23].Known.RschReqd.MaxDiagDiff 1 0 300 INFECTIOUS_LAUGHTER\nexpertise[24].Known.RschReqd.MaxDiagDiff 1 0 200 CORRUGATED_ANKLES\nexpertise[25].Known.RschReqd.MaxDiagDiff 1 0 400 CHRONIC_NOSEHAIR\nexpertise[26].Known.RschReqd.MaxDiagDiff 1 0 600 3RD_DEGREE_SIDEBURNS\nexpertise[27].Known.RschReqd.MaxDiagDiff 1 0 750 FAKE_BLOOD\nexpertise[28].Known.RschReqd.MaxDiagDiff 1 0 300 GASTRIC_EJECTIONS\nexpertise[29].Known.RschReqd.MaxDiagDiff 1 0 200 THE_SQUITS\nexpertise[30].Known.RschReqd.MaxDiagDiff 1 0 950 IRON_LUNGS\nexpertise[31].Known.RschReqd.MaxDiagDiff 1 0 200 SWEATY_PALMS\nexpertise[32].Known.RschReqd.MaxDiagDiff 1 0 300 HEAPED_PILES\nexpertise[33].Known.RschReqd.MaxDiagDiff 1 0 700 GUT_ROT\nexpertise[34].Known.RschReqd.MaxDiagDiff 1 0 800 GOLF_STONES\nexpertise[35].Known.RschReqd.MaxDiagDiff 1 0 950 UNEXPECTED_SWELLING\nwith this values ALL the aliens are kicked out. yet on a default level they are still kicked out. i dont think its exclusively to this values since on the beta 0.61 9 out of 10 patients are kicked out. on my RC test up to this point 10 out of 10 patients are kicked out. and even with incorrect values before and after the update.. @MarkL1961 yes it was on 100 and  @TheCycoONE said it must be higher. \nmy custom level enables ALL deseases/exam rooms/consults enabled by default since the start.\neven if i build the research room and put a researcher, only random upgrades are developed. others are not, like the enhaced machines to add into the research room. maybe the desease appears on the casebook BUT the AI cannot actually use it?. everyone can try to replicate this issue on 0.61 RC if you think this is a issue only from my custom level.\naldo i dont think so. it could be the desease was hard coded disabled cause they released the original game and has not been 100% fixed?\nEDIT: with the new settings, the SAME issue happens. the alien enters, wait on the GP queque, once it enters, it sits (goes from alien to man/woman) starts to talk to the doctor, after a few seconds its kicked out of the hospital, yet in the second i see it kicked, on the patient menu i see the option to send the patient straight to get cured and skip diagnosis. thats why i think its a new bug considering the game detects the decease and avaidable cure, yet the doctor kicks the patient out. on the 6.1 beta was with 9 out of 10 patients (the single patient that got the cure most likely was a bug considering the alien patient SKIP all the diagnosis and was straight to the DNA machine room to get cured) so this is a new glitch/bug on the RC version.\n@TheCycoONE i may suggest to compare the code differences regarding this decease with the 0.61 beta and the 0.61 RC. that might shed some light on how to make the alien decease to be diagnosed then cured. considering on the beta the alien whent straight to the cure, probably there was some sort of hot fix that forced the doctor to try the cure guessing rather than diagnose the patient, at least on that single alien out of the 10 that visit him.\nsecond edit: may i suggest, someone using a custom level (it can be mine if you have it) to disable ALL diseases and only enable alien one? that would make a straight line of alien patients. with all the consults/exams/threatments rooms open and working it would be pretty easy to replicate this issue when the doctor's on the GP office starts to kick out the patients one by one.\nedit 3:\ni did what i mention above. EVERY patient gets kicked. i set (ingame) the send home value to 0% and threatment value to 60% (just to debug this) and still they get kicked.\ni leave the save game + level files to be tweaked the .maxdiagdiff to anyone that wants to test this one out. also i might mention i have seen this kind of issue with \"iron lung\" disease. sometimes the patient leaves the infirmary and gets kick out of the hospital instead of go to surgery.\nhttps://drive.google.com/open?id=1f6I5QWS5u48cdiSLT9VZuedQ4RtbDo6N. @mugmuggy so you are in part confirming what i report. yes on the beta i assume the GP office takes the part of the code that threats as a \"emergency\" patient and sends it straight to the DNA machine to be cured.\non the RC release its just kicked out ALL the visiting alien patients (not the emergency ones those are fine)\ni have enabled visitor's alien's and the missing animations are made with regular men/woman spirtes then it switchs back to the alien form (to walk mostly) i am guessing it is nessesary to implement for visiting patients diagnosis rooms and then to be send to the DNA machine afterwards.\ni would suggest the blood test room, then the general diag room then the scanner, then X-ray then the DNA machine to be cured. aldo i would suggest a visit to the DNA machine room, take out the DNA alien  and to get \"cured\" go to the psychiatrist. it would be traumatic to get converted into an alien for X time.. alright. since we have the option to have walk-in alien patients. could it be possible to be developed as a fully dicease? i mean i think its a bad idea to be able to enable a disease that has no way to be diagnosed, you need a high skilled med to send it straight to the cure? its kinda stupid to be able to enable walk-in patients if you are just going to lose them at least most of them.. @MarkL1961 i have tested it with a hospital with only CONSULTANT doctor's and the result its the same.\nwe need to think in the original game they where only emergency patients, most likely they run out of time to make it a proper disease. we can fix this and not stick with \"ow well in the original this was like that\" it was a quickfix cause if you know the history of bullfrog, they where always at the 11th hour rushing the games since they where a small game developer untill EA purchased them and thrashed it apart.. if anyone can explain to me an easy way to mod the game or casebook so i can assign some exam rooms to the disease (alien DNA) i would be happy to do so and test it on my own.\nalso i would love to know if it is possible to send the patient to the DNA machine room and after to get threatment from a psychiatrist to get the \"cured\" part cause for real anyone morphed into an alien would get traumatized. it would be comfortable to know that after the rollback to human the patient was attended by a psychiatrist so he wont commit suicide, making a waste of hospital billing time! . @TheCycoONE another solution would be making them step over the DNA machine to give them their humanoid look back, then do some exams then psychiatrist as end goal. in that way you remove the alien issue and you can threat the patient anyways.\nas i said my theory is that they run out of time to do the alien desease properly or was a late addition to the game. i suppose it was not meant to be just an emergency sickness considering having a DNA machine with a doctor all the time just in case there is an emergency its stupid. unless they wanted to do a emergency room and they run out of time as well.\nEDIT: i managed to \"fix\" the disease but i am having issues making patients with alien DNA to come as regular patients. what do i need to change in order they come as regular patients?\nEDIT 2: jeez now all the doctor's on the GP office give me a error that crashes them... how broken is this diseace?\nedit 3: giving up considering there is an error and the patients cannot be send from GP to the DNA fixer (my fix was only diag room = dna fixer when the alien goes human again as \"threatment\" was a set of rooms, the blood one, x-ray, scanner, ultra scanner ward surgery then psychiatric) but after the alien goes  into the GP and the doctor its about to send the patient to the dna fixer the doctor crashes. so yeah up to this point without any pointers how to sort this one out its a no go.\nit would be better to replace ALL the animations by a new custom one. like the one that its all covered up with fur but with a green colouring. that should solve the animations issue. or just remove ALL animations aldo it would be silly to do that.\nEDIT 4: solved it tweaking the disease as a radiation patient, with the same visuals. lets just see if the game allows me to work with this tweaks...\nedit 5: now i broke the entire dicease aka it dissapeared. so giving up.. @TheCycoONE np. happy to help. i think this can be fixed in 2 ways:\n1: make the disease only an emergency (as BF did originally) and disable the option to get \"walk-in\" patients\"\n2: swap the \"alien\" appereance (i think the main bug/glitch its with the alien sprite that has missing animations) do a custom one, like the radiation one but in green color. in that way you get all the animations. or just make the alien DNA disease to be the same animation as hard radiation disease.\nin my experimentation with other diseases i found out if you add more exam rooms and specially consult's rooms to the disease cure, the game starts to give out errors, and the doctor's/patients get frozen in place. this can be a mayor issue if later along the way you plan to add custom diseases. this error can be the solution to prevent that. unless you can bypass and write from scratch the part of the game that handles the examination/curation of the patient's. that could solve the alien DNA disease. i still theorize the disease was hard code disabled to have walk-in patient's since the disease for some reason never was fully developed.\nmaybe on the origins of the game it was planned to have an \"ER room\" with a few diseases only for those rooms, and the DNA alien disease was a leftover from that. so it never was planned to be a \"walk-in\" disease.. @mugmuggy love all the info you are getting, and love to see you making work TH. ty for your time and skills you use in favor of this project.\nthat beeing said, could you take a closer look to the alien disease? why it breaks down the game when a patient comes in as a regular patient? and i dont mean the animations, i can live with that. but the doctor's and staff gets frozen in place, rooms get broken or with the patient stuck, etc.. @MarkL1961 if you desire i can give you a save + my own custom level. all the doctor's get 100% of skills in their field (not sure why i cannot force the game to convert a consultant into psychiatrist+researcher+surgeon at once as you could do on the original game trough training) and also only alien patients (after the emergency comes alone if an emergecy does not come, the aliens wont come alone) and the issue (as you mention) 90% of all the patients, instead of go into diagnosis they are kicked out of the hospital. i think thats an issue it should be adressed and solved. alien DNA its a VISUAL disease. so doctor's can have a minimal idea whats wrong.\nALSO it should be fixed that if an emergency with alien DNA patients does not come first, you dont get no walk-in alien DNA patients. thats a clear bug. (i have tested it on my custom level DISABLING all diseases and only enabled on alien DNA disease on the level) any other disease can start up without an emergency. must be part of hard coded data that prevents the alien dna patients to randomly walk-in without an emergency first.. @MarkL1961 i never said anything about a game freeze. (maybe when i started to tweak stuff but thats not valid cause i might have caused) the issue is that 9 out of 10 patients are kicked out from the hospital trough the GP office upon arrival.\ni am thinking the issue here is that i have my custom level with ALL the diseases and machines fully researched from the get-go. maybe if the alien disease its not discovered by research the game wont accept it? that's an issue from anyone that wants to disable research from the get-go of a custom level.\nalso i think i have missing reasearch items (the enhaced devices on the research lab, on the staff room some items like the arcade game, etc) \nhttps://drive.google.com/open?id=1f6I5QWS5u48cdiSLT9VZuedQ4RtbDo6N\nleaving my custom level. if you find a way to tweak the level settings to solve this, you are welcome.\n(be warned for the test i DISABLED all the diseases except the alien one, for testing purposes. feel free to enable all of them and tweak the values as you desire them as long the level works once again)\np.s: you might need to trigger (with cheats) an emergency so the first alien patients come in. THEN and only after that, the alien patients will enter trough the hospital if alien disease its the only one enabled. (without the emergency the patients will not come alone). @TheCycoONE i now see the misunderstanding. i never meant to call it a \"game freeze\" aka a game crash.\nthe Doctor in the GP office, gets stuck in place, and cannot be moved nor deleted as well the room.\nthats the \"freeze\" i was refering about.\nand yes its a diagnosis issue. maybe it should not be that difficult to diagnose considering the person is converted into AN ALIEN when they go to the hospital. if you can see the issue you dont need that much diagnosis more than to get the details of the disease.. @MarkL1961 tyvm for your assistance. i might think its an issue on my game (i have the gog version) and maybe its not corsix but the gog version. will try your fixed files tyvm again for your assistance and time.\nalso, i did the hospital so expandable, thinking of the future, if corsix team adds more diseases, diagnosis and consultation rooms. not to be used ALL at once. (unless we need 10x more diagnosis and consultation rooms that we have now)\nand yes the rules for win or loose are disabled cause my idea for this hospital is to run it as if it was open for decades (thats why its all researched) and its a real hospital. not a game that if you save X patients you win or if you loose X patients you loose the level. i just want to run it even if you save 2k and loose 200 patients. (bad ratio but its an idea)\nif i get more issues will try to do a video if you think that will be a berst way to debug issues.\now and btw i run the game on 4k on my 42 inch screen (its a virtualized resolution my tv is 1080p but my graphics card can render into virtual 4k resolution) so the map its fine (except some pixels on each corner)\nEDIT:\ni tested the file you send me. ty. but i detected part of the bug i was reporting in the begening.\nonce the consultant got tired, whent to the staff room (i build one) and the researcher took the GP office. in that moment ALL the alien disease (over 10) patients get send home (kicked out) considering instead of go to the DNA fixer and wait in queque while the researcher goes to the dna fizer, and the already recovered consultant goes back to the GP office, no the researcher stays forever on the GP office while the consultant runs around, and ALL the patients are kicked. so thats a bug. no researcher on the dna fixer = auto kick. they cannot even do the queque as any other patient would do on a diagnosis/consultant room.. @xcom169 may i suggest, to install the game to a non-admin folder? (dont install on program files) change the path to some user folder. for example to the download folder or links folder. those are useless if you ask me on windows. do something like links\\theme hospital so it wont scatter files over the links folder on the user folder. in that way you dont need admin rights (i think). @lewri up to my understanding, this is done cause MANY pc games installations has bundled it, and when MS started to \"allow\" the support apps for games, it did it out of charge, considering if you where going to add to the developer and/or the final consumer the extra money for some sort of MS license to use those free downloads... lets just say they allow it cause if not windows WOULD NOT BE a gaming platform. it would be more expensive than purchase a console with a single fee for the game.\nimagine having your games 2x as expensice cause the dev and you need to pay a \"redistribution\" license to MS to get visual studio, another one for directX, another one for framework... even if the cost to the final consumer was $1 per redistributable... you might end up needing to pay 5 extra dollars PER game.... i might suggest using cheats to inflate the population? when a fax comes type with the pointer 24328 then the green button on the fax. click a few times over the cheat \"create a patient\" wait a bit and you will get extra patients. be careful if you are not ready and you kill them it might be your doom!. i can see gog.com did some messing around in the game files, considering the original game files never present this issues with corsix. i assume its twice as hard work considering corsix may run well under an original TH installation yet the tiny mods they did on the gog.com version seems to create a pandora`s box of new bugs... as if the game had no issue whatsoever.\njust commenting i have noticed many bugs came from the gog version and the original version its less mentioned. i can also asume the original TH cannot be installed under windows vista and beyond so its pretty impossible to get this errors (considering the original game installation runs partially under DOS and needs 16/32 bits os up to my understanding so any 64 bits os its discarded) unless you install the game on a win 98 then copy&paste the installation under a modern system???. @TheCycoONE i know i was talking overall. if check it out most of the errors are on the gog version.\nit would be interesting to check if in corsix installed over a clean original TH version has this same issues that gog version has.. you need to spread out the radiators. you need to place them on the hallways as well as chairs so patients can sit down while they wait on the queque to be cured or diagnosed.\nadd some trashcans to avoide excesive dirt and reduce rat problems in the future.\nalso on big hallways and big rooms (surgery room an example on this shot) inside put 2 one on each end of the surgery ward.\ni would recommend add a radiator every 5 tiles on the hallways.\noutside the surgery ward you could put 1 radiator on each side of the door. then 2 more one right next to the building door and another one near the surgery ward.\nalso add one or two expending machines cause the heat will cause patients to get thirsty. and when you are heated or over heated patients will need their soda to survive!. i agree with this complaint. the last time i tried to train my doctors they NEVER learn any specialty just reach maximum doctor level. that is very wrong, in the original when you train they end up with a specialty one or the other. in corsix they never got it. specially on sandbox mode not classic level by level mode.. ",
    "strawgate": "FYI, I was hoping to use this as an intro to try contributing to this project so we'll see how it goes.\nI'm not entirely sure if/how the original game implemented it but the \"logic\" is littered all over the place.\nCorsixTH game guide https://github.com/CorsixTH/CorsixTH/wiki/Game-Guide\n\nFire extinguisher VIP's like to see these and they minimise danger from malfunctioning machinery.\nThe DNA Fixer Machine is a very complex piece of equipment and it would be sensible to keep a fire extinguisher in the room with it, just in case.\nThe presence of nearby fire extinguishers helps decrease the risk of explosion. A machine that explodes kills everyone in the room and renders the room permanently unusable thereafter.\n\nAnd in player documentation http://bullfrogproductions.wikia.com/wiki/Hospital_Items\n\nThe Fire extinguisher refers to single Red Fire extinguisher that can be bought and placed around your hospital as a form of fire protection. They cost \u00a325 per Fire extinguisher and an unlimited amount can be bought. Placing one near machinery will reduce the amount of breakdowns.\n\nOfficial Game Guide http://vignette2.wikia.nocookie.net/bullfrogproductions/images/2/20/Manual_Theme_Hospital.pdf/revision/latest?cb=20131210232242\n\nThe presence of nearby\nfire extinguishers helps decrease the risk of explosion. A machine that explodes kills everyone\nin the room and renders the room permanently unusable thereafter\n\nWhat are your thoughts on this?\n. ",
    "LiamDawe": "Okay, gave it a shot https://github.com/CorsixTH/CorsixTH/wiki/How-To-Compile\n. Is there a log I can show you that stores each time I tried?\n. Okay, not sure what's going on, tried with new release and it's fine without it.\n. ",
    "dfdgsdfg": "If you never play with lua53 and you never install it and its libs, then probably you should install these libs. In my case, it's the first time lua53 and I install it on the clean env.\nAlso, I had these error during build. \n\n\nIt may help for someone.\n. Okay. It's my wrong. I have home-brew lua and it means I didn't have clean env. I am not sure, but it make some massy during build.\nI uninstall all default lua and lua53 from home-brew, then install lua53. It makes some error on CMAKE.\n```\nBuilding CorsixTH\nFound SDL: /usr/local/lib/libSDL2main.a;/usr/local/lib/libSDL2.dylib;-framework Cocoa (found version \"2.0.4\") \n  SDL found\nCMake Error at CMake/FindLua.cmake:70 (MESSAGE):\n  Could not find Lua\nCall Stack (most recent call first):\n  CorsixTH/CMakeLists.txt:105 (FIND_PACKAGE)\nConfiguring incomplete, errors occurred!\nSee also \"/Users/me/var/CorsixTH/CMakeFiles/CMakeOutput.log\".\nSee also \"/Users/me/var/CorsixTH/CMakeFiles/CMakeError.log\".\n```\n. ",
    "danielcespedes2824": "Hi Mark!\nThe problem is that the room exploded and became disabled but it was built\nright on the connection to the expansion of the land. When i bought the\nexpansion of the property, it opened up and the people would try to get to\nthe other side through the corridor that ledto the burnt room. It had no\nwall on the picture (unfortunately i didnt get take a screenshot). And\neverytime one person would get to the \"illegal\" tile, Iwould get an error\nmessage.\nOn Sun, Mar 27, 2016 at 8:03 AM, MarkL notifications@github.com wrote:\n\nExploded rooms are closed off so how are patients and staff interacting\nwith closed rooms?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/1011#issuecomment-202052535\n. \n",
    "clobber": "@tobylane Still working on getting this merged? This looked promising.. @joewestcott Please upload it here (https://gist.github.com) and share in this issue.\nI just checked the build on another machine and interestingly enough, I was able to launch it. There seems to be a problem with one of the frameworks (maybe Lua?) and certain hardware configs, so the more details the better.\n. Okay, please post the crash log anyway! I was not able to get to the selection screen even after removing my config directory.\n. @joewestcott Probably details on your Mac would be good (model, cpu, etc) since that only appears in the log if you click the \"Report...\" button when the crash dialog comes up. Otherwise, the logs sitting in ~/Library/Logs/DiagnosticReports/ do not contain that extra info.\n. Doubt it. I can't even get to the point of game data selection screen, so that appears unrelated.\n. @tobylane That build above doesn't seem to be packaged right. Crashes with:\n```\nApplication Specific Information:\ndyld: launch, loading dependent libraries\nDyld Error Message:\n  Library not loaded: /usr/local/opt/xz/lib/liblzma.5.dylib\n  Referenced from: /Users/USER/Desktop/*/CorsixTH.app/Contents/MacOS/libavformat.dylib\n  Reason: Incompatible library version: libavformat.dylib requires version 8.0.0 or later, but liblzma.5.dylib provides version 6.0.0\n```\nAnd yeah, it's Core 2 Duo, not Core Duo. It'd be impossible to run on Core Duo because it's not 64-bit and unsupported on OS X since 10.7. Any package on homebrew will run on latest OS X.\n. Okay, I'm able to compile a working build doing the following via Terminal with having Homebrew and Xcode Command Line Tools installed:\n```\nbrew install cmake lua sdl2 freetype ffmpeg\nbrew install sdl2_mixer --with-smpeg2\nluarocks install lpeg\nluarocks install luafilesystem\nluarocks install luasocket\ngit clone https://github.com/CorsixTH/CorsixTH\ncd \ncmake .\ncd CorsixTH\nopen CMakeLists.txt \n```\nNow in CMakeLists.txt, Find & Replace all occurrences (should be 2) of the following line:\n\\${TARGET_BUILD_DIR}/\\${FULL_PRODUCT_NAME}\n...with a hardcoded path to your checkout folder, for example:\n/Users/YOURNAME/Downloads/CorsixTH-master/CorsixTH/CorsixTH.app\nSave the CMakeLists.txt file and close it. Now back in Terminal to compile the app and open the folder:\n```\nmake\nopen .\n```\nThere will be a newly compiled CorsixTH.app in the folder.\nEdit: build removed, wasn't redistributable. Missing libraries.\n. ",
    "DavidFair": "It crashes with both versions of SDL2 - the one from deps and a custom build I used for debugging.\nIt has happened since commit 85d890f - I downloaded and tested the previous commit from appveyor which did not crash when doing this\n. I've compiled using the above patch and it also resolved it on my end too.\n. Just following up - the upstream bug: https://bugzilla.libsdl.org/show_bug.cgi?id=3147 has been resolved by this commit: https://hg.libsdl.org/SDL/rev/17e0ded12e6f\nIf we have that commit in the external deps repo I'm happy to compile against it - test and close this ticket if everything works correctly?\n. Sorry I just realised I never followed up on this - the latest deps build did fix this, thanks.\n. It is very easy to replicate - any emergency with more than one patient triggers this behaviour. I'll try and get a save to show this happening.\n. Here are some saves showing the bug (before and after) - accept the emergency displayed and wait for ever patient to be cured (sucessfully on mine) the final patient will be cured yet the death sound will play and the count will increment incorrectly\n1032 Save.zip\nThis does not happen with only a single emergency patient\n. Could it be an option instead of unconditional. I play on multiple monitors so naturally the game loses focus a lot and this would be very distracting. \n. Just my opinions, I've been weighing up a heuristic or an option and I still think a simple toggle option is the way to go. \nFirstly as TheCycoONE has pointed out such a patch would introduce a lot of technical debt and edge cases. Regardless of the technical difficulty such a patch would be significantly more complex than a simple toggle option. Even if sherief supplies or helps develop such a feature who will support it going forwards, I foresee it being removed if the developers do not fully understand the code and sherief is not available. \nSecondly I think forcing certain behaviours on the user is bad, what if today I don't want the music whilst the window is out of focus on a multiple monitor system. What happens if a person with a single monitor wants to hear the game in the background. The developers would have to anticipate and force a decision on the users whereas a toggle can follow the original games behaviour as default.\nFinally for users with laptops the behaviour would be inconsistent. If you have another monitor attached whilst playing the game you will be used to the game playing music in the background. The average user would still expect the game to do that without a monitor attached. The correlation between game audio whilst the window is out of focus and whether your laptop is plugged into a monitor is non obvious and I foresee some confusion if we make this option automatic. \n. I fully agree we shouldn't maintain multiple packages for old compilers. I think its worth dropping VS2010 support and leaving VS2015 up as long as it successfully compiles using the deps repo.\nI hadn't come across vcpkg before, but it seems like a much better way of doing things. Could I propose a roadmap of changes, I'm completely open to feedback:\n\n\nCould we look at merging this PR before looking at vcpkg, it means for those of us developing on VS2015 it \"just works\"?\n\n\nI propose we make a new repository called something like \"CorsixTH/vcpkg_deps\"? I'm happy to look at building the dependencies for MSVC 2017 in a separate repo. However this may be the slowest part of the process as I have no previous experience pre-compiling libraries especially on MSVC. Edit: Actually it was a lot less painful than I expected - PR: #1261 \n\n\nOnce we have our own vcpkg dependencies built, would it be okay to move the changes in #1247 and #1261 into this build script? This way users and CI servers both use the same code path and the folder is cloned relative to their repository and not to the C:\\ drive (which causes me problems at least.).\n\n\nLastly we could then look at enabling VS2017 support with these changes in place afterwards? . Merged into #1261 . > The cmake folder isn't appropriate - that should just be cmake modules. In my opinion 'scripts' is the best folder, an argument could be made for the 'build_files' folder as well.\n\n\nOkay, I'll put this in scripts as build_files is picked up by .gitignore with build*\n\nThere are a couple runtime dependencies which I have been successful in submitting to upstream vcpkg (luafilesystem and lpeg)\n\nI didn't see them listed in the wiki as dependencies. I'll add them too and update the wiki.\n\nluasocket is going to be tricky - there isn't a release (or release candidate) version that works, so we have to pick a semi-recent git commit instead; which I think that upstream wouldn't accept.\n\nIt looks like development has stopped and nobody has an active fork. Does the vcpkg team have a policy on the state of a library before it is accepted?\n\nThere is also wxwidgets needed for building AnimView\nThe export could be optional, it's not necessary for local builds.\n\nOriginally my plan was to build all dependencies and distribute them pre-compiled like we currently do with the dependencies. However the final size of the .7z archive is 80MB so I prefer your approach of getting users to build locally rather than forcing them to download the exported libs. \nI'll adapt the script so it integrates with CMake and allows us to specify if AnimView is being built. This should allow us to compile only what users need instead of everything.\n\nIt is better to pull from a specific vcpkg commit or release; or from my fork (or a CorsixTH organization fork)\n\nII'm going to leave it pointing at the official repository and include checking out a specific commit. We can just change the commit we point to instead of having to pull the latest changes to test.\n\nPerhaps the script could write-out the cmake line to use the vcpkg[...]\n\nIf CMake invokes the script we could easily glob the final path and handle everything within the build script. \nMy only other concern is CI servers, I'm reluctant to force them to rebuild the same dependencies each time. If AppVeyor/Travis allows us to preserve files between builds we could save the current commit we use for vpckg and export the dependencies. This way we can easily determine if we need to rebuild or just extract and reuse previously built ones?\n. I've merged the PR from #1259 into this. \nHere is a list of the work I've done since last time:\n- The script no longer has an option to export, we just build locally\n- I've integrated it into the CMake script fully so this is completed automatically\n- I looked into using a toolchain and went with using CMAKE_PREFIX_PATH (reasons below)\nRegarding the toolchain to copy and paste my comment from the file:\n```\n    # We cannot use a toolchain file at this point despite it being recommended by MS.\n    # The arch is determined by the generator in use on Windows such as \n    # Visual Studio xx Win64 <= 64 bit build. If we use a toolchain this\n    # always defaults to a 32 bit build.\n# Also we would need to restart the build at this point, delete the \n# cache and invoke cmake again with the toolchain set if the user\n# specified their own generator as it is too late at this point.\n\n``\nI spent several hours looking for a workaround but it rapidly descends into dirty hacks. We can however use theCMAKE_PREFIX_PATH` which performs the same functionality for finding libraries as we previously had.\n\nI'm feeling fairly strongly that we will be adding a CorsixTH\\vcpkg fork so that we can maintain anything we need that deviates from upstream. It will be easy to swap though.\n\nCompletely forgot about advantages of a fork such as patching our own dependencies. I'll change where we point to if you want to set-up a fork?. Okay, I'll add a section to the powershell script (as it has a list of libraries for MSVC) that copies the debug and release binaries to the relevant locations.\nIs it worth me also adding a small section to the CMake script which copies the various files / folders we require into the build folder such as CorsixTH.lua? This will save us having to manually do it each time we have a fresh build folder.\nI've also noticed in the Corsixth/CmakeLists.txt file we do not specify debug and optimized libraries for target_link_libraries. Currently we just link against release libraries regardless of whether we are in debug or release. This is something I'll look into in the future as the change should be relatively easy but beyond the scope of this PR.. Ahh I do my builds out of source hence my different perspective.\nMy original plan was to use the library names to guess the DLLs to copy over, however ffmpeg doesn't following this convention. Ultimately I took the kitchen sink approach by copying over all DLLs and the contents of the tools folder. These are placed into the correct Release or Debug build folders.. > Release build is working, the debug build is not. It seems that some libraries SDL2 and freetype in particular are given a 'd' suffix for their debug dlls, but CMake is using the release libs which don't match that name. It's annoying but we might be better off just respecting CMAKE_BUILD_TYPE up front instead of the CONFIG at build time.\nI've added the changes from the link you suggested. SDL2 was giving some issues, it either found the debug OR release. In the end I tweaked the find module to search for both the debug and release version and package them together in the same variable.\nThis now links correctly on my end, does it resolve the problems you were seeing?\n\nI also have concerns about updating vcpkgs packages (iirc the old versions need to be manually removed, but we don't want to do that every time, so we'll have to check for updates), and maybe how to handle builds that require old versions (e.g. release tags), though I'm willing to ignore them for now.\n\nThe script adds the commit id for the last build to a file within vcpkg. Using this file we can see if we have checked out forwards or backwards. When we checkout backwards we run git clean -fx and build from scratch (I don't foresee this happening many times hence the nuclear approach).\nIn rare cases like this: https://github.com/Microsoft/vcpkg/issues/501 where vpckg update couldn't determine the correct behaviour the user will have to clean or delete the vcpkg folder. \nHowever I want to put the mechanism for that in when we have to otherwise it forces a clean rebuild each time.\nI've also moved the VCPKG_COMMIT_SHA into the cache so users can see it. From the GUI it only appears under the advanced tab. This should allow us to test new commits without having to change the CMake file until were ready.. @TheCycoONE Sorry I don't like leaving PRs in a half completed state but something came up on my end which I had to deal with.\nThanks for continuing with these changes in #1274, I'll close this PR which is now stale.. I've opened a pull request which should fix this for new games. \nPreviously we set an incorrect flag saying we are playing the campaign, as described in #1308 .\n@UncagedFungus because this flag can't be set on existing saves easily (how can we tell a campaign level from a single level...) it is likely you will need to start a new campaign if/when the changes are merged to resolve this.. @TheCycoONE - Okay I'll go ahead and mark this ~WIP~ Edit: RDY. \n\nAs such, a fix moving the logic into app.lua would be welcome...\n\nMy plan for tidying up is to move some of the initialisation logic (loadCampaign, loadLevel...etc) out of app.lua  into something like init_game.lua?\n\nI have simplified the release process substantially, and don't plan to have any more children in 2018, so I expect 0.62 won't take as long to materialize.\n\nThat explains the period of quiet for this project \ud83d\ude04 . Okay I propose we leave this PR for a patch candidate (0.62 for example) as the changes are safe. \nThen I'll open a separate PR for the clean-up work which is a bit riskier for the next major version (0.70)?. Let's merge as is. If we need to roll back the refactor we revert a single commit rather than all features at once.. Hi Pavel,\nIn #1310 we added a new in-game option to toggle mouse capture. Whilst testing the PR we noticed the following:\n\nOpen a new or existing game\nGo to the options menu at the top of the screen\nToggle edge scrolling on / off\nRestart CorsixTH \nLoad back into a game\nNotice the option was not preserved, so it wasn't written to the configuration file.\n\nOn the latest master (not sure if it made it into 0.61) the mouse capture option is saved with the following code \nWe need somebody to \n- Go through all of the options in the options menu\n- Check they are saved in the config and if not\n- If they are not add the relevant code as per above.\nHope this clears up the issue.\n. > I oppose this commits changes.\n\n[...]\nIt would be more confusing in a future where directories also represented namespaces.\n\nAgreed, I was working on some conventions which talk about moving headers into their own folder without realising this applies to a library interface. I'll move them back.\n\nI intentionally set this OFF by default.\nIf it is off and you meant to have it on then the build will fail nearly immediately. If it is on when you meant to have it off the build will succeed, potentially with the wrong libraries and after a fairly long time.\n\nMy only concern was you cannot use vcpkg dependencies with the GUI unless you have used the command line first.\nInitially I enabled it by default as doing a complete cache clean + build with developer warnings enabled as it was more convenient in the GUI. However I agree silently linking against the wrong libraries would be a nightmare to debug, so I'm not sure where to go from here as it requires discussion.\n\nCan you add a quick justification as to why you selected Google Test Framework (over another unit testing framework for C++). I would like some discussion on this before we jump on one or another.\n\nNo reason. I saw there wasn't unit tests in CorsixTH and wanted to start refactoring; this just happened to be the easiest to integrate as a proof of concept which is widely used.\nI'm happy to use any testing framework if people have personal preferences and it's the reason I only wrote a single test....\n\nI am in favour of adding a unit test framework, but I have strong reservations about adding one without also including a substantial number of tests to prove it; otherwise we're likely to end up like the lua situation, with a test framework in place but serving no use.\n\nThis is why I added only a single test for a function which was proving problematic to refactor. Whilst it's easy for me to to say I think we should add unit tests going ahead and writing one shows I am committed to actually using a testing framework. Without this I worry we would we end up in the same situation as the Lua testing where the framework was added without any tests. \nHowever I didn't want to commit too much time in case the changes were not accepted.\n\nThe install target already copies those files: https://github.com/DavidFair/CorsixTH/blob/bd7a72332f17023801d93cf68ef78cabd8a91924/CorsixTH/CMakeLists.txt#L234 (to the CorsixTH executable directory, not the proper location for FHS compliance)\n\nI added the extra steps as I had to remember to copy the various Lua files between the source directory and build directory each time I modified them whilst testing. This depends on developer workflows largely I suspect and is worthy of discussion.\n\nThe sprite function doesn't need it's own file. It is logically connected to the other gfx code.\nSee similar anti-guideline: https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#Rnr-lots-of-files\n\nI initially moved it out as it didn't have it's own header in the th_gfx_sdl.cpp. I agree having a file just for a single function isn't correct, and just left it there for the purpose of writing a unit test. I'll move it into th_gfx.cpp as it is not SDL specific though.\n\nI'm very much in favour of the things you've listed under future work. If you look at my own commit history I have been slowly pushing the code in that direction myself. Additionally I would like to eliminate code macros.\nAll changes unrelated to adding the unit test framework, and adding tests I'd prefer were not in this PR. Many of the changes included are controversial, and worthy of their own discussion.\n\nMany of the changes in this PR happened in a single day trying to just understand a single function and I suspected they would be controversial (actually more controversial than this) but wanted to spark some discussion around them.\nI'm glad to see there is interest in the ideas proposed. I'll try to open a discussion before prototyping changes in the future, as I agree with several points of feedback given here.\n\nI see this PR being split squashed into several separate PRs, something like this?: \nPotentially least controversial :\n\nUnit testing framework and initial unit tests. (Do we stick with Google Test or go with something else?)\nMove convertLegacySprite from th_gfx_sdl.cpp to th_gfx.cpp and include the new header which was missing\nBump C++ standard to C++-14 for make_unique and enable folders for IDEs that support it\n\nMore controversial and discussion required:\n\nDefault option for vcpkg, do other developers link against their own system libraries instead or is this the exception to the rule?\nCopying data directories / files into the build folder and should it be included in the build target steps?\n\nRevert:\n\nMoving header files into their own folder\nVcpkg on by default (depending on aforementioned discussion)\n\n. Due to work commitments I won't be able to look at this PR until the 12th. \nWhen I next look at this I'll split out the testing commits, add some additional unit tests too and make them all optional.\n  . @TheCycoONE Go for it, I'm more than happy for people to take any chunk they see fit from this PR into a separate one.. Upstream *nix does not include a prebuilt version of GTest: Readme. \nThe short version is that linking to a pre-compiled version might violate the one definition rule and cause link time / runtime errors.\nThe workarounds are:\n- Require users to build their own copy of the library whilst checking their compilation options always match ours\n- Build our own copy of GTest locally \n- Bundle the precompiled version in some manner\nVCPKG works - but only by chance as the compiler flags (and ABI) match the default used by the packaging tool. However this is fragile.\nThe recommended practise is to let CMake pull this in as an external project and build it using the same CMake file so it's guaranteed the same compilation flags are used, so I'm going to stick with this unless we can figure out a better way of doing this?. I did something similar in #1310 here but subsequently reverted it.\nHowever @TheCycoONE is encouraging people to move away from building in the root directory (at least that was the impression I got). \nThe compilation instructions for Windows correctly points people to build out of source so the Linux build instructions on the wiki need updating to follow similar conventions. \nI would do this, however I'm on phone only for the next couple of days and I don't fancy the prospect of writing markdown with it. \n  . Okay I've split this PR and updated the PR message to reflect the current changes.\nWhilst there are a couple of unrelated changes in this PR they are required for the unit test target to compile correctly.. So just to clarify we don't need top copy any files from the tools directory out? \nThe earlier changes copied lfs.dll and lpeg.dll into the tools directory and I was unsure if they needed copying into the build directory.. Okay lets save ourselves lots of headaches and just always clean build dependencies if we change the commit that we point to.. @ras0219-msft - Would these commands also work if we rolled back to a specific commit or would we have to take the clean build approach?. Great thanks for the heads up, this makes it significantly easier. \nCould we add this to the documentation in the vcpkg repository? \nThe only details I could find about updating was here. Beyond this I couldn't find details that you've provided such as re-running the bootstrap script or how versions are handled when I was looking.. I'll open another issue to look into it. It should be minor but deserves it's own testing to be sure we have got it working properly. I've opened #1311 - I'll look into it another day as it looks like a simple job, but I suspect other buttons could also be broken too.. This can be dropped. C99 support was added in VS2013 so we don't need to handle this ourselves.. Ditto on dropping this block as MSVC has this header natively in VS2013+.\nIn addition we should change the only usage of inttypes.h in SpriteEncoder/scanner.cpp to use <cinttypes> instead.. Do we need to explicitly exclude SVN files or is this a holdover from before the project used git?. If LUA_LIBRARY or LUA_INCLUDE_DIR are not found FATAL_ERROR means we bail out. So this check can be removed entirely. And we don't need to check Lua_found or the else condition at this point, we know it had to be set here.. Do we need to bump the CMake version to 3.7 for FindLua?. ",
    "Wowbagger2004": "Hi,\nHere's a video showing this bug and a savegame from just before it was recorded.\nYou can see that my hospital copes with the emergency but it counts the last patient as having been killed, even though he was actually cured.\nhttps://youtu.be/UlBWYjNPPUM\nemergency.zip\nThanks very much!  And thanks in general for this excellent project!\n. ",
    "immaculation": "Hi - might be able to shed some small light on this...what I've observed running 0.50\nX = total death toll\n= Sum of each disease death toll\nEmergency for any given disease, where the death toll for that disease is n, at the end of the emergency it seems to always be n+1 irrespective of if anyone dies. Announcer announces the new death toll as X +1. When you look at the casebook for the disease, the death toll for that disease is NOT n+1 but n + (X+1) ie n + the new grand total. Only seen this bug where n = 0, so it either increments that disease death toll by (X+1) or replaces it by (X+1).\nThe Grand total equation ie sum of each disease death total is maintained and thus at the end of this chain of events, is equal to \nX1 = X + (X+1)\n(instead of X1 = X + 1), again, notwithstanding that no one may have died as part of the emergency.\n. ",
    "JamesBream": "Absolutely no issue running the GOG version here on Mac OS X 10.11.4 with 0.60 B1 for what it's worth.\nEdit: Running on a Macbook Pro Retina 2014(11,3), 2.5Ghz i7, Intel Iris Pro/GT 750M\n. ",
    "roundowl": "Sorry, this was already reported.\n. ",
    "TatiGranger": "Humm them problem is I also did before,  I wonder if that is not saving aswell now. Did you try to change and save it? Did the changes to solve this problems were still on the new saved file? \n. ",
    "voodoo-burger": "I am also able to build on the portion of the floor you re-drew. It seems the issue is that you need to place the parcel first, and then the floor. The other way around doesn't work.\n. Thanks for the great effort guys!\n. This is what I did:\n- Placed helipad\n- Placed walkway to where the front door will be\n- Placed floor\n- Placed walls and doors\n- Drew parcel\nAs I said in #1044 the issue seems to be that you need to place the parcel first and then the floor.\n. ",
    "ciand": "Asisstant announces the death/increment the death total he announces; they appear in the casebook as a death and your total at year-end is incrememted. I didn't check if your reputation suffers yet.\n. Reputation appears to take a hit of -1 for each reported death although as you get a boost for the emergency in total you may still get an overall increase. \n. ",
    "sherief": "I strongly advocate for a heuristic. In the case where the game is running full-screen, and the machine has one screen attached, music should stop on focus loss. This should change on multimon systems based on @antibones's comment, since in his case it makes sense for it not to stop playing music or pause on focus loss.\n. Why? It's actually simpler than it sounds - you can just check whether your window is occluded or not. If it's occluded, mute music; if it's visible play music. Then add an override for this.\n. Dude, chillax, nothing is worth getting this riled about. I haven't looked at the code, but SDL 2 has window events that inform the app about window visibility and focus: https://wiki.libsdl.org/SDL_WindowEvent\nIf that doesn't work, I can offer a patch to SDL 2. If that still won't work, I can hook up something up internally using DXGI's DXGI_STATUS_OCCLUDED for Windows and NSWindowOcclusionState for OS X.\nIf the above pointers are insufficient, feel free to point me towards the code, but I currently have a good chunk of GPU code on my plate and it'll take me a while to ramp up with this code base.\n. Okay, valid concerns so far. Let me try to come up with a proposal considering all the points raised.\nLet's consider the following rule as the default option for music management:\n\"Any time the game window is fully occluded, mute the music.\"\nOf course, there should be an option exposed to the user controlling this, but for now I'm considering the default.\nThere are two cases to cover: single monitor and multi monitor.\nIn the single monitor case, I don't see an issue: if the player is in windowed mode it won't kick in unless they switch desktops, and if they're in fullscreen mode it won't kick in unless they switch to another process. Am I missing any cases here?\nIn the multi monitor case: If the user has the game partially or wholly visible on any monitor, this rule will keep the music playing, so you can get your TH on while browsing 9GAG or Twitter. Only when all screens have non-TH windows will this kick in, in which case I can't see it as an issue. \nAgain, this is my suggestion for the defaults - I totally agree that a toggle should be exposed to the user.\nWhat problems can you spot in this proposal?\n. FWIW, my proposal doesn't look at focus at all:\n\"Any time the game window is fully occluded, mute the music.\"\nonly occlusion. But it seems SDL2 doesn't handle occlusion properly and honestly, like you said, there's a zillion different window managers out there. What do people think as for ideas to make things work for OS X / Windows users while not giving Linux users the short end of the stick?\n. 2 seems to make the most sense to me - you?\n. Yes, of course as a user you'll be given a option to force 1 and 4 - I'm talking about the default in this case. I also don't want this to spiral into an over-complex monster. I think ultimately the options for audio should be:\n- Always on\n- Always off\n- On while visible\nI think separating things into three options for every sound type is just added complexity. \n. ",
    "zheega": "No, it was useless as well. Makes me mad every time :)\nSometimes it has as low as 1% of GP's visits.\n. ",
    "Tunaa": "my fps are very low. i want to allocate corsix more memory. usual this works always on my laptop\n. i am seaching for some configs. this works very well for me. but sadly ive found no config for corsixth where i can change the memory\n. ",
    "Scrabblebonce": "This was the last Autosave file, so I hope this one shows the issue for you\nAutosave12.zip\n. I will play a little more and see if it does the same error and report back\n. ",
    "viktorcech": "yes.. i have this issue too..\n. developers stop asking.. please, fix it\n. editing room is not a fix.. this is a bug.. then must be fixed .. source code..\n. im not a developer.. people how making this project must fixing bugs\n. ",
    "wyozi": "Here's a savegame where the bug happens (the operating room in upper right).\nhttp://fruitshake.wyozi.xyz:8080/f/oproombug.sav\n. ",
    "Viandante": "Damn, on git shell I couldn't find a way to make \"git commit --amend\" work, so I tried editing it here but it created another commit.\nShould I just close the request and make a new one?\n. When I tried to do that it picked also the changes made by Grimdoc.\nNow the terminal reads \"C:\\Users\\Viandante\\Documents\\GitHub\\CorsixTH [detached HEAD|REBASE-i +1 ~0 -0 !]>\", what do I do?\nI'd really like to commit it myself to learn a bit about this system. I thought a force push would be a sin, or at least that's what people say on stackOverflow and the likes! :)\n. Thank you, it seems sorted out now.\nI actually tried to create a branch called \"ITtranslation\" to work on but something went wrong along the way and changes went to master instead.\nI guess I'll have to study the system a bit more, I'm very interested in learning.\nIn the meantime, thanks for your help!\n. ",
    "robin110": "\"0.01\" is still too loud for music. It would be better if the sound instead of 1 a 10 would get. But that does not work.\nConclusion: Sound is too quiet, the music too loud.\nThe game is not playable with music.\n. ",
    "botcherO": "Have a look at VirtualMidiSynth: http://coolsoft.altervista.org/en/virtualmidisynth\nI use it to play the MIDIs with waaaaaay better Samples than the normal ones (like my old Ensoniq Soundscape ISA Card had in the Old Days), but it also has a Mixer with a Master Volume Controller usable from the Systray everytime a Midi Song is played. \nIt works with every game i played so far, including CorsixTh 0.60.\n. Sure, where do you want that in the wiki?\n. Sorry, that took a while. :)\nAdded it to the FAQ a minute ago.\n. ",
    "Brainsample": "Hi TheCycoONE,\nThank you, sleuthing is what I do best. Working with repositories not so much. :)\nSo I'll leave that to people with experience. In this case it's only five new lines of code, that's not too bad. Let's give the fix a good test, to see if there are any side effects. The workaround can be used to identify old cases of the bug, if necessary.\n. Hi Lewri,\nThanks for your playthrough. :)\nIt is doctor Manton who keeps the door of the X-ray room reserved, in this case. If you place doctor Manton in the X-ray room, and then place another doctor in the room, doctor Manton will have to leave. Doctor Manton is the only one who can use the door, so he'll just walk out, and everything will be back to normal.\nThe code-fix I proposed prevents this bug from happening, but unfortunately it doesn't solve the problem after it has happened. For that you have to find out which staffmember (always a doctor or a nurse) keeps the door reserved. If you feel up to it, you can apply the fix yourself with a text editor.\nPatients are asked to be patient!\n. Hi TheCycoONE,\nIt's true, every time I tried to work in a repository my head got dizzy, and dyslexia made me stop coding all together. I have what you can call a very specific skill set. :) However, I do want to share my work, so I'll try to set up a repo. Until then (or if I don't succeed) I will present my suggestions as comprehensible as possible.\nOn topic of the Pause overlay: The patch comes in very handy for testing purposes.\n. You're welcome. :)\n. Each time (room.lua line 98:)Room:createEnterAction(humanoid) is executed, a callback is registered, so the entity knows what to do in case the room is deactivated. That callback is erased when the entity safely enters the target-room in (room.lua line 291:)Room:onHumanoidEnter(humanoid)\nHowever, when a staffmember is rerouted before entering the room, the callback is not erased. Then, when you edit the old target-room, all its callbacks are executed in (room.lua line 927:)Room:deactivate(). This can make staffmembers meander when they're in an other room with a patient.\n\nI've added these debug lines to (app.lua line 1373:)App:afterLoad(), to show all registered callbacks for staffmembers after loading:\nlua\nfunction App:afterLoad()\n    for _, room in pairs(self.world.rooms) do -- Go through all rooms\n        print(room.room_info.id) -- Print the room type\n        for enroute, _ in pairs(room.humanoids_enroute) do -- Go through all registered callbacks\n            if enroute.profile then -- Only look at staffmembers\n                print(\"\\t\", enroute.profile.name) -- Print the staffmember's name\n            end\n        end\n    end\nNote: It looks like the staffroom never clears the callbacks in humanoids_enroute.\n\nI think the best way to fix this, is to clear the old callback each time a staffmember is rerouted.\nAnd also clean up the humanoids_enroute for all rooms in afterLoad() for savegame compatability.\n. Hi Lewri,\nYes, editing the staffroom must be the easiest way to reproduce the bug.\nI'm testing these lines of code, still misplaced in App:afterLoad().\nThe aim is to clean up all bad callbacks after loading a game:\n``` lua\nfunction App:afterLoad()\n  for , room in pairs(self.world.rooms) do -- Go through all rooms\n    for enroute, _ in pairs(room.humanoids_enroute) do -- Go through all registered callbacks\n      local clear_this_callback = true -- Presume the callback must be cleared\n      for , action in pairs(enroute.action_queue) do -- Go through the action queue\n        if action.name == \"walk\" then -- Only look at walk actions\n          if room == self.world:getRoom(action.x, action.y) and -- This walk action leads into the room\n              room ~= enroute:getRoom() then -- The entity is not already in the room\n            clear_this_callback = false -- Assume the callback is valid, don't clear\n          end\n        end\n      end\n      if clear_this_callback then room.humanoids_enroute[enroute] = nil end -- Clear if necessary\n    end\n  end\nprint(\"------------Check the results--------------\")\nfor _, room in pairs(self.world.rooms) do -- Go through all rooms\n      print(room.room_info.id) -- Print the room type\n      for enroute, _ in pairs(room.humanoids_enroute) do -- Go through all registered callbacks\n          if enroute.profile then \n              print(\"\\t\", enroute.profile.name) -- Print the staffmember's name\n            else\n              print(\"\\t\", enroute) -- Print the table index\n          end\n      end\n  end\n```\nIt also checks patients, and it seems to work well.\n. After some digging, I think there are three possible ways of fixing this.\n1) Do the bookkeeping as the game progresses, clearing the callback every time an entity changes its destination. That's not easy to do, and hard to maintain.\n2) Build a fresh humanoids_enroute every tick. It may seem blunt, but does have the advantage of knowing who goes where.\n3) Make humanoids_enroute obsolete, and change the action queue on the fly in the function Room:deactivate(). This function is the only place humanoids_enroute is actually used (apart from all the bookkeeping).\n\nI've experimented with all three options. The first one is torture, lol. Number 2 and 3 worked with some light testing. Let me clean up my code, and let you know tomorrow :)\n. For testing, I placed this cleaning loop in World:onTick(). It was a good test, and works as an \"if everything else fails\" solution, but it's not very elegant.\nlua\n  for _, room in pairs(self.rooms) do -- Go through all rooms\n    for enroute, _ in pairs(room.humanoids_enroute) do -- Go through all registered callbacks\n      local clear_this_callback = true -- Presume the callback must be cleared\n      for _, action in pairs(enroute.action_queue) do -- Go through the action queue\n        if action.name == \"walk\" then -- Only look at walk actions\n          if room == self:getRoom(action.x, action.y) then -- The action leads into the room\n            clear_this_callback = false -- Assume the callback is valid, don't clear\n          end\n        end\n      end\n      if clear_this_callback then \n        room.humanoids_enroute[enroute] = nil\n      end\n    end\n  end\nThen why not clean up humanoids_enroute just before it is used? That's much more efficient ... and it also makes humanoids_enroute obsolete, hehe. This new Room:deactivate() should give the functionality we want:\nlua\nfunction Room:deactivate()\n  self.is_active = false -- So that no more patients go to it.\n  self.world:notifyRoomRemoved(self)\n  for _, humanoid in pairs(self.world.entities) do -- Go through all entities\n    if humanoid.action_queue then\n      for _, action in pairs(humanoid.action_queue) do -- Go through the action queue\n        if action.name == \"walk\" then -- Only look at walk actions\n          if self == self.world:getRoom(action.x, action.y) then -- The action leads into the room\n            if class.is(humanoid, Patient) then\n              humanoid:setNextAction({name = \"seek_room\", room_type = self.room_info.id})\n            elseif class.is(humanoid, Vip) then\n              humanoid:setNextAction({name = \"idle\"})\n              humanoid.waiting = 1;\n            else -- For staffmembers\n              local current_room = humanoid:getRoom()\n              if current_room then -- In a room\n                if current_room.room_info.id == \"staff_room\" then\n                  humanoid:setNextAction({name = \"use_staffroom\"})\n                else -- Treatment / diagnosis / research\n                  self:commandEnteringStaff(humanoid)\n                end\n              else -- In the corridor\n                humanoid:setNextAction({name = \"meander\"})\n              end\n            end\n          end\n        end\n      end\n    end\n  end\nend\nYep, I was still able to make doctors meander in a room with a patient! So I added the different actions, depending on the staffmember's current location. Maybe something similar must be done for patients too.\n. Hi Lewri,\nYou help a lot by posting your findings here. :) Before the different actions depending on the doctor's current location were added, I made the doctor meander in a room by:\n- Find two nearby GP rooms with a doctor.\n- Make sure there are no nearby doctors in the corridor.\n- Wait for a patient to arrive in room A.\n- Pick up the doctor in room A, place him in the staffroom.\nObserve: The doctor in room B is now called to room A.\n- Before the doctor has left room B, edit room A.\n- Wait for a patient to arrive in room B.\nBug observed: Room B has a meandering doctor, and a patient.\nSo even when the doctor didn't act on some expired callback, it still went wrong.\nHaving the doctor take back command of room B fixes the meandering. But there are other options, like forcing the doctor to leave room B, and then meander in the corridor.\n. All walk-actions made by createEnterAction() have a field named \"is_entering\", it contains the destination room. Checking \"is_entering\" is more efficient than checking the room's coordinates.\nTo keep things simple and reliable, I've been testing the \"leave room and meander\" version. That should work for all staff & room combinations.\nWhen editing a room in CorsixTH 0.60, queueing patients don't stand up to find a new room. This behaviour makes sense: the user may just want to quickly move a machine.\nlua\nfunction Room:deactivate()\n  self.is_active = false -- So that no more patients go to it.\n  self.world:notifyRoomRemoved(self)\n  for _, humanoid in pairs(self.world.entities) do -- Go through all entities\n    if humanoid.action_queue then\n      local in_queue = false -- Presume a patient is not in the queue\n      for _, action in pairs(humanoid.action_queue) do -- Go through the action queue\n        if action.name == \"queue\" and self.door == action.reserve_when_done then \n          in_queue = true -- A patient is in this room's door queue\n        elseif self == action.is_entering then -- A walk action leads into this room\n          if class.is(humanoid, Patient) then\n            if not in_queue then\n              humanoid:setNextAction({name = \"seek_room\", room_type = self.room_info.id})\n            end\n          elseif class.is(humanoid, Vip) then\n            humanoid:setNextAction({name = \"idle\"})\n            humanoid.waiting = 1;\n          else -- For staffmembers\n            if humanoid:getRoom() then -- In a room\n              if humanoid ~= self.door.user then -- Don't disturb the door animation\n                humanoid:setNextAction(self:createLeaveAction())\n                humanoid:queueAction({name = \"meander\"})\n              end\n            else -- In the corridor\n              humanoid:setNextAction({name = \"meander\"})\n            end\n          end\n        end\n      end\n    end\n  end\nend\nTest plan: Try to disrupt your hospital in every possible way, by editing or crashing rooms.\n. Hi Lewri,\nHmmm, did you get that error by rebuilding the GP offices one by one, or all together?\nIt does looks like this is a different problem, deserving its own bug report.\n\nBy the way, if you want to help test the new function I made, here are some simple steps. No coding skills required. :) The first step is optional.\n- Google, download and install \"notepad++\" , it is an excellent text editor.\n- Install CorsixTH for a second time, but not in the folder \"Program Files\", or windows will annoy you to pieces.\n- In your new installation folder, find and open the file \"..\\lua\\room.lua\" in notepad++\n- Find the function \"Room:deactivate()\"\n- Using the magic power of copy and paste, replace the original function with the block of code from my previous comment.\n- Save the file, start your test-client.\nThis won't affect your original installation of CorsixTH at all. Just remember that saved games made with an altered client may not be compatible with the official version. It's always a good idea to save those games with a name like \"test 1104\" , so you can tell them apart.\n. Hi Maugsburger,\nThanks for your report. Running your \"autosave6.sav\" some strange things can be seen. A handyman sometimes walks through the wall (the tile just to the right of the door) into the toiletroom. Then sometimes the handyman tries to walk the same way back through the wall. This causes either a crash or a \"Warning: Humanoid leaving a room that they are not in\"\nThe handymen don't have anything to do in the toiletroom, they just seem to meander in and out. The patient in the toiletroom never moves, despite having an action queue.\nWhen you place a plant outside the toiletroom (blocking the path through the wall) the game doesn't crash, but the toiletroom remains unusable.\n. As it turns out, this is easy to fix.\nHere is the point where the cure just has been guessed:\nCorsixTH v0.6 seek_room.lua line 177:\nlua\n    humanoid:setDiagnosed(true)\n    if humanoid:agreesToPay(humanoid.disease.id) then\n      humanoid:queueAction({\n        name = \"seek_room\",\n        room_type = humanoid.disease.treatment_rooms[1],\n        treatment_room = true,\n      }, 1)\n    else\n      humanoid:goHome(\"over_priced\", humanoid.disease.id)\n    end\nThe goHome() branch already cleans all callbacks.\nAll that's needed is a clean up line in the agreesToPay() branch:\nlua\n    humanoid:setDiagnosed(true)\n    if humanoid:agreesToPay(humanoid.disease.id) then\n      humanoid:unregisterRoomBuildCallback(action.build_callback)\n      humanoid:queueAction({\n        name = \"seek_room\",\n        room_type = humanoid.disease.treatment_rooms[1],\n        treatment_room = true,\n      }, 1)\n    else\n      humanoid:goHome(\"over_priced\", humanoid.disease.id)\n    end\nAnd the patient will keep walking towards the treatment room.\n. Indeed, those callbacks quickly turn into a maze.\n``` lua\n        print(room.room_info.id, action.room_type, action.room_type_needed) -- Debug line\n        local found = false\n        if room.room_info.id == action.room_type then\n          found = true\n        elseif room.room_info.id == action.room_type_needed then\n      -- So the room that we're going to is not actually the room we waited for to be built.\n      -- Example: Will go to ward, but is waiting for the operating theatre.\n      -- Clean up and start over to find the room we actually want to go to.\n      TheApp.ui.bottom_panel:removeMessage(humanoid)\n      humanoid:unregisterRoomBuildCallback(build_callback)\n      humanoid:unregisterRoomRemoveCallback(remove_callback)\n\n```\nThe output of this added debug line is: general_diag  general_diag nil\nSo the cleanup lines are never executed, in this case.\n\nUnregistering the remove_callback as well seems like a good idea.\nHowever, when we do that we get a warning:\nlua\n    humanoid:setDiagnosed(true)\n    humanoid:unregisterRoomBuildCallback(action.build_callback)\n    humanoid:unregisterRoomBuildCallback(action.remove_callback)\n    if humanoid:agreesToPay(humanoid.disease.id) then\n      humanoid:queueAction({\n        name = \"seek_room\",\n        room_type = humanoid.disease.treatment_rooms[1],\n        treatment_room = true,\n      }, 1)\n\"Warning: Trying to remove nonexistant room build callback(function: 0D9EF088) from humanoid (table: 0B974CB0)\"\n. Aha, the problem with unregistering the remove_callback was that I used the wrong function!\nThis doesn't show a warning:\nlua\n    humanoid:unregisterRoomBuildCallback(action.build_callback)\n    humanoid:unregisterRoomRemoveCallback(action.remove_callback)\nThe absence of a warning must mean that something is being removed. :)\n. Hi TheCycoONE, \nAnd thank you too!\nUnfortunately the code in this pull request is not correct. :)\nIt uses:\nlua\n      self.staff_member:setMood(\"idea3\", \"deactivate\")\n      self.staff_member:setMood(\"reflexion\", \"deactivate\")\nBut that just deactivates the mood of the same entity we did before.\nIt should be:\nlua\n      staff:setMood(\"idea3\", \"deactivate\")\n      staff:setMood(\"reflexion\", \"deactivate\")\nSo everyone's idea3/reflexion gets deactivated.\n. That's got it! :)\nThanks again.\n. Don't forget Alberth's essential contribution ;)\n. Aha, good thing I checked in.\nI have code that works like this:\n\nPatients can only be admitted to the ward when a nurse is present.\nThe progress of treatment/diagnosis depends on the number of patients and the number of nurses in real time.\nNo nurse means no progress, but the patients do not have to leave the ward.\nThe best nurse affects diagnosis quality.\n\nThe main code is in \\Lua\\rooms\\ward.lua\n```lua\n-- This function is called once per tick per ward, unless there's no patient in the ward\nfunction WardRoom:getHealingAmount()\n    self.patient_idx = 0 -- Will be reset to nil after handling the last patient each tick\n    local nurse_force = 0   -- The total amount of work the nurses do\n    local best_staff = 0 -- Used for diagnosis quality\n    for humanoid in pairs(self.humanoids) do\n        if not humanoid:isLeaving() then\n            if class.is(humanoid, Patient) then\n                self.patient_idx = self.patient_idx + 1 -- Count the number of patients\n            elseif humanoid.humanoid_class == \"Nurse\" then\n                local nurse_quality = humanoid:getServiceQuality()\n                nurse_force = nurse_force + 1.0 + nurse_quality\n                if nurse_quality > best_staff then\n                    best_staff = nurse_quality\n                    self.staff_member = humanoid -- Used in \\patient.lua\\completeDiagnosticStep()\n                end\n            end\n        end\n    end\n    self.healing_amount = nurse_force / (1 + self.patient_idx)\nend\nfunction WardRoom:commandEnteringPatient(patient)\n  local bed, pat_x, pat_y = self.world:findFreeObjectNearToUse(patient, \"bed\")\n  self:setStaffMembersAttribute(\"dealing_with_patient\", nil)\n  if not bed then\n    patient:setNextAction(self:createLeaveAction())\n    patient:queueAction(self:createEnterAction(patient))\n    print(\"Warning: A patient was called into the ward even though there are no free beds.\")\n  else\n    bed.reserved_for = patient\n    local amount_to_heal = math.random(150, 450)\n    local --[[persistable:ward_loop_callback]] function loop_callback(action)\n            if not self.patient_idx then -- This is the first patient for the current tick\n                self:getHealingAmount() -- Evaluate the workload\n            end\n            --print(self.patient_idx, self.healing_amount, amount_to_heal)\n            amount_to_heal = amount_to_heal - self.healing_amount\n            if amount_to_heal < 0 then -- The patient is healed or diagnosed\n                action.prolonged_usage = false\n            end\n            if self.patient_idx == 1 then -- This was the last patient, set up for the next tick\n                self.patient_idx = nil -- Erase the temporary field\n            else -- Set up for the next patient\n                self.patient_idx = self.patient_idx - 1\n            end\n    end\n    local after_use = --[[persistable:ward_after_use]] function() self:dealtWithPatient(patient) end\n    patient:walkTo(pat_x, pat_y)\n    patient:queueAction{\n      name = \"use_object\",\n      object = bed,\n      prolonged_usage = true,\n      loop_callback = loop_callback,\n      after_use = after_use\n        }\n  end\n  return Room.commandEnteringPatient(self, patient)\nend\nfunction WardRoom:shouldHavePatientReenter(patient)\n  return false\nend\n```\nBut changes are necessary in \\Lua\\room.lua\nThe original function shouldHavePatientReenter() never actually did what its name suggested, and doesn't work.\n```lua\nfunction Room:onHumanoidLeave(humanoid)\n  if self.staff_member == humanoid then\n    self.staff_member = nil\n  end\n  humanoid.in_room = nil\n  if not self.humanoids[humanoid] then\n    print(\"Warning: Humanoid leaving a room that they are not in\")\n    return\n  end\n  self.humanoids[humanoid] = nil\n  local staff_leaving = false\n  if class.is(humanoid, Patient) then\n    -- Some staff member in the room might be waiting to get to the staffroom.\n    for humanoid in pairs(self.humanoids) do\n      -- A patient leaving allows doctors/nurses inside to go to staffroom, if needed\n      -- In a rare case a handyman that just decided he wants to go to the staffroom\n      -- could be in the room at the same time as a patient leaves.\n      if class.is(humanoid, Staff) and humanoid.humanoid_class ~= \"Handyman\" then\n        if humanoid.staffroom_needed then\n          humanoid.staffroom_needed = nil\n          humanoid:goToStaffRoom()\n          staff_leaving = true\n          self.staff_member = nil\n        end\n      end\n    end\n    -- There might be other similar rooms with patients queueing\n    if self.door.queue and self.door.queue:reportedSize() == 0 then\n      self:tryToFindNearbyPatients()\n    end\n  end\n  if not staff_leaving then\n    self:tryAdvanceQueue()\n  else\n    -- Staff is leaving. If there is still a need for this room (people are in the queue) then call\n    -- someone new.\n    if self.active and self.door.queue:patientSize() > 0 then\n      -- This call might not be effective, if the doctor last action is\n      -- walking/must_happen but is_leaving not set (psych likes to walk around in the room)\n      -- hence testStaffCriteria still pass.\n      -- This is guarded by onHumanoidLeave(Staff)\n      self.world.dispatcher:callForStaff(self)\n    end\n  end\n  if class.is(humanoid, Staff) then\n    if humanoid.waiting_on_other_staff then\n      humanoid.waiting_on_other_staff = nil\n      self.dealt_patient_callback = nil\n    end\n    -- Make patients leave the room if there is no longer enough staff\n    if not self:testStaffCriteria(self:getRequiredStaffCriteria()) then\n      -- This room does not meet the minimum staff requirements\n      local call_for_new_staff = false\n            for humanoid in pairs(self.humanoids) do\n                if class.is(humanoid, Patient) and not humanoid:hasLeavingAction() then\n                    -- There is a patient in the room\n                    call_for_new_staff = true\n                    if self:shouldHavePatientReenter(humanoid) then\n                        -- This type of room needs patients to re-enter\n                        self:makeHumanoidLeave(humanoid)\n                        humanoid:queueAction(self:createEnterAction(humanoid))\n                    end\n                end\n            end\n      -- Call for staff if needed\n      if self.is_active and (call_for_new_staff or self.door.queue:patientSize() > 0) then\n        self.world.dispatcher:callForStaff(self)\n      end\n    end\n    -- Remove any unwanted moods the staff member might have\n    humanoid:setMood(\"staff_wait\", \"deactivate\")\n  end\n  -- The player might be waiting to edit this room\n  if not self.is_active then\n    local i = 0\n    for humanoid in pairs(self.humanoids) do\n      i = i + 1\n    end\n    if i == 0 then\n      local ui = self.world.ui\n      ui:addWindow(UIEditRoom(ui, self))\n      ui:setCursor(ui.default_cursor)\n    end\n  end\nend\nfunction Room:shouldHavePatientReenter(patient) -- Sets the default value\n  return true\nend\n```\nAnd finally, the function \\Lua\\entities\\staff.lua getServiceQuality()\nIf I remember correctly, the function is currently not used.\nThe fatigue_weight works the wrong way around. :)\nThat's easy to fix:\n```lua\nfunction Staff:getServiceQuality()\n  -- weights\n  local skill_weight = 0.7\n  local fatigue_weight = 0.2\n  local happiness_weight = 0.1\nlocal weighted_skill = skill_weight * self.profile.skill\n  local weighted_fatigue = fatigue_weight * (1 - self.attributes[\"fatigue\"])\n  local weighted_happiness = happiness_weight * self.attributes[\"happiness\"]\nreturn weighted_skill + weighted_fatigue + weighted_happiness\nend\n```\nSorry for my crude bundled up way of posting.\nThe code is tested, give it a try :)\n. Hi Mugmuggy,\nThere are several things to consider. Currently in CorsixTH, all patients are magically cured when the last nurse exits the room, which is an easy exploit. It looks like in the original game, a nurse only had to be present when a patient is admitted, which is also a bit of an exploit. Possibly the original coders had to settle for this behaviour because time ran out, the game had to be released.\nRealism in computer games is one thing, but it doesn't always make for balanced gameplay. Personally, I just wanted intuitive and interesting gameplay, rewarding the player for playing well.\n=======\nIt's easy to tweak the behaviour of this code:\n\n\nMake (some) progress when no nurse is present.\nInitialize nurse_force with a positive value\nlua\nlocal nurse_force = 1.0 -- The total amount of work the nurses do\n\n\nAdjust the effect of the number of nurses.\nChange numerical value \nlua\nnurse_force = nurse_force + 0.12345 + nurse_quality\n\n\nAdjust the effect of service quality.\nAdd a multiplier\nlua\nnurse_force = nurse_force + 1.0 + nurse_quality * 0.12345\n\n\nAdjust the effect of number of patients.\nAdd a multiplier\nlua\nself.healing_amount = nurse_force / (1 + self.patient_idx * 0.12345)\n\n\nChange the base time (and spread) for a patient to stay in bed.\nlua\nlocal amount_to_heal = math.random(1234, 5678)\n\n\nRemove the effect of diagnosis quality.\nDelete the 5 lines involving the variable \"best_staff\".\n\n\n=======\nToday I did a test with very long healing times in CorsixTH. A tired nurse will not go to rest when there are patients in the ward. So I looked it up, and found another change in my code.\nIt's in \\Lua\\entities\\staff.lua Staff:checkIfNeedRest() line 582:\nlua\nif (self.staffroom_needed and (room and (not room:getPatient() or room.room_info.id == \"ward\")) or not room) or (room and self.going_to_staffroom) then\nThe ward is the only room for which this exception applies.\n=======\nCurrently in CorsixTH, when the last nurse exits the ward while there's a patient, the callsdispatcher calls a new nurse to the ward. This behaviour is correct, in my opinion.\n. Hmmm, so that would mean nurses completely ignore patients once they're in bed?\nThat's not very elaborate. :). Thank you for the clarification, the behaviour you describe makes perfect sense. \nThe code I wrote produces this behaviour, but it does so every tick, not every hour.\nCPU load is minimal.\n=======\nThe function shouldHavePatientReenter() can be repaired, but it can also be removed.\nSince the ward is the only room that works like this, the exception can be hardcoded in\n\\Lua\\room.lua onHumanoidLeave()\nlua\n    -- Make patients leave the room if there is no longer enough staff\n    if not self:testStaffCriteria(self:getRequiredStaffCriteria()) then\n      local call_for_new_staff = false\n      for room_humanoid in pairs(self.humanoids) do\n        if class.is(room_humanoid, Patient) and not room_humanoid:hasLeavingAction() then\n          call_for_new_staff = true\n          if self.room_info.id ~= \"ward\" then\n            self:makeHumanoidLeave(room_humanoid)\n            room_humanoid:queueAction(self:createEnterAction(room_humanoid))\n          end\n        end\n      end\n      -- Call for staff if needed\n      if self.is_active and (call_for_new_staff or self.door.queue:patientSize() > 0) then\n        self.world.dispatcher:callForStaff(self)\n      end\n    end\nThis part of onHumanoidLeave() had to be fixed anyway.. That's a good point!\nIt was easy to test, game speed did not affect the rate of progress.\n=======\nThe code is also savegame compatible, though patients who are saved in bed will still behave in the old way.\nIt's not a real problem.. If people want to test this new ward, the attached file \"ward_basics.zip\" contains the necessary files.\nJust copy the the Lua folder into a clean installation of CorsixTH v0.61, and confirm all prompts.\nward_basics.zip\n. When idling is random, there can be two or more consecutive walk actions, which looks 'bouncy'.\nYou wouldn't notice two consecutive idle actions, of course. :)\nBut alternating idle and walk actions are never bouncy, still the doctors look busy and alive.\nIt's subjective, maybe some people even like the bounciness?\nGive it a try, I think you will like it. :). Hmmm, I think I know what you mean.\nThis seems work just as well:\nlua\n  humanoid:queueAction(IdleAction():setCount(math.random(5, 40)):setMustHappen(action.must_happen), 0)\n  humanoid:queueAction(WalkAction(x, y):setMustHappen(action.must_happen), 1). Ok, queuing up both idle and walk at the same time doesn't work that well.\nThe field \"can_idle\" is used to clear the area when you build a room.\nWithout \"can_idle\", you have to wait for the next walk action.\nBut the code in the original post makes them walk away immediately.. Of course I made a mess, and I couldn't find a way to correct it.\nThese things happen when you use software for the first time, right? :)\nCan you ignore the unrelated patch, or should I start from scratch?. Great help, thank you very much. :). ",
    "edsilmon": "Could this be a similar issue to the people stuck in the toilets issue (/catastrophe)?. @OP Only the level config needs editing to give all researched illnesses and machines. Also the win conditions, availability of staff (good/bad) and a bunch of other things are soley based on the (editable) .level config file unless they're set for random. \nI find 10 reception desks works well in biggen btw until the GP queue (train) gets larger than 30 people :D \nWhat would also be good in that level is if there were more doors per room as large parts of the hospital are blocked from others - if you cram rooms in all the space - due to the corridors being only 4 wide though they need only be widened in the editor I guess. . This is an explanation of the .level file setup >> https://github.com/CorsixTH/CorsixTH/wiki/Custom-Levels\nBe wary of making a giant hospital as the handymen and other spare staff tend to disappear off into the corners unless you make a giant pointless room like a massive toilet to fill in the gap while you build up your hospital rooms (this does work).... I prefer to let the game put doctors in my rooms - which it usually does - but I suppose that is my preference. I also tend to put more smaller staff rooms around the hospital so a rested staff member can go straight there from work and back to work quite quickly by themselves. I understand the \"wow factor\" of having such a large ward (40+beds) but all those patients (and staff) all have to come in and out of the same door so will inevitably end up forming huge queues, either inside the ward to get out or outside the ward to get in. \nI have a save game in a large map (dalhem - i may have included a dropbox link to it and a save file) [ https://www.dropbox.com/sh/p5ctc00ydg177y8/AABlgAzqFIqVHtFzzv6mhkWla?dl=0 ] with one entrance to the hospital and it currently has about 20 GP rooms; at one point I had over 100 doctors until they were adequately trained and I reduced their numbers. I also have 10 reception desks as without them the patients queue out of the front doors! when I last tried I couldn't finish the level as the constant epidemics kept lowering my reputation when I failed to cure them. I have edited the .level file to include a custom template I made for myself (On my computer I have several glitched members of staff who are frozen and never leave! I also had serious problems with patients stuck in the toilets and kept reloading from before and changing the internal layout in the hope it would stop the glitches...).\nThe game has some limitations in the way it runs and giant rooms may take much more time (maybe too much time) for the patients to use; this probably compares to hospitals of today where they usually have small bays of up to a dozen patients cared for by a couple of staff members. This is a game, of course, though!. @overlordchaos I suggest you test it with default numbers and adjust it after you start; that method will mean you are completely happy with the settings. Nobody but you can configure the level to make you happy.. > edit: In fact you can delete that whole column of numbers if you also delete the .MaxDiagDiff part of the line on the left - then it will use the game defaults.\n@TheCycoONE Corsix will use the default settings from the 00.SAM Theme Hospital LEVEL files?. MaxDiagDiff is not for whether the disease is available at the beginning. It is to set how much effort the disease takes to diagnose. \nTo set a disease so it doesn't need research Known should be 1\nThis page explains it ... https://github.com/sydlawrence/CorsixTH-HTML5-Port/blob/master/source/CorsixTH/Levels/example.level\n\nThe following table contains all diagnoses and treatments that shows up in the drug casebook\nin the game. Known specifies whether it should show up from the beginning of the level and\nRschReqd how much research is required to discover the treatment room for the disease, MaxDiagDiff is how hard it is to diagnose (don't apply to diag rooms).\nexpertise[1].Known.RschReqd 1 0 GENERAL_PRACTICE\nexpertise[2].Known.RschReqd.MaxDiagDiff 1 40000 500 BLOATY_HEAD.\n",
    "bendyson": "Would you mind giving a quick description of what 'Parcels' are please? I've had a read through the PRs and googled but couldn't find anything. Not going to learn if I don't ask :)\n. Brilliant, thanks for this! Just tried this and it's crashing instantly for me.\nFollowing on from what @TheCycoONE said, it does appear that the dylib files aren't included. \nHere's the exact error message:\nApplication Specific Information:\ndyld: launch, loading dependent libraries\nDyld Error Message:\n  Library not loaded: /usr/local/opt/sdl2/lib/libSDL2-2.0.0.dylib\n  Referenced from: /Applications/CorsixTH.app/Contents/MacOS/CorsixTH\n  Reason: image not found\nBinary Images:\n    0x7fff61c08000 -     0x7fff61c3f007  dyld (360.19) <9D05FDF4-65CE-3B53-86D4-ABE1A5BF35F3> /usr/lib/dyld\n. ",
    "grote": "When I change check_for_updates to false in config.txt, the game starts without crashing.\n. ",
    "ecrips": "The problem seems to be caused by a patch carried by Debian, see my analysis in the luasocket issue. I've also commented on the Debian bug.\n. I added documentation comments to the two new functions added, and I realised that I'd unnecessarily duplicated the changeResolution function in game_ui.lua so removed that.\n. I've made a new commit which resizes the video dynamically per frame.\n. I've added another commit which calculates and enforces a minimum zoom on resolution change. Hopefully that will prevent the view being too zoomed out when resizing.\n. I've squashed the commits together and rebased onto the latest master\n. Sorry - I didn't realise there were also dummy functions for when videos were disabled\n. From what I can tell adjustZoom relies on setZoom failing to limit zooming out (it does provide the maximum zoom as a 'virtual width' of 200). setZoom fails when makeVisibleDiamond returns a negative width or height. The logic in calculateMinimumZoom simply working out when the width/height would be 0.\nUnfortunately having testing this a bit more I've found that it is still possible to trigger the behaviour where scrolling/zooming doesn't work in some cases. I believe this is due to floating point precision issues, so I've added a small tolerance in onChangeResolution to hopefully avoid this (I haven't been able to reproduce the problem with that in). Let me know if you've got a better idea for how to solve that!\nPS. Thanks for spotting the print I left in for debugging in the previous commit\n. I've moved the tolerance to the calculateMinimumZoom function as you suggested\n. ",
    "Karlstens": "Howdy TheCycoONE, \nWhere is the gamelog.txt located? I had a look within the install directory and under appdata, but couldn't find a gamelog.txt file.\n. I see. The crash is a freeze crash as such, after seeing some wonky business with a floaty head patient. I don't believe the file has been created. Does the save game file crash for you?\n. ",
    "evinx": "ah thanks keep up the good work love it :+1: \n. ",
    "maugsburger": "\nDo you have an autosave of before the woman enters the toiletroom? Looks like something has broken earlier than autosave 6, which could contribute to the handyman walking through the wall.\n\nYes, I added the additional save files into the Dropbox folder. The order according to my local timestamps is 11-12-1-2-...\n. ",
    "nickstar1234": "try not to keep the toilet to close to the sink, when i build a rest room, i tend to leave a gap between sink and the toilet. hope that helps\n. Exactly alberth289346\n. ",
    "spinktvis": "Hi Albert, after trying the latest AppVeyor build i discovered that there is a double colon on line 56 of multi_use_object.lua. After removing it it is running fine. \n+function MultiUseObjectAction::setLayer3(layer3)\n. ",
    "maki-chan": "@TheCycoONE Thank you very much, will try the patches from #1016 tomorrow as soon as I get up (already late here) and will upload again as soon as possible.\nI have OSX natively and additionally as a VM set up only for future CorsixTH development (the latter one has OSX 10.8 for compatibility reasons on builds), so I hope I can help developing for OSX.\n. I pulled #1016 over the b6fc9f9e0c6893720200088d21da4e2e14f0d319 commit (which is v0.60) and built it again with the dist target (additionally to the CorsixTH target) and that copied over the necessary dylibs (hopefully all of them).\n@bendyson Could you have a look at it again? The link is the same, this one.\n. They are in the Contents/MacOS/luarocks/share/lua/5.3 subfolder of the application (and that should be exactly where they have to bee, as libraries and scripts are searched for in the Contents/MacOS folder.\nEDIT: If you think of .so files instead of .lua files, I don't think they exist for OSX systems. Neither my development machine on 10.8, nor my Macbook with 10.11 have compiled libraries for lfs, luasocket and lpeg, only the .lua files that are included in the subfolder mentioned above.\n. You are right, totally forgot about the C extensions behind those Lua packages.\nI already mentioned it in the pull request #1016 \nIt seems that the osx_luarocks script had no copy commands for those libraries. After the additional commands I mentioned there, the libraries are now copied and I hope that now we have everything in the OSX .app bundle.\n@bendyson Sorry to mention you again, but if you tried the last upload, you should try it now again. Sorry for the inconvenience. The link has not changed once again, and is still here.\n. @joewestcott Great to hear :)\n@tobylane What do you mean with building for an older architecture? It's not possible for you to compile for 10.8 because you are on 10.9 or higher, or what do you mean exactly?\n. And one final note from my humble self: I didn't know there was a project like OpenRCT, I love the old RCT games. At least, it brought my attention to those projects ;)\n. Missing copy command for libraries here, should also have something like:\ncp -R \"$dir/lib/lua/$lua\" luarocks/lib/lua/\nas the path luarocks/lib/lua was defined for the various needed Lua packages in the package.cpath variable.\nEDIT: Obviously, we also need a mkdir -p luarocks/lib/lua before we copy those files.\n. ",
    "tomyun": "Not sure how much it could add to this conversation, but just wanted to notify that Homebrew recently got a formula for CorsixTH: Homebrew/homebrew-games#645\nYou can install the latest version (0.60) by typing brew install homebrew/games/corsixth. Hope this help out some users building/running CorsixTH on Mac.\n. ",
    "jrussek": "Hey there,\nany of the files in this thread crash for me shortly after starting up (when it starts loading the game). The report says:\nDyld Error Message:\n  Symbol not found: _sws_getCachedContext\n  Referenced from: /Users/USER/Downloads/CorsixTH.app/Contents/MacOS/CorsixTH\n  Expected in: /Users/USER/Downloads/CorsixTH.app/Contents/MacOS/libswscale.dylib\n(edited: Actually the brew version worked for me)\n. ",
    "rreina": "\n@tomyun \nNot sure how much it could add to this conversation, but just wanted to notify that Homebrew recently got a formula for CorsixTH: Homebrew/homebrew-games#645\n\nUsing this Homebrew formula worked for me in macOS Sierra 10.12.2. Thanks!\nI had to do the following to compile CorsixTH:\n1. Update brew:\nbrew update\n2. Install required dependencies:\nbrew install lua\nsudo luarocks install lpeg\nsudo luarocks install luafilesystem\n3. Execute the brew install command:\nbrew install homebrew/games/corsixth. ",
    "gakera": "The instructions in this thread and in the release notes as well (https://github.com/CorsixTH/CorsixTH/releases/tag/v0.60) seem to be depricated, when I do\nbrew install homebrew/games/corsixth\nI get: Warning: Use corsixth instead of deprecated homebrew/games/corsixth. ",
    "JohnnyWalkerDesign": "Hi, I'm running 10.12.5 and when I finally point to the game directory (which took a while because it the file window kept not responding) I got this error message:\nError loading languages/brazilian_portuguese.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/brazilian_portuguese.lua: Too many open files\nError loading languages/czech.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/czech.lua: Too many open files\nError loading languages/danish.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/danish.lua: Too many open files\nError loading languages/developer.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/developer.lua: Too many open files\nError loading languages/dutch.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/dutch.lua: Too many open files\nError loading languages/english.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/english.lua: Too many open files\nError loading languages/finnish.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/finnish.lua: Too many open files\nError loading languages/french.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/french.lua: Too many open files\nError loading languages/german.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/german.lua: Too many open files\nError loading languages/hungarian.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/hungarian.lua: Too many open files\nError loading languages/iberic_portuguese.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/iberic_portuguese.lua: Too many open files\nError loading languages/italian.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/italian.lua: Too many open files\nError loading languages/korean.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/korean.lua: Too many open files\nError loading languages/norwegian.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/norwegian.lua: Too many open files\nError loading languages/original_strings.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/original_strings.lua: Too many open files\nError loading languages/polish.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/polish.lua: Too many open files\nError loading languages/russian.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/russian.lua: Too many open files\nError loading languages/simplified_chinese.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/simplified_chinese.lua: Too many open files\nError loading languages/spanish.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/spanish.lua: Too many open files\nError loading languages/swedish.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/swedish.lua: Too many open files\nError loading languages/traditional_chinese.lua:\n/usr/local/Cellar/corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/languages/traditional_chinese.lua: Too many open files\nLanguage 'english' could not be found. Reverting to English.\nAn error has occurred in CorsixTH:\n...sixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/strings.lua:305: Language 'English' could not be found. Please verify your installation.\nstack traceback:\n    [C]: in function 'error'\n    ...sixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/strings.lua:305: in function '_loadPrivate'\n    ...sixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/strings.lua:279: in function 'load'\n    .../corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/app.lua:407: in function 'initLanguage'\n    .../corsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/app.lua:229: in function 'init'\n    ...corsixth/0.60_1/CorsixTH.app/Contents/MacOS/CorsixTH.lua:133: in main chunk\n    [C]: in ?\n...orsixth/0.60_1/CorsixTH.app/Contents/MacOS/Lua/audio.lua:674: attempt to index field 'ui' (a nil value)\nHope it helps!. Yes, you're right, it did. . ",
    "Thorworx": "Any chance of getting a .dmg that will mount on El Cap?\n\nThe following disk images couldn't be opened\nCorsixTH.0.62.dmg\nReason: no mountable file systems. > Let me look into creating a .dmg with HFS+ support - it hopefully shouldn't take too much to force High Sierra to create that.\n\nThanx Colin, much appreciated.\nWorse case scenario, can the .app just be zipped up for downloading? It seems like the APFS .dmg thing would be a serious artificial minimum system requirement.\n. > Please can you try this one?\nLaunching via GUI:\n\"Requires 10.13 or newer.\"\nHowever, I was able to launch from within the app using terminal.\nI got the CorsixTH GUI setup window, but was not able to select my Theme Hospital.app (GoG version) in the selector screen. Highlighting it and clicking okay does nothing. No error.. just nothing.\nSo I tried moving the resources out of original Theme Hospital.app figuring I'd be able to select that folder, but then I got a lot of errors: Error while fetching children for /Applications/... \"too many open files\"\n... then:\n```\nRunning: The buttonup handler.\nA stack trace is included below, and the handler has been disconnected.\n/Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:897: attempt to index a nil value (local 'fi')\nstack traceback:\n    /Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:897: in method 'saveConfig'\n    /Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:1395: in method 'exit'\n    .../Resources//Lua/dialogs/resizables/directory_browser.lua:188: in local 'callback'\n    ...ications/CorsixTH.app/Contents/Resources//Lua/window.lua:682: in method 'handleClick'\n    ...ications/CorsixTH.app/Contents/Resources//Lua/window.lua:1478: in method 'onMouseUp'\n    ...ications/CorsixTH.app/Contents/Resources//Lua/window.lua:1462: in field 'onMouseUp'\n    /Applications/CorsixTH.app/Contents/Resources//Lua/ui.lua:654: in function \n    (...tail calls...)\n    /Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:915: in function \nWarning: No event handler for buttonup\n```\nSo I then downloaded the Demo, and put the HOSP folder in Applications.\nGot to the setup/selector but could not choose the HOSP folder. No error, just no response from choosing/clicking okay.\nEDIT: I guess you don't really need to spend any more time on this... I can try building it on El Cap at some point. I just figured it would be easier to grab the app if it had already been done.\n. Hmm... no, I didn't dig into the .boxer package.. I'll give that a try.\nAlso, I keep all my games in a folder in /Applications\nThis is a problem for the CorsixTH.app\nMinor issue, but thought I'd mention it.\nEDIT: C.harddisk didn't work. Still can't select anything in the selector. Can only highlight. OK button does nothing, can only click the exit button.\n . Looks like this is gonna work.\nNotes:\nFirst launch from GUI, it locked up when opening /Applications in the selector. Had to force quit (with the cursor locked in the window, this needs to be done via keyboard - which is a bit odd force quit behavior)\nSecond launch.. tried choosing /Applications/HOSP folder from the demo download. Did not work. Could not click OK.\nHowever, using the selector, I WAS able to dig down into the GoG app, and get to the:\n/Theme Hospital.app/Contents/Resources/game/Theme Hospital.app/Contents/Resources/Theme Hospital.boxer/C.harddisk\nfolder and select it (this might need to be explained in a Read Me file - without our conversation, I'm not sure I would've found this). So far, game seems to run fine. I'll try out the app and options, editor, etc.\nThanks for your work on this!\n. I haven't noticed this in the save dialog, but it looks like this same/similar issue is a huge problem when trying to enter a custom resolution.\nIt was impossible to enter 1440 for my height (2560x1440 should be in the list of resolutions, imo). Arrow keys for cursor movement and forward delete keys do NOT behave as expected in the resolution height text box.. I did not remap any keys at all, or change any settings.\nOn first launch of game, first thing I did was went to settings to set resolution.\nCursor position and key behavior is just very strange in height and width boxes.. ",
    "katastic": "One last note. The final screen in the image doesn't indicate the proper FPS for the last zoom because the screenshot was taken quickly. If left zoomed out, the average FPS goes between 2 and 5. If fullscreened at 1080p, it goes down to 1.\n. OH GOSH DARN IT.\nI had both githubs open and posted to the wrong one.\nI can't stop laughing at myself.\n. That being said, it's a valid report for a game, and I expect changes soon.\n. I was joking. Have a good night.\n. ",
    "willsv": "What he is referring to is to the screen movement, which is not quite the same as I was saying.\nWhen I say \"strong\" i mean in the way it affects the machines and how they wipe out half my rooms, and not just screen movement.\n. Makes sense, thanks!\n. ",
    "Tristesseract": "Hi,\nEggsenham Level 10 should not have earthquakes. I ran 25 years of game time on the gog version to confirm.\nThanks. ",
    "mmcnicholas47": "I did install that as well - or at least I think I did. Should I reinstall it and see If that does the trick?\n\nOn Oct 2, 2016, at 1:19 AM, wolfy1339 notifications@github.com wrote:\nAs per the release info,\nNote: CorsixTH 0.60 for Windows requires the Visual Studio 2015 Redistributable which is not included in the installer. This is not the same version that was required for CorsixTH 0.50\u2019\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub, or mute the thread.\n. \n",
    "EythanF": "I don't remember, sorry. \n. ",
    "sgielen": "I just encountered this same error (same backtrace, at least) on the newest trunk 6a079fd0.. ",
    "maferv": "I ended up converting the XMI to midi with this software [1] and then to wav with Munt. Finally the wavs to mp3 and specificed the mp3 folder (and the right bitrate) in the config file.\n[1] http://www.vgmpf.com/Wiki/index.php?title=XMI_to_MIDI\n. ",
    "jvs3": "I attached some savegames. Stuck sliders.sav is when both sliders are to the far right, Stuck sliders 2.save is when both sliders are not all the way to the right. In both situations I can no longer move the 'send home' slider. When the sliders are both all the way to the right I can also no longer move the ' guess at cure' slider.\nStuck sliders 2.sav.zip\nStuck sliders.sav.zip\n. ",
    "lymelement": "Maybe... But where can I find the genuine Theme Hospital?\nThanks.. ",
    "andoruB": "Whoops, for whatever reason after reading the compiling instructions, I came out with the assumtion that both lfs and LPeg are components of luarocks, silly me. So it's a bit like python-apt. And indeed, debian supplies the lua-filesystem(-dev) and lua-lpeg(-dev) packages.. Yup, it does, but no satisfactory answer is available :(\nAlso, I don't think it's possible to set a default synth under Linux. I think it's all done through MIDI ports.. Thanks, will try it out. In the meantime: would it be possible to use a different backend for MIDI output? One that might enable more flexibility?. ",
    "MHStrider": "Alberth289346, thanks for the reply.\nI'm probably going to use the method \"pull requests\", so probably easier.\nThank you all ( the one who came up with and the people who help to refine ) for such a modification.\nHappy New Year everyone! Happy holiday!\n. Well, since all Lua files can be edited and viewed locally. That, after all going to do on your laptop, check in the game after already sent here.\nI use Notepad ++, I think you know about it, a good tool.\nAnd some do not understand about \"No trailing whitespace\" If possible, show an example. Google it does not know how to translate and does not know how. Too complicated the language - Russian :). Few reviewed the file, and I do not like here for example the structure of the russian.lua file. It seems that just after the update added the option you want and its translation. It will be necessary to reduce the amount of code a bit. Even it will be interesting, as it himself throw a challenge.\nNote: russian.lua <== 249 kb and 3426 lines\nOriginal ( or reference / sample / standart ) structure of the english.lua:\n387-399 lines:\ncustomise_window = {\n  caption = \"Custom Settings\",\n  option_on = \"On\",\n  option_off = \"Off\",\n  back = \"Back\",\n  movies = \"Global Movie Control\",\n  intro = \"Play Intro Movie\",\n  paused = \"Build on Paused\",\n  volume = \"Volume down hotkey\",\n  aliens = \"Alien Patients\",\n  fractured_bones = \"Fractured Bones\",\n  average_contents = \"Average contents\",\n}\nStructure of the russian.lua:\n3392-3402 lines:\ncustomise_window.average_contents = \"\u0421\u0440\u0435\u0434\u043d\u0435\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435\"\ncustomise_window.option_on = \"\u0412\u043a\u043b\"\ncustomise_window.paused = \"\u0421\u0442\u0440\u043e\u0438\u0442\u044c \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u043f\u0430\u0443\u0437\u044b\"\ncustomise_window.option_off = \"\u0412\u044b\u043a\u043b\"\ncustomise_window.intro = \"\u041f\u0440\u043e\u0438\u0433\u0440\u044b\u0432\u0430\u0442\u044c \u0437\u0430\u0441\u0442\u0430\u0432\u043a\u0443\"\ncustomise_window.caption = \"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438\"\ncustomise_window.back = \"\u041d\u0430\u0437\u0430\u0434\"\ncustomise_window.movies = \"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0440\u043e\u043b\u0438\u043a\u0430\u043c\u0438\"\ncustomise_window.volume = \"\u0413\u043e\u0440\u044f\u0447\u0430\u044f \u043a\u043b\u0430\u0432\u0438\u0448\u0430 \u0443\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0433\u0440\u043e\u043c\u043a\u043e\u0441\u0442\u0438\"\ncustomise_window.aliens = \"\u0418\u043d\u043e\u043f\u043b\u0430\u043d\u0435\u0442\u043d\u044b\u0435 \u043f\u0430\u0446\u0438\u0435\u043d\u0442\u044b\"\n. I created a repository, to learn to work with github and can operate remotely.\nhttps://github.com/MHStrider/LangTH. Why in the file russian.lua is the value of:\nadviser.tutoruial.build_reception\nAnd in english.lua no, where he takes this value?. Changing only the visual part of the font. And icons \"???\" not disappear. Yes, and if there was a problem in the font, the whole game was to be \"???\".\nNow I read the forum, yet it seems that it's a little problem with the engine.\nIt is necessary to start the engine and still learning :)\nI think the issue is closed.. ",
    "altiereslima": "This translation was based on the current english.lua layout.. I Don't Know Enough. Ok TheCycoONE, finished updates. :)\nThank you.. Yes, are those last changes still good translations. Works fine. ",
    "Honorbrachios": "I'm using french version of the game on windows 10 86x. It's CD version.. ",
    "ruPaladin": "Sorry for inconvenience. The problem is only with numbers. Red line was added in GIMP. I use Windows and didn't change default settings. I tried 0.4.0 and there is no problem with numbers (they are the same as in English). But 0.5.0 and 0.6.0 have that problem.. ",
    "PenguiN560": "I also have this problem. Is there some recommendation which font is better to used for different languages for normal display?.  @TheCycoONE oh, ok, thank you, we will hope on it. \nAlso some messages on Russian language go away from message boxes or text box and some others written over others text, for example https://cloud.githubusercontent.com/assets/816595/23758838/610b5452-0504-11e7-80a9-cc7a0bc7f531.png\nand here\n\nand some others. @MarkL1961 I think you're right, but there are russian localization for Theme Hospital without this problem.\n. It can be nice, but CorsixTH don't work with Rus version =( it hold on first loading screen.\n. Looks like the problem is check for update error. I try set check_for_updates = false in config.txt and it works fine. Thank you for answer. As I understand my version luasocket is broken and I should use newly version than =dev-lua/luasocket-3.0_rc1-r3, right? Or what's wrong?. @TheCycoONE Ok, thank you so much.. ",
    "tiriana": "Maybe it possible to add some flag like: use_custom_font_for_numbers, or use_default_font_for_numbers to config? \nI'm pretty new to this project - please let me know who's actively developing it, so I can mention them.. I also wanted to translate the warning about missing/corrupted files: \n\nbut I don't see key for it in translation file. Please let me know if there is a way do to it.. @MarkL1961 @Alberth289346 @TheCycoONE Just a ping. I don't know how long usually code review takes here. \nThis one should be pretty straight forward - it only adds some translations. . Yes, I'm comfortable with squash, I use git on a daily basis, I just wanted to wait for fixes etc and than squash. I was playing today a bit and found one or too missing text, I will add them to this PR, squeshed. And I'll add the prefix than.\nAbout the second thing - the translation of warning - I will create an improvement ticket for this as well.\nthx\nEDIT.\nI don't think I will dinf more time any time soon to add those few missing texts in this particular PR. I'll try to add them in the future. For now - I'm marking as [RDY].\nI can ask some of my polish speaking fellow developers to review it as well. Would that be helpful to you? cc: @TheCycoONE \n. @wolfy1339 \n\n(in english version font is not spicified, in polish it's set to ttf path)\n. I mean that the values (on the right) are rendered by the orginial font despite unicode_font is specified.. Good idea. \nI'll leave the final decision to @TheCycoONE however, as it is something that would be useful for other languages too.\n...\nbut on the other hand - the button on which this text is displayed might be to narrow for such long text. I can check it later and attach screenshot. . ",
    "cwlee0223": "This also happened when I used Korean language. ( ;Money bar broken http://i.imgur.com/IS7DRYb.png)\nI remember this bug did not occur when I used previous version of corsixTH (like 0.4).\nI hope this can be fixed on next version. Thx :)\n\n. ",
    "colinha667": "I can't seem to find the gamelog.txt. is it stored in the program files?. ",
    "RyanJGray": "Ah okay, thanks for clarifying.. ",
    "lucasmr": "Happens on 0.60 and also on the latest dev build.. Well, I loaded the save on the latest dev build with the same results. Maybe it's not useful then?. ",
    "phobos2077": "Or just a checkbox \"Double pixels\" or something, like OpenRA?. But how about forcing handy man to fix closest problem to where he was dropped? This seems to work with cleaning up litter, but not with repair.\nAlso the exploit I mentioned, is it intentional? Maybe should create another issue about it?. ",
    "matejdro": "Thanks for looking into this. I tried it, but I don't think this is what this issue is about.\nThis pull request only increases window size, putting windowed experience on par with full screen experience. But it is still using blurry interpolation method for scaling (text is still blurry).\nWhat I was talking about in this issue is scaling mode that just duplicates pixels. For example, if there is one blue pixel, and you have 2x scaling, this blue pixel will turn into 4 (2x2) exactly the same blue pixels, without any interpolation or math involved.\nFor example take a look at dos version with integer scaling enabled in dosbox:\n(Please open both images fully. GitHub will scale down on the comment page, making both look blurry)\n\nAnd this is your test build of CorsixTH which uses interpolation scaling:\n\nEven though both games are running at 640x480 resolution with 2x scaling, you can clearly see that DosBox version with integer scaling is very crisp, while CorsixTH's text and UI does not look very pleasant, it is too blurry.. ",
    "theAlevan": "Any progress on scaling on hidpi screens?. ",
    "OvermindDL1": "Why not turn off filtering on the texture when uploaded to the GPU?  Set it to purely nearest-neighbor (at least for GUI elements)?. ",
    "dhow": "I currently use a custom resolution of 853 X 480 to reduce the blur, however a pixelized resize would really help to give t he game a retro look. Thanks for all your help! . ",
    "shizeeg": "an issue report in Russian? That's savage. =D I don't see any problem here tbh. Arialuni.ttf is a standard Windows font & should be integrated in Windows https://en.wikipedia.org/wiki/Arial_Unicode_MS\nIt's not a surprise to me CorsixTH relies on that as well as many other games & software packages (CS:GO & Adobe Photoshop for ex.) do.. @MarkL1961 Russian is on your screenshot actually. It's \"\u0420\u0443\u0441\u0441\u043a\u0438\u0439\" (written in Cyrillic) 4th to the last.. @MarkL1961 Language(\"\u00d0 \u00d1\u0192\u00d1\ufffd\u00d1\ufffd\u00d0\u00ba\u00d0\u00b8\u00d0\u00b9\", \"Russian\", \"ru\", \"rus\") it's a UTF-8 encoded string in CP1252 encoding I suppose.\nIn my browser I see \nlua\n22: Language(\"\u0420\u0443\u0441\u0441\u043a\u0438\u0439\", \"Russian\", \"ru\", \"rus\")\nhere: https://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/languages/russian.lua#L22\nProbably CorsixTH needs a fallback to arial.ttf if arialuni.ttf is not found logic.. ",
    "FlameArtLab": "Arial looks very bad. I think, best font for russian is Gothic.ttf (in windows standart fonts). ",
    "1vanK": "I have no Gothic.ttf in my windows 10. ",
    "kamilkoterba": "+1 Translations are correct.. ",
    "naugtur": "LGTM.\nAlso, if you ever need to check Polish translation without knowing Polish, just check if the word \"dupa\" is not lingering anywhere :). I'd suggest leaving some indication that this is the language menu in English. \nJ\u0119zyk gry (language)\nEveryone who switched anything to Chinese accidentally knows why.. ",
    "AdamFx990": "I'll take a look at this. I'll post a couple of strings when I've got something (hopefully later today). . I mean, when you put it like that it does sound like a less enjoyable undertaking.. Not yet, I'm at work at the moment so can't test for a few hours. It should\nbe fine though.\nOn 23 March 2018 at 09:16, William Gatens notifications@github.com wrote:\n\nLooks good to me. Have you tested this fits on the dialog?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/pull/1366#issuecomment-375589611,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/APM4pY4ACpZyCJEZu70vhYv7B4vcR4-pks5thL1SgaJpZM4S4YU7\n.\n. \n. White space problems have been fixed. :). Sorry about the mess. I'm still learning git-bash.. So you reckon it should be \"M\u00c9DECINE\"?\n\nEDIT: I just checked with a Frenchman and he agrees.. ",
    "AphidGit": "Read the suggested fix bit; I'm saying it's too hard to avoid the penalty in the first few years for the last few missions. You should be able to avoid it as it can cause a game-over pretty easily. On the other hand, the goal is really easy to reach for say year 5. The goals for trophies should scale with time, not be constant. I do suggest that they cap out after some time though. \n. ",
    "TheOTNN": "Will check what can i do when i am available but can you please clarify what i need to do? I think i need to download some fonts from the internet and then drop them at the folder where you shared the link with me. If so, can you also add a link of the font with me?. Okay, i have chosen a text font it covers all the letter but in the game it appears as some cubes.. Let me show you. \n\nAs you can see at this picture i pick Arial for expamle, it covers all the letters of the language.\n\nSet it as it is in the screenshot.\n\nThen the result.\nBy the way i don't even know if one of those cubicles means Turkish, maybe they're other languages.\n. Okay i think i managed it and news occured sadly, here is an ss of it. I don't understand how those things can happen i didn't do anything but dumped the strings. By all those errors i am losing my enthusiasm.\n\n. Started with a new file and managed to complete the string with problem. The problem was, one or two strings was not a single line. Now it works so far.\nBut here's another question. The font when i changed into Turkish is so annoying how can i get the font while in English?. Yeah, i know i'm coming from there you can see the subject named ''Testing'' and it's mine, my nickname is just different it's ''UltimateBox''. \n. It seems i don't have lucon and didn't understand things you said about two pass approach. Anyway, so far i can see my edits on lua file and it's good.. ",
    "reubot": "According to https://gamedev.stackexchange.com/a/102881 0 would be the appropriate value.. I'll take a look.. ",
    "arnzel": "Fixed Indentation\n. ",
    "hnsl": "Hi, I was in the middle of a game. I just kept playing, didn't try to reproduce anything. Sorry!. ",
    "bacon1986": "Describe the issue\nI had the same error occur in the middle of a game during an Earthquake in Festering-on-the-Wold. I was not interacting with any rooms at the time.\n`An error has occurred!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The timer handler.\nA stack trace is included below, and the handler has been disconnected.\nC:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:667: Can only finish current action\nstack traceback:\n        [C]: in function 'assert'\n        C:\\Program Files\\CorsixTH\\Lua\\entities\\humanoid.lua:667: in method 'finishAction'\n        C:\\Program Files\\CorsixTH\\Lua\\rooms\\general_diag.lua:75: in field 'after_use'\n        ...Files\\CorsixTH\\Lua\\humanoid_actions\\multi_use_object.lua:264: in local 'timer_function'\n        C:\\Program Files\\CorsixTH\\Lua\\entity.lua:219: in method 'tick'\n        C:\\Program Files\\CorsixTH\\Lua\\world.lua:1075: in method 'onTick'\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:1000: in function \n        (...tail calls...)\n        C:\\Program Files\\CorsixTH\\Lua\\app.lua:901: in function \nWarning: No event handler for timer`\nSystem Information\nCorsixTH Version: v0.60 launched through Steam.\nOperating System: Windows 10 Enterprise\nTheme Hospital Version: GOG.com\nAdditional Info\nAfter the error my general diagnosis room is showing a glitch (see attached image). I tried to edit the room and the member of staff left but the patient didn't. I tried to send them home from their info window but they won't leave.\ngamelog.txt\nErrorLog1.sav.zip\n. This may be a duplicate of #1073 \nSorry.. ",
    "discuss99": "i reinstalled the corsixth to the default location(C:\\program files,,..etc) and now seem no crashes anymore.\nHowever when install corsixth to D:\\games\\corsixth, it always crash.. This time i start as tutorial mode, it still the same, it crashed/hang when I recuit the first doctor and right click to place it somewhere in the hospital.\ni tried to find the gamelog.txt but not able to find one. i can locate the config.txt \nC:\\Users\\Acer2018\\AppData\\Roaming\\CorsixTH, but there no gamelog.txt file there.. I used the real copy from Origin, so it suppose should works. I just test\nagain and now i found out what caused the issue.\nIf I use language - English, it works, but when i use Traditional Chinese\nand during the tutorial and put the recruit the first doctor and place it\nin the hospital, it will crash. For me it seem the text which tutorial say\nafter you place your doctor is not available for Traditional Chinese\nlanguage and hence it crashed there. maybe..im not sure.\nthanks.\nOn 7 September 2017 at 04:02, MarkL notifications@github.com wrote:\n\nTutorial is working fine for me, it is left click to place the Doctor,\nright click would cancel the hiring, no error if I right click.\nThis is the location of my game \\Downloads\\CorsixTH (060890f\nhttps://github.com/CorsixTH/CorsixTH/commit/060890fb7134f1960d0824e7f952fbb7c2a78bd1)\\CorsixTH.exe.\nWhere it is stored should not make a difference so long as you tell the\ngame where the original TH files are located and you have permission for\nthat location.\nYou could have some missing TH files as that can cause the game to crash.\nHave you read the FAQ's as there are some helpful solutions to common\nissues?\nhttps://github.com/CorsixTH/CorsixTH/wiki/Frequently-\nAsked-Questions#the-game-crashes-on-startup-or-after-clicking-start-game\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/1240#issuecomment-327565756,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AeJg6L-Wisa2ffISA8ErlM2ujTNTqRNtks5sft5OgaJpZM4PLjTJ\n.\n\n\n-- \nDiscuss99@gmail.com\n. this text looks alright to me. But when I placed the doctor on the floor,\nthen it will hang, no error message. if use English version, after placed\nthe doctor  on floor, game only stopped for like 0.5 seconds and then\nthe \"\"Welcome\nto the demo hospital!\" message will popup.\nOn 6 November 2017 at 21:23, Toby notifications@github.com wrote:\n\nThe Traditional Chinese language file hasn't been updated in a while. Are\nyou able to help us update it, by this method set out on the wiki?\nhttps://github.com/CorsixTH/CorsixTH/wiki/Localization#finding-translatable-strings\nThis line\nhttps://github.com/CorsixTH/CorsixTH/blob/master/CorsixTH/Lua/languages/traditional_chinese.lua#L308\nfrom the language file may be the text that caused a problem. Does it look\ncorrect?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/1240#issuecomment-342106417,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AeJg6InmEmqxNiWJY1CE7cNxcQLSK-k9ks5szt4pgaJpZM4PLjTJ\n.\n\n\n-- \nDiscuss99@gmail.com\n. ",
    "KeeperSt": "Here comes the translation:\n  \"Cobras muy poco en Medicina General.  Eso har\u00e1 que la gente venga a tu hospital, pero no le sacar\u00e1s provecho\".\nOriginal text:\n  \"You're charging too Little for Medicina General.  This will bring people to your hospital, but you won't make a lot of profit from each one\".\n. More messages, which are not translated.\nSave Game\nhttps://www.dropbox.com/s/rcmo6dt6l22x2vk/keeper4.sav?dl=0\nAdditional Info\n\nHere comes the translation:\n\"\u00a1Un paciente se ha ido de Medicina General sin pagar porque es demasiado caro!\"\nOriginal text:\n\"A patient left without paying for Medicina General because it's too expensive!\"\n. More messages, which are not translated.\nAdditional Info\n\nHere comes the translation:\n\"\u00a1Un paciente se ha ido sin pagar C\u00e1lculos de Golf porque es demasiado caro!\"\n. More messages, which are not translated.\nAdditional Info\n\nHere comes the translation:\n\"\u00a1Un paciente se ha ido sin pagar Vomitona porque es demasiado caro!\". More messages, which are not translated.\nAdditional Info\n\nHere comes the translation:\n\"\u00a1Un paciente se ha ido sin pagar Gaseocontenci\u00f3n porque es demasiado caro!\". Ok, you are right.  If a treatment is missing, it will be missing in all of them too.\nThe translation for\n \" A patient left without paying for ## because it is too expensive. - where ## equals the name of the treatment\" \nwould be\n  \"Un paciente se ha ido sin pagar ## porque es demasiado caro\", where ## equals the name of the treatment.\n  In case ## is the place where the patient has gone without paying, the translation would be\n  \"Un paciente se ha ido de ## sin pagar porque es demasiado caro\".\nThe translation for\n  \" Your charges are high. This will make big profits in the short-term, but ultimately you'll start to drive people away.\"\n  would be\n  \"Cobras demasiado.  Eso te dar\u00e1 grandes beneficios a corto plazo, pero al final la gente se ir\u00e1\".\nThe translation for\n  \"You're charging too little. This will bring people to your hospital, but you won't make a lot of profit from each one.\"\n  would be\n  \"Cobras muy poco. Eso har\u00e1 que la gente venga a tu hospital, pero no le sacar\u00e1s provecho\".\nIf the prices are low, \"you're charging too little for %\" would be translated as \"cobras demasiado poco por %\".\n  If the prices are high, \"your charges for % are high\" would be translated as \"cobras demasiado por %\".\n  If the prices are fair, \"your charges for % seem fair and balanced\" would be translated as \"el precio de % es correcto\".\n  (In all these cases I asume % is a treatment.  In case % is a place, the preposition \"por\" should be changed for \"en\").  (Cobras demasiado (or \"demasiado poco\") en %).. Thanks for fixing it.  Now it does not happen no longer.  Now a surgeon operates, but there is nobody in the bed, and the other surgeon does not do anything.\n\n.   I have not been able to find the translation, but this could be a shorter translation of the original one:\n\"Felicidades por dirigir con \u00e9xito los hospitales asignados.  Esta soberbia actuaci\u00f3n te permite viajar libremente por todo el mundo.  Recibir\u00e1s una pensi\u00f3n de 16017 y una limusina.  A cambio, viaja de ciudad en ciudad, saluda a tu p\u00fablico incondicional y fomenta la labor realizada en los hospitales\".\n  \"Estamos orgullosos de ti.  Te agradecemos tu labor de salvar vidas\".\nI think we save one line, or two.. OK, thanks.  I have already talked to the authors in the forum.. The values are in the wrong order.  In Spanish, your earn 0 out of 4800.  You do not out of 4800 earn 0.\n\"Has ganado 0 de una prima m\u00e1xima de 4800\". (Correct)       You have earned 0 out of 4800\n\"De 4800, has ganado 0\".  (Wrong)                                          Out of 4800, you have earned 0\nSo the translation is wrong \"out of 0, you have earned 4800\".\n. \"De una prima m\u00e1xima de 4800, has ganado 0.\"  This is not the usual way to say it, but the order of the sentence can be changed.. ",
    "jmealo": "@TheCycoONE I'm getting over a head cold and up against some deadlines for work. Maybe we can Skype/Hangout/Zoom to go over the tasks for this and find a good fit.\nI'm fine trying to serialize the input and/or help make it deterministic. I have OSX/Windows/Linux environments available but have not bootstrapped a CorsixTH development environment yet (docs seem good, just didn't have the time). My preferred method would be if we could get machine images I can boot on a spare hyper visor I have (gobs of ram and I think 32C/64T) so that I can run the tests in parallel and reset the environments easily. In an ideal world anyone could grab those and run them in VirtualBox or VMWare Player at home.\nIf we setup a Pritunl VPN we could have the VMs on the same \"LAN\" which will come in handy for working on the network code.\nI have used GDB on Solaris in 2012 but I'm not particularly married to a C/Lua debugger. If it's easier to debug on Windows with Visual Studio I'm down with that. I'd like to use the environment \"most developers\" are using.\nIf it's worth the time, I can help setup the VPN and provide remote access to pristine VMs and we can snapshot them (on actual hardware). If I can get it to PXE boot I can give some core members VPN access but the firewall will be clamped down for outgoing connections. As long as it's under $20/mo in power I don't really mind the noise of running a server under my bed.\nRandom number generator seed?\nWe might need to seed the random number generator or perhaps make it return an incrementing number.\nWhere should I start reading?\nWhile I'm thinking about it, could you point me to the relevant bits for input code and state management. Do we move the in-memory structure directly to the save game? (I'm guessing we have binary compatibility for reading Theme Hospital saves, not sure if we're trying to keep it for new saves, that could be an issue).\nAppend-only log\nNATS is a text-based protocol and I've used it from Lua with LuaSocks. I could set up a NATS streaming server to record the event log to a spinning hard disk. (I have an 8TB one laying around). It reads at about 150MB/s+, so we should be able to replay very long gameplay sessions into RAM and run queries on it.\nData/Query ergonomics?\nThat being said, would you rather be writing Map/Reduce type jobs in Lua or JavaScript over a stream of events or would you rather write SQL and query them from PostgreSQL (a log table).\nUnless we have a ton of custom lua code we'll need to interact with the data, I'd go the PostgreSQL route (especially with PL/Lua, that'll let you move some CorsixTH code into queries and triggers to normalize the stream).\nNetworking\nNATS = gnatsd from Apcera\nNAT = Network Address Translation\nFWIW, NATS would actually be a good foundation for the networking code (simple text based protocol, written in Go, tiny, single binary). It could work on a LAN or over the internet. You could use a STUN server to poke through NAT). I'd argue it makes more sense to bundle a server binary and provide public servers and allow people to run a server on their LAN if they choose. Troubleshooting NAT issues can be a painIf there's something purpose built that might be better. If you wanted to scale a production server, I'd probably just use NGINX (it can do UDP and TCP streams now) and the Lua Streams module. You can easily use C-structs or Lua Tables for state and it'll be really easy to deploy (not as easy as a single go binary, but, it doesn't introduce a new language and easily lets you leverage lua). If not there's a bunch of nice Lua bindings over an event loop suitable for writing a network server.\nSorry, again, head cold, so there's a lot to process here, hopefully it makes sense.. If we provide the same seed to a non cryptographic random number generator: If we call it in the same sequence we must get the same numbers. Assuming it's not timing dependent and we're managing input (repeating a sequence detached from actual user input) shouldn't we be able to achieve determism?\nFrom an outsider's perspective being able to achieve (determinism) could possibly resolve a number of bugs in itself by eliminating side effects.. ",
    "ras0219-msft": "\nDoes the vcpkg team have a policy on the state of a library before it is accepted?\n\nWe want libraries that are usable by others :) For mature libraries, this means latest stable release, for immature libraries it's whatever the submitter wants. For unmaintained libraries, the caveat is that we will break it by updating its dependencies, and if nobody fixes it it'll get removed.. The sdl2 issue should be fixed in https://github.com/Microsoft/vcpkg/tree/deee8c17.. I'd like to help you use the toolchain file if possible!\nNote that CMAKE_TOOLCHAIN_FILE only appears to take effect during the first call to project(), so if you want to download the prebuilt libraries, you could do that first:\n```cmake\nif(NOT CMAKE_TOOLCHAIN_FILE)\n  # download stuff here\n  set(CMAKE_TOOLCHAIN_FILE /downloaded/path/to/vcpkg.cmake CACHE STRING \"\")\nendif()\ncmake_minimum_required(VERSION 3.8)\nproject(foo CXX)\nmessage(STATUS \"VCPKG_TARGET_TRIPLET=${VCPKG_TARGET_TRIPLET}\")\n```\nAlso, the architecture of the Visual Studio generator can be controlled with -A x64.. It looks like SDL2 doesn't provide a -config.cmake, so you'll probably need to write a FindSDL2.cmake script manually (which you probably needed anyway?).\nThere are a few floating around that might be interesting: https://github.com/search?utf8=%E2%9C%93&q=filename%3Afindsdl2.cmake&type=Code. I don't have total context, but hopefully our design is that you can simply do\n./vcpkg remove --outdated --recurse\n./vcpkg install <list of all dependencies>\nAny deps that are still installed will be a no-op, any deps that got removed will be installed.. They will still work, though you should re-bootstrap the tool as well.\n.\\bootstrap-vcpkg.bat\nWe treat versions as \"cookies\" and don't try to say less-than/greater-than. If it's different, it's wrong :).\n. We should do this automatically in Vcpkg!\nCould you let me know what specifically isn't working?. Nevermind, I see below that you're not using the toolchain file.. ",
    "vyguera": "You are right, the issue is caused by a previous bug:\nThe doctor is already tired over is limit fatigue and is not treating the patient, so the patient results in death after a while. Even though I cant say why the doctor didn't go to the staff room once he got tired. I guess he got tired at the same time he was treating a patient. There is a shelving in the room. Doctor might got tired while using it.\nI have uploaded my savegame to one several minutes before-:\nhttps://app.box.com/s/q133ku4byrmcp80njy8w21npf47crsq0\nThe new screenshot:\n\n. Ok this savegame is even better:\nhttps://app.box.com/s/jnnyeh8vn1mr66ylsy8960v0c5warpv3\nJust a minute after the doctor enters the room. Is the one leaving from reception following the road and coming to psiquiatry. He is not tired at all, and gets tired while the patient enters but I've loaded the gamesave several times and this bug is not happening. I'm not quite sure if I understood you. Do you mean you couldn't debug the error in a new version?\nAnyway, do you need anything else of me?. ",
    "UncagedFungus": "Of course I haven't cheated.  If I had I wouldn't have been offered an increased salary.\nAttach my save?. https://drive.google.com/open?id=1JDN0LH2vBuJI3AGeub8syhYjIvuuNcHI. ",
    "dsnkostic": "@TheCycoONE I took the version from this link: https://github.com/CorsixTH/CorsixTH/releases. It says that it is v0.60. Ctrl+F10 does not work on this one.\nI did not took the latest git version as I did not tried to compile it yet.. @mugmuggy \nI was not aware that you have continuous integration setup. I unpacked the trunk version and upon hitting Ctrl+F10 solves the issue with multiple monitors. Mouse pointer is now contained within primary monitor.\nMay I recommend that this feature be enabled by default in the next release version.\nBest regards. ",
    "pschoffer": "Hi there, would you have a safe game of that? Was it repeating issue or just one time thing?. Hi @DavidFair,\ni would like to have a look on this one. Could you please provide more description for unexperienced person. Some steps to reproduce would be great.\nCheers,\nPavel . Awesome thanks. I will have a look.. So I tested the behavior.\nThe only option that is not being persisted is Lock Windows. I am not entire sure what it does to be able to comment it in the config file. Could somebody help me explain what is this switch for?\nAlso the Edge Scroling switch gets persisted, but only when the game is closed while the others when the save is made. I will try to figure out why and update here.  . Cool this was solved with explanation + #1322 . Ohhh. I was wrong. So I thought the whole CorsixTH (insede the CorsixTH repo is build), but is only a CorsixTH/CorsixTH executable file. Meaning only the file should be ignored in my opinion. Meaning I can't put the trailing / as git will then look for folder and not match files. Do you think we could keep it as is then? . Hi @TheCycoONE is there something you are missing here (there is a required change from you, but I think it was covered already maybe?)? . @TheCycoONE Thanks for checking. For the folder in my opinion that root folder is way to crammed at the moment and some more structure would be useful, but I understand your point. What about creating a util folder with this Date + Path class  in it? . None really, just seems hard to navigate. But I agree it is not that bad. I will move it to the root folder:). @TheCycoONE  I totally agree. I forgot to ask about that. \nThat was my initial plan, but I couldn't figure out how to do it. I tried to define \nfunction Data.__eq(one, other)\n  -- code\nend\nand\nfunction Data:__eq(one, other)\n  -- code\nend\nBut neither of them work. Then I tried some messing up with getmetatable(Data), but no luck either. I tried to find some reference in code but couldn't. But Maybe I was not looking hard enough:) Any pointers?. Awesome thanks! I will try to do that in the afternoon.. When I was doing some testing I found out this hip new class has some issue with persistence. I will have a look tomorrow.\nUnhandled argument to th_getfenv\nUnhandled argument to th_getfenv\nUnhandled argument to th_getfenv\nUnhandled argument to th_getfenv\nnil <no name>\nError while autosaving game: ./CorsixTH/Lua/persistance.lua:242: Lua functions must be given a unique persistable name in order to be persisted (attempt to persist ./CorsixTH/Lua/date.lua:112). For me it happens every time I try to save (or autosave). From the error I guess it tries to persist the metatable functions __lg and __eq and fails because they are not unique or something like that. I was refreshing my C++ to understand better how it works, but I am not there yet:)\nI got a little bit closer. I am suspecting that adding that method._metatable then tries to persist metatable twice (one explicitly and ones as a table key value pair, which results in name not being unique somehow). Man I got soo tired by this Lua <-> C integration so I just settled for your solution without understanding it. Feel free to explain that bit to me:)\nI would still like to sort out those hours as well.. Cool I did your last recommendation @TheCycoONE  and it seems to work fine! I also added some more fixes. So I am happy with this.. Pending play test?. Oh I see I thought you want me to merge some play test:) BTW you probably know that but it took me a while to realize that i need to turn on advisor for him to show up:). So I squashed it a bit. Is this enough? I still wanted to keep some stuff in separate commits. Also please check the last commit I remembered and fixed one potential issue with next_vip_date after your review.. Oh right thanks. Nice catch. I fixed it with a isSameDay method. Also I refactored the nextVIP method in world. This Way it seems a little more intuitive, but I am fine with reverting it back to having the old nextVIP as well. . Not fun the docs part. But it looks nice in the html thats true:). Hi @sionmaisley, do you have a save game or a way to reproduce this?. This might be useless for you now but in FAQ you can find a section that deals with save game location. \nHave you attached the file?. I am not sure if github can process email attachments this way, because I don't see it here on the issue. You might need to attach it here.. Cool thanks. I checked your safe and everything seems to be fine (I did't get the error you mentioned).  \nBut when I checked the error report that you posted, I think I know what could cause the issue. I will prepare a fix for that, but it is really hard to reproduce (epidemic needs to struck a person that wasn't initialized properly).. We added some more logging to be able to figure out next time what could have caused this wrong state. But as I am not able to reproduce the issue, this Is as far as I can go with it. I would suggest closing this issue.. @TheCycoONE I squashed the commit, but I didn't know what you meant by code_dir .. \"?\" .. pathsep .. \"init.lua\". As far as I know lua replaces ? with what you put to require. So if you would put require(\"cool_thing\") it would look for code_dir/cool_thing/init.lua is this what you meant?. I tested it with require(\"blbe\") and got \nAn error has occurred in CorsixTH:\n./CorsixTH/CorsixTH.lua:36: module 'blbe' not found:\n    no field package.preload['blbe']\n    no file './CorsixTH/Lua/blbe.lua'\n    no file './CorsixTH/Lua/blbe/init.lua'\n    no file '/usr/local/share/lua/5.2/blbe.lua'\n    no file '/usr/local/share/lua/5.2/blbe/init.lua'\n    no file '/usr/local/lib/lua/5.2/blbe.lua'\n    no file '/usr/local/lib/lua/5.2/blbe/init.lua'\n    no file '/usr/share/lua/5.2/blbe.lua'\n    no file '/usr/share/lua/5.2/blbe/init.lua'\n    no file './blbe.lua'\n    no file '/usr/local/lib/lua/5.2/blbe.so'\n    no file '/usr/lib/x86_64-linux-gnu/lua/5.2/blbe.so'\n    no file '/usr/lib/lua/5.2/blbe.so'\n    no file '/usr/local/lib/lua/5.2/loadall.so'\n    no file './blbe.so'\nstack traceback:\n    [C]: in function 'require'\n    ./CorsixTH/CorsixTH.lua:36: in main chunk\n    [C]: in ?\nSo seems to work as expected. OK that sounds good. I will unify the getCurrentAction logic somewhere with logging. To be continued:). @Alberth289346 thanks for the comment. I see your point (from both of you:)). and as I mentioned I will prepare the contra solution as suggested.. I get this when not catching in in test. So that looks good I think.\n\n. This is being done by #1343. @da4id have you thought about moving boiler and radiator logic into its own class? I think that the hospital class is getting pretty big now. If you would be up for it and move all that disaster, radiator price and all that logic to dedicated class (could be called Boiler or BoilerController). Even awesomer would be if you would add some unittests around the new class (as testing these big classes is much more challenging). Just a thought though so feel free to ignore:). Damn:) I am on it (in the evening)!. Good point. I added a new line and some more logic to the name of the humanoid. This is the current state. What do you think?\nA stack trace is included below, and the handler has been disconnected.\n./CorsixTH/Lua/entities/humanoid.lua:868: Action queue was empty. This should never happen.\n<LocalisedString> Current value:humanoid (MANMOOR) - class: Nurse\nWarmth: 0.290   Happiness: 1.000   Fatigue: 0.000  Thirst: 0.000  Toilet_Need: 0.000   Health: 0.970\nActions: [meander]\nstack traceback:\n    [C]: in function 'error'\n    ./CorsixTH/Lua/entities/humanoid.lua:868: in function 'getCurrentAction'\n    ./CorsixTH/Lua/entities/staff.lua:265: in function 'isTiring'\n    ./CorsixTH/Lua/entities/staff.lua:161: in function 'tick'\n    ./CorsixTH/Lua/world.lua:1036: in function 'onTick'\n    ./CorsixTH/Lua/app.lua:1014: in function <./CorsixTH/Lua/app.lua:1011>\n    (...tail calls...)\n    ./CorsixTH/Lua/app.lua:915: in function <./CorsixTH/Lua/app.lua:910>. With @TheCycoONE we figured out that it comes from the profile.name when the code does \"humanoid\" .. \" (\" .. self.profile.name.. \")\" Where the name is localized string so colling implicit metatable tostring on it generates that extra <LocalisedString> Current value:. I still don't fully understand why is it at the beginning of the whole line and if there is a way to suppress that. Damn it my changes breaks a lot of stuff:( Sorry. I will fix it soon hopefully.. This fails build with CorsixTH/Luatest/spec/system/path_manager_spec.lua:27:30: (W113) accessing undefined variable PathManager\nDo you know why? And how to fix it?. I got the same error with it not being local here as well. This still needs to be fixed. When I try to do require instead. I get an error that the module loader can't find it.. I guess it should be fixed now?. I don't know if there is a better way of doing this? This seems to work though. Yep thanks. I am aware of this and the next commit should fix that.. fix extra space. Another extra space. This I would suggest to change to use \".\" as universal separator. That way it will behave the same way as Lua require works. Now this \"/\" was kinda weird to me. This of course means going through all the usages of crosixth,require(.*\\/.*) and replace with .. Done, could you please also point me to other places ? I found some other comparisons as well but they are mostly about some part of year but every year so I couldn't figure out how to compare them.. I did it for VIP, but both emergencies and earthquake boundaries are configured within level config, and to translate that might be messy. I would prefer to not mess with it within this PR.. Nice point. I kept ISO format apart of 4 year digit as we start from 1 digit and rarely go above 1 or 2 digits.. Hmm sorry I didn't get that one. . I would say either Date() or Date(1,1,1,0). Defining some of the parameters and relying on the defaults for other ones seems a bit more confusing to me. But yeah I prefer the default solution. . I fixed most of the issues. I kinda refactor the whole annoucments section in hospital, changing some of it's logic. It would be nice if you could have a look especially on that. . This is the change i did after your review.. Figure out how to make metatables inherit form super metattable. Remove this I guess. TODO. This I am still not happy about, but I am not sure how to solve it. It would be best to register the assertion inside the class_test_base, but the assert table isn't defined there (I don't know why:() Any Ideas?. Awesome it worked! Thanks man. How come i don't need to require luassert inside the test classes? Is it some internal magic?. ",
    "joh024": "While not a direct resolution, I also found similar situations (only 1 room being actively used with queues of 1-2, when there are empty rooms right next door and staff that could fill these rooms doing nothing in the corridor) to be annoying to micro-manage, so I added some extra code to room.lua that made things flow much more smoothly.\nTo preface, the thinking behind the change is this: If the player has built rooms and hasn't disabled them (set queue size to 0), then they expect these rooms to be used.\nThe new code modifies Room:getUsageScore in room.lua which is a \"Score function to decide how desirable a room is for a patient.\" and uses the following special values.\nlua\nlocal tile_factor = 10     -- how many tiles further are we willing to walk for 1 person fewer in the queue\nlocal readiness_bonus = 50 -- how many tiles further are we willing to walk if the room has all the required staff\nI add to this an \"empty\" bonus:\nlua\nlocal empty_bonus = 30     -- how many tiles further are we willing to walk if the room has empty queue\nValue of 30 is arbitrary, but seemed to work fine for my playthrough.\nThen I add the following into Room:getUsageScore\nlua\n  if queue:patientSize() == 0 then\n    score = score - empty_bonus\n  end\nWith this change patients are more readily assigned to empty rooms, which leads to a dispatch call to staff, which gets them out of the corridor (well, usually. Sometimes staff from another room that's not currently busy gets called over instead, but that's working as intended) and accomplishes the goal of having rooms/staff being more actively used.. Probably worth posting some screenshots to demonstrate it in action.\nN.B. For this test I modified World:updateSpawnDates in world.lua to boost spawn rates, just so we don't have to wait as long.\n\nStart a Single Scenario on St. Peter's near Cawley.\nImmediately pause, build 1 Reception and 3 identical GP's Offices. Hire the required staff, but place them in corridor.\nSave game.\n\n\nWithout changes\nLoad game, open hospital then unpause.\n\nAlready by February 13 we see the problem occurring. Only 1 office is in use with queue of 4, with 2 offices and 2 doctors idle.\n\nBy March 10 we've finally got the second office active, but both offices have big queues with third office and doctor still idle.\nWith changes\nLoad game, open hospital then unpause.\n\nBy the same February 13 we see the second office is active, and it has been for a few days. Longest queue at the moment is only size 2.\n\nBy February 19 we have all 3 offices active. I redid this a couple of times and the third office was active by around Feb 16-20, depending on patient inflow and where the doctor had wandered off to (since I only counted it active when the doctor was inside and working).\nPretty simple change but with noticeable results, and a very nice quality of life change that lowers annoying micro.. ",
    "xcom169": "Maybe as a workaround could you set up the installer, to use %appdata% if the user doesn't have elevated access to the computer? . ",
    "Mailaender": "Updated https://build.opensuse.org/request/show/560427 and enabled debug packages now. \"Speicherzugriffsfehler\" means segmentation fault. I don't really know how to give a more detailed error message. I tried deleting the config file. That made the game ask me again for the Theme Hospital folder, then it restarted and crashed again. Tried different folder locations. It doesn't seem to matter. See http://en.opensuse.org/CorsixTH for the instructions I followed. Maybe the error is in there.. If the codec is patented I assume those parts are removed for @openSUSE due to legal reasons.. I can confirm the video workaround resolved the crash. Also wrote https://en.opensuse.org/CorsixTH to get people started.. ",
    "robbyt": "I did a bit more testing, and found that a very simple save file produced on the mac can be loaded. However, the attached save file cannot be loaded on the mac (but it works on Windows).\nI've also attached the .app file that brew generated.\n2018.sav.zip\nCorsixTH.app.zip\n. One more note, after installing CorsixTH with Homebrew, I had to manually install luafilesystem and lpeg using luarocks.. You're correct- homebrew does not place the .app into /applications, and so I was using an older binary.\nThank you for your help, and making such a great port of this game!\n(the correct version loads that save file just fine)\n  . ",
    "tonyfinn": "Unfortunately, I don't have a pre-issue save, I hadn't saved since starting the game at that point. . Here's the closest autosave (~2 minutes before): https://drive.google.com/file/d/1pYB5SjPEtlviw2Q-BhBQ2yiV78tJJoVX/view?usp=sharing. ",
    "stavrossk": "Hi, is CorsixTH playable in it's current state?\nThanks,\nStavros.. ",
    "psypod": "This error can be reproduced by placing a bench on a tile while an handyman is trying to remove something from that tile (e.g. litter, vomit).. A possible solution would be to comment out the line 2205 in world.lua. That would also prevent the abusive usage of objects to manually remove litter. It seems that handyman can clean the litter anyway (just tested).\nEdit: Not sure about other side-effects.. Well that's no solution then. I rushed through the campaign on original TH last week and didn't came across that possibility so i thought it's an issue.. ",
    "sionmaisley": "I don't know where to find my save files\nSent from Yahoo Mail on Android \nOn Sat, 20 Jan 2018 at 11:42, pschoffernotifications@github.com wrote: \nHi @sionmaisley, do you have a save game or a way to reproduce this?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub, or mute the thread.\n. Found it after much digging\nThanks\u00a0\nSent from Yahoo Mail on Android \nOn Sat, 20 Jan 2018 at 12:48, Christian Thorpesionmaisley@yahoo.co.uk wrote:   I don't know where to find my save files\nSent from Yahoo Mail on Android \nOn Sat, 20 Jan 2018 at 11:42, pschoffernotifications@github.com wrote: \nHi @sionmaisley, do you have a save game or a way to reproduce this?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub, or mute the thread.\n. Yes I just attached and sent it in the last email\nSent from Yahoo Mail on Android \nOn Sat, 20 Jan 2018 at 16:18, pschoffernotifications@github.com wrote: \nThis might be useless for you now but in FAQ you can find a section that deals with save game location.\nHave you attached the file?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub, or mute the thread.\n. OK here it is\nAutosave12.zip\n. Trust me to find a rare issue haha thanks for your help. ",
    "vertibird": "as you can see in the picture, there are two radiators near the doctors, radiator temp is maxed, and the warmth color on minimap is completely blue, not even a little green or red on the building operating table is in. Try the save, you cant increase the heat even if you put 30 radiators.. Is there a fix to this problem?. I wish you luck! Thanks for looking up!. Good job dev! I await the new update.. ",
    "tbhosman": "Thanks, this worked. I don't quite understand though, 120k hospital value is not mentioned in the briefing?. ",
    "gBringout": "I do not remember how it was. But comparing with the other languages, it makes sense for me.\nBut, the caps does not make any sense (for the french language and comparing with the other string in the files). I would prefer something like (Note the s at m\u00e9decins and e at sp\u00e9cialiste):\npromotion_to_specialist = \"L'un de vos m\u00e9decins est devenu un sp\u00e9cialiste.\", -- Fix the famous \"Level 5 bug\". ",
    "AlexUrbanAc": "I would think that the game shouldn't break at line 59, but maybe give a warning to the player.. Yes, must have forgotten to upload it.\nUlti XT.zip\n. I think all eight psych rooms worked before the evacuation, and I didn't touch anything during the evacuation. I wanted to wait until the hospital is empty before doing anything, but the game crashes before the evacuation is completed.. ",
    "andrewspode": "10.0.16299 Build 16299, should be fully up to date.\nNo other audio issues with the machine. Is there a verbose output mode where I might be able to get any error messages? As far as I can see it's not generating any errors, just closing.\n. I'm (rather selfishly) reluctant to spend a lot of time on it when there are two fairly easy \"fixes\" available (no music, or MP3).\nI wanted to post it here, so anyone else with the same problem of frequent crashes might find this - rather than a plea for a fix. I appreciate you both responding.\nI've just been running back with the original music on CMD to capture any errors and have yet to reproduce the error, which is frustrating considering its regularity yesterday.. ",
    "ultraviolet-1986": "Thanks, in that case, it looks more like an issue with a missing dependency in the snap itself - I've just posted a link to the Snapcraft team here: https://github.com/snapcrafters/corsixth/issues/1. I'll mark this as a non-issue at this end as the repo/source versions appear to work fine.\nThanks again ^_^b. I made a pull request (single line) to the snapcrafters team repo and it was accepted - the fix is in the stable channel now. I can verify it works (better than the bionic repos version) :)\nDetails here: https://github.com/snapcrafters/corsixth/issues/1#event-1615750878\nYou're welcome, thanks to popey too ^^b. Hi, apologies for the confusion - the 'How to Compile' page didn't mention sudo make install (in fact, I've never done that) - but building, running make and then sudo make install starts CorsixTH flawlessly on Ubuntu 16.04/18.04. Apologies again, looks like a non-issue ^^b\nI'll mark this as closed.. ",
    "ZaiHuo": "The devs suspected it was the drivers, since the device was 'too new' it could have a weird version of the driver installed, and that was exactly the case, I went to the manufacturer's website (Vaio) and downloaded/installed the audio version that was there.\nFunnily enough I didn't 'upgrade' the driver, but 'downgraded' it, the version at the website was actually older by more than a year, but.... surprisingly, it worked, it's running normally now after downgrading the audio driver.\nThank you very much for the devs's advice at the irc channel and the quick replies from the community, thanks to your directions I managed to make it work normally. Now I can go back to no-lifing CorsixTH.. ",
    "lekoook": "@TheCycoONE ahh yes that flag solved the compiling issue. The wiki didnt mention using that flag, rather it's just \"cmake ..\" so I assumed. But running the Lua 5.3 version's command doesnt seem to work as well even with 5.3 libraries installed.\nAs for the movie, I just re cloned the repo again and compiled again. Same issue unfortunately.\nCrash log: https://pastebin.com/w8UAPHS4. ",
    "utkusen": "Yes, I get this error every time. But this error occurs before game even starts. I only select game folder and press OK. by the way it worked with gog version. ",
    "LeandroStanger": "@nedrichards @TingPing @Alexander-Wilms could help?. ",
    "uwmyuan": "Thanks for the quick response. . ",
    "mlugg": "I'll try it out later, thank you :). Sorry about the late response - the issue still appears to be present on master.\nEDIT: It might be worth pointing out that when the game freezes, it actually seems to freeze up my system, in that my keybinds for my window manager stop working entirely (I have to reset my system). However, the music continues playing.. I'll try and get the Origin version today. My specs are a Sapphire Radeon RX 480 8GB GDDR5 graphics card, an AMD A8 5600K CPU, and 8GB of Corsair Vengeance DDR3 RAM.. ",
    "CyberKiller40": "I hit this recently with the GOG game version on 0.62 on windows 7 64bit. My machine is Core i5, 8GB ddr3 and intel hd3000.\nMaybe the game doesn't freeze, but it's uncomfortably slow, the mouse cursor also lags when moving around.. If appeared in just a few minutes of gameplay, nearly from the beginning. I spinned the mousewheel in and out, out of habit at the start of the game, so it could be zoom-related. However if you could tell me how to reset the view to the default zoom level then I could tell you for certain (I couldn't find it in any menus in the game).. I didn't have much time to play in the past few days, but I tried the game yesterday. It seems I might have been mistaken, the slowdown doesn't seem to be tied to the zoom level at all. On the other hand the game is sluggish overall. I thought for a moment that this might be due to running it through GOG galaxy (I planted the corsixth.exe in place of dosbox.exe inside the game directory in order to get the playtime counted on GOG), but running directly didn't help.\nSorry for misleading you, however I could use some tips on how to get better game performance. My machine should be able to run it blazing fast.. Nothing much actually, just 1366x768, I can play other 2d games very easily at this resolution.\nbtw I also noticed the game slows down very hard when zoomed out, but when I zoom in, it speeds up (but this doesn't give any extra performance when zoomed in very much).. ",
    "dmoojunk": "No I think its level 9 in the campaign. - CorsixTH Map - Hoppalong. Many thanks, can confirm fixed.. ",
    "antonv6": "The scripts work for me, they actually catch some files:\n```\n$ python ./scripts/check_language_files_not_BOM.py ./CorsixTH/Lua/languages\nFound files with UTF-8 with BOM encoding:\nnorwegian.lua\n$ python scripts/check_trailing_whitespaces.py \nFound files with trailing whitespaces:\n.../CorsixTH/CorsixTH/Src/th_map.cpp\n.../CorsixTH/CorsixTH/Src/th_map.h\n.../CorsixTH/CorsixTH/Src/lua_rnc.cpp\n.../CorsixTH/CorsixTH/Src/th_gfx_sdl.h\n```\nWhich is surprising, considering the last build on travis is clean: https://travis-ci.org/CorsixTH/CorsixTH/builds/406569941\n(check_lua_classes.py doesn't catch anything right now, but works as expected if I intentionally bork any class definition in CorsixTH/Lua/)\nAnd I don't see my PR in https://travis-ci.org/CorsixTH/CorsixTH/pull_requests. It should be there, shouldn't it? Maybe webhooks didn't fire or something, but travis doesn't even know that it needs to build something, that's my impression.. It's... possible that $TRAVIS_BUILD_DIR is an absolute path, in which case there are differences in path handling after 95a0430:\n\ncwd + '/' + path gives '/cwd//travis-build-dir'\nos.path.join(cwd, path) gives '/travis-build-dir'. Thanks for contacting them, but it seems what they proposed isn't enough. I've logged in using by github account, and the request is still marked as abuse.\n\nAnyway, the scripts now print the number of checked files, so you can see if it's 0 or not. I've decided not to do sys.exit(1) if count == 0, because after all, this is just for debugging your CI setup once (hopefully).. ",
    "TenAltz": "When I start CorsixTH (i have done this at least 10 times over a couple of days) and press resum\u00e9 game, the game is still frozen along with my other saves (i have savegames from early levels, and they dont move any more)\nIf I try to start completely over, the game still doesent move, when I change the gamespeed. \nFurthermore when I go back to the main menu when I have tried to play one of the levels, my mouse only moves when clicked.   . Sorry, Found some lates saves in CorsixTH:\nhttps://www.dropbox.com/s/8lzgrsp64bhi5r6/10.sav?dl=0\nhttps://www.dropbox.com/s/gh0se57oyuhv7yc/9.sav?dl=0\nhttps://www.dropbox.com/s/3sgyhds6e2iubdi/6.sav?dl=0. A new game (without trying to play my saves) works fine. I just dont want to start all over again unless that is the only option. \n\nThat helps. Patient using the decontamination shower is 'going home' for some reason, but the room can't finalise the processing and make him leave in that instance.\n\nI think I know what the problem to that is. I just now saw that, when I tried to load the broken save: \nhttps://imgur.com/xuYMHMt \n. ",
    "MVOverdijk": "@TheCycoONE Thanks for replying! \nYes, I've used the installer.\nInstalled @ D:\\SteamLibrary\\CorsixTH\nTheme Hospital (GOG version) is installed @ D:\\SteamLibrary\\Theme Hospital\nAdded the extra code to the app.lua file \n\nThen ran again and here's the output;\n\u00fe\u2563\u00fc\u00da\u00bd\u00f6\u00f5\u00a9\u00a1\u00b5\u00fb\u00e7    function: 000001AEDD3C3700\nita     function: 000001AEDD0B16F0\nzh(s)   function: 000001AEDD2C91A0\nchinese (traditional)   function: 000001AEDD3C3700\nzh(t)   function: 000001AEDD3C3700\nitaliano        function: 000001AEDD0B16F0\nzho(t)  function: 000001AEDD3C3700\nchi(t)  function: 000001AEDD3C3700\nchi(s)  function: 000001AEDD2C91A0\nkor     function: 000001AEDD16B3E0\n\u00f0\u00e1\u00d0\u00e2\u00d0\u00fc\u00d0\u00fc\u00f0\u2551\u00f0\u00a9\u00f0\u2563  function: 000001AEDD2CA320\nrus     function: 000001AEDD2CA320\nitalian function: 000001AEDD0B16F0\nit      function: 000001AEDD0B16F0\n\u00fe\u00ab\u00c7\u00f5\u00a2\u00f4\u00f5\u00a9\u00a1\u00b5\u00fb\u00e7    function: 000001AEDD2C91A0\nkorean  function: 000001AEDD16B3E0\nru      function: 000001AEDD2CA320\n\u00dd\u00f2\u00a3\u00db\u00c1\u00a1\u00fd\u00fb\u2524       function: 000001AEDD16B3E0\nrussian function: 000001AEDD2CA320\nko      function: 000001AEDD16B3E0\noriginal_strings        function: 000001AEDD16AEA0\nchinese (simplified)    function: 000001AEDD2C91A0\nzho(s)  function: 000001AEDD2C91A0\nLanguage 'english' could not be found. Reverting to English.\nAn error has occurred in CorsixTH:\nLua\\strings.lua:301: Language 'English' could not be found. Please verify your installation.\nstack traceback:\n        [C]: in function 'error'\n        Lua\\strings.lua:301: in method '_loadPrivate'\n        Lua\\strings.lua:275: in method 'load'\n        Lua\\app.lua:411: in method 'initLanguage'\n        Lua\\app.lua:231: in method 'init'\n        CorsixTH.lua:136: in main chunk\n        [C]: in ?\n\n. ",
    "Sebvandenbrink": "Not sure if I did this right, I did\nlocal ui = self.panel.window.ui and print('keypress: char: ' .. char .. ' cursor_pos: ' .. self.cursor_pos[1] .. ', ' .. self.cursor_pos[2])\n(I am unfamiliar with Lua.)\nAnyway, that did produce this result:\nCreated game with savegame version 127.\nError in keydown handler: \n...ications/CorsixTH.app/Contents/Resources//Lua/window.lua:1138: attempt to index a nil value (local 'ui')\nstack traceback:\n    ...ications/CorsixTH.app/Contents/Resources//Lua/window.lua:1138: in method 'keyInput'\n    /Applications/CorsixTH.app/Contents/Resources//Lua/ui.lua:543: in field 'onKeyDown'\n    ...cations/CorsixTH.app/Contents/Resources//Lua/game_ui.lua:289: in function <...cations/CorsixTH.app/Contents/Resources//Lua/game_ui.lua:288>\n    (...tail calls...)\n    /Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:915: in function </Applications/CorsixTH.app/Contents/Resources//Lua/app.lua:910>. Ah. Okay, but that doesn't produce any results in the log.\nBut I found the reason:\nI had uncommented the key_remaps in the key_mapping.txt\nNot that it helped as it did nothing to activate the WASD keys for camera movement, but it did screw up entering text in the save game dialog.\nCommenting them out again fixed the problem.. ",
    "yuk75": "This seems to be affecting the save from point of load, and the autosave from maybe a minute in. There's no way to continue playing it.. I think the original save is from 2014 so probably yes. Is that an issue? :). I'm not sure how to answer that question. I played this specific level about 8 times now with no problems, it's only been this specific time that the issue has happened. If I click to restart the level I don't see it happen. Is that what you wanted to know? :D. ",
    "tfrengler": "Ah yes, I had made a note of the map (second of the custom campaign that ships with CorsixTH) but forgot to include it. My mistake.. ",
    "Feanathiel": "Busted was giving me a hard time on Windows. I had to set default.lpath to \"../Lua/?.lua;?.lua\" in the .busted-file, although I didn't commit this (is it my configuration?). In the end I think I've managed to add some testcases, so feedback is appreciated.. I think we're fine with the decay times right now, unless someone sees problems with it. Also, I can squash and reissue the pull request if you want me to?. The \"playing this for a lot of years\" triggered me, the spawn rate is increased by each month:\nhttps://github.com/CorsixTH/CorsixTH/blob/b969a05dc56ec958fb0d570e3d2f3c01d566ecd2/CorsixTH/Lua/world.lua#L1192. We can tweak values here. I don't think they make sense right now, but its a start.. Do I need to clean these up, so they're not in the savegames anymore?. Adding priority shouldn't break anything. As far as I could find, there are no calls with more than one parameter.. Moved to Announcer:onTick. Do I actually need to keep this?. Check if 128 is the right value...?. Example call. We need to set priority to playAnnouncement calls. If its not specified, priority 'normal' is used.. Alright, thanks.. I've added a commit handling this issue.. This was added to be able to play multiple announcements when multiple desks were available. Now that I think about it, it doesn't make sense, so I've replaced it with a boolean.. I've read (http://lua-users.org/wiki/ForTutorial) that the order of pairs is not defined, which is not what we want if critical announcements need to be played before low priority annoucements. ipairs iterates over the table in a defined numeric order.. Yeah, I think that makes more sense. That way the heat issue can be fixed faster by the player.. Note to self: remove this.. ",
    "Tigertye": "Thank you for your response. Glad it's not my install. I miss the emergencies but I'm really enjoying playing the maps. Kind of surprised this issue wasn't caught already.\nHave a happy!\nTigertye . I only have snuffit sands in my campaign folder. How are you loading it as a single map? I did not know you could do that or was it a separate download. I would love to pick and choose any map like that.. Awesome thanks. Hmm, yes the Snuffit map has emergencies as a single game for me also. The Wishinwell map however still doesn't do emergencies as a single game. I'm thinking that maybe it's only specific maps in that campaign that have this issue. I agree with CycoOne that these maps need a careful review. Still shocked that no one noticed this earlier.. I started playing the Hoppalong map last night as a single. The emergencies don't work in that one either. I'm beginning to think it's a prob with both the campaign and some of the maps. I would be happy to share any of my save games you want. Just tell me where to send them and which one/ones you want.. interesting. So it should play properly then? hmmm Now I just have to figure out why the sudden and unexplained drop in rep. Thanks :). As for what you suggested MarkL, I have never looked at any of the files so I have no idea what the default is. Will it be easy to find in there?. TheCycoOne, I probably can I will see which file it is that does this. How do I get the save file to you? can I attch it here or do I need to upload it somewhere then provide the link?. @TheCycoONE dropbox. ok this is confusing. not a fan of this site. I have no desire to install their software on my puter. the file is only 530k. can I email it to you instead?. 1A Abscence Central.sav.zip\nwell that sounds easy enough. let's see if I did that right. It's my first time zipping a file in linux. \nThank you wolfy :). @TheCycoONE is that not the file you wanted?. cool. thanks\n. ",
    "Zababon": "@colinjmatt Thank you, the problem really is this. I apologize for the trouble, I found a mistake and she's stupid enough. It seemed to me that in the chapter \"Compiling on Linux\" you must choose one of the proposed commands and I chose the second one. But now I added the first command and the compilation was successful.. @Alberth289346 Most likely it's better.. ",
    "Icenowy": "@MarkL1961 The movie file is okay, and when I report the issue, the movie successfully plays. And this doesn't explain why Traditional Chinese and English work.\nBTW still tried your suggestion, fixed nothing, will hang just after \"\u5f00\u59cb\"(Start) is clicked.. @TheCycoONE \n\"\uff0c\", \"\u3002\", \"\uff1f\", \"\uff01\", \"\uff0d\", \"\uff1b\"\nare in the game translation now.. \\uff0c, \\u3002, \\uff1f, \\uff01, \\uff0d, \\uff1b\nas Unicode codepoints. After the punctuation, just similar to latin symbols.. ",
    "maye9999": "Same issue here. I've checked the #1240. It hangs exactly when showing the introduction_texts.  And adding whitespaces to end of lines solves it. However, whitespaces are already added to the demo level, but it still hangs when playing demo. I don't know why. But if I just play level 1, it fixes if I add whitespaces to end of lines.. ",
    "theGriant": "yes that's what i mean\nOp di 4 sep. 2018 om 02:14 schreef Stephen E. Baker \nnotifications@github.com:\n\nBy \"to match\" do you mean too many?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/1455#issuecomment-418208329,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/Ao9YVlKfjRtpsOXTFleq8wUbJswLgPOjks5uXcXcgaJpZM4WYFDS\n.\n\n\n-- \nMet vriendelijke groet,\nDennis de Reus\n. I didn't played the other levels. In a couple days I can tell it. In the next hospital I got the same problem.\nI change the code and hope that it works.\nI will respond quickly if this has helped.\nin the original levels of the game it will stop after a set of month's.\nExample\n\"\npopn[0].Month.Change       0       3\npopn[1].Month.Change       1       1\npopn[2].Month.Change       7       0\npopn[3].Month.Change       14      1\npopn[4].Month.Change       21      0\n\"\npopn = {\n    [0] = {Month = 0, Change = 4}, -- Standard: 4 patients the first month.\n    [1] = {Month = 1, Change = 1}, -- Then increase by one per month.\n    [2] = {Month = 29, Change = 0}, -- stop increase per month.\nOp do 6 sep. 2018 om 04:40 schreef mugmuggy notifications@github.com:\n\nJust checked the code, base_config.lua initiates and levels are to\noverride. As coffalot.level doesn't this stay in affect.\npopn = {\n[0] = {Month = 0, Change = 4}, -- Standard: 4 patients the first month.\n[1] = {Month = 1, Change = 1}, -- Then increase by one per month.\n},\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/CorsixTH/CorsixTH/issues/1455#issuecomment-418945147,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/Ao9YVhwOVbYsc5nuTCHVkz_MMNEUNBQlks5uYIsegaJpZM4WYFDS\n.\n\n\n-- \nMet vriendelijke groet,\nDennis de Reus\n. ",
    "bobucles": "I dunno if the relative rates of learning don't match vanilla mechanics. It may be that the XP growth rate is faster so the doctors get promoted more frequently before mastering specialties. Juniors have no problem learning multiple skills before maxing out.\nVanilla doctors gain a low amount of XP outside of training rooms. I found this most frequently with GP office doctors being suddenly promoted and slowly creeping towards 100% skill level. I'm not sure if other rooms give XP. It doesn't seem that corsix has this mechanic because I can't see anyone creep towards 100% skill.. ",
    "SeekingAdvice": "Hello, I just passing by and see these comments about the training, maybe I can contribute about the comparison in the original and CTH since i played both game simultaneously right now.\nWhat I know is in original TH, the time for a junior becomes a consultant in a training room with 6 bookcases, 3 lecture chairs and 1 skeleton roughly needs 1 full year. But what I see from CTH is the juniors become consultants in 6 months and everytime I see the specialty progression is the same with original game. This what makes many people confused about why the consultants very slow in learning specialties, when what actually happens is the juniors becomes consultant way too fast.\nWhen fixing this however you should pay attention about how this version staff happiness working, maintaining in training doctors for 6 month with falling happiness is already something, 1 year then worst. But that one is somewhat another separate problem.. ",
    "metsatron": "\nI believe I'm having the same if not a similar problem. Is there any way for now to temporarily disable earthquakes?\nEdit: I managed to get around this bug by fixing/replacing all machines before the earthquake hit.. Yeah I had the handy man get stuck even though by replacing the machine it didn't blow up the room. If I fired the stuck handyman the next one would come and do the same until I had fired all of them. I managed to unstick the handymen by editing the room.. ",
    "jonathan-gramain": "FWIW, I ran into a somewhat similar stacktrace, that led to the operation room being stuck. I compiled from source with commit c97629ed.\nA stack trace is included below, and the handler has been disconnected.\n...spital/CorsixTH/CorsixTH/Lua/rooms/operating_theatre.lua:181: attempt to compare number with nil\nstack traceback:\n        ...spital/CorsixTH/CorsixTH/Lua/rooms/operating_theatre.lua:181: in method 'getStaffMember'\n        ...jeux/dosbox/ThemeHospital/CorsixTH/CorsixTH/Lua/room.lua:333: in method 'onHumanoidEnter'\n        ...spital/CorsixTH/CorsixTH/Lua/humanoid_actions/pickup.lua:51: in local 'on_interrupt'\n        ...hemeHospital/CorsixTH/CorsixTH/Lua/entities/humanoid.lua:594: in method 'setNextAction'\n        ...meHospital/CorsixTH/CorsixTH/Lua/dialogs/place_staff.lua:60: in method 'close'\n        ...meHospital/CorsixTH/CorsixTH/Lua/dialogs/place_staff.lua:140: in method 'onMouseUp'\n        ...ux/dosbox/ThemeHospital/CorsixTH/CorsixTH/Lua/window.lua:1462: in field 'onMouseUp'\n        ...n/jeux/dosbox/ThemeHospital/CorsixTH/CorsixTH/Lua/ui.lua:673: in function <...n/jeux/dosbox/ThemeHospital/CorsixTH/CorsixTH/Lua/ui.lua:660>\n        (...tail calls...)\n        .../jeux/dosbox/ThemeHospital/CorsixTH/CorsixTH/Lua/app.lua:915: in function <.../jeux/dosbox/ThemeHospital/CorsixTH/CorsixTH/Lua/app.lua:910>\n. ",
    "Nox13last": "\nThe assertion suggests your original game data is corrupt. Where did you get it?\n\nI got it from an original disc. The disc is probably in one of my stacks somewhere, but because of their antiquity, they've fallen into disorganisation - I can't find the disc in question.\nThe size of the folder is about 180MB (I can never grasp the difference between \"Size\" and \"Size On Disk\", but they're 179MB and 180MB respectively). A fair bit out of the scope of the FAQ's assertion that a \"legitimate\" copy would be 150MB, but I looked inside and there are old save files from when I DOSBOX'd the game.\n\nLet me know what the result is of running the portable version, extracted to a different location.\n\n```An error has occurred in CorsixTH:\nLua\\graphics.lua:260: assertion failed!\nstack traceback:\n        [C]: in function 'assert'\n        Lua\\graphics.lua:260: in method 'loadRaw'\n        Lua\\ui.lua:402: in method 'setMenuBackground'\n        Lua\\app.lua:284: in method 'init'\n        CorsixTH.lua:136: in main chunk\n        [C]: in ?\n. No change.\nAn error has occurred in CorsixTH:\nLua\\graphics.lua:260: assertion failed!\nstack traceback:\n        [C]: in function 'assert'\n       Lua\\graphics.lua:260: in method 'loadRaw'\n        Lua\\ui.lua:402: in method 'setMenuBackground'\n        Lua\\app.lua:284: in method 'init'\n        CorsixTH.lua:136: in main chunk\n        [C]: in ?\nI'm just going to put the code change here in case I got it wrong.\nfunction Graphics:loadFont(sprite_table, x_sep, y_sep, ...)\n  -- Allow (multiple) arguments for loading a sprite table in place of the\n  -- sprite_table argument.\n  if type(sprite_table) == \"string\" then\n    local arg = {sprite_table, x_sep, y_sep, ...}\n    local n_pass_on_args = #arg\n    for i = 2, #arg do\n      if type(arg[i]) == \"number\" then -- x_sep\n        n_pass_on_args = i - 1\n        print('bg_size_1: ' .. tostring(bg_size[1]) .. ' bg_size_2: ' .. tostring(bg_size[2]))\n        break\n      end\n    end\n    sprite_table = self:loadSpriteTable(unpack(arg, 1, n_pass_on_args))\n    if n_pass_on_args < #arg then\n      x_sep, y_sep = unpack(arg, n_pass_on_args + 1, #arg)\n    else\n      x_sep, y_sep = nil, nil\n    end\n  end. The modified function is as follows:\nfunction UI:setMenuBackground()\n  local bg_size = menu_bg_sizes[1]\n  print('bg_size_1: ' .. tostring(bg_size[1]) .. ' bg_size_2: ' .. tostring(bg_size[2]))\n  self.background = self.app.gfx:loadRaw(\"mainmenu\" .. bg_size[2], bg_size[1], bg_size[2], \"Bitmap\")\n  self.background_width = bg_size[1]\n  self.background_height = bg_size[2]\nend\nAnd the output is:\nbg_size_1: 1920 bg_size_2: 1080\nAn error has occurred in CorsixTH:\nLua\\graphics.lua:260: assertion failed!\nstack traceback:\n        [C]: in function 'assert'\n        Lua\\graphics.lua:260: in method 'loadRaw'\n        Lua\\ui.lua:403: in method 'setMenuBackground'\n        Lua\\app.lua:284: in method 'init'\n        CorsixTH.lua:136: in main chunk\n        [C]: in ?\nDoes it matter that the laptop's resolution is 1280*800?. An error has occurred in CorsixTH:\nCreateTexture(D3DPOOL_DEFAULT): UNKNOWN\nstack traceback:\n        [C]: in method 'load'\n        Lua\\graphics.lua:260: in method 'loadRaw'\n        Lua\\ui.lua:403: in method 'setMenuBackground'\n        Lua\\app.lua:284: in method 'init'\n        CorsixTH.lua:136: in main chunk\n        [C]: in ?\nI really appreciate your help throughout this mess.\nDo you have any sort of system in place for soliciting donations?. > I do not accept donations, but thank you.\nThat's a shame. If you ever feel like opening a Ko-Fi or a Paypal.me, or something... I know, legally, you can't sell this (and probably had no designs on it), but I expect a lot of people would want to express gratitude for a game of this retro significance. The existence of Two Point Hospital alone shows how much people want it. But... *shrug*\n\nWe know from that error that the problem is related to acquiring memory from your video card to display the main menu. It's unfortunate that Direct 3D responded with 'UNKNOWN' instead of giving a more detailed description of the problem.\nIf I were to bet - I'd guess your video card / driver doesn't like allocating textures as large as 1920x1080.\n\nThat's likely. The laptop struggles to run Windows 7 without anything else on top of it. This laptop stays on W7, not willingly, but because the weight of W8 onwards will probably crush it.\n\nIn the short term....\n[Fixes]\n\nThe config was (is) set to a resolution of 1280*800. After commenting out the aforementioned line, though, the game brought up an interface asking me to select where the files are. It started playing the intro. I skipped it. It started playing the MIDI soundtrack, showed the syringe cursor on top of a plain black screen, and then did this...\nAn error has occurred!\nAlmost anything can be the cause, but the detailed information below can help t\ne developers find the source of the error.\nRunning: The movie_over handler.\nA stack trace is included below, and the handler has been disconnected.\nLua\\graphics.lua:260: assertion failed!\nstack traceback:\n        [C]: in function 'assert'\n        Lua\\graphics.lua:260: in method 'loadRaw'\n        Lua\\ui.lua:402: in method 'setMenuBackground'\n        Lua\\app.lua:462: in method 'loadMainMenu'\n        Lua\\app.lua:297: in field 'callback_on_destroy_movie'\n        Lua\\movie_player.lua:84: in upvalue 'destroyMovie'\n        Lua\\movie_player.lua:264: in method 'onMovieOver'\n        Lua\\app.lua:1098: in function <Lua\\app.lua:1097>\n        (...tail calls...)\n        Lua\\app.lua:915: in function <Lua\\app.lua:910>\n... it did not show this error in the game window. Had I not have alt+tabbed to the console, I would not have known that it was never going to load in this state.\nThe changes to this subroutine are as follows.\nlua\n  -- Load UI\n  corsixth.require(\"ui\")\n  if good_install_folder then\n    corsixth.require(\"game_ui\")\n    self.ui = UI(self, true)\n  else\n    self.ui = UI(self, true)\n   -- self.ui:setMenuBackground()\n    local function callback(path)\n      TheApp.config.theme_hospital_install = path\n      TheApp:saveConfig()\n      debug.getregistry()._RESTART = true\n      TheApp.running = false\n    end\n    self.ui:addWindow(UIDirectoryBrowser(self.ui, nil, _S.install.th_directory, \"InstallDirTreeNode\", callback))\n    return true\n  end\nDid I miss something?\nI feel it worth pointing out that I was curious to see what this would do on a computer that played the game anyway. It didn't seem to do anything - the main menu background loaded anyway.\n. Apparently.\nWell, it worked. The menu looks pretty grim and bleak now, but the game itself is functional. It loaded a scenario. Hospital staff were roaming.\nThen I went to the Options menu to change the render resolution. Upon nixing the fullscreen, the console vomited the following:\nAn error has occurred!\nAlmost anything can be the cause, but the detailed information below can help the developers find the source of the error.\nRunning: The window_resize handler.\nA stack trace is included below, and the handler has been disconnected.\nLua\\graphics.lua:260: assertion failed!\nstack traceback:\n        [C]: in function 'assert'\n        Lua\\graphics.lua:260: in method 'loadRaw'\n        Lua\\ui.lua:402: in method 'setMenuBackground'\n        Lua\\ui.lua:410: in method 'onChangeResolution'\n        Lua\\ui.lua:456: in method 'changeResolution'\n        Lua\\ui.lua:723: in function <Lua\\ui.lua:721>\n        (...tail calls...)\n        Lua\\app.lua:915: in function <Lua\\app.lua:910>\nDespite this, the game continues to function. I guess resizing the window tries to call the menu background again. I assume you want to hear about it. But it doesn't seem to be a critical error, so.... As far as I can tell, if the game is in Windowed Mode, the error happens the moment the window tries to show something. This is with the comment-out fixes in place. This does not seem to cause anything other than a vaguely-foreboding message in the console.\nZooming in and out doesn't seem to cause any showstopping issues, though zooming out to extreme scales (beyond the point where any useful information can be gleaned) causes the game to run extremely sluggishly and create odd gridlines along the map tiles. I wouldn't look too far into that - that's probably just the machine trying to render so much.\nIf there is anything else you would like to use me to investigate, then I'd be happy to be of use. Else, the immediate problem has been tackled and I would consider the ticket fulfilled.. I can't do it tonight, but I will do it first thing tomorrow.. Perfect!\nI just tried out the latter link. I had to destroy the config.txt file in addition to running the installer again, and then overwriting it with your build. But it works. The console didn't say anything beyond the fact that the software was a Trunk version and wouldn't search for updates because of that.\nThe menu background appeared (a little blurrier than I'm used to, but that's the nature of this particular beast, and probably still a bit higher than the graphical fidelity of the base-game). It seemed to scale correctly when I changed resolutions and switch into and out of full-screen (as far as I can tell, given that this screen is a weenie.\nThe window_resize handler didn't even complain in the Console.\nWell done.. ",
    "leiget": "Okay, thanks. I'll try to add code consistent with the current formatting.. Okay, I'm still figuring this stuff out. What you are saying is that you want me to:\n\nChange all the \"addKeyHandler\" keys back to how they were before.\nHave them modified according to the hotkey.txt file when loading a save game and when initializing the app.\nHave them modified by making a function to do so within every object with \"addKeyHandler\" is created.\n\nIs that right?. Okay, I get it.\nSo I'll need to bump SAVEGAME_VERSION to, say, 131, and then in an afterLoad class function I'll do basically something like:\nif old < 131 then\naddKeyHandler(hotkeys[\"ingame_ingame_panel_bankManager\"])\nAlthough I think that examples wrong?. I'll do that. I have to go to work now :cry: but I'll get to work on it tomorrow. Thanks for the help.. Yep, you can. I'm new to git: is it called a diff patch?. I merged it already.. I noticed that you got rid of some of the \"if old < \" statements that had addKeyHandler() functions in them. Do you want me to put those back in or ignore it?. My current issue is that I'm trying to add a setKeyHandlers() function to be used at the end of World:World(), but the ui hasn't been setup yet, so that means I can't use addKeyHandler() or removeKeyHandler(). . I'm confused. Are hotkeys saved when a level is saved, and then they are loaded when a save game is loaded?. I'll definitely get on those soon.. The current problem I'm working on is that whenever I save a game with the current version, and then I load that game with the same version but I have different hotkey(s) it loads the old hotkey configuration. Any idea what I could do, if anything?\nEDIT: Also, I added hotkeys for the dialogs to build a room, furnish the corridor, hire staff, and to edit rooms. Would it be a problem if I changed \"dialogBuildRoom()\", \"dialogFurnishCorridor()\", and \"dialogHireStaff()\" inside \"bottom_panel.lua\" to allow closing of these dialogs by simply pressing the hotkey again after they are open, and to also close any fullscreen dialogs that are open?. Any idea what I could do about this? . > that return should be removed.\nI've tested it with a couple of saves with three different key combos and it works as far as I can tell.. As far as  code reuse between print_table and table_toString, I'm not sure exactly what you'd like me to do. Do you not want too many global functions?\nAs I said, print_table prints and table_toString converts a table to string to be used now in menu items and the config_finder file.\nWould something like this work?\nhttps://gist.github.com/leiget/a6455105501a908ab8e94a60f3857a89. Okay, how about this? (It's not complete, yet)\n```lua\nfunction table_toString(obj, forMenu, printout, max_level, level)\n  assert(type(obj) == \"table\", \" Tried to use \" .. tostring(obj) .. \" with table_toString().\")\n  pt_reflist[#pt_reflist + 1] = obj\nforMenu = forMenu or false\n  printout = printout or false\n  max_level = max_level or 0\n  level = level or 0\nlocal temp_keyType\n  local spacer = \"\"\n  local result = \"\"\nif printout then\n    spacer = spacer .. \" \"\n  else\n    result = \"{\"\n  end\nfor k, v in pairs (obj) do\n    if printout then\n      print(spacer .. tostring(k), v)\n    end\ntemp_keyType = type(k)\n\nif temp_keyType == \"table\" then\n  result = result .. tostring(v)\n  v = k\nelseif temp_keyType == \"string\" or \"number\" then\n  result = result .. \"\\\"\" .. tostring(v) .. \"\\\"\"\nelseif temp_keyType == \"nil\" then\n  result = result .. \"nil\"\nend\n\nif type(v) == \"table\" and (not max_level or max_level > level) then\n  local found_ref = false\n  for _, ref in ipairs(pt_reflist) do\n    if ref == v then\n      found_ref = true\n    end\n  end\n\n  if printout then\n    if found_ref then\n      print(spacer .. \" \" .. \"<reference loop>\")\n    else\n      print_table(v, max_level, level + 1)\n    end\n  end\nend\n\nresult = result .. \",\"\n\nend\nif result ~= \"\" then\n      result = result:sub(1, result:len() - 1)\n  end\nresult = result .. \"}\"\n  pt_reflist[#pt_reflist] = nil\nreturn result\nend\n```. I changed the menu.lua file to add what you suggested and I'll get rid of it in my print_table/table_toString function.\nSo, if I were to make something like this:\nlua\nfunction print_table(obj, max_level, level, for_hotkey)\n  ...\n  if for_hotkey then\n    table_toString(obj)\n  end\nend\nThat would work for you?. Also, would it be a problem to add \"UIScrollSpeed\", \"UIShiftScrollSpeed\", and \"UIZoomSpeed\" to \".luacheckrc\"?. It would probably be best if you wrote a small patch for this specific issue so we can have exactly what you want.. I've merged but it says that loadstring is undeclared.. Soory, not sure where you mean that I should put that. You mean like this? (This is config_finder.lua around line 810)\n```lua\nfor k, str_val in pairs(hotkeys_values) do\n  if not loadstring then\n    function loadstring(str)\n      load(str)\n    end\n  end\nlocal status, lua_val = pcall(loadstring('return ' .. str_val))\n  if status then\n    hotkeys_values[k] = lua_val\n  end\nend\n```\nRegardless of how I do it, it says loadstring is undeclared, even if it's something simple like this:\nlua\nif not loadstring then\nend. Sure thing. I see what you're talking about. Should be simple enough.. Sure thing.. Made quite a few edits since last push. Still needs a bit of work, but I uploaded it so you can see what's going on.\nA screenshot:\n\n. I'm trying to find out how to get \"check_trailing_whitespaces.py\" (run locally) to show exactly what lines I need to edit to conform to the TravisCI build. Know how? Also, I'm not sure what the problem with the TravisCI build is when it says something like this:\nCorsixTH/Lua/app.lua:960:23: (W113) accessing undefined variable serialize\nAs I've already put \"serialize\" in \".luacheckrc\".. > On a related note, the default scroll keys should stay the arrows\nOkay.\n\ngit itself can find those line problems. git diff master --check\n\nThanks.. Does anyone know how to make my fork have a successful travis-ci build? I'm completely confused as to how it works.. That's weird, I have it completely updated on my computer but it doesn't seem to upload. I can run luacheck locally and it says I have 0 warning or errors.\nEDIT: The problem was that I was using git add * instead of git add .. git add * adds everything but dot files, but git add . adds all files, including dot files.. Whenever the numlock is off and I try to assign a keypad key, it doesn't seem to work. Is there a problem with keypad key input when the numlock is off? I'm trying to find out if there's something wrong with my code or not.. Besides the keypad thing, the only things I can think of are:\n\nDisable the \"global_exitApp\" hotkey while assigning hotkeys? (Alt-F4 still closes, even without adding \"global_exitApp\" in ui.lua)\nHave modifier keys for other languages. Ex: \"STRG\" for German's \"CTRL\".. It'd probably be more expedient, since you seem to know what you want.. I changed those lines in addKeyHandler() but forgot to change them in removeKeyHandler:\n\nlua\nif self.app.hotkeys[keys] ~= nil then\n  if type(self.app.hotkeys[keys]) == \"table\" then\n    temp_keys = shallow_clone(self.app.hotkeys[keys])\n  elseif type(self.app.hotkeys[keys]) == \"string\" then\n    temp_keys = shallow_clone({self.app.hotkeys[keys]})\n  end\nelse\nSorry.. Cool! So do you want me to merge this with my fork?. Okay, anything else that needs doing?. Do you mean if the player tries to set scroll up in the hotkey window as \"CTRL+W\", it won't work? You don't mean the \"Speed Shift\" modifer won't work, do you?. Okay, I'll write it to where it will get rid of any modifier, as it's not really nessecary and it might conflict with the speed shift modifier.. Appveyor failed. Was it something I did? It says \"C:/projects/corsixth/vcpkg/downloads/temp/bzip2-1.0.6.tar.gz\" doesn't have the expected hash.. I added the fullscreen/close statements so that if the player wants to move from one dialog to the next they can do so without having to close the previous one, making it more streamlined. I should have discussed it with you before changing it.. If a python file doesn't have a newline at the end, does it have a little arrow pointing at a \"no\" symbol?. Alright, then, the newline seems to be there. Anything else that needs to be done?. I don't know much about git. I've looked up rebasing and merging and I can't make heads or tails of it. Just do what you think is best.. Hey. Just wondering what the status was on this PR. Anything you need me to do?. I might as well try to rebase it.\nWould I need to do this:\ngit rebase master\nor\ngit rebase origin/master. I'm trying to rebase, but I can't seem to get it. I tried branching and other things, but the rebase doesn't seem to be doing anything.. Lol, sorry. I should of just left i t alone. Do you need the original code? I mean my code.. Okay, I won't mess with it anymore.. I go to bed in 3 hours, so I'll try to fix it tomorrow. If I'm not able to finish it by 1 pm EST, then I'll fix it after the merge.. Fixed it. And I wanted my fork to be back to working order so I pushed it again. Sorry if that makes things messier.\nThe changes I made to fix the bug you mentioned are in \"/CorsixTH/Lua/dialogs/resizables/hotkey_assign.lua\" It's just a hotkeys_backedUp = false in the accept buttons function, and I added a shallow_clone in the cancel buttons function so it would copy the backup table instead of just pointing to it, just in case not copying it causes problems.\n. Ugh, and when I copied everything I forgot luacheck. Sorry again.. Okay, I'll have to get on that tomorrow. As far as the git upstream thing you mention, I'm not sure I have upstream as remote.. I edited the \"Hotkeys\" and \"Programming Ideas\" wiki pages.. Sorry, I don't know why I deleted this. I'll change it back in my next commit.. Fixed.. I can try but Table2String returns a string while print_table prints directly to the terminal.\nTable2String also outputs a table like this: {\"shift\",\"q\"}\nWhile print_table outputs like this:\n1 shift\n2 q\n It seems that having to change print_table would change it's original purpose a little too much.\nWould making Table2String a local function inside config_finder.lua work for you? That's the only place it's used right now. I'll also change it to \"table_toString\" to fit the naming method, as I should of before.. Oh, yeah. If you'd like, you can.. No problem. Take your time. I'll work on testing and a couple other things in the meantime.. Needs an extra closing parentheses at the end. Or maybe it doesn't matter now that I've already merged?. Because if \"self.app.hotkeys[\"ingame_scroll_shift\"]\" is a string then it needs to be converted to a table before it gets looped through, and considering \"temp_table\" is local it's accessed quickly and freed after it's used.. I forgot Python needs a newline at the end of the file.. Yes, to be the same order as the english table.. Like this?\nlua\nif type(temp_keys) == \"table\" then\n      temp_keys_copy = shallow_clone(temp_keys)\n    elseif type(temp_keys) == \"string\" then\n      temp_keys_copy[#temp_keys_copy+1] = temp_keys\n    end. Do you want me to make it the same as my response to your \"game_ui.lua\" comment below?\nlua\nif type(self.app.hotkeys[\"ingame_scroll_shift\"]) == \"string\" then\n    temp_table[#temp_table+1] = self.app.hotkeys[\"ingame_scroll_shift\"]. But won't that just be a reference, and when the first key is removed on line 409:\nlua\nlocal key = table.remove(temp_keys, #temp_keys):lower()\nWon't temp_keys_copy also lose its first element, as it's only a reference to temp_keys?. Okay, I thought it would just be a reference and not a new table.. Okay, I changed it.. Okay, changed it to \nlua\nif type(self.app.hotkeys[\"ingame_scroll_shift\"]) == \"string\" then\n    temp_table = {self.app.hotkeys[\"ingame_scroll_shift\"]}. Changed.. Fixed.. Okay.. It's still used here in \"config_finder.h\", at line 808:\nhttps://github.com/leiget/CorsixTH/blob/9cdf151af7a5e4e0d995a0cdac1802486efc4d1b/CorsixTH/Lua/config_finder.lua#L807\nIf we should use a different function, what one would it be?. Nevermind, I just saw the second comment after this. Changed.. Changed.. Changed.. The problem is that each \"w\" is a different dialog class. i.e. \"UIBuildRoom\" in \"dialogBuildRoom()\" and \"UIHireStaff\" in \"dialogHireStaff()\". Also, there are different tutorial steps in a few of these dialogs that are different.. Since \"w\" and \"fullscreen\" variables are used so often, maybe I should define them in file scope and just change them when I need them, to keep from having to create and destroy these variables over and over through the course of a level, as the player might open these dialogs hundreds of times. Would that be enough?. Okay.. Do you mean the length of lines like the one at line 780?. How about this?\n\n. ",
    "mingodad": "Yes the tool lua2ljs does the convertion on almost all Lua code, except dynamic Lua code inside strings, C/C++ code, auxiliar scripts and makefiles, LJS also flag as warning/error duplicate variable declarations and a revision is needed mainly using \"ljsc -p -l ljsSource.ljs > /dev/null\" to only compile and emit the warnings/error to stderr, then several text scans to search and replace \"nil\", \".lua\" and Lua code inside strings, ...\nThen run the tests if available to check that it's working properly (at least with the tests).. ",
    "danabr": "Remove trailing whitespace.\n. ",
    "ryunp": "iStartY? It's only a func declaration, but caught my OCD\n. "
}