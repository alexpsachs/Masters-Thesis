{
    "Bryan-Legend": "Sorry the error message is so bad.\nI'm guessing that it's probably because the hostname isn't on the\nproduction acme servers whitelist. They are only white listing the\nwww.domain.com and domain.com for the beta.\nOn Friday, November 13, 2015, Rouzax notifications@github.com wrote:\n\nJust downloaded your project to start tinkering with SSL certificates for\nIIS.\nDownloaded: 0656bc6\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/commit/0656bc621a279553dc32fb3ec7e51ce3e6cdf040\nversion\nWhen running on Windows I get a stooped working error after selecting the\nIIS website I want to fetch a certificate for.\n[image: image]\nhttps://cloud.githubusercontent.com/assets/4103090/11144063/1dd7fae0-89fa-11e5-966b-a3172f9018cd.png\nRunning from an elevated Command Prompt\nC:\\letsencrypt>letsencrypt.exe\nLet's Encrypt\nUse production Let's Encrypt server? (Y/N)\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: C:\\Users\\xxx\\AppData\\Roaming\\LetsEncrypt\\httpsacme-v01.api.letsencrypt.org\nLoading Signer from C:\\Users\\xxx\\AppData\\Roaming\\LetsEncrypt\\httpsacme\n-v01.api.letsencrypt.org\\Signer\nGetting AcmeServerDirectory\nLoading Registration from C:\\Users\\xxx\\AppData\\Roaming\\LetsEncrypt\\httpsacme-v01.api.letsencrypt.org\\Registration\nChecking Renewals\n No scheduled renewals found.\nScanning IIS 7 Site Bindings for Hosts (Elevated Permissions Required)\nIIS Bindings\n 1: music.domain.com (C:\\inetpub\\wwwroot\\Ampache)\n 2: ebooks.domain.com (C:\\inetpub\\wwwroot\\Calibre)\n 3: tvseries.domain.com (C:\\inetpub\\wwwroot\\Sickbeard)\n 4: torrent.domain.com (C:\\inetpub\\wwwroot\\uTorrent)\n 5: movies.domain.com (C:\\inetpub\\wwwroot\\CouchPotato)\n 6: headphones.domain.com (C:\\inetpub\\wwwroot\\HeadPhones)\nA: Get Certificates for All Bindings\n Q: Quit\nWhich binding do you want to get a cert for: 1\nAuthorizing Identifier music.domain.com Using Challenge Type http-01\nUnhandled Exception: LetsEncrypt.ACME.AcmeClient+AcmeWebException: Unexpected er\nror ---> System.Net.WebException: The remote server returned an error: (403) For\nbidden.\n   at System.Net.HttpWebRequest.GetResponse()\n   at LetsEncrypt.ACME.AcmeClient.RequestHttpPost(Uri uri, Object message) in C:\n\\Users\\Bryan\\Documents\\letsencrypt-win-simple\\letsencrypt-win\\letsencrypt-win\\Le\ntsEncrypt.ACME\\AcmeClient.cs:line 598\n   --- End of inner exception stack trace ---\n   at LetsEncrypt.ACME.AcmeClient.AuthorizeIdentifier(String dnsIdentifier) in C\n:\\Users\\Bryan\\Documents\\letsencrypt-win-simple\\letsencrypt-win\\letsencrypt-win\\L\netsEncrypt.ACME\\AcmeClient.cs:line 261\n   at LetsEncrypt.ACME.Simple.Program.Authorize(String dnsIdentifier, String web\nRootPath) in C:\\Users\\Bryan\\Documents\\letsencrypt-win-simple\\letsencrypt-win-sim\nple\\Program.cs:line 399\n   at LetsEncrypt.ACME.Simple.Program.Auto(TargetBinding siteHost) in C:\\Users\\B\nryan\\Documents\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 200\nat LetsEncrypt.ACME.Simple.Program.Main(String[] args) in C:\\Users\\Bryan\\Docu\nments\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 152\nC:\\letsencrypt>\nIt appears there are reference directly to your user folder\n\"C:\\Users\\Bryan\\Documents\\\"\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/1.\n. Yes, it's because of the beta.\n\nTest server doesn't have a whitelist limit, but it's certs aren't\nrecognized by any browsers.\nOn Fri, Nov 13, 2015 at 4:47 AM, Rouzax notifications@github.com wrote:\n\nDomain.com is not the actual domain name, but didn't realise I had to\nwhitlist the domains first. Is that because let's encrypt is still in beta?\nWhat is the difference between using the production server and not?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/1#issuecomment-156407835\n.\n. Release 1.4 has better error reporting for this case.\n. Good idea with the manifest. I'll get that done.\n\nI thought I had fixed the error your seeing with the 1.0 build that I released yesterday. Can you confirm you're using the latest release.\nAs a workaround to the problem you can manually add an https binding in IIS manager. The error doesn't seem to happen when it updates a binding, just on creating a new one.\n. It might be this problem:\nhttp://blogs.msdn.com/b/varunm/archive/2013/06/18/bind-multiple-sites-on-same-ip-address-and-port-in-ssl.aspx\n. Do you already have a different https binding setup on the same IP address?\n. I've found the problem and will be creating a new build soon. The certs are\nnot getting placed into the certificate store correctly so they are not\nactually usable in the current build.\nYes. I'm Bryan. The paths shown are debug info to line numbers in the\nsource code on my computer where I compiled the program.\nOn Sat, Nov 14, 2015 at 4:30 PM, amlynnworth notifications@github.com\nwrote:\n\n@Long-Coder There is nothing else bound to https on this particular\nserver, no conflicts.\nI tried removing the server cert, rebooting, and putting everything back\nin manually and I still ended up with that message about the specified\nlogon session not existing.\nDid the presence of 'Bryan' make any sense to you in that screenshot -\nlook at the paths under \\users\\ ??\nI had downloaded the files to test ~30-60 minutes before posting my\nmessage, so they should have been \"latest.\" The file properties on\nletsencrypt.exe showed product version 1.0 and file version 0.0.0.0.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/2#issuecomment-156758034\n.\n. Okay. This should be fixed now. Give the new 1.1 release a try.\n\nMan that was some really bad error messages coming from Microsoft. I was getting the same errors in IIS manager. Only clue I found was in the event viewer.\n. I don't think I'll ever delete old certs. We have no guarantee they still aren't being used somewhere.\nI did start adding timestamps to the names so that we can tell them apart better.\n. Hi @amlynnworth, thanks for the great feedback. \nI've added a prompt to handle crashes better. Will be nice if renews fail to pop up and wait so user can know.\nOn the mime type. I've mostly convinced the ACME team to switch to .txt files to avoid that problem and others. Not sure when server change will happen.\nAlso, I'm checking the SNI box by default now on IIS 8.\n. @riipah Can you check the event viewer for more info when that error hit? Also, what version of IIS are you running?\n. What cert store was the old cert placed in? I'm wondering if changing cert\nstores caused the problem.\nOn Wed, Dec 2, 2015 at 5:13 PM, amlynnworth notifications@github.com\nwrote:\n\nI saw that same error \"A specified logon session does not exist. It may\nalready have been terminated\" with v1.6 yesterday. My test was on an IIS\nsite that already had a cert in place. I was able to switch to the new\nLetsEncrypt cert manually without any further problems.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/2#issuecomment-161473581\n.\n. Can it do that for different domains?\n\nFor instance, would it work for domain.com and example.com, if they are\nboth whitelisted?\nOn Sat, Nov 14, 2015 at 2:58 PM, Mat notifications@github.com wrote:\n\nThe client should request a certificate for all names that are associated\nwith a site. For example I have the a site with the following bindings:\n[ip] 443\ndomain 443\nwww.domain 443\nNow the letsencrypt client should request one certificate for the names:\ndomain and www.domain\nThis is what the \"official\" letsencrypt client is currently doing:\nletsencrypt/letsencrypt#369\nhttps://github.com/letsencrypt/letsencrypt/issues/369\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/3.\n. Also does each host name need a separate authorization too be passed?\n\nOn Sat, Nov 14, 2015 at 3:31 PM, Bryan Livingston <bryanlivingston@gmail.com\n\nwrote:\nCan it do that for different domains?\nFor instance, would it work for domain.com and example.com, if they are\nboth whitelisted?\nOn Sat, Nov 14, 2015 at 2:58 PM, Mat notifications@github.com wrote:\n\nThe client should request a certificate for all names that are associated\nwith a site. For example I have the a site with the following bindings:\n[ip] 443\ndomain 443\nwww.domain 443\nNow the letsencrypt client should request one certificate for the names:\ndomain and www.domain\nThis is what the \"official\" letsencrypt client is currently doing:\nletsencrypt/letsencrypt#369\nhttps://github.com/letsencrypt/letsencrypt/issues/369\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/3.\n. Mat, does SAN help alleviate the same problem that SNI addresses? Can it be\nused to host lots of domains on the same IP address?\nhttps://en.wikipedia.org/wiki/Server_Name_Indication\n\n\nOn Sat, Nov 14, 2015 at 7:03 PM, Mat notifications@github.com wrote:\n\nSee my comments in ebekker/letsencrypt-win#13\nhttps://github.com/ebekker/letsencrypt-win/issues/13 on how to add the\nSAN to the certificate request.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/3#issuecomment-156770113\n.\n. I should be able to get SAN working once https://github.com/ebekker/ACMESharp/issues/13 is complete.\n. This was caused by the domain not being whitelisted.\n\nVersion 1.4 has better error reporting that will explain this case better.\n. I'm only adding or updating a single binding as far as I know.\nSee the ConfigureBinding method here: https://github.com/Lone-Coder/letsencrypt-win-simple/blob/master/letsencrypt-win-simple/Program.cs\n. Very peculiar. Thanks for the solid repro in the screencast.\nOn Tue, Nov 17, 2015 at 1:54 PM, Sitting-Duc notifications@github.com\nwrote:\n\nActually I'm going to re-open this as the behavior does need to be changed\nsomehow. Watch this for explanation.\nhttp://screencast-o-matic.com/watch/coXbY7hFfF\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/5#issuecomment-157503450\n.\n. Try adding the bindings manually in IIS to see if IIS does the same\nbehavior for some reason. Also, try checking the \"Require Server Name\nIdentification\" to see if that changes it. Does it also do it when you go\nthru reverse order?\n\nMight be related to this:\nhttp://blogs.msdn.com/b/varunm/archive/2013/06/18/bind-multiple-sites-on-same-ip-address-and-port-in-ssl.aspx\nOn Tue, Nov 17, 2015 at 2:12 PM, Bryan Livingston <bryanlivingston@gmail.com\n\nwrote:\nVery peculiar. Thanks for the solid repro in the screencast.\nOn Tue, Nov 17, 2015 at 1:54 PM, Sitting-Duc notifications@github.com\nwrote:\n\nActually I'm going to re-open this as the behavior does need to be\nchanged somehow. Watch this for explanation.\nhttp://screencast-o-matic.com/watch/coXbY7hFfF\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/5#issuecomment-157503450\n.\n. Might be possible. Perhaps it should be a plug in with the new system I just created.\n\n\nTake a look at https://github.com/Lone-Coder/letsencrypt-win-simple/blob/master/letsencrypt-win-simple/Plugin/Plugin.cs\nThe problem I'm seeing is serving the answer file. I think it has to be done over http.\n. So I've tried setting the handlers to just the staticFile one using this web.config \n<?xml version = \"1.0\" encoding=\"UTF-8\"?>\n <configuration>\n     <system.webServer>\n         <staticContent>\n             <mimeMap fileExtension = \".*\" mimeType=\"text/json\" />\n         </staticContent>\n        <handlers>\n            <clear />\n            <add name=\"StaticFile\" path=\"*.\" verb=\"*\" type=\"\" modules=\"StaticFileModule,DefaultDocumentModule,DirectoryListingModule\" scriptProcessor=\"\" resourceType=\"Either\" requireAccess=\"Read\" allowPathInfo=\"false\" preCondition=\"\" responseBufferLimit=\"4194304\" />\n        </handlers>\n     </system.webServer>\n </configuration>\nBut it just gave me this error:\n\nLet me know if you can figure out a way around that problem.\nI've been asking the ACME team to change the protocol to use a .txt file. Would your configuration be able to serve a .txt file by default?\n. The renewals probably aren't going to work because the client writes out a\nweb.config to the acme-challenge folder each time. Try putting a web.config\nin the .well-known directory with just the handlers section.\nOn Wed, Nov 18, 2015 at 9:38 AM, Felix Mann notifications@github.com\nwrote:\n\nClosed #7 https://github.com/Lone-Coder/letsencrypt-win-simple/issues/7.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/7#event-468147467\n.\n. There's not an easy way. When I tested it I just set the renewal period to\na negative value in my code. Maybe set your server date?\n\nOn Wed, Nov 18, 2015 at 10:04 AM, Felix Mann notifications@github.com\nwrote:\n\nIs there any way to test this?\nI tried manually issuing the command that was in the Task Scheduler, but\nit tells me it won\u2019t renew until 01-17-2016 anyway\u2026\n\nOn 18 Nov 2015, at 17:56, Bryan Livingston notifications@github.com\nwrote:\nThe renewals probably aren't going to work because the client writes out\na\nweb.config to the acme-challenge folder each time. Try putting a\nweb.config\nin the .well-known directory with just the handlers section.\nOn Wed, Nov 18, 2015 at 9:38 AM, Felix Mann notifications@github.com\nwrote:\n\nClosed #7 <\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/7>.\n\u2014\nReply to this email directly or view it on GitHub\n<\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/7#event-468147467\n.\n\u2014\nReply to this email directly or view it on GitHub <\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/7#issuecomment-157777398\n.\n\n\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/7#issuecomment-157779741\n.\n. Yes, you'll want to replace the old files.\n\nI've changed the data structures of the scheduled renewals a bit, so you'll probably need to run thru the setup again to get them working correctly.\nIf everything is working fine it's probably smarter to wait. I'm wanting to add email reporting if a renewal fails and also SAN support in the future.\n. https://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.6 will check SNI by default now on new bindings.\n. Go for it! Can you have it done by launch?\nOn Fri, Nov 20, 2015 at 4:39 PM, David Spector notifications@github.com\nwrote:\n\nLoneCoder has done a great job to call this client a simple client. But I\nam concerned that in the real world prototypes sometimes get adopted and\nextended to meet real world needs.\n.NET is a wonderful dev env in the sense that it supports several\nlanguages and has many features. It makes development quicker and easier.\nIt is also standard on all modern Windows computer systems.\nHowever, if the use of HTTPS is to be made universal, and if one use case\nis for older computers to be converted into internet servers for various\npurposes, then we have a potential problem: most older Windows systems\ndon't have .NET installed, or if they do, it's frequently an either buggy\nor limited version of .NET. (They also may not use IIS or even Apache to\nserve webpages. LE should work even with tiny HTTPS servers such as\nMongoose to help promote its universal use on old Windows systems.)\n.NET is fine for a quickly-written and easily-extended demonstration\nclient, a proof of concept, but I would urge that you make sure that your\nsimple client isn't mistaken or used as the base for the final LE client\nsoftware in the future. I would suggest that the delivered LE client for\nWindows should have as few dependencies as possible, for ease of\ninstallation and knowing how to respond to error messages. LE needs\nbulletproof software, because a variety of users of various degrees of\nknowledge and experience will be using it.\nI recommend that someone start now to write a client that will not use\n.NET, Python, bash command language, or anything else having a library or\ninterpreter that must be installed by the user. Users may not know how to\ninstall a dependency and may not know how to respond to an error or a\nversion problem detected in a dependent library. That's part of what makes\nthem universal LE users.\nI realize that this makes the final client much harder to write, but LE is\nintended to be used by anyone running a website or an intranet or perhaps\neven a browser-based application, and that is an enormous and diverse\naudience. At some point, someone must take courage and eliminate run time\ndependencies, or LE may be in trouble, at least on Windows systems.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/9.\n. Perhaps the Go client and library would be portable enough:\nhttps://github.com/xenolf/lego\n\nOn Fri, Nov 20, 2015 at 5:03 PM, David Spector notifications@github.com\nwrote:\n\nI am noting problems that are completely obvious to you for the benefit of\nothers who may mistake or misunderstand the goal of a simple LE client such\nas yours. Snide remarks are not helpful.\nTo answer your question, I can't see how full Windows support will be\navailable by Dec. 2015. It will be an achievement to have ACME running and\nbulletproof even on Linux servers, and this at the expense of requiring\nPython, Bash, and other dependencies. Complete automation is fine, but\nusing dependencies should be accepted only for a specified period of time,\nIMO.\nThe advantage of your approach is that we can have something that works on\nWindows by December. But it will not have the full LE functionality,\ncorrect?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/9#issuecomment-158563225\n.\n. The 443 https port is probably already in use. Try checking the \"Require\nServer Name Identification\" on all the https bindings, but be aware that\nSNI doesn't work on IE on XP machines (2.5% of browsers currently).\n\nSee:\nhttp://blogs.msdn.com/b/varunm/archive/2013/06/18/bind-multiple-sites-on-same-ip-address-and-port-in-ssl.aspx\nOn Tue, Nov 24, 2015 at 8:32 AM, poynter2 notifications@github.com wrote:\n\nHi,\nRuns through fine, adds the certificate, private key, scheduled task,\nbinding, etc. etc. but the site stops and says \"the process cannot access\nthe file becuase it is being used by another process (Exception from\nHRESULT: 0x80070020).\nIf I remove the newly created binding, then the site starts fine.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/10.\n. That's pretty odd. Is domain whitelisted? Try with the --test option to use test server.\n. I can do SNI support fairly easily. I just need to decide if I should prompt for it or just set it always and screw IE on XP. Leaning towards the later. Also, it's only an IIS 8 feature.\n\nI'm able to use the Personal certs with SNI enabled on my system. I've changed it over to web hosting just in case. Maybe all SNI certs have to be in same store?\n. K. https://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.6 will check SNI on new bindings if it's available.\n. Cool. Good to know. WebHosting should be prefered.\n. The client only scans for http bindings, because they're needed for the authorization process.\nLooks like the IDN names should be filtered though.\n. I've mostly convinced the ACME working group to switch to .txt files to avoid this problem. Not sure when it will happen though.\n. Fantastic! Well done!\n. I've no idea. It'd be really cool if the ACME server was smart enough to do that.\nEither way the client software for the renewals should work.\n. It should be as easy as implementing a class here:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/tree/master/letsencrypt-win-simple/Plugin\nAll it takes is two methods, one to scan apache config for host names and\nanother to config a cert for a host. Since apache uses XML configs now and\n.net has great XML support it should be trivial.\nOnly reason I've not done it is I don't use apache any more so I've got no\ntest base.\nOn Thu, Dec 3, 2015 at 1:54 PM, vespino notifications@github.com wrote:\n\nAre you guys looking into Apache too? Would be great to have it work with\nit!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/17.\n. I thought they were XML, but taking a look they clearly aren't. Maybe SGML.\nSo it will be a little more difficult than I thought.\n\nOn Thu, Dec 3, 2015 at 2:51 PM, vespino notifications@github.com wrote:\n\nI'm using an older version of apache (2.2.4). I'm not familiar with the\nxml configs. I think I might have to setup a testing server :)\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/17#issuecomment-161795858\n.\n. Is IIS installed? What OS are you on?\n\nOn Thu, Dec 3, 2015 at 4:13 PM, vatara notifications@github.com wrote:\n\nI get this error after getting the certificate:\nOpening Certificate Store \"WebHosting\"\nSystem.Security.Cryptography.CryptographicException: The system cannot find the file specified.\nat System.Security.Cryptography.X509Certificates.X509Store.Open(OpenFlags flags)\nat LetsEncrypt.ACME.Simple.Program.InstallCertificate(Target binding, String pfxFilename, X509Store& store, X509Certificate2& certificate) in C:\\Users\\Bryan\\Documents\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 266\nat LetsEncrypt.ACME.Simple.Program.Auto(Target binding) in C:\\Users\\Bryan\\Documents\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 239\nat LetsEncrypt.ACME.Simple.Program.Main(String[] args) in C:\\Users\\Bryan\\Documents\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 171\nI'm not sure why that is...do I have to setup something with the\ncertificate store in Windows?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/18.\n. The manifest forces admin now so that'll never be the problem.\n\nIf you goto Control Panel->Manage Computer Certificates is there a Web\nHosting group like this:\n[image: Inline image 1]\nOn Thu, Dec 3, 2015 at 4:45 PM, vatara notifications@github.com wrote:\n\nOh, yes, IIS is installed also.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/18#issuecomment-161826300\n.\n. WebHosting is some special store that's implemented differently for perf.\n\nI'll add some code to detect it and drop down to Personal if it's missing.\nOn Thu, Dec 3, 2015 at 4:52 PM, Oguzhan YILMAZ notifications@github.com\nwrote:\n\nNo WebHosting store name on Server 2008 R2 default but exist on Windows\n2012 version. May be you can create manually.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/18#issuecomment-161827460\n.\n. I'm Bryan. It's the location of the source code where it was compiled from.\n\nOn Fri, Dec 4, 2015 at 12:08 AM, William Stam notifications@github.com\nwrote:\n\nwhere does it find the Bryan from? is it hard coded?\nhttps://camo.githubusercontent.com/6a963a339a4b3527bb3ba53fd6e9a694a3bfb88b/687474703a2f2f7075752e73682f6c494f43372f623938613633653163662e706e67\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/18#issuecomment-161895386\n.\n. Fixed in 1.7\n\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.7\n. I would have done this already but if fails on my machine with this:\nhttps://cloud.githubusercontent.com/assets/920120/11246535/4c19201c-8dd5-11e5-8818-4f2091f1f4ea.png\nSee https://github.com/Lone-Coder/letsencrypt-win-simple/issues/7\n. Shouldn't there need to be a delay then before we submit SubmitAuthorizeChallengeAnswer, which is telling the server that the answer is available?\nDoes the ACME server really return invalid and then several seconds later change it's mind to valid? It's in an infinite loop while the server keeps returning pending.\n. Fixed in 1.7\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.7\n. It updates the existing bindings to use the new certificate. Didn't know there was a renewal thing in IIS.\n. There will be a fix for this today.\nOn Fri, Dec 4, 2015 at 10:30 AM, Colin Ramsay notifications@github.com\nwrote:\n\nUpon further investigation, because this is a Windows 2008 server it\ndoesn't have that certificate store. The readme specifically mentions IIS7\nand doesn't say anything about an incompatibility with 2008, so I'm not\nsure if this is by design or if it's an oversight.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/24#issuecomment-162029229\n.\n. Fixed in 1.7\n\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.7\n. It's a good idea. Maybe we could just parse and handle physical locations\nlike this: ftp://username:password@hostname/\nOr it could be another plugin type with a different menu option.\nWe always have to worry about automating renewals though.\nOn Fri, Dec 4, 2015 at 5:46 PM, Nathan D notifications@github.com wrote:\n\nWhen manually generating a certificate, it would be useful to be able to\nFTP the challenge file to the host. Could be useful for people who may not\nhave direct access to the host (like people who use a web hosting service).\nAt a glance the current BeforeAuthorize implementation would need to be\naltered if it were to be used in ManualPlugin.cs to perform this\nfunctionality.\nThoughts?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/25.\n. The pem files are created at %appdata%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n\nThat's interesting about the chain not being provided. I think we had to get that issuer cert to generate the .PFX file.\n@ebekker is that something we can fix for writing the .pem files out?\n. Since it passed 55 other virus scanners and Qihoo is know for false\npositives (\nhttp://www.tomsguide.com/us/qihoo-cheat-accusations,news-20867.html) we can\nsafely consider this a false positive bug in their scanner. If you'd like\nyou can report it to them.\nTo be safe I've scanned my build system for viruses and it came up clean.\nI'd like to start signing the builds some day to fight potential tampering\nand pass the unknown executable warnings from windows.\nOn Mon, Dec 7, 2015 at 1:25 AM, Stefan Schulze notifications@github.com\nwrote:\n\nJust for your information:\nhttps://www.virustotal.com/de/file/c85d9d52b12462ad9bcd059c2183c773b906b21037890b77af87c8d911d4e40e/analysis/\nMaybe you find out why.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/28.\n. I think there's already an option for it. Should be 5 minutes for me to hook it up.\n. No. This is IIS's idea of a good error message. I've actually gotten it in\nIIS manager before.\n\nThere's more info in the event viewer but it's usually caused by something\nelse being open on port 443. Or some problem with IIS not being able to\nhandle multiple https sites on an IP without SNI.\nOn Mon, Dec 7, 2015 at 9:44 AM, Scott R. Frost notifications@github.com\nwrote:\n\nIt looks like it added the cert to IIS correctly, but it failed with this\nmessage when attempting to commit the binding changes. I have my\nAdministrator account renamed (for security, this is a best practice).\nPerhaps that has something to do with it?\nOpened Certificate Store \"WebHosting\"\n Adding Certificate to Store\n Closing Certificate Store\n Updating Existing https Binding\n Committing binding changes to IIS\nSystem.ComponentModel.Win32Exception (0x80004005): A specified logon session does not exist. It may already have been te\nrminated\n   at Microsoft.Web.Management.Utility.HttpApiWrapper.CreateSSLBinding(IPEndPoint endPoint, String hostName, HTTP_SERVIC\nE_CONFIG_SSL_PARAM_MANAGED allSSLData, SslFlags sslFlags)\n   at Microsoft.Web.Management.Utility.HttpApiWrapper.CreateSSLBinding(IPEndPoint endPoint, String hostName, Byte[] cert\nificateHash, String certificateStoreName, SslFlags sslFlags)\n   at Microsoft.Web.Administration.BindingManager.BindingTransaction.Commit()\n   at Microsoft.Web.Administration.BindingManager.Save()\n   at Microsoft.Web.Administration.ServerManager.CommitChanges()\n   at LetsEncrypt.ACME.Simple.IISPlugin.Install(Target target, String pfxFilename, X509Store store, X509Certificate2 cer\ntificate) in C:\\Users\\Bryan\\Documents\\letsencrypt-win-simple\\letsencrypt-win-simple\\Plugin\\IISPlugin.cs:line 116\n   at LetsEncrypt.ACME.Simple.Program.Auto(Target binding) in C:\\Users\\Bryan\\Documents\\letsencrypt-win-simple\\letsencryp\nt-win-simple\\Program.cs:line 259\n   at LetsEncrypt.ACME.Simple.Program.Main(String[] args) in C:\\Users\\Bryan\\Documents\\letsencrypt-win-simple\\letsencrypt\n-win-simple\\Program.cs:line 180\nPress enter to continue.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/31.\n. I'll see if I can flag it as non-hidden.\n. @ndouthit Yes. That was the thinking. I guess that was not the setting I thought it was.\n. Yes. To add an email just delete the registration file. It's under\n%appdata% folder. It's best to regenerate the certs as well, so that you'll\nget an email in theory if they don't renew.\n\nOn Wed, Dec 23, 2015 at 9:17 AM, poynter2 notifications@github.com wrote:\n\nHi,\nAfter upgrading to v17 I'm not prompted to add an email address as I\nalready have a registration in place Do I need to remove this (re-generate\nall certificates too?) or can I add an email to an existing one?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/45.\n. Not sure if they are sending them yet, but they said they are planning to.\n\nOn Wed, Dec 23, 2015 at 9:39 AM, poynter2 notifications@github.com wrote:\n\nThanks, removed the whole folder and reran and thats in there now. Are the\nalerts sent by letsencrypt directly then?\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/45#issuecomment-166939783\n.\n. You're right. I forget what my thinking was there.\n\nOn Thursday, January 7, 2016, Dylan Parry notifications@github.com wrote:\n\nThanks. Seems a bit odd to me that these are kept in the registry when\nalmost everything else is inside config files in %appdata%. It\u2019s a bit\ncounter intuitive not having everything in the same place.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/50#issuecomment-169634866\n.\n. Okay. I've given you push access. Please take good care of it and keep things simple. Feel free to contact me with any questions.\n. I recently added http://serilog.net/ to a project and was very happy with\nit. Would love for this project to use it as well.\n\nOn Wed, Jan 13, 2016 at 8:11 AM, Robert Kerber notifications@github.com\nwrote:\n\nThere isn't one now but I can work on adding in some logging.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/54#issuecomment-171324459\n.\n. Sorry for the neglect. I've added you as a collaborator to the project.\n\nWho else would like to be added?\nI'd prefer to see the plugins just be compiled in. They are just simple classes. No need to add a big project hierarchy for it. But if you really see the need I guess you can.. I've also added @jmarden and @LBegnaud to the project.. I'd be happy to hand off leadership of the project, as I'm probably not going to be working on it much. @ebekker was running the project for a while.. I'd love to donate the project to the EFF. They probably don't have resources to develop it but perhaps they could help manage it and would be a good owner.\nMaybe we could rebrand to win-certbot or something if they'd like.. You can use something as simple as this to load plugins. No need to split the project into libraries to do it.\n     void LoadMods(string modFolder)\n    {\n        if (!Directory.Exists(modFolder))\n            return;\n        foreach (var assemblyFilename in Directory.GetFiles(modFolder, \"*.dll\", SearchOption.AllDirectories))\n        {\n            var assembly = Assembly.Load(assemblyFilename);\n            foreach (Type t in assembly.GetTypes())\n            {\n                if (t.GetInterface(\"IMod\") != null)\n                {\n                    var constructor = t.GetConstructor(new Type[] { });\n                    if (constructor != null)\n                    {\n                        var mod = (IMod)constructor.Invoke(new object[] { });\n                        FoundMods.Add(mod);\n                    }\n                }\n            }\n        }\n    }\n\n. Hey. Sorry for the neglect. I'm looking at it now.. So I'm very leary of IoC, but since we're doing a plugin system I guess it could make sense.\nI really hate the interfaces for everything. It breaks F12 source navigation. Can we nuke most of those? There's no reason for something like ConsoleService not to be fully static. Things seem complicated now.\nIt doesn't work for IIS. Just boots me out most rudely:\n\nInternetInformationServicesPlugin.Auto() does not have anything in it. Should it just contain \"Install(target);\" or call PluginService.DefaultAction somehow?\nI'm cool with the MIT license change.\nSince we are breaking compatibility with V2, I want to stop using the windows registry and save everything to disk. Preferably in the letencrypt folder by default so we can do xcopy deploy and backup of settings. I'm happy to change the settings class to do that.. Sorry for the neglect. I'm happy to add anyone to the project that would like to manage it or take it over.. Invite sent. :). This requires a change to the acme protocol and for lets encrypt to change their server behavior.\nYou can take it up on the acme thread here: https://mailarchive.ietf.org/arch/msg/acme/b1kwAUS0UzcggJ645u_40RjXQ8Q. I'm happy to rename the project to whatever. How about, totallynotletsencrypt-win-simple?\nI also really like win-acme.\nIdeally I'd like to see the ownership of this project taken over by ISRG / Let's Encrypt. @bdaehlie is that something that we could make happen?. So since we've not heard back from @bdaehlie I guess we will go ahead and transfer to PKISharp and rename to win-acme. @WouterTinus are you good with that?. @WouterTinus @bdaehlie I did the rename.\nI tried to do the ownership transfer but it said \"You don\u2019t have the permission to create repositories on PKISharp\". Can you or @ebekker gimme rights there?. Looks like github is pretty smart about the redirects.. So I guess I thought AcmeSharp was already under PKISharp, but it looks like it's just a fork there, not the actual project yet.\n@WouterTinus since @ebekker and @bdaehlie haven't responded should we just close this issue and keep it under my ownership for now?\nAlso, can someone get us put back on https://letsencrypt.org/docs/client-options/. Sounds good. The ownership transfer is complete. Best of luck guys. :). ",
    "Rouzax": "Domain.com is not the actual domain name, but didn't realise I had to whitlist the domains first. Is that because let's encrypt is still in beta?\nWhat is the difference between using the production server and not?\n. Thanks for the info, truly great tool that you created.\nWhat about SNI support?\nOn 19 Nov 2015 17:55, \"Bryan Livingston\" notifications@github.com wrote:\n\nYes, you'll want to replace the old files.\nI've changed the data structures of the scheduled renewals a bit, so\nyou'll probably need to run thru the setup again to get them working\ncorrectly.\nIf everything is working fine it's probably smarter to wait. I'm wanting\nto add email reporting if a renewal fails and also SAN support in the\nfuture.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/8#issuecomment-158117248\n.\n. @poynter2: You can work around that by creating an extra Rewrite rule in IIS.\nRules\n\n\nLet's Encrypt rule\n\n. @navossoc thanks for the heads up.\n. Many thanks :+1: \n. I have a similar issue but for me it is Chrome on Android that gives the invalid warning.\nRunning on Windows 2012R2\n\n\n\n\n. Will a new server build solve the problem?\n. I can confirm that a new Windows build for the same sites generate working certificates. In my case it is fairly easy to rebuild the server because most sites on it are Reverse Proxies.\n. Everybody here please also post your experiences and tests at https://community.letsencrypt.org/t/iis-8-5-building-incorrect-chain-with-lets-encrypt-authority-x3/13320 to be sure LE has all the appropriate info.\n. Great news, wohoo :tada: \n. After running it again it went through fine.\n. Sorry, apparently I opened an empty issue during the creation of the other one #240 \n. Thanks\n. Would it be possible in the future to use this application to create and bind SSTP certificates?\n. @rkerber So I would need to create a manual certificate that is stored in the Personal certificate store and then bind it in RRAS?\nAccording to https://blogs.technet.microsoft.com/rrasblog/2009/02/11/how-to-change-certificate-on-sstp-server-in-windows-server-2008-r2/ I should be able to do the bind with.\nNetsh Command to configure the cert for SSTP:\nNetsh ras set sstp-ssl-cert name=<Cert Name>\nOR\nNetsh ras set sstp-ssl-cert hash=<Cert SHA-1 hash>\nI getting error when I try to create a manual certificate.\n```\nWhich host do you want to get a certificate for: m\nEnter a host name: xxx.yyy.zzz\nEnter a site path (the web root of the host for http authentication): C:\\inetpub\n\\wwwroot\\vpn\nAuthorizing Identifier vpn.mgdn.nl Using Challenge Type http-01\n Writing challenge answer to C:\\inetpub\\wwwroot\\vpn.well-known/acme-challenge/t\nLfUtxpawSGVPkpGWKpeUZ0rOiJ8DdWme-ZGaxBeGcY\n Answer should now be browsable at http://xxx.yyy.zzz/.well-known/acme-challenge\n/tLfUtxpawSGVPkpGWKpeUZ0rOiJ8DdWme-ZGaxBeGcY\n Submitting answer\n Refreshing authorization\n Authorization Result: invalid\n\nThe ACME server was probably unable to reach http://xxx.yyy.zzz/.well-known/acme\n-challenge/tLfUtxpawSGVPkpGWKpeUZ0rOiJ8DdWme-ZGaxBeGcY\nCheck in a browser to see if the answer file is being served correctly.\n\nPress enter to continue.\n```\nThis seems to be a MIME type issue\n\nIf I create a standard IIS certificate for the same subdomain I want to use for the VPN and move the certificate from Web Hosting to Personal I can use it in RRAS as SSTP certificate and it works when I connect.\nNow only a way to automate the renewal :)\n. That gave me a different error when I copied the web.config, something about not being allowed to overrride the settings at a sub path. \nCurrently not at home to try this.\nFound a way in PowerShell to move certificates to a different store.\nhttps://technet.microsoft.com/en-us/library/hh847799.aspx\n```\nC:\\PS>Get-ChildItem -Path cert:\\LocalMachine\\My -EKU \"Server Authentication\" | Move-Item -Destination cert:\\LocalMachine\\WebHosting\nDescription\nThis command uses the EKU parameter of the Get-ChildItem cmdlet to get SSL server authentication certificates in the MY certificate store.\nIt uses a pipeline operator to send the certificates to the Move-Item cmdlet, which moves the certificates to the WebHosting store.\n```\n. That is the funny thing they can coexist with each other on the same box.\nSSTP is directly bound to http.sys and listens to a specific URL.\nhttps://blogs.technet.microsoft.com/rrasblog/2007/01/25/sstp-faq-part-3-server-specific/\n```\nCan SSTP server co-exists with IIS Web Server?\nYes \u2013 they both can co-exist. SSTP listen on top of HTTP.SYS for all connections coming into specific URI (i.e. /sra_{BA195980-CD49-458b-9E23-C84EE0ADCD75}/). Rest of the web connections can be terminated at IIS.\n```\nThat means that I can create a site in IIS with the vpn domainname and generate a certificate for that site and afterwards I only need to move it to the Personal certificate store and bind it with Netsh ras set sstp-ssl-cert name=<Cert Name> to the SSTP in RRAS.\n. Aah, so you can simply add it to the application ;)\n. No I have not done it but would be eternally grateful if you did \ud83d\ude04 . I would need to try, but then it still needs to be registered with SSTP in RRAS if the certificate is renewed.. I was wondering if there is any progress with this?. This script will only work if the SSTP is the only IIS site, or not?\nI'm trying to figure out how to set this up and test this in my environment.\nOn my IIS server there are 9 sites already which are separated using host headers.\n- site1.xxx.yyy\n- site2.xxx.yyy\nThe scheduled task already provides the renewals for all those sites. @filthyfreak \nSo I'm trying to set this up but I do have a question.\nFirst of as described I have multiple sites in IIS all with their own host headers.\n\n\nSite ID 11 is the subdomain for the VPN on which I want to bind the SSTP.\n\nWhen I run the following command it seems to works \nC:/letsencrypt/letsencrypt.exe --plugin iissite --siteid 11 --validation selfhosting --certificatestore My --installation iis,manual --installationsiteid 11 --script \"C:/letsencrypt/Scripts/PSScript.bat\" --scriptparameters \"C:/letsencrypt/Scripts/ImportSSTP.ps1 {5} 11\"\nHow should I handle the renewal of the vpn certificate while also keeping my other renewals running?. @WouterTinus but how will the renewed certificate be bounded to the SSTP with the default renewal?\nThere is already 1 scheduled task running but that just handles the renewals for all.\nC:\\LetsEncrypt\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\nThank you for your help and sorry for being so dumb \ud83d\ude04 . @WouterTinus Should this already work with the latest v2.0.0-beta2?\nCan't get it to work but it is highly likely that is due to my incompetence.\nI'm running\nC:\\WACS>wacs --target iissite --siteid 9 --validation selfhosting --installation iis,manual --installationsiteid 9 --script \"C:/WACS/Scripts/PSScript.bat\" --scriptparameters \"C:/WACS/Scripts/ImportSSTP.ps1 {5} 9\"\nThis is the output\n```\n [INFO] A simple Windows ACMEv2 client (WACS)\n [INFO] Software version 200.0.6982.39228 (RELEASE)\n [INFO] IIS version 10.0\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\n[INFO] Running in mode: Unattended\n [INFO] Target generated using plugin IISSite: vpn.xxx.yyy\n [EROR] Unable to find installation plugin manual\n [INFO] Authorize identifier: vpn.xxx.yyy\n [INFO] Cached authorization result: valid\n [INFO] Requesting certificate Site-9\n [INFO] Saving certificate to C:\\ProgramData\\win-acme\\acme-v02.api.letsencrypt.org\\Certificates\n [INFO] Installing certificate in the certificate store\n [INFO] Adding certificate Site-9 2019-2-17 10:39:11 to store WebHosting\n [INFO] Installing with IIS...\n [INFO] Updating existing https binding vpn.xxx.yyy:443\n [INFO] Committing 1 https binding changes to IIS\n [INFO] Adding renewal for Site-9\n [INFO] Next renewal scheduled at 2019-4-13 11:39:11\n```. Let me know if there is anything you want to test with 2019 \ud83d\ude04 \n. ",
    "matbech": "I'm getting the same error with version 1.0\n```\nDo you want to add/update an https IIS binding? (Y/N)\n Updating Existing https Binding\n Commiting binding changes to IIS\nUnhandled Exception: System.ComponentModel.Win32Exception: A specified logon ses\nsion does not exist. It may already have been terminated\n   at Microsoft.Web.Management.Utility.HttpApiWrapper.CreateSSLBinding(IPEndPoin\nt endPoint, String hostName, HTTP_SERVICE_CONFIG_SSL_PARAM_MANAGED allSSLData, S\nslFlags sslFlags)\n   at Microsoft.Web.Management.Utility.HttpApiWrapper.CreateSSLBinding(IPEndPoin\nt endPoint, String hostName, Byte[] certificateHash, String certificateStoreName\n, SslFlags sslFlags)\n   at Microsoft.Web.Administration.BindingManager.BindingTransaction.Commit()\n   at Microsoft.Web.Administration.BindingManager.Save()\n   at Microsoft.Web.Administration.ServerManager.CommitChanges()\n   at LetsEncrypt.ACME.Simple.Program.ConfigureBinding(TargetBinding binding, X5\n09Store store, X509Certificate2 certificate) in C:\\Users\\Bryan\\Documents\\letsenc\nrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 281\n   at LetsEncrypt.ACME.Simple.Program.Auto(TargetBinding binding) in C:\\Users\\Br\nyan\\Documents\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 248\n   at LetsEncrypt.ACME.Simple.Program.Main(String[] args) in C:\\Users\\Bryan\\Docu\nments\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 175\n```\n. Yes it is possible. See:\nhttps://community.letsencrypt.org/t/multi-domain-san-certificate-and-webroot-auth/2493\nBut not implemented yet in the ACME windows client:\nhttps://github.com/ebekker/letsencrypt-win/issues/13\n. With my changes here (I apologize for the CRLF mess) a certificate with multiple SAN is successfully obtained: https://github.com/matbech/letsencrypt-win-simple/commit/375109970df5d10f724d6f7c7ab5f48b58ba9d27\n. ",
    "amlynnworth": "@Lone-Coder: There is nothing else bound to https on this particular server, no conflicts. \nI tried removing the server cert, rebooting, and putting everything back in manually and I still ended up with that message about the specified logon session not existing.\nDid the presence of 'Bryan' make any sense to you in that screenshot - look at the paths under \\users\\ ??  Does that have something to do with why Windows thinks another logon session made the cert and it is not generally available for use on the server?\nI had downloaded the files to test ~30-60 minutes before posting my message, so they should have been \"latest.\" The file properties on letsencrypt.exe showed product version 1.0 and file version 0.0.0.0.\n. @Lone-Coder Wow! Version 1.1 worked perfectly and very quickly for me.\nI ended up ticking the box in IIS Manager on the site bindings for [x] require sni.  I noticed it entered a binding for the ip number with no hostname. How will that work out if one uses the client to make multiple certs on a single machine, and they all need to be on 1 ip but in different IIS Sites?\nThank you very much for all your efforts. \n. Second test of 1.1 was a little trickier but worked in the end.\nIIS kept crashing, trying to respond with the challenge file over http.  I resolved that by removing the MIME type definition for .* at the top for all sites (done manually, previously, before v1.0), so then there was only 1 override via web.config in the .well-known/acme-challenge folder.  I also changed the definition to application/json which showed up better for me in Firefox when I was testing.  After that, it worked fine.\nOne suggestion, if there is a fatal error (such as challenge fails), it would be good to add some kind of press-key-to-continue pause because the error text is only visible if you ran from a cmd prompt initially. If you just right-click run-as-admin on letsencrypt.exe, the exe just exits with no chance to read the detailed error message.\n. Third test, this time on a Win8.1 system: perfect. It took longer to download and unzip than to request the cert and confirm it was working. i.e. super easy. Great work.\n. I saw that same error \"A specified logon session does not exist. It may already have been terminated\" with v1.6 yesterday.  My test was on an IIS site on Win2012 server that already had a cert in place. I was able to switch to the new LetsEncrypt cert manually without any further problems.\n. @Lone-Coder The old cert was from cacert.org and it was in the Personal store.\n. Ah!  Note 'DNS:' or 'IIS:' prefix on the site name in the list. \nWhen I used the IIS: name, it worked perfectly.  Perhaps just add a note to the Wiki.\n. ",
    "Sitting-Duc": "Certificates are now being added correctly to the 'Server Certificates' and also to the website bindings. \nDo you have something in place to remove old certificates after they have expired? I have not delved into the source code yet.\n. Clarification: \nSay you run the letsencrypt and select domain.tld - it does its thing and comes back with the certificate which it then adds to both the domain.tld:443 and www.domain.tld:443 bindings.\nYou then run the letsencrypt the second time for www.domain.tld - it does its thing and comes back with the certificate which it then adds to the domain.tld:443 and www.domain.tld:443 bindings.\n. That one is me, looks like although the code is only updating a single binding because multiple bindings were using the self signed certificate they were all updated. \nThis will be solved by the SAN issue however so not a biggie.\n. Actually I'm going to re-open this as the behavior does need to be changed somehow. Watch this for explanation.\nhttp://screencast-o-matic.com/watch/coXbY7hFfF\n. ",
    "riipah": "FYI I just got this error with 1.6. \"System.ComponentModel.Win32Exception (0x80004005): A specified logon session does not exist. It may already have been terminated\". I do have more than one site in the same IP/port, but I'm using SNI so it should be fine.\nAnyway, I was able to make the certificate work by binding it manually in IIS manager, so the tool helped.\n. Sorry, I can't find anything relevant in the event viewer (I checked IIS logs as well). IIS version is 8.5 (WinServer 2012 R2).\nI did save the console output. The last lines are:\nOpening Certificate Store \"WebHosting\"\n Loading .pfx\n Adding Certificate to Store\n Closing Certificate Store\n Updating Existing https Binding\n Commiting binding changes to IIS\nSystem.ComponentModel.Win32Exception (0x80004005): A specified logon session does not exist. It may already have been terminated\n. ",
    "mensand": "Hi i had to change the .* in the web.config file wich is created in the validation directory to . with the *\nAfter that the validation worked and the certificate was installed.\n. ",
    "Doogal666": "@Lone-Coder I saw this error message when I already had a certificate installed in the Personal store. On the first pass, I got the error. The new certificate had been added to the Web Hosting store. I then manually switched to the new certificate and ran the tool again and it worked flawlessly. So I suspect it doesn't like an existing certificate living somewhere other than the Web Hosting store\n. ",
    "My1": "well SAN is especially helpful if you are deling with non-SNI hosts (like webdav for windows or anything winxp)\nalso it is possible with the LE client to obtain a SAN at the very least in manual mode, I just have to enter all domains (I usually do it with -t and then paste all the domains in the prompt) and then I essentially get a webroot challenge for each and every domain requested as in\nput the following at example.com/url\ntext123\npress enter when your are finished\n[pressing enter]\nput the following to ssl.example.com/url2\ntext567\nress enter if you are finished\nAND SO ON...\n. technically as described in the closed beta email and also in the forum SANS do not count, just the number of certs that are actually made.\n. ",
    "poynter2": "big +1 for this. Would help with the SNI issue raised as well (at least with a single website).\n. Oh yes, sorry - that service that I forgot uses 443 \n. +1 for this. Have multiple hostnames on the same site as well, which is also throwing cert errors at the end user.\n. Noticed the same issue after setting up an automatic redirect from HTTP to HTTPS. I'm also dropping the www. from the URL, so it failed. SAN may help make the config simpler.\n. Thanks, removed the whole folder and reran and thats in there now. Are the alerts sent by letsencrypt directly then? \n. Thanks\n. Thanks for the update, thats working now. . ",
    "jagbarcelo": "@Lone-Coder: any progress on this issue? Did you have a look at @matbech changes (commented on 15th November)? He also contributed to https://github.com/ebekker/ACMESharp/issues/13 with something that might be of help for you too. It would be really helpful to have this feature available.\nHaving to use https://github.com/ebekker/ACMESharp as alternative because the lack of a Subject Alternative Name (SAN) feature is quite a pain; it is much more complex.\nThanks.\n. @japerlman Sorry, I didn't mean that I could use ACMESharp to get a SAN certificate (even though after a second read at my post, it might seem so).\nSince ACMESharp is used by this project it is absolutely clear that once https://github.com/Lone-Coder/letsencrypt-win-simple/issues/13 is solved, implementing SAN in this project would be straigtforward. That, however does not mean that it cannot be done directly here beforehand (maybe as a temporary patch), as @matbech suggests in https://github.com/matbech/letsencrypt-win-simple/commit/375109970df5d10f724d6f7c7ab5f48b58ba9d27\nI simply wondered if someone had given it a try instead of waiting the resolution of the issue in the other project.\nSorry for the misunderstanding.\n. I'm experiencing the same issue. The expiration date of our certificate is shown one month later that it should be, and thus, it will not be renewed until it has long expired!\n\nOur system locale is Spanish-Spain (ES-es). We are also using the latest version 1.9.1 now, but I cannot recall with which version it was first issued (maybe 1.9.0 or 1.8)\nI have also tried to manually update the registry key HKCU\\SOFTWARE\\letsencrypt-win-simple\\https://acme-staging.api.letsencrypt.org/, changing 'Renewals' to something in the past (22/10/2016). After that change in the registry the renewal process was run but after a warning the Renewal date was moved again 60 days in the future, even though it had failed to renew:\n\nSo it ended up with a even more delayed renew date and the original certificate not being renewed at all!\n. More info about this issue:\nI have enabled Debug level logging in letsencrypt.exe.config and even thouth the Registry key states that we are using alternatives names and \"San\":\"True\", the debug information of the process run states otherwise:\nThe value in the registry before running letsencrypt.exe:\n{\"Date\":\"2016-10-22T09:19:37.7203087Z\",\"Binding\":{\"Host\":\"hostname.mydomain.com\",\"WebRootPath\":\"%SystemDrive%\\\\inetpub\\\\wwwroot\",\"SiteId\":0,\"AlternativeNames\":[\"hostname.mydomain.com\",\"hostname2.mydomain.com\",\"hostname3.mydomain.com\"],\"PluginName\":\"Manual\",\"Plugin\":{\"Name\":\"Manual\"}},\"CentralSsl\":null,\"San\":\"True\",\"KeepExisting\":\"False\",\"Script\":null,\"ScriptParameters\":null}\nThe output in the EventLog:\n11/02/2016 10:18:54 +01:00 [Debug] Options { BaseUri: \"https://acme-v01.api.letsencrypt.org/\", AcceptTos: False, Renew: True, Test: False, ManualHost: null, WebRoot: \"%SystemDrive%\\inetpub\\wwwroot\", Script: null, ScriptParameters: null, CentralSslStore: null, HideHttps: False, San: False, KeepExisting: False }\nThe rest of entries in the Event Log are just informational messages without any interest. No errors at all. What should we do?\n. ",
    "clearbucketLabs": "yeah, i got multiple subdomains and it makes a cert for each.  should be an option to just throw them all in one cert.  i ran into the rate limit this way too.  Not sure if the rate limit affects SAN regardless though... \n. ",
    "japerlman": "@jagbarcelo How are you using ACMESharp to obtain a SAN certificate? This project sits on top of ACMESharp and needs ACMESharp to complete #13 on ACMESharp you mentioned before it can be done in this project.\nLooking at the Wiki for ACMESharp I don't see any examples for SAN usage.\n. See issue #3.\nFrom: brettyj notifications@github.com\nSent: Jan 19, 2016 8:04 AM\nTo: Lone-Coder/letsencrypt-win-simple\nSubject: [letsencrypt-win-simple] Subdomains (#57)\nHi,\nDue to the rate limits imposed by Lets Encrypt I could only set up 5 of the bindings :( - However it would be a nice addition that if your program realised that the bindings share the same domain suffix, so: service1blahcom, service2blahcom, it batched them together to get one certificate with multiple subdomains registered on it\nI'd like this functionality, but I don't really want to go the complication of learning and using ACMESharp just for this one feature\nAny chance?\nThanks\n\nReply to this email directly or view it on GitHubhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/57.\n. ",
    "ammoniak": "SAN support has been added to the ACMESharp project: https://github.com/ebekker/ACMESharp/commit/f34a49e4bc33d1b0cdf4de64439d0569910a59e4\n. PS: Thanks for the great work. I really appreciate it, and besides SAN, the client works like a charm.\n. Thanks.\n. ",
    "rkerber": "Since it uses the ACMESharp NuGet package, we have to wait until a new version is pushed out there before it can be added in.\n. PR #65 has been added in.\n. Yep, it would have to.\nI can start working on SAN support soon, but I want to get the last issue tagged for V 1.8 done first and get that released, since SAN support is going to require a lot of changes, and possibly a new plugin.\n. For IIS sites, it will just bring back a list of sites, and it will request a SAN certificate for all unique hosts across all of the bindings on that site.\nFor manual sites, it will only use the hosts you enter in.\n. I just added PR #77 and it should now support SAN.\nJust use --san, both the manual and IIS plugins are supported.\nLet me know if you encounter any issues, there were a lot of changes so i'd be surprised if someone doesn't find an issue.\n. @RvdHout can you try it again, I made some changes that should fix it.\n. The limit is 5 certificates per domain in 7 days. A SAN cert counts as a single certificate.\nI have done about 100 in an hour with the test URI. So if test has any limits, they are really large.\nI coded the 100 domain limit into the app, so nobody can hit that limit since it will display an error and not let you see that site.\nA SAN cert does require you to have authorized every domain under the site before it can generate the certificate.\n@brettyj can you change the min logging level in the letsencrypt.exe.config to Debug and try the SAN cert again? That will log all of the details into the Event Viewer. It will log the exact answer that comes back from the ACME server so that should help us understand what it is doing.\n. A SAN will work with different domains as well, as long as they all pass the authorization check.\n. I found https://github.com/ebekker/ACMESharp/issues/24 which looks like a simular issue.\n@ebekker do you have any ideas, or do you think the Let's Encrypt server error might eventually go away?\n. Maybe they are having issues creating SAN certs in prod right now.\nHowever I just did one with 7 hosts all under the same root domain about half an hour ago and it worked.\nI can try setting up a couple additional root domains and try to test with them as well.\n. Both test and prod worked for me half an hour ago.\nAre you trying to get a SAN cert for multiple domains?\nex. domain1.com, domain2.com, etc.\n. Let me setup a couple of extra domains and i'll give it a try to see if it still works for me or not.\n. If it worked before and now isn't, that's leading me to think it's a server error on the Let's Encrypt side.\n. I just got certs created with and without --test and with and without --san. I got certs for all 4 of those tests. All of them are on the same domain, i'm still getting DNS setup to be able to test additional domains as well.\n. What OS & IIS version is anyone getting the 500 error using?\nI was able to do a --san cert for dev.domain1.com, dev.domain2.com and dev.domain3.com with both --test and not using test.\n. That's the exact same OS and IIS version as my primary test server.\nDid you try deleting the registry keys?\n. I added another line of logging to the app and did a pre-release of it so we can make sure we are all on the same code base.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.8.6-Pre\nIf you can change the min log level to Debug and try it again, maybe we can see some more info.\n. The registry keys are at HKCU\\Software\\letsencrypt-win-simple\\URI where URL is the base URI of the ACME server.\n. It doesn't hurt anything, and there are no limits on authorizing, but it probably shouldn't authorize it twice.\n@DennisHeerema can you create a separate issue for it so I remember to fix it? Also, this one is starting to get long.\n. This issue is getting rather long and isn't really a single issue anymore so i'm going to close it.\nIf anyone still is getting 500 errors, can you open up a new issue so we can track it there.\n. I just went through and tested the latest source code on a Server 2012 R2 box, and I don't see it happening. I did a patch for some IP binding configuration yesterday in #62 so maybe that fixed it.\nCould you try compiling from source and let me know if you still see the issue?\n. Yep, that change isn't in v 1.7. There will probably be a release soon, but not sure when as there are still some important bugs to try to fix first.\nIf you need some guidance compiling it take a look at https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/How-to-Compile-From-Source-Code\n. Version 1.8 has been released and should fix this for you.\n. What OS and IIS version are you on?\nAlso, can you upload some screenshots or a screencast showing what it is doing?\n. Ok, that's why.\nServer 2008 & 2008 R2 do not support having multiple SSL certificates on the same IP address. IIS 8 + support SNI (Server name Indication) allowing you to have multiple HTTPS certificates on the same IP address.\nIf you want to have SSL for multiple sites with multiple domains with IIS 6 - IIS 7.5 all binded to the same IP address your choices are to either generate a SAN certificate (to be supported soon) for all domains you host up to a maximum of 100 domains (that's the max Let's Encrypt will currently support), or to upgrade to IIS 8 +.\nAnother option is a wildcard SSL certificate, but that only works for subdomains and Let's Encrypt has said they will not support wildcard certs.\n. No problem, I decided to create a wiki page about it so hopefully that will help anyone else having the same problem.\n. I have an alpha version of SAN support for multiple sites or an entire server SAN cert uploaded.\nSee https://github.com/Lone-Coder/letsencrypt-win-simple/issues/84#issuecomment-180962329 for details.\n. The answer file does still need to be served over HTTP. IIS FTP doesn't support SNI. If you aren't using a web browser for FTPS then even if the certificate is valid it still asks the user to trust the certificate.\nWith all of that said, it still would be a cool feature to support FTPS via the client. I have a HTTP and HTTPS site already running on the hostname I use for FTP, so I just used the client for that HTTP site and then manually changed the certificate under the FTP SSL Settings to the one the client installed. I might still have to touch it every time the certificate is renewed but a potential IIS FTP plugin might take care of that in the future.\n. I have taken a look at trying to do this, but I can't find an easy way besides updating the content of the ApplicationHost.config to set the certificate for IIS FTP user access. That might not be that reliable of a method for updating it.\n. Added in pull #33.\nIncluded web.config has been tested with stock IIS on Server 2012, Server 2012 R2, Server 2016, Win 7, and Win 8.1. If anyone needs to make changes to the web.config file, you can update the web_config.xml file in the root of the app.That is copied instead of using text hard coded in the app. So no more need to recompile to change the web.config.\n. Version 1.8 has been released and should fix this for you.\n. PR #71 hides IDN domains now.\n. Closing as there is a work around now in the latest unreleased code. See the readme web.config Settings section for details.\n. Central SSL was added in pull #33.\nI have noticed that for central SSL when you update the certificate it takes time for IIS to realize that there is a new certificate. It is faster at switching the certificates when you switch them on the binding and don't used central SSL.\n. Added in #113. Just select the f option when prompted. \n. If anyone wants to see this enhancement, add your +1 (via add your reaction) to the first comment of this issue.\n. Fixed by #216\n. The OpenSsl providers have been updated so they aren't the same anymore.\nI tried setting the NumBits for the RsaPrivateKeyParams to 4096 and it doesn't look like it did anything. Anyone have any suggestions?\nC#\nvar rsaPkp = new RsaPrivateKeyParams();\nrsaPkp.NumBits = 4096;\n. Yep, I see that now. That will have to be changed under https://github.com/ebekker/ACMESharp/ before it can be implemented here.\n. I created https://github.com/ebekker/ACMESharp/pull/84 to get this done in ACMESharp.\n. #70 adds support for this. After the ACMESharp pull is added, and the new NuGet package is added, it will be functional.\n. It's added into ACMESharp now. As soon as the NuGet package is updated, I'll update the app with the latest package and this should be fully supported.\n. This was add in Pull #75.\n. It's a setting in the app.config file. See the Wiki for details.\n. #63 Resolves this. I put it in the settings file so if someone wants to change the format they can. See https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Settings for details on how to set it.\n. @BrianKWhite for your existing SSL binding, was it IP only or IP & host name?\n. Have you tried the latest source code? (Not the prebuilt version 1.7, but the current source code)\nI had added some code in #33 to have it bind to an existing IP it the HTTP binding had one. I haven't tested it with an IP only binding but I can try that out this weekend.\n. So I found some time and ran some tests with the latest code (I patched a couple of issues today and IP's were part of #62 ).\nHTTP on specific IP with no hostname - Does not show up in the site list\nHTTP on specific IP with hostname - Creates HTTPS binding on specific IP with hostname\nHTTP on specific IP with hostname and HTTPS on specific IP with no hostname - Creates a new HTTPS binding on specific IP with hostname\nHTTP on specific IP with hostname and HTTPS on specific IP with same hostname - Updates cert on existing HTTPS binding\nHTTP on specific IP with hostname and HTTPS on specific IP with different hostname -  Creates a new HTTPS binding on specific IP with hostname\nHTTP with hostname and HTTPS on specific IP with no hostname - Creates a new HTTPS binding with hostname on any IP\nHTTP with hostname and HTTPS  with same hostname - Updates cert on existing HTTPS binding\nHTTP with hostname and HTTPS with different hostname -  Creates a new HTTPS binding with hostname\nI didn't get any errors on Server 2012 R2 and IIS 8.5 for any of those tests.\n. It has been such a long time since I have used Server 2008 R2, I forgot that it doesn't really have SNI support for HTTPS. It does, but really only works if you use a wildcard cert and Let's Encrypt isn't going to support those.\nI'll build a test Server 2008 R2 VM so I can do some testing as well.\n. It might work better with Server 2008 R2 after SAN support is added in. But we have to wait for https://github.com/ebekker/ACMESharp/issues/13 and then #3. \n. Version 1.8 has been released and should fix the root error for this issue. If it doesn't it will add more details to the logs now.\n. This is no longer hidden after #66. I also added a prompt to ask if you want to replace the existing task. So if someone wants to customize the task to run as a specific user or anything else, they now can without having to change it every time a certificate is created through the app.\n. My changes would mess pull #34 up. I moved the content of the webConfig string to the app.config file so users can change it without having to recompile the code if they need to change it. From my testing one setting normally works for an entire server, but some require one of the different options to work correctly. But the changed line can be updated in the app.config instead of in the code itself.\n. Not needed after pull #33.\nIncluded web.config has been tested with stock IIS on Server 2012, Server 2012 R2, Server 2016, Win 7, and Win 8.1. If anyone needs to make changes to the web.config file, you can update the web_config.xml file in the root of the app.That is copied instead of using text hard coded in the app. So no more need to recompile to change the web.config.\n. Just a note, this is the exact same as Pull request #34 \n. That's what I ended up having to do to get MVC 5 apps to work. I have a pull request #33 that moves the content for the web.config file to the app.config file. Then anyone can update the setting in the letsencrypt.exe.config file with whatever they their web.config file to contain and it will use that content and you won't have to edit the source code and recompile it yourself.\n. I don't think there will end up being a single web.config file that will work for everyone even if it is just under the .well-known directory. That's why I think anyone should be able to update it without recompiling the app from source if they needed to change it. It could be defaulted for what works for the majority of people, and if it doesn't work for someone they can change it easily.\n. Partially added in pull #33. I had issues with testing new handler, that only worked on stock IIS on Server 2008 R2 for me. So I went without it as it can now be easily changed, and I went with the method that worked on the most IIS version.\nIncluded web.config has been tested with stock IIS on Server 2012, Server 2012 R2, Server 2016, Win 7, and Win 8.1. If anyone needs to make changes to the web.config file, you can update the web_config.xml file in the root of the app.That is copied instead of using text hard coded in the app. So no more need to recompile to change the web.config.\n. Added in pull #33.\nIncluded web.config has been tested with stock IIS on Server 2012, Server 2012 R2, Server 2016, Win 7, and Win 8.1. If anyone needs to make changes to the web.config file, you can update the web_config.xml file in the root of the app.That is copied instead of using text hard coded in the app. So no more need to recompile to change the web.config.\n. Version 1.8 has been released and should fix this for you.\n. I added logging in PR #68.\nSee https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Logging for more details. If you set the logging level to Debug you will see all of the info that comes back via ACMESharp.\n. I noticed that once, it was waiting for someone to press enter to continue after running. I think that had been because it had been in test mode.\n. I added a wiki page for this.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Windows-Task-Scheduler-Settings\n. @sjkp I took a look at your code and I tested it with regular IIS sites, I don't have any Azure sites to test it with as i'm running too many Azure VMs and using up all of my credit.\nA couple of things I would like to see.\nFirst, since it has been switched to use the web_config.xml file in the app root instead of a hard coded webConfig constant, could you change your code in AzureWebSitesPlugin.cs Lines 62-68 to reflect that?\nSecond, could you create a wiki page on how to use the Azure WebSites Plugin? That's not needed before I approve the pull, but that would probably be helpful to anyone who wants to use it with Azure WebSites in the future.\n. Due to the changes made for supporting SAN, there are going to have to be even more changes made as the base plugin has been changed with new methods that will have to be supported.\n. Added in pull #33.\nIncluded web.config has been tested with stock IIS on Server 2012, Server 2012 R2, Server 2016, Win 7, and Win 8.1. If anyone needs to make changes to the web.config file, you can update the web_config.xml file in the root of the app.That is copied instead of using text hard coded in the app. So no more need to recompile to change the web.config.\n. Added in pull #33.\nIncluded web.config has been tested with stock IIS on Server 2012, Server 2012 R2, Server 2016, Win 7, and Win 8.1. If anyone needs to make changes to the web.config file, you can update the web_config.xml file in the root of the app.That is copied instead of using text hard coded in the app. So no more need to recompile to change the web.config.\n. Should we move the renewal config to config files instead of the registry?\n. I'd like to help manage the client. I have some free time and I think I understand the vast majority of how the client is setup and functions.\n. I started going through the pull requests last night and I got 3 of them added into the main branch. I'll see if I can take a look at yours and see about adding them in tonight.\n. Added in pull #33.\nIncluded web.config has been tested with stock IIS on Server 2012, Server 2012 R2, Server 2016, Win 7, and Win 8.1. If anyone needs to make changes to the web.config file, you can update the web_config.xml file in the root of the app.That is copied instead of using text hard coded in the app. So no more need to recompile to change the web.config.\n. I think the best way right now is to run it manually. Just run letsencrypt --manualhost domain.com --webroot C:\\sites\\siteroot.\nI ran into this same issue on one of my servers as well, maybe adding in some pagination could help if there are too many sites in the list.\n. The default buffer size for the command prompt is low, around 50 lines. You can increase it to 9999 lines but that's the max lines the command prompt can have in its buffer.\ntake a look at https://stackoverflow.com/questions/1740876/more-lines-in-command-window to see how to increase your buffer size.\n. PR #71 takes care of this.\n. There isn't one now but I can work on adding in some logging.\n. I have used log4net in the past, but I have heard good thing about serilog so i'll probably go down that road.\n. I added logging in PR #68.\nSee https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Logging for more details.\n. The task is created after the cert is installed. If it threw an error when it tried to install the cert, that could of caused the program to exit and not continue. So that could be why you don't see the task.\n. You should also check to see if it is in the registry, if not it won't know about it.\nIt's under HKCU\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/ and check the Renewals entry. If it isn't in there, then just add a new line using the same structure as any others you have.\nIf you don't have any other renewals or the registry keys, I can send them.\n. Save this as a .reg file and import it to your registry. Or add it manually\n```\nWindows Registry Editor Version 5.00\n[HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple]\n[HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/]\n\"ScheduledTaskName\"=\"letsencrypt-win-simple httpsacme-v01.api.letsencrypt.org\"\n\"Renewals\"=hex(7):00,00\n```\nThen go into your registry and update the Renewals entry with the following. Make sure to replace the host, the path (remember to escape \\'s like in the example), and the site ID with your values. the date should be 60 days from the time you got the cert.\n{\"Date\":\"2016-03-017T19:57:57.5699397Z\",\"Binding\":{\"Host\":\"www.domain.com\",\"WebRootPath\":\"C:\\\\websites\\\\www.domain.com\\\\wwwroot\",\"SiteId\":1,\"PluginName\":\"IIS\",\"Plugin\":{\"Name\":\"IIS\"}}}\n. Yep, you will need a new cert. However, since it might fail, I would recommend doing it on a site where SSL isn't required or forced first and running letsencrypt.exe --test. Then you won't have issues about generating too many certs for the same domain.\n. Yep, if you get an error post it here and we will try to see what's going on.\n. Yeah, that could have been it.\nSince it didn't complete the first site, it didn't really do anything other than add the first cert into your local cert store. So if you do that site again you might want to switch that one off of that cert or off HTTPS and remove it from your cert store to get rid of extra certs that might confuse someone later.\nIf you are running it for all sites, keep the limits in mind.\n10 certs per 3 hours per IP\n5 certs per domain per 7 days\nSee https://community.letsencrypt.org/t/quick-start-guide/1631\n. You don't need to remove the folder, it will overwrite any needed files. But you might end up with multiple certificates available with the same name if you don't remove the old certificate from the certificate store using MMC, https://msdn.microsoft.com/en-us/library/ms788967(v=vs.110).aspx.\n. The latest version of the code works with stock IIS running static HTML pages. It won't work with MVC sites out of the box. You can update the web_conf.xml in the root to get it to work with MVC sites. That file is then copied out to .well-known\\acme-challenge\\web.config. So you can customize it to work with your sites if you need to.\nHere is mine that i'm using for my MVC sites.\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <configuration>\n     <system.webServer>\n         <staticContent>\n             <mimeMap fileExtension=\"*\" mimeType=\"text/json\" />\n         </staticContent>\n        <handlers>\n            <clear />\n            <add name=\"StaticFile\" path=\"*\" verb=\"*\" type=\"\" modules=\"StaticFileModule,DefaultDocumentModule,DirectoryListingModule\" scriptProcessor=\"\" resourceType=\"Either\" requireAccess=\"Read\" allowPathInfo=\"false\" preCondition=\"\" responseBufferLimit=\"4194304\" />\n        </handlers>\n     </system.webServer>\n </configuration>\n. If you add in the changes that fix it for MVC, then it breaks it for other frameworks or when you don't use a framework. So whenever you upgrade, just keep your old web_config.xml file and you shouldn't have any issues.\nIt does sound like eventually this issue will go away as they might eventually support having files with extensions. See https://github.com/Lone-Coder/letsencrypt-win-simple/issues/14#issuecomment-161099242\n. There hasn't been a release since that was added, so you will have to compile it yourself or wait until it is released, not sure when that will be yet.\n. Looks like this is a duplicate of issue #31 \n. I just created a wiki page with steps to compile it.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/How-to-Compile-From-Source-Code\n. What OS and IIS version are you using?\n. Try the latest code. I guess I forgot to test it without the --test parameter and needed another if else statement to actually run the binding. I fixed that in Pull #61.\n. Duplicate of #31, read through that and if you still have questions or issues, post to that issue. \n. There shouldn't be any additional risks doing it that way.\nThere is another issue asking for a FTP provider and from this it looks like a WebDAV one might be useful as well.\n. I added a WebDav plugin in #115. Deleting the authorizations and folders won't work on every WebDav server see https://github.com/saguiitay/WebDAVClient/issues/4\n. Did you run it in test mode when you created the certificate?\n. Did you download Version 1.7 from the Releases page?\n. It defaults to build for Debug which has that extra Press enter to continue. To not have that, you need to build it for Release. You can see the details of what each configuration does at https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/How-to-Compile-From-Source-Code#solution-configurations. You can see how to switch it at https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/How-to-Compile-From-Source-Code#4build-the-solution.\n. This enables support for #29 after https://github.com/ebekker/ACMESharp/pull/84 is added in and the NuGet package is updated.\n. Are you using the released version 1.7 or did you compile the app from the current source code?\nWhere are you changing the settings at?\nWhat version of IIS are you on?\nAre you running something like MVC on the site?\n. There have been some fixes to the web.config file in the latest source code and they might fix this for you. Take a look at #37 and see if any of those suggestions help.\n. Version 1.8 has been released and should fix this for you.\n. It looks like you didn't branch off the latest code base. The latest source code already has changes in it for changing the web.config file. The changes were tested with stock IIS on Server 2012, Server 2012 R2, Server 2016, Win 7, and Win 8.1.\nPlease check to see if the latest source code works for you. If not, then create a new branch from the master branch and try to make your changes again.\n. That is Release 1.7. There are a lot of changes that have been made to the master branch since then that have not been released yet. You should get the latest from the master branch,https://github.com/Lone-Coder/letsencrypt-win-simple\n. It looks like the ACME spec no longer checks for Content Type, so ti doesn't really matter. However, it used to require it to be text/plain, application/jose+json or text/json. So that's why it was set that way. We are hoping that they will decide if .txt files will actually be able to be used and when that happens we will switch over to using .txt files instead of extensionless files.\n. It saves them to %appdata%\\letsencrypt-win-simple\\URL\\ since you haven't generated new ones, they should still be there.\nWhere URL is the Base URI for the ACME server.\nHere are the limits:\n10 certs per 3 hours per IP\n5 certs per domain per 7 days\nSee https://community.letsencrypt.org/t/quick-start-guide/1631\n. 1 You will need to install the .pfx files\nSee Importing from a .pfx File\n2 Your example falls under the 5 certs per domain in 7 days.\nMy advise is if you are using the application for the first time, is that you specify the --test parameter when you run it. That will use the test server that has no limits in place. The certificates won't be valid certificates but you can use them to make sure everything is working correctly before you hit your rate limit.\nHere's what Let's Encrypt says on the limits:\n```\nDuring this beta test we have very tight rate-limiting in place. We plan to loosen these limits as the beta proceeds.\nThere are two rate limits in play: Registrations/IP address, and Certificates/Domain.\nRegistrations/IP address limits the number of registrations you can make in a given time period; currently 10 per 3 hours. This means you should avoid deleting the /etc/letsencrypt/accounts folder, or you may not be able to re-register.\nCertificates/Domain you could run into through repeated re-issuance. This limit measures certificates issued for a given combination of Top Level Domain + Domain (a \"registered domain\"). This means if you issue certificates for the following domains, at the end you would have what we consider 4 certificates for the domain example.com.\nwww.example.com286\nexample.com www.example.com286\nwebmail.example.com ldap.example.com\nexample.com www.example.com286\nThe limit on Certificates/Domain is 5 certificates for a registered domain in a sliding window of 7 days. We know it's restrictive at present; thank you for your patience in helping us ensure Let's Encrypt is ready for the whole world.\n```\n. I'm not sure that would be worth the effort to add that in. It would actually have a bit of modification to get it to work, and more changes would be required to the plugins.\nDoes anyone else want to see this? or code it?\n. If anyone wants to see this enhancement, add your +1 (via add your reaction) to the first comment of this issue.\n. ACMESharp doesn't support revokation yet, https://github.com/ebekker/ACMESharp/issues/57\nHowever you can revoke a cert using the linux client. You will just need the .pem file that the app created. That should be under %appdata%\\letsencrypt-win-simple\\BaseURI.\n. If anyone wants to see this enhancement, add your +1 (via add your reaction) to the first comment of this issue.\n. Yep, it looks like renewal's with V 1.8 don't actually change the binding in IIS. I just put a fix in PR #81 so it's in the latest code. I also fixed that default date format as well.\nRight now it leaves any old certificates in the cert store. However with the default friendly naming convention, it should be easy to filter the old ones out and then you can manually remove them.\n. Looks like that's a feature Microsoft added it. It localizes the / and the : depending on the current locale.\nYou should be able to use yyyy'/'M'/'d'/' h:m:s tt to get it to display as 2016/2/2 9:32:39\nMore Info: https://msdn.microsoft.com/en-us/library/8kb3ddd4(v=vs.110).aspx#dateSeparator\n. It was requested in #30 so it would be easier to sort them in the cert store to see when they were expiring. I added it in the settings file so anyone can change it to whatever they want to.\n. What's the file version of letsencrypt.exe? it's under the file Properties, under Details.\nI have only been updating the file version between releases not the assembly version, that gets updated every time it's compiled.\n. I was going to say, I just fixed that today, and Line 794 in 1.8.5.2 is a } so I figured something was off.\n. 1 would probably be safer since it would only be for the certificate that was just generated. It won't have to do the file system since that would have just been overwritten, and same with the registry key for renewal. So it would just have to remove the cert from the cert store.\n2 is more of an overall cleanup, then the registry and file system should probably also be cleaned up as well. I could see that causing issues if it cleans up too much accidently.\n. I just added --replaceexisting that replaces the existing HTTPS binding. I'm thinking that 1 should only happen when that is specified. So should 1 use that same option or will there be times people want to replace the existing HTTPS binding but not cleanup the old certificate?\nI agree that 2 has to run attended. However, it really seems like a different application, since this one generates certificates and 2 is only going to cleanup certificates. 2 Wouldn't really run any of the existing code, it would probably only get the certificate storage location and that's it.\n. The old behavior wasn't really a manual binding, it would update the binding with the new certificate but it wouldn't remove and recreate it.\nI agree that it should be the default at some point to replace the bindings and after replacing them, but since it's new functionality and nobody has really tested it yet, I wanted to make it an option to replace them until I know it works and doesn't break more. So i'll probably invert it after someone tells me it works or not.\n. --replaceexisting has been replaced with --keepexisting.\n1 was done with #120 by default it now removes old certs after the binding is added to IIS.\n2 will be done tomorrow.\n. You can see the app I did for 2 here.\n. Yep, that's what the current SAN functionality that's being testing right now does for a single site.\n. UPDATE:\nSee Pre-release 1.8.8 for the latest code.\nI have an alpha version of this ready for testing. The alpha version is the important part, there were lots of changes made, it needs lots of testing, and there are already a few issues.\nI would highly advise that you run it with --test multiple times until you are sure it works 100% for your environment. I would also advise to run this in a testing environment. If you run it in Production and it messes up your HTTPS bindings, that's your fault.\nYou should take screenshots of before and after behaviour in case it doesn't work perfectly so you can manually fix it or use them to help report any issue you may find. You should also backup any certificates you are currently using if you are going to replace them.\nTo test it, run it with --test --san (it also works with --centralsslstore)\nYou will see a new plugin so enter s at the site list menu.\nNow enter all of the site id's from the site list separated by commas ex. 1,2,3,4,5,8, or enter s to do a certificate for all hosts on all sites on the server.\nNotes:\nNo matter how many sites you select, the total number of hosts cannot be greater than 100. If it is, the app will give you an error and quit.\nEvery host on every site you select must pass authorization or the app will give you an error and quit.\nWhen installing the certificate to IIS, you will see many more lines logged to the console saying it's setting or adding the binding than you actually have. I have a lot of time trying to fix that issue and I haven't been able to yet, but I coded in a workaround so it works.\nIf you already have HTTPS bindings, it may also error out.\nYou can find it at https://github.com/Lone-Coder/letsencrypt-win-simple/tree/multiple-site-san.\nIf you encounter any issues, create an issue for it, making sure that there isn't already one for the exact same issue you already have.\n. Pre-release 1.8.8 has been released.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/releases\n. I merged it in. Can you add it to the wiki page, https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Settings?\n. I tested it and it doesn't break stock IIS 7.5+. I don't have any older versions to test since Azure doesn't have them.\n. It looks like @ebekker added the references on 11/30 because it looks like it is needed for ACMESharp.\n. That's when ACMESharp was changed to use its NuGet package. And it is a dependency for ACMESharp, https://www.nuget.org/packages/ACMESharp/\n. @DennisHeerema #96 should have fixed this. If you can compile it and let me know if it doesn't that would be great.\n. If you can change the min log level to Debug and run the app again. Then take a look in your event viewer for certRequ. That should have the entire request and response from the ACME server. Can you post that?\n. @DennisHeerema can you give some details as to the bindings that both tries had? I'm wondering if it is an issue with a tld or possibly a name.\n. You can change the min log level in the letsencrypt.exe.config file. See https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Logging\n@DennisHeerema you can email them to my email under my profile.\n. So I found this, https://github.com/letsencrypt/boulder/issues/879, that points to IPv6 being the issue, but @DennisHeerema got a SAN cert working with some IPv4 and some IPv6 sites and had another one fail with both. And others have been able to get single certs with the domains that are failing.\nI'm checking some DNS entries to see if I can find some commonalities.\n. It also looks like someone reported it to the Let's Encrypt Community today.\nhttps://community.letsencrypt.org/t/error-creating-new-cert/10187\n. Can someone with the error change their min log level to debug, run the app, and then look for certRequ in the event viewer? That's the entire request to the ACME server so it might have more info.\n. I think it's failing at certRequ, so that's probably why there isn't anything for it.\n. I'll see if I can find a way to write that to the log.\n. I added in a ton of debugging, then I ran the app to make sure I had all of the variables being saved to the log that needed to be.\nWhile looking through the log, I found the issue.\nThe cert's Common Name was being set to the site's name. So if the site's name happened to be the same as an HTTP binding, it worked just fine. If not, then it blew up.\nI was able to reproduce the issue, and fix it.\nTest out https://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.8.7-pre\n. It looks good, and didn't break anything that I found.\n. @ph11 Could you test the latest source and make sure you don't have issues. #219 disables TLS 1.0 and you enabled it here.\n. There is nothing in the app to delete it.currently, the folder is needed when the renewal process is ran every 60 days. I suppose it could be deleted and then recreated every 60 days. However, if it doesn't have permissions to create it when the renewal runs then you have 30 days to notice and fix the issue before the site has an expired SSL cert.\n. Sometimes permissions change, and if someone doesn't have renewal run as the same user that initially runs the app, that could cause permission issues.\nHaving an error display when the user runs the app the first time vs when the automated renewal runs is probably a better option because it should be seen then.\nHow about it is a configuration option to delete the acme-challenge and the .well-known folders after a successful authorization if the folders are empty (besides the web.config file in the acme-challenge folder). Any failed authorization will keep everything.\n. No idea, but that's why it will be up to the user's to decide.\nThe app logs to event viewer by default https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Logging\n. Fixed in #110 \n. What version had you been on before 1.8?\nDid you try an iisreset?\n. That's strange. Has anyone else had that issue? None of my test boxes had any issues like that.\n. Sometimes IIS likes caching certs, and same with web browsers. I had an issue this weekend where IIS was serving sites with a cert that wasn't on the server anymore, and I had done an iisreset and tried restarting the app pool all to no avail. Eventually after waiting a few minutes IIS started serving the new certificates. Then I had to force refresh my browser and I saw the new certs.\n. After looking through some posts on the IIS forum, it looks like if you don't renew the certificate but generate a new one that you have to remove the HTTPS binding and add it back in.\nSince the renewal for Let's Encrypt certificates is really a new certificate not a renewal, this is probably why.\nI'm thinking a command line parameter to replace HTTPS bindings would probably be the best way to handle it. So when the certificate is generated it knows to replace HTTPS bindings. That can then be saved for renewals.\n. Should be fixed by #111 \n. Are you using the latest source (I pushed a new version this morning File Version 1.8.8.5)? If not, then you need to add --replaceexisting. I changed it this morning so it replaces them by default and you have to tell it that you want to --keepexisting.\n. You can use yesterdays, just you will have to specify --replaceexisting when you run it.\n. What version of IIS are you running?\n. You aren't using Central SSL are you?\nAlso, if you manually update the HTTPS binding, just edit it change something, change it back, hit OK, does that fix it? I noticed that I had to do that with some of my Central SSL bindings even though they are deleted and recreated if the cert changes too much.\n. Can you delete the HTTPS bindings for those 2 sites and manually recreate them and see if they serve the correct certificate then? I have noticed on a couple of tests that I had to wait for the App Pool Timeout period for IIS to start serving the new certificate, even after deleting and recreating the HTTPS binding.\nThere is a setting in the letsencrypt.exe.config file for what certificate store it uses. So you could change that to personal to see if that helps.\n. I have read numerous posts that iisreset, restarting the app pool, and restarting the server won't change the cert. The only way I have seen it work is when the app pool's idle timeout occurs.\nThe only way changing the certificate store would break the comodo cert is if your hostname for C is the same as for A or B. If so, the app will remove the comodo cert unless you add --keepexisting when you run the app.\nYou could also try using the manual plugin, that won't make any IIS changes so you can generate the new certificates for A & B and manually add them in.\n. Another idea, is that you could generate a SAN cert for both A and B. Then they are both on the same cert so the same cert is valid for both.\n. I'll see if I can reproduce it on one of my test servers. If so, i'll see if I can get a ticket open with Microsoft for IIS support.\nIf you want to do a san cert, run it with --san and then enter s at the prompt. Then enter the site ID's for both A and B.\n. I got a test machine to reproduce it with the latest code.\nJust for fun I tried version 1.7 and I don't see the issues with that. I have a couple of ideas where the problem might potentially be. I'll see if I can narrow it down.\n. If you run it with --keepexisting does it still mess up the cert for the other sites?\n. That happens occasionally. If you rerun it it should work just fine.\n. I think I might have figured out the issue. My last test I was able to run it normally and no issues with the other sites, and it was able to cleanup the cert stores.\n. So the fix I found worked for a regular IIS site but not with SAN support. So i'll look at that now.\n. The issue with a single site was the existing binding info was being accessed after the binding was removed. However since --keepexisting doesn't fix the issue with --san if's probably a different issue.\n. I did a ton of testing the last few days and I can't get repeatable results. Sometimes the fix worked for a bit, then it didn't, and others it worked every single time.\nHowever, I think the issue is fixed for both SAN and non SAN with the latest source since I couldn't get the issue to occur one multiple test machines last night running the latest source. But I would like someone to help test to let me know for sure.\nAlso, --keepexisting has worked for me every time, but not everyone else. The only issue with that is that it doesn't replace an existing HTTPS binding. So the new certificate will not take effect until the App Pool reaches it's idle timeout time. that's the only way I have ever seen IIS change the certs, rebooting the server, recycling the app pool, iisreset all don't work. Only waiting for the idle timeout period to terminate it works.\nv 1.7 won't give you the issue, but it doesn't remove the existing HTTPS binding so you will have to take the same steps as if using --keepexisting.\n. Did B and C have existing HTTPS bindings before you ran it?\n--keepexisting won't delete an existing HTTPS binding if there is one. Using it would delay when the certificate takes effect. It won't change the cert until after the idle timeout period.\n. I was finally able to get a server with Visual Studio on it to replicate the issue. I'm going to debug it and see if I can figure out where it messes up the other sites.\n. So I found and fixed a different issue. I'm installing VS on another server that always gives me this issue and i'll step through it there.\n. After I installed Visual Studio, I can't reproduce the issue on the server. This has now happened on two different Server 2012 R2 servers.\nI added in manual debugging steps and tried on another server, and it doesn't mess up anything until it commits the changes to the Server Manager. So that doesn't tell me what is causing it but i'll keep digging.\n. I think I figured it out.\nWhen it sets the IP address for the binding, that's when it messes up any other site bound to that IP address and HTTPS.\nIf you just update an existing HTTPS binding it now works. If you try to add a HTTPS binding through the app, and your HTTP site is bound to an IP, it gives you a warning message and lets you proceed or cancel. If it's set to listen on any IP address it will create the HTTPS binding and you should be good now.\nSo if you aren't listening on any IP address, the best bet is to manually create the HTTPS binding and then run the app.\n. I tested the latest code on a couple more servers and I didn't find any issues with sites using the wrong certs anymore.\nIt might be a bit of a pain manually creating the HTTPS bindings if you aren't listening on all available IPs, but to not have it mess up your certs on all of your sites, I think it's a small price to pay.\n. Well that sounds better than before. The only sites I had to do the workaround to on my servers were ones that had already been messed up from the previous versions.\nI also created a Wiki article about the issue.\n. IIS can be a giant pain when it comes to changing SSL certificates. The Let's Encrypt Win Simple app can't bind to specific IPs without causing issues with other sites. Recreating the HTTPS binding can change the certificate, but it also can cause issues with other SSL sites. The only way I have found to always get the cert to update is to wait for the IIS Application Pool's timeout period to be reached.\n. With it being a runtime option, it will mess up renewals if someone wants to change it. Renewals themselves are stored via the BaseUri, that's the same with how the renewal task is named. That means that if someone sets it for a single binding, it will overwrite all of the other renewals for that same BaseUri. That's why i'm thinking it would be better as an application setting (app.config) than a runtime option.\n. There have been some changes since you did your request. Also, after thinking about it, i'm not sure how useful this would really be. There has already been a change to move the certificates to another folder, so this would just be for the registration and signer file and I think those really should be per user not per computer as there could be multiple users on a computer and they will have different email addresses.\n. Right now it does Web Hosting if that exists, otherwise it saves it under personal.\nIt should be easy to change it to pull it in from the app.conf file.\n. Nope.\nCertificatePath is for the path on disk where the certificate files are stored.\nA new config option will need to be created.\n. Added to the latest SAN build.\n. That feature is currently being tested and is not yet in a fully released version. However, in the pre-release version you can run the application with the --san parameter and it will allow you to generate a certificate for the domains on a single site, or you can tell it to do it manually and specify the domains and the folder path for them.\n. An alpha version of code for this has been uploaded. You can see https://github.com/Lone-Coder/letsencrypt-win-simple/issues/84#issuecomment-180962329 for details.\n. This has been added to the latest SAN build.\n. I added this to the wiki page, https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/web.config, but this is something that will have to be done manually by anyone using it. The app should not edit the web.config for the root of the site.\n. This is supposed to be a simple application, it's already getting complicated enough with SAN support and multiple site/ entire server SAN certificates.\nThe application is designed to work with stock IIS, it is being made extensible so people running custom setups or custom applications can set up their environment as they want it.\nCoding the application to work with everything out of the box gets way too complicated and beyond the scope of what the application is designed to do.\n. After you ran it, did you specify S at the menu to run it for multiple sites?\n. I didn't look at the version you said you were running. The pre-release of 1.8.7 does not support multiple sites or the entire server for SAN certificates. It only supports SAN certificates for a single site.\nMultiple site or the entire server SAN is only in alpha testing right now and has not been released even as a pre-release. You can see https://github.com/Lone-Coder/letsencrypt-win-simple/issues/84#issuecomment-180962329 for details.\n. Your changes do not work with stock IIS on Server 2012, Server 2012 R2, Server 2016, Win 7, and Win 8.1.\nThe included web.config file works with stock IIS on all of those.\nYour changes are already in the wiki for MVC sites https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/web.config#mvc-changes\n. There is no command line argument for the email address. Right now it has to be entered manually for each BaseUri.\nIt saves it in a configuration file (%appdata%/letsencrypt-win-simple/[BaseURI]/Registration) when you ran it the first time for that BaseURI.\n. I would say this is probably a web.config issue.\nTake a look at the wiki. The MVC changes might fix it for you.\n. You should be changing the web_config.xml file in the root of the letsencrypt-win-simple application's folder. Not the web.config at the root of your site.\nThe web_config.xml is copied to /.well-known/acme-challenge/web.config every time you run the app. That shouldn't interfere with the rest of your site.\nIf you still can't get it to work, lookup how to serve extensionless files with ASP.NET Core 1.0, as it is a web.config change so ASP .NET Core 1.0 can serve up the extensionless files.\nIf you get it working with a different web.config than is currently on the Wiki, please add it to the Wiki so anyone else with your issue can see how to get it to work.\n. How are you running the app and what are you generating a cert for?\nCan you change the log level to Debug, try it again, and post any errors in the Event Viewer and the entry right before it so I can narrow down exactly where it is happening?\nYou can see https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Logging#change-log-level for steps on how to change the log level.\n. That would be nice, you should add that as an issue for ACMESharp.\n. Right now SAN support is interactive. It won't work with --manualhost. You can just run it with --san and type m at the prompt. Then follow the rest of the prompts.\nCreating some more documentation is in my to do list, just there are new features added almost daily so it's hard to keep up with them.\n. I added some documentation about how to run it with the command line arguments.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/How-to-Run\n. The --san argument is currently the only way to run the app for SAN. The prompts only come up when you run it for --test so then the prompt for --san would behave different than the rest.\nAlso, --san would have to prompt you as soon as you run the app since it changes the way the program runs. Therefore you might as well just add --san  when you run it.\n. If you check the URL, it is checking http://www.azurelatestversion.esriuk.com. \nwww has no public DNS entry so it can't be accessed by the ACME server.\n. Version 1.8 added in a PFXPassword setting in the letsencrypt.exe.config.\nSee it in the WIki.\n. There were a couple of issues I fixed in my latest commit.\nI had some errors pop up in my testing, and I added the ability for it to create directories if they don't exist.\n. Thanks for reminding me, I forgot to delete that. Good thing the password is a secure string so I couldn't put it in there :)\n. That's an interesting issue and a reason I like it when people help me test.\nRight now it creates the certificate, removes any HTTPS binding for the binding, adds a new HTTPS binding with the certificate, then deletes any old certificates from the certificate store for the same SubjectName that weren't done today.\nThere is no way to distinguish between Let's Encrypt certificates any other certificates so any others you have for that SubjectName will be deleted unless you use the --keepexisting argument when you run it.\nIt's going to take a bit of work to get the uninstall certificate to know what certificate was installed but i'll take a look at that.\n. I can check for the certificate, that's the easy part, but right now the uninstall method doesn't have the installed certificate's info so i'll have to pass the variable along in a few different methods to get it there.\n. Fixed by #125 \n. Try it now.\n. I did it a bit different way in #132, but it should still work now when you do a renewal. Let me know if it doesn't. \n. Since we have changed all of the existing password prompts to secure strings, is there any way to make the password a secure string? Take a look at what ndouthit did with the WebDav and FTP plugins.\n. That's probably better than leaving it in plain text.\n. One thing I noticed is that you are forcing someone to specify a user to run as. What if they don't want to specify a user and just want to run it as the app as been doing thus far? I think a question asking if they want to specify a run as user or use the default would be a good idea.\n. Sorry, I didn't see you already had the question there, all of the formatting changes you committed as well threw me off and made it harder to see exactly what you did.\n. I cleaned up the formatting with ReSharper so it's all good.\n. I ran the latest source code (file version 1.8.8.6) with the following and it worked just fine for me with a blank password and with a password specified in the letsencrypt.exe.config file.\nletsencrypt.exe --test --accepttos --manualhost host.com --webroot C:\\inetpub\\sites\\host.com\\wwwroot --centralsslstore C:\\Central_SSL\nThere are quite a few bugs in 1.8.8.1 that have been fixed so far, I can't remember any specific changes I did for central ssl since 1.8.8.1 but maybe it was inavertantly fixed.\nCan you make sure that your password is set correctly?\nxml\n<setting name=\"PFXPassword\" serializeAs=\"String\">\n   <value>SuperSecurePasswordHere</value>\n</setting>\nFor the listing of the bindings, can you create another issue so i'll remember to fix that?\n. Cool, I didn't have any issues with it when I tested it yesterday, and now you can even see that bindings list should be gone since I added that in this morning.\n. I did another (hopefully the last) pre-release today with all of the latest changes.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/releases\n. #136 fixed this issue.\n. Your changes break stock IIS on Server 2012, Server 2012 R2, Server 2016, Win 7, and Win 8.1\nSee https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/web.config as it already has a section in the Wiki with the static file handler under there.\n. This is a Let's Encrypt Simple Windows Client. It is designed to work on stock IIS. If someone can't get their site to authorize, there are steps on the Wiki they can follow to get their non stock IIS sites to work. There won't be multiple web.config files included in the application since the end user can update the web.config file themselves without having to edit any source code.\n. SAN support cannot be ran unattended.\nTo run for SAN support you just need to run letsencrypt.exe --san You can see more ways to run it on our Wiki page.\nI'd also recommend compiling the latest source code. I fixed some large bugs with SAN and Central SSL support today, and it won't actually generate any certificates for SAN + Central SSL without the latest fixes.\nYour last run was the closest but here's what you need to do to run it.\nletsencrypt.exe --san\nIf you want to generate a single cert for both sites:\ns then 1,2\nWhich host do you want to get a certificate for: s\n Running IISSiteServer Plugin\n Enter all Site IDs seperated by a comma\n S: for all sites on the server 1,2\nOtherwise, if you want to generate a single cert for just the Default Web Site:\n1\nWhich host do you want to get a certificate for: 1\n. Yep, please add it to the Wiki.\n. I'm working on adding support to the client to be able to run a script after the certificate is generated, so that might help a bit after I get that merged in.\n. I moved it to https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Create-a-SAN-certificate-for-Exchange-2016\n. Right now you can run the app manually and generate the certificate. Then you could do something like in https://github.com/Lone-Coder/letsencrypt-win-simple/issues/55#issuecomment-173594059 to write a script to install it, or @angryhussord, https://github.com/Lone-Coder/letsencrypt-win-simple/issues/141#issuecomment-187213858, is going to work on adding steps to the Wiki for Exchange certificates.\n. I moved it to https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Create-a-SAN-certificate-for-Exchange-2016\n. I got that function from the web and didn't change a thing with it when I added it into the project.\nIf you submit a PR for it, i'll get it added in.\nI have been thinking about going through it and refactoring it a bit, but issues and features keep popping up so I add them instead of refactoring the old code.\nI'm planning on a full release of v 1.9 by the end of the month. So hopefully the code won't be changing that much after then. I was also thinking of running it through ReSharper and doing a Full Cleanup. So maybe i'll create a code cleanup branch after the 1.9 release and we can try to clean it up then.\n. If you can undo your commits for everything besides the ObjectExtentions, I'll merge it. There are changes going in for all of the other files so there will be lots of merge conflicts. If you wait a week until after the next version release, i'll create a separate branch for code cleanup and we can work on refactoring it all there.\n. If you keep committing to the same branch you submitted the PR from, GitHub adds those commits into the PR until the PR is merged in or closed.\nI'll just close this one for now and i'll let you know when I have the new code cleanup branch created and you can add your changes to that branch.\n. I think the reason it was under the user's app data folder is because each registration to the ACME server requires an email address. With it under the user's folder each user could get notifications on their certificates expiry. If it was under a central location, then only 1 email address would get alerts for all certificate expiry notifications. There are probably reasons why people want both options so it could go either way.\nRight now you can specify a different location for the certificates it generates, but that could be reworked to allow the entire config folder to be moved. I feel that this should be an option or everyone currently using the application might have to re-register and that will mess up renewals.\n. You can only create 1 registration per Base URI that you use right now. There would have to be more changes to support having multiple registration files.\nAs I had stated the path is configurable for the certificates that are normally stored in that location and with a bit of tweaking that could be reused to move all of the config.\nThose had been added a long time ago and I guess nobody ever added them to the Wiki page. However, you can see examples of them here.\nI'm adding a few more arguments now, so i'll update the arguments Wiki page after I get them added.\n. If anyone wants to see this enhancement, add your +1 (via add your reaction) to the first comment of this issue.\n. I noticed that this weekend one 1 of my test servers but not on all of them. PR #139 fixes it. After that, SAN now shows the Site ID and sorts them ascending.\n. What version are you running? How are you running it?\n. What parameters are you running it for? What plugin are you using?\n. This client only works if you have HTTP bindings for hostnames. Your bindings screenshot only has a single HTTPS binding. You need to add a HTTP one with a hostname to use this client.\n. Yep, it has to be a public domain and a public site that the Let's Encrypt servers can access externally.\n. As a note, I fixed it, #153, so it now will let you know that a SAN site doesn't have a HTTP host binding when you run it.\n. There is a way to run it manually. However the manual process does require an initial setup for the registration right now. The manual process won't add any IIS bindings, but there is a new script process that you could use to run a script after install in the current source code.\n. Here are some links from the Wiki that might help.\nInstall Script\nManual Run\n. Right now that's the only way to do it.\nI opened another issue #151 about adding the ability for more unattended runs, it's going to take some work and won't make it into the next release, but should make the next one.\n. If anyone wants to see this enhancement, add your +1 (via add your reaction) to the first comment of #151.\n. I just added that into the source code yesterday. See the wiki for how to use it.\n. Right now the Manual, FTP, and WebDav plugins all support the script in the latest source code. They also support it for renewal. I didn't think about adding it after the IIS plugin, but that would be a good idea.\nHowever, I would like some feedback from people testing it on the existing plugins before I add it to the IIS plugin. It would be nice to know that the code is good before it's added into the IIS plugin so it doesn't cause more problems.\n. I probably won't have time to do another pre-release before i'll do the next full release so it will probably be released untested.\nIf you want to compile it, here are the steps.\n. That can be done with using a custom install script. You will also want to use --keepexisting to not delete old certs.\n. It turns off the deletion of old certs and the delete and recreate of existing HTTPS bindings.\nIt will keep any old certs in the cert store and it will just update existing existing HTTPS bindings.\n. If anyone wants to see this enhancement, add your +1 (via add your reaction) to the first comment of this issue.\n. Right now the manual plugin does not run any renewals so it won't rewnew, see #195.\nThe wiki clearly states that the script only works with the Manual, FTP, or WebDav plugins.\nThe app saves the script and the script parameters in the registry with the rest of the renewal information right now. That will be moved in #146.\n. If anyone wants to see this enhancement, add your +1 (via add your reaction) to the first comment of this issue.\n. No idea yet. #146 is the first one on my list to tackle then this one, and 146 is going to take a while longer to complete.\nIf anyone else wants to take a stab at this before I can get to it, go right ahead, let me know if you have any questions.\n. @dansali Take a look at #17 for apache support.\n. I think this should really be a separate plugin than an addition to the main program. If you take a look at the IISSiteServer plugin, I did something similar already. But that's only for SAN support so your plugin should only run when SAN isn't specified.\n. Since the precedent of allowing multiple sites has already been made into a plugin, I would have to say it needs to be a separate plugin.\nThe only features that have been added to the main program.cs are changes that affect every plugin globally. More code is actually being removed from the main program and is being ported into the plugins to enable plugins to do more.\nThere is already a windows application built off ACMESharp's PowerShell library.\nKeep in mind this is a simple console application. It is already growing a ton and i'm trying to keep that growth to the plugins.\n. If you want to just make a new issue for each of them including this one, I can take a look at them after the next release (I'm shooting for this weekend or Monday for v1.9).\n. That was fixed in #139 right after the pre-release was released.\n. Yes, this was fixed after the pre-release of v 1.8.9 was released. If you want the fix you will either have to compile the code yourself or wait for another release. I'm targeting this weekend or Monday for another release.\n. Nope, there are some other SAN issues that need to be fixed and testing is happening for one, and I still need to fix the other and test it as well.\n. This could be part of #146.\n. If anyone wants to see this enhancement, add your +1 (via add your reaction) to the first comment of issue #146.\n. What plugin is your renewal using?\n. After taking a quick look at it, this is going to require some time and some fairly big rewrites of multiple methods and some more overhaul of the plugin architecture to find out if it fails during a renewal and to not update the renewal date.\nI'm changing this from a bug to an enhancement since it's going to require lots of changes and lots of testing.\nThe good thing is that Let's Encrypt has been sending out emails for renewals so at least you get a warning before they expire. As you also stated you can change the registry entry and with their notifications nobody's cert should expire without them having enough time to fix it.\n. If anyone wants to see this enhancement, add your +1 (via add your reaction) to the first comment of this issue.\n. Right now the tool does not support renewing via the manual plugin. This enhancement is to enable the manual plugin to renew.\n. It had been removed when the ability to run scripts was added because nobody helped test that functionality. It's on the list to be added back in in #195.\nIssue #195 is for manual plugin renewal please move your conversation there as this conversation is off topic for this current issue.\n. Right now there isn't a way.\nThis is what #151 is about.\n. If anyone wants to see this enhancement, add your +1 (via add your reaction) to the first comment of issue #151.\n. That error means that you have no IIS bindings that are bound to hostnames. You have to have bindings that are bound to host names for it to work.\nFor IIS 7.5, you need to have IIS bindings bound to hostnames and IP addresses for it to work.\n. Your HTTP bindings have to be bound to a host name for the app to see them.\n. You just specify the host for the HTTP binding.\n\n. My guess is it created the one with the hostname. So if you take a look that should be using the new certificate, so keep that one.\n. Yep\n. If anyone wants to see this enhancement, add your +1 (via add your reaction) to the first comment of this issue.\n. 1.8.9 was a pre-release and isn't supported. Version 1.9 was released on the 8th so you should be using that.\nAll of my servers running v 1.9 and Central SSL are using the pfx password in the config file and that's the same password IIS is configured to use and IIS sees all of the certs and can access them just fine.\nYour config looks just fine. I'd have to test it to make sure there aren't any issues. I haven't actually tested Central SSL with the manual plugin before. From what I have seen there shouldn't be any issues with it as long as your HTTPS binding is setup correctly.\n. https://github.com/Lone-Coder/letsencrypt-win-simple/releases\n. The source is currently the exact same as the release.\n. Or I guess it isn't.\n. It looks like https://github.com/Lone-Coder/letsencrypt-win-simple/commit/ac2cbea41c17af9c9fa2e19c8b6091830ad0b61e didn't actually apply. That was just changing the assembly version. So no big deal.\n. You could try using the IIS plugin and selecting the site instead of doing it manually. But the certificate generation process isn't different between the plugins so that shouldn't change anything.\nAs you said when you opened the cert up with Digicert, it is using the correct password. That's leading me to think it's not 100% an issue with the app since the password is correct.\nI can't replicate the issue so I really have no idea what's going on. Central SSL certs worked just fine for me during my testing, and I even have Prod servers using it with the latest version now and it worked just fine for me.\nThe only thing I can think of is maybe it is a special character or space or something in your password. But if you tried it with the one in your config, I have no idea.\n. If you install the self signed FTP cert to your trusted root certs, does it work then?\n. Take a look at http://stackoverflow.com/questions/15462732/obtain-certificate-from-ftps-server-with-explicit-ssl-tls\n. /webroot is not a valid Windows path. It needs to be the full path to the webroot folder ex. C:\\sites\\site1\\webroot .\n. If you do it unattended it looks like it works just fine.\nletsencrypt --accepttos --manualhost www.site1.com --webroot C:\\sites\\site1\\webroot\nI see the error when running it interactively and i'll work on a fix for it.\n. This is the same issue that was fixed in #174. \nCompile the latest code from source to get the fix, or wait for the next release.\n. If you press backspace at the password prompt and there are no characters in the password field to backspace it will throw an error. Don't press backspace if you don't have anything to remove.\n. I just added a Wiki page for this.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/A-specified-logon-session-does-not-exist\n. I did it differently in #174 \n. How are you running the app?\nDid you read through the wiki article on the web.config file?\n. As of right now, there is nothing coded for DNS.\n. I'm trying to test this out, but Let's Encrypt cached old DNS entries for all of my test servers (Azure VMs) so I have to wait for the DNS cache to change before I can validate any of my test sites. All of my current ones were signed by X1 and work just fine with Firefox and perfect results on SSL Labs.\nFrom your results, it looks like it is attaching the X1 cert and not getting the X3 cert now that they switched to using X3 and X4 instead of X1 and X2.\n. So I was sort of able to reproduce it.\nSSL Labs actually says the site is sending the x3 cert. However, Chrome shows it is sending the x1 cert.\n. Firefox shows X3 being sent and IE shows X1 as being sent.\nI tested from a couple of different PCs and Chrome, Firefox, and IE all return X3. So the earlier X1 ones must be cached on that PC.\nAre you using v 1.9.0?\n. Debugging the app, it's working just fine, it doesn't have anything hard coded and gets the URL passed back from ACMESharp and that gets it back from LE. I see it gets the X3 cert back and that's what it uses.\nWith one of my test sites, only 2 browsers on 1 client saw it incorrectly. Those were the two browsers I used the most for testing and that was the client I used the most. So that leads me to think that it was caching it on the client.\n. If you take a look under %appdata%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ there should be a certificate that begins with ca-. That should be the intermediate CA's cert. You could try deleting them and rerunning the app. It will get download and save it if it isn't there.\nYou can also try going to https://acme-v01.api.letsencrypt.org/acme/issuer-cert from the PC you are running letsencrypt.exe from and seeing if you get the X1 or the X3 cert back.\n. Closing this issue, anyone else with this issue, look at the ACMESharp issue.\n. If the issuer cert has already been saved, it doesn't save it again. I can't tell you why that is, but maybe @Lone-Coder knows why.\n. I reopened this so hopefully people stop creating duplicates.\nAs of right now, it isn't an issue with the app itself but an IIS/ client issue.\nWhat I have seen work is removing the X1 intermediate certificate from the server and trying to generate a new certificate again.\nI have also seen that if a client has visited the site when it had the X1 intermediate that it sometimes cached it and I haven't found a good way to clear that out.\n. My guess is Let's Encrypt won't change their certs anytime soon. So you will have it fix it on your side if you want it to work.\nRemoving the X1 intermediate from your computer and generating a new cert and installing it should help out. But it doesn't look like it has helped everyone.\n. Yep if you disable the task, it won't try to renew.\n. I created a Wiki article for this.\nI would close this issue, but I have a feeling not everyone looks through the Wiki before they log an issue, so I think it should stay open a little while longer.\n. Authentication can be a reason why and so can DNS. If you paste the URL I can take a look. Otherwise it could be either of those two or something else entirely. Those are just the two that I have seen before.\n. Let's Encrypt certificates are always 90 days, that cannot be changed.\nThe renewaldays is just for when the renewal task will attempt to renew your certificates. That was really added so you can test the renewal process.\n. I added in some comments. I haven't actually ran it yet to see if it works, so after you make the changes there might be some more.\nIn addition, you need to add your plugin to the main Visual Studio solution under the Plugin folder.\n. Did you use the manual plugin or the IIS plugin when you first created the certs?\n. How did you run the app when you created the certificate the first time?\n. Ok, then that means you used the IIS plugin and not the Manual plugin. That's good because the Manual plugin doesn't auto-renew.\nIf you are using V 1.8 or greater check your event logs for any errors or warnings logged by letsencrypt_win_simple to the Application log. If you aren't, there is no logging so not much we can do to troubleshoot it.\nIf it had any errors or warnings while trying to renew, they should be in your event log.\nYou can also change the minimum log level to Debug and try to run the renew again.\n. Now since the renewal isn't until the 22nd, it won't renew it until then.\nIf you open regedit and go to HKCU\\SOFTWARE\\letsencrypt-win-simple\\https://acme-staging.api.letsencrypt.org/, edit the Renewals and change the renewal date to be in the past.\nThen you can rerun the renewal.\n. Yes, run it with --san.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Command-Line-Arguments\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/How-to-Run\n. The error right there says \"Name does not end in a public suffix\".\nLet's Encrypt only works with public websites and public domain names.\n. Check your HTTP bindings for that site, are they all public domains?\n. So I looked at your error message again. It is seeing MEWebMail.localhost as a binding. If you remove that binding it should work.\n. Duplicate issue, see https://github.com/Lone-Coder/letsencrypt-win-simple/issues/177\n. Duplicate issue, see https://github.com/Lone-Coder/letsencrypt-win-simple/issues/177\n. I added in some comments. I haven't actually ran it yet to see if it works, so after you make the changes there might be some more.\nIn addition, you need to add your plugin to the main Visual Studio solution under the Plugin folder.\nAlso, you don't do much in the way of logging, so you need to add that as well.\nTry to follow the same standards as the rest of the application does, we want to use curly braces around if statements, we want to use full if statements, and we don't want to duplicate code unless there is no other way. The plugin architecture is still evolving, so we can make changes to the main Program.cs and the Plugin.cs to allow plugins to do more.\n. You just need to check them in and merge them into the same branch you created this under. It looks like that is Trumf-dk:patch-6. Here's some more info on stackoverflow.\nFor logging you should add some Log.Debug calls for anywhere someone might get stuck at or encounter an error at. Otherwise if they get an error and can't find out why it isn't working for them, they will have to compile it from source and debug it themselves on their server and not a lot of people can/ will do that on a production web server.\n. Duplicate issue, see #177 \n. Until it's supported in ACMESharp, there is really nothing we can do.\n. @Trumf-dk, the renewal system is going to be completely rewritten soon to not use the registry, so take that into account when working on your plugin.\n. Linking to Revocation enhancement request #78 \n. The Manual plugin is set to allow a buffer size of 8192, so I would think it should let you type that all in there. What version are you using?\n. I tried a few things and I can't get it to accept more than 1022 characters either.\nIf these are all for IIS sites, you could try the IIS Site Server plugin. Type in S at the prompt and put in a comma separated list of of the sites that you want.\nOtherwise, it looks like the manual plugin won't work for all of your domains for a single cert.\n. Yeah, if you don't have the hostnames in the bindings, you can only use the manual plugin.\n. You could just export the SSL certs from the cert store on the 2008 R2 server and import them on the 2012 server.\nAs long as the sites go to the same location you can then export the renewals from the registry and add them into the new server. If they are different, you will have to edit the paths in the entries.\n. This would have to be added to ACMESharp before it can be added here as that's what actually generates the CSR.\nCurrently there is no way to use your own CSR with the app. It was asked for in #165 but there aren't any votes for it so you can add yours to get it implemented sooner.\n. letsencrypt-win-simple is based on ACMESharp. ACMESharp's code is used for all of the certificate and ACME server integration. Let's Encrypt's servers use the ACME protocol, so that's how letsencrypt-win-simple talks with them.\nAfter support for Elliptic Curve is added into ACMESharp, it can be added into letsencrypt-win-simple. So you probably want to open an issue up on ACMESharp for adding the ability to do Elliptic Curve certificate requests.\nI don't think there is currently a way to do Elliptic Curve on Windows with Let's Encrypt as the majority (or maybe all) of the Let's Encrypt Windows clients are built on ACMESharp.\n. You can do a manual unattended request for only a single site right now.\nYou can do a manual request for SAN but it isn't unattended. All SAN support isn't unattended.\n. The manual plugin won't automatically renew. The app will only automatically renew if you are using IIS.\n. It currently can't.\nIf it did, it would renew the cert but it would just save it on the server but wouldn't be used by anything so the admin would have to remember to get the cert from there and install it every 2 months.\nOnly the IIS plugin, and the IISSiteServer plugin (IIS with SAN support) currently allow for automatic renewals.\n. @LBegnaud maybe you should open up a separate issue so we can talk about this more there since it's not completely on track with this issue.\n. A new feature that hasn't been tested that much is the ability to run a script after generating a cert. Right now that works for the manual, FTP, and WebDav plugins only for install since none of those plugins currently support renewal.\nI wouldn't see any issue with adding in renewal for those plugins if a script is specified. The script doesn't have to do anything besides exist and be executable by the user running it.\nIf a script isn't specified, should it still do a renewal? If the cert is renewed, but the admin doesn't realize it, they won't get an email from Let's Encrypt telling them it's going to expire since it will already have been renewed, so then they might forget about it and their cert might expire.\n. That would probably work, or maybe it should be a command line argument. That way it could be done unattended. If it's an argument, I almost think the default should be to renew, and the argument is to not renew.\n. It's not that difficult, but it's going to take a while to code and much much longer to test.\nIt's also not the top priority according to the enhancement voting.\nHowever, it could almost be tied in with #151. So it will still be a while, but it might be in the next release. \n. That happened when the plugin architecture changed to support renewals for the FTP and WebDAV plugins. However, I never finished getting that finished working.\n. It is intended to support this again with the ability to run scripts on renewal.\nHowever, right now this is towards the end of the list of enhancements as only 2 people have said they want it. If you want it, give the issue a thumbs up.\n. It has been merged in.\n. The ACME server won't tell you that the cert is up to date. That would be letsencrypt-win-simple telling you that the renewal date in the registry is in the future for that site.\nSomeone else had this problem recently, if you take a look at #182 that should show you some things to check.\n. Can you try changing the log level to debug and run it again? It might add some more into into your event logs.\nIf it doesn't, I'd suggest downloading the compiled app again because it looks like some reference isn't there..\n. What were your bindings like before, and what are they like after?\nWhat version are you using? What IIS version are you using?\n. Can you post what the bindings were before and after? (Feel free to change the domains if you don't want to list the actual ones)\n. What about your HTTP bindings? The app creates the HTTPS bindings based off the existing HTTP bindings.\nI also noticed that before you were using the MY (Personal) Cert Store and after it looks like a mix of Personal and WebHosting. Letsencrypt-win-simple only creates them in a single cert store, the default is WebHosting if it is available, and Personal otherwise.\nIf you only ran the app once then it looks like it created certs for 0.0.0.0:443, [::]:443, localhost:443, xxxxxxx.com:49443, www.xxxxxxx2.com:443, www.yyyyyyyyy.com:443, pwstate.zzzzzzzzzz.com:9119, and pwstate.zzzzzzzz2.com:443.\nDid you get any warnings when you ran the app while it was installing the certificates?\nI'm not sure of any way it would create a binding for 0.0.0.0:443, [::]:443, or localhost:443. It specifically only uses hosts that have a hostname, and Let's Encrypt would fail to authorize any without valid public hostnames.\n. That sounds a lot like an issue with SAN support that had been fixed a while ago.\nSo are some sites returning the incorrect SSL cert now?\n. If they are, try these steps and see if that fixes the ssl certs.\n. I'm still not sure exactly what you are saying the issue is, or how it happened.\nCan you post your HTTP bindings?\nAlso, exactly how did you run the app, and what inputs did you provide to the app as you ran it?\n. I have tried to reproduce this, but I can't.\nDoes it still change the cert on the wrong site if you run the app with --keepexisting?\n. I'll keep trying to reproduce it, otherwise it's hard to fix it when I have no idea why it's doing that or where it's doing it.\nI'd ask you guys to debug and tell me where it happens, but it's only going to happen at IISPlugin.cs Line 276 or IISPlugin.cs Line 355 (for Central SSL) since that's where it commits the IIS changes.\nOne thing that might help is some examples of what all HTTP and HTTPS bindings and sites you had before and what all HTTPS settings they had enabled (Central SSL, SNI, IP bindings, etc.). If you don't want to post it all here, my email is on my profile.\n. I have multiple servers setup the same way, but I can't reproduce this on any of them. I have some ideas on where the issue might be happening at. I'll probably make a new branch for testing it and i'll need some help to test it on a server with the issue to get some more info.\n. Right now the app doesn't do anything to the website root. It only adds the folder structure to the website root and adds it's own web.conf file under that structure.\nTo do this would mean that it would have to check the authentication of every site every time and attempt to change it, authorize the site, and attempt to change it back. If authorization fails, then the authorization may not be reset causing the site to not load correctly.\nSince it runs unattended for renewals, I would be hesitant to let it change the authentication type.\nAnyone else see merit to doing this?\n. So what you are saying is that the .well-known path would have to be an app under the main site, then the authentication can be changed for that and everything under it.\n. I think I understand it now. And I think I figured out how to do it.\n. If you take a look at the wiki, those should already be mentioned.\nThe default config works with stock IIS, MVC and other frameworks require additional changes, but that's why you can edit the file to work with your environment.\n. Yes, they break stock IIS.\n. @Lone-Coder, i'll leave this PR for you as i'm not sure what you want in the license. \n. 1) That's a setting you can change, this is the current format that was agreed on.\n2) We haven't figured out the root cause for that yet. From what we have seen, it can happen if there are IIS changes made outside the app while the app is running. The current workaround is to rerun the application. Nobody else has reported getting it every time, I haven't seen it more than once a day.\n3) That means you have extra certificates in your WebHosting store. You can use --keepexisting to have it not try to remove certificates.\nYou can change the log level to Debug and it should let you know what the problem certificate is in the event log.\nIf you would like to have any of these added as enhancements, please submit them as separate issues so they can be voted on and worked on separately.\n. It tries to uninstall any certs for the same hostname you are running it for. If it can't it shows the error message and continues on, since you can manually remove the old cert if you so desire.\nI can add in some more debugging so it tells you what cert it is trying to access sooner than it currently does.\n. #224 resolves your third item.\n. It doesn't have any way right now to do it.\nIt would require some modifications to allow it to pull in existing HTTPS bindings and allow you to authorize it. Adding an argument for it would probably be the best way to do it.\n. It will attempt to verify the site again when it renews.\nI force HTTPS on most of my sites and I don't have any issues with renewals. I don't even have issues issuing certs the first time when a site already has HTTPS and forces HTTPS.\nSo it probably depends on how your URL rewrite rule is setup.\n. I don't have my sites set as SSL Required, but I have a URL rewrite rule to send all HTTP requests to HTTPS. Renewals work just fine as long as HTTP and HTTPS are both still enabled and pointing to the same server.\nHere's my rule if someone wants to use it.\nXML\n<rule name=\"HTTP to HTTPS redirect\" enabled=\"true\" stopProcessing=\"true\">\n     <match url=\"(.*)\"/>\n     <conditions>\n          <add input=\"{HTTPS}\" pattern=\"off\" ignoreCase=\"true\"/>\n     </conditions>\n     <action type=\"Redirect\" url=\"https://{HTTP_HOST}/{R:1}\" redirectType=\"Permanent\"/>\n</rule>\n. It was just a suggestion as a possible workaround until DNS validation is added in.\n. Duplicate, see #27.\n. It doesn't look like an ACMESharp issue, but an issue with you connecting to https://acme-v01.api.letsencrypt.org/. It looks like they only support TLS 1.0, TLS 1.1, and TLS 1.2 and they don't support SSL 2 and SSL3 on their server.\nSo maybe your side didn't change, but maybe theirs did. So you might want to check to see what all protocols are enabled for the Windows client. I found this post that shows how to change them for the Windows client and server. I would make a backup before trying it and it does require a reboot.\n. Can you access https://acme-v01.api.letsencrypt.org/directory from your computer? Are you behind a proxy server or a web filter?\n. I'm not really sure what else to check.\nHas anyone else had anything similar to this or any suggestions?\n. Did you generate a single SAN certificate for all of your domains on that IP?\n. Since you are using IIS 7.5 and they are all on the same IP, the only thing that will work is a single SAN certificate for all of your sites on that IP. IIS 7.5 doesn't support SNI so you can only have 1 SSL cert per IP.\n. You would have to compile it for .NET v4 but with the additional libraries that are needed and some of the functions that are used, I highly doubt that it will even run on Server 2003.\nI use Azure for my test machines and Server 2003 isn't on there, and I don't have a Server 2003 ISO so I don't have any way of testing it myself.\n. As long as the change doesn't mess up stock IIS, and I don't think it should, go right ahead and create a PR for it.\n. Merged in.\n. letsencrypt-win-simple uses the ACMESharp library for it's connections to ACME servers. It looks like that's coming from ACMESharp, so you should open an issue up under ACMESharp for it to be resolved there.\n. As of right now, there is not. This was already going to be part of the fix in #151.\n. Yep it does. Thanks for pointing that out.\n. So after looking at the code, it's working as designed.\nThe manual plugin doesn't configure any server software unless you specify a script to run.\n. If you want it to configure IIS that can't be done unattended. That's should be added as part of #151. \n. Did you use the manual plugin with a specified script, or did you have it update it for an IIS website?\n. Then it should renew it automatically. By default it is set to renew 60 days after the cert is generated. That gives you 30 days before it expires to make sure it renewed correctly.\n. Explorer won't let you create a folder or a file without a name.\nHowever you can either do it via the command line mkdir .well-known or you can create it as .well-known. in Windows Vista and greater in Explorer.\n. Sorry it took me so long to test it. It does work just fine on one of my test servers.\n. It's going to take a bit of work to get this to work. Right now the app is entirely driven off hostnames, so a new parameter would have to be created and the vast majority of the app would have to be altered to allow it to be driven off IPs.\nSo it can be done, but it's probably about as much work as adding in san support was.\n. If you go to the URL where it said it should be browsable and look at the headers, what is the content type or content encoding that it shows?\nIn 1.9 the manual plugin won't work unless you are using SAN. That has been fixed in #174 but hasn't been released yet. \n. That should be fine then.\nI'm not sure why it isn't working. Did you just try it once?\n. There have been lots of changes between 1.7 and 1.9. None of them should have affected the content type of the authorization file.\n. Sorry it took me a while to test this.\nIt worked just fine on a test server.\n. This has been removed in #268 as Server 2008 doesn't have TLS 1.1 or TLS 1.2 and needs TLS 1.0 enabled.\n. The manual plugin doesn't support renewals yet. It has already been requested in issue #195.\n. 146 is an enhancement to move the renewals out of the registry and to make over the app's registration files to a per user location so it isn't related to that.\nIs your task scheduled to run if the user is not logged in? Does the user that runs the task have access to the registration folder?\n. So is your scheduled task just running with --renew --accepttos?\nIf so, then you must have manually created or altered the task. If it was generated by the app, It should be running with --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\".\n. Can you send me a screenshot of what the General tab looks like for the task? (Feel free to redact usernames/ domains if you want to)\n. The tasks look fine to me.\nCould you try enabling debug logging and see where it stops at in the event log?\nYou are using the released version from https://github.com/Lone-Coder/letsencrypt-win-simple/releases/download/v1.9/letsencrypt-win-simple.v1.9.0.zip and not compiling it yourself?\nIs anyone else with German Windows having the same issue? What about anyone else not using an English version?\nOtherwise i'll work on tracking down a copy of German Windows to see if I can test it out. However, ich verstehe nur ein bisschen Deutsch. So that will make it more interesting.\n. If you did it once, you shouldn't have to do it again. Unless you deleted the registration file, which if you delete you can't renew (It will just create new certs instead of renewing) or revoke any of the already generated certs again.\n. Right now i'm working on #146 where the files are going to be moved to the ProgramData folder instead user a user's %APPDATA% folder if it's ran with Admin rights. So that should help alleviate that part then.\nAll props for the apps should go to @Lone-Coder. I just started helping out in January when Brian didn't have as much time to devote to it anymore.\n. There are two possible solutions already in the thread.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/221#issuecomment-222999651\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/221#issuecomment-225436576\n. This is already in #146.\n. The renew task does support SAN.\nHad you previously generated a cert just for that one domain?\nIf so, then you probably didn't delete the renewal information out of the registry and so it saw that there and renewed it.\nThe renewals are currently in the registry at:\nHKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\\Renewals\nJust delete the entire line for the single domain cert and it won't try to renew that one again.\n. Thanks for catching this. Nobody else did while testing before that went live.\n. There are no nightly builds. You have to compile it yourself or wait until the next version is released, and there is no current timeline for that.\nNope, read through the wiki article about how to fix the missing cert chain issue.\n. Yes, Let's Encrypt doesn't support wildcard certificates and they have stated that they don't plan on ever supporting them. They do support creating SAN certs with up to 100 names and letsencrypt-win-simple does support creating SAN certs with up to 100 names.\n. Let's Encrypt does not support Internationalized Domain Names (IDN). They were hidden in the tool in #13. \n. That depends on how you run it.\nIf you use manual mode, then no, as it only knows what you tell it. However there is no renewal support for manual right now and it won't install it in IIS for you.\nIf you run it for --san, then you would have to remove it as San requires every hostname binding to pass authorization or it won't continue.\nIf you run it without arguments, then you select what binding to generate a cert for, so you just don't select any IDN bindings.\n. I don't know if it would work even with the IDN characters removed. If someone has an IDN and wants to try it with it translated, please let us know if it works.\n. I'm going to close this issue for now. If someone wants IDN support after Let's Encrypt supports it, please open up an issue for that as an enhancement then.\n. Duplicate of #193.\nAs far as I know nobody has added an issue under ACMESharp to add support for it yet there. Until ACMESharp supports it, letsencrypt-win-simple can't support it.\n. I haven't heard of any other issues with the 2nd domain on a SAN cert. I am using lots of SAN certs and don't have any issues with mine renewing.\nThere can be a number of reasons why it can't reach the file. It could be a DNS issue, an authentication issue, a proxy issue, etc.\nIf you enable debug logging, it will give you the entire message the ACME server returns even though that doesn't give a lot of detail.\n. It looks like the status is Pending for that site. It has a delay already and checks 3 times, so it must be taking a while for Let's Encrypt to load your site.\nMaybe you could load the site via all of the domain names before running letsencrypt-win-simple and that should help reduce the time it takes to load.\n. --warmup isn't in a released version. If you compile it from the latest source, you will be able to use it.\n. What was the output of the app when you ran it?\nThat issue is only when sites are bound to a specific IP. If your sites were set to use all unassigned addresses, then that shouldn't of had any issues creating the HTTPS bindings.\nThe Error removing certificate was fixed in #224.\n. In your first attempt, that error happens every so often. The workaround is just to run the app again. Or Google the error, as there are about 100+ possible fixes for it.\nIt looks like your second attempt was for a single site and it looks like that should have worked.\n. It's going to be a while. I'm working on 146 and 151 and then I anticipate a release.\nVS 2015 Community is a free download. I'm not sure if you can build it just with the build tools or not.\n. I just did a release of the latest changes.\n. You should check your event log to see what was logged during the renewal.\nYou might have to enable debug logging and rerun the renewal again. However the renewals are currently driven off the registry (HKCU\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/), so you will have to edit the registry key to change the date to make it try to renew the cert.\nThe san and centralsslstore options are stored in the registry information. That way only 1 renewal task is needed no matter what arguments you run the app with.\nThere isn't currently any other options besides the regular --renew.\nMy guess is that it either failed somewhere (enhancement request to fix that in #162), or the same issue as in https://github.com/Lone-Coder/letsencrypt-win-simple/issues/221#issuecomment-222999651.\n. Yep, the manual plugin doesn't support renewals right now, but will in the future.\n. This was fixed in #174 but there hasn't been a release since that was fixed.\n. So how this is setup, this won't work for renewals, but only if someone manually runs the app. That means someone is going to have to manually renew their certs every 60 - 90 days if they use the wait option.\nHow are you uploading the files if you need to wait for the user to tell it to check for the authorization?\n. What about making a plugin for Google App Engine instead?\nIt could just be a copy of the manual plugin, but just have the prompt to continue, or have a delay in there before it tries authorizing. Then if anything else needs to be done for Google App Engine in the future, it could be added into that plugin and won't affect any of the other plugins.\n. Closing for now since we decided that a Google App Engine plugin would probably be the best way to do it.\n. It doesn't currently support the DNS challenge, but it should be able to with some work.\n. Possibly, that's going to require a bit of a change to the plugin architecture as only the IIS and IIS Site Server plugins could use the site ID, the others still need to keep the path.\n. I don't think it will show anything else, but could you enable Debug Logging and see if you see anything else in the Event Logs?\n. #146 Might help with this. Otherwise i'm not sure what's causing it.\n. It's in the application settings.\n. Right now that's stored in the registry. Look at #50 as that tells you where at.\nThe location will be moved in #146.\n. Apparently I forgot to upload it to the release. I just added it.\n. This is probably related to #219. My guess is your server only has TLS 1.0 enabled. You need to disable that and enable TLS 1.1 or 1.2.\nThis script should work to enable TLS 1.2 and it also disables insecure protocols & ciphers. You should read through it before running it to make sure you want to do all of it.\n. That's making me think that TLS 1.0 support should be added back in. However, I think it should only be enabled if the OS < NT 6.1.\n. Fixed in #268.\n. If you manually create the HTTPS binding for that site and run it again, does it still error out?\n. There is a wiki article about this.\n. That functionality is already in the app. Check the wiki.\n. This is probably going to take a while to review and test to make sure it doesn't break anything.\n. I haven't had time to do real in-depth testing, but i'll merge it in anyway.\n. Right now it should try each site at least 3 times, and it does wait 4 seconds before it checks for the status each time. So that's a minimum of 12 seconds.\nHere are some options, you can increase the timeout and compile the code yourself, write a script that you schedule to run before letsencrypt-win-simple runs that loads each site (a few other people have said they did that), or change this to an enhancement request to allow that timeout to be configurable.\n. My bad, I wasn't thing it all the way through.\nYou can't change the ACME server's timeout period. Your only option is to load all of the sites before letsencrypt-win-simple goes to authorize the sites. The easiest way to do that would be to add a script that calls them and schedule a task to run that script a couple of minutes before the letsencrypt-win-simple scheduled task runs.\nYou might be able to use https://github.com/spjeff/spbestwarmup with some URL's changed to pre-load all of your sites a couple of minutes before the task runs.\n. I'm thinking this should be added into the individual plugins instead of to the main program. Then there could be a command line argument added in for someone to specify a wait time. That way it can be on a per site basis so sites that don't need it won't have to use it.\n. Fixed in #255.\n. Right now only the IIS Plugin supports automated renewals. It looks like you are using the manual plugin. #195 is an enhancement request to add renewals to the manual plugin.\n. By default the app is set to renew certificates after 60 days. You can change that setting.\nLet's Encrypt certificates expire after 90 days so that gives you a 30 day buffer.\nIf you don't want your certificates to renew 1 month early, then you will need to change the setting to be something more than 60 days (I wouldn't advise doing any more than 89 days as that doesn't give much time if something doesn't work correctly).\nOtherwise you can leave it as is and as long as you generated them with a plugin that automatically renews, they will automatically renew 60 days after they were generated/ 30 days before they expire.\n. Duplicate of #162.\n. It sounds like this might be relateted to #198.\n. I think the config file path still needs to stay, as most people want to specify the cert store for all certs they generate and having to remember to add in an argument every time the run the app will probably result in a lot of complaints.\nI'd say a better option would be to keep it in the config file but add an optional argument to change it on a per run basis.\nI have also been thinking that a next step after #146 would be to try to move the configuration settings to a per user store. Then you could just run it as a different user and it could go to a different store. However, that's probably a long time away.\n. If you can make a script to install it, then take a look at the Install Script page in the Wiki. Otherwise someone will need to make a plugin to support it.\n. For the mime type issue, take a look at the web.config Wiki article.\nManual plugin renewals have been requested, I have no idea when i'll be able to get to it though. I don't have a lot of free time anymore to code.\n. You might have to do some research into the SSTP website, to see how to allow extensionless files to work for it.\nOtherwise you will need to move the HTTPS domain to another IIS website, generate the Cert for there, and then move it back over to the SSTP site and manually change the cert.\n. Wow, that sounds like it should be a lot easier then. It's about time Microsoft made something easy.\n. It could be added in, but it would have to be it's own plugin. I don't use SSTP and I can't really enable it on any of my test servers so someone else will have to create the plugin.\nOtherwise you can just write a script and use the Install Script to move the cert and bind it.\n. Letsencrypt-win-simple has support to run a script after a cert has been updated.\nTake a look at the wiki article on the Install Script. Ideally, your script should use the variables as given by the program and could then be called after a cert is generated for Exchange.\n. Since you are adding a new argument, you need to add that argument to ScheduledRenewal.cs, and then make sure the value is saved when it writes to the Registry and retrieved for renewals.\nAlso, I see your PromptForWarmup method requires a response. Lots of people are having issues trying to automate everything and the prompts are stopping them. So is there any way to get rid of the prompt?\n. All arguments are only valid for the single run of the program.\nRenewals should save the arguments in the registry and read them for each site. That's why you need to add your argument to the ScheduledRenewal.cs.\nI added a note to the Wiki that specifies that arguments are applied to all sites it is ran for.\nSo if someone doesn't want it to apply to multiple sites, they just need to run it twice, once with it defined and once without it defined.\n. Also, there were changes merged into program.cs so you might want to pull in the latest changes as well.\n. If you tested a renewal with both it defined and not defined and the renewals ran, there there should be no issue.\nIf you can add the new argument to the Command Line Arguments page, and add a section or two to the How To Run page, i'll merge your changes in.\n. It has been merged in.\n. Did you create your cert with the manual plugin?\n. The manual plugin doesn't currently support renewals. #195 is an enhancement for the manual plugin to support renewals.\n. You just have to issue the certificate again. So it's a new cert not a renewal.\nIt's going to be a while before I have any time to work on the enhancement. You can post under that enhancement and see if someone else has time to work on it.\n. Technically none of the plugins actually renew any certs. They just issue a new cert with the same info as last time. So it doesn't really renew it. But even that's better than nothing.\nIf you read through the conversation in #195 and the other issues listed there, there was discussion about adding in a command line argument and maybe requiring the script to be specified.\nI'm going to close this issue, and if you have other questions about it, you can post them in #195.\n. Sorry I missed this issue, too many emails.\nYou are correct, the app never modifies the root directories web.config file. Doing so could cause lots of issues, it only updates the one in the .well-known folder.\n. I was already considering this for #151.\n. Duplicate\n256, #248, #231, #195\n. This is a known issue. See the Wiki article on it.\n. Duplicate\n256\n254\n248\n195\n. IIS won't change the cert a site is using unless the site's application pool idle timeout period has been reached. Recycling/ restarting the App Pool, restarting IIS, or even restarting the server won't fix it. If you change the app pool's idle timeout to 1 minute, and then wait a couple of minutes (when nobody else goes to the site) the app pool should time out and terminate. Then it will completely reload when you attempt to load the site and it should reload the new cert.\nAlso, browsers like to cache the cert as well, using a site like SSL Labs is your best bet to see what cert is being used for the site. Otherwise use a different browser on a client that you haven't used before and use private browsing to check it.\n. --keepexisting used to be called replaceexisting and would replace existing HTTPS bindings. I guess that was missed when it was changed over to keepexisting\nHow it was supposed to work, it was supposed to not override the existing HTTPS bindings. It should still create HTTPS bindings for HTTP bindings that don't yet have HTTPS bindings. So your changes wouldn't accomplish that. Yours will not create any bindings at all if you specify keepexisting and it should create the ones for the HTTP sites.\n. You can also take a look at the Wiki article on the web.config. It has some other examples in there for different applications.\n. What OS are you running?\nAre you generating a manual certificate, or selecting domain(s)/ site(s) to generate a cert for?\nThe app has to verify each domain and subdomain. So if your simple site was site1.com and the more complex site is site2.com or even app.site1.com, both are verified sperately.\n. Yep, take a look at the Wiki article on IIS 7.5. You have to generate a SAN cert for every site on that IP, if you only have 1 IP than a SAN cert for the entire server.\n. You simple need to remove the certs from either IIS or the cert manager. Then remove the renewals from the registry, see #50 for that.\n. Duplicate of #151 \n. Fixed in #268.\n. Duplicate\n261\n256\n254\n248\n195\n. It will still generate a new cert and save it under the local store. You can use that or you can use the cert for your site under %AppData%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org. You should see a new cert that it generated for your site under there.\nYou will have to then change Apache to use the new cert.\n. You shouldn't delete your registration file under that directory. If you do you won't have any way to renew or revoke certs (when those features are officially supported).\nWhat's the output of the program when you run it?\n. I can't tell you why it isn't generating a new certificate with an extended expiration date without seeing the output to see if there are any errors or warnings. You can check your event log and see if there are any errors or warnings logged as well.\n. No problem, sometimes it just takes someone else to be involved and it starts working correctly.\n. Duplicate #106 #140.\nYour changes do not work with stock IIS on Server 2012, Server 2012 R2, Server 2016, and Win 8.1.\nThe included web.config file works with stock IIS on all of those.\nYour changes are already in the wiki for MVC sites https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/web.config#mvc-changes\n. I'm not sure if multiple plugins should be ran at once. The app isn't really designed to run more than a single plugin at once, and i'm not sure what use there could be to run multiple plugins at once since right now they would share the arguments for what to run for, and their certs would overwrite each other.\nI'll take a look at it and test it out to see how it works.\n. What error does it throw?\n. If you want someone to look into the error, you need to provide the actual error encountered.\n. That's already in the Wiki. That's an error IIS is throwing. Make sure you don't have the IIS management console open as that sometimes causes it.\n. You need to undo your changes to the web_config. They are preventing an automatic merge, since the web_config has been changed.\n. The return is going to end the program. This isn't a fatal error that should end the program. Just set certificatePath = configPath; \n. Change the Log.Error to a Log.Warning and say it was defaulted to the config path.\n. To follow the same convention as the rest of the app\nc#\nConsole.WriteLine($\"Error creating the certificate directory, {certificatePath}. Defaulting to config path\");\n. You don't need to add the --test option as the renewal is done via the used BaseUri. If the BaseUri changes for the --test option, doing it this way it won't be a renewal but it will generate a new certificate signed by a different source.\n. This doesn't follow the app's conventions for if statements.\n. This section is only ran if a user specifies to run in --san. Therefore no null checks should happen in here.\n. Yep, it shouldn't have that hard coded in the plugin as the value is already set in the main program and it can be different. I'll give an example when I add in all of my PR comments.\n. This should not be hard coded in here. However there isn't currently a way in the main Program to get this value. So it needs to be changed to Public in the program and then you should use Program.ClientName wherever you need to use it.\n. Is the goal to only to list the sites/ hosts that the app will see? If so, then you should instantiate a new plugin object and call the IISPlugin's GetSites.\nIf not, I don't see the point in listing every IIS site and every binding in the app.\nAlso, you need to consider that listing these can be long and by default the command prompt only shows 50 lines. So you need to do some pagination like is done in the main program for listing sites. Make sure you use the hostsPerPage setting.\n. Use the full if else format like is done in the rest of the app.\n. You can't default to this value. If you look in the Program it has some logic that sets the _certificateStore. The _certificateStore needs to be made public under the Program.cs and then you need to use that value.\n. Is the goal to list all certificates or just Let's Encrypt certificates?\n. This main code for getting renewals shouldn't be in your plugin but in the main program.\nThen you should run it to get all of the Renewals and can then print them out under your plugin.\n. I like this but I think it should be moved to the main Program and can then be used by the other plugins.\n. This should only show if Program.Options.San is true.\n. Add a check for Program.Options.San if not,\nConsole.WriteLine($\"Please run the application with --san to generate a SAN certificate\");\nLog.Error(\"Please run the application with --san to generate a San certificate\");\n. You need to instantiate a new plugin object and call the IISPlugin's GetSites to get all of the sites. That will filter out all of the invalid sites.\n. Use curly braces around your if statements.\n. Use the regular if, else syntax like is used in the rest of the program.\n. If you can, instantiate an instance and run the IISSiteServerPlugin's CreateTarget so code isn't duplicated.\n. If this is copied from another plugin, instantiate that plugin and run it via that plugin.\n. This needs to be a class added to the solution, not a class added directly in your plugin.\n. It will have to require --san to be set for this to show.\n. It will have to require --san to be set for this to show.\n. Why won't it work?\n. You have multiple if's in there. The ? : syntax is not used in the rest of the app so it shouldn't be used here.\n. Why won't the CreateTarget from IISSiteServer work?\n. Since you are doing the exact same thing, and your plugin really is doing the same thing as the IIS Site Server plugin, but doing it with domains instead of multiple sites, you should just use the same function. Otherwise there is duplicated code and when changes are made to one nobody will remember the other and issues will pop up.\nYou can make it public if you want to, otherwise add an issue for it and it will be prioritized with all of the other enhancements.\n. You haven't said why it won't work. Depending on what it is, GetSites could be changed or another method could be created to give you what you need.\n. Pagination has already been requested and implemented into the app, so it is now accepted as a standard feature for the app.\n. Same thing as the others, the ? : syntax for if statements is not used in the app.\n. You don't need to leave the old code in there since you are replacing it.\nOtherwise it looks and works great. It accepted up to 16382 characters for me. That's up to 162 characters per domain up to the 100 domain limit. If someone goes over that, I think they need shorter domains.\n. If you check your code into the same branch you did this PR from, it should merge it right into this same PR. Here's some more info on stackoverflow.\n. renewal.Warmup won't be saved as a boolean to the Registry but as a string. So as you have it, it will probably error out during renewal.\nTake a look at KeepExisting above.\n. It won't actually be able to save it as a boolean to the Registry, it should convert it to a string when it saves it, but it will then have issues converting the string back into a boolean when a renewal runs.\nTake a look at KeepExisting above.\n. ",
    "ebekker": "I've just submitted PR #65 which upgrades to the latest ACMESharp library and related dependencies.  With this change, it should now be possible to implement this feature relatively easily.\n. Cool, thanks.\n. When you authenticate an Identifier and successfully complete a challenge, the status of that ID changes to valid and it gets assigned an expiration.  I just checked for a test that I completed against the LE STAGE API a couple days ago, and the validation expires in September of next year.  I also checked the test against the current LE BETA API and it has a similar expiration date out in September.\nI'm not sure if this is the time range they plan on sticking with once they go live with an open BETA and then finally PROD, but as long as you reference a DNS Identifier in your cert request that is currently valid, then you don't need to complete any more challenges.  (Obviously, this requires that you use the same Registration.)\nBut note, that even in this case, you will eventually need to re-validate the DNS Identifier, so you will either need to open up the port again or perhaps by then, the LE server will start supporting alternate methods of validating or re-validating, such as the Proof of Possession of a Prior Key or even the DNS method which are less invasive to a current web server's configuration and environment.\n. @leonletto, in your specific case, you simply want to switch from the clear-text HTTP challenge method, to a more secure HTTPS challenge method, such as the TLS with SNI method, correct?  If that's the case, the LE server already supports this second method, and I definitely plan on adding this method to be fully supported in the base library, and I assume @Lone-Coder will surface that as well in this client.\nI'm holding off on implementing it till the spec is finalized -- the spec authors are still debating some of the finer points of how this challenge method is supposed to work, and I don't want to have to redo the implementation (again!).\n. And are you running as admin with elevated privileges?\n. What version of Windows/IIS?  If it's 2012+, do you have SNI enabled?  You need to use SNI if you have mutliple SSL-enabled sites listening to the same network interface + port binding.  Also note, this can only be done on Win2012+, prior to that you needed to use distinct bindings for each SSL-enabled site.\n. ACME spec is very explicit the HTTP challenge must be over the standard HTTP port 80 for security reasons. You may be better off with the DNS challenge when that becomes supported by the LE project.\n. The DNS challenge just requires you to make a particular DNS entry available for the CA to verify, no need to make any changes on the web server.\n. No, the DNS challenge does not interact with the Web server at all.  It is strictly DNS-based only\n. Just to give my $0.02, in the ACMESharp library, with the 0.8 release, I moved to a \"Profile\" mechanism, that allows you to create multiple Vaults (one with each Profile).  Along with that is the default Profile which is implicitly stored in the \\ProgramData folder if you run with Admin privileges, and in the user's %LOCALAPPDATA% if you don't.\nAll of the PowerShell cmdlets take an optional Profile name to override which Vault they operate on, which by default goes to the default Profile.  I think this has turned out to be a good compromise for flexibility without overly complicating things.\n. ACMEv2 library is internally limiting crypto calls to those APIs which are available in .NET Standard to make it portable.  There are actually two sets of APIs that are available, one that is native to the BCL supporting .NET Standard (i.e. built into .NET Core 2.x) and another that is based on BouncyCastle (to support non-Core environments like .NET Framework and mono (like Blazor)).\nBut I doubt either of these is FIPS compliant.  Because of the interface-driven approach that ACMESharpCore takes to its crypto-usage, it is possible to write a new set of crypto implementors that are strictly based on FIPS compliant, my guess is you would need to limit it to .NET Framework APIs like the CNG calls which Microsoft certifies.\nCC: @glatzert -- wanted to call out the advantage of interface-driven API for scenarios like this.. According to @rdebath, this is an issue with the way the PFX archive is exported.  With the current and latest version of ACMESharp, I've moved over to BouncyCastle as the main supported crypto provider (OpenSSL lib and CLI versions are still there if needed, but I'm not planning on supporting them going forward because they were brittle).\nSo the code to generate the PFX is here, so if there is some option that I need to provide to generate an Exchange-friendly PKCS12 archive, I'll be happy to include it, or at least make it optional.\n. Now, I'm not sure if this project has upgraded to the latest version of ACMESharp yet (0.9.x) but if not, then you may be working with the output of the OpenSSL CLI crypt provider, which was the previous default implementation.\n. I published the latest to nuget.org just a couple days ago, including some recent bug fixes.\nOne major change that I made with 0.9.x was a change in how providers work for the Challenge Handlers and also the introduction of Installers, but if I understand correctly, LEWS does not use the ACMESharp implementations of Handlers (and certainly not Installers), so it pby shouldn't break anything.\n. As of today, ACMESharpCore work is in progress again.... Just to provide an update on ACMESharpCore that is relevant to win-acme -- all the functionality for ACME protocol is done, the 2.x core protocol client in its current stage is actually more feature complete than the original 1.x client.\nWhat I'm working on now is actually refining the API and \"in-the-box\" support for things like cert and key management, but those things are ancillary to the ACME v2 protocol support.  So if win-acme has its own way of managing that (like storing things in the registry or using .NET Framework APIs for things like key pair and CSR generation), then you likely won't care of about that anyway.\nMy approach to refining the API and seeing what would be needed is by working through several example applications and seeing what is awkward, difficult or impossible to do with the ACMESharp client library, but 2 of these are already complete and working so they can provide sufficient guidance in using the client library.\n. Which components are you looking to keep backward compatible, the locally stored assets, such as private account key, order details, certificates?\nDoes win-acme store all those using .NET Framework artifacts, such as export of AsymmetricAlgorithm instance and X509Certificate2 instance?  If so and those are the elements you're referring to, I believe you should be able to continue to use those.\n. Have you re-tried this multiple times and at a later time from when the error originally happened?  There have been known cases where LE staging server gets broken or parts of it are unavailable because of some update but later corrects itself.  Also, have you tried this against LE production?\n. Speaking of which, there was an incident with LE stage over the last 12 hours:  https://letsencrypt.status.io/\n. Just ran through a successful Identifier validation against LE PROD (just using ACMESharp PowerShell client, not the letsencrypt-win-simple CLI).\nHere is my request submitting the completed challenge:\n```\nPOST https://acme-v01.api.letsencrypt.org/acme/challenge/T1gymXvQg8cAvbk6fWmZYEVpQ1o65ddLx74wGrP3WcQ/1716086487 HTTP/1.1\nContent-Type: application/json\nUser-Agent: ACMEdotNET v0.9.0.0 (ACME 1.0)\nHost: acme-v01.api.letsencrypt.org\nContent-Length: 1116\n{\n  \"header\": {\n    \"alg\": \"RS256\",\n    \"jwk\": {\n      \"e\": \"AQAB\",\n      \"kty\": \"RSA\",\n      \"n\": \"lSBF6JRoFB99fl7AcvAHQlIepO1VP8NIcezhHao5VOQzpRdjV4tc9f0pdHPxJ98beBKrXLL5qnktsuldLdKfToikfYxII51oqhPScEGNl-kawo1q6Ct7b0jTp2jSMOsf1WLuR-Y4zVF9vb7EwLurCcEiOSs8l5X7pXkU9FBZCjRHU-2HsU6VpjUmfV5a1GjuquOke7hiAHEWou6ElAqFWBd_J8CknBgTL38J2GYLESRBfq9Y_5MT-TF85PskMFPkc_DYiVIdpgtlSipfi10T2oOoqsoT7A26C8MFgrChq8oknzO203E-f0lZtxDqomky8hYOLcmTAS8H_ObtodLuZQ\"\n    }\n  },\n  \"protected\": \"eyJub25jZSI6ImdSRF9NUExET0dCRVg4T1ZrSUZ6dnN5WlNPTGQyZjNMekdKS0tYVWVFa28ifQ\",\n  \"payload\": \"eyJSZXNvdXJjZSI6ImNoYWxsZW5nZSIsIktleUF1dGhvcml6YXRpb24iOiJBcXdTN19XQXowTkV5TFptVldIcHZOVDZvYmo2dUdGRkVwajVpTFhqQjJjLmJvWmt5b0RfbGhua2V5RlJGcGR3Qk9kWkljbkFSMjNNVDh1N0VuWUdMdFEifQ\",\n  \"signature\": \"UBgRMbB1KWv5mwHhsfa_5dh8M9ECbhC4tAkGfZzJOzuTxxLYkXJk-gL8MYbMNSTDzsBrzva0erh3znMQaCxpdRLpMgahR9e23TZ6ZdoVU8gId1QossAyuVpC81axkZoW7ZybyHMlTXzh8y1yoYJFuOTC0RR3qJebWFt9JW6JBY-AsPz5lMcXdFZR9HbzFQcfbpYSHg6ZrU0Qc2crm6OboIAE6o8jJuSyIfaHA6aNQup4xt5xPgNSxX7o7jDEFC2nA6KEYTrdCFvO4KsHFG9n8qhEBLzJag6ZGXm-mRw77tNdcPVtK-ZojIstEvy-bbjgS-AiB6JprCBvHhbp5gPOig\"\n}\n```\nThe payload element decoded is:\n{\"Resource\":\"challenge\",\"KeyAuthorization\":\"AqwS7_WAz0NEyLZmVWHpvNT6obj6uGFFEpj5iLXjB2c.boZkyoD_lhnkeyFRFpdwBOdZIcnAR23MT8u7EnYGLtQ\"}\nWhen I try to decode the payload element from your failed request in your Fiddler session, I get:\n[{\"Key\":\"Resource\",\"Value\":\"challenge\"},{\"Key\":\"KeyAuthorization\",\"Value\":\"I4UCD-X7g1D314LPj5iE2ZJf6bynGtMZlgXjtGPw4iM.5TgkcejXoIl_ZckdDgJUnuM7UMh2reOkH53qtsTDYj0\"}]\nSome how the payload in your case is get serialized at the wrong level -- that is, it's JSON encoding the already JSON-encoded payload.\nI'm not intimately familiar with how the ACMESharp lib is used by this project, but has something changed under the hood recently?  Is this problem seen by anyone else?\n. The issue appears to be somewhere around this line of code which looks like it was just impacted by a change about 2 weeks back.. @WouterTinus, did you recently upgrade or switch versions of Newtonsoft?. Note, the first report on May 4th was actually of last year (2016) so I'm not sure the two are related in this case.  But glad it seems to be working with the latest JSON lib.. Hey guys, sorry late to party.  More than welcome to host this under the PKISharp umbrella, it's the reasoning behind it, collection of .NET-supporting tools for PKI and security.\n@nemchik -- GitHub does a good job of redirecting old names to new names when referenced by URL.  Likewise if a repo is moved from under one ownership (e.g. person) to another (e.g. org).. @Lone-Coder -- the current ACMESharp is still hosted under by personal account, but new work (i.e. docs repo, .NET Standard client, server project, etc.) are all being done under the PKISharp org.  I will eventually move the current client lib under PKISharp as the \"legacy\" client.\nThere is currently a fork of ACMESharp already under there and I have some changes in that repo that I need to review and either trash or merge, and then I'll delete the fork -- once that's done, I can relocate the current ACMESharp project to its new home.\n. Hey guys, let me know if there's anything I need to do to enable this.. ",
    "gijswijs": "@ebekker You are my favourite person on the world right now.\n@lone-coder you come in 2nd, but the 1st place is up for grabs if you support it. ;)\nWill try it with. ACMESharp asap. \n. Hey,\nI had the exact same issue.\nBut I could fix it through the IIS GUI by selecting the new certificate in \"Edit Site Binding\" and I didn't get any errors after that.\n\nWorked like a charm.\n@Lone-Coder Your client is a christmas gift!\n. Thank you for your swift reply!\nto be clear, it's not perse a problem with a a 2nd domain. I've issued SAN certificates for multiple domains, as long as each domain was bound to a different IIS site.\nBut if I try to issue a certificate for a single IIS site with multiple domains bound, I get this error on the 2nd domain and onward:\n\n2016-05-27 15:57:21.038 +02:00 [Debug] Full Error Details AuthorizationState { IdentifierPart: IdentifierPart { Type: \"dns\", Value: \"libris-tolino.mindbus.net\" }, IdentifierType: \"dns\", Identifier: \"libris-tolino.mindbus.net\", Uri: \"https://acme-v01.api.letsencrypt.org/acme/authz/[...]gUj1-uQpSFtfBUQ6t7AChwPPF8Ph0aM\", Status: \"invalid\", Expires: 06/03/2016 13:57:12, Challenges: [AuthorizeChallenge { ChallengePart: ChallengePart { Type: \"tls-sni-01\", Uri: \"https://acme-v01.api.letsencrypt.org/acme/challenge/[...]gUj1-uQpSFtfBUQ6t7AChwPPF8Ph0aM/97405686\", Token: \"[...]XEXU-kjLFzrm9yRGtoh11XYYmebJVRE\", Status: \"pending\", Validated: null, Error: null }, Challenge: null, Type: \"tls-sni-01\", Uri: \"https://acme-v01.api.letsencrypt.org/acme/challenge/[...]gUj1-uQpSFtfBUQ6t7AChwPPF8Ph0aM/97405686\", Token: \"[...]XU-kjLFzrm9yRGtoh11XYYmebJVRE\", Status: \"pending\", OldChallengeAnswer: KeyValuePair2 { Key: null, Value: null }, ChallengeAnswerMessage: null, HandlerName: null, HandlerHandleDate: null, HandlerCleanUpDate: null, SubmitDate: null, SubmitResponse: null }, AuthorizeChallenge { ChallengePart: ChallengePart { Type: \"http-01\", Uri: \"https://acme-v01.api.letsencrypt.org/acme/challenge/[...]gUj1-uQpSFtfBUQ6t7AChwPPF8Ph0aM/97405687\", Token: \"[...]w7HLbk6mV7TSejLMKahKPPY4p_86YRVTs\", Status: \"invalid\", Validated: null, Error: [(\"type\": \"urn:acme:error:connection\"), (\"detail\": \"Could not connect to http://libris-tolino.mindbus.net/.well-known/acme-challenge/[...]7HLbk6mV7TSejLMKahKPPY4p_86YRVTs\")] }, Challenge: null, Type: \"http-01\", Uri: \"https://acme-v01.api.letsencrypt.org/acme/challenge/[...]0TgUj1-uQpSFtfBUQ6t7AChwPPF8Ph0aM/97405687\", Token: \"[...]HLbk6mV7TSejLMKahKPPY4p_86YRVTs\", Status: \"invalid\", OldChallengeAnswer: KeyValuePair2 { Key: null, Value: null }, ChallengeAnswerMessage: null, HandlerName: null, HandlerHandleDate: null, HandlerCleanUpDate: null, SubmitDate: null, SubmitResponse: null }, AuthorizeChallenge { ChallengePart: ChallengePart { Type: \"dns-01\", Uri: \"https://acme-v01.api.letsencrypt.org/acme/challenge/[...]0TgUj1-uQpSFtfBUQ6t7AChwPPF8Ph0aM/97405688\", Token: \"aFDox5T9TuJdMXtVZvExvJRDCkpSC5SSncRCQR3Ev1o\", Status: \"pending\", Validated: null, Error: null }, Challenge: null, Type: \"dns-01\", Uri: \"https://acme-v01.api.letsencrypt.org/acme/challenge/[...]gUj1-uQpSFtfBUQ6t7AChwPPF8Ph0aM/97405688\", Token: \"[...]XtVZvExvJRDCkpSC5SSncRCQR3Ev1o\", Status: \"pending\", OldChallengeAnswer: KeyValuePair`2 { Key: null, Value: null }, ChallengeAnswerMessage: null, HandlerName: null, HandlerHandleDate: null, HandlerCleanUpDate: null, SubmitDate: null, SubmitResponse: null }], Combinations: [[1], [2], [0]] }\n\n(I left out parts of the tokens intentionally, because I'm paranoia. Could I have copy pasted everything in unedited?)\n. I'm sorry to revisit this issue once again.\nI use your client extensively, but from time to time keep running into this issue.\nI just reran the client up to 10 times to have it pass.\nIt's probably because it takes too long for the challenge answers to load, although it doesn't take that long.\nI tried running it with the --warmup argument, but that argument isn't recognized (anymore?)\nIt would be great if you could make that argument work again. Or make the timeout configurable in letsencrypt.exe.config\nRegards,\nGijs\n. @rkerber \nWoop Woop!\nI compiled from source. --warmup worked, but still didn't do it for me.\nThen I changed Thread.Sleep to 10000 on line 1211 in Program.cs and that was exactly what was needed.\nI just created this SAN certificate for 22 domains and it works flawlessly!\nYou made me so happy! Again!\n. Would be a great feature.\n. 1) I would vote for Azure DNS but that's becasue we are heavily invested in the Azure cloud.\nhttps://docs.microsoft.com/en-us/rest/api/dns/\n2) Good suggestion, but I could certainly envision other scenario's where the services are publicly accessible but the HTTP challenge isn't a good fit.. Again LEWS never fails to impress me. \nThis is the best thing since sliced bread!\nOff to test as well!. I assume removing the certificate with the MMC certificate Snap-in will do the trick.\nBut @rkerber know best, obviously.\n\n. ",
    "RvdHout": "+1 for SAN support\nWould love to see this feature added to 'letsencrypt-win-simple' \nInstead of showing the complete list of sitebindings this would mean the list of site names (id) is shown, right? \n. I get a error when calling --renew, eg:\n02/02/2016 09:26:16 +01:00 [Error] Error ArgumentNullException { Message: \"Value cannot be null.\nParameter name: collection\", ParamName: \"collection\", Data: [], InnerException: null, TargetSite: Void InsertRange(Int32, System.Collections.Generic.IEnumerable1[T]), StackTrace: \"   at System.Collections.Generic.List1.InsertRange(Int32 index, IEnumerable`1 collection)\nat System.Collections.Generic.List1.AddRange(IEnumerable1 collection)\nat LetsEncrypt.ACME.Simple.Program.Authorize(Target target) in C:\\projects\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 794\nat LetsEncrypt.ACME.Simple.Program.Auto(Target binding) in C:\\projects\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 340\nat LetsEncrypt.ACME.Simple.Program.CheckRenewals() in C:\\projects\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 723\nat LetsEncrypt.ACME.Simple.Program.Main(String[] args) in C:\\projects\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 154\", HelpLink: null, Source: \"mscorlib\", HResult: -2147467261 }\nVan: Robert Kerber [mailto:notifications@github.com] \nVerzonden: dinsdag 2 februari 2016 04:40\nAan: Lone-Coder/letsencrypt-win-simple letsencrypt-win-simple@noreply.github.com\nCC: RvdHout ruud.vd.hout@hotmail.com\nOnderwerp: Re: [letsencrypt-win-simple] SAN for multiple names (#3)\nI just added PR  https://github.com/Lone-Coder/letsencrypt-win-simple/pull/77 #77 and it should now support SAN.\nJust use --san, both the manual and IIS plugins are supported.\nLet me know if you encounter any issues, there were a lot of changes so i'd be surprised if someone doesn't find an issue.\n\u2014\nReply to this email directly or  https://github.com/Lone-Coder/letsencrypt-win-simple/issues/3#issuecomment-178349600 view it on GitHub.\n. Thx, seems OK now\n. letsencrypt.exe --san shows IIS site id's (can have multiple bindings)\nletsencrypt.exe shows all unique bindings \nBTW, this feature is not yet in 1.8, get 1.8.5.2 artifact here to test this\n. When you are building it from the latest master you should be good.\nMmmm strange, no errors where displayed during the creation of the certificates?\nHow much bindings does that site have, do go beyond the limits?\n. I think you are mistaking there... all the bindings must respond to the ACME challenge, otherwise the domain can not be validated, once an errors occurs, the program stops and will not create the IIS bindings nor create certificates\nin my test i just created a single certificate for example:\ndomain.com\nwww.domain.com\n. Shouldn't matter I guess...but remember the limits currently in place by Let's Encrypt!\n\nThe limit on Certificates/Domain is 5 certificates for a registered domain in a sliding window of 7 days. We know it's restrictive at present; thank you for your patience in helping us ensure Let's Encrypt is ready for the whole world.\n. Why do you assume a SAN certificate ignores the limits? \n. I think your assumption about SAN certificates VS limits is way off, but i leave it to the experts to answer. Why should they have limits in place on the first place if this could be bypassed by SAN certificate?\n. I noticed the log4net library in the download package so i thought maybe some hidden option to enable logging was already in place, would be a nice feature to have in a future release, thx!\n. I think really think it's due the dateformat change, on another box i still use v1.7 and those certificates renewed today and the bindings are updated with those certificates\n\nAnd shouldn't old certificates not be automatically deleted? if you have lots...the certificate store gets so messy\n. One issue still, eg:\n<value>yyyy/M/d/ h:m:s tt</value> still is being converted to 2016-2-2 9:32:39, why did it make dashes from the slashes? (The OS is a English Windows Server 2012 R2 with Dutch locale set)\n. Lol,  honestly i don't know why you changed it ;-) \nThe previous display format was exactly how we show it here in the Netherlands and most of the rest of Europe, eg: d-M-yyyy HH:m:s or better: dd-MM-yyyy HH:mm:ss\nSo now i think i'll use <value>dd-MM-yyyy HH:mm:ss</value> for my Certificate friendlynaming\n. I know, i saw that request, no harm done ;-)\n. I downloaded the latest artifact from appveyor.com and gave it another run changing back date in registry to 2-4-2015\n\nC:\\Tools\\letsencrypt-win-simple>letsencrypt.exe --renew\nLet's Encrypt (Simple Windows ACME Client)\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\htt\npsacme-v01.api.letsencrypt.org\nLoading Signer from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simpl\ne\\httpsacme-v01.api.letsencrypt.org\\Signer\nGetting AcmeServerDirectory\nLoading Registration from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win\n-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\nChecking Renewals\n Checking IIS autodiscover.vdhout.nl (%SystemDrive%\\inetpub\\wwwroot) Renew After\n 2-4-2015\n Renewing certificate for IIS autodiscover.vdhout.nl (%SystemDrive%\\inetpub\\wwwr\noot) Renew After 2-4-2015\nSystem.ArgumentNullException: Value cannot be null.\nParameter name: collection\n   at System.Collections.Generic.List1.InsertRange(Int32 index, IEnumerable1 c\nollection)\n   at System.Collections.Generic.List1.AddRange(IEnumerable1 collection)\n   at LetsEncrypt.ACME.Simple.Program.Authorize(Target target) in C:\\projects\\le\ntsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 794\n   at LetsEncrypt.ACME.Simple.Program.Auto(Target binding) in C:\\projects\\letsen\ncrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 340\n   at LetsEncrypt.ACME.Simple.Program.CheckRenewals() in C:\\projects\\letsencrypt\n-win-simple\\letsencrypt-win-simple\\Program.cs:line 723\n   at LetsEncrypt.ACME.Simple.Program.Main(String[] args) in C:\\projects\\letsenc\nrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 154\nPress enter to continue.\n. 1.8.5.2....wait a second...maybe i screwed up, let me check\n. Sorry, my bad....seems to be OK now, seems i was still working with 1.8.5.1 not 1.8.5.2\n\nBinding was updated now! \n. Check, it works OK with 1.8.7 \nThanks!\n. Me also, Windows Server 2012...weird stuff, anyone got a solution yet?\n. That sucks!\n. Weird thing is none of the major browsers (IE, Edge, Chrome) is complaining about these faulty certificates, except firefox and the SSL Labs test\n. Wow, isn't that what we are discussing right here?\nThat's the whole issue IIS (8.x) still serves the X1 cert although it does not exist anywhere in the cert store, something very strange is going on here, and as it seems no one has a real solution (as of yet)\n. Cleaned up the whole certificate store, reinstalled all certificates ans still IIS (8.x) serves the X1 cert to clients, i'm clueless how to proceed now :( \n. I'm on IIS 8 on  Server 2012 (without R2) as well...but until now have not been able to fix this weird issue \n. At this point a tried almost everything (multiple times) incl. reboots, unbinding, binding, removal of certificates, re-installation of the certificates and the alike, without success :(\n. @colinramsay \nBeen there, done that...without success\n. --warmup              Load the site URI(s) before authorization\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Command-Line-Arguments\n. Why not? Makes more sense than doing this a month after the certificate has expired!!! . Simple...leave it running. ",
    "basildane": "Just FYI, please don't hard-code the additional SAN names (like www or whatever).  I need SAN certificates for Exchange and Jabber, they would have many custom SAN DNS records.\n. Bummer.  I'm having the same issue.  I got a san cert successfully in test mode, and I was just about to get a production certificate, and now I just get error 500 from Letsencrypt.\n. I haven't pull the production cert yet, just started getting 500 errors still on the --test.\n. I am requesting a cert for \nemail.domain1.com\nemail.domain2.com\nemail.domain3.com\nIt worked 30 minutes ago, but now error 500.\n. Still getting 500 here.\n. I just tried turning off --san, and it worked.  Turn --san on, and 500.\n. I don't know what happened.\nI can still request certs from my dev server, I can't request anything from my production server without getting a 500 now.  I don't know of anything that changed.  I even rebooted it.  Nothing has helped.\n. All my machines, both the dev and prod, are 2012 R2.  Identical configurations running iis 8.5.\nThe prod machine was working perfectly getting test certs, until just suddenly started throwing 500's this morning.\n. I tried creating a new, empty site on the failed machine, and tried to get a cert for it.  Get 500  on it as well.  Created an identical site on another machine, I can get a cert for that one.  Something happened / got corrupted on my production machine?  I tried deleting the httpsacme-staging.api.letsencrypt.org folder and trying again, but no change.\n. I have not deleted keys yet, what tree should I delete?\n. I was logged in as Administrator, and opened PowerShell as \"run as administrator\", and I ran the exe from that shell.\n. Yes, I understand.\nWhat are your recommendations for my next step?\nThis server is in production, and also, I don't want to keep requesting certificates unnecessarily from Letsencrypt.\nI can renew the cert manually in 60 days using --renew?\nThanks.\n. Thanks LBegnaud, I will do that.\nrkerber, I have no \"letsencrypt...\" key under HKCU\\Software.\nBTW, thanks for this cool project.\n. Thank you!\n. OK, LBegnaud, I concur.  But what are your recommendations to reinstall, will I have to download a new cert from letsencrypt?\n. OK, tested on a dev server and it worked.  One thing different, I picked a single site, instead of A for all sites.  A failed the other day.  Perhaps that was part of the problem.\nFinishing up, should I delete anything on the production server before submitting my new request?\n. No problem with that, but it's the first cert that I really need.\nI was not able to get SANs working, so I guess I'm just going with site one only.\nSo I'll remove the letsencrypt folder on the server and request a new site-one cert?\n. I have the certificate and the scheduled task is now setup - thanks for all your help.\nI have some additional questions and comments.\nI have an Exchange server.  That's what I needed a certificate for.  The automated renewal process will not work for Exchange.  It renews the IIS cert, but I still have to manually export the certificate and import it into SMTP, IMAP, POP, UM, and other Exchange services.  This is a time consuming process.\nFirst question: when will the certificate be renewed?  If it expires on 4/1/2016, for example, on what date would a new certificate get fetched?  I need to schedule time to do this process and install the cert into all the services.\nSecond question, is about letsencrypt.  Why oh why oh WHY do they have such an absurd renewal time for certificates?  This makes the whole thing pretty unusable for any serious installation.  2 years minimum, I would say 5 years for a web cert, and 20 years for the CA - minimum.  It's free, but it's almost not worth it because of the huge amount of effort we have to make just to keep renewing certificates like possessed monkeys.  People have better things to do with their time.  I really wish they had thought about this.\n. That's a great idea.  I'm going to look into it.  Thanks for the suggestion.\nYou are correct, Exchange certs can be managed this way.\n. I have removed the reg key you indicated.\nRemoved the database folder.\nNo change.\nIf I remove --san, it works.  FYI.\nI am ready to test anything or provide any logs or support.\n. ",
    "brettyj": "Silly question, but how do we use it? I've updated and I get a list of IIS bindings, if I select one it seems to go off and just get that one - do I have to do A for all hosts for this to work?\n. Hey,\nI'm building from the latest master. I ran the --san flag and pointed it at one of my sites, it went ahead and looped through all the bindings - however when it finished it didn't seem to add a cert to IIS or even dump one in C:\\Users\\user\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org am I doing something wrong?\nThanks,\nBrett\n. I did have a couple of errors from bindings which couldn't be browsed because they are IIS Rewrites, which is fine, but no other errors. I do have a lot of bindings on this website as I use it as a reverse proxy, so it would go over the limit if I was requesting them individually, but I thought that was why we use SAN, so we can have loads of subdomains on one cert?\n. If it helps, I just ran it with the --test parameter and got exactly the same result, so I don't think it's due to limits. It gets to the last binding and just exits:\nSubmitting answer\n Refreshing authorization\n Authorization Result: valid\n Deleting answer\nPress enter to continue.\nWithout seemingly generating a cert\n. Ah okay, thanks. I made sure that they'd all return a result and it started the generate the cert (in test mode) although I got this error:\nRequesting Certificate\nUnexpected error\nACME Server Returned:\n{\"type\":\"urn:acme:error:serverInternal\",\"detail\":\"Error creating new cert\",\"stat\nus\":500}\nPress enter to continue.\n. Something I've just thought though, I have bindings for that website for different domains. Is it failing because it's trying to group xx.blah.com, hhh.hello.com into one SAN?\n. But I'm generating one SAN certificate with many hosts as part of it, so the limits shouldn't apply. Also this happened on test which has very very very high limits\n. Well what I mean is that, a SAN certificate is only one certificate but with loads of subdomains attached to it - I know that therefore the domain limit doesn't apply to a SAN.\nNames/Certificate is the limit on how many domain names you can include in a single certificate. This is currently limited to 100 names, or websites, per certificate issued.\nI don't have 100 names on the certificate\nCertificates/Domain you could run into through repeated re-issuance. This limit measures certificates issued for a given combination of Public Suffix + Domain (a \"registered domain\"). This is limited to 5 certificates per domain per week.\nThis doesn't apply to a SAN with multiple domains on it\nhttps://community.letsencrypt.org/t/public-beta-rate-limits/4772/8?u=brett\n\"so a SAN multi-domain cert having domain1.com, www.domain1.com, domain2.com, www.domain2.com is counted as 1 certificate ? but you can only renew this SAN multi-domain cert 5 times per 7 days ?\nExactly.\"\nPlus, this is happening on the test server which has a very high limit that I shouldn't be hitting, and when I've hit the limits previously the error returned explicitly said that, not an generic internal error\n. It's more about how many certificates they issue, they don't care if they issue 1 certificate with many many hosts, but they do care if you try to get a cert for each of those hosts. I've raised a topic on their forums here: https://community.letsencrypt.org/t/error-creating-new-cert/10187 - which hopefully will help us get to the bottom of it.\nThe main reason I don't think it's limits is because it happens on the test server too, and limits are set very high there\n. Already supports as far as I'm aware.\n. I ran the exe with --test but no SAN and got it to generate test certificates for all the sites on that website binding and it worked fine, so I'm 99% sure it's not a limit thing, or an issue with the bindings.\n. Hey @rkerber \n02/04/2016 15:28:17 +00:00 [Error] Error AcmeWebException { WebException: WebException { Status: ProtocolError, Response: HttpWebResponse { IsMutuallyAuthenticated: \"The property accessor threw an exception: ObjectDisposedException\", Cookies: \"The property accessor threw an exception: ObjectDisposedException\", Headers: \"The property accessor threw an exception: ObjectDisposedException\", SupportsHeaders: True, ContentLength: \"The property accessor threw an exception: ObjectDisposedException\", ContentEncoding: \"The property accessor threw an exception: ObjectDisposedException\", ContentType: \"The property accessor threw an exception: ObjectDisposedException\", CharacterSet: \"The property accessor threw an exception: ObjectDisposedException\", Server: \"The property accessor threw an exception: ObjectDisposedException\", LastModified: \"The property accessor threw an exception: ObjectDisposedException\", StatusCode: \"The property accessor threw an exception: ObjectDisposedException\", StatusDescription: \"The property accessor threw an exception: ObjectDisposedException\", ProtocolVersion: \"The property accessor threw an exception: ObjectDisposedException\", ResponseUri: \"The property accessor threw an exception: ObjectDisposedException\", Method: \"The property accessor threw an exception: ObjectDisposedException\", IsFromCache: False }, Message: \"The remote server returned an error: (500) Internal Server Error.\", Data: [], InnerException: null, TargetSite: System.Net.WebResponse GetResponse(), StackTrace: \"   at System.Net.HttpWebRequest.GetResponse()\n   at ACMESharp.AcmeClient.RequestHttpPost(Uri uri, Object message)\", HelpLink: null, Source: \"System\", HResult: -2146233079 }, Response: AcmeHttpResponse { StatusCode: InternalServerError, Headers: [\"Replay-Nonce\", \"Pragma\", \"Connection\", \"Content-Length\", \"Cache-Control\", \"Content-Type\", \"Date\", \"Expires\", \"Server\"], Links: [], RawContent: System.Byte[], ContentAsString: \"{\\\"type\\\":\\\"urn:acme:error:serverInternal\\\",\\\"detail\\\":\\\"Error creating new cert\\\",\\\"status\\\":500}\", IsError: True, Error: WebException { Status: ProtocolError, Response: HttpWebResponse { IsMutuallyAuthenticated: \"The property accessor threw an exception: ObjectDisposedException\", Cookies: \"The property accessor threw an exception: ObjectDisposedException\", Headers: \"The property accessor threw an exception: ObjectDisposedException\", SupportsHeaders: True, ContentLength: \"The property accessor threw an exception: ObjectDisposedException\", ContentEncoding: \"The property accessor threw an exception: ObjectDisposedException\", ContentType: \"The property accessor threw an exception: ObjectDisposedException\", CharacterSet: \"The property accessor threw an exception: ObjectDisposedException\", Server: \"The property accessor threw an exception: ObjectDisposedException\", LastModified: \"The property accessor threw an exception: ObjectDisposedException\", StatusCode: \"The property accessor threw an exception: ObjectDisposedException\", StatusDescription: \"The property accessor threw an exception: ObjectDisposedException\", ProtocolVersion: \"The property accessor threw an exception: ObjectDisposedException\", ResponseUri: \"The property accessor threw an exception: ObjectDisposedException\", Method: \"The property accessor threw an exception: ObjectDisposedException\", IsFromCache: False }, Data: [], Message: \"The remote server returned an error: (500) Internal Server Error.\", InnerException: null, TargetSite: System.Net.WebResponse GetResponse(), StackTrace: \"   at System.Net.HttpWebRequest.GetResponse()\n   at ACMESharp.AcmeClient.RequestHttpPost(Uri uri, Object message)\", HelpLink: null, Source: \"System\", HResult: -2146233079 }, ProblemDetail: ProblemDetailResponse { Type: \"urn:acme:error:serverInternal\", Title: null, Status: 500, Detail: \"Error creating new cert\", Instance: null, OrignalContent: \"{\\\"type\\\":\\\"urn:acme:error:serverInternal\\\",\\\"detail\\\":\\\"Error creating new cert\\\",\\\"status\\\":500}\" } }, Data: [DictionaryEntry { Key: \"ProblemDetail\", Value: \"{\\\"type\\\":\\\"urn:acme:error:serverInternal\\\",\\\"detail\\\":\\\"Error creating new cert\\\",\\\"status\\\":500}\" }], Message: \"Unexpected error\", InnerException: WebException { Status: ProtocolError, Response: HttpWebResponse { IsMutuallyAuthenticated: \"The property accessor threw an exception: ObjectDisposedException\", Cookies: \"The property accessor threw an exception: ObjectDisposedException\", Headers: \"The property accessor threw an exception: ObjectDisposedException\", SupportsHeaders: True, ContentLength: \"The property accessor threw an exception: ObjectDisposedException\", ContentEncoding: \"The property accessor threw an exception: ObjectDisposedException\", ContentType: \"The property accessor threw an exception: ObjectDisposedException\", CharacterSet: \"The property accessor threw an exception: ObjectDisposedException\", Server: \"The property accessor threw an exception: ObjectDisposedException\", LastModified: \"The property accessor threw an exception: ObjectDisposedException\", StatusCode: \"The property accessor threw an exception: ObjectDisposedException\", StatusDescription: \"The property accessor threw an exception: ObjectDisposedException\", ProtocolVersion: \"The property accessor threw an exception: ObjectDisposedException\", ResponseUri: \"The property accessor threw an exception: ObjectDisposedException\", Method: \"The property accessor threw an exception: ObjectDisposedException\", IsFromCache: False }, Data: [], Message: \"The remote server returned an error: (500) Internal Server Error.\", InnerException: null, TargetSite: System.Net.WebResponse GetResponse(), StackTrace: \"   at System.Net.HttpWebRequest.GetResponse()\n   at ACMESharp.AcmeClient.RequestHttpPost(Uri uri, Object message)\", HelpLink: null, Source: \"System\", HResult: -2146233079 }, TargetSite: ACMESharp.CertificateRequest RequestCertificate(System.String), StackTrace: \"   at ACMESharp.AcmeClient.RequestCertificate(String csrContent)\n   at LetsEncrypt.ACME.Simple.Program.GetCertificate(Target binding) in C:\\Development\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 498\n   at LetsEncrypt.ACME.Simple.Program.Auto(Target binding) in C:\\Development\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 343\n   at LetsEncrypt.ACME.Simple.Program.Main(String[] args) in C:\\Development\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:line 283\", HelpLink: null, Source: \"ACMESharp\", HResult: -2146233088 }\nI'm assuming it's a due to an ObjectDisposedException :p \n. If it's an intermittent server issue though why would it fail every single time I try SAN but work when I do normal certs?\n. If it helps, I'm trying to get blah.blah.com, blah2.blah.com, blah3.blah.com, hello.hello.com, hello2.hello.com, hello3.hello.com, world.world.com, world2.world.com\n. I've just tried it on a one binding site, so ultra simple and it still failed on test, so maybe the server is having issues then?\n. I'm using Windows Server 2012 R2 x64 IIS 8.5\n. I don't see the web_conf.xml is the pre-compiled version, do I have to compile it myself to be able to edit it?\nThanks\n. That's fine - I ended up doing that and it works brilliantly now.\nThanks\n. Cheers! I'll close this ticket then as it's a dup. Apologies!\n. That was me @rkerber no responses yet though :( I'll send over some logs tomorrow. \n. Here is the error - is this what you wanted? I'm now testing this on a very simple 1 binding SAN site. If I run it without --san, it works, with --san it fails.\nI'll PM the domain\n. I think I may have found part of the problem. If I run in SAN mode, that certRequ ISN'T generated, it's only if I run without SAN mode that I get a certRequ event log generated...\n. to add to that, the last info log I get in SAN mode before the error is this:\n02/05/2016 14:16:19 +00:00 [Information] Requesting Certificate\nwhere as, in non-SAN mode I get that message, followed by the certRequ\n. Okay, when you've committed something give me a nudge and I'll compile and run it.\n. It works! Thanks @rkerber - happy to close :)\n. ",
    "nemchik": "I've also seen material stating they LetsEncrypt will support SAN certs with up to 100 domains. How would that even be possible with a limit of 5 in 7 days. Can you add domains to a SAN cert after its been created? I thought the answer was no, SAN certs had to be generated with validation for all of the domains up front (otherwise what's the point of validation?), but I might be mistaken.\n. This is a good idea.\nI think it could go one of two ways;\n1. Remove existing cert specifically for the binding that is being replaced.\n2. Remove all expired certs that were issues by LetsEncrypt.\nThe 2nd one is more of a cleanup type of action that might catch and remove certs that are not being renewed for whatever reason.\n. Maybe 1 could happen automatically when certs renew, and 2 could be run manually with a command switch that triggers some user prompts and nice big warnings about the damage it could do. If done this way 2 would not be able to run unattended, and the functionality could be safely added (I think). Thoughts?\n. Another possible idea for number 2 would be to present the user with a prompt remove all expired certs (after showing which ones they are) or to remove individual certs via prompts, similar to how you can create certs for all bindings or individual bindings. Again ensuring this could not be run unattended.\n. I would assume that if you're replacing an existing cert/binding that there would very rarely be a need to keep the old cert in the store. I would almost venture to say that --replaceexisting should be the default and maybe something else needs to exist like --keepexpired (self explanitory in context I hope) and/or --manualbinding (get the cert and put it in the store, but don't change the bindings automatically, and thus imply --keepexpired). This seems to make more sense from an automation standpoint.\nI agree about 2 also that it could be a separate application and might not be directly related to this one.\n. Sounds good :+1: \n. Very nice, thanks!\n. Yes please.\n. > if it doesn't have permissions to create it when the renewal runs\nWouldn't this be the same as running for the first time?\nThus any run of the program should be able to create the folder (and files inside the folder) else error.\n. I like the idea that failed auth keeps the files. As far as file permission\nchanges, if a user in Windows can't create a folder what are the chances\nthey can create a file for authorization?\nI'm not sure if the program currently outputs anything to the windows event\nlog, but it might be a good idea to log failures (and success) to the event\nlog and advise on the usage description pages that users should check the\nevent log.\nOn Mon, Feb 8, 2016, 3:54 PM Robert Kerber notifications@github.com wrote:\n\nSometimes permissions change, and if someone doesn't have renewal run as\nthe same user that initially runs the app, that could cause permission\nissues.\nHaving an error display when the user runs the app the first time vs when\nthe automated renewal runs is probably a better option because it should be\nseen then.\nHow about it is a configuration option to delete the acme-challenge and\nthe .well-known folders after a successful authorization if the folders are\nempty (besides the web.config file in the acme-challenge folder). Any\nfailed authorization will keep everything.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/93#issuecomment-181573391\n.\n. Sounds good.\n. P.S. I was able to resolve this by renaming %appdata%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ and rerunning letsencrypt.exe. Once I confirmed it was working correctly I deleted the old renamed folder.\n. I am running Win2k8R2/IIS7\nI loaded mmc.exe and added the cert snap-in for the computer and the current account (which is the one i always run letsencrypt.exe with). I checked the personal and intermediate and root cert locations and removed everything having to do with LetsEncrypt (including the certs I was actively using). I then renamed %appdata%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ and reran letsencrypt.exe and the cert issued successfully. I then recycled my websites application pool and then restarted IIS. I did not reboot the server.\n\nI don't know if all of those actions are actually needed, but that's the order that I did things and everything is now working for me.\n. p.s. I generated my new cert with --san even though I only have one domain that I'm working with on this server.\n. While I was having the issue Chrome v49 on Windows 10 would not display an error. Chrome v49 on my Android 6.0 phone would display a cert error. https://www.ssllabs.com/ssltest/ graded me a B saying Incomplete Chain, Extra Download because the X3 intermediate cert was not sent by the server but rather had to be downloaded (my result prior to renewal on 4/2/2016 was an A). The comments on the issue here https://github.com/ebekker/ACMESharp/issues/119#issuecomment-203479385 mention files being cached wile creating the .pfx was causing issues.The mention of deleting the ca- files from %appdata%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ here in this issue got me thinking the whole folder needed to go. So that's what I did.\nWhen I look at my score now on https://www.ssllabs.com/ssltest/ the only difference is that the X3 intermediate cert is sent by the server. Now that everything is working, my issued cert for my server shows up in my cert store under Local Computer > Personal > Certificates. The LetsEncrypt Authority X3 cert shows up under Current User > Intermediate Certification Authorities > Certificates. Maybe a separate issue should be created to ensure the certs are all placed under Local Computer rather than Current User? (unless it has to be this way for some reason?)\nLastly, I did not have this issue until the scheduled task ran a renewal for me on 4/2. Prior to that there was no problem. Also prior to 4/2 all of the certs that were in my store were X1. So it's only recently that X3 is being used. Also I'm not sure why a renewal scheduled task ran on 4/2 because I had reissued my cert about a week prior to that when I upgraded my letsencrypt-win-simple client to 1.9.0. But I can confirm prior to the renewal I did not have this issue (I used the site with no cert warnings in Chrome on Android on 4/1).\n. It wouldn't make sense that the issue is specific to 8.5 because I had the issue on IIS 7\n. Has anyone tested this and confirmed how the Install Script parameters would need to be setup?. I made a slight adjustment and this is the end result:\nGet-PSSnapin -registered | ? {$_.Name -match \"Microsoft.Exchange.Management.PowerShell\" -and ($_.Name -match \"Admin\" -or $_.Name -match \"E2010\" -or $_.Name -match \"SnapIn\")} | Add-PSSnapin\nImport-ExchangeCertificate -FileData ([Byte[]]$(Get-Content -Path $args[0] -Encoding Byte -ReadCount 0)) -Password:(ConvertTo-SecureString (-join ((65..90) + (97..122) | Get-Random -Count 20 | % {[char]$_})) -AsPlainText -Force) | Enable-ExchangeCertificate -Services 'IMAP, POP, SMTP, IIS'\nI have not yet tested but this should work for 2007, 2010, 2013, and 2016.\nI only have production environments so finding a way to test will require some convincing, but I'll report back with my results once I've managed to do this (unless someone beats me to it and can confirm it works).. The only test environment I have isn't really a test environment, but rather the production environment at my work. We are scheduled to test this out in January before rolling it out to a number of other production environments for some clients.. @LBegnaud you are correct the only line actually changed was the snap in line. The other changes were caused by my editor automatically removing trailing whitespace.\nThe snap in line should only result in one snap in being added in most cases. A 2013 server won't have the 2007 or 2010 snap in for example. 2013 and 2016 share the same snap in name, but only one snap in will exist that matches the pattern. Also, if an extra snap in is loaded somehow it shouldn't have a negative impact.\nI have tested the Get-PSSnapin code that I submitted. I have other scripts I've written using it. I just haven't tested this script (meaning the rest of it), but I've used the Enable-ExchangeCertificate manually before and yours looks good to me. I've never used the code that puts the cert in a store, I've always done that manually. It looks like you have the same code for RD gateway, so if that's tested then this whole thing should work :) my CTO asked me to hold on testing this until January, and we don't have extra resources to spin up a test environment, so we're just going to go to production.\nI have successfully used LetsEncrypt-win-simple with iis so this script is all I'm really testing.. One question I do have is how are renewals handled? Will the script be executed and parameters passed with every renewal? Or does the scheduled task need to be modified?. I haven't had the pleasure of going through the new UX in 1.9.8 yet, but just from reading the discussion here I'd like to ask @UweKeim if you have any opinions on which of the 11 steps in the workflow of 1.9.8 do you feel could be presented better, worded different, made more simple to understand, or considered advanced in the case that an --advanced command line switch were added.\n@WouterTinus first, thank you for your amazing efforts, they are much appreciated. Second, I like the --advanced command line switch idea, but I would also propose that one of the first prompts that the wizard ux could offer is to show or skip the advanced options. This might negated the need for a command line switch to specify whether the wizard should show the advanced options. Also when using any OTHER command line switches, I think they should be respected if they are specified regardless of the wizard ux being in advanced mode or the --advanced switch being specified.. That's still on the books for me. I'll update as I'm able.. Just wanted to tag https://github.com/Lone-Coder/letsencrypt-win-simple/pull/671 in this for reference in case anyone would like to read the related history.. As noted in the discussion of my PR I can confirm from other testing that the snap in code and the enable exchange cert code is correct and does work. The part I am unable to confirm is adding the cert to the correct store. We know iis configuration shouldn't be an issue, so owa should be fine, what we want to confirm is in the exchange management console (or web interface for 2016) that the imap, pop, and smtp protocols are set to use the correct cert. If that looks good then we'll want to see how a renewal is handled just to confirm those protocols are set to use the correct cert after a renewal. Once we're sure this looks good I would consider this fully tested.\nI plan to attempt all of that testing later this month.. To be perfectly honest now that I'm looking more at it, I don't think lines 23-47 are required for exchange. It looks like all they do is copy the cert to another store and leave the original. I don't think exchange needs the cert to be in that location. It should work in the original location where le-win-simple puts it. I'll test this when I'm able.. @johlju I'm excited to see what you've come up with. I have a feeling after seeing what you've got working we'll compare it to the script in the repo and maybe make some tweaks (like I mentioned above about certain lines not being needed) and have a pretty solid tested option in the repo.\nHaving the script in the repo fully tested and working should be priority over updating the wiki. Documentation is important, but if we're about to consider changing the script it'd be good to have those changes accounted for in the documentation.. @cts1085 it should be, yes. Worst case scenario you can remove the existing certs and start over. The only concern would be if you hit the rate limit on the letsencrypt API and you'd have to wait for your limit to reset before getting a new cert.. @johlju I like a lot of what you've done there. I also like a lot of the existing script, and I'd like to see the best of both put together. I can get a PR put together soon:tm:.. I guess I should also tag @LBegnaud in this since the original script was committed by them. When I have time to make a PR I'll reference this issue so anyone subscribed here should be notified that there's activity happening.\nAgain, once we're sure the script is where it needs to be then we can focus on documenting (for those more interested in the documentation I'm sorry we've hijacked this issue discussion into development, but this issue shouldn't be closed until documentation is where it needs to be).. @cts1085 I'd definitely like to see what you've done to get things working for you. Also you mentioned needing to force a confirmation, are you able to tell which command specifically needed the confirmation? (We could include the -force switch in the script if we know where it needs to be).. Does the wiki page now have instructions for exchange? I only see the Rd gateway example.. Another thought;\nMaybe it would be good if each script included specific examples of command line usage with win-acme instead of having it on the wiki. This way the wiki could instruct people to look at the script.. I have reviewed the existing script and the proposed script and I'm confident that what they are both trying to do is going to work fine, but it does seem like the new changes to the proposed script might need a little touching up before merging.. @Lone-Coder There's still references to the original name letsencrypt-win-simple in many places like the readme that might need to be changed before LE will add this project back to their docs page. I also imagine they might want to see an actual release on your releases page with the new name.\nBTW congrats on the new name (it sucks that it had to change at all, but the new name is nice). This program is definitely the best and easiest option on Windows, and the closest thing to certbot that we're going to get anytime soon.. I have mentioned in https://github.com/PKISharp/win-acme/issues/832 that I was able to get around the Cert thumbprint not found in the cert store issue by adjusting ImportExchange.ps1 and not using a central ssl store. Hopefully this is helpful to anyone else who ends up reading this.. FIY I posted https://github.com/PKISharp/win-acme/issues/832 mentioning that setting the execution policy to Bypass is what ended up working for me. Since the bat file is just calling an instance of powershell and using Bypass for the execution policy in that instance and not permanently setting the execution policy to Bypass this shouldn't pose much of a threat.. @LBegnaud I had not tried using unblock-file. The file is local, I've saved it in C:\\inetpub\\win-acme\\Scripts\\, so i'm not sure why I'm having issues with RemoteSigned. Either way I got it working for now and won't have the ability to test the unblock-file for a while. In any case I do think that the unblock-file thing should be documented as part of the recommended procedure for using the script, as well as the changes I mentioned in #832 being considered.. We used v1.9.10.1 on Exchange 2016 running on Windows Server 2012 R2.. I looked at #796 very briefly and I could be wrong but it seems like it prompts for credentials on every run. Maybe @martijnvangeffen could shed some light.. As an additional confirmation the info in the OP works fine for renewals as well.. ",
    "leonletto": "For extra confirmation, I have generated a SAN cert with 12 URL's (in the same domain eg. domain.com, www.domain.com, admin.domain.com) in the same certificate without issue over a three week period.  I can't confirm if I added more than 5 per week but I scaled it from 2 to 7 and then 12 so suspect that it is probably within that timeline.  I have not tried generating a SAN cert with lots of different domains in the same cert.\n. Perfect!   Can't wait till tomorrow.  I have a lot more sites to install :)\nLeon\nSent from my iPhone\n\nOn Dec 2, 2015, at 10:05 AM, Eugene Bekker notifications@github.com wrote:\n@leonletto, in your specific case, you simply want to switch from the clear-text HTTP challenge method, to a more secure HTTPS challenge method, such as the TLS with SNI method, correct? If that's the case, the LE server already supports this second method, and I definitely plan on adding this method to be fully supported in the base library, and I assume @Lone-Coder will surface that as well in this client.\nI'm holding off on implementing it till the spec is finalized -- the spec authors are still debating some of the finer points of how this challenge method is supposed to work, and I don't want to have to redo the implementation (again!).\n\u2014\nReply to this email directly or view it on GitHub.\n. \n",
    "DennisHeerema": "Dit an test on windows 2012 R2 standard server (VPS at strato) \nused --test --san option\nAuthorizing identifiers of all bindings went fine, even dubble hostnames, i have ipv6 and ipv4 bindings per hostname, so every one hostname gets authorized twice. Is this OK?\nAt the end i got the following error:\nRequesting Certificate\nUnexpected error\nACME Server Returned:\n{\"type\":\"urn:acme:error:serverInternal\",\"detail\":\"Error creating new cert\",\"stat\nus\":500}\nPress enter to continue.\nKind Regards,\nDennis\nAddendum: Deleted key and directory in C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\nHad to register again, but at the end same error as mentioned above.\n. Selecting sites, would it also mean: selecting al configured hostnames for these sites and will these hostnames be inculded in the SAN?\nThen yes, that would be nice! \n. I'will check this today and get back to you.\n. Dit a test on https://github.com/Lone-Coder/letsencrypt-win-simple/tree/multiple-site-san\nIPv6 multi host IIS site.\nused --test --san switches\nall went well, no errors to report.\n. Did a compile and used --test --san options and you did indeed fixed it.\nGreat Job!\nDennis\nOp 5-2-2016 om 20:47 schreef Robert Kerber:\n\n@DennisHeerema https://github.com/DennisHeerema #96 \nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/96 should \nhave fixed this. If you can compile it and let me know if it doesn't \nthat would be great.\n\u2014\nReply to this email directly or view it on GitHub \nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/90#issuecomment-180519188.\n. When creating SAN Cert: Error creating new cert\",\"stat us\":500\n\nOS windows 2012 R2 x64 standard server (VPS at strato)\nused --test --san options\nAuthorizing identifiers of all bindings went fine.\nAt the end i got the following error:\nRequesting Certificate\nUnexpected error\nACME Server Returned:\n{\"type\":\"urn:acme:error:serverInternal\",\"detail\":\"Error creating new cert\",\"stat\nus\":500}\nPress enter to continue.\nDeleted key and directory in C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\nHad to register again, but at the end same error as mentioned above.\nDid the same on a other site, with less bindings, everything went fine, so what is the difference?\nversion 1.8.6 Pre Release\n. @rkerber how do i change the min log level? Yes I can give you the hostnames, preferred off list.\nGot two screenshots (png) available.\n. Screenshots send.\nEvent log: send\n. Dit a test on my production server and i can confirm this is happening.\nI Already rolled out a normal certificate (san), today i created a certificate on the same server for another site with --test --san switches and and i got my test certificate served instead of the normal/good cerificate.\nI had to delete the test certificate to get the normal / good certificaten served again.\nThough i also noticed rkerber his remarks about caching in the past. An old deleted certificate still was server after deleting.\n. I think it's still hapening.\nAlready i have one site with a certificate (Website A)\nexecuted letsencrypt witch switches --test --san for another site on the same iis server (website B).\nNow the test certificate of website B is served when i try to reach website A.\nTo repair this i have to recreate the binding for website A again.\nKind regards,\nDennis\n. Compiled the code yesterday, so i willtry the last build you made.\nThanks!\n. downloaded and build the latest master source.\nThere is already an san cert for website A\nHad to create a certificate for B and C no SAN\nAfter creating B website A servers B certificate\nAfter creating C, A and B are serving C certificate \nDid not use --keepexisting, I was in the asumption that --keepexisting is only needed when creating a SAN certificate..?\nChecked the bindings from website A and B, they are still configured with the right certificate in IIS.\nSo now waiting when the idle timeout expires, to see if that solves the problem.\nSeems not....after waiting for more than 40 minutes...\nNow recreating the websites B and C and their bindings...still the same behaviour...drivng me nuts.\n. No they did not have any HTTPS binding.\n\nHet is een raar fenomeen.\nMaar echte Amsterdammers wonen er 20 kilometer omheen!!\nQuote Marije en Dennis\n-----Original Message-----\nFrom: Robert Kerber notifications@github.com\nTo: Lone-Coder/letsencrypt-win-simple letsencrypt-win-simple@noreply.github.com\nCc: Dennis dennis@heerema.net\nDate: Mon, 07 Mar 2016 07:10:20 -0800\nSubject: Re: [letsencrypt-win-simple] IIS SSL not working after run letsencrypt-win-simple (#94)\n\nDid B and C have existing HTTPS bindings before you ran it?\n--keepexisting won't delete an existing HTTPS binding if there\nis one. Using it would delay when the certificate takes effect. It\nwon't change the cert until after the idle timeout period.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/94#issuecom\nment-193290528\n. I removed the web hosting store, but it got recreated after generating the certificate.\n\nBut it good enough for me, to be able to influence it via a config file.\n. Would changing:\n<setting name=\"CertificatePath\" serializeAs=\"String\">\n        <value></value>\n      </setting>\ninto\n<setting name=\"CertificatePath\" serializeAs=\"String\">\n        <value>Personal</value>\n      </setting>\nbe ok?\nRegards,\nDe\n. Thanks!\n. Yep that would be great!\n. It's not only related to mozilla, chome also sees the x1 certificate, but doesn't complain about it.\nThe x3 certificate is also missing in the mozilla client, X1 certificate is there. When i delete the x1, the x3 is not downloaded automaticly. one could install the X3 certificate in the browser, but hey, all my users should do that and i do not really want that.\n. Same here with my websites\n. ",
    "WilliamStam": "this is the exact issue im experiencing. i had to resort to create a new site for the www and non www version of the site. the one site i have using \"any available\" and the other im binding to the servers IP. does meen that i cant add any more certs for the other project running on the server :(\n. where does it find the Bryan from? edit: nvm i see now that its your name :D so something is definitely hard coded in\n\nWindows Web Server 2008 R2\n. figured as much. im guessing its throwing a fit cause of the whole \"WebHosting\" thing being missing on 2008? its not actually looking at those locations right?\n. yips, so basically if you're using 2008 letsencrypt-win-simple wont work. \ni was curious that its looking for C:\\Users\\Bryan\\Documents\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs was wondering if its trying to call a function in the file that doesnt exist. \n. dude you are a LEGEND!! it works flawlessly (1.7) thank you SOOOOO much!!\n. it just has a hard time when you add more certs to the server tho. so be\nvery carefully. my certs are all messed up now i think. still trying to\nfigure it out. think its that whole certs must have a static ip yada thing.\nso each site would need a new ip im guessing. but for a single site this\nproject is amazing!!!!!\nOn Sat, Dec 5, 2015 at 2:23 PM, sceee notifications@github.com wrote:\n\nReally nice, thank you very much it works!\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/18#issuecomment-162177386\n.\n. yeah ive pushed through a web.config to redirect to https for a few of my projects. to get the certificate ive had to disable it in the config which is fine.. now the next Q.. what happens come renewal time? doe it verify again - and will fail cause no http://.... only https://.....? \n. \n",
    "Zaphnl": "Just curious to see if there's a solution to this yet - I have absolutely no way of getting both with and without www working. I also tried creating a new site, but that won't work either - when setting the appropriate certificate for the one, IIS insists on changing that of the other one as well.\nAdding the actual domains to applicationHost.config doesn't help either - as in \n<binding protocol=\"https\" bindingInformation=\":443:www.mydomain.nl\" />\nand \n<binding protocol=\"https\" bindingInformation=\":443:mydomain.nl\" />\nfor the 2 <site>s\n. Hmm...I just installed v1.7 today. I suppose that's not in there yet..\n. I'll have to install VS first - new PC... ;-) But thanks for the link, I'll definitely look into that!\n. Thanks, but alas...still not success. \nI removed the existing certificates in IIS, I removed the https-bindings in my website, and requested a new certificate. A new https-binding was added, but it's still only valid for the www-version - the non-www-version still says \"This Connection is Untrusted\"\n. If I request a second certificate for the non-www version and try to add that to the website, IIS says \"This binding is already used by a product other that IIS\" and a warning that it may overwrite existing vertificates. If I click Okay, it's the other way around - non-www works fine, www is untrusted.\n. I use Windows Web server 2008 with IIS 6.1 build 7601: SP1.\nEarlier I was able to add a second https-binding, but right now I can't anymore. \n. Oh, snap - that explains it. Odd that my ISP pre-installed an old version of IIS, but at least I know now why it won't work.\nThanks so very much for your time, Robert!\nEdit: it's due to the Windows version, not the IIS version. My bad...\n. ",
    "MetUys": "PS: Does FTPS (FTPeS) even care about the host matching the Certificate common name (or SANs), and I dont think IIS FTP supports the SNI TLS extension anyway. would be nice if this was possible, but maybe at a later date.\n. Hi, same here (removed the star from the web.config file and it worked),\n@Lone-Coder can you update the binary to not use \".*\" and use \".\" instead? (I see there was another post about this, and I commented there but its been closed by the reporter after doing my manual work around)\n. +1 to this, definitely something of interest for us.\n. I see the issue is the web.config file generated is using \".\" as the file extension in the mime type.\nThe fix for this is simple.... remove the \"\" from the auto generate web.config.\nFor now to override, just copy the web.config that's generated, move one directory up and paste it there.. manually remove the \"*\". and run the process again, it will create the slightly flawed web.config but the site will read both web.config files as they do not conflict allowing it to proceed on.\nIf you don't have access to the web.config to copy it, i.e. hosted service user, then in the IIS manager you can manually add the \".\" file extension \"text/json\" mine type, just make sure you set it NOT at the last folder level, as running this process again will replace it.\notherwise, very nice work. SNI worked beautifully and so did the correct WebHost certificate store location, as apposed to the personal one.\ngreat work!\n. HI Bryan,\nCan this be tweaked in the creation of the web.config (Server 2012 R2), there is a \"\" (star) near the period \".\" that shouldn't be there. can this be amended so that we don't have to do anything when running through the automated process?\n. take a look at this issue #48 \nits been reported a few times before and is known should get sorted in newer releases.\n. Hi,\nI have also experienced an issue that sounds like its the same issue,basically have two sites in IIS\n- SiteID1 is for HTTP traffic (binding of :80) \n- SiteID2 is for all HTTPS traffic (binding of *:443 for non-sni compliant devices, and a few other bindings on specific domains with SNI flag set)\nI added the fqdn to the HTTPS site and then ran letsencrypt-win-simple v1.9.0 and it created the SSL for the newly added fqdn and bound it with the SNI flag... which is great, but what it also did was updated the base SSL for my non-sni compliant devices to that of the new LE SSL.\nso my end result was all HTTPS SNI sites that were in place before hand continued to function correctly, the new HTTPS SNI LE site also works great, the issues is the non-SNI compatible HTTPS traffic started getting certificate errors because it was update to the LE SSL instead of leaving the original one in tact.\nhope that makes sense.\nI have a similar setup elsewhere in the network and will check the configurations before I run the app and let you know.\n. Makes sense. Thanks for clarification\n. Ok I see this is covered in #195.\nsorry missed that post.\n. Hi all,\nsince we are not seeing any new releases in a while, I am looking to use this release (provided by @gdau above) so that I can move forward with automatic renewals after using the \"M\" option in the initial setup.\nwhat would I need to update in order for the renewals to renew:\n- on the schedule in registry\n- using the forcerenewal (to confirm its working)\nIf I can get this last corner stone done my life will be blissfully pleasant with moving forward with more system rollouts. (at the moment every new rollout means more admin work for me).\nIm just looking for clarification on what should be present in the scheduled task execution properties,\nwhat should be present in the registry to confirm it will renew.\ndo I need to nuke all previous setup and start from scratch to get in setup correctly (and what should the full command execution be)?\nSingle sites:\nC:\\letsencrypt\\letsencrypt.exe --renew --accepttos --centralsslstore C:\\IIS-CentralCertificateStore\\ --manualhost mysite.domain.com --webroot C:\\Domains\\Default_HTTPS\nSAN sites:\nC:\\letsencrypt\\letsencrypt.exe --renew --accepttos --san --centralsslstore C:\\IIS-CentralCertificateStore\\ --manualhost mysite.domain.com,mysite2.domain.com --webroot C:\\Domains\\Default_HTTPS\nAnd I like the new parameters too: --forcerenewal --notaskscheduler --closeonfinish (but will only use those once the setup of the rest in sorted). thanks @jmarden, fortunately I have the luxury of having a few systems I can test on.\nbut so far trying to force a renew doesn't work. :( I will look again tomorrow with fresh eyes.\nI think I stumbled onto this branch because of the key words: \"SAN\" \"Manual\" and that you have implemented it to use a csv style (another search term I was rummaging through).\nbut I think the \"Manual\" here is different to the manual \"M\" switch used with letsencrypt-win-simple in IIS?. Sadly I haven't had any joy, so have asked our development team to take a look at it.. Hi,\nthe problem is just because you control a subdomain doesn't mean you control all of them or any sub-sub domains. To allow this (the way you want it) would be a huge security flaw.\nthink of a hosting provider like \"wordpress.com\" and you control \"my-nice-site.wordpress.com\", you only control that subdomain, not any other subdomains of wordpress.com (or the root domain).\nhope that explains why this cannot be allowed.\nso bottom line is its not a replacement for wildcards and never will be.. I'm having the same problem, but only with one site on the same servers as all my successful validations.\ntrying at different times results int he same issue with only the one domain.\nany suggestions or more detailed logs that we can use to see whats happening and why its not working?\nPS: My issue was the DNS Server was incorrectly responding to the CAA record (i.e. regardless of where a CAA record was present r not.. just gave a non-standard response which resulted in the failure). Once it was moved to a DNS server that did respond (positively or negatively) it worked. Not sure what the old DNS server was (controlled by someone else).. ",
    "DJFliX": "The Web.config you provided works for me! I'm able to retrieve the (extension-less!) files within the acme-challenge folder now. Thanks!\n. Just verified that the script works like a charm now without having to modify anything in IIS manager :+1: \n. Is there any way to test this? \nI tried manually issuing the command that was in the Task Scheduler, but it tells me it won\u2019t renew until 01-17-2016 anyway\u2026\n\nOn 18 Nov 2015, at 17:56, Bryan Livingston notifications@github.com wrote:\nThe renewals probably aren't going to work because the client writes out a\nweb.config to the acme-challenge folder each time. Try putting a web.config\nin the .well-known directory with just the handlers section.\nOn Wed, Nov 18, 2015 at 9:38 AM, Felix Mann notifications@github.com\nwrote:\n\nClosed #7 https://github.com/Lone-Coder/letsencrypt-win-simple/issues/7.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/7#event-468147467\n.\n\u2014\nReply to this email directly or view it on GitHub https://github.com/Lone-Coder/letsencrypt-win-simple/issues/7#issuecomment-157777398.\n. I set the date in the Windows Registry instead. \n\n\n```\nC:\\Users\\Administrator\\Downloads\\letsencrypt-win-simple.v1.1>letsencrypt --renew --baseuri \"https://acme-v01.api.letsencrypt.org/directory\"\nLet's Encrypt (Simple Windows ACME Client)\nACME Server: https://acme-v01.api.letsencrypt.org/directory\nConfig Folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.orgdirectory\nLoading Signer from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.orgdirectory\\Signer\nGetting AcmeServerDirectory\nLoading Registration from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win\n-simple\\httpsacme-v01.api.letsencrypt.orgdirectory\\Registration\nChecking Renewals\n Checking testapi.[company].com (C:\\inetpub\\test-api) Renew After 1/17/2015\n Renewing certificate for testapi.[company].com (C:\\inetpub\\test-api) Renew After 1/17/2015\nAuthorizing Identifier testapi.qwiksense.com Using Challenge Type http-01\n Writing challenge answer to C:\\inetpub\\test-api.well-known/acme-challenge/dgcMMM1pwsM7ngAVKIj-zmZ1PDHU6ko9_W8vNCTy90g\n Writing web.config to add extensionless mime type to C:\\inetpub\\test-api.well-known\\acme-challenge\\web.config\n Answer should now be browsable at http://testapi.[company].com/.well-known/acme-challenge/[filename]\n Submitting answer\n Refreshing authorization\n Authorization RESULT: valid\n Deleting answer\nRequesting Certificate\n Request Status: Created\n Saving Certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.orgdirectory\\testapi.[company].com-crt.der\n Saving Issuer Certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.orgdirectory\\ca-009813F47513E5750B43E7431E971E44BD-crt.pem\n Saving Certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.orgdirectory\\testapi.[company].com-all.pfx (with no password set)\n Opening Certificate Store\n Loading .pfx\n Adding Certificate to Store\n Closing Certificate Store\n Updating Existing https Binding\n Committing binding changes to IIS\n Renewal Scheduled testapi.[company].com (C:\\inetpub\\test-api) Renew After 1/17/2016\n```\nRenew seems to have worked for me :). Not exactly sure why tho... Your comment about writing the web.config seems valid, looking at the source code. Well I think I'm just going to enjoy what I have right now. Thanks!\n. ",
    "David263": "I am noting problems that are completely obvious to you for the benefit of others who may mistake  or misunderstand the goal of a simple LE client such as yours. Snide remarks are not helpful.\nTo answer your question, I can't see how full Windows support will be available by Dec. 2015. It will be an achievement to have ACME running and bulletproof even on Linux servers, and this at the expense of requiring Python, Bash, and other dependencies. Complete automation is fine, but using dependencies should be accepted only for a specified period of time, IMO.\nThe advantage of your approach is that we can have something that works on Windows by December. But it will not have the full LE functionality, correct?\n. Don't know if the Go library is extensive enough, or bulletproof enough, sorry. It's certainly standard enough, and probably portable back to previous versions of Windows. Not sure.\n. ",
    "rdolezel": "@Lone-Coder: I didn't remember the difference well. So I found it again.\nhttp://www.iis.net/learn/get-started/whats-new-in-iis-8/iis-80-server-name-indication-sni-ssl-scalability\n\"In addition, a highly scalable WebHosting store has been created to complement SNI. The result is that the secure site density is much higher on Windows Server 2012 and it is achieved with just one IP address.\n...\nUnlike previous versions of Windows Server, the certificates on Windows Server 2012 are loaded in memory on-demand. After configuring thousands of secure sites using SNI, send a GET request to one of the secure sites and observe the memory usage. It is negligible. On previous versions of Windows Server, if hundreds of secure sites are configured, sending just one GET request would cause the Windows Server to load all certificates, resulting in a high memory usage, and further limits the scalability.\"\nI wanted to load certificates when requested only. That's the main reason why I prefer Web Hosting certificate repository.\n. Very good solution, thanks. I understand we have to wait for ACME working group now.\n. WebHosting certificate store is a new feature in W2012 and newer.\n. No worries, it's expected behavior, not related to your installation.\n. It's IIS 8.5+ feature only (ie. W2012R2+).\nhttp://www.iis.net/learn/get-started/whats-new-in-iis-85/certificate-rebind-in-iis85\nThe implementation is quite weird:\n\"When you enable Certificate Rebind, IIS registers a task in the system\u2019s Task Scheduler, and the task is keyed to trigger upon a certificate-renewal event (event ID 1001). When such an event occurs (either when you manually renew the certificate, or when it renews through autoenrollment), the scheduled task executes the IIS command-line tool appcmd.exe. It gives appcmd the thumbprint of the expired certificate and the thumbprint of the new one. Using these two parameters, appcmd locates the Web sites that the old certificate is bound to, unbinds that certificate, and then binds the new certificate to them. If you set up your certificates to renew automatically through autoenrollment, and you enable Certificate Rebind, the whole process will be automated.\"\nI would personally prefer the current rebinding system. Based on my experience it's not necessary to restart website or recycle application pool after replacing website certificate in HTTPS binding(s). It works immediately, for IIS, for Exchange too.\n. Don't forget the name of this project - there is \"simple\" word in it :) In my opinion, for CCS it makes more sense to invest time into ACMESharp. This combination could create pretty robust platform with a centralized certificate repository.\n. I can confirm cert. renewal was successful on all servers after I installed UBPM Task Scheduler fix. That was the missing part in the puzzle.. ",
    "Tasteful": "Pullrequest #19 will solve this problem.\n. Only to the .well-known\\acme-challengeand that folders subfolders.\n. What is the IIS-version do you got error on?\n. When the file is added iis is stopping and then starting again for the first request that is from the ACMEserver. Maybe better that client is making one webrequest to the expected url and waiting for answer before returning to ACMEserver that the file exist.\nACMEserver is only testing 5 times or so and the existing delay was to short for my site to start.\n. the version command is not returning the released version number.\n\nletsencrypt.exe --version\nLetsEncrypt.ACME 1.0.5816.17976\n. Sounds that is doing more or less the same the the letsencrypt client application is doing.\n\nOther option that I have found is CCS (Central Certificate Store) that probably is easy and good for loadbalanced environment.\nhttps://technet.microsoft.com/en-us/magazine/jj937171.aspx\nhttp://blogs.msdn.com/b/kaushal/archive/2012/10/11/central-certificate-store-ccs-with-iis-8-windows-server-2012.aspx\n. ",
    "ghost": "I had to patch the letsencrypt binary to use \".\" extension instead of \".*\" because of the security and configuration of a client server I had. It may benefit more people to have both:\n  manually added to circumvent, this is the only thing that worked for me \n\n. A definite must. 2048 is considered 'adequate' for now but 4096-bit is being recommended to phase into.\n. Manual client allows you to insert alternative names whereas command line have no such option. It would be great if there was an option to extract the certificate and key from the main file as Apache needs them seperate.\n. @rkerber Apache works good for me, it's mainly the additional names, because the certificate is only created for my domain and not the subdomain www. Manual mode within the application allows you to provide additional SAN's however the command line does not. It would be great if I can just automate this in one line rather than having to manually run it every couple of months.\n. Has anybody found a solution? Or is there any other software that is able to renew certificates on Windows Server if only port 443 is available?\n. To let others know, the backend transparently strips the asterisk, so you'll get 'example.com' instead of '*.example.com'. No warning either. Screw this, I'll buy a cert.\n. The point was no validation against wildcards and no path-name validation.\n. I think this should be closed as a dup. of #408.. I'm also having this issue more often than not. Sometimes a restart of the IIS services and/or system reboot resolves it, but it does return.. ",
    "JasperHuijser": "Hi, \na better (and easy) solution is just to work along with IIS..\njust add on Program.cs ons line 564\nC#\n            answerPath = Path.Combine(answerPath, \"Default.htm\");\nthis add's the directory with a default file and omits the need of a custom web.config and moving this staticfile handler.\nUPDATE:  Just saw pull #33, solves the issue aswell\n. ",
    "navossoc": "You should place a ^ on the start of that pattern, otherwise this will be valid:\nhttp://domain.com/folder/file.txt?fake=.well-know/acme-challenge/\nI'm using the same idea but with this pattern:\n^\\.well-know/acme-challenge/\n. @some-guy-23 same here mate, but if you take a look on Firefox it will display the correct intermediate certificate (X3).\nMaybe it is a Chrome caching or issue? I don't know.\nBefore I reissued all my certificates Firefox was throwing an error, now it's all good again ;)\nPS: https://www.ssllabs.com/ssltest/ is reporting everything all right too.\n. Well, definitively it's an user issue.\nI did a test on a clean machine and chrome displays the X3 certificate.\nI did some digging on my computer and I have found a X1 intermediate certificate installed (user certificates).\nI just removed it, open chrome again and voil\u00e0, everything ok :+1: \nI'm not sure HOW and WHY Let's Encrypt issued another Intermediate certificate with the same identifier causing all this trouble...\n. I solved my problem using IIS 8 (2012), are you guys having problem only with the 8.5 (2012 R2)?\n. Well, not sure if it will help but this is what I did:\n1. Renewed all my personal certs to use X3 (so I'm not mixing more X1 and X3 intermediate).\n2. Removed all my personal certificates used on https/ftps/etc (user/computer).\n3. Removed Let's Encrypt intermediate X1 and X3 from user/computer certificates.\n4. If the X3 intermediate is not create, import it manually from %APPDATA%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org. Probably will be two files named ca-*, look for the newest one (X3) and import it to to the \"Intermediate Authentication Authority\" (just in case I did on both places user/computer).\n5. Imported all my personal certificates again to \"Web Hosting\" (computer).\nSome tips from what I'm using:\n1. When importing, I'am choosing \"Place all certificates\" to make sure to install the certificate in the right folder.\n2. I'm running \"mmc.exe\" then adding the Certificates (My User/Computer) snap-in manually.\n3. Doing a search using the \"Find Certificates\" menu in the root folder. Using the option \"Issue To\" with the terms \"Let's Encrypt\" on both locations (user/computer).\nAfter all that I did a reboot on IIS from a prompt (as admin).\ncmd -> iisreset\nIt didn't work and I'm not sure if it is really need, but you know (strange things happens)...\nThen I did a computer reboot and the certificate chain started reporting X3 intermediate.\nGive it a try, you will have a few downtime, but maybe it worth ;)\nLet me know if it works for you.\nPS: Always make a backup :+1: \n. @Trapulo How are you checking the chain?\nTry using this site:\nhttps://www.ssllabs.com/ssltest/\n(there is an option to clear cache)\nSeems that Firefox reports the chain updated too.\nChrome may display it wrong if you have the certificate installed on the client machine.\nI'm not sure about other browsers...\n. @Trapulo Yeah, that is a problem...\nSorry but I'm not sure how I can help.\nHave you checked if the *.der files in %APPDATA%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org are using the right Let's Encrypt Authority X3 as intermediate?\nTry to reinstall the intermediate X3 certificate from there...\n. Me neither, it seems really tricky...\nTo be honest I'm feeling lucky that it worked for me on the first try...\nAs a last resort:\nHave you tried to remove the HTTPS binding, restart IIS and then add the HTTPS binding again?\n. @Trapulo Yeah, that seems a really poor decision from LE...\nIf that is right there is two places I remember:\nC:\\Documents and settings\\All Users\\Application Data\\Microsoft\\Crypto\\RSA\\Machinekeys (computer)\n%APPDATA%\\Microsoft\\Crypto\\RSA (user)\nNot sure if its safe to start deleting all, but, at this point who cares? (I think)\n. I'm looking for it too.\nAssign the same certificate to the site with HTTPS and FTP binding.\nRight now it assign the certificate only to the https binding, it ignores the FTP SSL Settings.\nMy current config is this:\njson\n{\n    \"Date\": \"2018-07-08T01:08:54.6078155Z\",\n    \"Binding\": {\n        \"Host\": \"domain.com\",\n        \"HostIsDns\": false,\n        \"IIS\": true,\n        \"WebRootPath\": \"C:\\\\inetpub\\\\wwwroot\\\\www\",\n        \"SiteId\": 1,\n        \"TargetSiteId\": 1,\n        \"AlternativeNames\": [\n            \"domain.com\",\n            \"www.domain.com\"\n        ],\n        \"TargetPluginName\": \"IISSite\",\n        \"ValidationPluginName\": \"http-01.FileSystem\",\n        \"PluginName\": \"IIS\"\n    },\n    \"San\": true,\n    \"KeepExisting\": false,\n    \"InstallationPluginNames\": [\n        \"IIS\"\n    ],\n    \"Warmup\": false\n}. ",
    "vespino": "I'm using an older version of apache (2.2.4). I'm not familiar with the xml configs. I think I might have to setup a testing server :)\n. Can't wait for the .exe file since I know jack of how to compile these files. Great job so far, thanks for your work and update and I'm looking forward to future updates!\n. Thanks, but a bit dangerous seeing I only have a live server :)\nBut this proves Letsencrypt works with Windows as well as Linux then?\n. Tried it anyway but got these errors:\n\n. I have tried this and it works great for me!\n. Consider it a feature request :)\n. Any news on this by the way?\n. ",
    "ndouthit": "Which Apache stack (Bitnami XAMPP/WAMP, ApacheHaus, Apache Lounge, etc.) should be supported? All? I'm not sure what the popular ones are.\n. I did some messing around and I'm thinking a separate plugin would make the most sense at least right now.\nI don't see an easy way to do auto renewals especially if the certs are being generated manually on a personal PC. The only thing I can think of would be maybe a task scheduler to attempt an auto renewal. If it fails, it notifies the user.\nShould cert revocation be a concern right now?\n. Check out #3 \n. I think it needs to be implemented in ebekker/ACMESharp first before it can be implemented here. \n. I was able to generate 4096-bit certs but I had to update the OpenSsl providers in ACMESharp (OpenSslLib32Provider/OpenSslLib64Provider) to this:\ncs\nint bits;\nif (rsaPkParams.NumBits == 0)\n    bits = RSA_BITS_DEFAULT;\nelse\n    bits = rsaPkParams.NumBits;\n. @rkerber check out the OpenSslLibBaseProvider.cs file in ACMESharp. It always uses RSA_BITS_DEFAULT for the bits. \n. @chrischarles2002 The letsencrypt-win-simple task is created with the \"Hidden\" option enabled, so if \"Show Hidden Tasks\" is unchecked under the View menu, then you won't see it listed. You have to check the option.\n. Hey @Lone-Coder what was your intent with that line of code?\ncs\ntask.Settings.Hidden = true; // don't pop up a command prompt every day\nWere you trying to run the task in the background?\n. I don't know if it's bad practice to run a task as SYSTEM or not but I believe it would allow the task to run behind the scenes.\ncs\ntask.Principal.UserId = new SecurityIdentifier(WellKnownSidType.LocalSystemSid, null).Value;\ntask.Principal.LogonType = TaskLogonType.ServiceAccount;\n. If you're unable to access that file in your browser, then it's likely the MIME type. Try adding '.' (a period) as a file extension with MIME type 'text/json'.\n. I also noticed an issue where the .well-known and acme-challenge directories were not being properly deleted so I threw in a fix for that.\nIn addition I noticed that the .well-known and acme-challenge directories are not created automatically if they do not exist. I haven't implemented a fix for that, but it will be necessary if you plan on deleting the answer file and the directories.\n. Awesome. Looks like the merge accidentally includes some code that was\nmeant for testing.\nOn Saturday, February 13, 2016, Robert Kerber notifications@github.com\nwrote:\n\nThere were a couple of issues I fixed in my latest commit.\nI had some errors pop up in my testing, and I added the ability for it to\ncreate directories if they don't exist.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/123#issuecomment-183811275\n.\n. \n",
    "schultz-it-solutions": "I would be interested in this feature as well...\nI am using Apache 2.4.x from ApacheLounge, Apache themself name a few \"distributors\":\nhttps://httpd.apache.org/docs/current/platform/windows.html#down\n. ",
    "o6asan": "Thanks for your nice code.\nI have used Apache from Apache Lounge since 2.4.x was released. One of the reasons I use it is the same as schultz-it-solutions. Another reason is PHP For Windows recommends Apache Lounge on their site. I think ApacheHaus and Apache Lounge exchange the information each other.\nI use Apache 2.4.20 now. Version 2.4.8 and later prefer fullchain.pem. So I merged sever-crt.pem and ca-xxxx-crt.pem.\ncopy sever-crt.pem + ca-xxxx-crt.pem fullchain.pem\nFor updating fullchain.pem automatically, I made a simple batch file like this. I think it updates fullchain.pem automatically though it isn't sure because the first update is May 12 or later.\n. ",
    "der-eismann": "It's my first time coding in C#, but I've invested some hours into a first draft of an Apache plugin, if you want to compile and try it yourself, it's in this branch:\nhttps://github.com/der-eismann/letsencrypt-win-simple/tree/ApachePlugin\nIt scans for a running Apache service and locates the standard config (.\\extra\\httpd-vhosts.conf). It then scans for configured virtual hosts and lets you request certificates for them (A for all vhosts, R for selection). Also works with SAN when you have configured the ServerAlias directive.\nIt's not pretty and it's not efficient, but it works for me and I will file a pull request once I've handled the automatic installation.\n. This is my latest release, you can try it if you want:\nhttps://jogi-server.de/seafile/f/137878f45c/?dl=1\nIt should detect your vhosts after starting, if not you can check if the path to the config file is correct. If everything is detected you can generate certificates for all hosts (E) or specific hosts (R and afterwarts the numbers of the hosts).\nI appreciate your reply!\n. No problem, it was my first commit to a public project :) Thanks for merging!\nNormally the chain contains root & intermediate and only the fullchain contains root, intermediate & server certificate, but I didn't know where to get the root from and this combination suits my needs:\nhttps://certbot.eff.org/docs/using.html#where-are-my-certificates\n. IDN support should start in about 2 months:\nhttps://letsencrypt.org/upcoming-features/\nMaybe you can just wait until it's implemented, don't know if the effort is worth it.\n. ",
    "vatara": "This is on Server 2008 R2. Running it as administrator.\n. Oh, yes, IIS is installed also.\n. I'm running into this issue again, when creating a SAN certificate for many sites on the same server. I think the only change needed is adding the \nConsole.SetIn(new StreamReader(Console.OpenStandardInput(8192))); call to IISSiteServerPlugin.cs. It looks like it was added to the other Plugins, but not this one.\n. Oh, you know never mind. I only ran into this because I was trying to enter the site host names at the prompt instead of the site IDs.\n. Changing that timeout doesn't seem to affect the authorization result, it only seems to change when it checks the result. For example, I'm testing with a non-responsive site, whether that Thread.Sleep call sleeps for 100ms, 1000ms or 2000ms it still returns a failed response after about 6 seconds.\nI'm a bit unclear on how the ACME protocol works so maybe this doesn't make sense, but I think what I'm looking to change is to get the ACME server to wait longer or to tell it to try again. Maybe this is something that needs to be changed in the ACMESharp library? Or maybe it can only be changed at the ACME server?\n. Hmm, I was hoping to avoid that...would you be open to a change that adds a warmup option to load the answerUri before submitting it? Not sure if that's the best place/method for it, but I would be glad to work on it.\n. #255 \nSomething like this? I added a command line argument that will prompt if you want to warmup each Target. This sets a Warmup boolean in the Target. If that is true it will load the Target answerUri before authorization. I don't think we actually need a wait time as the web request will wait until the URI loads, which should be fine.\n. The PromptForWarmup argument adds the prompt during Authorize. If the response is yes it sets the added Warmup property in the Target. Since the Target is stored in the ScheduledRenewal, it does get saved. The Warmup property then gets checked during renewal Authorization.\nI agree I'd like this without a user prompt, but I'm not sure how to make an argument that would be site-specific.\n. OK, that sounds good to me. This commit should make those changes. It did work in my testing.\n. That should merge the changes correctly. I haven't had any problems with the bool serialization/deserialization. It seems to read/write it correctly, and it works if the property is not there as well.\n. I've added documentation for the argument.\n. The serialization/deserialization is working for me as a boolean, it gets written as:\n\"Warmup\":true\n. ",
    "c1982": "No WebHosting store name on Server 2008 R2 default but exist on Windows 2012 version. May be you can create manually.\n. ",
    "sceee": "Really nice, thank you very much it works!\n. ",
    "Sebazzz": "Does changing the handler order only apply to the subfolder or to the entire site?\n. It is easier to remove the problematic handlers, named ExtensionLess****. Perhaps that is allowed.\n. I have been able to reproduce this too. The site in question had already an SSL binding. Perhaps that is the issue?\n. Same issue, and now happens with older beta versions of 1.9.4 as well.. ",
    "liuxyon": "I using IIS8.5. \n. ",
    "Seany84": "IIS 8.0 running on Windows Server 2012\nI'll look up how to enable SNI and post back.\nThanks ebekker\n. @VitaliyMF Thank you so much. I am hosting my VM on Windows Azure and completely forgot about opening up port 443. \nAs soon as I allowed that port/endpoint through the Azure portal I was able to hit my now SSL encrypted site :+1: \n. ",
    "VitaliyMF": "@Seany84 I've just created Let's encrypt SSL certificate and my situation was similar to yours:\n- several subdomains + www\n- Windows Server 2012\nI got the same \"site not found\" error and reason was in the firewall:\n- I've checked Windows Firewall but inbound connection rule for HTTPS was active\n- then I remembered that Amazon EC2 has its own firewall and by default it doesn't allow inbound connections for 443 port - maybe your hosting provider also have the firewall that should be configured for HTTPS\n. ",
    "colinramsay": "Upon further investigation, because this is a Windows 2008 server it doesn't have that certificate store. The readme specifically mentions IIS7 and doesn't say anything about an incompatibility with 2008, so I'm not sure if this is by design or if it's an oversight.\n. Perfect, thank you.\n. I was seeing a similar issue; the X1 wasn't appearing anywhere, but we were seeing an incomplete chain on IIS7 with only the X3 involved. Steps to fix:\n1. Delete/move the %appdata%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ directory\n2. Remove the X3 intermediate from certmgr\n3. Reissue the certificate with the letsencrypt-win-simple\nHope this helps someone.\n. Yes, the X3 intermediate\n. ",
    "jhaisley": "This could  be done by using something like ftpuse which allows you to mount the ftp server as a local drive, but currently this doesn't work, because it doesn't allow for enough time for the answer to be uploaded.  It would be nice if there was an option to retry or add an optional delay. \n. ",
    "lostandlost": "I was able to get it working on nginx by combining the crt.pem that win-simple creates and adding https://letsencrypt.org/certs/lets-encrypt-x1-cross-signed.pem.txt to the end of the file.  This is probably day one stuff that all of you already know.  But here is the info anyways. \n. ",
    "shu05": "We need a fullchain.pem\n. ",
    "LBegnaud": "I might be missing something obvious, but would someone please tell me how to implement the custom key size using the win-simple command line?\n. Got it. Thanks for the reply!\n. One thing I would point out is that if your IIS site already has those settings applied, the configuration will fail. What I have done to reliably let the web.config apply is to set the removal of those options in the .well-known directory (since this tool only applies a web.config into the acme-challenge directory) as follows:\n\n<staticContent>\n       <remove fileExtension=\".*\" />\n   </staticContent>\n. I second this idea. Didn't know enough about IIS config to put it so elegantly, but if this works that is a much cleaner solution.\n. Did you perhaps not run the exe in an elevated prompt?\n. Interesting. I have no other suggestions. I have, however, had this happen when i didn't run as administrator on a machine with UAC enabled. \n\nSorry I can't be more help\n. You could manually create the scheduled task\n\nMake sure it runs as the user than ran the executable. The default settings for this task are to run only when the user logs on, I like to set to run regardless. The default time is 9am daily.\n. While it's interesting from a learning perspective, I would honestly try to get the exe to run properly before I would go about re-creating the scheduled task AND the registry information...\nApologies for not thinking to have you check the registry. Without that information \"--renew\" will not work.\n. I believe that you would have to create a new cert to get it to install properly. Perhaps you should test the syntax in your environment on a non-production server. \nI'm not a dev, so I doubt I can provide too much insight into particular errors, but I would say providing the error output would be a good place to start.\n. 1) the registry has a value that indicates when it needs to renew, should be 30 days before it expires. I have setup my remote desktop services deployments to automatically import the certs by adding a second action to the scheduled task which runs a powershell script. I expect you could do something similar with exchange. The script is below:\n``` powershell\nparam(\n    $password\n)\nSleep 60\nipmo activedirectory\nipmo remotedesktop\n$ADDomain = (Get-ADDomain).dnsroot\n$connBrokerPotentials = (Resolve-DnsName rdpconnbroker.$ADDomain |%{Resolve-DnsName $_.ipaddress}).namehost | sort\nforeach($Potential in $connBrokerPotentials){\n    if(Get-RDDeploymentGatewayConfiguration -ConnectionBroker $Potential -ErrorAction SilentlyContinue){\n        $connectionBroker = $Potential\n    }\n}\nif(-not $connectionBroker ){\n    Write-Output \"No active connection broker found!\"\n}else{\n    #$certlocation = \"C:\\Windows\\SysWOW64\\config\\systemprofile\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\rds.lpbuilding.com-all.pfx\"\n    $certlocation = \"C:\\rds.pfx\"\n    $SecurePassword     = \"$password\" | ConvertTo-SecureString -AsPlainText -Force\n$rdsfqdn = (Get-RDDeploymentGatewayConfiguration -ConnectionBroker $connectionBroker -ErrorAction SilentlyContinue).gatewayexternalfqdn\n$LEcertFromStore = dir cert:\\LocalMachine\\ -Recurse | ? dnsnamelist -contains $rdsfqdn | ?{$_.issuer -like '*let?s encrypt*'} | sort notafter -Descending | select -f 1\nif(-not $LEcertFromStore){\n    Write-Output \"This computer has no Let's Encrypt cert in the machine's store for the rds fqdn!\"\n}else{\n    if($LEcertFromStore.NotBefore -gt (get-date).AddDays(2)){\n        Write-Output \"Cert is not new, skipping injection into RDS\"\n    }else{\n        $LEcertFromStore | Export-PfxCertificate -ChainOption EndEntityCertOnly -FilePath $certlocation -Password $SecurePassword\n\n        Set-RDCertificate -Role RDGateway -ImportPath $certlocation -ConnectionBroker $connectionBroker -Force -Password $SecurePassword \n        Set-RDCertificate -Role RDWebAccess -ImportPath $certlocation -ConnectionBroker $connectionBroker -Force -Password $SecurePassword\n\n        dir cert:\\LocalMachine\\ -Recurse | ? dnsnamelist -contains $rdsfqdn | ? thumbprint -ne $LEcertFromStore.Thumbprint | Remove-Item -Force\n\n    }\n}\n\n}\n```\n2) https://letsencrypt.org/2015/11/09/why-90-days.html\nThe idea is that certs should be automated, so the renewal fequency shouldn't matter. Lower time means less impact of a leaked private key.\n. @misterHippo  Looks like the newest release might resolve the issue you're seeing. Have you tried updating to 1.9.7.2?. Seems very similar to the work in #634 \nYou are using a version from before @WouterTinus took the reins and started making a lot of stability improvements. I didn't notice that at first so honestly I would make sure you test your workflow on another machine before making the switch, but it's important to make the switch.\nIf you run into issues after updating I recommend opening a new Issue to track it specifically. to add to what @richard-browne says. Every server I've configured has been done by using \"psexec -i -s\" to make LE-win-simple run as system.\n. I believe you need to import the X3 intermediate cert, then REBOOT the IIS server. Restarting the IIS service is not enough in my experience.\n. I dealt with this issue this weekend and that's what worked for me. Import the intermediate X3 cert on all IIS servers hosting the site. Reboot them all. The issue is exactly as stated earlier: IIS is not providing the cert, so only clients with some other way to verify the intermediate trust the cert.\nEdit: https://www.ssllabs.com/ssltest/ was very helpful when i was troubleshooting this.\n. Right. This is a pretty well know occurrence with IIS. You need the intermediate cert loaded on the IIS machine's cert store. I have had it happen with a godaddy cert\nPerhaps there is some extra layer of annoyance with the two LE intermediate certs sharing something that causes IIS to present X1 when it is supposed to present X3, but other than that it is possible to get it working. \n. what worked for me was to delete the X1 from the cert store on the IIS server, add the X3 to the intermediate store, then reboot the server. \nIf that doesn't work for you, go to bindings in IIS and simple re-save the cert (I did this too, but I am not sure if it was necessary)\n. I am running WS 2012 R2 with IIS 8.5, yes. \nSpecifically, this is a remote desktop deployment with rd gateway and RD Web setup to use the LE cert. I noticed that the cert renewed last weekend on saturday, had the issue above on my mobile device but things worked fine on windows PCs. took the steps I mentioned, and it was resolved.\n. Desktop browsers have cached intemediate certs I suppose to protect against weird things like this.\n. I think you misunderstood me. Browsers cache the X3 cert. So even IIS webservers that are not properly sending the intermediate cert are trusted on some browsers. I'd rather not post cert paths, but I can tell you that I went through all these steps this weekend. SSL Labs showed that my server was not distributing the intermediate cert. After my changes, i was able to verify that the intermediate was being served properly (via ssl labs and the ms rdp client on my mobile device)\n. My apologies that I cannot be more help. Just sharing what worked for me.\n. it's my understanding that it should be impossible for IIS to distribute the X1 cert if it isn't in the cert store, but I have reach the limits of my knowledge of IIS.\n. that's awesome @Trapulo keep us posted!\n. Incredible! \n... I suppose I lucked out because I run mmc as system when setting up LE-win-simple. This way the task doesn't rely on a user being logged in.\nThis is truly great news.\n. Yes.\nYou can run the command line tool with the \"--san\" option. Answer the prompts, then press \"m\" at the menu to choose \"manual\". You will give your primary fqdn, then a list of ALL SAN fqdns (including the primary fqdn). \nAfter that you specify a webroot. This is the base path of a webserver that responds to all of the SAN fqdns that you listed above. The tool will validate each fqdn separately, then generate a single cert if they all pass. Afterwards a scheduled task will be created to perform the same process automatically every 2 months.\n. @rkerber once the cert is generated it will renew unattended, right?\n. Wow sure enough. I was very much under the impression that the manual plugin could renew. \n. so... @rkerber i just did a quick scan of the issues and don't see anything about it. Are there plans to have the manual plugin be able to renew? I don't understand why it doesn't. The registry has all the information it should need.\n. Wouldn't it be better to have a cert waiting for you than having to renew then import?\nOn a side note, I have written a powershell script to import my cert into my RDS deployment if the cert is new (I guess a poor-man's method instead of writing a proper plugin) that runs 60 seconds after the LE renewal task.\n. sure thing, sorry for derailing\n. That is an interesting point about not getting the email. We have a monitoring system that alerts us if the cert is close to expiration, so I didn't think about that. Maybe an option like the one to run the scheduled task as a different user? Default to not renew, but give the option to renew.\n. I'm fine with whatever you want as long as it's documented :)\n. I'm not familiar with the code to know how difficult this change is. Any estimate of complexity so I can get an idea of an ETA?\n. I understand. Thanks for the clarification.\n. I just had one of our servers update using the manual plugin. I was even more confused, so I looked into it.\nThe ManualPlugin.cs from version 1.8 contains no \"public override void Renew(Target target)\", but version 1.9 does. \nUnfortunately, I am not great at browsing history of particular files in github... but it seems like the change was made to facilitate manual SAN runs.\nI tested and implemented using 1.8 and it worked great. So I assumed it would still function the same with 1.9 with a little more functionality (being able to generate SANs is great!). \nAny idea where that commit happened to see the reasoning behind putting in that limitation of the manual plugin?\n. oh I see\n. This is great news. One of the main things we do with this tool requires that we do the http validation, so please don't remove it in favor of tls. You verify your identity! Like maybe with TLS-SNI-01... oh wait.... the manual plugin doesn't know what webserver you're running, so it doesn't put a web.config file\nYou'll need to manually put it before running letsencrypt.exe\n. Let's Encrypt doesn't support wildcard certs AFAIK\n. The project includes a web.config that should serve your purposes nicely. Put that in the .well-known directory and it will adjust settings just for that path\n. no problem. if you can't find the web.config, you can do what I'm suggesting manually by just adjusting the settings in IIS for the .well-known directory instead of the whole site.\n. @jagbarcelo This is a known behavior of the manual plugin. It has been resolved in a pull, but hasn't been bundled into an official release. I have been using the compiled version supplied here, and it has been working well for me:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/299\n. not sure why these aren't linked, but there is a PR built off of this issue\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/299 . The issue with this is that this tool requires web access for LE to verify to generate a cert. This means your RDS server will also need IIS (or some other webserver) configured. If you're using IIS on an RDS server, you probably are going to want to setup RD Gateway. Now you would need to import the cert into that as well... so on and so forth.\nIt's not impossible, but it's probably outside the scope of this tool. \n. As I said above it would probably be outside the scope of this tool to do that, as there are so many variables... but it is possible (I've done it) to use a powershell script to import the certs. \nIf you configured via server manager in 2012+, you should have a connection broker and the ability to use this suite of cmdlets: \nhttps://technet.microsoft.com/en-us/library/jj215488.aspx\nhttps://technet.microsoft.com/en-us/library/jj215464.aspx. This is great, any chance we can get it bundled in a new release sometime soon?\n. Finally got around to toying around with this. I didn't have much luck with the forcerenewal option, but it was dead simple to generate a new one with manualhost and webroot options (not sure if that's part of the original or if that's part of what you built in this PR). I'm excited to see if a renew will go through in 2 months\nalso, i love the extra options to return immediately\n. @jmarden any word on if this will get bundled into the main branch?\nI'm just wondering about the future of this project... seems like @Lone-Coder might have abandoned.. I'm all for getting this bundled into the main branch, but fyi for the time being you CAN edit the scheduled task to look like this:\n\n--renew --baseurl  --san --manualhost  --webroot \n\nThe default task only contains renew and baseurl. This has been working fine for me until the code gets merged and works properly with just a \"--renew\". @moonbug that's right my mistake\nalso yes the first host is the primary subject of the cert. There is no mechanism to change the settings of an existing certificate. YOu can definitely generate a new cert with updated SAN list. Overwriting is probably what you want, but that's your choice.\n. are you testing it from an external location? the client is telling the acme server to hit the address, so the request will be coming from the internet.\n. You're giving conflicting information. You responded \"no\" to say you aren't testing externally, but then you say you are.\nIf you really are able to download the authorization file using external DNS from outside your exchange server's network, then I'm not sure what the issue is... I can confirm that creating SAN certificates works if the above is satisfied for each SAN fqdn.\n. check your filesystem that the file contains data. Perhaps your web.config isn't properly allowing the file to be served? There is info in the wiki about how to allow extension less file handling\n. can you not add a second binding for port 80 with the hostname? Not sure if your version of IIS supports it, but that's what we typically do and it works well\n. Yea this issue cropped up a while back when they released the X3. You will likely find the X1 cert in the indermediate store somewhere on your IIS server (typically it is found under the system account).\ndelete it, make sure the X3 is there, and restart the IIS server.\nIf you need to run certmgr as system, an easy way is to use psexec. . \n\nas the system user account, not the local computer.. yes your issue is very likely what i posted originally, and expanded on with screenshots.\nLoad mmc as the system user account, then open cert manager as the USER not as the computer. This will show you the cert store for the system user account, which likely contains the intermediate cert. It was a big deal when LE first released their X3 intermediate until someone discovered this issue related to how IIS decides on the intermediate it distributes and a poor choice of identifiers for the new LE intermediate.\nYour ssl checker confirms that your site is still distributing the old intermediate. some browsers will have a cached intermediate cert, but mobile devices will tend to exhibit the issue most often.. unless I'm missing something from your setup, that is the way it's supposed to work.\nIf you're trying to make a cert with alternate names a.domain.com, b.domain.com, c.domain.com, LE needs to verify you control those three (sub)domains.. I think you might have a much simpler time if you let your proxy terminate ssl\nwe use nginx in centos for this task. build the domain list by parsing the config files and generating certs using this tool. No.\nBoth actions require building a new cert. . I'd like to point out that it is useful in a situation where the request is made from one server and then exported to many servers (we have one such situation with RDS deployments)\nI'm perfectly fine with it being an option that is off by default. Seems like a more-secure choice. But please know that there are valid use cases for making it exportable.. fyi the recommended method of authorization now with IIS is to use \"SelfHosting\" mode, which doesn't change anything on your local IIS configuration (including creating/writing into the .well-known directory). It uses .NET to hook into the port 80 binding and serve a webserver just for the duration of the authorization. \nI recommend you try it out and open a new issue if you run into problems.. then i suggest you open a new issue with details on your setup. I believe there is a flag to output debug messages which should be helpful. @gordonfpanam yes i ran into the same thing. My script exports as the first step for the same reasons.\nNot a big deal though because if you have more than one RD server in the deployment, you need to be able to distribute anyhow.. Also keep in mind that there's a config option to not remove the old cert. \nFor us we do that and have a powershell script that we run as a second action on the scheduled task. The script:\nchecks for a new cert\nif cert is new, assigns it to the binding\ndeletes old certs\nwrites to a log file\n. you can do whatever you want with the script :)\nAs for running every day, by default the scheduled task from this tool does just that, so you're fine there. What we did was to check if the cert was created within 3 days. This means that when the cert gets renewed, it will get imported for the next three days just in case something goes wrong on day 1.. > For us we do that and have a powershell script that we run as a second action on the scheduled task\nI\"m referring to that script. \nWe add a second action on the scheduled task as such:\n\n. I can share the bones of it, sure.\n```\nparam(\n    $password = \"letsencrypt\",\n    $RDRoles = \"RDGateway,RDWebAccess\",\n    $rdpconnbroker = \"rdpconnbroker\",\n    $certlocation = \"c:\\letsencrypt-win-simple\\certs\",\n    $sleepTimer = 60\n)\nsleep $sleepTimer\nipmo activedirectory\nipmo remotedesktop\n$ADDomain = (Get-ADDomain).dnsroot\n$certlocation = \"C:\\RDScert.pfx\"\n$loglocation = \"$certlocation\\rdscert_log.txt\"\n\"$(Get-Date -Format \"yyyy-MM-dd_HH:mm:ss\") -- Beginning import script.\" | Tee-Object -FilePath $loglocation -Append\n$connBrokerPotentials = $(21..29 | %{Resolve-DnsName \"$($(Get-NetIPAddress | ? ipaddress -like 10.* | select -f 1).ipaddress.split(\".\")[0..2] -join '.').$_\"}).namehost | sort\nforeach($Potential in $connBrokerPotentials){\n    if(Get-RDDeploymentGatewayConfiguration -ConnectionBroker \"$Potential\" -erroraction silentlycontinue){\n        $connectionBroker = \"$Potential\"\n    }\n    if(Get-RDDeploymentGatewayConfiguration -ConnectionBroker \"$Potential.$ADDomain\" -erroraction silentlycontinue){\n        $connectionBroker = \"$Potential.$ADDomain\"\n    }\n}\nif(-not $connectionBroker ){\n    \"$(Get-Date -Format \"yyyy-MM-dd_HH:mm:ss\") -- No active connection broker found!\" | Tee-Object -FilePath $loglocation -Append\n}else{\n    #$certlocation = \"C:\\Windows\\SysWOW64\\config\\systemprofile\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\rds.lpbuilding.com-all.pfx\"\n$SecurePassword     = \"$password\" | ConvertTo-SecureString -AsPlainText -Force\n\n$rdsfqdn = (Get-RDDeploymentGatewayConfiguration -ConnectionBroker $connectionBroker -ErrorAction SilentlyContinue).gatewayexternalfqdn\n#$LEcertFromStore = dir cert:\\LocalMachine\\ -Recurse | ? dnsnamelist -contains $rdsfqdn | ?{$_.issuer -like '*let?s encrypt*'} | sort notafter -Descending | select -f 1\n$LECertFile = dir $certlocation -Filter *.pfx | ? name -like *$rdsfqdn*\n$LECertFromStore = Import-PfxCertificate -FilePath $LECertFile.FullName -Password $SecurePassword -CertStoreLocation cert:\\LocalMachine\\My \nif(-not $LEcertFromStore){\n    \"$(Get-Date -Format \"yyyy-MM-dd_HH:mm:ss\") -- This computer has no Let's Encrypt cert in the machine's store for the rds fqdn!\" | Tee-Object -FilePath $loglocation -Append\n}else{\n    if($LEcertFromStore.NotBefore -lt (get-date).AddDays(-2)){\n        \"$(Get-Date -Format \"yyyy-MM-dd_HH:mm:ss\") -- Cert is not new, skipping injection into RDS\" | Tee-Object -FilePath $loglocation -Append\n    }else{\n\n           <#\n\nLogic for importing cert... we do some custom stuff that probably distracts from the discussion here\n               #>\n        dir cert:\\LocalMachine\\ -Recurse | ?{$_.issuer -like '*let?s encrypt*'} | ? dnsnamelist -contains $rdsfqdn | ? thumbprint -ne $LEcertFromStore.Thumbprint | Remove-Item -Force\n\n    }\n}\n\n}\n```. my script has nothing to do with FTP, but someone familiar with powershell should be able to adjust it to use the IIS cmdlets.. I've found that the timeframe of renewals (every 2 months) makes it cumbersome to just trust that things will work out. I think a requirement of upgrading to any major version should be to rebuild the scheduled task and renewal data.. This tool maps to IIS sites (if you choose the automatic method). Specifically, it reads all FQDNs mapped to port 80 on the site. So if you want the tool to work you'll need as many port 80 bindings as you have FQDNs and run the tool with the \"--san\" parameter. From there, you'll choose your site and it should generate a SAN for that site.\nDisclaimer: I don't use the automatic method for SANs, but the above is what I believe to be true about it :). there can be a web.config file in every directory, which defines or overrides configuration for that path\nfor instance, we have a web.config that we use for manual SAN that we put in the .well-known folder before installing the tool\nalso, as an aside, you will always have to configure IIS manually (i.e. put or tweak web.config) when using manual mode. This is because manual mode doesn't require that you use IIS, it just assumes you have a webserver whose base path is the webroot parameters. I don't typically use the automatic method because of the conditions required for it to work, but I do recall there being configuration options in the web_config.xml: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/web.config . That is what i use. We are currently in production with ~20 RDS deployments using that build. The scheduled task runs with the \"--san --manualhost  --webroot \" and we have a powershell script that imports the certs when it gets renewed. I wish i knew how to browse my post history. I shared the skeleton of the code somewhere in this repo, but i don't know where.. Yea... it was a comment to someone else's post. Sorry can't post it right now, but the TL;DR is: pass the fqdn as a parameter, check if there is a cert from LE within 2 days with that name. If there is, do things to import it, in my case push to RD deployment, then clean up the old certs and exit. I doubt you'll be able to use the automatic method to update other sites. Once the cert exists there's nothing stopping a separate script from updating the primary site. \nOr you could setup a central cert store. . yes AFAIK there is currently a bug where if the renewal fails for some reason, the date in the registry is still updated\n. You could set the letsencrypt.exe.config file to not remove the old certificate.. What if the webserver isn't IIS?. Just want to give a bit thanks to @WouterTinus for taking charge here and cleaning house. I'm very glad to see some activity in this project again, as we rely on it for a fair number of client servers. I'll be testing out 1.9.4 later this week as we've been using the custom-compiled version linked in one of the issues here for renewing SAN certs via scheduled task.. In my experience, only the most-recent cert exists in the store when using manual mode. Is that not the case?\nIf it works the way I expect, then IIS would have the thumbprint configured on the binding, but the cert wouldn't exist and IIS would serve the old cert until the app recycles.. Plugin is probably overkill for doing that. We have been running over a year with many RDS deployments by just running a powershell script after the renewal. Way simpler to maintain and more flexible.. selfhosting mode uses native .NET functions to share port 80 with an existing IIS binding. I suspect it would fail if IIS is not set to bind to port 80? I can't say for sure. When you run manually, are you also using selfhosting mode?\nI believe manual runs have the option to output the parameters you'd need to do it via cmdline. Have you tried comparing that?. I think i was mistaken with the cmd line generation. I'll defer to @WouterTinus on this one. I'm not familiar enough with the codebase to help in the core development, but I could definitely create a powershell script for this project to bundle (if given specific inputs and outputs :) ).\nPerhaps we can include a cache of powershell scripts that can become part of the tool?. I have to admit that I haven't looked much into the pre and post scripts functionality. If you let me know what information is passed to the scripts I can start whipping something together for RD Gateway imports. Not that server 2012 RD gateway is managed by a centralized database by the connection broker (if configured properly). There are a lot of variables if we want to go the route of integrating with that.\nA much simpler mechanism might be to stick to RD gateway only (using the set-item cmdlets directly) and provide some proof-of-concept code for someone interested in fully integrating into the connection broker (I have a script that works for our environment, but would take some modifications to work for other people). Like I said I have no capacity to contribute to the rest of the project, but I can definitely take a stab at this. \nI'll fork and do a PR later today. Is there some documentation that you can point me to on the pre/post script execution? Env variables and the like. I'm a goofball, i found it \nI'll make a batch file wrapper for powershell scripts and put it all in a new bundledscripts directory. Hey @WouterTinus  just realized I have no idea how to make this new folder get included in the build. Can you perhaps define a folder for me to place the scripts that'll get included when the project gets built?. How do we want to handle log messages from scripts?\nCould we take stderr/stdout from the script execution and place in event logs?. I think it would be useful to provide an event with the whole output (speaking for myself currently :) ). Doesn't seem like it would be too chatty since it should only happen on renewals. I've seen some pretty verbose event logs... but if we find a limit we can split and it should still be manageable. Incredible work. Apologies if I should have done the PR against the Install branch.. @WouterTinus is it possible for us to use a wildcard in the include command or do you want me to add lines for each file?. Resolves #629 by including scripts for rd gateway, rd listener, and exchange certs... as well as a few batch scripts to allow execution by letsencrypt-win-simple --script command\nSyntax for the RDSCerts.bat file would be as follows:\n--script \"./Scripts/PSRDSCerts.bat\" --scriptparameters \"{5}\"\nIt assumes the powershell scripts are within the \"Scripts\" directory. Here's an example of that pair of scripts running: \n\n. I believe I'm done here. The exchange script is not tested as I do not have exchange nor do I have the expertise to spin up a test exchange environment.. Do you want me to update the wording in the wiki \"install script\" page?. K this is done: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Example-Scripts\nAlso note that you can reference wiki pages using double brackets (from other wiki pages) instead of using the full github URL:\n[[Example-Scripts]]\nI linked it as such in the wiki sidebar.. looks like the error above says the script cannot be found\n\nThe system cannot find the file specified\n\n. oh good catch\n. keep in mind that there are many different limits that you can run into\nas long as you have less than 10-15 domains you should be fine to create individual certificates, though.\nDon't forget to run the tool with the --test parameter to run against the letsencrypt test servers, which have less strict rate limits (but they don't generate trusted certificates, it's just for testing automation workflows). Good call here. I get so spoiled with our environment.\nI see no issue with this change, but I'm curious why appveyor failed. Don't have the time to dig into the details. \n. Seems like the only thing you added was the enhanced snapin command? @nemchik I have no exchange environments to test with, but I'd be surprised if enable-exchangecertificate worked without adding it first.\nI wish I could be more help, but we migrated from zimbra to office 365 years ago so I've been shielded from mail admin for a long time.. As far as I know, renewals mimic whatever settings were used on the initial run. That includes the --script and --scriptparameters as well as any other configurations.\nAs for your previous comment I await your testing. Pretty excited about expanding this script library.. \nYou have to downlod the release, not the source code.. when completing a certificate creation, a scheduled task is created and information is added to the registry to define the parameters for renewal. \nThis should all be automatic. Can you expand on what you're asking for?. yes self-host creates its own http server to present the authorization files\nif you have apache running on port 80, then you can use the webroot method as long as you set up apache to serve files from the .well-known path with extensionless files.\nGreat question why the error isn't logged. I suspect it's something to do with the self-host method being fairly new. Seems like most non-iis web servers won't share the port: https://stackoverflow.com/questions/33720518/how-to-share-port-80-for-applications-running-on-different-platforms-on-windows\nthis also might be a good read: https://www.codeproject.com/Articles/437733/Demystify-http-sys-with-HttpSysManager\nBoth go a little above my head, but it looks like http.sys is the only way you can share ports, and I doubt anything outside of IIS and .NET applications will use it. sure adding it to the letsencrypt.exe.config sounds like a fine solution. Giving an output of what parameters will be used when \n- asking if you want to run as a different user \n- asking if you want to reinstall the scheduled task\nwould probably be helpful as well.. - trigger hour\n- trigger minutes\n- delay task by up to X\n- stop task if running longer than X\n- any sections of the \"conditions\" tab that are currently set should probably be an option?. That seems a bit complex. Have you tried using the self-hosting method? I would imagine skype would use http.sys and be able to share port 80. I also kind of find it hard to believe that skype would bind to port 80 at all.. http-01 validation always uses port 80 so you're fine there. But as far as I know this tool doesn't have the functionality you're looking for natively.\nMy best guess as to how to solve your problem without modifications to the project would be to setup IIS to listen on some other port, then use manual method to place the files in the webroot directly. The installation plugin is separate from the validation plugin, so you could set the installation to set up IIS bindings I believe. But worst case you can use an installation script after validation. This is the channel for that as well. Perhaps you can outline how you're trying to use the tool first? What are you trying to generate a cert for?. exposing rdp directly to the internet is a bad idea. Might I suggest something like Guacamole?. yea it's an apache webserver to broker RDP, VNC, SSH through any browser. It can be run in docker if you don't have a linux machine handy. \nI'll reiterate that exposing RDP directly to the internet is a really bad idea. \n. The wiki has been updated along the process, so the answers to your questions should be there. \nThings are much cleaner now than they were (and should be more reliable)\ncan you provide a specific workflow that can't be executed using command-line options?. @cts1085 if it's no different to you, i can make a PR for the changes. @cts1085 I see that you load run import-exchangecertificate only if the cert wasn't already in the store. Have you tested this process if the cert is in the store? \nAlso what is targethost? Seems like it's the fqdn of exchange?\nother than that the script looks clean. I like the additional verbosity and the exchangecert cleanup at the end.\n. Cool. PR here\nI adjusted the logic slightly and also added a parameter to make the old cert cleanup optional to preserve original functionality (the positions have changed on your new parameters so keep that in mind @cts1085 ). a couple more tweaks have been made to the script.. Which part are you suggesting is missing? The whole thing is in a try block so any error will exit. Maybe. I imagine the bigger issue is my logic for ensuring $CertInStore exists is bad. \nBTW i'm not going to use a string as a bool. If the logic is backwards we can fix it, but we'll stick with a bool type. I don't think the logic is backwards. The bool has a default of 1. If it is 1, then -not 1 would return false, so the if block would be skipped to remove old certs (I.E. leave the old certs)\nTo reiterate my point:\n\nI need to catch up on some things at work, but I will update my PR with better logic for ensuring $CertInStore exists before continuing (i might even use a throw :) ). What does the write-debug line output for the variable?. did you try passing True or False? They should be equivalent:\n\nApologies that i can't test myself right now. right but the parameter should then be cast as a bool. I'll play around with it later. Thanks for the heads up. let's wait. I need to figure out the bool parameter issues. @nemchik  https://github.com/PKISharp/win-acme/wiki/Microsoft-Exchange is there, but it seems to still have a good amount of old data.\nI'm really not in a position currently to spend time on that, but I think your idea of putting better examples in the exchange script is a good one. I think i put a little, but putting more explicit examples related to using it with this tool is a great idea. It's also pretty obvious that we should clean up the other example scripts to include better documentation like we did for this script.\nI'd be happy to provide feedback for the PS script changes if someone wants to ping me with a PR. \nFinally it seems like this issue got lumped into a lot of things, and the original question wasn't really answered, so we may want to open a fresh issue for updating that wiki page. Do the fqdns change?. Updated per recommendations from @johlju . I honestly had forgotten about this. I think that it's fine in its current state. I'm going to make a quick fix to the parameter to be an int that gets passed a 0 or 1 as I don't have time to mess with it too much right now. I'll push a commit then you're good to merge.. K I think it's ready. Thanks for the reminder. Duplicate of #464\nThis is pending upstream support. I've locked the conversation. See #464 . are you sure that your site is siteid 1?. also note that as of a few versions ago, the recommended validation method is selfhosting, as it's the most reliable.. you can't specify a siteid with the manual plugin. \ntry\nletsencrypt.exe --plugin iissite --manualhost www.domain.com,domain.com --siteid 1 --validationmode http-01 --validation selfhosting --installation iis,manual --script <whatever> --scriptparams <whatever>\nthat should use the selfhosting validation with the domains you list. It'll then install the cert to your IIS bindings as well as run a script\nNote that if you define SNI bindings on siteid 1 in IIS, you don't need to list the domains and every renewal will populate the list of domains from IIS directly.\nEdit, i believe the above is incorrect from the docs. You probably want to use plugin iissite without the manualhost. let's encrypt will only ever hit port 80 for http-01 validation.\nchanging the local port is only useful if you are doing NAT on external port 80 to whatever internal port you specify (port 88 in this case).. If you need too much more information, i would suggest creating a fresh issue so we can discuss. But the wiki has information about your options with this tool. Specifically, the validation methods. If you can't get port 80 inbound, then your only option I believe is DNS script validation. Honestly I would recommend working with your isp to unblock port 80. That restriction seems arbitrary.. not to draw this out, but I think you may be able to use https://www.cloudflare.com/plans/ for anything simple you're trying to do.. Even if it isn't a 100% legitimate, as users of their fine platform, I'm inclined to submit to a reasonable request like this. It is a bit interesting how turning a blind eye to simple infractions like this can wind up biting someone like ISRG in the ass later down the line. Also, while it's a bit annoying, it is true that it's more accurate to call this an ACME tool rather than specifically for let's encrypt.\nI vote for acme-win-simple.exe and yes if we can move the project underneath an umbrella of other ACME tools that seems to be a smart move for visibility. Not sure how @Lone-Coder  feels about that, though :) . yes exchange should only ever connect via an FQDN. Typically one would split dns for your setup. you can just use --scriptparameters \"\" but yes i agree that it probably shouldn't be mandatory. Cert thumbprint not found in the cert store is definitely the warning from that ps script that the cert isn't in the store and it needs to be loaded from disk. Note that the warning says TargetHost and StorePath need to be passed as parameters as well.\nIf you don't want to pass those, then yes we need to look into why the cert isn't in the store. IIRC the script should look in cert:/LocalMachine with the -recurse flag, So I'm a little confused why it wouldn't be finding it.. If you had to adjust the execution policy, then your file was either on a remote path (probably not a great idea for automation purposes) or you didn't \"unblock\" the file, thus powershell saw it as a file from a remote location.\nLet me know if neither of those is the case.\nas for the REM, good catch there. This was a copy/paste from the other bat file.\nalso just a reminder for people looking... these scripts are really intended as examples of what is possible. It likely won't fit most deployments using them verbatim.\nI'll make a PR to update the second point, though.. I try to avoid using that in production. I think I said it elsewhere, but if you have to use Bypass instead of RemoteSigned, it seems like you are running the scripts off of a remote path. If not, then perhaps Windows sees the files as external? You should be able to unblock-file using powershell if that's the case.. You could probably confirm by running this command: netsh winhttp show proxy\n\n. does node.js listen on port 80? self-host verification is specifically for sharing port 80 with other .NET applications. It would be helpful to provide logs\nI am not well-versed in using all these methods, but you probably want this method:\n\npulled from the wiki: https://github.com/PKISharp/win-acme/wiki/Validation-plugins . I'm not sure how else to say this: \nself-hosting validation is not the same as filesystem validation. You want to use filesystem validation. Please provide the output of a failed run after adjusting to use filesystem validation. I'm afraid that's going to be a question for @WouterTinus if you can't find what you're looking for in the wiki. I do know recently the name was changed and there's some trickery to rebuild the configs to reference the new name. Perhaps it's as simple as going through the interactive menu to remove all old renewals and creating a fresh one? I don't know for sure.. To be clear: are you creating public dns records that match the public FQDN of the certificate you're trying to create?. Let's Encrypt only issues certificates for public DNS names. . I'm with @WouterTinus on this. Something is fishy with your download:\n\n. to expand on that pro tip: if you're in a powershell shell, you have to use where.exe since where is an alias for the where-object cmdlet. @galoou  is an error raised because the cert is already in the local store? The script could probably be improved to return the one in the personal store if they are in both (I thought it already did that with a sort, but looks like it doesn't)\nI've made some changes similar to the ImportRDGateway.ps1 script. Could you test first by using the script from my PR here? https://github.com/PKISharp/win-acme/pull/959 . The powershell script has ordered parameters, you passed \n./Scripts/ImportExchange.ps1 DebugOn XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX IIS,SMTP,IMAP 1\nyou need to remove \"DebugOn\" from the parameter list. I'm going to go ahead and say we can't support WS2003. What web server are you trying to run on this old OS? You could easily put an nginx proxy between it and the internet (to take advantage of newer TLS versions) or better yet, upgrade the server to an OS still under MS support. script settings are stored for the renewal. AFAIK there are no command line parameters that are taken when you use the --renew option. You need to generate a new certificate with the script options you want.. Let's Encrypt only validates against external DNS. Are you creating records on a DNS server that is externally accessible and is listed as the NS address for the internet domain? It sound to me like you are creating DNS records in AD DNS and doing internal lookups.. @WouterTinus  note that if IIS is clustered, it means that the serverA starting the validation might get those requests sent to serverB. The way we have handled this ourselves is a virtual directory for .well-known that points to a central smb path (could be the same server as the central ssl store).. how are you calling wacs? can you post your full command?. and I'm assuming that exact command is being run after it times out and it completes properly?\nif that's the case, i suspect wacs is running as a different user that can't access the hidden share. As a test, i would actually share out the folder with full ACL and share permissions to authenticated users (again, only temporarily, as a test) and adjust the ImportIntranet.ps1 script to reflect the new path.. >I did think that running the script manually exactly how I see WACS runs it would of highlighted an error - but nothing. I even included an echo on the first line - but this does not appear.\nso you put an echo \ninteresting. are you sitting in the directory c:\\win-acme when you run the GUI?\nI know the scheduled task sets the working directory as c:\\win-acme, so perhaps it relies on the shell being in the right directory to work properly.\nYou could easily test this by passing explicit paths when you set script and script parameters values.\nI.E.\n\nI select the option to run a custom script and use the PSScript batch file that comes with the build as a start.\n./Scripts/PSScript.bat\nThen on the parameters I use\n./Scripts/ImportIntranet.ps1 {5} {2}\n\nchange ./Scripts... in both to c:/win-acme/Scripts.... by the way, write-debug isn't going to output anything unless your debugpreference is set properly, which it most certainly won't be when running from the psscript.bat method. I would suggest changing those to simple write-output (or just the string on its own line, since powershell will send that to the stream)\nalso a separate point about your script in general. I'm not sure i understand why you have the foreachobject loop, then later in the script you directly run commands against WEBSERVER. Really shouldn't cause issues, just pointing out that it's odd.\nIf adjusting the write-verbose commands to general output still shows no content, then we'll need to get @WouterTinus  involved to see what might be happening deep in WACS, as I'm not familiar with the code side of it. what issue are you reporting? It isn't clear from the output that something with the tool is failing.. you can either do a manual list of hostnames, or point to an IIS site that has multiple hostname bindings. Technically it will only have one common name, but multiple Subject Alternate Names. Example from amazon's main cert :\n\n. TLS challenge was disabled by let's encrypt due to being exploitable on shared hosting services.. ah cool. Didn't know!\nTo that end, though, I would suspect this project would be waiting for upstream support before being able to implement it here. While I agree it's probably cleaner to copy from the webhosting path, the path to the cert should be readily available from the parameters here https://github.com/PKISharp/win-acme/wiki/Install-Script#available-script-parameters\nOr adjust the settings file to place the certs in the personal store.\nIIRC this script was an adjustment of the rdgateway script, which requires the cert to be in the Personal store to install the binding.. That's fine. I built this as an example with no access to an exchange server. Others have contributed and I've come back to verify the powershell was sane.\nI've never touched the exchange wiki, and when I wrote this script the wiki didn't have any mention of the --script parameters of this tool. \nMy hope is that these example scripts all have a similar structure and functionality, as they can then be adopted to various other situations with a bit of powershell knowledge. I made my changes in #959 to address a bug in my original design. \nI don't want to come off rude here, but I really am ignorant into the specifics of installing certs in exchange, so I'm going to step away from this for now.. forward port 80 to another machine and generate the cert there? Once the pfx file is created, you can import it into any machine manually.\nyou could also use a different ACME tool to generate a wildcard cert (doesn't require changing where the web traffic goes) and use that.. Note that i'm pretty sure --renew ignores all other settings that normally configure plugins. When this tool is doing a renew run, it only looks to its previous settings. So the real test will be in 2 months when the renewal comes up (which should be a couple weeks from now?). Confirmed to resolve #832. You downloaded the zip from the releases section? https://github.com/PKISharp/win-acme/releases . I guarantee that it is. Try downloading on a phone to verify. Note that it's not the source code download, it's the one with a version number.\nYou likely have some kind of AV detecting this as malware.. I'd like to expand on that.\nSince this tool doesn't revoke the old cert, there is no urgency to iisreset immediately. I would say it's probably a pretty good idea to just set your default application pool settings to recycle after some period of time and/or at a particular time. As this is helpful for other reasons as well.\nIf you do want to run iisreset after a renewal, you can use the --script option to run a bat file that does just that (documentaiton here). Note that I don't think it's possible to edit an existing renewal, so you'd need to cancel your current renewal and generate a new certificate.. I believe you missed the part where there's command-line options for this tool. I suggest you adjust your internal tool to run those instead.. > * you don't want to learn the documented command line options\nfrom the reply above. It uses .NET to share port 80 binding. If you aren't using IIS then you likely can't use this method, and probably are best with filesystem validation. just thinking out loud here, what if you use a raw listener on another port, and do a standalone reverse proxy that forwards to that port. Let that reverse proxy run SNI port sharing.. note that you probably don't want to touch IIS when using WS2012+ RDS deployment schemes. Everything is managed through the connection broker, so a single powershell script on the connection broker should be able to do it.. should be fine to add snapins that aren't necessary, so this is ok. I'm a little torn on whether to put it there or just in the wiki. I've never done that so I can see how difficult it is. probably cleaner than the way i have remarks currently. I think that might be a bit out of scope as it would require updating with specific knowledge on Exchange. Keep in mind this script should never be run interactively. . $true and $false are a pain to pass through from cmd. passing 0 and 1 are dead simple. \nSince it's a bool, powershell will interpret all those the same if you really want to.. I'm honestly not sure why i kept using sort, since I'm not specifying the field to sort on and, more importantly, because we are filtering by thumbprint so we will never get certs from different days.. Seems cleaner to do this so we are sure to get the right type of object. I don't have an exchange install to know if the passthrough from import-exchangecertificate returns the same type of object as get-childitem. I like to play it safe in that regard.. Yes, keep in mind the script's original intent was not to be used with centralssl (the fqdn and storepath aren't required parameters). TargetHost isn't guaranteed to be passed. According to everything I'm reading in these issue threads, the primary CN of the cert should be the same as TargetHost. That would be a question for @WouterTinus . I don't see the difference really. Either way it'll be logged.\nDisclaimer: I'm not a proper developer, so I'm not really well-versed error handling. Outputting them always works fine enough for my needs.. Better? That's pretty cool. \n\n. it'll fail into the catch block. I see no functional difference since both would stop the script from continuing.. according to the docs, there are no outputs of this cmdlet. Also the method of getting the cert after the import is a bit of a check to make sure $NewCertThumbprint is set properly.. ",
    "daveyyoung": "Hi All, was a keysize with 4096 ever made possible with the ACMESharp module?. Hi WouterTinus,\nI suspect I'm missing something but I thought the settings.config was a PKISharp/win-acme file, not something in the Windows ACMESharp PowerShell module.  Is this incorrect?\nCheers,\nD. ",
    "WouterTinus": "Yes it was - as you can read above. You can set RSAKeyBits in settings.config to 4096.. Ah I see what you mean now, sorry for that. \nYour question is about ACMESharp rather than win-acme. I think you'll have a better chance of someone knowing the answer over at https://github.com/ebekker/ACMESharp \nI can confirm that settings.config is indeed a PKISharp/win-acme thing. I don't know how the Powershell Module is configured.. That's good news! Let's hope it get merged in soon.. It landed in ACMESharp, so now it's up to us to implement it in LEWS.. Released in v1.9.8. What I know is that on Windows all HTTP traffic runs through the kernel, so an important part of TLS/SSL handling, including SNI support, is implemented at the kernel level. The kernel bindings are what you see with netsh. \nThey are distinct from the IIS bindings which, live in user space (stored in the applicationHost.config). The two sets of bindings need to be kept in sync to make the HTTPS connection work. The IIS manager is responsible for that.\nWhile the GUI seems to do a good job, the .NET library that LEWS uses seems to mess up in some unknown set of conditions. Until someone is able to figure out reliable reproducible steps to trigger the mess-up, there is not much we can do to try and fix it, other than randomly try moving around bits and pieces hoping that it will improve (maybe triggering other issues while doing so).\nWhat would be extremely useful to have from anyone impacted by this type of issue:\n\nVersion of Windows/IIS used\nDetailed description of initial IIS bindings (protocol, host, ip, port, certificate, etc.)\nExact command line and --verbose output from LEWS\nDetailed description of post-run bindings. Some update from #634: for v1.9.8 I'm bumping the system requirements up to .NET 4.6 so that we can upgrade Microsoft.Web.Administration from version 7.0 to version 11.0. I hope that's going to improve reliability.. Thanks for chiming in @webprofusion-chrisc . \n\nSome context: users of the Certify project have experienced very similar issues as LEWS users. They've gone as far a adding a button to re-apply certificates (doing that not once but twice on the background) to kick the kernel level HTTPS bindings back into shape. They've theorised it's something to do with Private Keys becoming (temporarily?) inaccessible, causing Windows to fall back to whichever certificate it can find with an accessible key.. > (1) They're scheduled to run as \"highest privileges\" under an account that is in the Administrator group, but isn't the actual Administrator.\nOne thing you could try in that case is to follow the guide at https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Migration-to-v1.9.5 and try to run as SYSTEM. For some this improves reliability.\n\nQuestion: Are there any plans in LEWS to double apply the cert storage as a matter of course?\n\nNot so far, I think it's used as a recovery mechanism rather than a preventative measure, right @webprofusion-chrisc ? \n\nQuestion: Does the location of the non-LEWS cert have any bearing on any of this?\n\nPossibly, at this point we grasping at straws. We're trying to get Microsoft involved to investigate. You can configure the store to use in the config file, see: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Settings any evidence (even if circumstantial) is welcome.\n\nQuestion: Also, do you know if the Personal Store crap itself when you reach a certain number of certificates?\n\nI haven't run into that myself. I've heard of people using LEWS to manage thousands of certificates though, so my gut feeling is that the problem is not there. \nI think the 'ghost' binding on 0:0:0:0 is the issue and that it's triggered somehow by manipulating other bindings through Microsoft.Web.Administration, because it's never explicitly created by LEWS. Since a couple of months we don't edit bindings anymore, but instead delete the originals and add modified versions, which seems to have increased reliability. Circumstantial evidence points to IP-specific and/or non-SNI bindings as having a higher chance of causing trouble.. I'm going to close this since the problem seems to be understood now and there is no fix possible from our side, only Microsoft can improve IIS/Windows.. #483. Ping to #398 - this shows that it might be necessary to chain multiple post-authorization actions.. Released in v1.9.8. This has been addressed in v1.9.4. No, unfortunately it doesn't. I haven't looked into it yet because it seems to be a pretty big can of worms. The CSR would have to match the scheduled renewal and be compatible with Let's Encrypts requirements, but I don't know what they are or how to check them. \nI suppose it wouldn't be too difficult to hack in a workaround at the level of \"you have to read the Wiki to figure out that trick, and use at your own risk...\" but real support I can't see happening soon unless someone else is going to put in the work. . LEWS uses ACMESharp to generate a new CSR whenever it's requesting a certificate, but doesn't necessarily have to. It could also be read from a static file or the command line. \nI think the main problem is that it would also need the private key to be able to generate a .pfx file after receiving the certificate, so just a CSR would not be enough.. This is more in the realm of possibilities now with 2.x, but still not quite sure how people would want this feature to work. Shall we call into a script with SAN names and Common Name as parameters, and then it writes the PK and CSR to a folder?. Just had a little light bulb moment. Rather than requesting a custom CSR for a target generated from one of the existing plugins, an externally generated CSR could actually be the target, i.e. this feature could be implemented as a target plugin. \nI'd like to get some confirmation that people are still waiting on this though, because it's been awfully quiet recently.. v1.9.5 will support this by re-scanning the bindings of IIS websites before renewal, but I just realised that the older certificate will still expire. I will have to check out how hard it would be to revoke the older certificate on such changes.. I want to make this a bit more clear so we get it right. \n\nLet's say you have set up a SAN certificate for a.example.com and b.example.com \nYou add a binding to IIS, c.example.com\nYou run WACS, it detects the new binding \nIt requests a new SAN certificate for a.example.com, b.example.com and c.example.com\n\nNow, after some weeks, Let's Encrypt will start warning you that your [a-b] certificate is going to expire, while you don't need it anymore. Is the correct way to prevent that to revoke the certificate? Or is there another way to tell the ACME server that we stopped caring?\nI couldn't find one in the protocol, but a revoke seems a bit harsh, implying a security breach and unnecessarily adding to the CRL.\n@cpu?. Thanks for your insight @cpu! Then we'll keep this open just in case those issues get resolved sometime in the future, but we definitely won't do the revoke.. The issue that non-SNI bindings get updated when adding a new Let's Encrypt SNI binding was fixed in the latest version. If anyone else has problems I will refer to #94.. This should be fixed with the new default web.config which contains the following.\n<system.web>\n    <authorization>\n      <allow users=\"*\" />\n    </authorization>\n  </system.web>. I tested that scenario on IIS10 and it worked. I guess the logic is that if\nauthz doesn't care who you are, authc is not necessary.\nOn Sat, Aug 19, 2017, 22:22 K\u0101rlis Ga\u0146\u0123is notifications@github.com wrote:\n\nIs it working if the site has anonymous disabled and only Windows enabled?\nThe point of this issue was to handle the fact that anonymous\nauthentication could be completely disabled and thus the authorization rule\nwill not help.\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/199#issuecomment-323545745,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AKilXD1y0lPokbxt-xdTgXXML8IX57hDks5sZ0QEgaJpZM4IGNog\n.\n. You are right, I did some further testing and figured out that actually the Let's Encrypt staging server doesn't actually validate the certificate requests, so it was not picking up on the errors. Unfortunately as you point out we cannot change the state of the anonymousAuthentication setting through web.config because it's locked by default. \n\nOne way to do it via code would be through the IIS manager, but I don't think I'm comfortable doing that. I'm thinking more along the lines of displaying a warning if/when we detect that anonymous authentication is not possible.. Might be possible now with the change in #550. This sound like it should be doable. Ping to #398 though, we really need to pull the plugins apart to support this validation mode for IIS and others.. It's pretty far away. \nI'm currently in the process of rewriting the plugin system to make it possible to support it in a sensible way, as the current code packs too many responsibilities together in one bundle. You can read more about that in #398.\nThe first results of that work should land in v1.9.6 but I expect the infrastructure and UX to do multiple validation methods won't exist until v1.9.7. Even at that point it will be (Azure) DNS validation that will be added first, because there is already code for that laying around.\nSo think v1.9.8 or beyond for tls-sni-01 validation.. Some good news on this front. I've just managed to do a successful TLS-SNI validation on my local machine using the development branch of LEWS. The code still needs a lot of cleaning up and also depends on some small changes in ACMESharp (https://github.com/ebekker/ACMESharp/pull/295), but it's starting to look a lot better for this feature.. Don't worry, http validation is here to stay! Other validation options will be added for those who need them but the goal is to stay fully backwards compatible. . Thanks to @ebekker's merge and fast release to NuGet this features is now enabled in v1.9.7.0-beta10. If this passes your testing, I hope to release the final v1.9.7.0 next week.. I'm afraid I have bad news Joe,\nA) TLS-SNI validation is not HTTP validation on port 443, but something quite different\nMore significantly, \nB) Let's Encrypt doesn't support it anymore for new certificates due to security concerns related to shared hosting companies assigning the same IP to different customers.\nSo there is no more TLS validation possible.\n. It's based on SNI (Server Name Indication). Basically the ACME server starts to negotiate a TLS session with your server pretending to be looking for a random hostname. Your server is then expected to offer a bogus self-signed certificate with some specific properties.\n\nThen why not just allow it for those who have full on dedicated server boxes and or vps'?\n\nThat would be the ideal world, but how would one determine that from the side of the ACME server, or the organisation that runs it for that matter? . > You contact them, tell them...\nAnd how will they be able to verify that you are not lying? . I think we're now well into the realm of fantasy :). I thought this would be obvious but the worry is not that the domain owner is lying, but that someone who is not the owner manages to obtain a certificate for a domain - by creating an account with the same shared hosting company.. > But if you already have a certificate, renewal through the same process\n\nshould be easy because they already know who you are...\nDoesn't solve the problem of initial validation, not the problem that\ndomains can change owner over time.\noh, well in that case you tell your domain registrar you used to register\nyour domain with, to verify it with lets encrypt ...and they can be solid\nproof you own the domain...\nNow you have arrived at DNS validation, which is supported by Let's Encrypt\n/ ACME :)\n. The new ACMEv2 library @ebekker is working on uses a different way of generating these hashes - I think because the ACMEv2 protocol is also different in that regard. But I wouldn't dare to say if those are FIPS compliant or not. . Ping to #398 . AFAIKT this should be possible to set up with some manual effort during first time set up in 1.9.8 or above, as it's smarter about matching with higher-level bindings (including the nameless/catch-all one) instead of always creating a host name specific one.  This is a byproduct of us adding support to target the default website.\n\nWhat remains is the option to add IP-specificity to the default binding (only works without SNI), so that you won't have to take manual steps in IIS during initial setup. That's a low-priority for me, though PR's are always welcome!. Belated thanks @programcsharp !. Hi Kelvin, please try the latest beta with the --verbose option and post the output to a new issue if it doesn't work. Thanks!. Azure DNS has been merged, for more providers/systems we should tackle #398.. This is a feature of the 1.9.4 beta releases, please check it out and report back if there are issues with it.. Help me understand this request please. It's possible to configure which certificate store to use using the .config file. Setting it to \"Personal\" should work no? As part of #398 we should make installing to the store optional and allow the user to pick a store per certificate.. Yes, running the RRAS command and restarting services etc. would have to be done by some kind of script. In the future we might have standard installation options for these kind of usages, but we just not there yet.. Running the script automatically is possible by using manual mode by the way, if you don't need the certificate in IIS.. Potentially interesting script for #629 . Depends what the 'this' you refer to is. Saving certificates to different stores has been supported in the 1.9.8 beta releases for a while now. 1.9.8 also enables you to run a script after updating IIS bindings, which was not possible before. Some example scripts for RD and Exchange are included. There is no out-of-the-box SSTP example yet but I feel the pieces are in place to make it doable.. Hi @filthyfreak, thanks for contributing! Would you mind if we distribute this script as an example in the next release?. You don't need anything special for that, just setup the different renewals. \nAll due renewals are processed by the (single) scheduled task, so you can create as many certificates as you like and they will all be handled.. This is the key message:  [EROR] Unable to find installation plugin manual - \"manual\" has been renamed to \"script\" in 2.0. If you got that command line from the docs they should be updated..  v1.9.4 has an option to disable the task creation. Thanks @dlidstrom for the PR!. This seems to be known issue with the Microsoft.Web.Administration. \nThe following link describes similar issues when deleting certificate bindings: https://forums.iis.net/t/1149714.aspx\nMicrosoft released a new MWA .dll 5 months ago. I just tried it but it doesn't fix the problem:\nhttps://www.nuget.org/packages/Microsoft.Web.Administration/\nI think we should just throw an error when we encounter the situation when there are non-SNI bindings on the same IP/port, because it's not acceptable that existing binding stop working.. I figured out a fix for the problem. The key is not to add the binding to the BindingCollection before all of it's properties have been set.. There is a long standing bug which causes validation dates to move into the future even if validation fails, which has been fixed in v1.9.4. It doesn't fix the reason why validation fails, nor helps existing users experiencing this problem (you still have to move the date back into the past one more time) but it will stop it from happening again. . Fixed in v1.9.4 (though it won't update the existing task unless you ask it to).. Which has been merged in the mean while :). I think we cannot support IIS6 with the IIS plugin, it's too different from IIS7+\nThe \"require SSL\" checkbox is locked by default and thus cannot be changed by a local web.config. There is a guide for Exchange on the wiki.. I've made some changes so that the IIS plugin updates all bindings for a host, not just the first one it happens to find.. I've also seen this behaviour. The underlying issue I believe is that not all manually created HTTPS bindings specify a certificate hash and therefore the certificate can change based on IIS internal logic, which appears to be affected by changes in seemingly unrelated bindings/websites.\nSetting SNI might trigger the IIS GUI to also set the hash for that binding, but I haven't tested that. \nI think I should run some tests and at least give a warning that something like this might happen if not all existing bindings are SNI enabled and/or pinned to specific certificates.\n. This should be fixed with #263 . I'm not sure if ACME can validate on another port than 80, which would most likely already be in use for a HTTP scenario, so I don't know if the option to set the port is useful. I'm also kind of on the fence if this kind self-hosting should be a global option for the program, or stored per certificate.\n. I'm not able to merge this code as-is, but I've cherry-picked the essential bits for v1.9.7. Thanks for the help!. I'm going through old issues and I'm not sure if any if you are still experiencing problems, but if so, please try the latest release and if that didn't help, open a new issue. Thanks in advance!. It has been merged with master :). I've just merged it in!. This should be fixed in #496, please report any issues there!. I guess it was solved :). The default pfx password is an empty string, but can be changed in letsencrypt.exe.config. \nCurrently it's not possible to mix and match plugins (e.g. manual input of DNS identifiers followed by an IIS install), so either you do it all manually (which means with a script) or all through the CLI.\nLooking to fix that with #398 . It is not possible to renew just one specific site. The --renew option renews all previously generated certificates. If one renewal fails, it continues trying the other renewals.. Fixed in 1.9.4!. Good idea, this should be part of #398. 2. The latest version of the web.config doesn't require you to change handlers for the main site anymore.\n3. Yes you can.\n4. Not directly, but as per the answer to question 1., requesting any certificate gives you the change to (re)create a task which renews all of them. Alternatively you can create one yourself.. I spent quite a lot of time making sure the Wiki is up to date, but anyone is free to add to it or make corrections/clarifications. . From what I've gathered --test mode does less extensive validation than regular mode. The latest releases of LEWS give better feedback about why validation fails. You can try and open a new issue if you still run into problems.. This is by design, as the manual mode can also be used without IIS. In fact I believe that is the primary use case for it. Especially with the new features in v1.9.6 it should be possible to create all IIS certificates you want, even unattended, so I'm going to close this issue for now.. I think your problem would be fixed by setting CertificatePath in the .config file.. Another option would be the --centralssl parameter to copy the final pfx files to a location of choice.. DNS, especially DNSSEC, and now also CAA records can cause mayor validation headaches. For now I would advise to use Fiddler to check the raw response from the ACME server to see why it doesn't validate. ACMESharp doesn't parse this feedback. But since this is an old issue which is already resolved, please start a new one if you still experience trouble.. This should be fixed with #263. I think the long-term solution here would be to use DNS or TLS validation instead of HTTP, keep an eye on #203. Starting from v1.9.7 you can generate the certificate in site x and then use it for a binding of site y, where it will continue to be renewed. That should help in your case.. It's possible now with v1.9.8 to install a manual hostname to the default IIS site.. The latest beta should provide you with more meaningful feedback. Have you tried loading the URL in your browser? . I'm going to close this due to inactivity. Please post again if the issue reoccurs with the latest version.. Renewal dates moving into the future after unsuccessful renewals has been solved in 1.9.4. There are of course still many reasons why renewals can fail and if you run into them please report them, but at least LEWS should keep trying everytime you run with --renew.\nThe other mayor issue is that information about renewals is stored in the user account, so you should run the tool and the scheduled task under the same account. See #483.. More here #488. Check out the options for unattended use here:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Command-Line-Arguments. In my mind --test mode is for hands-on troubleshooting. If you just want to use the Let's Encrypt staging server but not get any other special 'testing' behaviour, you can use the --baseuri parameter and set it to https://acme-staging.api.letsencrypt.org/\n  . You have to run the scheduled task under the same account as you orginally created the certificates with. I know, seems silly, but it's a known issue which will be addressed in a future release.. It must have been there at some point otherwise Let's Encrypt would not have issued the certificate. My theory is that LEWS deleted the folder after authorization, as it does when it detects that there are no other files in there. Nothing to worry about!. Good idea, should be part of #398 though as we rework how plugins such as this one work.. Ping to #398, I think we could and maybe should make an installer plugin for the default IIS binding, but maybe also to specific IP addresses as requested in #217.. v1.9.7 will support updating bindings created with the generated certificate outside of the target site.. From #612 the workaround with v1.9.7. \n\nCreate a separate website with port 80 binding(s) for the domain(s) your OWA is accessible from.\nOptional: redirect the root of the separate site to https:// for your users\nUse LEWS to generate a certificate for the separate site\nDelete the generated https binding(s) from the separate site (as they take priority over your default site)\nLink the generated certificate to the https bindings of your default site\n\nv1.9.8 should offer a better solution\n. It's possible now with v1.9.8 to install a manual hostname to the default IIS site.. There was a bug in 1.9.3 and below that caused many of these issues. Given the age of the issue and the work that happened between then and now, I'll close this. Please report back if it still happens on the latest stable version.. That doesn't sound right. SAN renewals are basically all-or-nothing; either the whole certificate is updated or the old one remains in place. Can you confirm that both bindings are using the same certificate? . I'll look into this when refactoring the IIS plugins for the next release.. I've looked into this, but it's actually pretty difficult to implement, especially when properly matching the certificate to the binding during renewal. In my opinion it would require at least one extra field in the internal representation of a target and a bunch of logic changes in different places. \nPerhaps at some point in the future this will become easier as we refactor the code to be more flexible, but right now I'm removing this from the v1.9.5 milestone.. You can do it in v1.9.7 by creating the certificate on another binding (might even be another website) and then link it to the hostless binding. After this initial manual step LEWS will keep the host-less binding updated after renewal.. You would have to create a binding on port 80 somewhere with the correct hostname configured. It's not the perfect solution yet, but it's at least a way to get auto-renewing certificates set up on hostless bindings :).. Yes it has to be port 80, but it can be on the same site as the hostless binding so that it doesn't conflict; all traffic would still go to the same site.. It's possible now with v1.9.8 to install a manual hostname to the default IIS site.. Option 3 is implemented with the--warmup switch, though that doesn't work for all cases (e.g. when the external IP is routed through NAT). \nWhile v1.9.4 already greatly improved the default web.config and feedback from the ACME server, I decided to add Option 2 as an choice for users running in --test mode. . I'm not really keen on spending more effort in creating 'crutches' around FileSystem validation and all of its common issues with IIS, because at this stage FileSystem validation is for legacy renewals (which are generally working) and non-Microsoft webservers, which potentially have very different issues. . At the Let's Encrypt level it's still mainly HTTP-01 validation, since TLS-SNI-01 got turned off due to security issues and DNS-01 validation requires you to write automation scripts for your DNS provider of choice, which is kind of an advanced task for most users. \nThere are different ways to implement HTTP-01 through, which you can now choose from in the menu. The FileSystem implementation is by far the most naive one. For IIS users I recommend the SelfHosting one, which bypasses IIS completely by hosting an in-process HTTP server. If that doesn't work for some reason these is an IIS-specific implementation, which works around every common configuration issue by creating a seperate application under the main site. . Most commonly with the default/simple mode this means a network level issue (firewall, reverse proxy, etc.) causing port 80 to be unavailable from the outside world.. Seems to be merged already, so this can be closed. Please open a new issue if it doesn't work for you @webbysteve . I'm going to close this because starting from v1.9.6 I've already broken compatibility with 3rd party plugins (which as far as I know, there are none). Versions v1.9.6 and v1.9.7 have significantly improved the whole plugin architecture, including moving things into their own namespaces. I'm not completely there yet, but it safe to say that this doesn't need to be merged anymore.. v1.9.8 is going full blast on Autofac.. Error handling on this should be a little better.. I'm going to merge this issue with #629, so we can gather all useful scripts in one place.. I think this is fixed in a combination of #371 and #263. v1.9.5 has a lot of improvements to run as SYSTEM and to prevent the hanging on user input when running in unattended mode.. Scheduled renewals are bound to a specific site and LEWS only scans the bindings for that site when installing a certificate. \nIt's a good one for #398 though to create an FTP installer plugin.. Native support for this is coming soon!. An FTP plugin was added to version 1.9.10. You are missing an essential point about how ACME works. Your 'authentication' - which is actually called a validation - has a very limited life span, measured in days if not hours. By the next time your certificate has to be renewed, you will always have to revalidate. You can't get away with validating once and renewing forever. One way or another, you have to retain the ability to serve validation files on port 80. The only alternative is DNS-based validation.\nThat said, there are two ways to add installer steps. Either re-setup the renewal (it will overwrite the previously create one) or edit the \"Renewals\" database manually, which is either in a file or the registry.. Yes you can choose different validation methods between different renewals.\nHere are some instructions about DNS validation: https://github.com/PKISharp/win-acme/wiki/Validation-plugins#dns-01-validation. Great that it works for you!. I just added some changes to this PR to get it in sync with a couple of other PRs that I just added to master, though it seems to have caused a merge conflict. I started an attempt to rebase this PR, but the project is set up so differently that is very difficult, and I don't want to break anything. We should try to work back which other bug fixes from 1.9.x need to be merged forwards to 2.0.\nI feel at this point that 2.0 could become the new master after we create a 1.9.x maintenance branch.\n. I've been waiting for a 2.0 beta/merge, but I guess if nobody else has time, I will step up and try releasing some pull requests. Starting with my own and @olivermue's DNS challenge plugin, which are in v1.9.4-beta as of now. . @nul800sebastiaan I'm all in favor of you taking the lead and I'll be happy to assist. \nI'm new to Git(Hub) and still getting the hang of it all. I suggest we start by creating a 2.0 branch and push out an alpha release. I've no qualms with the IOC patterns you did, though I think it was a good call from @Lone-Coder to try and remove the registry from the picture before it becomes final.\nI can see myself monitoring the issues and fixing them in 2.0 first while backporting the most critical ones to 1.9.x. Then I would also like to go through the open PRs and see if it would be worthwhile to rebase them on 2.0. . Please try again with beta 6, that should fix the null reference exception. Adding a Wiki page about how to use this would also be much appreciated!. I guess the code is expecting domains like \"example.com\" instead of \"example.edu.au\". Perhaps @olivermue can take a look?. Asking the user is problematic due to SAN certificates which can have hostnames for multiple subdomains, e.g. example.com and example.co.uk. That means we would have to either drop support for Azure DNS validation when more than one top level domain is detected (circling back to the issue of what \"top level\" means) or store settings per hostname (which the architecture doesn't support).\nThe best solution might be to use the Public Suffix List, which Let's Encrypt itself also uses.\nhttps://publicsuffix.org/list/. The PSL has been implemented in beta 7. \n\nI can see that working for many (even most) cases, but I'm pretty sure that there will be sites that might have extra domain elements.\n\nBut that should not matter, unless I'm mistaken ns-records are always set at the top level (e.g. the registered domain), so that's the entity that you manage with Azure. \n\nWhen you say the architecture doesn't support settings per hostname - do you mean the architecture of this program, or of LE?\n\nThis program, the host list is just a list of strings, would not be easy to tag extra information on them.. That makes a lot of sense, thanks for helping out!. On newer versions the raw certificate output is in %programdata% instead of %appdata%, though the path can be configured in the .config file.. Yes I'm also not so happy with the DNS plugin.\nThe plugin architecture needs some real work, as they are now being used for three main purposes (and abused for some other). I would like separate plugins in three categories:\n\nEnumeration of possible certificates to generate\nGenerating validation requests and responses\nHandling the installation/deployment of certificates\n\nIt should become easy to mix and match them. E.g. specify hostnames with Manual, generate validation with (Azure)DNS and running a custom Powershell script to install the certificate in a specific website.. I just found out that ACMESharp already these kinds of plugins, or at least something very similar, so I feel we should start using those in a future release of LEWS to not waste effort developing them in parallel. The parts which are missing from ACMESharp could be contributed to that project or kept in LEWS.. So, my idea for a new plugin system is as follows\nSplit the current Plugin class into three interfaces:\nTargetPlugin\nResponsible for reading possible certificates from different sources.\n- Manual\n- IIS\n- Remote IIS?\n- Other web servers?\nThis should also facilitate different types of certificates \n- Single binding/host\n- Single site (all bindings)\n- All sites \nIt would also be responsible for updating certificate settings before renewal (e.g. adding or removing alternative names or changing the webroot path).\nVerificationPlugin\nImplements different validation methods. Implementations should include at least three main modes (http-01, tls-sni-01, dns-01), but those would be abstract classes implemented in different ways. \nhttp-01\n\nFilesystem (local IIS or other web server)\nFTP\nWebDav\nSelf-hosting (#294)\n\ntls-sni-01\n\nLocal IIS\nRemote IIS?\nOther web servers?\n\ndns-01\n\nAzure DNS\nWindows DNS?\nOther DNS servers/APIs\n\nInstallationPlugin\nResponsible for executing one or more actions after the certificate has been validated and retrieved.\n\nCertificate store\nFilesystem (e.g. central ssl store)\nIIS (create/update bindings)\nScript\n\nMany puzzle pieces are already available, so it's a matter of refactoring and coming up with a sensible UX for chaining/combining plugins, also rethinking the command line parameters for unattended mode.\nFurthermore it will be a challenge to run the correct actions for existing renewals. I feel it should be possible to choose the correct set of plugins based on the information stored in the registry by 1.9.x, but testing all possible combinations of settings might not be feasible, so maybe it should be 2.0 requirement to recreate the scheduled renewals.. I've reopened #94 as the place to report binding issue, please post detailed information there if the problem persists on the latest release.. But why use a SAN certificate and then limit the binding to a specific host? Seems like a single domain certificate would be more suitable in that case, especially since IIS7 doesn't support SNI.. The date format is customizable, but a more sensible default was set for 2.0. The FriendlyName will be customizable via the command line, .json files and in advanced interactive mode. The defaults will look very similar/same as the current ones though. I'm not a fan of 'collapsing' three DNS names into a wildcard, because then it might be confused with a real wildcard. . I'm doing some cleanup of the issue list and this seems to be a duplicate of #165, therefore I'm closing it.. In v1.9.5 the list of hostnames is refreshed during renewal, so if you force a renewal after updating the list of bindings, it should work. \nAs long as you don't manually link a Let's Encrypt certificate to a different site it should be fine. \nFor extra security you can use the --keepexisting toggle so that it never deletes certificates (that still puts them at risk of expiring, but that can be monitored).. I ran into the same issue. The problem is that when the certificate renewal fails due to some (intermittent) issue, the next renew date is still moved 30 days into the future, hence preventing the program from trying again the next day. \nOne way to work around this is to manually edit the registry (HKCU/Software/Let's Encrypt i think), but it seems to be a pretty serious bug in this tool.. Reading through the code it doesn't seem like the issue is fixed in the upcoming 2.0 release either. Would PR be appreciated?. I made some changes to the code which cause the program to keep retrying the renewal every day if it fails. \nOf course this is only useful for intermittent issues, in the ideal case it would also notify the administrator after 2 or 3 failed tries, but I want to see first if the creator(s?) are open to contributions like this.. @rnenjoy : I think we're talking about two different issues in this thread. First is the general problem that certificate renewal dates are moved into the future even when authorization fails for any reason. That is what my PR solves. \nSecond is that SAN certs are not renewed (silently, it seems), which is a more specific issue, but of course also would be good to have a fix for in the main branch. \nHoping for a reaction from @nul800sebastiaan. @webbysteve: if your problem is with SAN certificates you can try building the other branch created by @rnenjoy and using that. If your renewals didn't happen for any other reason you should figure out why by changing the date in the registry and trying again manually. \nMy fix would only help dealing with intermittent issues, not with any misconfiguration or bug that causes renewals to fail.. I've just pushed out a beta of 1.9.4 which has the fix for the authorization failure handling. We hope to get some traction going in the project again :). I'm going to close this issue, because it's a pretty old discussion and a lot has changed in the meanwhile (v1.9.4, v1.9.5 and v1.9.6 were released, which all improved on reliability and feedback). If there are still problems, please try either the latest stable version or the latest beta and open a new issue, thanks!. I believe this is a duplicate with #349.. That the date is wrong and the program refuses to try to renew is due to #408, but the fact still remains that renewal failed for you at some point. \nI would advise you to change the date in the Windows registry, start the program manually and report or figure out for what reason that happened in the first place.. There is also the --forcerenew command line switch if you don't want to mess with the registry!. Are you using DNSSEC with a wildcard A-record by any chance?. Ping to #398 . Would be good if no manual changes to the certificate were needed, but I've got some question marks about this.\n\n\nI'm not sure how to it from code (LEWS doesn't use the command line program), though perhaps with some more research I or someone else could figure that out.\n\n\nI'm also not sure what the impact on other use cases would be. The documentation says that it supports SSL 3.0 and TLS 1.0, where it's kind of worrying for me that later versions of TLS are not listed.\n\n\nhttps://msdn.microsoft.com/en-us/library/windows/desktop/aa386988(v=vs.85).aspx. Might this be solved with the option to provide your own CSR? (e.g. #165)?. I think this should come from upstream. @ebekker does all of this mean anything to you? :). Thanks for the feedback. It looks like LEWS is using a pretty dated version of ACMESharp (0.8.1), so it should be upgraded. The latest version on NuGet seems to be 0.8.5 though. Will 0.9.x appear there or would you recommend us to switch to MyGet?. I created a pull request with changes I believe would enable LEWS to support this without risk to other clients/applications. The code is mostly untested but should give you an idea of what would need to be done: https://github.com/ebekker/ACMESharp/pull/297. Fixed it in v1.9.7 in a bit of a hacky way outside of the ACMESharp library (opening and re-saving the PFX). This is a duplicate of #424 (which was submitted later, but has a more clear title), hence I will close this issue and we will continue there. Thanks for reporting it!. Seems useful and easy to add, though if you deploy the tool through some xcopy equivalent you might end up with multiple version files, which could confuse scripts. Wouldn't it be better to have a version.txt with the version as its content?. This has been fix for the next release.. Let's keep the discussion about this error in one location in #371, but I'm definitely going to look into it.. Maybe related to #420 too?. Could you test with v1.9.7?. I'm going to assume that this answer resolves the issue, thanks @gordonfpanam for chiming in.. Due to all refactoring I couldn't merge this, but the changes were that small that I just added them upstream. Thanks for helping out!. Thanks for the heads up!. What is your concern about having those unused certificates on the system? How thoroughly do you feel they should be removed? \nDetecting which certificates are in use might be tricky given that there are multiple plugins, not just IIS. \nOne approach might be to stop renewal attempts if they continue to fail past the expiry date of the certificate. That would be a pretty clear sign that the administrator stopped caring about it. \nActually removing the certificate from the store is not something I would personally like to see the tool do. Dealing with an expired certificate for a site/system can be annoying, but deleting it can really break things.. Looks like something went wrong renewing the certificate, as your manual renewal attempt shows. If you can see the answer file in your own browser you might want to consider any firewalls or other security mechanisms which might block the ACME server, or check the DNSSEC config.\nThere's a pretty serious bug in the code that moves the renewal date forward even if authorization fails. We are waiting for a new release to fix that issue. In the mean while the work around is to edit the registry and figure out why renewal failed. See #415. . AFIAK there is no way to edit the SAN list through the answer file, so yes you would have to start again (or dive into the registry). I'm thinking of adding code for the IIS plugins to edit the SAN list based on currently configured bindings in a future release though.. I don't believe it's possible right now, but we might look into it - or someone can send in a PR of course. Show \ud83d\udc4d for support! . Another instance of the famous and now fixed registry update bug.. This issue has been fixed in version 1.9.4!. Thanks for posting the solution!. The problem is that\nftp://domain.org.well-known/acme-challenge/dGGZXjQSM4ZRSknn5StbIwN9ezyyRFLZ6zRVFFAc0hM\nshould be \nftp://domain.org/.well-known/acme-challenge/dGGZXjQSM4ZRSknn5StbIwN9ezyyRFLZ6zRVFFAc0hM\nI'm not sure where the backslash is coming from. Did you enter that?\n. We're handling this exception in v1.9.4. The problem is \"The specified path, file name, or both are too long\"\nYou might try specifying a --configpath to get a shorter directory name.. The problem is that you are supposed to provide IIS metabase IDs for the websites whose bindings you want to get read, not the domains that you want to get a certificate for. I'd already fixed handling of thi  raw exception, but now that I understand why it gets triggered by you and others, I've also added better checking and feedback around this input section.. Another PR added this feature already in 1.9.4 (Options.NoTaskScheduler), so I will not be merging this one in as is, but please take a look at current branch to see if it is how you like it to be!. I think you should also change the date the renewal is scheduled in the registry.\nI've justed pushed a fix to let the scheduled task run if the user is not logged on (almost can't believe this wasn't the default before). . The best way to avoid it is by using the --test switch for testing. If you need to request a lot of them in production then you should consider using manual mode to get the .pfx file and then script the deployment to all of your servers. There is no way to bypass the limit though, sorry.. This has been addressed in v1.9.4!. v1.9.7 started recording the thumbprints. We can definitely do more with that information than we do now though.. Ping to #494 . While ASP.NET development is interesting, I think this question should be discussed elsewhere, as you would have the same issues with any certificate. thanks for using LEWS though ::). I'm going to highjack this issue for wildcard support. If anyone is still interested in the NGINX part, please open a new one.. Wildcard support is not likely to appear anytime soon. There has been some work on a new version of ACMESharp with ACMEv2 support, but it's not exactly close to release or even actively in development. At this point there are roughly three courses of action to move this issue forward: \n1a - wait for the ACMESharp project to get their v2 support out (if ever).\n1b - divert time from this project to ACMESharp to help them get it out.\n2 - find another library to build win-acme on while maintaining compatibility.\n3 - write our own protocol layer, based on ACMESharp and perhaps others\nI have not decided yet which would be the best way to move forward. I like the idea of having a common ACME(v2) library that different tools can use,, but which or whose library it should be is difficult to say. Having control is nice, but duplicating efforts is a waste of valuable time and having others fix bugs before you even knew they were there is great.\nI consider ACMEv2 support crucial for the long term viability of this project and it's the first major thing I'll start working on once I have time, but for personal reasons I'm not able to spend much of that on open source development right now. Unless other devs step up, it will be a while.. I was referring to https://github.com/PKISharp/ACMESharpCore - but that effort seems to have stopped around the same time as the main branch. ZeroSSL looks very feature complete but it's written in Perl so it's not of much use for this (C#) project. Can be a useful as a reference though.. For my part, I'm working on a branch of win-simple based on the ACMESharpCore library. So far it doesn't look like it would be very difficult to release a version based on that, but I'm still in dubio about how to handle upgrades and backwards compatibility.. Hi @Dragonsangel - I ran into some roadblocks moving to .NET Standard, but now I have my builds and dependencies in order and some of the basics are working, i.e. setting up the connection and making a new registration. Next up is obviously validation and certificate generation. I made some attempts to run v1 and v2 side by side, but that is proving too difficult, so we might be looking at a 2.0 release that is ACMEv2 only. \nObviously then I'll want to have a migration plan in place for v1.x users and consider which (if any) other mayor changes should be done for v2 (e.g. dropping some more dependencies and legacy ugliness).. Finally got a day off to work ACMEv2. Testing this is the first step towards wildcard support, so everyone who's eager to have that is invited to help in the effort!\nhttps://github.com/PKISharp/win-acme/releases/tag/v2.0.0-alpha1. Just got it working for the next beta! Now it doesn't have to be a new years resolution to add it. Will upload a new beta build after the party tonight :). That's right wildcards can only be validated using DNS methods. I guess the error message should be improved because not everyone is going to be familiar with the LE specifics.. I'm going to merge this issue with #629, so we can gather all useful scripts in one place.. Manual mode renewals have been added in v1.9.4, please open a new issue if you run into any problems with that using the latest release.. This is fixed in v1.9.7, duplicate of #290. #496 might help, please check out the new beta and report back if this helps in your case!. I'm not familiar with SSTP, but you are right that the old certificate should be uninstalled. The program output should show that happening, or an error if it fails. You can try running with --forcerenew and --verbose to see whats happening (and post the exception if uninstall fails).. I found and fixed the issue in the IISSiteServer/UninstallCertificate code. . The next release will keep trying to renew after it fails, 1.9.3 and before have a serious bug where a failed renewal attempt is registered as a success.\nThe reason why your renew failed should still be figured out though. It could be due to Let's Encrypt more aggressively verifying DNSSEC records recently.. I've just merged #299 so it will be in v1.9.4!. I think it's not possible right now. Maybe if more people are interested in this feature we can look into it.. Ping to #398 . @Archanian for your use case #445 would be an interesting feature request to keep an eye on.. v1.9.6 provides an option to run unattended for a specific site.. It should be in %programdata%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org or %userdata%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org in a file ending with -chain.pem. Do you see the other files in those folders though? -crt.der, -crt.pem, -csr.pem, .pfx, etc.?. I'm going to close this issue due to it being quiet in the thread for a long time. Please feel free to post again though if you keep having issues with the latest release. Thanks for using LEWS and providing us with feedback.. There is already a very similar function which is --warmup. Its use is optional but it works for all plugins generating http challenges. It logs errors but doesn't do anything else with them. I would propose changing that instead of adding another hook into the already overly complicated plugin system.. This has fallen far behind master and shown no activity in the past half year, so I'm going to close it. Please feel free to create a new PR though if you still plan to implement this.. Should be possible to do this by hooking into the GetSites() function of ManualPlugin. I'll look into it.. It's possible in the latest betas using --san --manualhost example.com,www.example.com,test.example.com. The web.config work can be done through a script that you can specify using --script and --scriptparameters, I think the Manual Plugin should not do any IIS specific work. The idea to disable httpRedirect in the .well-known folder is a good one though, I'm going to include that in the 1.9.4 release. Thanks for that!. Another great option would be if this one was merged #294, then the Manual Plugin would not require IIS or any webserver at all.. Closing this because the solution seems to be found and there is no more activity in the thread.. Fully agree on that, it bit me too a couple of times. The plan is to stop using the registry altogether in version 2.0, but using SYSTEM/HKLM would already be a big improvement.. This has been implemented for new users. Existing users will continue to work as they did before, but it's possible to migrate manually.. I very much like the idea but this would have to implemented in the ACMESharp library before we can display it. Relevant link: https://github.com/ebekker/ACMESharp/issues/267 . I actually managed to find the error messages today. I've removed the standard explanation about the IIS handler, because there are many more reasons why authorization can fail, and now just display the errors as ACME sends us.. This will be possible from version v1.9.4 thanks to #299 . This exception will be properly handled in the next release, it's due to no DNS names being detected. . I remember reading somewhere (though I can't find it now) that it's related to the openssl library used by AcmeSharp and therefore LEWS. It was supposed to be harmless, i.e. the certificates should work.. @rdebath what do you mean by PFS? Is this something which LEWS could do better?. This might be fixed with the updated ACMESharp library that will be landing into 1.9.7.. I guess the user needs local admin rights to access the computers certificate store and the IIS metabase.. A clean install of v1.9.5 is going to run as system, I'll update that release with instructions on how to migrate before it hits final.. This should be easily fixed by adding the line <remove fileExtension=\".\" /> in the (default) web.config before (re)defining it. I'll include that change in the next release.. That's a pretty serious bug, so I rolled out a new beta for you to try. Turns out I set a flag which only works on older versions of Windows.. The trick with this new DNS plugin is that all sites are listed twice when you start the tool. Once for DNS validation and again for IIS (HTTP) validation.\nI can imagine it would be much easier if you first choose the site and then the validation method, but that would require a somewhat drastic refactoring of how plugins work, which seems more appropriate for the 2.0 release.. Will do - ping to #494 . I've been testing the Manual plugin and was not happy with a lot of the code that I found, so there's been some pretty extensive rework on that in beta 4. \n--manualhost now interprets comma-separated domains as you tried, but only if the --san option is also specified. \nI very much disliked the way the Manual plugin messed with the program flow (i.e. triggering authorisation in the function which is supposed to print the menu), so to get back the old behaviour of immediately triggering, you should also add --plugin Manual to your command line.  \nYour full command line should be\nletsencrypt.exe --emailaddress my.address@mailme.com --signeremail my.address@mailme.com --usedefaulttaskuser --accepttos --san --manualhost agga.it,www.agga.it --webroot \"F:\\Domino\\Data\\domino\\html\" --warmup --plugin Manual. The option --notaskscheduler would skip the task scheduler step, and --closeonfinish skips the start again question.\nIt also looks like there a is renewal in your registry which cannot be parsed. I've improved error handling for that case but we should still investigated what causes that to happen. It would be useful if you could relay the error message.. Will do! Thanks for helping with testing!. Good idea, will update when I feel 1.9.4 is stable enough to release. Meanwhile #493 might help. . First mayor update is done:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Command-Line-Arguments. This page has also been updated now:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Settings\n--signeremail was in the beta for a while but has been removed because as I was documenting the command line switches I found out there was another one with the same stated function (--emailaddress).\n--plugin is a bit of an awkward mechanism for me too, but actually the whole plugin system is. See #507 and #398 among others. IMHO a program called letsencrypt-win-simple should not have a publically exposed plugin architecture. Might be a v2.0 thing though to fix that.\n. I can't really explain why the bindings would get removed when using the Manual mode, as it is not supposed to touch IIS, nor the certificate store for that matter. Can you show us the script that you run for installing?\nThe content of the registry entry and exact command line that you use in your scheduled tasks could also be useful for debugging.. I wouldn't recommend changing the registry manually, as the first (interactive) run when setting up a certificate can provide valuable feedback about the validation and installation process. If you want to use manual mode without LEWS doing anything with the certificate store, yet still use the certificates in IIS, you can use the Central SSL store.. The manual input with IIS install scenario should be supported out of the box with the final phase of #398. Meanwhile there is a workaround described in #612.. I will push a small change to download the temporary file to same place where the final files are stored. Please try the upcoming 1.9.4-beta6 to check if that helps in your case.. Have you tried copying the .dll from C:\\Windows\\system32 to the LEWS directory?. You are very right, my bad! Look for 1.9.4-beta6!. Good idea, look for 1.9.4-beta6!. You are right, this happened because of the addition of the DNS plugin, which causes the program to see two targets with the same SiteID. For now I'll filter out the DNS targets from this particular mode of operation. \nIn the future it should become possible to mix and match targets and validation modes.\n. I'm not able to reproduce this issue but I will add some additional logging. It would be helpful if you could post the output of the next beta.. The new --verbose switch might provide some extra insight, but since this would be an exception generating a log message with Error priority it will show regardless.. You are welcome -- thanks in return for helping me with testing and debugging.\nIf you could post the contents of the registry key Renewals from the path HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/ I will try to track down the problem.\n. You are very right.\nThe --certoutpath command line switch has already been removed because of this and other reasons, though it's still possible to change the certificate path globally using the .config file. \nI'm going to remove --configpath and --proxy too as command line options for the same reasons. I believe that these kind of options are not something people would typically want to change per certificate, so it doesn't make sense to persist them at runtime or into the scheduled task.. Agreed, see #483!. I believe this is a duplicate of #502 -- please post your JSON there so we can debug!. 1. You should be able to export the certificates from the old server and import them on the new one. \n\nYes, check out the --san switch.. Exactly. If your current certificates don't have their private keys marked as exportable yet, you should re-generate them on the old server first, or get the original files from the appdata-folder and copy those over to the new one. \n\nYou can either run LEWS on the new server to re-schedule the renewals, or export/import the LEWS registry keys to save some time.. You'll find the keys under HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple. That is not possible in SAN mode, but as an alternative you can generate single-host certificates when you omit the --san switch.. Check out v1.9.6 as it has more fine-grained options to generate multi-site certificates while excluding some bindings. That might help in your scenario.. I've decided to keep plugin support, but not to guarantee stable interfaces across different point releases of LEWS. That way plugins can be built against specific versions of the program (e.g. 1.9.4.x, 1.9.5.x, 1.9.6.x), but they will have to evolve with the mother program as we refactor the plugin system. . The error appears to originate from the call to the function SubmitChallengeAnswer of ACME.NET. I don't have visibility into the exact cause but it could help either me or the developers at that project if you managed to capture the data going over the line using a tool like Fiddler ( http://www.telerik.com/fiddler ). I also noticed that @rdebath, but it's unlikely to cause this JSON error because there are no invalid characters and I don't believe these local paths are communicated back to ACME anyway. I'll take a look at the trace later to figure out if it's something on our side or a problem further up the chain.. And you have tried to access that URL http://myfakeurl.co.za/.well-known/acme-challenge/0ZHb5kOp0YhYTtb_O_g-9IS4pvxYsOYuxlHS5EvIlx8 and confirmed it shows some random character string? I assumed so, but reading back I don't actually see you describing that that works.. The JSON from the Fiddler dump looks like this, so it's missing a \"resource\" field indeed. Would that field typically contain a DNS identifier? \n{\n  \"header\": {\n    \"alg\": \"RS256\",\n    \"jwk\": {\n      \"e\": \"AQAB\",\n      \"kty\": \"RSA\",\n      \"n\": \"qIoWuetgoOPH3jFAWnYo4ASQtDDrNwbuycJHB4c1PKfUItsh2uxsCdhdmI-2Fh9jV01Gc2krq2dbyphlTaCjNhKx98I52Pyq-t9i3mhA_BQCEbsvOYXypL8PTwJlohlpEeBECJalP5DVytPerWvGQOBMxKqpBuys7za0hOSuqbJAH0oKhorhL9irKtMu5m1lx2EOwkCMTY8qE0RPVYI6ao0v3qMMLkx2wDc0Er9S_YUz8GMyvP9jMg_unTwfyrjdfJGF-ZpYaxd5a5bTkU-BaTHghxd-HaREsKiPAsTsnnclSP1uy3KQoxDaELR9gPzzphPgbwzql8ernjmuXuS23w\"\n    }\n  },\n  \"protected\": \"eyJub25jZSI6Ik5CMUtjVlVxUkFncjZHSnB0Tk5PVVNQeGRuWnFZUDZtMHRDazNtcUlxMUkifQ\",\n  \"payload\": \"W3siS2V5IjoiUmVzb3VyY2UiLCJWYWx1ZSI6ImNoYWxsZW5nZSJ9LHsiS2V5IjoiS2V5QXV0aG9yaXphdGlvbiIsIlZhbHVlIjoiSTRVQ0QtWDdnMUQzMTRMUGo1aUUyWkpmNmJ5bkd0TVpsZ1hqdEdQdzRpTS41VGdrY2VqWG9JbF9aY2tkRGdKVW51TTdVTWgycmVPa0g1M3F0c1REWWowIn1d\",\n  \"signature\": \"GaLtyejFzHkIaTNwC_cWXwGHzxbAacPdB3CERS62157TLhLvOo4ydkE8hc0Y69e7mT8ZlDL1kg0NSjkhpL4RZJ0U4R7H8m6ILtIjPRUl99DYUGBpJZExFVxpCbiLmFnyGzhwQm2wdL7S0ar0gE5X7j15lE2ia5YmdZON8edzugsPrPLrT75cNhZRICHzug89F-8afNRD5o2vq8po1OUlTHr5iv_MfolqyOKpUbhS3t3qovTYzvEilBUMQdqD3kLKgt16SyBvFlaSVDE4rAZQ3jH7XasfkH04q_zzOkOct8G8IT5Ng2RiPeNLz4R1cA17xNT98DWwKDt_RThzoDpWzQ\"\n}. Thanks for clarifying that @cpu. \nThis issue remains a bit of a mystery though. AFIAK this project has been using the same AcmeSharp NuGet package for a long time. It also doesn't seem to happen for everyone. On my machine it works fine for example /cliche.\nThe fact that these values are locked away in a container format also eliminates any proxy or firewall messing with the content. I hope @ebekker has some ideas.. Thanks @cpu and @ebekker, this is very useful feedback! \nI'll investigate if I can trigger this funky JSON encoding on my end.. Not personally, but digging through the history it looks like we went from 8.0.2 to 9.0.1 on February 25th ( checkin). \nThe first time a user reported the issue was on May 4th (#218). \nIt all smells like there could be some system-level settings (GAC?) messing with Newtonsoft. \n. This issue got closed automatically when I committed the changes for the latest beta. @KelvinJones can you try beta11 and see if that works for you? I've upgraded to Json.Net 10.0.3. If this doesn't fix it for you then I will revert back to 8.x.x and see if that helps.. Beta 12 fixes that issue, I did some more testing with Path.Combine and it does indeed make funny decisions sometimes, so now I just strip any trailing or leading / and put one in the middle myself. . Difficult to say, can you run with --verbose and post the output here?. @hbruun, your error sounds like #371. @1liminal1 seemingly has a different problem. . This a known issue in version 1.9.3, which will be fixed in 1.9.4. If you want you can try the beta version!\nAnyhow, thanks for the detailed bug report!. Could you post your command line and program output to help diagnose?. I decided to remove the Azure DNS plugin for the final 1.9.4 release because the user experience is obviously not clear and I'm not happy with the plugin architecture anyway (#398). It will return in another form in a future release.. Should be fixed in the latest (and hopefully last) beta :). Take a look at the --warmup switch and #478 for a PR related. You might have other problems with validation though (e.g. DNS issues), the latest betas give much better feedback about it!  . I'm not sure what your configuration looks like, but it sound like you might be able to use a central cerficate store: https://blogs.msdn.microsoft.com/kaushal/2012/10/11/central-certificate-store-ccs-with-iis-8-windows-server-2012/\nLEWS supports that with the --centralsslstore switch. I guess we can close this then :). Your authorisation with the manual plugin probably failed because you didn't specify the --webroot when starting up. I will change the UX to prevent that mistake in #518, but since it's a somewhat breaking change it will be 1.9.5 or beyond. I saw you've opened another issue for the other error so I'll close this one.. Could you post the full program output in --verbose mode and which version you were using? . Closing for now to keep things tidy around here :). Have you figured out what was causing the 403 error? Was something wrong with the bindings?  . I don't see anything strange in your program output, it looks like a perfectly normal and successful renewal. It's too bad that you haven't been able to figure out the root cause for the 403 errors. That might have helped us to figure out the exact cause. \nWhat I can tell you is that v1.9.4 changed the way of renewing certificates in IIS. Instead of altering the binding, it removes the existing one and re-creates a new one with the same settings and the new thumbprint. According to some users that increases reliability (see #371). I would advise you to test renewals with the latest release and the --forcerenewal option, preferably in a test environment.. Since there's no more activity on this issue I'm going to close it. Issue #94 can be used to report similar issues.  . We can't put it in the configuration file because the path might be different for each certificate request. Agreed though that the manual plugin is non-intuitive to use. I think it should not have a default value and ask the user for input when none is provided through the command line.. Fixed with #527. Hi Bent, the wrong date is due to a bug in v1.9.3 and earlier, the renewal was tried and failed, but the date was still moved forward.  You can try the --forcerenewal option of the new version to see if it succeeds now (or to find out what went wrong in the first place).. The problem I think is the default value for --webroot, which is already on my todo list to remove from v1.9.5 (#518). I will check the history and if that default value was not in v1.9.3 or earlier I will create a v1.9.4.1 release to get it out sooner. In any case the workaround is to specify the webroot on the command line.. It looks like you are missing a file in your program directory, specifically \\x86\\libeay32.dll\nCan you check if it's there?. Nice catch, will be fixed in the next release!. Hmm strange that I didn't get those locally, might be a release build issue or I might need to clear some temp folders. Will look into it anyway, thanks for testing!. For now the only workaround I can think of (but not tested) is using the --centralssl parameter. That copies certificates to a file system location instead of installing them on the local machine.. Feels like a bug in 1.9.5, i'll look into it next week. . @nvanrooij you are right that seems to be the same issue. Yes, the keys are needed and will be created automatically again by the next beta. The problem was a simple missing null-check for the clean install scenario.. TIL :) . I think what's missing from that command line is --plugin manual though I'm currently not able to test.. It's no problem that the scheduled task gets overwritten, there's ~always one task for all scheduled renewals. I can't explain why --san won't show any sites but that code has gone through some rework in 1.9.5 so you might have more luck with 1.9.4. . Might be related to #539 . I believe this has been fixed with #544 . Could you post some more information on what you were doing and what other messages got logged before this one?. Hi Pitapam, could you perhaps try v1.9.5 beta 2 with the --verbose switch to see if you still get the issue that you had with beta 1?. Closing this due to lack of activity and the fact that we've moved forwards a lot with the code.. You can test with the --forcerenewal switch. There is not really any difference between an initial issue or a renewal, so I doubt it's going to work with SSO enabled. You should figure out a way to disable SSO for the .well-known folder. \nModifying the web.config could be one way depending on how your application is codes and configured.. Happy to help!. Thanks, some others users reported similar problems but so far it's not been linked to the existence of a ftp site. This should help to pinpoint the bug. . Should be fixed in beta2!. So far there is no command line option to do that, however it has been requested before (see #445). . I've had similar issues which my DNS provider, it sucks to be dependant on an incompetent or unwilling one, though there is nothing more we can do about it on this end.. It's not possible to update a registration at this point, though you can actually clear the configuration folder to force creating a new one (by default it's C:\\Users\\xxx\\AppData\\Roaming\\letsencrypt-win-simple for v1.9.4 or C:\\ProgramData\\letsencrypt-win-simple for v1.9.5-beta). You should either generate two separate certificates for www.domain.com and domain.com (which will only work on IIS8+), or alternatively use the --san switch to generate a single certificate for both of them. Hope this helps!. Nice catch, there had been some reports of missing sites which I'd been meaning to investigate, but this probably explains most if not all of them.. Try adding --plugin Manual. I believe the latter is already the case.\nThere is already a setting to specify a proxy server to use. I've made a little change to v1.9.5 to have that also apply to warmup requests, that should help to break free from internal environments (in other cases the DNS can be correct but routing issues might occur).. This is the issue \"No valid IP addresses found for vh-dev.tk\". I also cannot ping the domain. You cannot get certificates for domains which are not registered and/or listed in the public DNS tree.. Did you by any chance install ASP.NET between encountering this problem and solving it? I'm kind of sceptical about the mimeType solution because that is already added by the default web.config. But it might be related to the user report in #550.. I'm going to close this due to it being quiet for a long time. Please feel free to post again though if you keep having issues with the latest release.. This might be because you have not installed ASP.NET, which unlocks the  section. Apparently, that is not a default feature of IIS. I would like to keep the  section in because it seems to be the most common issue people have while deploying LEWS, but for the (rare?) cases where people use IIS without ASP.NET, we also cannot cause errors.\nI guess that we should detect whether the section is locked and maybe even unlock it in cases where it is.. This is 1.9.5.0-beta3!. This should be fixed in the final version of 1.9.5, I'd already caught it in 1.9.6 but hoped no-one else would notice :). Can you please post the output of letsencrypt.exe --forcerenewal --verbose?. Looks like a perfectly normal renewal for me, what is wrong?. Can confirm that the credentials are just passed to the Windows Task Scheduler to be able to run LEWS unattended, nothing is sent to Let's Encrypt.. It's probably because in IIS, under SSL Settings, the checkbox \"Require SSL\" is on for that website, meaning that IIS blocks the HTTP-request to the validation file. Watch for the new beta soon for a solution.. That's good news! Thank you for providing valuable feedback.. Yes, I believe Exchange requires some additional steps. Though I don't know a lot about Exchange, there's an article on the Wiki about it: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Create-a-SAN-certificate-for-Microsoft-Exchange-2016,-2013-&-2010. Are you running as administrator?. Do you have IIS installed on your server? . It was built as AnyCPU, but the option \"Prefer 32-bit\" is on by default in Visual Studio, causing the program to prefer the 32 bit runtime and registry. \nI've just updated the release with a new build which runs 64 bit on 64 bit systems, That means that if you applied the workaround with Wow6432Node you'll now have to undo that. Sorry for the inconvenience!. The --test switch is not meant for unattended operation. What is your use case exactly?. On second thought, it does make sense that --closeonfinish takes precedence over the default --test behaviour, so I'll make a little tweak regardless.. You have an AAAA (IPv6) record for the host, but that address doesn't seem to respond to http requests. That is probably the issue.. Apparently it's a recent change to Let's Encrypt that they prefer IPv6 over IPv4, see: https://community.letsencrypt.org/t/certbot-ipv6-not-configured-and-challenges-fail-ipv6-preferred/34645. You have two options:\n\nMake sure the site is reachable through IPv6 (you can test with http://ipv6-test.com/validate.php)\nRemove the AAAA records to indicate that the host is IPv4-only. We would be able to run some tests on the domain if you'd be willing to share the real one.. You can ping @wtinus on Twitter.. It looks like you're creating a SAN certificate, but are kind of expecting the behaviour of separate certificates for each binding. Basically the same kind of confusion as was discussed in #579.\n\nIn order to create or renew a SAN certificate Let's Encrypt requires valid authorizations for all host names listed in the site, though you will have been offered to input a list of host names to exclude the first time you created it.\nIf the invalid domain name is added after setting up the certificate, then LEWS will automatically attempt to include it into the SAN list and in that case yes, renewal will fail. LEWS will keep retrying every day, while Let's Encrypt will send an email (to the address you provide when registering) to notify you about the fact that the certificate hasn't been renewed for a while.\nOnce made aware of the problem the resolution is to re-create the certificate manually, or remove the invalid binding from IIS.. Let's Encrypt prefers IPv6 over IPv4, while your browser probably cares a lot less. I would recommend you to try http://ipv6-test.com/validate.php for the domain that you get the error for.. DNSSEC can be a pain in the ass if your provider hasn't implemented it well (speaking from personal experience). Hope they manage to correct their configuration!. You have to specify all fully qualified domains, so www.example.com and example.com. You can either create two separate certificates or a single one that supports both.. Yes this seems excessive, I'll make sure that it will only show those messages when they are really useful (e.g. when creating a certificate, not when doing other stuff).\nThanks for trying the new version!. I think Central SSL should work for Exchange, as I believe the web applicatie part of it does not have any magic dust which different from any other IIS site. Are you aware of these instructions? https://technet.microsoft.com/en-us/library/jj129387(v=ws.11).aspx. Please check out or contribute to #629 if you manage to get that PS script up and running!. I'm not familiar with the requirements for XAMPP or how to create bindings for it, but after generating two certificates you should find two .pfx files, two .der files, etc. etc. in the certificate folder of LEWS. . I'm going to close this due to lack of activity (to keep the issue list clean) but don't hesitate to post additional questions. . Nice catch! Thanks for testing.. My experience with git is limited as you may have gathered from my stumbling around with PRs. I had limited success from GitHub, but this mess was the result of trying to do a merge in the Git Desktop tool, because GitHub wasn't able to merge some files.\nI've since figured out that I'm supposed to rebase before trying to pull code between branches (right? :)).\nI might give resetting master a try, but on the other hand I prefer working on the project rather than fighting with Git. . Thanks, that helps! You seem to be happy to help around here in general, perhaps you would like to become a contributor? If @Lone-Coder approves of course :). It feels like it wouldn't be a great idea for a piece of software built to help encrypt the world, to ignore problems with said encryption. I would prefer to install the Let's Encrypt root/intermediate certificates from a known good location, though I haven't figured out where to get them yet.. So launching a HttpWebRequest to https://valid-isrgrootx1.letsencrypt.org/ should already do the trick, and possibly the API calls ACMESharp does have this effect already (if the endpoint uses the same certificates as the test url).. I just made a change that installs the intermediate certificates upon a successful validation. It turns out there are two of them in the generated pfx, so perhaps you also need two of them for the initial contact with the API.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/commit/643a59586da4bf94f36c99225eb354176597628d. Perhaps this would help if you want to do it from the .config file\nhttps://weblog.west-wind.com/posts/2011/feb/11/httpwebrequest-and-ignoring-ssl-certificate-errors\n. No problem!. I've not looked into it yet, but the first thing that popped into my mind is that it might have to do with the capitalization of the host name. So a quick fix might be to exclude \"server2\" instead of \"SERVER2\".. Yes, the problem was that the exclusion list always got lower cased, while the hosts weren't, so there was no correct input possible for an upper case binding. Now the hosts are also getting lower cased and the comparisons are made case insensitive. Anyway you can try v1.9.6.1 for yourself, I've updated the release.. Seems like the wrong installer is running, definitely a bug.. This is fixed in 1.9.6.1. Interesting setup you have there. Supporting this would require some changes to the program, as our 'targets' are scoped to a specific site, rather than considering the whole collection of sites. It might be useful to change that behavior, but we obviously have backwards compatibility to take into account. Especially for SAN certificates that could prove challenging. \nThere could be a new type of plugin for this scenario, but actually in your case using TLS or DNS validation would make much more sense, because it seems like you've only set up the http site for Let's Encrypt. \nLimited support for DNS validation (for Azure DNS) will be added soon and it should be pretty easy to add other providers to that list, but TLS is further away.. > I have a similar configuration. I have separate IIS websites for SSL (443) and non-SSL (80). The non-SSL website just points to a dummy folder that contains nothing but a default page that redirects to the https domain.\nWouldn't it be easier to use an urlRewrite for that (with an exception for the .well-known path)?\nA more valid use case for split bindings would be if your main endpoint is using ip restrictions, Windows authentication or other security measures which you don't want to or cannot make exceptions for in the .well-known path.\nPing to #398 because it would be something to consider for the installation part of the new plugin architecture.\n. With v1.9.7 you can at least manually create the set up in this way. Just create the certificate in site x and use the certificate for a binding in site y. It will renew in site y as well.. It's possible now with v1.9.8 to install to a different site.. You're running your own ACME service? That's cool :). I'll have to check if this is an issue with LEWS or ACMESharp and I'll get back to this thread when I know more.. The issue is with ACMESharp, but v1.9.6 uses a pretty old version of that library, so this might be fixed in v1.9.7 - which will include the latest release. Perhaps @ebekker can chime in to tell us if this has ever been tried before.. Did you have a chance to try one of recent releases @nabber00? . This will not be fixed for 1.9.x anymore, but you might have more luck with the upcoming 2.0 release. If the bug is still in there, please let us know.. Hi Jason, support for dns-01 will come in the next release but initially only for Azure DNS. Other providers/services will have to be added through plugins. It's not possible to change the registration email but you can create new registration by deleting the files from the configuration folder under \\ProgramData. What you need for your case is dns-01 or tls-01 validation.. Keep an eye on #203 as @robjarsen pointed out. The next beta will include limited support for DNS validation.. Actually I would call it a bug. --hidehttps is supposed to hide bindings/sites from the user in interactive mode, not hide them from the software itself.. Actually I'm not seeing any unexpected behaviour in this case, though we can discuss whether or not it's desirable.\nYou chose \"All bindings for a single IIS site\", which is implemented by generating a SAN (multi-host) certificate. The advantage of SAN certificates are at least these:\n\nless likely to run into rate limiting \nmore friendly for IIS<8 or other hosts/clients which do not support SNI\nmore manageable by humans\nadditional bindings can be added and automatically included in the renewal\n\nThis mode used to be hidden behind the --san switch and therefore was not easily accessible. What you might have been expecting option \"2\" to do was just repeat option \"1\" three times in a row, but it's actually a pretty different thing.. Thanks for helping out. Unfortunately there is a problem with this proposal. UrlRewrite is not a standard feature for IIS so this change will cause errors on servers which don't have it. The other change is specific to ASP.NET which might also not be installed, though I'm not sure how IIS would behave when encountering it (it might just ignore the whole system.web section).. I tested on a default install. The system.web section seems fine but the urlRewrite causes a crash when that module is not installed.. This should not be needed anymore with v1.9.7, see https://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.9.7.0-beta1. Nice little improvement, thanks!. Thanks for helping out! \nTwo comments about this:\n- There's another place in the code where the proxy setting is used (for --warmup), I think should be kept consistent (and might be a nice time to create a helper somewhere to avoid duplicating the code)\n- Shouldn't we use the system proxy as a default?. I think that if you configure a system wide proxy you should expect applications to use it by default. Overruling the system should be the exceptional case. That said, it should be possible to do just that, because we might run into some users for whom this breaks renewals (because they have a misconfigured/broken proxy server configured which was previously ignored). \nMy proposal would therefor be to keep using the magic string to trigger the system proxy, but to add that magic string as the default setting in the .config file.. This has been fixed in v1.9.6.2. Which version are you using? There should be some logging to the Event Viewer. . That might message happen if you run the new version under a different account than before. \nLEWS used to store configuration data in the user profile (HKCU/AppData), but that was changed to system level locations (HKLM/ProgramData). If you run the new version of LEWS and it detects user-specific data then it will still use that, but if not then it runs as a clean install, as seems to be the case with you.. Yes you can migrate: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Migration-to-v1.9.5\nBut it's kind of worrying that it doesn't work automatically for you. Can you confirm that you changed the user that your run with, or might we be looking at a bug?. Could you post the output of letsencrypt.exe --verbose? . So the error happens only from the scheduled task and not when you run from the command line? Are you sure they are running the same executable? Which command line does your scheduled task use?. > I figured you might want the output from letsencrypt.exe --verbose --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\", however as this spawns a new console window I wasn't sure how to capture the output. I did take a screenshot of the output, but there didn't look to be much of interest.\nYou might be able to get it when you run the command prompt as administrator. I'm very curious if there is any difference in the Config folder that it chooses.. > The user account specified for the scheduled tasks is another admin account.\nAh that might explain the difference. That admin could have a configuration folder for LEWS in their user profile that triggers the program to focus on that. Can you check their %appdata% folder?. > So it looks like it's running ok - i've added the --emailaddress parameter to the task to get any failure emails\n--emailaddress only has effect when running for the first time on a server, i.e. when the Let's Encrypt 'account' still has to be created. It doesn't have any effect for subsequent runs.\n\nis there any way I can check that it is running correctly before the next expected renewal (about a month away)?\n\nYes, you can try running with --forcerenewal to check if the renewals are successful.. The general rule is that certificates are renewed for the bindings that you originally created it for, not in places where you've manually added it later. So in order to renew for all sites, you should generate it for all sites, which is possible with the option \"generate certificate for multiple IIS sites\" (and then choosing \"s\" I believe).. So what you want is to use site x for validation and then let LEWS search all bindings in IIS for matching hostnames? I think we had a similar request recently (#574). I'm not against it, but lets keep the discussion in one place :).. You can choose which store to use in the .config file, though that's a global setting which will apply to all certificates. AFIAK IIS doesn't care which store you use though.. Yes and no. Let's Encrypt does not currently support wildcard domains (e.g. *.example..com), so you have to specify each subdomain that you want to cover. The good news is that you can let the tool generate a certificate with SANs for all bindings of an IIS site (that is option 2 if you generate a new certificate).. > A: What I really should done?\nIt's was a bug in version <=1.9.3 that renewals were tried every 60 days, regardless if they were successful or not. The only way to get around it was to edit the registry or force renewal from the command line.\n\nB: Can I somehow save/schedule those certificates to client?\n\nThe scheduled task really doesn't do anything special, it basically just runs letsencrypt.exe --renew. You can manually create it or create any (dummy) certificate to let the program (re)create it, then it works for all scheduled renewals.\n\nC: \"Bug report:\" Client should schedule certificates at same time as those are saved to IIS.\n\nSee A, this was fixed in v1.9.4\n. So there are a couple of things here. \nThe code to create the scheduled task will be less likely to cause errors in the next release of LEWS. There is one particular bug (#380) that was fixed which caused problems for you too. The best way to avoid potential issues is to remove the existing scheduled task when upgrading, then it will be recreated to run as SYSTEM.\nThe fact that you didn't see any certificates which you have created points to a configuration issue. Most likely they were stored to the old user-specific location, while a later run went to look for them in system-wide location. You have a chance of finding them in your HKCU registry instead of HKLM. Make sure to complete remove all user-specific configuration data, because those locations are still default for backwards compatibility reasons.\nIn any case some of the most strict rate limits for Let's Encrypt only apply to new certificates. Renewing (i.e. recreating) has less strict rules so you should be able to do that, even if you cannot recover the registry entries.. This should become possible in the final phase of the plugin system refactoring which I'm doing (see #398). Soon there will be a beta of 1.9.7 which will provide some other options that could help, e.g. a new validation method and changes detect the certificate being bound to sites outside of the one used for validation (though the latter still requires a one-time manual intervention, it's a step forward from having to do things manually every time a renewal is needed).. So v1.9.7 is pretty far along and offers more validation options which might help you to achieve what you want to do. For instance you can let the program create a temporary application in IIS under your root just to handle validation requests.. It's possible now with v1.9.8 to install a manual hostname to a specific IIS site.. I'm not sure if that whole big warning screen is still needed, given the changes to the way bindings are created/updated, but I haven't gotten around to testing if that's true.. Yes. it's possible to detect running in unattended mode and not ask the question, but what should be the behaviour then? \nDefaulting to the 'safe' choice wouldn't help in your case, and all the bad stuff that this warning is about doesn't make me feel confident to default to unsafe choice. That's why I'd like to do some testing first. . v1.9.8 ignores IP-addresses configured on the HTTP binding when creating a new HTTPS binding, because it causes bad stuff, so no more need for this prompt. Making the binding IP-specific afterwards (manually) doesn't seem to cause issues though, so hopefully everyone will be happy now.. First of all thanks for testing the new version. I think there are four issues here.\n\nCan you check in your registry if you have keys listed under HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/? Or any similar path under HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple? It's odd that the program finds the configuration in your %appdata% folder (meaning that you've upgraded from a previous version), but doesn't seem to detect the registry entries from HKCU (which are supposed to be there). \nSecond is the strange exception from ACMESharp that it cannot decode the challenge. I'm not able to reproduce that and not even sure what it's doing in that stage of the code, but it's definitely a blocking bug.\nIt's not possible that your certificates where updated after crashing on DecodeChallenge. If the files are updated in the folder it must have happened during another run and/or with a different version of LEWS.\n\nAfter crashing at DecodeChallenge you can never make it to the part where it would setup a scheduled task, basically that's a side effect of 2.. 1. Not a problem necessarily, just suspicious and I might not fully understand your setup. Have you not created the scheduled task before (in the older version of LEWS)? If you haven't done that, then LEWS doesn't remember which certificates it has created and/or is supposed to renew. \n\n\nIt could be helpful to see what the process is doing right before the crash. I don't fully understand what this InitExtConfig is doing, but if you could use procmon to capture file activity it might help getting to the root cause. I'm also hereby giving a ping to @ebekker of ACMESharp to take a look.. It's not a problem, can you host it somewhere on Google Drive or WeTransfer for example?. Just had the same crash on a clean Windows 2016 install, though on my devbox it runs fine. I must have something left behind from an older version on my machine that prevents the crash.. Managed to trace it to an issue in ACMESharp which is triggered by the packing tool LEWS uses in it's build script. Beta2 should fix the issue.. The certificate store issue is discussed here #597 . The latest stable release (v1.9.6) will automatically update the webroot path on renewal. For older versions you can either edit the registry manually or create a 'new' certificate for the same website (assuming that the name of the website hasn't changed, this will overwrite the old scheduled renewal).. LEWS will try to renew the certificate every 60 days. The scheduled task checks if any certificates are (over)due for renewal, but if there are none, it just exits. . Yes, either creation or the last successful renewal.. I thought it was unnecessarily verbose to print that information all over the place, though I agree that it would be good to have it accessible somewhere. Would you be happy if those details were listed in the \"List renewals\" options from the main menu?. It seems like your web server is telling Let's Encrypt it's not allowed to see the response file (403). \n\n\nThis can have any number of reasons (IP restrictions, Windows authentication, file system rights, etc.). You should first confirm that with some service like http://www.webconfs.com/http-header-check.php to see if you can reproduce the 403 and then figure out the cause.. That looks like the homepage, not the answer file, so there's a small chance different settings apply in the subfolder where the answer files are stored, but my next step would be to test it on IPv6: http://ipv6-test.com/validate.php\n. So there we have the 403, which is the reason why your certificate can't be authorized. Is there any chance that the root application (Orchard?) is intercepting the request and denying access?. I changed the title to make this easier to find for other Orchard users. Good to hear that it's fixed!. The problem is that in v1.9.6 and before the default certificate store is \"WebHosting\". But failing to open that store, it silently fell back to the \"Personal\" store. \nI suppose you and others who reported this error don't have the WebHosting-store on your machines, because I guess it's only created on machines with IIS installed and/or recent versions of Windows server. \nv1.9.7-beta does not have that automatic fallback anymore, because I don't like the idea of handling an exception by moving the certificate to some other place than is specified by the .config. This takes away control from the user, but also makes it more difficult to find the certificate should we want to remove it, check it's thumbprint to figure out which bindings it's selected for, etc. \nIn short, the way to solve this issue is to change the .config file to make the default store \"Personal\". \nI will consider some options to fix this error, either by going back to the old behaviour, automatically creating a store with the specified name if it doesn't exist yet, or some other configuration mechanism to enable the fallback. . If you don't want the certificate to be installed to any store, the alternative is to use the --centralsslstore switch, which outputs .pfx files to the specified folder instead of installing to a Windows Certificate Store. AFIAK those .pfx files are not useful for Apache either, but at least it will leave the Certificate Store clean.. The first error happens when LEWS is looking for the previously issued certificate, but is not fatal. \nWhen the new certificate is saved it creates the store (if it doesn't exist yet). And of course it should be the WebHosting store, not the Wouterstore, I fixed that little oopsie with the beta4 build.\n\nBtw.\nWith 1.9.7 I see : [INFO] Cached authorization result: valid\nWhat does this mean ?\nI see that there are no new acme-challenge's and see no traffic from letsencrypt.org in my server ?\n\nIt means that your previous authorization for the domain is still valid, so it's not necessary to go through the process again, and we can skip straight to requesting the certificate. It's a little optimization that saves a little time and prevents you from running into rate limits.. Unfortunately not, though re-requesting a previously issued certificate (i.e. for the same hosts) shouldn't be hit with a rate limiting exception., as it would count as a renewal.. What makes you say the certificate is not imported? This line in the log\n\n[INFO] Installing certificate in the certificate store\n\nWhich is not followed by any exception, point to the fact that it is (both first and second times). It could be imported to the wrong Certificate Store perhaps, but it definitely looks like its being imported somewhere. Can just run with --verbose to maybe see where it's going?. It might be an aliasing problem. I think the real name of the Personal store is \"My\", you should try configuring that.. The alias problem that I theorized would be that there are two stores. The \"My\" store which shows as \"Personal\" in mmc, and a store which is actually called \"Personal\", which would be hidden by the fact that the other store already occupies that name. Your registry dump seems to confirm that theory.\n\nWas a value of \"Personal\" translated before to \"MY\", or why was it working before?`\n\nIt was working before because LEWS would hit an exception when trying to open the non-existing \"Personal\"-store, which was silently handled by falling back to the \"My\"-store. The new version handles non-existing stores differently, specifically by trying to create them - and fatally crashing when that doesn't work either.\nIn summary, you were always supposed to configure \"My\" instead of \"Personal\" in the .config file, but were lucky that the old error handling code did what you intended anyway.. I added a little change to beta 6 to auto-translate \"Personal\" to \"My\" to prevent this confusion in the future.. I think this is a duplicate of #597, let's keep the discussion in one place.. Good idea, thanks for the feedback!. This is actually a duplicate of #592 and is already fixed in beta2. Thanks for testing though :). I have a theory about what could have caused that, but I'm not able to reproduce it. Can you try beta 5 and, if it still crashes, post the full --verbose output?. This is actually a bug, the .exe is supposed to include a manifest which lets the CLR know that it needs admin privileges, but it's missing so it will let you run as a regular user. That will be fixed in the next release.. The --webroot switch is your friend. I guess you are using v1.9.6? v1.9.7 should have asked you for the path if none was provided. . This is probably because the password was not being used to open the .pfx files for examination, should be fixed in beta 6.. It would be useful to know some more details about this error. \n\nWhich version of the program?\nWhich command line parameters?\nWhich version of Windows/IIS?\nCopy of the output on the screen. I would recommend you to try the latest beta. There have been countless changes between v1.9.3 and v1.9.7, and I simply don't have time to support older versions.. Hi @qcnguyen - are you creating a new certificate or updating an existing one? I have a little theory about why creating a new one might fail on IIS 7.x.. I've managed to reproduce and fix this issue in beta 7.. It installs the chain, you should be able to find it under Intermediate Certification Authorities.. The tutorial is based on an older version of the program, probably v1.9.4 or below. I would not recommend using old versions anymore. Instead just follow the instructions on the screen, beginning with choosing \"N\" to create a new certificate.. Thanks for the contribution! Does this block execution on the main thread while the script is running, or is a call to process.WaitForExit needed?. So this is obviously a backwards compatibility issue.\n\nI've implemented a two-fold solution in beta 8.\n\nThe default, backwards compatible, FileSystem-validation will not mess around with IIS\nThe now separated IIS-validation will not just do the settings it already did, but also create a new sub-application in the site, disabling any custom modules (e.g. CMS'es) that are installed above it.. Cool, this could replace/combine the IIS and SelfHosting validation plugins. It's a pity that you branched master (v1.9.6) instead of develop (v1.9.7) because the latter is pretty close to being released, but I think it might be worth including this.\n\nWould you mind rebasing this on develop and submitting a PR? . Unfortunately it seems that you can't listen to a specific path, it has to be the whole binding, so IIS would temporarily stop receiving requests during validation. Could still be preferable over the alternative though.. The misunderstanding happens here:\n\nEnter a site path (the web root of the host for http authentication): .well-known/acme-challenge\n\nYou're supposed to enter the physical path of the web root, e.g. C:\\inetpub, C:\\httpdocs or something.\nI'll add some code checking the path to prevent exceptions and confusion for others.. You should enter the path to the root of the website, i.e. C:\\progra~1\\webapps\\ROOT\\. The rest is automatically appended.\nThe challenge file and folders are deleted immediately after validation. If you want to test it and have the opportunity to see what's happening, try running with the --test parameter.. Your IIS log shows a 500 error, though you say it works in the browser. You should figure out why it works for you but not from Let's Encrypt's point of view. It might be your CMS or other security measures. Cookies? IP-address? Authentication? User agent string? . Which version of IIS are you running?. In that case it shouldn't be a problem to have multiple certificates for different sites. Could you post the complete output of a run with the --verbose switch?. There doesn't seem to be anything wrong with that run. Very strange.\nCould you try the latest beta of version 1.9.7 to see if it also happens there?. Hi @unluckynelson, good that you found a work-around, but I'm still curious if the same issue occurs with v1.9.7, because I would like to get to the bottom of this bug. Would you mind testing it?. So just to confirm the steps:\n\nLatest version of LEWS\nCreate certificate for single binding on Site 1\nSite 1 binding/certificate fine\nCreate certificate for single binding on Site 2\nSite 2 binding/certificate fine\nSite 1 binding linked to the Site 2 certificate\n\nIs that what happened? Because I just tried those steps in a squeaky clean Windows 2012 R2 VM and I'm not able to reproduce. Anything special/exotic about your setup that you can think of? There must be some part of the puzzle missing.. These issues might have been solved by #634. Honestly I don't really much value in this feature. As you note it's possible to replace the settings by requesting a certificate for the same target with different parameters, which overwrites the previously scheduled renewal. \nThe advantage is that you can immediately see if your new settings are working and they won't be changed unless they do. Updating them without renewing delays that test until the next scheduled renewal, when you're probably not around to see it happening.. This is going to be possible with phase 3 of #398, which will allow you to chain manual input of hostname(s) to IIS site installation. The upcoming v1.9.7 release represents phase 2 of that rework.\nIn the meantime, there is a workaround with v1.9.7. \n\nCreate a separate website with port 80 binding(s) for the domain(s) your OWA is accessible from.\nOptional: redirect the root of the separate site to https:// for your users\nUse LEWS to generate a certificate for the separate site\nDelete the generated https binding(s) from the separate site (as they take priority over your default site)\nLink the generated certificate to the https bindings of your default site\n\nLEWS should then be able to detect and renew the certificate on the default website. . No, though after those steps the renewal should be able to run automatically. You just have to keep that separate site up and running.. This is a duplicate of #349 also, so I'll close it for the overview.. >  I guess this one is also communicating over port 80?\nCorrect.\n\nI noticed that the os task for renewing the cert is timed daily? I thought best practice would be 60 days later? Did I miss something?\n\nThe task just checks for scheduled renewals every day, because different certificates might be at different points in their lifetime. Each certificate is only renewed every 60 days. Since you're planning to automate it yourself (with firewall changes and SSTP), you might just want to opt out of the scheduled task altogether.\n\nIt's interesting because I want to use the cert also for sstp (Windows 2016), and as I am informed, there is a possibility to export an import the cert to the AD PKI via powershell - are there also known best practices for that?\n\nI'll leave this to the experts, but it should be pretty easy to get the certificate from either the certificate store or the folder that's created under %ProgramData%.. - Delete the .exe and everything in the folder with it\n- Delete the configuration folder from %programdata% (or %appdata% for older versions)\n- Delete the scheduled task from the Windows Task Scheduler\n- Delete the registry keys under HKLM/Software (or HKCU/Software for older versions) \nThen there's nothing left!. It's a obviously a good idea to keep the Wiki up to date and add some kind of FAQ based on previous issues. When I get v1.9.7 out of the door I'll take some time to go through the pages and update them.\nAnyone is free to help out though :) \nThis answer has been added a as page:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Uninstall-instructions. I had similar experiences myself with v1.9.4. I'd recommend upgrading to v1.9.6 and following the steps in https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Migration-to-v1.9.5. It's not intentional. Apparently GitHub changes the url for downloads based on latest tag that's given to the release. The tags are useful for people digging through the source code to see what's changed between releases. \nOne solution could be to create new GitHub post for every beta/point release instead of updating the post about the minor release. That would lead to a more fragmented release notes section though, especially if there is a point release for an older minor while the next one is already in beta. \nAnother solution would be to mirror the binaries at another location.. I've decided to create separate releases from now on, so you will be able to bookmark/permalink the version you want.. This was a bug in the first beta of 1.9.7, please try again with the final release.. Yes, the OpenSSL libraries are not needed any more because everything is done with BouncyCastle now. \nACMESharp was included separately for a while during the beta because of a bug (https://github.com/ebekker/ACMESharp/pull/302), but that one has since been fixed - so it could be re-integrated into the main executable.. That's still possible, check out: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Settings. Yes that's a documentation bug, I've updated the page.. Yes it should. FileSystem validation is available for all targets. It's described in the menu as \"Save file on local (network) path\".. The --san switch was already dropped in v1.9.6 as I didn't feel this function should be hidden.\nIn your case you can use the manual plugin and enter a comma-separated list of subdomains.. See also #391 . This scenario is something on the roadmap for v1.9.8. For now it's only possible with a workaround, described here #612 . No, if you're using FileSystem (or any other HTTP validation method) you have to keep the port 80 binding there, otherwise it won't be able to renew. You can use DNS or TLS validation if you don't want to keep 80 available.. It's possible now with v1.9.8 to install a manual hostname to the default IIS site.. --plugin iisbinding --siteid 1 indicates that you want to create a certificate based on an existing IIS binding, but there is likely just a default/empty binding. Removing those two params will probably get you further.. This is a bug, environment variables should be expanded during the path validation. You should be able to work around it by going to IIS and changing the basic settings of the website(s) that use the %systemdrive%... path and changing them to C:... (or whichever drive %systemdrive% resolves to).\nI'll make sure to fix it in a future update though.. Check out the brand new Wiki page about validation issues: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Validation-issues. You're welcome!\n\nI have not managed to get the \"create a temporary application\" working, and honestly not sure what I should do to test that for you. if there is any info on that, please let me know\n\nYou could try running in --test mode. As the program stops to give you the chance to try the answer file in the browser, you might be able to diagnose what's causing the IIS mode to fail. What it's supposed to do is create a temporary application in IIS under the /.well-known/ path of the website with all the right settings pre-configured.\n\nMay I ask what does Self host verification files' actually do? It has worked for me ab out 8 times today but once or twice it fails and after that, I do an IISRESET and then it works next time I try it.\n\nIt uses a HttpListener to receive the validation requests. AFAIK, this is implemented using some kernel-level trickery to allow port sharing with IIS.. Hi @markbreen, just wondering if you have you been able to figure out the configuration problem with IIS mode? . There have been some improvements to the IIS plugin which probably fix this issue, but I'd really recommend any IIS config to use SelfHosting, because it's just beautifully simple.. From\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/blob/master/letsencrypt-win-simple/Clients/ScriptClient.cs\n_log.Information(true, \"Script {script} starting with parameters {parameters}...\", script, parametersFormat);\nAs you can see, the ... is hard coded into the log message and doesn't mean that anything gets truncated. There must be some other reason why the DNS validation is not working. . It should be pretty easy to add this feature to v1.9.8 with it's InstallationPlugins. However I don't personally have a RD Gateway server to test with, nor any experience with setting something like that up. So it depends if anyone would be willing to contribute code for that.\nIn any case even with the current release it should be possible to do it with PowerShell script.. @LBegnaud that would be a great idea. We can start by including them in the Git and creating Wiki pages explaining what they do. Later we can add code to the program that enumerates them and offers them as options when setting up a renewal.. Parameters passed are:\n\nhostname\npfx password\npfx filename\ncertificate store name\ncertificate friendly name\ncertificate thumbprint\n\nThese are passed through a string.format, so you can do things like --hostname {0} to get --hostname example.com . Just closed some other issues to keep the discussion in one place, please check out those threads too because they contain useful scripts.. Yes, I've set that up for you. You can remove the test.txt. The ScriptClient writes stdout to the screen and stderr to the Event Viewer. It could be changed so that stdout goes the Event Viewer as well but I try not to be too chatty in that channel. Perhaps if people ask for it we could add a config switch.. Good idea and good compromise (if there is no limit on the size of an event viewer message?). The new logging idea has been implemented in v1.9.8. Wow, there is much in this issue/rant that I just decided to start responding from the top...\n\nGotta say, I was really impressed with the new features and improvements. \nBut dear god has it made it difficult to run the system unattended.\nIt likes to prompt for user input on everything and doesn't necessarily have a way to bypass that.\n[EROR] Create certificate [IIS] xyz.net - PHP (SiteId 7) [3 bindings - xyz.net, ... @ \nD:\\inetpub\\wwwroot\\xyz.net\\www] failed: Exception of type \n'LetsEncrypt.ACME.Simple.AuthorizationFailedException' was thrown.\nWell that happens because it's trying to CREATE iis bindings for a site which has multiple sub domains.\n\nActually that exception is thrown during the validation stage, well before the program could be creating bindings. There is not even a certificate yet when this occurs.\n\nI don't want you to CREATE iis bindings for me for domains which I didn't tell your system to operate on. The new system requires a site id, and then operates against that WHOLE \"site\". So does that mean all bindings, even if they are redirect bindings, have to have an SSL counterpart?\n\nThat's one mode of operation, but it's far from the only one. Check out various target plugins and specifically also the --excludebindings switch.\n\nSeems ridiculous, since if you want to forward someone from not https to https, you need a binding on the non https domain/ip. Which may or may not match the final destination domain. So that sucks. I feel like a certificate generation tool shouldn't be trying to manage IIS for me. IIS is fine. The bindings are fine. Just give me the certificate. sheesh.\n\nYou can generate a certificate completely manually without touching IIS at all. The problem is that if you are deploying to IIS, the bindings have to be modified after the certificate is renewed, otherwise they won't work anymore. Manual intervention every 60 days is the last thing you want. In version v1.9.7 the IIS code has been changed to also update bindings outside of its target site, so all of this becomes a one-time inconvenience. You generate the certificates the first time, change/move the bindings to other sites as you please, and renewal will just work. v1.9.8 should provide even better tools, \n\nSecondly, what in tarnation is this...\nWarning creating HTTPS Binding for www.mysite.com. The HTTP binding is IP specific; the app can create it. However, if you have other HTTPS sites they will all get an invalid certificate error until you manually edit one of their HTTPS bindings. You need to edit the binding, turn off SNI, click OK, edit it again, enable SNI and click OK. That should fix the error. Otherwise, manually create the HTTPS binding and rerun the application. You can see https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/HTTPS-Binding-With-Specific-IP for more information. Press Y to acknowledge this and continue. Press any other key to stop installing the certificate\n\nSee issue #591\n\nFunny because there IS NOT a www. binding in IIS, yet your system is trying to CREATE that binding.\nI don't understand why is it magically creating a www binding when the website in IIS does NOT have a non-ssl or an ssl www. prefix binding?\nSo I'm supposed to go into DNS for all of my websites that don't have a [www] prefix, and add it so that it routes properly to machine IP, entirely so that your system can run duplicate certificate generation on a site which need not have the binding in the first place?\n\nThere is no way that it just invents a www-binding out of nowhere. You can easily confirm that by looking at the code. The fact that a www-binding showed up in your target, was successfully validated against Let's Encrypt and that it detected an IP linked to a http-binding during installation all points to that binding just being there.\n\nAnd that's totally aside the error message which seems pretty bogus to me. Perhaps that's a real solution to some kind of strange real underlying IIS issue with the SNI checkbox? No seriously, what?\nAnd then furthermore go through IIS sites and uncheck and recheck a checkbox? What ?\n\nYes, it also seems pretty bogus to me. It's been on my list to test and perhaps remove that code, but I haven't gotten around to it yet. It's low priority because I don't really see the reason to use IP-specific bindings anymore with IIS8+.. You're welcome. I actually started contributing to this project because of my own frustrations with it, so I understand your feelings very well ;).. That's pretty shocking. I can't immediately imagine what could cause it, but I should do some performance testing with large amounts of bindings.. Actually a copy of your applicationHost.config would be useful as a test data set, because I'm not really looking forward to generating 1000+ bindings manually and I'm not aware of any existing scripts that generate them. I could write one, but it would take some time.. I justed tested with 3000 bindings on Windows 10 and Server 2012 R2 and didn't experience any noticeable slowdown on startup, nor when enumerating the targets.\nWhat might be the issue is the download of the public suffix list. That's just a ~200kb file but if that service is experiencing issues routing to Australia it could be what's slowing you down. You can test here: https://publicsuffix.org/list/public_suffix_list.dat\nI'll make sure that it's only downloaded when needed.. If I simulate 1000 renewals on a system with 3000 bindings I can reproduce the same effect as you have.. Could you test the new v1.9.7.1 release? I moved the target refresh logic to a different place (i.e. not during startup) so that should help a lot.. That error is about a pfx file password. Are you sure there is no password set on any of the .pfx files in the CCS and that no password is set in letsencrypt.exe.config either?. > I assume letsencrypt places the certificates in %PROGRAMDATA% then converts those to a PFX in the directory I specify, but only encrypts them if a password is specified in letsencrypt.exe.config\nTrue.\n\nI used powershell to import the certificates into exchange because EMC would not allow importing certificates with blank passwords.\n\nAny chance that Powershell script overwrites the original .pfx created by LEWS?\nIf you are using the --centralsslstore switch to get .pfx files in a specific location, but not actually to use as a Central Certificate Store in IIS, and if you don't need the old .pfx'es anymore because they are already imported, then a workaround would be to delete them.\nAnyway this error happens while looking for the old certificate because that old thumbprint might be useful during installation, but it shouldn't be a fatal error, so I'm going to mark this as a bug.\n. I believe that's #626 popping it's head up. I just published v1.9.7.1 which address both your original issue and that one.. > The pfx files are placed in a directory of my choosing, but they did not update in the certificate store. \nIt's an or/or thing, either you publish to the CCS (Central Certificate Store) or to a Certificate Store. If you want the certificate in the Certificate Store, but also need access to the PFX, you can find it in the CertificatePath (https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Settings)\n\n(Note I had removed the old pfx files, but I assume the operating system does not directly refer to those certificates anymore once they are imported into the certificate store?)\n\nThat's true.\n\nI then has to use the Import-ExchangeCertificate -Server to import them into exchange 2010, then assign the correct services to the certificate. How much of this part of the process is meant to be automated?\n\nThe program currently has no support for managing Exchange, though there is some initiative right now to start creating a library of powershell scripts which can be used post-renewal (#629) it would be great to have a standard script for (different versions of) Exchange. . That's expected, the program doesn't try to change firewall settings.\nI added a note to https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Validation-issues about it, thanks for bringing it up.. I've read similar reports many times over, though it never seems to be consistently reproducible for anyone. Also see #94 which I designated as the issue to collect these stories. \nYou should be able to see in the Event Viewer whether a renewal happened between the working state and the broken state. Could provide some interesting clues perhaps.\nMy theory is that the Microsoft.Web.Administration assembly which is used to manage IIS is simply a bit buggy. For v1.9.8 I'm bumping the system requirements up to .NET 4.6 so that we can upgrade from version 7.0 to version 11.0. I hope that's going to improve reliability.. Thanks for this insight!\nUnfortunately I don't think the proposed solution is bullet proof either. The subject name can actually change between renewals (due to the refresh feature), and there can be multiple certificates with the same subject name (but different SAN's). \nI could add some kind of separator character between the fixed part of the friendly name and the date, or some kind of unique id to the renewal and tag it as an extension to the certificate, but all of those require at least one renewal to happen before they become effective. By that time, the thumbprint should also be available from the history, and I think that is still the most solid way of identifying the previous certificate anyway.\nI'm going to change the code to simply not match anything unless the thumbprint can be found.. This change was released into v1.9.7.2, thanks for thinking along!. I've noticed it myself too. The build numbers are auto-generated by Visual Studio based on the time of day the build is done. There is supposed to be a revision number in front of that, but that's fixed to \"7\" in this case, which is why it doesn't make sense. \nI think I'm going to switch to the 197.3.[build].[revision] / 198.0.[build].[revision] format.. This can be closed imo, thanks!. Great contribution! I'm sure this is going to make a lot of people happy. \nMerging with this branch is not a problem, I merge master to install (v1.9.8) regularly anyway.\nv1.9.8 is going to make it a bit more easy for Exchange, because it will enable you to run a script before or after updating IIS bindings (now it's either one or the other, while you need both as far as I understand). \nAlso it will allow you to choose a certificate store for a specific certificate, instead of just having one global setting.  That might allow the scripts to become a bit simpler than they are. \nBut I see no reason not to merge it into v1.9.7, as there is not any risk.\n. That would be helpful, yes!\nOn Mon, Nov 13, 2017, 15:38 LBegnaud notifications@github.com wrote:\n\nDo you want me to update the wording in the wiki \"install script\" page?\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/637#issuecomment-343938305,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AKilXPqdNq3SvTyBGzuP8gruUGnz_QeRks5s2FR9gaJpZM4QaGYo\n.\n. The --san switch has been removed in v1.9.6. SAN certificates are generated by choosing a target plugin which generates them, either from the menu or from the command line: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Target-Plugins. Do both of them have .NET Framework 4.5 installed?. I'm unfamiliar with SolidCP, but it sounds like your TLS settings are FUBAR. I wouldn't be able to tell you if it's at the cipher suite or protocol level, but that error message means that the TLS negotiations with the Let's Encrypt API break down.. Thanks for posting your findings! Perhaps something to create a Wiki page for? Since there not really anything to do with this issue anymore, I'm closing it now.. For #629 @LBegnaud created a .bat file to launch Powershell, because yes it seems like it's not possible to launch Powershell scripts directly as a processes.. Seems like this is a bug in the command line parser.\nletsencrypt.exe --plugin iissite --siteid 1 --validation script --validationmode dns-01 --dnscreatescript C:\\script\\letsencrypt\\add_dns.ps1 --dnsdeletescript C:\\script\\letsencrypt\\remove_dns.ps1\n\nThe bold part is being interpreted as if it were  --script validationmode \nOnly if you put --validation script at the very end of the command line it works as intended.. In 1.9.8 this plugins canonical name will be dnsscript to work around this bug. script will continue to work as an alias for b/w compat.. Which version(s) of Visual Studio, if any, do you have installed? I don't think msbuild is bundled by default.. Yes that would be possible, but I think there should be a better solution. We should recognise that the target site (where hostnames come from) the validation site (which handles the :80 requests) and the installation site (where new bindings are created) can all be different. That would help other users with more exotic setups as well.. It's all possible now with v1.9.8 :). I see two ways for you to solve it.\n\n\nUse self-hosting validation as you don't have to care about webroots at all that way.\n\n\nUse the --installationsiteid parameter to tell the program to create new bindings in another website than the target (the target would be the catch-all or manual input). The WebRootPath will keep changing, but our focus should not be on that,\nbecause the solution is rather to forget about it (1) or make sure that it\nworks with the real one set (2).\n\n\n1) Set up your certificates up with SelfHosting validation, because then\nthe WebRootPath is not needed at all. You have to recreate your\ncertificates with advanced settings, choose target manual, validation self\nhosting and then install to IIS. To be clear this means you have to replace\nthe existing renewals 1 by 1.\n2) Not going to explain in more detail due to time. It's less elegant\nanyway and it's not faster to implement.\nOn Tue, Feb 27, 2018, 23:48 Martijn085 notifications@github.com wrote:\n\nI`m still figuring it out... but it not seems possible to renew without\nchange the webrootpath? Just like in the old versions?\nI can make a batch file with this cmd line and run it every 60 days or so,\nbut that is not what i`m looking for.\nletsencrypt.exe --plugin iissite --siteid 2\nIs it possible to add a option in the setting.config file like:\nfalse\nMy setup in IIS:\n1 \"Default Web Site\" with a binding on port 80 with a catch all (*)\n14 websites with only a binding on port 443\nAll this 14 websites have diverent folders on a data partition. This\nfolders are not open for port 80 to renewal. That would be the \"Default Web\nSite\" folder. So all websites must renew by this website.\nThis is my Renewals value in the registry (1 example):\n{\"Date\":\"2018-04-01T22:18:24.151153Z\",\"Binding\":{\"Host\":\"ssub.domain.nl\n\",\"WebRootPath\":\"%SystemDrive%\\inetpub\\wwwroot\",\"SiteId\":7,\"AlternativeNames\":[],\"PluginName\":\"IIS\",\"Plugin\":{\"Name\":\"IIS\"}},\"CentralSsl\":null,\"San\":\"false\",\"KeepExisting\":\"False\",\"Script\":null,\"ScriptParameters\":null,\"Warmup\":false}\nThe point is that i do not want to change this WebRootPath so the renewal\nalways use the Default Web Site.\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/PKISharp/win-acme/issues/642#issuecomment-369055126,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AKilXILxbbUZXe9IxXsdmAw3H-s2ZdKHks5tZIY7gaJpZM4QexBo\n.\n. I'm puzzled by this issue and am unable to reproduce it.  \n\nLEWS doesn't use a web.config to remove modules; it instructs the IIS Manager to make those changes, which in turn updates the applicationHost.config. Even if it chose to use a web.config (which it might if the modules section is unlocked), that should  be in the /.well-known/ path already, because it doesn't tell IIS Manager to do anything with the /acme-challenge/ part.\nIs there any chance that you made your own module changes to the web_config.xml in the program directory? Because the whole point of IIS validation is that you shouldn't have to do that.. I see what you mean now. Actually LEWS anticipates that inherited modules can be a problem and removes them for you when you use IIS validation. This is done via IIS Manager / applicationHost.config. So it shouldn't be necessary to add those lines at all. . And for #646 we are going to handle everything at the /acme-challenge/ level, so it becomes possible again to make those changes. Even though they would still not be necessary in IIS mode, they could be useful for filesystem mode.. Odd, because it's supposed to remove any non-global handler present in the /.well-known/ application (which inherits from the root application). \nIs there anything special going on with virtual directories or something?\nAny chance AventoMvc.Core is installed as a global handler instead of in the root application?\nCan you show the relevant part of your applicationHost.config where LEWS created the config for the /acme-challenge/ application?. Many improvements made since, but recommended way to go is SelfHosting.. Good catch :). Can you post the output of letsencrypt.exe --renew --verbose ?. If the older version is working well for you, you don't have to upgrade. But when you run into problems please try the latest version first before reporting them, because they might already be fixed.. I had no idea /.well-known/ was also used for OpenID. The next release of LEWS will scope the application to the acme-challenge path only.. I guess the FileLoadException is a case of non-proper re-use of the IISClient object, where one instance made changes while the other was not refreshed. This shouldn't be possible anymore in 1.9.8 due to the DI framework.. How's 1.9.8.0-beta? . Should be fixed in the next beta, validation plugin choices were indeed not respected in unattended mode.. Yes but that's expected behavior, the --plugin parameter is the main trigger for unattended mode.. It would be useful if you could get the log output. Try running from an elevated command prompt and using the --test --verbose parameters.. Yes indeed, can you post its full content?. Try \n<setting name=\"CertificatePath\" serializeAs=\"String\">\n        <value>E:\\certs</value>\n      </setting>\ninstead of \n<setting name=\"CertificatePath\" serializeAs=\"String\">\n        <value>\"E:/certs\"<value/>\n      </setting>\n. I recommend you use an XML validator such as https://codebeautify.org/xmlvalidator to help you create a valid config file. The mistake is that you replaced <value/>, which is a self-closing tag, for <value>something<value/>. That way, you're opening but not closing the <value> tag, making the whole document invalid. The correct way to close a tag is by using </value>. First one: \"JWS has invalid anti-replay nonce\" - this happens when you spend too much time in the main menu. There seems to be some kind of timeout period where the client is supposed to refresh the nonce but doesn't. I believe this is fixed in 1.9.8.\nSecond one: \"ACME server reported detail Connection reset by peer\" - seems like Let's Encrypt is unable to set up a TLS connection with your web server. This might be due to TLS protocol/cipher settings. Maybe #639 provides some hint?\nThird one: I'd be very interested to know what causes the 403 exception. Can you use --test mode to freeze the process at the validation stage and figure out what should be different in IIS (in terms of modules, security, etc.) so that we can improve this?. Can you try the IIS mode in beta4?. Nothing like that is possible now, but I like the idea because Let's Encrypt is all about automation.\nTo do this properly would require supporting all target plugins though. I would guess the way to go is to support all command line arguments that you would use to choose the target when generating a certificate in unattended mode, plus one new --cancel / --delete / --remove switch to trigger the removal.. Check out https://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.9.8.0-beta4\nOne caveat of the current simple implementation is that the website must still exist when you trigger the cancellation, as renewal is identified by its name. That is legacy from way back when, but must be respected until 2.0.. If you're manually generating then you can also remove them from the command line. I was talking about the scenario where you would generate certs based on --siteid x, you wouldn't be able to cancel it when Site X doesn't exist in IIS anymore.. --plugin manual --manualhost www.domain.com --cancel should do the trick. I don't see how this could be implemented. Their API just seems to be useful to update the \"IP\" (meaning the A record, I suppose). I see no way to add or remove the TXT records needed for ACME DNS-validation. . Luckily, browsers without SNI capabilities are going extinct pretty rapidly (we're talking Windows XP / Android 2.3 stuff here), but for those unfortunate enough to have to support that, I think we can put in some effort. \nYou make a fair point that SNI is not a requirement for the certificate at all, so I've made some changes to set the flag only when creating a new binding (where it's the safe thing to do) or when it's explicitly requested (e.g. for TLS-SNI validation). Otherwise it respects the existing state.. Are you sure you're on the latest beta? Can you post the exact build number? I'm asking because this looks very much like the build script issue that I fixed in beta 2.. I recently fixed how builds numbers are generated, so now every release at least has a unique, ever incrementing, version number.\nbeta 2 reports 198.0.6537.31259\nbeta 3 reports 198.0.6544.34162\nbeta 4 reports 198.0.6545.42419\nBasically the first part represents the main version \"1.9.8.0\" and the second part is a timestamp of sorts (as provided by MSBuild when you let it generate build numbers).\nI'm not quite happy with this yet, as it doesn't scale nicely go to 1.10.0 or 1.9.10, and it also differs from the versions as communicated in the releases, milestones, etc. but at least it allows me to uniquely identify which exact release someone is using from seeing the log.\nWhile I'm generally a fan of semver, I've considered going \"Chrome\" on this and just have a (bi)monthly update cycle where every month is just +1. E.g. version 199, version 200, version 201, etc. since there is close to no support on older releases anyway.. Yes, somehow AssemblyInfo.cs went completely empty, but it's been restored in the latest beta.. Are you using HKCU (e.g. upgraded from 1.9.4 or below) or under HKLM? It's my understanding that HKLM will take more abuse than HKCU. . No problem!. There are at least two other AV's which generate a hit, though the vast majority doesn't find anything. Maybe one of the new assembly references is causing a false positive.\nhttps://www.virustotal.com/#/file/cfebc9703ab5267c0e879880b1f5357933548647076279525135e4aa670291c0/detection. I'm closing this one in favor of #668 . Definitely a bug that needs fixing.. Should be better in the latest beta's, I just noticed that I forgot to respond or link the commit to the issue.. The message [EROR] Script error: null is generated by the programs handling of the strerr output of the launched process. That bit of code checks for null values but not for the literal string \"null\" which is apparently output in this case. Or it might be some non-CLR null-object. \nUnattended operation with dns-01 still not working 100%.\nI get a prompt asking if I want to save the certificate (which I of course do).\nI have found no command line switch to eliminate that prompt.\nThat's a side effect of --test mode as you already suspected. I think we really need a separate --silent switch or something in a future release, but since I'm very much in bug fix mode now I don't want to risk introducing new issues.\nThe error on valid is a stupid bug also noted in #684 and will be fixed soon. \nIs your DNS validation otherwise working ok? . > It stepped through all the subdomains, looked like it was all good... then crashed at the end with a gripe about illegal characters in path.\nWould be interesting to see the log from that error (and the list of domains that you issued for).\n\nError 429, too many certificates already issued for this exact set of domains. Renewal failed. WTF? I wouldn't have thought that failures would count as actual issues!\n\nThe next release will prevent these kinds of situations by not issuing a new certificate if the previously issued one is less than 24 hours old, though that doesn't help you now. \nWith Central SSL the trick is make a copy the .pfx file for each domain that you want IIS to use it for. For example if you issued a certificate for a.com, b.com and c.om, you should make three copies of it named a.com.pfx, b.com.pfx and c.com.pfx. That's all LEWS does when copying over to the CSS.\nAnother workaround that you could try is to issue individual certificates for the domains, to circumvent the \"exact set of domains\"  criterium of the rate limit.. I managed to reproduce and fix this bug, it will be solved in the next beta, which should be ready this weekend.. AFIAK AppVeyor doesn't even check the Powershell. The builds are failing because I've switched to C# 7 and AppVeyor runs with an older compiler. Maybe @Lone-Coder can fix that, I think I don't have access.. This is a duplicate of #661. I have no idea why some AV's are flagging the recent builds, though they are not signature matches but heuristic matches as far as I can tell. The main difference between 1.9.7 and 1.9.8 is the inclusion of .NET Core assemblies and the new version of the Fody Weaver which packs all .dll's into a single .exe. . This is the latest build: https://www.virustotal.com/#/file/d4a6bafccf22fc0126e1c97daac563ca4f7cc21841702024445db622fe0fd4de/detection\nMostly clean except a notable hit from MalwareBytes, though that also seems to be a heuristic based on registry keys accessed.\nWould be nice if someone could build it themselves and see if they get the same result, to rule out the off chance that my machine got infected by something that injects bad stuff at compile time.. Can you upload your build to https://www.virustotal.com/ and share the link?. You mean #674 about Windows Defender triggering about \"Fuerboos.A!cl\". The first four hits on Google about that are other Github projects which got tagged by defender. It's a heuristics based match according to https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:Win32/Fuerboos.A!cl\nI guess it is pretty suspicious from an AV's point of view to have a relatively unknown executable which messes around with certificate stores, HKLM registry keys and the task scheduler. \nMaybe it would help to sign the code but I don't want to be personally responsible for the build process. Perhaps something is possible with AppVeyor, but only @Lone-Coder has access there I think.. I've just noticed that recent builds are missing their AssemblyInfo, which might be another trigger for AV. Maybe that will fix some issues.. Thanks @skfd for figuring out how to do that, I'll do it for the next releases as well. . What you want there is <value>My</value> though <value>Personal</value> should also work.. That's would be nice, since a lot has changed since 1.9.3. Let me know if you have some questions, though the Wiki should hopefully cover most of them.. I don't think it's your fault, it was the result of the Dispose method being called more than once, which is apparently a thing that happens in .NET. . That's a nice contribution, I hope @LBegnaud can take a look at it, though as I understand he also doesn't have an Exchange lab to test with (neither do I). It would be great if you could test the modified version and report back.. We can't do that because the <handlers> section is locked by default and therefore adding those lines would cause errors for some users. There are many problems with FileSystem validation so it's basically a legacy mode nowadays. I would advise anyone to use SelfHosting mode or TLS-SNI validation, or if that doesn't work IIS mode. Both of them fix the handlers problem and many others.. ^ what he said ;). Ping to #668 in that case!. My advice would be to start from the beginning if you got an error, because chances are that the details of the renewal are incorrect or lost when an exception occurs. Manually creating the scheduled task (or through some new menu option) is not that hard, but chances of successful renewal would be much lower than with a full clean run.\nThe latest beta doesn't actually re-issue the certificate if it's less than 24 hours old, so there is no more risk of running into rate limits as with previous releases. If the exception you get is reproducible then please post it here, so we can fix it!. It's not really documented as of yet, what kind of information would you like to see about it? . It's mentioned on the basic usage page: https://github.com/PKISharp/win-acme/wiki/Basic-usage. Can't make it red because the logging framework decides the colors, but can change the level nfo to an Error or at least a Warning . It sounds like there might be a problem in your build with Fody, which adds assemblies as embedded resources to the .exe. It was pretty annoying to get it to work with the new .NET Standard stuff on my machine and I'm not even really sure what finally fixed it, so I'm afraid I can't offer much help, other than suggest you look at the detailed build output to see what Fody is doing.\nDepending on what you're planning to do with the build / your branch, you might consider to remove Fody altogether (I don't see the point of it myself, but it's been in the project since the beginning I believe).\n. #680 reports issues with .NET 4.6.1 as well, can you try installing .NET 4.7 and see if that helps?. Seems to be this issue: https://github.com/dotnet/sdk/issues/1405. I checked in some changes to the .csproj file that might help. It seems to have lowered the number of warning during the build, so hopefully at least one of you will have more luck like this?. I noticed that the .exe got a lot bigger after a change in the build script, which might mean that you will have different (hopefully better) results too. Would anyone mind to try?. Seems like Microsoft has no intention of fixing this unless we'd target the future 4.7.2 framework, because it would be potentially breaking: https://github.com/Microsoft/msbuild/issues/2481\n@dermase: does it make a difference if you use the build script or a debug run from VS?. There have been some updates to the .NET Standard assemblies in the latest release, might help for some people.. Won't be fixed anymore in 1.9.x, please report back if anyone has similar issues with 2.x.. Procmon wouldn't be able to see the SelfHosting plugin at work because it all happens in-memory, nothing is written to the file system. The latest beta (7) has some fixes and adds more logging for SelfHosting to make it more robust, because I also ran into some issues on my production systems. Please try it and post the --verbose log if it still doesn't work for you. . See #683, self-hosting doesn't seem to work with Apache because it won't share the port as IIS can. I would have expected an exception to be thrown during the creation of the HttpListener due to that but apparently it's not. Maybe there's another way to detect if the port is in use but not shareable.. Your best bet would be to use FileSystem validation or DNS validation with Apache, by the way.. This is by design, to prevent you from running into Let's Encrypt rate limits while experimenting with the program. In the past some people have gotten very much stuck by having broken bindings etc. and not being able to recover because the same certificate has been requested more than a couple of times in a row already.\nIf you really want to have a new certificate within 24 hrs of the last issue, you can delete the .pfx file from the CertificatePath. . I'm not able to reproduce or diagnose this issue, but I've added some more error handling code so I hope that if you try the next beta, we can at least figure out what the problem is.. Interesting, thanks for figuring that out.. Would still be good to see the log from the latest build on the system that's not working for you. I just tried on a Windows 2008 VM with  .NET 4.6.1 and I'm not running into this issue.. Please post in #677 if you can still get the log, I suspect these issues are very much related.. I'm a bit puzzled by this description. The \"S\" option (Renew specific) requires you to enter the ID for a renewal, not a SiteId, If they are the same number that's purely a coincidence.\nCan you confirm that there is a site in IIS with ID 17 and that it was running (e.g. not stopped) at the time of this renewal?. Can you think of any reason why the site IDs could get mixed up? \nDid you change site names / host names / servers between creating and renewing the certificates? \nIs there a site 24 and if so what does it look like?\nCan you show the --verbose output?. Thanks for the pastebin, I don't see anything to explain this issue though.\n\nSo the config in the Renewals registry key is from that version.\n\nThat should not be a problem and I'd consider it a bug if that was the reason. Do you by any chance have a backup of the registry entry from before the upgrade? \nIt's just very odd for me that it came up with the wrong SiteId, especially when no such site exists at all. That it changed from 17 to 24 makes it even weirder. Does it increase every time you run it? . I just tried creating a renewal with 1.9.1 and renewing it with 1.9.8 but it went without problems. Also I checked the source code and there are literally no places where the SiteId is set, as it's currently an obsolete property which is just read for upgrading users. \nIn your pastebin it shows that the SideId is 24, so unless there is a bug in Newtonsoft.Json someone or something has manipulated the registry and/or IIS outside of this (version of the) programs control causing the IDs to change. . The best way is to re-create the certificates. Creating a 'new' certificate for an existing target overwrites all of its existing properties. To keep track of which ones you still have to do, you could delete (cancel) the current bunch. I'd also recommend to follow this guide: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Migration-to-v1.9.5. I think this issue mostly stems from a misunderstanding of the --centralsslstore switch (and actually almost every other switch provided). They apply to certificates newly created during the run, but don't alter the settings for existing scheduled renewals. \nIf you're looking to alter the settings for existing renewals, your options are to re-create them (through the \"GUI\" or the command line) or to edit the registry manually.\nWhat happened to your bindings though should not have. I suspect it might have something to do with the use of a cached certificate, which was a new addition to the code recently that I've discovered some bugs in. The next release will be a lot more robust in this scenario.. Suggestions are always welcome, but I don't think this one is a good idea. It would break peoples existing workflows and be inconsistent unless half of the other parameters are also renamed to include \"create\" in their names. I did a minor update of the Wiki though, to clarify that those parameters are for \"unattended creation of new certificates\" instead of \"unattended use\". . Good catch. I guess the \"magic\" port sharing requires at least some support from the program that the port is being shared with. E.g. works with IIS but not with Apache and possibly other web servers. \nThis kind of sucks because I hoped that SelfHosting could be the new default, but this means it actually can't because of backwards compatibility.\nI'll add some error handling around the construction of the SelfHosting plugin.\n. Apparently no exception is thrown (#678). Just tested with xampp myself and I do get nice big red exceptions when trying to use SelfHosting with the Apache service running.\nGood resources @LBegnaud, it seems like any HTTP server that wants to be a good citizen in a Windows environment can and should use those API's rather than exclusively opening a socket, but I can understand that Apache doesn't want too much Microsoft-specific code in their project, since it's not exactly their main target platform.. The simplest kind of logic bug. Big d'oh from my side, thanks for reporting it!. I've added some more error handling and better checks around the use of cached certificates, that should hopefully fix this error. There is a new binary in the latest release. https://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.9.8.0-beta8. This is actually expected behaviour now when a cached certificate is used (and also already found in the store). Why re-import something that's already there? The installation plugins should still run though, and it seems like they do.. There are a couple of steps to getting a certificate once validation is complete:\n\nCheck if a .pfx file already exists in the CertificatePath. If it exists and is less than 24 hours old, then it's used to avoid rate limits. Otherwise a new certificate is requested from Let's Encrypt.\nCheck if the certificate already exists in the target store. If it doesn't, import it.\nRun installation plugins.\n\nIn your case the certificate exists in the CertificatePath, in the target store and there are no installation steps, so LEWS basically does nothing (until the 24 hours pass, then you would get a new certificate which would be valid 1 more day into the future), \nSo you can either change the CertificatePath to a location that Apache can access, or configure an installation step to copy the files you need over to where they're needed.. Ok, thanks for using LEWS!. There are not really any required steps, it all depends on what you want to do with the certificates. If you'd like to contribute, please feel free to add a page with instructions on how to set up LEWS with Apache, because I wouldn't know how to do that exactly myself. I'd also be happy to include a sample .bat / .ps1 script for Apache users in a future release.\nThe --forcerenewal switch is a fair point, I've updated some code to make that bypass the cache (with a clear warning about the possibility of hitting a rate limit.. https://support.dnsimple.com/articles/caa-record/ is a good starting point on how to configure CAA, it should look something like this: 0 issue \"letsencrypt.org\". No, the .well-known path is specified by the ACME standard. There are many different solutions to your problem, but the one I'd really recommend it to use SelfHosting-validation as it completely bypasses IIS and all it's configuration issues.. You can change the template for the web.config in the program directory, but you'll find that IIS in it's default configuration won't let you remove modules for a sub folder that way. What you have to do then is create a separate application under your root. While you're at it, you also have to take care of UrlRewrite, Authentication, etc. etc. It's a lot of hassle and that's why it's simply not the recommend way to validate anymore.. Nice catch. There'll be a fix for this in v1.9.8.1, but for now you can fix this by removing \"KeepExisting\":null  whereever you find it in the list of renewals in the registry.. It's not such a big deal to add a .config entry. I think it's not something I'd like to ask the user a lot of questions about in interactive mode, but it's valuable to provide an escape this way. I always felt myself that 9am (peak hour for a lot of services) was kind of risky.. There are a lot of parameters though, which ones (besides the time) would be most important?. The ones you've posted above have been added as config options in the latest release. For many other settings of the scheduled task I couldn't think of good reasons to change the hard coded defaults, so I'll add those options if and when someone opens an issue with a practical use case.. It's a legacy thing that it it assumes you want to run a script when you choose the manual target. To not use any installation steps, add --installation none . Wiki has been updated:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Installation-Plugins. It doesn't make much sense to me to renew without using the renewal system. What I would suggest is that you either remove the cached .pfx file manually (if it's a one time thing), or create a renewal without installation steps if you want to do it regularly. You can delete or disable the scheduled task if you don't want anything to happen automatically.. So to clarify the cached certificate is only used for 24 hours. In a normal production scenario where you renew every ~60 days, you would actually get a new certificate without deleting the existing .pfx first. . --forcerenewal behaviour has been changed in 1.9.8.1 to also be able to bypass cache for new certificates\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Command-Line-Arguments. Could you post the --verbose output of a renewal run that fails to update the binding?. Unfortunately that doesn't show much interesting. \nTo figure out exactly what happened we need to be able to reproduce the issue. If you could run with letsencrypt.exe --verbose --forcerenew it will trigger a new certificate regardless of the date it was last renewed and perhaps then the ourput will provide some clues on why the binding didn't get updated. \nIf you're not comfortable doing it on your production website, which I would totally understand, perhaps you could set up a temporary for testing.\n  . What stands out for me are these lines:\n\n[INFO] Renewing certificate for site.eu\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[INFO] Cached authorization result: valid\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[INFO] Cached authorization result: valid\n\nIt seems that it's authorising two different hostnames there, while you describe that you have seperate renewals for each host. I wonder if that might be something that would trigger this issue. \nI'd be interesting to see what happens with the bindings when you just trigger one of the renewals, rather than both at the same time. \nAnother thing that would be interesting is to try with the --keepexisting switch, which prevents deletion of old certificates. It's not a solution per se but it could provide some insight into what's happening (e.g. if a binding sticks to the wrong/old certificate, we'd at least see it there).\nYou might also want to try running the new version (1.9.8) and see if it exhibits the same behaviour. \n  . I've just spotted the real issue (I believe)\n\n[INFO] Installing SSL certificate in server software\n > [WARN] No script configured.\n[INFO] Uninstalling certificate from the certificate store\n\nThe highlighted line tells me that these renewals are manual targets, which are supposed to be installed by a script. Since there is no script provided, nothing happens (except the old certificate getting deleted, causing the bindings to fail).\nIf I'm correct, the first time you set this up, you also had to configure the bindings manually, right?\nThe way to really fix it is to re-create the certificates as IIS targets, so that the bindings can and will be automatically updated. Alternatively you can upgrade to v1.9.8 which actually allows manual targets to be installed to IIS. You still have to re-create the renewals though.\n. I'm going to close this issue due to it being quiet in the thread for a long time. Please feel free to post again though if you keep having issues with the latest release. Thanks for using LEWS and providing us with feedback.. Could you post the full log leading up to this error? Preferably using the --verbose switch.. That might be because of #695. This is caused by a bug that's triggered when PrivateKeyExportable is set to False in the .config file. As a temporary workaround you can set it to True, but it will be fixed in the next release.. It does, but it cannot guess what you intended to do based on a previously created renewal ;). In this case you have a IIS site target for a SiteId 1, but that site seems to have been removed or stopped. There is no recovering from that. But even if it would be the Default Web Site there would be no bindings configured with host names in them, so the renewal would have failed for that reason.\nWhat you want to do is set up a renewal with the manual target plugin and the IIS installer plugin (perhaps followed by a script installer to configure Exchange itself).. There's an ongoing effort here to document Exchange setup with LEWS: #700, I'll close this issue and defer to that one for any followup questions you might have.. Most likely this is because one of your IIS websites is of an unrecognised type or in an unrecognized state. In the past this sometimes happened because there were FTP sites, but that shouldn't be a problem anymore. Can you think of something special about any of your websites?. Could you perhaps share (an anonymized version of) your applicationHost.config? To solve the issue we have to figure out what the program is tripping over.. I'm going to close this issue due to it being quiet in the thread for a long time. Please feel free to post again though if you keep having issues with the latest release. Thanks for using LEWS and providing us with feedback.. There is currently no way to listen to another port. The only workaround would be to use another validation method, or use some kind of script that terminates the process hogging :80 before running LEWS.. This was added in version 1.9.9!. In my opinion things should be as simple as they can be, but not any simpler. The whole process of automatically generating, validating, installing and renewing certificates is not something that's very simple when you consider all the different use cases for Let's Encrypt certificates on Windows.\nThe only reason that v1.9.3 was (relatively) simpler was that it was very limited. If  you weren't creating a certificate for an IIS website with host-bindings on port 80, you were pretty much screwed, or at least forced to renew manually (which kind of defeats the point of Let's Encrypt).\nI believe that the current version provides the power and flexibility that a significant number of users have wanted since the beginning, given the amount and age of issues that I closed.  Throwing away \"all that complicated stuff\" is not really an option because these are things that people need and are using in their environments.\nAt the same time, the quality of the code has improved a lot - with almost no duplicated lines anymore, much better logging and error handling, no more reliance in user-specific data storage etc. I also personally believe that UX has improved, because it gives you a level of control and discoverability that previously was only available if you started regedit.exe or browsed through Wiki-pages here.\nObviously there are some more questions to answer when you want to create a new certificate. It might be a good idea to skip some of the less commonly needed steps in interactive mode unless an --advanced parameter is provided, or to better explain some of the choices that users need to make.\nI would recommend anyone who's frustrated with the UX to contribute ideas about possible improvements, improve the Wiki or submit at PR if you have the ability and time! It'd be shame if some people got 'stuck' on v1.9.3 out of pure frustration about what would probably take minor changes to fix.\n\ncan you provide a specific workflow that can't be executed using command-line options?\n\nAlso curious about which use case you have in mind.. The command line for that is here:\n https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Target-Plugins\n--plugin iisbinding --manualhost example.com\nThat doesn't work in v1.9.3 though - in that version you can use --manualhost but then it will not create or update a binding in IIS.. I like your suggestion @nemchik. I could imagine it being the first question, but that would be an extra thing to read and decide on, so I can also imagine the menu option \"Create new certificate\" being split into two, i.e.\n\nCreate new certificate \nCreate new certificate with advanced options\n\nThe command line behaviour is mostly independent of interactive mode, and the exceptions, such as --centralssl, --warmup and --keepexisting, are command line only, so it wouldn't be affected.. @pbh-stu did you by any chance use the letsencrypt.exe.config from a previous version when you tried v1.9.8?. Ok, in that case I'm not sure what's happening, but #677 is the place to discuss that specific issue. Check out v1.9.8.2 for the new default (simple) mode:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.9.8.2. That page is pretty long. I think it could be much shorter, just something like:\nletsencrypt --manualhost webmail.example.com --validation selfhosting --installation iis,script --siteid 1 --script \"./Scripts/PSScript.bat\" --scriptparameters \"./scripts/ImportExchange.ps1 {5} IIS,IMAP,POP\" \nBut since all of this is untested at this point, at least as far as I know, I would prefer that someone with an actual Exchange lab try this and documents their experiences. @nemchik was planning to do it this month.. It's my understanding that Exchange (or at least OWA) doesn't like bindings with hostnames specified. But OTOH IIS doesn't support CCS without hostnames, so I'm not sure if or how you can combine the two. All I know is that Exchange is a complicated beast, so I'll leave it to the experts to comment on potential issues and how to check for them.. Nice work! Great to see people working together to find the best solution. \nMy 2ct: I think the prerequisites part (except firewall) can be skipped when using the SelfHosting validation mode.. @LBegnaud how are you feeling about the current PR? I'm thinking to make a 1.9.8.2 release sometime over the weekend, wondering if you'd like it merged in already or wait until the next one :). This has been merged in with 1.9.9! Thanks for all the effort!. There are commands to create the kind of certificate that you describe. The trick is to use the IISSites target and then provide \"s\" as SiteId (also should work from the command line).\nBecause it can be created I've felt for a long time that it should be updatable in that way as well. But honestly the whole IISSites thing with its abuse of the \"Name\" field to drop a CSV string feels like a hack that's screaming for refactoring.\nWhat I'd like is to get closer to the Let's Encrypt semantics: defining a certificate by a unique set of FQDNs. The (Friendly)Name should be freely chosen by the user and other parameters shouldn't depend on it. Until we get there I don't really feel it wise to build additional semantics on top of the current system.. @LBegnaud - How are you feeling about this? My gut says that the script is much better already than the once that's currently being distributed in our releases. Would fixing the parameter type issue at a later date cause problems for people upgrading? I guess what I mean to say is don't let perfect get in the way of good :).. No problem, thanks for contributing!. The first one you tried should be correct, though it seems the program has some problem 'guessing' the validation plugin. You should making that explicit (e.g. --validation selfhosting) as a workaround, but i marked is as a bug.. It's been fixed in v1.9.8.2, so it should work without validation parameter now.. There's no official way to do that right now, but if you're willing to a little regedit then you can influence it, because it should use either the Host property of a target or - if Host is not a FQDN - the first of the AlternativeNames.. LEWS has no influence over which protocols your server supports. You can use IIS Crypto to view and change those settings though.. There is not really syntax for that, but you can do it with a two step approach. You can use the --cancel command to cancel the previously created renewal, and then create a new certificate with the updated set of sites.. I'm afraid that this is not really the right place for WAMP support. Unless you're able to pinpoint the problem and show that it's an issue with LEWS, I won't be able to help you.. Good catch, thanks for contributing!. Unfortunately I don't have the time to support older versions of LEWS. Therefor I'd recommend you to try the latest version and report in if that's also causing you issues.. Sorry to hear that. Could you post the output of the program in --verbose mode so that we might get some more insight into what's happening?. I also don't see anything strange happening there. But IIS is known to be quirky in some cases. Are any of your https bindings IP-specific? If so, it might work better when they listen to all IP's.. There is already a lot of logging there, and as you can see LEWS is not touching the other binding, yet IIS messes things up. This behavior is not happening on my machine, though it's known to happen in rare cases (see #94). So no, it's not a trivial issue unfortunately, since nobody has been able to pin down exactly in what circumstances it goes wrong, and it's IMO most likely a bug in the Microsoft.Web.Administration library rather than an issue with this program.. Good catch! I should have thought of SNI issues when you described the problem. The reason it's not set during certificate updates is to respect the admins wishes in case they have to support non-SNI clients, but if possible I'd recommend anyone to leave SNI checked.. This is because of #695 - tls-sni-01 validation has been disabled.. Error handling has been improved in the 1.9.8.2 release.. This seems to be a duplicate of #703, please check for the solution there or post there if it doesn't work for you.. I've updated the basic usage page, does it answer your questions now?. > What is an external script? Are there examples? What does this ext script do? \nRunning an external script is optional step that can happen after retrieving the certificate from Let's Encrypt. Basically a fallback to do anything that LEWS doesn't support natively. See this page for details. \n\nIs there somewhere that I need to input the path of where the website is hosted (C:\\xampp\\htdocs\\servername)? \n\nIf you're using self-hosting for verification that's not necessary, because the challenge is answered from within the LEWS process. Self-hosting doesn't work with Apache running on port 80 (because unlike IIS it won't share access to a network port), so for a XAMPP setup you would likely have to use a different validation method such as FileSystem. For that one do have to specify a path.\n\nIs this letsencrypt.exe supposed to be run from the same computer that is running the server? \n\nThat's the most common use case, yes, though the FTP validation mode and such do make it possible to run it from a remote server.\n\nCan this work with XAMPP? \n\nIt should be workable, though I don't have direct experience with it. It would be great if you could document your method if you get it up and running.\n. A wiki page has been created in the meanwhile, see #738. Did you customize anything in your letsencrypt.exe.config? Specifically seems like there's an issue with the ConfigurationPath.. I'm going to close this issue due to it being quiet in the thread for a long time. Please feel free to post again though if you keep having issues with the latest release. Thanks for using LEWS and providing us with feedback!. The command line that you used doesn't make sense for the program. The --script and --scriptparameters switches are only for setting up new certificates, they have no effect when renewing. There is no command line to change parameter for existing renewals, the only way to do that is to overwrite them by setting up a new renewal for the same target. . I've considered some validation on the options but I feel it would get pretty really complicated pretty quickly. Roughly speaking the parameters are just as complex as the program itself. I'd prefer to improve documentation/examples rather then add warnings for each unused option. \nI guess that there was no script provided during initial setup yes, but that much have been an older version then before there was validation on the input side, can that be the case?. They are not different. If you want to change anything about your renewal, you have to re-create it. The program detects if there is a match on a previously created target and replaces/overwrites the existing one if so.\nI don't see why it would be necessary to change --dnscreatescript for every renewal though. The parameters passed to those scripts change based on the challenges posed by the ACME server, but I can't imagine you'd want to run different code each time.. You're right about that, but what happens is that the program stores all provided configuration (be it via the command line or via interactive mode), and reuses it during the renewal. The command letsencrypt.exe --renew is enough to renew any certificate that's due to be renewed, no matter with which options (target, validation, store, install) they are set up. \nSpecifically for the DNS script it will remember the location of the executable and just start it again with parameters to tell it which record to create.. It's safe to delete them. I've fixed two bugs that could've caused this in the next release.. 1.9.8.3 should not allow this to happen anymore, thanks for reporting the bug!. If you don't have IIS running on the machine then the default/simple mode to create certificates will not work for you. I'm marking this as a bug because the menu option shouldn't be available, but going forwards you will have to use the \"M\" for advanced mode.. 1.9.8.3 should not show the menu option anymore, thanks for reporting the bug!. I'm sorry but we won't be able to help you in Russian. Perhaps a Google Translate of https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Basic-Usage#renewal would help?. I'm not sure about this, but I guess if they both exist, Let's Encrypt wants A and AAAA to validate. You can try a different validation method or remove the A record.. I'm afraid not. If there was an option to weaken the validation requirements, then it might as well be weaker by default (because a fraudster would also enable such an option). That's just my reasoning though, maybe you can try https://community.letsencrypt.org/ for better insights into how Let's Encrypt actually works from the inside.\nFrom this projects side I can only suggest that you try DNS-based validation. . I see where you want to go with this - and I think it might even be possible - but it would have to be a bit more elaborate than merely reading letsencrypt.exe.config from a different location. This kind of .config file in the .NET world also serves the purpose of initializing the CLR with the correct assembly redirects etc., so that stuff would have to be separated from the user settings in order to ensure successful upgrades.\nThanks for including LEWS into your project by the way, I wasn't familiar with it before but it seems useful!. Reopening because it would make sense to do this.. This is done by the new release!. Another workaround is to add --installation none. \nI will update the heuristics of unattended mode in a future release though, the assumption in 1.9.7 and below was that manual target means script installer, which was harmless until the script installer started validating that its input made sense.. 1.9.8.3 should not give you this error anymore, thanks for reporting the bug!. Thanks for the PR! I appreciate any help that I can get with this project. In this case I'd already prepared a different fix for the bug though. Rather than checking for the magic \"x\" I removed it altogether and skipped webroot validation for the IISSites plugin. \nhttps://github.com/Lone-Coder/letsencrypt-win-simple/commit/8c8426664de7087bae840dc496f63f9f9937987d\nKeep up the good work though if you find yourself stuck on something else.. If your website has two host names (with and without www) then what you want is a certificate which is good for both them. You should choose to \"create a certificate for all bindings of an IIS site\" to get that. Alternatively, you can create two separate certificates, one for each binding.. If there are no bindings with host names, LEWS has no way to figure out for which domain(s) you want to generate a certificate. Therefore when the program asks what kind of certificate you would like to generate, you should go for the \"manual\" option, where you can specify it yourself.\nBy the way this looks like it might be an Exchange server, so the ongoing work in #700 might be interesting for you to take a look at.. I'm going to close this issue due to it being quiet in the thread for a long time. Please feel free to post again though if you keep having issues with the latest release. Thanks for using LEWS and providing us with feedback.. Thanks for reporting that :) I've ninja-updated the releases to correct the issue and updated the build-script to make the change automatically going forward, so it shouldn't happen again.. Fixed and uploaded a new build, thanks for reporting this!. Please check the Wiki on validation issues, I guess you either have a firewall issue or an IPv6 misconfiguration.. I'm going to close this issue due to it being quiet in the thread for a long time. Please feel free to post again though if you keep having issues with the latest release. Thanks for using WACS and providing us with feedback.. This seems to be a variant of #677. The reasons why this occur are misty at best for me. One thing that could be the issue is if you kept a letsencrypt.exe.config from a previous release, or your .NET Framework version is out of date.. This sounds more like a general web server issue than a LEWS issue, but this Wiki page might be helpful, assuming your running IIS. \nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Validation-issues#http-01-validation-issues. I'm going to close this issue due to it being quiet in the thread for a long time. Please feel free to post again though if you keep having issues with the latest release. Thanks for using WACS and providing us with feedback.. You could start by reading this page: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Validation-issues\nIf you feel that it's none of those issues, please get back to us with a full log of what goes wrong.. Thanks for the update! . 1. A new key pair is generated automatically when a new certificate is requested, you don't have to do anything for that\n2. Yes\n3. Yes\n4. Yes\nSeems like your intuition is pretty good :). Going to mark this as a bug because it obviously shouldn't happen in the first place.. The bug will be fixed in the next release, thanks using LEWS and helping to make it better by providing feedback!. This was implemented in 2.0. The full answer requires some context, because there are two types of pfx files. \n\nThose stored by the program in its certificate cache. They are protected by randomly generated passwords which you can view from the main menu. It's not possible to specify those passwords nor disable them.\nThose exported by the program for the IIS Central Certificate Store. Those have no password by default, but one can be specified from the command line. The same password must be set in IIS for it to work.. Hi @nul800sebastiaan, first of all thanks for the contribution!\n\nRegarding this specific implementation, it only seems to work during the initial run, because the password is not persisted in the ScheduledRenewal. The first time it will use the given command line parameter, but on subsequent runs it will default back to the one specified in the .config file. \nMy architectural idea for the Options(Service) is to consider it a read-only entity that represents the command line. It's a way to facilitate unattended certificate creation as an alternative to interactive mode. (And to expose some advanced options in interactive mode as well).\nBut, it shouldn't be necessary to read from it during the 'execution' phase of the program, which is identical for cmdline/interactive/renew. The ScheduledRenewal should be a self-contained unit of work, independent from Options(Service).\nI hope you understand what I mean and have a chance to incorporate this thinking into your patch.. iisbinding makes a certificate for single binding, so it doesn't support comma-separated input for hostnames. You can use either iissite (which processes all bindings) or manual to get a SAN.. > using --plugin iissite runs on all bindings (I have more than 300 there) and all of them already have certificates, how can I target only bindings without certificate? using --excludebindings is not an option cuz of the long long list.\n--hidehttps is your friend!. Thanks for writing that up! \nIt would be great if you could add this to the Wiki ( https://github.com/Lone-Coder/letsencrypt-win-simple/wiki ) so that others can contribute (if and when necessary). I think it will get more visibility there as well.\nPing to #713 \n. Thanks @lvn78 and @tschallacka for your input! Great to have Wiki page for Apache users because the question pops up regularly.. According to Microsoft, you should be able to install .NET 4.6 and 4.7 on Windows 2008 R2 SP1. Perhaps you are missing the service pack?\nhttps://docs.microsoft.com/en-us/dotnet/framework/migration-guide/versions-and-dependencies. I'm going to close this issue due to it being quiet in the thread for a long time. Please feel free to post again though if you keep having issues with the latest release. Thanks for using WACS and providing us with feedback.. Great! Nice to see that the Wiki is growing with more use cases and more up to date information.. Looking at the source code and your log, this seems to fail during the conversion of the private key to the Microsoft RSA SChannel Cryptographic Provider, which may not be installed or disabled on your system. We might be able to diagnose that with more certainty if you post a log with --verbose.\nI haven't encountered this problem before, but I'll make sure to add better error handling and a fallback to the default provider in the next release of LEWS. Thanks for reporting this bug!. This is odd, the logger seems to be acting up. I don't see any of the [VERB] messages in your log. Also it shows a debug message which I don't see in my builds.\nWould you mind trying this build to see if it gives you a proper error message?\nletsencrypt.zip\n. So the error is where I expected it to be, but at least it's handled with a warning now, instead of it being fatal. I recommend you to use that build until the next official release comes out.. The error is warned about but no longer fatal in the latest release.. Self-hosting validation is hard-coded to port 80, which works in the vast majority of cases because Let's Encrypt is hard-coded to port 80 as well. But if http traffic is internally redirected to another port then it falls apart.\nHonestly it's not the first time that I've heard from someone with this kind of setup, so I think it's time to add some way to configure it to listen to another port.. The latest release contains a new parameter --validationport to support listening to other ports besides 80.. Can confirm what @LBegnaud said, the ACME protocol specifies port 80 as a MUST for http validation, this new switch will only work for NAT setups. \nSince tls validation is disabled, your only other alternative right now is dns validation.. The problem with --scriptparameters is that you might not want the same ones for add and remove, and definitely don't want the same ones for your install script (if you're also doing manual install).\nI like the second idea more, but there would be a compatibility issue if we pass them as the first parameters, becauses scripts created for the current version would expect other input in that position. \nWe can add it last, but then if you're going to count parameters anyway to figure out which one is last, then you can already use the rule that n=3 means add and n=2 means remove.\nI guess all things considered we would have to add two new command line parameters to support this.. We wait up to 5 minutes for the script process to exit, so if you add timeout to your script it shouldn't be a problem. \nSince it's a new record and not an update of an existing one, you shouldn't have issues with TTL or caching, just possible slowness in the response time of your DNS API. . This is version 2.. @Lone-Coder - if we're going to have to rename the program, it might be good time to move the repository as well. I would suggest two options, in order of preference.\n\nWe move to https://github.com/PKISharp - which is the collection of C# based ACME tooling\nWe create new organisation for 'Acme-Win-Simple'. I guess nobody has trademarked AWS ;).\n\nIt would be possible to create a fork and update the readme in this branch, but I'd much rather keep the whole history, list of issues, etc.. @bdaehlie - your request makes a lot of sense to me and I'll try to get it done as soon as possible.\n@anyone: Ideas for a new name?. Not bad!. Yes that's fine by me! . I'm not sure how Github handles moving repositories (e.g. temp/permanent redirects?), but if it doesn't do anything it would be great if you could create a new placeholder project at this location explaining the move. This page is being linked all over the place and it wouldn't be easy to find again if it just disappeared.. I think @ebekker is the only one who can do that.. Thanks Brian! . @bdaehlie we have complied with your wishes, could you in turn please make sure that we are re-listed at https://letsencrypt.org/docs/client-options/ ? Preferably at our original position in that list :). I can see why that's an annoying job which is ripe for automation, but I feel this is outside of the scope of this particular program. If I understand it correctly, those bindings would have to be fixed regardless of encryption, because you want your users to be able to put www or non-www even if you don't have https.. Ah that changes things a bit. I think there's already an alternative though. Rather than adding HTTP bindings just for the sake of LEWS, you can use the advanced mode (\"M\") to manually input the host names that you want the certificate to be generated for, and then point the installation plugin to the site where you want them. LEWS will then automatically add or update HTTPS bindings if needed. This is also possible from the command line if you want to automate the process.. \"Do you want to install the certificate\" is not the best wording for the question since we have installation plugins, it should be something more like \"Do you want to store and install the certificate?\". \nAs the pfx is stored to the CSS, the program makes a properly named copy of it for each hostname that it's for.. Think of that copy as the \"gold master\" or a cache. From that location the certificate is normally processed further, first storing it and then the installing it. But because of this:\n[--test] Do you want to install the certificate? (y/n): - no\nYou not only don't run the installation, but also not the store step. That's why I mentioned the question is not worded well.. At this point, I'm guessing that your directed CertificatePath (or ConfigurationPath) to your CSS, instead of specifying the path using the --centralsslstore parameter on the command line.  --centralsslstore is really essential to use because it triggers CSS specific behaviours that CertificatePath doesn't, e.g. creating multiple copies and setting the right flag on the bindings.. I noticed that you did in fact use --centralsslstore, but I was correct to guess that you changed the CertificatePath to the same folder. This combination of settings doesn't work because of the 'dupe check' which prevents us from storing the same certificate twice. \nThis could perhaps be prevented on the programs side by not giving the cache file the .pfx extension, but that could potentially break peoples workflows, so the best solution is to just change CertificatePath back to default. I'll add a comment to the Wiki though.. Please check letsencrypt.exe.config, there is a setting called PFXPassword which may have been set by someone else or yourself without remembering it.. In that case maybe try entering a blank password?. I'd suggest trying to use the interactive mode (just run letsencrypt.exe and follow the menu) before you try to make it run from the command line. Perhaps there is no site with id 1 or it's not running or something like that.. I'm afraid you have use an official public suffix to qualify for a Let's Encrypt certificate.. No problem, thanks for using LEWS!. I create a Wiki page in response to this question:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Upgrades. I must admit I'm not very familiar with this myself, but at least it should work if you copy both the \"Signer\" and \"Registration\" files from another server. \nYour idea may or may not work depending on whether or not LE associates the registration with the PK-pair as a security measure. If you try please report back if it worked or not :). If the program on other server didn't ask you to make a new registration (i.e. input email address and agree to the TOS) but still issued the certificates, then everything indicates it's happening on the same registration. . The only way to verify it 100% would be to ask someone from Let's Encrypt. They can be found at https://community.letsencrypt.org/. The deepest error message is one which I've never seen before:\n\nMissing initial replay-nonce header \n\nMy initial guess it that it's coming from the ACME-protocol layer, but I almost can't think of any reason why it would fail on a specific machine and/or with specific settings.\nOne theory that springs to mind is that the API calls are going to some proxy which strips certain headers from the requests, would that be possible?. > Do not use environment variables. Specify the path as C:\\inetpub\\wwwroot\nActually that should work, if it doesn't then I'd consider it a bug.. The crash happens during initialisation of the ACME client, so it's getting ready to start talking with Let's Encrypt. The domain to look for is acme-v01.api.letsencrypt.org or acme-staging.api.letsencrypt.org (if running with --test). \nMy theory is kind of far fetched though, because it'd have to be the kind of security appliance that peeks into TLS connections and re-encrypts them with it's own certificates. There is no way that a simple firewall which opens or closes ports is causing this.. I hope it worked :). Does the domain have an AAAA record set? It looks like it might be an IPv6 misconfiguration. . The simple but honest answer is that you cannot do either of those things right now.\nI can think of some workarounds, e.g. to run LEWS on a dedicated machine outside of the cluster, saving certificates to the CCS on the cluster through a network share. That creates a SPOF, though not a very critical one because renewal only needs to happen every 60 days or so.\nAnother option might be to configure the scheduled task in such a way that it imports a .reg file from a network share before running, and exports it to the same location after running. If that feels a bit dirty, that's because it is :).\nI'll label this as a request for enhancement because there is not really a good reason why we should use the registry to store anything.. The latest release stores renewal information in the ConfigurationPath instead of in the registry, at least for fresh installs.. Good question, I'll make a Wiki page to answer that.. See https://github.com/PKISharp/win-acme/wiki/Migration-to-v1.9.9. I didn't have time yet to do anything with the configuration folder handling. It requires some more work than simply changing a string, because we have to take existing installations into account. \nThe sub folder should IMO only be created under %programdata%, not under a custom path. But if that's a bug it would break existing installs if we 'just' fix it. I'll look into it sometime.. This would be breaking some peoples workflows who don't use scripts or installers to move certs around, but rely on them directly appearing into the configured CertificatePath, so it'd have to be a optional feature.. That would be the other option, but I prefer to keep the whole 1.x line as backwards compatible as possible so that people can easily upgrade and get the latest bug fixes without having to worry about having to change their scripts or processes. \nFor a future 2.x we can of course choose other (more sensible) defaults.. In version 2.0 the number of files generated in the certificate path per renewal has been reduced from 8 to 2, meaning that file system related bottlenecks should be reduced by 4x.. It's possible, but are you really facing this problem or asking for puristic reasons? With the 2.0 changes you could do 10k renewals with 20k files in a folder, leaving plenty of headroom until you hit that 60-80k limit that you ran into before. How many renewals do you actually have?. > As I know you keep all files forever. You never delete any older/expired/no longer used certificate files. That means we have several new files every 2 months and this is growing. That means 10 or 100 certificates can also easily grow over 60.000 over time. We have a lot more.\nThis is not entirely true. When certificates are renewed the old cache files are overwritten. The only way the cache folder can get out of hand is when you have a high churn rate, e.g. new renewals being set up and old renewals being cancelled.  Even if you have 10.000 certificates you'd have 3 full cycles of all of them being removed and replaced. \nIf this is really the problem that you want to address, then dividing the cache files among sub folders is not the solution, because it would just delay the inevitable. The solution would be to simply delete the old files rather than merely warning about them.. The next build will have a new non-default setting that makes the program delete files older than 120 days from the certificate cache.. The new setting to clean up older files was released in 2.0.4. I'm going to close this issue for now because I'm not aware of anyone actually handling more than a couple of thousand of renewals, which is still very comfortably below these file system limits. \nIf someone actually wants to manage tens of thousands of certificates on a server then it's probably wise to have some separate discussions anyway.. Agree on the first part.\nThe latter is a bit more tricky because it's a common feature for all HTTP-01 based validation modes, some of whom may be used in combination with remote IIS installs (e.g. FTP/WebDav/network share).. This has been incorporated into 1.9.9.0. Thanks for that! It's always good to make it easier for people to get involved.. Unfortunately TLS-SNI-01 has been disabled by Let's Encrypt for most cases due to security concerns.\nhttps://community.letsencrypt.org/t/important-what-you-need-to-know-about-tls-sni-validation-issues/50811. In the new release the option is no longer presented, though the plugin will still work for existing renewals.. Let's Encrypt doesn't issue certificates to non-public host names, so I think you'll have to make your internal users connect through your public host name to make it work. I'm not an Exchange expert though, so perhaps the [[wiki|Microsoft-Exchange]] will provide better guidance.. It's a misunderstanding.  --certificatestore is meant to target a specific Windows Certificate Store (e.g. WebHosting, Personal, ...). The CertificatePath cannot be changed using the command line, only globally using the config file: https://github.com/PKISharp/win-acme/wiki/Application-Settings. Maybe, but we'd to be really clever about it because there are a lot of scheduled tasks out there configured to run letsencrypt.exe. That's why I've pushed this into the future, perhaps even to a v2.0. \nThe alternative is to distribute two executables for some time. We'd then have the one called letsencrypt.exe change the scheduled task that calls it :).. For the past half year I've made sure that you can copy a new version of the program to your server with confidence that your existing workflows (tasks, scripts and previously scheduled renewals) keep working as-is.\nThat way you can get bug fixes without finding yourself in reconfiguration hell. Not such a problem for a single server perhaps, but if you operate dozens of servers with hundreds or thousands of sites and have custom automation built around it, that gets annoying really fast.\nThis is the promise of semantic versioning. There have been a few notable exceptions, but all for good reasons.\nI agree with your sentiment that it'd be nice to offer a clean install with the new name, but dealing with legacy is an important part of the software development game. In my opinion the most successful products adhere to this philosophy.\nThere might be a 2.0 version someday that break things in a major way, but it'd have to offer some compelling reasons why it's worth the hassle. Esthetics is usually not one of them. \nSo I'll keep thinking about 'clean' ways to handle the rename.. I had that same fix lined up locally, but you beat me to it with the commit. Thanks!. See #464 , it's not supported currently and will likely take some time after the public launch of ACMEv2 to integrate it, especially since (while?) we rely on ACMESharp to handle the ACME protocol.. You are running renewals, which means the program is going to use the settings as specified at the time you created them. \nTo change settings for existing certificates, be it validation, installation, or whatever, you have to go through the process of creating them again. . Yes, see https://github.com/PKISharp/win-acme/wiki/Installation-plugins#multiple. Yes the application manifest was missing for some reason. 1.9.10 and hopefully above will automatically try/ask to run as admin again.. I did my best to improve it, though I don't have an Exchange lab to try it out so it's kind of tricky. There's been a lot of work on this new script #700 recently, so I figured it deserves to be mentioned there rather than all these manual steps.. Thanks for the keen observation and the PR! . This seems to be something that has to be added in the CSR, which puts it into the domain of ACMESharp. They have an open issue about this: https://github.com/ebekker/ACMESharp/issues/249. This should be possible with a 2.x release since we now generate our own CSR. Removing the \"pending...\" tag.. This is in the latest alpha build using the --ocsp-must-staple parameter.. > maybe that's not best practice altogether but lets ignore this for now...)\nLet's not ignore the fact that you seem to have an uncommon setup. Understanding why and how you do things might lead to a better solution than the one you proposed.\nSo do you actually recreate the IIS bindings on each deployment of your application? \nBecause if you don't, there's no need to run WACS, because the bindings will keep working. You'd only have to run it when you add another (sub)domain.. I'm going to close this issue due to it being quiet in the thread for a long time. Please feel free to post again though if you keep having issues with the latest release. Thanks for using WACS and providing us with feedback.. This behavior is by design because creating an IP specific host binding\nprogrammaticly also creates a nameless kernel binding for that IP,  which\ncan really mess things up if you have other websites hosted on that IP as\nwell.\nIt's a bug in Microsoft's management API though, so it's safe to add the IP\nmanually through the GUI and renewals will work.\nOn Sat, Mar 3, 2018, 21:52 Dmitry Gusarov notifications@github.com wrote:\n\nthis is a verbose output (with cached certificate)\n[INFO] Plugin IISBinding generated target [IISBinding] xxx.yyy (SiteId 5)\n[ @ C:\\inetpub\\xxx.yyy]\n[DBUG] Scanning IIS site bindings for hosts\n[DBUG] Loading signer from\nC:\\Users\\xxx\\AppData\\Roaming\\letsencrypt-win-simple\\\nhttpsacme-v01.api.letsencrypt.org\\Signer\n[DBUG] Getting AcmeServerDirectory\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n[DBUG] Loading registration from\nC:\\Users\\xxx\\AppData\\Roaming\\letsencrypt-win-simple\\\nhttpsacme-v01.api.letsencrypt.org\\Registration\n[INFO] Authorize identifier: xxx.yyy\n[DBUG] Send POST request to\nhttps://acme-v01.api.letsencrypt.org/acme/new-authz\n[INFO] Cached authorization result: valid\n[DBUG] Certificate folder:\nC:\\Users\\xxx\\AppData\\Roaming\\letsencrypt-win-simple\\\nhttpsacme-v01.api.letsencrypt.org\n[DBUG] Certificate store: WebHosting\n[DBUG] Set private key exportable\n[WARN] Using cached certificate for xxx.yyy 2018/3/3 8:48:22 PM. To force\nissue of a new certificate within 24 hours, delete the .pfx file from the\nCertificatePath or run with the --forcerenewal switch. Be ware that you\nmight run into rate limits doing so.\n[WARN] Certificate with thumbprint\n22190D6FD8AC5493FD82828EAD74B6456E3F11C3 is already in the store\n[INFO] Installing with Create or update IIS bindings...\n[INFO] Adding new https binding xxx.yyy:443\n[INFO] Committing 1 binding changes to IIS\n[INFO] IIS will serve the new certificates after the Application Pool\nIdleTimeout has been reached.\n[INFO] Deleting existing task letsencrypt-win-simple\nhttpsacme-v01.api.letsencrypt.org from Windows Task Scheduler.\n[INFO] Adding Task Scheduler entry with the following settings\n[INFO] - Name letsencrypt-win-simple httpsacme-v01.api.letsencrypt.org\n[INFO] - Path C:\\Apps\\LetsEncrypt\n[INFO] - Command letsencrypt.exe --renew --baseuri \"\nhttps://acme-v01.api.letsencrypt.org/\"\n[INFO] - Start at 09:00:00\n[INFO] - Time limit 02:00:00\n[DBUG] Creating task to run with previously chosen credentials\n[INFO] Adding renewal for xxx.yyy\n[INFO] Next renewal scheduled at 2018/4/27 8:48:22 PM\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/PKISharp/win-acme/issues/775#issuecomment-370178903,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AKilXNRyA_3Sevw8xqqh10WZoM6CLwtIks5tawJ5gaJpZM4SbEy6\n.\n. Yes :). It's a problem because http.sys does the TLS negotiation and if you have more than one website running, it may send the wrong certificate to your clients if there is a binding for :10.0.0.2 instead of example.com:10.0.0.2. > So, you mean via API call it will add :10.0.0.2 here even if there is a host header in a call?\n\nExactly. The IIS binding will be created correctly, but the underlying kernel binding will be for *. Microsoft acknowledged this bug but so far there's no fix available. The only way I know of to get it to work correctly is via the GUI. . Is it possible that the original site you used to create the certificate with doesn't exist anymore?. It seems to point to not being able to find the site it's supposed to use for validation in IIS. I'd be interested to see the contents of the registry entry for the certificate.\nYou can try to recreate the certificate but you'd have to go with the command line to set it up with TLS validation, as it's no longer supported for mainstream usage.. The program can't find the IIS website, and I think I can see why. Could you try removing \"SiteId\":0,\"TargetSiteId\":0,? Because this way it's trying to find IIS Site 0. \nIt's definitely a bug that the registry got into this state, I'm making some changes in the next release to prevent this from happening to others.\n. Yes I should have realised that it would happen that way, because the bug that caused it is still in there.\nI made a fix in 1.9.10, but if you don't want to upgrade yet, you might try another workaround, which is adding \"ValidationSiteId\":1, to the line.. I think we have some code\n_eventLogger = new LoggerConfiguration()\n                    .MinimumLevel.ControlledBy(_levelSwitch)\nWhich might prevent the config setting about the minimum level from working. You can run your scheduled task with the --verbose parameter though if you want to test the full logging output. Also --forcerenewal can be useful when you want to test renewals without waiting for the scheduled date.. It does not, but if you don't want to change the command line then you can modify the registry/file to alter the date on one or more renewals. Then you can test a scenario which is as real as it gets.. I've been doing this long enough to know that there's a 1001 possible ways for a renewal to fail and there's no sane way to test for all of them of preventatively. Keep in mind that each individual renewal (potentially) has a different web root, different certificate store, different (custom) scripts to run with different parameters, etc. \nThere's no way to guarantee if all of that will/would work, short of trying it - first during initial setup, and then if you want to be extra safe, by forcing a renewal. \nI don't really consider adding a --verbose parameter to your command line a \"wonkey workaround\" by the way, but I'll look into ways to respect the serilogger .config.. Merging this with #901 . I concur with @alexhass. \nRather than letting a script run win-acme, let win-acme run the script: https://github.com/PKISharp/win-acme/wiki/Install-Script. The program does have exit codes by the way, but they are not used for individual renewals, just for fatal errors. It's definitely worth considering erroring out to the task scheduler when one of the renewals fails, because it would be a pretty strong signal for an admin to check out what's up.. It isn't mandatory as far as I can tell?. I added the exit codes in 1.9.10. Though it's not usable for your original scenario unless you only have 1 renewal. If there are more than one you won't know which one of them failed.. So there seems to be some confusion about the basic concepts of unattended operation. There's two things that you can do running letsencrypt.exe with command line parameters. One is set up a new certificate, the other is to renew previously created certificates.\nThe --script parameter, like most others, is meant for the first usage. It has no effect on the latter. Renewal uses configuration values as they were specified at the time of creation, which are remembered in registry (<1.9.10) or in a file called \"Renewals\" in the configuration path for new installs of >=1.9.10. This allows users to choose different scripts or validation methods etc. for different certificates.\nIf you want to change the way an existing certificate is set up in terms of installation or validation, you have to recreate it, or edit the stored parameters manually. The scheduled task generally never has to be changed.\n. @westofsa - I like your creative thinking, but it's really not necessary even with the current feature set.\nAll you have to do is cancel your current renewal and then create a new one (for the same domains etc.) with the script included as an installation step. This can be done either from the command line or through the GUI. \nCancelling the renewal will not revoke or delete the existing certificate so this is safe to do at any time, as long as you setup a new one in time before it expires.. See also #674.\nI've submitted it to Microsoft as a false positive, I hope they're going to update their definitions.. It can be submitted as a false positive here: https://www.microsoft.com/en-us/wdsi/submission/\nI've already done so, but perhaps it gets more priority if others do it as well.. Tried signing the assembly but it won't work because the ACMESharp assemblies aren't signed. I've submitted 1.9.10.1 now too as a false positive.. That's a bug, but it should be fixed in the next release!. Agreed, thanks for contributing!. This might occur when the program is unable to enumerate the websites you have in IIS, which in turn can be caused by an inconsistent configuration, e.g. missing application pools. Can you verify that all of the sites you have in IIS are configurable through the GUI?. Would you be willing to share an anonymized version of your applicationHost.config? Then I could debug with your IIS configuration.. You can anonymise it yourself as far as you like to hide your domain names and/or company names etc., though that's entirely optional. Afterwards you can add it to pastebin or something. If you want you can post the link here, or otherwise send me a DM on Twitter at @wtinus. Finally had the change to check out your applicationHost.config\nThe problem seems to be that you have two websites \"Lampadin\" and \"AmigoRural\" configured to use the applicationPool \"ASP.NET v4.0\", which doesn't exist. Therefor their state is \"Unknown\" and the IIS manager shows the same exception as this program does in the status column of the site list, e.g. \"The object identifier does not represent a valid object. (Exception from HRESULT: 0x800710D8)\"\n\nIf you fix or remove those sites I expect everything to work fine again, but we should guard against these kinds of exceptions, so I marked it as a bug anyway.\n. Thanks for the PR, that's a nice addition to the options!. OpenSSL has been dropped in recent releases in favor of BouncyCastle. Other than that I'm not really sure what you're asking, but it feels like #165 perhaps?. I'm closing this because I don't understand the issue and there has been no further response from the OP.. Duplicate of #781. Not right now, but it's on the Let's Encrypt roadmap: https://letsencrypt.org/upcoming-features/. Thanks for the explanation @rhymeswithmogul - so it comes back to #165. . In theory this is possible now with 2.0 and no longer depends on ACMESharp, but I seem to have some issue with the .NET Framework.. I built a plugin system for generating CSR's and wrote a ECDSA plugin with a configurable curve (default secp384r1). This will be in the next beta release.. This is in the alpha4 build.. Not issues per se, but you should check: https://github.com/PKISharp/win-acme/wiki/Upgrades\nAlso the --san switch was removed 1.9.4. Currently there is no way in WACS to unsubscribe from notification emails or to change the address that they are sent to. The notifications are a Let's Encrypt specific feature not covered by the ACME standard (#189).\nI think ACME supports changing/adding contacts for a subscription, but it's not in WACS and I haven't checked whether it's in ACMESharp.\nSo I'm not sure if there is any negative effect of editing the registration file, but it highly likely that there is no positive effect either :).\nThe solution I provided is a brute force one, it just forces the program to create a new registration with Let's Encrypt so you get the opportunity to provide the email address again, but it doesn't cancel or unsubscribe from anything for the older one - that just loses its relevance after 90 days and all previously created certificates have expired.. It depends what you mean exactly by \"support\". \nIf you're talking about handling validation requests, which seems most likely to me, then the ACME standard does not allow it. The only way is to use NAT to map the incoming port 80 to a different internal port and let the program listen to that with the --validationport parameter. . It looks like you're redirecting requests coming in on port 80 to port 8065, which ACME doesn't allow; Let's Encrypt wants an answer from port 80. \nYou have to make an exception in this behavior for the /.well-known/ path, use NAT to hide this 80/8065 business from the outside world, or use another form of validation.. You are almost certainly mistaken that the scheduled date used to be after the expiry date, unless you've made nonsensical changes to the configuration file. The renewal date is supposed to be before expiry of the certificate.. We try to renew a little over a month before the certificate expires, so that if renewals fails for whatever reason, you have plenty of time to figure out what's wrong. \nBad Stuff\u2122 tends to happen when an expired certificate is used in a production system, so it's not wise to wait to renew it until the last possible moment, nevermind until it's already expired.. Looks like the certificate might be in the wrong store, maybe the example command line should specify the certificate store to be \"Me\"? Do you concur @LBegnaud ?. Closing this in favor of #832. Thanks for the heads up. I wouldn't mind to use this method but I don't have an Exchange lab to try any of this, so I'd prefer if @LBegnaud or anyone else could take a look at it. If we're going to use this script it'd also be nice to redistribute your library as-is, so it'd be easy to get future bug fixes. Perhaps you wouldn't mind to set up a PR yourself?. Closing this in favor of #832. Three very similar issues reported with different versions of the program in a short time. I wonder if something changed on the Let's Encrypt side. I'm going to look into it as soon as I find some time.. Are you sure it's not created? Because the program deletes the file after validation (successful or not). If it's never created your web server log should show a 404 error.. @CCNST can you try running in --test mode and check if it's working when it's asking you to try the file in your browser? The exception that you are getting seems to happen while the program is trying to list the errors returned from Let's Encrypt, so the root cause must be somewhere else.. --test defaults to the Let's Encrypt staging server, and this program stores separate configuration and renewals for each ACME server, so you're less likely to mess up something in production. The downside is that you have to recreate (one of) your certificates to reproduce the issue.. Definitely worth a shot.. I just did a little .1 release with fixed error handling and more verbose logging in the FileSystem plugin, which should provide insight into what's happening. I also caught a mean little TLS-SNI-01 validation bug based on your second stack trace @Gfweis. Please try with --verbose and post any remaining issues.\nhttps://github.com/PKISharp/win-acme/releases/tag/v1.9.10.1. @cherzog \n\n[VERB] Writing file to D:\\xyz\\www.well-known\\acme-challenge...\n\nLooks like it should be D:\\xyz\\www \\ .well-known\\acme-challenge... no?\nCan you manually change the webrootpath with a trailing slash to see if it works then?\n@Gfweis \nYours looks like a firewall issue or perhaps an IPv6 issue. Do you have an AAAA record for the domain?. @CCNST \n\nThe new 1.9.10.1 doesnt crash like 1.9.10.0 but I get the following error: [EROR] Error loading assemblies for plugins.\n\nDo you have any *.dll files in the WACS path that are not in the current .zip package? I'm thinking maybe the old openssl dll's?. I'd guess you have an issue with IPv6, you should check with http://ipv6-test.com/validate.php. Thanks @LBegnaud ! Your changes have been released in 1.9.10.1. Closing this in favor of a central discussion in #832.. Thanks for reporting this issue. It seems to be a duplicate of #797, though it's regarding different versions of the program. I wonder if something changed on the Let's Encrypt side, or if it's just a coincidence. For now I'm going to assume that the underlying issue is the same and keep the discussion there > #797. Thanks for reporting this issue. It seems to be a duplicate of #797, so I'd like to keep the discussion in one place.. This is the first time I've heard about AVG tripping up, but we had issues with Windows Defender before, i.e. #781. Let's keep the AV discussion there in one place.. The only way I can think of right now is to setup two separate renewals, though they'd have to have different names, so they can't both be from the manual target plugin. \nYou're right that it should be possible to do both. I was thinking to make the plugins cross-check each other to see if any FTP bindings need to be updated when a web binding changes (and vice versa), but to make it even more formally complete there should be a ftpsiteid parameter.. @ptsoccer good catch, and I think you're right about the solution as well. PR's are always welcome!. Nope, we're tracking that in #464 . Unfortunately it's not that easy. \nWe'd have to regress to a six year old version of the IIS Management library to run on .NET 4.5.2, which I'm not quite willing to do for the master branch. That's because .NET 4.5.2 is limited to .NET Standard 1.2, whereas the latest version requires .NET Standard 1.6.  \nThe only sane way'd be to support a separate branch with a different set of dependencies, but that'd be a lot of extra work. I would encourage the effort but I'm not sure I can take it on personally, unless it turns out that there is a lot of demand for it.\nThe latest version with the old library is v1.9.7.2, that should run on .NET 4.5.2 without issues. If you can live with the features and limitations of that release, you might already have your solution.\nOtherwise you might be able set up the current release on a different server and use a script or the central ssl store to install to your target server.. I think you should go through the steps in https://github.com/PKISharp/win-acme/wiki/Validation-issues, especially testing your IPv6 connectivity. When you use SelfHosting it's normal that no files are written to disk.. The ciphers can't be the cause of this, because validation happens on plain http. When you choose SelfHosting validation (e.g. the default) nothing is written to disk anymore, it all happens a virtual in-memory file system.\nI really suspect it is (was?) an issue with IPv6.. I noticed you have a seperate issue open (#821) about this, so I'll close this one.. It seems like you have 127.0.0.1:8888 configured as the proxy address, either system wide or in the .config file for this program. The proxy however doesn't seem to be responding. Does that ring any bells?. Do you have any anti-malware products running which might use a proxy to filter web traffic?. Perhaps you can try to remove the default value [System] from the <Proxy> element in your settings.config \nhttps://github.com/PKISharp/win-acme/wiki/Application-Settings. I'm going to close this issue due to it being quiet in the thread for a long time. Please feel free to post again though if you keep having issues with the latest release. Thanks for using WACS and providing us with feedback.. I personally don't like the \"all sites\" mode, especially because it doesn't (yet) detect newly added sites on renewal. Also the fact that a single domain failing to validate will preventing all sites from renewing is not so nice. So I'd go with one certificate per site or domain.. I'd have to see the content of the Renewals json (either from the file or the registry or the --verbose log) to make sense this. There must be a reference to the old domain somewhere, perhaps it's still a secondary binding on the site? But from this description I can't figure out how you set things up.. Nothing, that should do the trick. \nDidn't you choose the option to automatically renew when you set up the certificate for the new domain? Otherwise there should have been two renewals.. The simplest way is to cancel all the old renewals (no need to revoke, that's just in case you get hacked) and then set up new ones. \nAfter that you can remove the single-host certificates from the certificate store to clean up because WACS doesn't remove them when you stop the renewal.. There's an option to cancel renewals in the main menu, in case you haven't found it yet. You can also edit the Renewals list manually, which will either be in the registry or a file in the ConfigPath, depending on which was the first version of the program you downloaded.. The only way the program should try to do anything with a letsencrypt-win-simple folder is if it exists. Are you sure you've completely deleted it?. Can you take a look at your letsencrypt.exe.config? Does it list the <ClientName> setting and if so, what is its value? . Can you post the output shown on your screen while running with the --verbose parameter? Something is very fishy about all this.. You can do this if you set up a renewal for the IIS site, so not manually or for specific bindings.\nA renewal will detect the additional bindings and request a new certificate for the new total set of bindings. You have to force it to renew though, at least if you want to get the bindings encrypted before the regulary scheduled renewal, with the --forcerenewal switch.. Not exactly, but close enough. In this mode, a single certificate is requested that is valid for all bindings (known as multi-domain / SAN certificate). All existing bindings are replaced with the latest version of the certificate.. Did you make any changes to the supported protocols/cipher suites in the OS? E.g. to get a higher rating on an SSL test? Because it kind of looks like those settings were changed a bit too aggressively.. Does this page work on your server? https://valid-isrgrootx1.letsencrypt.org/. DNS validation is supported. Check out:\nhttps://github.com/PKISharp/win-acme/wiki/Validation-plugins#dns-01-validation\nIt's also presented as an option when you create a new certificate in advanced mode. \nThe tricky part is that you have to provide your own script to update and delete the records.. You are right about the process of DNS validation @markbreen. As @pmorriss points out in his post, his approach updating the (internal) Windows DNS server didn't work out for him because of the reasons listed below, but he provided it as an example of how to set things up.\nLet's Encrypt requires a domain name to be under a root listed on the public suffix list ( https://publicsuffix.org/list/ ). E.g. mycompany.com would qualify but server1.mycompany would not. Furthermore the DNS record has to be publicly accessible. Let's Encrypt does not document from which location or location(s) the DNS validation is performed, so for it to work it has to be world-visible.\nIf you meet those requirements, there are currently two options to automatically create the validation record. One is to use Azure DNS, because someone contributed a plugin for that. The second is to write your own .bat/.exe file (using .ps1 (Powershell) is also possible but has to be launched through a .bat, as @pmorriss did).\nAnyway, the script file has to talk with DNS server/provider in some way to create the record that Let's Encrypt wants to see as proof of ownership (it changes every renewal, so automation is a must). It requires that there is some kind of API or direct access to the zone files, plus some scripting or programming skills to string it together.\nThinking about it, it would be possible to create a manual DNS validation plugin, that just prints the record to the screen and asks you to create it. But then it would never be able to run unattended. Wouldn't be very scalable but could be a stopgap for some people.. This has been addressed in the linked issue, closing this because there seem to be no further questions!. This is a duplicate of #677, so yes more people have reported it. Let's continue the discussion there to keep it in one please.. @LBegnaud is right, you can't use Let's Encrypt for internal domains. You might want to look into the options there are for a Windows domain controller to issue certificates that are trusted by joined peers and clients.. Best way to debug is with the --verbose parameter. My first guess is that you initially created a certificate manually and then added it to IIS yourself, rather that letting the program manage the whole process. If that's the case, the program didn't configure the \"update IIS\" step for the renewal.. Yes, or edit the Renewals list manually, it's in the registry or in your case most likely on disk in the ConfigPath (%programdata%\\win-acme-simple). Create one as an example and copy-paste away :).. If the issue is with Let's Encrypt in general rather than this specific client, which seems pretty likely at this point, you might get more insight from https://community.letsencrypt.org/. . Alas, there are no such options. Making security measures optional means you might as well not have them at all :). I think it's highly likely there is a subtle misconfiguration of your sites IPv6, but if you already did the basic connectivity tests then I don't have other tips to offer. If you figure out what the problem is, please update us though, it might be useful to add to the Wiki for future reference.. 1.9.3 is a pretty old version, there are a lot of command line options that have changed in the past year. I'd recommend getting the latest version.. You're definitely not running the executable that you downloaded and are checking the file properties of. Perhaps you have an older version of the tool in your system path.. If you didn't download another version then someone else did. I'm going to close this because we can't help any further if you don't want to accept that you're not running the right .exe.\nA tip might be to rename/delete the file that you downloaded and then see if the \"letsencrypt\" command still works on your system. Then through the task manager you should be able to figure out where the image of the old version is located.. I think you'll find that both of these issues have already been addressed in the latest version. Please try that one and report back if there are any inexplicable validation issues. Hopefully you'll figure it out though with some proper feedback from the server.. It looks like Let's Encrypt cannot access the validation file, it's getting a 403 error from your web server.\nI'd recommend going through the steps here: https://github.com/PKISharp/win-acme/wiki/Validation-issues. Great to see that you found the issue! It's one of the common problems the SelfHosting and IIS validation plugins work around.. We support multiple modes of validation, but none of them touch the web.config in the root.\nFileSystem validation can optionally copy a web.config file (whose template you can modify) to the /.well-known/acme-challenge/ folder. This is the classic/legacy way of working, same as it's ever been (except for the part where it's optional now).\nIIS validation is pretty new and uses the management API to create a temporary web application under /well-known/acme-challenge/ preventing most/all common issues people have with the former method (URL rewrite etc.). It should not affect availability of the root application, but IIS can be fickle beast, so I understand this would concern you (though perhaps not more than updating the bindings).\nThe most recommended validation method though is SelfHosting, which doesn't require any interaction with IIS or the file system for validation.. Yes, that options will stop the tool from doing anything with the web.config. Here's some useful tips to figure out validation issues: https://github.com/PKISharp/win-acme/wiki/Validation-issues. This is intended behaviour from the side of Let's Encrypt, nothing can be done on our side to change it. \nSince you opened another issue about the reason for the failed authorizations, I'm going to close this one.. Your site is unreachable via IPv6, even though you publish an AAAA record in the DNS. That's why Let's Encrypt is timing out. Check: http://ipv6-test.com/validate.php. I there is currently no way to do that. --notaskscheduler implies to the code that you don't care about renewal. That assumption is highly debatable of course, so I've made some changes for the next release.. Thanks for the PR!. Thanks a lot for sharing your fixes! For which version of Exchange did you get this to work?. #796 #795 . Might be the same problem that I answered here #985. If my hunch turns out to be right the docs should be updated to reflect that.. Documentation is updated, also for 2.0 changes, and @Atlantis1979 's issue was fixed, so I think we can close this issue for now!. Though I haven't tried it personally, the code for this is already in the project. If you build a .dll with a public class implementing IValidationPluginFactory, it should be treated as any native plugin.. It scans all .dll's in the program directory and presents the plugin it finds as if they were native to the program, e.g. they will be listed in the GUI (in Advanced mode) and accessible from the command line (just make sure to give them a unique name so you don't get conflicts). . I hope it all worked out writing your plugin! I'm closing the issue because there's hasn't been any updates and I like to keep the issue list clean.. First of all I appreciate the effort! It's a feature that's been requested from time to time, so I'm sure you will make some people happy with it. I have the following requests for this PR, which I feel would make the feature more well-rounded:\n\n[ ] Add support for other plugins capable of generating SAN certificates\n[ ] IISSite\n[ ] Manual\n\n\n[ ] Add a command line parameter for unattended use.\n[ ] Make invalid input for the CN a fail condition at creation time (Aquire /  Default) but just log a warning and provide a safe fall back in GetCSR. (Because the list of identifiers can change in each run, I wouldn't want to risk a failing renewal for a cosmetic issue.)\n[ ] Print the value when the user lists certificate details.\n[ ] For the manual input in IISSites you can use the ChooseFromList helper in the InputService, It would remove a lot of boilerplate.\n[ ] I think for now let's just ask this question when we're in Advanced mode, because the Simple user might not even know what a common name is.\n\nMight sound like a lot, but I think it's doable and I'd be willing to help out if needed.\n. I've reviewed the code and it all looks fine to me, so I think we can merge it in. Thanks very much for your efforts, I'll be sure to mention your name in the next release notes.. What the log tells me is that validation was successful, the certificate was requested and installed into the store, but somehow it didn't update the IIS binding. \nThere are several reasons why this could happen, so the best way forward is to check your Event Viewer and look for warnings or errors from the program.\nAlso you seem to be doing this for OWA, so the Exchange server might also have something to do with this. Let's Encrypt with Exchange is a complicated thing to get exactly right, because even after some heroic efforts of several users we still don't seem to have perfect examples/docs on how to get that working for all scenarios (see e.g. #795 #832).. Closing because there has been no follow-up, so I assume the issue has been fixed.. Good catch, that  someone would probably be me trying to rename the file. My Git-fu is still pretty weak unfortunately, so I tend to use the wrong commands \ud83d\ude1e. Would you by any chance know how to rename the main code folder to win-acme without losing the history? Still haven't figured that out.. Thanks Georg, I personally think it's nicer to have history than to fix the aesthetics. Let's Encrypt (the org) seems to be satisfied with the steps we've taken to distance ourselves from their trademarks for now.. Who could say no to cleaner code? . You sure can, check out https://github.com/PKISharp/win-acme/wiki/Validation-plugins#dns-01-validation. You can use any language you want really, as long as you can launch it through a .bat or .exe file. There are some examples of launching Powershell through .bat floating around if you want to go that way (check the examples for install scripts, they work much the same way). \nAn example on how to invoke it in unattended mode is provided at the page I linked, though you have to add extra parameters to determine the target and the install options. \nAnother option is to follow the on screen steps from the menu when creating a new certificate in advanced mode.\nFirst step in any case is to figure out if you can control your DNS servers/provider with some kind of API.. winacme will call out to the executable with three parameters\n- host name\n- txt record name\n- txt record content\ne.g. if you provide it with c:\\create-dns.bat as a script, it will run c:\\create-dns.bat example.com randomstring1 randomstring2 and the result should be that there is a TXT record for randomstring1.example.com with randomstring2 as its content.. Thanks, I hadn't realized yet that it was broken, probably since we moved the repo. I'm going to set it up again.  . I think those references are left over from me experimenting with SqlLite based storage for renewal information, before finally deciding that a flat JSON file would be the best solution (for now). As you can see, my local branching discipline could use some improvement. I'm glad that you caught this.. Looks like the webhooks are not working yet, I might not have enough access to set this up. @ebekker I added you as Administrator to the AppVeyor account ( https://ci.appveyor.com/project/WouterTinus/win-acme-s8t9q/ ), can you help to configure the GitHub integration?. Hi @ebekker, this should be the trick:\nhttps://help.appveyor.com/discussions/questions/203-auto-run-tests-on-pull-requests#comment_33212404\nThe webhook url I will send you in private.. No there isn't - see #791\nWhat you can do is delete your Signer and Registration files, forcing the program to create a new registration with Let's Encrypt. The notifications on the old address will stop after all older certificates have expired (90 days tops).. @georg-jung your answer is spot-on. \n@jmar83 sorry you couldn't get it working. . > To get a certificate we have to manually enter the ACE String of the Domain,\nActually it's supposed to work when you use any of the IIS target plugins. Have you tried that?\n\nbut then the IIS Binding can't be automatically generated.\n\nHave you tried to do that (if so, how exactly) and didn't it work? Or is this a feature request?. Target plugin is too much jargon, sorry for that. The point I was trying to make is that IDN is supported by the regular program and there should not be any need to do things manually. So just start the program, tell it you want a new certificate and follow the instructions. . Closing this because there has been no more follow-up in more than a month. Please post again if you're still having issues though!. Obvious questions first: did you revoke your certificate for some reason? And did you confirm that the certificate that gives these errors was issued by Let's Encrypt?\n. If the certificate was revoked by this program you should be able to see evidence of that when you look at the renewal details in the main menu, there will be a history entry for it. Additionally, it should be logged into the Windows Event viewer. Can you check those?. Closing this due to lack of updates. Please post again if you're still having issues though!. @webprofusion-chrisc is right, for internal domains you will have use another solution than Let's Encrypt, e.g. AD CS: https://msdn.microsoft.com/en-us/library/ff630887.aspx?f=255&MSPPError=-2147217396. Apache doesn't share its port as IIS can do, but the SelfHosting plugin would fail if that was the case, so I guess they are not running on the same machine.\nI would suggest trying v1.9.10.1 instead of v1.9.10.0 because it fixes a bug that prevent error messages from displaying. That we might get to the root cause.. It doesn't seem like IIS is handling port 80, because I'm seeing an nginx header on the 404 page. I'd recommend trying FileSystem validation.. > yes IIS is binded to port 80,\nHow do you explain the Server: nginx response header and the Apache Server at webaccess.jpg-bouw.nl Port 80 in the body of the response then if I open http://webaccess.jpg-bouw.nl/.well-known/acme-challenge/xg3mtGwraY8AoSgO1ypBAt6zVyjoN2Ni5XkyTQ6rn-c ?\n\ni also cant find the file that should be created, but it may that im looking at the wrong directory.\n\nSelfHosting validation doesn't create files on the disk. If you want to try that way, which has a bigger chance of success, then create the certifcate with advanced options (\"M\" from the main menu) and choose for FileSystem validation. Running with the --test switch freezes the program at the point before it asks Let's Encrypt to actually validate, so that you can check if the file is in the right place and being served to your browser.\n. >  can we change the port of acme?\nNo, the standard defines that it has to be 80.. Seems the IIS installer doesn't know which site to install to. How did you set up this renewal? Using the command line or the menu? \nI'd recommending canceling it and creating it again, recording the steps exactly. I'd be happy to know which combination of commands/parameters led the renewal to get into this state.\n. I think I already know. There's a bug which was introduced in the latest version that makes the combination  Manual target + IIS Installer impossible to set up in interactive mode. In your case I recommend using an IIS target, e.g. ask the program to create a certificate for an IIS binding instead of inputting host names manually.. Hi Bill, both options are on the table. The ability to freely configure the FriendlyName is already on the issue list here #404. The ability to add an IP-specific binding is #217. Neither are currently high priorities because they seem to be inconveniences rather than showstoppers (correct me if I'm wrong), but they won't be forgotten. Please let your voice be heard in those issues if you have ideas about how it should be implemented, use cases, etc.!. Yes, unfortunately that just not possible yet.. The --script parameter - like most - has no effect during a renew, because different renewals are be managed by the program, with each potentially their own unique means of target acquisition, validation, storage and installation. \nIf you want to change an existing renewal, for example to add a script to the installation steps, you have to recreate it.. >The --script only runs for new certificates and not for renewals.\nNo, that's not the case. (It would be silly because ACME is all about\nautomatic renewals.) The script runs each time the certificate is renewed.\nThe catch is that you cannot decide at renew time that you want to run a\nscript. You have to specify it at setup time.\nThe reason is that --renew can potentially have to renew multiple\ncertificates, each with their own specific configuration. You typically\nonly want a script to run if the renew was successful, you want it to run\nfor each certificate separately, and there might be different scripts for\ndifferent certs.\nSo setup your certificate with a script installation step and it will run\neach time when that specific certificate is successfully renewed. No need\nfor workarounds.\nOn Fri, May 11, 2018, 02:46 pollardd notifications@github.com wrote:\n\nThanks for the quick response. I'm not sure I understand the reasons but I\nunderstand the outcome.\nThe --script only runs for new certificates and not for renewals.\nI don't really want to automate removal of my certificate(s) in case the\nrecreate process fails and I'm left with nothing.\nAs my install script works when I run it from the command line I'll just\nschedule it to run once a week from the task scheduler. If there are new\nrenewed certificates waiting there it should install them.\nIf there are no updated certificates then it may produce an error but\nthat's OK if I'm expecting it.\nMy renewal script is scheduled to run every morning.\nSo I think this will be a successful work around.\nThanks\nDavid\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/PKISharp/win-acme/issues/852#issuecomment-388226838,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AKilXJAqM7UeaS8ZMmp5gLSKBVRrQJ0sks5txN9MgaJpZM4T5aMc\n.\n. There is no need to revoke a certificate unless you fear that it's private key has been compromised. If you stop caring about the certificate or want to set it up with different parameters, just cancel the renewal and start over. This won't affect any bindings or other places where you are using the currently issued certificate.. Hi David, I see two problems happening in your log. The first is your use of --centralsslstore. That's a feature that was introduced in IIS 8, whereas you seem to be running IIS 7.5. I think you'll find that removing that parameter will allow the IIS installer to work.  \n\nIf you are using that parameter because you want to control where the .pfx file is written, then consider changing the CertificatePath in settings.config instead. (Perhaps older versions of the program were less strict on checking if --centralsslstore is used on IIS8+ only, but I'm not sure about that.)\nRegarding the script that you're running, it seems worth it to debug that separately from this program. You're not passing it any parameters so it should be able to do its thing regardless of whether it's called from WACS or by you yourself. The program reports that it hasn't terminated after 5 minutes have passed, which should be enough time to do whatever it's supposed to do.\nI'm not an Exchange admin myself so I can offer little guidance there, but there is some documentation about the subject here about how do it with the included example script: https://github.com/PKISharp/win-acme/wiki/Microsoft-Exchange\nThough there is also debate about the quality of that (#832) so it might not be an out of the box solution for you. Anyway I hope you managed to solve it!. It seems like the client is unable to connect to the Let's Encrypt server. It might be hitting some kind of proxy or other network edge device. Does that ring any bells? This endpoint should be reachable and return JSON data:\nhttps://acme-v01.api.letsencrypt.org/directory\nOther options is that you were just unfortunate to hit a service disruption with Let's Encrypt. . Great!. Yes, you can configure proxy settings in settings.config, see: https://github.com/PKISharp/win-acme/wiki/Application-Settings#proxy. This stems from the design issue that there is no unique identifier for certificates other than their name, and the IISSites plugin uses that name to store its data (e.g. that long list of sites). \nThe only workaround is to split this up into multiple certificates, but IIS 7.5 won't support that. The solution I suppose can be to name the history files by a hash of their name, rather than their actual name.\nIt'll have to be implemented like that in a future version though. For now all I can suggest is trying an older version without this history feature, which would be v1.9.7.2 I guess.\n. I applied a bugfix in 1.9.11!. You're right, the problem shows up in a few places and only one of them got fixed in the 1.9.11 release.. The problem here is that the program can't find the registration with Let's Encrypt, so it finds itself forced to create a new one, which requires user input, which is not possible during a non-interactive (renewal) run.\nThe registration is normally stored in a file in the ConfigPath, called \"Registration\". There is one such file per each ACME service endpoint (e.g. staging and production). \nSo the question is, was the file there? If so, why can't the program see it? Has it been created now since you added --emailaddress? (Which, btw, should not be enough to create a registration in unattended mode as it wouldn't also require --accepttos)?. I would guess the problem is that the program finds different configuration folders for different runs, which can be because it's being run in a different context (e.g. different user accounts / logged on or not). What I'd recommend is to clean up all older folders, e.g.\n\n%appdata%\\letsencrypt-win-simple (check both your own profile and the scheduled task users' one)\n%programdata%\\letsencrypt-win-simple\n\nDon't just make them empty, but completely remove them. If there are files in there, you can copy them over to the new folder location, (i.e. %programdata%\\win-acme).\nThe Registration file should always be there, since version 0.x it's been used I think. Renewals might be in the registry, but I'd also recommend to move those to a file, see:\nhttps://github.com/PKISharp/win-acme/wiki/Migration-to-v1.9.9. I haven't seen this error before. Do you have ACLs set on your certificate store?. Yes, but the strange thing is that at the point of the crash (conversion to the other crypto provider) we're working on a locally stored .pfx file and I can't really imagine that it could have a protected keyset because it comes straight from AcmeSharp. Maybe there's an issue with the CryptoProvider itself?. Some further reading of the stack trace tells me that it already fails before the 'conversion' step, so the problem is not even in the attempt to convert a new CryptoProvider. The problem is that it finds itself unable to read back the private key from the original .pfx file (created with the default/original CryptoProvider) which it's just created for itself a few lines before. This is highly curious.\nCan you try locating the .pfx file from the ConfigPath and inspect its properties, or try to import it into a store manually? Not sure what we're looking for but Windows might give some hints about what might be wrong.. What doesn't make sense to me that IIS can read the private key (apparently) but the .NET code cannot access it (even though it generated it). Are you running the program under an account with limited access? Is there any higher level account that you could try (e.g. domain admin?).. The only suggestion I can offer is to go through the release archive and try older versions of the program and see if they work. If you hit an older version that works, we can at least narrow it down to some versions' changes. If none of the versions work, it's more likely an external factor.\nI reserve the bug label for issues where it's already clear that we can solve something  with a code change, if only better error handling. That's not yet clear to me for this one, but we might get there yet ;)\n. There have been no further comments to this issue, so I hope it's been solved. Please update us if you still have problems!. I'm afraid that --test is still not meant for unattended operation. If the purpose is to get a certificate from the Let's Encrypt staging endpoint rather than the production one, you can pass the --baseuri parameter with https://acme-staging.api.letsencrypt.org/ as value. Or did you want to achieve something else?. The only reason I could see the code failing at that point with that exception, is if the --baseuri parameter is filled with an invalid URI. Can you think of any reason why that would be the case?. I hope the issue didn't come back!. If you're not working with IIS, the IIS installer should obviously not be used. Is IIS installed (but disabled?) on the system though? Normally the program should detect that and not present certain options to you.\nI recommend cancelling this renewal and setting up a new one in advanced mode (\"M\") where you have more explicit control over installation steps and such.\n. Yes it does when you use http validation.  Since tls validation has been disabled, dns validation is the only option for when you want to close 80.. Thanks for the report, there were two serious bugs in the code that meant proxy support was completely broken.. Fixed in 1.9.11.2. I've just released another new version and immediately reported it to Microsoft as a false positive to get ahead of the issue. I'd be good to get code signing to work to prevent this from happening. We'd have to get a signed version of ACMESharp to do that though. . That's a great tip, thanks! I've updated the build script to sign the code using a self-signed certificate. Not the prettiest way to manage trust in the binary but hopefully it'll be enough to prove to AV that it's coming from the same source at least. Let's keep the rest of the discussion in the previous issue (#781)! . Thanks for the report! Would never in a million years have come across this myself :). You should be able to import the .pfx file into the Windows 2000 system and then use it with IIS.. I've updated the docs to reflect the most recent developments in the field of renewal storage. Recent versions of the program save them to the file system instead of to the registry.\n\n[Answer] file.\nIt was not created and I had to create them myself, for all 14-domains, of which was not a big deal.\n\nI'm not sure what you had to create. Did you use SelfHosting validation (simple mode?) in that case no changes to disk would be needed for validation.. This is definitely possible, but you have to run in Advanced Mode, choose the HTTP site as the target, then for install pick the IIS installer and then answer \"choose a different site to install\" with yes, pointing it to the HTTPS site.. The easiest way to do this is to choose manual host input, self-hosting validation, then IIS installer. Then you don't even need the HTTP site at all. . Going to close this due to lack of activity. Hard to say what might be the cause here, there are a lot of pitfalls with FileSystem validation (see https://github.com/PKISharp/win-acme/wiki/Validation-issues), I'd recommend you to try running in --test mode, and when it asks if you want to try to open it in your browser, try doing that (preferably from another network than the server itself). \nIt might be worth trying the SelfHosting validation if you're running IIS, that avoids many common problems.. I'm not sure whether we have any control over this.\nLooking at the code, we do send them in the user provided order into ACMESharp. ACMESharp also generates the CSR in that order, so the Boulder server (Let's Encrypt) seems to be the point where it gets mixed up. If that's the case, they'll either be reversing the order (which would be fixable from our side), or alphabetizing/randomizing (which would not be fixable from our side).\nIt might be worth some further investigation. Can you try if it's getting reversed or not?. This is already possible, either from the command line (--excludebindings) or through the UI when you create a certificate \"with advanced options\".. Have you made any changes to IIS (e.g. through the IIS Manager GUI) while win-acme was running?. That's very odd, the difference between 1.9.11.1 and 1.9.11.2 is just two checkins and both of them aren't anywhere near the IIS management code.. It shouldn't matter if it's open; I frequently test with multiple instances of the IIS Manager running in the background, as long as no changes are made by it it should be fine. This bug used to be pretty common, but I thought it'd been eliminated since we started to make sure that not more than one ServerManager can exist simultaneously. \nAny chance of a PowerShell/WMI-script or other tool (Puppet etc.) interfering?. I'm going to write this off as an issue on Microsofts side then :), thanks for the feedback!. The default validation method (SelfHosting) doesn't work when Apache is running, you have use advanced mode and choose FileSystem validation.. This looks like a nice addition to the program \ud83d\udc4d . I'm going to review it in detail soon and intend to merge it for the next release.. You don't need to have two scheduled tasks, there is one task that checks all certificates that you previously created and (only) those that due for renewal are renewed. So just basically just create the second certificate and don't do anything else :). It would be helpful if you could post the output that is written to the screen when you renew the certificate. Then we can determine why it's not working the way you expected it to work.. It seems like you haven't set up any installation steps for these renewals. How have you initially created them? Manual input I guess? The program will not try to update IIS unless it's told to install to IIS. You should re-create the certificates in simple mode (which automatically sets up IIS installation) or use advanced mode and select the IIS plugin when it asks for installation steps.. Here are the parameters for IIS installation: https://github.com/PKISharp/win-acme/wiki/Installation-plugins#iis-web\nIf you want to try if it works without waiting two months you can just force a renewal by the way \ud83d\ude04 from the command line --renew --forcerenewal or from the GUI \"renew specific\".. Connecting Window Server 2003 to the internet is highly dangerous, as it's not gotten any security updates for over 3 years. Beside that, it doesn't run .NET Framework 4.5, so it's just not going to work natively. Proxying as @LBegnaud suggested would be nice stopgap before you can upgrade that system.. The core of the matter is this\n\nConnessione sottos tante chiusa: Impossibile stabilire una relazione di trust per il canale sicuro SSL/TLS.. \n\nI think you might have disabled protocols some or cipher suites that a required for your server to be able to communicate with the Let's Encrypt API. I'm not sure which ones are required to be there, but you should definitely try to roll back some of those changes.\n. --certificatestore can only be used to specify the name of a Windows Certificate Store, not a file system folder. \n--centralsslstore is a feature meant for IIS, where the program copies the *.pfx files (one per domain) to a file system location.\nI think what you are looking for is the CertificatePath in settings.config. If you change that then all files related to the certificate are written there. \nSee also: \nhttps://github.com/PKISharp/win-acme/wiki/Command-line-arguments\nhttps://github.com/PKISharp/win-acme/wiki/Application-Settings. Have you restarted the application after making those changes to the .config file? And are you sure you didn't change settings_default.config instead of settings.config? Can you post the log in --verbose mode? I'd be curious to see if it does pick up the ConfigPath. So the only way I can reproduce this issue is if I create two entries in the config file for ConfigurationPath (or CertificatePath). The program will use the last one. So if you put yours at the top, then they will be overruled by the default values further in the file.. The command line you proposed should work actually, so it's seems you are more pro than you think :)\nWhen unsure about the command line, you can also run the \"GUI\" and create a new certificate with advanced options (\"M\" in the main menu). That will ask you all the relevant questions.. The issue appears to be with the example script that you copied, the parameters that are passed by the program are exactly what I would expect based on the documentation (see: https://github.com/PKISharp/win-acme/wiki/Validation-plugins#script).\nI don't really understand what is wrong with the script or how it could be fixed to be more robust, but I hope it's obvious that we cannot just change the parameters that are passed without causing headaches for people who have already deployed this.. Hi Arun, please try without http://, that's a protocol identifier in a URI, but not part of the host name.. Hi Arun, I just noticed that your hostname appears to be non-public, but Let's Encrypt only works for public domain names. The real issue though seems to be that your server is unable to connect to the Let's Encrypt server. Can you get to https://acme-v01.api.letsencrypt.org/directory with a browser?. I don't personally agree that it's the main reason to check the log, but it doesn't hurt (much \ud83d\ude04) to scroll through it either. I can imagine for people with tooling to centralize event logs from multiple servers this would be easier than logging in and running the tool.. That's curious, the exception reads \"Valid entries are \"NT AUTHORITY\\SYSTEM\", \"SYSTEM\", \"NT\nAUTHORITY\\LOCALSERVICE\", or \"NT AUTHORITY\\NETWORKSERVICE\".\"\nBut \"SYSTEM\" is exactly what we use.\n_log.Debug(\"Creating task to run as system user\");\n                            task.Principal.UserId = \"SYSTEM\";\n                            task.Principal.LogonType = TaskLogonType.ServiceAccount;\n                            taskService.RootFolder.RegisterTaskDefinition(\n                                taskName,\n                                task,\n                                TaskCreation.CreateOrUpdate,\n                                null,\n                                null,\n                                TaskLogonType.ServiceAccount);\nI'm wondering if this is a bug in the latest version of the Task Scheduler library that we are using. Can you try v1.9.10.1 or before to check if those work?. Did this happen the first time you create a certificate, or did you try to replace an existing task?. Hi @tgice, thanks for the feedback! Interesting that you got it to work on Windows 2008. According to Microsoft themselves .NET 4.6.1 is not supported on that version of the OS, but I guess this means that they don't stop you from installing it anyway. \nThe creator of the Task Scheduler library that we use was unable to reproduce the issue we are facing (I provided sample code), so the bug hasn't been fixed. Good to know that there's at least a viable workaround.\nOne other thing: manually you should be able to change the scheduled task to run with the SYSTEM account. WACS doesn't really care which credentials are used, as long as it has administrative rights.. Yes there is. You can set it globally using the config file:\nhttps://github.com/PKISharp/win-acme/wiki/Application-Settings#certificatestore\nOr for a specific certificate, but that only works from the command line (or by editing the Renewals json manually):\nhttps://github.com/PKISharp/win-acme/wiki/Command-line-arguments#store-guide. Thanks for the answer @webprofusion-chrisc!\n@iisuser the certificate cache is the CertificatePath folder, so yes it is where you'll find the .der and .pem etc. as well. If you can't read from that folder you there's something fishy going on with permissions and I'd recommend you to figure out what that is.. If you're taking the programmatic route, then I would just call out to letsencrypt.exe with the right parameters after you create a new binding. GUI support for this task is not going to help your program in any case.\nBut I'd also like to point out that SAN certificates are update with new bindings during renewal. So instead of creating separate certificates for each host you can actually create a single one and force a renewal when the bindings change. (The force is needed to renew before the regularly scheduled date).. This should help you get started https://github.com/PKISharp/win-acme/wiki/Target-plugins#iis-binding. Hi Spongeman, there are two ways to set this up using the command line or advanced mode. You either enter the hostname manually or choose your HTTP site as target. Then choose the IIS installer and point it to your HTTPS site. I'd also recommend to choose SelfHosting validation, which is much more reliable than FileSystem validation.\nTo change the settings of the renewal, cancel the current one and re-create it. This won't affect the existing certificate.\n. That's a great question, and the answer kind of depends one which potential risk you're trying to manage. \na) Malicious developer\nb) Benevolent but compromised developer account\nc) Compromised (re)distribution channel\nAgainst (a) your only option is to read the source and build it yourself.\nStarting from the next release I'm going to sign the executable, though that will just prove that it's been built on my computer, somewhat defending against (b). Ideally I'd like to get code signing set up in AppVeyor, so that it doesn't depend on me personally.\nI don't really see the point of posting hashes to GitHub, while in theory I could help with (c), since both the binaries and hashes would be editable with the same account information, so in practice it would be trivial to bypass. (And for non-malicious corruption the .zip format has its own crc check.)\nIf you have other ideas on what could be done then I'd like to hear them, because trust is obviously an important factor for this kind of program.. That is a nice offer Chris! I've looked into AppVeyors options a bit more and it seems possible to set up code signing by including a password protected certificate in the source tree and keeping that password locked up in AppVeyor (where admins can see it, though). It doesn't feel like very solid security to me. I wonder how other open source projects solve this kind of problem, should look into that sometime.. I've set up AppVeyor to sign the .exe using a .pfx file embedded in the source tree. The .pfx is protected with a strong password (100+ bits of entropy), stored as an encrypted environment variable in appveyor.yml (which is also in the source tree). \nSo there are two vectors of attack if someone wants to brute-force their way into the certificate. As said before not very secure, but running a private signing server (nice project btw, @Daniel15) would probably not be free and it would depend too much on one person if it's just a hobby thing. \nI am thinking of offering paid support for WACS to businesses so maybe if that takes off I can invest some more. . My idea is not to put any limitations in place on the software, mostly because I don't feel that it would be fair towards other past and future contributors. But the support would be provided by myself so that's where I can differentiate to create some price points (e.g. e-mail vs. phone support).\nAnyway, back on topic: I'm also planning to look into verified commits.. Thanks, that's a useful example!. Another common reason for this exception is misconfigured IPv6. If you publish AAAA records for your domain you have to make sure that your site is really available through IPv6.. It really depends if you're using the F5 to offload HTTPS or if it's handled by the servers in the pool themselves. In the latter case you should probably use the Central Certificate Store feature of IIS, see https://blogs.msdn.microsoft.com/kaushal/2012/10/11/central-certificate-store-ccs-with-iis-8-windows-server-2012/\nYou can create the certificates while running WACS with the --centralsslstore parameter pointing your your CCS path. You should also point the ConfigurationPath in the settings.config of WACS to somewhere on your SAN, so that any member of the pool can potentially renew the certificates. I don't know if you're going to build an actual cluster, but in that case a Clustered Task instead of a regular Scheduled Task could be useful for reliability running WACS. Otherwise I'd just configure Scheduled Tasks on different machines at different times, e.g. one at 4:00am and the next at 5:00am.\nIf the F5 is going to do offloading then I can't help much, you'd have to use their API and call into that from a .bat/.ps1/.exe, like this: https://github.com/PKISharp/win-acme/wiki/Install-Script. You are right that some work has been done in that area, but it's not quite mature enough yet for the \"Simple Mode\" to automatically make all the right decisions, so you'll have to dive into the \"Advanced Mode\". That's really not that advanced, but just makes things more explicit.\nWhat you have to know is that there are four stages for each renewal:\n- Target (this part doesn't list FTP sites)\n- Validate\n- Store\n- Install (this is where we added IIS FTP support)\nSo in a nutshell, to get it working, you have input the target information (host names) manually.. I just realized that there's a stupid bug in the FTP installer plugin that caused it to only be available in IIS10, even though it should work perfectly well on IIS8(.5) too. That will be fixed in the next update.. Hi Rob, this looks like a pretty common misunderstanding. When you use --renew none of the other parameters have any effect. The rest of the parameters are there for setting up new renewals but don't affect existing ones.\nIf you are not happy with the parameters that you initially picked when setting up a certificate, you can re-create the renewal (optionally cancelling the old one first, though it will overwrite). The other option is to edit the settings in the Renewals file which you can find in the ConfigurationPath.\nIf you are 100% sure that KeepExisting is actually set for the renewal (easy to verify by choosing \"List scheduled renewals\" and then \"Show details for renewal\" from the menu) then we can dive further into this.. Try using an external service to validate connectivity, e.g. https://www.ssllabs.com/. I just tried to reproduce this issue but could only do that when I not only moved the binding, but also assigned a different certificate to it. This might have been by mistake (e.g. older version or mis-click) or on purpose (e.g. wanting to keep SAN-certificates matching with IIS site bindings, creating a situation where multiple certificates 'fit' the same binding). Could one of those be have been the trigger?\nWhen the original certificate is left assigned to the moved binding, renewal does succeed without nasty side effects, at least on my machine :)\nIn any case we shouldn't cause IIS to stop websites, so I will mark this as a bug regardless of any preceding mishaps.. You are right that shouldn't happen, but I'm also not able to reproduce it on the latest version. Some bugs that may have caused this were fixed in 1.9.8.3, are you sure that this situation with the duplicated renewal didn't exist already before the recent addition of the SAN name?. Hi Alex, I just tried again, but I just don't see it happening in the latest release. It would help me to find and fix the issue if you could reduce your bug report to the simplest possible configuration/script that triggers it and then submit that.. Converting the private key is actually already done by the time \"Set private key exportable\" is logged. The delay seems to be reading back the certificate from the file system, just after it's been streamed out it. What might be happening is that some OS service (antivirus? backup? distributed storage?) is still busy flushing/examining the file before it allows the program read back from it.. I can add some more verbose messages around the relevant calls but it's not much more than File operations I believe.\nHave you tried using procmon to monitor for any file system activity in the relevant paths?\nhttps://docs.microsoft.com/en-us/sysinternals/downloads/procmon. How are you writing the log output to files? If you use the SeriLog configuration it should be possible to add a timestamp that way (though I admit that I don't know exactly how, the framework seems powerful enough to allow it...) See: https://github.com/serilog/serilog/wiki/AppSettings as a starting point.\nAlso there are timestamps available in the Windows Event Viewer (though obviously not in huge detail because only select messages are logged there).. That is what I was afraid of, you are piping the screen output to a file. That means that in order to add timestamps for your output, they'd have to be visible on screen. I'm not sure that wouldn't want to display them everywhere all the time, but it'd also be difficult to point out beforehand where they would be useful or not. \nI think a custom Serilog config is the best way to go if you want detailed performance diagnostics, though unfortunately I don't have example configs available. Perhaps someone else can chime in? . Thanks for the example @davidpeden3! I created a wiki page https://github.com/PKISharp/win-acme/wiki/Advanced-logging so we can close this issue for now.. Maybe it sounds strange or untrustworthy, but Nuget.org is not exactly a random source, it's the standard package repository of the .NET world, run by Microsoft themselves and used as the primary distribution channel by the Serilog project. If we were to include some of these .dlls, this is exactly where they would be coming from.\nThere are direct and indirect costs associated with added third party dependencies into a project, and the list of Serilog sinks is long. I would consider adding one or two by popular request, but it won't be all of them for sure. So put in your votes for the one(s) you'd like to see!\n. > All files needed should be part of the project here. \nIt all depends on your definition of \"needed\". The software works perfectly fine without support for 30 advanced logging targets. These are options for advanced users who don't mind to tinker a bit.. @jochenwezel we are not talking about the assembly references that you found, all of those are of course included in the download (embedded in wacs.exe). So you don't need to download anything extra to run the program.\nWe are talking about additional plugins for Serilog, that can be configured by fiddling with wacs.exe.config.\n\nAs a suggestion: maybe it makes sense to always publish 2 releases: a \"light\" version as currently and a \"full\" version containing the additional DLLs.\n\nThat only addresses the concern of download size, which is a minor one in my opinion. The bigger issue is testing and support.. I think you mean this one: #778. I think that's a good idea to open a new case. Let's separate the concrete feature idea from options around custom logging.. I think he knows that, but still feels that it should become a standard feature. I don't want to reopen #778 or this one because frankly it would confuse anyone. So let's have a new issue where we can have a to-the-point discussion and people can express their interest.. The standard logging works out of the box. This question is if \"standard logging\" should include files. Currently, it does not. An issue can be opened to discuss if that should change. . It's only unexpected if you skip part of the instructions on the Wiki. We already know that you don't like downloading extra files to enable extra features, so either open an issue to make file logging standard, or otherwise let's just agree to disagree.. Thanks @EricQTI, the way you describe it is best practice as far as I know.. Also see #893 for some tips.. Made a wiki page about it: \nhttps://github.com/PKISharp/win-acme/wiki/Load-balancing\nI hope you managed to solve your connection issue sl4cky. Can have many reasons at the network level and OS level, but there are better places than this to get help for troubleshooting fileshares/IIS.. It's only possible by re-creating one of the certificates. It will overwrite the existing settings (e.g. if you do it the same way, nothing will change) and then detect the missing task and re-create it.. That's pretty annoying, especially that IIS becomes unresponsive because of this. Can you give an indication of how many sites and bindings you have running on this instance? Did those numbers increase a lot recently? Are there a lot of stopped sites? Lot of unusual bindings? e.g. FTP/DAV. I hope the issue resolved itself!. duplicate with #464 . I believe this has been fixed already in one of the more recent releases, so I think it's worth testing with the latest one.. I think the application manifest won't allow you to run as non-administrator. The admin rights are required to be able to manage IIS and the certificate stores. It's possible to use some parts of the program without admin rights, but it would lead a lot of issues opened here from people who forget to run under a privileged account when we remove the requirement from the manifest. (I say that with certainty because it was like that for a while \ud83d\ude04).\nAnyhow, if you're good with code (which you probably are, building API's and such), you may want to consider borrowing some of the source, or even just building your own version without the manifest included.. It sounds like you created the task manually, perhaps it's better to have the program create it using the default settings - by (re)creating a certificate with the program. I never heard of this problem before so it must be doing something right :).\nThere's a lot of Google results about the message so it seems like a common issue with Windows Task Scheduler in general.. Yes, that should work. Sorry for the late reply!. The next release will have an option to create the scheduled task from the menu.. You should be able to extract that from the ConfigurationPath, which is most commonly C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org. There's a file called Registration there that hold everything we have on the Let's Encrypt account.. Yes, that should work!. I think the email explains itself pretty clearly. You issued certificate running with --test and Let's Encrypt is letting you know that at this time - had you issued a real one and not renewed it yet - they would have reminded you.. No the only way this could have happened with this program is with --test. Though it's entirely possible that someone else did it, or some other Let's Encrypt client. There is no verification of the email address and the emails are not under the control of the ACME protocol nor this program, it's just something that Let's Encrypt does. In any case I wouldn't worry about it. Test certificates are not valid in any browser or other software, so you would know if you had them running anywhere!. You probably went a bit too far tuning the TLS settings on your machine. \nCould not establish trust relationship for the SSL/TLS secure channel. means that you don't have any combination of algorithms in common with https://acme-v01.api.letsencrypt.org/. Try allowing more until you can access that page from the browser on the server and then the program should work too.. Yes, the version of Microsoft.Web.Administration that we depend on requires .NET Standard 1.6, which requires .NET 4.6.1. The last version of this program that runs on Windows Server 2008 is v1.9.7.2\nhttps://github.com/PKISharp/win-acme/releases/tag/v1.9.7.2. You can set up your renewal so that it runs a script after doing the IIS step. The correct certificate can be found based on the parameters passed to the script, such as the path to the .pfx file and the thumbprint. It's a bit more tricky to get Powershell running, but luckily there are examples.\nCheck out these Wiki pages:\nhttps://github.com/PKISharp/win-acme/wiki/Install-Script\nhttps://github.com/PKISharp/win-acme/wiki/Example-Scripts. In general win-acme doesn't change the binding flags for existing bindings. It sets SNI for any new bindings it creates, but doesn't force it on when it's updating an existing one. \nWhen we detect that an other site is using a previously issued Let's Encrypt certificate, we update that to the new certificate as well, so this can only happen during a first-time setup.\nIn this case we would be able to detect that not turning on SNI would cause problems, so I think we should turn it on when:\n\nwe're issuing for the first time\nthere's an existing https binding\nthe certificate on the existing binding is also used by another binding\nthe existing binding is not using SNI\nthe other binding is not using SNI\n\nThese are pretty specific circumstances but it's a problem nonetheless.\n. This will be fixed in the next release.. I would suggest trying using the advanced mode (M) since the normal/simple way to get certificates (N) is really just meant to work with IIS. The N option is unavailable when IIS is not detected, but it seems it gets confused because you have it installed but not running or without any websites. I'll mark this as a bug because you're right that the error should be handled more gracefully.\nYou can uninstall IIS by removing the `Web Server' role from your Window Server, by the way. . The script installer works by launching a process and capturing data from stdout and stderr. \nWe collect the output in a buffer and log it (to screen and event viewer) after the process has exited or timed out. Your observation seems of only getting the timeout without any further messages seems to indicate that no output has been generated at all. You also indicate that the script doesn't seem to have run, so it really looks like it's very slow to start up or gets blocked for some reason.\nThere are some ways in which launching a script from the code vs. running it from the command line. No window is created, output is redirected and it uses CreateProcess rather than ShellExecute.\nI tried to reproduce the issue and couldn't on my machine, I just got the expected output after a short time. Can you try perhaps a very old version (1.9.6)? From 1.9.7 onwards there were some changes to how the process was launched.. Closing this due to lack of updates :). It looks like the Let's Encrypt service is unable to access the domain on port 80, while it's working locally. Is it possible that outside traffic is going through some kind of proxy?. Most users would run the tool on the same machine that hosts the website. \nIf you want to run from another machine, you can look into DNS-based validation, or use FileSystem validation and have the program write the validation file to a network path. . The thing is that Let's Encrypt only works on port 80, so you will have to serve the validation response from the server that responds to port 80. \nThere is more than one way to get the validation file from one server to the other (ftp, networkshare, etc.) or you can go the other way and generate the certificate on the server that listens to 80 and then move the .pfx to the other one.. You're welcome!. Hi bavta, the last release for .NET 4.5 was 1.9.7.2, see also #913 for some more explanation and link.. Thanks for pointing that out. I'd really like to get AppVeyor working with the GitHub integration and everything but it's not nearly as easy as I hoped it would be. Would you mind providing some hands-on help? I can give you access to the AppVeyor account.. Could you post or send me your e-mailadres? You can twitter DM me at @wtinus. Linked to #890. Hi @C0nw0nk, the error that you see is due to invalid XML; the <value> tag is not closed properly, where you put <value /> it's supposed to read </value>.\n\nAlso why is it when we run letsencrypt.exe options to delete certificates / domain names from its database is not an option all we can do is revoke not remove them from the listing all together.\n\nThe option in the menu is called \"C: Cancel scheduled renewal\". It's not called \"delete\" because it doesn't actually delete anything. The certificate will simply not be renewed and expire naturally. \n\nAnd a feature of custom renewal time would be nice so when we run letsencrypt.exe it allows us to change options of renewal time from 55 days to 15 days for example for each domain listed.\n\nAlready there, in the same file where you changed the CertificatePath :)\n. Thanks for the feedback! This is the central issue to track ACMEv2/wildcard support, please refer there for future updates: https://github.com/PKISharp/win-acme/issues/464. Not really. There is some hacking possible, but by far the easiest way is if you just request another one using this tool. That's the great thing about Let's Encrypt; the certificates and accounts are pretty much disposable.. The code assumes that you are managing the registrable domain, e.g. xyz.de via Azure. It doesn't support the case where you're only managing the subdomain. I think your only workaround is to manage the DNS through Powershell. \nhttps://github.com/PKISharp/win-acme/wiki/Validation-plugins#script. Are there though?. Then you can choose a \"SAN certificate for all bindings of multiple IIS sites\".. Duplicate with #933 I guess, so I'll close this.. > No options for Webdav, SFTP of FTP etc I need FTP verification\nSince the program has already established that your target is a local IIS site (since that's what you picked) it typically doesn't make sense anymore to offer FTP verification. Can I ask why you want to use that?\nAs a workaround, you can choose a manual target (\"Manually input host names\"), then all cards will be on the table for validation.. So you're forwarding port 443 but not port 80? Any reason why you can't just do that?. Hi @gabrielpotumati, it looks like you either moved around bindings (from one site to another), changed webroot paths or maybe even deleted sites between creating certificates and renewing them.  I see different problems happening in just this screenshot and it's kind of hard to zoom into one particular issue here, but in general it's necessary to apply some 'hygiene' when using IIS and WACS; if you make some changes on the IIS side, you have to make sure the WACS renewals are updated as well. \nYou might want to run in --verbose mode and run individual renewals to focus on specific issues. . We are tracking ACMEv2 support in #464 . It sounds like the best solution would be set up two renewals: one for the main site and one for the \"redirect\" site. There are other ways to do it (because WACS tries to be clever about whether or not to update or create bindings), but as a rule of thumb it's easiest to have one certificate for one IIS site.\nYour event viewer and description of the issue seem to indicate that you have not set up WACS to manage IIS bindings for you. My guess that is that you manually input the host names and then manually applied the certificate to the bindings. That's all fine, but the spirit the program is such that it doesn't try to automate things that you haven't let it do in the first place. That why it hasn't tried to update your bindings.\nThe idea behind that is that if the automatic update of IIS is going to fail, at least it'll fail immediately while you're already logged into that server, ready to take action, instead of at some unexpected date during a scheduled task. Of course you can always try first on a seperate testing VM or a set of testing websites.. Hi Mats, I just realized that I didn't get back to you on this follow-up question. In case you haven't figured it out yet: WACS automatically detects new host names on each renewal, so you can force a renewal after you add a new binding and you should be all set.\nThere is no way to add extra exclusions though through the menu or command line (short of re-creating the certificate), but that can be done by editing the renewals file.. You may have to install a new version of the .NET Framework, at least v4.6.1. Marking as bug because there should be better error handling.. Is anyone able to test this with 2.0?. I tested on a Windows 2012 R2 VM and got a decent error message.. Unfortunately key reuse is not supported by WACS at this point. Let's Encrypt does support it, but it hasn't been implemented by this client. We do however support calling a script after each successful renewal, which may allow you to update the DNS records automatically. See this Wiki page for details:\nhttps://github.com/PKISharp/win-acme/wiki/Install-Script. Key reuse should be possible now with 2.0 because we have full control over the CSR and could reuse the previously generated key pair.. Thanks for reporting this; I've added a note of caution to the 1.9.12.0 release pending investigation of this issue. . I think you've hit an edge case with the default binding, I will investigate.. This edge case should also be fixed in the next release.. >  Though I still have both single certificates in my certificates folder, so this is not a SAN certificate? or is it?\nSounds like you're using (or at least configured) a central certificate store. IIS requires a .pfx file whose name exactly matches the hostname for that to work. So for SAN certificates, a copy is made for each alternative name.\nGlad you figured the rest out on your own!. Hi @anvaya, this looks like a duplicate of #942. For now I recommend rolling back to 1.9.11.2 if this affects you.. > Why didn't IISBinding work?\nI'd guess because there are no specific host names configured in your IIS bindings, but you are relying on a catch-all binding (which is the standard behaviour for the Default Web Site). WACS then has no way to know for which host names it should request a certificate, so it throws that error.\n\nWhat's the correct command line to manually bind existing cert to additional port?\n\nI'd recommend you to manually create the :7299 binding and link it to the generated certificate. Upon renewal WACS will update any binding in IIS using the previously issued certificate. \nSome background: on installing a certificate to IIS, the program tries to make sure that all DNS names are in some way accessible through HTTPS, but it heavily prioritises the existing configuration, assuming admins set it up in whatever way for good reasons. Adding a new binding to a website is actually a last resort method for WACS, because it can potentially cause different kind of problems.\nThe --sslport parameter determines which port to use for any SSL bindings which are newly created. Because it finds the existing catch-all :443 binding it's already satisfied that the host names reachable, and doesn't take further action.\n. If you are - or started out with - using an older version of the program, the list of configured certificates might be in the registry.  This should help you locate the key and move it to the new server. I'd recommend to start using the file-based method, rather than re-importing the registry key.\nhttps://github.com/PKISharp/win-acme/wiki/Migration-to-v1.9.9. > Currently, we've exported certificate as pfx file and imported it on the new box.\nThat's good!\n\nIf I just launch letsencrypt.exe and request a new certificate as you describe, what happens to the currently imported certificate?\n\nThe bindings in IIS will get modified to point to the newly issued one.\n\nHow does this work when you request a new certificate with an existing old certificate?\n\nLet's Encrypt doesn't care about old certificates. There is not really any meaningful difference between a renewal and new certificate. This program cares a little bit, because it will try to clean up the previously issued certificate from the store. That's mostly for cosmetic reasons though and it doesn't hamper operation if the old certificate remains there.\n\nTo clients who use our website (the new certificate will have a different issue date and potentially something else (some signature), will they not become suspicious of it and potentially harm server behavior due to this change)?\n\nIn theory that's possible if you have paranoid clients, but you would have run into those issues already if you're a long time Let's Encrypt user, because it's been happening roughly every 55 days.. Going to close this because there haven't been further updates, but feel free to chime back in if there are!. Thanks for the contribution, always nice to get some help! I requested one change for backwards compatibility reasons. When that's done I think we can merge this in.. You cannot change parameters for existing certificates during a --renew.  You will either have to make the change manually (by editing the renewals file) or re-create the certificate with the new webroot.. That is very strange, especially in your case (not using IIS) there is no mechanism that can detect a web root  change. What does raise a yellow flag though is that you mention X:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org.  I might be a typo, but in your screenshot it shows the program is reading from C: not X:. Another theory might be that you are changing the Renewals file while the program is running. When it's running its working from an in-memory cache that's written back to disk from time to time, so that might also explain the reversion.. No, there is no service running. The only options are that the Task Scheduler has an instance running or it's on your desktop in a console window. Either way it should be visible from the Task Manager and you can terminate it. I can't explain why the file would change, even if the program would decide to change the webroot (as is possible for IIS) it would be logged on the screen. Any chance you have more than one copy of the program on your machine?. The scheduled task will be at the root of the Task Scheduler Library and the name is \"win-acme\" followed by the name of the Let's Encrypt endpoint, typically \"httpsacme-v01.api.letsencrypt.org\". If it's not there then I'd recommend you to re-create the certificate and keep a copy of the output, to post here if it doesn't create the task again.\n. I'm also hereby proposing an enhancement to add an option to check/create the scheduled task from the main menu, as this (type of) question came up before.. The latter. Renewing doesn't do anything with the scheduled task (because it's typically done by the scheduled task :)).. I just checked and I was mistaken with my first answer. Recreating the same certificate will not work because the program detects that it already exists, therefore doesn't consider it new, and therefore doesn't try to create the scheduled task. \nYou either have to create another certificate, or cancel this renewal and then recreate it.. The next release has a menu option to create the scheduled task.. There is no text log, just the console and the event viewer. You might pipe the console output to a text file if you're running unattended and you want to save a text log, but that won't help for interactive runs. \nEvents are logged to the \"Application\" log. You can filter by source \"win-acme\" to group them together.. Refer to #901 for the issue that tracks the enhancement for advanced/custom logging options.. You either have to set up a (http) binding in IIS, or use advanced mode (\"M\") to input a host name manually.. I'd recommend creating a new certificate in --test mode (of course without installing it), because then it'll pause after the \"Answer should now be browsable...\" step and offer to test the availability of the answer file via the local browser. If it works in a local browser you should also test a remote browser, because often people run into issues because of reverse proxies and such.. I'll refer to #464 !. Sounds like a virus scanner intervening. Which version did you download and which virus scanner do you use?. v1.9.12.1 just submitted to Microsoft, hoped the code signing would maintain trust, but apparently not.. Going to close this and refer to #781. It's not a bad idea to add this. Automatic renewal would obviously not be possible, so there'd have to be some extra plumbing to make sure nothing goes haywire because of that.. This will be in 2.0 to support testing wildcards. The new TLS challenge is interesting, I'll also have to look into that. Did you already have that on your radar @ebekker?. You can try this feature in the latest alpha build.. I don't know what you mean by pan domain names, can you elaborate?. I accepted #959 instead of this PR, because it's supposed to solve the same issue and our resident expert considers it a better solution. If you disagree on either of those please discuss! And thanks for contributing, it's always welcome to have more eyes looking at the code!. This is odd, it looks like something is wrong with the way your renewals are stored. Can you share the content of your Renewals file in the ConfigPath?. I would suggest cancelling the renewal and recreating it.. It might have something to do with the SelfHosting plugin not being able to claim port 80 for itself. In that case use the FileSystem based validation.. Nice to hear that it worked out!. Hi @SylwesterZarebski, sorry for misinterpreting your message. We don't have to wait two weeks to test this though, you can renew at any time by going to the main menu, choosing \"Renew specific\" (S) and selecting the one that you want to try. Please let us know what it does.. Any updates?. I'm going to close again because there has been no news for 3 weeks and also because it's about a possible bug in 1.9.x which I'm not planning to support anymore. If the problem comes back please try if the latest 2.x.x release does any better.. I think this is a duplicate of #954 . For FileSystem validation issues I recommend going through these steps:\nhttps://github.com/PKISharp/win-acme/wiki/Validation-issues\nSpecifically check for IPv6, firewall and IP restrictions\n. It seems like for whatever reason the client is unable to read the history for the certificate. That's not supposed to be a fatal error but I located a piece of code with a missing null check that can cause this error. For now the workaround should be to locate the history file in the ConfigPath and delete it, as it's not required to have it.. Please clarify; did it not create the binding in IIS the first time? Or did it create the binding but you were unable to get a connection?. I would appreciate if you could try to reproduce it with the latest version and post the output here. That might give some hints about what went wrong.. Copy-pasting the whole screen output would be good. Also maybe the before and after of the sites binding list.. Were you able to reproduce the problem?. Can you check the history for the renewal? You can access that through the menu by listing the renewals and then choosing the number for \"show details\". I'm curious if there are errors there.. So there has not even been a (recorded) attempt to renew. Can you confirm through the history of Task Scheduler and/or logs from Windows Event Viewer that the scheduled task has run between 2018/11/7 and 2018/11/22? Did it report any errors?\n. Any updates on this issue?. Good to hear! Please let us know if you run into any other problems.. Looks good and I'm sure it's going to be useful for people! Thanks for the contribution!. The message actually suggests that IIS will serve the new certificate after the Application Pool recycles. That piece of text has been there since before I started contributing and I don't believe it actually holds true for Server 2012+, but it might be true for Windows 2008. \nI think your idea to run iisreset after letsencrypt.exe via the scheduled task is not so bad, but mind that it will then reset regardless of whether it's needed or not. Also make sure that it's scheduled for a time when it's least likely that users are active, because by default it happens at 9am.\nYou can also configure the Application Pools in IIS to automatically recycle at set times or whenever they detect no activity for a while.. Correct. I've updated the Wiki https://github.com/PKISharp/win-acme/wiki/Installation-plugins - it doesn't make sense to ever start running installation steps for a failed renewal.. It's a good idea and should be doable. I think your proposed approach makes sense. If an error is logged to the screen, then it should show up for scripts/task scheduler history etc.. On further examination, there are quite a lot of error entries that are already covered by higher level functions, so it would be kind of wasteful to sprinkle ExitCode setters all around. Perhaps the better solution is to make sure that all errors actually require human attention and end up throwing exceptions, while \"errors\" that can be handled gracefully are demoted to warnings. \nDo you have concrete examples of cases where something failed and you still got a 0?. I just streamlined things a bit, this should get most if not all problems related to certificate creation and renewal.\nhttps://github.com/PKISharp/win-acme/commit/3c2f646afd6ce523b21fc2e39a22bbc710735501. So let me get this straight; \n\nyou are automating WACS by sending keystrokes to its console window, so any change to the menu structure would break your application\nyou don't want to learn the documented command line options\nyou think that hiding a menu option which would surely lead to an error or crash is bad practice\nyou want me to put it back with a warning, only so that your automation will fail milliseconds later\n\nCan you see how unreasonable this request is?. I think I see what the problem is. When creating the renewal, the program is asking you to give it a path. However that path is not used while executing the validation.\nInstead, it's using the paths it finds in IIS for the chosen sites (i.e. the webroots).  Can you confirm that the files are created there?. Can you try with the 2.0 alpha please?. I'm going to close this because there hasn't been activity for a while now. Please try with the latest 2.0 release and report back if there are any issues.. Actual random number or user-configured number? There is a command line option for the latter, which I'm guessing you just found as you closed the issue ;). I think the best option is to set it up for IIS first (manually changing the port) and then point Apache to the *.pem version of certificate in the CertificatePath (under %programdata% by default).\nIf you want this kind of things to be set up automatically there are also options, but I'm guessing this is more of a one-time thing.. I'm sorry but I'm not very familiar with Apache. Here is a guide though:\nhttps://github.com/PKISharp/win-acme/wiki/Apache-2.4-Basic-usage. Good catch! I've made the change in my own branch because there was another thing (ACMESharp link) that needed updating. . Are you sure about that? This page says that Exchange 2013 CU21 and Exchange 2016 CU11 support 4.7.2\nhttps://docs.microsoft.com/en-us/exchange/exchange-server-supportability-matrix-exchange-2013-help\nI'm using a new feature that was introduced in 4.7.2 to generate the SAN extension for the CSR (the AcmeSharpCore library doesn't handle that anymore). I could fall back to BouncyCastle and/or direct manipulation of ASN-data, but I'd rather not add complexity when it's not needed.. Another reason to stick with .NET 4.7.2 is its improved support for EC crypto, which I currently am not able to get working yet, but it's supposed to. . I'm sorry but I'm going to have the shut the door on older .NET versions, since we also need the extra API surface for ECDSA certificates.. We use Serilog, which a similar options ( https://www.nuget.org/packages/serilog.sinks.Email ). It requires fiddling with letsencrypt.exe.config though to set up, see #901. It could be worth to add this to the default though.. This will be in 2.0 natively!. Check out the beta 1 for those interested. The SMTP settings have to done according to the docs in https://github.com/PKISharp/win-acme/wiki/Application-Settings\nFurther suggestions welcome.. There are a couple of scenarios here:\n1) The application requires you to manually point to a certificate file. Those can pointed to the 'randomly' named files, as they do not change on renewal. The names are funky like that because they are required to be unique, so they don't change even if all the properties of the certificate do. You may change the ID of a renewal (and thus its filenames) by manually editing the .json but then you assume responsibility for their uniqueness.\n2) The application automatically maps file names to host names, much like IIS does with its Central Certificate Store. For IIS we make a properly named copy of the .pfx version of the certificate for each domain name in the SAN set. \nThe second scenario would not be very hard to add for the .pem files, as we already have the code in place for the .pfx versions. But which is your scenario?. For scenario 1 I'm going to add a check that tests if the renewal stored in xxx.renewal.json actually has the id xxx configured. That way the file system is going to help enforce uniqueness :). Thanks for helping with the testing, especially interesting to get some done on Windows 2019 since that's not in my own fleet yet. This was a dependency injection bug though, so nothing specific to 2019. I will be fixed in the next build.. This is fixed in the latest alpha.. I think we should create a repository of DNS plugins/scripts that people can pick and choose from. I'm actually considering to remove the Azure code from the main project and move it into a seperate plugin/download, but I haven't figured out what to do with the command line options yet. Might have to switch to a different parsing library to support plugins as the current one doesn't quite provide the level of flexibility required ( https://github.com/commandlineparser/commandline/issues/60 ).\nAdding a native plugins for each possible DNS provider would get kind of 'busy' in terms of menu options, command line options and also project dependencies (the aforementioned Azure plugin pulls in quite a lot of other packages).. This is a good candidate because of the fluent API: https://github.com/fclp/fluent-command-line-parser. Thanks Chris for your insight! \nacme-dns looks like a very interesting project, I think that should definitely be supported by WACS. \nPosh-ACME deserves at least a mention in the documentation for people considering to write their own script. I'd have to look into it more to see if compatibility would be possible.. ACME-DNS support has been added in the latest builds and the command line arguments system was reinvented to support more flexible (third party) plugins. I don't want to track a general issue of everybody's favorite DNS providers/server, so I will ask future visitors to open and vote for issues about specific ones they would like to see.. I heard about it, but haven't got around to trying it yet. I can't see if they are using ACMEv1 or ACMEv2.\nDefinitely going to give it a go, because it's good to see some alternatives popping up. In fact this reminds me that I should make the default --baseuri a user-configurable setting to reinforce the idea that WACS is not married to Let's Encrypt.. In the latest alpha build it's possible to change the default base uri (also for --test mode), so we can test against the Buypass ACMEv2 staging endpoint.. We're blocked by a bug in ACMESharpCore: https://github.com/PKISharp/ACMESharpCore/issues/12. There is already an option in the main menu that's very close to what you describe: L: List scheduled renewals. What's missing there though is a quick overview of failing renewals. I'm going to add it there for the next build because I think it's a useful feature.. I see, that shouldn't be too difficult to add :). Do you have any IIS bindings set up yet? That target plugin creates a HTTPS binding for a corresponding HTTP binding. If there are no HTTP bindings then it won't work, you should input the host name that you want manually then.. That's one solution yes :). The other would have been to choose option 4 (manually input host names). Anyway, thanks for helping with the 2.0 test!. I understand your concern but the ability to use the staging endpoint has not been lost, you can still select it with the --baseuri parameter. I'm also going to make the defaults configurable in the settings.config.. FYI: the default endpoint when using --test will be staging endpoint in the final release of WACS 2.0. Using the --baseuri parameter or the settings.config you will be able to change that behaviour.. Exactly! It was renamed because it's not (only) a Let's Encrypt client but an ACME client!. If there are no named binding in IIS, as would be the case with Exchange OWA, you have to input the host name manually. \nJust as a warning: at least older versions of Exchange don't like it when you use named bindings. . By default it creates a scheduled task in the root of your Task Scheduler. It should be named something like \"win-acme httpsacme-v01.api.letsencrypt.org\". If it's not there you may have skipped a step during setup of your renewal. Then the main menu option \"T\" can help to create it.. Hmm, the problem seems to be that it cannot find the certificate in the Personal/My store. By default, certificates are installed to the WebHosting store. You can change that via settings.config key CertificateStore or through the command line --certificatestore. I would try the store \"My\", which is called the \"Personal\" store in MMC. That's the one the script checks and probably the one that Exchange requires.. I will probably work with My. \n\nWill this successfully update itself via the scheduled task in the future?\n\nIt should, but it's always wise to test it. You can force a renewal from the main menu.. Documentation and examples in the Wiki have been updated to reflect this information. They are written for version 2.0 though.. Yes but @catwiesel wasn't I believe. I think this issue has been addressed now, but do reply again if there are further problems. Thanks for using WACS!. Good catch, there were some changes after the first implementation of the importer that caused it to break. The next version will bring it back up to speed.. The latest alpha contains a fix for this issue.. There's another fix in alpha4 that makes sure the default baseuri is properly populated, you in alpha3 you had to manually type the old endpoint name, e.g. https://acme-v01.api.letsencrypt.org/. This should be fixed, please re-open this issue if some other problem turns up!. You may be right that you hit a rate limiting bug. It cannot be unblocked (at least by us), but it will unblock itself automatically. It is a bug though that we don't catch that error sooner.. The latest build has better error handling, would you mind trying again?. That's good news, thanks for testing! Regarding the file names, please check out issue #975.. Thanks for testing again! As written in the release notes, there was a breaking change between alpha3 and alpha4. Instead of referring to plugins by their class name, they are now referenced by a GUID. \nThis is more robust towards the future because it allows for easy renaming and versioned settings, so it's going to prevent breaking changes in the future, but the bullet had to be bitten. . Closing this for housekeeping purposes, if you have further findings please keep us posted!. Thanks @cpu, I updated the link!. Did some further digging: the API's required to do this are in .NET Standard 2.1, but Microsoft has decided to keep the .NET Framework (which we target) on .NET Standard 2.0. This even includes the upcoming Framework version 4.8. . I managed to successfully validate a certificate using TLS-ALPN-01 with a build of WACS for the .NET Core runtime. The move from .NET Framework to .NET Core is no small step by itself because it would require replacing some packages we rely on, redoing our build script and rethinking our distribution/installation method.\nFurthermore, to get it to work, we have to use a raw TcpListener on port 443, which means all (other) web servers on the system have to be shut down for it to work, making it pretty unpractical. Unless Microsoft is going to offer a way to combine the properties of HttpListener (i.e. port sharing) and TcpListener (fine control over TLS handshake) then I don't see this becoming very usable.\nSo it's on the 'backlog' for now.. On paper that's possible, but my feeling is that it would end up being too fragile in terms of performance, reliability and security. Basically we'd be throwing our dinky little selves in front of the battle-tested Microsoft implementation of the IIS network code. And we'd always have to be there or it would defeat the point of not having to interrupt live traffic.\nHere's another discussion on why ALPN is hard: https://community.letsencrypt.org/t/so-how-are-we-bringing-tls-alpn-to-the-masses/63824. Thanks for this! I will take a look tonight.. There is also things like the task scheduler, Windows Certificate Stores, registry and installation scripts to keep in mind. It would be quite a lot of testing to figure out what does or doesn't work without administrator rights, and to stop everything from crashing when it runs into a wall somewhere. So no, unfortunately it's not currently possible unless you build your own version without the embedded application manifest.. It looks like the same bug indeed! Rather than looping through the  requested domains and figuring out which challenge is supposed to be answered for each of them (which fails because two challenges are for the same domain), we should just loop through all the challenges and answer them.. It would be possible, but currently the program is structured in a way that each challenge is answered individually. Grouping them by domain and making the validation plugins answer a bundle of them at the same time would be a pretty big change to the architecture. Let's Encrypt is generally very good at bypassing all kinds of caches/TTLs, though you might obviously run into delays on the provider side, e.g. how fast they process their control panels' input. It's definitely not the kind of rework that I'd do preemptively, let's see if it actually becomes an issue first!\nWhat Chris means is that Let's Encrypt remembers your accounts' authorizations for specific identifiers. Once you've proven ownership of *.example.com and example.com individually, you might be able to request a certificate for both of them as well, because you can skip through the validation.. The bug will be fixed in the next build, by the way.. Fixed in beta1. > But in my experience not many people are using Windows DNS as the public DNS server for thier domains, \nAgreed. \n\nso you may have a hard time finding help to build this new feature. \n\nThe \"help wanted\" label might not be the most appropriate one. I created this issue to allow people to express their interest (if any) and to invite contributions from people looking for a nicely scoped PR idea, not because I'm planning to do it myself anytime soon and can't figure out how. I'll change it to \"up for grabs\". . It looks like you've outgrown the registry. Please follow these steps to move your renewal database to a file: https://github.com/PKISharp/win-acme/wiki/Migration-to-v1.9.9. There is no need to upgrade WACS (at least for this reason), but you will have to modify those renewals that currently rely on TLS-SNI validation. This can be done either by manually editing the .json in the Renewals file, or by re-creating them (the new one will automatically overwrite the one with the previous settings).. Definitely a documentation error, and agreed that the messages for the manual plugin could be improved. Also agreed that we shouldn't ask for a password if it was already provided on the command line.. I think we ignore bindings starting with *. as potential targets because they were not supported in ACMEv1/1.9.x. Obviously that changed, so the code should be updated accordingly. Might have to put in place some extra code to prevent renewals with HTTP validation from suddenly having to deal with wildcards.. Right now --centralsslstore is the one that works, but since there's no real reason for that change, I think it's better to go back to --centralsslpath to preserve backwards compatibility in the beta/final release.. A lot of these issues have been addressed in beta1. Please open new issues if there are furter suggestions!. For now the workaround is to add --installation none to the command line. That won't be necessary anymore in future releases.. Fixed in beta1. Might also be this bug #994 if you're trying to create a certificate for .example.com and example.com . @marcotibben one unrelated thing... please don't use GitHub as if it were a chat box. If nobody responded yet, you might as well edit your last comment. That saves those following the issues a lot of unnecessary notifications.. Don't take it the wrong way, your detailed feedback is very much appreciated! It's just easier to keep track of the status of the issue if you summarize your efforts and findings rather than reporting them live as they are happening :). Another thing I though of, have you added quotes to the TXT record? And did you take note that the token is spread over two lines in the current build (fixed in the next one)?. So not even HTTP-01 SelfHosting validation is working? That's very* odd. \nThe only explanation I can think of is that somehow there is a bug in decoding the challenges. Could you perhaps make a backup of your Registration_v2  and Signer_v2 files (for possible future examination) and then remove them from the config folder, so that the program will create a whole new registration with the ACME server. Maybe something weird is going on in that area.\nAnother thing that we can try is have you run http-01 validation for a non-wildcard host with --verbose on. Then someone like @cpu can check on the Let's Encrypt side what's happening.. Very interesting lead Chris. One would think that all privileged communication with the ACME server would fail if something was wrong with the account key. But at this point almost anything seems possible. . So after you installed .NET 4.7 it started working? \nThis is odd for a couple of reasons. \n- Server 2019 is supposed to ship with .NET 4.7.2 out of the box. \n- If you somehow opted out of installing it, WACS wouldn't be able to run at all. \n- Other 2019 users haven't run into this.\n- The installed version of the framework is checked at start up. \nSomething very fishy was going on, I might try with a fresh 2019 VM myself. Anyway let us know how the wildcard turns out!\nThis is the result on a clean 2012 R2 install:\n\n. I'm going to try to reproduce this in a VM. The ASP.NET role should not be required as far as I know (having just the .NET Framework should be enough), but there may be a hidden dependency.. Here are the results: fresh install of Windows 2019, nothing changed to the features or roles (so no IIS, no ASP.NET). Single domain, manual DNS validation. No problems at all:\n. I just installed the IIS and CGI roles on the VM (still without ASP.NET) and re-tested, but still got a valid authentication result. \nToo bad we couldn't test the account key theory.. No problem, thank you for testing and reporting your findings! At least we know now that this problem can occur and what a possible workaround can be. If others report similar issues in the future we might get to a root cause.. Let's Encrypt queries different nameservers from different geo-locations and verifies the DNSSEC chain to prevent spoofing. We cannot easily reproduce that behaviour, so while it might increase the initial success rate to wait until a simple local TXT lookup works, it will not be perfect. I've added the check because it's just a couple of lines of code, but I'm not going to do the waiting because we can never be sure when we've waited long enough. It makes more sense to me that the script does any waiting necessary before it returns. . > or make it optional.. default behaviour as it is; instantly.. but if one (like me) needs the check for the TXT record, or some waiting for the TXT field to be working, it can be activated with an argument... just like one would activate central store..\nTo me this is about separation of concerns. Dividing the steps between the main program and the script opens up a can of worms, because while you might want to wait some seconds, someone else might need to upload a file, someone else might need to restart a service, someone else might need to call a REST API, etc. \nTo keep it simple (which is after all part of name of the program) the rule - in my opinion - should be that the script takes all the required steps. \nYou have a good point that not everyone is be capable of writing their own script, but that is the reality that we have to deal with for DNS validation. We can hope to solve that by providing additional plugins and example scripts, but I have no intention of building a proprietary scripting language based on command line arguments.\n\nlets encrypt will probably use the same procedure for the same geolocation each time I presume? \n\nI wouldn't rely on that. It's not documented and therefore subject to change. Also you have to consider that your DNS providers' systems are subject to change and difference in load. If you measured 210 seconds to be the minimum I would put the wait at 300 to have a safety margin.\n\nso far it was around 210 secs for me at each attempt.. or could the time it took be stored in the renewal json, wacs can then figure out how long to wait next renewal for instance?\n\nNo... we are trying to keep it simple here :)\n\nwhich also leaves me with the question; how does a manually dns registered certificate renewal work? if the renewal starts automatically at 09;00, then how to manually change the dns in time? (just wondering)\n\nRenewals set up with manual DNS validation cannot be automatically renewed. If you want to use that in production you have to log into the server and run WACS manually every second month.. Good catch, this bug hits only clean installs. I'll upload a hotfix soon.. To fix this either download the beta1 hotfix version, or manually copy/rename the file settings_default.config to settings.config. See also #1003. Thanks for trying the beta!. That's a good question! For now, the only time an email is sent is when a renewal fails in unattended mode.\nSo you could create a copy of a working renewal (copy the .json file), sabotage it somehow (e.g. include a domain that you don't own, enter a web root path that doesn't exist etc.), and then run the scheduled task or start the program from the command line with the --renew switch. I think for the final version it would be good to have an option in the menu to test it directly!\n. The option to send a test email is in beta2.. I assume you're talking about the file names as they appear in the CertificatePath. Those are named after the ID of the renewal, which is a GUID. You can change the ID but currently only manually:\nhttps://github.com/PKISharp/win-acme/wiki/Renewal-Management#file-names. Not yet, but I like the idea. It will then be the eight parameter though, i.e. {7}. I misread a bit. If you want it to be the first parameter to your script, you'll be able to use --scriptparameters \"{7} otherparams\" \nParams {0} to {6} are already taken: see https://github.com/PKISharp/win-acme/wiki/Install-script#available-script-parameters\n. Hmm I'm not sure if I understand you correctly. With the new {7} parameter you will get the id of the renewal, which translates directly to the files {id}.pem, {id}.der etc. The {0} parameter is the common name of the certificate, which is the primary domain. Are you still missing something for your script?. I've added the ID as {7} for the next release. The domain name (common name) is at {0} and the CertificatePath is {6}. Besides that, is there anything else you would need?. Great, thanks for the feedback!. Version 2.0 has a lot less cross-dependencies between plugins and configuration / command line arguments. This means that the code is easier to test and evolve, but unfortunately also that it can be a bit less 'clever' sometimes. \nIt is no longer able guesses/assume that the script installer should run because a --script argument has been provided, instead it has to be made explicit with --installation script . That blog is a bit outdated, though it's certainly not impossible to modify the approach the author takes. You'd have to add an extra parameter to the script to pass the .pfx password. Those passwords are accessible from the main menu (List scheduled renewals > Show details).\nThe recommended approach would be to let win-acme handle the whole process by configuring two installation steps (which was probably not possible yet when that blog was written). The first installer would be IIS, followed by a script step to run the Powershell. You can find some documentation about this approach:\nhttps://github.com/PKISharp/win-acme/wiki/Microsoft-Remote-Desktop-Server\nand some example scripts here: \nhttps://github.com/PKISharp/win-acme/tree/master/dist/Scripts\nIf you want to run your own script directly from win-acme, check out the instructions here on which parameters you can pass and how:\nhttps://github.com/PKISharp/win-acme/wiki/Install-script \n. Also our Exchange example follows a similar approach passing the .pfx password, check out that documentation here: https://github.com/PKISharp/win-acme/wiki/Microsoft-Exchange. The file name settings-default.config is the right one, but what's supposed to happen is that if there is no settings.config yet, i.e. on a clean install, it makes a copy of that template. That allows us to change the defaults for clean installs without messing up existing users' configuration changes on updates. \nThis was broken in beta1, hence the hotfix build. I've since removed the original beta1 download so nobody else can run into this.. Please run the program with --verbose and try to renew the certificate from the menu. That should give some more information about why the authorization fails.. Could you please actually run the renewal? I.e. Renew specific > 1 . The reason seems to be that your web server returns a 404 error instead of the requested validation file. You can try to solve that using this guide: https://github.com/PKISharp/win-acme/wiki/Validation-issues \nBut it might be faster to re-create it and choose SelfHosting validation (or just use \"simple\" mode, then you don't even have to choose anything). That bypasses a lot of known pitfalls of the FileSystem validation which you're currently using.. That's right, when you want to generated your certificate based on an IIS website, there have to be named bindings configured on it, otherwise we won't know for which host names to request the certificate. Typically we pick up the port 80 bindings and by the time we're done they all have properly working sister bindings on port 443.\nIf you don't want to create (temporary) named bindings on port 80 or otherwise, you have to input the desired host names manually, which is option 4 in the menu. Then you will be asked which IIS site you want to target to create or update https bindings.\nIf you don't want to do anything with IIS choose \"M\" (...with advanced options) in the main menu.\nI've updated the error messages to be a bit more clear.\n. The program can manage multiple certificate renewals, hence the parameters are to be provided at creation time. They are remembered and stored on disk. With --renew, all previously created certificates are renewed, each with the respective options provided at creation time. So I expect everything will work fine as you did it, but if you want to make sure, you can always trigger a renewal from the menu.. Thanks, that is a nice addition to the toolbox!. Writing the private key to disk has been disabled by default in version 2.0 for security reasons. It can be enabled with the setting SavePrivateKeyPem in settings.config. This is a documentation issue. That page has been updated in anticipation of the next/final 2.0 build, which provides the extra parameter {7}. If you're not using the central certificate store (and it doesn't seem that you are), that parameter is not required. You might replace it with a dummy value (e.g. \"a\") as a workaround.. Fixed in beta2. You're right, that was a bug, and it will be fixed in the next build. Thanks for testing and bringing this to our attention.. There have been some changes already which haven't been released yet in the current build, so that the configuration path and custom settings are printed again verbose mode, as they used to be in 1.9.x. I've just made some more little changes so that the certificate path is also checked and printed at start up, mainly because it's also a failure risk when we only found out after authorization that the path is actually inaccessible or wrong.. So thanks for the feedback, and looking forwards to your findings on the final 2.0 release!. I don't see any obvious mistakes in your command line, so let's start by figuring out if the thumbprint parameter actually makes its way to the script. That's easily tested by adding a Write-Host $NewCertThumbprint at the beginning. That will narrow down the search quite a lot.. If you would add that Write-Host statement to the .ps1 script we'd know whether the thumbprint properly arrives to PowerShell. One theory I have is that the quotes may be included for some reason. The other obvious pitfall is that it would be empty.\nThe program will request a new certificate at most once every 24 hours unless you use --force, but if you've already hit one of the rate limits then there are two ways to work around them. One is to issue for another domain that you might own. The other is to use the --test switch so that you will request an (untrusted) certificate from the staging server. The rate limits for the staging server are much more relaxed.. I'm going to close this issue due to it being quiet in the thread for while now. Please feel free to post again though if you keep having issues with the latest release. Thanks for using win-acme and providing us with feedback.. Every registrar is different but it's pretty common to show only the subdomain instead of the full domain. Did you add quotes around the value, or did Google do that automatically as well?. I'd recommend trying to run with the --test switch, then the program will pause right before the moment it tells Let's Encrypt that it can validate. That gives you the chance to check the URL from a web browser, preferable one outside of your own network.\nThe two most likely reasons are:\n1) the web server is somehow locked down\n2) the files are written to the wrong path\nYou might also just try putting a file in that folder yourself and check if you can fetch it with a browser. At the end that's all Let's Encrypt is trying to do here.\n. Since there hasn't been any answer for 2 weeks I'm going to assume the problem was fixed one way or the other, but please report back if you have further questions!. There is no built-in support for that service right now. It looks like they do have a pretty straightforward API though, reading through the source of their certbot hook @ https://github.com/desec-io/certbot-hook/blob/master/hook.sh it's just a matter of sending a PUT request with the right headers and a bit of JSON. \nThere are two ways to go around doing this. One is the approach where you use the \"script\" DNS validation plugin to call a .bat file, which can in turn start PowerShell/Perl/whatever process to do this. Here are the instruction on how to hook that up:  https://github.com/PKISharp/win-acme/wiki/DNS-Validation-Plugins#script \nThe second would be to develop some .NET code that plugs into the main program. Because there are so many different DNS services I'm not going to build each one myself unless I can see some level of community demand, but of course anyone is free to send in PR's!. Hi misterHippo, please check out this guide: https://github.com/PKISharp/win-acme/wiki/Migration-to-v1.9.9. It looks like IIS is installed, but either the whole service is stopped or no websites are configured/started.. I'm going to close this issue due to it being quiet in the thread for while now. Please feel free to post again though if you keep having issues with the latest release. Thanks for using win-acme and providing us with feedback.. I'm a bit confused because there is no --port parameter, though we do have --sslport. Both of those are remembered and re-applied when renewing. \nIn general port 80 has to be accessible for http validation. The program creates its own listener for that, so as long as you don't firewall it off you should be fine.. That one is also remembered, though Let's Encrypt will still connect to port 80. The forwarding to 8015 you'll have to do yourself, as you may already be aware.. Interesting behaviour. Since you're not using the Dreamhost plugin, I'd recommend you to just delete it from your WACS folder to get rid of the error.  For those that do want to use it, you will have to do this in File Explorer:\n\nIt's not a fatal error in any case, so I'd expect execution to resume as normal after you get it. You will run into bug #1015 next though, so please check that issue as well.. I've just posted a beta2 build which contains the fix for #1015.. Hi Steffen, thanks for testing again! It would be cool to expand your script to be more generic for others to work with, so I high-jacked this issue to track that possible enhancement.. That's just for renewals though right? Would it be feasible to add certificates to sites that don't have them set up yet?. What happens if you type Add-PSSnapin Microsoft.Exchange.Management.PowerShell.E2010 into a regular Powershell window?. I've updated the Exchange script with some more error handling to pin-point where it goes wrong.\nhttps://github.com/PKISharp/win-acme/blob/master/dist/Scripts/ImportExchange.ps1\nWould you mind trying that one?\nAlso if you Google for the error The Exchange Certificate operation has failed with an exception. The error message is: Unknown error (0xe0434f4d) you will find some tips and tricks from people who has similar problems, ranging from installing a SP to checking services which may not be running, etc.. Enable-ExchangeCertificate probably doesn't work if you run it from outside of the program either, though it's worth to test that from a regular Powershell window. It's beginning to look more like a general Exchange problem than a WACS problem, but maybe there are still some users here who can chime in with their experience.. In the first case, was Powershell running as administrator?. That's good news! \nHave you tried if it works with either of those statements individually? Or do you need both of them?\nNext step would be add them to the script and test the whole chain.. I've added those lines as comments into the example script for future reference.. I have found that sites tend to be very dynamic creatures; people change bindings, names (often names reflect bindings) and move the root path around. In some cases the site even gets deleted and an a whole new one pops up with the same id.\nThe default FriendlyName for an IIS site certificate used to be the site name, and for a multi-site certificate it was a comma separated list of id's.\nNow it's the id for both because it's semantically the most correct over time. \nThere are different ways to customize friendly names both before and after creating the first certificate. But I understand your concern so I will think about a compromise.\nOne option that springs to mind is to not store the FriendlyName into the renewal unless its explicitly specified by the user, making it dynamic for each run. Then using the site name would no longer be a source of potential future confusion.. I propose this new default pattern:\n[IISBinding] www.example.com\n[IISSite] Default Website (dynamically updated)\n[IISSites] 1,2,4,5\n[Manual] www.example.com\nThe advantage of the prefix is that it's easy to group all WACS certificates together and to recognize which certificates are more or less static (manual/binding) and which ones are subject to changes based on changes in IIS configuration. . Hi Keith, it would be the name of the site as you see it in the IIS Manager. I used Default Website as an example, but it might also be www.example.com or Awesome Customer Portal just depending on how you name stuff in IIS.. You didn't do anything wrong, but the program stopped saving the private key to disk by default. To enable that set the SavePrivateKeyPem option in settings.config to True. I've cooked up a little store plugin for Apache by the way, so you can have nicely named .pem files in a folder of choice, rather than the randomly named versions you'll find in the certificate cache. That will be in the next build.. Highjacking this issue as a reminder to myself to update docs and release notes.. It would be nice if you could test! \nThere's a build deployed on my fork that you should try. What I've done is removed the SavePrivateKeyPem setting and instead added explicit command line options to tell the program that you're going to use Apache, i.e. --store apache --apachecertificatepath C:\\apache\\cert, or you can input that from the GUI in advanced mode.\nI felt that the CertificateCache - with its weird file names - should be more 'private' to the program and therefor can be kept more clean, e.g. it doesn't contain all those .der and .pem files anymore. Instead they are written by request to the --apachecertificatepath. For now it's just the full chain certificate and the private key, because I think others were not needed in the first place, but let me know if that assumption is wrong.\nPlease let me know what you think of this change. \nAlso ping to @SteffenAL and @ekoome\nhttps://github.com/WouterTinus/win-acme/releases/tag/v2.0.0.169. Renamed because this will also be a feature for other applications, not just Apache.. I put up a build where the plugin is called --store pemfiles --pemfilepath C:\\certs and the setting for the default path is called DefaultPemFilesPath in settings.config, to reflect that Apache is not the only webserver that requires .pem files to work with.\nAlso the PemFilePath and store type that are used can now be passed to an install script, bringing us a step closer to nice reusable scripts for Apache and such.\nhttps://github.com/WouterTinus/win-acme/releases/tag/v2.0.0.173. Yes, that Wiki is out of date and should be updated. Sometime during the beta test I realized that the .pem files have many more applications than just Apache, so that's when the parameter and plugins names were changed. \nI'm sorry for your bad upgrade experience. If you've not completely deleted the old version yet, it's easy to go back.\nThe good news is that while Apache support used to be more or less based on hooks into win-acme implementation details (which have admittedly changed over time), with the 2.0 release it's a formal plugin with all the backwards compatibility promises that come with that.. Check out this: #1029 - for the next build it's going to be a generic PemFiles plugin rather than an Apache plugin. Please let us know what you think there.. You can see the password from the program itself, go to \"List scheduled renewals\" and then show details for the renewal. . The ArgumentOutOfRangeException stems from the fact that Windows is unable to compile the certificate's chain of trust, possibly because you're behind a proxy server. I've removed some code around that part of the program in 2.0 because it seemed unnecessarily complicated, but I guess this is why it was there. Shows the value of comments :)\n\nthere was no conflict there's no sites on that server that use SNI, switching that on would make all the other sites on that server serve up that particuliar Letsencrypt cert and totally screw up everything :)\n\nMaybe you're misreading what that message is trying to say. If your existing bindings don't use SNI and we'd set the Let's Encrypt certificate on any of them, then all of them would start serving the Let's Encrypt certificate. If we activate SNI for the one that we're changing we prevent that from happening.. There will be a fix for the bug in the next build, thanks for testing the beta release and reporting the issue!. Hmm, perhaps the fact that they are on different ports helps to keeps the bindings working without SNI. The program currently doesn't check for that, but I'd have to test properly before I could relax the \"enable SNI\" condition, because it's caused people a lot of pain in the past :). The check is in the release of 2.0.0. At this time there have been too many failed attempts for you to try again, though you can switch to the staging server with --test to continue.\nI recommend following the page validation issues on the Wiki to figure out what's going wrong.. I guess you have a typo somewhere, maybe a superfluous space, in your list of domains. Without seeing your command line and/or screen output I can't tell for sure though.. I'm sorry that this happened to you. In the programs defense, it only updates site bindings and never even looks at virtual directories. But IIS can unfortunately fail in spectacular ways when it feels mistreated.\nIf you could provide some more information on what you did and how we might be able to prevent this from happening in the future. E.g. which bindings were there before you started and for which domain(s) you requested the certificate. Feel free to substitute your domain for example.com. Also interesting to know would be which version of Windows this is running on.. I think the problem might be that you requested an additional host name that you didn't have a binding for, so the program matched with the default binding. Additionally it recognized that if it changed the certificate for a non-SNI binding, it would create problems for other bindings. So it tried to apply the SNI flag to the default binding, which I believe caused the crash of the IIS Manager.. I can tell from the log that the program updated the default binding i.e. :433. I'm guessing that you have a binding in IIS for the main domain but not for the autodiscover domain, or the other way around. Alternatively, you may have had a typo in the program. At least that's the way that I've been able to reproduce your issue.\nI'd suggest removing the whole HTTPS binding from applicationHost.config and recreating it from the IIS Manager.. A build with the fix is at https://github.com/WouterTinus/win-acme/releases/tag/v2.0.0.176\nThis or something very close to this will likely be the 2.0.0 release.. > After selecting the domains to be included in an IISSITE certificate using the Interactive Simple mode (N), there is an option asking to select the common name, even when a site only has one binding. I was wondering if this is intentional?\nNo, it doesn't make sense for the question to be asked when there's only one domain.\n\nwhy not skip this choice and select the first one by default anyway? If the user wants more control they can use the Interactive Advanced mode instead?\n\nThe line between simple and advanced mode is kind of arbitrary. One could take simple to mean the ability to generate a certificate with the least amount of key strokes and advanced to mean offering every trick in the book, but that would also mean that users who care even a little bit about the shape of their certificate, would be forced into the advanced mode, which is much more difficult to deal with.\nSo to me it makes sense to offer some 'common' options (pun intended) in the simple mode, so that users can exactly describe what the certificate is supposed to look like (the common name is end user visible so it's something that admins may care about), without having to deal with all the questions regarding plugins for validation/install/csr/installation. \n\nI also noticed that if I get to this choice point and select the C Cancel option instead of selecting a domain for the common name, the program doesn't cancel the process and still goes ahead with processing the certificate.\n\nYes that label is a bit confusing. In this case it means \"don't care\" or \"default\" rather than cancel.\n. I've made some changes in the latest release so that most questions now have default choices that can be triggered by simply pressing enter. The bug with the common name question is fixed and as a compromise I've removed the \"exclude bindings\" options to advanced mode. I think everyone should be happy now :). > Only asking as I've had issues previously where ACME wasn't able to validate the certificate because the site was already redirecting to https. Maybe it's already resolved and validated the domain differently now.\nI don't expect .dev to behave any differently than .com if/when Let's Encrypt accepts it as a valid root. They work with the public suffix list ( https://publicsuffix.org/list/public_suffix_list.dat ) where dev is listed, so it should be no problem as long as port 80 is publicly accessible. Otherwise you have to use DNS-validation.. I will release a fix for this shortly!. Are you running with an administrator account?. Have you tried running with --verbose? And do you see anything relevant in the event viewer perhaps?. - I don't understand this event about \"Microsoft-Windows-Immersive-Shell\", are you sure that's related? Aren't you running the program from a normal command prompt? \n- Is this on a Chinese language version of Windows Server?\n- Are you sure that this is the complete output that you get? Doesn't it print anything else after [DBUG] Renewal period: 55 days?\n- Does it just hang or quit?\n. But that seems like normal behavior to me. Can you explain what you expect to happen, or what exactly fails? I just don't know how to interpret \"is no response when running directly\". I realize that English is not your native language but please try to explain a bit more.. You can simply delete the files that are mentioned in those error messages if you are sure that you don't need those renewals anymore. They may be leftovers from an early alpha build, if you've tried that.. The default behavior of the program is to install the certificate into the certificate store, though as you noted it ends up in the WebHosting store rather than Personal. You can change that either with the setting DefaultCertificateStore or the command line argument -certificatestore.\nThe thumbprint usually respresented by this kind of hex string like 3a7aa8a2058a55128ddb207d7e66749faa5df127. Maybe the only problem is that it's in the wrong store?. You can convert the .pfx with some trickery but the program can actually do it for you with the PemFiles plugin, which you can choose from advanced mode or trigger with --store pemfiles. Note that you cannot output to the certificate store and pemfiles at the same time though, so you have to set up two renewals even if these are for the same domain.. You're welcome!. Anything is possible, though I'm not familiar with Tomcat or its requirements. If .pem files are what you need then please check out this link: https://github.com/PKISharp/win-acme/wiki/Store-plugins#pemfiles. Thanks for pointing that out, it's been fixed in the latest release!. Thanks for noticing that! \nThe Wiki is actually correct, it was the (default) config that was out of date. You can make the modifications yourself or download the latest version from https://github.com/PKISharp/win-acme/blob/84df8a5b8c5003465020bf5b1d8e3b417ed40eca/src/main/settings_default.config (and rename it to settings.config).\nI'll make sure that the correct template is included in the next build.. Fixed in 2.0.4. It's a bug in the \"GUI\". If you're familiar with .json (it's not that complicated) you can put your parameter string in the ********.renewal.json file manually under the item ValidationOptions. Create a new key DeleteScriptArguments with your argument string. Alternatively, use unattended mode and provide everything on the command line.. There is a pre-release build with a fix at https://github.com/WouterTinus/win-acme/releases. Fixed in the 2.0.4 release. Great that you fixed it yourself, but I noticed a null reference exception in your log, so the FTP plugin will be a little bit better in the next release thanks to this issue.. It's not necessary to quote all of them, the RecordName starts with a fixed value as determined by the ACME standard and a DNS identifier is not allowed to begin with a - as per the RFC. \nIt's not possible to change the default arguments because it would be a breaking change for those using .bat files. Luckily Powershell doesn't care if you provide the arguments quoted or not, so I'll add some code that adds quotes around {Token} in the argument string if it's for a Powershell script and we detect that they are not there yet.. There is a pre-release build with a fix at https://github.com/WouterTinus/win-acme/releases. The problem is that the program is trying to save to a file based on the common name, in this case *.example.com. It should be updated to follow the convention of the IIS CCS, which uses a _ instead of a *.. There is a pre-release build with a fix at https://github.com/WouterTinus/win-acme/releases. I think both of the problems come down to the same issue: the DNS updates that your script does do not propagate fast enough. I suspect that if you would add some waiting time into the script, e.g. 1 or 2 minutes, it would allow the name servers to synchronize and thus the records to become  publically visible consistently.\nIt's a good idea to query the name servers directly to help users figure out when this is necessary.\nI'd have to look into Seq because I never heard of it, but in any case you can add extra sinks to Serilog by adding a .dll file from Nuget into the program folder and adding it to wacs.exe.config. There is an issue open here somewhere that has an example.. > In fact, I'm not sure where it gets it's information from because as I mentioned, even when I explicitly configure the DNS server to point to the IP of ns71.domaincontrol.com, it never ever yields a value (even an incorrect one). It always returns null.\nIt might be a bug in the library that we're using then. I've tried several ones and this seemed to be the best, but it had issues querying from 8.8.8.8 (which already indicates that it's not that great), so I've set an OpenDNS server as the default. Anyway - don't take the preliminary validation too seriously, it's just an informative message that doesn't influence the certificate order process in any way. For more serious checking you might want to try this service: https://unboundtest.com/\n\nI'd be happy to debug it and see why but, as I mentioned, I couldn't get the solution to build straight from source. Do you have instructions for building successfully? Should I open a new issue to specifically address this topic?\n\nI think that's a good idea, you can post there which problem(s) you're running into and I can help to figure out why it's not building.\nThis is the Serilog issue by the way: #901\n. > @WouterTinus How do you feel about making the code async? I'm not sure how large of an undertaking it would be to convert the entire app but the DNS client work that I'm doing could stand to benefit from utilizing the async APIs. The challenge here is that async spreads like a virus.\nGood question! My feeling is that in some cases the code could be more elegant with async (the AcmeSharpCore is also an async API that we wrap around in a rather ugly way), but to get any end-user benefit (e.g. the runtime advantage of handling multiple certificate orders and/or validation challenges in parallel) there would have to be some fine-grained locking around certain services, risking whole new classes of potential bugs. I considered it for the 2.0 refactor and decided against it, but I'm not saying it should/will never happen.. Thanks for addressing the feedback, do you feel you're ready to merge it in now, or would you prefer to make some more changes?. The only way that's possible without some additional automation around this tool, is if you don't mind having all of the sites working with the same certificate. If that's alright with you, use the \"multiple IIS sites\" as the type of certificate and then choose \"all sites\".. It turns out that there is indeed a certain class of failures that doesn't get caught by the e-mail notification handler.. Personally I don't think it's a good idea. Some people manage hundreds or even thousands of renewals, so I think email notifications should be used for exceptional situations and should be actionable, lest you end up ignoring them altogether. \nIf you want to monitor the programs health in general there is the task scheduler history, windows event viewer and other forms of logging that can be added. \nOf course that's just my opinion, if the community wants this feature as an option, I might still add it. Feel free to open a separate issue for the idea!. The basic principle of Let's Encrypt is that things happen automatically so you shouldn't have to do or check anything manually. \nBecause the question is what are you actually going to do when you receive such an email? Take a mental note about when the next one should arrive and hope to remember if it doesn't?. @kabilan-baskaran: To me that just confirms that you're interested in failure, not in success. I don't like manual processes like \"check if we got recent success emails for all of our certificates\", because that's tedious and more easily accomplished in different ways, such as asking the program itself for the status of renewals, checking the task scheduler history and/or the Windows Event Viewer.\nLet's Encrypt themselves provide a independent email when a certificate is about to expire so even the \"what if the failure email doesn't work\" case is covered.\nBut I see you're not the only one who would like to have these emails and it's not that much effort to add it in, so I'll add the option.. Both the bugfix and the new setting to send emails on succes have just been released in 2.0.4. You have to choose \"Manually input hostnames\", because the program can't figure out which (sub)domains to order a certificate for based on the selected IIS sites, likely because there are no named bindings on them (as Exchange typically uses blank/catch-all bindings).. The password can be accessed from the menu -> \"List scheduled renewals\" -> \"Show details for renewal\". It's a random one for every certificate that you will create. In the future it might even change every time you renew.\nIf you want to do something useful with the certificate, the idea is that you'd use the combination of store and installation plugins, rather than manually picking it up from the cache folder.. Another nice improvement for the DNS check. It's been merged.. And just in time for the 2.0.4 release!. We set the console encoding to UTF8 on startup so that we can properly display international domain names. That's the only thing I can imagine that would trigger the font change. \nI wonder if you can prevent this crash by fiddling with the font settings of the console.. Found this in the Microsoft docs:\n\nThe console must use a TrueType font, such as Lucida Console or Consolas, to display characters.\n\nDoesn't mention anything about crashing when you don't have the right font, but it's worth a shot.. It's sounds like the binding in IIS was not created, but I can't tell for sure unless you post the full output of the program.. Hmm, I hope that the duplicate binding was not created by this program. Which version did you run? And do you mind to repeat the process from the beginning to see if it happens again?. Did some testing with both 0 and 1 pre-existing :443 bindings on the default website and was not able to get a duplicate binding to appear.. Both success and failure emails are only sent when running unattended. The assumption is that the operator doesn't need to be notified if he or she is witnessing something directly on their screen :). Have you tried sending a test email from the menu? And are you running in unattended mode? (e.g. --renew). Perhaps the email is flagged as potential spam and held in quarantine for a while? Usually you can figure that kind of stuff out by looking through the headers.. I've hotfixed the release to address this issue > v2.0.4.227 has the fix. Thanks for the issue report!. @davidpeden3 do you have time to look into this?. I've just sent you an email!. @ericcan I like your idea, that way we could even make AcmeDns work in unattended mode. But I think it deserves it's own issue, so that we can close this one when the bug fixes are in. Would you mind copying this proposal into a new thread?. I've done some refactoring and improved reliability based on two of my own DNS providers, so this will be in 2.0.5.. The FTP installion plugin currently only enables itself for IIS 8 and up. I did some research and it should actually work for IIS 7.5 as well (even for 7.0 it's possible, but we'd have to detect whether or not the extension has been installed).\nI'll make sure to enable the plugin for IIS 7.5 in the next release. . Great idea, this can even open up the the acmedns-plugin to unattended operation, at least for pre-configured domains. We can start implementing this after the improved DNS resolver lands (#1067).. The interactive part is done, some support for unattended mode should still be added.. There are two passwords that you are confusing (understandably, but nonetheless)\n\n\nThere is a password for the cached certificate file, which is randomly generated and can be accessed from the programs main menu (List scheduled renewals > Show details for certificate). I actually want to discourage users from directly using files stored in the programs cache folder, as the shape and form of the cache may be subject to future changes. The proper way to get certificates \"out\" of win-acme is to use either a store plugin or an installation plugin.\n\n\nThere is the IIS CCS, which is something you can use when managing a cluster of IIS servers. The setting DefaultCentralSslPfxPassword is meant specifically for this store plugin.\n\n\nSo there are a couple of ways to go about this, ranging from dirty to very clean, but I'd recommend you to configure your certificate to be stored to the \"IIS CCS\", even if that's not your purpose at all. Make sure that you choose a different folder for the \"CCS\" than the program uses for its own certificate cache.\n. You're right, it seems that the CentralSsl store plugin requires the setting PrivateKeyExportable to be True (default is False since version 2.0). \nSince that setting only applies to the CertificateStore plugin, I've marked it as a bug and it should be fixed in the next release.. Hi @tobiastromm, those files are not created by default anymore. With version 2.0 I actually want to discourage users from directly using files stored in the programs certificate cache folder, as the shape and form of that cache may be subject to future changes. The proper way to get certificates \"out\" of win-acme is to use either a store plugin or an installation plugin.\nOne of the store plugins is the \"PemFiles\" plugin which writes the private key and the full chain certificate (which would be equivalent to HTTPS_CERT + HTTPS_CA_CERT) to a folder of your choice. I think that would be the best to employ in your case. If your application actually needs separate files for HTTPS_CERT and HTTPS_CA_CERT then we should upgrade this question to a feature request. . It looks like the separate CA file is optional. Have you tried it with just the PK and the chain cert?. Good catch @webprofusion-chrisc, but I think you're right that there is more to it than just the CAA. app.home.tilsch.it doesn't seem to have a public A record, suggesting it's some kind of internal domain. \n@snudel: HTTP validation only works for publicly accessible websites. If you want to have a certificate for an internal application, you have to use DNS based validation.. Very interesting observation, thanks for reporting it!\nThis should at least be mentioned in the documentation but of course more preferable fixed in the Powershell script.. Maybe useful:\nhttps://github.com/PowerShell/CertificateDsc/issues/47\nTogether with:\nhttps://github.com/RamblingCookieMonster/PowerShell/blob/master/ConvertFrom-SID.ps1. The most reliable way to get everything to work is to check SNI for all sites. Browsers/devices without SNI support are extremely rare nowadays anyway.. Why not filter by *.dll instead of this construction?. Maybe add some try-catch with a Log.Warn if it fails to load? (Not sure if the logger is available at this point). Since we're going into the deep end, doesn't it make sense to actually check all of the name servers (as Let's Encrypt probably does) rather than just the first one?. You noted that this might be a breaking change, and technically it is. However, since this a completely non-essential function and querying the actual name server(s) much better approaches what Let's Encrypt is doing, I would actually be in favor of removing the \"DnsServer\" setting. If we keep it around then I would not use it as an override, but rather as a fallback in case we cannot determine the registered name servers for whatever reason.. I'd rather put this interface in Services/Interfaces and the implementation in Services.. This doesn't have to be a static variable because the DI container at top level is already registers the service as a single instance.. Too bad that not all of the SOA records are returned. So I think we can forget about this idea for now, perhaps until the upstream library resolves your issue.. You've convinced me, let's keep it as an override!. Thanks!. Ok, let's keep it in then.. ",
    "ScottRFrost": "No errors in event viewer.  There was a warning for deleted cert and created cert, but nothing after that.\nBindings for first try: \nspecific.site.name.com:443\nThe script didn't notice the site in question even existing, so I just hit Q to bail.\nBindings for second try:\nspecific.site.name.com:80\nspecific.site.name.com:443\nThis is where I got the error mentioned in the first post on this issue.\nFinally, I changed the bindings to:\nspecific.site.name.com:80\n*:443\nThis allowed the script to work without error.  However, this isn't usable in production since I have multiple sites.\n. Would it be possible to use this with regular IIS renewals too?\nHere are my two sites (set up in IIS before trying to run Lets Encrypt):\n1. Real Site - Available 24/7, only one binding for 443 / HTTPS required\n2. Lets Encrypt Challenge Site - One binding for 80 / HTTP,  Virtual Directory for .well-known that maps to .well-known on real site, everything other than that Virtual Directory set to redirect to Real Site.\nCurrent Process:\nBoth sites are active and answering 24/7, which isn't ideal.\nAwesome Process:\n1. Run script to start port 80 Lets Encrypt Challenge site\n2. Do the regular challenge\n3. Create / renew cert on Real Site\n4. Run script to stop port 80 Lets Encrypt Challenge site\nThis way, the port 80 site is basically only started / answering long enough to do the challenge then goes away.\n. ",
    "BrianKWhite": "I had the same problem as well since I also had existing SSL bindings.  In order to get the program to work automagically, I used  AppCmd to add the host name to the existing SSL binding that was by IP address only. Then the host name search used by the program works.\n%systemroot%\\system32\\inetsrv\\appcmd set site /site.name \"Site Name\" /bindings.[protocol='https',bindingInformation='192.168.1.1:443:'].BindingInformation:192.168.1.1:443:example.com\n. @rkerber It was IP address only.  I looked at the C# code and couldn't come up with an easy way to associate IP address only bindings with host names. This works; but breaks editing that particular binding in the GUI. Nothing I could think of was clean.  Everything required too many assumptions.  The \"best\" approach would be multiple IIS plugins.  so we could have one for IP address only SSL bindings using a DNS lookup of the host name on the cert to gather the info needed to update the correct binding.\n. @rkerber Thanks for testing the patch in Server 2012 R2.  I still run Server 2008 R2 so I will try to download and build the latest and test that configuration some time this weekend.\n\"HTTP on specific IP with hostname and HTTPS on specific IP with no hostname - Creates a new HTTPS binding on specific IP with hostname\" is an issue for IIS 7.5 and Server 2008 R2 since you cannot easily create a HTTPS binding with a host name through the GUI.  (You have to rename the certificate.)  It's also a common use case.  Probably the most common configuration for 2008 R2 installations, since IIS 7.5 and below do not support SNI. So a binding created with a host name amd without an IP address:port combination will not be used. The host name I added via AppCmd is ignored. It's probably necessary to differentiate (separate plugin or separate certificate install logic) between IIS 7.5 and below and IIS 8+.\nFor others who may be reading this, here is a blog post outlining the differences between the SSL handshake between IIS  7.5 and IIS 8.0+: http://blogs.msdn.com/b/kaushal/archive/2012/09/04/server-name-indication-sni-in-iis-8-windows-server-2012.aspx\n. ",
    "SgtOddball": "I've hit the same issue (win2008 R2) and I can confirm that after wasting far too much time it's not doable to have different domains under the same IP address using different certificates. \nI'm more than happy to be proven wrong but after numerious hacks and differing attempts I haven't bee able to get it to behave so my only advice is to migrate to 2012 R2(which we will be doing later this year). \n. I'm fairly certain that it won't be able to work correctly since it'll be looking for IIS7+ directories to work with.\nThere's also the issue of only being allowed 1 certificate per IP address on server 2008 R2 or earlier.\n(Also exchange shouldn't have any effect on the IIS at all so is irrelevant in this instance) .\n. What OS are you using? If it's Server 2008 r2 or lower, thats a restriction of that OS. From 2012 onwards they allowed for multiple SSL certs to be added to the same domain using SNI on binding the https connection to a website (this project allows that to happen automatically).\n. Ahh fair enough. Have you made sure that all of the sites with https have SNI configured on? It could be that you've got one website that isn't correctly configured and it's causing this effect. (I'm running 2012 r2 too and It's been working fine for me). \n. And you've definitely selected the right cert on the binding for junglecoders.dk? For the ip address are you specifying an IP address or setting it to 'all unassigned'  ? \n. Ahh coolbeans, glad you got it sorted in the end.\n. Ideally then there should be an option to bind to a specific IP addresses even with SNI checked or unchecked which currently isn't the case. \n@bitified by the way did you enter y as once it'd created the certificate or skip past and manually add it? (I've found pressing y as the last option will override the settings and I think it does give a warning about this). \n. Nope, I've never had any problem with it renewing other than I use one of the certs for a mail server which doesn't catch on that the certificate has been updated - but that's really a moot point. \n. I'd think it means 2008R2 isn't supported any more.\n. I've just checked my own websites and it's done the same for me sort of....\nTo elaborate, I created a test certificate about 2 weeks earlier on for a subdomain (to give my email server an SSL cert) and later created 2 further certificates on the same day (for non-prefixed and www sub domain). Of which the secure mail has been created but only the www binding was created of the subsequent two certificates. \n. Interestingly, I've just checked my old server (win2008 instead of win2012) and that does have all of the correct bindings for each of the certs being generated. But each one of them was initially binded to 1 IP address and no SNI was used (since it's not present) where as on the win2012 server I'm using SNI to allow more certs to be added. \n. Since you haven't yet set up an SSL certificate you first need an unsecured host instance to work with.\nSo instead of using https you need to set http first. Though how it will cope with not using port 80 i'm not sure. I would hazard a guess that you might need to have a firewall rule setup to redirect port 7001 to port 80 for IIS.\nHopefully that should get it for you. \n. Are you running letsencrypt as an admin? I'd say if it's not able to create the files that it's a permissions issue so that should resolve the problem for you (either that or allow new files to be created by the same user profile that letsencrypt is running under but thats just asking for trouble) . ",
    "chrischarles2002": "That was EXACTLY it.  Thanks @ndouthit - never knew about hidden scheduled tasks on Windows Server.\n. ",
    "Trumf-dk": "ndouthit, thanks that did the trick.\nAre there any security riscs doing this on a production server?\nJust tried to see if I could download web.config but this i not possible but anything similar when opening with this wildcard solution??\n. Thanks MetUys, this also solwes my security concerns :)\n. I have fixed this and will commit it when my other pull requests are either accepted or rejected...\n. Hi, I'm totally noob with Git and have maybe misunderstood how to contribute to this project. I have som pull requests. Would any of you either accept or reject them. I have a few other improwements and ideas for even more. I just dont want to keep working on my own branch if you wont accept my pull requests...\nThanks\n. Yes i should only be run when san isnt specified. Didnt see that...\nI disagree though that this should run in a seperate plugin. It must be part of the main program. Plugins make it harder to operate and the whole idea with LetsEncrypt is that everybody should have a free secure website. People having a small family website running on an old pc in the garage should be able to install a certificate from LetsEncrypt. We might even consider to port this to a WinApplication instead of a console application just to make it easier to use...\nThats just my opinion!\n. OK... but I dont really understand Git and how it works. As I told you a few months back I have some improvements and have just merged them into the newest version.\nDo you or anybody else want the main file to see what I did and make the plugins.\nI have two more improvements.\n. Updated it to: string _certificateStore = Properties.Settings.Default.CertificateStore;\n. I have made most of the requested changes. I just don't know how to submit them to this file???\nAs for logging you are welcome to add what you need. I have what I need and dont see where to put in more??\n. I think this will be possible when Revocation has been implemented in ACMESharp. It is set for the milestone 0.8.5 https://github.com/ebekker/ACMESharp/issues/103\nMy problem is that I have too many certificates for the same domain and need to have some to \"time out\" renewals so I can make SAN's instead.\nI'm testing a new plugin for deleteing renewals and hope to upload it later today. This will only be a temporary solution though...\nRegards Trumf\n. I need this function and can't wait so I will rewrite it when it is done. It would be nice to have a roadmap so it will be easier to plan things like this. I have thought of rewriting to use central store as well and will start when another plugin I need is done...\n. I was under the impression that my plugin should be isolated but I have updated my code. Who will make the referenced function public?\n. OK\n. This isent possible I just wrote this comment not to take credit for the whole part...\n. There is no else...\n. OK\n. It dosent serve what I need\n. I need this to run without command arguments so there is no SAN option set. If this is not allowed I will have to make a new branch and continue by my self...\n. I need this to run without command arguments so there is no SAN option set. If this is not allowed I will have to make a new branch and continue by my self...\n. OK\n. OK\n. GetSites dosent give me what I need! Also GetSites has logic which should not be there if it should be used elsewhere in the program.\nThis overview is exately what I need. Does it matter if you get the point? (I dont mean to be rude but your comment is a little condescending)\nPagination is in my humble view not appropiate in a console app. If you have too many sites to show you could increase the buffer with Console.SetBufferSize.\n. There is no else...\n. OK\n. Let's Encrypt certificates but for now thats OK unless you can provide the code or tell me how\n. ",
    "mrinc": "I was unaware of the fix.\nPlease merge #34 then.\n. ",
    "LordBenjamin": "Sounds good.\nI don't see a problem in making the web.config use the above by default - since the only thing in that directory should be the ACME answer file anyway, so no other handlers are needed.\nCorrect me if I'm wrong!\n. Thanks @anemitoff, your suggested config is exactly what I was aiming for!\n. ",
    "anemitoff": "Since the acme-challenge folder is only used for one purpose... why not have the web.config file in that folder use <clear/> as follows:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<configuration>\n    <system.webServer>\n        <staticContent>\n            <clear/>\n            <mimeMap fileExtension = \".*\" mimeType=\"text/json\" />\n        </staticContent>\n        <handlers>\n            <clear />\n            <add name=\"StaticFile\" path=\"*\" verb=\"*\" type=\"\" modules=\"StaticFileModule,DefaultDocumentModule,DirectoryListingModule\" scriptProcessor=\"\" resourceType=\"Either\" requireAccess=\"Read\" allowPathInfo=\"false\" preCondition=\"\" responseBufferLimit=\"4194304\" />\n        </handlers>\n    </system.webServer>\n</configuration>\n\n. ",
    "GioviQ": "Thanks @anemitoff I rebuilded with your web.config and now it works. \n. I even do not know \"test mode\". Maybe when I downloaded the code, there was a issue in the source.\n. I downloaded the source before you made webconfig configurable for the known issue with IIS.\n. https://github.com/Lone-Coder/letsencrypt-win-simple/issues/37#issuecomment-171080976\n. Ok thank you.\n. Thank you. It works now.\n. ",
    "Landale": "As a quick note, to save people some time looking for it, if you need to change the user under which the task will run, there are some additional steps you'll have to take.\n1.) Make sure the new user can access and execute the program\n2.) There is a folder under \"C:\\Users\\old user\\AppData\\Roaming\" that will have to be copied to the new user's \"AppData\\Roaming\" directory\n3.) There is a registry key that will have to be exported from \"HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\" and imported under the new user's registry\nThat is how I got it to work when I changed the user.\nSo, as a request, it might be good if there was a command line option to automatically do all of this for the user.\n. (rkerber was responding to this - I wasn't sure if I should make it a new issue or not so I deleted it to figure that out.  Apparently I didn't do that fast enough!)\nI have run into another, related problem.\nIt appears that even if I have checked the option to run the task while the user is not logged in, the task run at the scheduled time does not actually finish.  It remains in the \"running\" state, likely waiting for user input.  When I try to run the task (the task, not the program) under my administrative login, the same thing happens as well.\nHowever, if I run the task as the user under which the task is run, it will run and finish just fine.\nThis may be related to its registry dependency in the HKCU root key, and since the selected user is not actually logged in then the key may not exist (I'm guessing here, I'm not that familiar with the Windows registry).  This issue might be fixed by performing the switch to using config files in the user's AppData, or if you want to use the registry then you may want to use the HKLM root key.\n. I have run into the same issue and find that I have to use the manual setup.  I'm not sure why this happens.\n. ",
    "Kofl": "I can confirm the issue and workaround which Landle provided.\n. ",
    "csalzano": "I followed Landale's instructions above to copy the files and the registry key. The renew command still prompts for input before closing, so\nmy scheduled task doesn't finish until the time limit is reached and Task Scheduler kills it. This is what I'm running: \nC:\\letsencrypt-win-simple-master\\letsencrypt-win-simple\\bin\\Debug\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\nThe output always ends with \"Press enter to continue.\" and the program waits for that input.\n. This is old but still open. Can this project renew a cert without changing the keys now?. Thank you much for the quick response.. ",
    "nmg196": "@mistercorey You probably compiled in Debug mode. Never upload a Debug version of LetsEncrypt to production :) . Has this problem been raised with Microsoft? Is there an existing ticket reference I can cross-reference?. If @Symbiatch's fix works, then this solution seems to be a LetsEncrypt client problem and this bug needs reopening?. I ran into this too.  I think it would be better if the application told you about the \"access denied\" problem (from the HTTP Status Code) rather than just showing the JSON error. Something like \"Error: Remote server returned 'Access Denied' while trying to access http://(api url). Please verify you can access this URL in your browser.\"\nThe solution for the cause of the error is that the application was not using the network's default proxy server.  As such, the fix was to add the following section to letsencrypt.exe.config:\n<system.net>\n         <defaultProxy enabled=\"true\" useDefaultCredentials=\"true\" />\n    </system.net>\nAs this is closed, I'm not sure anyone will notice this comment though?\n. Perhaps it might be best to swap that line for \"if (Debugger.IsAttached)\"?\nSee: http://nickg.uk/2ekjJrE\n. Isn't this a simple matter of checking this box? (Which the install routine should really do itself)\n\nI also recommend checking \"Stop task if it runs for longer than 1 hour\" in case you accidentally install a debug build which would wait for keypress.\n. @jorik90 I think you may also need to add this line to Program.cs around line 947:\ntask.Settings.RunOnlyIfLoggedOn = false;\n. I think manually installing the intermediate certificate first (or after) is an easier solution though?\n. Yes, on a new installation, the intermediate certificates are missing from the certificate store on the server. Once installed on the server, they then get sent to the client OK.\n. Another option would be if the client didn't delete the .well-known folder and web.config - that way I can put in an override to remove any conflicting setup/modules.   However it gets wiped after any renewal (successful or not). OK - I'll try an alternate validation method next time and I'll close this issue.. My customer's web server is behind a proxy for the purposes of outbound requests. Is there a way to tell the client to use a proxy?  This link works fine in a browser, but cannot be accessed from letsencrypt.exe:\nhttps://acme-v01.api.letsencrypt.org/directory\nThanks!. ",
    "556556bt": "ooh i see. but without DNS challenge, how LE verify for the domain ownership?\n. it means it still needs both port 80 and 433 directly go thru. to work, correct?! \n. https://community.letsencrypt.org/t/shouldnt-verification-via-dns-record-be-a-priority/604/9\nis it the one they are talking about? \nso that will be much more better to use DNS rather than touching the web server but it may makes those using DDNS have some difficulties.\ndo you know when DNS challenge will be launched and letsencrypt-win-simple will support too?\n. ",
    "bandleader": "Any idea when this will be supported?\nI am happy to help.... I don't mean automatic DNS authentication. \nI mean manual. \nI.e. Program gets a string to put in a TXT record on your DNS server/provider, you manually put it in, come back to the program and it downloads/installs your certificate. . @WouterTinus How would that work -- if you choose a different binding, wouldn't LE issue the certificate for that wrong hostname?. @WouterTinus It has to be on port 80? But then that will conflict with the user's existing binding.... Much appreciated!. I would still encourage the \"dummy.txt\" method described above, in order to diagnose if the problem is with extensionless files or not.. @rdebath No need for a Wiki page; the program could simply print \"Please check the URL in a web browser.\" The problem is (as descibed above) that the URL is way too long to be typed into a web browser. That's why I suggested options 1/2/3 above.\n@WouterTinus Interesting -- I've been away from LetsEncrypt -- which validation method is currently recommended instead?. Very interesting. Will have to take a look. Thank you for your work!. ",
    "rdebath": "The problem with automatic DNS authentication is that a different script is needed for every DNS provider, for example getssl does a few, but one of them is a wrapper around lexicon that does loads more.\nThe main requirement would be to convert all these scripts to something that runs on Windows (probably also adding a script to update Microsoft's DNS server) ... not a small task.\nSo at this time I would suggest that your best solution for DNS validation is to use a Linux or BSD VM somewhere secure to renew the certificate and then post the signed certificate to the target server using whatever method is most convenient. (Note: The key needs to be transferred over a secure channel but a signed certificate need only be validated at the destination)\n. Yes. Just to add a counterpoint, I think the original is easier to follow.\nIt could, perhaps, be tidied a little by putting the return statements onto their own lines and adding a blank line between the pre-checks (simple cases) and the array/etc section.\nThe heavily indented one is hiding the division between the simple cases and the more complex one and so making the entire function look more complex than it is.\nIf C# had the structure this might be a perfect example for using a CASE TRUE OF...ELSE.. construct.\n. For the generic plugin I have a similar use case.\n- Startup IIS-80\n- Update the Certificate&key\n- Store the Certificate&Key in the machine Certificate store\n- Stop IIS-80\n- Insert the Certificate thumbprint into a particular XML file\n- Give access to the Key to a particular user or group (eg: Network Service or DOM\\ServiceUser).\n- Restart a Service. (Or schedule a restart for 3am)\n- Delete expired certificates.\nNotes:\nThe IIS-80 could quite easily be a web service provided by some other means (eg: WCF)  as the port will be empty.\nI want to keep all unexpired certificates so that the old certificate is, probably, still around until the next Windows Update reboot.\n. Oh, does \"--keepexisting\" still delete dead certificates? The Wiki seems to say it turns off the delete completely.\n. I would suggest you use something like http://www.infobyip.com/httpservertest.php\nIt will try to connect to the URL you give and give you the error or a HTTP/1.1 200 OK and the Content-Type: it gets (which has to be json)\n. It has to be possible to access the site from outside your local network, many things can prevent this but still allow you to connect using a local web browser because your browser doesn't have to go through the same routes (eg firewalls) and has access to things like the tokens that you've got because you're logged on to your local network and various websites.\nHave you put the URL into the form on \"infobyip\" ? What does it say ?\n. Just adding a note that this is now https://tools.ietf.org/html/draft-ietf-acme-acme-01#section-7.3 in the acme-01 spec used by Let's Encrypt.org with the type \"tls-sni-01\".\nIn addition le-org does NOT currently support acme-05 https://tools.ietf.org/html/draft-ietf-acme-acme-05#section-7.3 which has an updated version \"tls-sni-02\". Otherwise le-org are using acme-05 https://github.com/letsencrypt/boulder/blob/release/docs/acme-divergences.md\n. 1) @DumbJoe LE will follow your redirection to https, or you can exclude the .well-known directory from the exclusion. If you keep the redirection IIS needs a certificate for https, but it doesn't have to be valid.\n2) @benlavender The account key does have a longer validity term associated with it so a second manual validation related to the account key is a reasonable thing to do. This is one of the reasons for ACME-2 which changes the process slightly to make this easier for OV and EV certificates (Not LE AFAIK).\n3) Example\n``` xml\n     Rule 1 redirect anything not an ACME challenge to same URL in https \n\n\n\n\n\n\n\n\n``. Yes, that's an IISweb.configfragment.\nThis is formod_rewritein an Apache conf or.htaccess`.\nRewriteEngine on\nRewriteCond %{HTTPS} !=on\nRewriteCond %{REQUEST_URI} !^/\\.well-known\nRewriteRule ^/?(.*)$ https://%{SERVER_NAME}/$1 [L,R=301]\n. https://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#RewriteCond\nYou need a full set of conditions for each rule, or you can use [OR] like I've tried below.\nAlso there is a \\ quoting the initial . of .well-known.\nSo I guess about ...\nRewriteEngine on\nRewriteCond %{HTTPS} !=on [OR]\nRewriteCond %{HTTP_HOST} ^www\\.\nRewriteCond %{REQUEST_URI} !^/\\.well-known\nRewriteCond %{REQUEST_URI} !^/less-well-known\nRewriteRule ^/?(.*)$ https://%{SERVER_NAME}/$1 [L,R=301]\n. FYI: from https://community.spiceworks.com/topic/1045017-windows-server-2003-r2-x64-iso\nThese links seem to still work.\nGary D Williams Jul 2, 2015 at 7:42 PM\nThe hardware is pretty much ancient. You won't get drivers for that card.\nWindows Server 2003 R2 Standard Edition with SP2 Trial (32-bit x86)\ndisk1: http://download.microsoft.com/download/5/1/C/51C53A00-7F8B-423C-A841-8B9C49B910BF/X13-04874.img\ndisk2: http://download.microsoft.com/download/5/1/C/51C53A00-7F8B-423C-A841-8B9C49B910BF/X13-04795.img\nWindows Server 2003 R2 Standard Edition x64 with SP2 Trial (64-bit x64)\ndisk1: http://download.microsoft.com/download/F/9/D/F9DA93F8-2814-4B9B-A6A1-EA9B6B7E8BD6/X13-05825.img\ndisk2: http://download.microsoft.com/download/F/9/D/F9DA93F8-2814-4B9B-A6A1-EA9B6B7E8BD6/X13-05774.img\nUse 2003 at your own risk. End of life, etc.\n. If your host is: www.\u00fc\u00f6\u00e4.com and you add www.xn--4ca9ar.com as an alias (eg See here for a translator) will it work ? Would you have to remove the IDN first? \n. Two probably significant questions for this enhancement:\n\nMost importantly, which DNS provider's API would you need?\nAssuming the protected services are not publicly accessible have you tried using private CA, why doesn't it work for you? Note: Windows certificate services automatically makes the private CA trusted by all domain connected computers.. Turn off the redirection for the \"well known URL\" ? ... https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/web.config#url-rewrite-support\n. Almost right.\n\nThe challenge response must be accessible from the public internet on the address http://websiteaddress/.well-known/acme-challenge/xxx\nYou can't have it just on port 8888, it must be visible on the standard http port -- 80\nNote, the rest of your web site does NOT have to be accessible on port 80, just that particular set of URLs. In fact nowadays it's probably best if \"the meat\" of your website is only available over https.\n. see #203 \n. @Knagis The --keepexisting flag stops the old certificate being deleted.\nOtherwise, you both might be better off with a 'manual' (or san) update.\n. @cpu, when ACME/Boulder follows http redirections will it go to non-standard ports as well as standard http and https?\n. @gerard-kanters If you don't give us the URL we can't help directly.\nI would suggest you use something like http://www.infobyip.com/httpservertest.php\nIt will try to connect to the URL you give and give you the error or a HTTP/1.1 200 OK and the Content-Type: it gets (which must be \"text/json\")\n. You need to see it from the internet not from the PC it's running on.\nI would suggest you use something like http://www.infobyip.com/httpservertest.php\nIt will try to connect to the URL you give and give you the error or a HTTP/1.1 200 OK and the Content-Type: it gets (which has to be json)\nAlso for ACME the URL must be http and must NOT have a port number.\n. It looks fine from here, did you fix it?\nOr perhaps you made a mistake with the DNS the first time you tried it, if you do that you may have to wait for the DNS ttl to expire before it'll succeed.\n. I don't see where you save the config directory name for the scheduled task.\nIf one is created it really needs access to the data in the directory from the first run.\nI would suggest the location should be dumped into the registry and pulled from there by all future invocations including the scheduled task.\n . Not it's a host name.\nYou should add the --test command line argument and play with it. (this turn off rate limits, but gives you a dummy certificate)\nWith the DNS system this is also called the \"Domain name\".\nSome people make a distinction that it is a \"full host name\", including the rest of the domain name after the dots as opposed to a \"plain\" or \"short\" host name that's just the first part.\nSome people call just the bit they sell a \"Domain\" because it's important to them. LE's certificates apply only to specifically named hosts (and they don't sell them).\n. No, not with this client.\nHowever, it is not difficult to exclude the .well-known directory from your redirection.\nI use rewrite rules to do the redirection and so add a small section to the supplied web.config to turn it off.\n(The name must match the rule you have at the higher level)\nOr you can override\n```xml\n\n\n\n\n\n\n<rewrite>\n  <rules>\n    <remove name=\"HTTP to HTTPS Redirect\" />\n  </rules>\n</rewrite>\n\n\n\n\n\n\n\n\n```. If the input is redirected perhaps we should realise there's a good reason for the user to do this; like they don't want it to ask something of the user because they won't be there.\nIf the redirected input cannot be read a better solution would be to always return \"Yes\", and make sure \"yes\" is always the reasonable answer.\n. I've just tried with another client (that doesn't understand IDN either) and the trick seems to be to get the certificate using punycode.\nIn this case I made the IDN the first SAN list name. . LWS has accepted the hostname, done it's setup, created an account on LE.com requested validation for the name on LE.com, got an authentication token from LE.com, placed the token on the website and told LE.com to look for the file. LE doesn't like it.\nI'd say it's a connectivity issue; check the URL from outside your local network/firewall eg using https://www.infobyip.com/httpservertest.php (It looks like it understands punycode )\nNote: When LWS is in manual mode it DOES NOT alter the setup of IIS so you'll have to do the extensionless file support change manually. (This is because you might be using Apache or 101 other things)\nPS: You should get this, bold parts are important.\n\nHTTP/1.1 200 OK\nContent-Length: 25\nContent-Type: text/json\nLast-Modified: Mon, 23 Jan 2017 07:35:20 GMT\nAccept-Ranges: bytes\nETag: \"e1be52404b75d21:0\"\nServer: Microsoft-IIS/8.5\nX-Powered-By: ASP.NET\nDate: Mon, 23 Jan 2017 08:27:20 GMT\n. The certificate wasn't created from the session you posted; LE.com said the domain validation file wasn't correct.\nI'd have to access the actual URL to help any more, though one option that's been added for sites that should be working but don't is --warmup.\nNote: The challenge string (Lq...gY) is a completely random number of at least 128bits long, it's safe to publish and won't be reused. It's used as the filename to make attempting attacks on the random number generator impractical. The contents also contain a SHA2 thumbprint of the account key being used to do the validation, this is also safe against eavesdropping.\nhttps://ietf-wg-acme.github.io/acme/#http. I would suggest you (@bandleader)  write a Wiki page which can be pointed at by the program and perhaps referencing https://www.infobyip.com/httpservertest.php as an external testing site to access the files which are left in the directory and can be \"navigated to\" and opened in a browser using IIS manager.\nNote: Neither WouterTinus nor I can really write this page as to us it's all pretty obvious really and we forget which bits took a little longer to work out.\n. @CBruceH\nThe authenticators stored in the .well-known/acme-challenge directory have to be proven for every individual sub-domain. Proof of ownership of a higher level domain is not taken as proof for a sub-domain. But for a given Account key the proof of ownership doesn't have to be done every time you want a CSR signed; last I checked a proof of ownership was supposed to last up to a year.\nFor example, from here I get:\nmail.businessdatatransfer.com. 6489 IN  CNAME   mail.businessdatatransfer.com.netsolmail.net.\nBut mail.businessdatatransfer.com.netsolmail.net does not resolve and so the authentication would fail.\nNote also that, the Let's Encrypt server seems to obey the DNS TTL counters, so if you make a mistake with your DNS you may have to wait for the full TTL period.\n. Have you seen this:\nhttp://serverfault.com/questions/541922/where-to-get-root-ca-certificates-for-windows-server-now-that-microsoft-no-longe\nIs that GPO flag in your domain?. Also note that the \"exportable\" flag do not make it impossible to extract, it only means that none of the standard APIs are allowed to export it. It does not add any sort of 'secure encryption' or similar limitation that makes it infeasible to decode.\n. Looks fine from here as far as I can tell. I'd need a real file name to check the content type.\nNote that letsencrypt-win-simple tries the URL that LE will be checking so it must be available to the web server at the correct public name too.\nYou can test from outside yourself with http://www.infobyip.com/httpservertest.php\n```\nHTTP/1.1 404 Not Found\nDate: Sat, 25 Mar 2017 09:10:29 GMT\nServer: Apache\nContent-Length: 268\nContent-Type: text/html; charset=iso-8859-1\nHTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"\n\n404 Not Found\n\nNot Found\nThe requested URL /.well-known/acme-challenge/data_tests_data_tests_data_tests_data_tests was not found on this server.\n\n```\n\n```\nHTTP/1.1 301 Moved Permanently\nDate: Sat, 25 Mar 2017 09:13:33 GMT\nServer: Apache\nLocation: http://romanel.bible.ch/.well-known/acme-challenge/\nContent-Length: 259\nContent-Type: text/html; charset=iso-8859-1\nHTTP/1.1 403 Forbidden\nDate: Sat, 25 Mar 2017 09:13:33 GMT\nServer: Apache\nContent-Length: 229\nContent-Type: text/html; charset=iso-8859-1\nHTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"\n\n403 Forbidden\n\nForbidden\nYou don't have permission to access /.well-known/acme-challenge/\non this server.\n\n```. SHA1 is now an insecure hashing algorithm Google (and co) recently generated a collision where two files hash to the same result. You need to disable that Cipher combination in IIS (with the nartac tool).\n\nThe LE certificates are fully trusted by ssllabs for example https://www.ssllabs.com/ssltest/analyze.html?d=slashdot.org\n. Looks like networkflare.com-crt.pem and networkflare.com-key.pem\nThough the web server should really provide the chain certificates too so the file for the ssl_certificate should be networkflare.com-crt.pem with networkflare.com-chain.pem appended to the end.\nBut the best solution is to provide the same file to both lines: it consists of, concatenated in order:\nnetworkflare.com-key.pem, networkflare.com-crt.pem and networkflare.com-chain.pem\n(Probably). @nul800sebastiaan That isn't dns-01, it's an httpS only auth method using specially constructed self signed certificates. \nIMO it's a good thing to add to the TODO list for le-win-simple as it doesn't need extra third party interfaces (like dns-01 does) and could actually make things even simpler as you don't need a HTTP binding anymore.  . Task Scheduler arguments are not considered secure private storage.\nI strongly suggest you move the Azure secret to somewhere that can be secured, at the very least a registry key or file where access can be limited to a single user. Ideally, one of the Microsoft stores designed for passwords (though that might be problematic as I don't think the API allows you to save credentials for another user and they're probably limited to Domain\\user/password triples.)\n. They usually are. The %Appdata% path is under the profile and so is accessible only to the user who owns the profile and other administrators. The HKCU path is stored in a registry file under the user profile so has permissions that end up the same when it's not loaded. When it's loaded into memory the permissions can be reduced, but I think by default they are exactly the same.\nThinking it through, the \"password store\" is probably pointless. A password store is (in theory) better because it gives some protection against other administrators and people with physical access (because the passwords are encrypted when on the disk). However, this would only apply if the use's password isn't stored on the machine ... but it (or an equivalent) has to be to allow access by the scheduled task.\nNote: The attack profile here is someone who has gained access to a single user through (for example) an insecure web application. For this attacker finding the passwords for what amounts to physical access to the (virtual) machine would be a big win.\n. @rfaix Always check with Virus Total if you get a report like this.\nOne of the major indicators that some AV products use is how popular an executable is, if you're one of the first to download a new compile you are likely to get a false positive for anything even slightly dubious, such as \"Connects to the internet\", \"Uses encryption\" and \"Not signed by a Microsoft validated key\".\nThis is after all the ONLY indicators that they have for a new type of \"ransomware trojan\".\nBTW: It appears that the false positives are now cleared . For http-01 validation you must have a site on port 80.\nThe site CAN be a redirect to somewhere else (including https) and LE will follow it.\n. @miqrogroove Looks like you have a different problem, I'd guess LE can connect to your port 80, but your setup isn't really \"simple\". \nYou do seem to have missed that the file web_config.xml is the one that LE-WS uses for it's web.config and this can be modified for less simple setups.\nBut, if you want distinct HTTP and HTTPS websites in IIS I think you'll have to use manual mode.. Looks like it an easy manual fix in the certificate store if you need to manually enable it to change your host name. (NB: Computer account, not current user)\nThough \"manual\" every two months sounds like a poor idea, why would you want to do it?. Apache has access to the directory you want to serve, so I can ignore the application you're proxying.\nMy first suggestion is \"Don't proxy HTTP\".\nNote: You already have a full Rewrite on your http as well as the Proxy I have no idea which Apache will prefer and I guess it can change between versions ... so don't do that.\nSet it up so that everything except .well-known/acme-challenge is redirected to HTTPS by Apache.\nThen serve just that directory from the document root and proxy https through your Apache SSL offload.\nGoogle says the best document is here: https://www.hyperborea.org/journal/2016/04/redirecting-https-lets-encrypt/\nIf you do need to proxy http too, I suspect you're going to have to do a regex like the RedirectMatch directive around the http proxy pieces, that looks like ProxyMatch.\nOne last thing, it's probably a good idea to limit the URLs you proxy to the backend server to limit it's attack surface. If the URLs are too variable/varied this may be unreasonable, but a list of ten or twenty would be quite possible (eg: I ended up with fifteen for MS-exchange).\n. This post? https://github.com/Lone-Coder/letsencrypt-win-simple/issues/390#issuecomment-287881663\n@fpeterson194  If you connect from localhost you should get a better error than just \"500\". BTW: Always make sure the LE is actually validating and not just remembering that your account key successfully validated an address earlier.\n. I seem to have some luck with this web.config in the acme-challenge directory (as an application) it should work in the .well-known directory too.\nIt basically turns off all the problems I've come across and just sets the extensionless json.\nRemember the file has to be available both from the internet and the local machine under the public name, this might be an issue if your firewall can't deal with 'hairpin connections'.\n``` XML\nxml version=\"1.0\" encoding=\"UTF-8\"?\n\n\n\n\n\n\n\n<httpRedirect enabled=\"false\" />\n\n<validation validateIntegratedModeConfiguration=\"false\"/>\n\n<handlers>\n  <clear/>\n  <add name=\"ACMEStaticFile\" path=\"*\" verb=\"*\" modules=\"StaticFileModule,DefaultDocumentModule,DirectoryListingModule\" resourceType=\"Either\" requireAccess=\"Read\"/>\n</handlers>\n\n<staticContent>\n  <clear/>\n  <mimeMap fileExtension=\".\" mimeType=\"text/json\"/>\n</staticContent>\n\n\n\n\n\n\n\n\n``` . If you can't connect to the address from your DSL line LE probably won't be able to connect from their line either. So they won't be able to see your proof of ownership.\nWe would need to know the error you're getting when you connect like LE are going to connect\nI would suggest you use something like http://www.infobyip.com/httpservertest.php\nIt will try to connect to the URL you give and give you the error or a HTTP/1.1 200 OK and the Content-Type: it gets (which may have to be json). No, the problem isn't with the certificate itself, the item modified by the -csp is a label on the PFX container file format. In fact the -CSP option can me moved to the second openssl command where it labels the PFX file itself as having been provided by the old Microsoft library.\nAs they stand the first openssl command extracts only the signed certificates and the key from the PFX file, it ignores all the additional Microsoft provided \"****\". The second openssl command creates a minimal PFX file with none of the labels or metadata about the certificates set. Neither of these commands can change anything in the certificate because that would break them. Especially they cannot change the public key, which is the only thing that a CA will use unchanged from the CSR. \n. You need to do at least what kdhoe1 did, tell us the error and the URL that should be available.\nIf not all we can do is tell you to try a service like: https://www.infobyip.com/httpservertest.php\n. Read the rest of the Email; LE does NOT check your server, it sends the email about 70 days after a certificate with that exact Common Name and SAN list was refreshed by the account.\nIf the san list, common name or account key gets changed you will get spurious emails.. Oh, sorry, it's another instance of #340 then? Is the registry entry out of sync? Do you have any idea what broke in May?\n@nul800sebastiaan, other ACME clients seem to hang onto a copy of the certificate and get the date from their copy when they want to do an expiry check. As I see it that would have the advantage that it's impossible for the  client to update the date unless it gets a certificate. If it doesn't notice an error it'll end up storing something invalid which fails when it checks next time hence triggering a retry. The Email seems to imply that something like this is happening as LE didn't issue a matching cert.\n. There's a port scanner a https://www.grc.com he calls it \"ShieldsUP\". The 'all ports' version gives a colourful block of ports that are open, closed or filtered. Please ignore his paranoia, he thinks that all machines on the internet should never respond to unsolicited packets; this is dubious for client machines and downright stupid for servers.\n. no yes. Oh, that used to just say no. The requirement for DNS-01 validation makes sense and the protocol changes look pretty small.\nI imagine IIS will be the problem.\n. Not \"LEWS\" specifically, but LE certificates are fine with terminal services any you tell it to use the certificate by loading the cert into The \"Local Computer/Personal Certificates\" store and loading the Thumbprint/Fingerprint into the below location...\n``` bash\nRemote desktop\nRKEY='HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp'\nreg ADD \"$RKEY\" -f -v SSLCertificateSHA1Hash -t REG_BINARY -d $THUMBPRINT\n```\nPS: That bit of script will have the quoting completely wrong for normal windows, but you'll get the idea.\n. No, it was removed from http-01 because of a rather too common misconfiguration of shared hosting providers.\nThe DNS-01 protocol needs neither a http nor a https server.\nThe tls-sni-01 and tls-sni-02 protocols do work on https, but they're rather different to http-01 and not supported by LEWS. . LE do follow an HTTP/301 or 302 redirection quite happily. You'll need a certificate on there so the server isn't broken, but LE don't check it in any way so a self-signed one is fine.\nBut I don't know how LEWS reacts to this, you may have to trick it's accessibility check.\n. https://www.nartac.com/Products/IISCrypto/\nThe IISCrypto program allows you to enable the older SSLv3 and TLSv1.0 on your machine IF you need to take the risk to allow the old browser or bot that's trying to connect to do so. The ssllabs site lets you see how your server's configuration responds and, indirectly, which browsers will connect with which protocol versions.. The private keys that you load into CertMan are NOT stored in the registry. They exist on the filesystem under the directory:\nC:\\Users\\%USERNAME%\\AppData\\Roaming\\Microsoft\\Crypto\\RSA\n\nThe \"Computer\" store is under \nC:\\ProgramData\\Microsoft\\Crypto\\RSA\\MachineKeys\n\nSo if the profile for a particular user is temporary (missing) some of the private keys won't be available.\nThey also don't always get deleted; another reason for making sure that your PFS is working properly.. PFS means 'perfect forward security'. Also known as \"Forward Secrecy\".\nIt's nothing to do with LE or LEWS directly, it's related to the cipher combinations that the SSL library negotiates with the web browser. When they both agree to use a suitable combination an encryption key is agreed on the fly between the two ends that only they know. What's more, once the connection has closed and they have deleted the 'session key' not even they can go back and decrypt a log of the connection. Even though the server has the private key for the certificate.\nThis means that IF all connections used (P)FS and all certificates using that key have expired the private key becomes completely useless (even to an attacker) as it was only ever used to authenticate the connection and never used to encrypt anything that went over the wire. \nOTOH, normally, you have to be very sure to delete the private key from an old machine, you really don't want it left in a random (hidden) directory in a forgotten corner.\nSSLLabs has a writeup about (P)FS ... \nhttps://blog.qualys.com/ssllabs/2013/06/25/ssl-labs-deploying-forward-secrecy\n. Importing into the certificate store doesn't delete or overwrite the old certificate. However, by default LEWS will delete the old certificate. See the --keepexisting option.\n. Manual mode... yes that's how I understand it.\nSwitching plugins... I suspect it's not going to be that simple, yes, you should be able to change the setup but a plugin does more than just switching where the certificate is placed. It also makes changes as to how the certificate is validated and downloaded.\n. Small question this name:\nC:\\inetpub\\wwwroot.well-known/acme-challenge/0ZHb5kOp0YhYTtb_O_g-9IS4pvxYsOYuxlHS5EvIlx8\nIt should have a \\ before the .well-known ...\nIs that it?. No, no paths go back to LE, and they should notice the 404 and give a different message.\nBut ... if the display is a real issue and the web server is setup with a redirect on 404 and the redirect is one of those \"helpful\" ones that redirects to a search page with a \"200\" response. Well, they'd get a page without any error and without any json.\n. Nothing to do with LEWS.\nThe LE CA will not issue domain validated certificates for a .onion address. These addresses are specifically excluded for all except the (very) expensive and very non-private \"Extended validation\" certificates by the CAB rules that a CA must follow to be included in the browsers.\nThis isn't that unreasonable because you're actually asking something rather contradictory here: A certificate that uniquely identifies an anonymous website.\nNow this is possible, but a single trusted third party can't do it. The only way I can think of offhand is a trust score kind of scheme where you ask lots of third parties what the right key is and trust the consensus. AFAIK there isn't any software for this so the only way to do it would be for the website to use a self-signed certificate (or single use CA certificate) and the visitor checks the certificate by other means the first time they see it.\nAnother possibility that the browsers could do would be to treat the onion address as a proxy. So you connect to https://github.com.bwz1FYjkZ2spfLws.onion the SSL connection would be to bwz1FYjkZ2spfLws.onion and the remote certificate must contain github.com. This obviously wouldn't be anonymous for the web site but would be anonymous for the client which would only need support from the browser for a secure connection (with no special support from the certificates and only, maybe, an SNI alias on the website)\n. Oh, extras. Okay, I checked out the new onion addresses; they're very simply 256bit ed25519 public keys. This has a rather weird effect in that the certificate for SSL does not need a CA. All it has to do is provide a certificate signed by that same public key. \nPutting it another way the address itself is the certificate.\nWeird!. From here I'm getting a holding page for that domain, not a default IIS page or 404 or other.\nIn fact the final IP is in The USA, probably Las Vegas.\nIs the DNS I'm seeing right ?\n``` asm\n;; ANSWER SECTION:\nmerge.taffy.cn.         43      IN      CNAME   t.dcoin.co.\nt.dcoin.co.             272     IN      A       170.178.178.60\n;; AUTHORITY SECTION:\ndcoin.co.               6868    IN      NS      ns3.dnsv2.com.\ndcoin.co.               6868    IN      NS      ns4.dnsv2.com.\n```\n. Okay, I successfully downloaded the verification file from two continents too, so LE should be able to also.\nHowever, their DNS cache will be polluted with your old AAAA record for the TTL that that record had. If it was ten minutes it should work now, otherwise you might have to wait til tomorrow. If you tripped a rate limit you'll also have to wait a while (the test server has much higher rate limits and is unlikely to trip). \nIf it's still not working I'd be starting to think about firewalls and routing problems. The connections should be coming from one or more of outbound1.letsencrypt.org, outbound2.letsencrypt.org and so on and those hosts are pingable (I don't think they have web servers on them though).\n. LE only use other ports if you set a redirection for them, so you can, for example, redirect the acme folder to a different web server or a different machine if you like. Of course you'd then have the problem of installing the new certificate on a remote machine 'cause LEWS won't do that for you.\nOkay, differences between now and when LE is checking ...\n\nDoes this file exist at the moment: \nC:_websites\\emptysite\\.well-known\\acme-challenge\\web.config? If not does copying the file from C:_scripts\\letsencrypt-win-simple.V1.9.3\\web_config.xml break anything?\nThe check file has just been created at verification, there may be a delay, does --warmup make a difference?\n. Well, you'd better add the --verbose flag to the command line too. However, be aware that it may show private keys which you'll have to discard or even revoke (if used on the live server) afterwards.\n. Right! I see the problem; your DNS provider is giving out a SERVFAIL for a valid query.\n\nIt looks like your DNS server getting confused when a CAA request is sent to it. If I get dig to do a trace for an A record 112.90.141.215 is giving me the data. For an AAAA record it gives me a nice \"nope\" but for a CAA record it falls over. For a UDP query it just doesn't respond, for a TCP query it looks like it closes the connection.\nSounds like something you need to talk to your DNS provider (dnspod ?) about.\n. However, while not supported, most DNS servers don't fall over :-1: when asked for a CAA, they just can't be configured to respond with one. . I'm getting this list from the directory, so the files appear to be there, however, if I try at access any of the files themselves I'm getting a 404. This would normally be because there isn't a web.config file to enable the extensionless files. In this case you appear to have something at a higher level overriding the web.config file. The fact that I'm actually getting a listing is also an indicator of this as IIS doesn't normally do this sort of directory listing unless you specifically enable it.\nBTW: We can't see the webconfig in your message as you haven't surrounded it with lines. \nNB: I don't seem to have a Windows 2016 demo machine handy so I can't tell if this is a new default or something you've changed though.\n                        certauth.fs.dataproces.dk - /.well-known/acme-challenge/\n                                              certauth.fs.dataproces.dk - /.well\n     _______________\n[To Parent Directory]\n  9/7/2017  4:40 PM           87 e4KEV5t7C_Z8IW01M6DYkzWkx1XE2yUN5kBcwyJfuyM\n  9/7/2017  4:56 PM          162 web.config\n  9/7/2017  4:57 PM           87 YL_I1GHUGtOcp-FtfUEaC62YZSYku7KVeU3N5lgEtDQ\n  9/7/2017  4:56 PM           87 z8BkuNmsqi2VQfoYoITm6Rbr_Chtumzs-IkM2gMjwAQ\n     _______________\n```\n. I guess that is https://github.com/Lone-Coder/letsencrypt-win-simple/issues/532#issuecomment-326778347\n. Actually I found this flag confusing at first too.\nI thought all it did was to make the program use the test server, everything else would work exactly as it does in live.\nBut instead it messes with several other things too, so I ended up doing some tests using the production LE server because LEWS was working \"wrongly\" against test.\n. I note that it isn't unreasonable to completely remove a change with (for example) git rebase rather than using revert on a \"develop\" branch. Even if you happen to be pushing it to a publicly visible repository.\nOf course, now that you've merged it into \"master\" there will be grumbles if you change that. :smiling_imp: \nAlso the modification is because of the \"* text=auto\" line; those DOS copyright hacks have been a pain for decades.\n. One of the nicest things about git is there are NO rules. But, there are lots of recommendations and suggestions from lots of people...\nA git repository is very much like a very large pile of zip files (the 'tree' objects containing 'blob' objects) these are linked together into chains (the 'commit' objects). The most recent item in a chain needs a pointer (mainly the branches, tags and the reflog), if it doesn't have one it will (eventually) disappear. Everything else is an illusion of the particular tool that you are using, but some of these tools make really, really good illusions. \nThe rebase tool lets you look at a single chain and treat it as a list of changes, you can then reorder those changes. The tool does this by creating new trees that are what you would have got if you had made the changes in the new order; it then points the branch at the new \"most recent\" tree.\nThe various merge tools (or methods) take two (or more) branches that were forked and link them together with a new tree that's supposed to be what you would have got if you made the changes in sequence to a single chain. The normal merge literally does that, it takes two chains and goes down one of them creating lots of patches which it applies in sequence to the top of the other chain. The final result of this becomes the 'merge commit' and contains pointers to the heads of both previous chains.\nSo, probably, yes, the rebase doesn't really understand merge commits (or rather it probably won't do what you want with them) so rebase first then merge is likely right. Though cherry-pick, format-patch and many other tools can be good too.\nBUT, the most important thing to remember though all this is probably the reflog, it is always possible to force any branch head to point at any commit. But it's the reflog that lets you find the commit that want; for example the commit that master was pointing at twenty four hours ago.\nAlso, you may notice that everything is done on the local repository there is no such thing as a distributed GIT repository. Only the chains and their pointers are transferred between repositories by the single command that makes GIT a \"DVCS\". Specifically this means the reflog only exists in your copy of the .git directory. DON'T delete it.\nOh, and one last thing; if you have changes in the working directory COMMIT THEM (you might like the stash command for this). It doesn't matter where because you can always merge, rebase or cherry-pick them to exactly where you want them later, but if you overwrite uncommited changes they are lost.\n. Naa, that's fine, I'll help out when I have time, but I'm really not that keen on Microsoft Java.. AIUI Windows downloads \"other\" root certificates from Microsoft on the fly.\nWouldn't it be better to trigger this automatically rather than doing an override for everything.\n. It appears all you have to do is use one of the Windows SSL libraries to access a page with the right CA.\nI'd suggest https://valid-isrgrootx1.letsencrypt.org/ as that's what it seems to be for.\nOTOH, just viewing a certificate (double click on the CRT file) seems to do the same thing as long as the machine can access Windows Update.\n@myspace-nu I guess this windows 2008 (still in extended support) machine isn't fetching it's own windows updates.\nThis makes a problem; the only root certificates in the Windows store by default are Microsoft ones, they will only validate Microsoft servers (like WU), but if the machines can't access WU to download other certificates it's not going to trust any other site. So while Certutil -syncWithWU can be used to download the certificates it's not going to be much use because it'll have to be run on another server.\n. That's my understanding. \nHowever, I do know that there are at least two HttpWebRequest interfaces (The user and the Server variants) and the version of ACMESharp you're using is using the OpenSSL libraries which has the option of using it's own certificate store and even when it's using the Windows one may not call it 'correctly' in some obscure way. \nBut on the plus side Microsoft did add nice tracing to Windows Vista and later for the SSL validation:\nhttps://technet.microsoft.com/en-us/library/cc749296(v=ws.10).aspx\n. Okay, I've found a Windows 2008 machine.\nThe DST root certificate IS present on the machine and valid.\nThe server certificate is well-formed and acceptable to Windows 2008.\nThe problem seems to be the cross-signing, the ISRG root is NOT in the certificate store but Windows 2008 doesn't seem to be able to correctly chase down the alternate chain.\nIf the below certificate is loaded in the Intermediate store MSIE becomes happy with the website certificate (presumably) because it gets forced down the alternate chain to the DST root that it knows about.\nAIUI LEWS has access to the intermediate certificate and should be able to load it into the computer intermediate store automatically.\n-----BEGIN CERTIFICATE-----\nMIIEkjCCA3qgAwIBAgIQCgFBQgAAAVOFc2oLheynCDANBgkqhkiG9w0BAQsFADA/\nMSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT\nDkRTVCBSb290IENBIFgzMB4XDTE2MDMxNzE2NDA0NloXDTIxMDMxNzE2NDA0Nlow\nSjELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUxldCdzIEVuY3J5cHQxIzAhBgNVBAMT\nGkxldCdzIEVuY3J5cHQgQXV0aG9yaXR5IFgzMIIBIjANBgkqhkiG9w0BAQEFAAOC\nAQ8AMIIBCgKCAQEAnNMM8FrlLke3cl03g7NoYzDq1zUmGSXhvb418XCSL7e4S0EF\nq6meNQhY7LEqxGiHC6PjdeTm86dicbp5gWAf15Gan/PQeGdxyGkOlZHP/uaZ6WA8\nSMx+yk13EiSdRxta67nsHjcAHJyse6cF6s5K671B5TaYucv9bTyWaN8jKkKQDIZ0\nZ8h/pZq4UmEUEz9l6YKHy9v6Dlb2honzhT+Xhq+w3Brvaw2VFn3EK6BlspkENnWA\na6xK8xuQSXgvopZPKiAlKQTGdMDQMc2PMTiVFrqoM7hD8bEfwzB/onkxEz0tNvjj\n/PIzark5McWvxI0NHWQWM6r6hCm21AvA2H3DkwIDAQABo4IBfTCCAXkwEgYDVR0T\nAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAYYwfwYIKwYBBQUHAQEEczBxMDIG\nCCsGAQUFBzABhiZodHRwOi8vaXNyZy50cnVzdGlkLm9jc3AuaWRlbnRydXN0LmNv\nbTA7BggrBgEFBQcwAoYvaHR0cDovL2FwcHMuaWRlbnRydXN0LmNvbS9yb290cy9k\nc3Ryb290Y2F4My5wN2MwHwYDVR0jBBgwFoAUxKexpHsscfrb4UuQdf/EFWCFiRAw\nVAYDVR0gBE0wSzAIBgZngQwBAgEwPwYLKwYBBAGC3xMBAQEwMDAuBggrBgEFBQcC\nARYiaHR0cDovL2Nwcy5yb290LXgxLmxldHNlbmNyeXB0Lm9yZzA8BgNVHR8ENTAz\nMDGgL6AthitodHRwOi8vY3JsLmlkZW50cnVzdC5jb20vRFNUUk9PVENBWDNDUkwu\nY3JsMB0GA1UdDgQWBBSoSmpjBH3duubRObemRWXv86jsoTANBgkqhkiG9w0BAQsF\nAAOCAQEA3TPXEfNjWDjdGBX7CVW+dla5cEilaUcne8IkCJLxWh9KEik3JHRRHGJo\nuM2VcGfl96S8TihRzZvoroed6ti6WqEBmtzw3Wodatg+VyOeph4EYpr/1wXKtx8/\nwApIvJSwtmVi4MFU5aMqrSDE6ea73Mj2tcMyo5jMd6jmeWUHK8so/joWUoHOUgwu\nX4Po1QYz+3dszkDqMp4fklxBwXRsW10KXzPMTZ+sOPAveyxindmjkW8lGy+QsRlG\nPfZ+G6Z6h7mjem0Y+iWlkYcV4PIWL1iwBi8saCbGS5jN2p8M+X+Q7UNKEkROb3N6\nKOqkqm57TH2H3eDJAkSnh6/DNFu0Qg==\n-----END CERTIFICATE-----\n. Woah, that sounds like you're getting an error when you attempt to connect to the API at https://acme-v01.api.letsencrypt.org/ the problem with that is that it does NOT use a Let's encrypt CA at all. (The bootstaps problem) \nSpecifically the certificates are:\nSubject: CN=*.api.letsencrypt.org, O=INTERNET SECURITY RESEARCH GROUP, L=Mountain View, ST=California, C=US\nSubject: C=US, O=IdenTrust, OU=TrustID Server, CN=TrustID Server CA A52\nSubject: C=US, O=IdenTrust, CN=IdenTrust Commercial Root CA 1\n\nWhich is the same CA chain as https://www.identrust.com\nSo I think you need to find what the actual problem is, a full debug log from LEWS might help, but you'll probably have to follow https://technet.microsoft.com/en-us/library/cc749296(v=ws.10).aspx to get windows to log what's really happening.. I'm not 100% certain without doing a lot more checking, but I think if you break the verification of the API SSL certificate the MITM attack that you allow would be able to assign the validation that you complete to a different account key.  This would allow the attacker to get LE to sign their public key instead of yours. I don't think this could be done silently; but that wouldn't matter much if it just looks like a network problem. I hope you're checking the certificate transparency logs, just in case.\nOTOH a DNS hijack would only be able to prevent you completing the validation. . <<REPLACED>>\nHang on --- nevermind. I see. You've put your CA in a subdirectory.\nIt doesn't match existing public servers, but it is explicitly allowed by the standard.\n<<EDIT2>>\nIn fact the way I read it it doesn't even have to have the name \"directory\", and never did.. A bit late but Windows GUI applications (including explorer) DO allow you to create a file or directory beginning with a dot just use .well-known. with a dot at the beginning and the end. Windows will fix this to remove the trailing dot without complaining.\nIIRC this also works in the web.config.. ",
    "Legion-5": "I already added StaticFile Handler above 3 ExtenssionlessHandler and create web.config in .well-known directory. And still doesn't work\n. There is domen validation...\nI create a domain, and now autorization result valid\n. ",
    "DraviaVemal": "Hi I am Trying to install SSL using Using your letsencrypt-win-simple package code\nI made all thing ready It is going smooth till I select my site host name and local path to store the certificate. once i cross the step its showing error.so kindly help me to solve the issue,\n\nplease .\n. I tried re-writing the code the results are not positive.Sorry\n\n\nI am having accesses to account details without errors in normal code if I rename(rewrite) my account(credentials) as you said the result is shown as bad request during power shell azure login.Please help me to sort out the problem\n. @hazzik  If I tried as You said I get the following response\n\nI checked my web page directory using FTP I can't see any uploads there I Donna whether this will show any upload but said this info. may be it will be useful for you to trace the problem caused. \n. @hazzik  and @sjkp  Thank you so much finally we succeded sucessfully got ssl\n@sjkp  it was my mistake I changed the root folder of my site so the kit uploaded content was inside root and not identified\nand as @hazzik said the certificate installs on second time\nonce again thank you guys :)\n. @sjkp  sure I will try and let you know the result tanks again :)\n. ",
    "hazzik": "@sjkp it does not support to retrieve subscriptions from other tenants\n. @draviyam just put empty string to the temp folder\n. @sjkp I have only trial subscription of azure, and default tennant does not show this subscription. If I try to get that subscription explicitly (client.Subscriptions.Get(mySubscriptionId)) I receive following error:\n\n{\"The access token is from the wrong issuer 'https://sts.windows.net/f8cdef31-a31e-4b4a-93e4-5f571e91255a/'. It must match the tenant 'https://sts.windows.net/f8e7c348-af14-40aa-b2e7-99d4519d49d6/' associated with this subscription. Please use the authority (URL) 'https://login.windows.net/f8e7c348-af14-40aa-b2e7-99d4519d49d6' to get the token. Note, if the subscription is transferred to another tenant there is no impact to the services, but information about new tenant could take time to propagate (up to an hour). If you just transferred your subscription and see this error message, please try back later.\"}\n\nThe tenant \"f8e7c348-af14-40aa-b2e7-99d4519d49d6\" can be found in client.Tenants.List(), where client is SubscriptionClient.\nI fixed the error by authorizing like this:\ncsharp\nvar authContext = new AuthenticationContext(settings.AuthenticationEndpoint + \"f8e7c348-af14-40aa-b2e7-99d4519d49d6\", settings.ValidateAuthority);\nI will try to come up with a generic solution \n. @draviyam just try again, it worked only from second time (I'm not sure why).\n. ",
    "sjkp": "@hazzik what do you mean by other tenants? Do the account you login (which is an organizational account) have access to more than one tenant? \n. @hazzik the easiest way around it would be to just use the tenant you want to login to instead of common on line 127 in AzureWebSitesPlugin.cs \nvar authContext = new AuthenticationContext(settings.AuthenticationEndpoint + \"YOURTENANT.onmicrosoft.com\");\nI don't know how to list the tenants with meaningful names with the ARM libaries, if I figure it out I will update the pull request. \n. @draviyam my comment about line 127 was for @hazzik \nSound strange that it isn't working. Are you sure nothing is uploaded, you can e.g. check using yoursitename.scm.azurewebsites.net go to debug console and you can browse into site\\wwwroot.well-known? \nIt should look something like this (the challenge file should be named differently)\n\nCan you browse the URL http://apartmentz360.com/.well-known/acme-challenge that is printed to the console? \nAre your site written in PHP? I can see a request header, X-Powered-By:PHP/5.6.10 I don't know how PHP handle the web.config file that I write to the acme-challenge folder. \n. @draviyam please take note, that you have to remember to renew your lets encrypt certificat with the tool before it expires, the tool in its current version doesn't automatically update it. I have been working on a site extension, that automatically updates the certificate, but it is a little more involved to setup at first. Just search for \"Letsencrypt\" under site extension in azure preview portal if you want to try it out.\n. @rkerber it's okay - im not gonna maintain this plugin, it was mostly a proof of concept. I have created a site extension that is better suited for using lets encrypts certs on azure websites. https://github.com/sjkp/letsencrypt-siteextension \n. I'm trying to hunt down this bug in the azure site extension that uses the same code. So far I cant see what goes wrong, other that the cert chain in the pfx files still have the Authority X1 instead of the new one X3. But the code in GetIssuerCertificate looks like it would do a lookup to get the issuing cert, but maybe \nvar upLink = links.GetFirstOrDefault(\"up\");\nIs returning the wrong thing. \n. I have follow up question. The pfx generated by acmesharp does contain the x3 intermediate i verfied this by converting it to pem with openssl. But when i install it on my windows machine and look at the certificate chain it shows the x1 cert as the intermediate. \nI the check the certificate store (intermediate store for current user) and see both x1 and x3 there. Okay I then remove the x1 from that store and now my chain looks correct on windows too. Any ideas how i can fix this without uninstalling x1?\n. It is not hardcoded if you look at the code you would see that it does follow that link and downloads the correct intermediate. It the adds that to the pfx. \n. Well it is probably caused by something with the certs that windows handle in a less then ideal way. But I cant confirm it just tell what im experiencing\n. I recommend following along in https://github.com/ebekker/ACMESharp/issues/119 \n. Yes there are some File.Exists checks in \nhttps://github.com/Lone-Coder/letsencrypt-win-simple/blob/e13f1332c1aa8b40b77dc0769d0debeed6997bb8/letsencrypt-win-simple/Program.cs#L963-L976\nThat I dont really understand why is there. \n. ",
    "sebastienfi": "Same as here : https://github.com/ebekker/ACMESharp/issues/55\nThe complete discussion thread about \"should we change it and how\" is here : https://github.com/Lone-Coder/letsencrypt-win-simple/issues/37\n. ",
    "Malyngo": "This is working for me, too. :+1: \nTo make it work more universally, also on systems that already have a mime mapping for no extension, the web.config should probably also use a remove first:\n<remove fileExtension=\".\" />\n<mimeMap fileExtension = \".\" mimeType=\"text/json\" />\nJust saw there is already a pull request for this #34\n. Better add a \n<remove fileExtension=\".\" />\nbefore adding the mimeMap so it will also work on systems that already have a mime type for extensionless defined.\nThen it should work universally.\n. ",
    "luisperezphd": "Is there a reason the challenge file can't just be created with the .html? That way most web servers would already be configured for it to be publicly accessible. Also can't allowing the dot extension lead to unintended consequences. Maybe the file extension of the challenge file can be a configuration parameter, that way no configuration changes would be needed, the implementer could simply choose an extension they know is already supported. Just an idea I'm running into this problem myself right now. Thanks.. Same here. I'm guessing it's not a permission issue since it does successfully create the folders as well as the challenge file itself. The only file that is missing is the web.config.. ",
    "VagyokC4": "This should be pulled in and updated to prevent these recurring issues.\n. UPDATE:  I went in to Web Hosting certificates and removed all certs.  Re-ran the lets encrypt code, and it successfully completed its process (i.e. no errors were displayed)\n. ",
    "amaiman": "I was wondering the same thing.  You can find it in this registry key: HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\\Renewals\nRemoving a line from that key will remove it from the attempted renewals.  It's also possible to edit the date for testing.\n. ",
    "dylanparry": "Thanks. Seems a bit odd to me that these are kept in the registry when almost everything else is inside config files in %appdata%. It\u2019s a bit counter intuitive not having everything in the same place.\n. ",
    "krissebesta": "I vote for moving all options out of the registry and into config files.  WHO'S WITH ME!?!!??!  ;-)\n. I was able to leave the Handler Mapping untouched (did not need to promote StaticFile above ExtensionlessUrlHandlers) by simply adding mimeMap fileExtension=\".\" mimeType=\"text/json\" (inside staticContent tags)  to the web.config file located in C:\\inetpub\\wwwroot.well-known\\acme-challenge\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<configuration>\n<system.webServer>\n<directoryBrowse enabled=\"true\" />\n<staticContent>\n<mimeMap fileExtension=\".\" mimeType=\"text/json\" />\n</staticContent>\n</system.webServer>\n</configuration>\nNote: I also needed to remove the following line in Program.cs (and recompiled it obviously) because it would delete and recreate the above web.config file which, of course, would also remove the mimeMap setting.  Why does it delete and overwrite the file if it already exists?  I don't know why... but it was REALLY ANNOYING until I figured out what it was doing.\nIn method: public static AuthorizationState Authorize(Target target)\nI removed this line: target.Plugin.BeforeAuthorize(target, answerPath, httpChallenge.Token);\nWhich would call IISPlugin.BeforeAuthorize() which would overwrite the config.web file.  You could also check for the file in BeforeAuthorize() and only copy if it does not already exist, which would be a slightly better solution.\nHope this helps! - Kris\n. So is it possible to configure letsencrypt-win-simple to create AND renew an SSL cert on a port other than 443?  It would be good if it would prompt for the port number to use or put it in a config file or something.  But it seems to only create and bind to 443, or am I incorrect?  Thanks - Kris\n. Thanks WT that is SUPER HELPFUL!  I'm working on renewing the certs this week so I appreciate your efforts to keep this up to date and enhancing it!  Cheers!. Well, as a developer, I'm wondering if we can modify the code to prompt for the port number to use.  Might be worth looking into it.  I'd like to make other changes as well.  Have you been able to find a workaround?\n. Hi, try deleting the middle https from the list and update the bottom one to use * for IP Address (which means all IP addresses).  You've got two 443 bindings which will probably cause problems.\n. Sorry for the late reply.  Do you see that the Host Name is blank in the site bindings dialog?  You need to give your web site a name in order for letsencrypt-win-simple to be able to use it.  I would do this for the at least the site running on port 443.\n. Hmmm.... try selecting a specific IP address in the drop down list box (change it from \"All Unassigned\" to one of the IP addresses that appear).  Then see if you can enter a Host Name.\n. Wow this turned out to be a really interesting problem.  Check out both of these web sites for several solutions and hacks.\nhttp://serverfault.com/questions/96810/iis7-cant-set-host-name-on-site-with-ssl-cert-and-port-443\nand...\nhttp://brianflove.com/2015/01/21/iis-and-https-binding-with-host-header/\nGood luck! - Kris\n. ",
    "RichiCoder1": "Nice!\n. I think I'm running into a similar issue. \nBefore:\n```\nSSL Certificate bindings:\n\nHostname:port                : a.xyz.com:443\nCertificate Hash             : 07fd6136d6d998b3e5b87ee49eb4075652e79555\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : b.xyz.com:443\nCertificate Hash             : 4f19c4880d9cc98dda9e4a100ffb471e67bd18eb\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : c.xyz.com:443\nCertificate Hash             : 6ca51ab638290da19ee05f6dc53b03ffc741db34\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : teamcity.finalphasesystems.com:443\nCertificate Hash             : f6bf8f6e28add494bac9330bc9f2c67a49fd125b\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : d.xyz.com:443\nCertificate Hash             : 8474f96ae5961fe711219be7e9887432a4c1db9b\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\n```\nAfter:\n```\nSSL Certificate bindings:\n\nIP:port                      : 12.345.678.910:443  <-- My Server's IP\nCertificate Hash             : b88104002c6cd2d1dfed677a12413c8ca1038cc0\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : a.xyz.com:443\nCertificate Hash             : 07fd6136d6d998b3e5b87ee49eb4075652e79555\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : b.xyz.com:443\nCertificate Hash             : 4f19c4880d9cc98dda9e4a100ffb471e67bd18eb\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : c.xyz.com:443\nCertificate Hash             : 6ca51ab638290da19ee05f6dc53b03ffc741db34\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : teamcity.finalphasesystems.com:443\nCertificate Hash             : f6bf8f6e28add494bac9330bc9f2c67a49fd125b\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : d.xyz.com:443\nCertificate Hash             : 8474f96ae5961fe711219be7e9887432a4c1db9b\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\n```\nWhich results in all the above websites serving only on of the above website's SSL certs.\n. ",
    "AlexLaforge": "TL;DR\nYou have to UNSET then RE-SET the \"Require Server Name Indication\" checkbox in the bindings of your website.\nExplanations\nFor Everyone in trouble with the Auto-Renewals task not created in the Task Scheduler, here is how I overcome this.\nSPOIL ALERT : Basically, this is a \"SNI\" issue :-)\nWhen I first ran the letsencrypt.exe executable in --SAN mode (with multiple Alternatives names) on my Windows Server 2012 R2 Standard, the certificates were well created, but the binding was not completed, throwing the following error : \"Error setting binding : A specified logon session does not exist. It may already have been terminated.\"\nFor sure, the certificates were created in my Central Certificates Store, and usable by my websites. But I was left in place with no auto-renewal :\n- No registry \"Renewals\" key was created/updated in HKCU\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/.\n- And obviously, as the executable stopped prematurely, no auto-renewal task was added to the Windows Task Scheduler. So My certificates are here for 3 months, and after, I'll be in trouble, having to generate them again maually .. seriously : No : I need the full-automated-package that letsencrypt-win-simple provides :-)\nAfter researching the web, trying a lot of things, including manual or automated-Powershell binding creation/deletion/tweaking, I have found a working and reproductible way to have letsencrypt.exe finish the job correctly.\nHere is the process I have successfully reproduced with several domains and subdomains (SANs) on fresh-installed Windows systems :\nOPTIONAL : Use Centralized Certificates Store\n\nFirst, if you want to use a folder for holding all your certificates, you have to enable the \"Centralized SSL Certificates Support\"\nGo to \"IIS\" >> \"Connections\" >> \"MachineName\"\nGo to the Section \"Management\" >> \"Centralized Certificates\" >> \"Actions\" >> \"Edit Feature Settings\"\nTick \"Enable Centralized Certificates\", then enter a \"Physical path\", the \"User name\" and its password. Done.\n\nMANDATORY : Reset the \"SNI\" property for \"https\" bindings\n\nOnce you have created your domains and subdomains, go to \"IIS\" >> \"Sites\"\" >> my-website.com\" (do this for EACH subdomain too !)\nEdit all the default existing \"https\" bindings :\nUntick \"Require Server Name Indication\" > Click \"OK\"\nTick \"Use Centralized Certificate Store\" too if you want to use a central repository for your certificates.)\nOpen again this binding, then Tick \"Require Server Name Indication\" > Click \"OK\"\n\"Close\" this dialog box, then click the \"Restart\" button in the \"Actions\" panel.\n\nMANDATORY : Create the certificates\n\nThat's it ! You have done the core job : Now you can run the letencrypt.exe executable for example with : c:\\ssl\\bin\\letsencrypt-win-simple\\letsencrypt.exe --san --accepttos --centralsslstore c:\\ssl\\central-store --baseuri https://acme-v01.api.letsencrypt.org/\nThe letencrypt.exe executable should go to the end : it creates the necessary Registry entry under the key \"HKCU\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\\Renewals\" , then ask you for the creation of the automatic renewal task in the Windows Task Scheduler. I suggest you to should accept it ! This way, you will never have to do anything manually to renew the certificates :-) (that's the goal of this game, no ?)\nOpen the Task Scheduler, then edit this task :\n\u2043   GENERAL > Run wether user is logged or not : Ticked\n\u2043   TRIGGERS > \"Edit\u2026\" > Stop task if it runs longer than : 1 hour.\n\u2043   SETTINGS > Stop task if it runs longer than : 1 hour.\n\nTo conclude / Alternative manual solution\nThis \"Require SNI\" un-ticking/ticking made me crazy for 3 days.\nFor everyone still in trouble, you will need to manually create the \"Renewals\" key in the Registry. Here is an example of the content of this \"Renewals\" key.\nIn this example, I have 2 certificates. Each certificates have the \"sub1\" subdomain, so that is why the \"Host\" property contains 2 ID's (the first ID is my domain, and the second ID is my \"sub1\" subdomain).\nPlease note that the content of this \"Renewals\" key have to be in JSON, with 1 CERTIFICATE per line. No comma separates the two lines, by a carriage return. So in my example, I use two lines separated by a carriage return.\n{\"Date\":\"2017-05-12T00:19:36.3142563Z\",\"Binding\":{\"Host\":\"9,10\",\"WebRootPath\":\"\",\"SiteId\":0,\"AlternativeNames\":[\"mywebsite.com\",\"www.mywebsite.com\",\"ipv4.mywebsite.com\",\"sub1.mywebsite.com\",\"www.sub1.mywebsite.com\",\"ipv4.sub1.mywebsite.com\"],\"PluginName\":\"IISSiteServer\",\"Plugin\":{\"Name\":\"IISSiteServer\"}},\"CentralSsl\":\"C:\\\\ssl\\\\central-store\",\"San\":\"True\",\"KeepExisting\":\"False\",\"Script\":null,\"ScriptParameters\":null}\n[!! HERE IS THE CARRIAGE RETURN SEPARATING THE 2 JSON LINES - OBVIOUSLY REMOVE THIS LINE, JUSTE HIT \"ENTER\", AND DO NOT LEAVE A BLANK LINE !!]\n{\"Date\":\"2017-05-12T02:49:58.9307057Z\",\"Binding\":{\"Host\":\"13,14\",\"WebRootPath\":\"\",\"SiteId\":0,\"AlternativeNames\":[\"otherdomain.org\",\"www.otherdomain.org\",\"ipv4.otherdomain.org\",\"sub1.otherdomain.org\",\"www.sub1.otherdomain.org\",\"ipv4.sub1.otherdomain.org\"],\"PluginName\":\"IISSiteServer\",\"Plugin\":{\"Name\":\"IISSiteServer\"}},\"CentralSsl\":\"C:\\\\ssl\\\\central-store\",\"San\":\"True\",\"KeepExisting\":\"False\",\"Script\":null,\"ScriptParameters\":null}\nIf you still have to manually create the renewal task in the Task Scheduler, here is how letsencrypt.exe creates it :\nCommand-Line\nC:\\ssl\\bin\\letsencrypt-win-simple\\letsencrypt.exe\nArguments\n--renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\nStart in\nC:\\ssl\\bin\\letsencrypt-win-simple\nI hope it will help :). ",
    "MarcoMiltenburg": "Although it says it has created the scheduled task, e.g.:\n[INFO] Adding Task Scheduler entry with the following settings\n[INFO] - Name win-acme httpsacme-v01.api.letsencrypt.org\n[INFO] - Path C:\\Program Files (x86)\\LetsEncrypt\n[INFO] - Command letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\n[INFO] - Start at 09:00:00\n[INFO] - Time limit 02:00:00\nIt really hasn't yet. It first asks another question Do you want to specify the user the task will run as? (y/n): and it's not until after this question is answered that the scheduled task is actually created.. ",
    "curcas": "Thanks, this is working for me.\nIs it planned to integrate this or must it be replaced with every new version?\n. ",
    "nosage": "Thank you!\n. ",
    "thermionic": "Running 2012 with IIS8, and the update fixes it :-)\nMany Thanks!\n. ",
    "RobertGetzner": "Cool, thanks. For me then it's already solved, I can work with the webdav approach. Just had to use another tool to 'mount'  the webdav folder...thanks for your fast response \n. Thanks a lot! :)\n. ",
    "jasonthenderson": "Yes, released version 1.7 - I followed the directions in the red text - Sites->Site->HandlerMappings->View Ordered List.  StaticFile was the last entry, ExtensionLessUrlhandler entries were just above, so I moved StaticFile above them.  This immediately broke everything below the top level page.  I moved the handler back down, and the site immediately started working again.\nWindows Server 2012, IIS8\nNo, not running MVC - just plain asp.net application, the only thing remotely related I can think that I am doing is in global.asax I use HttpContext.Current.Request.Path to intercept '/foo/bar' and do a HttpContext.Current.RewritePath to '/bar/foo.aspx'\nI wonder if moving StaticFile up means that my code in global.asax doesn't get invoked by the ExtensionLessUrlhandler on requests to /foo/bar?\n. Thanks a lot for the pointer @rkerber  I took a look at #37 and the suggestion @anemitoff  made.  I replaced my web.config in the WellKnown... directory and that seems to work great.  \nI agree with the recommendation to include that in the web.config in the wellknown directory - it would save the hand editing of the handler ordering, which inadvertently broke my production site ;(\n. ",
    "hrafiee": "Hi Robert,\nI have downloaded the latest release of the code and it did not work \nwith IIS 8 and windows 2012.\nletsencrypt-win-simple v1.7\n  https://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.7\nif this is not the latest version.. then I need to download the code \nfrom the git again.\nThanks,\nBest Regards,\nSara\nOn 01/31/2016 10:53 PM, Robert Kerber wrote:\n\nIt looks like you didn't branch off the latest code base. The latest source code already has changes in it for changing the web.config file. The changes were tested with stock IIS on Server 2012, Server 2012 R2, Server 2016, Win 7, and Win 8.1.\nPlease check to see if the latest source code works for you. If not, then create a new branch from the master branch and try to make your changes again.\n\nReply to this email directly or view it on GitHub:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/73#issuecomment-177626973\n. \n",
    "rboy1": "2 question please:\n1. How do I use the certificates? Just import them manually into the IIS server certificate?\n2. When you say 10 certificates per 3 hours per IP and 5 per domain,\nSo say if I www.mydomain.com 3 times and sub.mydomain.com 3 times. (this is what I did). I've only 2 certificates and I've requested 6 certificates in total (and now it's past 3 hours). Why can't I get them again? What am I missing?\n. Thank you!\nIt would be awesome if the script could have a parameter to automatically reinstall the pfx certificates (I've done it manually for now - thanks) given that the routines to install are already built in.\n. I should have captured it but you could replicate on any system with the steps above.\nI believe it said something about a binding failure. It was a .NET exception. This was the step before it asks if you want to replace the existing task. \n. ? is it not an issue?\n. I think it was the step where you may be trying to unbind the existing certificate but since one doesn't exist it throws an exception.\n. Okay here you go, simplest way to replicate. Create a certificate for a new site. Then open IIS Manager, goto Server Certificates and delete the new certificate (do not open the site bindings). Start letsencrypt again and create a new certificate for the same site (which you just deleted) and you get this error:\n\nOpened Certificate Store \"WebHosting\"\n Adding Certificate to Store\n Closing Certificate Store\n Updating Existing https Binding\n IIS will serve the new certificate after the Application Pool Idle Timeout time has been reached.\n Committing binding changes to IIS\nSystem.ComponentModel.Win32Exception (0x80004005): A specified logon session does not exist. It may already have been terminated\n   at Microsoft.Web.Management.Utility.HttpApiWrapper.CreateSSLBinding(IPEndPoint endPoint, String hostName, HTTP_SERVICE_CONFIG_S\nSL_PARAM_MANAGED allSSLData, SslFlags sslFlags)\n   at Microsoft.Web.Management.Utility.HttpApiWrapper.CreateSSLBinding(IPEndPoint endPoint, String hostName, Byte[] certificateHas\nh, String certificateStoreName, SslFlags sslFlags)\n   at Microsoft.Web.Administration.BindingManager.BindingTransaction.Commit()\n   at Microsoft.Web.Administration.BindingManager.Save()\n   at Microsoft.Web.Administration.ServerManager.CommitChanges()\n   at LetsEncrypt.ACME.Simple.IISPlugin.Install(Target target, String pfxFilename, X509Store store, X509Certificate2 certificate)\n   at LetsEncrypt.ACME.Simple.Program.Auto(Target binding)\n   at LetsEncrypt.ACME.Simple.Plugin.Auto(Target target)\n   at LetsEncrypt.ACME.Simple.Program.Main(String[] args)\nPress enter to continue.\n. It's closed and it's still happening. I think it needs to be handled in the code.\nAgain this only happens when the server certificate is deleted BEFORE removing the binding leaving the binding with an invalid reference which is what I think is causing the exception. It just needs to be handled,/ignored and continue with the rest.\n. That's the issue, when it renews, the FTP site stops working because the cert is no longer there. I was wondering since FTP is still part of IIS is this something that can be programatically done along with the website certificate binding?. Thanks this is a good temp work around. I can put a reminder on my calendar every few months to go in and run this script.\n\nI was really hoping that letsencrypt can do this programatically along with the IIS website certificates when it renews them.. If the script can be set to run everyday and it will automatically bind the new certificate while ignoring it if there already is a binding that's great. The script can set to run along with the letsencrypt schedule back to back. Does anyone have such a script which can do the above?. I\"m sorry which script are you referring to? Lets Encrypt WinSimple is an EXE which is scheduled to run everyday after you first configure it and it automatically takes care of ignoring active certificates and rebinding new certificates to websites. I don't see any way to modify it to work on IIS FTP sites.. Great to hear, is the script something you can share or did I misunderstand your point?. Great thanks, try to figure this out, what variable would I need to change to make it point to the certificate I want it to use? I'm assuming this binds to the IIS FTP server. Where does one specify which FTP site?\nThe whole things look automated so I can't seem to find where you specify the above or does it go through each certificate and bind it to the corresponding site (like letsencrypt win simple does but for FTP sites here?). Struggling here. Going out on a limb. Does anyone have a script that can be invoked with Let's Encrypt that can rebind the latest certificate with IIS FTP?. I noticed that LetsEncrypt places all certificates in WebHosting and then from there binds it to the IIS websites. Back to the Author if the IIS FTP site also takes the certificates from WebHosting why can't Let's Encrypt detect the FTP sites and automatically provide an option to bind to those sites similar to the HTTPS sites?. So just to be clear on this works, if one had a IIS FTP server running along with the website, it will automatically renew the FTP certificates for those FTP sites along with the websites?. > An FTP plugin was added to version 1.9.10\nA related, I'm in situation where I cannot reauthenticate the domain (the self hosting option) since the server is running on a non standard port. Now the good news is that the domain is already authenticated win-acme is renewing the certificate every few months. I just need to \"add\" the FTP site to the current HTTPS site in win-acme. Is there a way to do this without having to reauthenticate from scratch? (both the HTTPS and FTP use the same domain FQDN).. Sorry trying to find the right terms, when I see the renewal I only see the IIS plugin attached to the site. How do I attached the IISFTP plugin to the same site in the renewal without having to reauthenticate?. > Your 'authentication' - which is actually called a validation - has a very limited life span, measured in days if not hours. By the next time your certificate has to be renewed, you will always have to revalidate\nI did not realize this, thank you for pointing it out. I guess then it's moot trying to do what I was trying to do.\nWhere can I find more information on this DNS based validation technique? Can I mix and match validations? E.g. most websites servers use the regular validation where as for this one FTP site use DNS based validation?. Thank you very much for that. It was extremely helpful. \nI have one question about the DNS validation which want clear. Sounds like the program will use the script to create a TXT record, verify that it worked and then deletes it. \nThe documentation doesn\u2019t state how long it will wait before waiting to verify that the record was created. I\u2019m asking because the provider I\u2019m using takes 15 minutes to publish the changes. . I agree on this issue, I deleted a website from one server and moved it to a different one and the original renewal would keep failing because it gave an error about not finding site ID X to be able to bind to.\nI ran letsencrypt win simple from the command line and it ran perfectly but the task scheduler version kept failing with the binding error. Check the IIS bindings and it was perfect but then new certificates would keep popping up in the server and then it would fail with that ID binding error.\nTook some debugging to find out that letsencrypt win simple scheduler was using an old list from the registry and not looking at the current active bindings to renew them.\nThis would be a GREAT fix to only renew certificates that are active and not those that aren't bound or atleast provide a switch (enabled by default) which looks only at active bindings. Will save a lot of headache for simple users :). I also realized that it didnt' add a new website binding to the registry renewal list even thought I had manually run letsencrypt win simple on the command line to generate a certificate for it. I had to manually got and delete all the registry entries to start over. \nREally it would be great if it can sync the registry key automatically with active bindings (provide an option to do it for all bindings and automatically update everything without user intervention - really keeping it simple :). Yes I absolutely agree it is an awesome product, didn't want to make it sound any less!. ",
    "nul800sebastiaan": "I'll close this now due to lack of interest.. This should be fixed in v2 where the configpath is configurable on the command line - https://github.com/Lone-Coder/letsencrypt-win-simple/pull/394. I'll close this as I think everything mentioned here is addressed in #275 which is available in v1.9.3 now.. @Lone-Coder What would you like to do with this one? I think we should just merge this. :). @vieira I see some line ending differences in the payloads that you posted, that might be it. Unfortunately this info is and error seems to be coming from the ACMESharp project. Maybe check there first? :)\nI'll close this for now, if you have steps to reproduce (I can't repro it) then that would be great, feel free to re-open.. Closed as duplicate of #193 . v2 will feature a configurable path for the output directory (see https://github.com/Lone-Coder/letsencrypt-win-simple/pull/394).\nSince this has been inactive for a few months I'll close it now. Please feel free to re-open this if you have steps to reproduce.. This looks more like a discussion rather than anything that needs fixing at the moment. Make sure to create a new issue when there's more things to be fixed here.. Oops, was working on an old clone.\n. Ah yes, didn't think of that! Sure, limited to 1 plugin should be fine actually. I can update the PR.\n. Updated to only use a single plugin when it's specified on the command line!\n. Updated in 0ede74083a4dd22ec7999545b7e27de3f432937c. Turns out that I had a small mistake in the logic there, all plugins would run regardless of what was specified on the command line, Now if you specify --plugin MyPlugin only that one will run.. And to be able to run fully unattended, even on first run, you can now specify a SignerEmail and you're no longer required to press Enter to exit after the program is done (only if a plugin is specified on the command line).\nCommit: https://github.com/Lone-Coder/letsencrypt-win-simple/pull/275/commits/68a25e5b9b1b5d0d3830966ef3bd7635e4563324. Is this still an issue for version 1.9.3 https://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.9.3?. I don't understand what this issue is referring to. Make sure to re-open it with more information if you're still struggling with this!. You should be able to do this in 1.9.3 with a script - see: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Install-Script. I'll close this as a duplicate of #203 . It's great to add proxy support, but since it's a pretty rare occurance, I think this should be specified as a command line option. Perhaps the exception message then could mention that if you're behind a proxy, that one should be passed in in the options?. Thanks, looks great!. I don't think this is a problem with this app, works fine in Chrome for millions of sites :-). LetsEncrypt needs to verify against each domain, the .well-know directory HAS to be accessible for each one of them. \nAs for https-only domains, see #203 . I've added a .NET 4.5 version check in v2 - https://github.com/Lone-Coder/letsencrypt-win-simple/pull/394/commits/7c9590fc3768bd6319edbd910915c174a822009e\n. I think this is great for now to keep it backwards compatible, \nI created an issue to make it non-exportable by default in the next major version: https://github.com/Lone-Coder/letsencrypt-win-simple/issues/369. Seems like this was answer. FYI: if you need to validate on port 443 then follow #203 - but that doesn't seem to be the question here. . @jmarden Not right now, I'm in the middle of a refactor process at which point you'll probably have to rewrite a bit of this code. I won't have a lot of time for the next few weeks so it depends a bit on how my weekends will look.\nAlso, I have not looked at this PR at all so I don't know if it is wanted right now :-) I'm sure it might be, but maybe it's also great as an independent plugin. Again, I know absolutely nothing about this PR so I might be saying strange things right now.. ;-). Seems related to #277 too.. You have the option of specifying a proxy server in v1.9.3 now - https://github.com/Lone-Coder/letsencrypt-win-simple/pull/287. This is now available in v1.9.3.. \ud83d\udc4d Thanks!. This is now available in v1.9.3.. This file has been updated since and seems to be fine at the moment, there is not strange characters when I  try that same powershell command. Feel free to re-open if this is still an issue for you.. This will be fixed in v2 with the --configpath parameter. See PR: https://github.com/Lone-Coder/letsencrypt-win-simple/pull/394. You can't :-). This will be fixed in v2 with the --configpath parameter. See PR: #394. Will be fixed in v2. This is now available in v1.9.3.. Seems related to #277. Cheers! \nI've manually applied the ExitCode, the variable name change is technically a breaking change, so will have to wait for v2.. Might be related to #277 . This will be fixed in v2 with the --configpath parameter. See PR: #394. This option is not yet available but as soon as #203 is implemented it will be (I have no timeline for that at the moment). I'll close this as a duplicate of  I'll close this as a duplicate of #203.. This will be fixed in v2 with the --configpath parameter. See PR: #394. Thanks, I've just tried this in v1.9.3 and it seems to work. Let me know if you can still reproduce!. @aellert if it seems random it might be an issue with the site recycle time being too long, you can use the --warmup paramater (available since 1.9.3) to ping the site after changes have been made that should help. If not, feel free to re-open this issue.\nFYI: the site in your example is currently unavailable from here, that might be another issue.. @Quentinb It has to be publicly accessible.. Sorry, we can't help here as this is not an issue with this app. Maybe try this: https://community.letsencrypt.org/t/iis-8-5-building-incorrect-chain-with-lets-encrypt-authority-x3/13320/84. Let's Encrypt doesn't support wildcard domains. So yes, you would need to create 2 certificates for both www.domain1.com and domain1.com.. Ah I just realized that you can use a SAN to create a certificate that's valid for both the non-www and the www domain.. Yes, you can create a new certificate with SAN and they will be valid for the default period of 90 days.. Just FYI: I have a PR open to make that a feature: https://github.com/Lone-Coder/letsencrypt-win-simple/pull/275. Thanks! I'll see where I can help take this project, it's been a real lifesaver for a lot of people for a while now!\nAs for plugins, I have a specific need for a plugin that doesn't apply to anybody in the world except for our company and I imagine there might be more projects that could rely on this one for their own purposes! :-). @jmarden No worries! Is your branch something that applies to many people or is it pretty specific for your company? . FYI: I've been going over some PRs and will do a few more for a 1.9.2 release so that all the latest bug fixes have an actual release. After that I'll look into separating the logic out into a class library project so we can build real plugins (that will be v2.0.0 as it's a breaking change).\nI'd also like to set up a development branch next to the master branch so we can do releases from master and ongoing work in development.. I don't think we need a super specific set of libraries as @gdau is suggesting. My only idea is to put all of the current code in a single class library then we can put that up on NuGet. Then you actually have something to use to develop plugins against instead of having to get the exe file and put it in a lib folder and committing it to source control :-). Gotcha @gdau! FWIW I believe there's plenty of projects already that manage certs, maybe look into that?\n@Lone-Coder So.. I've done all I could for a new release, now the big question is: how is it that you actually build the release version? I thought I'd download it from AppVeyor but there's obviously quite a few extra files in that build. Do you ILMerge it in the end?\n[Edit] BeyondCompare screenshot:\n\n. Ah, I think I see, you just release these files without the additional libs?\n\nSeems to run fine on their own without the rest of the dlls. I can try to make a build script for AppVeyor that does this automatically.\n. Also, I pushed a develop branch - would be good to set that as default so that we can follow git-flow.. Resolved in: https://github.com/Lone-Coder/letsencrypt-win-simple/pull/313. I understand, but it's extremely easy to request new certs when migrating. Do you really think the short period for which the certificates are valid are not enough for migrating to a new server?. I don't understand, how can you not request a new cert? It's trivial.. :-). Ah, got it.. if it only allows SSL requests, good point!!. Once PR #337 is merged the default will be non-exportable, in letsencrypt.dll.config you can still set PrivateKeyExportable to true.. Note: this is a breaking change as the namespace changes, so targeted for v2.. PR here: https://github.com/Lone-Coder/letsencrypt-win-simple/pull/394. @vnikolay Sorry, there's no variables available, you will have to change the command for each domain name.. \ud83d\udc4d thanks!.  I recommend you run Nartac IIS Crypto and apply the fixes suggested using the \"Best Practices\" button. It's a dead-simple, one-click fix for most (if not all) of your bad grades on SSLLabs.. Ah, no I should have clarified: this is a server problem, not a certificate problem. Once you update the protocols your server accepts, you should get an A grade on ssllabs.. You need .NET 4.5 even, there will be an error in v2: https://github.com/Lone-Coder/letsencrypt-win-simple/pull/394/commits/7c9590fc3768bd6319edbd910915c174a822009e\nThis duplicates issue #293 . Seems like a rewrite issue indeed, try the suggestion @dwtm-ts gave.. Bah! I just got the files from AppVeyor. Ok, I'll make a build script and get 1.9.3 out today, thanks for the heads up!. Added build script that fully automates the build for release: https://github.com/Lone-Coder/letsencrypt-win-simple/commit/1cbed312f321dc58ad54e6f72f9f3e9129101271. 1.9.3 is available here: https://github.com/Lone-Coder/letsencrypt-win-simple/releases/tag/v1.9.3. Sure, le-win-simple doesn't support DNS verification yet.. Ah I see what you mean now, sorry misread. I'll close this as a duplicate of #203. @mbeiley I can have a look, but it looks like there's a lot of changes that may no longer be necessary or at least may not have to be so complicated in v2. Once v2 is out it could be a feature of 2.0.1 if someone wants to send a PR against the code that I've cleaned up a lot now.. @Lone-Coder I've added you as a reviewer, I know you probably don't have time to look at most of these changes but I at least would like your blessing before trying to release this as a new beta version.\nThese updates should over time lead to easier bug fixing and even the addition of unit tests.\nA few more things:\n\n[ ] I would love to add an MIT license to this project\n[ ] I would like to have the development branch be the default and the master branch to be dedicated to being the release branch (a la gitflow) - happy to change these settings myself, but I don't have enough rights at the moment\n[ ] If you have any objections.. give a shout \ud83d\ude04\n\nLastly: there are some bugs to fix, like the renewal date of scheduled tasks that seems to be wrong. There's also some interesting feature requests / PRs that need some guidance, like support for DNS validation. I know this is all fixable in the current 1.9 version but it will be harder and if we continue that line of code it will be difficult to merge it up to this v2 version.\nPersonally I'm pretty happy after a few months of using the v2 code and our domains are running happily and securely with this version, I feel a v2 beta is long overdue. If you have 5 minutes can you please have a look at this PR and the checkboxes above?. Hi @Lone-Coder - any chance you can have a look at the comment above please? Thanks!. As an update, the response to this PR has been pretty demotivating indeed unfortunately.\nA quick reply to the objections above:\n\nIOC is nice when used in moderation, helps a lot with plugins indeed.\nCTRL-F12 can be used on interfaces, all good. Resharper is your friend too, I see no problem.\nConsoleService is great to have replaceable in case you do not wish to use console but just logging for example. It's also there to consolidate all the repeated console wrangling that was scattered all over the place. \nObviously I need to fix some bugs :-)\n\nAnyway, it seems like I'm really thinking of different direction and it seems a fork might be best, but obviously I've been a little distracted too lately. Happy if someone re-uses the code here to build upon, for the next month I have no plans to pick this up again, but I'd like to. Maybe even start from scratch.. :-). I'm happy to take over but I don't want to step on any toes! \ud83d\ude42. It'd be easiest to follow git-flow which is widely adopted so more people know about that. \nhttp://nvie.com/posts/a-successful-git-branching-model/\nIn short: \n\nmaster branch contains the currently released code\ndevelopment branch contains what will be released next\nfor everything else there's feature branches or bugfix branches which can be reviewed and merged into development when done. \n\nv2 should be a feature branch like that indeed. :-). Codebase has evolved somewhat, this is no longer very relevant for now.. This seems to be a false positive, neither the zip file or the exe file are flagged on VirusTotal:\nZIP: https://www.virustotal.com/en/file/d3fe0bc22c1799fedb365eada3777ec4d05d9c043c7526273edc02f3ffb2210c/analysis/\nEXE: https://www.virustotal.com/en/file/118a882c9a64c08701341f828f314602e2ead4e038153e9b935991aaf5e6f511/analysis/1490170939/\nLocally, neither Windows Defender nor Malwarebytes find anything either.\nFeel free to re-open this if you find more proof that there's actual malware embedded in the zip file!. FYI: the \"HEUR\" in this signature means that it's a heurisitic, so the scanner is determining that it looks like something that might possibly be malicious. The same result has been found here for example : https://social.msdn.microsoft.com/Forums/vstudio/en-US/081020e7-77cf-46f1-aa4a-fdc00804ee4e/my-vs2015-builds-virus-infected-exe-files?forum=visualstudiogeneral#e6a0f42b-6005-4ee1-9588-657abdfa8ca0\nQuote: \n\nThe cause of the problem is that the exe file was not in the list in your anti-virus software. So it will regard your exe file as a virus.\nTo avoid this problem, one idea is that you need contact with the development of the anti-virus and add the program into the trust list.\n\nEdit: looks like in the future we should sign the exe file generated to avoid this problem.\n. FYI: this is still an open feature request for Let's Encrypt, so this is currently not at all supported: https://community.letsencrypt.org/t/if-when-will-le-support-onion-addresses/341. This is enforced by Let's Encrypt, so make sure to head over to their community to voice your concerns: https://community.letsencrypt.org/latest. Thanks, I couldn't directly find anything on this subject! In any case, with the correct configuration this should not be a concern for anyone.. @WouterTinus Thanks for the review, this is now updated:\n\nOnly looking for dll files without the verbose filterinig\nAdded logger (not sure if this is the best way but it seems to make sense\nLoads the internal plugins regardless of anything\nTries to load plugin types in dlls, with a try-catch to handle problems\n. I could have made it into an extension method but the number of usages is pretty low. Let me know what you think though!. Gotcha! This will need some rethinking then. Closing for now.. Good point, I'll update!. Yep, agreed, couldn't figure out how to get the logger, but I'll look into it again.. \n",
    "bigrck64": "Yes, adding revokation will be a great addition when ACMESharp will have implemented it !\n. ",
    "Micrologiciel": "up :). > \n\nIt looks like you've outgrown the registry. Please follow these steps to move your renewal database to a file: https://github.com/PKISharp/win-acme/wiki/Migration-to-v1.9.9\n\nTrue !!! THX a lot !!!\nI close this Issue. ",
    "Marcus-L": "I submitted https://github.com/ebekker/ACMESharp/pull/301 to ACMESharp just now to add RevokeCertificate to AcmeClient. ",
    "epmik": "Wrapped the Directory.CreateDirectory(certificatePath); call in a try/catch statement. \nI don't think there's a need for a try/catch block around \ncertificatePath = Properties.Settings.Default.CertificatePath;\nIf the value isn't specified in app.config, then it defaults to an empty string, which defaults to the default directory, and a malformed path will throw when creating the directory, in which case the app quits.\nThe certificatePath value was already logged.\n. Hi, reverted the changes to web_config.xml and updates the code as requested.\n. ",
    "Groman123": "Thanks a lot - maybe it should be added as a nuget dependency there\nSorry for the inconvenience\n. You're right - didn't saw it inside the vs nuget client.\nsorry again ;)\n. ",
    "ph1ll": "Works well for me, the main reason I enabled TLS 1.0 was it is enabled by default in .NET and is supported by https://acme-v01.api.letsencrypt.org/. Its best practice to disable TLS 1.0 where possible, as per #219, so disabling it in the client and preventing it from being used with the Lets Encrypt API is a good move.\n. ",
    "Trapulo": "The exe is 1.7.0.0\nOf course, also full server reboot.\n. Really strange. And I cannot explain why is this possible, if IIS config seemed ok.\nBut experimented on two different servers in different environments..\n. I'm sotty, but still I have problems and cannot understand what it's wrong.\nI installed the last release today 1.8.9-pre on a server when I have website A and website B running (quite old) letsencrypt SSL certificates.\nThen I did run  --renew. It has upgraded certificated with new one. But now IIS serves BOTH A and B using the SSL certificate of A!\nI tried to remove and recreate bindings both from A and from B. Also rebooted the entire server. Nothing: settings in IIS are ok, but it's serving both A and B with same certificate.\nI don't understand what also I can do... :((((\n. Windows 2012 R2\nAn other notice: I have a third website C, running an SSL certificate from Comodo. It's still working well and it's the only website served with a certificate different from the A. It's also the only non letsencrypt website on the server.\n. no Centralized SSL\nNothing changes :( Still if I remove SNI and make a website the default https one, without host name specified, it's served using the wrong certificate assigned to an other one.\n. if can help, the Comodo certificate (the only one that works) is in Personal store. All Letsencrypt are in Web hosting store. No duplicates or exipired certificates, or something that seems not ok.\n. Deleted https binding from A and B -> iisreset - > new bindings to A and B -> both are served with same certificate (the one of A).... :(\nIf I change letsencrypt store to Personal and it brokes the Comodo certificate of C, is really a big disaster so I cannot make this test :(\n. Ok, but really is a trick :( How can I do this?\nI also tried:\n- remove bindings\n- remove certificates from cert store\n- reboot\n- import certificates pfx from letxencrypt db to certificate store\n- created bindings for A and B\nStill both respond using A certificates... this doesn't makes really any sense! \n. @dwtm-ts tried, but same. Also when assigned the self signed, it respond using the wrong one. When I reassign the let's encrypt one, still the same.\nOther things I noticed today, maybe useful maybe not.\n1. if I stop the website B, the browser negotiate the connection (using the wrong certificate) then reports a 404. If I start the website, the 404 become the right website content.\n2. I noticed that the website A is the first in ID order (lower ID) in this IIS that has SSL enabled. Maybe the IIS is serving letsencrypt certificate using always the first (this can explain why is using the certificate A and not B, maybe).\nHowever I cannot explain why this behavior is started after letsencrypt has updated certificates for A and B. Really no idea.\n. only happens with let's encrypt certs and only to shared port: I tried to bind my website B to port 444 (used only by this site, without SNI), using same letsencrypt certificate used for binding to port 443. On port 444 it uses the right certificate, on 443 the on from site A.\n. Any news? I've some expiring certificates on a server and I don't know how to renew them without broke my entire server. :(\nIf I install the 1.7?\n. I tried to compile current code and run it on my servers. \nIt run better that the last one I tried. I can now assign certificates, and then IIS works as expected. Only two sites required to manually the \"remove the SNI flag and reenable it\" workaround; others worked well without workarounds.\nTried some --san requests, and some standard. Some was new certificates replacing old (not renewals, I asked new certificates), some was renewals (--renew), a few was new certificates on sites without SSL.\n. Yes, seems really better.\nAlso mine was a site that was broken by previous version.\n. I also will appreciate a way to have a \"per server\" way to store data (for example a flag so save them under the executable folder). I'd like to install the program on our servers, schedule renewals and so on, and allow any server administrators to manage it. A \"per user\" scenario is a big problem and trouble in a company environment.\nthanks\n. Yes, I think it can be a subtask of #146 \n. IIS\n. Maybe an options to force a renew for an existing certificate? It will not require to hack the registry to retry a renew.\ne.g.\n...exe --forcerenew\nthat starts a selection of existing certificates and allows to try a manual renew\nOnly if it's not hard to add, because it will be less important if later renew data will be moved to a file, and/or this enhancement will be performed.\n. I also on my 8.5 cannot fix broken X3 HTTPS... :(\n. LE managers are really stupid re-using keys. No reasons can allow an ID or Key in ICT, stop. They wrote on blog that they used something as a workaround to run this idea in their client, because they have not time to use a full new CA key.\nBut now? Maybe I can recreate all certificates using the new CA, but IIS still now manage the right chain. Tried to import the new one and delete the old one, but nothing.\n. I'm on 2012R2\n. 1. removed the X1 from computer and user store\n2. added the X3 to computer intermediate\n3. server reboot\n4. changed SSL binding to an other certificate (ok IIS is serving using this), then applied the original issuded by X3\nsame a before, bad chain :(\n. Chain issues    Incomplete, Extra certs\n2\nSubject     Let's Encrypt Authority X1\nFingerprint SHA1: 3eae91937ec85d74483ff4b77b07b43e2af36bf4\nPin SHA256: YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg=\nValid until     Mon, 19 Oct 2020 22:33:36 UTC (expires in 4 years and 6 months)\nKey     RSA 2048 bits (e 65537)\nIssuer  DST Root CA X3\nSignature algorithm     SHA256withRSA\n. I've also requested an entirely new certificate for the site, but still same problem. IIS is linking it to X1 (currently not installed in the store)\n. yes, .der new files report as certification path \"DTS Root X3 -> Let's encrypt X3 -> my domain\". I've installed the X3 from the official LE web site (however is the same I found in appdata db folder).\n. I also tried this:\n1. - exported my certificates, every one with private key and without related certificates, deleting them from store (IIS do not start any SSL website anymore) \n2. - deleted all LE intermediate certificates from store\n3. - rebooted\n4. - installed just the last certificate I have, issued by X3. \nNothing! IIS serves (only one SSL site, of course) using the certificate + the X1! I decoded what FFox reports and they are web site's certificate then the X1 certificate.\nI hate it!!! Where the hell it find the X1? There is nothing in Win that link certificates to X1, and in fact there isn't any X1 certificate!\n. I started an incident with MS support, hope they will understand where my IIS finds the \"ghost\" X1 certificate...\n. #2 -> do you mean the X3 intermediate? \np.s. currently MS official support is not providing me any real help.. :(\n. just my two cents: https://msdn.microsoft.com/en-us/library/windows/desktop/aa376515%28v=vs.85%29.aspx\n\nTracking all of the certificates that back a new end certificate can become cumbersome. Therefore, CryptoAPI 2.0 technology provides functions that automate creating the chain of certificates that back any given end certificate. These functions also check and report on the validity of each certificate in a chain.\n\nMaybe IIS does use cryptoapi to create a cache, that is PERMANENT and not refreshed, so it binds new certificates to X1 (also cached) auth instead of X3 (same key, thank you LE team)?\n. I noticed files in C:\\ProgramData\\Microsoft\\Crypto\\RSA\\MachineKeys, but.. I care! :( I'm on a production Web server, cannot delete file I don't know if it can block IIS... :(\n. I tried this:\nGet-item Cert:\\LocalMachine\\WebHosting*\n... su I found TB of my certificate issued by X3: 46A98E53F1C50D3EB43F9C22DFEBECA1C5546707\nthen\nPS C:\\Users\\Administrator> $cert = Get-item Cert:\\LocalMachine\\WebHosting\\46A98E53F1C50D3EB43F9C22DFEBECA1C5546707\nPS C:\\Users\\Administrator> $cert.PrivateKey.CspKeyContainerInfo.UniqueKeyContainerName\na1cdfde4828aab5bce8aad8ff84836b7_4d664946-1eb9-4745-beed-5ff736196280\ndeleted that single file in C:\\ProgramData\\Microsoft\\Crypto\\RSA\\MachineKeys\nrebooted\nIIS do not bind anymore the website -> remove binding -> remove certificate from store -> import in cert store again -> new bind in IIS\nstill respond sending X1 in the chain................... :(((\n. solved!!!\nhttps://community.letsencrypt.org/t/iis-8-5-building-incorrect-chain-with-lets-encrypt-authority-x3/13320/81\nI tried using store for world wide web service but nothing. Running current user for System works!!!\n. I've updated certificate also on a second server. Really strange: it has managed new X3 certificates without any problem! No problem with X1 used by existing old certificates...\n. I just downloaded 1.9.1. Yes, I think that it will be skipped (this is default behavior for XML config), but sure some tests on servers without that modules enabled will be good. My servers have all them :(\n. ",
    "dwtm-ts": "I had this problem on a machine and the only way to get new cert bindings quickly, was to \n- create a self signed cert via IIS manager and \n- apply that to the affected sites, \n- remove it again and \n- manually reassign the let's encrypt certs.\nIt only happens on one machine and I have no clue why.\n. I can't imagine that IIS serves the first cert by default since all the bindings look correct. Also netsh http show sslcert outputs correct certs and bindings. \nInterestingly this only happens with let's encrypt certs. Sites with certs from other CAs are not affected, but those using let's encrypt will all serve the latest installed cert. Also, this doesn't happen if you install the certs manually.\nSo far this happens only on one machine, without anything special in it's setup. Another identically configured server behaves correctly.\n. Just did some further tests and it seems that IIS delivers the cert for the highest site ID, not the most recently installed one. \ne.g. I installed a san cert for site 5, which worked. Then one for site 7, which got delivered instead of that for site 5 and then one more for site 3. After that, all websites served the cert for site 7.\nI hope this helps in pinning down the issue.\n. Some more info\u2026\nDeleting the cert for the highest site ID (7 in the above case) and rebooting the server restores all other bindings and the correct certs are delivered for all sites. Manually reinstalling the site 7 cert didn't work this time. After doing that, all sites served the wrong certificate again.\nI compiled the current source code of letsencrypt-win-simple, btw.\n. Running letsencrypt --san --keepexisting had an interesting side effect just now:\n- letsencrypt requested certs for site n+1 (I typed 3, it took 4)\n- while committing binding changes to IIS, the following exception was thrown (sorry for german):\nSystem.ComponentModel.Win32Exception (0x80004005): Eine angegebene Anmeldesitzung ist nicht vorhanden. Sie wurde gegeben enfalls bereits beendet \n   bei Microsoft.Web.Management.Utility.HttpApiWrapper.CreateSSLBinding(IPEndPoint endPoint, String hostName, HTTP_SERVI\nCE_CONFIG_SSL_PARAM_MANAGED allSSLData, SslFlags sslFlags)\n   bei Microsoft.Web.Management.Utility.HttpApiWrapper.CreateSSLBinding(IPEndPoint endPoint, String hostName, Byte[] certificateHash, String certificateStoreName, SslFlags sslFlags)\n   bei Microsoft.Web.Administration.BindingManager.BindingTransaction.Commit()\n   bei Microsoft.Web.Administration.BindingManager.Save()\n   bei Microsoft.Web.Administration.ServerManager.CommitChanges()\n   bei LetsEncrypt.ACME.Simple.IISPlugin.Install(Target target, String pfxFilename, X509Store store, X509Certificate2 certificate) in S:\\dev\\letsencrypt-win-simple\\letsencrypt-win-simple\\Plugin\\IISPlugin.cs:Zeile 306.\n   bei LetsEncrypt.ACME.Simple.Program.Auto(Target binding) in S:\\dev\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:Zeile 450.\n   bei LetsEncrypt.ACME.Simple.Plugin.Auto(Target target) in S:\\dev\\letsencrypt-win-simple\\letsencrypt-win-simple\\Plugin\\Plugin.cs:Zeile 41.\n   bei LetsEncrypt.ACME.Simple.Program.Main(String[] args) in S:\\dev\\letsencrypt-win-simple\\letsencrypt-win-simple\\Program.cs:Zeile 363.\n. Aside from the error it seems that the existing bindings for the other sites weren't affected!\n. alright. --keepexisting worked for another site. Bindings were applied correctly, no other sites affected.\nNonetheless with this option I have to select SiteID-1 in order to get the right site. ;)\n. Correction: After a few seconds the other sites started to serve the newly created (wrong) cert.\n. I'm going to test the new source somewhen tomorrow and give you the results.\n. Sorry for the delay. I tested the new version on 3 servers and a few dozen websites. For most of the sites, everything worked. A few sites gave me the \"A Specified Logon Session Does Not Exist\" error, even after several retries. However, I could install the cert manually in these cases.\nRight now there are 3 sites without ssl bindings in IIS. When trying to access them via https they answer with a connection reset. Before installing all the certs, they did not react to https requests at all (i.e. \"Server not found\"). I'm not sure, why that happens. The sites in question aren't bound to a specific IP.\nAside from that there were only a few problems with app specific URL rewrite rules that had nothing to do with let's encrypt. Most notably it is necessary to either deactivate any canonical hostname rules, or add a condition that doesn't fire the redirect if the request goes to .well-known/acme-challenge/.*\n. Right, just checked. But this one works for MVC sites. Maybe implement as option?\n. Try to add <add input=\"{REQUEST_URI}\" pattern=\"\\.well-known/acme-challenge/.*\" negate=\"true\" /> inside the <conditions>-tag of each of your redirect rules (\"Redirect to WWW\", \"Redirect to HTTPS\", \"CanonicalHostNameRule1\").. ",
    "antoninn": "Could this problem somehow be related to this? I have previously solved problem, where IIS after certificate replacement always presented the old one instead new one even the old one was deleted from cerificate store. It was necessary to use netsh command and manually delete old binding like described here: http://thinknook.com/ssrs-ssl-certificate-nightmare-2011-06-28/ Could it be any diiference between binding [::] and 0.0.0.0? Just guessing... It would be maybe good to have list of bindings created by netsh command before and after running letsencrypt to see how bindings will change..\n. ",
    "Symbiatch": "Had this happen to me now. All SSL sites (all SNI) provide the latest Let's Encrypt certificate. All settings are correct, all certs are fine, but everything's messed up. Version 1.8.8.1\nHad to manually delete the IP binding that override everything with netsh http delete sslcert ipport=1.2.3.4:443 and things started working.\nI think the client should never add that kind of binding, since it's not even visible from IIS site management. And I would like to hear how this is a problem in IIS and not in the Let's Encrypt code.\n. ",
    "Tarmil": "I just had the same issue, and @Symbiatch's solution fixed it.. ",
    "TheUltimateC0der": "I can verify that this problem still exists in version 1.9.3\nMy OS is Windows Server 2016\nThe approach of @Symbiatch helped me too. . ",
    "nschikora": "Can confirm that the solution of @Symbiatch works. Thanks for figuring that out.. I can't tell where the described binding came from but according to @Symbiatch it's from the Let's Encrpyt client. \n\nI think the client should never add that kind of binding, since it's not even visible from IIS site management. \n\nWhat I can confirm is that the binding is nowhere to be found in the IIS Manager.. ",
    "robsiera": "I'm having the same problem on V1.9.6.0-beta1. Fix of @Symbiatch did not help. Now this IIS had already a certificate installed on a website. More precisely a wildcard certificate. Removing that wildcard certificate and applying fix of @Symbiatch helped. But then installing wildcard again broke everything. \nSo, I removed wildcard cert again and started installing letsencrypt on all the hostnames of that site. But that failed too. I would not authorize the domain.com host. All subdomains where no problem, but authorization of root domain.com failed with Timeout status 400 after fetching (although I could fetch from browser without any problem).  Anyway, after 5 tries I discovered the hard way that there is a feature that you can not fail more than 5 times in one hour. :-) So now I have to wait to try more. \nBut this information might already be valuable.\n. ",
    "misterHippo": "G'day all, \nWe're seeing the same/similar issues using LEWS version 1.9.3 on Windows 2012 R1. (Websites involved: almost 400.)\nEverything was fine. Working well. Suddenly, reboots & new certs via LEWS means that all the SNI sites are either:\n\nServing the default web sites selected cert\nServing the most recently created cert (when no HTTPS binding on default web site)\n\nThe settings in the IIS GUI, and via the Powershell objects found in module WebAdministration, all look normal.\nTo overcome this manually, we locate the site where the cert is supposed to be, untick/save/retick/save SNI on HTTPS binding(s). This seems to work, although sometimes there is a 10 min window where it makes no difference.\nNotable difference to what I've read above, when we reboot, it happens again. Even without reusing LEWS. We've been trying to pin it to a MS update, but can't. Nothing seemed to have happened? This issue just \"started\" on the 28th Oct. :(\nAside: I have now written a Powershell script to set the sslFlag on the binding to 0 and then set it back to 1 for all sites, barring the default web site. (Although, running it in the wild for the first time last night didn't seem to have helped. Not sure if we waited long enough?). @LBegnaud - We haven't done that as yet, but we are planning on doing that today (Monday).\nMy senior admin is querying what makes me (ie: you) think that the new one might resolve the issue? Is there anything that you can point me to?\nAssuming your above statement holds true, I don't understand why this issue would suddenly start happening. Can anyone shed any light on this?. Copy that. Thanks for your input. FYI: Initial signs look good. :). Hi all. An update you on what our testing has shown... (And to get the content here for anyone else having this issue.)\nVersion 1.9.3 (previously working fine), currently sets the default HTTPS binding to use the newest created certificate. Upon reboot, this somehow does \"stuff\" and pushes this effect out to other IIS sites. To get around this, reassign the default HTTPS certificate.\nVersion 1.9.7.2 doesn't play nice with the wildcard certificate. Putting wildcard cert on another IP address seems to help this.\nWe have downloaded and have been testing 1.9.8.0 beta 4, and there are still issues.\nCurrently, the server is to a state, where upon reboot, all the non-LE SSL Certs (bar one site) get replaced by the wildcard cert of our own company. That is to say, that with/without issuing new LE SSL, rebooting often (not always) causes sites with their own EV certs to switch to use the hosting companies wildcard.\nThe solution appears to be to untick SNI on one of the EV sites, and retick it (and continue through the list until you find the \"one\" that fixes them all). Sometimes it's the first one we pick other times it's a few down the list.\nI should note that there are multiple IP addresses, and SNI used too.\nIP's (v4)\n.3 houses all the LE certs and the one EV that works.\n.6 houses the EV certs\n*.8 houses the wildcard cert sites.\nPreviously they had all been on *.3, but we moved them and 'assigned' them to be other IPs to try and work out what was going on. \nNot having a default HTTPS site seems to help - with this present, everything goes haywire more often.\nThoughts? Experiences?. @webprofusion-chrisc \n(1) They're scheduled to run as \"highest privileges\" under an account that is in the Administrator group, but isn't the actual Administrator.\n(2) Looking at the output of netsh, there are no \":443\" bindings for IP:Port. There are 0.0.0.0:443 though. Which is odd, I thought that was an unassigned non-SNI HTTPS binding... but we don't have one. The default site has an SNI enhanced HTTPS Binding with Hostname.\nI'm not sure about the last known good idea. The server's a VM, so there's no console access to see it on boot... although that should show in the event viewer, shouldn't it? There have been a couple of long reboots, without Windows updates being installed... Hmmmm.\n@WouterTinus - Interesting. However, there are times when two consecutive reboots, without the use of LEWS (issue or renew), causes the certificates to get \"messed up\", \"most of the time\". \nQuestion: Are there any plans in LEWS to double apply the cert storage as a matter of course?\nFurther thoughts:\nWe found this: https://docs.microsoft.com/en-us/iis/get-started/whats-new-in-iis-8/iis-80-server-name-indication-sni-ssl-scalability that seems to indicate that the Cert Web Hosting store and the Cert Personal store are same-same, but different.\nWe then realised that the LEWS certs are in Webhosting, and non-LEWS are in Personal. We have approx 10 EV, Bank (et al) Certs in Personal - AND it includes our WildCard cert. \nQuestion: Does the location of the non-LEWS cert have any bearing on any of this?\nQuestion: Also, do you know if the Personal Store crap itself when you reach a certain number of certificates?\nLastly, thanks for you both being involved in this :) I appreciate your past/future help on this.. Thanks @webprofusion-chrisc, but that doesn't seem like our issue.\nWe are assuming that certLM/Manage computer certificates, all tasks> manage Private keys is in the MMC? (and you're not referring to the Registry.) If we do this via the snap-in in the MMC , we can see the permissions, and they say full control.\nThe windows/ that we use is machine specific, not AD/Domain, it is logged into remotely by us to initiate LEWS & admin the machine + IIS. We've never seen any errors as you've noted. (re: 'A specified logon session does not exist'). FYI: Won't be commenting until the new year. Merry Christmas & Happy new year to all. (And to all a good night?)\nReading back, I'm now enjoying the irony of our default site with a hostname. \ud83d\ude04 \nOn topic question: Should I assume from the above that the 0.0.0.0 shouldn't be there at all? Is there a case where it should be there?\nAlso, on topic, but not - is my thinking correct, that having a default site with unasssigned IP, unbound HTTPS hostname is stupid on a server that's mostly SNI? (Thought being, a browser arrives at server, and see's default site for whatever reason on \"some random client domain\", and gets served HTTPS SSL cert for completely different domain, and thus the \"alarmist browser screen of warning +6\".). @webprofusion-chrisc - crazy thought. What if said ghost binding is an indirect result of the machine name being changed at some point in the past?\n(I had another comment under this, but I removed it as we found conflicting info - will update when we've worked out what is what)\n  . Hi all, \nMuch time, such wait, wow, Amaze!  ... >> Moving on >>\nWe have \"Exorcised the demon\" (Ace Ventura).  I didn't actually work on it, but the ghost binding was the key. What was more the key, was that there were ghost bindings for more than one IP Address. Once we simultaneously removed all these bindings, peace returned to the village.\nWhen the wrong cert was being issued, there was a secondary IP Address which showed the :443. Once we removed that with netsh http delete sslcert ipport=:443, the problem instantly rectified and stopped recurring on reboot.\nThank you so much for your help, patience and collaboration on this. I really appreciate it. :). We've just experienced this too with version 1.9.1 of letsencrypt-win-simple (L.E.W.S). \nThe process executes happily up to Submitting Answer & Refreshing Authorisation, but then the Event ID 2 appears: [Information] Auth Result \"invalid\". (Followed by Event ID 4, Error] Authorisation Failed \"invalid\")\nOn the surface, we think it's because 'require SSL' was selected. When the massive digest of info gets put into the Event Viewer, it notes that there is an \"invalid response from http://[website in question].com.au/.well-known/acme-challenge/[mass of characters]\".  *Note the https, not https.\nThat aside, the real issue here is that the renewal date registry value for this was increased by 60 days. Obviously pushing it beyond the original 90 day window of use.\nAt this point, I'd like to also +1 the force-renew idea, and also suggest an improvement that ties the current manual / single line implementation of L.E.W.S to an IIS entry (even if it's by manual reference of IIS ID, although matching physical path would be good)\nLet me know if I'm behind the times on any of the above. Case in point, I've just found & downloaded version 1.9.3 :). Oh! So it's a simple case of copying the registry values into a file & deleting the registry values.\nWonderful. Thanks @WouterTinus :). ",
    "webprofusion-chrisc": "@misterHippo can I just check if your renewals are using the Administrator account or an alternative (a service account or SYSTEM etc)?. @misterHippo regarding the reboot causing the certs to go wrong, this sounds possibly like an issue with the CurrentControlSet - if you are booted using Last Known Good configuration then when you reboot you go back to the old configuration (or some version of it). \nIf the wrong cert is presenting itself always check first that the \"netsh http show sslcert\" doesn't show an IP with no hostname being bound to a cert, if it does that will take precedence over SNI bindings, and you can delete it with \"netsh http delete sslcert ipport=:443\" if you know it shouldn't be there.\nRegarding the Private Keys issue @WouterTinus mentioned, yes for Certify SSL Manager we've found that in some cases using an alternative user account for cert requests (and thus cert storage) can (sometimes) lead to a problem whereby the private key for the new cert cannot be accessed shortly after the cert creation. So it can look fine, then stops working, presumably when windows cleans up it's temp private key storage. Repeating the storage of the cert (same cert twice) fixes the issue, but I have no idea why. We do also re-apply the binding twice but I don't know if that makes any difference.\nIn all cases, our projects have limited resources for exhaustive testing and it's real world feedback that makes all the difference, so thanks to everyone who contributes their time and effort to investigate.. @misterHippo Regarding Personal vs Web Hosting. Personal (MY) is better supported in the .net API knows about it, whereas 'Web Hosting' is a kind of add-on). Web hosting has alleged performance benefits but I haven't seen much detail on it. I'm trying to loop in an IIS/httpapi internals developer from MS to see if they can shed any light on the cert storage issues. Ideally we'd get some hard numbers of Personal storage limits, rather than a vague \"it's better, somehow\" :)\nRunning as an alternative user account (in Certify's case, Local System when running as a background service) surfaces the private key problem almost immediately. If you can't access the certificate private key permissions (Right click certificate in certlm/\"Manage computer certificates\", All Tasks > Manage Private Keys) then this is the problem. The other symptom of this is if you try to fix the binding in IIS (deselect and reselect the certificate) you get 'A specified logon session does not exist', so I think generically it may centre around per-user profile storage of private keys. You could try logging in to remote desktop as the alternative user to see if they just need to have a profile folder/registry setup.. From the Certify side, one of our users seems to reliably get a 'ghost' cert binding every time they start a new site  using SNI and a specific IP. Using non-SNI works ok, so it seems to be the combination.\n@WouterTinus regarding the double cert storage, yes that's done as a preventative measure. Currently the risk that it may or may not cause an issue is too high, so we're doubling up just in case.\n. @misterHippo I believe 0.0.0 0 is the catch-all binding thats the same as 'all unassigned' https://www.howtogeek.com/225487/what-is-the-difference-between-127.0.0.1-and-0.0.0.0/  regarding default sites, thats just what site you want to show if no hostname is given in the request (like a request by ip only or a DNS pointer to that ip that has no site hostname binding). Default sites are generally unnecessary, but there can be good reasons for them.. Hi, I can confirm with my own testing that any attempt to specify a fixed IP for an SNI binding results in a 'ghost' binding of IP:port being added as well as the hostname:port SNI binding, which then takes precedence over any other https binding on the same IP. This seems to be expected (?) behaviour but I'm just looking for a technical doc to back that up. \nI believe that the solution is to always use 'all unassigned' etc for SNI, IIS/http.sys will then direct the traffic to the correct site.. @blakeduffey just as an aside, unless you specifically require FIPS you can disable it (it actually means you can only use a subset of validated cyptography algorithms, not necessarily better or more secure ones): https://www.howtogeek.com/245859/why-you-shouldnt-enable-fips-compliant-encryption-on-windows/. One of the major issues I found while developing the latest version of Certify with wildcard support was that your reliance on DNS providers increases massively, as does the requirement to securely store DNS API credentials so you can do auto renewals. \nFrom a maintainers point of view, it's worth considering these points up front as otherwise the level of support requests for help with manual DNS challenges and custom DNS scripting will increase dramatically.. @daniel15 thanks, yes I've been looking into that. Incidentally my plan with Certify is to offer a supported hosted DNS CNAME redirection service that other clients can also have plugins for, so a bit like acme-dns but the only setup would be to register for an API key then set your CNAME in DNS (per domain), thereafter updates would be automatic. There is a security consideration regarding safety of people's certificates if someone compromises the service or gets your API  key, so that needs more thought, possibly a 2FA option or notification whenever an update happens.. @jhughes-mc Posh-Acme has a bunch of DNS scripts: https://github.com/rmbolger/Posh-ACME, Certify has cloudflare and wildcards etc but is a GUI not a CLI so may not be what you need. You could also just use curl or similar to talk to the cloudflare API as I don't think powershell is a requirement of win-acme.. For those experiencing this issue, what OS version are you on, what version of .Net do you have installed? Can you confirm your website has explicit hostname bindings present for your domain(s)?. @lexo13 OK, server 2012 and IIS8. Does your website have bindings showing in the IIS UI? Do you have any special website control panel software installed?. @DumbJoe AFAIK Apache on all operating systems requires a restart to see updated certificates, so just updating the certificate file is only half the job. If in doubt you could schedule a restart of Apache every week/month.. @DumbJoe not that I'm aware of (for Apache). You just need to restart Apache though, not the whole machine (as per httpd.exe -k restart in, https://github.com/PKISharp/win-acme/wiki/Apache-2.4-Basic-usage) which I'm sure you've seen already.. @DumbJoe yes, but you can also use a scheduled batch file (running the command mentioned above) to restart apache in the same way. The idea would be to run this batch file after you have renewed your certificate.. @DumbJoe thanks, I'm not the creator of this app though, I make an app called Certify (https://certifytheweb.com) which is a GUI that does much the same sort of thing (it doesn't directly support Apache either, yet). Funnily enough I did start the conversation that led to both programs being created though: https://github.com/ebekker/ACMESharp/issues/12\nI'm not an expert in win-acme though, I'm just chipping in to try and help a little. \nQ1: yes in general it does create the .well-known folder, although it depends on the challenge type.  This is (usually) required for every renewal. \nQ2:  you can auto redirect to https but you must preserve the url path so that a request for http://yourwebsite.com/.well-known/acme-challenge/test123 becomes https://yourwebsite.com/.well-known/acme-challenge/test123  and not just http://yourwebsite.com - let's encrypt needs to be able to get to the challenge response that's auto created.\nQ3: maybe something like this: https://stackoverflow.com/questions/10457207/redirect-to-another-domain-but-keep-the-url but honestly, IIS has a GUI and it's generally easier to use than modifying Apache config. All webservers have some complexity when it comes to https/ssl though.. @alexhass a simple option is to schedule a task to cleanup files older than 180 days (for instance) e.g.: https://stackoverflow.com/questions/51054/batch-file-to-delete-files-older-than-n-days that way you are in control of the cleanup you need.. Tip: on windows you can use the 'where' command to find where an exe in your path is coming from. So if you type 'where letsencrypt' you may find that it's not where you expected it to be (perhaps in system32 etc). When you use Let's Encrypt to request a certificate you can only use real publicly registered domains (e.g. microsoft.com) - local machine names or made up names won't work (like 'companyweb').. You appear to be running Apache on port 80 externally, according to the 404. As you've picked the self hosting option Apache may conflicting with this? Or are you perhaps running Apache as a reverse proxy front end for  the server?. This is not currently supported and is a part of future ACME v2 support. See https://github.com/PKISharp/win-acme/issues/464. The error 'Keyset does not exist' suggests a possible permissions problem. https://support.microsoft.com/en-au/help/977754/keyset-does-not-exist-error-message-when-you-try-to-change-the-identit. Just for info, you might also want to look at certes: https://github.com/fszlin/certes its ideal for integration into other apps.. @WouterTinus even when signed you can still get people reporting your app as malicious just to be mean (then smartscreen blocks it). If you're building a single exe you can run the sign tool over that to sign the bundle. You can also sign other peoples unsigned dll's in your distribution.. Just a general pointer if people are having similar issues, The app doesn't know how your domain zone is structured but your custom script can/should. So your script may have to trim the requested record part down to just the root domain of your zone (not always the case for all DNS APIs). \nGiven a record to create called _acme-challenge.remote.example.com - If the zone is for a whole domain example.com then you would generally have to trim it down to _acme-challenge.remote and if your zone is for a the subdomain remote.example.com then you'd need to trim it in your script to just _acme-challenge. The general technique is to replace the part of the domain you don't need with a blank (\"\"). Then create the resulting TXT record name. Repeat for the delete process.. Hi, your apache https.conf perhaps has a reverse proxy configuration? Looks like the /.well-known/ path isn't mapping to the respective file system folder.. @mpinardon did github remove an extra slash? I think you may(?) also need forward slashes for the path.\nxml\n<Directory \"D:/www/web/.well-known\">\n    AllowOverride All \n    Require all granted\n</Directory>. Hi, when the certificate is stored in the main certificate store of the server Windows stores the private key file separately with restricted permissions. The error you are seeing can be caused by a few things:\n\nAn intermittent authentication issue (restarting the server can sometimes fix this)\nYour private key is stored under a user account that IIS cannot access the keys for. This is most common if you are using something other than the default Administrator account to run your certificate generation. A workaround for this is to export the stored certificate using the account that created it, then re-import it.\nYour private key for this cert is no longer accessible by any account, if you still have the pfx you can re-import it.\nYour application pool identity may just not have access to the certificate store: https://stackoverflow.com/questions/2609859/how-to-give-asp-net-access-to-a-private-key-in-a-certificate-in-the-certificate\n\nAs ever with weirdness on Windows, make sure your %TEMP% folder (inc subfolders) does not contain more than 65535 items as various apps/parts of windows stop working reliably after that.. Glad you got it working, it would be really interesting if you could find a reason for the permissions not being fully set. Normally windows takes care of all that, but glitches do happen.. If it would help I could sign releases using the Webprofusion Pty Ltd code signing certificate (used for Certify), as real code signing certs are quite expensive. As you say that only solves certain parts of the problem. There may be some way it could be used via appveyor (or similar) but still keep it secret, obviously I need to control that cert pretty carefully. Just a thought anyway.. @WouterTinus I can definitely recommend the paid support angle. Only a small percentage of users convert but it's worthwhile doing as it's support that you would have ended up doing anyway. I've tried Open Collective etc for other things but it's not been effective.. Hi, your server or firewall is blocking traffic on port 80 (http). You can test this by opening your website (http:// not https://) on your phone using your phone data (switch off Wi-Fi first), which then means you are connecting as an external visitor. If the site also times out there then you know you can investigate unblocking your firewall (on the server most likely).. If you're website is responding to external traffic on port 80 (not just an open firewall, the website actually responds normally) and there an no IPv6 issues etc, then I'd suggest trying this tool to diagnose issues: https://letsdebug.net/\nIf that doesn't report a problem then try reporting the issue with the exact Let's Encrypt error message here: https://community.letsencrypt.org/ - there's an outside chance that the Let's Encrypt service is having some sort of trouble, however the most common reason is that your website just isn't externally accessible on port 80 and the LE server just can't connect to check your validation.. Your server firewall is probably blocking port 443 (https).\nFrom PowerShell on another computer try:\nPS\nTest-NetConnection -Port 443 -ComputerName yourdomain.com\nIf you get 'TcpTestSucceeded : False' then that likely confirms your firewall if blocking. If it returns 'True' then it's an IIS configuration problem.. This is not optional unfortunately. Let's Encrypt (the certificate authority) determine which path they will check for http challenges. It is not configurable or negotiable in their API.. Windows can only bind one SSL certificate per IP/port combination unless you are using SNI (which is not available before Server 2012). This means that for Server 2008 (R2 included) you need a separate IP address for each SSL certificate. The other alternative is to create a (SAN) certificate with all the domains you are hosting included, then bind that in your https bindings as required.\nI would very much recommend upgrading to a newer version of Windows Server and using SNI bindings (which are non-IP specific/shared bindings). Unless you are on Extended Support with Microsoft your operating system reached end of life in 2013.. From my fairly shallow investigations, tls-alpn on Windows will either need Server 2016 or higher (for http.sys driven servers like IIS or a standard http listener like a self hosting process) or a custom https server process controlling port 443.\nIf anyone can find/produce a proof of concept tls-alpn-01 challenge response on windows (ideally that does/doesn't take down IIS port 443) it would be great to see it.. Just as an aside. although DNS plugins are generally necessary they are a maintenance burden which you need to weigh carefully, as in reality there are hundreds of popular providers and thousands of less popular ones. In some cases a buggy API call can even wipe out a DNS zone(!). \nTo reduce your maintenance burden you might consider taking a dependency on providers written for Posh-ACME (which is also a powershell dependency) https://github.com/rmbolger/Posh-ACME or other tools.\nConsider also having an ACME DNS provider, which is a one-time auto registration per fqdm, and a manually created CNAME redirection to a TXT record hosted by the acme dns service. The service can be either hosted externally or the user may run their own acme-dns instance.. I note from acme.sh that you can get buypass certificates that last up to 180 days but they are limited to one domain plus the www. subdomain, so will need a little extra validation logic depending on which CA your cert is currently requested against. For certify I went all out on a new workflow for acme v2 so the though of having to re-implement a v1 workflow is mostly what's making me hesitate. That and the uncertain nature of the CA's future (I don't know enough about them) - alwaysonssl.com was also CA offering free ACME but their website doesn't seem to work now.. It's worth knowing that .domain.tld and domain.tld must indeed use the same _acme-challenge.domain.tld TXT record, this is as per the current ACME/Let's Encrypt design. You can either complete the challenges individually (allowing the other to fail then retrying) or you can try to use your domain control panel to add a multi value TXT record (not all controls panels support that).. Can't help with this but just as an aside, Server 2012 supports wildcard certificates, it just doesn't support wildcard host headers (i.e an IIS catch-all binding to .example.com). Couple of things to look at:\n-  try using https://letsdebug.net to see if it says anything.\n- you have multiple name servers for your domain so you need to allow time for the response to replicate to those. For manual DNS issues I usually recommend waiting one hour between making the DNS TXT record value change and proceeding with the completion of the challenge.\n- what is the language locale/region of your windows installation? There is an unusual case which affected Certify (my app) related to the sort order of JSON account keys but may not be an issue here.\n. One thing I would investigate with account related weirdness (especially DNS challenges) is that serialization order of the account key to JSON for hashing is super important and I wasted a week debugging that on Certify (which uses Certes). .Net reflection determines the default order of serialized properties and this varies by region. The fix for certes was to specify explicit serialization order; https://github.com/fszlin/certes/commit/7f6eae653a911b8a1984c5ef895912b16c346628\nWe also had a bug regarding the encoding of the X and Y components of the EC curve which affected a subset of account keys (depending on whether the value was low enough to ended up being 1 byte too short), this was with Bouncy Castle - I don't know if you would have anything similar here though.. Hi, if you try out https://letsdebug.net you have something wrong with your DNS setup:\nhttps://letsdebug.net/app.home.tilsch.it/28717\nThe CAA servfail error means Let's Encrypt can't check whether they are allowed to issue cert for your domain or not (a CAA record may specify which authorities are allowed to issue).\nThat said, the error could be masking some other problem as otherwise it seems ok.. ",
    "Soumya-Saha": "Thanks!\nOn Sun, Feb 7, 2016 at 12:08 PM, Robert Kerber notifications@github.com\nwrote:\n\nClosed #99\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/99.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/99#event-542043537\n.\n. Yes, I did that.\n(Though there were no instruction/option on display for specifying S at the menu to run it for multiple sites)\n. Windows Server 2008 R2. IIS 7.5\n. It is checking other sites, which were not specified, for authorization validity.\n. I used the letsencrypt-win-simple v1.8.9 pre-release. Today I faced this problem while running it on 18 sites out of a total of 34 sites.\n. Oh, I understand now. Thank you. I'll wait and try the next release.\n. Hi! Any update on the upcoming release date?\nThanks.\nOn Feb 26, 2016 8:55 PM, \"Robert Kerber\" notifications@github.com wrote:\nYes, this was fixed after the pre-release of v 1.8.9 was released. If you\nwant the fix you will either have to compile the code yourself or wait for\nanother release. I'm targeting this weekend or Monday for another release.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/154#issuecomment-189322055\n.\n. Oh, ok. Thanks for the update.\nOn Mar 3, 2016 9:16 AM, \"Robert Kerber\" notifications@github.com wrote:\nNope, there are some other SAN issues that need to be fixed and testing is\nhappening for one, and I still need to fix the other and test it as well.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/154#issuecomment-191566687\n.\n. Hi Robert,\n\nYes, I had already checked it using SSLABS and the expired cert was being used.\n. I'll try out your suggestion and 'll get back to you.\n. Followed your suggestions. It helped. Though a reboot was necessary.\nThank you so much!\nSoumya Saha\n. ",
    "jakobbotsch": "I see, sorry about that. I only tested it on server 2008 and just dove into it head first, so hadn't seen that page.\n. ",
    "UweKeim": "I don't think so.\nOne of the current entries of my web.config is:\n<add \n    name=\"httpplatformhandler\" \n    path=\"*\" \n    verb=\"*\" \n    modules=\"httpPlatformHandler\" \n    resourceType=\"Unspecified\" />\nI tried to add the content from your link but this renders my website defect, showing only the HTML as source code.\nMaybe I could add your web.config changes, run the letsencrypt tool and remove it again.\nEven if this would work, my understanding is that I would have to do it every half of a year for every reneval. This seems impractical to me.\n. Thanks and sorry, I suck at reading :confused: \nAfter changing the web_config.xml as described in the MVC section of the wiki, everything worked as expected. \n. I see that this pull request seems to provide an additional command line parameter that should fit my needs.\nUnfortunately it is not merged yet.. This pull request also seems to provide an app.config setting for exactly the same scenario.\nUnfortunately, it is not merged yet, too.. Most likely the project here is dead and the developer moved on to other things.\nSince the app is overall in a very usable state, I do think this is acceptable.. Thanks, @Bitmapped. Is there a standard procedure/\"workflow\" for dealing with abandoned projects here on GitHub?. I've just looked at Rick Strahl's blog article.\nI was able to add the following lines to the \"Web_Config.xml\" and got it working:\nxml\n<handlers>\n  <clear />\n  <add name=\"StaticFile\" path=\"*\" verb=\"GET\" modules=\"StaticFileModule\" resourceType=\"Either\" />\n</handlers>\nSo my suggestion is to add the above lines by default.\n. Thanks, @WouterTinus, I'll try that (I start right now trying to understand what these other modes actually mean).. Generating a single SSL certificate for a single domain takes these steps:\nV1.9.3:\n\nletsencrypt.exe return\nreturn\nreturn\n23 return\nn\nreturn\n\n(6 steps, 5 return keys)\nV1.9.8.1:\n\nletsencrypt.exe return\n1 return\nreturn\nreturn\n23 return\n6 return\n1 return\nn\nn\nn\nq return\n\n(11 steps, 8 return keys)\nCommand line usage for V1.9.8.1:\nI've found no way of specifying a single domain. --siteid doesn't help, since my site has multiple domain bindings and I only want to add an SSL binding for one domain.\nIt seems that I might use --excludebindings to specify all domains that I do not want to bind, but this looks so unnatural to me that I didn't even try this option. I would have to enter approximately 50-100 domains to not bind, only to bind one single domain.. Thanks, @WouterTinus. \nI've just tried:\nletsencrypt.exe --plugin iisbinding --manualhost www.example.org --validation selfhosting\n\nThis seems to be the exact equivalent as what I do in the interactive wizard.\nAwesome \ud83d\ude04 . Thanks, @nemchik \nHow about printing something like that at the end of the wizard:\nWizard finished. Did you know that you can run the exact same configuration\nby using the following command line:\n\nletsencrypt.exe --plugin iisbinding --manualhost example.com --validation selfhosting\n\nI.e. help the user by automatically calculating the full, exact command line of his entered values.. Please accept my biggest \"thank you\" I can give!\nNot only did you listen to my (ranting) suggestions, but you also provided a new release in record speed.\nThis is really awesome!\n(Is there a PayPal donate button or something similar somewhere?). Version 1910.1.6661.39349 (RELEASE)\nI'm getting this error, too, for a site that worked successfully since years:\n\n[EROR] Error authorizing [IISBinding] nugetserver.zeta-test.com (SiteId 7) [ @ C:\\Websites\\zeta-test.com\\nugetserver]\n[EROR] Exception: No DNS identifiers found.\n[EROR] Renewal for nugetserver.zeta-test.com failed, will retry on next run\n\nI've double-checked, that the hostname is correctly configured in the IIS site bindings, and that the public DNS entry is present, too.\nAdditionally, both the SSL version and non-SSL version of the website is reachable.\nMy question:\nAny hints on what I might have done wrong?. For anyone (like me) who do/did not know about ACMESharp, here seems to be the ACMESharp repository.. These never-ending breaking changes to the once-to-be-usable application really drive me insane. Instead of a fire-and-forget SSL tool on my servers, I do have a pile of broken glass at least every 6 month. Now I'm getting my hands bloody again by picking up and fixing douzens of broken Apache SSL configurations on my Windows server.\nProbably fixing it once again and never ever updating will be the best option. \ud83d\ude22 \nMy actual question:\nAre the above mentioned changed included in the v2.0.4 release?. Is this Apache documentation still up-to-date?\nBecause it talks about DefaultApachePath and here you talk about DefaultPemFilesPath and I'm really not sure how to get working certificates to my Apache again.\nUpdate 1\nIn addition, when running this command from the linked Wiki:\n\n\"c:\\program files\\letsencrypt\\wacs.exe\" --target manual --host exit.php.apps.zeta-producer.com --validation filesystem --webroot \"C:\\Websites\\zeta-producer.com\\apps\\php\\exit\" --store apache\n\nIit gives an error:\n [EROR] Unable to find store plugin apache\n [EROR] No store plugin could be selected\n\nHow to fix this?\nUpdate 2\nI got it working with:\n\n\"c:\\program files\\letsencrypt\\wacs.exe\" --target manual --host exit.php.apps.zeta-producer.com --validation filesystem --webroot \"C:\\Websites\\zeta-producer.com\\apps\\php\\exit\" --store pemfiles --pemfilespath \"C:\\Websites\\ApacheConfigs\\Certificates\"\n\nSo it seems that the linked Wiki contains erroneous information.. ",
    "twodawg": "I had the same problem.  In my case, I also had to add this code into my Startup.cs.  \nAlso, be sure to add the .well-known directory.  It is a hidden folder - so use the name, \".well-known.\" (the trailing dot will disappear).  Windows will not allow a new hidden folder without the beginning and trailing dot.\n```using Microsoft.Extensions.FileProviders;\nusing System.IO;\nusing Microsoft.AspNetCore.Http;\npublic class Startup\n{\n    public void Configure(IApplicationBuilder app, IHostingEnvironment env)\n   {\n        app.UseStaticFiles();\n        app.UseStaticFiles(new StaticFileOptions\n        {\n            FileProvider = new PhysicalFileProvider(Path.Combine(Directory.GetCurrentDirectory(), @\".well-known\")),\n            RequestPath = new PathString(\"/.well-known\"),\n            ServeUnknownFileTypes = true // serve extensionless files\n        });\n    }\n}. ",
    "c0bra99": "Running it from an elevated command prompt as Admin on the IIS 8.5 webserver (Server 2012 R2), increased the log level to Verbose, and it doesn't really log anything more detailed.\n```\n02/11/2016 13:08:49 -05:00 [Error] Error JsonReaderException { LineNumber: 0, LinePosition: 0, Path: \"\", Message: \"Unexpected character encountered while parsing value: <. Path '', line 0, position 0.\", Data: [], InnerException: null, TargetSite: Boolean ParseValue(), StackTrace: \"   at Newtonsoft.Json.JsonTextReader.ParseValue()\n   at Newtonsoft.Json.JsonTextReader.Read()\n   at Newtonsoft.Json.Linq.JObject.Load(JsonReader reader, JsonLoadSettings settings)\n   at Newtonsoft.Json.Linq.JObject.Parse(String json, JsonLoadSettings settings)\n   at Newtonsoft.Json.Linq.JObject.Parse(String json)\n   at ACMESharp.AcmeClient.GetDirectory(Boolean saveRelative)\n   at LetsEncrypt.ACME.Simple.Program.Main(String[] args)\", HelpLink: null, Source: \"Newtonsoft.Json\", HResult: -2146233088 }\n02/11/2016 13:08:49 -05:00 [Information] Getting AcmeServerDirectory\n02/11/2016 13:08:49 -05:00 [Information] Certificate Folder: \"C:\\Users\\username\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\"\n```\n. Remote debugging the process it is throwing the exception inside of the \n_client.GetDirectory(true);\nI'll try to load up the AcmeClient source and see if I can dig into it more.\n. I was stepping through and I saw on this line:\nvar resMap = JObject.Parse(resp.ContentAsString);\nThe resp.ContentAsString did not contain JSON, it was an Access is Denied error message. So, I loaded up the {https://acme-v01.api.letsencrypt.org/directory} url in the browser on the server, and it returned the correct JSON. I re-ran the application, and it did not error. I'm going to blame the actual issue on my network setup (Proxy/IDS/etc...). Although it would be nice if ACMESharp handle if it does not get a valid JSON response back and return an error instead of crashing.\n. ",
    "cadams84": "Thank you. After amending the URL, I have successfully generated a certificate.\n. ",
    "Emill": "This probably works to check certificates for equality: https://msdn.microsoft.com/en-us/library/e8ey9k04(v=vs.110).aspx\nThis gives the issuer: https://msdn.microsoft.com/en-us/library/system.security.cryptography.x509certificates.x509certificate.issuer(v=vs.110).aspx\n. Are you sure this works? GetCertHash returns a byte[] that is compared to another byte[] by == which doesn't compare that the contents are the same, but rather that they point to the same array object in memory...\n. ",
    "glacasa": "The RegisterTaskDefinition method expects a String and not a SecureString, so I can't really do this.\nBut I can adapt the prompt to hide the password like in the plugins, is it ok for you ?\n. If we want the task to run when nobody is logged, we must specify a user. \nBut if we answer \"No\" to the question \"Do you want the task to be able to run when user is not logged?\", the task is registered with the default values, without having to enter a user and password.\n. Ouch, I'm sorry, I didn't notice I changed formatting \nI often do the Ctrl K, Ctrl D mechanically, I didn't mean to push these changes\n. ",
    "BernF": "I may have had my version wrong. I downloaded the letsencrypt-win-simple-v1.8.8-SAN-Testing-Pre-Release ZIP file, but the version listed for the letsencrypt executable is 1.8.8.1.\nI believe I do have the password set correctly in the config file as I needed to use the password to import the certificate into the Digicert utility. I'll do some more testing to see if I can find more specific info...\n. Wow, never mind. Totally missed the minor revision number. I'll download the current source and compile...\n. Thanks!\n. The binding doesn't appear to be the issue? Removing or creating that doesn't (seem to) affect whether or not the central certificates can load the PFX file. Plus it works immediately after importing/exporting using the Digicert utility.\nVersion 1.8.9.2 is what I get when right-clicking on the executable generated from the source I download today. I feel like I am missing something obvious.\nThanks for your reply...\n. Thanks. When I had issues the last time the source was newer than the release, didn't even think to check and see if the release was newer again...\n. I tried running again with the newest release (1.9.01) and am still having the same issue.\nI do get a WARNING: Unable to configure server software after the PFX is saved to the central certificates folder. (Again this is running manual from the command line).\nCould that be indicative of some other issue with my config? I haven't worried about it because I don't need the bindings created as I have other scripts for that. I just need the PFX on disk.\nIs there another approach I should try for creating the certs?\n. That's unfortunate, but thank you for the ideas. As time permits I'll try it on different servers and see if I can get it working elsewhere...\n. Interesting! I use a PowerShell script to run in manual mode and could probably integrate \"run as\" into that. However, at some point in the past years the problem went away for me. Though I didn't do anything intentionally to fix it.. ",
    "angryhussord": "I cloned the latest last night and compiled it in VS 2015. Still getting an Index was out of range exception.\nPS C:\\letsencrypt> .\\letsencrypt.exe --san\nLet's Encrypt (Simple Windows ACME Client)\nRenewal Period: 60\nCertificate Store: WebHosting\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: C:\\Users\\Administrator.HUFFORD\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nCertificate Folder: C:\\Users\\Administrator.HUFFORD\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.\norg\nLoading Signer from C:\\Users\\Administrator.HUFFORD\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.\norg\\Signer\nGetting AcmeServerDirectory\nLoading Registration from C:\\Users\\Administrator.HUFFORD\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsen\ncrypt.org\\Registration\nScanning IIS Sites\n 1: SAN - IIS Default Web Site (%SystemDrive%\\inetpub\\wwwroot)\n 2: SAN - IIS Exchange Back End (C:\\Program Files\\Microsoft\\Exchange Server\\V15\\ClientAccess)\nW: Generate a certificate via WebDav and install it manually.\n S: Generate a single San certificate for multiple sites.\n F: Generate a certificate via FTP/ FTPS and install it manually.\n M: Generate a certificate manually.\n A: Get certificates for all hosts\n Q: Quit\nWhich host do you want to get a certificate for: s\nRunning IISSiteServer Plugin\nEnter all Site IDs seperated by a comma\n S: for all sites on the server 1,2\nSystem.ArgumentOutOfRangeException: Index was out of range. Must be non-negative and less than the size of the collectio\nn.\nParameter name: index\n   at System.ThrowHelper.ThrowArgumentOutOfRangeException()\n   at LetsEncrypt.ACME.Simple.Program.GetCertificate(Target binding) in D:\\GitHub\\letsencrypt-win-simple\\letsencrypt-win\n-simple\\Program.cs:line 600\n   at LetsEncrypt.ACME.Simple.IISSiteServerPlugin.ProcessTotaltarget(Target totalTarget, List1 runSites) in D:\\GitHub\\l\netsencrypt-win-simple\\letsencrypt-win-simple\\Plugin\\IISSiteServerPlugin.cs:line 175\n   at LetsEncrypt.ACME.Simple.IISSiteServerPlugin.HandleMenuResponse(String response, List1 targets) in D:\\GitHub\\letse\nncrypt-win-simple\\letsencrypt-win-simple\\Plugin\\IISSiteServerPlugin.cs:line 89\n   at LetsEncrypt.ACME.Simple.Program.Main(String[] args) in D:\\GitHub\\letsencrypt-win-simple\\letsencrypt-win-simple\\Pro\ngram.cs:line 356\nPress enter to continue.\nPS C:\\letsencrypt>\n. Okay, so I think I'm nearly there. I've had to switch domains because I forgot mail.hufford.org is still in use for Google Apps. So I created the record in DNS for webmail.hufford.org, verified it propagated overnight. Then, after running the below, I realized port 80 isn't open on my firewall so the responses can be read. The .well-known and acme-challenge folders were created and the files are being created, but they can't be read externally.\nletsencrypt.exe --san\nM\nwebmail.hufford.org\nwebmail.hufford.org,autodiscover.hufford.org\n%SystemDrive%\\inetpub\\wwwroot\nThe issue left is that I need to reconfigure IIS to allow responses for files in the acme-challenge folder to be read by the ACME server. \n. I have everything working now and have a document written up to explain all the steps to make this work for my home Exchange 2016 lab. It's actually not too bad once I figured out all the changes I needed to make to IIS to allow the acme-challenge folder to be readable over port 80. The biggest pain was this: https://support.microsoft.com/en-us/kb/326965 which means that challenge files, which don't have a file extension, don't have an assigned MIME-type so IIS throws a 404. Once I have this all written up, do you want to add it to the Wiki? I'd really like to share this since letsencrypt means my Exchange lab is just that much cheaper to run now.\n. 2013 it will work just fine, the differences between 2016 and 2013 are very minimal and shouldn't affect the process I've written up for this at all. I'd have to spin up an entirely new lab for it and I'm not sure it's worth the effort for a 6 year old product.\nI don't have a fully fleshed out script yet, but I'll get to working on that this week. \n. https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Using-letsencrypt-win-simple-to-create-a-SAN-certificate-for-Exchange-2016\n. https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Using-letsencrypt-win-simple-to-create-a-SAN-certificate-for-Exchange-2016\n. svecpetr, rename Web_Config.xml to web.config and then place it in the .well-known directory. Then, make sure to turn off the option in IIS that forces SSL connections for that directory.\n. ",
    "soldier9945": "Thanks for answering @rkerber !\nAn entry in the Wiki would be great @angryhussord ! Could you just confirm if your script would work on an older exchange version, like 2013 or 2010? Thank you!\n. ",
    "jean": "Update for anyone reading in 2017, looks like the page is now https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Create-a-SAN-certificate-for-Microsoft-Exchange-2016,-2013-&-2010. ",
    "NKCSS": "Good to hear :) I hope I'll get some time soon and I'll go through the entire project and see what I can do, submit PR's and go from there :)\n. Not sure how to do that; I usually don't use github PR's; for some reason, it adds new commits to existing PR's.\nI have to send my daughter to bed; not sure I'll have more time today. if you can let me know what you want me to do, I'll try and do that next time I have some time.\nRegards,\nNick.\n. ",
    "RickStrahl": "But you can create multiple registrations in a single vault I think so the folder should have no impact on the email address. You would need an option to specify the email address as part of the command line or config options though to trigger that.\nAgree though - if the path is configurable this isn't a big issue but I don't see that option currently. It looks like the docs are out of date for command line options (--manualhost --webroot options aren't there for example).\n. ",
    "Elemecca": "Using the user's ApplicationData folder can also be a security issue: it's part of the roaming profile, so if the user is a domain user their registration key will end up getting synced to the DC and every other domain-joined machine they log into. If it's a dedicated production domain that might actually be wanted, but if the domain is shared with workstations it could result in super-easy key compromise if any single machine they've logged into is compromised with a RAT trojan.\nWe should at least have the option to keep the config directory local.\n. ",
    "richard-browne": "Add my vote. To me it makes no sense at all to store the config data under C:\\Users\\account. An IIS web site is not per user. We have multiple admins on our server. If adminA logs in and configures letsencrypt, adminB will login and won't be able to run letsencrypt.exe. If adminA leaves, his account is deleted from the server, and everything breaks.\nThe correct location for config data is C:\\ProgramData.\nSimilarly, the scheduled task should not run as the user who happened to run letsencrypt.exe first. It should run as SYSTEM by default.\n. ",
    "murray-grant-fe": "I've created a fork with the minimal changes required to change the vault location (which works in our corporate environment).\nNo attempt to address security or email issues raised.\nhttps://github.com/murray-grant-fe/letsencrypt-win-simple. ",
    "keitharowe": "\nI was just fetching the version, under admin creds from the dos cmd\n. --san switch then entering a host number\n\n. Ahhh, I see, ok, made a quick adjustment and that resolved the argument exception. However, now I am seeing \nError creating new authz :: Name does not end in a public suffix\nwhich appears to tell me that I may outta luck with the .local suffix, can you confirm?\n. Thank you very much for your help, keep up the awesome work. Job well done.\nCheers\n. Nice work!\n. ",
    "brunomlopes": "The idea would be to use the manual process, which is unattended, and handle the binding install myself? \nIdeally I'd use the iis plugin, but run it in unattended mode, instead of interactive.\n. Makes sense, thanks.\nMy scenario might be summed up as:\n- create new vm on azure\n- run dsc to install IIS\n- create a iis website/app pool via powershell\n- call letsencrypt-simple with my email to initialize the vault\n- call letsencrypt-simple with the website/app pool to install certificate and set up task scheduler\nThis would all be unattended.\nIf you need help testing a version let me know, I might be able to lend a hand.\n. ",
    "gablau": "O yes, when i check 2 days ago the page not exist!!\nVery nice! I'll wait for a binary release to testing!!\n\nWould it be possible to use this with regular IIS renewals too?\n\n+1 me too\nAnother scenario:\nExchange standalone mail server\n1. IIS with Exchange OWA up and running, which manage renewal\n2. Import certificate in different location store for Exchange service like SMTP, POP3, IMAP\n. If you can provide a compiled version I could do some tests. Off course with Manual plugins\n. Hi, I updated the program to version 1.90 because I need the script to run on the issuance of the certificate, that works properly!\nNow I only have a doubt, I used the manual plugins:\nletsencrypt.exe --manualhost webmail.mywebsite.com --webroot C:\\inetpub\\wwwroot --script C:\\letsencrypt\\myscript.bat --scriptparameters \"{5}\"\nwhich automatically creates renewal in task scheduler:\nc:\\letsencrypt\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\nbut when will do the renovation also will launch the script ?? how does? that there is not written anywhere? or do I have to change the task and add -script parameters?\nYou could confirm that the start of the script does not work with IIS plugins?\nIt is not very clear in the wiki :) \nbest regards\n. ",
    "sthammadi-spsc": "Any update on when #151 will be fixed/closed?\n. I hope #151 gets fixed quicker. Will make my life easy with unattended installs. Especially when i'm constantly tearing down and bring up my stage environment for continuous deployment and testing.\n. ",
    "RiP63": "I would very much appreciate the \"--forcerenew\" option.\nI started implementing usage of let's encrypt certificates and letsencrypt-win-simple for exchange servers, to test the scripts which will bind the certificate to exchange services after renew I have to wait until --renew will renew the certificate (60 days?).\n. I also have the renew problem, using V 1.8.9.1 and 1.9.0.1:\nRenewing certificate for Manual mail..eu (%SystemDrive%\\inetpub\\webmail-redirect) Renew After 19.05.2016\nWARNING: Unable to renew.\nRenewal Scheduled Manual mail..eu (%SystemDrive%\\inetpub\\webmail-redirect) Renew After 21.05.2016\n\"Unable to renew\" is not much information - is there any way to find out the reason, why it fails?\nWould be helpful to know, if there is a problem local on the computer or on server side.\n. ",
    "eliotcougar": "This issue is annoying... It the auto-renewal fails on the first try, it sets the next renewal at least one month after the previous certificate expires...\nUPD: I had to revert back to v1.6 in order to renew... It gave me uninformative Failed to renew errors... And even the attempt to install new certificate fails...\nWindows + Apache 2.2 + Manual cert\nEnter a host name: photobioschool.ru\nEnter a site path (the web root of the host for http authentication): C:\\www\\photobioschool\nSystem.ArgumentNullException: \u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043d\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u043c.\n\u0418\u043c\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430: collection\n   \u0432 System.Collections.Generic.List`1..ctor(IEnumerable`1 collection)\n   \u0432 LetsEncrypt.ACME.Simple.ManualPlugin.HandleMenuResponse(String response, List`1 targets)\n   \u0432 LetsEncrypt.ACME.Simple.Program.Main(String[] args)\n. Renewal of \"manual\" certs does work in 1.6... It's not an enhancement then... It's fixing the regression...\nHowever, even in 1.6 the \"next renewal\" is set 2 months later (after the expiration date) even if the renewal fails...\n. Please, take into account the web-server setup scenario \"Apache on Windows\"... In other words, manual mode is very much needed...\n. ",
    "Knagis": "Adding my +1 - two of our production servers just had their certificates expire because letsencrypt failed during renewal (one of the issues is fixed in 1.9.1, the other is not). Since the certificate is renewed on the let's encrypt side, they aren't even sending out the e-mail. However the certificate either is not installed in the local store or IIS is not reconfigured resulting in the page breaking.\n. Heh, came here to post about it but there are two notes about it here already :)\n. I have a probably related issue.\nBefore: multiple sites with SNI SSL certificates (all from letsencrypt) and one with non-SNI SSL certificate (also from letsencrypt). Each is bound to 1 or 2 hostnames.\nI added a new site, added the http binding with hostname. Ran letsencrypt, generated the certificate, the binding was added, everything was fine for that domain.\nHowever the new certificate was also applied to the site that did not have SNI enabled. Which resulted in that site being broken.\nEvent log (all the same second):\nSSL Certificate Settings created by an admin process for endpoint : the.new.domain:443 .\nSSL Certificate Settings deleted for endpoint : 0.0.0.0:443 .\nSSL Certificate Settings created by an admin process for endpoint : 0.0.0.0:443 .\n. Yes, I can reproduce the issue both with and without --keepexisting.\nWinSrv2012R2\n. Looking at the code, it seems that it should have printed multiple entries to the log if multiple bindings were modified but the console window only shows a single entry:\nOpened Certificate Store \"WebHosting\"\n Adding Certificate to Store\n Closing Certificate Store\n Adding https Binding\n Committing binding changes to IIS\nSo perhaps the issue is somewhere within IIS/Windows. If this is the case, would it be possible to reiterate the IIS bindings to check if the certificate was not applied to a host where it should not have?\nOne suspicious thing I had done on the server (while trying to solve that X1/X3 intermediate CA issue), was using netsh delete sslcert ipport=0.0.0.0:443 at one point. Perhaps that messed up something?\n. No, the change would be made at the folder level, just for the .well-known path. Anything else stays as is.\n. No, at least on my server it works fine without being an app - changing the setting adds an entry to applicationHost.config like \n<location path=\"the-name-of-the-site/.well-known\">\n        <system.webServer>\n            <security>\n                <authentication>\n                    <anonymousAuthentication enabled=\"true\" />\n                </authentication>\n            </security>\n        </system.webServer>\n    </location>\n. Is it working if the site has anonymous disabled and only Windows enabled? The point of this issue was to handle the fact that anonymous authentication could be completely disabled and thus the authorization rule will not help.. Strange, on Win2013r2 that did not work. Unfortunately I no longer have access to that server to verify.. Is there a situation when these would not work and why they aren't in the default web_config.xml?\n. I just ran into the exact same problem - the certificate is renewed, 443 updated correctly but since the old certificate is deleted, the binding on the other port becomes invalid and does not work at all.\n. I have received this error multiple times on multiple servers. Usually retrying once fixes it. I also have received the same message when changing the ssl binding through IIS manager after renewing the certificate.. ",
    "rip747": "Thank you for pointing this out. I wasn't aware the issue had been raised.\nOn Mar 9, 2016 12:41 PM, \"Robert Kerber\" notifications@github.com wrote:\n\nRight now there isn't a way.\nThis is what #151\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/151 is\nabout.\n\u2014\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/163#issuecomment-194418293\n.\n. The latest... i think 1.9\nOn Apr 10, 2016 5:39 PM, \"Robert Kerber\" notifications@github.com wrote:\nThe Manual plugin is set to allow a buffer size of 8192, so I would think\nit should let you type that all in there. What version are you using?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/191#issuecomment-208077743\n. Thank you for taking the time to confirm my issue.\n\nI've been researching it a bit on my end and will try a couple of things.\nI don't think the IIS plugin will work since it is the only site, i don't\nput the domains in the bindings.\nI tried a few things and I can't get it to accept more than 1022 characters\neither.\nIf these are all for IIS sites, you could try the IIS Site Server plugin.\nType in S at the prompt and put in a comma separated list of of the sites\nthat you want.\nOtherwise, it looks like the manual plugin won't work for all of your\ndomains for a single cert.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/191#issuecomment-208086682\n. No problem. If i can figure something out, I'll submit a patch.\nOn Apr 11, 2016 10:03 AM, \"Robert Kerber\" notifications@github.com wrote:\n\nYeah, if you don't have the hostnames in the bindings, you can only use\nthe manual plugin.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/191#issuecomment-208361041\n. I made the changes you requested and updated the code to be a bit shorter\n. Yes.\nOn Jul 11, 2016 4:33 PM, \"Robert Kerber\" notifications@github.com wrote:\nDid you create your cert with the manual plugin?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/256#issuecomment-231855705,\nor mute the thread\nhttps://github.com/notifications/unsubscribe/AABcg7xl5v9X4E9fquc1nrhSD_dvyTMpks5qUqiIgaJpZM4JJu6l\n.\n. What can do I (or what are others doing) in the mean time to get it renew\nand also how I can help you out to get the enhancement done?\nOn Jul 11, 2016 4:35 PM, \"Robert Kerber\" notifications@github.com wrote:\nThe manual plugin doesn't currently support renewals. #195\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/195 is an\nenhancement for the manual plugin to support renewals.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/256#issuecomment-231856268,\nor mute the thread\nhttps://github.com/notifications/unsubscribe/AABcg8xWBnObQJOPVzWlaxuJkVzTfGheks5qUqj_gaJpZM4JJu6l\n.\n. I'll work on the enhancement for you.\n\nI've been looking at the code and issues and noticed that this worked in\n1.6.\nthe only change I've seen in the ManualPlugin.cs between 1.6 and 1.9 that\ncould effect this was this addition:\npublic override void Renew(Target target)\n{\nConsole.WriteLine(\" WARNING: Unable to renew.\");\n}\nLooking at the same method in the IISPlugin.cs shows the following:\npublic override void Renew(Target target)\n{\n_iisVersion = GetIisVersion();\nAuto(target);\n}\nObviously I need to get more familiar with the code, but this is what I got\nfrom the 5 minute tour :)\nOn Mon, Jul 11, 2016 at 4:40 PM, Robert Kerber notifications@github.com\nwrote:\n\nYou just have to issue the certificate again. So it's a new cert not a\nrenewal.\nIt's going to be a while before I have any time to work on the\nenhancement. You can post under that enhancement and see if someone else\nhas time to work on it.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/256#issuecomment-231857908,\nor mute the thread\nhttps://github.com/notifications/unsubscribe/AABcg-n-LOB3hNT1YZVjDaDXeEr6nDQkks5qUqpQgaJpZM4JJu6l\n.\n. ok. thank you for that info.\n\nOn Mon, Jul 11, 2016 at 5:07 PM, Robert Kerber notifications@github.com\nwrote:\n\nTechnically none of the plugins actually renew any certs. They just issue\na new cert with the same info as last time. So it doesn't really renew it.\nBut even that's better than nothing.\nIf you read through the conversation in #195\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/195 and the\nother issues listed there, there was discussion about adding in a command\nline argument and maybe requiring the script to be specified.\nI'm going to close this issue, and if you have other questions about it,\nyou can post them in #195\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/195.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/256#issuecomment-231865262,\nor mute the thread\nhttps://github.com/notifications/unsubscribe/AABcg1THVOzsV_Kvg-kZm08pKIBZsQHUks5qUrB7gaJpZM4JJu6l\n.\n. thank you for your quick response. I've have been playing around in the code since opening my issue. If I get something working, I will issue a pull request.\n. So..... I will admit that I completely over thought this :)\n\nI took your advice and wrote a powershell script that does EXACTLY what I was trying to accomplish. My powershell skillz suck to say the least, but oh well:\n```\n$bindings = Get-WebBinding -Name \"the_name_of_the_site\"\n$needs_cert = @()\n$http = @()\n$https = @()\nforeach( $binding in $bindings )\n{\n    $1 = $binding[\"bindingInformation\"] -split(\":\")\nif($binding[\"sslFlags\"] -eq 1)\n{\n    $https += $1[2]\n}\nelse\n{\n    $http += $1[2]\n}\n\n}\nforeach( $h in $http )\n{\n    if( $https -notcontains $h )\n    {\n        Write-Host $h\n        $needs_cert += $h\n    }\n}\nforeach( $h in $needs_cert )\n{\n    \"c:\\letsencrypt\\letsencrypt.exe --plugin iisbinding --manualhost $h\" | Invoke-Expression | Write-Host\n}\n```. I will fix up the patch and do another pull request.\nIn letsencrypt-win-simple/Plugin/ManualPlugin.cs\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/196#discussion_r59407793\n:\n\n@@ -107,7 +107,14 @@ public override void HandleMenuResponse(string response, List targets)\n                 if (Program.Options.San)\n                 {\n                     Console.Write(\"Enter all Alternative Names seperated by a comma \");\n-                    Console.SetIn(new System.IO.StreamReader(Console.OpenStandardInput(8192)));\n  +\n-                    //Console.SetIn(new System.IO.StreamReader(Console.OpenStandardInput(8192)));\n\nYou don't need to leave the old code in there since you are replacing it.\nOtherwise it looks and works great. It accepted up to 16382 characters for\nme. That's up to 162 characters per domain up to the 100 domain limit. If\nsomeone goes over that, I think they need shorter domains.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/196/files/cba66d56dfb3ad646d7fbdde229aa00891f4b326#r59407793\n. ",
    "Bortxx": "You can not add bindings that are bound to hostnames in IIS 7.5. The host name field is always grayed out for https type. See: \n\nletsencrypt.exe placed this certificate on my IIS server 4 months ago and worked fine. Now that the certificate expired, why will it not renew?\n. How? And how did it work 4 month ago without them?\n. That worked but now I have two HTTPS bindings. One with the IP address \" * \"  and no host name and one with a blank IP address and a filled in host name. Which should I keep?\n. They are both using the new certificate. So keep the one with the host name?\n. So where do I get the build with #224 fixed?\nIs there a nightly builds page?\nDoes this fix the X1/X3 intermediate chain problems?\n. Is wild card cert support ready yet?. Their site states \"wildcard certificates will be supported in January 2018 as part of the ACMEv2 endpoint\".\nAre you saying they are not supporting it yet?. ",
    "johnccr": "That would be really helpful for third party CSR files for IIS websites, for example, when your IIS is hosted on a ISP. This is currently my situation and I have to do the Linux version in order to have it working.\n. ",
    "wombling": "It is possible to do this with the *nix let's encrypt client as that is what I currently use to solve same problem. So underlying capability is there. In the meantime just means I need to use my mbp and transfer the certs across to my windows server.. ",
    "nicholasbergesen": "We're having the same problem.\nInterestingly if you run command prompt as the user you use to connect to your CCS (shift click the cmd .exe and select run as different user) and then run explorer through the cmd, the certs magically fix themselves in IIS. Must be something user profile related, not having loaded some special folders or something.\nOpen Command prompt with this user, then run the \"explorer\" command\nhttps://i.stack.imgur.com/AgbUU.png. ",
    "sintroo": "don't really know how to download the ftp cert in order to add to the trusted root.\n. Well yeah just a usability thing. \nEg. I made a mistake typing a long password and want to just hit backspace many times to get rid of the whole password but if I press one too many it'll throw an error and skip to the next step then I have to start all over again.\n. ",
    "santigarcor": "I have this problem too, the strange thing is that i have a correct path like C:\\xampp\\htdocs\n. But i don't understand why it doesn't work, because if i enter the url in the browser it works\n. I don't know what happend but i tried the solution posted in #182 and it worked like charm\n. ",
    "os-sc": "I got it to work when compiling it myself with a newer version of ACMESharp, Version 0.8.1.0.\nWhen trying to manually replacing the DLLs i got the latest version 0.9. something, which didn't work.\n. ",
    "DusterLag": "I'm using v1.9.0.\nI did notice that it looked fine in the latest version of Chrome and Edge but failed in the latest version of Firefox and the SSL Labs test.\n. Hmm, there must be something else going on here outside of just an \"IIS\" issue.\nFor me it was a simple as removing the X1 Intermediary cert from the Server's certificate store.\nAs soon as I did that the chain was delivered correctly on all browsers. I made absolutely no other changes.\nServer 2008 R2 IIS 7.5\n. Yes, no issue. And just to confirm I've spun up a new VM with IE and Firefox to test as well as re-run the SSL Labs test. Everything checks out.\n. Mine looks exactly like yours.\nAll of my certificates have an exclamation mark on those two fields.\n. ",
    "some-guy-23": "This seems to be related to this change with LetsEncrypt -\nhttps://community.letsencrypt.org/t/upcoming-intermediate-changes/13106\nSounds like the client has the issue pointed out in this paragraph -\n\nBrowsers and other TLS clients generally validate certificate chains based on both the issuer public key and the issuer name. So when you renew your certificates, it's important to serve them with the correct certificate chain. If you're using the official client you should be fine. Similarly, if your client correctly uses the Link: rel=\"up\";title=\"issuer\" header received on issuance, you won't have any issues. The only place you might expect to have issues is if you hardcoded the certificate chain somewhere. If that's the case, you should update your code to use the issuer certificate provided at issuance time.\n\nBasically the X1 intermediate cert is hardcoded somewhere, since it shouldn't be getting used for new certs anymore. This will actually work on some clients (e.g. Chrome) still, which only compare the keys, but not on others that also compare the issuer name, as I found out...\n. So, is this a bug with Windows cert store then...?\n. @rkerber - in my case, I first noticed an issue because CloudFlare rejected a renewed certificate as invalid (basically treating it as self-signed). Dug a bit deeper and noticed that the issuer for the renewed cert was X3. Talked with support about the problem, and they said that the certificate was rejected once it reached the intermediate certificate in the chain, makes sense.\nThe X3 certificate was never put in my store under intermediate (or anywhere) during renewal. I also tried removing the host in question and re-doing the entire process (with v1.9) to make sure that wasn't the problem either. Even after manually adding the X3 certificate to intermediate folder, still having issues.\nI believe this is because, for whatever reason, the certs fetched right now are still pointing towards X1 as the intermediate cert (checking certification path in Windows seems to verify this), even though they are issued by X3. This mismatch causes failure in some clients, including CloudFlare.\n. @nemchik - what are you using for a server? I can't seem to get things working with Windows/IIS. No matter what I do, the client still shows the server as hosting out a certificate w/ intermediate of X1.\nFor reference - https://github.com/ebekker/ACMESharp/issues/119#issuecomment-203479385\n. @LBegnaud - I've rebooted the server about 5 times now I think, ha...\nThe odd thing is it seems to be showing the correct cert path in Firefox now (the site will load without security warning). However, Chrome still shows X1 as intermediate, and OpenSSL run via command line shows failure (due to X1).\n. I'm on Server 2012 R2/IIS 8.5 Here is what I've tried (in different orders) -\n- Removing X1 intermediate certificate\n- Added X3 certificate to Machine/User cert stores\n- Removed all existing site certs\n- Removed appdata folder for LE client\n- Reissued all site certs\n- Rebound IIS to all the new certs\n- Restarted IIS + app pool\n- Rebooted the server (multiple times)\n- Something else I'm probably forgetting\n@LBegnaud and @nemchik - can you verify in both your cases Chrome displays X3 as intermediate certificate, when you go to cert details for the site, and go to Certification Path?\nAlso, if you happen to have OpenSSL installed, it would be a big help if you can run this and let me know if it passes (with your servers) -\nopenssl s_client -connect {server.com}:443 -servername {domain.server.com}\n. @navossoc - yes, Firefox also displays correct intermediate for me as well.\nI'm not 100% sure, but I don't believe it is a caching issues on client side. I tried it on another machine entirely (which, admittedly I have tested with before FF displayed X3), and it still shows X1 as intermediate on Chrome there as well.\nThe other thing is, OpenSSL displays X1 as intermediate, so it doesn't seem to be just Chrome. In addition, I use CloudFlare in front of my site. If you use Strict SSL mode (which requires a valid, non-self-signed certificate on the origin machine), then it throws an error. That's actually the reason I'm trying to figure out the problem. I talked with support there, and they are the ones that first tipped me off to the issue being with the incorrect name on intermediate cert.\n. I checked and the client machine I'm testing with doesn't look like it has the X1 cert anywhere (machine or user stores, or chrome's certificates). So, no clue where it is pulling it from, if not the server.\nRegardless though, since CloudFlare seems to still believe the cert is invalid (from wrong intermediate cert), seems like I'm stuck. :frowning: \nHere is the backstory on the change to X3 cert  - https://community.letsencrypt.org/t/upcoming-intermediate-changes/13106\nAlthough they don't really give any explanation why they decided to keep the same auth key that is causing this headache....\n. I think the problem I'm having is specifically caused by IIS 8.5, since even taking the same steps as others here, it is not resolved. This seems to be backed up by these couple of posts -\n- https://community.letsencrypt.org/t/iis-8-5-building-incorrect-chain-with-lets-encrypt-authority-x3/13320\n- https://social.technet.microsoft.com/Forums/en-US/9cd5d6c8-25e5-494d-acf2-d94230e68a9f/iis-85-on-windows-2012-r2-returns-the-incorrect-intermediate-certificate?forum=winserver8gen&prof=required\nIs anyone using Server 2012 R2 + IIS 8.5 and has gotten things to work?\n. I understand you had the original issue, but I'm saying IIS 8.5 must act a bit differently, as taking the exact same steps to fix the issue (and trying things beyond that even) doesn't work for myself/others on IIS 8.5.\n. Only solution I've seen so far is to rebuild the entire server -\nhttps://social.technet.microsoft.com/Forums/en-US/9cd5d6c8-25e5-494d-acf2-d94230e68a9f\nYeahhhhhhhh...\n. Sure makes you wish LE would have just used a completely new key for the X3 intermediate cert... Or tested it on an existing 2012 Server and found this issue before release... :cry: \n. @LBegnaud - you never mentioned what version of Windows Server or IIS you are using. Are you are on Server 2012 R2 and IIS 8.5? That is the common factor for people who can't get things working.\nI've yet to hear from anyone on that setup that has gotten past this issue (other than reinstalling Windows completely).\n. @LBegnaud - for me, I've verified the issue is not with browsers caching the intermediate. I've setup an entirely new machine, and tested with OpenSSL to get the same results (X1 intermediate being served up).\nCan you run this OpenSSL test from a client machine, to your server? Does everything pass?\nopenssl s_client -connect {server.com}:443 -servername {domain.server.com}\nHere are a list of sites hosting binaries for Windows if you need them for OpenSSL - https://wiki.openssl.org/index.php/Binaries\n. Well, then I don't know what to think at this point, since I tried the exact same steps (and more beyond that), and nothing works for me, and others as well. There must be some other factor that is having an effect...\n. @LBegnaud - no worries, thanks for trying anyhow. Just to update, I ran the SSL Labs test, and verified that the issue is the server is still hosting out the X1 intermediate (in addition to X3). Error of - \"Chain issues Incomplete, Extra certs\".\n. @navossoc - for the steps that fixed it for you, I've tried those identical steps previously, without any luck. At this point, I'm just wondering what the people who are having issues have in common, since it doesn't seem to be specifically 2012 R2 and IIS 8.5.\n. @navossoc - yeap, that is actually what I did when I created the new site. I removed the old bindings from IIS, restarted IIS, then created a new site, added new bindings, and no change.\n. @Rouzax - looks like you are running into the same issue the rest of us are experiencing, sorry! Let us know if you find any fix...\n. It should, yes. I'd test out your certs with a VM or such to confirm this first, before wiping your existing server though.\n. Yeap, this was the issue, and I was able to manually renew the certs without a problem. Added my thumbs up to request #195.\n. ",
    "tim-j-s": "rkerber, thanks for the update. So is it likely that Let'sEncrypt will update their certs soon to avoid this issue? I'm assuming this would be easier than waiting for Microsoft to update IIS!\n. Well, I could try, but as you say others have not had a lot of success on 2012 R2 with IIS 8.5. Being a novice with HTTPS (which is what attracted me to Let's Encrypt in the first place of course!) I don't want to break my existing sites that are using the X1 cert and end up with all those sites not working.\nThe certs don't renew until June, so some time to see if this gets resolved. Converting my other sites will have to go on hold, and I may just have to go back to having them all unsecured.\nI assume temporarily disabling the scheduled task for letsencrypt-win-simple until this is resolved will not have any detrimental effect? I don't want to wake up one morning and find all the sites are broken because it has updated all the certs to X3!\nThis sort of thing is going to ruin people's trust in Let's Encrypt.\n. Jacob Hoffman-Andrews at Let's Encrypt has just posted on the LE forum that they are looking at this issue!\n\"Just wanted to chime in and say we're looking into this and trying to come up with a good answer. Your work on this thread is very helpful too, so please do keep trying things and let us know what you find!\"\nhttps://community.letsencrypt.org/t/iis-8-5-building-incorrect-chain-with-lets-encrypt-authority-x3/13320/74\nLet's hope they can figure it out!\n. Yes, fixed for me! Well done Knagis on the LE forum!\nOne thing to note - I followed the steps above to delete the X1 cert, then used LE-win-simple to renew all the certs for my sites. But at some point the X1 cert reappeared, so I had to delete it again!\n. ",
    "SvilenStoianov": "Well, that will be very very sad news - if only solution is new IIS installation :( I can confirm that that issue is present also on IIS7 and IIS express. As far as I know, on Apache there is no such problem.\n. Did you try on computer where you did not view your web site before? I also have a laptop where i was able to work before and after that update. But on PC - first time loading my web system via Firefox - problem is still exist\n. well, i'm speachless... there is absolutely no logical explanation for me about that issue :( excuse me, but can you confirm that in you web server have no any critical marks. Here is snapshot from my server - notice exclamation marks:\n\n. Thank you! Maybe I'm too tired - searching for solution - I've start to suspect every kind of properties, but obviously there is something out of my possibilities here.\n. ",
    "Palloquin": "Knagis over @ the let's encrypt forum solved it!\n. Thank you for your very quick responses! much appreciated!\n1) sure, if it's by design I'm absolutely fine with it.\n2) i'm tempted to say it happens every time I generate a certificate for a host that does not yet have a certificate. I agree that the workaround works.\n3) ok, so what is the intended behavior? Should the tool remove the extra certificates by default and does it fail in this case? Or is this error expected behavior if I've run the tool before for this host (e.g. see previour point!).\nI have changed to debug but cannot seem to find any info on what certificate is the problem.\nI find this error, but it does not show more then the CLI does\n<Event xmlns=\"http://schemas.microsoft.com/win/2004/08/events/event\">\n<System>\n<Provider Name=\"letsencrypt_win_simple\" /> \n<EventID Qualifiers=\"0\">4</EventID> \n<Level>2</Level> \n<Task>0</Task> \n<Keywords>0x80000000000000</Keywords> \n<TimeCreated SystemTime=\"2016-04-14T14:40:28.000000000Z\" /> \n<EventRecordID>56016</EventRecordID> \n<Channel>Application</Channel> \n<Computer>HomeServer</Computer> \n<Security /> \n</System>\n<EventData>\n<Data>04/14/2016 16:40:28 +02:00 [Error] Error removing certificate IndexOutOfRangeException { Data: [], Message: \"Index was outside the bounds of the array.\", InnerException: null, TargetSite: Void UninstallCertificate(System.String, System.Security.Cryptography.X509Certificates.X509Store ByRef, System.Security.Cryptography.X509Certificates.X509Certificate2), StackTrace: \" at LetsEncrypt.ACME.Simple.Program.UninstallCertificate(String host, X509Store& store, X509Certificate2 certificate)\", HelpLink: null, Source: \"letsencrypt\", HResult: -2146233080 }</Data> \n</EventData>\n</Event>\n. ",
    "svecpetr": "I'm affected too... \nFor me worked solution mentioned by colinramsay\n. ",
    "chris64digital": "Ahh, that makes sense then! There is a long discussion on this at: https://community.letsencrypt.org/t/maximum-and-minimum-certificate-lifetimes/264/17\n. Agreed, #151 seems to answer all of my needs\n. ",
    "cwn00": "I created the initial certificate using the executable/command line, which also created the Windows scheduled task for me. I then ran the command that you can see in the task scheduler manually, which gave me the notice about the certificate only being renewable after 07/05/2016, which is well after the cert has expired.\n. I  just ran letsencrypt.exe from the command line and it took me through\nthe process, asked me to choose an IIS site and so on.\nOn 5 April 2016 at 17:12, Robert Kerber notifications@github.com wrote:\n\nHow did you run the app when you created the certificate the first time?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/182#issuecomment-205876570\n. No luck with the logs, just a bunch of normal informationals.\n\nI've attached an image of what I'm getting.\nThanks.\nOn 5 April 2016 at 17:59, Robert Kerber notifications@github.com wrote:\n\nOk, then that means you used the IIS plugin and not the Manual plugin.\nThat's good because the Manual plugin doesn't auto-renew.\nIf you are using V 1.8 or greater check your event logs for any errors or\nwarnings logged by letsencrypt_win_simple to the Application log. If you\naren't, there is no logging so not much we can do to troubleshoot it.\nIf it had any errors or warnings while trying to renew, they should be in\nyour event log.\nYou can also change the minimum log level to Debug\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Logging#change-log-level\nand try to run the renew again.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/182#issuecomment-205894924\n. Hmm, image didn't attach. Here it is:\n\nhttp://u.sv1.uk/uploads/o_1afjp8ufocv015uq1bfv13b4ecga.PNG\n. Oh ok, so it didn't update that reg key properly for some reason.\nMy cert expired yesterday now, so that date is a bit out for some reason. The same happened on my own server and another server I manage.\nChanging the date in that key worked perfectly and it seems to have set the correct 'renew after' date now.\nThank you for your help :)\n. ",
    "Gfweis": "Thanks. Unfortunately, it is a public web site... http://yyyz.net\n. Both are public... 1 to yyyz.net and 1 to www.yyyz.net. Neither points to a specific IP address as the server is set to will handle SNI. Is there a way to just remove everything and start over?\n. We have the cert updating for an IIS website using Task Scheduler as created by LetsEncrypt.exe \nwith arguments --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\n. Thanks... really appreciate your help and letsencrypt-win-simple.\n. dws1... I made sure that the . with text/plain was there ... same error.  I am running Win Server 2016 with IIS 10.0.14393. Winserver 2016/IIS 10\nI had two renewal failures this morning...\n[INFO] Authorizing yyyz.net using http-01 validation (FileSystem)\n [INFO] Answer should now be browsable at http://yyyz.net/.well-known/acme-challenge/4WpdO7L21P4N0HRkRPvvGyoCO6bipJV6wShlD41nnU4\n [EROR] Authorization result: invalid\n [EROR] NullReferenceException: Object reference not set to an instance of an object.\n [EROR] Renewal for yyyz.net failed, will retry on next run\n====================================================\n[INFO] Renewing certificate for yyyz.com\n [INFO] Authorize identifier: yyyz.com\n [INFO] Authorizing yyyz.com using tls-sni-01 validation (IIS)\n [INFO] Installing certificate in the certificate store\n [INFO] Adding certificate c3ad8bdbc5463675eb20d790085d829c.74d0fb301303a83ed50871d50d6bb890.acme.invalid to store WebHosting\n [INFO] Adding new https binding :443\n [EROR] Error preparing for challenge answer\nSystem.ArgumentException: Value does not fall within the expected range.\n   at Microsoft.Web.Administration.Interop.IAppHostMethodInstance.Execute()\n   at Microsoft.Web.Administration.Binding.AddSslCertificate(Byte[] certificateHash, String certificateStoreName)\n   at Microsoft.Web.Administration.BindingManager.Save()\n   at Microsoft.Web.Administration.ServerManager.CommitChanges()\n   at PKISharp.WACS.Clients.IISClient.Commit()\n   at PKISharp.WACS.Plugins.ValidationPlugins.Tls.IIS.AddToIIS(CertificateInfo certificate)\n   at PKISharp.WACS.Plugins.ValidationPlugins.Tls.IIS.InstallCertificate(ScheduledRenewal renewal, CertificateInfo certificate)\n   at PKISharp.WACS.Plugins.ValidationPlugins.BaseTlsValidation.PrepareChallenge()\n   at PKISharp.WACS.Plugins.ValidationPlugins.BaseValidation`1.PrepareChallenge(AuthorizeChallenge challenge)\n   at PKISharp.WACS.Program.Authorize(ILifetimeScope renewalScope, Target target)\n [INFO] Uninstalling certificate from the certificate store\n [INFO] Removing certificate c3ad8bdbc5463675eb20d790085d829c.74d0fb301303a83ed50871d50d6bb890.acme.invalid from store WebHosting\n [EROR] Error authorizing [IISBinding] yyyz.com (SiteId 18) [ @ C:\\WebSites\\yyyZ.com\\webroot]\n [EROR] ArgumentNullException: Value cannot be null.\nParameter name: element\n [EROR] Renewal for yyyz.com failed, will retry on next run\n====================================================\nSure hope someone comes up with an answer. Sorry for the large text, didn't see anyway to format.. Ver 1.9.110.1\nInitial issue, I had to turn off windows defender as it treated it as a virus.\nAfter turning off Windows Defender I executed with the --verbose option for both a new cert and a renewal... both failed. Results follow...\n==========================================================\n[DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [VERB] Settings SettingsService {ConfigPath=\"C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\", ClientNames=[\"win-acme\", \"letsencrypt-win-simple\"], RenewalDays=55, HostsPerPage=50, ScheduledTaskRandomDelay=00:00:00, ScheduledTaskStartBoundary=09:00:00, ScheduledTaskExecutionTimeLimit=02:00:00}\n [VERB] .NET Framework >=4.7 detected\n[INFO] A Simple ACME Client for Windows (WACS)\n [INFO] Software version 1910.1.6661.39349 (RELEASE)\n [INFO] IIS version 10.0\n [INFO] ACME server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\n [VERB] Verbose mode logging enabled\n[DBUG] Renewal period: 55 days\n [VERB] Store renewals in registry HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: m\n[INFO] Running in Advanced mode\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: 1\n[DBUG] Scanning IIS site bindings for hosts\n1: 72t.net (SiteId 8) [@c:\\WebSites\\72t.net\\webroot]\n 2: condoadmin.net (SiteId 9) [@c:\\WebSitesCore\\CondoAdmin.net\\webroot]\n 3: jodeeweispilates.com (SiteId 17) [@c:\\WebSites\\JoDeeWeisPilates.com\\webroot]\n 4: meadmin.localhost (SiteId 16) [@C:\\Program Files (x86)\\Mail Enable\\Bin\\NetWebAdmin]\n 5: mewebmail.localhost (SiteId 15) [@C:\\Program Files (x86)\\Mail Enable\\Bin\\NetWebMail]\n 6: packagetrack.net (SiteId 4) [@C:\\WebSites\\PackageTrack.net\\webroot]\n 7: residentnotify.com (SiteId 5) [@c:\\WebSites\\ResidentNotify.com\\webroot]\n 8: residentnotify.net (SiteId 6) [@C:\\WebSites\\ResidentNotify.net\\webroot]\n 9: skyline.sudlerathome.com (SiteId 13) [@c:\\WebSites\\Skyline.SudlerAtHome.com\\webroot]\n 10: stafftimeclock.net (SiteId 7) [@c:\\WebSites\\StaffTimeClock.net\\webroot]\n 11: sudlerathome.com (SiteId 12) [@c:\\WebSites\\SudlerAtHome.com\\webroot]\n 12: sudlerathome.net (SiteId 20) [@C:\\WebSites\\SudlerAtHome.com\\webroot]\n 13: sudlerstaffnotify.com (SiteId 14) [@c:\\WebSites\\SudlerStaffNotify.com\\webroot]\n 14: theelmatclark.com (SiteId 10) [@c:\\WebSites\\TheElmAtClark.com\\webroot]\n 15: theelmatclark.net (SiteId 19) [@C:\\WebSites\\TheElmAtClark.com\\webroot]\n 16: tv.theelmatclark.com (SiteId 11) [@c:\\WebSites\\Tv.TheElmAtClark.com\\webroot]\n 17: www.sudlerathome.com (SiteId 12) [@c:\\WebSites\\SudlerAtHome.com\\webroot]\n 18: www.theelmatclark.com (SiteId 10) [@c:\\WebSites\\TheElmAtClark.com\\webroot]\n 19: yyyz.com (SiteId 18) [@C:\\WebSites\\yyyZ.com\\webroot]\n 20: yyyz.net (SiteId 21) [@C:\\WebSites\\yyyZLtd\\wwwroot]\n 21: yyyzltd.com (SiteId 3) [@C:\\WebSites\\yyyZLtd\\wwwroot]\n C: Cancel\nChoose site: 20\n[INFO] Plugin IISBinding generated target [IISBinding] yyyz.net (SiteId 21) [ @ C:\\WebSites\\yyyZLtd\\wwwroot]\n1: [dns-01] Azure DNS\n 2: [dns-01] Run external program/script to create and update records\n 3: [http-01] Create temporary application in IIS\n 4: [http-01] Save file on local (network) path\n 5: [http-01] Self-host verification files (recommended)\n C: Cancel\nHow would you like to validate this certificate?: 5\n1: Create or update ftps bindings in IIS\n 2: Create or update https bindings in IIS\n 3: Do not run any installation steps\n 4: Run a custom script\n C: Cancel\nWhich installer should run for the certificate?: 2\nWould you like to add another installer step? (y/n): - no\nUse different site for installation? (y/n): - no\n[DBUG] Scanning IIS site bindings for hosts\n [DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: yyyz.net\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing yyyz.net using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://yyyz.net/.well-known/acme-challenge/6RKTlspsGFyB1qdmlzEifdYQdTu7nLJsTa3a8AZEWJc\n [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/CUuqJN0up1Hxa76aj6mrqKhRvD8TwcO5WQS3Y45VOmI/4005621611\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/CUuqJN0up1Hxa76aj6mrqKhRvD8TwcO5WQS3Y45VOmI\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/CUuqJN0up1Hxa76aj6mrqKhRvD8TwcO5WQS3Y45VOmI\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/CUuqJN0up1Hxa76aj6mrqKhRvD8TwcO5WQS3Y45VOmI\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/CUuqJN0up1Hxa76aj6mrqKhRvD8TwcO5WQS3Y45VOmI\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/CUuqJN0up1Hxa76aj6mrqKhRvD8TwcO5WQS3Y45VOmI\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/CUuqJN0up1Hxa76aj6mrqKhRvD8TwcO5WQS3Y45VOmI\n [EROR] Authorization result: invalid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [EROR] ACME server reported:\n [EROR] [type] urn:acme:error:connection\n [EROR] [detail] Fetching http://yyyz.net/.well-known/acme-challenge/6RKTlspsGFyB1qdmlzEifdYQdTu7nLJsTa3a8AZEWJc: Timeout\n [EROR] [status] 400\n [EROR] Create certificate failed\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: l\n1: yyyz.net - renew after 2018/2/24 12:04:57 PM\n 2: yyyz.com - renew after 2018/3/2 12:33:49 PM\n 3: CondoAdmin.net - renew after 2018/3/6 11:03:05 AM\n 4: condonotify.com - renew after 2018/4/6 11:13:46 AM\n 5: JoDeeWeisPilates.com - renew after 2018/4/20 15:00:34 PM\n 6: ResidentNotify.com - renew after 2018/4/20 15:01:01 PM\n 7: 72t.net - renew after 2018/5/6 13:33:26 PM\n 8: 72t.net - renew after 2018/5/6 13:33:26 PM\n 9: theelmatclark.net - renew after 2018/5/12 14:00:53 PM\n 10: theelmatclark.com - renew after 2018/5/12 14:01:08 PM\n 11: sudlerathome.com - renew after 2018/5/12 14:01:24 PM\n 12: skyline.sudlerathome.com - renew after 2018/5/12 14:01:31 PM\n 13: sudlerstaffnotify.com - renew after 2018/5/12 14:01:39 PM\n 14: sudlerathome.net - renew after 2018/5/12 14:01:47 PM\n 15: packagetrack.net - renew after 2018/5/12 14:02:03 PM\n 16: residentnotify.net - renew after 2018/5/12 14:02:19 PM\n 17: stafftimeclock.net - renew after 2018/5/12 14:02:25 PM\n 18: condoadmin.net - renew after 2018/5/13 11:56:26 AM\n 19: yyyzltd.com - renew after 2018/5/21 8:40:31 AM\n C: Cancel\nShow details for renewal?: 2\nName:               yyyz.com\n Target plugin:      Single binding of an IIS site\n Validation plugin:  Use IIS as endpoint\n Store plugin:       CertificateStore\n Install plugin(s):  Create or update https bindings in IIS\n Renewal due:        2018/3/2 12:33:49 PM\n KeepExisting:       False\n Warmup:             False\n Renewed:            16 times\n1: 2018/1/1 6:33:43 AM - Success - Thumbprint A529B9634252CEA4C76A4B768D8D5A65A45E79F4\n 2: 2018/3/18 9:02:26 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 3: 2018/3/19 6:56:09 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 4: 2018/3/19 9:00:38 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 5: 2018/3/20 9:00:41 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 6: 2018/3/21 9:00:43 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 7: 2018/3/22 9:00:38 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 8: 2018/3/23 9:00:49 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 9: 2018/3/24 9:00:47 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 10: 2018/3/25 9:00:48 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 11: 2018/3/26 7:48:34 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 12: 2018/3/26 9:01:06 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 13: 2018/3/27 3:40:36 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 14: 2018/3/27 9:00:47 AM - Error - Renewal target not found\n 15: 2018/3/28 7:31:14 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 16: 2018/3/28 9:00:41 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu:\n. 10.9.0.1... I got renewal working on one website that failed yesterday. The other site is now \"rate limited\" by LetsEncrypt... too many failures so I guess that I will wait a week on that one. . @WouterTinus ... Interesting...  A have AAAA record pointing to an IPv6 address and the link that you provided states that I have no AAAA record.  On two other websites, it finds AAAA record, but states that the \"web server is unreachable : Connection timed out\"\nI will have my web host review and comment.. @stamster ... as soon as I had IPv6 added to my server, all the LetsEncrypt issues went away. A late thankyou to @WouterTinus . ",
    "cpu": "Hi @WouterTinus,\n\nIs the correct way to prevent that to revoke the certificate? \n\nRevocation is not recommended by Let's Encrypt except for key compromise.\n\nOr is there another way to tell the ACME server that we stopped caring?\n\nThere isn't a general way to tell the ACME server that you don't want expiration warnings for the now replaced certificate. ACME has no notion of expiration warnings at all, that's a Let's Encrypt specific feature. You could unsubscribe from the expiration warnings via the link in the email (or delete your ACME account contact) but this will have the effect of silencing all expiration warnings, not just those for a specific certificate. We have some open issues related to this (https://github.com/letsencrypt/boulder/issues/2475, https://github.com/letsencrypt/boulder/issues/1396) but unfortunately they require us to stand up a whole new service in front of our mail provider's API and its a fair bit of work blocked by higher priority items.\n. > I'm not sure if ACME can validate on another port than 80\nACME only supports port 80 (via HTTP-01 challenges), port 443 (via TLS-SNI-01 or TLS-SNI-02), or no port (DNS-01). Let's Encrypt/Boulder will follow redirect responses from the initial port 80 HTTP-01 request to other ports which can sometimes achieve similar results but the initial request will always be 80/443 based on challenge type.\nHope that helps!. > @cpu, when ACME/Boulder follows http redirections will it go to non-standard ports as well as standard http and https?\n@rdebath Yes.. > However, looks like Letsencrypt is reporting its back operational\nOnly OCSP is back to operational. The API is still degraded and we are working on it.. @Acerby I work on the server-side implementation of Let's Encrypt and the ACME Server. My expectation in this scenario is that the IPv6 request would fail but Boulder (the LE ACME server) should have retried with the IPv4 address.\nCan you share the domain name(s) you were trying to renew? When you say: \"the path wasn't accessible via ipv6 due to firewall issue\" can you describe this with more detail? Was there a rule dropping all traffic? Was it a DROP or a DENY rule? What was the change you made at the firewall to fix the v6 route?\nIf you'd prefer we can troubleshoot on https://github.com/letsencrypt/boulder/issues/2770 instead of here.\nThanks!. @WouterTinus Ahhh! I apologize. I didn't realize that Win-Simple was itself relying on ACMESharp. \nThat makes perfect sense and my colleague Jacob's issue on that repo will hopefully help.. @WouterTinus That's great news! Thank you! :tada: . I thought I might be able to help a little bit, apologies for butting in :-)\n\nThere have been known cases where LE staging server gets broken or parts of it are unavailable because of some update but later corrects itself. Also, have you tried this against LE production?\nSpeaking of which, there was an incident with LE stage over the last 12 hours: https://letsencrypt.status.io/\n\nThat's true in some cases but typically this manifests as 500 server internal errors that are fairly distinct from this JSON error. I believe this is unrelated to outages.\nI was able to work backwards from the key authorization (0ZHb5kOp0YhYTtb_O_g-9IS4pvxYsOYuxlHS5EvIlx8) @KelvinJones shared as a starting point for searching the server logs to identify the request that failed. The full error generated when the /acme/challenge/1DxGFoc7Spd3qZ7At1ylxVOnW5D89QdNI7Fp8yNRbhE/1708869654 challenge was POSTed by the ACME client is:\n\"Errors\":[\"unable to JSON parse resource from JWS payload: json: cannot unmarshal array into Go value of type struct { Resource string \\\"json:\\\\\\\"resource\\\\\\\"\\\" }\",\"400 :: urn:acme:error:malformed :: Request payload did not parse as JSON\"],\nIt does look to me like the client generated an invalid JWS body for the request. It seems like it may have been { \"resource\" } or something approximately like that which wouldn't parse. This is the code path in Boulder that generates this error for reference.\n@ebekker Is there potentially a condition where the resource field of a POST to a challenge resource to initiate verification could be generated missing values?\n. > It seems like it may have been { \"resource\" } or something approximately like that \nHere's a small test program that generates the same error (\"cannot unmarshal array into Go value of type struct\") using an input of []: https://play.golang.org/p/Ok3g64cdvA. > Would that field typically contain a DNS identifier?\n@WouterTinus For a POST to a challenge resource it should be \"resource\":\"challenge\". That's definitely the reason these requests are failing. This check hasn't changed anytime recently on the Let's Encrypt/Boulder side and strongly indicates there was a regression/bug with the client.\nAs further background, the corresponding ACME spec section for this resource field is ACME draft-02, section 5.3. Notably the current-most spec (draft-07) does not have this resource field. We note this as a Boulder divergence that will be corrected in the upcoming \"V2\" API.. > The JSON from the Fiddler dump looks like this, so it's missing a \"resource\" field indeed\n@WouterTinus Re-reading your comment if you mean that the literal JSON you shared is missing the \"resource\" field that's not actually indicative of a problem. You've shared a JWS in JSON encoding. The \"resource\" field would be expected to be present inside of the protected JWS body. Unfortunately JWS makes it tricky to look at requests in Fiddler without doing some post-processing to unpack the encoded values & signature.. @WouterTinus I unpacked the JWS with a small test program and go-jose and the raw payload from the JWS you shared is:\nPayload:\n[{\"Key\":\"Resource\",\"Value\":\"challenge\"},{\"Key\":\"KeyAuthorization\",\"Value\":\"I4UCD-X7g1D314LPj5iE2ZJf6bynGtMZlgXjtGPw4iM.5TgkcejXoIl_ZckdDgJUnuM7UMh2reOkH53qtsTDYj0\"}]\nIt looks like perhaps something wiggly is going on with the JSON marshalling. The correct payload should be something more like:\n{\n  \"resource\": \"challenge\",\n  \"keyAuthorization\": \"I4UCD-X7g1D314LPj5iE2ZJf6bynGtMZlgXjtGPw4iM.5TgkcejXoIl_ZckdDgJUnuM7UMh2reOkH53qtsTDYj0\"\n}\nI'm not a C# programmer by any stretch of the imagination but it smells like something doing a foreach over a key/value mapping and marshalling the key/value pair incorrectly.\n. @ebekker Jinx! Looks like we arrived at the same thing at the same time :-)\nI'm going to bow out of the thread for now since we're into territory I can't directly help with. Feel free to @ me in the future if you need help from the server-side perspective. Good luck!. @wdfstryfe I'm not a letsencrypt-win-simple developer, but I work for Let's Encrypt and saw your issue. I would be happy to check the server-side logs to see if we can ensure this is a Win-Simple issue before involving their developers.\nWhat's the domain name you're having trouble issuing for?. @wdfstryfe Thanks for providing the domain name. I'm able to confirm the problem isn't WinSimple related.  It's a combination of your server's DNS configuration including an IPv6 address that doesn't work and a change on the Let's Encrypt side from May that prefers IPv6 to IPv4.\nwhendarknessfals.org has an AAAA record in addition to its A:\n\n$ dig +short whendarknessfalls.org AAAA\n2001:470:1f11:115f::4\n\nI'm not able to ping this IPv6 address from a test host or connect to port 80 on it:\n\n$ ping6 -c5 2001:470:1f11:115f::4\n--- 2001:470:1f11:115f::4 ping statistics ---\n5 packets transmitted, 0 received, 100% packet loss, time 4031ms\n\nYou will either need to remove the AAAA record or fix the IPv6 connectivity to the server and then you should be able to issue a certificate for the domain without this problem occurring.\nHope that helps!\n. > I had a feeling that was the problem thank you I'll get that corrected.\nGreat! Good luck!\nAs a quick final note: I do my best to keep my :eyes: on the new issues added on a handful of ACME clients but the best place to get help across a wide variety of Let's Encrypt issues is the community forum. It has the highest density of helpers :-) I usually try to encourage folks to post there first and then if it looks like it's a problem with the ACME client to open issues on the respective GitHub page.. > However, it only works over IPV4. In looking at the letsencrypt.org site, they say that the validation now uses IPV6. But IPV6 is not routable to my server. The host company doesn't offer it.\nHi @lanceosaurus, could you remove the AAAA record for your domain? If you know that IPv6 isn't routable then any clients that fetch the AAAA record are going to be have increased latency while waiting for the failed request.. > I just added the record today incase the letsencrypt.org validator needed it to gracefully fail. I tried to create a cert a bunch of times yesterday before I added the record. But I'll remove it now if you think that is best.\nI'm confused - what would there be to fall back from if there wasn't already an AAAA record? IPv6 is only used when there's an AAAA record for the domain. If there wasn't one already and your issuance failed then you had a different problem and maybe added a second problem (broken IPv6) by adding the AAAA record. Does that make sense? It sounds like removing it is the right decision.. @lanceosaurus Removing the AAAA record will definitely fix the IPv6 reachability problem you're reporting in this ticket. It sounds like that problem was introduced when you added the record to try and solve a different problem. I recommend that you remove all of the AAAA records for the domains in question and try to issue again. If you still get an error you should update this ticket with that new error message and I can help troubleshoot. Does that sound feasible? Let's Encrypt should be able to issue for servers in China without problem.. > This is enforced by Let's Encrypt, so make sure to head over to their community to voice your concerns: https://community.letsencrypt.org/latest\nPlease do a search of the community forum first and add to an existing thread. This has come up lots of times before. It's enforced by the baseline requirements that all browser trusted CAs must adhere to for HTTP-based domain validation. The use of .well-known is standardized in RFC5785 and many protocols (not just ACME) will be placing resources in this location.\nI apologize about the difficulty but the decision stems from higher powers than Let's Encrypt or this client.. @InteXX What are the exact domain names you're trying to issue for? The \"DNS name does not have enough labels\" error makes me believe one of the names isn't a valid public domain name and the problem likely isn't with with LEWS.. > I don't think tls-sni-01 scheme supports client certificates - otherwise I'd have used this from the start: I can't see any options for it on any client, unless I've missed it?\nIt does not. There aren't any ACME challenge methods that support client certificates.\n. > @bdaehlie\u00a0we have complied with your wishes, could you in turn please make sure that we are re-listed at\u00a0https://letsencrypt.org/docs/client-options/\u00a0? Preferably at our original position in that list :)\n@WouterTinus Thanks! I submitted a website PR to add win-acme back in the position that LEWS was previously: https://github.com/letsencrypt/website/pull/252\nEdit: This is now merged and deployed :+1: . @JustinWebDev @LBegnaud ACME TLS-SNI-01 was disabled due to a security issue with the design. TLS-ALPN-01 is a new challenge type that also uses port 443 but is otherwise unrelated to TLS-SNI-01. It doesn't have any known problems and remains available.. > I can't see if they are using ACMEv1 \nIt's ~ACME v1. The most immediate give away is that https://api.buypass.com/acme/directory returns only the legacy endpoints (new-cert, new-authz, etc) and doesn't have mandatory v2 endpoints like newOrder.. > Docs: https://tools.ietf.org/html/draft-ietf-acme-tls-alpn-01\nCareful! That's an old draft that has some errors that were subsequently fixed. The current draft at the time of writing is -05:  https://tools.ietf.org/html/draft-ietf-acme-tls-alpn-05. ",
    "OlegKi": "Thank you for the answer. I voted the feature of the usage of CSR, but my main goal would be to use Elliptic Curve TLS Certificates and the usage of custom CSR could be only a workaround if nothing other works.\nI'm not sure what you mean with \"This would have to be added to ACMESharp before it can be added here\". As I know ACMESharp is another project full independent from letsencrypt-win-simple. I tried it too, but without any success. It has a lot of restrictions and the error messages help not. I followed many step by step instructions and videos, but with the same final: I get always an error on start of  Initialize-ACMEVault (\"The term 'Initialize-ACMEVault' is not recognized as the name of a cmdlet,...\"). On the other side letsencrypt-win-simple worked on my Windows 10 64-bit computer without any problems.\nDo you want to use ACMESharp module in letsencrypt-win-simple? Do you plan to use parts C# ACMESharp code in you project? Do you can/plan to allow to create Elliptic Curve Certificate with respect of letsencrypt-win-simple? Do you have any tips (references and so on) how one could create Elliptic Curve TLS certificates with letsencrypt on Windows 10?\n. Thank you very much for the quick response. I will open an issue at ACMESharp. I will try to debug ACMESharp code too and will continue to try making letsencrypt working on Windows by installing different unix subsystems and packages.\nThank you once more for very interesting project letsencrypt-win-simple!\n. ",
    "tomascassidy": "https://github.com/ebekker/ACMESharp/issues/140\n. https://github.com/ebekker/ACMESharp/issues/140\n. Thanks.  I'll try with just the build tools and nuget.exe.\n. Just verified that it builds successfully using a combination of nuget.exe to restore the packages and Microsoft Build Tools 2015 to do the compiling.\n. ",
    "nicgord": "Thanks for the info, to make things easy (or maybe more comlplicated) I have installed IIS and configured a site on an unused port with all the San names. I will then use the automated  process to create the certs and handle the renewal and just grab the certs   from the lets-encrypt directory on a schedule for may alternate purpose. (In this case a nginx reverse proxy)\n. Great idea for this and happy to test when ready.\n. ",
    "GurliGebis": "I'm currently using this, following this guide to get it all working with WAP and centralized ssl: https://forums.servethehome.com/index.php?resources/letsencrypt-a-2012-r2-web-application-proxy.16/\nThe problem is, all the certificates is created using the manual method, so renewal is not working.\nAll it should do, is just renew them, and overwrite the pfx files with the new ones.\n. ",
    "ecc256": "Wanna chime in about a single certificate renew using manual plugin.\nI understand, the LE API renew is for updating multiple certificates at once (using exact the same parameters as when the certificates were initially requested)\nIf we want to renew a single certificate, we essentially need to do the same as initial certificate request, except skip KEY and CSR generation and start with domain validation (i.e. re-validation) and then use old CSR.\nAm I wrong about it?\n. ",
    "ritsute": "Ran into the same problem, had a shock when cert expired. (email was sent to administrator so i never saw it)\nHad to resort to \"letsencrypt.exe --accepttos --manualhost www.example.com --webroot C:\\Apache24\\htdocs\\example\" to force renew.\n. Since this is still not fixed, for Apache manual users, you can add this to your scheduler.\nPlease set frequency to either 30 days or 60 days as there is Rate Limits on the \"renewal\".\nrenewal.bat:\necho n | C:\\letsencrypt\\letsencrypt-win-simple.V1.9.1\\letsencrypt.exe --accepttos --manualhost www.example.com --webroot C:\\Apache24\\htdocs\\\nTips on Task Scheduler:\nRun whether user is logged on or not.\nRun with highest privileges.\nTriggers: Monthly.\nAction: Start a Program.\nProgram/script: C:\\Users\\Username\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\renewal.bat\nAdd arguements: renewal.bat\nStart in: C:\\Users\\Username\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nThis results in an error from trying to read from console, but your cert will be renewed.\nSystem.InvalidOperationException: Cannot read keys when either application does\nnot have a console or when console input has been redirected from a file. Try Console.Read.\n   at System.Console.ReadKey(Boolean intercept)\n   at LetsEncrypt.ACME.Simple.Program.PromptYesNo()\n   at LetsEncrypt.ACME.Simple.Program.Auto(Target binding)\n   at LetsEncrypt.ACME.Simple.Plugin.Auto(Target target)\n   at LetsEncrypt.ACME.Simple.ManualPlugin.PrintMenu()\n   at LetsEncrypt.ACME.Simple.Program.Main(String[] args)\nAlternatively, use https://github.com/Lone-Coder/letsencrypt-win-simple/releases/download/v1.8/letsencrypt-win-simple.v1.8.zip\n. ",
    "DavidRawling": "I am the author of the guide at servethehome.com. I too have been bitten by the manual \"bug\" and I'm working on a way to not have that problem again - I'll update the guide with the new process.\n. ",
    "s-berney": "If you would like to compile yourself, you can add this modification, that allow creation of \"san\" certificate with command line argument :\nAdd this on \"Options.cs\" file :\n[Option(HelpText = \"Alternate's host(s), comma separated\")]\n        public string AltHost { get; set; }\nAnd on file \"/Plugin/ManualPlugin.cs\", replace the \"PrintMenu()\" function by this one :\n```\npublic override void PrintMenu()\n        {\n            if (!String.IsNullOrEmpty(Program.Options.ManualHost))\n            {\n                string[] alternativeNames = null;\n                List sanList = null;\n                if (Program.Options.San && !String.IsNullOrEmpty(Program.Options.AltHost))\n                {\n                    var altInput = Program.Options.AltHost;\n                    alternativeNames = altInput.Split(',');\n                    sanList = new List(alternativeNames);\n                if (sanList == null || sanList.Count <= 100)\n                {\n                    var target = new Target()\n                    {\n                        Host = Program.Options.ManualHost,\n                        WebRootPath = Program.Options.WebRoot,\n                        PluginName = Name,\n                        AlternativeNames = sanList\n                    };\n                    Auto(target);\n                }\n                else\n                {\n                    Console.WriteLine(\n                        $\" You entered too many hosts for a SAN certificate. Let's Encrypt currently has a maximum of 100 alternative names per certificate.\");\n                    Log.Error(\n                        \"You entered too many hosts for a San certificate. Let's Encrypt currently has a maximum of 100 alternative names per certificate.\");\n                }\n            }\n            else\n            {\n                var target = new Target()\n                {\n                    Host = Program.Options.ManualHost,\n                    WebRootPath = Program.Options.WebRoot,\n                    PluginName = Name\n                };\n                Auto(target);\n            }\n\n            /*var target = new Target()\n            {\n                Host = Program.Options.ManualHost,\n                WebRootPath = Program.Options.WebRoot,\n                PluginName = Name\n            };\n            Auto(target);*/\n            Environment.Exit(0);\n        }\n\n        Console.WriteLine(\" M: Generate a certificate manually.\");\n    }\n\n```\nNow you can use this command line :\nletsencrypt.exe --san --manualhost www.mydomain.com --althost www.mydomain.com,mydomain.com,xxx.mydomain.com. If you would like to compile yourself, you can do this modification :\nAdd this on \"Options.cs\" :\n[Option(HelpText = \"Don't ask for update task schedule\")]\npublic bool NoTaskUpdate { get; set; }\nAnd on \"Program.cs\", on function \"public static void ScheduleRenewal(Target target)\" :\nif (!Options.NoTaskUpdate)\n{\n   EnsureTaskScheduler();\n}\nelse\n{\n   Console.WriteLine($\" You must manually schedule the renewal (FYI : no renewal available for manual host)\");\n}\nAnd now you can run commande line with argument :\nletsencrypt.exe --notaskupdate. ",
    "mbeiley": "This pull request worked for me to get around this issue.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/299. @nul800sebastiaan it is wanted by me too.  Anyone running Apache on Windows would benefit from this.. Thanks @nul800sebastiaan .  Could you consider incorporating #299 in v2?  For those of us running Apache on Windows it is necessary to support manual renewals automatically.. ",
    "ArcticCascade": "Thank you. I didn't realise there was a 'closed' section.\nI changed the date, as suggested, but now I'm getting the following error:\n04/13/2016 14:48:19 +10:00 [Error] Error MissingMethodException { Message: \"Method not found: 'ACMESharp.AuthorizeChallenge ACMESharp.AcmeClient.DecodeChallenge(ACMESharp.AuthorizationState, System.String)'.\", Data: [], InnerException: null, TargetSite: ACMESharp.AuthorizationState Authorize(LetsEncrypt.ACME.Simple.Target), StackTrace: \"   at LetsEncrypt.ACME.Simple.Program.Authorize(Target target)\n   at LetsEncrypt.ACME.Simple.Program.Auto(Target binding)\n   at LetsEncrypt.ACME.Simple.Plugin.Auto(Target target)\n   at LetsEncrypt.ACME.Simple.IISPlugin.Renew(Target target)\n   at LetsEncrypt.ACME.Simple.Program.CheckRenewals()\n   at LetsEncrypt.ACME.Simple.Program.Main(String[] args)\", HelpLink: null, Source: \"letsencrypt\", HResult: -2146233069 }\n. I deleted the entire folder and re-downloaded the latest version. The error has now gone.\nThanks for your help.\n. This is related to the problem I was having. My site is running on 443, but the verification is going to port 80.\nOn my server, port 80 is a page with javascript that simply redirects visitors to the real site on 443. To get around the issue, I've simply set up a virtual directory pointing to the .well-known folder on the main server.\n. ",
    "vegitakicker": "Hi and thank you for your reply.\nIt's IIS 8.5. There is another https binding on one of the sites that has SNI indicated. I've just reproduced the issue on another server also running IIS 8.5 where the same problem occurs.\nI'm using win-simple 1.9.0 on Windows Server 2012r2 standard. One of the machines are domain joined, the other is not.\n. > xxxxxx.com uses an invalid security certificate. The certificate is only valid for www.yyyyyyy.com Error code: SSL_ERROR_BAD_CERT_DOMAIN\nThis happens with any arbitrary https://domain.com site, even if the https is not bound or visible in iis. After I've requested and received a certificate it looks like this:\n```\nSSL Certificate bindings:\n\nIP:port                      : 0.0.0.0:443\nCertificate Hash             : redacted\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nIP:port                      : [::]:443\nCertificate Hash             : redacted\nApplication ID               : {ba195980-cd49-458b-9e23-c84ee0adcd75}\nCertificate Store Name       : MY\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : localhost:443\nCertificate Hash             : redacted1\nApplication ID               : {5d89a20c-beab-4389-9447-324788eb944a}\nCertificate Store Name       : MY\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : AdfsTrustedDevices\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : xxxxxxx.com:49443\nCertificate Hash             : redacted\nApplication ID               : {5d89a20c-beab-4389-9447-324788eb944a}\nCertificate Store Name       : MY\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Enabled\n\nHostname:port                : www.xxxxxxx2.com:443\nCertificate Hash             : redacted\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : www.yyyyyyyyy.com:443\nCertificate Hash             : redacted\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : pwstate.zzzzzzzzzz.com:9119\nCertificate Hash             : redacted\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\nHostname:port                : pwstate.zzzzzzzz2.com:443\nCertificate Hash             : redacted\nApplication ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\nCertificate Store Name       : WebHosting\nVerify Client Certificate Revocation : Enabled\nVerify Revocation Using Cached Client Certificate Only : Disabled\nUsage Check                  : Enabled\nRevocation Freshness Time    : 0\nURL Retrieval Timeout        : 0\nCtl Identifier               : (null)\nCtl Store Name               : (null)\nDS Mapper Usage              : Disabled\nNegotiate Client Certificate : Disabled\n\n```\nAnd then before I requested any certificates with win-simple:\n```\nSSL Certificate bindings:\n\nHostname:port                : pwstate.zzzzzzzzzzz.com:443\n   Certificate Hash             : redacted\n   Application ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\n   Certificate Store Name       : My\n   Verify Client Certificate Revocation : Enabled\n   Verify Revocation Using Cached Client Certificate Only : Disabled\n   Usage Check                  : Enabled\n   Revocation Freshness Time    : 0\n   URL Retrieval Timeout        : 0\n   Ctl Identifier               : (null)\n   Ctl Store Name               : (null)\n   DS Mapper Usage              : Disabled\n   Negotiate Client Certificate : Disabled\nHostname:port                : pwstate.zzzzzzzzz2.com:9119\n   Certificate Hash             : redacted\n   Application ID               : {4dc3e181-e14b-4a21-b022-59fc669b0914}\n   Certificate Store Name       : My\n   Verify Client Certificate Revocation : Enabled\n   Verify Revocation Using Cached Client Certificate Only : Disabled\n   Usage Check                  : Enabled\n   Revocation Freshness Time    : 0\n   URL Retrieval Timeout        : 0\n   Ctl Identifier               : (null)\n   Ctl Store Name               : (null)\n   DS Mapper Usage              : Disabled\n   Negotiate Client Certificate : Disabled\n```\n. No errors were thrown, and yes, you are correct, personal and web hosting are the difference, however I also attempted to make a change afterwards in the config that had win-simple put the certificates in the \"personal\" store. My issue is not that other sites receives a certificate too, it is that they start responding on https and tries to use the ssl certificate last requested and installed as opposed to not using one at all.\nAlso have several SSL-certificates that were manually installed, but bought from vendors, and they do not produce said issue.\n. I attempted the steps suggested, unchecking SNI then re-enabling just makes it so that the last one it is performed on will be the one showing up as a bad certificate for https sites not bound.\nI'm unsure about the SAN support thing because I've only attempted requesting certificates for single bindings thus far and then use a rewrite rule for the sites in question to redirect to https.\n. I'll try to rephrase as best I can, rather than posting HTTP bindings for now, hoping to clarify further.\nSetup prior to using let's encrypt win-simple:\n- Multiple sites, none with https bindings except one and it uses SNI.\n- This worked fine, and if you navigated to https://sitewithhttps.com then it works with the correct certificate. Also if navigating to some site that has no https bound to any site like https://nohttpshere.com it would throw one of these:\n```\nSecure Connection Failed\nThe connection to the server was reset while the page was loading.\n```\nSo prior to win-simple it's correct and working fine.\nThen I do complete the following steps to request a certificate:\n1. Run win-simple as administrator\n2. Select a specific site binding for www.example.com (say it's number 18)\n3. It completes correctly, and I specify the task scheduler account for it to use\nNow the following happens.\n- Firstly, the binding is set and the certificate is added to the certificate store.\n- https://www.example.com works splendidly and there's no issue at hand here.\n- However every single site that did not previously have a https binding now suddenly responds with https with an invalid certificate, namely the www.example.com certificate which is only valid for www.example.com.\n- If I add an exception for the sites (all) which throws the error I'm greeted with a 404.\nSo to sum up, no sites had https binding before, suddenly they all respond on https. Nothing else has changed. If I remove the certificate and the https binding and add a blank https binding and remove it again they all stop responding to the https bindings again.\nThat's really the extent of knowledge for me regarding this issue.\n. Thought I'd write back.\nThe auto-renewal hit today, and the issue flared back up. I had previously performed the following to have it work again:\n- Removed https binding\n- Removed the * binding and re-added it\n- Manually re-added said https binding\nNow I had to re-do this in order to make it so that it doesn't mess with other sites that are on SNI.\nFor clarification, the server has only one IP, but multiple sites with SNI.\n. ",
    "kria": "I have the same issue. I compiled and ran the latest code against IIS 8.5.\nBoth letsencrypt --san and letsencrypt --san --keepexisting with the same result.\nSite A: :8080, .443 no SNI with a DigiCert wildcard certificate.\nSite B: domainb.com:80, www.domainb.com:80\nAfter I ran letsencrypt against Site B, that site gets two new SNI bindings with the new letsencrypt certificate as expected.\nThe problem is that the certificate on Site A is replaced with the new letsencrypt certificate, so the site breaks.\n. In my example, the renewals work without resetting the certificate for Site A, if Site B already has HTTPS bindings. But if I delete the HTTPS bindings from Site B and re-run the renewal, Site A also gets the new certificate.\n. It was alluded to above, but to spell it out for those (like me) that compile the source and have this problem. You need to run a Release build, since there's a conditional Press enter to continue in the Debug build, which prevents the task from finishing.\n. @gordonfpanam Have you read #278? There's a Windows bug that you might be affected by.. A workaround is to change WebRootPath in the registry to some static location where you have a .well-known subdirectory and add a .well-known virtual directory pointing there. \n. Unless something has changed, it's in the registry at HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/.. > I set the scheduled task to stop after 1 hour under both Triggers and Settings. That's the only change I made.\nThanks @smcguire1, this little trick fixed it for me too, weirdly enough. :astonished: \n. Yes my certificate got renewed. I never did log the output, so I don't know why the task hanged in the first place, and now I can't make it hang again. \nWhat OS are you running @andi-blafasl? Your problem is that letsencrypt is looking for files in C:\\Users\\Default\\AppData\\Roaming\\.. instead of C:\\Users\\Administrator\\AppData\\Roaming\\ when logged out. I'm thinking KB2968540 might be the problem.\n. The cause may also be that @Tseretyan is compiling it himself and not in release mode, see this line.\n. ",
    "strifejester": "Just ran into this today when trying my first IIS server. I know you mentioned that you might have it figured out but before I thought to look here I setup a powershell script to run 5 minutes before the renewal scheduled task and then another to change it back afterwards. I used this page for the information.\nhttp://www.iis.net/learn/manage/powershell/powershell-snap-in-changing-simple-settings-in-configuration-sections\n. ",
    "Cheekysoft": "Would love this feature. I have a few sites that are HTTPS-only, with no binding to port 80. So this tool doesn't yet offer any help for those sites.\n. ",
    "ErwinCraps": "Same issue over here.\n. ",
    "vovka36": "I agree with all aforesaid. I'd love to see the implementation of this feature in the next release.\n. This method is not suitable for me. By the firewall is only open port 443. 80 port is closed. Do not ask why - it is company policy. So I can not redirect requests from http to https.\n. ",
    "fra-itc": "Strange, with WSRV2012 I was not able to issue the cert with HTTPS flagged as required. After I disabled it, everithing worked fine.\nIn my production environment instead we have different servers for HTTP and HTTPS, so the feature that enable to renew by HTTPS and not HTTP will be very appreciated!\nI'm using the version v1.9.1.1\n. ",
    "DavidMatthewson": "We have the same situation as Vovka36 - only 443 open on the boundary firewall so redirection at the web config level will not work. So an up vote from me too!\n. Great progress \u2013 thanks.\nDavid\n. I would certainly welcome DNS challenge, as we run a number of sites which do not have port 80 open, only 443. Certainly LEWS is IMHE the best Win client around to date so many thanks!\n. Indeed is seems to be so \u2013 many thanks \u2013 off to test!\nBrgds\nDavid\nFrom: Robert (KHobbits) [mailto:notifications@github.com] \nSent: 20 April 2017 18:30\nTo: Lone-Coder/letsencrypt-win-simple\nCc: DavidMatthewson; Comment\nSubject: Re: [Lone-Coder/letsencrypt-win-simple] DNS-01 challenge (#234)\nLooks like this is solved by #395 https://github.com/Lone-Coder/letsencrypt-win-simple/pull/395 \n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub https://github.com/Lone-Coder/letsencrypt-win-simple/issues/234#issuecomment-295825630 , or mute the thread https://github.com/notifications/unsubscribe-auth/AT0Bb5i9nw75QTlCMbTjLTLHJu8vAO_0ks5rx5YagaJpZM4IzfrQ .Image removed by sender.\n. One of the common simple implementations of the DNS Challenge is to place a key in a TXT record field on the DNS (possibly by hand) and then have LE query it. SSLforfee [https://www.sslforfree.com/] does this as do several other systems. Obviously not as good as a fully automated API but perhaps better than having to open prt 80/443 to the Real World if you don't want to...\nJust a thought.... ",
    "Jorgelig": "We have the same situation as Vovka36, what is a workaround?\n. Duplicate: #203 \n. ",
    "kobruleht": "I have also only 443 port enabled in router and use self-signed certificate in IIS 10. How to replace this with letsencrypt certificate ?  Only 443 port is opened in server.. ",
    "benlavender": "Would be great to have this supported, we run a number of IIS servers and wanting to use LE ACME a lot more. . @DumbJoe \nLogically ACME is supposed to be an automation tool, where having to separately and manually contact a third-party for verification purposes is a step away from this automation. . ",
    "DumbJoe": "<rule name=\"HTTP to HTTPS redirect\" enabled=\"true\" stopProcessing=\"true\">\n     <match url=\"(.*)\"/>\n     <conditions>\n          <add input=\"{HTTPS}\" pattern=\"off\" ignoreCase=\"true\"/>\n     </conditions>\n     <action type=\"Redirect\" url=\"https://{HTTP_HOST}/{R:1}\" redirectType=\"Permanent\"/>\n</rule>\nWhere do I add this in?\n\nThanks to @ebekker's merge and fast release to NuGet this features is now enabled in v1.9.7.0-beta10. If this passes your testing, I hope to release the final v1.9.7.0 next week.\n\nI'm guessing it's fully implemented now and validation and certificate generation/renewals will work on https as well as http if it fails on https as a backup?. Oh no! \ud83d\ude31\nA) Wait how so is it different?\nB) So people with dedicated servers and or virtual private servers are ok, just not those who host their web pages on say cpanel or something for really cheap or and rent out webhosting from a provider that just shares resources of one box amongst all webhosters rentees? Then why not just allow it for those who have full on dedicated server boxes and or vps'?. > It's based on SNI (Server Name Indication). Basically the ACME server starts to negotiate a TLS session with your server pretending to be looking for a random hostname. Your server is then expected to offer a bogus self-signed certificate with some specific properties.\nDo at least get certified after all of that?\n\nThat would be the ideal world, but how would one determine that from the side of the ACME server, or the organisation that runs it for that matter?\n\nYou contact them, tell them you're hosting your site on a VPS or dedicated server (or even from your very own house/workplace! ...if you're that cheap... hahaha...) and that you only accept secure connections from wherever, regardless what the reason is.....? Or are they one of those people where they are uncontactable like yahoo...? I once tried to get into contact with yahoo to fix up something with my webmail, but they have no email OR even a phone number to call them up on! Or a postal address for that matter if I decided to mail them my question and problems...... > And how will they be able to verify that you are not lying?\nIs it possible for someone to hack into your VPS or and dedicated server, miraculously overwhelming(Or power through them all) all and any security measures you have put in place to prevent such an action(And assuming you're smart enough not to fall for social engineering attacks), and gain complete full control over it and or locking you out?\nAnd then after all that, they decide to host a website only through a secure connection and only through Lets Encrypt and using your program to create the certificate, assuming you're the only ones that have dabbled into creating a certificate through a secure only connection....?. ...yes, but seriously - if what I said is not possible, then why should they worry about us lying to them?\nIf it IS actually possible, but would take some time to do, then I okay fair enough..... > I thought this would be obvious\nPerhaps to you coz you're smart and I'm dumb, hence my username, haha; I didn't exactly create this username as a joke....ok maybe partly as I had a giggle, hee hee...but still...\nBut if you already have a certificate, renewal through the same process should be easy because they already know who you are...\noh, well in that case you tell your domain registrar you used to register your domain with, to verify it with lets encrypt ...and they can be solid proof you own the domain..... > Doesn't solve the problem of initial validation, not the problem that domains can change owner over time.\nOh yeah, true that...\nAre PTR records or the likes any good?. ....yes you're right..... >  Rule 1 redirect anything not an ACME challenge to same URL in https \n\n\n\n\n\n\n\n\nI'm guessing this is for IIS, and I don't use IIS, I use XAMPP.....and I don't see an equivalent rule example in any of the conf files to know where to insert this in.... Oh thanks, it works!\nHow do I add another directory into the exclude list? I tried copying the same line 3 to line 4 and original line 4 to line 5, but instead of .well-known I put 'kf' but the apache server seems to fail to run with this setting, apparently it doesn't like lowercase letters...or at least lowercase starting letters... I tried capitalizing k and f to KF and runs, but http access still redirects to https...\nAlso, while we're on the subject, how do I redirect any and all http(s)://www access to https:// and of course excluding anything that looks for /.well-known/ and other custom directories so that they don't get a blank page or a page not found error?. Sorry for late reply, been busy the past week...\nYour attempt doesn't work... It just globally redirects all traffic to https regardless the above conditions of accessing .well-known or and the others or not....\nI tried another method which invokes Redirect command instead of rewrite, and unless I did it incorrectly, that doesn't support multiple conditions....... \nWhy do you need to backward slash the period and not the other(s)?. ..should have a FAQ section in the wiki answering common questions so people don't have to keep asking the same questions over.....or searching through old posts to find answers and or necroing them in hopes there is either an updated reply or an actual reply to the question if it's not already been answered.... I'm guessing it was because of this: https://github.com/PKISharp/win-acme/pull/110 so new version will delete the folder directory upon successful renewals/creation..... > Thanks, I couldn't directly find anything on this subject! In any case, with the correct configuration this should not be a concern for anyone.\nWhat is this correct configuration you speak of?. I get \"[EROR] Unknown argument: manual\" after 2nd step...\n\nLet's Encrypt Simple Windows Client 198.4.6605.15190\n Let's Encrypt\nERROR(S):\n  Option 'manual' is unknown.\n  --baseuri                   (Default: https://acme-v01.api.letsencrypt.org/) The address of the ACME server to use.\n  --test                      Overrides --baseuri setting to https://acme-staging.api.letsencrypt.org/ and enables other testing behaviours in the\n                              program which may help with troubleshooting.\n  --verbose                   Print additional log messages to console for troubleshooting.\n  --renew                     Check for scheduled renewals.\n  --forcerenewal              Force renewal on all scheduled certificates  when used together with --renew. Otherwise just bypasses the certificate\n                              cache on new certificate requests.\n  --plugin                    Specify which target plugin to run, bypassing the main menu and triggering unattended mode.\n  --siteid                    [--plugin iissite|iissites|iisbinding] Specify identifier of the site that the plugin should create the target from.\n                              For the iissites plugin this may be a comma separated list.\n  --excludebindings           [--plugin iissite|iissites] Exclude bindings from being included in the certificate. This may be a comma separated\n                              list.\n  --hidehttps                 Hide sites that have existing https bindings.\n  --manualhost                [--plugin manual|iisbinding] A host name to manually get a certificate for. For the manual plugin this may be a comma\n                              separated list.\n  --manualtargetisiis         [--plugin manual] Is the target of the manual host an IIS website?\n  --validation                Specify which validation plugin to run. If none is specified, FileSystem validation will be chosen as the default.\n  --validationmode            (Default: http-01) Specify which validation mode to use.\n  --webroot                   [--validationmode http-01 --validation filesystem] A web root for the manual host name for validation.\n  --validationsiteid          [--validationmode http-01 --validation filesystem|iis] Specify site to use for handling validation requests. Defaults\n                              to --siteid.\n  --warmup                    [--validationmode http-01] Warm up websites before attempting HTTP authorization.\n  --username                  [--validationmode http-01 --validation ftp|webdav] Username for ftp(s)/WebDav server.\n  --password                  [--validationmode http-01 --validation ftp|webdav] Password for ftp(s)/WebDav server.\n  --azuretenantid             [--validationmode dns-01 --validation azure] Tenant ID to login into Microsoft Azure.\n  --azureclientid             [--validationmode dns-01 --validation azure] Client ID to login into Microsoft Azure.\n  --azuresecret               [--validationmode dns-01 --validation azure] Secret to login into Microsoft Azure.\n  --azuresubscriptionid       [--validationmode dns-01 --validation azure] Subscription ID to login into Microsoft Azure DNS.\n  --azureresourcegroupname    [--validationmode dns-01 --validation azure] The name of the resource group within Microsoft Azure DNS.\n  --dnscreatescript           [--validationmode dns-01 --validation dnsscript] Path to script to create TXT record. Parameters passed are the host\n                              name, record name and desired content.\n  --dnsdeletescript           [--validationmode dns-01 --validation dnsscript] Path to script to remove TXT record. Parameters passed are the host\n                              name and record name.\n  --keepexisting              While renewing, do not remove the previous certificate.\n  --centralsslstore           When using this setting, certificate files are stored to the CCS and IIS bindings are configured to reflect that.\n  --certificatestore          This setting can be used to target a specific Certificate Store for a renewal.\n  --installation              Specify which installation plugins to use. This may be a comma separated list.\n  --installationsiteid        [--installation iis] Specify site to install new bindings to. Defaults to --siteid.\n  --sslport                   (Default: 443) [--installation iis] Port to use for creating new HTTPS bindings.\n  --script                    [--installation manual] Path to script to run after retrieving the certificate.\n  --scriptparameters          [--installation manual] Parameters for the script to run after retrieving the certificate.\n  --closeonfinish             Close the application when complete. Overrules behaviour of --test, otherwise not needed.\n  --notaskscheduler           Do not create (or offer to update) the scheduled task.\n  --usedefaulttaskuser        Avoid the question about specifying the task scheduler user, as such defaulting to the SYSTEM account.\n  --cancel                    Cancels existing scheduled renewal as specified by the target parameters.\n  --accepttos                 Accept the ACME terms of service.\n  --emailaddress              Email address to use by ACME for renewal fail notices.\n  --help                      Display this help screen.\n  --version                   Display version information.\n [EROR] Unknown argument: manual. The latest version - 1.9.8.4...\n\nAnd yes I did go \"letsencrypt --plugin manual --manual wwww.domainname.com --webroot C:\\htdocs\\www\\mywebsiteroot\" substituting \"wwww.domainname.com\" for the actual domain name I'm trying to certify and \"C:\\htdocs\\www\\mywebsiteroot\" to the directory htdocs is located at.. gasps\nIT WORKS! THANKYOU MY GOOD MAN!\nThe OP needs to update his thread post to reflect the new changes because I was using the outdated method which obviously now doesn't work in the this recent version......\nOk, since this is now all new stuff, what do I need to do next for XAMPP to detect my new certificate so I get a nice solid green padlock across all web browsers that access my web page? Same process as it hasn't changed or is the procedure now different?. Oh cool thanks...\nAhh so my certificates are apparently saved @ C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org rather than under appdata...\nAhh, gotta watch out for those forward slashes on the 2nd line for SITEROOT.....\nInteresting why the edits must go under: Apache\\conf\\extra\\httpd-vhosts.conf and not Apache24\\conf\\extra\\httpd-ssl.conf because I thought that's where all the HTTPS configuration settings goes in...? ...at least if using XAMPP's built-in self-signed certificate generator.....\nuh, I'm getting a:\n\nObject not found!\nThe requested URL was not found on this server. If you entered the URL manually please check your spelling and try again.\nIf you think this is a server error, please contact the webmaster.\nError 404\ndomain.com\nApache/2.4.25 (Win32) OpenSSL/1.0.2j PHP/5.6.30 \n\nBut green padlock present on all firefox, opera and ie and doesn't warn against it being \"untrustworthy\" because it's self-signed so it works I guess....just that the contents of the web page is not shown....and yes my htdocs directory is correct as well...\nOh just noticed the first line for CERTROOT is also meant to be forward slashed too...... I also uncommented NameVirtualHost *:443 if that helps? But still nothing.... ....http works, just https does not.....and the self signed version worked before this so something here must have borked it in the manual settings you provided if it's not to do with the certificate generation as you said....\n..but sure, have a look at my httd.conf: https://pastebin.com/F1HCC7yJ and httpd-vhosts.conf: https://pastebin.com/K2LJA7WP both paste expiring within the next 24 hrs..... Here's your httpd-ssl.conf contents: https://pastebin.com/wxNBq3AD \u263a. no, that didn't work....\u2639. > Have you restarted Apache after changes?\nI have and have done so again just to make sure....\n\nAnd try comment string Include conf/extra/httpd-ssl.conf in httpd.conf\n\nNow gives me \"The connect has timed out\" error on firefox...\nI tried moving over the info from vhosts.conf to ssl.conf in hopes that would do anything, but still gives me the same \"Object not found\" error again.....\nSo it appears \"Include conf/extra/httpd-ssl.conf\" mustn't be commented out or else you get that timed out connection error unless there's something else that needs to be added....that you forgot to include in your instructions for apache users...? ...or could just be me......but you've already viewed my config files and everything seems to be in order, right; just that it isn't working for me for some reason, mmmm?\n\nIf you wonder about the difference, I'm using standalone apache from apache haus, not xampp or any other mix mash. \n\nShould be the same unless the creators of XAMPP did something to it so that it's now different from a stock apache install even if you unselect all the other unnecessary things when installing XAMPP(which is what I think I did as I had no use for filezilla, php, perl or mercury...I just wanted a gui simpleton installer and runner...lol)?. Yay got it fixed: https://stackoverflow.com/questions/5801425/enabling-ssl-with-xampp Apparently with mine, I didn't need the domain name in the document root.....and just left it as \"DocumentRoot \"${SITEROOT}\"\" And when you reboot the server by clicking on the stop and start buttons in the XAMPP control panel, and then click refresh in your browser, no more 404 object not found error!\nAlso, after reading some more, I can see why you forward slash instead of back slash; because backslash in apache is equivalent to escaping the characters so if you wanted to use backslash for directory, you would have to double up, so C:\\apache\\htdocs for example... Also, while we're on the subject, I think XAMPP fixed it so you don't have to double slash to escape the escape key, so you can do C:\\apache\\htdocs and boot the server and no problems....or atleast that's what's happening to me.\n\u263a\nThanks for helping tschallacka and Ivn78!\nNow I can finally rest.....oh yeah how does renewal work? Do I just leave the cmd window open or I can quit out of it or what? And I still need that .well-known folder under htdocs? Because....I kinda deleted it.....hahahaha. Sure, I just made some edits on the main page: https://github.com/Lone-Coder/win-acme/wiki/Apache-2.4-Basic-usage - check it out! \u263a Also incorporated the rest of the thread page's topic steps as I believe that was supposed to have been there but got removed or something(because that's suppose to be this entire thread and all its posts/comments summed up in one page in that wiki right as it was rather odd the initial steps to acquire the certificate file wasn't present...?)? -And also fixed up your 2nd step CLi command to work, thanks to @Ivn78. Besides that and to pretty up things, everything else is the same as is untouched.\nI actually thought that only the creator(s) or mods/admins could create/edit wiki pages, didn't think it was possible for a peon like myself to do one up.....haha....\nAlso, I'm still not quite clear on the renewal process, do I just retype the same command but with --renew parameter included (and so I can safely close the cmd prompt window) or do I just leave the cmd prompt hanging as it automates the renewal for me when the time comes without me ever typing a thing? Or maybe I don't even need it running because it's already running in the background as a service?. Yes, yes it is, ok I've edited it and now should look more like a recent release version. \u263a\nAs for the renewal, after reading the sample output I provided, it creates a task schedule which would run by itself when the time comes so I guess it's ok to close the prompt now let it be as it'll do it itself automatically.. Lies! It does not auto-renew correctly or fails to if this feature of yours does work, not sure which though; had to do: https://i.imgur.com/Z6ru4Rq.png and then restart the Apache server for the new certificate to apply!\nI only just found out after a friend of mine notified me that my website was using an outdated SSL certificate which expired a month or two ago....I guess I trusted your program too much to have left it by itself to do its job......looks like it still needs more micro-management now after this....hah....\nNext renewal schedule is supposedly on the 12th of August 2018 @ 2:37:27pm, so I guess I will have to write this down so I don't forget......\nAlso why is the date backwards? Am I able to change the format from YYYY/M/D to D/M/YYYY as that's how I read the date over here? Because it gets confusing at first......and don't get me started on those dates that go YYYY/DD/MM or MM/DD/YYYY........\n'\n. Oh....\nIs there a way to just re-apply the certificate without restarting the server?. @webprofusion-chrisc I see...\nI use XAMPP so I just click the stop (pause for a couple of seconds to make sure the process is actually killed/stopped) and start buttons on the control panel menu window to restart the Apache server..... @webprofusion-chrisc  Ah ok, it seem like you know your way around the apache system, great! Coz I'm a noob(or newb is probably the better technical term) and just started(well technically started a few months ago) hosting my own server.....hahahaha....\nAnd I just noticed you're the creator of this wonderful little program here! Be prepared for some noobish/newbish questions.....\nLets see where I can start....\n1) Does your program auto-create the \".well-known\" folder along with a random alphanumerical folder name inside that when it renews the certificate and then deletes that as soon as it's done renewal or is that only applicable for the first time when you create a new certificate and then later on when you renewal said certificate, there is no need to have a valid \".well-known\" folder under your root site directory and inside that the same alphanumerical folder name? \n2) If the above question is no it no longer requires it, then it won't matter if I were to use a rule to auto-redirect any and all traffic to the unsecure site to a secured site globally, will it?\n3) Assuming question 2) is that it won't affect the auto(or even manual)-renewal process, how do I create a working auto-redirect traffic to the secure site when anyone accesses the unsecure version of it, with the exception of one folder, say a folder named \"KF1_Redirect\"? I think I created another issue on this or hijacked another thread that had relevance to my issue at hand but the answers I got never worked for me and I tried looking the manual for apache and it kinda looked like I was reading a thesis statement but overcame it and tried the different methods that said should work but for me for some reason didn't.... I'll see if I can find that issue thread in question in my emails......since I can't look it up through github as don't seem to track what threads/issue threads you have commented/replied on.... @webprofusion-chrisc\nSorry for late reply, I kinda forgot about this...\nOh yeah, I think I remember you, I used it once only to find out it doesn't work on Apache servers.....and then I think it was William or someone else suggested I this out and sourced that it works for apache server and it does! Except it's commandline without the pretty GUI Certify has, which was the selling point that got me to it...hahahaha....\nQ1) Well I deleted that folder so unless it re-creates and deletes it automatically after it renews the certificate, it apparently doesn't require it.....\nQ2) Same as above, I deleted the file and folder and should be reachable since the directory doesn't exist and will give a 404 if visited....but renewal still works regardless, aparently...\nQ3) Well I just had a friend who suggested I use Apache and I also wanted something simple and noob friendly and he suggested using XAMPP....and yeah, and now I'm stuck with Apache....forever ...hahahaha...\nThank I'll look into that.... ",
    "jonthegiant": "Hi, thanks for the reply. I went ahead and applied those reg settings and rebooted, but unfortunately \nI'm still crashing. \nFor reference:\n\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 2.0]\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 2.0\\Client]\n\"DisabledByDefault\"=dword:00000001\n\"Enabled\"=dword:00000000\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 2.0\\Server]\n\"DisabledByDefault\"=dword:00000001\n\"Enabled\"=dword:00000000\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0]\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0\\Client]\n\"DisabledByDefault\"=dword:00000001\n\"Enabled\"=dword:00000000\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0\\Server]\n\"DisabledByDefault\"=dword:00000001\n\"Enabled\"=dword:00000000\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0]\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Client]\n\"Enabled\"=dword:00000001\n\"DisabledByDefault\"=dword:00000000\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Server]\n\"DisabledByDefault\"=dword:00000000\n\"Enabled\"=dword:00000001\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1]\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\\Client]\n\"Enabled\"=dword:00000001\n\"DisabledByDefault\"=dword:00000000\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\\Server]\n\"Enabled\"=dword:00000001\n\"DisabledByDefault\"=dword:00000000\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2]\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Client]\n\"Enabled\"=dword:00000001\n\"DisabledByDefault\"=dword:00000000\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Server]\n\"Enabled\"=dword:00000001\n\"DisabledByDefault\"=dword:00000000\n. https://acme-v01.api.letsencrypt.org/directory resolves in chrome on the host machine.\nHost machine is a VPS, so it's most likely behind the hosting company's firewall.\n. Taking a look at the machines event log I see a swamp of Schannel errors.\nA fatal error occurred while creating an SSL client credential. The internal error state is 10010.\n\nThey're generated each time I run the utility, so I'll look into this first.\nEdit:\n\n\"This behavior is caused by the SMTP service processing an incoming EHLO command if no certificate is assigned to an SMTP site.\"\n\nhttps://technet.microsoft.com/en-us/library/dn786445.aspx#BKMK_36871\nSo I'm generally confused here, I don't see the correlation between these Schannel errors and ACMESharps functionality.\n. Server in question is being wiped, out of my control, sorry to waste your time guys. Thanks for your help @rkerber \n. ",
    "jhorning": "Does it list the domain you are connected to in the Subject Alternative Name field in the certificate?\n. It will vary by browser but right click on the lock icon and view connection details. View the certificate and look at the details tab. Scroll down and click on the Subject Alternative Name entry. You should see a list of sites it is valid for.\n\n. Did you select s (for all sites) when prompted?\n. \"A\" should get individual certificates for each site. Since you were running it with the san option, I was assuming you wanted all of them on one certificate.\n. ",
    "bLightZP": "I'm not sure where to look, can you be more specific?\n. Under \"site bindings\" I can open the https entries and there it lists the certificate.\nHowever, if I change the certificate for one site, it appears to change it for all sites with a warning message:\nAt least one other site is using the same HTTPS binding and the binding is configured with a different certificate. Are you sure that you want to reuse this HTTPS binding and reassign the other site or sites to use the new certificate?\n. That field shows the other site's domain, not the site I created it for.\nIt seems that only the last certificate issued works.\nWhat I'm trying to do is have https support for multiple domains under one IP using IIS 7.5.\nSample domains list:\nmysite.com\nwww.mysite.com\ndl.mysite.com\nmyothersite.com\nwww.myothersite.com\nversion.checkingstuff.org\n. Appologies, I guess I missed that, I pressed \"A\" for all and even did them manually. I guess I missed the \"S\".\n. ",
    "jslatts": "My understanding from reading the docs is that the validation flag is simply there to alert devs to possible issues with their configuration and it actually has no impact on the behavior of IIS. I'll get the PR going today.\n. ",
    "octogondude": "Thank you, i have done so:\nhttps://github.com/ebekker/ACMESharp/issues/126\n. ",
    "blakeduffey": "Is anyone aware of any updated guidance on this issue?. oh yes - painfully aware.  Sadly, it is a compliance issue for us.\nThanks much.  . ",
    "rickster2": "Thanks, good sir.  That did the trick and I have successfully followed the rest of the guide.  I appreciate the help.\n. ",
    "zyo2012": "I'm also having a server on Windows Server 2008 with no SNI support and the tool doesn't work, after renewal the certificate set is bind to a name and this feature is not working.\n. I'm looking for using the wildcard when available in 2018.  When the renews occurred, it should update all sites that use the wildcards.. ",
    "programcsharp": "Just made a PR for this -- #947 -- pretty simple and naive as I am not familiar with the codebase. I basically followed SSLPort and added SSLIPAddress everywhere the port is used.\nWorks on my server \ud83d\ude01 \nHappy to make adjustments if needed.. The configuration is in %programdata%\\letsencrypt-win-simple. I haven't tried this, but what if you copy that over to the new machine and then do a renew?. How many certificates is it? If it's just a couple, just do over the request from scratch steps on the new server -- that'll grab you new certs and set up the renewal task etc.. OK, sweet! Easiest PR I've ever done \ud83d\ude01 \nAdded the check to BaseRenewalService.Load.. Yes. I just tweaked the host to make it invalid (get NXDOMAIN on lookup). Here's the log from my service calling letsencrypt with identifying info removed -- it wasn't foo.com obviously.\nI figured if something as simple as certificate creation fail was returning 0, then probably all error areas need to set an exit code. Or maybe there are some specific fail points like create cert fail that can do it? I don't know the codebase well enough to know where the chokepoints are.\n2018-12-02 22:06:07:520 letsencrypt.exe --plugin manual --manualhost xxxwww.foo.com,foo.com --webroot c:\\afolder --centralsslstore c:\\otherfolder --validation selfhosting --installation iis --installationsiteid 94 --sslipaddress 0.0.0.0\n2018-12-02 22:06:08:225 letsencrypt: \n2018-12-02 22:06:08:241 letsencrypt:  [INFO] A Simple ACME Client for Windows (WACS)\n2018-12-02 22:06:08:272 letsencrypt:  [INFO] Software version 193.5.6861.10318 (RELEASE)\n2018-12-02 22:06:08:272 letsencrypt:  [INFO] IIS version 10.0\n2018-12-02 22:06:08:288 letsencrypt:  [INFO] ACME server https://acme-v01.api.letsencrypt.org/\n2018-12-02 22:06:08:288 letsencrypt:  [INFO] Please report issues at https://github.com/PKISharp/win-acme\n2018-12-02 22:06:08:304 letsencrypt: \n2018-12-02 22:06:08:319 letsencrypt:  [INFO] Running in Unattended mode\n2018-12-02 22:06:08:335 letsencrypt:  [INFO] Plugin Manual generated target [Manual] [2 bindings - xxxwww.foo.com, ...]\n2018-12-02 22:06:08:975 letsencrypt:  [INFO] Authorize identifier: xxxwww.foo.com\n2018-12-02 22:06:09:493 letsencrypt:  [INFO] Authorizing xxxwww.foo.com using http-01 validation (SelfHosting)\n2018-12-02 22:06:09:524 letsencrypt:  [INFO] Answer should now be browsable at http://xxxwww.foo.com/.well-known/acme-challenge/ (removed)\n2018-12-02 22:06:14:122 letsencrypt:  [EROR] Authorization result: invalid\n2018-12-02 22:06:14:137 letsencrypt:  [INFO] Authorize identifier: foo.com\n2018-12-02 22:06:14:656 letsencrypt:  [INFO] Cached authorization result: valid\n2018-12-02 22:06:14:671 letsencrypt:  [EROR] ACME server reported:\n2018-12-02 22:06:14:671 letsencrypt:  [EROR] [type] urn:acme:error:dns\n2018-12-02 22:06:14:687 letsencrypt:  [EROR] [detail] DNS problem: NXDOMAIN looking up A for xxxwww.foo.com\n2018-12-02 22:06:14:687 letsencrypt:  [EROR] [status] 400\n2018-12-02 22:06:14:702 letsencrypt:  [EROR] Create certificate failed\n2018-12-02 22:06:14:718 letsencrypt: \n2018-12-02 22:06:14:718 exit code 0. Looks like a win! Will test once the new build is released.. ",
    "Duetting": "Site Information from Firefox says \nType: text/json\nEncoding: windows-1252\n. No. On two different days at least 10 times. And it also didn't work with two other other sites on the same iis server, where i was successful a few weeks ago.\nShould the file be actually in json format? As it only contains a long number with I think three dashes in between.\n. I just tested using the old 1.7 version, and had success in creating a new certificate.\n. ",
    "vieira": "Hello, we are also experiencing the same issue. 1.7 works, 1.8/1.9 does not. Replacing the function AuthorizationState Authorize(Target target) (Program.cs) with the one from 1.7 makes 1.9 work.\nOutput from 1.9 (not working):\nAuthorizing Identifier www.comiteparalimpicoportugal.pt Using Challenge Type http-01\nPosting to https://acme-v01.api.letsencrypt.org/acme/new-authz\nPayload begin\n{\n  \"header\": {\n    \"alg\": \"RS256\",\n    \"jwk\": {\n      \"e\": \"AQAB\",\n      \"kty\": \"RSA\",\n      \"n\": \"po2Rrgm9W_kgT0Vo_z1CbkJwdm_APCNbQwhmXHJrakn9XXqdl2eV45_PYr4qikih6ROthimZPh-0l2eaowFeyGGyeWyLvzg5g4XFNjO5kH3l\n3_GYRXkJyQ8GjZD5jhkWWxBjOHT2glyZUY_trY4s61cdl8lpY1YDQbPL3IHKFPb7cjJqyEaB0LaMCdPA_fpBAQmKZey81k-Q3E3mOfwOYLn1EMBN4vrmeiX_\nrfGPbaHbz35hv0MWM-Xs3bkHnyZMr49c6iXvB9im3J9sZgtHTjjBOMEm-IXWarE7A5zdHmbT4Z_O5bIPqoa1FEUeI00pWnaDE-fhRKEqbdl0kEeCgw\"\n    }\n  },\n  \"protected\": \"eyJub25jZSI6InBwQVc5akJhU3VCUmJHWWg0c0FwMXo0MnVsa0NCSTIwNDZrRkRkR1ROZjQifQ\",\n  \"payload\": \"eyJJZGVudGlmaWVyIjp7IlR5cGUiOiJkbnMiLCJWYWx1ZSI6Ind3dy5jb21pdGVwYXJhbGltcGljb3BvcnR1Z2FsLnB0In0sIlJlc291cm\nNlIjoibmV3LWF1dGh6In0\",\n  \"signature\": \"DscsqLiJ1wqRA-CEwzlIvGzqoyQXo_ZHLXUtFCIb-XfcU5YMTLQXNeP0sk7OnXEP3guuwzUXzVyOlbAGH89W6FLtS-Kicwmko2Yq1ko0\nptr9nMSqrTR5PWGh--wSCV1aCHV4wafvVtidQR2lepbwip-8TDfljAJqd7meYoCoFe4Dt0G-1-kmraIme-6ZsLJyWBhplZj8fAm6AyY_JSMoWZ6ZV-ugpGFx\nDyJgyDZdiXq6i054Rl3xQ4puH2tJyp9zGn9HGSKWmhqBFve9PKzvD01_dgKSheMKqCTlaVW5jtGnPWYm5MdRqj03N3nF5QW3NA7EtHh41LoaECnIRz6gqA\"\n}\nPayload end\n Writing challenge answer to C:\\inetpub\\wwwroot\\wss\\VirtualDirectories\\80\\.well-known/acme-challenge/aPDynAJRFkYufQrf26F\npUOIGiI2Qj4XYU2rTySsFNr4\n Writing web.config to add extensionless mime type to C:\\inetpub\\wwwroot\\wss\\VirtualDirectories\\80\\.well-known\\acme-chal\nlenge\\web.config\n Answer should now be browsable at http://www.comiteparalimpicoportugal.pt/.well-known/acme-challenge/aPDynAJRFkYufQrf26\nFpUOIGiI2Qj4XYU2rTySsFNr4\n Submitting answer\nPosting to https://acme-v01.api.letsencrypt.org/acme/challenge/9fVvbjMACfqGwp6TkWzN5C-_kFQfX4nnMtt53aYNSbk/101742523\nPayload begin\n{\n  \"header\": {\n    \"alg\": \"RS256\",\n    \"jwk\": {\n      \"e\": \"AQAB\",\n      \"kty\": \"RSA\",\n      \"n\": \"po2Rrgm9W_kgT0Vo_z1CbkJwdm_APCNbQwhmXHJrakn9XXqdl2eV45_PYr4qikih6ROthimZPh-0l2eaowFeyGGyeWyLvzg5g4XFNjO5kH3l\n3_GYRXkJyQ8GjZD5jhkWWxBjOHT2glyZUY_trY4s61cdl8lpY1YDQbPL3IHKFPb7cjJqyEaB0LaMCdPA_fpBAQmKZey81k-Q3E3mOfwOYLn1EMBN4vrmeiX_\nrfGPbaHbz35hv0MWM-Xs3bkHnyZMr49c6iXvB9im3J9sZgtHTjjBOMEm-IXWarE7A5zdHmbT4Z_O5bIPqoa1FEUeI00pWnaDE-fhRKEqbdl0kEeCgw\"\n    }\n  },\n  \"protected\": \"eyJub25jZSI6IldsbFcxZ0hfTi1GT1JJVjZZRlNtbDZmd2Zjc21kLXBGemREOWk4VUM2NUkifQ\",\n  \"payload\": \"W3siS2V5IjoiUmVzb3VyY2UiLCJWYWx1ZSI6ImNoYWxsZW5nZSJ9LHsiS2V5IjoiS2V5QXV0aG9yaXphdGlvbiIsIlZhbHVlIjoiYVBEeW\n5BSlJGa1l1ZlFyZjI2RnBVT0lHaUkyUWo0WFlVMnJUeVNzRk5yNC5MSFpoczVmVTVxcy1GY1JFZHNUU21mNTlZbktPV1lwRExiQVBtckpIZTRvIn1d\",\n  \"signature\": \"JmgzLtt66Roh6HvWbi7NHGomy1RWe7yhnotlAPlty8siXErVQqmOBiUsQeF-X6WFcxo76--XJssaqGkxCdPrJLdc7cqVG0FXlCar6U_u\n1XILoUw5jGBlzlVPbLFkUIE2frY4z8MYToiEYVVREYu3r4xFQpYn4JiODWin1WQns_swpcNPt_KSAV98mrO_R4dqvleTd-NdRPIUCLVTrTMqpFeH6LsxHPGE\nwEiOCiWB7eFlnjcTkXhqWK7XdZ7R9fubV8JOcCBg7TEJH3VOs_MAFWRfEgBSS0Mds8ctlCdMm2TRZg1U7ErzQrDs_Q5BzLWUjm6P6uEXP20PGjYlNDUwig\"\n}\nPayload end\nUnexpected error\n +Response from server:\n        + Code: BadRequest\n        + Content: {\n  \"type\": \"urn:acme:error:malformed\",\n  \"detail\": \"Request payload did not parse as JSON\",\n  \"status\": 400\n}\nACME Server Returned:\n{\n  \"type\": \"urn:acme:error:malformed\",\n  \"detail\": \"Request payload did not parse as JSON\",\n  \"status\": 400\n}\nPress enter to continue.\nOutput from 1.7 (working):\n```\nPS C:\\letsencrypt-win-simple.vcheat> .\\letsencrypt.exe\nLet's Encrypt (Simple Windows ACME Client)\nRenewal Period: 60\nCertificate Store: WebHosting\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: C:\\Users\\VILT\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nCertificate Folder: C:\\Users\\VILT\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nLoading Signer from C:\\Users\\VILT\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\nGetting AcmeServerDirectory\nLoading Registration from C:\\Users\\VILT\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registr\nation\nScanning IIS Site Bindings for Hosts\n 1: IIS www.comiteparalimpicoportugal.pt (C:\\inetpub\\wwwroot\\wss\\VirtualDirectories\\80)\nW: Generate a certificate via WebDav and install it manually.\n F: Generate a certificate via FTP/ FTPS and install it manually.\n M: Generate a certificate manually.\n A: Get certificates for all hosts\n Q: Quit\nWhich host do you want to get a certificate for: 1\nAuthorizing Identifier www.comiteparalimpicoportugal.pt Using Challenge Type http-01\nPosting to https://acme-v01.api.letsencrypt.org/acme/new-authz\nPayload begin\n{\n  \"header\": {\n    \"alg\": \"RS256\",\n    \"jwk\": {\n      \"e\": \"AQAB\",\n      \"kty\": \"RSA\",\n      \"n\": \"po2Rrgm9W_kgT0Vo_z1CbkJwdm_APCNbQwhmXHJrakn9XXqdl2eV45_PYr4qikih6ROthimZPh-0l2eaowFeyGGyeWyLvzg5g4XFNjO5kH3l\n3_GYRXkJyQ8GjZD5jhkWWxBjOHT2glyZUY_trY4s61cdl8lpY1YDQbPL3IHKFPb7cjJqyEaB0LaMCdPA_fpBAQmKZey81k-Q3E3mOfwOYLn1EMBN4vrmeiX_\nrfGPbaHbz35hv0MWM-Xs3bkHnyZMr49c6iXvB9im3J9sZgtHTjjBOMEm-IXWarE7A5zdHmbT4Z_O5bIPqoa1FEUeI00pWnaDE-fhRKEqbdl0kEeCgw\"\n    }\n  },\n  \"protected\": \"eyJub25jZSI6IlVKSXk5Nkk4bEh1OGxja2FRLWZXRWpKekV4eWdIMzZydmNTbGxFUEZ6ZkUifQ\",\n  \"payload\": \"eyJJZGVudGlmaWVyIjp7IlR5cGUiOiJkbnMiLCJWYWx1ZSI6Ind3dy5jb21pdGVwYXJhbGltcGljb3BvcnR1Z2FsLnB0In0sIlJlc291cm\nNlIjoibmV3LWF1dGh6In0\",\n  \"signature\": \"FrH82LFtF2OGqEhy9MwHhKHO37nP95QT2vmfmlhtc-jNG8Fg9mCD4mVjvGvfOm9MeAgg0OfEqFdMZX5CeO-iAXpklY7sgKtBHhE05q0q\nRH0wJu3ApcKXSzzw5WahPOEp-j4ex0qWsmlHXvnbD0qtFpUWcEwtng5arQLesDSApDBdJIoXSpldAZuas1jkKbIN6BGOp0ecQ94nDioCRN0qN-rBgJpukxmc\nCmeX96iX9kbmWB5X0rD_zkMqusXiFOXoONB-d_NUV-21e8tuehyFW8v51cparoNatCAboO0mZo9mXw2aJdCVLPHedIsVFq0k4VpMmHhzfv0mWSPQgPXwPA\"\n}\nPayload end\n Writing challenge answer to C:\\inetpub\\wwwroot\\wss\\VirtualDirectories\\80.well-known/acme-challenge/jFuyiMkkiiFsmYoKPTC\nqXq-3FHGtlTu4gyrtz5_Aygo\n Writing web.config to add extensionless mime type to C:\\inetpub\\wwwroot\\wss\\VirtualDirectories\\80.well-known\\acme-chal\nlenge\\web.config\n Answer should now be browsable at http://www.comiteparalimpicoportugal.pt/.well-known/acme-challenge/jFuyiMkkiiFsmYoKPT\nCqXq-3FHGtlTu4gyrtz5_Aygo\n Submitting answer\nPosting to https://acme-v01.api.letsencrypt.org/acme/challenge/fu5GCMMkEiKuUH9VtLbkgIU9GMUJIA0PbxUiZuE-tbY/101827441\nPayload begin\n{\n  \"header\": {\n    \"alg\": \"RS256\",\n    \"jwk\": {\n      \"e\": \"AQAB\",\n      \"kty\": \"RSA\",\n      \"n\": \"po2Rrgm9W_kgT0Vo_z1CbkJwdm_APCNbQwhmXHJrakn9XXqdl2eV45_PYr4qikih6ROthimZPh-0l2eaowFeyGGyeWyLvzg5g4XFNjO5kH3l\n3_GYRXkJyQ8GjZD5jhkWWxBjOHT2glyZUY_trY4s61cdl8lpY1YDQbPL3IHKFPb7cjJqyEaB0LaMCdPA_fpBAQmKZey81k-Q3E3mOfwOYLn1EMBN4vrmeiX_\nrfGPbaHbz35hv0MWM-Xs3bkHnyZMr49c6iXvB9im3J9sZgtHTjjBOMEm-IXWarE7A5zdHmbT4Z_O5bIPqoa1FEUeI00pWnaDE-fhRKEqbdl0kEeCgw\"\n    }\n  },\n  \"protected\": \"eyJub25jZSI6IlNMcWVEVnVhQ0hpdFdjMWRMWFhqVHRrR1FNbEFMRHdQWXhUQnJUNWNjcG8ifQ\",\n  \"payload\": \"eyJLZXlBdXRob3JpemF0aW9uIjoiakZ1eWlNa2tpaUZzbVlvS1BUQ3FYcS0zRkhHdGxUdTRneXJ0ejVfQXlnby5MSFpoczVmVTVxcy1GY1\nJFZHNUU21mNTlZbktPV1lwRExiQVBtckpIZTRvIiwiUmVzb3VyY2UiOiJjaGFsbGVuZ2UifQ\",\n  \"signature\": \"Y5C15DcNAHgtjr-9_JeUicgLOzhKUrszlrflz3j7atCQ_pfzd8Q9KqU8rviylachZEuGLfj06fFTkv_wyEptDCJ6ZiqAORf89oHKYdbK\nz6cZcU9guRs2QAlRbtpxyzfAvk67io2PiaOStAWmvQE7lcKAXMBqlomrZ0Gsmpea9EfcHxYT1q6hb0l4ph4BIbIFKTtrk7y7RWfiuVAtWwMzcYs5jGFbsAFP\nTfxx4s_28ZZqOv29ZMxfCDzZffWQurUWF7P6jnF9ril58aSTB70rbKlsYKrScrTcT2Lyb2fbga90CY-Pxm-Cd3pRhjMwpY_N2gamdmq7EbvIVw_RORM2wQ\"\n}\nPayload end\n Refreshing authorization\n Authorization Result: valid\n Deleting answer\nRequesting Certificate\nPosting to https://acme-v01.api.letsencrypt.org/acme/new-cert\nPayload begin\n{\n  \"header\": {\n    \"alg\": \"RS256\",\n    \"jwk\": {\n      \"e\": \"AQAB\",\n      \"kty\": \"RSA\",\n      \"n\": \"po2Rrgm9W_kgT0Vo_z1CbkJwdm_APCNbQwhmXHJrakn9XXqdl2eV45_PYr4qikih6ROthimZPh-0l2eaowFeyGGyeWyLvzg5g4XFNjO5kH3l\n3_GYRXkJyQ8GjZD5jhkWWxBjOHT2glyZUY_trY4s61cdl8lpY1YDQbPL3IHKFPb7cjJqyEaB0LaMCdPA_fpBAQmKZey81k-Q3E3mOfwOYLn1EMBN4vrmeiX_\nrfGPbaHbz35hv0MWM-Xs3bkHnyZMr49c6iXvB9im3J9sZgtHTjjBOMEm-IXWarE7A5zdHmbT4Z_O5bIPqoa1FEUeI00pWnaDE-fhRKEqbdl0kEeCgw\"\n    }\n  },\n  \"protected\": \"eyJub25jZSI6ImN5dV94TUZocTk0eEpsQWI1WjdRclNuYXE1NE5VU0ZKVDhseGtVdFloQ2sifQ\",\n  \"payload\": \"eyJDc3IiOiJNSUlDY0RDQ0FWZ0NBUUF3S3pFcE1DY0dBMVVFQXd3Z2QzZDNMbU52YldsMFpYQmhjbUZzYVcxd2FXTnZjRzl5ZEhWbllXd3\nVjSFF3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQzlRYjI3UUY0eHNxTmNMV0NjZ2oyWjUtTjE5ZlFXQ0hPeTdhMXVoQ2tqQz\nZJbjdIS0J0bUc2ME9PT1V4dlJ5UkZrNTNBS1FyWXJoeG9lTVpfNXhRc01ZVG5uUUF2SmRYTEh2RTFMZXJOeTkyWkVfbHZreXlpZlY3aGZ2QkhZa2hUVFQxcT\ng2TjhwNlRsZ0xORGtvWjk1WFF1d2xueldrb3FFYWdsTXJheVZ1cUZTdlpKR1QySTZVUHA1cHprT1Bvd0dXT2MzWlJ4Zi01VDB2cU9SQnNDQ2ZLN2tzUWFkaE\n14NTAwaFJQYUhlbm9EOV9tNVJlODN2TDFHTExGekhCLVBDbGRBTk5aMFpMNnhEbXh6V0dnTzlfM2RxNGRranB5Sm1ldkRyOWJfMjRaMDEwVVZQZUNXTVdCdE\n0xT011YlpZV3JQMVJyVUs2emtvc3VxWU9NdHlqQWdNQkFBR2dBREFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBTGlzTXJoNXh1YV9lWktENzk3UTZHNVd0Vk\no2Q2VpRWEwLWZQSWsxYUs2X3RlUGx3NXpuMWVXS1R5Wl9HZnZsVTJOUmxHUXlxT2hHRE9lRFZEanBVOTA1eTY0akJFc3ZGemxNY293MjJHWkF6TmlUN3pscV\nNkVThXOVJEM1dadlNyODRaSWxaU1hrSFQxY2loMHB6cEVfTzIzWTJOVWFMUFItb3VRZXMzeEowNUY2UlVsU3VEZ0VuS1NkYmV2UlpCTFNGNk1tcFR5Mk56NG\nl2cUEtclE0MGdOX3pPcDZsbERSVjBBNVBMS01OanJ2QmNZamx2WW9WZk9qQlpwVGF3LTI0ZGs5S2NQOVpjT1Q4ZVpKOXp3X1N6VWt5QWxpemlQaFNxUTNjdU\npNMmoyeFNVb2JiM2FOR2V1MUJ5eHBqTUpyU2llTURUa3FQRFE2dVIwckRkZUR3IiwiUmVzb3VyY2UiOiJuZXctY2VydCJ9\",\n  \"signature\": \"W9vcsgIQETItCpvFtT21iGcx1oFtoStUsERJrfa0JSG1jgJuOTyY4GYiHwMdhgaoM7_t-rz0tnBRY3HtXENPDw9z_olSAWwD8-jXBKhI\nkrDkB1ddMmsceqyJQ0j77DP-QxiqhmjREocUgj3GLeSEs-HZNfyNN6-wuYh1UTWaMYz88p3J9jBrpQPGCQmCeZNMp701ZMYEQeeL1xxFhE0p6kLyT8WfbCuR\ntNsgQpP0HkpRgDXmzFP38xy98Pw6X5l_bxcqWTB6FaMP59PsPSDazxysKqFt9fUPEDF5uDF27XjPNqMr8OMjhUqf1pkJ79c10W9pYsuqh0egVdM-0Pxwrg\"\n}\nPayload end\n Request Status: Created\n Saving Certificate to C:\\Users\\VILT\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\www.comite\nparalimpicoportugal.pt-crt.der\n Saving Issuer Certificate to C:\\Users\\VILT\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ca-\n0A0141420000015385736A0B85ECA708-crt.pem\n Saving Certificate to C:\\Users\\VILT\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\www.comite\nparalimpicoportugal.pt-all.pfx\n Opened Certificate Store \"My\"\n Adding Certificate to Store\n Closing Certificate Store\n Adding https Binding\n Committing binding changes to IIS\n Opened Certificate Store \"My\"\n Removing Certificate from Store\n Closing Certificate Store\n```\n. ",
    "KelvinJones": "I see this has been closed but I'm getting the exact error above.  Was there a solution?  I get this on Server 2012R2 and 2016. . Happy to support this effort if I can.  I've attached the Fiddler session capture file.\nIs there a particular part you would prefer that I upload here?\nWorth noting is that I used the LE staging server rather than production and I've tried to clean up the server by deleting the .well-known and letsencrypt-win-simple folders and registry entries (but there were none) after each run.  Not sure if that will skew the results or the tests or perhaps be the cause of the problem I'm experiencing?\nLEWS-1.9.4beta10-Win2012R2-JSONerrorCapture.zip\n. Just a dribble more detail.  I can also confirm that the IIS install is a default one, for RDS, with no redirect modifications to the Default Site.  I've added the host header value so it will get picked up by LE and that's it.  It sits behind a firewall with port forwarding on 80 and 443.  Inbound and outbound traffic is on the same public IP.\nReally looking forward to this working. I've had limited success but the progress is exciting in terms of what this means for businesses.\n. > And you have tried to access that URL http://myfakeurl.co.za/.well-known/acme-challenge/0ZHb5kOp0YhYTtb_O_g-9IS4pvxYsOYuxlHS5EvIlx8 and confirmed it shows some random character string? I assumed so, but reading back I don't actually see you describing that that works.\n100% - tested that.  Works perfectly. Displays the hash as it should so the extensionless file problem with IIS is not a problem in this case.. I've been working on this for about 2 weeks.  Was using the production servers first then read that they are set to block after X attempts over X time so switched to the staging servers.  Will try the production server now and revert shortly.. Just to eliminate the staging server as the problem I tested against the production servers just now. No joy.  Did not sanitize the URLs below.  Here's the pertinent part of the response again, using the same version of win-simple with the --verbose switch:\n[INFO] Authorizing Identifier rdweb.demo.c29.co.za Using Challenge Type http-01\n[INFO] Writing challenge answer to C:\\inetpub\\wwwroot.well-known/acme-challenge\n/2n8KuZ0_-GVmkuht3D48H9uQ9D-p3bwP4KYK7p86KJY\n[INFO] Writing web.config to add extensionless mime type to C:\\inetpub\\wwwroot.\nwell-known\\acme-challenge\\web.config\n[INFO] Answer should now be browsable at http://rdweb.demo.c29.co.za/.well-known\n/acme-challenge/2n8KuZ0_-GVmkuht3D48H9uQ9D-p3bwP4KYK7p86KJY\n[INFO] Submitting answer\n[DBUG] AcmeWebException {@awe}\n[DBUG] ACME Server Returned: Unexpected error - Response: {\n  \"type\": \"urn:acme:error:malformed\",\n  \"detail\": \"Request payload did not parse as JSON\",\n  \"status\": 400\n}\nWould you like to start again? (y/n)\nHere's the URL where the response should come from (same as above). It's my demo box, semi-production but please hit it if you'd like to test the response:\nhttp://rdweb.demo.c29.co.za/.well-known/acme-challenge/2n8KuZ0_-GVmkuht3D48H9uQ9D-p3bwP4KYK7p86KJY\n. Awesome, thanks!  Looking for beta 11 now.  Will test and revert.... Success! mostly. Looking at sanitizing some of the --verbose results now and will post shortly.. RESULTS:\nletsencrypt.exe --accepttos --emailaddress name@company.co.za --verbose\n[INFO] Let's Encrypt (Simple Windows ACME Client)\n[INFO] version 0.0.0.0 (RELEASE)\n[VERB] Verbose mode logging enabled\n[INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n[INFO] Renewal Period: 60\n[INFO] Certificate Store: Personal\n[INFO] ACME Server: https://acme-v01.api.letsencrypt.org/\n[DBUG] Settings {ScheduledTaskName=null}\n[DBUG] Config folder: C:\\Users\\user\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n[DBUG] Certificate folder: C:\\Users\\user\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n[DBUG] Getting AcmeServerDirectory\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n[DBUG] Registration email: name@company.co.za\n[INFO] Calling Register\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-reg\n[INFO] Updating Registration\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/reg/19755304\n[DBUG] AcmeWebException AcmeWebException {WebException=WebException {Status=ProtocolError, Response=HttpWebResponse {IsMutuallyAuthenticated=\"The property accessor threw an exception: ObjectDisposedException\", Cookies=\"The property accessor threw an exception: ObjectDisposedException\", Headers=\"The property accessor threw an exception: ObjectDisposedException\", SupportsHeaders=True, ContentLength=\"The property accessor threw an exception: ObjectDisposedException\", ContentEncoding=\"The property accessor threw an exception: ObjectDisposedException\", ContentType=\"The property accessor threw an exception: ObjectDisposedException\", CharacterSet=\"The property accessor threw an exception: ObjectDisposedException\", Server=\"The property accessor threw an exception: ObjectDisposedException\", LastModified=\"The property accessor threw an exception: ObjectDisposedException\", StatusCode=\"The property accessor threw an exception: ObjectDisposedException\", StatusDescription=\"The property accessor threw an exception: ObjectDisposedException\", ProtocolVersion=\"The property accessor threw an exception: ObjectDisposedException\", ResponseUri=\"The property accessor threw an exception: ObjectDisposedException\", Method=\"The property accessor threw an exception: ObjectDisposedException\", IsFromCache=False}, Message=\"The remote server returned an error: (500) Internal Server Error.\", Data=[], InnerException=null, TargetSite=System.Net.WebResponse GetResponse(), StackTrace=\"   at System.Net.HttpWebRequest.GetResponse()\\r\\n   at ACMESharp.AcmeClient.RequestHttpPost(Uri uri, Object message)\", HelpLink=null, Source=\"System\", HResult=-2146233079}, Response=AcmeHttpResponse {StatusCode=InternalServerError, Headers=[\"Mime-Version\", \"Pragma\", \"Connection\", \"Content-Length\", \"Cache-Control\", \"Content-Type\", \"Date\", \"Expires\", \"Server\"], Links=[], RawContent=System.Byte[], ContentAsString=\"Error\\nAn error occurred while processing your request.\\nReference #179.a7a3c129.1502301701.3c456deb\\n\\n\", IsError=True, Error=WebException {Status=ProtocolError, Response=HttpWebResponse {IsMutuallyAuthenticated=\"The property accessor threw an exception: ObjectDisposedException\", Cookies=\"The property accessor threw an exception: ObjectDisposedException\", Headers=\"The property accessor threw an exception: ObjectDisposedException\",SupportsHeaders=True, ContentLength=\"The property accessor threw an exception: ObjectDisposedException\", ContentEncoding=\"The property accessor threw an exception: ObjectDisposedException\", ContentType=\"The property accessor threw an exception: ObjectDisposedException\", CharacterSet=\"The property accessor threw an exception: ObjectDisposedException\", Server=\"The property accessor threw an exception: ObjectDisposedException\", LastModified=\"The property accessor threw an exception: ObjectDisposedException\", StatusCode=\"The property accessor threw an exception: ObjectDisposedException\", StatusDescription=\"The property accessor threw an exception: ObjectDisposedException\", ProtocolVersion=\"The property accessor threw an exception: ObjectDisposedException\", ResponseUri=\"The property accessor threw an exception: ObjectDisposedException\", Method=\"The property accessor threwan exception: ObjectDisposedException\", IsFromCache=False}, Message=\"The remoteserver returned an error: (500) Internal Server Error.\", Data=[], InnerException=null, TargetSite=System.Net.WebResponse GetResponse(), StackTrace=\"   at System.Net.HttpWebRequest.GetResponse()\\r\\n   at ACMESharp.AcmeClient.RequestHttpPost(Uri uri, Object message)\", HelpLink=null, Source=\"System\", HResult=-2146233079}, ProblemDetail=null}, Message=\"Unexpected error\", Data=[], InnerException=WebException {Status=ProtocolError, Response=HttpWebResponse {IsMutuallyAuthenticated=\"The property accessor threw an exception: ObjectDisposedException\", Cookies=\"The property accessor threw an exception: ObjectDisposedException\", Headers=\"The property accessor threw an exception: ObjectDisposedException\", SupportsHeaders=True, ContentLength=\"The property accessor threw an exception: ObjectDisposedException\", ContentEncoding=\"The property accessor threw an exception: ObjectDisposedException\", ContentType=\"The property accessor threw an exception: ObjectDisposedException\", CharacterSet=\"The property accessor threw an exception: ObjectDisposedException\", Server=\"The property accessor threw an exception: ObjectDisposedException\", LastModified=\"The property accessor threw an exception: ObjectDisposedException\", StatusCode=\"The property accessor threw an exception: ObjectDisposedException\", StatusDescription=\"The property accessor threw an exception: ObjectDisposedException\", ProtocolVersion=\"The property accessor threw an exception:ObjectDisposedException\", ResponseUri=\"The property accessor threw an exception: ObjectDisposedException\", Method=\"The property accessor threw an exception: ObjectDisposedException\", IsFromCache=False}, Message=\"The remote server returned an error: (500) Internal Server Error.\", Data=[], InnerException=null, TargetSite=System.Net.WebResponse GetResponse(), StackTrace=\"   at System.Net.HttpWebRequest.GetResponse()\\r\\n   at ACMESharp.AcmeClient.RequestHttpPost(Uri uri, Object message)\", HelpLink=null, Source=\"System\", HResult=-2146233079}, TargetSite=ACMESharp.AcmeRegistration UpdateRegistration(Boolean, Boolean, System.String[]), StackTrace=\"   at ACMESharp.AcmeClient.UpdateRegistration(Boolean useRootUrl, Boolean agreeToTos, String[] contacts)\\r\\n   at LetsEncrypt.ACME.Simple.Program.UpdateRegistration()\\r\\n   at LetsEncrypt.ACME.Simple.Program.ConfigureAcmeClient(AcmeClient client)\\r\\n   at LetsEncrypt.ACME.Simple.Program.Main(String[] args)\", HelpLink=null, Source=\"ACMESharp\", HResult=-2146233088}\n[EROR] ACME Server Returned: Unexpected error - Response: ErrorAn error occurred while processing your request.Reference #179.a7a3c129.1502301701.3c456deb\nWould you like to start again? (y/n): -- yes\n[DBUG] Getting AcmeServerDirectory\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n[DBUG] Registration email: name@company.co.za\n[INFO] Calling Register\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-reg\n[INFO] Updating Registration\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/reg/19755403\n[INFO] Saving Registration\n[INFO] Saving Signer\n[DBUG] Scanning IIS Site Bindings for Hosts\n[DBUG] Scanning IIS Site Bindings for Hosts\n1: [DNS] myfakeurl.company.co.za (SiteId 1) [@ %SystemDrive%\\inetpub\\wwwroot]\n2: [IIS] myfakeurl.company.co.za (SiteId 1) [@ %SystemDrive%\\inetpub\\wwwroot]\nW: Generate a certificate via WebDav and install it manually.\n F: Generate a certificate via FTP/ FTPS and install it manually.\n M: Generate a certificate manually.\n Q: Quit\nChoose from one of the menu options above: 2\n[INFO] Authorizing identifier myfakeurl.company.co.za using http-01 challenge\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[DBUG] Writing challenge answer to C:\\inetpub\\wwwroot.well-known\\acme-challenge\\ov6lXppraSyHn9OWIMVLBccH1NlHtnNq7-r0E5iqsnw\n[DBUG] Writing web.config to add extensionless mime type to C:\\inetpub\\wwwroot.well-known\\acme-challenge\\web.config\n[INFO] Answer should now be browsable at http://myfakeurl.company.co.za/.well-known/acme-challenge/ov6lXppraSyHn9OWIMVLBccH1NlHtnNq7-r0E5iqsnw\n[DBUG] Submitting answer\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/uWjVp5Us2jPcfi4fe3TFHst_FN2GaIHjOuGBFGuJlJM/1717412976\n[DBUG] Refreshing authorization\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/uWjVp5Us2jPcfi4fe3TFHst_FN2GaIHjOuGBFGuJlJM\n[INFO] Authorization result: valid\n[INFO] Deleting answer\n[INFO] Deleting web.config\n[INFO] Deleting C:\\inetpub\\wwwroot.well-known\\acme-challenge\\\n[WARN] Error occured while deleting folder structure. Error: ArgumentOutOfRangeException {Message=\"StartIndex cannot be less than zero.\\r\\nParameter name: startIndex\", ActualValue=null, ParamName=\"startIndex\", Data=[], InnerException=null,TargetSite=System.String Remove(Int32, Int32), StackTrace=\"   at System.String.Remove(Int32 startIndex, Int32 count)\\r\\n   at LetsEncrypt.ACME.Simple.IISPlugin.DeleteAuthorization(String answerPath, String token, String webRootPath, StringfilePath)\", HelpLink=null, Source=\"mscorlib\", HResult=-2146233086}\n[DBUG] RSAKeyBits: 2048\n[INFO] Requesting certificate: myfakeurl.company.co.za\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n[DBUG] certRequ CertificateRequest {CsrContent=\"MIICrDCCAZQCAQAwHzEdMBsGA1UEAwwUcmR3ZWIuZGVtby5jMjkuY28uemEwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDJJQVI7SREZ-Bj39kK--F7KDc0mt7JNcRX0ipk8uMZNSnPe22ADrbfqiRyJGgpZQ7fO1_055OnkIpOwuAlOYPggK9A3z8SR9A8Q2uUzbnQ2TGSm7OCL-s4mP9XW9K4wmWm48gJhBd4sw9euXDZs-r4YQqcgTXFvNthjYXkHRPI5w-ZaVZ47ibrJ_nL_on_-9tgfVye_6uMMa6F59iltSUmovFkC5yi_dYJ6GZRjo4J5xk1OQ-Ryf0HJKD0vX3eh0ilrYJ2_4jmC_vUw8EICBTPmf7noYS-i78iekHu02rSI9nKnPO2dNQMZ9n2gGHxCsmgqeE2PS9hkVTZpHlIrPG7AgMBAAGgSDBGBgkqhkiG9w0BCQ4xOTA3MDUGA1UdEQQuMCyCFHJkd2ViLmRlbW8uYzI5LmNvLnphghRyZHdlYi5kZW1vLmMyOS5jby56YTANBgkqhkiG9w0BAQsFAAOCAQEAS3UkPGrx4FTx16Iz0wZG0uiDKV4ZdDkSlavYv5nFV1C_HQ7HkndDkuhd8z3AM4dwjx1rfxl0R4CvNfUR9vVQAZdRR3rJUlUB_gfksYwh_qM5ww9e-PCeKH8IjkvTVXLAbY6zsTTfwHSPShJbhiVNdhM8j4bt1TiyCKLD1G9dhAInL5dXvCO0dbjCzi9sgAec0Zr9Ztj4dPhmlZS1x7SJvvsfNJlgdUWUECW8DbW-7oS-g4BXpzKQyWpHsqpZb7SfGZyxesyHKsGSWsPtoGzlRzGJDo88KmymlZsSXxsGUVi-8-8v_qQJPFPqtVNFZb6-8yZAE8G3jV5cNMini6XZIQ\", Uri=\"https://acme-v01.api.letsencrypt.org/acme/cert/038288fdffe0a7a055188828aa5aa261b28f\", Links=[\"https://acme-v01.api.letsencrypt.org/acme/issuer-cert;rel=\\\"up\\\"\"], StatusCode=Created, RetryAfter=null, CertificateContent=\"MIIFCzCCA_OgAwIBAgISA4KI_f_gp6BVGIgoqlqiYbKPMA0GCSqGSIb3DQEBCwUAMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQDExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xNzA4MDkxNzA1MDBaFw0xNzExMDcxNzA1MDBaMB8xHTAbBgNVBAMTFHJkd2ViLmRlbW8uYzI5LmNvLnphMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAySUFSO0kRGfgY9_ZCvvheyg3NJreyTXEV9IqZPLjGTUpz3ttgA6236okciRoKWUO3ztf9OeTp5CKTsLgJTmD4ICvQN8_EkfQPENrlM250Nkxkpuzgi_rOJj_V1vSuMJlpuPICYQXeLMPXrlw2bPq-GEKnIE1xbzbYY2F5B0TyOcPmWlWeO4m6yf5y_6J__vbYH1cnv-rjDGuhefYpbUlJqLxZAucov3WCehmUY6OCecZNTkPkcn9BySg9L193odIpa2Cdv-I5gv71MPBCAgUz5n-56GEvou_InpB7tNq0iPZypzztnTUDGfZ9oBh8QrJoKnhNj0vYZFU2aR5SKzxuwIDAQABo4ICFDCCAhAwDgYDVR0PAQH_BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBRRzX9pxg0bw0-qvN5KUeBO7qds5DAfBgNVHSMEGDAWgBSoSmpjBH3duubRObemRWXv86jsoTBvBggrBgEFBQcBAQRjMGEwLgYIKwYBBQUHMAGGImh0dHA6Ly9vY3NwLmludC14My5sZXRzZW5jcnlwdC5vcmcwLwYIKwYBBQUHMAKGI2h0dHA6Ly9jZXJ0LmludC14My5sZXRzZW5jcnlwdC5vcmcvMB8GA1UdEQQYMBaCFHJkd2ViLmRlbW8uYzI5LmNvLnphMIH-BgNVHSAEgfYwgfMwCAYGZ4EMAQIBMIHmBgsrBgEEAYLfEwEBATCB1jAmBggrBgEFBQcCARYaaHR0cDovL2Nwcy5sZXRzZW5jcnlwdC5vcmcwgasGCCsGAQUFBwICMIGeDIGbVGhpcyBDZXJ0aWZpY2F0ZSBtYXkgb25seSBiZSByZWxpZWQgdXBvbiBieSBSZWx5aW5nIFBhcnRpZXMgYW5kIG9ubHkgaW4gYWNjb3JkYW5jZSB3aXRoIHRoZSBDZXJ0aWZpY2F0ZSBQb2xpY3kgZm91bmQgYXQgaHR0cHM6Ly9sZXRzZW5jcnlwdC5vcmcvcmVwb3NpdG9yeS8wDQYJKoZIhvcNAQELBQADggEBABhEQ8z05K9OsIrBXzvmXnGNrgT16OHrqi8dwgOsK1JTGj5o82OM4Tm68MOZswS17cOBnXRXe8X5Kqthk0oonEhNGfc0oPldVD9CRA-AiA-96n3e0bcC69iTjgXqRzQf3eot-TKGl6BXqs7tMhUzkfhjlPw_OAto-mjtdITbktNWfdBEivw5nhESsUO2dcv6EUve2pvMDljIXMiAZDXi6BAUOifdvcGu3j8t7FnB3UXCLZgkBp9xV1psz2QQNUjOQX3UC7E049DwAUdj_lJijQm1_AnwF1z4Cf5W0tPLiHBqelFWqr9CbIQS-qBzTXiwGdatu_VH7mChV1HGtu3H-KI\"}\n[DBUG] Request Status: Created\n[INFO] Saving certificate to C:\\Users\\user\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\myfakeurl.company.co.za-crt.der\n[INFO] Saving issuer certificate to C:\\Users\\user\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ca-0A0141420000015385736A0B85ECA708-crt.pem\n[DBUG] CentralSsl False - San False\n[INFO] Saving certificate to C:\\Users\\user\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\myfakeurl.company.co.za-all.pfx\n[INFO] Installing Non-Central SSL Certificate in the certificate store\n[DBUG] Opened Certificate Store My\n[DBUG] Set private key exportable\n[DBUG] myfakeurl.company.co.za 2017-8-9 8:5:27 PM\n[DBUG] Adding certificate to store\n[DBUG] Closing certificate store\n[INFO] Installing Non-Central SSL Certificate in server software\n[INFO] Updating Existing https Binding\n[INFO] IIS will serve the new certificate after the Application Pool Idle Timeout time has been reached.\n[INFO] Committing binding changes to IIS\n[DBUG] Opened Certificate Store My\n[INFO] Closing Certificate Store\n[INFO] Adding renewal for [IIS] myfakeurl.company.co.za (SiteId 1) [@ %SystemDrive%\\inetpub\\wwwroot]\n[INFO] Creating task letsencrypt-win-simple httpsacme-v01.api.letsencrypt.org with Windows Task scheduler at 9am every day.\n[DBUG] TaskDefinition {Actions=[ExecAction {Arguments=\"--renew --baseuri \\\"https://acme-v01.api.letsencrypt.org/\\\"\", Path=\"C:\\Install\\letsencrypt-win-simple.V1.9.4\\letsencrypt.exe\", WorkingDirectory=\"C:\\Install\\letsencrypt-win-simple.V1.9.4\", ActionType=Execute, Id=null}], Data=null, LowestSupportedVersion=V2, Principal=TaskPrincipal {DisplayName=null, GroupId=null, Id=null, LogonType=None, ProcessTokenSidType=Default, RequiredPrivileges=[], RunLevel=Highest, UserId=null}, RegistrationInfo=TaskRegistrationInfo {Author=null, Date=01/01/0001 00:00:00, Description=\"Check for renewal of ACME certificates.\", Documentation=null, SecurityDescriptor=\"The property accessor threw an exception: ArgumentNullException\", SecurityDescriptorSddlForm=null, Source=null, URI=null, Version=Version {Major=1, Minor=0, Build=-1, Revision=-1, MajorRevision=-1, MinorRevision=-1}, XmlText=\"The property accessor threw an exception: NotImplementedException\"}, Settings=TaskSettings {AllowDemandStart=True, AllowHardTerminate=True, Compatibility=V2,DeleteExpiredTaskAfter=00:00:00, DisallowStartIfOnBatteries=True, DisallowStartOnRemoteAppSession=False, Enabled=True, ExecutionTimeLimit=02:00:00, Hidden=False, IdleSettings=IdleSettings {IdleDuration=00:10:00, RestartOnIdle=False, StopOnIdleEnd=True, WaitTimeout=01:00:00}, MaintenanceSettings=MaintenanceSettings {Deadline=00:00:00, Exclusive=False, Period=00:00:00}, MultipleInstances=IgnoreNew,NetworkSettings=NetworkSettings {Id=00000000-0000-0000-0000-000000000000, Name=null}, Priority=BelowNormal, RestartCount=0, RestartInterval=00:00:00, RunOnlyIfIdle=False, RunOnlyIfLoggedOn=True, RunOnlyIfNetworkAvailable=False, StartWhenAvailable=False, StopIfGoingOnBatteries=True, UseUnifiedSchedulingEngine=False, Volatile=False, WakeToRun=False, XmlText=\"The property accessor threw an exception: NotImplementedException\"}, Triggers=[DailyTrigger {DaysInterval=1, RandomDelay=00:00:00, Enabled=True, EndBoundary=12/31/9999 23:59:59, ExecutionTimeLimit=00:00:00, Id=null, Repetition=RepetitionPattern {Duration=00:00:00, Interval=00:00:00, StopAtDurationEnd=False}, StartBoundary=08/09/2017 09:00:00, TriggerType=Daily}], XmlText=\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-16\\\"?>\\r\\n\\r\\n  \\r\\n    Check for renewal of ACME certificates.\\r\\n  \\r\\n  \\r\\n    \\r\\n 2017-08-09T09:00:00\\r\\n      true\\r\\n      \\r\\n        1\\r\\n \\r\\n    \\r\\n  \\r\\n  \\r\\n    \\r\\n      HighestAvailable\\r\\n    \\r\\n  \\r\\n  \\r\\n    IgnoreNew\\r\\n    true\\r\\n    true\\r\\n    true\\r\\n    false\\r\\n    false\\r\\n    \\r\\n      PT10M\\r\\nPT1H\\r\\n      true\\r\\n      false\\r\\n    \\r\\n    true\\r\\n    true\\r\\n    false\\r\\n    false\\r\\n    false\\r\\n    PT2H\\r\\n7\\r\\n  \\r\\n  \\r\\n    \\r\\n      C:\\Install\\letsencrypt-win-simple.V1.9.4\\letsencrypt.exe\\r\\n      --renew --baseuri \\\"https://acme-v01.api.letsencrypt.org/\\\"\\r\\n      C:\\Install\\letsencrypt-win-simple.V1.9.4\\r\\n    \\r\\n  \\r\\n\"}\nDo you want to specify the user the task will run as? (y/n): -- yes\nEnter the username (Domain\\username): demo\\user\nEnter the user's password: 123\n[DBUG] Creating task to run as demo\\user\n[INFO] Renewal scheduled [IIS] myfakeurl.company.co.za (SiteId 1) [@ %SystemDrive%\\inetpub\\wwwroot] - renew after 2017-10-08\nWould you like to start again? (y/n): -- no\nFRIENDLY NAME came out like this (is the time stamp right?):\nmyfakeurl.company.co.za 2017-8-9 8:5:27 PM\nAlso, I think it's supposed to bind to the default web site too but it didn't. Perhaps it doesn't by design?\n. Despite the error on the first run, selecting yes to run again worked and all the bits are in place except for binding the cert to the site but I can live with that as long as renewals work.  I'll move on to test this on another box now.\nAwesome work @WouterTinus , thanks!. Next server, ran perfectly as far as I can tell!  More cheers!  I see the time stamp can be controlled in the config and the above note on the Friendly Name can be ignored.\nAlso, there was a cert already bound to the IIS site this time and the behaviour was to bind the new LE cert successfully.  It looks like, if the site doesn't have a cert, it doesn't bind the new one but if it has a cert it binds the new one successfully.\nOverall, a win! For me, until run into something new, CASE CLOSED, thanks a mil!\nI'm moving on to capturing the thumbprint from the cert now so I can script applying it to RDS next.  Should be just three lines of scripting. ;-) (famous last words).. @tsimmons, no red-herring there.   The \"\\\" is indeed missing in the output. Checked it. ;-). As to the challenge answer, I can't comment. I thought you were referring to the cleanup path with regard to the missing \"\\\".   Since the update by @WouterTinus it works and generates certs for me.  As for the clean up error, that persists but I'm not really fussed about that as long as the rest works.  It seems to delete the files when cleaning up, just not the folders.. ",
    "clemensmach": "yes, it is configured to run if not logged in. the process is starting and the status is \"running\"\nit is doing some tasks, the last in event log is \"Getting AcmeServerDirectory\" but then it is waiting for something (i guess)...\nit is administrator account so it does have access to registry. the task is working when the user is logged in, but not if he isn't.\n. \ni tried it with \"hidden\" (Ausgeblendet) checkbox disabled, but same result - task started but not finishing\n. same, here \n[Information] Getting AcmeServerDirectory is the last log entry\nyes, released version, not compiled\n. console is not asking for e-mail (with --renew and without parameter)\n. but none of them is working\nthere is only one user on our server and i used the release (did not compile it)\n. ",
    "airathere": "i do have the same problem. my task was automatically created with defaults (letsencrypt.exe --renew --baseuri ...). If i run it by rightclick/run now in task scheduler everythings working fine. If it's run by scheduler it always has error code 0x103 (running forever). I tried it on a second and afterwords on a third win 2012r2 server: exactly the same problem. Maybe it's helpful to know, that we are operating under german windows? We are using latest version (1.9.0) \n. No problem:\n\n. Hi,\ni started the task 10 minutes ago, since this there are the following entries in log, no changes:\nStarted 2016-05-25 19:40:01.836 +02:00 [Information] The global logger has been configured\n2016-05-25 19:40:02.290 +02:00 [Debug] Options { BaseUri: \"https://acme-v01.api.letsencrypt.org\", AcceptTos: False, Renew: True, Test: False, ManualHost: null, WebRoot: \"%SystemDrive%\\inetpub\\wwwroot\", Script: null, ScriptParameters: null, CentralSslStore: null, HideHttps: False, San: False, KeepExisting: False }\n2016-05-25 19:40:02.352 +02:00 [Information] Renewal Period: 60\n2016-05-25 19:40:02.352 +02:00 [Information] Certificate Store: \"WebHosting\"\n2016-05-25 19:40:02.352 +02:00 [Information] ACME Server: \"https://acme-v01.api.letsencrypt.org\"\n2016-05-25 19:40:02.352 +02:00 [Debug] Settings { ScheduledTaskName: null }\n2016-05-25 19:40:02.368 +02:00 [Information] Config Folder: \"C:\\Users\\Default\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\"\n2016-05-25 19:40:02.368 +02:00 [Information] Certificate Folder: \"C:\\Users\\Default\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\"\n2016-05-25 19:40:02.993 +02:00 [Information] Getting AcmeServerDirectory\n...\ntask is in state \"running (0x41301)\" now.\ni will show you the rest of the log after timeout (in 1 hour)\ni'm using the zip, yes, no compiled stuff.\nIf you need access to german windows let me know, no problem for us.\n. OK, timeout is over (1 hour) and nothing else in the log any more, only the already described lines above with the last entry ...Getting AcmeServerDirectory...\nTask is at state 0x103 now\n. Its closed without a Solution? Or do i misunderstood something in the thread?\nRegards\nJoe\nVom iPhone gesendet, daher bitte ich, Schreibfehler und Abk\u00fcrzungen zu entschuldigen.\n\nAm 01.08.2016 um 16:49 schrieb Robert Kerber notifications@github.com:\nClosed #221.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub, or mute the thread.\n. \n",
    "werasmusstuff": "Hi,\nI have the same issue on an English version of Windows 2008 R2. Only difference is, even if I manually run it, it does the same thing. The task was running fine a couple of days ago. My task scheduler history is disabled so I can't tell you exactly when the last successful run was.\nI have enabled debugging and the last entry is the same as that of clemensmach and airathere.\n [Information] Getting AcmeServerDirectory.\nAlso the released version, not self compiled.\n. I think it may be the email prompt stopping further flow of the task.\nTry this: \n1. Run letsencrypt, with no parameters, from you command console(cmd).\n2. It will prompt you for an email address for failure of renewal. Enter an email address.\n3. The app will scan IIS etc.\n4. You can quit the app after that. Q or ctrl+C\n5. now run letsencrypt with the renewal parameters and it should go through.\nI am pretty sure I added the email address the first time I ran it. But following the above steps my task is now running again as normal.\n. Definitely did not delete the registration file and the task was running before. As far as I am concerned nothing changed between the task running the one day and not running the next.\nI should have tried running letsencrypt.exe with the renewal parameters first to see what it does in the console, but I didn't. Maybe one of the others with the issue can try that and see if it prompts for an email address.\nThis solved it for me though.\n. Just curiosity from my side but did you log in with the same user running the task? or from a different user? \nRkerber is correct about the registration file. The registration file saves under \"intialusername\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\\" for the user that ran it initially. If the user running the task is different it will check \"taskusername\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\\"  and will not be able to find the registration file and thus prompt for the email address. Note the difference in the username.\nIts not that I deleted the registration file, it was just in the wrong location. I guess one option is to copy the registration, signer and other files over from the initial users directory to the task users directory but I have not tested this and maybe Robert can give us more information on that.\nP.S Robert, thanks for your time into making this great little app. Saved me and my clients some cash.\n. Ye that change will sort it out, so regardless of which user runs the task it will still run.\nJust to confirm I did a quick test. Created a new admin user. Logged in with it, ran the app with the renewal parameters in the console and got the below:\n\nWell kudos to Bryan for the initial idea and code then and kudos to you for maintaining the app and dealing with the issues.\n. ",
    "richtere": "Hi, I have the same problem on a Windows Server 2012 R2 with installed \"German Language Pack - Windows Server 2012 R2 - (KB2839636)\".\n. ",
    "jmcm66": "Hi, I'm having the same problem, Windows 2012 R2 Portuguese version.\nI altered the scheduled task, so it stops after 1h (same user).\nIf I log in to the server and run the task, it ends with success, without login the scheduled task result is 0x103 \n. ",
    "weyCC81": "Workaround:\n    #1 Move ConfigDir to Service User & Delete Folder in Admin User\n    cp \"C:\\Users\\[admin-user]\\AppData\\Roaming\\letsencrypt-win-simple\" \"C:\\Users\\Default\\AppData\\Roaming\\letsencrypt-win-simple\\\"\n    rmdir /s \"C:\\Users\\[admin-user]\\AppData\\Roaming\\letsencrypt-win-simple\"\n\n    #2 Create Symbolic Link - !Warning: Not the best Option for Security reason!\n    mklink /J \"C:\\Users\\[admin-user]\\AppData\\Roaming\\letsencrypt-win-simple\" \"C:\\Users\\Default\\AppData\\Roaming\\letsencrypt-win-simple\\\"\n    mklink /J \"C:\\Users\\[sa-user]\\AppData\\Roaming\\letsencrypt-win-simple\" \"C:\\Users\\Default\\AppData\\Roaming\\letsencrypt-win-simple\\\"\n\n\n    #3 Export the Following in Admin User und Import in Service User\n    HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\n        ::If not done: 02/27/2017 14:15:05 +01:00 [Information] No scheduled renewals found.\n\n    #4 Check Permission on Install Dir (Full-Access for Service User)\n    C:\\[Install Dir]\n\n    #5 Check Run, Service User with CMD in Admin rights\n    C:\\[Install Dir]\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\n\n        ::Change Debug Level for more Information\n        <add key=\"serilog:minimum-level\" value=\"Information\" />. > Does somebody have a better Workaround for that, as i didn't thought about:\n\n\n\"I'm not a fan of copying anything to C:\\Users\\Default though\"\n\nUBPM doesn't set environmental variables correctly when you run scheduled tasks in Windows Server 2012 R2\nhttps://support.microsoft.com/en-us/help/3133689/ubpm-doesn-t-set-environmental-variables-correctly-when-you-run-scheduled-tasks-in-windows-server-2012-r2\n(Scheduled tasks reference incorrect user profile paths in Windows Server 2012\nhttps://support.microsoft.com/en-us/help/2968540/scheduled-tasks-reference-incorrect-user-profile-paths-in-windows-server-2012)\nWorkaround after KB Apply:\nThe \"letsencrypt-win-simple\" Client is no longer searching in \"Default User\" for Certificates! :-)\n#1 Move ConfigDir to Service User & Delete Folder in Admin User\ncp \"C:\\Users\\[admin-user]\\AppData\\Roaming\\letsencrypt-win-simple\" \"C:\\Users\\[sa-user]\\AppData\\Roaming\\letsencrypt-win-simple\"\nrmdir /s \"C:\\Users\\[admin-user]\\AppData\\Roaming\\letsencrypt-win-simple\"\n\n#2 Create Symbolic Link for Admin User\nmklink /J \"C:\\Users\\[admin-user]\\AppData\\Roaming\\letsencrypt-win-simple\" \"C:\\Users\\[sa-user]\\AppData\\Roaming\\letsencrypt-win-simple\"\n\n#3 Export the Following in Admin User und Import in Service User\nHKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\n    ::If not done: 02/27/2017 14:15:05 +01:00 [Information] No scheduled renewals found.\n    ::There Could be a Different Date in Reg Key after first Renewal. ([admn-user]/[sa-user])\n\n#4 Check Permission on Install Dir (Full-Access for Service User)\nC:\\[Install Dir]\n\n#5 Check Run, Service User with CMD in Admin rights\nC:\\[Install Dir]\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\n\n    ::Change Debug Level for more Information\n    <add key=\"serilog:minimum-level\" value=\"Information\" />\n\n`\n. Hi @asipicki\nDo you want to run it with the same user as you did your configuration or with a different service-user?\nsame user \n--> Windows Server 2012 = apply KB2968540, Windows Server 2012 R2 = apply  KB3133689\nservice-user \n--> apply Workaround / wait for Version 2 / (change the source-code) \n. Workaround: https://github.com/Lone-Coder/letsencrypt-win-simple/issues/221#issuecomment-282717780. Workaround: https://github.com/Lone-Coder/letsencrypt-win-simple/issues/221#issuecomment-282717780. ",
    "gordonfpanam": "This is still happening even if I do the initial letsencrypt.exe run as the user I intend to have the scheduled task run as, and yes, with the release version.\nIf I run the scheduled task while logged on as the user that the task is meant to run under, it checks for renewals and exits. If the user meant to run the task is logged on but disconnected, for instance via Remote Desktop or Fast User Switching, and I run the task from another user account, it checks for renewals and exits. It's only when the user in question is not logged on does it get stuck.\nI think the application is depending on some object that is only available when the user is logged on to the server's console. The only clean way (that is, without moving stuff around in a script beforehand) I can think of working around this, is by doing the initial run as LocalSystem somehow, and then programming the scheduled task to run as LocalSystem, but that would require an unsupported hack of launching a command prompt as LocalSystem.. I can confirm that running the initial setup as LocalSystem and then creating the scheduled task as LocalSystem does work around this problem. Windows ended up storing the working folder in %systemroot%\\syswow64\\config\\systemprofile\\appdata\\roaming.\nRunning things as LocalSystem requires use of a SysInternals utility called PsExec, or otherwise somehow launching and interacting with letsencrypt.exe as LocalSystem.\nRunning an interactive command prompt as LocalSystem is usually a bad idea anyway. It is possible to instead copy the current user's %appdata%\\Roaming\\letsencrypt-win-simple folder to the 32-bit System Profile folder, and then change any created scheduled task to run as SYSTEM. This also works, and the renewal exits as intended.\n. @kira Is this where environment variables aren't presented to tasks launched via the Task Scheduler? It would explain why the task behaves if the task-running user is logged on.\nI'm not a fan of copying anything to C:\\Users\\Default though; stuff there gets copied to new user accounts' profiles, which means anyone logging on to that server for the first time would get a copy of sensitive information stored in the letsencrypt-win-simple folder.\nAssuming an older system than 2012 R2 and thus no hot fix, what would be better? Running this still-beta software as SYSTEM, or putting the sensitive data in the default profile? Both are really bad ideas. I'd rather see this become a configurable setting, or at least default to the Start In folder. There are unofficial forks, yes, and I wish they got merged into here.. I'm getting this problem too, though the central store and certs seem to work fine when browsing the SSL sites.\nComplaints on stackoverflow suggest there's some problem with how non-Windows cert tools like OpenSSL are packaging these PFX files, and that importing them to a Windows PC and re-exporting them to the central store seems to 'fix' them. letsencrypt-win-simple uses ssleay and libeay like OpenSSL does, so maybe it's inherited the same problem.\nThis may just be specific to the IIS Manager UI though. Like I mentioned, I can browse https bindings that use central store certs generated in this manner.\n. So this might be one way to do it, though it would require the use of a centralized SSL store even if it's on the local computer. letsencrypt-win-simple supports a centralized store so that's fine.\nStep one would be to prepare a regular cert or a SAN cert using the help in How to Run. Step two would be to import one of the resulting certs from the central store to the local machine's Personal or WebHosting cert store. Step three would be to create a new web binding while writing the output of Import-PfxCertificate to a variable, and then use that to create a default SSL binding.\nSo assuming you can run letsencrypt-win-simple.exe within a PowerShell script, a renewal script could look like this:\nc:\\letsencrypt-win-simple\\letsencrypt.exe --renew --test\nimport-module webadministration\n$webservercert = import-pfxcertificate -filepath [centralstore\\somecert.pfx] Cert:\\localmachine\\webhosting\nnew-webbinding -name * -ipaddress * -port 443 -protocol \"https\"\ncd IIS:\\SslBindings\ndel 0.0.0.0:443\n$webservercert | new-item 0.0.0.0!443\nI was stuck originally trying to read the thumbprint of an already-installed cert. Maybe I could fill $webservercert from a local machine cert... still fighting my way through PowerShell too much to be fancy about it.. I got this warning if I specified a manual configuration during a guided setup. I think this just means it can't (or won't) configure IIS with the new certificate. Since you're specifying a manual host I'm guessing it skips configuring an IIS binding.\nIf you set up a centralized SSL store (even on a local disk) and add the centralized SSL store support to IIS, you just need to make the bindings once in IIS; I think it will look for a cert with a matching host name and use that, even if you change the cert under its feet with an automated --renew command.. I think so, yes. What I don't know is whether IIS caches a store certificate and key for a while or not, or maybe it checks every HTTPS session, or every few sessions, or something.\nSo if the --renew command successfully replaces the cert in the store, any IIS servers using the store (including a local server using a local store) would just start using the new cert without interaction. . OK here's a wild guess based on my rudimentary PowerShell so far.\nI found I can use the .NotAfter property of a certificate for the date. I can use this to check an installed cert's expiration date against the expiration date of any certs stored in a central store, and then act if the central store cert's date is newer. For example, to update a Remote Desktop Gateway cert:\nletsencrypt.exe --renew --baseuri $eitherTheTestOrProductionURI\n$currentCert = Get-RDCertificate -Role RDGateway -ConnectionBroker $connectionBrokerHost \n$newCert = Get-PfxCertificate $centralSslStorePath+$myHostName+\".pfx\"\nIf ($newCert.NotAfter -gt $currentCert.ExpiresOn) \n{\n     Set-RDCertificate -Role RDGateway -ConnectionBroker $connectionBrokerHost -ImportPath $centralSslStorePath+$myHostName+\".pfx\"\n     Set-RDCertificate -Role RDWebAccess -ConnectionBroker $connectionBrokerHost -ImportPath $centralSslStorePath+$myHostName+\".pfx\"\n}\nThis could work for more than just Remote Desktop certs, for instance, to automatically update a secure FTP service:\nletsencrypt.exe --renew --baseuri $eitherTheTestOrProductionURI\n$currentCert = Get-ChildItem -path Cert:\\LocalMachine\\WebHosting | where {$_.Subject -eq \"CN=\"+$myHostName}\n$newCert = Get-PfxCertificate $centralSslStorePath+$myHostName+\".pfx\"\nIf ($newCert.NotAfter -gt $currentCert.NotAfter) \n{\n     $newCertThumbprint = Import-PfxCertificate -FilePath $centralSslStorePath+$myHostName+\".pfx\" -CertStoreLocation \"WebHosting\" -Confirm\n     Set-ItemProperty -Path $myFtpSiteInIISSites -Name ftpServer.security.ssl.serverCertHash -Value $newCertThumbprint\n}\nI may have specific syntax wrong, but this looks like the general idea. Also I'm missing steps to remove expired certs, which will depend greatly on what the certs are being used for. The cert you need to replace may be in \"My\" or in \"WebHosting\" depending on your choices for initial setup.\nThis all hinges on using -manual mode for the initial setup and using a centralized SSL store path, even if you don't have centralized SSL support installed. But as long as you can retrieve the cert expiration dates and you can replace certs using PowerShell, you can adapt this idea for any service that uses them.. Finally managed to make something like this work with Remote Desktop. However, Set-RDCertificate did not like the PFX files that letsencrypt.exe generated because it couldn't find the private key. I had to import them, re-export them without extended properties or other certs in the chain, then re-import them using Set-RDCertificate. That finally worked.\nThere are probably other cmdlets that won't like the central store PFX files generated. Or maybe there's a way I can omit the extended bits during generation or renewal. Otherwise, I'll have to add scripting steps to strip the unwanted details from the PFX files before attempting to use them with non-IIS things.. This is in Issue #221 as well. It's like letsencrypt.exe is looking for something that's only visible or loaded when the user running the task is also logged on the server's console. And since this is running on a server I don't like to leave users logged on idle.. OK @marcwaz try the workaround I added to Issue #221: Create your certs and the initial scheduled task, then copy the %appdata%\\letsencrypt-win-simple folder to %systemroot%\\syswow64\\config\\systemprofile\\Roaming\\letsencrypt-win-simple, then edit the scheduled task so it runs as SYSTEM.\nI don't consider this a correct solution; the correct solution would be to find out what path or environment variable letsencrypt.exe is looking for, and have it look for something else. Whatever it's looking for now isn't available unless the task's user account is logged on to the server's console or remote desktop session.. This is the same problem I'm running into in #381, where I'd want to use Let's Encrypt certificates for things that aren't IIS web sites.\nIt's not insurmountable, though. If you set up a manual configuration and have letsencrypt.exe store the certs in a centralized SSL store, you can then assign the resulting certs and keys to a FTP binding.\nThe catch is how to detect if a cert's been renewed. I'm investigating how to script a way to replace an old cert with a renewed one, for instance if the cert in the Central Store has a later expiration date than the cert being used. Most non-IIS things use PowerShell for this and as a result I'm taking a crash course in it.. There's a way to programmatically change the SSL cert and key for FTP sites, I just don't have the cert date expiration mechanism down yet.\nIt took some digging. To change the SSL cert used for FTP sites you do this in PowerShell:\nSet-ItemProperty -Path [path to FTP site in IIS:\\sites] -Name ftpServer.security.ssl.serverCertHash -Value [A working cert's thumbprint]\nYou might need to ImportModule WebAdministration first. So there's that much. I couldn't find documentation for ftpServer properties and only stumbled on this on a powershell.org forum page. \nYou'd need to detect when the cert renewed by letsencrypt.exe has a later expiration date than the one used by the FTP site, and then Set-ItemProperty the newer cert. Or if the old cert got deleted by letsencrypt.exe, just look up the thumbprint for the HTTPS site that it changed. I'm still looking around for how to look up that thumbprint.. Or just tack a PowerShell script to the end of the regularly scheduled letsencrypt.exe scheduled task, maybe? . Does using letsencrypt.exe in manual mode work? I think manual mode is not dependent on the web server software you use; as long as you can create a /.well-known/acme-challenge/ folder in your web site and tell letsencrypt.exe where this is in your file system, it might work.\nYou'd also have to tell letsencrypt.exe to use a Central SSL Store, even though it doesn't appear to actually use any components of the IIS Central Store support; it just writes .p12 files there with the names of the sites you host. Can nginx use a .p12 file directly, or do you need to split these into .pem and .key files first?\nEven if you need to use .pem files it looks like these are kept in the letsencrypt-win-simple folder that gets stored in the running user's profile. That's a whole other mess because letsencrypt.exe needs to see environment variables not normally visible to scheduled tasks, but assuming you get that working (such as running it as SYSTEM) you can do this:\nssl_certificate c:/windows/syswow64/config/systemprofile/appdata/roaming/letsencrypt-win-simple/https-acme-blah-blah/your.website.example.com-crt.pem;\nssl_certificate_key c:/windows/syswow64/config/systemprofile/appdata/roaming/letsencrypt-win-simple/https-acme-blah-blah/your.website.example.com-key.pem;\nI'm just pulling this out of nowhere, having never used nginx and only playing with le-win-simple for a very short time.. Here's a quick and dirty way to sanitize a LWS certificate for use with Remote Desktop Services, and possibly with other things such as Exchange 2016:\n$newCertPfx = Import-PfxCertificate -FilePath 'path-to-LWS-created-pfx.pfx' -CertStoreLocation Cert:\\LocalMachine\\My -Exportable\n$tempPasswordPfx = ConvertTo-SecureString -String \"NothingPersonal\" -Force -AsPlainText\nExport-PfxCertificate -cert $newCertPfx -FilePath 'some-temp-path\\temp-pfx.pfx' -Force -NoProperties -Password $tempPasswordPfx\nRemove-Item -Path $newCertPfx.PSPath\n// do whatever you need to do with the re-exported cert at some-temp-path\\temp-pfx.pfx\n// for instance:\nSet-RDCertificate -Role RDGateway -ConnectionBroker 'your-connection-broker-host' -ImportPath 'some-temp-path\\temp-pfx.pfx' -Password $tempPasswordPfx -Force\n// and when you're done, delete the temporary PFX file\nRemove-Item -Path 'some-temp-path\\temp-pfx.pfx'\n. I just verified with the current build (1.9.3) that the CertificatePath setting works as expected. Backslashes seem to work. However, letsencrypt.exe still stores some information in %appdata%\\letsencrypt-win-simple[BaseURI].\nIf Z:\\ is a network drive, I'd instead use a UNC path.. I've run into this when trying to import keys into Remote Desktop Services (Issue #400). It might not be stripping the private key so much as being unable to find the thing.\nThe quick fix solution was to import the PFX into a Personal store and re-export it without the extended attributes or additional certificates. \nThe long term solution would be to somehow specify what information goes into a LWS-generated PFX file. But I'm just as happy if I can script the import - re-export in PowerShell or something.. I just finished and tested an import / re-export script in PowerShell that can strip off unneeded details in a PFX file, so a non-IIS service like RDS can use it. I think it'll fix the problem with Exchange 2013 as well. Check issue #400 for the script sample.. You're using a centralized SSL store to do this, so LWS will copy the file for each host name. When you enable centralized store capability in IIS, the web server then looks for certs that match the site host names. Since you have multiple host names, IIS will look for one cert for each host name.\nSure they'll be all copies of the same cert, but IIS doesn't have a separate setting to go, \"this site uses this cert file, this site uses this one,\" and so on.\nSo this behaviour is by design, to accommodate how IIS looks for these certs.. ",
    "asipicki": "Sorry but I didn't understand the explanation. I have a Windows Server 2012 English Version and I have the same issue. If I run the schedule task manually, it works.\nHowever, If it runs automatically, I get a 0x103 error.\nCould anyone tell me how to fix the issue?. I'm trying to download the file from this URL and I can't.\nCould you provide me an URL to download it?\nThanks!\n2017-07-20 16:13 GMT-03:00 weyCC81 notifications@github.com:\n\nHi asipicki\nDo you want to run it with the same user as you did your configuration or\nwith a different service-user?\nsame user\n--> Windows Server 2012 = apply KB2968540, Windows Server 2012 R2 = apply\nKB3133689\nservice-user\n--> apply Workaround / wait for Version 2\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/394 / (change\nthe source-code)\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/221#issuecomment-316802191,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AM_7oIPbgweW79uPUOoUNRa1btkzdf6mks5sP6bfgaJpZM4Ib2pf\n.\n. \n",
    "SH-Solutions": "In previous versions the old certificates are still present and not deleted because of this faulty check.\n. ",
    "dulemis": "Hi!\nI have this Issue, IIS doesn't allow puny code in bindings (only real domain name), but Lets encrypt Win simple doesnt list \u00e5\u00e4\u00f6 .. ",
    "vrbyjimmy": "Hi,\nI've created a simple ACME client based on AcmeSharp and BouncyCastle to issue an ECDSA certificates from LE. You are welcome to use it or take a look at how can the CSR request be made to obtain an ECDSA certificate from LE.\nhttps://github.com/vrbyjimmy/EcdsaAcmeNet. Happened to me as well. The reason behind that for me was use of a proxy server in network i was connected to. .Net by default does not use default credentials for proxy connections. Try to add this:\nxml\n<system.net>\n    <defaultProxy useDefaultCredentials=\"true\" />\n</system.net>\nto App.config of lets-encrypt-win-simple. It should be there by default I guess.\nIf you want to issue an ECDSA certificate, you might wanna try out simple ACME client for that:\nhttps://github.com/vrbyjimmy/EcdsaAcmeNet. Happened to me as well. The reason behind that for me was use of a proxy server in network i was connected to. .Net by default does not use default credentials for proxy connections. Try to add this:\nxml\n<system.net>\n    <defaultProxy useDefaultCredentials=\"true\" />\n</system.net>\nto App.config of lets-encrypt-win-simple. It should be there by default I guess.\nIf you want to issue an ECDSA certificate, you might wanna try out simple ACME client for that:\nhttps://github.com/vrbyjimmy/EcdsaAcmeNet\n. ",
    "gsdnano": "I was able to reproduce this on first try on 2012 (IIS 8.5) server with SNI with IP binding of \"all unassigned\": http://i.imgur.com/KYvOl0C.png\nMultiple 2012 servers with all sites running SNI and bound to \"all unassigned\" = half worked, half had to manually apply (and worked fine after that).\nThe one 2008 server I used worked fine and it was even using specific IP bindings, but not SNI.\nVersion 1.9.0. I used this tool for 22 websites on the SNI servers, great app.\n. ",
    "mrlindstrom": "Actually, this looks like it might be Issue #195 , so you can probably dupe this to that.  I've added my thumbs up on that issue/request.  Also, you might get more people here with that same issue if they followed this guide like I did: https://forums.servethehome.com/index.php?resources/letsencrypt-a-2012-r2-web-application-proxy.16/\n. ",
    "tehNinth": "I'm aware of the manual nature, which is why I made the description \"Wait for user input before requesting challenge(s) from server\"\nThis is for a Google App Engine instance, where files have to be uploaded from a local repo onto the server.\nI simply point --webroot to the local repo, then when the files are generated I run the upload command (it's a python script with detailed output), which takes ~15 seconds.\nIt's already set up to forward HTTP requests to the challenge files, so when it's uploaded I just hit enter and wait for the verification to pass and the certs to download.\nThen I go to an SSL Certificates section and upload {domain}-chain.pem and {domain}-key.pem\nI haven't figured out how to make SAN certs yet though, the client seems to crash when I use --san.\nI don't have IIS set up or anything.\n. That's a great idea\n. ",
    "mchilson": "This would be a great feature to add so we don't have to leave 80 and 443 open to the world on our app hosting. thanks!\n. ",
    "NobodyOfNaught": "I would really like this support aswell. ",
    "khobbits": "Looks like this is addressed in #395 . ",
    "kscheel": "395 only allows to solve the dns challenge when azure dns is used, right?\nMany DNS providers have a HTTP-API. Would be nice if it was possible to just provide an API-URL to LEWS. Then a lot of different DNS providers could be used :). Does this only support solving the dns challenge when I use Azure DNS?\nMany DNS providers have a HTTP-API. Would be nice if it was possible to just provide an API-URL to LEWS. Then a lot of different DNS providers could be used :). ",
    "willis936": "Is there a way to change the webroot for renewals at all?  I looked through all files in the vault and letsencrypt-win-simple directory and the scheduled task.  I didn't see the webroot specified anywhere.. ",
    "rherbil": "Hello, same issue here.\nIt would be nice to get rid of the registry key and handle all this in a config file instead.\n. ",
    "JohnLahr": "It doesn't provide any new information, just sort of repeats itself. It's still just claiming the save location is in an invalid directory despite the fact that I can see the file there.\n. ",
    "jason1234": "thanks man.\n. ",
    "AnderssonPeter": "Nvm found it!\nC:\\Users[CurrentUser]\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n. ",
    "tiagondelgado": "I just found an article that says TLS 1.1 and 1.2 are available on 2008 R2.  I'm running 2008 (non R2) which is probably the issue here.\ufeff  Thanks for the program as i'm sure I can use this elsewhere.\nsysteminfo | findstr OS\nOS Name:                   Microsoft\u00ae Windows\u00ae Web Server 2008\nOS Version:                6.0.6002 Service Pack 2 Build 6002\nOS Manufacturer:           Microsoft Corporation\nOS Configuration:          Standalone Server\nOS Build Type:             Multiprocessor Free\nBIOS Version:              Phoenix Technologies LTD 6.00, 11-06-2014\n. ",
    "TetraAsh": "Build of exe for this fix hosted here - http://www.ashleyunwin.com/letsencrypt-win-simple-work-server-2008-fixed/. Build of exe for this fix hosted here - http://www.ashleyunwin.com/letsencrypt-win-simple-work-server-2008-fixed/. Build of exe for this fix hosted here - http://www.ashleyunwin.com/letsencrypt-win-simple-work-server-2008-fixed/. ",
    "gallatin17": "Alright, found my on mistake (or rather misunderstanding). I downloaded and compiled the Project on my Surface within the path \"C:\\Users\\galla\\Source\\Repos\\letsencrypt-win-simple-master\". This Path didn't exist on my Server. I compiled the Project directly under C:\\, uploaded and started it in the same path on my server.\nNow all's fine, the renewal Task is created.\nI therefore close my issue.\n. ",
    "MonsterMMORPG": "ok i have binded all domains manually and everything works awesome\nty very much for such awesome product\nby the way for other readers\nif you get this below error restart your app and try to get domain certificates 1 by 1 :)\n\n. ",
    "mendel129": "Hey, thanks! Missed that one! I did check the wiki before posting this actually, but only looked at the cmdline arguments... \n. <setting name=\"CertificateStore\" serializeAs=\"String\">\n        <value>Computer</value>\n      </setting>\nworks perfectly!\nthanks!\n. ",
    "pukovec": "As there were no unit tests, I hope I haven't broken anything, however it will definitely be important to re-test it. We are using the code on our servers so hopefully the potential bugs will be identified quickly. The code is still far from being perfect but it should be way easier to extract methods to separate class and mock out the logger and console. I would like to get rid of that static members in Program.cs but I haven't touched them yet as the code base was quite new for me and I didn't want to affect the stability too much, so I will do the rest later if you review the current version and decide to accept the pull request.\n. ",
    "Martijn085": "Thanks it is now clear.\n. Would be great!. Sorry for the late reply, but how can i use this? \nThe WebRootPatch keeps changing to the original location. How can i exclude some websites and use the location in the registry?\nI have tried --webroot \"C:\\location\" and  --excludebindings \"subdomein\"\nBut it keeps changing to de IIS WebRootPath. Thanks for the fast reply.\nBut how can i renew on schedule and keep the path in the registry to the IIS default path ?\nI can do it manualy but then the certificate renews everytime i run the script.\nletsencrypt.exe --plugin manual --manualhost sub.domain.nl --webroot D:\\Website --installation iis --installationsiteid 2\nI have 15 sites only with 443 (dont want port 80 open for this).  I just want to renew on schedule and create the certificate in the IIS default path and then add the certificate to the IIS site ID where it belongs.. Im still figuring it out... but it not seems possible to renew without change the webrootpath by \"letsencrypt.exe\"?\nI can make a batch file with this cmd line and run it every 60 days or so, but that is not what i`m looking for.\nletsencrypt.exe --plugin iissite --siteid 2\nIs it possible to add a option in the setting.config file like: \n<setting name=\"ChangeWebRootFolder\" serializeAs=\"String\">\n    <value>false</value>\n</setting>\nMy setup in IIS:\n\n1 \"Default Web Site\" with a binding on port 80 with a catch all (*)\n14 websites with only a binding on port 443 (all websites have there own sub domain)\n\nAll this 14 websites have diverent folders on a data partition. This folders are not open for port 80 to renewal. That would be the \"Default Web Site\" folder. So all websites must renew by this website.\nThis is my Renewals value in the registry (1 example):\n{\"Date\":\"2018-04-01T22:18:24.151153Z\",\"Binding\":{\"Host\":\"ssub.domain.nl\",\"WebRootPath\":\"%SystemDrive%\\\\inetpub\\\\wwwroot\",\"SiteId\":7,\"AlternativeNames\":[],\"PluginName\":\"IIS\",\"Plugin\":{\"Name\":\"IIS\"}},\"CentralSsl\":null,\"San\":\"false\",\"KeepExisting\":\"False\",\"Script\":null,\"ScriptParameters\":null,\"Warmup\":false}\nThe point is that i do not want to change this WebRootPath so the renewal always use the Default Web Site.. Ok, thanks for the explenations.. ",
    "clarity99": "Not sure it is the same as I had just SNI cert before and that got changed - in the gui when imclicked on https binding it was set to the new letsencrypt cert. i'll try to reproduce again, But I'm away until Sunday. \n. Yeah, it's not renewing the certs anymore:\nChecking Renewals\n Checking IIS psihoterapija.robertivanc.com (C:\\inetpub\\robWpTerapija) Renew After 3/6/2017\n Checking IIS sfu-rezervacije.robertivanc.com (C:\\inetpub\\sfu-rezervacije) Renew After 3/1/2017\n Checking IIS sfu-rezervacije.awakeheart.net (C:\\inetpub\\sfu-rezervacije) Renew After 3/1/2017\n Checking IIS webmail.psihoterapijacenter.si (C:\\inetpub\\corp\\webmail) Renew After 3/1/2017\nNow I am not sure which date format is this supposed to be, if it's american, this is wrong, as these sfu-rezervacije certs for example expire at the end of this month, not in march!\n. Same here. The workaround was to request the certs again for the sites that exhibit this problem (not all were). ",
    "cmoski": "Agree with everything above -- the only note I'd have is that although it is called the Personal store, it is technically in machine certificate store under a folder called 'Personal' \nIt is an odd place DirectAccess/SSTP RAS Manager pulls from, although IIS will check both locations when setting up the binding. This behavior is consistent on Windows 2003, 2008, and 2012 Server versions I have had access to check.\nI haven't seen anyone encrypting Windows SSTP via LetsEncrypt yet either..\n. ",
    "henno": "Before I start creating the certification renewal script for SSTP, has anyone else done it already?. Well, my script looks like this:\nhttps://gist.github.com/henno/e399cec2571ca35effceab1a14b0fba7\nI requies human to run it :-(. Not to my knowledge. I got tired of doing the manual work and switched to 3y paid SSL cert.. ",
    "markysoft1": "I would also be very grateful for it.. ",
    "filthyfreak": "I've mopped up a script that will setup RRAS SSTP with the generated cert. From my internal testing it seems to work. I had an issue where I needed the IIS *:443 binding to use the new cert otherwise RRAS would not start so I added an optional argument to handle that.\nSave script as ./Scripts/ImportSSTP.ps1\nExample command lines;\n\nC:/letsencrypt/letsencrypt.exe --plugin iissite --siteid 1 --validation selfhosting --certificatestore My --installation iis,manual --installationsiteid 1 --script \"C:/letsencrypt/Scripts/PSScript.bat\" --scriptparameters \"C:/letsencrypt/Scripts/ImportSSTP.ps1 {5} 1\"\nC:/letsencrypt/letsencrypt.exe --plugin manual --manualhost a.example.com,b.example.com --validation selfhosting --certificatestore My --installation iis,manual --installationsiteid 1 --script \"C:/letsencrypt/Scripts/PSScript.bat\" --scriptparameters \"C:/letsencrypt/Scripts/ImportSSTP.ps1 {5} 1\"\n\n```\nparam(\n    [Parameter(Position=0,Mandatory=$true)]\n    [string]$NewCertThumbprint,\n    [Parameter(Position=1,Mandatory=$false)]\n    [int]$RecreateDefaultBindings = 1\n)\nImport-Module RemoteAccess\n$CertInStore = Get-ChildItem -Path Cert:\\LocalMachine -Recurse | Where-Object {$_.thumbprint -eq $NewCertThumbprint} | Sort-Object -Descending | Select-Object -f 1\nif($CertInStore){\n    try{\n        # Cert must exist in the personal store of machine to bind to RRAS\n        if($CertInStore.PSPath -notlike \"*LocalMachine\\My*\"){\n            $SourceStoreScope = 'LocalMachine'\n            $SourceStorename = $CertInStore.PSParentPath.split(\"\\\")[-1]\n        $SourceStore = New-Object  -TypeName System.Security.Cryptography.X509Certificates.X509Store  -ArgumentList $SourceStorename, $SourceStoreScope\n        $SourceStore.Open([System.Security.Cryptography.X509Certificates.OpenFlags]::ReadOnly)\n\n        $cert = $SourceStore.Certificates | Where-Object {$_.thumbprint -eq $CertInStore.Thumbprint}\n\n\n\n        $DestStoreScope = 'LocalMachine'\n        $DestStoreName = 'My'\n\n        $DestStore = New-Object  -TypeName System.Security.Cryptography.X509Certificates.X509Store  -ArgumentList $DestStoreName, $DestStoreScope\n        $DestStore.Open([System.Security.Cryptography.X509Certificates.OpenFlags]::ReadWrite)\n        $DestStore.Add($cert)\n\n\n        $SourceStore.Close()\n        $DestStore.Close()\n\n        $CertInStore = Get-ChildItem -Path Cert:\\LocalMachine\\My -Recurse | Where-Object {$_.thumbprint -eq $NewCertThumbprint} | Sort-Object -Descending | Select-Object -f 1\n    }\n    \"Stopping RemoteAccess service to prevent errors...\"\n    Stop-Service RemoteAccess\n    if($RecreateDefaultBindings -eq 1)\n    {\n        \"Checking if we need to replace default binding...\"\n        $replace = $false;\n        $binds = Get-WebBinding -Name \"Default Web Site\" -Protocol https;\n        for ($i=0; $i -lt $binds.length; $i++)\n        {\n            if(($binds[$i] | Select-Object -ExpandProperty bindingInformation) -eq \"*:443:\")\n            {\n                \"Default binding detected. Deleting...\"\n                $binds[$i] | Remove-WebBinding;\n                $replace = $true;\n                break;\n            }\n        }\n        if($replace -eq $true)\n        {\n            \"Creating new default binding...\"\n            $binding = New-WebBinding -Name \"Default Web Site\" -Protocol https -IPAddress * -Port 443 -Force;\n            $binds = Get-WebBinding -Name \"Default Web Site\" -Protocol https;\n            for ($i=0; $i -lt $binds.length; $i++)\n            {\n                if(($binds[$i] | Select-Object -ExpandProperty bindingInformation) -eq \"*:443:\")\n                {\n                    $binding = $binds[$i];\n                    break;\n                }\n            }\n            \"Assigning certificate to new default binding...\"\n            $binding.AddSslCertificate($NewCertThumbprint, \"my\");\n        }\n    }\n    \"Assigning certificate to RRAS...\"\n    Set-RemoteAccess -SslCertificate $CertInStore\n    \"SSTP SSL certificate has been applied, restarting RemoteAccess...\"\n    Start-Service RemoteAccess\n}catch{\n    \"Cert thumbprint was not set successfully\"\n    \"Error: $($Error[0])\"\n}\n\n}else{\n    \"Cert thumbprint not found in the cert store... which is strange because it should be there.\"\n}\n```. I haven't tested it with multiple sites/bindings but it should work. See https://github.com/PKISharp/win-acme/wiki/How-To-Run\nOne example for multiple sites would be;\n\nC:/letsencrypt/letsencrypt.exe --plugin iissite --siteid 1,2,3 --validation selfhosting --certificatestore My --installation iis,manual --script \"C:/letsencrypt/Scripts/PSScript.bat\" --scriptparameters \"C:/letsencrypt/Scripts/ImportSSTP.ps1 {5} 1\"\n\nOr you could have one scheduled task for SSTP and another for the rest.. Thanks for asking, feel free to use anything I post.. ",
    "mfred01": "Thank for everyone contributed to SSTP script, as I'm happily going to put it in production to a bunch of servers!\nReally, those servers have also Gateway Services role which should benefit of the same certificate used by SSTP and I suppose I'll need to create a new batch file... something like :  PSRDS_SSTP_Certs.bat (..as Gateway Services and SSTP roles cohexists in the same server with no problem).\nI'll keep you informed by the way...\nJust one little issue: the sample ImportSSTP.ps1 is not present inside  win-acme.v1.9.11.2.zip\nInfact, I see letsencrypt-win-simple/win-acme.csproj has this tag:\n<None Include=\"Scripts\\ImportSSTP.ps1\" />\n...well, is ImportSSTP.ps1 supposed not to be included in the .zip file ?\n. ",
    "orangevan": "@filthyfreak @WouterTinus \nI found this script doesn't work on Server 2008 R2 (and probably older) due to a lack of powershell module \"RemoteAccess\"  Below is my modified version that seems to work.  (untested on 2012 and newer)  If this doesn't work on 2012, perhaps we should include it as a second version of ImportSSTP.ps1  (maybe ImportSSTP2008r2.ps1)\n```\nparam(\n    [Parameter(Position=0,Mandatory=$true)]\n    [string]$NewCertThumbprint,\n    [Parameter(Position=1,Mandatory=$false)]\n    [int]$RecreateDefaultBindings = 1\n)\n$CertInStore = Get-ChildItem -Path Cert:\\LocalMachine -Recurse | Where-Object {$_.thumbprint -eq $NewCertThumbprint} | Sort-Object -Descending | Select-Object -f 1\nif($CertInStore){\n    try{\n        # Cert must exist in the personal store of machine to bind to RRAS\n        if($CertInStore.PSPath -notlike \"*LocalMachine\\My*\"){\n            $SourceStoreScope = 'LocalMachine'\n            $SourceStorename = $CertInStore.PSParentPath.split(\"\\\")[-1]\n        $SourceStore = New-Object  -TypeName System.Security.Cryptography.X509Certificates.X509Store  -ArgumentList $SourceStorename, $SourceStoreScope\n        $SourceStore.Open([System.Security.Cryptography.X509Certificates.OpenFlags]::ReadOnly)\n\n        $cert = $SourceStore.Certificates | Where-Object {$_.thumbprint -eq $CertInStore.Thumbprint}\n\n\n\n        $DestStoreScope = 'LocalMachine'\n        $DestStoreName = 'My'\n\n        $DestStore = New-Object  -TypeName System.Security.Cryptography.X509Certificates.X509Store  -ArgumentList $DestStoreName, $DestStoreScope\n        $DestStore.Open([System.Security.Cryptography.X509Certificates.OpenFlags]::ReadWrite)\n        $DestStore.Add($cert)\n\n\n        $SourceStore.Close()\n        $DestStore.Close()\n\n        $CertInStore = Get-ChildItem -Path Cert:\\LocalMachine\\My -Recurse | Where-Object {$_.thumbprint -eq $NewCertThumbprint} | Sort-Object -Descending | Select-Object -f 1\n    }\n    \"Stopping RemoteAccess service to prevent errors...\"\n    Stop-Service RemoteAccess\n    if($RecreateDefaultBindings -eq 1)\n    {\n        \"Checking if we need to replace default binding...\"\n        $replace = $false;\n        $binds = Get-WebBinding -Name \"Default Web Site\" -Protocol https;\n        for ($i=0; $i -lt $binds.length; $i++)\n        {\n            if(($binds[$i] | Select-Object -ExpandProperty bindingInformation) -eq \"*:443:\")\n            {\n                \"Default binding detected. Deleting...\"\n                $binds[$i] | Remove-WebBinding;\n                $replace = $true;\n                break;\n            }\n        }\n        if($replace -eq $true)\n        {\n            \"Creating new default binding...\"\n            $binding = New-WebBinding -Name \"Default Web Site\" -Protocol https -IPAddress * -Port 443 -Force;\n            $binds = Get-WebBinding -Name \"Default Web Site\" -Protocol https;\n            for ($i=0; $i -lt $binds.length; $i++)\n            {\n                if(($binds[$i] | Select-Object -ExpandProperty bindingInformation) -eq \"*:443:\")\n                {\n                    $binding = $binds[$i];\n                    break;\n                }\n            }\n            \"Assigning certificate to new default binding...\"\n            $binding.AddSslCertificate($NewCertThumbprint, \"my\");\n        }\n    }\n    \"Assigning certificate to RRAS...\"\n    Netsh ras set sstp-ssl-cert hash=$NewCertThumbprint\n    \"SSTP SSL certificate has been applied, restarting RemoteAccess...\"\n    Start-Service RemoteAccess\n}catch{\n    \"Cert thumbprint was not set successfully\"\n    \"Error: $($Error[0])\"\n}\n\n}else{\n    \"Cert thumbprint not found in the cert store... which is strange because it should be there.\"\n}\n```\n. ",
    "zkafr": "As I remember, I have finally not used the script directly with letsencrypt-win-simple. I had to do it as fast as possible (using a worst way to achieve it).\nWorking way (but ugly)\nI created a scheduled task that :\n1. execute letsencrypt-win-simple\n2. execute a script like this\nAdd-PSSnapin Microsoft.Exchange.Management.PowerShell.E2010\nImport-ExchangeCertificate -FileData ([Byte[]]$(Get-Content -Path %userprofile%\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\$some_fqdn$-all.pfx -Encoding Byte -ReadCount 0)) -Password:(ConvertTo-SecureString (-join ((65..90) + (97..122) | Get-Random -Count 20 | % {[char]$_})) -AsPlainText -Force) | Enable-ExchangeCertificate -Services 'IMAP, POP, SMTP, IIS'\nThis powershell script imports the certificate with a generated password. The password is 20 random characters A-z, you can add digits by modifying the join. You have just to replace the $some_fqdn$ by your name and it is done.\nIt was the easiest and fastest way I had many month ago. As I said, I had to do it very fast...\nA better way (to try)\nI can not test it, I have no any Exchange to try it for now... But I think this way will work (and it is prettier than the first one...)\nAs it is described here, you can do it.\nIt seems to be very easy with this : {2} - pfxFilename - The filename and location of the PFX file. \nSo, you have to :\n1. call letsencrypt-win-simple with the --script and the path to your script\n2. add the following argument to the call --scriptparameters \"{2}\"\n3. in the script above, replace %userprofile%\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\$some_fqdn$-all.pfx by $args[0]\nPlease try it and tell us if it worked :-). ",
    "Chluz": "Hi Guys, \nI needed to setup automatic renewal of the certificates for exchange 2013, so used your code as a starting point for a few things. \nThe idea is to run the letsencrypt.exe in manual node (m) as described here letsencrypt.exe --san --centralsslstore C:\\Central_SSL\\ --script C:\\LetsEncrypt/deploy_script.bat --scriptparameters \"{0} {2}\"\nBecause we are using --centralstore, {0} will correspond to the certificate name, and {2} to the folder that contains the certificate.\nThe script C:\\LetsEncrypt/deploy_script.bat is as follows:\nset arg1=%1\nset arg2=%2\nc:\\windows\\Sysnative\\WindowsPowerShell\\v1.0\\powershell.exe -command \". 'C:\\Program Files\\Microsoft\\Exchange Server\\V15\\bin\\RemoteExchange.ps1'; Connect-ExchangeServer -auto; . 'C:\\LetsEncrypt/importcertexchange.ps1' %arg1% %arg2% \"\nI learnt, after much searching, that it is absolutely necessary to use Sysnative in the path for powershell for the exchange command shell call to work from the letsencrypt call. for testing purposes, when calling outside of letsencrypt, this should be replaced with system32.\nThe script C:\\LetsEncrypt/importcertexchange.ps1 does all the important work, and is as follows\n```\nPowershell script to import generated certificate and set it as main certificate for exchange\nthe script also deletes the old certificate if it is present\nparam (\n [string]$CERTNAME,\n [string]$CERTFOLDER\n)\n$CERTPATH = $CERTFOLDER + \"\\\" + $CERTNAME + \".pfx\"\n $OUTLOOKIDENT = \"msstd:\" + $CERTNAME\n $THUMBPRINTSAVE = $CERTFOLDER + \"\\old_thumprint.txt\"\nConnect to exchange CMS\nGet-PSSnapin -registered | ? {$.Name -match \"Microsoft.Exchange.Management.PowerShell\" -and ($.Name -match \"Admin\" -or $.Name -match \"E2010\" -or $.Name -match \"SnapIn\")} | Add-PSSnapin\nGet cert thumprint\n$CERTTHUMBPRINT = (Get-PfxCertificate $CERTPATH | select -ExpandProperty Thumbprint)\nif ( Test-Path $THUMBPRINTSAVE ) {\n    \" Old certificate found, it will be compared to new thumprint.\"\n    $OLDTHUMBPRINT = Get-Content $THUMBPRINTSAVE\n    }\nif ( $OLDTHUMBPRINT -eq $CERTTHUMBPRINT ) {\n    \"No new certificate has been found, the certificate will not be replaced.\"\n    }\nelse {\n    \"A new certificate has been found, the certificate will be imported and activated.\"\n    # Import certificate\n    Import-ExchangeCertificate -Server exchangeserv  -FileName $CERTPATH\n# Enable the newly imported certificate\nEnable-ExchangeCertificate -Thumbprint $CERTTHUMBPRINT -Services POP,IMAP,UM,IIS,SMTP,UMCallRouter -Confirm:$false -force\n#Enable-ExchangeCertificate -Thumbprint $CERTTHUMBPRINT -Services UM -Confirm:$false -force\n\n\n# Set internal outlook identity\nSet-Outlookprovider -identity EXCH -Certprincipalname $OUTLOOKIDENT\n# Set internal outlook identity\nSet-Outlookprovider -identity EXPR -Certprincipalname $OUTLOOKIDENT\n\nif ( Test-Path $THUMBPRINTSAVE ) {\n    # delete old thumbprint file\n    Remove-ExchangeCertificate -Server exchangeserv -Thumbprint $OLDTHUMBPRINT -Confirm:$false\n    Remove-Item  $THUMBPRINTSAVE \n    }\n\n# Save thumbprint to file\nECHO $CERTTHUMBPRINT >> $THUMBPRINTSAVE\n\n# Restart IIS\n#iisreset /noforce\n}\n\n```\nwhere you should replace exchangeserv  with your exchange server fqdn. \nI have commented the iisreset, as I don't think that the iis server needs to be restarted to take into account the new certs. \nHope this helps, its tested and works for me.\nPS: I'm not sure if the script call needs to be added to the automatically created scheduled task. Does anyone know ?. ",
    "davequested": "Would love this feature too. We'd want to run it as part of an unattended build process and would want it to not ask any questions :)\n. We have also tried to use --keepexisting, but any https bindings which don't have SNI enabled get overwritten with the certificate being created.\nIf we go and change the bindings before hand to SNI enabled, they don't get overwritten. \nIs there a fix for this? We have hundreds of existing SSL bindings and don't want to update them all! \n. It would be fantastic if the manual command line method would:\n- Not ask if you want to replace the scheduled task\n- Provide an optional flag to install the IIS binding with the cert attached.\nAll I can find is using --script and doing something with powershell? Would be awesome if the app handled all this as it does for the non-commandline approach.\n. Sure, here's an example:\nhttps://www.ssllabs.com/ssltest/analyze.html?d=www.artefacto.com.mx&hideResults=on&latest. Is there a way to get these ECDSA certs using Win-ACME?. ",
    "chcoust": "Hello, \nis this \"feature\" implemented in the latest version ? with another argument ?. ",
    "rocketraman": "@rkerber  Since #151 is closed now, and this is still not done, can this be upgraded from \"Question\" to \"Enhancement\"?. Same problem here. Running as admin so I don't think its a permissions issue.. Yikes, this is a big problem. No response from the author on this seems to indicate this project is dead? Is there a fork which is better maintained?. ",
    "habakuk007": "Yeah would be very useful to automate letsencrypt-win-simple.... ",
    "RealFlachmann": "LetsEncrypt-win-simple is fully automatic, except this one single manual confirmation step (usually 'n', if the task already exists). I also like to have a parameter, something like --createtask, or whatever.\n. Could it simply be, that letsencrypt-win-simple does not support the creation of certificates for multiple addresses? E.g. agga.it and www.agga.it? This would explain the error code SSL_ERROR_BAD_CERT_DOMAIN.\nOr, is there is a way to create certifier for multiple host names?\n. Problem had been solved meanwhile. KyrTool has an option to display the certifier structure to clarify the hierarchy. In addition multiple certifier can be created using --san plus --manualhost. . Thank you, WouterTinus. \nI now ran 1.9.4 beta6 with:\nletsencrypt.exe\" --emailaddress my.address@mailme.com --signeremail my.address@mailme.com --usedefaulttaskuser --accepttos --san --manualhost agga.it,www.agga.it --webroot \"F:\\Domino\\Data\\domino\\html\" --warmup --plugin Manual\n\nThe global logger has been configured\nLet's Encrypt (Simple Windows ACME Client)\nRenewal Period: 60\nCertificate Store: WebHosting\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nCertificate Folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nGetting AcmeServerDirectory\nCalling Register\nUpdating Registration\nSaving Registration\nSaving Signer\nScanning IIS Sites\nIIS Version not found in windows registry. Skipping scan.\nScanning IIS Sites\nIIS Version not found in windows registry. Skipping scan.\nAuthorizing Identifier agga.it Using Challenge Type http-01\nWriting challenge answer to F:\\Domino\\Data\\domino\\html.well-known/acme-challenge/3lCSbc2zizfvZXeIPhHn-NQiCB2EKZm9NdmgHzEbW10\nWaiting for site to warmup...\nAnswer should now be browsable at http://agga.it/.well-known/acme-challenge/3lCSbc2zizfvZXeIPhHn-NQiCB2EKZm9NdmgHzEbW10\nSubmitting answer\nRefreshing authorization\nAuthorization Result: valid\nAuthorizing Identifier www.agga.it Using Challenge Type http-01\nWriting challenge answer to F:\\Domino\\Data\\domino\\html.well-known/acme-challenge/fGjbqDsqeJDqfpDYvH6eDED1dCwQcNIFWcRgmYsUCFs\nWaiting for site to warmup...Answer should now be browsable at http://www.agga.it/.well-known/acme-challenge/fGjbqDsqeJDqfpDYvH6eDED1dCwQcNIFWcRgmYsUCFs\nSubmitting answer\nRefreshing authorization\nAuthorization Result: valid\nRequesting Certificate: {dnsIdentifier}\nRequest Status: Created\nSaving Certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\agga.it-crt.der\nSaving Issuer Certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ca-0C11414300000B638C7A6409866CA302-crt.pem\nSaving Certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\agga.it-all.pfx\nInstalling Non-Central SSL Certificate in the certificate store\nOpened Certificate Store My\n Set private key exportable\nSet private key exportable\nAdding Certificate to Store\nClosing Certificate Store\nInstalling Non-Central SSL Certificate in server software\n WARNING: Unable to configure server software.\nOpened Certificate Store My\nClosing Certificate Store\nAdding renewal for [Manual] [2 bindings - agga.it, ... @ F:\\Domino\\Data\\domino\\html]\nSo far all looks great. :-)\n\nSadly, the job still asks for the manual confirmation of the reminder task. I know, that there are already some issues open on this...:\n\nDo you want to replace the existing letsencrypt-win-simple httpsacme-v01.api.letsencrypt.org task? (y/n)\nDeleting existing Task letsencrypt-win-simple httpsacme-v01.api.letsencrypt.org from Windows Task Scheduler.\nCreating Task letsencrypt-win-simple httpsacme-v01.api.letsencrypt.org with Windows Task scheduler at 9am every day.\nRemoving existing scheduled renewal Capturing the property value threw an exception: NullReferenceException\nRenewal Scheduled [Manual] [2 bindings - agga.it, ... @ F:\\Domino\\Data\\domino\\html] Renew After 03.10.2017\nWould you like to start again? (y/n)\n\nSo, there is a NullReferenceException now...\n. Thanks, I removed task and regedit key as described in the Wiki. Then retried using 1.9.4 beta7, again without the two new parameters --notaskscheduler and --closeonfinish:\n\nCreating Task letsencrypt-win-simple httpsacme-v01.api.letsencrypt.org with Windows Task scheduler at 9am every day.\nRenewal Scheduled [Manual] [2 bindings - agga.it, ... @ F:\\Domino\\Data\\domino\\html] Renew After 04.10.2017\n\nLooks good now, task and regedit key had been recreated. I'd appreciate, if these new parameters go to the documentation as well (#494).\n. Thanks, that would be great.. Very good, thanks a lot!\nI also saw the switch --signeremail somewhere. Does it exist as well, or was it just a suggestion somewhere in the discussions that I took for real?\nI stress to enhance the --plugin documentation, maybe as a separate wiki entry. There is a wiki for \"Server Plugins\", but the whole section is very confusing to me and seems to be more for programmers. So, for most users it would be very helpful to determine which plugin is to be used when, best with examples.\n. Ok, thanks for clarification. So I can remove --signeremail from my command line.  :-). It depends, if you own both domains, with and without the www, which is usually the case.. ",
    "dlidstrom": "I tried to fix this in #457 which fixes another (duplicate) issue of this one.. Has progress stopped completely? Perhaps one of the forks could take over the torch if @Lone-Coder doesn't have the time? Issues keep piling up\u2026. @WouterTinus please find a way to merge this with master, or make this the master branch. This project is important to us Windows devs that it would be a shame if progress stopped. It seems this branch is the best way going forward, IoC or not. Don't you agree? Thanks!. \ud83d\udc4d\ud83c\udffb. With Git there are many possibilities. One that I personally like is to have master be the next release always. To achieve this here you can create a 1.x branch from current master and then reset master to the 2.x branch. It's a suggestion, you guys do what you feel is best!. Duplicate of #258.. Thanks!. Related ACMESharp issue: https://github.com/ebekker/ACMESharp/issues/260. Make sure you don't request new certificate on each deploy. Your setup\nscripts should request certificate once and then used for 60-90 days until\nrenewed. I made the mistake to request certificate on each deploy until I\ngot request denied from letsencrypt (which does rate limiting). Not sure\nthis is your problem though, but it's a good tip nonetheless.\ntis 27 juni 2017 kl. 14:04 skrev robortly notifications@github.com:\n\n[image: image]\nhttps://user-images.githubusercontent.com/11662528/27586602-942597a6-5b73-11e7-987a-01a40ea39769.png\nWhen I want to deploy my website,I meet this problem. Can someone help me\nto slove it?\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/465, or mute\nthe thread\nhttps://github.com/notifications/unsubscribe-auth/AAWsAUrvlpa1URH7ReNo5uxad-iT-xKZks5sIO-ygaJpZM4OGh9v\n.\n. Wouter, an idea. When you answer questions like this one. Why not create a\nwiki page and refer to that one? It might be interesting for more people.\nfre 27 okt. 2017 kl. 22:42 skrev Wouter Tinus notifications@github.com:\n\nDelete the .exe and everything in the folder with it\nDelete the configuration folder from %programdata% (or %appdata% for\n   older versions)\nDelete the scheduled task from the Windows Task Scheduler\nDelete the registry keys under HKLM/Software (or HKCU/Software for\n   older versions)\n\nThen there's nothing left!\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/615#issuecomment-340080137,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAWsAdvRyL6YBwfjhL9YkMTYddjByPKrks5swkAhgaJpZM4QHX7v\n.\n. There\u2019s a limit on how many certificates you can issue from letsencrypt (see their documentation. If you need to test things there is a test parameter you can use.\n. You have possibility to administer your machine, right. If you don\u2019t trust Lews release builds you can always build it from source. What do you expect to happen with this issue you raised?. This is a duplicate of this issue: https://github.com/PKISharp/win-acme/issues/464. I\u2019m not sure which logging library that is used but with log4net this could be solved with an smtp appender. Just a suggestion!. Is it enough to know that the task thinks it succeeded? I think not. You should probably monitor your site externally and check availability, perhaps also time to certificate expiration, if you really want foolproof system.. \n",
    "ahwm": "I looked through the wiki but didn't see that. Thanks.\n. Just an update in case it helps permanently resolve the issue (without a workaround):\nI get this error every time if there is an existing HTTPS binding using SNI and a certificate that's not Let's Encrypt. If the site has an IP-based HTTPS binding it runs just fine (though I have to manually go remove the IP-based binding, which is to be expected). If the binding already has a Let's Encrypt certificate it runs just fine.\nI believe part of the problem here (in our case, at least) is that the paid SSLs are in the \"Personal Store\" instead of \"Web Hosting Store\" because IIS would throw errors when we would try to complete the request and have it store in Web Hosting.\nIf I use --san and run it on a site that has multiple HTTPS bindings (www and non-www, for example) and those certificates are in the Personal store I get an error. It will error until none of the HTTPS bindings have a certificate. That may be 2 times or 3 times or whatever. So what I've been doing is running it once to get the certificate then updating all bindings to use it and re-running it to get it in the renewal queue.. Just had this happen to me as well. Also 2012 R2. I created a new certificate for a site that previously did not have SSL and it worked fine. Then we got a notification from our customer that their site wasn't secure. I looked and it was sending the wrong certificate. I looked at the bindings and it had not only changed the certificate for the www https binding, but it disabled SNI for the same binding.\nAlso using 1.9.1. I haven't seen this problem with automatic renewals (I haven't seen this problem before at all, actually).. Just saw this again using 1.9.3.21006. I installed a certificate on a new site (ID 92) and it worked, but it also updated a different site that I set up a month ago (ID 68) with the certificate I just generated and turned off SNI.\nNow, with the site with ID 68, I hadn't used the --san option because I only wanted the certificate on the test URL since the live domain isn't pointed there yet, but it has bindings for the live domain.\nWindows Server 2012 R2, IIS 8.5. I posted this on #260 and there's more on #371 with a rewritten portion.\n\nJust an update in case it helps permanently resolve the issue (without a workaround):\nI get this error every time if there is an existing HTTPS binding using SNI and a certificate that's not Let's Encrypt. If the site has an IP-based HTTPS binding it runs just fine (though I have to manually go remove the IP-based binding, which is to be expected). If the binding already has a Let's Encrypt certificate it runs just fine.\nI believe part of the problem here (in our case, at least) is that the paid SSLs are in the \"Personal Store\" instead of \"Web Hosting Store\" because IIS would throw errors when we would try to complete the request and have it store in Web Hosting.\nIf I use --san and run it on a site that has multiple HTTPS bindings (www and non-www, for example) and those certificates are in the Personal store I get an error. It will error until none of the HTTPS bindings have a certificate. That may be 2 times or 3 times or whatever. So what I've been doing is running it once to get the certificate then updating all bindings to use it and re-running it to get it in the renewal queue.\n\nHopefully that's helpful to someone. I've found that if I get the error I can set the certificate to the one just created on all SSL bindings on the website and re-run it. I guess I don't understand why this hasn't been addressed and simply filed away as a \"temporary issue\" - it's only temporary for that one site. But it reoccurs regularly. Especially if you're switching from another certificate provider with a lot of websites.. I just downloaded it for a new server and it worked perfectly out of the box.. Thanks. It looks as though the default value is %appdata%\\letsencrypt-win-simple\\[BaseUri] but even after running it and installing a certificate, this directory doesn't exist.\nIt actually says the default is empty (which it is when I look at the config) but then it resolves to the path above.\nSo I just found the files under C:\\ProgramData\\letsencrypt-win-simple\\ But %appdata% doesn't map to that directory. Is that an oversight in the documentation?\nUsing Windows Server 2016, by the way, if that makes a difference.\nThanks again!. Cool. Thanks!. ",
    "NickMcAvoy": "Is it possible to keep from adding an HTTPS binding for a site which lacks one? We are using another webserver for SSL and the IIS binding conflicts with it.. ",
    "rickparrish": "Went another way this.\n. ",
    "Hiblet": "Ah, OK, I will take a look, thanks for the very quick response!\n. I did not realise I could re-order handlers for a particular folder.  Thanks for the help, I will have a look.\n. There is one cert per server (IP address) yes?  So I first ran the LetsEncrypt win app for a simple static site, got the error above, and then manually adjusted the handlers, as this would have no impact on the simple site.  I then ran again to certify another more complex (Web and API) site on the same server.  This did not generate the error.  I assume that because I have tweaked the simple site, and this simple site has handlers in acceptable order, and this simple site has the well-known folder under it, then I should be fine.  My complex site should be unchanged because the checking of the challenge is done through the simple site.  Does that sound correct?\n. Oop no, I have over-written the original certificate...\n. OS is Win 2008 Server R2, IIS 7.5.  Selecting site from the menu.  I have been reading, I think IIS 7.5 will only allow me to have one site certificated.\n. OK, plan is to remove cert from simple site and drop that site back to HTTP only.  Then I can try to get the complex site going.  Will have to resume tomorrow.  Thanks for your help today, apologies for not being up to speed.\n. I seem to have myself in a knot, cert-wise.\nI have installed one cert for a simple site, and then I have installed a second cert for the complex site, (which I now know is wrong).  I have removed the first cert from IIS7.5, so IIS now only reports the second cert in the management console.  If I set up URL re-writing to force traffic to HTTPS for the second complex site, the certificate is not recognised.\nIs there a way to clean up and start again?  A thousand apologies, this is quite embarrassing.\n. Great, thanks, will take a look.\n. ",
    "nono1974": "Sorry to ask but what we should do on 2008 R2 OS ? Do i have to change anything in the tunable HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols ?\nI have TLS 1.0, 1.1 and 1.2 presents for client and server \nI have installed the 1.9.1 and getting the issue.\n. ",
    "tsimmons": "I think you've almost got it;\nThat command should have added a new cert to the store. If you launch the IIS manager, select the site, edit the bindings, select the https site, you should then be able to select the newly generated cert ... in my case, they show up with the generated-date in the list, just select the one most recently generated.\n\n. Nevermind ... I just saw you're using Apache, sorry!\nI'll leave my comment incase anyone with IIS runs into this issue.\nCheers,\nToby\n. Does anyone know if any of these pushes will be merged? Is there a more current version/build than the 1.9.1 with the re-enabling TLS 1.0 commit from July 30, 2016?. Sheesh, that makes perfect sense and I assumed (without looking) that nuget.exe would put the files where they needed to be. Turns out the *.dll files weren't even in C:\\Windows\\System32 ... they were in nested folders below that. After copying:\nC:\\Windows\\System32\\Serilog.Sinks.RollingFile.3.3.0\\lib\\net45\\Serilog.Sinks.RollingFile.dll\n\nand\nC:\\Windows\\System32\\Serilog.Sinks.File.3.2.0\\lib\\net45\\Serilog.Sinks.File.dll\n\nto the LEWS directory, it works perfectly. Thanks!. Echoing @rdebath It appears the paths are not right in the verbose logs above where it creates the challenge answer and web.config files ... the leading slash before \".well-known\" is missing. It might well be creating a file in:\nC:\\inetpub\\wwwroot.well-known\\acme-challenge\n\nbut it should be creating it in\nC:\\inetpub\\wwwroot\\.well-known\\acme-challenge\n\nThis would lead to LE being unable to verify the request, either because the site returns 404 or (in the case of helpful 404 handling) another non-hash response.\nLooking at the later error on @KelvinJones logs when LEWS tries to cleanup:\n[INFO] Deleting C:\\inetpub\\wwwroot.well-known\\acme-challenge\n[WARN] Error occured while deleting folder structure. Error: ArgumentOutOfRangeException {Message=\"StartIndex cannot be less than zero.\\r\\nParameter name: startIndex\", ActualValue=null, ParamName=\"startIndex\", Data=[], InnerException=null,TargetSite=System.String Remove(Int32, Int32), StackTrace=\" at System.String.Remove(Int32 startIndex, Int32 count)\\r\\n at LetsEncrypt.ACME.Simple.IISPlugin.DeleteAuthorization(String answerPath, String token, String webRootPath, StringfilePath)\", HelpLink=null, Source=\"mscorlib\", HResult=-2146233086}\n\nLooking at line 1180-1183 of Program.cs there doesn't appear to be any check to verify there is a trailing slash at the end of webRootPath:\n        var webRootPath = Environment.ExpandEnvironmentVariables(target.WebRootPath);\n        var httpChallenge = challenge.Challenge as HttpChallenge;\n        var filePath = httpChallenge.FilePath.Replace('/', '\\\\');\n        var answerPath = Path.Combine(webRootPath, filePath);\n\ne: According to https://msdn.microsoft.com/en-us/library/fyy7a5kt(v=vs.110).aspx System.IO.Path.Combine() should append a \"DirectorySeparatorChar\" to path1, but maybe that is failing? Is there another Path.Combine() that is getting called instead?\ne2: Did @KelvinJones make an error when sanitizing the log output and this is a red-herring?. So it is not creating the challenge answer in the correct spot?. Take a look at the Wiki, command line argument is:\n--webroot D:\\websites\\wwwroot\n\nCommand Line Arguments. Yup. Can also confirm the 1.9.5.1 build works fine. Thanks!. Quite honestly (since this runs as a scheduled task, logs to a file) the only piece of information relevant for me is the date the renewal is due; some iterations logged something like \"domain.com not due for renewal until ...\" which would work for me. It's nice to just check the logs to make sure things are doing what they are supposed to, without having to open the registry to check the dates.. 1.9.7 beta 5 works perfectly, thanks!. Awesome! Thanks for your work on this project!. That sounds great. You want me to close this ticket or wait until the new build process is in place?. Probably the continuing saga of false positives.\nhttps://www.virustotal.com/#/url/941032302ffff52a8713a9d83c9f6eae41c0d77bdfb9f108323cc2a19cb53669/detection. I am doing this. Within letsencrypt.exe.config, simply add this within  <appSettings></appSettings>:\n<add key=\"serilog:minimum-level\" value=\"Debug\" />\n<add key=\"serilog:using:RollingFile\" value=\"Serilog.Sinks.RollingFile\" />\n<add key=\"serilog:write-to:RollingFile.pathFormat\" value=\"letsencrypt-{Date}.log\" />\n<add key=\"serilog:write-to:RollingFile.retainedFileCountLimit\" value=\"30\" />\n\nThis results in 30 days of one-log-per-day with log lines that are timestamped, thusly:\n2018-11-13 09:00:01.572 -06:00 [Debug] Options: Options { BaseUri: \"https://acme-v01.api.letsencrypt.org/\", Test: False, Verbose: True, Renew: True, ... (etc.)\n2018-11-13 09:00:01.743 -06:00 [Debug] Config folder: \"C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\"\n2018-11-13 09:00:01.743 -06:00 [Information] A Simple ACME Client for Windows (WACS)\n2018-11-13 09:00:01.743 -06:00 [Information] Software version \"1912.1.6872.39942\" (\"RELEASE\")\n2018-11-13 09:00:01.759 -06:00 [Information] IIS version \"7.5\"\n2018-11-13 09:00:01.759 -06:00 [Information] ACME server \"https://acme-v01.api.letsencrypt.org/\"\n2018-11-13 09:00:01.759 -06:00 [Information] Please report issues at \"https://github.com/PKISharp/win-acme\"\n2018-11-13 09:00:01.759 -06:00 [Debug] Renewal period: 55 days\n2018-11-13 09:00:02.086 -06:00 [Information] Renewal for certificate \"...\" is due after \"2018/12/20 15:22:49 PM\"\n. Leave out the bloat. Let people choose what extras they want. If that\u2019s too much to have to process, then I say use another tool.. Have you read the Wiki on logging? It might solve your problem as this is already possible (simple logging to a file), albeit you need to grab two dlls from NuGet. https://github.com/PKISharp/win-acme/wiki/Advanced-logging. ",
    "jlamberes": "I deleted all of the files in \" %AppData%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\", ran the command to get a new cert, but then all the old junk appears in the folder with the same impending expiration date??\n. The output shows as if I installed a new certificate (running \"letsencrypt.exe --accepttos --manualhost www.example.com --webroot C:\\wamp\\www\").\nBut the bottom line is, my expiration date does not change and it will expire on 8/9\n. \n. I thought it was strange the expiration was not changing. I must be doing something stupid.\n. OK - I dont know what happened but I ran it again and it seems to have extended the cert until the end of October. As always - I will chalk it up to magic.\nThanks for your help.\n. ",
    "urbanspike": "It's OK, just turn on http NAT on my firewall to autorize ACME validate key...\nThank's\n. ",
    "spsoofbaf": "try this: https://github.com/Lone-Coder/letsencrypt-win-simple/issues/182\n. ",
    "Genilink": "Thanks for the tips but its still not normal :)\nThe cert expiration date is 16/08/2016 and in the registry the renewal date is 16/09/2016.\nIf I manuallly update the date in the registry i will be able to renew the cert. But the problem may occur again next time.\nThe version I use is 1.9.1.10\nGuillaume\n. ",
    "laurent-n": "Same issue, the only option I've found was to renew manually the certificate with this syntax\nletsencrypt.exe --accepttos --manualhost www.domain.com --webroot C:\\sites\\wwwroot\n. It doesn't seems to be fixed, \nI've done as before to have my new certificate.\nletsencrypt.exe --accepttos --manualhost www.domain.com --webroot C:\\sites\\wwwroot\nperhaps, on the next refresh following this operation ..... ",
    "steentottrup": "Just downloaded 1.9.3 and ran it:\n```\nC:\\temp\\letsencrypt-win-simple.V1.9.3>letsencrypt.exe --renew --webroot %systemdrive%\\inetpub\\wwwroot**.*.*\nThe global logger has been configured\nLet's Encrypt (Simple Windows ACME Client)\nRenewal Period: 60\nCertificate Store: WebHosting\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nCertificate Folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nLoading Signer from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\nGetting AcmeServerDirectory\nLoading Registration from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\nChecking Renewals\nChecking IIS .*.* (C:\\inetpub\\wwwroot***.***.)\nRenew After 5/5/2017\n```\nIf I look at the certificate (through the browser or in IIS) it expires 4/4/2017. ",
    "smcguire1": "Forgot to say Windows 2012 R2.\n. I started over just using the local Administrator account and ran into the same thing.  Even tried changing the Task Scheduler service to \"Allow service to interact with desktop\" - same result, the program just hangs when run from the Task Schedule.\nI suspect that it's because the registry information is stored under HKEY_CRRENT_USER\n_HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\\nwhich would be inaccessible unless the user is logged in.\n. This makes no sense to me.  In trying to make sure there weren't lots of letsencrypt processes running all the time, I set the scheduled task to stop after 1 hour under both Triggers and Settings.  That's the only change I made.  But now it suddenly starts claiming that it completes successfully!  Both running manually (as a different user) and on a schedule with no one logged in.\n. Awesome.  I was able to use beta 8 to renew without a problem.\nThank you for such a fast response, and all your hard work in a great project.. ",
    "mdehaas": "I also have this issue. The task does complete when logged in with the same user that is configured to run the job. Can we generate some logging or help with any other debugging info?\nVersion: 1.9.1.38228\nOS: Windows Server 2012 R2\nDomain Joined: No\n. ",
    "PeterDefendo": "I have the same Issue on Windows 2008 R2\n<Event xmlns=\"http://schemas.microsoft.com/win/2004/08/events/event\">\n    <System>\n        <Provider Name=\"Microsoft-Windows-TaskScheduler\" Guid=\"{DE7B24EA-73C8-4A09-985D-5BDADCFA9017}\" />\n        <EventID>101</EventID>\n        <Version>0</Version>\n        <Level>2</Level>\n        <Task>101</Task>\n        <Opcode>101</Opcode>\n        <Keywords>0x8000000000000001</Keywords>\n        <TimeCreated SystemTime=\"2016-08-23T07:00:00.003200000Z\" />\n        <EventRecordID>47</EventRecordID>\n        <Correlation />\n        <Execution ProcessID=\"832\" ThreadID=\"304\" />\n        <Channel>Microsoft-Windows-TaskScheduler/Operational</Channel>\n        <Computer>Server</Computer>\n        <Security UserID=\"S-1-5-18\" />\n    </System>\n    <EventData Name=\"TaskStartFailedEvent\">\n        <Data Name=\"TaskName\">\\letsencrypt-win-simple httpsacme-v01.api.letsencrypt.org</Data>\n        <Data Name=\"UserContext\">Server\\Administrator</Data>\n        <Data Name=\"ResultCode\">2147943645</Data>\n    </EventData>\n</Event>\n. ",
    "andi-blafasl": "I have the same issue! \n@smcguire1 @kria Did you check if your certificate get's renewed properly? I changed the scheduled task to produce some log output:\n<?xml version=\"1.0\" encoding=\"UTF-16\"?>\n<Task version=\"1.2\" xmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\">\n  <RegistrationInfo>\n    <Date>2016-06-22T12:54:01.338+02:00</Date>\n    <Author>WEBSERVER\\Administrator</Author>\n    <Description>Check for renewal of ACME certificates.</Description>\n  </RegistrationInfo>\n  <Triggers>\n    <CalendarTrigger>\n      <StartBoundary>2016-06-22T09:00:00</StartBoundary>\n      <Enabled>true</Enabled>\n      <ScheduleByDay>\n        <DaysInterval>1</DaysInterval>\n      </ScheduleByDay>\n    </CalendarTrigger>\n  </Triggers>\n  <Principals>\n    <Principal id=\"Author\">\n      <UserId>WEBSERVER\\Administrator</UserId>\n      <LogonType>Password</LogonType>\n      <RunLevel>HighestAvailable</RunLevel>\n    </Principal>\n  </Principals>\n  <Settings>\n    <MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy>\n    <DisallowStartIfOnBatteries>false</DisallowStartIfOnBatteries>\n    <StopIfGoingOnBatteries>true</StopIfGoingOnBatteries>\n    <AllowHardTerminate>true</AllowHardTerminate>\n    <StartWhenAvailable>false</StartWhenAvailable>\n    <RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable>\n    <IdleSettings>\n      <StopOnIdleEnd>true</StopOnIdleEnd>\n      <RestartOnIdle>false</RestartOnIdle>\n    </IdleSettings>\n    <AllowStartOnDemand>true</AllowStartOnDemand>\n    <Enabled>true</Enabled>\n    <Hidden>false</Hidden>\n    <RunOnlyIfIdle>false</RunOnlyIfIdle>\n    <WakeToRun>false</WakeToRun>\n    <ExecutionTimeLimit>PT1H</ExecutionTimeLimit>\n    <Priority>7</Priority>\n  </Settings>\n  <Actions Context=\"Author\">\n    <Exec>\n      <Command>cmd.exe</Command>\n      <Arguments>/C D:\\letsencrypt-win-simple.V1.9.1\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\" &gt;D:\\letsencrypt-win-simple.V1.9.1\\log.txt</Arguments>\n      <WorkingDirectory>D:\\letsencrypt-win-simple.V1.9.1</WorkingDirectory>\n    </Exec>\n  </Actions>\n</Task>\nAnd the output looks like the following\n- with the Task-Owner logged in:\n```\nLet's Encrypt (Simple Windows ACME Client)\nRenewal Period: 60\nCertificate Store: WebHosting\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nCertificate Folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nLoading Signer from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\nGetting AcmeServerDirectory\nLoading Registration from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\nChecking Renewals\n Checking IIS www.mydomain.tld (D:\\inetpub\\wwwroot) Renew After 30.10.2016\n```\n- with some other user (or no user) logged in:\n```\nLet's Encrypt (Simple Windows ACME Client)\nRenewal Period: 60\nCertificate Store: WebHosting\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: C:\\Users\\Default\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nCertificate Folder: C:\\Users\\Default\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nGetting AcmeServerDirectory\nEnter an email address (not public, used for renewal fail notices): \n```\nI have no Idea what's going wrong here.\n. @kria Thank you so much for pointing me to this problem. The Hotfix for Windows Server 2012 R2 fixed it and now it is working like a charm!\nMaybe this can be added to the Wiki page for the installation of the client? This Problem should affect all users with Win 2012+ / 8+\n. Maybe in January 2018 Let's Encrypt will support Wildcard certificates with the ACMEv2 Protocol.\nAre there any plans to update letsencrypt-win-simple to support the new Version of the ACME Protocol?. Update your client to version 1.9.3. The message is shown because 1.9.2 was compiled in debug mode and not release mode\nYou can see it in the releases  as well.. ",
    "Tseretyan": "I think that the reason why process hangs is because it is waiting for user interaction. The task runs the process every day and if certificates do not need to be renewed the application stops and waits until user press Enter. I think it make sense to add some argument like --silent to not wait for user interaction.\n. ",
    "jorik90": "@Tseretyan that's correct, and caused by the wrong appdata-path, mentioned by kria. In my branch I made a change so the task no longer relies on the environment-path, but calculates it itself: https://github.com/jorik90/letsencrypt-win-simple/commit/33b076c825a831b73c94e8962e2e79aefda2c072. My problem is kb3133689.\n. @nmg196 there are multiple problems. One of them is kb3133689, where the apppath is not correct when  the user is not logged in. An other problem is the one you describe, where the task will not run when the user is logged in (in my branch I fixed it by not making  this an option, see https://github.com/jorik90/letsencrypt-win-simple/commit/c5b09c9dc4b3e8e2e0f6da5adf5ae4f9965a6ecc). The third problem is the debug-code when built in debug-mode.\n. It looks like that's the default when you enter a username/password. But I can't find the documentation to confirm that. Also, tasks that I created using the script have the option set to the correct value.\n. ",
    "nathan-alden": "Am I wrong in saying that the scheduled task is simply broken, and doesn't do what everyone would expect? A scheduled task should run silently, regardless of whether a user is logged in, and this task in particular should not require user credentials for performing the type of work it performs. This task should be running as SYSTEM without any user interaction required.\n. ",
    "Julien-nl": "I am having the same issue now,\nI have installed the hotfix but when I run the task manualy it finished but it does not renew the certificate.\nwhen I check the registry HKEY_CRRENT_USER\n_HKEY_CURRENT_USER\\Software\\ I can't. seem to find the let encrypt there \nCan someone advise please how to get this fixed ?\nOS is 2012R2. After playing around with the new version 1.6.4 the task seems to be created on \nHKEY_CURRENT_MACHINE\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\nwith the value {\"Date\":\"2017-11-17T13:38:31.1461774Z\",\"Binding\":{\"Host\":\"mail.domain.com\",\"HostIsDns\":true,\"WebRootPath\":\"%SystemDrive%\\inetpub\\wwwroot\",\"SiteId\":1,\"ExcludeBindings\":null,\"AlternativeNames\":[],\"PluginName\":\"IIS\",\"Plugin\":{\"Name\":\"IIS\",\"ChallengeType\":\"http-01\",\"MenuOption\":\"\",\"Description\":\"\"}},\"CentralSsl\":null,\"San\":null,\"KeepExisting\":\"False\",\"Script\":null,\"ScriptParameters\":null,\"Warmup\":false}\nThank you for the support and creating this great tools.. Dear Wouter\nthank you for your answer.\nbelow is the log\n```\nMicrosoft Windows [Version 6.3.9600]\n(c) 2013 Microsoft Corporation. All rights reserved.\nC:\\Users\\admin_julien>cd c:\\root\nc:\\root>letsencrypt.exe --forcerenewal  --verbos\nLet's Encrypt Simple Windows Client 1.9.5.38878\n Let's Encrypt\nERROR(S):\n  Option 'verbos' is unknown.\n--san                   Enables mode for creating certificates with more than\n                          one DNS identifier.\n--warmup                Warm up websites before attempting HTTP authorization\n--baseuri               (Default: https://acme-v01.api.letsencrypt.org/) The\n                          address of the ACME server to use.\n--centralsslstore       Path to a centralized certificate store, which may be\n                          on a network drive. When using this setting,\n                          certificate files are stored there instead of in the\n                          --configpath.\n--test                  Overrides --baseuri setting to\n                          https://acme-staging.api.letsencrypt.org/ and enables\n                          other testing behaviours in the program which may\n                          help with troubleshooting.\n--verbose               Print additional log messages to console for\n                          troubleshooting.\n--renew                 Check for scheduled renewals.\n--forcerenewal          Force renewal on all scheduled certificates.\n--keepexisting          Keep existing bindings and certificates.\nc:\\root>letsencrypt.exe --forcerenewal  --verbose\n[INFO] Let's Encrypt (Simple Windows ACME Client)\n[INFO] Version 1.9.5.38878 (RELEASE)\n[VERB] Verbose mode logging enabled\n[INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-sim\nple\n[INFO] Renewal period: 60\n[INFO] Certificate store: WebHosting\n[INFO] ACME Server: https://acme-v01.api.letsencrypt.org/\n[VERB] Using registry key HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\htt\nps://acme-v01.api.letsencrypt.org/\n[DBUG] Scanning IIS site bindings for hosts\n[INFO] Target for mail.domain.com still found in IIS, updating record\ns\n[DBUG] Settings {Renewals=[ScheduledRenewal {Date=11/10/2017 03:13:18, Binding=T\narget {Host=\"mail.domain.com\", WebRootPath=\"%SystemDrive%\\inetpub\\w\nwwroot\", SiteId=1, AlternativeNames=[], PluginName=\"IIS\", Plugin=IISPlugin {Name\n=\"IIS\", ChallengeType=\"http-01\"}}, CentralSsl=null, San=\"False\", KeepExisting=\"F\nalse\", Script=null, ScriptParameters=null, Warmup=False}]}\n[DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.le\ntsencrypt.org\n[DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.a\npi.letsencrypt.org\n[DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.a\npi.letsencrypt.org\\Signer\n[DBUG] Getting AcmeServerDirectory\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n[DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme\n-v01.api.letsencrypt.org\\Registration\n[INFO] Checking renewals\n[INFO] Renewing certificate for mail.domain.com\n[INFO] Authorizing identifier mail.domain.com using http-01 challenge\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[DBUG] Writing challenge answer to C:\\inetpub\\wwwroot.well-known\\acme-challenge\n\\DZn7SqhVOgkqwQ1DIqxGI3iIwh_enQQvJM4RIYV8j2U\n[DBUG] Writing web.config to C:\\inetpub\\wwwroot.well-known\\acme-challenge\\web.c\nonfig\n[INFO] Answer should now be browsable at http://mail.domain.com/.well\n-known/acme-challenge/DZn7SqhVOgkqwQ1DIqxGI3iIwh_enQQvJM4RIYV8j2U\n[DBUG] Submitting answer\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/\nCCK_x39xBEgQteV26GthGdgeiKDErG09ivIv3RVHcL8/1957222515\n[INFO] Authorization result: valid\n[DBUG] Deleting answer\n[DBUG] Additional files or folders exist in C:\\inetpub\\wwwroot.well-known\\acme-\nchallenge not deleting.\n[DBUG] RSAKeyBits: 2048\n[INFO] Requesting certificate: mail.domain.com\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n[DBUG] certRequ CertificateRequest {CsrContent=\"MIICvjCCAaYCAQAwJTEjMCEGA1UEAwwa\nbWFpbC5hdXRvYmVkcmlqZmFkZWpvbmcubmwwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7\nQNUjiw4GvcSxbQ3QxZhO7k2aHhSYOpjrO-kz-I7-cS8bhlz-8PepcJopA3QOiH-BSPiloOggJrQ3Th1\nB0xGozfiqOTfkzuXoakWv2jpk5Nr2wexugsnUfRsmOilLGk2jqm3r4XD8LGhgdtdosydvx09WS7AjnPb\nAPtENwWmxV0fOiMlSYnBkATzPcQULX0WzQduOQsDyBYvcjOM7j-bE7AEl1hBpoC0bMyHXdwzqCbn0n38\n86CZUkP0JsgkxLpNlH8TDEJurarENDSOM_I4zbblvSlkMLMYjBgRxuTtG5D75odpTuFcAX9OmlZ84ixF\n9W2wX0LW4No6CLZOO-sPAgMBAAGgVDBSBgkqhkiG9w0BCQ4xRTBDMEEGA1UdEQQ6MDiCGm1haWwuYXV0\nb2JlZHJpamZhZGVqb25nLm5sghptYWlsLmF1dG9iZWRyaWpmYWRlam9uZy5ubDANBgkqhkiG9w0BAQsF\nAAOCAQEAVGiMH9Au3DpyL24PY4lQB-r3zCamWAR39MjrZkm6yqJZG3UYiWtL7KcXNHk1Lw-eFEeAMEHE\ni4x4OPQjxtNp1V-NrWbGeiQp2tL5VsUvgHz8z5RLkMKgWe8AFcX0O9ZuvsR924y9xu-QBpPKxi5vqV4b\nLm9hZlIxqkWLmJ4hpp8GW2dOgGHczDQYzinOeXRrKJWI9huP_TayGdooEAiUACNivZZFGNXd_0Qxtjh1\n9GkUmQ2M1tFsnNhUou-iVTnz-DbxBayMkuWtxWaVaPXsZG6LM6KGAmip87fZQ6PG4LMPc5uXPK9_4FEV\nfolderDQoAGnzaiY3QJp2tRjKk-Vtw\", Uri=\"https://acme-v01.api.letsencrypt.org/acme/\ncert/03e2dbc7a400074e81d05c922648b9dfc36c\", Links=[\"https://acme-v01.api.letsen\ncrypt.org/acme/issuer-cert;rel=\\\"up\\\"\"], StatusCode=Created, RetryAfter=null, C\nertificateContent=\"MIIFFzCCA-gAwIBAgISA-Lbx6QAB06B0FySJki538NsMA0GCSqGSIb3DQEBC\nwUAMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQDExpMZXQncyBFb\nmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xNzA5MTMxMTA0MDBaFw0xNzEyMTIxMTA0MDBaMCUxIzAhBgNVB\nAMTGm1haWwuYXV0b2JlZHJpamZhZGVqb25nLm5sMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCA\nQEAu0DVI4sOBr3EsW0N0MWYTu5Nmh4UmDqY6zvpM_iO_v3EvG4Zc_vD3qXCaKQN0Doh_gUj4paDoICa0\nN04dQdMRqM34qjk35M7l6GpFr9o6ZOTa9sHsboLJ1H0bJjopSxpNo6pt6-Fw_CxoYHbXaLMnb8dPVkuw\nI5z2wD7RDcFpsVdHzojJUmJwZAE8z3EFC19Fs0HbjkLA8gWL3IzjO4_mxOwBJdYQaaAtGzMh13cM6gm5\n9J9_POgmVJD9CbIJMS6TZR_EwxCbq2qxDQ0jjPyOM225b0pZDCzGIwYEcbk7RuQ--aHaU7hXAF_TppWf\nOIsRfVtsF9C1uDaOgi2TjvrDwIDAQABo4ICGjCCAhYwDgYDVR0PAQH_BAQDAgWgMB0GA1UdJQQWMBQGC\nCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBRnTaO2RIgOe2m-H6uq2TROV\n4khLzAfBgNVHSMEGDAWgBSoSmpjBH3duubRObemRWXv86jsoTBvBggrBgEFBQcBAQRjMGEwLgYIKwYBB\nQUHMAGGImh0dHA6Ly9vY3NwLmludC14My5sZXRzZW5jcnlwdC5vcmcwLwYIKwYBBQUHMAKGI2h0dHA6L\ny9jZXJ0LmludC14My5sZXRzZW5jcnlwdC5vcmcvMCUGA1UdEQQeMByCGm1haWwuYXV0b2JlZHJpamZhZ\nGVqb25nLm5sMIH-BgNVHSAEgfYwgfMwCAYGZ4EMAQIBMIHmBgsrBgEEAYLfEwEBATCB1jAmBggrBgEFB\nQcCARYaaHR0cDovL2Nwcy5sZXRzZW5jcnlwdC5vcmcwgasGCCsGAQUFBwICMIGeDIGbVGhpcyBDZXJ0a\nWZpY2F0ZSBtYXkgb25seSBiZSByZWxpZWQgdXBvbiBieSBSZWx5aW5nIFBhcnRpZXMgYW5kIG9ubHkga\nW4gYWNjb3JkYW5jZSB3aXRoIHRoZSBDZXJ0aWZpY2F0ZSBQb2xpY3kgZm91bmQgYXQgaHR0cHM6Ly9sZ\nXRzZW5jcnlwdC5vcmcvcmVwb3NpdG9yeS8wDQYJKoZIhvcNAQELBQADggEBAGSUrI1329EChIYmZIcuz\nTqGBhlUiHzsAiqJFdDK0a1L_o-UMw-nIDTUa_UaobKQmQKkIOiy49q6kq99HttZ_Css4w7e7RpBzlY_u\nrwJgbXQ-x7sB_wL5HDrFCVPc8H-gxSZuILtoFCjpZkCx0mH9YpIe3Qx2aTDIFF5kWkJNrEpmjT9CNj1_\n27szMX_1UdTox1qKmsZdos5I_acal3S5SrA94VE7K1eSVHhqvvXZ55OltyBBSXsE2-jzl8IaRBw2vPe5\nyy6NmBPL7yVoedGYJ5Z8O7vXQbXOecUjEXxGW6UKgai10mG2Dn07B7M7uPim_YqhQfmvxKmiJwJFfH73\n1A\"}\n[DBUG] Request Status: Created\n[INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01\n.api.letsencrypt.org\\mail.domain.com-crt.der\n[INFO] Saving issuer certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsa\ncme-v01.api.letsencrypt.org\\ca-0A0141420000015385736A0B85ECA708-crt.pem\n[DBUG] CentralSsl False - San False\n[INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01\n.api.letsencrypt.org\\mail.domain.com-all.pfx\n[INFO] Installing Non-Central SSL Certificate in the certificate store\n[DBUG] Opened Certificate Store WebHosting\n[DBUG] Set private key exportable\n[DBUG] Adding certificate mail.domain.com 2017/9/13 2:02:10 PM to sto\nre\n[DBUG] Closing certificate store\n[INFO] Installing Non-Central SSL Certificate in server software\n[INFO] Updating existing https binding for mail.domain.com\n[INFO] IIS will serve the new certificate after the Application Pool IdleTimeout\n has been reached.\n[INFO] Committing binding changes to IIS\n[DBUG] Opened certificate store WebHosting\n[INFO] Removing certificate mail.domain.com 2017/9/11 5:11:54 AM\n[INFO] Closing certificate store\n[INFO] Renewal for mail.domain.com succeeded, rescheduled for 11/12/2\n017 12:02:10\n```\n. is it supposed to created a registry key on the Windows ?\nfrom the log it looks like it will renew the SSL on 11/12/2017 \n. Hi Timo,\nWhat do you mean exactly with forced a new registration ?\n. Thank you Timo,\nis the user who is assigned to run the task, would be sent to the letsencrypt server ? or will this information remain locally ?\n. Thank you Wouter,\ntoday I have tried the new 1.9.6.2 on Win 2012R2 however its keeps errouring out. can you please advise why ?\nits a exchange 2013 on Server 2012r2\n1: mail.domain.net (SiteId 1) [@%SystemDrive%\\inetpub\\wwwroot]\n C: Cancel\nChoose site: 1\n[INFO] Authorizing identifier mail.domain.net using http-01 challenge\n [INFO] Answer should now be browsable at http://mail.domain.net/.well-known/a\ncme-challenge/bY2tZMypHOwI_ojOMEIS1N2BoTLVNZcdvPeGMxrEy8k\n [INFO] Authorization result: invalid\n [EROR] ACME server reported type urn:acme:error:unauthorized\n [EROR] ACME server reported detail Invalid response from http://mail.domain\nnet/.well-known/acme-challenge/bY2tZMypHOwI_ojOMEIS1N2BoTLVNZcdvPeGMxrEy8k: \"<!DO\nCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml\n1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http\"\n [EROR] ACME server reported status 403\n [EROR] Exception Exception of type 'LetsEncrypt.ACME.Simple.AuthorizationFailed\nException' was thrown.\nWould you like to start again? (y/n):. Thank you so much,\nhowever I managed to get the SSL installed\na big thank you for the support you provide here.. Dear Wouter,\nI've noticed the SSL is already assigned on the IIS but when I log to the ECP on the Exchange its not there to assign the services.\nam I supposed to import the certificate to the exchange ?\n. Thank you Wouter for your support,\nthose steps has been already followed but its appear the SSL is only for the IIS encrypting the https connection and it does not need to be on the ECP.\n. ",
    "gdau": "This would be amazing... I need this too.\n. I've just tried it and is solved my problems with renewing SAN certs on a schedule... thank you!\n. Here we go:\nletsencrypt-release.zip\n. Feel free to ignore, but I would love to see this project broken into two seperate repositories.\nI would like to see one class library - a wrapper for the ACME lib - that doesn't know anything about files or the console and is only responsible for simplifying the calls to letsencrypt. Very simple signatures that accept byte[] for parameters such as signers and registrations when requesting certificates and seperate methods that are able to wrap the crytpo required to generate the necessary streams to create these for the first time if necessary (but is not concerned with how or where they are stored).\nThis would open the door to projects using this library directly when they have bespoke requirements and would also allow a second, more full-featured console app with plugins etc. that is not concerned with the ACME side of things but is responsible for the management of the generated certs (installing them, renewing them).\nThoughts?. Sorry no I didn't mean having a super-specific set of libraries; I wanted to have what you suggested - a single library only responsible for certificate-related functionality (without Console calls for logging and ReadLines() and other UI-related things). \nThis app could then use this library and contain the functionality orthogonal to the interactions with letsencrypt since I think that installing and managing certs is something that needs to happen for many people who don't use letsencrypt and could be useful outside of this project (i.e. the exe that manages certs should know nothing about letsencrypt - should just be able to pick up a cert from somewhere and install it).\nAnyway this is the path I've started down on my own now - if I have something to put up at some point I will post it.. ",
    "garyrowswell": "It would be nice to know if this is even under consideration?. ",
    "jeremycook": "That matches my experience on Windows 2012 R2. I haven't found specific guidance related to this so I'll add it here.\nI manually installed the Let\u2019s Encrypt Authority X3 (IdenTrust cross-signed) certificate from https://letsencrypt.org/certificates/ to the Local Computer's Intermediate Certification Authorities store.\nI installed this certificate using the .der file:\n\nAt this location:\n\n. ",
    "Felk": "This can be manually fixed by concatenating the intermediate certificate onto your own certificate. letsencrypt's certificates can be found here: https://letsencrypt.org/certificates/\nbasically just cat your-domain.com-crt.pem lets-encrypt-x3-cross-signed.pem >> chained-crt.pem and then use that certificate file instead. It destroys the beauty of having a fully automated solution though.\n. I assumed installing the intermediate certificate happened on the client's end, and therefore would have to be done for every client, which makes no sense. Was the certificate installed on the server?\n. That sounds more robust indeed, thanks.\n. ",
    "offerlam": "when i brows:\nhttp://XXX.YYY.UU/.well-known/acme-challenge/\nI get forbidden access 403\nbut Authentication both for folder .well-known and acme-challenge allows annonymous authentication\n. ok - I never got it to work and found another solution for it not using lets encrypt.\nbut thanks letting me know!\n. ",
    "gp54321": "I have seen a very similar problem with LE 1.9.1 and Exchange 2016.\nThe reason was that Default Web Site is configured with required SSL and the .well-known directory inherits this attribute. It is sufficient to clear it with IIS manager (select .well-known virtual directory, clic SSL parameters, clear the 'require SSL' checkbox ) and restart the site to get rid of this 403 error.\nThe clue was in the IIS Log (the 403 code was followed by '4 5' meaning that SSL and 128 bits are required, something that will never happen on a HTTP connection)\nThis is a small bug in LE of course.. ",
    "xiti": "Hi, I'm running RDS with RD Gateway for a charity and I've successfully installed LE certs on IIS thanks to letsencrypt-win-simple and also manually added the cert to RDS Gateway, I was wondering if it would be possible to include and automate that certs are also added to RDS Gateway at the same time as IIS. Automating it would be nice, as at every renewal there wouldn't be no manual setting required any more. Which is the primary advantage of LE. It would be a VERY nice feature. Otherwise I think I'll buy a commercial cert which has a validity of 3 years \ud83d\udc83 . ",
    "amineo": "I might be wrong here, so correct me if I am :) -  I believe your internal website needs to accessible publicly (externally) so that the ACME server can talk to and verify the site its assigning the SSL cert to. If the ACME server can't reach your internal website then it can't finish its challenge to assign the SSL. \n@seanvree - Please mark this label as 'question'\n. ",
    "seanvree": "Not sure how to mark this as a question. \nOkay, I got around that.\nI was able to install the certificates. However, I'm still having an issue with bindings:\nAs I understand it, I should have the website bound to HTTP port 80 and HTTPs to port 443, correct?\nfrom an external client, I CAN access the website on 80, but when I try to switch to 443, I get : Err_Empy_Reponse. However, I CAN access the website via https://localhost on the server\nWhat am I doing wrong?\n. Nevermind, i got it. \nThanks,\n. I was wondering if it's possible to do the opposite?!. THX!. Yup @rnenjoy  - I had to wipe mine out and recreate.  \nFML.. wow, this is a HUGE bug.  LOL. I spent two days ripping out all my certs and creating new ones on my home webserver.  \nSucks. . Yeah, this project needs to be taken offline till it's fixed.. @WouterTinus  - No such file Sir. . @WouterTinus  sorry, lost track fo this.  yes, all those folders have files in them. \nJust wondering which one is the full chain?. ",
    "andrewmurray": "@seanvree would you mind sharing how you managed to get around the fact that your website was not publicly accessible? I have a website whose DNS is scoped to our company's network domain and I'm suffering a similar issue as that which you originally reported.. ",
    "samfb24": "Thanks! I read that thread and it looks like a workaround is to redirect any traffic coming in via http to https on the webconfig level. The problem is port 80 is completely blocked by my isp so anything trying to come in on port 80 will never even hit my network, so this will not work in my case. It looks like a few others are in the same situation as me and there doesn't appear to be a solution for that yet.\n. ",
    "andrewaggb": "my isp also blocks port 80... one work-around that is really terrible but can work is if you get a cheap vm like speedykvm, digitalocean, vultr, wable whatever for a few dollars a month and use iptables or nginx or whatever you feel like to redirect traffic from port 80 on that host back to your home over a different port (say port 81) and then use your router to map port 81 back to port 80 internally or another similar solution.  I know it's awful, but it works.\n. ",
    "gregorygsmith": "Agreed it's pretty rare. Makes sense to move it to options as it's pretty intrusive otherwise. Will move it over.. Proxy option has now been moved over. Could add switches for WebProxy overloads but this may go a bit beyond the scope of what's needed.. @ruicaramalho\nIf you left the value empty or blank if would skip using a proxy.\nThis PR only added the most basic web proxy, so there was no option to add credentials. Do you have a need for this?\n. @ruicaramalho I've added options for proxy credentials in this PR - https://github.com/PKISharp/win-acme/pull/786 which has now been merged to master.\nIf you do a fresh pull, you should have the extra options.. ",
    "ruicaramalho": "What are the Options? in:\n<setting name=\"Proxy\" serializeAs=\"String\">\n    <value>[System]</value>\nI can see [System] is one off them do you have the option [None] for skipping default proxy?. If you have to set a proxy, how do you send user and pass ?. Gregory, yes I would like to use a feature like that.\nTo bypass this problem I changed the proxy for that computer in registry\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\InternetSettings\\ProxyEnable 1\nHKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ProxyEnable 1. I need to import the certificate to a keystore file (for openfire)\nkeytool -delete -keystore /opt/openfire/resources/security/keystore -alias <your-hostname> -storepass changeit -noprompt\nkeytool -importkeystore -deststorepass changeit -srcstorepass changeit -destkeystore /opt/openfire/resources/security/keystore -srckeystore cert.p12 -srcstoretype PKCS12 -deststoretype pkcs12\nsystemctl stop openfire \nsystemctl start openfire\nBut previosly I would need something like \nopenssl pkcs12 -export -passout pass:changeit -in /etc/letsencrypt/live/<your-hostname>/fullchain.pem -inkey /etc/letsencrypt/live/<your-hostname>/privkey.pem -name <your-hostname> -out cert.p12 \nkeytool -delete -keystore /opt/openfire/resources/security/keystore -alias <your-hostname> -storepass changeit -noprompt . ",
    "hlizard": "My website also has this problem now. It has work fine from April, but now https in chrome and Wechat not working, other browser work fine. I am using letsencrypt-win-simple.v1.9.0.\nsorry for my poor english\n. ",
    "JD-aus": "suggest this is a problem with chromes interpretation of the SSL certificate, as opposed to an application to install and renew said certificate.\nthese questions should be asked on the LE community forums first, then here if confirmed to be a problem with this app..\n. ",
    "bamma": "Using Windows 2012 R2\nBut I have 2 IP's on the server, but mostly only use 1. And i have a multitude of websites and domains on the same server.\n. I will take a look if some is without\n. jep all is on.\nhttps://junglecoders.dk/\nthere you can see cert is for pearldivingkohtao.com\nbut if i go and switch on and off, then pearldivingkohtao.com will complain that the cert is for junglecoders.dk\n. They all set to specific, but when created i set them for all unassigned\nDen 12-09-2016 kl. 15:30 skrev Chris Monkman:\n\nAnd you've definitely selected the right cert on the binding for \njunglecoders.dk? For the ip address are you specifying an IP address \nor setting it to 'all unassigned' ?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub \nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/289#issuecomment-246281581, \nor mute the thread \nhttps://github.com/notifications/unsubscribe-auth/AGZMxqllYR8d0UT2vxWgRWy7oXWVhfq9ks5qpQ2LgaJpZM4J6Onb.\n. alright I works now by using multisite san. Which in the end is much easier.\nletsencrypt.exe --san Press S and then all the Id's i wanted to Add.\nThx for the help @SgtOddball \n. \n",
    "gps035": "I've just had the same happen to me. I agree its a critical bug. I don't remember seeing a warning. Is there a way to add a certificate on the server without this happening, or do I need to wait for a fix before running it again?\n. ",
    "Ellfish": "I too am having this issue with version 1.9.1, Windows Server 2012 R2 Standard.\n@SgtOddball does your suggestion affect automatic renewals in any way?. This sounds like the same issue as #292 . ",
    "elmartino": "Same here.. only when requesting ssl cert for a site that previously didn't had a cert. renewals works fine. I also use certify tool, same problem there btw.. ",
    "Acerby": "I did some further investigation. It seems it does work with 2008R2, but that it requires .net4.5. In fact I found that is listed as a dependency of the ACME library. \nWould be good if it popped up a message to say it required .net 4.5 to work.\n. ",
    "dazerdude": "Yeah. I was using a reverse proxy to forward the incoming request back to my dev machine. I think was using port 80 anyway. We could just default to that.. ",
    "JimmiG": "For me, the www and non-www bindings both appear as separate entries when I run let's encrypt without any parameters. So it was easy to create the two separate certs. The problem at my end only seems to be the registry entry, which affects the renewal task. I guess I'll find out in 60 days whether the certs will renew automatically now that I've added the missing line.\n. ",
    "jmarden": "A bit more...\nI am aware that I can use the --san and then (m) manual option but this causes me problems as I really need to be able to script/automate the renewal process.\n. Please see Pull Request 299\n. I built this modification so that I could use this tool to request (and\nrenew) certificates without any reliance on IIS.\nAs I mentioned in the pull request; I don't have access to IIS and cannot\nimpact test my changes.\nOn Fri, 4 Nov 2016, 15:17 Jon Hanna, notifications@github.com wrote:\n\nWhy do you need the manual option? Is something going to go wrong with my\nsan certs when the renewal comes due?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/297#issuecomment-258455200,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AHNYJkuMjCXBsXu3Xu3C3FLIuQyCjSQyks5q60j7gaJpZM4KD_jN\n.\n. I've just got into the office, thanks for sorting that @gdau \ud83d\udc4d \n. Yeah it was to maintain compatibility with the applications behaviour before these changes.. I've not heard anything from @Lone-Coder what-so-ever :/\n\nOn Mon, 30 Jan 2017 at 17:51 LBegnaud notifications@github.com wrote:\n\n@jmarden https://github.com/jmarden any word on if this will get\nbundled into the main branch?\nI'm just wondering about the future of this project... seems like\n@Lone-Coder https://github.com/Lone-Coder might have abandoned.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/299#issuecomment-276135575,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AHNYJgf0vX34J0jg7qe1dveGx6LAqW7pks5rXiMjgaJpZM4KGaXN\n.\n. @MetUys Unless I'm missing something I don't see your need to use this branch as the master branch included SAN support for IIS. However as you're here I would say that your example Single and SAN commands are correct but please bare in mind that I have not tested my code against IIS as I don't use or have access to an IIS install. You're more than welcome to test and I tried to keep the code backward compatible but I cannot make any promises.\n\nAs for the Scheduled Task; the code should handle working with an updated profile but if you're testing then I would delete any existing ones and start again. letsencrypt-win-simple stores the properties passed on the commandline to the registry and then reloads them when renewing, so the best way to ensure that the registry is set-up correctly is to use le-win-simple to create the Scheduled Task.. I'll take a look too but I without IIS I fear it won't be easy to see what's happening.. @nul800sebastiaan any chance you could give me some pointers on how you'd like me to proceed to get this pull request resolved? I have done a lot more work but I don't know how to go about resolving the conflicts?. As I'm sure I've mentioned before; I'm using my fork in production across 30 sites. I have recently begun looking at moving our server infrastructure off of Windows. Whilst this won't be a quick project, it will mean that my commitment to this project will eventually dry-up as I'll be migrating to one of the Linux tools.\nIn the meantime I will continue to bug fix my fork and try to work towards getting my changes merged into the main stream. Until then I've uploaded a new release of the latest version (V1.9.1.1) of my fork here\n. Can you show me the output of just running:\nletsencrypt --renew\nplease?\n. @rnenjoy the renewal date being being pushed forward when the renewal fails is a known bug and identified in #408 . I won't be going out of my way to fix it until I know what's going to happen regarding merging this code (or not) into the main project.\n@bencurthoys I don't use or have access to IIS so all of my development is done without being able to test against IIS but also I try to write code that shouldn't impact the normal flow of the application.\nYou're more than welcome to develop against my fork but please be aware that at this time it is unclear if this code/my fork will ever be merged with the main project.. Out of interest why are you running the LE Renewal ST as Admin and not as the httpd user ?\nI am running Apache on Windows and have a specific user for Apache and the LE Task.. Hi Chaps, \nThanks for the invite to contribute and I'm very happy to do what I can but please don't expect loads. This is the first .NET project I've worked on and also the first time I've contributed to a GitHub project!\nMy branch is currently deployed across 30+ sites throughout our company so I will definitely need to support it but I cannot say how much time I'll get to work on the project outside of work hours due to other commitments.\n. My branch provides SAN support with manual domain specification. I believe it's being used by a few people but I don't know how to get a specific number of pull requests (see, a bit of a Git noob!).\nFull details are here: \nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/299\nMaster and develop branches makes sense if there's likely to be a number of contributors.. @C0nw0nk have you got a solution? If NginX runs as a regular user then you could do the same as I do for Apache and use a file junction between the %appdata%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ files that you need and your destination.\nTo get renewal working seemlessly for Apache I also had to write a script that detected if the certs had been updated and Gracefully Restarted Apache when they had.. The prompt seems a little redundant to me too.\nThe default behaviour of the ST (letsencrypt.exe --renew) is to iterate through all previously generated hosts/certs and if the renewal date stored against the host/cert in the registry is old enough, the app will renew the certificate.\nSo to answer your question...\nY will delete the existing ST and create a new ST with default parameters. This ST will still iterate all known hosts/certs.\nN will leave the existing ST in place. Any new hosts/certs will be included in the renewal sweep when it runs.. @mikebrandy Modifying that date and setting it in the past will allow a renewal to be attempted. Be aware that LE have rate limits on their live server of 7 requests so I would recommend using the staging server for testing if you can.. I was well out, it's 20 per week per domain.\nYour best bet is to take a look here: https://letsencrypt.org/docs/rate-limits/. ",
    "tialaramex": "When validating, you won't be able to use other ports. The Let's Encrypt CA, not the local software decide which ports are acceptable. Current CA/B Forum Baseline Requirements (which Let's Encrypt needs to obey to remain trusted by web browsers among other things) deliberately don't permit arbitrary port numbers because of the risk this would be abused to obtain certificates you aren't entitled to.\nOnce you have a certificate, it is valid for any SSL/TLS service on any port, only the DNS name is in the certificate, not a port or IP address or other parameters.\n. ",
    "daeks": "@jmarden @gdau is it possible to share a compiled executable? \n. ",
    "DumboJetEngine": "This seems to work for me as well! :)\nAt least up until now.\nI am not sure what will happen when updating the certificate.\nWe will see...\n. ",
    "eeschi": "Thank you! This is great. The only issue I see is the daily windows renew task does not return. Is this intentional?\nif (Options.Renew && !Options.ForceRenewal)\n{CheckRenewalsAndWaitForEnterKey();}\n. ",
    "pipomambo": "Thank you so much!\nWorks great. Hello @MetUys,\nI use that release with IIS for my RD in manual mode and I import the certificats in IIS with \"Set-RDCertificate\".\nSo, you can try to renew your certificat in manual mode and then add it to IIS  with \"New-WebBinding\".\nMore details of that command here : https://weblog.west-wind.com/posts/2016/Jun/23/Use-Powershell-to-bind-SSL-Certificates-to-an-IIS-Host-Header-Site\n. ",
    "datico": "+1 to incorporate this into the main branch.\n+7 more on my team who need it too. :)\n@jmarden @nul800sebastiaan re: https://github.com/Lone-Coder/letsencrypt-win-simple/issues/365#issuecomment-281329639\nThe question has been raised more than once, how many people are using/would use this feature?\nSeems to me there are only 2 conditions for the need to arise:\n1) Windows (the whole point)\n2) SAN certs\nSince letsencrypt certs expire so quickly, anyone using them will need to use the scheduler to renew them. And without this feature or similar (see #195 with 30 votes), on Windows with SAN certs, scheduler is broken. \nI would think there are a lot of people out there with this environment who may entertain letsencrypt-win-simple if/when it can handle this scenario. For my product it's critical right now, and so I'll be looking at using this branch instead of the mainline because I have little choice.\n. ",
    "daedalus01": "This is basically required for anyone using Exchange as a use case - Exchange server require SANs, and there is no hostname/SNI attached to the IIS sites that your Client Access Server role uses, so the manual method for letsencrypt must be used to specify the hostnames for the SAN. To that end, while manual mode works, scheduled renewal does not per others here in the thread, so I would welcome this new feature.. Take a look at #103 or #333 or the wiki page about settings exceptions for that folder: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/web.config. ",
    "rnenjoy": "Can i help somehow?\n@jmarden tried the different releases with no luck. Now i tried your latest fork from 6 days ago and finally got something.\nC:\\letsencrypt>letsencrypt --renew --san --manualhost mail.company.se,autodiscover.company.se,server1.ad.company.se --webroot c:\\inetpub\\wwwroot\nLet's Encrypt (Simple Windows ACME Client)\nRenewal Period: 60\nCertificate Store: WebHosting\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: C:\\Users\\Administrator.SERVER1\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nCertificate Folder: C:\\Users\\Administrator.SERVER1\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nLoading Signer from C:\\Users\\Administrator.SERVER1\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\nGetting AcmeServerDirectory\nLoading Registration from C:\\Users\\Administrator.SERVER1\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\nChecking Renewals\n Checking Manual mail.company.se (%SystemDrive%\\inetpub\\wwwroot) Renew After 2017-04-03\n Renewing certificate for Manual mail.company.se (%SystemDrive%\\inetpub\\wwwroot) Renew After 2017-04-03\n Ignoring Manual Certificate Renewal due to Primary Domain mismatch.\n Renewal Scheduled Manual mail.company.se (%SystemDrive%\\inetpub\\wwwroot) Renew After 2017-06-03\n Checking Manual autodiscover.company.se (C:\\inetpub\\wwwroot) Renew After 2017-04-03\n Renewing certificate for Manual autodiscover.company.se (C:\\inetpub\\wwwroot) Renew After 2017-04-03\n Ignoring Manual Certificate Renewal due to Primary Domain mismatch.\n Renewal Scheduled Manual autodiscover.company.se (C:\\inetpub\\wwwroot) Renew After 2017-06-03\nThe bug is still there also that it moves the renewal date forward even though the renewal didnt work.. I actually remade the cert from the start with your release instead. Now i got a real name on it, before it was blank. I think its better to see if it works to renew it now when it was created from the start in yours instead. . Having exactly the same problem!\n\"Renew after 2017-03-09\" (i have changed to Swedish style dates). It says it will renew after 9th of march. But the cert will die at 6th of february!. Same problem here. Says renew after 2017-03-09, but certificate dies in february 6th.. Thats the command i have been using. Just renew. @rajeshpachar 's solution worked perfect for me! Big thanks!\nletsencrypt.exe --accepttos --webroot \"C:\\inetpub\\wwwroot\" --manualhost \"domainname.com\". Same here\nUpdate:\nTried to renew my Exchange SAN certificate.\nFirst i got that it was unable to renew it (no reason why).\nNow i get the same message as @seanvree \"Renew after ....\" some day in july. But the certificate will expire in 19 days.. @WouterTinus Ah ok. So the renewal date is stored in the windows registry? i was looking for it, cause this was my thought aswell.. Yes you are right. In HKCU/software/letsencrypt-win-simple there is a key called Renewals.\nThe first date is the renewal date. Changing that it tries to renew it again and fails, but sets it forward 30 days again. So aslong as i can figure out why it fails, changing this date manually will fix it.. Guys, try this release out:\nhttps://github.com/jmarden/letsencrypt-win-simple/releases/tag/v1.9.1\nIt didnt work for me cause i get an error saying primary domain mismatch. I think the trouble we had before was that the official release doesnt support renewals at all for SAN. But this one should.. Have you guys tried the new branch instead? . @WouterTinus exactly. The second is solved in the new branch.. I had some problem with this, but managed to get it work for me. It complained that it couldnt find the certificate file. Needed to do some manual changes since it was adding the filename twice.  \nRan it with:\nletsencrypt.exe --plugin manual --manualhost mail.company.com,autodiscover.company.com --validation selfhosting --installation iis,manual --installationsiteid 1 --script \"./Scripts/installexchange.bat\" --scriptparameters \"{0} {5} C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.let\"\nSo no {2} on the end cause then it would be: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.let\\certfile.pfx\\certfile.pfx\nI dont know why. And then i had to rename my certificate file cause it had a name of -all in it, which the script didnt know.. ",
    "bencurthoys": "I think I want to use letencrypt-win-simple in the same way that you do... \nI just created this issue which is what I thought would fix the issue for me:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/419\nbut if I were going to look at the code I'd have done the \n--forcerenewal Causes the renewal logic to ignore the Date in the registry and renew the certificate.\n--notaskscheduler Skips the prompt and code for creating/updating the scheduled task.\n--closeonfinish Prevents the app from waiting for a key press at the end of execution.\nflags as you did because I need them too. \nI'm not very clear on how Git works either; would it make more sense for me to try and contribute to your fork instead of the main trunk?\n+\nIn your fork, with SAN + manualhost, does it update the IIS bindings? Because\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/305\nsays it doesn't attempt to update IIS bindings when manualhost is specified, but I really don't see why it shouldn't iterate over the IIS sites until it finds one that matches the manual host and webroot and update the bindings on that. . I just tried your fork and it doesn't help me; I want a completely unattended script that I can fire at a fresh machine and not have it pause for user input at all ever, and whilst yours doesn't ask about creating scheduled tasks, it does ask \"Do you want to install the .pfx into the Certificate Store / Central SSL Store\" and it doesn't have a parameter for \"signeremail\". \nI think my best bet is to wait for the 2.0 refactor from @nul800sebastiaan and then start contributing to that. \nMy plan is to make PromptYesNo take a parameter to supply a default value, and then add an --unattended option that, if set, just makes PromptYesNo return the default instead of waiting for a keypress. . I've seen this too and my gut feeling is that it happens when you are doing something that takes a long time - e.g. creating certificates for all hosts on a server that has a lot of hosts. I think that the script creates a session with the server, starts requesting certificates, but eventually that session times out, and the next time you go to request on you get an error. . ",
    "soberdor": "Hi @jmarden and thanks for your efforts! I also just ran into the renewal failure on Windows/Apache, but I have the added problem that I'm still dependent on TLS 1.0 - this was re-enabled in the latest release (1.9.3). Could you maybe provide an updated version of your fork? That would be greatly appreciated!. ",
    "moonbug": "@LBegnaud  How do I specify the primary host (eg. test.com) for the SAN renewal? \n--san --manualhost test.com, test01.com --renew\nis the first domain in --manualhost automatically considered primary host or do I add --BaseUri test.com?\n@LBegnaud in your option list, is that a typo , did you mean --BaseUri, there is no  --baseurl option. ",
    "mesa57": "I am wondering why this needed change has never been merged \ud83d\ude1e . Thank you very much !. The reason it failed was in letsencrypt-win-simple itself. It silently generates a message that the manual option is not supported for renewal.. @josephrcolis Please look at #474 also. Same problem I think, I also use --san because I have multiple domain names.. I know the rule concerning the http binding. That's how I got the certificate the first time.\nAnyway, I will reset the date in the registry and try again. I will post the results here.. Ok, after resetting the date I get this : \nRenewing certificate for Manual mijnvital.nl (C:\\Program Files (x86)\\Apache Soft\nware Foundation\\Apache24\\htdocs) Renew After 15-7-2017\n WARNING: Unable to renew.\nCan anybody help me why that warning was issued ?. For apache there is no plugin needed. The certificates just have to be placed in the configured folders. \nBut --renew should work as expected. Why doesn't it work ?. I see there is a pull request #299 which solves this issue, but it got never merged \ud83d\ude1e . jmarden also created releases on his github fork : https://github.com/jmarden/letsencrypt-win-simple/releases\nAnd btw: that works. I do not understand why this was not merged.. Thank you. This makes it possible to have 1 certificate with multiple domain names like {domain name} and www.{domain name} in 1 single certificate (which in my eyes is a must have because the www alias is almost alway present) for apache servers.. ",
    "ashkansiroos": "P.S: I have the latest version (v1.9.1) and I am running it on windows server 2012 R2. \nAlso, I ran it using CMD (Administrator)\n. ",
    "Frogglet": "Hey I had this problem as well, and I was able to solve it after installing new updates and disabling symantec antivirus on the server. Hope that helps.\n. Thanks for the helpful answers, that clears it up for me nicely.. ",
    "cgq355716727": "Hey I had this problem as well. ",
    "jclimac": "I'm getting exactly the same error. Using V1.9.3, running as administrator.\nIs there any workaround?\nThanks!!\n. ",
    "lhphong09t2": ":( Me too\n. ",
    "mchupp": "That is what I was afraid of, I will need to do it closer to renewal as I have too many requests in due to testing.\n-------- Original Message --------\nFrom: LBegnaud notifications@github.com\nSent: Thu Oct 06 12:37:51 EDT 2016\nTo: Lone-Coder/letsencrypt-win-simple letsencrypt-win-simple@noreply.github.com\nCc: mchupp matt@gainmojo.com, Author author@noreply.github.com\nSubject: Re: [Lone-Coder/letsencrypt-win-simple] Way to add a domain to an existing SAN certificate (#301)\nThere is no mechanism to change the settings of an existing certificate. YOu can definitely generate a new cert with updated SAN list. Overwriting is probably what you want, but that's your choice.\n\nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/301#issuecomment-252018682\n. Thanks!. Sorry, one more question. Let's say I create san certs and then create a separate cert manually. Will that manual creation make it to this registry key? Or will I need to add it manually? @mattkemp . Allow me to hijack since I have a similar request. I went through the steps to add a certificate and the process error-ed out on the password section. Leaving me with a new certificate and no scheduled task. \nWhat is the best way to add one after the fact?. Thanks for the reply. So from your response I am going to assume that I can't influence it on the initial issue but can edit the registry entries to influence the renewal. Is that right?. ",
    "dfarrall": "Can confirm this is also an issue for myself.\n. ",
    "brichardson1991": "No i am running it directly on the exchange server and i can hit the acme request url from either on the server itself, or from an external site.\n. Apologies i mis-read what you meant.\ni can hit the file it is asking to check when it fails but it doesn't download anything it displays a blank page.\nLet me get you a example: \nThe ACME server was probably unable to reach http://autodiscover.richardson1991.co.uk/.well-known/acme-challenge/wgjAOpKcNeOm1WfkcKAWPMoke0aX0oaBr_G_gK5BPvk\n. ",
    "gerard-kanters": "I have the same issue here. Files are there in C:\\inetpub\\wwwroot.well-known\\acme-challenge I can access the files from a browser, both from the server and externally. \n. Thanks rdebath, it has been resolved. Firewall was not accepting or forwarding http traffic, only https :-) . ",
    "dmurton": "Thanks, I have done this now, however it still hasn\u2019t made a difference unfortunately:\n\n\n. Bump (sorry, I accidentally closed this the other day)\n. Thanks - I have tried doing this, but unfortunately the field is greyed out and I can't enter in a hostname. I've tried assigning it via CMD as well, but all it does is create another empty binding.\n\nI'll keep looking, but let me know if you know of a way to enter in a hostname.\n. Unfortunately that doesn't allow me to adjust either.\n\n. Thanks!\nThe hack in brianflove.com works is the sense that I can create a hostname now. However event after doing that, it still shows up saying 'No IIS bindings with host names were found...' in letsencrypt.exe.\nIt's only when the host name is set for 'http' that it shows up in letsencrypt.\nI think this may be a situation were I won't get it working with letsencrypt in its current state unfortunately.\n. I've just tried your suggestion @LBegnaud. I just need to wait for my accounting team to test out their side of things to see if it resolves this.\n\n. ",
    "leighghunt": "I too had a desire to be able to browse to my site via localhost (i.e. to get extra debug info during setup) - these are the settings I ended up going with, which should allow auto-renewal.\n\nI used the same cert on localhost as for the FQDN, which of course gives browser warnings, but allows navigation to the site.\n\n. ",
    "marchchad": "I'm pretty sure you just delete the scheduled task in the Task Scheduler.. It isn't documented, but you have to promote the StaticFile Handler Mapping above all of the ExtensionLessUrlHandler- mappings prior to running the program. Once it completes successfully, remember to demote the StaticFile Handler Mapping back to the bottom.. My understanding is that those steps are only required for the initial set up. I haven't had any problems having certs autorenew once set up.. It isn't documented, but you have to promote the StaticFile Handler Mapping above all of the ExtensionLessUrlHandler- mappings prior to running the program. Once it completes successfully, remember to demote the StaticFile Handler Mapping back to the bottom.. > our server is already pushing the http to https\nCan you provide more detail on this? You should only need a http - port 80 binding and an https - port 443 binding with the same domain (or subdomain) for the site you're getting a cert for.\nIt may also help to include a copy of or screenshot of the exact error you're receiving.. Ah gotchya, sorry for my misunderstanding. Yeah unfortunately letsencrypt is not an alternative to wildcard certs.\n\nFrom: mygeek911 [notifications@github.com]\nSent: Tuesday, January 10, 2017 4:53 PM\nTo: Lone-Coder/letsencrypt-win-simple\nCc: Chad March; Comment\nSubject: Re: [Lone-Coder/letsencrypt-win-simple] ACME Server Unable to Reach - Answer File is Reachable Through HTTPS (#333)\nThis email comes from an external source, so remember, Think Before You Click!\nI apologize for the confusion. I did get it working so the main problem is resolved, hence why I redacted the URL in the first message. When you originally clicked the link it went from a non-secure link to https. But since I was able to fix the issue, I removed it.\nWhat I was referencing in my reply immediately after yours, marchchad, was the web.config file. I just removed all of the information since that wasn't originally in there and I no longer needed it once the process completed. It seems to be working fine.\nThe only issue I have now is that our mail is set at mail.osawatomieks.org at one IP address and letsencrypt.exe only binds to that subdomain instead of also adding osawatomieks.org. Since our e-mail addresses are @osawatomieks.org and not @mail.osawatomieks.org, then Outlook is starting to pop up messages saying that the certificate domains don't match.\nI'm guessing, and I hope I'm wrong, that I'll have to continue to purchase a cert from namecheap.com with our domain and subdomain included\nI hope this makes more sense now.\n\ufffd\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHubhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/333#issuecomment-271755686, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ADmBgEt10Qyl---ItqBfjKL6m-FjP9sFks5rRDY1gaJpZM4LVTkJ.\n. It isn't documented, but you have to promote the StaticFile Handler Mapping above all of the ExtensionLessUrlHandler-* mappings prior to running the program. Once it completes successfully, remember to demote the StaticFile Handler Mapping back to the bottom.. ",
    "sunstarjeff": "It would appear that only a single scheduled task is created in Windows, and that the task runs for all installed ACME certificates.  My question deals with removing a site/binding (for example, if a site is moved to another server). \nI wonder if it's as simple as removing the pfx/pem/json files (for the given domain name) in the working directory for LetsEncrypt.. Great, thank you!  Yes, that answers it.  The lines contained in the registry key also contain the renewal date, which means there is the ability to manually update the certificate sooner (for example to test the renewal process), by changing the date and saving the key.  Thank you very much for your reply to my question.. ",
    "akuropka": "It's not as simple as that, however, if you look up the registry under\nHKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\n(the key may vary if you have set a different baseuri)\nyou find a value called Renewals and there you can delete the corresponding line.. Thank you for the fast fix... seems to work with beta 4.. I have experienced a similar problem with a changed SiteID.\nThe SiteID in the registry in the Renewals key is not updated and upon renewal the WebRootPath is changed ([WARN] - Change WebRootPath from ... to ...) whereas the validation fails as it is now saved in the wrong WebRootPath. Changing manually the SiteID fixes the issue (the WebRootPath will be adjusted then automatically).\n. ",
    "kverpoorten": "I have the same issue.\nIt does not really bother me that I have to add the certificate manually to the binding afterwards, however I do wonder now if the automatic renewal will work? \nAnyone know if this will also affect the auto renewal?\n. ",
    "bassu": "Did you guys setup with --manualhost? You guys are probably confusing the way this ACME client runs unlike the traditional Apache/Certbot. Manualhost option has no way of relating host binding with a website/vhost in IIS, so it doesn't know which vhost a binding belongs to; and as a result there's no SSL binding done for you.\nFor scripting, you can write Powershell script to a) Lookup binding b) Find its website c) Create ssl binding if it doesn't exist or d) Delete and update it if it does. Well not so quickly because bummer; Get-WebBinding and Get-Website don't relate and work with each other (the way Powershell is designed) so without extensive and slow looping, you'll probably redo the job. \nThe easier way is: letsencrypt.exe --san. \nThen select the IIS vhost/website ID as seen in IIS Manager (these will match if you used --san option; I know weird but I didn't notice until I read the code). When asked, create a scheduled task by inputting an admin user and pass. This creates a config entry in HKEY_CURRENT_USER\\Software and uses it to renew that particular vhost/website's SSL.\n. ",
    "lonbluster": "I got the same error and then tried to install the .pfx certificate manually, but it requires a password.\nShould I start over and make those bindings first?\nCan I install the .pfx manually, with which password?. ",
    "gerdesj": "Each certificate has a unique thumbprint, so yes you will have to handle that if you are using it for say Exchange ...\n. ",
    "cmacetko": "I have a website with the trailer certificate and a Fixed IP only to this site, however when running renew a new line in the BIND was created\n. ",
    "rajeshpachar": "This issue looks old. Has anyone found a solution yet ?\nIssue looks similar to \nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/340. I have also facing same issue and certificate is about expire in 3 days. I have tried both commands\n- letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\n- letsencrypt.exe --renew \nAny solutions here ?. this command worked for me:\nletsencrypt.exe --accepttos --webroot \"C:\\inetpub\\wwwroot\" --manualhost \"domainname.com\". ",
    "VaclavElias": "I think:\n1.  That is correct, the command in the Task Scheduler d:\\Install\\letsencrypt\\letsencrypt.exe --renew --baseuri \"https://acme-staging.api.letsencrypt.org/\" updates all certificates.\n2.  Not sure\n3.  I read somewhere that .well-known will be needed in renewal process, not sure once you deleted it, if it will be created again, I assume yes.\n4. I also deleted my task, and then recreated it again by creating a certificate on a test domain. Anytime you create a certificate it seems it checks if there is a task. If not it is created again.\n. I run manually letsencrypt.exe --renew and got my certificates renewed, hope the automated renewal will be fixed soon... @jphellemons I cannot assist with @rajeshpachar's solution as I don't know. I simply have 4 websites in IIS in different folders and certificates were created previously through letsencrypt.exe. \nThe automated renewal is not working so I simply run letsencrypt.exe --renew from command prompt on the date the domain should be renewed (the certificates last 90 days but --renew will update certificate after 60 days) and this worked.. @jphellemons  Yes, it was all ok but I have to restart my IIS.. @jphellemons I have no idea. But if you click in your IIS\n1) The Server name\n2) then Server Certificates icon you should see a list - the current Expiration Date of all certificates\n- if these are ok, then check your certificate again in the Browser but delete browser cache or try to check from another browser/computer\n- if the Certificates are expired in your IIS listing then you have got another problem which I cannot help with as I don't know the cause, you would need to wait till somebody else would give us an answer.. Just another update.\nI was claiming that it works ok on my server and it does but on another server I got exactly the same issue as you guys \"finally\".\nI went right away to registry hack and even that didn't work. I did again registry hack and run renew from console and got an error message that the .well-known\\acme-challenge\\ is not accessible. Well it was checking in the wrong folder. I have moved my website to another folder and it seems that it is using the path from registers for renewal. So one more edit, including the incorrect path in WebRootPath and then I got my certificate renewed. \nWhat a surprise. Now I have to remember this :). Possibly, check your registers again. I see that you have got there \"WebRootPath\":\"C:\\Websites\\www.expiredcert.com\\20170213\". Try to fix the path in registers and date again and then run the renew again.. Well, that's up to the developer of this application @Lone-Coder :). Actually, that is correct answer for me for now :)\nHappy to do that till something else emerges.\nI will test it and update here.\nThank you!. ",
    "srijken": "Hi, I noticed that, but it doesn't seem to work when setting it up for the very first time. When I run with --warmup, I don't get the list of sites to choose from?\n. Any updates on this? Right now we have to keep trying until it is fast enough after a while.. and sometimes that means we have to try it dozens of times... looks like --warmup isn't part of v1.9.1. Are there any plans for a new release?. ",
    "OliverHi": "Ah thank you, once I added a binding for port 80 it poped up in the program (http server.xyz.myfritz.net 80 *). When I select that one though I get an error message that the ACME server was unable to reach the file. And sure if I open that url in the browser I get a 403 error.\nAny idea how to fix that? Or how to use another port instead of 80? I did already add a port forwarding rule in my router for port 80 to 7001 on the server\n. ",
    "KeenRivals": "203 might resolve this without requiring an http host.\n. ",
    "leo9223": "yeah thank you so much. my DNS records were not pointing to my domain name.. ",
    "chises": "\ni have this issue in the last version 1.9.4.1. ",
    "w0rkrb": "I'm having the same problem as morphje. I am running as Admin with correct rights on the webroot folder. I can resolve my problem using a similar approach to morphje however I wonder if this may be worth looking at. I am happy to work with someone to see if we can see what's going on.. Since I'm using the command line tool in a batch file with a larger context I've added folder creation to the overall script like so:\n:create_https\nrem ===========================================================\nrem Create https bindings and letsencrypt cert for site\nrem ===========================================================\necho creating required files and folders for TLC certs\nif not exist %WEB_PATH%.well-known\\acme-challenge mkdir %WEB_PATH%.well-known\\acme-challenge\nif not exist %WEB_PATH%.well-known\\acme-challenge\\web.config copy %CERTTOOLPATH%\\Web_Config.xml %TLC_PATH%.well-known\\acme-challenge\\web.config\necho Okay we need to wait a short while for DNS to update so LETSENCRYPT can find the site .........\ntimeout 30\necho Getting SSL cert from LetsEncrypt for site on %URL%\n%CERTTOOL% --accepttos --manualhost \"%URL%\" --webroot \"%WEB_PATH%\"\nHope this helps someone :). ",
    "jaredthirsk": "+1\nI looked to this tool because it had unattended options.  Clearly this does not support unattended in its present state.. I created a pull request to at least add email and default to the default user for creating the task: https://github.com/Lone-Coder/letsencrypt-win-simple/pull/325. Sample usage: letsencrypt.exe --emailaddress my@email.com --usedefaulttaskuser --accepttos --manualhost example.com --webroot c:\\html. I updated the wiki: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/How-To-Run. ",
    "hagman": "This is at most a workaround until the main issue is resolved, but IIRC, it suffices under most Windows systems to grant rights to the innermost folder and the path components ACL are not checked. ",
    "OYCom": "@hagman At least on our server 2k8r2 this does not work. Probably may be caused by inherited ACL settings. Apache fires \"not found\" entries to the eventlog when accessing SSL sites - and these does produce cert warnings in browsers since cert files cannot accessed. Our \"workaround\" currently is to do all the jobs manually and hope its would not forgotten when letsencrypt certs expires.. ",
    "blooodorange": "@headscratcher same here. Workaround:\nNavigate to acme-challenge folder and create a MIME wildcard mapping via IIS Manager:\nExtension: *\nMIME Type: application/octet-stream\n. ",
    "headscratcher": "If one has to promote and demote the StaticFile Handler Mapping it's no longer an automated process, or am I missing something ?\nTo reiterate, I did not see the web.config file being created as per the docs. ",
    "DuBistKomisch": "Yeah ran into the same issue... adding a MIME mapping from . to text/plain stopped it 404ing and worked perfectly after that. application/octet-stream is probably a better idea as it's more generic.\nI guess IIS thinks it's more secure to not serve unknown file extensions by default, not much letsencrypt-win-simple can do about it, given you have to manually set up IIS before it'll work anyway.. ",
    "warrenkc": "Hi. I am having trouble. The authorization fails even when I have checked the file in the browser and it shows up correctly. What can I do?\nhttps://pugetsoundestateauctions.com/.well-known/acme-challenge/MSbTQiJIVTC4Pf5ZS56Jpf0D3W18mMTNF3cDx0WEJLM\n\n. I always get the error as well. It seems like if I delete the progam and try again, it works sometimes. It seems entirely random to me.. Is that possible that it would randomly not work? That seems really weird to me. I really wish this issue could be resolved as it happens a lot.. ",
    "akrohn": "Is there any documentation on how to use these new options? Dont find anything in the wiki about it.. ",
    "nMountain": "Bump. How do I put the email as a parameter?. Thank you, but it\u2019s not working unfortunately.\nI\u2019m getting this error:\n\u201cEnter an email address (not public, used for renewal fail notices): Error NullReferenceException {Message=\"Object reference not set to an instance of an object.\", Data=[], InnerException=null, TargetSite=Void Main(System.String[]), StackTrace=\"   at LetsEncrypt.ACME.Sim\nple.Program.Main(String[] args)\", HelpLink=null, Source=\"letsencrypt\", HResult=-2147467261}\nPress enter to continue.\u201d\nWhen I run this in PowerShell: .\\letsencrypt.exe --emailaddress nhill@myworkdrive.com --usedefaulttaskuser \u2013accepttos\nI have tried with and without specifying manual host.\nFrom: Jared Thirsk [mailto:notifications@github.com]\nSent: Monday, May 8, 2017 3:14 PM\nTo: Lone-Coder/letsencrypt-win-simple letsencrypt-win-simple@noreply.github.com\nCc: Nate Hill nhill@myworkdrive.com; Comment comment@noreply.github.com\nSubject: Re: [Lone-Coder/letsencrypt-win-simple] Command line parameters for Email address and use default user for renew task (#325)\nI updated the wiki.\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHubhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/325#issuecomment-300006055, or mute the threadhttps://github.com/notifications/unsubscribe-auth/AbOMJPfac1VvnV6F3rQB7YcJos8j7FI-ks5r35OogaJpZM4LGeS-.\n. Thank you!. Yeah I resolved it. I modified the source code and manually input my email address. I also modified it so that the program produces an SSL cert for the domain name / site that is in IIS's default web site binded to port 80. This way I was able to bypass both prompts so that no user input was needed. I can send you the modified (compiled) code if you want (I would change the email of course).. ",
    "dusekj": "It worked for me with --signeremail.. ",
    "usermax83": "Apparently, compiling in Release mode solves this.. ",
    "bsthomsen": "We experienced the same recently we added 4 new certificates on a server where a site already had one. Resulting in the site with the existing certificate being updated with the last created aswell. However the 4 new ones are still correct.. ",
    "nakchak": "Use powershell cmdlets before and after LEWS\nhttp://serverfault.com/a/562341\nSpecifically \nNew-WebBinding: https://technet.microsoft.com/en-us/library/ee790567.aspx\n&\nRemove-WebBinding:  https://technet.microsoft.com/en-us/library/ee790591.aspx. ",
    "hidegh": "Have tried, and even restart (entire PC) and after reinstalling a new cert with the console app.\nAnyhow, even not having the X1 cert. on my system the intermediate cert. of the generated SSL cert is still X1.\n\n\n\nbtw i test it also here: link\n. Hi, thanx for the help. On IIS the certificates (and chains) seems to be correct. Weird thin is that (although clearing HSTS in android chrome too) the cert. does not seems to be valid...and thy should be with DST and X3.. yeah, psexec -i -s and my user account for the snap-in was the key. big thanx.. ",
    "mygeek911": "Thanks to both of you! I ended up disable the SSL settings in the Default Web site, and then require it where it was needed.\nmarchdad, is it just a matter of changing the web.config file again? I had the StaticFile Handler Mapping changed as you noted from back when I originally asked the question, but then I just deleted all of the handler information from the web.config file today. Will that take care of it?. Our main web site is handled by another host than where our mail server is located. I'm thinking that this may be a bit more difficult to work with Let's Encrypt since now Exchange is saying that our main domain isn't part of the certificate. Should I just renew the commercial cert?. I apologize for the confusion. I did get it working so the main problem is resolved, hence why I redacted the URL in the first message. When you originally clicked the link it went from a non-secure link to https. But since I was able to fix the issue, I removed it.\nWhat I was referencing in my reply immediately after yours, marchchad, was the web.config file. I just removed all of the handler information since that wasn't originally in there and I no longer needed it once the process completed. It seems to be working fine.\nThe only issue I have now is that our mail is set at mail.osawatomieks.org at one IP address and letsencrypt.exe only binds to that subdomain instead of also adding osawatomieks.org, which is actually hosted on another server/IP. Since our e-mail addresses are @osawatomieks.org and not @mail.osawatomieks.org, then Outlook is starting to pop up messages saying that the certificate domains don't match.\nI'm guessing, and I hope I'm wrong, that I'll have to continue to purchase a cert from namecheap.com with our domain and subdomain included\nI hope this makes more sense now.. I hadn't even thought about it until I went through the process. I thank you though for helping me out!. ",
    "matso42": "It seems like you are right about that , bummer ;)\nI was fooled by the statement from letsencrypt that San certificates could be used to replace Wildcards. Since there is enough to prove that you own your domain to get a wildcard for it I assumed that the same should apply for San certs. As it stands today it makes issuing certs for non-web-servers rather \"interesting\"\nIn the scenario I'm working on now I need a San certificate for the Proxy server and to standard certificates for two stand alone web servers and an appliance box behind the proxy. \nlets say we got the following servers:\nProxy.example.org\nWeb.example.org\nMail.example.org\nVPN.example.org\nSince there is a need for SSL inspection Proxy.example.org must have a certificate that can represent all three servers. \nI also want server certificates for Web, Mail and VPN.\nSince Web and Mail are standard windows servers it's easy to put the client on them and that's it. \nThe problems starts when we come to the proxy machine. As the client works today it will put all challenge files in one directory - hence making it impossible to have that URL forwarded to the correct server for getting the servers own certificate.  Here I would like an option to select a Webroot for each SAN name. That would give a possibility to issue both a standard server cert for the server and the san cert for the proxy from the same webroot. \n. ",
    "pbarclay": "I can't get this to work. I move the handler as suggested but always get a 404 for the challenge file.\n.\n.\n.\nAuthorization Result: invalid\nAuthorization Failed invalid\n\nThe ACME server was probably unable to reach .well-known/acme-challenge/fLWUx1tBma3tPFQvepL2r_qMKJGuEVHEP83LrDfWKrM\nCheck in a browser to see if the answer file is being served correctly.\nAuthorize failed: This could be caused by IIS not being setup to handle extensionless static files.Here's how to fix that:\n1.In IIS manager goto Site/ Server->Handler Mappings->View Ordered List\n2.Move the StaticFile mapping above the ExtensionlessUrlHandler mappings. (like this http://i.stack.imgur.com/nkvrL.png)\n3.If you need to make changes to your web.config file, update the one at\n.\n.\n.\n. Is this relate to the issue of IIS not serving files without an extension? I can not get static file serving so I get the error reported above. I have literally tried everything the internet has to offer but nothing works. I managed to get the file loading by adding an extension and using a rewrite rule to map the extension-less request to the the new file but there is no way to run the letsencrypt app again and use the smae authorization file twice. \nSimple fix would be to just add a .txt extension to the file an then it would work 100% of the time in all web servers.\nThe fact people seem to be able to solve this problem means I am overlooking something , it's driving me crazy. ",
    "madman32395": "yep. same here. Date adjusts, but certificate doesnt.. ill try again when it comes time to renew in march, but try removing the --baseuri \"fdsjlksd-api.letsencrypt.org\" part from the task.  making the arguemnts just --renew\npath\\letsencrypt.exe --renew. ",
    "jphellemons": "@madman32395 I did not had the baseuri parameter, just the --renew\nletsencrypt.exe --renew --baseuri https://acme-v01.api.letsencrypt.org/\nalso did not work (for me).\nIf I just run letsencrypt.exe and overwrite for that website, it does work. It is just the renewal that does not.. @VaclavElias The console output of the command gives no errors, however the real ssl cert still has the old date in it.\nI have several websites. Each in its own dir C:\\websites\\website1  C:\\websites\\website2 etc. so my webroot should be \"C:\\websites\\\"? or just the default wwwroot of IIS for the vb admin scripts? If I want to use @rajeshpachar's solution, I have to make a script to run it for each of my websites in the C:\\websites folder because of the host specification.. @VaclavElias ok, but have you verified the cert in the browser? because my console output seems great, but the served cert is not updated.. @VaclavElias iisreset or a reboot did not fix it for me. I have an expired cert now, while the command line output says that the certs are renewed and still valid. Really strange... \n\nThe ones with 2017 are done manually. \n\nedit is it possible that the top entry of the list was blocking the whole thing? because I got an error manually updating that one: I had to move the static file handler above the extensionless handler on the iis site.\n. I have manually re-created all of them and encountered this staticfile handler issue, so maybe that does solve it for me.\nSo when I check the iis server certs, it is great because of the manual re-creation:\n\n. I will try the registry hack. I am running 1.9.3 release atm https://github.com/Lone-Coder/letsencrypt-win-simple/issues/408#issuecomment-292777831\nHKCU/Software/Let's Encrypt \n\nthe renewal value for the expired cert is:\n{\"Date\":\"2017-06-14T07:00:10.6303531Z\",\"Binding\":{\"Host\":\"www.expiredcert.com\",\"WebRootPath\":\"C:\\Websites\\www.expiredcert.com\\20170213\",\"SiteId\":4,\"AlternativeNames\":null,\"PluginName\":\"IIS\",\"Plugin\":{\"Name\":\"IIS\"}},\"CentralSsl\":null,\"San\":\"False\",\"KeepExisting\":\"False\",\"Script\":null,\"ScriptParameters\":null,\"Warmup\":false}\nso it expired yesterday and running:\nC:\\letsencrypt-win-simple.V1.9.3>letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\ngave me:\n...\nChecking IIS www.expiredcert.com(C:\\Websites\\www.expiredcert.com\\20170213) Renew After 14-6\n-2017\n....\nBut did not auto renew. any thoughts?\nin windows there is also no history of the running task.... When I create a cert for a site, it lists the iis entries... But I have a dir structure: c:/websites/mydomain/20170101/websitefileshere and when I release a new version of the website I ftp it to c:/websites/mydomain/20170619/websitefileshere So I use a date folder for each new version. I change the folder in IIS to set it to production... Can that be the renew issue cause? That the renew still expects the old folder being active in IIS?. I think it is the registers indeed! But is it possible for letsencrypt-win-simple to take the current dir from iis, instead of storing and reading it from the registry?. Worked! Thanks guys!. Seems like my issue https://github.com/Lone-Coder/letsencrypt-win-simple/issues/340\nC:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nhas old files for my domain which are not renewed.. Here is a sample entry from my:\nHKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\nRenewals (REG_MULTI_SZ)\n{\"Date\":\"2017-08-11T07:00:16.7818123Z\",\"Binding\":{\"Host\":\"www.mydomain.com\",\"WebRootPath\":\"S:\\\\www\\\\www.mydomain.com\\\\20170105\",\"SiteId\":30,\"AlternativeNames\":null,\"PluginName\":\"IIS\",\"Plugin\":{\"Name\":\"IIS\"}},\"CentralSsl\":null,\"San\":\"False\",\"KeepExisting\":\"False\",\"Script\":null,\"ScriptParameters\":null,\"Warmup\":false}\nBut updating the websites, we change the webrootpath to a newer \"date\" folder... I think that that might break the auto renewal? Or does it lookup the webrootpath by using the siteID and the IIS metadata?. I have removed them already from the cert store (iis does not list them on the server level) But how do I cancel the renewal?. ",
    "chobo2": "Same problem, says my cert is updated in cmd line but when I go to my website it is expired.. ",
    "kohenkatz": "May also be related to #408. ",
    "StefanLundmark": "Is this bug still around? I just ran into this today but I'm not sure which version I'm on.. Some information is stored in the registry as well. Please verify the expirary dates there are correct.. Thats unfortunate. I would start the process from scratch if I were you. Delete the existing certificates folder and the registry key and try that. Have seen it help others but YMMV.. ",
    "jafrajarvy292": "I have the same issue. Noticed the scheduled task that runs the following command line:\nC:\\letsencrypt-win-simple\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\nAppears to run successfully. Even in command prompt, when I run it, it doesn't show any issues. However, when I check the folder where all the certs are stored, it doesn't show any of them were updated. I tried renaming the default folder thinking maybe it was a write permission issue. When I did that, though, it re-created the default folder, but only created the Registration and the Signer files. Nothing else.\nI can't figure it out.\nIn case anybody is interested, here is the printout of the command line:\nC:\\Windows\\system32>C:\\letsencrypt-win-simple\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\nThe global logger has been configured\nLet's Encrypt (Simple Windows ACME Client)\nRenewal Period: 60\nCertificate Store: WebHosting\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: C:\\Users\\David Tran\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nCertificate Folder: C:\\Users\\David Tran\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nLoading Signer from C:\\Users\\David Tran\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\nGetting AcmeServerDirectory\nLoading Registration from C:\\Users\\David Tran\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\nChecking Renewals\nChecking Manual corps.asuscomm.com (C:\\xampp\\htdocs\\phptraining) Renew After 8/25/2017. Here is the value of the Renewals string\n{\"Date\":\"2017-08-25T16:00:01.6352383Z\",\"Binding\":{\"Host\":\"corps.asuscomm.com\",\"WebRootPath\":\"C:\\xampp\\htdocs\\phptraining\",\"SiteId\":0,\"AlternativeNames\":null,\"PluginName\":\"Manual\",\"Plugin\":{\"Name\":\"Manual\"}},\"CentralSsl\":null,\"San\":\"False\",\"KeepExisting\":\"False\",\"Script\":null,\"ScriptParameters\":null,\"Warmup\":false}\nMy certificate shows it will expire on July 25 2017. Should I change that date in the registry to 2017-07-25 then?\nEDIT: Changing registry date to various values didn't seem to get me any progress.. It appears this might be a bug mentioned in issue #195 \nHowever, it looks like I also had my auto-renew task operating without Administrative permissions, so maybe it renewed but couldn't write to the folder. Hard to tell what the cause is at this point. Anyway, I created a new certificate. If the auto-renew fails again this time, even with elevated permission, I'm going to revert to v1.8.0. ",
    "bbct": "Perhaps a better idea would be the following?\n(Disclaimer - I have not looked at the code...)\nIf PromptYesNo is used for confirming the user really wants to use what was entered, why not have a command line argument that specifically indicates it is being run in \"quiet\" or \"unattended\" or \"noprompt\" mode.  Because passing a value in an input file, and then passing confirmation that you \"typed\" it properly also in that input file seems silly...\nShould be an easy change to check if \"noprompt\" parameter was passed, and if so, assume the input is correct and don't prompt at all...\nJust be sure to test your input file by including --test the first time you run it.  If it looks good, remove --test and you are all set!. ",
    "HodofHod": "This is still an issue when --test is specified. Test mode is never completely unattended, still asking questions like Try in default browser? (y/n): and [--test] Do you want to install the certificate? (y/n):. ",
    "sa9927": "I've tried this but with no luck :(\nI'v got the following reply:\nLet's Encrypt (Simple Windows ACME Client)\nRenewal Period: 60\nCertificate Store: WebHosting\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: xxxxxxx\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nCertificate Folder: xxxxxxxxx\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nLoading Signer from xxxxxxxxx\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\nGetting AcmeServerDirectory\nLoading Registration from xxxxxxxxx\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\nScanning IIS Site Bindings for Hosts\nW: Generate a certificate via WebDav and install it manually.\n F: Generate a certificate via FTP/ FTPS and install it manually.\n M: Generate a certificate manually.\n A: Get certificates for all hosts\n Q: Quit\nWhich host do you want to get a certificate for: M\nEnter a host name: xn--xxxxxxxxx-lwb.se\nEnter a site path (the web root of the host for http authentication): %systemdrive%\\inetpub\\wwwroot\\xxxxxxxxx\nAuthorizing Identifier xn--xxxxxxxxx-lwb.se Using Challenge Type http-01\n Writing challenge answer to %systemdrive%\\inetpub\\wwwroot\\xxxxxxxxx.well-known/acme-challenge/LqK12I_nZRd_P3mnXXXXXXXXPQZHd99iLL71kgY\n Answer should now be browsable at http://xn--xxxxxxxxx-lwb.se/.well-known/acme-challenge/LqK12I_nZRd_P3mnXXXXXXXXPQZHd99iLL71kgY\n Submitting answer\n Refreshing authorization\n Authorization Result: invalid\n\nThe ACME server was probably unable to reach http://xn--xxxxxxxxx-lwb.se/.well-known/acme-challenge/LqK12I_nZRd_P3mnXXXXXXXXPQZHd99iLL71kgY\nCheck in a browser to see if the answer file is being served correctly.\n\nPress enter to continue.. Thanks.\nI can reach http://xn--xxxxxxxxx-lwb.se/.well-known/acme-challenge/LqK12I_nZRd_P3mnXXXXXXXXPQZHd99iLL71kgY and I see the content string of the file\nEDIT:\nAfter alter the web.config according to https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/web.config I have got it to work, thanx a lot\nI can add that I also have the domain without IDE-characters and there have LWS work like a charm :) . Yes everything working as it suppose to do so again thank you.. ",
    "Fishthedj": "I checked the source code and it seems that the app is trying to create folder \n\nC:\\Users\\\\AppData\\Roaming\\letsencrypt-win-simple\\\n\nWhere  is name of the user which is running the task and  will probably be \"httpsacme-v01.api.letsencrypt.org\". It is something like:\n\nC:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n\nSo first of all I would check if the user who is running the task is able to write into his AppData folder.. Try running the LE like if you just want to add new domain. So use something like \nletsencrypt.exe --manualhost www.example.com --webroot C:\\inetpub\\wwwroot\\\nOnly the domain will be the same one as the one you need to renew. I just tried it and it worked for me.. You need to use Registry Editor, go to HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\\ folder and edit value of registry key called Renewals.\nWhen checking for certificates that needs to be renewed, the app is using value of this key. \nThe value consists of separate rows one for each site that should be check and renewed if needed.\nSo you need to remove the row which contains information about the site/domain which you no longer have in IIS.. ",
    "mikebrind": "Further information. It appears that the multiple sites running on one code base might be a red herring. When I initially requested a certificate, the response couldn't be found so I changed the order of the static file handler as suggested in the console window so that it was higher than the extensionless url handler. while this enabled the acme-challenge file to be found, it seems to have broken routing for the ASP.NET web forms sites affected. When I reordered the handlers, the sites worked again.  . I see this has already been discussed: https://github.com/ebekker/ACMESharp/issues/15\n. ",
    "bjmi": "I had a similiar problem that one of my two certifcates didn't renew. The renewal process failed because of a misonfiguration of that site (Require SSL was enabled but ACME checks against http) but certificate wasn't renewed after fixing the site configuration.\nI think letsencrypt won't actually check for certificate renewal before the date that is stored in\nHKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/Renewals\nalthough the scheduled tasks runs on a daily basis. I had to predate that line in registry and run\nletsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\nagain with successful renewal.. ",
    "CommanderAlchemy": "@WouterTinus \nNot sure if I should create a new issue or remain here.\nI have a SAN cert for www.tld.com and tld.com\nIt renewed the cert for the www.tld.com but not for tld.com\nStarting the task manually does not seem to renew the cert that will go out the 12th October. \nServer is running 1.9.4 of lets encrypt win simple. \n(but i did only replace the files contained in the zip, do i need to do something else during upgrade?). @WouterTinus \nI looked at it a bit closer and yes you are correct they are not the same certs. Seems that some websites got bindings with SAN certs only, while one or two got bindings with the previous cert for the one binding while SAN cert for the other binding.\nWhat i did was installed a default cert previously it mostly binded to www.tld.com, then with version 1.9.3 did a SAN cert install for www and without www for same websites. I'm guessing it kept the older certs and gave a new cert for some bindings.\nI updated the bindings with the wrong certs to the correct ones, should I remove the other certs from Server Certificates and let it be, or should I do something more?  . ",
    "timc4": "319  would be helpful for me as well.",
    "Bitmapped": "I'm running into this same problem. It would be nice if these pull requests could be merged in.. There are several users who apparently have write access and have made commits within the past month. It may be beneficial to reach out to one of them.. @UweKeim Not that I know of specifically. @nul800sebastiaan appears to be one of the more recent people to commit to the project so I'd just contact him and ask him to look at your pull request.. ",
    "silentcross": "if you need free ssl just try https://letsencrypt.org/docs/client-options/ in browser section. ",
    "msnapka": "Closest to what I need is letsencrypt-win-simple.. ",
    "aellert": "Today, I try again and Authorization Result is valid. Maybe a problem with the remote ACME api ?. ",
    "akishu": "I have the same issue as above with the one web server we are using this for. I tried everything given in the output as the OP and still can't renew my certificate. Please help and let me know if you need further details.. ",
    "CipherBruceH": "NOTE: (I also entered my issue in the [Help] topic of the Let's Encrypt forum)\nI'm trying to create a SAN certificate, but I get authorization errors on [some] of the base domain's sub-domains, while other sub-domains of the same base domains are authorized successfully.\nserver hosting = Rackspace\nMain domain (@ Rackspace):\n- businessdts.com\nOther domains hosted (@ Network Solutions) whose DNS A records point to businessdts.com:\n- businessdatatransfer.com\n- businessdataaccess.com\n- bdts.us\nWindows Server 2008 R2\nIIS 7.5\nC:\\Program Files (x86)\\letsencrypt-win-simple>letsencrypt.exe --san\nNOTE: All of the base domains and their WWW sub-domains authorized successfully.\nSome of the other sub-domains were authorized successfully... others failed with:\n\"ACME server was probably unable to reach http:\\sub.domain.com...\"\nPASS:\nSERVER-NAME.businessdatatransfer.com\nSERVER-NAME.bdts.us\nSERVER-NAME.businessdataaccess.com\nsmtp.businessdts.com\nmail.businessdts.com\nFAIL:\nSERVER-NAME.businessdts.com\nsmtp.businessdatatransfer.com\nmail.businessdatatransfer.com\nsmtp.bdts.us\nmail.bdts.us\nsmtp.businessdataaccess.com\nmail.businessdataaccess.com\nDoes anyone have an idea of what could cause the mix of authentication successes and failures across these sub-domains?\nThanks,\nCBruceH. ",
    "Quentinb": "I also have the same issue. Have tried it a few times with different configs. .well_known is browsable from the site. Keeping in mind the the domain is internal to my network and does not resolve to a public IP.. ",
    "MasterChiefmas": "I've run into something similar to this but using sites served through SNI. \nWhen I run the lets-encrypt.exe, I don't seem to be able to just select which site I want a new cert for and have it work. It seems like when I do that, letsencrypt-win-simple wants to write a web.config file into the acme-challenge folder that the authentication file is located in.  \nThat web.config is breaking access to all files in the directory, which breaks the ability of the site to be authenticated. However, if I select the manual option and targeting the root folder of the site, tt works exactly like I expect the automatic one to work, except it succeeds because it doesn't write a web.config into the acme-challenge folder and break IIS' ability to serve files from there.\n. ",
    "pra1ham": "facing this issue, please suggest a resolution:\nis it required that the site should be accessible over internet to proceed with below step without error?\n\n. awaiting this to get resolved....\n\n. ",
    "habibi-m": "same issue here for me. \n\nreally appreciate any suggestions. ",
    "rosdi": "It works for me after 3 attempts... \nFirst got [EROR] Authorization result: invalid\nSecond got [EROR] Authorization timed out\nThird success!...\nI didn't wait or try to fix anything... just retried it and it suddenly works on the third try to my pleasant surprise! :-). ",
    "Kevinrob": "I have the same issue (the Renew After is more than certificate expiration). The workaround of @Fishthedj work \ud83d\udc4d . ",
    "knowledgeplaces": "Thanks for all your feedbacks.\nI used letsencrypt to regenerate the certificate.\nWhen I launch the scheduled task manually, the renewal dates are all correct now.\nCan't understand why things went wrong, but everything seems fine now.\nThanks again.. ",
    "dombarnes": "Thanks @Fishthedj! Never would have found that. Appreciate the help. ",
    "joebucar": "Hello,\nThank You for the response. I currently have a cert for domain1.com. So do I now create a cert for www.domain1.com. Then when they do expire, do I recreate them using the SAN option?\nThanks,\nJoe  . Hello,\nI tried to use this as a renewal\nletsencrypt.exe --accepttos --webroot \"D:\\iis\\Test1_IA11\" --manualhost \"xiaptesx.xarxwarx.com\"\nand the following is the output:\nAuthorizing Identifier xiaptesx.xarxwarx.com Using Challenge Type http-01\n Writing challenge answer to D:\\iis\\Test1_IA11.well-known/acme-challenge/yCLPbJCR4\nK4gUqUAMYOEoylLPOfemKshMbN5AejyJUw\n Answer should now be browsable at http://xiaptesx.xarxwarx.com/.well-known/acme\n-challenge/yCLPbJCR4K4gUqUAMYOEoylLPOfemKshMbN5AejyJUw\n Submitting answer\n Refreshing authorization\n Authorization Result: invalid\n\nThe ACME server was probably unable to reach http://xiaptesx.xarxwarx.com/.well-\nknown/acme-challenge/yCLPbJCR4K4gUqUAMYOEoylLPOfemKshMbN5AejyJUw\nCheck in a browser to see if the answer file is being served correctly.\n\nIt does come up in the browser but still an error\nThank You,\nJoe\n. Hello,\nI failed to mention that the is on a Windows 2012R2 and IIS 8\nJoe\n. Thank You for your response. I can see the answer in the browser.  Firewall is not the issue. There is no antivirus issues or other security that I can think of in the way. I am not familiar with DNSSEC but I will find out. I looked at #415 and I can not find how to use forcerenewal option. \nThank You,\nJoe. ",
    "jeffmagill": "I just double checked the Trusted Certificate Authorities on my server and the list is substantially smaller than my regular workstation. At this point, I assume that I am missing the LetsEncrypt CA. I know this isn't an issue with letsencrypt-win-simple but if anyone can point me in the right direction, I would be very appreciative.. I solved this. I should maybe delete this whole thread but I'll leave it in case it helps someone else. My server was created with a vastly trimmed set of certificate authorities. On my regular dev workstation, I opened a commend prompt and ran\ncertmgr\n\nGo to Trusted Root Certificate Authorities > Certificates\nSelect all and export them. I did PFX file format. \nUpload the exported certs to the affected machine (e.g. my server). Go back into the same location in certmgr. \nRight click anywhere, All Tasks > Import\nSelect your file and finish up. Now you should be able to run letsencrypt-win-simple.\nIf someone removed the CAs, it was probably for a reason and therefore it isnt a great idea to add several dozen back in. Ideally, you would just add whichever CAs are required for LetsEncrypt, but I couldnt figure that out so I just did the nuclear approach and imported them all.. I just checked and mine was set to Not configured. I just changed it to Enabled for any future updates.. ",
    "trentbraidner": "Thanks @nul800sebastiaan for taking this project on board. Absolutely right this tool has been a lifesaver \ud83d\udc4d . I can provide debug logs if that helps\nRegards,\nTrent Braidner\n\nOn 7 Nov 2017, at 4:23 pm, Wouter Tinus notifications@github.com wrote:\nThat's pretty shocking. I can't immediately imagine what could cause it, but I should do some performance testing with large amounts of bindings.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub, or mute the thread.\n. Im sceptical that is the cause only because download here is not an issue for that list.\nFurther testing on my end shows 1.9.6.2 working no problem at all, it has a long pause after validation of the cert but then carries on.\n\nC:\\Windows\\system32>E:\\letsencryptbeta\\letsencrypt.exe --centralsslstore E:\\CentralCertificateStore\n[DBUG] Options: Options {Warmup=False, BaseUri=\"https://acme-v01.api.letsencrypt.org/\", Test=False, Verbose=False, Renew=False, ForceRenewal=False, KeepExisting=False, SiteId=null, ExcludeBindings=null, HideHttps=False, ManualHost=null, ManualTargetIsIIS=False, WebRoot=null, UserName=null, Password=null, AzureTenantId=null, AzureClientId=null, AzureSecret=null, AzureSubscriptionId=null, AzureResourceGroupName=null, DnsCreateScript=null, DnsDeleteScript=null, CentralSslStore=\"E:\\\\CentralCertificateStore\", Script=null, ScriptParameters=null, SSLPort=443, AcceptTos=False, EmailAddress=null, Plugin=null, ValidationMode=\"http-01\", Validation=null, CloseOnFinish=False, NoTaskScheduler=False, UseDefaultTaskUser=False}\n[DBUG] Using Centralized SSL path: E:\\CentralCertificateStore\n[DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n[INFO] Let's Encrypt Windows Simple (LEWS)\n[INFO] Software version 1.9.7.11910 (RELEASE)\n[INFO] IIS version 8.5\n[INFO] ACME Server https://acme-v01.api.letsencrypt.org/\n[INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n[DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\n[DBUG] Getting AcmeServerDirectory\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n[DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\n[DBUG] Certificate folder: E:\\CertificateStore\\Letsencrypt\\\n[DBUG] Certificate store: WebHosting\n[DBUG] Renewal period: 60\n[DBUG] Scanning IIS site bindings for hosts\n[DBUG] Scanning IIS site bindings for hosts\nIts the last line  [DBUG] Scanning IIS site bindings for hosts thats runs for many iterations before showing the menu, and after validating the cert via HTTP-01.\nI can send an applicationhosts.config somewhere privately if that helps (too many bindings to obfuscate). @WouterTinus v1.9.7.1 has fixed my issue. Still takes a while when hiding https bindings but that is a serious improvement. Greatly appreciate your time thank you.. ",
    "thenotandy": "The option is great, but I would prefer that they stay exportable by default. One example would be a server migration where I would migrate all current certificates to a new server. If any of the sites were SSL only I would have issues requesting a certificate. Just my 2 cents.. If a migrated site doesn't have a certificate because it wasn't exportable from the old server and the site only allows SSL requests then the binding wont be active and it will not be possible to request a certificate.. ",
    "lmeyer1": "Thanks. In fact, I changed to ACMESharp, because I could not get running it with win-simple.. ",
    "pixelfreak": "This is happening to me too. I tried manually putting a dummy file in that folder and I can access it on a browser. So possibly, it's not writing anything to that folder. Any idea why and how to fix this? I am on the latest version.. I am using node js on Windows, not IIS. Manual host name and self-host.. Yes, the node.js server is listening on port 80. What type of logs? I set --verbose and it didn't really give any meaningful data aside from the URL returning 404.\nBtw, this worked in previous version.. Thanks. That works, but I ran into another problem. The old version stored the certificate at: C:\\ProgramData\\letsencrypt-win-simple\\ The new version at C:\\ProgramData\\win-acme\\. \nIf I rename the folder manually or delete them, when I generate the cert, I get an error saying that it couldn't find the Signer file at letsencrypt-win-simple. How do I fix this so it looks at the updated folder name instead?. @WouterTinus yes, I deleted it from ProgramData completely. I tried removing all renewals too. No luck. Still getting DependencyResolutionException error, could not find a part of the path C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration. letsencrypt.exe.config does not have ClientName but settings.config does and it's\n<setting name=\"ClientName\" serializeAs=\"String\">\n    <value>win-acme</value>\n  </setting>. Any other idea @WouterTinus? It's still giving me an error. Is there anywhere else this setting might be stored?. Hah! The error disappears once I stop the app and re-run it. I guess it's holding on to that path while it's executing? Everything works now.. ",
    "pwetzel": "I got the exact same error, but the certificate was in the store. All I had to do was manually select the certificate (conveniently timestamped for differentiation) in the binding and I was good to go.. ",
    "ensemblebd": "Well I added a System.Threading.Thread.Sleep for 30 seconds to it. It still fails.\nThe iisManager.CommitChanges() fails with that error message, no matter the case. I have verified that the thumbprint is 100% valid, and that the store name is correct as well, which are common causes for that error message.\nI noticed something interesting though. If you select an invalid certificate for the domain, and run the renewal, it properly executes and does not fail. Rather, if the IIS Binding does not have a certificate to be deleted, then letsencrypt-win does not delete the existing certificate, and when it tries to install the new one, it succeeds entirely.\nI have two log files with nearly identical output, the only difference is that one of them uninstalls a certificate.\nSo I think that gives us some clues as to what is happening... It only fails if there is a certificate to be removed prior to attachment of the installed cert to the iis binding. (since letsencrypt installs the new one before it deletes the old one, and then binds to IIS).\nThe problem SEEMS (idk)  to have do with \"UninstallCertificate\" in Program.cs. If the \"store.Remove(cert)\" line executes, the IIS commit fails. I don't know why... just sharing my findings.\nSee also: https://github.com/Lone-Coder/letsencrypt-win-simple/issues/260 https://github.com/Lone-Coder/letsencrypt-win-simple/issues/31. I ended up rewriting the update portion. It clearly has issues being modified with a new cert. Perhaps someone willing to debug ServerManager can dive into why it happens..\nBut this works for me. Instead of updating the binding, I straight up replace it entirely with a clone.\n```\nif (existingBinding != null) {\n\n    Log.Information(\"Updating Existing https Binding to use new cert(\" + store.Name + \": \" + certificate.GetCertHashString() + \")\");\n    Console.ForegroundColor = ConsoleColor.Yellow;\n    Log.Information(\"IIS will serve the new certificate after the Application Pool Idle Timeout time has been reached.\");\n    Console.ResetColor();\n    Binding replacement = site.Bindings.CreateElement(\"binding\");\n    replacement.Protocol = existingBinding.Protocol;\n    replacement.BindingInformation = existingBinding.BindingInformation;\n    replacement.CertificateStoreName = store_name;\n    replacement.CertificateHash = cert_bytes;\n    // support for sslFlags  aka checkbox for SNI\n    foreach (ConfigurationAttribute attr in existingBinding.Attributes) {\n        replacement.SetAttributeValue(attr.Name, attr.Value);\n    }\n\n    site.Bindings.Remove(existingBinding);\n    site.Bindings.Add(replacement);\n\n    } else {\n\n```. Much appreciated!!   I wasn't expecting a reply to be honest. It was indeed a rant.\nYou were far more tactful and respectable than I was. Had been a really long day...\nVery strange on the [www] aspect, that's very confusing. I know IIS 8 is buggy, and it wouldn't surprise me to find out that it exists but just doesn't show in the GUI. I've actually seen that happen with bindings before. Same with certs for that matter (have to use netsh to delete the thumbprint). Will investigate.\nI will try out the latest version & 1.9.8, with the excludebindings feature, and see if that gets me where I need to be with this using automatic renewals. \nI know it also has the ability to execute scripts post completion, so it may be worthwhile for me to look into coding some powershell interactions to help report back the results of the renewals, as opposed to a windows task running through each binding to tell letsencrypt which ones to renew, and reporting that way.\nThe project is absolutely a life saver, and I don't want that to go unmentioned. And your candid response to the above deserves to be noted.\nThank you.\n. ",
    "e9gille": "Being able to specify output dir for certificate would be a very useful feature. Looks like your fix should work well.. ",
    "argenacho": "Yes, the day I was trying was the day Amazon S3 went out.. It's not related to the renewal task, because this happens when you run the command in the terminal. I think it has to do with the fact that each version of my web-app is deployed to a folder with a different name from the original (append version number), because version 1.9.3 started showing the physical path where it expects the website to be located, and that path no longer exists. Where can I change that information? Registry?. Update: I changed the correct path in the registry after finding the key, but still can't get renewals to work. I only get the \"Renew after...\" message, but nothing happens. Any ideas or suggestions?. ",
    "ygator": "If I do nothing and since the binding is now in place are you saying that the renew should then work for the website?\nThanks. Thanks you.  I'll check it out in 2 months when it renews.. I had the same thing happen.  I just created another cert.\nTask run 9:00 AM Daily\nC:\\full\\path\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\n. ",
    "infogulch": "You probably want the CertificatePath setting in letsencrypt.exe.config.\nIt would probably be a good idea to move the settings page into the readme instead of buried in a wiki page to make it more accessible: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Application-Settings. ",
    "vnikolay": "Yes, this is exactly that I was looking for, thank you!. And Is there some variable for being added domain, in path,\nfor examlpe somthing like this:\n\n...\\certificates[domainName]\n\n[BaseUri] is not working. ",
    "idansh": "Would I need to run lestencrypt tool again for both www.mysite.com and mysite.com to generate a new certificate after using IIS Crypto 2.0?. One last thing if I may please.\nI get this in Chrome:\n\nThe connection to this site uses a strong protocol (TLS 1.2), a strong key exchange (ECDHE_RSA with P-384), and an obsolete cipher (AES_256_CBC with HMAC-SHA1).\n\nAnyway to solve this. Thank in advance.. ",
    "willsp": "In case anybody comes across this issue, looking for this functionality, this powershell forum post helped me, tremendously... This is what I came up with... all in all, pretty simple, and gets the job done:\n```\nImport-Module WebAdministration\n$cert = Get-ChildItem -Path Cert:\\LocalMachine\\WebHosting | Where-Object {$_.Issuer -like 'let?s encrypt'} | Select-Object -ExpandProperty Thumbprint\n$current = Get-ItemProperty -Path IIS:\\Sites\\Public -Name ftpServer.security.ssl.serverCertHash | Select-Object -ExpandProperty Value\nif ($cert -ne $current)\n{\n    Set-ItemProperty -Path IIS:\\Sites\\Public -Name ftpServer.security.ssl.serverCertHash -Value $cert\n}\n```. ",
    "C0nw0nk": "I was looking at a Issue someone else has and they also do not use IIS according to their comment, But they are using this build/pull request here. That seems to be the one even Apache on Windows recommends. If they use that and get it working on Apache on Windows we can use it on Nginx on Windows.\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/299#issuecomment-253143459\nI will do some testing and toying and with the info provided in the above comment from this we should have it working soon enough I believe if anyone has any recommendations or command line code etc they think would help or wish to share feel free I will be posting back here to  let everyone know the outcome and result if we can get it working.. \nWhat one is the certificate we are suppose to use... There is a few in that directory.. @jmarden Hello,\nI am onto a decent solution with Nginx+Lua that every time a certificate get's renewed to prevent the running Nginx process needing to be restarted Lua grabs and caches the certificate in memory and when it expires from memory it grabs the certificate from the file path again. So each time the Letsencrypt.exe renews the certificates we don't need to restart nginx since it is now fully automated.\nAlso I modified the letsencrypt config file here : Where your letsencrypt.exe file is located edit the letsencrypt.exe.config in notedpad++ or some text editor.\nAs I mention here https://github.com/Lone-Coder/letsencrypt-win-simple/issues/401\n<setting name=\"CertificatePath\" serializeAs=\"String\">\n<value>Z:\\letsencrypt\\certificates</value>\n</setting>\nThat puts all certificates in a location that is more convenient to manage and access.\nWith my Lua I will share it when I am confident it is 100% working a few more days of testing.\nThe reason I don't want to restart the Nginx process each time and I am doing it with Lua like this is because every time you restart your server you need to realize all caches etc get cleared/removed (not very efficient).\nWhen I post it i will be sure to include the example Nginx config, Lua script and required letsecnrypt command line to generated the certificates you require.. But you still need a way to tell hmailserver to restart when the certificate has been updated or modified.. Thank's \ud83d\udc4d \nSo this should be the correct format for Windows network sharing / mapped hard drives.\n<value>//172.16.0.1/Networkshare1/letsencrypt/certificates</value> Don't know if we should use back or forward slashes nor if their should be a trailing slash on the end of the file path. \n<value>//172.16.0.1/Networkshare1/letsencrypt/certificates/</value>. The problem it causes is that the certificate is renewed after it has expired what deems websites inaccessible to users who get a browser warning message over the issue.\nSo for 24-48 hours depending how incorrect the time in the registry may be your website (if using HTTPS only) will be unavailable until that certificate is renewed.\nIt does not break the renewal process renewing works fine once the Windows Scheduled Task runs >= the date in the registry. But if the certificate has expired and the registry date is > the expiry date on the certificate you will have allot of unhappy users of your site.\nI don't know why it inputs the wrong date into the registry in the first place but it does.\nIt definitely does not follow or respect the default setting in this file : \\letsencrypt.exe.config\n<setting name=\"RenewalDays\" serializeAs=\"String\">\n<value>60</value>\n</setting>\nIn the Github repo : https://github.com/Lone-Coder/letsencrypt-win-simple/blob/master/letsencrypt-win-simple/App.config#L32-L33. I observed it happen running the same command the scheduled task runs in the command prompt. Why would I post a issue based of assumption / speculation...\nSame command the scheduled task runs :\nletsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\nWhat would not do a renewal until I modify the date on the registry key to be < the date output from the renewal process in command prompt.\nHence why in my previous post you see i provided the .config file values meaning letsencrypt.exe does not follow obey or respect its own config file.. Anyone have a .CMD/.BAT (Batch file command line script) even powershell script to add the scheduled task to check the certificate and registry key dates match ?\nif the expiry date on the certificate is out then the registry can be modified back to make it attempt to renew again.\nMight be the start of a decent solution.. Thanks for the information :).. ",
    "leram84": "this is exactly what i need! Im a total nginx noob, but i had everything running perfectly w startssl... now that they have gone under, i've been scouring for a win10 nginx solution, that can auto renew to replace startssl. Very eager to try this out!. ",
    "sbh2ch": "cool, that's perfectly what i need. ",
    "jrlilly": "\nSince we are breaking compatibility with V2, I want to stop using the windows registry and save everything to disk. Preferably in the letencrypt folder by default so we can do xcopy deploy and backup of settings. I'm happy to change the settings class to do that.\n\n@Lone-Coder - Huge yes to eliminating the registry.  Easy backups and easy deploys would be awesome :). Sorry about not doing a pull request, being a little lazy :). ",
    "moose999": "How do we use this? I can find no mention in the Wiki.. Hi, does anyone know how this works?. I am not a developer, but I have some scripting experience, and to secure passwords in Powershell I have used the secure string functions to great effect and security:\nhttps://blog.kloud.com.au/2016/04/21/using-saved-credentials-securely-in-powershell-scripts/ . I used the manual generation process for another certificate, and it did create the scheduled task, which the app reconfigured for my IIS-visible certificate, so all is well.. ",
    "olivermue": "You're right. That's missing. Will add some documentation next week.. Quite busy at the moment, so I hadn't time to write something more elaborate. But the concept is the following:\n- The DNS plugin uses the IIS plugin to determine all available hosts. \n- Then it asks for all needed informations to connect to Azure DNS (Tenant ID, Client ID, Secret, Subscription ID, Resource Group Name).\n- If the connection to Azure succeeded it performs a DNS challenge to LetsEncrypt and enters the given data into DNS.\n- When LetsEncrypt marks the challenge as success the certificate will be retrieved and installed through the existing IIS Plugin.\n- The given informations about the Azure DNS credentials will be added to the scheduled task as command line parameters to trigger renewals.. LetsEncrypt also stores some informations within %AppData%\\letsencrypt-win-simple and some others in the registry under HKCU\\Software\\letsencrypt-win-simple. Would any of these locations be safer?. Okay, so I'll try to put these values into one of these two places. I will check what concrete informations are stored in each of these places and pick whatever makes more sense.. Just moved the Azure parameters from scheduled task command line parameters into registry.. You are correct. The UrlElements class was a very hacky way, that worked for the default cases. But depending on the domain structure (especially second level domains like e.g. co.uk) this simply doesn't work. AFAIK you cannot determine from the host name which part belongs to the domain and which to the subdomain. So we have to ask the user (interactive or through command line parameter) to tell where to split.. Consistency and DRY are always a good idea.\nI also thought about making the system proxy the default, but I'm not sure if there is any drawback in this solution. So to avoid a breaking change I used the magic string, but if nobody complaints or knows about any bad behaviours when the system proxy is used we should make it the default.. The proxy logic is in its own method. Next decision would be if system proxy should be always taken or not.. Sounds good to me. Just made the magic string the default entry within the settings.. ",
    "jochenvangasse": "Would love to know how this works too.\n@olivermue Any guidance?\n. ",
    "eduvik": "Where do the client ID and the secret come from? I have found all of the other parameters, but can't find those two. OK; I've answered most of my own question. For future reference, and if anyone wants to write up a guide (I got most of this info via  https://docs.microsoft.com/en-us/azure/dns/dns-sdk )\nTenant ID: get this from Azure Portal: Azure Active Directory -> Properties -> Directory ID\nCreate Service Principal as per https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-authenticate-service-principal - save the username and password\nAssign DNS Zone Contributor permissions to the service principal account just created as per https://docs.microsoft.com/en-us/azure/active-directory/role-based-access-control-configure\nClient ID: This is the username of the Service Principal you just created\nSecret: Password of the Service Principal you just created\nSubscription ID: via Azure Portal: Subscriptions\n. However, despite the above, I still can't get this to work. I get the following error\n\n[INFO] Authorizing my.servers.dns using dns-01 validation (Azure)\n [EROR] Exception Object reference not set to an instance of an object.\nSystem.NullReferenceException: Object reference not set to an instance of an object.\n   at LetsEncrypt.ACME.Simple.Plugins.ValidationPlugins.Dns.Azure.CreateRecord(Target target, String identifier, String recordName, String token)\n   at LetsEncrypt.ACME.Simple.Plugins.ValidationPlugins.DnsValidation.PrepareChallenge(Target target, AuthorizeChallenge challenge, String identifier, Options options, InputService input)\n   at LetsEncrypt.ACME.Simple.Program.Authorize(Target target)\n   at LetsEncrypt.ACME.Simple.Program.Auto(Target binding)\n   at LetsEncrypt.ACME.Simple.Program.CreateNewCertificate()\n   at LetsEncrypt.ACME.Simple.Program.Main(String[] args)\n\nAny thoughts?. tried with beta 6; that error no longer shows up, but now I get:\n\nException Can not perform requested operation on nested resource. Parent resource 'edu.au' not found.\nMicrosoft.Rest.Azure.CloudException: Can not perform requested operation on nested resource. Parent resource 'edu.au' not found.\n\nNot sure if that's outside the scope of this app or not.. Yeah, I'm wondering if the UrlElements class is at fault here. The domain I'm trying to secure has 5 elements. I don't have a dev environment (or much knowledge of C#) to debug properly. \nSpecifically, the lines:\nDomain = String.Join(\".\", elements.Skip(elements.Length - 2));\nSubdomain = String.Join(\".\", elements.Take(elements.Length - 2));\nstrike me as a bit strange; I think the Domain in this context needs to either be determined from Azure, or else specified on the command line, and the subdomain determined by subtracting aforementioned domain from the domain of the site we are trying to secure.\n. So we'd match the domain of the site (e.g. coffee.reg.vic.gov.au) to be secured against the public suffix list, split on the public suffix (so we have coffee.regulation and vic.gov.au), then move one element across (now we have coffee and reg.vic.gov.au)? I can see that working for many (even most) cases, but I'm pretty sure that there will be sites that might have extra domain elements. A manual alternative might be necessary for those cases.\nAnother possibility (forgive me if I've misunderstood the problem) might be to ask the user for all of (higher level) the domains that a user will be creating subdomains in (or, again, getting this straight from Azure). So the user might need to enter example.com and example.co.uk (or just confirm these if we can get those two domains from Azure). \nWhen you say the architecture doesn't support settings per hostname - do you mean the architecture of this program, or of LE? . I'm getting some problems with the latest build. I run the whole thing, and get a validation error:\n\n[INFO] Authorizing my.domain.vic.edu.au using dns-01 validation (Azure)\n [INFO] Answer should now be available at _acme-challenge.my.domain.vic.edu.au\n [INFO] Authorization result: invalid\n [EROR] ACME server reported type urn:acme:error:connection\n [EROR] ACME server reported detail DNS problem: NXDOMAIN looking up TXT for _acme-challenge.my.domain.vic.edu.au\n [EROR] ACME server reported status 400\n [EROR] Create certificate [Manual] [1 binding - my.domain.vic.edu.au ] failed: Exception of type 'LetsEncrypt.ACME.Simple.AuthorizationFailedException'\nwas thrown.\n\nI stopped the program after the record had been created, and discovered in azure that it had generated a TXT record at my.domain.vic.edu.au not at _acme-challenge.my.domain.vic.edu.au. Changing \nvar url = _domainParser.Get(identifier);\nto\nvar url = _domainParser.Get(recordName);\nfixes this; I'm uncertain if there are other implications though.. No worries; I've also added a wiki page on setting up Azure DNS :). Interesting. Perhaps a warning printed to the console to this effect would be useful. So I'm guessing my script isn't being run as the initial certificate was created without the script parameters being passed?. ",
    "juanminm": "I remember doing it before on a virtual machine and it worked fine as long as you have an HTTP server (Apache and Nginx will require --manual) to get the certificates requested.\nDepending on your setup you may need to use the --san option to input multiple alternative names for the needed subdomain names for your mail server (\"imap.\", \"pop3.\", etc...).\nLet's Encrypt SSL certs should work for most if not all services that use TLS, including IRC as some networks like OFTC do so.\nYou can always use --test argument before doing it in production then see if it works (with the possible SSL warning due to non-trusted CA cert which you can get here)\nSo, to sum it up:\nShould be possible. Worked before. You still need an HTTP server. \nJust in case, test first with letsencrypt.exe --test. Beware of untrusted Staging CA cert warning on the mail client\nIf the HTTP Server is not IIS, add --manual argument.\nIf you need multiple subdomains, add --san argument.  . @lahela223 You should have some files at %AppData%\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org. Use $DomainName-chain.pem for the certificate file and $DomainName-key.pem for the private key. If the first doesn't work, try $DomainName-crt.pem or $DomainName-crt.der.\nIf the testing certificates were good, do what you just did without the --test. The production certificates will be on %AppData%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org instead.. ",
    "lahela223": "great actually complete newbie to this sorry i am successfully able to generate letsencrypt.exe --test for all domains on iis . but hmailserver server ask for certificate file and private key i am not sure what to do. please help. ",
    "amanjuman": "Yeah it would be now, C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\\n@juanminm Method worked. Thanks a lot.. ",
    "brondavies": "It would also reset any options and user login information you may have manually set.  For instance, I changed my scheduled task so that it could run when I am not logged in so I always choose N - don't replace.. ",
    "rfaix": "Feel free to contact Bitdefender and Avira. That are the engines, which 360\nTotal Security is using. Nobody will take any risk an take the programs out\nof the quarantine - especially on a Webserver\nbest regards\nRudolf Faix\nAffiliate Marketing Reviews http://affiliates.wwpa.com/\nFraud & Scam Systems http://fraud-systems.wwpa.com/\nOffshore Outsourcing & Scammer http://blog.wwpa.com/\nOn Wed, Mar 22, 2017 at 4:32 PM, Sebastiaan Janssen \nnotifications@github.com wrote:\n\nFYI: the \"HEUR\" in this signature means that it's a heurisitic, so the\nscanner is determining that it looks like something that might possibly be\nmalicious. The same result has been found here for example :\nhttps://social.msdn.microsoft.com/Forums/vstudio/en-US/\n081020e7-77cf-46f1-aa4a-fdc00804ee4e/my-vs2015-builds-\nvirus-infected-exe-files?forum=visualstudiogeneral#\ne6a0f42b-6005-4ee1-9588-657abdfa8ca0\nQuote:\nThe cause of the problem is that the exe file was not in the list in your\nanti-virus software. So it will regard your exe file as a virus.\nTo avoid this problem, one idea is that you need contact with the\ndevelopment of the anti-virus and add the program into the trust list.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/399#issuecomment-288330671,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AS-tENDqtS3gtHC0rL2gcyPf5CSgpIK2ks5roNyOgaJpZM4Mk1Od\n.\n. \n",
    "miqrogroove": "Same problem for me.  After ensuring all bindings show the same host name, it only finds port 80 and this behavior is not obvious.  Will it automatically renew all of the hosts it didn't find?  Port 443 for example?. Site being a redirector also causes validation to fail completely.\nSubmitting answer\nRefreshing authorization\nAuthorization Result: invalid\nAuthorization Failed invalid\nAuthorize failed: This could be caused by IIS not being setup to handle extensio\nnless static files.. Found above error caused by the web.config file placed in acme-challenge directory by the client.  Inside of system.webServer, the following line is needed and missing:\n<httpRedirect enabled=\"false\" />\nAdding this manually solved the redirect problem.\nUnfortunately, the client overwrites web.config with each attempt, thus forcing the error.. After creating a new web.config file in the parent directory named .well-known, it looks like the client deleted my StartSSL certificate, updated my port 443 binding to a new certificate, and left another binding with no certificate at all.  Can't even find the old certificate to restore it.  Wow.. Additional symptom:  Client adds binding for port 443 to the redirector, causing the redirector to shut down and the following error is logged:\nLog Name:      System\nSource:        Microsoft-Windows-IIS-W3SVC\nDate:          4/6/2017 5:36:07 PM\nEvent ID:      1007\nTask Category: None\nLevel:         Error\nKeywords:      Classic\nUser:          N/A\nDescription:\nThe World Wide Web Publishing Service (WWW Service) did not register the URL prefix for site 3. The necessary network binding may already be in use. The site has been disabled. The data field contains the error number.\n. Also experiencing error 500 any time a client certificate is used now.  What a mess.. Restored the StartSSL certificate from a backup.  IIS no longer throws error 500 during client certificate authentication.  I haven't found an exact cause of that problem, but it seems to be related to the lets encrypt certificate binding.. Manually switching back to the letsencrypt certificate through the site bindings dialog seems to fix everything.  No errors this time.  So now looks like something with that automatic client royally screws up the bindings. :(. ",
    "celeburdi": "Not a big problem.\nBut it is disturbing that the Host Name is not visible on the editbox.. ",
    "zag2me": "Just came up against this problem myself, looking for solutions in IIS 7...\nEDIT: thanks for the post above, tripped up on not adding the certificate store from the computer (not the user). ",
    "shapeh": "Just a small comment here on the file naming format: \nI would do something like this instead:\ncertificate.FriendlyName = (Options.San ? \"*.\" : \"\") + $\"{binding.Host} {date of expiry}\";\nFor SAN certs, \"date of creation\" is not really useful and AM/PM should be substituted with 24-hour system instead. Instead something like this makes more sense when checking the IIS SSL settings: \n*.(host) - (date of expiry in yyyy-mm-dd hh:mm)\n\nMost countries around the world today use the 24-hour system. The 12-hour format, including am and pm, is officially used only in the United States, Canada (except Qu\u00e9bec), Australia, New Zealand, and the Philippines. https://www.timeanddate.com/time/am-and-pm.html \n\nA site with certificates for \ncdn.example.org \nwww.example.org\nexample.org\nturns into *.example.org (2019-02-17 13:35)\nYou could also allow users to type in Friendly Name themselves but default to above.. ",
    "aelg305": "Thanks for the prompt response @rdebath \nI think i MUST use the proxy option...... it has to do with how the APP behaves...... \nyou can check out the APP here https://home-assistant.io/\nThey kinda of explain here, what to do to pass the APP to apache...... https://home-assistant.io/docs/ecosystem/apache/\nSo, it dosnt seem like the APP has an index or anything within the folder... and its served over python....yaiiiii .....Im learning chinese here!\nA complete noob here (must admit) with Apache and what not, so I been trying every single option out there to pass the darn LetsEncrypt validation token.... :(\nI did cookie cleanup, dns flush, restart wamp every time.... maybe I need to look deeper!!!! WAYYYYYY deeeper....lol\nI did try your recommendation from the link.....but tired today... so i need fresh eyes tomorrow or something... SOLVED:\nSituation was:\nI have an app called HomeAssistant (pretty cool if you haven't checked it out), it serves content on port 8123 under localhost. I also have apache running under windows 10 machine.\nI already had the app working through apache (configuration below), purpose was to not forward port 8123 and use instead and alias (HA.example.com).... however, I wanted the SSL option as well, like on the rest of my sites been hosted.\nProblem: LetsEncrypt-win-simple uses a token when the code to generate the cert its run under the command prompt. Usually, that token its placed under the folder /.well-known, the problem under my configuration was that I was unable to figure out how to send the requests from HA.example.com/.well-known to the proper folder, since the app runs its own server thing and the main folder where the app is hosted, is not necessarily accessible directly....so placing under that \"root\" folder would give me access to \"/.well-known\"\nSo..... SOLUTION..........add more proxypass commands..... code below:\napache vhost:\n<VirtualHost *:80>\n  ServerName HA.example.com\n  ServerSignature Off\n  ProxyPreserveHost On\n  ProxyRequests Off\n  RewriteEngine on\n  RewriteCond %{HTTPS} !=on\n  RewriteRule .* https://%{SERVER_NAME}%{REQUEST_URI} [NE,R,L]\n</VirtualHost>\nthe prior will forward all traffic from regular http to httpS, \nssl-vhost:\n<VirtualHost _default_:443>\n  ServerName HA.example.com\n  ServerSignature Off\n  SSLProxyEngine on\n  ProxyPreserveHost On\n  ProxyRequests Off\n  ProxyPass \"/.well-known\"  \"https://HA.example.com/local/.well-known\"\n  ProxyPassReverse \"/.well-known\"  \"https://HA.example.com/local/.well-known\"\n  ProxyPass /api/websocket  ws://localhost:8123/api/websocket\n  ProxyPassReverse /api/websocket  ws://localhost:8123/api/websocket\n  ProxyPass / http://localhost:8123/\n  ProxyPassReverse / http://localhost:8123/\n  ErrorLog \"C:/wamp64/bin/apache/apache2.4.23/logs/ssl_error.log\"\n  TransferLog \"C:/wamp64/bin/apache/apache2.4.23/logs/ssl_access.log\"\n  SSLEngine on\n  SSLCertificateFile \"c...directory....blah blah\"\n  SSLCertificateKeyFile \"Cc...directory....blah blah\"\n</VirtualHost>\nThe problem with the HomeAssistant app and letsencrypt: HA app root is under A folder of the system, lets call it C:/HA_main_root_folder, and then if one would like to access static content from the app, like images, thats within a folder inside that main one called: www, however, because of the configuration of the HA app... the folder is only accessible as \"local\".....example:\nHA.example.com/local....would serve the files inside the folder within my computer, like ie: c:/HA_main_root_folder/www   ..... accessible only as https://HA.example.com/local\nHA.example.com ...would serve the actual app (which btw runs on python and so much more I cant explain...because..NOOB!!)\nSolution explained:\n-basically I have 3 different proxypass\n1-ProxyPass \"/.well-known\"  \"https://HA.example.com/local/.well-known\": this is the one that tells letsencrypt win simple to pass the token verification when challenge with the /.well-know/acme.....\n2 and 3-ProxyPass to serve the app over SSL connection\n. ",
    "Risord": "Since we updated to Server 2016 this issue haven't been relevant for me for a while. But good that this is fixed now.. > The scheduled task really doesn't do anything special, it basically just runs letsencrypt.exe --renew. You can manually create it or create any (dummy) certificate to let the program (re)create it, then it works for all scheduled renewals.\nTo clarify: I didn't had a problem with not having scheduled windows task. I may over used \"scheduled\" too much but client use those as well. So there were two differen't scenarios called \"not having certificiates scheduled\":\n\n\n\"List scheduled certificates\" (L) results:\n    domain-a.com: not scheduled\n    domain-b.com: not scheduled\n    domain-c.com: not scheduled\n    ...\nSo this was when opening newest client for old data. You probably meant that at this point force renewals would fix things.\n\n\n\"List scheduled certificates\" (L) results: [empty]\nSo B and C was about this thing. After complete regeneration of certificates those were installed to IIS but from LE client point of view certificates were completely vanished and haven't been saved to registery(?). Are those certificates still recovable to LE client so that renewal can be done?\nRecovability is not super important since after my rate limit allow me to retry I can simply do that with --notaskscheduler for example (to make sure not to repeat same error).\nBut I claim that if windows scheduled task creation fail it should still save certificates which are already installed.\n\n\nEdit: Anyway nice to hear that crucial root issues are already resolved.. ",
    "webbysteve": "Just a note to confirm I'm also seeing the same issue. My renewals failed because it reckoned it couldn't validate the acme file. It bumps the renewal date on still so I'm heading for a period of expired certs I'll need to sort.\nIf I just run my initial job to create certs for all sites will that override the current ones?\nIs there a fixed version on its way?. As an interim - am I/we best removing all the certificates every 60 days and then running a job to add all from scratch? . I have similar problem. The task scheduler renewal process stops when it hits a domain that has been removed from IIS. The only option is to start again, and of course it stops again.\nI have to go into registry to remove these old domains which isn't the best solution.\nIt would be great if it could a) ignore renewals for sites not found and b) automatically update its renewal list removing that domain.\nI can't think of any reason why there is a need to keep old info - if a domain is deleted and then added back to iis later then it would have a different site id anyway.\nGreat product though, and for that I am thankful.. ",
    "nefcanto": "@LBegnaud that did the trick. I'm happy now, because I have a lot of subdomains and based on this approach, I can get to 20 certificate requests per domain per week, and in each request, I can embed many subdomains. This made my day. Let's go for a totally secure web.. ",
    "BugRaptor": "Ok, my issue is now solved. The key point was effectively to generate a san certificate for www.raptordev.ch AND raptordev.ch with letsencrypt.exe --san after having configured two binding on port 80 on iis: one for www.raptordev.ch and another one on raptordev.ch. Just for letting letsencrypt.exe add the SAN (Subject Alternative Name) for the DFQN raptordev.ch used by my rabbitMQ server.\nAfter the new certificate has been generated, it is possible to remove the useless raptordev.ch:80 iis binding.\nI simply forgot to install the issuer certificate to allow checking of the full trust chain...\nHopes this will eventually help someone getting in the same issue.. ",
    "fpeterson194": "One more note:\nI have only the default web site from IIS (neither MVC site nor URL re-writes). I read the wiki: https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/web.config\nThe web.config file is copied by the executable here C:\\inetpub\\wwwroot\\ .well-known\\acme-challenge while the other web.config one is  C:\\inetpub\\wwwroot.\nCan be the issue a conflict between them?. @nul800sebastiaan @rdebath @CBruceH do you happend to know how can I sort this?\nThanks in advance!!. @LBegnaud thanks very much for your response!\nI understand we have to manually configure the web.config file. So when using M option, I put the web.config file with the proper information and it works. However, what about the --san one with the S option? if I leave the web.config in the root folder and even though the web.config appears within the .well-known folder does not work (authorization failed).\nI\u00b4m thinking of all the different scenarios here: If manual mode, you change your web.config file at the web root and works. If you need a single certificate for the site with SANs (-S option) how can I do? I can not say to the web admin \"remove your web.config to issue the certificate\". Do you see my point? I think I\u00b4m missing something.... @LBegnaud thanks for your response. As I mentioned above, I have checked the link you mentioned and I have a very basic site (default IIS one) so neither MVC site nor URL re-writes.\nYou mentioned that you don\u00b4t use automatic method, so how do you manually request a certificate that has a domain + SANs names without using -S option? And then, how do you make the renewal?\nI read here #299 from @jmarden that he made an improve here to make this works. However, it is still not merge with the main version. . @LBegnaud thanks again for the response. Ok, then you have a separate powershell script to import the certificates, now make sense. Is there any possibility to share the powershell script you are using so I can test it? Does the script import the cert to the selected store and configure the IIS bindings too?\nAny other advices on this? My goal is: \n1. Issuing a cert for a single domain (this works for me) - No issues with the web.config file\n2. Issuing a cert for a domain with SANs - It works only if I removed the web.config file from the web root.. @LBegnaud I read your post #195 but seems not to be there.. @LBegnaud ok, no problem.\nI still having issues with the web.config file. Some strange bahaviour. When I run .\\letsencrypt.exe with the M option it gives me the certificate successfully. I deleted all the information related to let\u00b4s encrypt (acme-challenge, app/roaming, schedule task, registry entry) and again run the same...it fails! with auhorization invalid error message (the same happends to me with --san). If I tried to access the challenge file generated via web browser http://mydomain/.well-known/acme-challenge/challengeHere I get error 500. \nI created a new folder and a file (without extension) inside it in the web root and I can access it successfully. Why this random behaviour? Anyone knows?. @rdebath thanks for your response and for the post.\nI\u00b4m connecting from localhost and I only receive a 500 error (even I have the option \"detail error for local requests\" enabled in IIS). It is very strange.\nI ran tons of tests and what I find out is that only these scenarios work for me:\n\n.\\letsencrypt.exe --san with S option | No web.config in the webroot + Register or not ->Success\n.\\letsencrypt.exe --san with M option | No web.config in the webroot + Register only ->Success\n\nI made conbinations with or withour web.config file, register or not register, with S option and with M one, even without parameters (meaning calling .\\letsencrypt.exe directly).\nI\u00b4m confused here. Do I have an issue with my web server?\n@rdebath how can I test LE is actually validating and not just remembering my account? by deleting everything in Roaming folder? I have already done that :(\nI read issue #358 showing similar random issues -warmup does not help me here either.\n@warrenkc @aellert @MetUys @akishu @rdebath as you help in #358 too, can you please share with me your insights here?\nThanks in advance to all of you!!\n. One more test to add: .\\letsencrypt.exe --san  with S option without web.config in the web root. Then, if I add the web.config subsequents renewals work fine. Any thoughts?. After some days, now all the options work good. This behaviour seems the same as #358. However, the --warmup parameter did not help me. Any thoughts? \nThanks!!. @jbisson this is your answer #401 :). ",
    "mortenbock": "I did take a look at the central cert store, but as far as I could tell, that runs on conventions, so the binding would actually need to match the certificate in the central folder. So I think an empty hostname would eliminate that method.\nAm I right in assuming that when using the \"manual\" option, then it will just create a new certificate in the cert store, and not touch any IIS bindings?\nI was looking at the source code, and it seems that it would be possible to make a PR that could allow updating hostless binding of a site. It could even support the scenario where the http and https bindings live on different sites. But I don't know if it would be stretching the \"simple\" part of the project name :). ",
    "jbisson": "yeah, exactly ! thanks!! . ",
    "KevinM23": "Hello,\nI solved it with the new lets encrypt (https://github.com/jmarden/letsencrypt-win-simple/releases/tag/v1.9.1) and the --forcerenewal command.\nFor some reason the renewal system could not access the ACME challenge, and I assume thats why it went wrong in the first instance. However, with the new version and being able to force it, I managed to renew them.\nThanks \ud83d\udc4d . Closing it, thanks guys \ud83d\udc4d . ",
    "mikebrandy": "Thanks jmarden.  Is the limit 7 requests per domain forever or 7 requests per week?  I changed the date in the registry and ran the automatic renewal about 4 or 5 times for my domain using the --san parameter for a SAN certificate during my testing.  I'm still under 7 but if it's 7 renewals forever, I will hit that limit by the end of the year (assuming I stop my testing and let the automatic renewal run every 60 days).. ",
    "CiscoRed": "Not with a wildcard .\nStilll the same error and Idk Why .... when will be the next release ?. ",
    "savvinovan": "try open url from your browser. ",
    "ismailmayat": "I have similar issue when i open url from browser i get the file served up. So not sure whats going on?. ",
    "stevejbauer": "Dig you ever get this resolved?  I am experiencing the same issue..  If I switch to use some like acme.sh using standalone mode using Cygwin, I can get a certificate.\n. I was able to resolve my issue.  It was due to the fact that Letsencrypt is now validating the server with ipv4 and ipv6 is the dns name has both an a and an aaaa record.  If the v6 doesn't work when the renewing, etc. the server will fail validation.  \n. Looks good!\n. ",
    "imjustalf": "I was getting this error on my local machine, the only way i was able to get it to work was to run it from the server where the site running live from.. ",
    "KalanVryce": "I currently tried Certify to generate my SSL cert, however, I'm running into the issue above as well.  I am searching for an ACME client that will automatically use the proper provider for Exchange so I don't have to have manual intervention all the time.  I figured I would ask that here just in case you found a solution as well.\nEDIT:\nUsing LetsEncrypt-Win-Simple works as laid out in the following:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Create-a-SAN-certificate-for-Microsoft-Exchange-2016,-2013-&-2010. ",
    "RonaldCarter": "Yes that is a better solution that way it overrides instead of adds.. ",
    "kprueckl-dt": "Tested with 1.9.6.2: works like a charm. Thx!. ",
    "9swampy": "Possibly see https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/A-specified-logon-session-does-not-exist\nIt's a temporary issue; retry fixed it for me... though the Scheduled Task create still failed but I'll keep looking for that one :). ",
    "InteXX": "@9swampy \u2014 Ah, that looks good. Thanks. When I get a chance I'll look at the task part and report back here.. @cpu \u2014 I have a binding SERVER2 in my IIS configuration for the Default Web Site. The challenge/response sequence in my OP should indicate that I attempted to instruct LEWS to exclude that binding, but in fact LEWS did not exclude it and attempted to resolve it instead.\nI've updated the issue title to more accurately reflect the problem.\nThanks for all your work on this.\n. @WouterTinus \u2014 Actually, that was the first version I tried...  server2. Both produce the same result.. @WouterTinus \u2014 That looks like a good fix, but are you certain it correctly addresses this issue? As stated, the exclusion didn't work for either upper or lower casing.. @WouterTinus \u2014 That's what's known as a 'Catch-21'...  not quite as severe as a 'Catch-22,' as there is a way out  ;-)\nThanks, that worked. But now there's another problem, detailed here.. @WouterTinus \nNow that is interesting!\nYou are correct in that I was expecting option 2 to run option 1 for each included binding. Perhaps the menu text could be tweaked a bit to better explain this.\nWhat a great job all of you are doing on this.\n. ",
    "MDAEFLX": "Solved by https://github.com/Lone-Coder/letsencrypt-win-simple/issues/304\nClear out the redundant entries in the registry.. ",
    "harrijon": "Hi, Thanks for your quick response!\nWe have lots of temporary domains, which are created and taken down periodically.  My concern is keeping our servers clean and tidy at the end of life for domains, so, domains which need renewing get renewed.  We may have 50+ domains online at any time.  We typically remove 80+ unused domains, from the server, 2 or 3 times a year.  Manually changing a registry key for multiple domains, multiple times a year, is not scale-able.\nI would like a command line parameter to remove a domain from being renewed on our server.  ie. the parameter would remove the specified domain from the \"renewal\" registry key, from https://github.com/Lone-Coder/letsencrypt-win-simple/issues/304, so, it no longer attempts to get renewed and doesn't cause errors, for other renewals.\nI am not asking for LWS to delete the cert, as I think there is a spin-off script which will do that on our server.  ..and LE will handle expired certs.  \n. ",
    "akircher": "I am having this same issue, was it resolved?  Do you mind sharing how?. ",
    "Sebi94nbg": "Hey,\nI've the same issue with v1.9.3.21006.\nI've already restarted and even stopped/started IIS as well as the related IIS site, but the SSL certificate does still expire on 7/18/2017.\nRunning letsencrypt.exe --renew only returns the message \"Renew After 8/18/2017\". But that's to late. The certificate is not valid until this date. The parameter --forcerenewal does not exist anymore.\nI've checked the certlm, but it also only shows the one/old certificate, which will expire on 7/18/2017.\nWhat's the problem? How can I renew my certificate?. Any feedback or idea?. @bovas85 no, I've executed it without any parameter.\nI did these steps:\n>letsencrypt.exe\nEntered the number (eg. \"3\") of the IIS site, which I want with SSL.\nAnd that was it already. The SSL cert was requested and generated and imported to the internal (Windows) certificate store. HTTPS was also autom. activated for this IIS site.. ",
    "bovas85": "Is your cert generated with --manual? \nI've read somewhere --renew won't work, so best option is to run / generate a new certificate instead. ",
    "GarthKiepper": "I am experiencing this issue as well, with v1.9.1.38228. I also tried upgrading to v1.9.3, trying jmarden's v1.9.1 release, as well as building jmarden's fork.\nI created a certificate, which is valid from 3/2/2017 to 5/31/2017. I have a scheduled task to run C:\\Users\\Administrator\\Desktop\\letsencrypt\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\" daily, but recently got an email that my domain's cert was about to expire. The certificate files appear to have never been renewed since I initially created them.\nWhen I run the command manually, I see that a new certificate is not retrieved, and it mistakenly says Renew After 7/1/2017:\n```\nC:\\nginx-1.7.4>C:\\Users\\Administrator\\Desktop\\letsencrypt\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\nLet's Encrypt (Simple Windows ACME Client)\nRenewal Period: 60\nCertificate Store: WebHosting\nACME Server: https://acme-v01.api.letsencrypt.org/\nConfig Folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nCertificate Folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\nLoading Signer from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\nGetting AcmeServerDirectory\nLoading Registration from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\nChecking Renewals\n Checking Manual focal.software (C:\\nginx-1.7.4\\html\\focal.software) Renew After 7/1/2017\n```\nEDIT:\nI modified the date in the registry key HKEY_CURRENT_USER>Software>letsencrypt-win-simple>https://acme-v01.api.letsencrypt.org/>Renewals and retried the renewal command, but again, the renewal failed. In the program's output, I see that the renewal date is pushed further back, exactly 2 months from today's date.\nEDIT 2:\nI updated to jmarden's v1.9.1.1 release, but now I get the error Ignoring Manual Certificate Renewal due to Primary Domain mismatch. I also built his fork from source, but saw the same error.\nEDIT 3:\nI updated to the v1.9.3 release, but see the error message WARNING: Unable to renew. The renewal date is still pushed back 2 months despite failure.\nEDIT 4:\nFinally have a band-aid solution by backing up C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple, deleting this directory, and then recreating my certs from scratch.\nThis seems like a dupe of #408 . ",
    "fyve5": "In reference to GarthKiepper comment\n\n\nEDIT 2:\nI updated to jmarden's v1.9.1.1 release, but now I get the error Ignoring Manual Certificate Renewal due to Primary Domain mismatch. I also built his fork from source, but saw the same error.\n\n\nI got this error as well, after comparing it to another server that was successfully renewing, I found a missing bit in the registry entry (HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/)\n\"Warmup\":false,\"ManualHost\":null,\"Renew\":true}\nafter\n\"Warmup\":false,\"ManualHost\":\"mail.whatever.com,autodiscover.whatever.com\",\"Renew\":true}. ",
    "PavelH76": "@fyve5 Thanks, I had the same problem. Your tip works. Thanks!. ",
    "sschiffel": "Here the same. Any solution for that error?. ok it was my personal incompetence. I had enabled debug logging for letsencrypt-win-simple described here. This will print a LetsEncrypt API link that will return a json with further details. It seems letsencrypt takes ipv6 as default transport protocol (as it described in RFC3484) seen in \"addressUsed\" value, but i had a mistake in the AAAA record in my zone, so it pointed to a wrong server that returns 404.. ",
    "cinadr": "Same here. I had a ipv6 firewall rule that has an old ip caused packets to drop while authenticating. Thanks for the response, it helped me to find the root of my problem. . I found that the changes in #959 does not resolve my issue. \nAfter issuing a new certificate as described in https://github.com/PKISharp/win-acme/wiki/Microsoft-Exchange the new certificate is located ONLY in WebHosting store. This is not found by the script of #959 and fails to install it. \nThe logic makes a mistake by assuming if  store does not contain the cert (line 89) it must be specified by  TargetHost and StorePath parameters and exits with an error missing these params (line 94: Error: Cannot bind argument to parameter 'Path' because it is an empty string.). It should continue searching the new cert in WebHosting and should install it directly from there or move it to personal store, etc... \nMy proposed change is more generic. The script makes a search by the new thumbprint (as it is new and not copied already - why we should be afraid of any mistake - same thumbprint very unlikely) and catches it if any store can provide a match. If not than it could safely assume that TargetHost and StorePath should specify the file based location of new certificate and install from there. . I do not want to push this too far but from an average user point of view the directions written in Exchange wiki page should bring up results flawlessly. Sure one can adjust settings and paths to correct the upcoming issues (this needs reading through 4-5 pages of the wiki and than it can be done correctly) but the examples on the Exchange wiki page should contain all details to be able to get expected results. What I propose here is to modify either the script or the wiki page (PSScipt parameters! and settings.config) to reach our goal.\n\nBasic - unmodified - setup on win-acme installs the issued cert from LetsEncrypt to WebHosting store (stated here).\nThe ImportExchange.ps1 script does not accept parameter for source store of the certificate to be installed (I think you referred to param {3} from Available Script Parameters - Certificate Store name). In this case it is not usable. The script assumes it is in My (Personal) store.\n\nSo the wiki page should mention that the My (Personal) storage should be specified in settings.config (or the setup should do that by default for the user). \nThank you for your patience and happy coding.. Ok, understood. Have a nice day. . ",
    "robyle": "I meet the same problem, I have set done, But it doesn't work on. How to slove it,Please help me .... Ok,I try to use the quick way. use the number to select which website I want to install. It's so easy to setting and all things seems sloved.. ",
    "Harvzor": "My .well-known folder remains after the tool is run. (version 1.9.1). I also have this error. Thanks for finding that the issue is with LetsEncrypt itself.. This has been fixed.. ",
    "sitefinitysteve": "I am on 1.9.1 as well...So what might be wrong then?  I run the tool, the UI says it all works, but the folder just gets deleted.  So every renewal, also deleted.\nCan see in the output that it deletes the folder, but also that it accepted the challenge so it must have been there for that?\n\n. Awesome I will try this, thanks!\nOn May 23, 2017 8:19 AM, \"Manuel M.\" notifications@github.com wrote:\n\nI don't think the .well-known folder is needed once you got your\ncertificate. If you renew certificates, it will create the folders as\nneeded. To answer the last question on the initial post, there's a setting\ncalled CleanupFolders that controls whether the folder is cleaned up\nafter acquiring the certificate successfully:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/blob/\nmaster/README.md#cleanupfolders\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/440#issuecomment-303380204,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ABeI6HtU5m8KoMvVcUeoWoFZnJ01QQ94ks5r8s7lgaJpZM4NeAWM\n.\n. \n",
    "Manuzor": "I don't think the .well-known folder is needed once you got your certificate. If you renew certificates, it will create the folders as needed. To answer the last question on the initial post, there's a setting called CleanupFolders that controls whether the folder is cleaned up after acquiring the certificate successfully: https://github.com/Lone-Coder/letsencrypt-win-simple/blob/master/README.md#cleanupfolders. ",
    "JonathanSedman": "Looks like this may be an issue with letsencrypt its self: \n\n. Anyone had any luck, they say they are operational again but i still cant get a cert https://letsencrypt.status.io/. ",
    "fredrikholm": "I just encountered this as well - good to know it wasn't caused by me... :-). ",
    "NightFlash82": "Same here and I get the same error on 3 different versions, though my recent windows update messed it up but hopefully it's not that =). ",
    "diplonics": "Same problem here so thanks for hunting down link that LetsEncrypt availability was the issue....\nHowever, looks like Letsencrypt is reporting its back operational, yet I'm still getting JSON error.\nAnyone else back working??. ",
    "dchina": "me too,  waiting for solving ............... ",
    "johnchen198": "me too. ",
    "ApolloCr": "You should first finish reading my post before you start answering, email is NOT the issue here.. ",
    "mattkemp": "It might help to know a bit more about what you are trying to do, because the program can handle renewing multiple certificates.\nThe default scheduled task it creates runs daily at 9am and checks the registry key HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/Renewals for the list of certificates. It checks the dates on them and renews any that need it, leaving the others.. @mchupp all certs made with letsencrypt-win-simple get an entry in that registry key. If you . I've added a new wiki page where I've brought a lot of the IIS solutions in to one place:\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/wiki/IIS-answer-file-issues\nAdd a new issue if you still can't get it to work and I'll be happy to try to find the solution. \n. ",
    "toreft": "Hi!\nSame issue, where did you update the reg?\nTore. ",
    "bassebaba": "HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\\Renewals. ",
    "GRL570810": "+1. Me too also on server 2012.. I believe that the registry entry recorded will  be fine, since AFAIK the --renew code looks for expiries within the following 30 days and renews those that fall within the window. That being so the fact that the date in the registry is perhaps one day out (and this may be a time zone artefact anyway - perhaps the recorded time is local TZ & the code works on UTC or vice versa) won't cause any issue in renewing the certificate.. Can I ask if you have actually seen this occur, or are you speculating based on what you see in the registry? My experience is that when I run 'letsencrypt.exe --renew' it will renew any domain that has an registry expiry date that is within 30 days in the future and then update the registry to a date 90 days ahead. The effect is that domains are renewed 60 days after the last renewal. I am running this on Server 2012 if that's of any relevance - still can't get it to run correctly as a scheduled task but that's a whole other can of worms.. ",
    "goldfish1974": "Some additional information: If you have multiple certs being renewed, and one succeeds and the other doesn't, then BOTH certificates get the registry values updated to the same renewal date.\nThis implies that the renewal date value is not coded to be per certificate either, as both were updated!\nExpecting that the successful cert update registry key gets updated, and the failed cert registry key timestamp does not.\n. ",
    "jeffvfren": "I have the same issue when my certificate expired on 2017-07-05 19:30PM.\nThen, I try renew it same day at 20:00PM, I get the same result \"Renew After 2017-07-05\"\nYou can see that the renewal process is check the date but not time, even your certificate expired in evening but it is consider certificate expire end of the day (next day).\nIf you use of IIS, you can check certificate expiry time in Server Certificates.\nI believe this is a bug or letsencrypt.exe have to allow us to renew one day in advance.. ",
    "yayh": "I found the pfx in C:\\Central_SSL :) I took the main and the password was blank\n\n\n. ",
    "uka-support": "Same here. Simple certificate works, SAN does not.. ",
    "ber5ien": "Is the task configured correctly?\nI have noticed that you need to change the renewal task so it runs if the user is no logged int as well.\nYou may also need to run it under user with admin rights.\nYou may also need to allow the user to be in the (LOg on as batch job) under Local Security Policy -> Local Policies -> User Right Assigments.\n\n. Have a read there. You must be hitting a limit.\nhttps://community.letsencrypt.org/t/rate-limits-for-lets-encrypt/6769\nhttps://letsencrypt.org/docs/rate-limits/\nWe also have a Duplicate Certificate limit of 5 certificates per week. \nThe changes were:\n20 certificates per registered domain per week (up from 5).\nAdded an exception to this limit for renewing certificates (issuing a new certificate with same names as a previous one).\nAdded a new limit on issuing certificates with the exact same set of names: 5 certificates per FQDN set per week.. Have you tried first to do telnet localhost 443 to see if you can connect locally.\nHave you added binding to your IIS with port 443 in and attached SSL cert to it? \nAre you forwarding port 443 from your router to web server?\nIt's not working as port 443 is not responding.\n{ ~ }  \u00bb nmap -sS www.jtlanguage.com                                                             ~\nStarting Nmap 7.40 ( https://nmap.org ) at 2017-06-23 12:28 ope\nNmap scan report for www.jtlanguage.com (162.236.130.44)\nHost is up (0.023s latency).\nrDNS record for 162.236.130.44: 162-236-130-44.lightspeed.sntcca.sbcglobal.net\nNot shown: 999 filtered ports\nPORT   STATE SERVICE\n80/tcp open  http\nNmap done: 1 IP address (1 host up) scanned in 7.79 seconds\n{ ~ }  \u00bb telnet www.jtlanguage.com 443                                                           ~\nzsh: command not found: telnet\n{ ~ }  \u00bb telnet www.jtlanguage.com 443                                                       ~ 127\nHTTP/1.1 400 Bad Request\nContent-Type: text/html; charset=us-ascii\nServer: Microsoft-HTTPAPI/2.0\nDate: Fri, 23 Jun 2017 11:30:06 GMT\nConnection: close\nContent-Length: 326\nHTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\"http://www.w3.org/TR/html4/strict.dtd\"\nBad Request\n\nBad Request - Invalid Verb\nHTTP Error 400. The request verb is invalid.\n\nConnection to host lost.\nC:\\WINDOWS\\system32>telnet 162.236.130.44 443\nConnecting To 162.236.130.44...Could not open connection to the host, on port 443: Connect failed\n. Sorry for opening it again but noticed that your setup is not completed :)\nWhat you need to do now is setup http -> https redirect.\n1. Create a new entry in your IIS with pointing it to a different directory than your website.\n(Every redirect needs to have it is own folder otherwise it will override the web.config)\n2. Add binding for http only then setup a redirect as per picture below.\n3. Then remove http binding from your old IIS entry.\n4. Test!\nSo all your visitors will be automatically moved to your site using https instead of http.\nThe only problem is that you will need to revert your changes during the renewal as it only renew it using http as far as I remember. The only solution for that would be to use URL rewrite module to ignore the path this software is using to validate the URL and not to redirect it.\n\n. Hi,\nI don\u2019t think you need this \nase \"http\":\n                    var path = \"https://\" + Request.Url.Host + Request.Url.PathAndQuery;\n                    Response.Status = \"301 Moved Permanently\";\n                    Response.AddHeader(\"Location\", path);\n                    break;\nas you already do a redirect using IIS.\nIf you can post screenshoots of binding you use in the folders you pointing the iis entry I can then check it for you.\nSent from Mail for Windows 10\nFrom: jtsoftware\nSent: 23 June 2017 17:06\nTo: Lone-Coder/letsencrypt-win-simple\nCc: Rafal Zdziech; Mention\nSubject: Re: [Lone-Coder/letsencrypt-win-simple] How to debug unreachablehttps? (#463)\nActually, I'm working on this now. I tried doing the redirect in IIS, but I would get \"too many redirects\" errors in Chrome, and Edge and IE wouldn't connect at all. I'm working on doing the redirect in my MVC code, from a response someone got on StackOverflow, which seems to work so far, though I had to hack it a bit to keep my WCF service working. I also had to fix a number of things to handle both \"http\" and \"https\" in urls. Here's my MVC hack to Global.asax.cs to do the redirect:\n` protected void Application_BeginRequest(Object sender, EventArgs e)\n{\n// Handle http to https redirection here.\nif (Request.IsLocal)\n{\nreturn;\n}\nelse\n{\n// If connecting to a machine on the local network, don't redirect.\nif (!Request.Url.Host.StartsWith(\"www.\"))\nreturn;\n            // If for the service, don't redirect. \n            if (Request.CurrentExecutionFilePathExtension == \".svc\")\n                return;\n        switch (Request.Url.Scheme)\n        {\n            case \"https\":\n                Response.AddHeader(\"Strict-Transport-Security\", \"max-age=31536000\");\n                break;\n            case \"http\":\n                var path = \"https://\" + Request.Url.Host + Request.Url.PathAndQuery;\n                Response.Status = \"301 Moved Permanently\";\n                Response.AddHeader(\"Location\", path);\n                break;\n        }\n    }\n}\n\n`\nThis only works if I use \"http\" in the service url. Can services use https also? If I use https, I get an \"Endpoint not found exception\".\nAny thoughts on this?\nThanks.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub, or mute the thread.\n. Are you using HTTP to HTTPS redirect?\nIt also looks like I need to \"authenticated\" to be able to access this file.\nI think you need to disable windows authentication in IIS for .well-done folder\n{ ~ }  \u00bb curl -s http://vmd12124.contabo.host/.well-known/acme-\n challenge/jNYhyJZlm1rUBkMG9AEk5YKakcao37NkB8eP8bX_d3k                              ~\n <!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n <html><head>\n <title>301 Moved Permanently</title>\n </head><body>\n <h1>Moved Permanently</h1>\n <p>The document has moved <a href=\"https://market-intern.de//.well-known/acme-\n challenge/jNYhyJZlm1rUBkMG9AEk5YKakcao37NkB8eP8bX_d3k\">here</a>.</p>\n </body></html>\n. have you tried to run letsencrypt as a different user\ngo to start type Run then runas localadminuser cmd\nthen navigate to letscrypt and try to run it.. Have you got scheduled task to setup to run even if user is not logged in ? . Do you have both http/https binding?  http binding is required for it to work.\nDo you have Windows Authentication enabled?\nI frequency finding out that i need to exclude .well-done folder from Windows Authentication\nDo you use WAF (Web Application Firewall) ?\n. Should it spell ERROR instead of EROR ? . ",
    "wstaelens": "because of nullreferenceexception and issue in old version of winacme i'm now blocked and can't renew with newer version after too many attempts. oh boy. I have the same (for site that worked).\nversion 1.9.5.11152 (RELEASE)\n```\n[EROR] ACME server reported type urn:acme:error:connection\n[EROR] ACME server reported detail Fetching http://www.xxxxxx/.well-known/acme-challenge/......: Timeout\n[Eror] ACME server reported status 400\n[EROR] Exception Exception of type 'LetsEncrypt.ACME.Simple.AuthorizationFailedException' was thrown.\n```\n. and how do we get it working again? \n(btw we were using -san switch) . both http://sub.site.be and http://www.sub.site.be are not reachable via IPv6.\nNo AAAA records (only A records are defined).\nso it should be only IPv4.\nwith the --san switch when I want to renew it automatically tests the two domains:\nhttp://sub.site.be is valid\nhttp://www.sub.site.be is invalid  -> ...AuthorizationFailedException status 400\nboth sites are accessible via HTTP (with or without www.)\nletsencrypt-win-simple gives me these urls:\n\n\nhttp://sub.site.be/.well-known/acme-challenge/foo1\n\n\nhttp://www.sub.site.be/.well-known/acme-challenge/foo2\n\n\nI can access the foo2 via: http://www.sub.site.be/.well-known/acme-challenge/foo2 \nthe foo2 file is also available in the acme-challenge directory on the server, but foo1 challenge could not be found in the same directory on the server. (because it is deleted automatically?)\nresult  httpS for www and without www does still not work.\nany suggestions, it is IPv4 only. Can i email you or twitter dm @wstaelens? (private Message doesn't seem possible here). @WouterTinus waiting till you accept so that I can DM you :-). @WouterTinus I'm testing another domain now but I'm getting closer.\nMy domain had 5 bindings. 4 of them were reachable outside (via the internet), 1 of them with an underscore was for internal testing.\ncertificate was not valid anymore, so i generated a new one:\n\nas you can see this failed.\nI removed the internal binding, and tried again:\n\nthis works.\nSo maybe ALL bindings should be valid, otherwise no single renewed certificate is being stored and no bindings are attached ? \n(or is it only in case there is an exception, easily testable by just adding a binding like www._mydomain.com, as this throws an ACME Server malformed exception (invalid character). )\nMaybe this is something that could be changed?\nIt seems also that or the domain that was failing, now works. I'm not sure if something changed at let's encrypt or if it was our internal IT.\n\ndid another test on a different domain.\n3 bindings were ok, 1 gave an exception:\n\nACME server reported type urn:acme:error:connection\nACME server reported detail DNS problem: NXDOMAIN looking up A for <...>\nACME server reported status 400\nException Exception of type 'LetsEncrypt.ACME.Simple.AuthorizationFailedException' was thrown.\n\nResult: no certificates updated because 1 binding failed --> site not reachable via https on every binding.\n. I'm still facing some errors on another domain...\nACME server reported type urn:acme:error:connection\nACME server reported detail Fetching http://...: Timeout\nACME server reported status 400\nException Exception of type 'LetsEncrypt.ACME.Simple.AuthorizationFailedException' was thrown.\nwith or without the --san. (1.9.5.11152).\nI can access that file on my mobile phone (4G, not wifi) so it IS reachable. Still I have status 40 and that exception.\n. \"This website is not ready for IPv6\", no AAAA records, so it should fall back to IPv4.... I'm waiting for a reply for the DNS-provider (Versio.nl).\n(they already gave this url to check: https://srvx.nl/mydomain.nl ). ",
    "gufmar": "I confirm having the same behavior on a win2012 server with latest v1.9.3 release.\nI had to change (set in the past) all the Date fields in HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\\Renewals\nafter that a manual run of the scheduled task action renewed all certificates.. maybe a bit OT, but on a Friday evening: big applause and THANKS for all the work @WouterTinus . ",
    "jtsoftware": "@ber5ien Thank you so much!  It was the port forwarding. I'd forgotten all about that, even though I had to do it for port 80 back when I first set up the web site.  For other router NGV510 users out there, this is done on the Firewall->NAT/Gaming page, adding a hosted application referencing the HTTPS service and the web server machine name.\n@rdebath Thanks also for the reference to the cool ShieldsUp page which was useful in the process of debugging this.\nAgain thanks to both of you for taking the time to help me out.  I really appreciate it.\n. Actually, I'm working on this now.  I tried doing the redirect in IIS, but I would get \"too many redirects\" errors in Chrome, and Edge and IE wouldn't connect at all.  I'm working on doing the redirect in my MVC code, from a response someone got on StackOverflow, which seems to work so far, though I had to hack it a bit to keep my WCF service working. I also had to fix a number of things to handle both \"http\" and \"https\" in urls.  Here's my MVC hack to Global.asax.cs to do the redirect:\n`        protected void Application_BeginRequest(Object sender, EventArgs e)\n        {\n            // Handle http to https redirection here.\n            if (Request.IsLocal)\n            {\n                return;\n            }\n            else\n            {\n                // If connecting to a machine on the local network, don't redirect.\n                if (!Request.Url.Host.StartsWith(\"www.\"))\n                    return;\n            // If for the service, don't redirect. \n            if (Request.CurrentExecutionFilePathExtension == \".svc\")\n                return;\n\n            switch (Request.Url.Scheme)\n            {\n                case \"https\":\n                    Response.AddHeader(\"Strict-Transport-Security\", \"max-age=31536000\");\n                    break;\n                case \"http\":\n                    var path = \"https://\" + Request.Url.Host + Request.Url.PathAndQuery;\n                    Response.Status = \"301 Moved Permanently\";\n                    Response.AddHeader(\"Location\", path);\n                    break;\n            }\n        }\n    }\n\n`\nThis only works if I use \"http\" in the service url.  Can services use https also?  If I use https, I get an \"Endpoint not found exception\".\nAny thoughts on this?\nThanks.\n. ",
    "phairplay": "Hello \nI'm using nginx on Windows and was hoping to obtain a wildcard ask cert\nIs there any update on when this will. E included?. ",
    "HyramTang": "Hello, Does anyone know how to support wildcards?. ",
    "AndreiPukrov": "@WouterTinus which work did you are referring? Since 6 month I do not see any actions on ACMESharp and for me it looks like it is death since a half year. ZeroSSL seamed to be very active, maybe its time to switch?. @vineetkr1985 \nThe developer from that solution is @ebekker and you can see the latest status here: https://github.com/PKISharp/ACMESharpCore however there is no ETA provided yet. So we still need to wait.... ",
    "SteffenAL": "Thanks. That is good news !. Changed in letsencrypt.exe.config to Personal, same issue as above.\n<setting name=\"CertificateStore\" serializeAs=\"String\">\n        <value>Personal</value>\n      </setting>\nIndeed in MMC/Certificates (Local Computer)/Personal/Certificates I see the  certificate apachelounge.com (On Windows 2012 R2)\nBtw.\nRunning Apache, there is no need to use the CertificateStore.\n. Trying with Beta 3:\nFirst attempt:  Certificates are renewed:\n```\n [EROR] Error encountered while opening certificate store\nSystem.Security.Cryptography.CryptographicException: The system cannot find the file specified.\nat System.Security.Cryptography.X509Certificates.X509Store.Open(OpenFlags flags)\n   at LetsEncrypt.ACME.Simple.Services.CertificateStoreService.GetCertificate(Func`2 filter, X509Store store)\n [INFO] Requesting certificate apachelounge.com 2017-10-15 12:19:18\n [INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\apachelounge.com-crt.der\n [INFO] Installing certificate in the certificate store\n [INFO] Installing SSL certificate in server software\n [WARN] Unable to run script.\n [INFO] Renewal for apachelounge.com succeeded, next one scheduled for 2017-12-14 10:19:20\n```\n[INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\apachelounge.com-crt.der\nShould be:\n [INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\\nSecond attempt, no error any more and certificate is stored in Wouterstore\n```\n\nletsencrypt --forcerenewal\n [INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Version 1.9.7.20942 (RELEASE)\n [INFO] ACME Server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n [INFO] Renewing certificate for apachelounge.com\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Cached authorization result: valid\n [INFO] Requesting certificate apachelounge.com 2017-10-15 12:28:57\n [INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\apachelounge.com-crt.der\n [INFO] Installing certificate in the certificate store\n [INFO] Installing SSL certificate in server software\n [WARN] Unable to run script.\n [INFO] Uninstalling certificate from the certificate store\n [INFO] Removing certificate apachelounge.com 2017-10-15 12:19:18\n [INFO] Renewal for apachelounge.com succeeded, next one scheduled for 2017-12-14 10:29:00\n```\n\nSo all fine. Maybe you can add an option that IIS is not installed/used, so we do not have a Warning. \nBtw.\nWith 1.9.7 I see : [INFO] Cached authorization result: valid \nWhat does this mean ?   \nI see that there are no new acme-challenge's and see no traffic from letsencrypt.org in my server ?\n. Thanks!\nAll fine now.. Read https://letsencrypt.org/trademarks/  \n. Tried to renew with Alfa4 with the generated with Alfa3, get :\n[EROR] Unable to read renewal ypgncL_aZUedyn2ZNjnRmQ.renewal.json: missing TargetPluginOptions\nRemoved ProgramData/win-acme\nCreated a new certificate, and all fine.\nThanks! \n. Option is not on renewal (makes sense). So I created a new certificate with GUI. \nIt works !\nIndeed nowadays only chain and private are needed (since 2014).\nHit now rate limit, so testing after a week again. (too many certificates already issued for exact set of domains). ",
    "vineetkr1985": "Hi @WouterTinus ,\nCan I know when letsencrypt win simple for ACMEv2 wildcard support  will be available for us? Is there any possibility for launching by July end?\nThanks in Advance. ",
    "Dragonsangel": "@WouterTinus do you have an update on this feature for us?. ",
    "TeamKinetic": "Good work everyone, looking forward to using wildcard certificates!. Thanks,\nI'm guessing that command would renew every certificate found in the site?. Thanks for taking a look. I will try to replicate on a dummy server and get some images etc.\nI've used quite a few versions over the last year or so, so perhaps it's something to do with that. I'll get back to you,\nThanks. ",
    "wlpdrpat": "Hi @WouterTinus - any further updates on the 2.0 development? Time frame for release?. ",
    "Daniel15": "\nas does the requirement to securely store DNS API credentials so you can do auto renewals.\n\nacme-dns helps with that. It's a DNS server that is designed specifically to serve the TXT validation records. It provides an API to only set those records, with validation (the records are only allowed if they're the exact length and format that ACME uses). The idea is that you run it separately from your main DNS server, and CNAME the _acme-challenge subdomain to it. Because of this, it greatly reduces the surface area accessible by the API keys. It works very well! \nOf course, installing/configuring acme-dns is extra work you need to do. You do need a public IP for its DNS server  to be reachable, but it's perfectly fine with being IPv6-only. Let's Encrypt has no trouble connecting to DNS servers that only listen on IPv6 addresses, and most servers have a bunch of IPv6 addresses they're not using. . @webprofusion-chrisc \n\nso a bit like acme-dns but the only setup would be to register for an API key then set your CNAME in DNS (per domain), thereafter updates would be automatic.\n\nSo, exactly like acme-dns, but with someone else hosting it? \ud83d\ude1b \nThe creator of acme-dns used to run a public instance, but phased it out a while back. I think he didn't want people to be relying on his hosted version in case it ever went down.. @jhughes-mc  I haven't tried this build of win-acme yet, but Let's Encrypt wildcard certs require DNS validation. You can't use HTTPS validation, which it looks like you're trying to use.. > when completing a certificate creation, a scheduled task is created\nThis is awesome! Is it documented anywhere? I couldn't find it in the docs.. > what kind of information would you like to see about it?\nThe fact that it exists would be a good start \ud83d\ude1b  I was looking for how to configure auto-renewal, not realising that it works fine out-of-the-box.. >  I wonder how other open source projects solve this kind of problem\nStoring the signing cert in the source tree (as you'd need to do with AppVeyor) feels unsafe to me.\nFor Yarn, the code signing certificate is sitting on a server I control, encrypted at-rest. I use a simple webapp I built (SecureSign) in a separate LXC container to handle signing the release files, so that the certificate is never actually exposed to the build environment. The installer file is posted to the signing webapp, which signs it and then returns the signed version.. I'd love to see acme-dns support too. I'm running my own acme-dns server, and it works fine for Certbot on my Linux machines, but I'd like to use it with win-acme too.. ",
    "jhughes-mc": "Running alpha2. Unable to get it to validate a wildcard cert. Tried filesystem validation too. It all seems to work fine if it's not a wildcard. Any way to get more logging out of this?\nwacs.exe --target manual --host *.domain.com --validationmode http-01 --validation selfhosting --verbose\n```\n [INFO] A simple Windows ACMEv2 client (WACS)\n [INFO] Software version 200.0.6940.36971 (RELEASE)\n [INFO] IIS version 7.5\n [INFO] ACME server https://acme-v02.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\n[INFO] Running in mode: Unattended\n [INFO] Target generated using plugin Manual: *.domain.com\n [EROR] Validation plugin SelfHosting cannot validate this target\n [EROR] No validation plugin could be selected\n```. @Daniel15 @WouterTinus Thanks for the tip. I missed while reading that wildcards require DNS. Any recommendations for getting this hooked into Cloudflare on a windows machine? I'm finding plenty of other ACMEv2 clients with Cloudflare support but none of them also install and configure the certificate. Maybe I can find a Cloudflare powershell script and tie it into win-acme?. ",
    "SoloIT4": "Bump. ",
    "struppinet": "Same here. A fix would be really nice! I also use the Manual Mode.\nWARNING: Unable to renew. ",
    "tandrasz": "Same request from me: update all bindings. In my case I have two bindings: one for IPv6 and one for IPv4. On renewal IPv4 binding was left out.. ",
    "b00gz": "I was able to resolve this error by rebooting the server. Have you attempted to do that?. Understood I just wanted to make sure that if you didn't try to reboot already that you could reboot and likely fix the problem.. Thanks for that information. That will help us out until this problem is resolved.. It would be awesome if it be ran as system is that a possibility?. ",
    "NikolayIT": "This fixed the problem for me too. Anyway this is a bug :-). Same here with 1.9.8.0-beta7\n\n. ",
    "foxontherock": "I solved it without rebooting, I restarted the service \"IISADMIN\" (IIS Admin Service). . ",
    "GibbyOH": "What if port 80 traffic is re-routed to 443? I use a kemp load balancer and all my port 80 traffic get re-routed to 443. . ",
    "nvanrooij": "I have tried your suggestion, but the old certificate(s) are not being removed. I don't think this has anything to do with SSTP though*. I think this happens on all of my Windows Server 2008 R2 machines. All servers have a similar configuration: 1 or more website(s), all secured using a SAN certificate. IIS uses URL rewrite to redirect http to https. RRAS enabled, SSTP certificate set to 'default'.\n(*) I already figured out the problem with SSTP: My users connect via VPN to sub.domain.com using SSTP. If the certificate bound to the SSTP listener does not match the certificate used for the website on https://sub.domain.com the connection will fail. Since the letsencrypt certificate is being renewed every 60 days the website on https://sub.domain.com gets a new certificate, but SSTP is still using the old certificate.\nIf there is only one certificate in the store, then SSTP should - theoretically - use the same certificate as IIS, but I can't test this since old certificates are not being deleted.\nThis is the logfile from one server (domainnames have been edited for privacy):\n[INFO] Let's Encrypt (Simple Windows ACME Client)\n[INFO] version 1.9.4.27694 (RELEASE)\n[VERB] Verbose mode logging enabled\n[INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n[INFO] Renewal period: 60\n[INFO] Certificate store: WebHosting\n[INFO] ACME Server: https://acme-v01.api.letsencrypt.org/\n[DBUG] Settings {ScheduledTaskName=\"letsencrypt-win-simple httpsacme-v01.api.letsencrypt.org\"}\n[DBUG] Config folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n[DBUG] Certificate folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n[DBUG] Loading signer from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\n[DBUG] Getting AcmeServerDirectory\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n[DBUG] Loading registration from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\n[INFO] Checking renewals\n[INFO] Renewing certificate for \n[IISSiteServer] 1,2,3 \n[3 bindings - example.domain.nl, ... ] - renew after 11-10-2017\n[DBUG] Scanning IIS sites\n[INFO] Authorizing identifier example.domain.nl using http-01 challenge\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[DBUG] Writing challenge answer to C:\\path\\towebsite\\.well-known\\acme-challenge\\iR9xIg1GXbVSEm8eS_pq5jt7fLfbxbtq4gkNIn5JQ-c\n[DBUG] Writing web.config to C:\\path\\towebsite\\.well-known\\acme-challenge\\web.config\n[INFO] Answer should now be browsable at http://example.domain.nl/.well-known/acme-challenge/iR9xIg1GXbVSEm8eS_pq5jt7fLfbxbtq4gkNIn5JQ-c\n[DBUG] Submitting answer\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/0xpJ1QNY-tL0EpLG60v9ixkSM615jGxanIWM5OTNkgk/1733776504\n[INFO] Authorization result: valid\n[DBUG] Deleting answer\n[DBUG] Deleting web.config\n[DBUG] Deleting C:\\path\\towebsite\\.well-known\\acme-challenge\n[DBUG] Deleting C:\\path\\towebsite\\.well-known\n[INFO] Authorizing identifier dossier.domain.nl using http-01 challenge\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[DBUG] Writing challenge answer to C:\\path\\towebsite2\\.well-known\\acme-challenge\\MOKCljBH6iYsHOGPXoRg4ZIYYn5gcowEgYX4kqUlqoQ\n[DBUG] Writing web.config to C:\\path\\towebsite2\\.well-known\\acme-challenge\\web.config\n[INFO] Answer should now be browsable at http://dossier.domain.nl/.well-known/acme-challenge/MOKCljBH6iYsHOGPXoRg4ZIYYn5gcowEgYX4kqUlqoQ\n[DBUG] Submitting answer\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/DUdFpO5hqUymuFUiNqc4_GXVg9PaUal4ZOO7tJSEomU/1733777437\n[INFO] Authorization result: valid\n[DBUG] Deleting answer\n[DBUG] Deleting web.config\n[DBUG] Deleting C:\\path\\towebsite2\\.well-known\\acme-challenge\n[DBUG] Deleting C:\\path\\towebsite2\\.well-known\n[INFO] Authorizing identifier debiteur.domain.nl using http-01 challenge\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[DBUG] Writing challenge answer to C:\\path\\towebsite2\\.well-known\\acme-challenge\\zXFKc0A-RgUk6E4JXf3rhL_P3A9qlW1njFn_JnIPR-I\n[DBUG] Writing web.config to C:\\path\\towebsite2\\.well-known\\acme-challenge\\web.config\n[INFO] Answer should now be browsable at http://debiteur.domain.nl/.well-known/acme-challenge/zXFKc0A-RgUk6E4JXf3rhL_P3A9qlW1njFn_JnIPR-I\n[DBUG] Submitting answer\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/d57sWXCiKEaK5eMkZLNIKlUrHm4kU8_A8j-k5mDJt4E/1733778134\n[INFO] Authorization result: valid\n[DBUG] Deleting answer\n[DBUG] Deleting web.config\n[DBUG] Deleting C:\\path\\towebsite2\\.well-known\\acme-challenge\n[DBUG] Deleting C:\\path\\towebsite2\\.well-known\n[DBUG] RSAKeyBits: 2048\n[INFO] Requesting certificate: example.domain.nl\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n[DBUG] certRequ CertificateRequest {CsrContent=\"*****\"}\n[DBUG] Request Status: Created\n[INFO] Saving certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\example.domain.nl-crt.der\n[INFO] Saving issuer certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ca-0A0141420000015385736A0B85ECA708-crt.pem\n[DBUG] CentralSsl False - San True\n[INFO] Saving certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\example.domain.nl-all.pfx\n[INFO] Installing non-Central SSL certificate in the certificate store\n[DBUG] Opened Certificate Store My\n[DBUG] Set private key exportable\n[DBUG] 1,2,3 2017-8-21 10:2:26\n[DBUG] Adding certificate to store\n[DBUG] Closing certificate store\n[INFO] Installing non-Central SSL certificate in server software\n[INFO] Adding https binding\n[WARN] No HTTP binding for Website1 on Website1\n[INFO] Updating existing https binding\n[INFO] IIS will serve the new certificate after the Application Pool IdleTimeout has been reached.\n[INFO] Committing binding changes to IIS\n[DBUG] Opened Certificate Store My\n[INFO] Closing Certificate Store\n[INFO] Adding https binding\n[WARN] No HTTP binding for Website2 on Website2\n[INFO] Updating existing https binding\n[INFO] IIS will serve the new certificate after the Application Pool IdleTimeout has been reached.\n[INFO] Committing binding changes to IIS\n[DBUG] Opened Certificate Store My\n[INFO] Closing Certificate Store\n[INFO] Adding https binding\n[WARN] No HTTP binding for Website3 on Website3\n[INFO] Updating existing https binding\n[INFO] IIS will serve the new certificate after the Application Pool IdleTimeout has been reached.\n[INFO] Committing binding changes to IIS\n[DBUG] Opened Certificate Store My\n[INFO] Closing Certificate Store\n[INFO] Renewal scheduled \n[IISSiteServer] 1,2,3 \n[3 bindings - example.domain.nl, ... ] - renew after 20-10-2017\nAfter this websites use the new certificate, but the old certificate is still in the certificate store:\n\n. I can confirm that the old certificate is now succesfully removed.. I am not sure if it has to with this new option, but I have removed version 1.9.3 by manually deleting the folders in appdata\\roaming and the registry key in HKCU and installed 1.9.5 afterwards. When trying to create a new certificate the renewal is not being written to the registry:\n```\nC:\\folder\\letsencrypt>letsencrypt --verbose --san\n[INFO] Let's Encrypt (Simple Windows ACME Client)\n[INFO] Version 1.9.5.38878 (RELEASE)\n[VERB] Verbose mode logging enabled\n[INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-sim\nple\n[INFO] Renewal period: 60\n[INFO] Certificate store: WebHosting\n[INFO] ACME Server: https://acme-v01.api.letsencrypt.org/\n[VERB] Using registry key HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\htt\nps://acme-v01.api.letsencrypt.org/\n[DBUG] Settings {Renewals=\"The property accessor threw an exception: ArgumentNul\nlException\"}\n[DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.le\ntsencrypt.org\n[DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.a\npi.letsencrypt.org\n[DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.a\npi.letsencrypt.org\\Signer\n[DBUG] Getting AcmeServerDirectory\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n[DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme\n-v01.api.letsencrypt.org\\Registration\n[DBUG] Scanning IIS sites\n1: [IIS] Site1 (SiteId 1) [1 binding - subdomain.site1.nl @ C:\\folder\\Site1]\n 2: [IIS] test (SiteId 2) [1 binding - test.test.nl @ C:\\folder\\Site1Debi\nteurenPortal]\nW: Generate a certificate via WebDav and install it manually.\n S: Generate a single San certificate for multiple sites.\n F: Generate a certificate via FTP/ FTPS and install it manually.\n M: Generate a certificate manually.\n Q: Quit\nChoose from one of the menu options above: S\n[DBUG] Running IISSiteServer Plugin\nEnter a comma separated list of site IDs, or 'S' to run for all sites: 1\n[INFO] Authorizing identifier subdomain.site1.nl using http-01 challenge\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[DBUG] Writing challenge answer to C:\\folder\\Site1.well-known\\acme-challe\nnge\\rGUDlYHsIsNSpUjK-Vgzz-srT8jPQ_fOCInSmw3wWzM\n[DBUG] Writing web.config to C:\\folder\\Site1.well-known\\acme-challenge\\we\nb.config\n[INFO] Answer should now be browsable at http://subdomain.site1.nl/.well-known\n/acme-challenge/rGUDlYHsIsNSpUjK-Vgzz-srT8jPQ_fOCInSmw3wWzM\n[DBUG] Submitting answer\n[CUT FOR PRIVACY]\n[INFO] Authorization result: valid\n[DBUG] Deleting answer\n[DBUG] Deleting web.config\n[DBUG] Deleting C:\\folder\\Site1.well-known\\acme-challenge\n[DBUG] Additional files or folders exist in C:\\folder\\Site1.well-known, n\not deleting.\n[DBUG] RSAKeyBits: 2048\n[INFO] Requesting certificate: subdomain.site1.nl\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n[CUT FOR PRIVACY]\n[DBUG] Request Status: Created\n[INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01\n.api.letsencrypt.org\\subdomain.site1.nl-crt.der\n[INFO] Saving issuer certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsa\ncme-v01.api.letsencrypt.org\\ca-0A0141420000015385736A0B85ECA708-crt.pem\n[DBUG] CentralSsl False - San True\n[INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01\n.api.letsencrypt.org\\subdomain.site1.nl-all.pfx\n[INFO] Installing non-Central SSL certificate in the certificate store\n[DBUG] Opened Certificate Store My\n[DBUG] Set private key exportable\n[DBUG] Adding certificate 1 2017-8-30 2:44:27  to store\n[DBUG] Closing certificate store\n[INFO] Installing non-Central SSL certificate in server software\n[INFO] Adding new https binding for subdomain.site1.nl\n[INFO] Committing binding changes to IIS\n[DBUG] Opened certificate store My\n[INFO] Removing certificate 1 2017-8-30 2:31:05\n[INFO] Closing certificate store\n[INFO] Adding renewal for [IISSiteServer] 1 [1 binding - subdomain.site1.nl ]\nDo you want to replace the existing task? (y/n): - no\n[DBUG] Exception ArgumentNullException {Message=\"Value cannot be null.\\r\\nParame\nter name: source\", ParamName=\"source\", Data=[], InnerException=null, TargetSite=\nSystem.Collections.Generic.IEnumerable1[TResult] Select[TSource,TResult](System\n.Collections.Generic.IEnumerable1[TSource], System.Func2[TSource,TResult]), St\nackTrace=\"   at System.Linq.Enumerable.Select[TSource,TResult](IEnumerable1 sou\nrce, Func2 selector)\\r\\n   at LetsEncrypt.ACME.Simple.Settings.get_Renewals()\\r\n\\n   at LetsEncrypt.ACME.Simple.Program.ScheduleRenewal(Target target)\\r\\n   at\nLetsEncrypt.ACME.Simple.IISSiteServerPlugin.ProcessTotaltarget(Target totalTarge\nt, List1 runSites)\\r\\n   at LetsEncrypt.ACME.Simple.IISSiteServerPlugin.HandleM\nenuResponse(String response, List1 targets)\\r\\n   at LetsEncrypt.ACME.Simple.Pr\nogram.HandleMenuResponseForPlugins(List1 targets, String command)\\r\\n   at Lets\nEncrypt.ACME.Simple.Program.Main(String[] args)\", HelpLink=null, Source=\"System.\nCore\", HResult=-2147467261}\n[EROR] Exception Value cannot be null.\nParameter name: source\nWould you like to start again? (y/n): - no\n```\nWhen I then try to renew I get the following error:\n```\n[INFO] Let's Encrypt (Simple Windows ACME Client)\n[INFO] Version 1.9.5.38878 (RELEASE)\n[VERB] Verbose mode logging enabled\n[INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-sim\nple\n[INFO] Renewal period: 60\n[INFO] Certificate store: WebHosting\n[INFO] ACME Server: https://acme-v01.api.letsencrypt.org/\n[VERB] Using registry key HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\htt\nps://acme-v01.api.letsencrypt.org/\n[DBUG] Settings {Renewals=\"The property accessor threw an exception: ArgumentNul\nlException\"}\n[DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.le\ntsencrypt.org\n[DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.a\npi.letsencrypt.org\n[DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.a\npi.letsencrypt.org\\Signer\n[DBUG] Getting AcmeServerDirectory\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n[DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme\n-v01.api.letsencrypt.org\\Registration\n[INFO] Checking renewals\n[DBUG] Exception ArgumentNullException {Message=\"Value cannot be null.\\r\\nParame\nter name: source\", ParamName=\"source\", Data=[], InnerException=null, TargetSite=\nSystem.Collections.Generic.IEnumerable1[TResult] Select[TSource,TResult](System\n.Collections.Generic.IEnumerable1[TSource], System.Func2[TSource,TResult]), St\nackTrace=\"   at System.Linq.Enumerable.Select[TSource,TResult](IEnumerable1 sou\nrce, Func`2 selector)\\r\\n   at LetsEncrypt.ACME.Simple.Settings.get_Renewals()\\r\n\\n   at LetsEncrypt.ACME.Simple.Program.CheckRenewals()\\r\\n   at LetsEncrypt.ACM\nE.Simple.Program.Main(String[] args)\", HelpLink=null, Source=\"System.Core\", HRes\nult=-2147467261}\n[EROR] Exception Value cannot be null.\nParameter name: source\n```. I think this is the same problem as I described here: https://github.com/Lone-Coder/letsencrypt-win-simple/issues/483#issuecomment-325982197. I just found out that the web.config used for 1.9.3 included the following code:\n<system.web>\n    <authorization>\n      <allow users=\"*\" />\n    </authorization>\n  </system.web>\nI think this solves my problem.. ",
    "LennardF1989": "Having the same issue. Right now on a web-server of mine 6 sites got their certificates renewed, but not updated and I have no way with this tool to attempt a re-download and reinstall.. --san allows for getting certificates for all bindings on an IIS website. It however requires there is a HTTP binding as well. If you use --san but remove the HTTP binding of a website, it will refuse to try and renew a certificate. There's not much else too it :P. @woric I'm not quite sure at who this is directed? Did you place this in the wrong issue? It seems out of place :P. As for further information. \nAdjust the date in the line of your website on the following registry key: HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\\Renewals\nAfter doing so, the client will simply request a new certificate from LetsEncrypt. This registry key is the only thing that keeps the client from requesting a new certificate every time you run --renew.\nBut you have to keep in mind that the HTTP request has to succeed in order to get a certificate. So not having a HTTP-binding, or having a web.config that does not exclude the .well-known folder from routing (if applicable to your website), will make it fail.\nThese \"rules\" are applicable to any kind of certificate, regardless of --san.. @mesa57 I think your problem in this case is you are trying to update a certificate for Apache, which uses this Plugin: https://github.com/Lone-Coder/letsencrypt-win-simple/blob/863de4b109fd5dc154e674cf4389f2e0ce906c6c/letsencrypt-win-simple/Plugin/ManualPlugin.cs#L74\nAs you can see, there is no renew mechanism whatsoever. If you compare that to the IIS plugin, it will call this: https://github.com/Lone-Coder/letsencrypt-win-simple/blob/863de4b109fd5dc154e674cf4389f2e0ce906c6c/letsencrypt-win-simple/Program.cs#L578\nLooks like you'll have to implement a Renew function that works for your situation, or better yet, an ApachePlugin.\nEDIT: You can also simply request a new certificate for the domain every two months using the command-line, without renew. You just have to make your own scheduled job for that.. @mesa57 It doesn't work because it's programmed not to do anything upon --renew :P It's right there in the code I linked. Do not rely on --renew but instead make a scheduled job to request a new certificate every 2 months and you'll be fine.. You can grab it off AppVeyor if building it yourself is a daunting task: https://ci.appveyor.com/project/Lone-Coder/letsencrypt-win-simple/build/1.0.267/artifacts. ",
    "josephrcolis": "Lennard!Please kindly elaborate --san and steps you made . thanks\n. ",
    "woric": "Not sure how you guys are getting your certificates to work as CN (common\nname) support has been dropped from both chrome and Firefox;  those\nbrowsers now require  a SAN in the certificate.\nSee\nhttps://groups.google.com/a/chromium.org/forum/m/#!topic/security-dev/IGT2fLJrAeo\nand\nhttps://textslashplain.com/2017/03/10/chrome-deprecates-subject-cn-matching/\nfor more info.\nApparently the security boffins deprecated using the CN to check a site\nname when https was first introduced in 2000, but it has taken them 17\nyears of agitating to overcome common practice and actually make it happen.\nOn 19 Jul 2017 06:21, \"mesa57\" notifications@github.com wrote:\n\n@josephrcolis https://github.com/josephrcolis Please look at #474\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/474 also.\nSame problem I think, I also use --san because I have multiple domain names.\n\u2014\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/475#issuecomment-316185586,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AFkhC7yffODpmbEiFPl4Y_V33jdzCBJDks5sPROxgaJpZM4ObJhe\n.\n. \n",
    "Archanian": "+1 this feature would be awesome. I am working on an installer which sets up new instances of a web app running in IIS. Automating SSL setup process is one of the steps and currently I am having to reimplement everything the IIS plugin does manually, simply because I want to be able to run this via command line args alone.. ",
    "next100years": "Thank You!. I resolve! the problem is a domain not valid but present in IIS, delete the domain in IIS is OK. Thank You.\nIs recomanded to update client at the latest version 1.9.7.2?. ",
    "trankin": "Fair enough, is there a way to run and automate all of the IIS work without\ninteraction?\nT\nOn Mon, Jul 24, 2017 at 3:47 PM, LBegnaud notifications@github.com wrote:\n\nWhat if the webserver isn't IIS?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/pull/481#issuecomment-317549537,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AAJ-yEjNPCGVljXgChRfQwxHEvqfX3-Iks5sRQLtgaJpZM4OhtCZ\n.\n. \n",
    "davyme": "Can you explain how we can migrate manually, please?. ",
    "notken": "Hi there. Thanks for the suggestion, but, yes, and just tried again and got the same issue.. ",
    "hslatman": "We performed the installation a while ago; the command executed back then was similar to this:\nletsencrypt.exe --manualhost lets-encrypt-live1.example.com --webroot \"C:\\path\\to\\webroot\" --emailaddress me@example.com --accepttos\nWe performed this for several domains. To renew the certificates we run the following in a .bat script:\nletsencrypt.exe --renew\nThe 1.9.3 version was problematic, as it would fail and still set the renewal date into the future. That particular issue was solved by deploying 1.9.4 beta4 (nice job on fixing that one :smile:).\nThe registry has multiple entries similar to the one below:\n{\"Date\":\"2017-10-01T13:18:58.5892533Z\",\"Binding\":{\"Host\":\"lets-encrypt-live1.example.com\",\"WebRootPath\":\"d:\\\\websites\\\\lets-encrypt-live1\",\"SiteId\":0,\"AlternativeNames\":null,\"PluginName\":\"Manual\",\"Plugin\":{\"Name\":\"Manual\"}},\"CentralSsl\":null,\"San\":\"False\",\"KeepExisting\":\"False\",\"Script\":null,\"ScriptParameters\":null,\"Warmup\":false}\nWe also performed some tests with domains that wouldn't resolve. The registry was not altered in those cases and they were retried on the next run, so the content of the registry looks OK to us.\nSo, certificate renewal is in fact working, but the binding in IIS breaks. If I'm correct, letsencrypt-win-simple imports the certificates into the certificate store after renewing the certificate, overwriting the old certificate, right? Could it be the case that IIS loses the reference to the old certificate upon the import by the client?. The --keepexisting option makes sense! Totally missed that one.\nSo, when we use that we will still get a renewed certificate, but the certificate in IIS will remain. This means that in manual mode we will have to manually change the certificate within the IIS bindings configuration? \nI've browsed the code for a bit and saw there are multiple plugins. I think we will switch to automatic configuration IIS in the end; our IIS admin first wanted to run a trial with Let's Encrypt before moving all domains over. I think it should be possible to switch to the IIS plugin by changing the registry entries, or is this considered a bad practice? . ",
    "iand123": "Forgot to say CMD is running as administrator. ",
    "hbruun": "Confirming that the issue was corrected in 1.9.4-beta10. Thank you. Thanks, I'll forward you the log info if/when it happens again with the next beta. Do I need to use any special settings to generate that log info?. I got past that problem in the new 1.9.4-beta10 version. Thank you.. Closing issue since latest version corrected the issue.. I'm seeing something similar. To me it happens while it is setting up the certificates.\n[INFO] IIS will serve the new certificate after the Application Pool IdleTimeout has been reached.\n[INFO] Updating existing https binding\n[INFO] IIS will serve the new certificate after the Application Pool IdleTimeout has been reached.\n[INFO] Committing binding changes to IIS\n[EROR] Exception A specified logon session does not exist. It may already have been terminated\nWould you like to start again? (y/n):\nI'm running with command line:\nletsencrypt --san --accepttos\nselecting S and then giving it 10+ site ids comma separated.\nI'm running 1.9.4-beta12 on Windows 2016 Standard. Works. Thanks :). I ran a 'renew all' with the latest beta 5 and did not encounter any problems. Thanks for the quick fix.. Version numbers are coming up with 0.0.0.0 in the latest 1.9.8.0-beta6 build (same in beta5).. That appears to have worked (using beta7). Thank you.\nOne note. I noticed that each validation ended up with an [EROR] response even though the result was 'valid'. Is that expected output (it was catching my eye because it would be in red).\nExample:\n[EROR] Authorization result: valid\n. ",
    "vanyamil": "Here is mine, from Issue #505\n{\"Date\":\"2017-09-24T13:00:03.1266Z\",\"Binding\":{\"Host\":\"dashctp.dyndns.org\",\"WebRootPath\":\"C:/Dash/Portal/public\",\"SiteId\":0,\"AlternativeNames\":null,\"PluginName\":\"Manual\",\"Plugin\":{\"Name\":\"Manual\"}},\"CentralSsl\":null,\"San\":\"False\",\"KeepExisting\":\"False\",\"Script\":null,\"ScriptParameters\":null,\"Warmup\":false}\n. ",
    "markbreen": "Hello Wouter,\nThank you very much, Beta10 worked for me.\nFYI, I still had to adjust the renewal data in the registry key because an earlier version updated it but had not updated the cert.  I just adjusted the date to the past and the newewal worked.\nI am now trying to figure out why another site will not renew but I will send you info if I figure out what is wrong.\nThanks again and if you need me to try anything, just ask,\nMark\n. Hello Wouter,\nI have not been back on this but when I am, I will let you know, sorry for\nthe delay.\nThanks\nMark Breen\nPhone: +353 45 831 025\nMobile: +353 86 806 6970\nEmail: mark.breen@margin.ie\nweb: http://marginbusiness.solutions\nOn 2 December 2017 at 07:58, Wouter Tinus notifications@github.com wrote:\n\nHi @markbreen https://github.com/markbreen, just wondering if you have\nyou been able to figure out the configuration problem with IIS mode?\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/627#issuecomment-348675930,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AH9x3t88a6-tXylKtOrFOZTLILu8prcNks5s8QMngaJpZM4QSdxV\n.\n. I second that comment from Wouter, we have recently added LEWS to three or four servers, including one with Spanish as the default language and the IIS plugin just worked 100% of the time.  Thank you Wouter.. Hi Paul,\n\nthank you for your response and time to prepare the script files.\nI suspect that I am misunderstanding something about how the Acme protocol => LetsEncrypt =>Win-Acme works.\nI had previously understood that we did the following:\n1) create a change in a subfolder that can we publicly verfied eg /.wellknown\n2) LetsEncrypt make a call from a remote location to this subfolder and proved that we truly own the domain\n3) LetsEncrypt issued us with a cert.\nIn DNS validation I expected the following:\n1) We generate a public DNS record somehow eg a txt record and save that with our domain DNS records.\n2) LetsEncrypt make a DNS lookup from a remote location to this txt record and proved that we truly own the domain.\n3) LetsEncrypt issued us with a cert.\nIn your ps1 files, you are adding a DNS record to an internal DNS entry in Windows Server.  How can LetsEncrypt use that to prove we own a domain?  \nOr am I completely mis-understanding the DNS-01 validation option?\nThe question remains:\nHow can I request a cert for a site without opening ports 80 and 443. \nPerhaps I should expand that question to say that even though it is not open to the world, it is open to more people than on the corporate network using the corporate DNS servers.\nThanks in advance for your advice.\n. ",
    "ukoloff": "Well, config file is a brilliant idea. Just tested it and found very convenient :+1: . ",
    "voidmonk": "Thanks. Are you suggesting to export certs from old server, import them on new server, and finally once all sites are moved then use letsencrypt to regenerate certs?. Thanks again!\n\nexport/import the LEWS registry keys to save some time.\n\nHow and where (old server or new) do I do that?. Is it possible to generate a SAN cert for multiple domains from different IIS sites and web-roots.\nExample:\n\n[IIS] Site1 [1 binding site1.com @ D:\\Site1]\n[IIS] Site2 [4 bindings site2.com @ D:\\Site2]\n[IIS] Site3 [2 bindings site3.com @ D:\\Site3]\n\nI'm wondering how to generate one SAN cert only for site1.com, site2.com and site3.com (each has its own web-root), but exclude any other domains/bindings.. I just tried generating single-host certificates, but since all the sites on this server have the same IP:port binding with different host names, IIS doesn't let me assign different certs to each site. IIS message:\n\nAt least one other site is using the same HTTPS binding and the binding is configured with a different certificate. Are you sure that you want to reuse this HTTPS binding and reassign the other site or sites to use the new certificate?\n\nIt wants to assign one cert to all sites, so a widlcard cert may work, but I'm trying to move to separate LetsEncrypt certs, or one SAN cert excluding some host names.\nAny way to workaround this issue?. ",
    "WinnME": "I am planning on trying to develop a plugin for Windows Small Business server 2011, as the default IIS plugins don't update RDS Gateway and Exchange certificates.\nSo please don't remove plugin support at all.... ",
    "1liminal1": "Hi guys, \nI think it was just timing out, today its a different issue, ill open a new case. \nThanks . Thanks all, \nI ended up using the other non HTTP (/.well-known) that I cant remember the name of lol. This worked well with a SAN cert. \n. Yes :) \nThanks again everyone!. @WouterTinus Im still having issues with it not working, but ill open another ticket for that. \nThanks for your help :)\n. ",
    "macaba": "Perfect, thank you. I'll be able to wait for 1.9.4.. ",
    "atom0s": "Sorry for the delayed response. This appears to be a similar issue with the newer DNS stuff that was recently added. All sites are being printed out twice, and using the incorrect one causes this issue to happen. The sites are prefixed with either [DNS] or [IIS], the correct one to target is the one prefixed with [IIS]. All is working now.\nI do have one small question though, when adding more than one site, I am asked if I want to overwrite the existing task schedule event to auto renew, should I be choosing yes to this or no? I want to make sure all sites I add are being auto-renewed and not just the newest one added.. ",
    "evancamilleri": "had same issue myself!. I used the actual site ID and it worked.\nI got only the following error, why?\n[WARN] Error occured while deleting folder structure. Error: IOException {Message=\"The directory is not empty.\\r\\n\", Dat\na=[], InnerException=null, TargetSite=Void WinIOError(Int32, System.String), StackTrace=\"   at System.IO.__Error.WinIOEr\nror(Int32 errorCode, String maybeFullPath)\\r\\n   at System.IO.Directory.DeleteHelper(String fullPath, String userPath, B\noolean recursive, Boolean throwOnTopLevelDirectoryNotFound)\\r\\n   at System.IO.Directory.Delete(String fullPath, String\nuserPath, Boolean recursive, Boolean checkHost)\\r\\n   at System.IO.DirectoryInfo.Delete()\\r\\n   at LetsEncrypt.ACME.Simp\nle.IISPlugin.DeleteAuthorization(String answerPath, String token, String webRootPath, String filePath)\", HelpLink=null,\nSource=\"mscorlib\", HResult=-2147024751}\n. The error did not came again - will reply when it comes.. Thanks a lot - issue solved!. Third one, it has to do with the original site (which works correctly when not in '/.well-known' folder)\nServer Error in '/.well-known' Application.\nConfiguration Error\nDescription: An error occurred during the processing of a configuration file required to service this request. Please review the specific error details below and modify your configuration file appropriately. \nParser Error Message: Could not load file or assembly 'DevExpress.Web.ASPxTreeList.v16.2, Version=16.2.6.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a' or one of its dependencies. The system cannot find the file specified.\nSource Error: \nAn application error occurred on the server. The current custom error settings for this application prevent the details of the application error from being viewed remotely (for security reasons). It could, however, be viewed by browsers running on the local server machine.\nSource File: C:\\COMPANY\\Applications\\W5_SITE\\WEB\\WEB-root\\web.config    Line: 107 \nAssembly Load Trace: The following information can be helpful to determine why the assembly 'DevExpress.Web.ASPxTreeList.v16.2, Version=16.2.6.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a' could not be loaded.\n=== Pre-bind state information ===\nLOG: DisplayName = DevExpress.Web.ASPxTreeList.v16.2, Version=16.2.6.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a\n (Fully-specified)\nLOG: Appbase = file:///C:/COMPANY/Applications/W5_SITE/WEB/WEB-root/.well-known/\nLOG: Initial PrivatePath = C:\\COMPANY\\Applications\\W5_SITE\\WEB\\WEB-root.well-known\\bin\nCalling assembly : (Unknown).\n===\nLOG: This bind starts in default load context.\nLOG: No application configuration file found.\nLOG: Using host configuration file: C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\aspnet.config\nLOG: Using machine configuration file from C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\config\\machine.config.\nLOG: Post-policy reference: DevExpress.Web.ASPxTreeList.v16.2, Version=16.2.6.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a\nLOG: Attempting download of new URL file:///C:/Windows/Microsoft.NET/Framework64/v4.0.30319/Temporary ASP.NET Files/.well-known/cc51f2a1/24019a93/DevExpress.Web.ASPxTreeList.v16.2.DLL.\nLOG: Attempting download of new URL file:///C:/Windows/Microsoft.NET/Framework64/v4.0.30319/Temporary ASP.NET Files/.well-known/cc51f2a1/24019a93/DevExpress.Web.ASPxTreeList.v16.2/DevExpress.Web.ASPxTreeList.v16.2.DLL.\nLOG: Attempting download of new URL file:///C:/COMPANY/Applications/W5_SITE/WEB/WEB-root/.well-known/bin/DevExpress.Web.ASPxTreeList.v16.2.DLL.\nLOG: Attempting download of new URL file:///C:/COMPANY/Applications/W5_SITE/WEB/WEB-root/.well-known/bin/DevExpress.Web.ASPxTreeList.v16.2/DevExpress.Web.ASPxTreeList.v16.2.DLL.\nLOG: Attempting download of new URL file:///C:/Windows/Microsoft.NET/Framework64/v4.0.30319/Temporary ASP.NET Files/.well-known/cc51f2a1/24019a93/DevExpress.Web.ASPxTreeList.v16.2.EXE.\nLOG: Attempting download of new URL file:///C:/Windows/Microsoft.NET/Framework64/v4.0.30319/Temporary ASP.NET Files/.well-known/cc51f2a1/24019a93/DevExpress.Web.ASPxTreeList.v16.2/DevExpress.Web.ASPxTreeList.v16.2.EXE.\nLOG: Attempting download of new URL file:///C:/COMPANY/Applications/W5_SITE/WEB/WEB-root/.well-known/bin/DevExpress.Web.ASPxTreeList.v16.2.EXE.\nLOG: Attempting download of new URL file:///C:/COMPANY/Applications/W5_SITE/WEB/WEB-root/.well-known/bin/DevExpress.Web.ASPxTreeList.v16.2/DevExpress.Web.ASPxTreeList.v16.2.EXE.\nVersion Information: Microsoft .NET Framework Version:4.0.30319; ASP.NET Version:4.6.1590.0. thanks - worked with beta6\n(sorry for delay in answering). No did not revoke it myself.\nI even disabled all auto-renew batch files\nThe certificate was issued by Let's Encrypt and was working well.  It happened to me on 3 certificates till now.\nNow I revoked them completely, removed them from the Listing (L command) by cancelling renewal.  I deleted them from IIS and then re-created them - - - let's see if they get again the same problem!\nThanks for your support and great job.\n. ",
    "TheoMee": "I have the same problem with IIS ARR , I have multiple sub domains, and in the master server just binding port 80  without any domain . ",
    "alexhass": "There is nothing special needed. Only the path /.well-known to these subdomains need to be accessible from outside. It is just a text file... so you can easily test with staging system.. May I also jump in here, please and ask if DNS command line options are different?\nIn near future wildcard SSL is possible with Lets Encrypt and than we need to switch from file based to DNS. As DNS requires changes on every renew the --dnscreatescript and --dnsdeletescript  should work. Is that the case?. Sorry for asking... my understanding was that I need to update the validation token in dns server before the renew validation is executed. In this case the dns server need to be contacted and updated on every renew. Is that wrong?. For IIS Central Certificates Store the config file is the perfect place. For other use cases it may not. I personally do not random passwords yet as I use CCS, but it would be good to have the password encrypted somehow. Not sure if it really increases security if someone steals my config file.. Thanks for your quick feedback. I already wondered why you save so many domains in registry. I think a sqllite database may be better. Using a textfile or xml file may also work, but I\u2018m not sure how fast it is if you have 10.000 hostnames inside. With an sql lite you can also use select and can reduce the resultset with filters.\nAny chance we can get rid of the registry within next 15 days? Sorry, I\u2018m in a hurry and like to switch from Thawte to letsencrypt... there are certs running out and I hate the dirty solutions :-). Thanks. I was not aware that registry can be replicated. Will give it a try.. Thanks for the quick fix! I just tested it and learned some strange behaviour.\nI configured a ConfigurationPath of E:\\win-acme\\data and placed the binary files in E:\\win-acme\\bin. Than the path E:\\win-acme\\data\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org was created. I was confused why the superflous letsencrypt-win-simple directory was created. It is not a problem for me, but the documentation in the Wiki does not explain this for the migration and on the first run I just copied httpsacme-v01.api.letsencrypt.org to E:\\win-acme\\data\\httpsacme-v01.api.letsencrypt.org.\nIs this the correct and wished behaviour to have this extra folder? I just thought with the project rename that this shouldn't be there. This could be just documentation, but it could also be a bug?\nAdditionally https://github.com/PKISharp/win-acme/wiki/Application-Settings yields the same questions. A word how this path need to configured if there are automatisms like this would be beneficial, too.. That is not time critical, it is just something that need to be documented or fixed or better both. Will you reopen this case or do you need a new one?. Or make the hostname structure the new default and optionally allow the previous flat directory. Explain in the wiki why the new structure is better.. How about adding the hostname subfolder now?. As I know you keep all files forever. You never delete any older/expired/no longer used certificate files. That means we have several new files every 2 months and this is growing. That means 10 or 100 certificates can also easily grow over 60.000 over time. We have a lot more.. I was just looking for a config setting as documented to see what the job is doing without changing the job and without forcing a renew. Does it verify that all paths are accessible without a renew? Just in case there are permission issues...?. The problem is that the logging feature does not work as documented... this should be fixed. Than we do not need wonkey workarounds.\nIt would also be great if you can check the paths and if they are all accessible if this is not done yet. If a path has permission problems it need to error and stop. This should be done first as \u201einput validation\u201c.. Adding the \u2014verbose to cluster task requires changes to the cluster task. Enabeling logging does not change the task. :-) a config file change is much easier.\nI agree that a lot of things may fail during a run, but the basics like a Test-Path() is no big trick and just simple input validation... less possible failures are always better.\nThanks for confirmation that so many things can fail... that all was exactly the reason why I use a static letsencrypt webroot, do not use the iis scripts and so on. Reliability is my main concern.. I have not tested yet, but a post-renew script (such a param exists) for service reload/restarts should only run if the renew was successful. Than you do not need to look for error codes.... Typically if you sign your executable, they whitelist your for all future releases and not omly one specific file.. To configure your IIS, see https://www.hass.de/content/setup-microsoft-windows-or-iis-ssl-perfect-forward-secrecy-and-tls-12. Could you explain shortly what the change does or if it requires an additional command line param, please?. I had the chance today to test it again. I checked the Reneval file before requesting the certificates and after. 100% safe I'm running on v1.9.9.0 and this duplicates the entries in Reneval file. Both entries are the same, so the old existing entry has been updated and another one has been added. \nLooks like a bug.. Any chance to fix this issue soon? I need to correctthe reneval file once a week manually.. Tested with v1.9.12.0 and issue seems to be fixed.. How about bundeling the dlls with your product? It sounds very strange that I should download random dlls from random sources and copy they together. That is really not trustworthy.. I think a software need to be self containing. All files needed should be part of the project here. I do not like to build my own package with dependencies I have no clue of and I have much less chance to know if compatible or not. Never seen a sungle project that requires me to puzzle pieces of dlls together to get al logging function. What a crap is this?. I confused myself here. Looks like i only subscribed here. I thought it is my case where I reported a not working standard logging to a logfile. That was a different case... that should still be open.... Correct. I still do not know how to enable logging in your software. As both cases are closed without a solution or answer, should I open another case? \nI do not need 30 methods of logging - just one simple solution - verbose logging to logfile is fine.. Can you reopen #778, please?. I was not aware of this, but again I do not like to build my own package. Standard logging need to work out of the box and all files should be delivered with the software.. If I configure logging it writes files to disk or not? \nIf I need to download DLLs before this works - it does not work out of the box. This is unexpected.. ",
    "zeidmandevelopment": "Thank you for asking.\nBindings were fine. Problem existed even after removing them and reapplying to other sites on the server. \nEnded up removing IIS and components completely and then reinstalling - everything works fine now.\nSo was unable to pin point the cause and still concerned about future renewals.\n\nPrior to this we had tried everything including:  ... \n\n\"Had this happen to me now. All SSL sites (all SNI) provide the latest Let's Encrypt certificate. All settings are correct, all certs are fine, but everything's messed up. Version 1.8.8.1- Had to manually delete the IP binding that override everything with netsh http delete sslcert ipport=1.2.3.4:443 and things started working. I think the client should never add that kind of binding, since it's not even visible from IIS site management. And I would like to hear how this is a problem in IIS and not in the Let's Encrypt code.\"\n\nThis did not work for us and observed that  running the win-simple executeable had generated 99+ empty bindings for no reason.\n\nWe would like to ensure a smooth and less time consuming process in future - so any light you can shed on this would be helpful.\n. ",
    "omarzd": "OK. That works. But I would like to suggest this to be an option in the configuration file. Or a better idea is to include this link in the README under Running instead of just saying \"follow the messages in the input prompt\".. ",
    "daudhumayun": "I'm facing similar kind of issue. \nDespite specifying the new --webroot value, it keeps on processing some old webroot value and as a result, answer is not browsable at the specified webroot (the actual root) and Authorization result evaluates to be invalid. \n\nAs can be seen in the screenshot above, --webroot value is specified to be \"D:\\xampp\\htdocs\\z*k\", however if you see verbose log, .well-known is placed at \"D:\\xampp\\htdocs.well-known\"\nPlease suggest how to resolve.. > You cannot change parameters for existing certificates during a --renew. You will either have to make the change manually (by editing the renewals file) or re-create the certificate with the new webroot.\nThank you for the clarity. How do i manually edit the renewal file? Actually which file to edit? Because when i update the value of \"WebRootPath\" in \"Renewals\" file in config folder (X:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org), and after that when i run the renew command line; the value of \"WebRootPath\" reverts back to old value in \"Renewals\" file.\nPlease guide which file to edit.. >What does raise a yellow flag though is that you mention X:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org. I might be a typo, but in your screenshot it shows the program is reading from C: not X:.\nPlease consider X: as C:. That's a typo.\n\nAnother theory might be that you are changing the Renewals file while the program is running. When it's running its working from an in-memory cache that's written back to disk from time to time, so that might also explain the reversion.\n\nSo should i consider stopping the service and then update Renewals file and then run the service and renew command subsequently again? If that is so, which service to stop?\n. Any help to resolve this issue will be really appreciated.. I found one process with the name letsencrypt.exe in Task Manager. I killed it. Then updated the value of WebRootPath in Renewals file at C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org.\nAfterwards I ran renewal again and it succeeded.\nThank you for support!. ",
    "wdfstryfe": "The domain I'm trying to renew is whendarknessfalls.org .  I've been able to renew it in the past but for some reason this go around it won't let me.. I had a feeling that was the problem thank you I'll get that corrected.. ",
    "bracke": "That fixed it! Thanks for the quick response :-) . ",
    "RVCTinker": "Oh my I feel stupid.  Correct, it is missing. Long story short I had to remove what I used with the first site and when I put the software back that directory was missed... (Palm face)  Thanks for spotting it!. ",
    "tm8544": "1.9.5 first beta, problem still exists, although there is some change in output...\n\n. V1.9.5.0-beta2, error message is not displayd anymore --> closed.  --closeonfinish  makes no difference. In my case i use \u2013test for unattendant operation as well.\nI have a script to renew certificates, and if they are renewed, carry out necessary actions to restart Apache etc.\nI test this script with \u2013test switch to make certain that it runs ok before using it in production certificates,\nand I would like to see that the script runs unattendant in both cases. I understand that there may be other opinions regarding the test case.\nAs you wrote in your second email, making \u2013closeonfinish to take precedence is a good solution.\nt: Timo\nFrom: WouterTinus [mailto:notifications@github.com]\nSent: Wednesday, September 13, 2017 8:33 PM\nTo: Lone-Coder/letsencrypt-win-simple letsencrypt-win-simple@noreply.github.com\nCc: tm8544 ; Author author@noreply.github.com\nSubject: Re: [Lone-Coder/letsencrypt-win-simple] --test --renew still asks \"Would you like to start again? (y/n)\" (#559)\nThe --test switch is not meant for unattended operation. What is your use case exactly?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHubhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/559#issuecomment-329240707, or mute the threadhttps://github.com/notifications/unsubscribe-auth/AOdwvxCRN20q_jKEQqfi6zGGJSZRd_Faks5siBG2gaJpZM4PWOwp.\n. --test         Overrides --baseuri setting to https://acme-staging.api.letsencrypt.org/ and enables other testing behaviours in the program which may help with troubleshooting.\nso it does not work exactly as it does in live.\n--closeonfinish         Close the application when complete, avoiding the 'Press any key to continue' and 'Would you like to start again' messages.\nthis should override the prompts that appear in --test mode\n. Now tested with letsencrypt-win-simple.v1.9.8.0-beta8, otherwise same config as above.\n\"Authorization result: valid\" produces no more error message, but\nthere is a new error at the end of the log, see below.\nTried several runs, now the certificate fails to renew.\n[DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing (removed) using http-01 validation (FileSystem)\n [INFO] Answer should now be browsable at http://(removed)/.well-known/acme-challenge/Fcr6g1DbTSD3grBR7HB0ju3GZQr2QPYJT-A3qR6Dh4I\n [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/qnGIHmMMisAlMqYVeYlWzK7aD1MZurRBoXCf1wlXWcY/84083779\n [INFO] Authorization result: valid\n [DBUG] Deleting answer\n [DBUG] Additional files or folders exist in d:\\http-server-d.well-known, not deleting.\n [DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n [DBUG] Certificate store: My\n [WARN] Using cached certificate for (removed) 2017.12.28 3.04.30 ip.\n [DBUG] NullReferenceException: NullReferenceException {Message=\"Objektin viittaukseksi ei voi m\u00e4\u00e4ritt\u00e4\u00e4 objektiesiintym\u00e4\u00e4.\", Data=[], InnerException=null, TargetSite=LetsEncrypt.ACME.Simple.RenewResult OnRenewSuccess(Autofac.ILifetimeScope, LetsEncrypt.ACME.Simple.ScheduledRenewal), StackTrace=\"   kohteessa LetsEncrypt.ACME.Simple.Program.OnRenewSuccess(ILifetimeScope renewalScope, ScheduledRenewal renewal)\", HelpLink=null, Source=\"letsencrypt\", HResult=-2147467261}\n [EROR] NullReferenceException: Objektin viittaukseksi ei voi m\u00e4\u00e4ritt\u00e4\u00e4 objektiesiintym\u00e4\u00e4.\n [EROR] Renewal for (removed) failed, will retry on next run. Tested with letsencrypt-win-simple.v1.9.8.0-beta8.1, otherwise same config as above.\nNow log is clean from previous errors, but new certificates are not stored if previous certificate files exist in c:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\\ . If I delete all files except Registration and Signer, then new certificate files are saved.\nHere are parts of the log output. As you can see, case 1 does not save certicate, case 2 does.\nCase 1) Previous files exist\n[DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n[DBUG] Certificate store: My\n[WARN] Using cached certificate for (deleted) 2017.12.28 6.01.48 ip.\n[INFO] Installing with Run external script...\n[WARN] No script configured.\n[INFO] Renewal for (deleted) succeeded\n[INFO] Next renewal scheduled at 2018.2.21 4.01.48 ip.\nCase 2) Previous files deleted\n[DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n[DBUG] Certificate store: My\n[DBUG] RSAKeyBits: 2048\n[INFO] Requesting certificate (deleted) 2017.12.28 6.03.36 ip.\n[DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-cert\n[INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n[DBUG] Set private key exportable\n[INFO] Installing certificate in the certificate store\n[DBUG] Opened certificate store My\n[INFO] Adding certificate (deleted) 2017.12.28 6.03.36 ip. to store My\n[VERB] CN=(deleted) - CN=Fake LE Intermediate X1 (BB7F8F3A9053A5A372CD80899A4AECC682F1FA02)\n[VERB] CN=Fake LE Intermediate X1 - CN=Fake LE Root X1 (4EEE7398C1A3DAF91DA16689DB8243927A271B9A) to CA store\n[VERB] CN=Fake LE Root X1 - CN=Fake LE Root X1 (B3F73C419DAC14711F4B97192BF89C7DEA7A7794) to AuthRoot store\n[DBUG] Closing certificate stores\n[INFO] Installing with Run external script...\n[WARN] No script configured.\n[INFO] Renewal for (deleted) succeeded\n[INFO] Next renewal scheduled at 2018.2.21 4.03.41 ip.\n. I'm a bit lost here. For Apache I need updated certificate and key files.\nAs you say\n\nThe installation plugins should still run though, and it seems like they do.\n\nwhat do you mean?\nOn previous case 1, where can I find updated cert and key?\nOr should I use some script to produce them?\n . Ok. now I understand.\nI was not aware of the 24 hour limit.\nIn my test environment, I will delete .pfx file so I can see that certificate and key files are created,\nregardless whether 24 hours has passed.\nAnd regarding the original reason for this bug report, you can close it.. One more thing.\nIt might be a good idea to include your explanation of required step after validation into the Wiki.\nI think it is not mentioned there now, and without explanation it might be a bit confusing, because the 24 hour limit overrides --forcerenewal, if I understood correctly.. ",
    "fearworksmedia": "To add to the info above, I have noticed that the task in Task Scheduler also presents this same error, reproducible if I run the command line that is used for the task:\nC:\\letsencrypt-win-simple\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\nWhen I run that manually (or when Task Scheduler runs it) I get:\n\n[INFO] Let's Encrypt (Simple Windows ACME Client)\n[INFO] Version 1.9.5.38878 (RELEASE)\n[INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n[INFO] Renewal period: 60\n[INFO] Certificate store: WebHosting\n[INFO] ACME Server: https://acme-v01.api.letsencrypt.org/\n[INFO] Checking renewals\n[EROR] Exception Value cannot be null.\nParameter name: source\n\nAgain, I'm not entirely sure if I've done something silly, but even with the error message all of the certs still seem to have been installed and are working/valid.\nThanks.. I agree it looks similar - but I have not used any previous versions of the program. The version I am running (1.9.5.38878) is literally the first version I have ever used. There has never been a previous version of the software on my server. The server is only about a week old too, and I am the only person who admins it. So if it is related to previous settings, I can only guess that this version of the program is creating old and new settings both by itself.\nI hadn't realised that I could get the debug info so have just adjusted my config file and run the renewal process to generate the error again:\n\n[INFO] Renewal period: 60\n[INFO] Certificate store: WebHosting\n[INFO] ACME Server: https://acme-v01.api.letsencrypt.org/\n[DBUG] Settings {Renewals=\"The property accessor threw an exception: ArgumentNul\nlException\"}\n[DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.le\ntsencrypt.org\n[DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.a\npi.letsencrypt.org\n[DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.a\npi.letsencrypt.org\\Signer\n[DBUG] Getting AcmeServerDirectory\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n[DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme\n-v01.api.letsencrypt.org\\Registration\n[INFO] Checking renewals\n[DBUG] Exception ArgumentNullException {Message=\"Value cannot be null.\\r\\nParame\nter name: source\", ParamName=\"source\", Data=[], InnerException=null, TargetSite=\nSystem.Collections.Generic.IEnumerable1[TResult] Select[TSource,TResult](System\n.Collections.Generic.IEnumerable1[TSource], System.Func2[TSource,TResult]), St\nackTrace=\"   at System.Linq.Enumerable.Select[TSource,TResult](IEnumerable1 sou\nrce, Func`2 selector)\\r\\n   at LetsEncrypt.ACME.Simple.Settings.get_Renewals()\\r\n\\n   at LetsEncrypt.ACME.Simple.Program.CheckRenewals()\\r\\n   at LetsEncrypt.ACM\nE.Simple.Program.Main(String[] args)\", HelpLink=null, Source=\"System.Core\", HRes\nult=-2147467261}\n[EROR] Exception Value cannot be null.\nParameter name: source\n\nI think the error message looks the same as the one you (nvanrooij) got when you tried to renew.\nI wondered if the Default Web Site had any effect so I tried with it both present on the server and then removed from the server, but the results are the same.. Thanks. I have created those registry keys and I now don't get the errors I described earlier.\nPresumably this will be fixed in the next release, so it would be good to know if I can then remove the registry keys or if they need to stay (i.e. they should have been created on the first run and need to be there?).. Are you sure it's the same version? Did you definitely create the registry keys correctly?\nMake a .reg file with this code in:\nWindows Registry Editor Version 5.00\n[HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/]\n\"Renewals\"=hex(7):00,00\nand run it to add it to the registry, then try running letsencrypt-win-simple again and see if you still have a problem. It cured the error for me, but you haven't posted your error message so can't say for definite if it's the same as I was getting.. Sounds like you've implemented the fix correctly now. Shame you've hit your rate limit! Perhaps you have another domain you can try with for now?\nI'd still like to know if we have to keep those registry keys in place once the bug is fixed, or if they can be removed once this is fixed? I imagine @WouterTinus will be able to tell us this once its fixed :). Wonderful! Thanks for your time spent on this! \ud83e\udd47 . Hmmm, I can't say this behaviour is what I've been experiencing with #539 as running both with and without the --san switch gives me the error I described there. Here, there doesn't seem to be an error message shown but I'm definitely getting an error message then no sites listed. It corrects itself when I remove the FTP site from IIS and reappears if I put the FTP site back in.. Of course it could be something more specific than I just have an FTP site on the server - maybe it's something specific to the way I have the FTP site set up, I don't know. If you need me to send you the exact configuration I can do.. Looks good! I can see all my sites listed now and I don't have to keep removing the FTP site anymore :)\nThanks \ud83d\udc4d . I also find this resource useful for building a CAA record:\nhttps://sslmate.com/caa/. Well even if there was an additional config option that could be used to specify whether certificates are named after the site ID or the certificate's common name, and leave it to the user to choose.\nAlternatively, showing the names dynamically would work I guess...\nI just don't think that defaulting to names like \"Site-13 2019/2/15 3:43:13\" is really helpful to anyone, whereas naming them with the common name makes sense... to me at least :)\n. I think that would work well, and adding the prefix is extra information that will be useful for quick reference. So for the dynamic IISSite name, what would be shown? Would it be something like this:\nIIS site with bindings: www.example.com, example.com\nFriendlyName: [IISSite] www.example.com\nThanks for giving this some attention, btw!\nKeith.. That makes sense :). Yes, I understand. I'd be in the \"fewest keystrokes but still knowing what I'm going to get\" corner :)\nI agree that the choice does not need presenting when there is only one domain binding, but to be asked which one you want as the common name where there are multiple domains does also make sense. Could the C Cancel option be removed and instead be like the choice that comes before it, where if you aren't excluding any domains you just press enter to continue? So, instead of a C option, the user is told to just press enter if they don't care and want the default choice choosing for them?\nThanks again.\nKeith.. ",
    "jackfagner": "You can \"fix\" this error by creating a new registry key Renewals (Multi String value, REG_MULTI_SZ) in key\nHKEY_LOCAL_MACHINE\\SOFTWARE\\WOW6432Node\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\nYou probably need to create the keys letsencrypt-win-simple and https://acme-v01.api.letsencrypt.org/ within WOW6432Node first.. ",
    "JRichmond27": "I'm having the exact same issue with the same version and same brand new server, but creating the registry key did not work for me. Still got the same null value error.\nUnfortunately it also sounds like I'll have to wait a week to try any other solutions since I have run into some sort of request limit...\n\n[EROR] ACME Server Returned: Unexpected error - Response: {\n  \"type\": \"urn:acme:error:rateLimited\",\n  \"detail\": \"Error creating new cert :: too many certificates already issued for exact set of domains: XXXX\",\n  \"status\": 429\n}`. Yep, exact same version (1.9.5.38878) and same error message: \"Exception Value cannot be null. Parameter name: source\" The rest of the message is lost unless the logs are saved to disk somewhere.\n\nI checked the registry keys again, and it looks like I missed the trailing slash on the URL. I triple checked everything I typed, but apparently still missed that slash.  :(\nI'm guessing that was the problem, but now I have to wait a week for them to allow me to try again. I'll post an update at that time.\n. I just tried a couple other domains on another Win 2012 server after applying the registry keys, and it worked flawlessly. Thanks!\nBased on other threads I've seen, it sounds like the registry key is required for now, but the plan is to stop using the registry completely for version 2.0.. @marcverkade did you hand type in the keys, or did you use the .reg code that fearworksmedia provided above?\nMine originally didn't work because I missed the trailing slash on one of the keys, even though I checked and re-checked my work several times. His .reg code worked on multiple servers for me.. ",
    "billsey": "Thanks, this work around worked for me as well.. Looks like I have the same issue with 1.9.4. I pulled 1.9.4.37651 down and when I run it without any parameters it shows the two IIS site URLs (both listed as SiteId 1). When I run it with the --san switch they don't show up.\n`PS C:\\letsencrypt-win-simple> .\\LetsEncrypt.exe\n[INFO] Let's Encrypt (Simple Windows ACME Client)\n[INFO] version 1.9.4.37651 (RELEASE)\n[INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n[INFO] Renewal period: 60\n[INFO] Certificate store: WebHosting\n[INFO] ACME Server: https://acme-v01.api.letsencrypt.org/\n1: [IIS] tower.{domain1} (SiteId 1) [@ C:\\Program Files\\Windows Server\\Bin\\WebApps\\Site]\n 2: [IIS] tower.{domain2} (SiteId 1) [@ C:\\Program Files\\Windows Server\\Bin\\WebApps\\Site]\nW: Generate a certificate via WebDav and install it manually.\n F: Generate a certificate via FTP/ FTPS and install it manually.\n M: Generate a certificate manually.\n Q: Quit\nChoose from one of the menu options above:`\n`PS C:\\letsencrypt-win-simple> .\\LetsEncrypt.exe --san\n[INFO] Let's Encrypt (Simple Windows ACME Client)\n[INFO] version 1.9.4.37651 (RELEASE)\n[INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n[INFO] Renewal period: 60\n[INFO] Certificate store: WebHosting\n[INFO] ACME Server: https://acme-v01.api.letsencrypt.org/\nW: Generate a certificate via WebDav and install it manually.\n S: Generate a single San certificate for multiple sites.\n F: Generate a certificate via FTP/ FTPS and install it manually.\n M: Generate a certificate manually.\n Q: Quit\nChoose from one of the menu options above:`. No FTP sites on the server though.... It looks like I can now see things correctly when running with the --san switch, so I agree.. ",
    "marcverkade": "Same here... Registry key add does not work, no clue why but I'll await the next beta..\nThanx for the great work!. Hai Jeff,\nI copied and pasted the code of the site in a .reg file and after I imported that file, it created the extra registry node, but one level too high.\n[cid:3336ac7f-b01c-44e3-8a22-0bddfa209a5d]\nI created the reg-key manually and then it worked.\nThanx for your concern.\nregards, Marc\n\nVan: Jeff Richmond notifications@github.com\nVerzonden: maandag 11 september 2017 16:43\nAan: Lone-Coder/letsencrypt-win-simple\nCC: marcverkade; Mention\nOnderwerp: Re: [Lone-Coder/letsencrypt-win-simple] Error: Exception value cannot be null with new beta (1.9.5.0) (#532)\n@marcverkadehttps://github.com/marcverkade did you hand type in the keys, or did you use the .reg code that fearworksmedia provided abovehttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/532#issuecomment-326778347?\nMine originally didn't work because I missed the trailing slash on one of the keys, even though I checked and re-checked my work several times. His .reg code worked on multiple servers for me.\n\u2014\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHubhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/532#issuecomment-328587813, or mute the threadhttps://github.com/notifications/unsubscribe-auth/AG3Eeu-_oVBRhrnKVnDxGNbGaeW-Dhodks5shWNDgaJpZM4PD9el.\n. ",
    "Pitapam": "Hello,\nI'm French, Sorry for the Bad English.\nI have the same problem on a Windows Server 2012 R2 (VPS OVH)\nI have a running Webservice in http (80). The webservice is started and functional from the web.\nWhen I execute Let's Encrypt-Win-Simple-V1.9.5-Beta-1, for the first time, it ask me a mail (\"Enter an email adress ...\") , and valid by Yes the conditions (\"Do you agree to https://let....\"), and after that, I have this message : \n\"\n[EROR] Exception L'identificateur d'objet ne repr\u00e9sente pas un objet valide. (Exception de HRESULT : 0x800710D8)\nWould you like to start again? (y/n) : \n\"\nAfter the first time I use the tool, I have directly the same message (after the message for present the tool (\"[INFO] Let's ..... ACME Server: https://acme-v01.api.letsencypt.org/\")\nI don't understand, I searched on the web for resolve it, but no way. I searched during two full days.\nI had tried the V1.9.4.2 too, and I had the choise menu (\"Webdav,..., Manual\"), but my website isn't on the list (there is no message but my site is not listed)\nI had verified the binding (Host name = \"localhost\"), and I had tried others Host name, no way too.\nDo you have an idea for resolve this ? Do you think it's a Bug or a bad server config ?\nThank you in advance for try to help me.. Capture of the problem : \nFirst use of the tool : \n\nOthers use\n\n. I used the V.1.9.3. In it, My Website is listed : \n\nAnd after change the Host name by a real dns (xxx.net) ...\n... It Works !!!!\nI Have my httpS !!!. ",
    "lanceosaurus": "I just added the record today incase the letsencrypt.org validator needed it to gracefully fail.  I tried to create a cert a bunch of times yesterday before I added the record.  But I'll remove it now if you think that is best.. Is there a way to trigger the manual dns validation with this tool?. I added it in desperation to get the validator to work!  I tried it many times without.  Enough failures to get hit with the ban hammer.\nAgain, I can put the url in a browser and view the file from anywhere on the planet, but the validation service still fails.. The server is in China, if that makes a difference.  I've used letsencrypt-win-simple on a few other non-Chinese servers successfully, so I know what's supposed to happen when it works successfully.. To be clear: I added the AAAA record today after trying multiple times yesterday to get a certificate.  Adding the AAAA record has NOT caused this issue...  it may have introduced a different one, but the end result is the same - verification fails.\nHere's the latest verification file: http://mergeDOTwebportglobalDOTcn/.well-known/acme-challenge/2EPm_Uv9OdignbAVIIv9qm-SNq0bFTGpOYGtTvWQElc - Its on the Chinese server and I can access this from Europe or anywhere else.  However, the validation still fails.\nHere are the results of the latest run: \nC:\\Users\\Lance>C:_scripts\\letsencrypt-win-simple.V1.9.3\\letsencrypt.exe --test\nThe global logger has been configured\nLet's Encrypt (Simple Windows ACME Client)\nRenewal Period: 3650\nCertificate Store: WebHosting\nACME Server: https://acme-staging.api.letsencrypt.org/\nConfig Folder: C:\\Users\\Lance\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\nCertificate Folder: C:\\Users\\Lance\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\nLoading Signer from C:\\Users\\Lance\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\\Signer\nGetting AcmeServerDirectory\nLoading Registration from C:\\Users\\Lance\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\\Registration\nScanning IIS Site Bindings for Hosts\n 1: IIS demoDOTwebportglobalDOTcn (C:_websites\\demoDOTwebportglobalDOTcn)\n 2: IIS mergeDOTwebportglobalDOTcn (C:_websites\\emptysite)\n 3: IIS wwwDOTwebportglobalDOTcn (C:_websites\\wwwDOTwebportglobalDOTcn)\nW: Generate a certificate via WebDav and install it manually.\n F: Generate a certificate via FTP/ FTPS and install it manually.\n M: Generate a certificate manually.\n A: Get certificates for all hosts\n Q: Quit\nChoose from one of the menu options above: 2\nAuthorizing Identifier mergeDOTwebportglobalDOTcn Using Challenge Type http-01\nWriting challenge answer to C:_websites\\emptysite.well-known/acme-challenge/2EPm_Uv9OdignbAVIIv9qm-SNq0bFTGpOYGtTvWQElc\nWriting web.config to add extensionless mime type to C:_websites\\emptysite.well-known\\acme-challenge\\web.config\nAnswer should now be browsable at http://mergeDOTwebportglobalDOTcn/.well-known/acme-challenge/2EPm_Uv9OdignbAVIIv9qm-SNq0bFTGpOYGtTvWQElc\nSubmitting answer\nRefreshing authorization\nRefreshing authorization\nRefreshing authorization\nRefreshing authorization\nRefreshing authorization\nRefreshing authorization\nRefreshing authorization\nRefreshing authorization\nAuthorization Result: invalid\nAuthorization Failed invalid\n\nThe ACME server was probably unable to reach http://mergeDOTwebportglobalDOTcn/.well-known/acme-challenge/2EPm_Uv9OdignbAVIIv9qm-SNq0bFTGpOYGtTvWQElc\nCheck in a browser to see if the answer file is being served correctly.\nAuthorize failed: This could be caused by IIS not being setup to handle extensionless static files.Here's how to fix that:\n1.In IIS manager goto Site/ Server->Handler Mappings->View Ordered List\n2.Move the StaticFile mapping above the ExtensionlessUrlHandler mappings. (like this http://i.stack.imgur.com/nkvrL.png)\n3.If you need to make changes to your web.config file, update the one at C:_scripts\\letsencrypt-win-simple.V1.9.3\\web_config.xml\n\nPress enter to continue.\n. @rdebath - sorry, I subbed a different domain name for privacy, shoulda used something like foobar to make it more obvious/mentioned the domain was changed to protect the names of the innocent - the actual domain name is mergeDOTwebportglobalDOTcn.  (but replace the DOTs). The firewall we have control over has port 80 open to the world, so I doubt that is an issue, unless LE is trying to use some other port?\nI can ping those addresses from the China server:\nC:\\Users\\Lance>ping outbound1.letsencrypt.org\nPinging outbound1.letsencrypt.org [66.133.109.36] with 32 bytes of data:\nReply from 66.133.109.36: bytes=32 time=232ms TTL=235\nReply from 66.133.109.36: bytes=32 time=240ms TTL=235\nReply from 66.133.109.36: bytes=32 time=243ms TTL=235\nReply from 66.133.109.36: bytes=32 time=251ms TTL=235\nPing statistics for 66.133.109.36:\n    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),\nApproximate round trip times in milli-seconds:\n    Minimum = 232ms, Maximum = 251ms, Average = 241ms. #1 - the file is created and accessible instantly.  While it's going through the loop 'Refreshing authorization', I can grab the link and browse to the file.\n2 - I just tried --warmup, but come up with the same result - failed.. FYI - I've opened this issue up on the LE forum too: https://community.letsencrypt.org/t/failed-authorization-on-windows-using-letsencrypt-win-simple/41404. @rdebath - I don't have a --verbose flag offered on v.1.9.3...\n...Just downloaded the HEAD from the repo.  --verbose now available!  Thanks!\nACME server reported detail DNS problem: query timed out looking up CAA for {my domain} \nWe use DNSPod.com as our DNS service.  Is there some config change I can do to my DNS records to get the CAA request to work?. Thanks @rdebath !  I've sent a message to Dnspod's support about how to add a CAA record.  It seems that this option is not yet widely supported, there are a lot of complaints on various DNS providers' forums asking them to support this standard.. Thanks @rdebath!  I took advice on the LE forum and changed my DNS provider to a free Cloudflare service.  Just created the certificate today, first time!  Woot!. ",
    "claudio10": "Isn't it safe to simply edit the contacts field in the registration file generated by win simple letsencrypt in the configuration folder and create a new certificate?. ",
    "dvgamerr": "it work, thanks.. ",
    "jawakharlal": "@WouterTinus i register it  1.5 hours ago. sorry man, i do it . ",
    "goldfingyr": "Noobs - huh? :-)\nOK didn't see that. However you gave me the search criteria to go with: \"extentionless\" and it turns out that someone you might know already had an answer for this https://github.com/ebekker/ACMESharp/issues/15 So I followed those instructions: \n\nGoto Site/Server->Mime Types\nAdd a mime type of .* (application/octet-stream)\nand that solved the connection issue.\n\nNow the next one is:\n Do you want to specify the user the task will run as? (y/n): - yes\nEnter the username (Domain\\username): myDomain\\administrator\nEnter the user's password: NahNotGonnaGiveThatAway\n[EROR] Exception Value cannot be null.\nParameter name: source\nWould you like to start again? (y/n): - no\nAny Idea what that could be if it is an issue at all ???. ",
    "raymov": "Found a temporary workaround:\nCheck status:\nhttps://stackoverflow.com/questions/14275397/check-if-configuration-section-is-locked-iis-7/29813610#29813610\n```\nPS> Get-WebConfigurationLock -PSPath \"IIS:\\\" -Filter //system.webServer/handlers\nLockType                      Value                         PSPath                        Location\n--------                      -----                         ------                        --------\noverrideMode                  Deny                          MACHINE/WEBROOT/APPHOST\nUnlock:\nhttps://stackoverflow.com/questions/9794985/iis-this-configuration-section-cannot-be-used-at-this-path-configuration-lock/13752745#13752745\n%windir%\\system32\\inetsrv\\appcmd.exe unlock config -section:system.webServer/handlers\nUnlocked section \"system.webServer/handlers\" at configuration path \"MACHINE/WEBROOT/APPHOST\".\n```\nAlternatively: Unlock using IIS Manager (GUI)\nhttps://stackoverflow.com/questions/34199976/iis-config-error-this-configuration-section-cannot-be-used-at-this-path/35332431#35332431\nMore info:\nhttps://blogs.iis.net/webtopics/troubleshooting-http-500-19-errors-in-iis-7  (Scenario 7). ",
    "DanSmith888": "Finding this in beta3 made my night... and saved a bunch of work. Can confirm it is fixed for me. Thanks.. ",
    "Timo-Breumelhof": "We have the same issue using 01.09.04\nThe certificate did not renew, although it expired yesterday.\nI now renewed it manually so I cannot run the suggested letsencrypt.exe --forcerenewal --verbose? any more.. Ok, I checked the registry and it was empty (setup in 01.09.02). I forced a new registration and now the registry is filled, so I guess the schedular will have something to renew now... I ran the executable manually and selected the sites id to create a new certificate (and registry keys). \nBut after looking into this further I think we had a different problem from yours. \nFor security reasons we switched the user we used to run the scheduled tasks and AFAIK, the registry keys were (in 01.09.02) stored in the user tree in the registry. So switching the user made that none were found and we had to re-create them.. AFAIK it's not sent. . ",
    "CarlosBustos1": "Yes, I tried to run as administrator.. You were in the right direction. IIS was not installed. After installing it, the error disappeared. Thanks. ",
    "ryannewington": "I've just run into this same issue. If you add the key to HKLM\\Software\\Wow6432Node\\letsencrypt-win-simple it works.\nBinary might be compiled as x86 instead of anycpu?. Champion! Works great.. ",
    "professorpaddle": "Odd because it worked for a couple of months then stopped. I never changed the records during that time.. ",
    "roelvs": "just a follow-up: the problem @wstaelens faced was caused by a (faulty?) secure dns setup at the DNS-provider side. Disabling secure dns fixed the problem immediately.  \n(The DNS-provider is investigating this issue..). ",
    "michaelkhalsa": "I am having the  same problem for a new site using Azure DNS, \nno AAAA records, propagated a couple days ago. \nWindows 2016 server using IIS on an Azure VM\nI have generated letsencrypt certs for other sites on the same VM on azure no problem.\nAlso there is not any bad bindings (none for https)\nThe only difference is that this one does not yet have an MX record for mail.\nit is using SNI, just like the other sites that were successful.\nAny Suggestions, greatly appreciated.\nwww.alohaturmeric.com is the site url.\nThanks\nGot it sorted. I forgot to include a www record\nworks great, thanks for this super product.. ",
    "Foxtrek64": "Slightly off-topic, but I strongly recommend picking one and having the other redirect. You can read why and how on the admittedly (strongly) biased www.yes-www.org/redirection. Whichever way you go (with or without), it'll save you a big headache both now and further down the road. I personally use the www host for all of my sites, but at the end of the day it's personal preference.. ",
    "Benoire": "Thanks Wouter,\nI've set up Central SSL but it might be the rest of the web farm stuff which is missing... Will fully follow that process and setup shared storage etc. for all the IIS/Exchange servers and see how I get on!\nI presume another way, not using the Central SSL storage, would be to run a PS script that directly imports the cert in to each exchange server and then activates them, followed by an IIS restart on each server; this would be run using the script command as a cli toggle.. ",
    "myspace-nu": "@WouterTinus  I completely agree the approach is a bit controversial especially with the nature of the program itself. However, since the setting only affects the program itself while it is only communicates with a fixed endpoint the only thing that could possibly be seen as a security risk is if the system is a victim of DNS hijacking. Then again the setting is default off, so you would need to be aware of it to use it. But, yes, I see your point.\n@rdebath The system is running WU just fine. But it doesn't seem to want to update root certs.\nIn short, his was the only way for me to get it to run on the system in question.. Hmmz. I installed the cert as per https://www.sslshopper.com/article-installing-an-ssl-certificate-in-windows-server-2008-iis-7.0.html as a Intermediate CA. But still no luck. Will dig into it more tomorrow.. Ohh, I don't even get that far. I get:\n[EROR] Exception The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel.\nat Program.cs:line 91. > Woah, that sounds like you're getting an error when you attempt to connect to the API\n@rdebath I know :) But instead of plowing through miles and miles of Microsoft documentation it took me 2 minutes to add the setting since I trust the Let's Encrypt CA and I know I'm not victim of DNS hijacking. So I thought I'd share the \"solution\" if there are others suffering from the same issue. But I fully understand if you're hesitant to accept the pull request.. @WouterTinus It looked very promising, but unfortunately it didn't make a difference.. I ended up making a fresh windows installation and now everything is working flawlessly. Thanks for the suggestions anyway!. ",
    "leon42": "I have a similar configuration. I have separate IIS websites for SSL (443) and non-SSL (80). The non-SSL website just points to a dummy folder that contains nothing but a default page that redirects to the https domain.\nFor renewals, the ACME challenge needs to use the non-SSL site, but LEWS needs to install the certificate in the SSL site.\nI noticed in the Registry settings, each renewal entry has a bunch of settings, such as the renewal date, Site ID, etc. One simple solution might be to add an additional renewal setting that specifies the Site ID to use for the ACME challenge if it differs from the site with the certificate.. Yes, URLRewrite is the better way of doing that as long as your sites always have a web.config file. I have some sites that are updated by users who I don't trust not to overwrite that file or delete it, especially when they are not using asp.net.\nFor the cases when URLRewrite will work, it would be nice if LEWS had an option to automatically add the SSL redirect rule (along with the exception for \".well-known/acme-challenge\") when the cert is first installed.. ",
    "rangercej": "I don't think tls-sni-01 scheme supports client certificates - otherwise I'd have used this from the start: I can't see any options for it on any client, unless I've missed it?\nDNS changes unfortunately have to go through our corporate process, so there's no API available to do dyndns changes to automate this.\nThere's an arguable bug here - if letsencrypt-win-simple is using the http-01 scheme, it should use the port 80 bindings in IIS to do perform the challenge/response: the client currently assumes that both the http and https website are bound to the same website, which may not always be the case (there may be folk that have split them, but for reasons other than mutual TLS).. ",
    "robjarsen": "See issue #203. The http-01 challenge can only be performed over port 80 via HTTP.. ",
    "brgrz": "After further tests this seems to always happen at binding that comes number 8 in turn. The code for some reason removes single forward slash between the domain and \".well-known\".\nFetching http://www.some-domain.well-known. Ok after even further tests this seems to consistantly happens with domain that have a hyphen (-) in them. Happens with either single or multiple sites/bindings installs.. This was due to the DNS setting - our DNS provider has the ability to do DNS redirects via the Url record and this was in place on the affected domains. Closing.. ",
    "TimSirmovics": "1.9.3.0\nI will update to the latest version and see how that goes.. I have updated to 1.9.6.0\nThe task now runs instead of hanging, however the following message gets logged to the Event Viewer:\nException \"User input 'Enter an email address (not public, used for renewal fail notices)' should not be needed in --renew mode.\". Ok, am I able to do a fresh install, or migrate to the new storage method, if I have already set up a few sites with LEWS?. Yes, I have been using the same user account to run the Task from the beginning.\nI performed the maintenance steps as per the guide, however when I ran the task I still get the error.. Here is the output from letsencrypt.exe --verbose:\n```\n [INFO] Let's Encrypt (Simple Windows ACME Client)\n [INFO] Version 1.9.6.16084 (RELEASE)\n [VERB] Verbose mode logging enabled\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n[INFO] Renewal period: 60\n [INFO] Certificate store: Personal\n [INFO] ACME Server: https://acme-v01.api.letsencrypt.org/\n [VERB] Using registry key HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\n [DBUG] Scanning IIS site bindings for hosts\n [DBUG] Scanning IIS site bindings for hosts\n [DBUG] Scanning IIS site bindings for hosts\n [DBUG] Scanning IIS sites\n [DBUG] Scanning IIS site bindings for hosts\n [DBUG] Settings {Renewals=[ScheduledRenewal {Date=11/25/2017 22:06:41, Binding=Target {Host=\"host_removed\", HostIsDns=True, Hidden=null, WebRootPath=\"path_removed\", SiteId=4, ExcludeBindings=null, AlternativeNames=[], PluginName=\"IIS\", Plugin=IISPlugin {Name=\"IIS\", ChallengeType=\"http-01\", MenuOption=\"\", Description=\"\"}}, CentralSsl=null, San=False, KeepExisting=\"False\", Script=null, ScriptParameters=null, Warmup=False}, ScheduledRenewal {Date=11/24/2017 04:26:45, Binding=Target {Host=\"host_removed\", HostIsDns=True, Hidden=null, WebRootPath=\"path_removed\", SiteId=5, ExcludeBindings=null, AlternativeNames=[], PluginName=\"IIS\", Plugin=IISPlugin {Name=\"IIS\", ChallengeType=\"http-01\", MenuOption=\"\", Description=\"\"}}, CentralSsl=null, San=False, KeepExisting=\"False\", Script=null, ScriptParameters=null, Warmup=False}, ScheduledRenewal {Date=11/24/2017 21:54:46, Binding=Target {Host=\"host_removed\", HostIsDns=True, Hidden=null, WebRootPath=\"path_removed\", SiteId=1, ExcludeBindings=null, AlternativeNames=[], PluginName=\"IIS\", Plugin=IISPlugin {Name=\"IIS\", ChallengeType=\"http-01\", MenuOption=\"\", Description=\"\"}}, CentralSsl=null, San=False, KeepExisting=\"False\", Script=null, ScriptParameters=null, Warmup=False}, ScheduledRenewal {Date=11/26/2017 03:25:10, Binding=Target {Host=\"host_removed\", HostIsDns=False, Hidden=False, WebRootPath=\"path_removed\", SiteId=2, ExcludeBindings=\"\", AlternativeNames=[\"name_removed\", \"name_removed\"], PluginName=\"IIS\", Plugin=IISPlugin {Name=\"IIS\", ChallengeType=\"http-01\", MenuOption=\"\", Description=\"\"}}, CentralSsl=null, San=null, KeepExisting=\"False\", Script=null, ScriptParameters=null, Warmup=False}, ScheduledRenewal {Date=11/26/2017 03:38:44, Binding=Target {Host=\"host_removed\", HostIsDns=True, Hidden=False, WebRootPath=\"path_removed\", SiteId=8, ExcludeBindings=null, AlternativeNames=[], PluginName=\"IIS\", Plugin=IISPlugin {Name=\"IIS\", ChallengeType=\"http-01\", MenuOption=\"\", Description=\"\"}}, CentralSsl=null, San=null, KeepExisting=\"False\", Script=null, ScriptParameters=null, Warmup=False}]}\n [DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\nN: Create new certificate\n W: [Legacy] Generate a certificate via WebDav and install it manually.\n F: [Legacy] Generate a certificate via FTP/ FTPS and install it manually.\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew forced\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu:\n```\nI figured you might want the output from letsencrypt.exe --verbose --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\", however as this spawns a new console window I wasn't sure how to capture the output. I did take a screenshot of the output, but there didn't look to be much of interest.. Correct, the error only happens with the scheduled task.\nBoth my testing and the scheduled task use the same executable: C:\\Program Files\\Let's Encrypt\\letsencrypt.exe\nScheduled Task command line is C:\\Program Files\\Let's Encrypt\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\nThe user account that I am manually running the command with, is my own user account.\nThe user account specified for the scheduled tasks is another admin account.. The admin account did have the following folder: C:\\Users\\_adminusername_\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org however the folder was empty. I deleted it anyway and re-ran the task but got the same error logged.\nAs this seems to be an incorrect config file issue I ran Process Monitor to look for any paths ending with .config accessed by letsencrypt.exe. I noticed that it also looked inside the Default user profile, where I found a similiar empty folder. I deleted this one, re-ran the task, and finally the error is no longer logged!\nSo it looks like it's running ok - i've added the --emailaddress parameter to the task to get any failure emails, is there any way I can check that it is running correctly before the next expected renewal (about a month away)?. ",
    "magoralczyk": "Well, if I could create certs for these sites directly, I would not ask, but the acme protocol needs access to port 80 or 443 and those I have only once. The other sites are bound to other ports. So I have one dummy acme site just for cert renewal and then the real sites, where I have to select the cert manually. This is way easyer with apache or nginx, because there I can overwrite the cert and restart the server.  I am hoping, somebody has the same problem, and maybe there is an easy scriptable solution, because such processes, that only work with manual interferance are a big hastle.... ",
    "mountaindude": "Ahhh - amazing!\nAnd thanks for super quick reply.. ",
    "kdovale": "Basically they implemented it on solidcp but the bindings need to be set to * to work, else the script is run via powershell and it seems it freezes at that point where it asks for the confirmation, and then times out, so it prevents us from using static ips assigned to the websites. Is there a way to override the confirmations somehow\nFrom: WouterTinus [mailto:notifications@github.com] \nSent: Saturday, October 7, 2017 11:54 AM\nTo: Lone-Coder/letsencrypt-win-simple letsencrypt-win-simple@noreply.github.com\nCc: kdovale keith@hostworx.co.za; Author author@noreply.github.com\nSubject: Re: [Lone-Coder/letsencrypt-win-simple] ip binding issue (#591)\nI'm not sure if that whole big warning screen is still needed, given the changes to the way bindings are created/updated, but I haven't gotten around to testing if that's true.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub https://github.com/Lone-Coder/letsencrypt-win-simple/issues/591#issuecomment-334923825 , or mute the thread https://github.com/notifications/unsubscribe-auth/AG9DThATjRZc-cOteGzz6qXPTiqdZRS_ks5sp0pSgaJpZM4PwpT5 .  https://github.com/notifications/beacon/AG9DTt0tD9d33jiaKQwyi8a5grGbN6QKks5sp0pSgaJpZM4PwpT5.gif \n\nThis email has been checked for viruses by Avast antivirus software.\nhttps://www.avast.com/antivirus\n. Hi,\nUnderstandable. If I manually run it and accept it applys the certs correctly, but I hear your concern. Obviously we are using SNI on 2016  but there might be ppl using 2008r2 or similar then there is an issue.\nI was under the impression that SNI wouldn\u2019t be an issue, so maybe check for SNI and allow it only then once the parameter was applied. \nFrom: WouterTinus [mailto:notifications@github.com] \nSent: Saturday, October 7, 2017 2:50 PM\nTo: Lone-Coder/letsencrypt-win-simple letsencrypt-win-simple@noreply.github.com\nCc: kdovale keith@hostworx.co.za; Author author@noreply.github.com\nSubject: Re: [Lone-Coder/letsencrypt-win-simple] Unattended mode doesn't work when IP-specific HTTP bindings are present (#591)\nYes. it's possible to detect running in unattended mode and not ask the question, but what should be the behaviour then?\nDefaulting to the 'safe' choice wouldn't help in your case, and all the bad stuff that this warning is about doesn't make me feel confident to default to unsafe choice. That's why I'd like to do some testing first.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub https://github.com/Lone-Coder/letsencrypt-win-simple/issues/591#issuecomment-334932974 , or mute the thread https://github.com/notifications/unsubscribe-auth/AG9DTp69PG1LIb8KcpFrVx-XpuWtcC_Vks5sp3N_gaJpZM4PwpT5 .  https://github.com/notifications/beacon/AG9DTg0dQMz_as4HNYSiUvt2C8PuUwj9ks5sp3N_gaJpZM4PwpT5.gif \n\nThis email has been checked for viruses by Avast antivirus software.\nhttps://www.avast.com/antivirus\n. ",
    "leenen": "Hi Wouter,\nThanks for your very quick response.\nRe. 1: no, there are no registry keys whatsoever regarding letsencrypt. Could that be a problem with authorization (I ran letsencrypt as administrator)?\nRe. 3: Sorry for this misleading info. As the date suggests (July 10, 2017) these are the original files for the certificate (which is no longer valid).\nRe. 4: So this means that the exception must be solved first. Is there anything I can do to assist in this?\n. The first run of -the old version- LEWS (the one resulting in a valid certificate) was with the --notaskscheduler option, so no scheduled task was created then. Does that also imply that there is no record of the request made in the registry at all?\nAs for pt. 2: I ran procmon to capture activities and could attach the results in native (PML) format, but the file is rather big (24Mb). Is that a problem?\n. Link to file on GoogleDrive has been sent.\n. Looks great, thanks! Awaiting beta2 .... Beta2 tested with the following results:\nD:\\letsencrypt-win-simple>LetsEncrypt --plugin Manual --manualhost certitude.tk\n--webroot \"D:\\Xampp\\htdocs\" --accepttos --emailaddress john.leenen@certitude.eu\n--warmup --closeonfinish --verbose\n [DBUG] Config folder: C:\\Users\\Leenen\\AppData\\Roaming\\letsencrypt-win-simple\\ht\ntpsacme-v01.api.letsencrypt.org\n [VERB] Using registry key HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\ht\ntps://acme-v01.api.letsencrypt.org/\n [VERB] Settings Settings {}\n [DBUG] Loading signer from C:\\Users\\Leenen\\AppData\\Roaming\\letsencrypt-win-simp\nle\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\Users\\Leenen\\AppData\\Roaming\\letsencrypt-wi\nn-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\n [DBUG] Certificate folder: C:\\Users\\Leenen\\AppData\\Roaming\\letsencrypt-win-simp\nle\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Certificate store: WebHosting\n [DBUG] Renewal period: 60\n[INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Version 1.9.7.13786 (RELEASE)\n [INFO] ACME Server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-si\nmple\n [VERB] Verbose mode logging enabled\n [INFO] Running in unattended mode.\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[INFO] Authorizing certitude.tk using http-01 validation (FileSystem)\n [INFO] Answer should now be browsable at http://certitude.tk/.well-known/acme-c\nhallenge/AWIpsk-tq0dFc2qMGkJIAZzGBgkjOjn03Vyf6UxNlKY\n [INFO] Waiting for site to warmup...\n [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge\n/4zZTxAaP9tn0Oi1S08pdH6rkg8rerqa1-c1qsWJbt90/2152094833\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/4zZT\nxAaP9tn0Oi1S08pdH6rkg8rerqa1-c1qsWJbt90\n [INFO] Authorization result: valid\n [DBUG] Deleting answer\n [DBUG] Additional files or folders exist in D:\\Xampp\\htdocs.well-known\\acme-ch\nallenge, not deleting.\n [DBUG] RSAKeyBits: 2048\n [INFO] Requesting certificate certitude.tk 2017-10-12 10:03:43\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n [INFO] Saving certificate to C:\\Users\\Leenen\\AppData\\Roaming\\letsencrypt-win-si\nmple\\httpsacme-v01.api.letsencrypt.org\\certitude.tk-crt.der\n [DBUG] Set private key exportable\n [INFO] Installing certificate in the certificate store\n [EROR] Error encountered while opening certificate store. Error: CryptographicE\nxception {Message=\"The system cannot find the file specified.\\r\\n\", Data=[], Inn\nerException=null, TargetSite=Void Open(System.Security.Cryptography.X509Certific\nates.OpenFlags), StackTrace=\"   at System.Security.Cryptography.X509Certificates\n.X509Store.Open(OpenFlags flags)\\r\\n   at LetsEncrypt.ACME.Simple.Services.Certi\nficateStoreService.InstallCertificate(X509Certificate2 certificate, X509Store st\nore)\", HelpLink=null, Source=\"System\", HResult=-2147024894}\n [EROR] Create certificate [Manual] [1 binding - certitude.tk @ D:\\Xampp\\htdocs]\n failed: The system cannot find the file specified.\nProblem here seems to be the certificate store used. What should be the name of the store in the config file (apparently not WebHosting as defined by default.. I already changed the storename to Personal, but haven't tried to rerun LetsEncrypt as the certificate generated is valid and gives no further issues.. Seems OK now, except there's still no scheduled task generated for renewal and no registration in registry at all.\nIs there a difference between renewal and a rerun with all parameters specified again?. ",
    "Liga97": "Thanks WouterTinus for your quick reply.\nLEWS will try to renew the certificate every 60 days, starting from what date? \nCertificate creation date? . ",
    "LegendORC": "@WouterTinus Thanks for answer.\nHere is what i got.\nHTTP/1.1 200 OK\u00a0=> \nCache-Control\u00a0=> no-cache, no-store, must-revalidate\nPragma\u00a0=> no-cache\nContent-Type\u00a0=> text/html; charset=utf-8\nExpires\u00a0=> -1E\nTag\u00a0=> 6432dfce052049d181ebe9258fa72741\nServer\u00a0=> Microsoft-IIS/10.0\nX-Generator\u00a0=> Orchard\nX-AspNetMvc-Version\u00a0=> 5.2\nX-Frame-Options\u00a0=> SAMEORIGIN\nX-AspNet-Version\u00a0=> 4.0.30319\nSet-Cookie\u00a0=> __RequestVerificationToken=meF2svORQt82_yEAShShAQs8o8WzVYJmOxqc9r-dBX_KpOEPTrCWtC-XQdQQXjHGFuDbwGvJ1FaH2novLtOVzgRbKf0trsD4JOCV5jprP4Y1; path=/; HttpOnly\nX-Powered-By\u00a0=> ASP.NET\nDate\u00a0=> Mon, 16 Oct 2017 03:05:56 GMT\nConnection\u00a0=> closeContent-Length\u00a0=> 23554\nAnything wrong ?\n. @WouterTinus OK, This time i try with :\n http://legendorc.test.xxxxx.com/.well-known/acme-challenge/dYR1qNhTF-SLhM2JGz9apTREvNwDSb_mMthw67YbxVk\nAnd here is what i got :\nHTTP/1.1 403 Forbidden => \nServer => Microsoft-IIS/10.0\nX-Powered-By => ASP.NET\nDate => Tue, 17 Oct 2017 07:28:54 GMT\nConnection => close\nContent-Length => 0\nThen i try on http://ipv6-test.com/validate.php and put my url to check it.\nHere what i got :\n\n\n. @WouterTinus Oh! Thanks you very much.\nFinally, I can do it.\nJust follow this link : https://flowerbunch.org.uk/using-letsencrypt-with-orchard-cms. ",
    "Darklurker": "Coming in from #598 , is there a way to tell LEWS that we have a valid Cert, we just need it to put it in the proper store and setup the scheduled renewal task?  Kinda like the optimization you were talking about above for the authorization stage, but starting after the certificate has been received.  (Maybe this is too much of an edge case to address, since normally this shouldn't happen)\nIf not, I'll test this again on Win2008/IIS on Friday when I'm out of the penalty box.\n. I just ran beta 8 on my Win2008 server and it ran fine.  Cert installed properly, scheduled task setup as expected. \nI chose \"save file on local(network) path\" when I ran it - the new \"temporary application in IIS\" looked too spooky for me (and it's late on a Friday, so I didn't want to push my luck).\nThanks a ton for the bugfixes, man.. Hi jorevf.  Thanks for the reply, but it still didn't work.\nI created the directories c:\\inetpub\\wwwroot.well-known and c:\\inetpub\\wwwroot.well-known\\acme-challenge\nthen I copied c:\\inetpub\\wwwroot\\web.config to c:\\inetpub\\wwwroot.well-known\\acme-challenge \nand renamed it to Web_config.xml.\nShould I have restarted that site or stopped and started IIS?  I didn't do either, since it's the middle of the morning here and folks are using that server.\nMy attempts have caused me to hit the throttling limits for certs from Let's Encrypt, so I guess I'm out of luck until next weekend, unless there's a way to tell letsencrypt-win-simple that it doesn't need to try fetching a cert, since it already has one.. Yeah, same exact error at the same spot - it couldn't open the cert store because it couldn't find the file.\nI did try running it once under the System account (using psexec to get a System command prompt) so it would have unfettered access to anything and everything, but it still gave the same error.  This was the last time it successfully pulled a cert before I hit the throttle limit.\nBut manually importing, without having the letsencrypt-simple-win finish successfully means the auto-renewal isn't setup, right?  And even if I set up that scheduled task manually (by looking at a Win2012 server that I've successfully got LetsEncrypt-simple-win running on), there's still possibly something that's \"not right\" on this server so the renewal won't work - a whacky permission somewhere or a missing file or just me being a bone-head and missing something stupidly simple...  . ",
    "ThomasCr": "Hi, i have the same problem. Cert is not getting imported with letsencrypt-win-simple.v1.9.7.0-beta5.\nIn my letsencrypt.exe.config I have set CertificateStore to Personal (I came from letsencrypt-win-simple.V1.9.3 and from there I had set is to personal right before).\nI see the error also only once, the second time the error is gone, but cert is not imported.\n``\nC:\\Users\\Administrator>\"C:\\Program Files (x86)\\letsencrypt-win-simple\\letsencrypt.exe\" --forcerenewal --baseuri \"https://acme-v01.api.letsencrypt.org/\"\n [INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Version 1.9.7.40771 (RELEASE)\n [INFO] ACME Server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n [INFO] Renewing certificate for wsus.comp.com\n [INFO] Authorizing wsus.comp.com using http-01 validation (FileSystem)\n [INFO] Answer should now be browsable at http://wsus.comp.com/.well-known/acme-challenge/6oFLH42REJY1dS6sfc9rS1yYPgLT_qnncHVr2bgQHIc\n [INFO] Authorization result: valid\n [EROR] Error encountered while opening certificate store\nSystem.Security.Cryptography.CryptographicException: Das System kann die angegebene Datei nicht finden.\n   bei System.Security.Cryptography.X509Certificates.X509Store.Open(OpenFlags flags)\n   bei LetsEncrypt.ACME.Simple.Services.CertificateStoreService.GetCertificate(Func2 filter, X509Store store)\n [INFO] Requesting certificate wsus.comp.com 2017.10.16 5:46:13\n [INFO] Saving certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [INFO] Installing certificate in the certificate store\n [INFO] Installing SSL certificate in server software\n [WARN] Unable to run script.\n [INFO] Renewal for wsus.comp.com succeeded, next one scheduled for 2017.12.15 3:46:23\nC:\\Users\\Administrator>\"C:\\Program Files (x86)\\letsencrypt-win-simple\\letsencrypt.exe\" --forcerenewal --baseuri \"https://acme-v01.api.letsencrypt.org/\"\n [INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Version 1.9.7.40771 (RELEASE)\n [INFO] ACME Server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n [INFO] Renewing certificate for wsus.comp.com\n [INFO] Cached authorization result: valid\n [INFO] Requesting certificate wsus.comp.com 2017.10.16 5:50:20\n [INFO] Saving certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [INFO] Installing certificate in the certificate store\n [INFO] Installing SSL certificate in server software\n [WARN] Unable to run script.\n [INFO] Uninstalling certificate from the certificate store\n [INFO] Removing certificate wsus.comp.com 2017.10.16 5:46:13\n [INFO] Renewal for wsus.comp.com succeeded, next one scheduled for 2017.12.15 3:50:27\n```\nThe current cert files are in %appdata%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ \nBut I think, letsencrypt-win-simple should maybe check, if the import in the windows stores are well done, and if not should retry to import.\n. no, it was not - not in webhosting section and not in personal section - and I was for sure in certlm.msc and refreshed the view. And there was also no cert binding in IIS set (cleared).\nI runned it again, but also no import done:\n```\nC:\\Users\\Administrator>\"C:\\Program Files (x86)\\letsencrypt-win-simple\\letsencrypt.exe\" --forcerenewal --verbose --baseuri \"https://acme-v01.api.letsencrypt.org/\"\n [DBUG] Config folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [VERB] Using registry key HKEY_CURRENT_USER\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\n [VERB] Settings Settings {}\n [DBUG] Loading signer from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\n [DBUG] Certificate folder: C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Certificate store: Personal\n [DBUG] Renewal period: 60\n[INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Version 1.9.7.40771 (RELEASE)\n [INFO] ACME Server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n [VERB] Verbose mode logging enabled\n [VERB] Checking renewals\n [INFO] Renewing certificate for wsus.comp.com\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[INFO] Cached authorization result: valid\n [DBUG] RSAKeyBits: 4096\n [INFO] Requesting certificate wsus.comp.com 2017.10.16 7:19:18\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n [INFO] Saving certificate to C:\\Users\\Administrator\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Set private key exportable\n [INFO] Installing certificate in the certificate store\n [DBUG] Opened certificate store Personal\n [DBUG] Adding certificate wsus.comp.com 2017.10.16 7:19:18  to store\n [DBUG] Closing certificate store\n [INFO] Installing SSL certificate in server software\n [WARN] Unable to run script.\n [INFO] Uninstalling certificate from the certificate store\n [DBUG] Opened certificate store Personal\n [INFO] Removing certificate wsus.comp.com 2017.10.16 5:50:20\n [DBUG] Closing certificate store\n [INFO] Renewal for wsus.comp.com succeeded, next one scheduled for 2017.12.15 5:19:33\n```\n. Hi, I also wanted to ask you about the MY store... it looks like all certs are in \"MY\", but the one from letsencrypt-win-simple has gone (i'm not sure, it looks only like) in \"Personal\" and can't been seen:\n\nWhat do you mean with alias problem? I'm on a german Windows Server 2012 R2.\nCan't currently renew the cert.. I think because of letsencrypt limits:\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n [EROR] Renewal for wsus.comp.com failed, will retry on next run. Maybe the following comment from http://paulstovell.com/blog/x509certificate2 (what is referred in the project sources) is wrong interpreted:\n\nStoreLocation.CurrentUser specifies that I want the \"My user account\" store. StoreName.My maps to the Personal folder in recent versions of Windows.\n\nI also think it should just be MY, like on other suggestions from MS on the web. Example: https://blogs.msdn.microsoft.com/muaddib/2013/10/18/understanding-and-managing-the-certificate-stores-used-for-smart-card-logon/\n\nTo view these certificates using CERTUTIL type the following:\nCERTUTIL -viewstore  where store name is MY, Root, CA, AuthRoot\n\nWas a value of \"Personal\" translated before to \"MY\"? Because on a other Server (same Windows Version) I also use a value of \"Personal\" and it was doing a good job.\n. one question left: how can \"Personal\" be suggested (see also above), when it could never work, because it should be called MY (in every locale) ? It would be nice to place the right suggestion somewhere in docs/comments/wiki - thanks.\n. ok, it works... figured it out.. ",
    "jorevf": "copy web.config from %SystemDrive%\\inetpub\\wwwroot to .well-known\\acme-challenge and rename it to Web_config.xml in the acme directory..\nThen it will work.\n. Hi,\nDid you get the same error?\nI realised that every time you run the client, it requests a new key, so on my last try it complained about max number of certificates for the domain, so in that case I'll have to wait a week or so..\nBut I saw that the certificate was created, but the last part of the configuration for IIS was not done.\nEven it the certificate was visible in MMC / Certificates / and under Personal, I could not chose it in IIS..\nBut by importing it again in the MMC tool, then I could chose it in IIS.\nAnd I could also import it into my mailserver without issues..\nSo now my SSL part works perfectly.\n. ",
    "rdaunce": "I had the same issue a few days ago.  I just tested the fix and it is working for me now.. No problem.  That \"x\" appeared to be a leftover workaround from the old architecture but I didn't want to change things up too much.  Thanks for fixing the issue!. ",
    "GaryWenneker": "Looks like this one is back. \n\nDownloaded the latest binaries\nRunning win10\nUAC off\ndisabled firewall for a few mins (and all accessible from remote machine, also /.well-known/acme-challenge)\n\nand then the error:\nFilename: \\?\\C:\\Windows\\system32\\inetsrv\\config\\applicationHost.config\nError: Cannot commit configuration changes because the file has changed on disk\n-----------EDIT---------------------------------\nlike running Visual Studio in win10 the actual run as Admin just don't work.\nSo I thought, let's try to right click and troubleshoot and add additional rights.\nThis works and now it does what it needs to do \ud83e\udd47 . ",
    "SamSirry": "In deed, turns out I have been using an old release (by mistake).\nThank you!. ",
    "kudecha": "Thanks WouterTinus,\nIt works as expected now.. ",
    "qcnguyen": "hi, I have the same problem. Please fix this. Thank you team. hi WouterTinus,\nI'm using the letsencrypt-win-simple.V1.9.7.0-beta6\nIIS version 7.5.7600.16385.\nWindows server 2008 R2.\nI can't give you the exact log because after several testing, I encounter error: \"too many certificates is generated for mysite.domain\". So I can't reproduce now.\nOne notice that my ISS site have 5 domain point to it. Don't know whether it affect the result or not.\nThank you. Hi WouterTinus, I created new one. . Thank you WouterTinus.\nHowever, I can't test to validate issue now, I encounter the \"too many certificates already issued for exact set of domains\", so can not test it now.\nAnyway, thank you for your support.. ",
    "richardabutler": "I am have the same problem too.\nI have exchange 2010, with iis 7.5 on windows 2008 r2\nI managed to create a certifcate with just a single name with v1.9.3 which is about to expire.\nOn this combination I haven't ever been able to do a SAN certificate and haven't been able to generate a certificate with a single name for a while either.\n. beta7 now works for me and correctly validates and generates a certificate with 3 SAN in it.\nbut when it updates IIS it only installs the certifiate, not the chain, some older browsers then complain\n. ",
    "lggt": "I'm sorry, if my message does not clear enough. All changes that needs I made in block between brackets {...}. Other code does not changed. So call to WaitForExit also needed.. ",
    "dasMulli": "@WouterTinus in theory it should be possible to interface directly with the http.sys kernel module and directly bypass IIS to handle the challenge requests.\nASP.NET Core provides the necessary abstractions and an in-process web server so you could intercept requests by installing a prefix into http.sys via the HttpSysServer:\nc#\nstatic void Main(string[] args)\n{\n    var webHost = new WebHostBuilder()\n        .UseHttpSys(options =>\n        {\n            options.UrlPrefixes.Add(\"http://www.mydomain.com/.well-known/acme-challenge/foo\");\n        })\n        .Configure(app => app.Run(async (context) =>\n        {\n            await context.Response.WriteAsync(\"any response\");\n        }))\n        .Build();\n    webHost.Run(); // there is a start/stop API as well\n}\nI'll try playing around with it in IISPlugin.. This actually works really well\nput together a proof-of-concept change at https://github.com/dasMulli/letsencrypt-win-simple/commit/bda344c79fb0e4dfa1a08d057c118c9981600df9\n Change target framework to 4.6.1\n Add required ASP.NET Core Libraries and update packages (Update-Packages -reinstall because of the target framework change)\n* Create a web host per challenge using HttpSys server.. Sure, but thinking about it (and some sleep) I might be over-complicating things.\nHttpListener should already be able to do this by registering the prefix so your self-hosting plugin should be sufficient if it registers for a specific enough prefix.. I tried with httplistener a few days ago (on vacation now) and it did work to register for :80/some/prefix and let IIS handle the rest (needs to run with admin privileges though). Only tried on latest win10 1709 though, haven't tried yet with older windows / server versions but I'll have a look once I'm back (next weeks). @WouterTinus thanks for looking into it and creating the self-hosted validation option \u2764\ufe0f. It works super smooth and is perfect for IIS + ASP.NET core API-only apps that don't have any filesystem-based contents (ANCM-only).. ",
    "donfl": "Thank you for your reply.  I got a little more insight and got further but\nstill no solution.\nThe problem seems to be that the Tomcat server resolves web requests\ndifferently than the physical path.  The physical path is\nC:\\progra~1\\webapps\\ROOT.well-known\\acme-challenge.  However to access it\nfrom a browser it would be\ninfo.finwoks.com/.well-known/acme-challenge.  Consequently, if I put in\nC:\\progra~1\\webapps\\ROOT.well-known\\acme-challenge letsencrypt fails as\nbefore.  However if I exclude the ROOT directory i.e.\nC:\\progra~1\\webapps.well-known\\acme-challenge the program gives\nCopy default web.config before validation? (y/n): - no\n Enter a site path (the web root of the host for http authentication):\nC:\\progra~1\\webapps.well-known\\acme-challenge\n [DBUG] Send POST request to\nhttps://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing info.finwoks.com using http-01 validation (FileSystem)\n [INFO] Answer should now be browsable at\nhttp://info.finwoks.com/.well-known/acme-challenge/grw44nMUDKsrHn7qq2CFldot1jSiBK1WZvfLxzjq-S0\nTry in default browser? (y/n):\nLooking in the actual directory the challenge file is not there. Also I had\nto answer no to copying the default web.conf.   My conclusion is that the\nprogram tries to check the dir over http and finds it, but put can't\ncopy/ftp to the directory since it needs the ROOT intermediate directory.\nIf I continue on with the program it throws an exception\nTry in default browser? (y/n): - no\n[DBUG] Submitting answer\n[DBUG] Send POST request to\nhttps://acme-staging.api.letsencrypt.org/acme/challenge/gjGVlVQ3AcGLMqIvWtk7XIH6xc59_TJHua04NHTFYJ4/70467916\n[DBUG] Refreshing authorization\n[DBUG] Send GET request to\nhttps://acme-staging.api.letsencrypt.org/acme/authz/gjGVlVQ3AcGLMqIvWtk7XIH6xc59_TJHua04NHTFYJ4\n[INFO] Authorization result: invalid\n[DBUG] Deleting answer\n[EROR] ACME server reported type urn:acme:error:unauthorized\n[EROR] ACME server reported detail Invalid response from\nhttp://info.finwoks.com/.well-known/acme-challenge/MBWkeXmN4tdOJGRI8KFcTrm2PF9EhrqlZ0fzmViatMQ:\n\"<!DOCTYPE html>\npache Tomcat/9.0.0.M4 - Error report",
    "YuriPetskus": "I assume that it was the incorrect order of roles for the directory .well-known. \nFinally, the certificate was created using the version of the application from source code, running in Visual Studio.\n [INFO] Let's Encrypt (Simple Windows ACME Client)\n [INFO] Version 1.9.6.26336 (DEBUG)\n [VERB] Verbose mode logging enabled\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\nAlso, I noticed that the app removes the challenge files with the option CleanupFolders=False.\n. ",
    "unluckynelson": "Hi Wouter\nI am running IIS 8 on Server 2012 R2\nThanks\nJohan\nFrom: WouterTinus [mailto:notifications@github.com] \nSent: 23 October 2017 02:42 PM\nTo: Lone-Coder/letsencrypt-win-simple\nCc: Johan; Author\nSubject: Re: [Lone-Coder/letsencrypt-win-simple] NET::ERR_CERT_COMMON_NAME_INVALID for second domain installation (#610)\nWhich version of IIS are you running?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub https://github.com/Lone-Coder/letsencrypt-win-simple/issues/610#issuecomment-338646345 , or mute the thread https://github.com/notifications/unsubscribe-auth/AIH3McnGyuRtpUyJUyeaeYIL9vAiU-mOks5svImvgaJpZM4QCfEh .Description: Image removed by sender.\n. Hi Wouter\nAfter re-installing the certificate for domain2 the exact same behaviour happened to domain1, here\u2019s the verbose output:\nNow apmine (domain1) has the tracker (domain2) common name and tracker has a valid certificate, but apmine (domain1) does not. (If you are checking online, I restored it so that apmine has a valid certificate since that one is more important, if you look at the certificate for tracker, you'll see the common name has apmine, the same happens again in reverse https://tracker.ptinnovation.co.za/)\nC:\\Users\\Administrator\\Downloads\\letsencrypt-win-simple.V1.9.6.2>letsencrypt --v\nerbose\n[INFO] Let's Encrypt (Simple Windows ACME Client)\n[INFO] Version 1.9.6.39968 (RELEASE)\n[VERB] Verbose mode logging enabled\n[INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-si\nmple\n[INFO] Renewal period: 60\n[INFO] Certificate store: WebHosting\n[INFO] ACME Server: https://acme-v01.api.letsencrypt.org/\n[VERB] Using registry key HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\ht\ntps://acme-v01.api.letsencrypt.org/\n[DBUG] Scanning IIS site bindings for hosts\n[DBUG] Scanning IIS site bindings for hosts\n[DBUG] Settings {Renewals=[ScheduledRenewal {Date=12/22/2017 08:24:09, Binding=\nTarget {Host=\"tracker.ptinnovation.co.za\", HostIsDns=True, Hidden=False, WebRoot\nPath=\"C:\\inetpub\\wwwroot\\proxy\", SiteId=2, ExcludeBindings=null, AlternativeN\names=[], PluginName=\"IIS\", Plugin=IISPlugin {Name=\"IIS\", ChallengeType=\"http-01\"\n, MenuOption=\"\", Description=\"\"}}, CentralSsl=null, San=null, KeepExisting=\"Fals\ne\", Script=null, ScriptParameters=null, Warmup=False}, ScheduledRenewal {Date=12\n/22/2017 08:28:58, Binding=Target {Host=\"apmine.ptinnovation.co.za\", HostIsDns=T\nrue, Hidden=False, WebRootPath=\"%SystemDrive%\\inetpub\\wwwroot\", SiteId=1, Excl\nudeBindings=null, AlternativeNames=[], PluginName=\"IIS\", Plugin=IISPlugin {Name=\n\"IIS\", ChallengeType=\"http-01\", MenuOption=\"\", Description=\"\"}}, CentralSsl=null\n, San=null, KeepExisting=\"False\", Script=null, ScriptParameters=null, Warmup=Fal\nse}]}\n[DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.l\netsencrypt.org\n[DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.\napi.letsencrypt.org\n[WARN] Proxying via [System]\n[DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.\napi.letsencrypt.org\\Signer\n[DBUG] Getting AcmeServerDirectory\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n[DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacm\ne-v01.api.letsencrypt.org\\Registration\nN: Create new certificate\nW: [Legacy] Generate a certificate via WebDav and install it manually.\nF: [Legacy] Generate a certificate via FTP/ FTPS and install it manually.\nL: List scheduled renewals\nR: Renew scheduled\nS: Renew forced\nC: Cancel scheduled renewal\nX: Cancel all scheduled renewals\nQ: Quit\nPlease choose from the menu: N\n1: Single binding of an IIS site\n2: All bindings for a single IIS site\n3: All bindings for multiple IIS sites\n4: Manually input host names\nC: Cancel\nWhich kind of certificate would you like to create?: 1\n[DBUG] Scanning IIS site bindings for hosts\n1: apmine.ptinnovation.co.za (SiteId 1) [@%SystemDrive%\\inetpub\\wwwroot]\n2: tracker.ptinnovation.co.za (SiteId 2) [@C:\\inetpub\\wwwroot\\proxy]\nC: Cancel\nChoose site: 2\n[VERB] Plugin IISBinding generated target [IIS] tracker.ptinnovation.co.za (Sit\neId 2) [@ C:\\inetpub\\wwwroot\\proxy]\n[INFO] Authorizing identifier tracker.ptinnovation.co.za using http-01 challeng\ne\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[DBUG] Writing challenge answer to C:\\inetpub\\wwwroot\\proxy.well-known\\acme-ch\nallenge\\1bE6FzolXH8FOWDkTsqjE9uTfmXxX9p0hTKj5kI1JjQ\n[DBUG] Writing web.config to C:\\inetpub\\wwwroot\\proxy.well-known\\acme-challeng\ne\\web.config\n[INFO] Answer should now be browsable at http://tracker.ptinnovation.co.za/.wel\nl-known/acme-challenge/1bE6FzolXH8FOWDkTsqjE9uTfmXxX9p0hTKj5kI1JjQ\n[DBUG] Submitting answer\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge\n/UOpoCrTynGJlmNNy8c_bMOEyxCCnpP8mCxscFCIn2Nc/2281301952\n[INFO] Authorization result: valid\n[DBUG] Deleting answer\n[DBUG] Additional files or folders exist in C:\\inetpub\\wwwroot\\proxy.well-know\nn\\acme-challenge not deleting.\n[DBUG] RSAKeyBits: 2048\n[INFO] Requesting certificate: tracker.ptinnovation.co.za\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n[DBUG] Request Status: Created\n[INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v0\n1.api.letsencrypt.org\\tracker.ptinnovation.co.za-crt.der\n[INFO] Saving issuer certificate to C:\\ProgramData\\letsencrypt-win-simple\\https\nacme-v01.api.letsencrypt.org\\ca-0A0141420000015385736A0B85ECA708-crt.pem\n[DBUG] CentralSsl False - San False\n[INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v0\n1.api.letsencrypt.org\\tracker.ptinnovation.co.za-all.pfx\n[INFO] Installing Non-Central SSL Certificate in the certificate store\n[DBUG] Opened Certificate Store WebHosting\n[DBUG] Set private key exportable\n[DBUG] Adding certificate tracker.ptinnovation.co.za 2017/10/24 8:07:39 AM to s\ntore\n[DBUG] Closing certificate store\n[INFO] Installing Non-Central SSL Certificate in server software\n[INFO] Updating existing https binding for tracker.ptinnovation.co.za\n[INFO] IIS will serve the new certificate after the Application Pool IdleTimeou\nt has been reached.\n[INFO] Committing binding changes to IIS\n[DBUG] Opened certificate store WebHosting\n[INFO] Closing certificate store\n[INFO] Adding renewal for [IIS] tracker.ptinnovation.co.za (SiteId 2) [@ C:\\ine\ntpub\\wwwroot\\proxy]\nDo you want to replace the existing task? (y/n): - no\n[DBUG] Removing existing scheduled renewal tracker.ptinnovation.co.za - renew a\nfter 2017/12/22 8:24:09 AM\n[INFO] Renewal scheduled tracker.ptinnovation.co.za - renew after 2017/12/23 6:\n08:08 AM\nWould you like to start again? (y/n): - no\nC:\\Users\\Administrator\\Downloads\\letsencrypt-win-simple.V1.9.6.2>\n. I am experiencing a new problem but seem to have found the culprit, as before the certificate installed successfully on my second domain but my first domain now resets the connection and does not even open a page to show the common name is invalid.\nAfter digging around a bit I saw that under Bindings my first domain\u2019s certificate was deselected. I selected the correct one and now everything seems to work fine. So I think the problem lies there that after the installation the certificate gets de-selected under Bindings.\nThanks for the help.\nCheers\n. Hi Wouter, the last problem I described was while using letsencrypt-win-simple.v1.9.7.0-beta9 . ",
    "sflancer06": "I'm experiencing this issue, as well.\nAlso using Win 2012 R2 / IIS 8.\nI get the following details:  \"This server could not prove that it is [site 2]; its security certificate is from [site 1]. This may be caused by a misconfiguration or an attacker intercepting your connection.\"\nFor what it's worth, site 1's cert came free with my GoDaddy VPS.\nAfter playing around with this trying to resolve the issue, I now get the following error in the app:  \"Error creating new cert :: too many certificates already issued for exact set of domains: [site 2],[www.site 2]\"\n. In my case, my Site 1 certificate was not created using LEWS.  I had installed it years ago from GoDaddy.\nThe rest of the steps were accurate.\nBy removing the GoDaddy cert, creating Site 1 cert with LEWS and recreating Site 2's cert, everything works fine.. ",
    "dverg": "I agree. It actually doesn't give much additional value. In my case it was a bit cumbersome to request a new certificate as the servers are behind a load balancer. However, in that case the scheduled task won't work very well anyway.. ",
    "stanelie": "So,\nThis means there is currently no way to automate the process at this time?. Ok,\nThanks!. ",
    "BoatrightTBC": "**OH FREAKING NEVERMIND.   THIS WAS THE BETA!   \n1.9.6.2 worked just fine thank-you-very-much!!**. ",
    "Koochy87": "Thank You for your answer! \ud83d\udc4d . ",
    "bradthurber": "To be fair to this project, 1.9.7 is marked \"Pre Release\" and perhaps I should be using the actual 1.9.6 \"Latest Release\" if I am expecting URL stability.. ",
    "mlewand": "Just in case someone is lost with the directory, and get's here in late 2018 like I did: the path seems now to be like %ProgramData%\\win-acme \ud83d\ude42. ",
    "YourDistrictCongressman": "Thanks.  Unlike the user posting int #612, I have http requests to OWA automatically forwarding to the HTTPS version of the site, so setting the hostname for the port 80 binding causes no problems for me and allowed me to use the automatic cert generation through IIS.\nThe new scheduled task created using the IIS option should automatically update the site bindings to the new Cert every 3 months, right?\nThanks a ton!. Also, if I remove a binding for port 80 after the first run, it will renew using https/443 right?. Awesome, I love seeing this program get better and better.\nOn Tue, Jan 2, 2018 at 3:48 PM, Wouter Tinus notifications@github.com\nwrote:\n\nIt's possible now with v1.9.8 to install a manual hostname to the default\nIIS site.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/625#issuecomment-354884012,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ACWpF0Sk4oLXbU1-1-2LR-uG7cHNq8Ibks5tGqRGgaJpZM4QRirC\n.\n. \n",
    "pstatho": "I seem to be having the same issue with v.1.9.12. This is the command I'm running:\nletsencrypt --plugin iisbinding --manualhost example.com --siteid 1 --validation selfhosting --installation iis --installationsiteid 1 --emailaddress myemail@domain.com --accepttos --usedefaulttaskuser --test --verbose\nI'm getting the same error as OP \"Plugin IISBinding was unable to generate target\". When I run it interactively it works.\nHow does selfhosting work and perhaps it's interfering with IIS on port 80?\n. Yes I'm also using selfhosting in interactive mode. I have an test server that I can reproduce this issue on now.\nWhen I run interactively even with --verbose I don't see the command line options that you are talking about. Is there a particular switch or log file somewhere, since I would like to see the difference as well.. Changing to --plugin manual and removing --sited 1 does indeed help. I still got an warning that binding info wasn't changed but that might be on my side. Thanks guys!. ",
    "conneo": "Hi Wouter,\nThanks for the fast reply. I changed the path, now that error is no longer\nshown. But authentication is still not working. It seems iis cannot host\nfiles on the .well-known subdirectory. I already added mime type \".\" with\ntext/plain.\nPlease could one help me to the right direction?\nRegards,\nJan Rutger\nOp 4 nov. 2017 09:46 schreef \"Wouter Tinus\" notifications@github.com:\nThis is a bug, environment variables should be expanded during the path\nvalidation. You should be able to work around it by going to IIS and\nchanging the basic settings of the website(s) that use the %systemdrive%...\npath and changing them to C:... (or whichever drive %systemdrive% resolves\nto).\nI'll make sure to fix it in a future update though.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/626#issuecomment-341881425,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/Af0qB0pfAEGqqqn8lFo0C7xH_GlnIqokks5szCRugaJpZM4QR7zz\n.\n. ",
    "DrDrrae": "Sorry.  Definitely an issue on my side. I figured it out.  Thanks.. ",
    "konoskoncepts": "Looking at the powershell RD Gateway module now...\nDefinitely quite promising for Server 2012 and up using > PS v3 \nCmdlets Get-RDCertificate and Set-RDCertificate do most of the work.\nLegacy Powershell is a bit trickier but doable. It goes something like this...\nImport-Module RemoteDesktopServices\n$NewThumbprint = (Get-ChildItem -Path cert:LocalMachine\\My | Where-Object {$_.Subject -like \"CN=remote.mydomain.com.au\"} | select Thumbprint | ft -HideTableHeaders)\nSet-Item -Path RDS:\\GatewayServer\\SSLCertificate\\Thumbprint -Value \"$NewThumbPrint\"\nThats completely untested but i'll go away and find myself a testbed to debug it...\nN. @LBegnaud\n\nPerhaps we can include a cache of powershell scripts that can become part of the tool? <\n\nYep.. me like. That's a great idea.. OK.. in its basic form... this works for all Windows Server versions\nImport-Module RemoteDesktopServices\n$OldThumbprint = (Get-Item -Path RDS:\\GatewayServer\\SSLCertificate\\Thumbprint).CurrentValue\n$NewThumbprint = (Get-ChildItem -Path cert:LocalMachine\\My | Where-Object {$_.Subject -like \"CN=remote.mydomain.com.au\"}).ThumbPrint\nSet-Item -Path RDS:\\GatewayServer\\SSLCertificate\\Thumbprint -Value \"$NewThumbPrint\". Just a thought...\nis it worth storing thumbprints for current certs in the registry for easy access for the scripts?\nPowershell can access them easily through Get-PSDrive. ",
    "labnet7": "I recovered a backup of the letsencrypt.exe.config (from before I upgraded from 1.9.4 to 1.9.7) and \"PFXPassword\" was not set. I used powershell to import the certificates into exchange because EMC would not allow importing certificates with blank passwords.\nI assume letsencrypt places the certificates in %PROGRAMDATA% then converts those to a PFX in the directory I specify, but only encrypts them if a password is specified in  letsencrypt.exe.config\nAnything else I can try? eg. Could I export the certificate from the IIS7.5 certificate manager, but add a password, then add that password to the letsencrypt PFX config parameter?\n. I've deleted the pfx files, but now directory for putting the temporary auth file in (.wellknown) is defaulting to c:\\letsencrypt\\%SystemDrive%\\inetpub\\wwwroot\nI've tried letsncrypt.exe --renew --webroot \"c:\\inetpub\\wwwroot\" , but it doesn't change the incorect directory it tries to store the file.. That Worked! (I had downloaded your code and was about to have a look myself).\nJust a couple more questions on the process.\nThe pfx files are placed in a directory of my choosing, but they did not update in the certificate store. (Note I had removed the old pfx files, but I assume the operating system does not directly refer to those certificates anymore once they are imported into the certificate store?)\nThe certificates are stored in the 'personal' store.\nFrom IIS 7.5 I removed the old certificate then imported the new pfx certificate.\nI then has to use the Import-ExchangeCertificate -Server to import them into exchange 2010, then assign the correct services to the certificate.\nHow much of this part of the process is meant to be automated?\nThanks again for your quick responses.\n. ",
    "StefanBCN": "Nope, nothing in Event Viewer about the broken sites at all :(. Just managed to recreate this! Updated site 1, and site 2 (with a similar IIS name but different bindings entirely) was also updated to the new certs. Then I updated site 2, and site 1 was updated to its certs. And then I updated 1, and this time 2 was missed and it behaved normally. Very odd.\nThe error occurs at the section where LEWS logs \"Updating existing https binding\". Site 2 is not mentioned in the console output prior to that. It seems like the code in AddOrUpdateBindings() is incorrectly determining that site 2 shares the same bindings as 1, but they do not.\nAt the \"Updating existing\" point, it includes the bindings from the other site. Bizarrely it doesn't seem to do this in test mode.\nI've dug around in your code and I can't find anything in AddOrUpdateBindings() which would make site 2 show as an alternative for site 1. \nI will try compiling LEWS after stripping out the AddOrUpdateBindings() code and see if that fixes my problem.. Okay, I think I've cracked this. It comes down to FriendlyNameFilter in services\\CertificateService.cs line 298. This is used to find the most recently issued certificate for a site (so it can find other sites with the same cert).\nBut if the most recent logged request doesn't have a thumbprint logged (or if it can't find any history items) it instead uses GetCertificateByFriendlyName, searching against the 'Host' attribute of the target.\nThat 'Host' attribute, though, is actually just the NAME of the site in IIS, eg 'Blue Widgets Website' - check out IISSite.cs line 93.\nThe fact that it's the name of the site means that when the FriendlyNameFilter kicks in, and does this: \nreturn (x.Issuer.Contains(\"LE Intermediate\") || x.Issuer.Contains(\"Let's Encrypt\")) && x.FriendlyName.ToLower().StartsWith(friendlyName.ToLower()); \nIt's using StartsWith() as the comparison for the FriendlyName (in the existing cert) to friendlyName (from the site you're actually renewing), which is pretty lax and matches when the site's name in IIS starts with the same bunch of characters as another (which happens often enough if you're hosting hundreds of similarly named sites).\nI'm guessing this is because the FriendlyName in the certificate ends with the date, which changes, so you want to exclude that from the comparison by only checking the start.\nI propose that rather than doing this, you compare against the 'Subject' attribute of the certificate, which will be something like 'CN: domainname.com' and doesn't change between renewals. Although this may well have its own flaws.\nA client-side solution to the problem of certificates being replaced, which I will implement in the interim, is to ensure that no site in IIS has a name which starts with another site's name. This means the 'StartsWith' comparison will fail between the two non-matching sites. So no site called 'Widgets Co' if I also have a 'Widgets Co Ecommerce'. This will be a pretty straightforward fix, anyway.\nI hope that makes sense and proves useful! This bug had been causing some serious woe lately. I'm very happy to have finally figured it out :). ",
    "thirdoff": "Yes, windows 2012 R2 comes withnet 4.5 enabled.  I also have 3.5 enabled.\nOn the one that is not working, I should add that I had the script setup on its own, in a website's wwwroot folder and everything worked.  Once it was built into solidcp, I removed the scheduled task and the old setup directory.  I disabled ssl 3, ssl 2, tls 1, and tls 1.1 (so it only uses TLS1.2).  I set the cipher order.\nIn solidcp it says cert is created but it isnt.  So i ran the letsencrypt.exe in the solidcp server/bin and that is when I see [eror] the request was aborted: could not create SSL/TLS channel.   I can open the LE page.\nI get success on a new install of solidcp and letencrypt with the same steps..  CIPHER order I am using works on 2016 but breaks LEwinsimple on 2012 R2. \nTLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_DHE_RSA_WITH_AES_128_GCM_SHA256,TLS_DHE_RSA_WITH_AES_256_GCM_SHA384,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA256,TLS_DHE_RSA_WITH_AES_256_CBC_SHA256. This cipher order works on both Server 2012 R2 and 2016.  Also gets A ratings from SSL Labs.\nTLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_DHE_RSA_WITH_AES_256_GCM_SHA384,TLS_DHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA. I do not see \"M\" option.  (I am running IIS and LE detects IIS.) I'm having a Null issue also.. ",
    "TuminD": "Yes, using bat file to launch PS works - thank you.\nAnd it looks like all is ok - I got certificate \nbut letsencrypt gave one Error in console output (after Installing certificate in server software):\n\"[INFO] Adding certificate mydomain.com 2017/11/15 6:44:08 PM to store WebHosting\n [INFO] Installing SSL certificate in server software\n [INFO] Script validationmode starting...\n [EROR] Script is unable to start\nSystem.ComponentModel.Win32Exception (0x80004005): The system cannot find the fi\nle specified at System.Diagnostics.Process.StartWithCreateProcess(ProcessStartInfo startIn\nfo) at LetsEncrypt.ACME.Simple.Clients.ScriptClient.RunScript(String script, String parameterTemplate, String[] parameters)\"\nI used such command:\nletsencrypt.exe --plugin manual --manualhost mydomain.com --validation script --validationmode dns-01 --dnscreatescript C:\\script\\letsencrypt\\scripts\\add_dns.bat --dnsdeletescript C:\\script\\letsencrypt\\scrip\nts\\remove_dns.bat\nWhat is \"Script validationmode\" ?. ",
    "RobBiddle": "None.  I've used a previous version of letsencrypt-win-simple that had the executable bundled instead of using build.ps1.  I was hoping to pull straight from the repo; I guess I'll have to build on a different system first.. Derp.  I just realized that if I go into the actual release the .zip files there are already built.  Sorry for the non-issue.. Thanks for the explanation, the docs definitely don't make that clear.\nI'm having some difficulty tracking down my Renewals file.  I think it may be related to the client having been upgraded following the initial CSR.  \nThe ConfigurationPath value is blank in my settings.\nAccording to the docs the default directory is: %programdata%\\win-acme\\ , however I don't have that directory.  \nInstead I have: %programdata%\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\ , which has the .history.json file showing the most recently renewed certificate, but no Renewals file.\nWhen this certificate was first obtained I was running letsencrypt-win-simple.v1.9.7.2 and during the most recent renewal I was running win-acme.v1.9.10.0\nI'm conditionally running my renew command based on the number of days until expiration date of the certificate.  Can I just drop the --renew switch out of my command to request a new certificate and keep the existing?. Ahh, just found this: https://github.com/PKISharp/win-acme/wiki/Migration-to-v1.9.9. ",
    "dyroymag": "We have hundreds of web-projects which mostly use a handfull of modules. If i try to validate using the webapplication, I get errors because of inherited modules from the parent IIS-site.\nIt is possible to exclude inheritence of modules to other webapplications within the site, but that would require editing every web.config in every project individually.\nI tried making changes to the web_config.xml in the program directory to try and remove some of the modules which are inherited from the IIS-site.\nI added the lines:\n<modules>\n      <remove name=\"ImageResizingModule\" />\n    </modules>\nat line 4.\nThis makes a valid web.config file, but removing modules from a subfolder is apperantly not supported. If i move the same web.config file down to the root of the web application (/.well-known/) the modules are correctly removed.\nBasically I would like to be able to remove IIS modules using LEWS and the web_config.xml template. Or by using some other method.\n. I just tried \"letsencrypt-win-simple.v1.9.8.0-beta2.zip\"\nValidation still fails and the IIS logs shows that the webapplication is complaining about dependecies related to loaded modules from the parent webapplication.\n\nException type: ConfigurationErrorsException \nException message: Could not load file or assembly 'AventoMvc.Core' or one of its dependencies. The system cannot find the file specified.\n\nI can however succesfully validate if I alter the Web_Config.xml file to remove the modules in question.\nI believe this is due to that 'acme-challange' now is its own web-application, and not a subfolder of the 'well-known' webapplication.\nMy Web_Config.xml file, now looks like this:\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<configuration>\n    <system.webServer>\n        <modules>\n            <remove name=\"ImageResizingModule\" />\n            <remove name=\"ErrorMail\" />\n            <remove name=\"ErrorLog\" />\n            <remove name=\"ErrorFilter\" />\n            <remove name=\"ErrorHandler\" />\n        </modules>\n    <httpRedirect enabled=\"false\" />\n    <validation validateIntegratedModeConfiguration=\"false\" />\n    <staticContent>\n      <clear />\n      <mimeMap fileExtension=\".\" mimeType=\"text/json\" />\n      <mimeMap fileExtension=\".*\" mimeType=\"text/json\" />\n    </staticContent>\n  </system.webServer>\n  <system.web>\n    <authorization>\n      <allow users=\"*\" />hial\n    </authorization>\n  </system.web>\n</configuration>\n. ",
    "Booster2ooo": "Just to let you know, it seems the problem is fixed since the update. Thanks a lot :). ",
    "MSYCCE": "Thanks dlidstrom. This is my first attempted use of Lets Encrypt, so I have no other certificates. Since the error is a FileLoadException, I believe that the problem must be local in letsencrypt-win-simple.. dlidstrom and others, my apologies. I did not realize that the certs were being generated even though I was getting the errors. Once I saw the certs were created and on the disk, I simply created the binding. However, I do not know why the FileLoadException error occurred.. Thanks, downloaded 1.9.8 yesterday.\nFrom: Wouter Tinus [mailto:notifications@github.com]\nSent: Monday, November 27, 2017 11:01 AM\nTo: Lone-Coder/letsencrypt-win-simple letsencrypt-win-simple@noreply.github.com\nCc: MSYCCE mick@go-cce.com; Author author@noreply.github.com\nSubject: Re: [Lone-Coder/letsencrypt-win-simple] FileLoadException: (#647)\nI guess the FileLoadException is a case of non-proper re-use of the IISClient object, where one instance made changes while the other was not refreshed. This shouldn't be possible anymore in 1.9.8 due to the DI framework.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHubhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/647#issuecomment-347269584, or mute the threadhttps://github.com/notifications/unsubscribe-auth/AgURcRZbijm_kfKPQ_9kvA1YblBuV1d9ks5s6vjugaJpZM4Qm12p.\n. ",
    "vaguy": "I just tried this with 1.9.8 beta4.  Using the parameters I referenced in my initial post still causes lestencrypt to fall into interactive mode.\n. Unattended operation with dns-01 still not working 100%.\nI get a prompt asking if I want to save the certificate (which I of course do).\nI have found no command line switch to eliminate that prompt.\nAlso, I'm getting an error (3 of them) stating \"[EROR] Script error: null\"\nMy scripts are working correctly - their outputs are shown in the attached log - \"OK1\", \"OK2\", and \"OK3\".\nI don't understand where the script errors are coming from.  Perhaps because I'm using the --test mode?\nThere is also one other error I'm seeing - \"[EROR] Autorization result: valid\"\nIt seems to always validate (regardless of whether the acme-challenge TXT record is correct or filled with a bogus value)\nAgain, perhaps this is because I'm running in --test mode?\nHere is my session log\nC:> .\\letsencrypt.exe --manualhost bbbbbbb.zzzzzz.net --plugin manual --v\nalidationmode dns-01 --validation dnsscript --dnsdeletescript le_NOOP.bat --dnscreatescript le_TXTupdate.bat  --installa\ntion manual --script le_INSTALLcert.bat --accepttos --emailaddress eeeeeeeee@gmail.com --test --closeonfinish --notasksc\nheduler --verbose\n [DBUG] Test parameter set: https://acme-staging.api.letsencrypt.org/\n [DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n [VERB] Using registry key HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\https://acme-staging.api.letsencrypt.org/\n [VERB] Settings SettingsService {ConfigPath=\"C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt\n.org\", RenewalStore=null, HostsPerPage=50}\n [VERB] .NET Framework 4.6.1 detected\n[INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Software version 198.0.6563.39986 (RELEASE)\n [INFO] IIS not detected\n [INFO] ACME Server https://acme-staging.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n [VERB] Verbose mode logging enabled\n[DBUG] Renewal period: 55\n [INFO] Running in unattended mode.\n [INFO] Plugin Manual generated target [Manual] [1 binding - bbbbbbb.zzzzzz.net]\n [DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\\Registrati\non\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing bbbbbbb.zzzzzz.net using dns-01 validation (DnsScript)\n [INFO] Script le_TXTupdate.bat starting with parameters bbbbbbb.zzzzzz.net _acme-challenge.bbbbbbb.zzzzzz.net lWuww__67\njVfDKMRENIjpFiGsyEvZpsjewiAV0Xn_aI\n [INFO] OK1\n[INFO] Answer should now be available at _acme-challenge.bbbbbbb.zzzzzz.net\n [EROR] Script error: null\n [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/4RyWNRCENrr9xYcYDHA9fQljQQqeT6H9c1o\njtUCobZY/85607778\n [EROR] Authorization result: valid\n [INFO] Script le_NOOP.bat starting with parameters bbbbbbb.zzzzzz.net _acme-challenge.bbbbbbb.zzzzzz.net\n [EROR] Script error: null\n [INFO] OK2\n[DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n [DBUG] Certificate store: My\n [WARN] Using cached certificate for bbbbbbb.zzzzzz.net 2017/12/23 10:52:44 PM\nDo you want to save the certificate? (y/n): - yes\n[INFO] Installing certificate in the certificate store\n [DBUG] Opened certificate store My\n [INFO] Adding certificate bbbbbbb.zzzzzz.net 2017/12/23 1:06:54 AM to store My\n [VERB] CN=bbbbbbb.zzzzzz.net - CN=Fake LE Intermediate X1 (82C9F7C66300F8E09FC03173607D09D32A8E7F5E)\n [VERB] CN=Fake LE Intermediate X1 - CN=Fake LE Root X1 (4EEE7398C1A3DAF91DA16689DB8243927A271B9A) to CA store\n [VERB] CN=Fake LE Root X1 - CN=Fake LE Root X1 (B3F73C419DAC14711F4B97192BF89C7DEA7A7794) to AuthRoot store\n [DBUG] Closing certificate stores\n [INFO] Installing with Run external script...\n [INFO] Script le_INSTALLcert.bat starting...\n [EROR] Script error: null\n [INFO] OK3\n. Sorry, didn't want to run in non-test mode until I knew everything was OK.\nSo, I eliminated --test and everything worked OK without any operator intervention.\nThx\nJust an FYI for others, I had to throw in a delay (ping localhost -n 10 >nul) after updating my dns-01 TXT record to give it time to propagate before continuing on with letsencrypy to validate.. ",
    "SpringLeader": "\n. Seems like a problem with the config file at first glance. https://pastebin.com/zAzQ1STg\nHere it is. No dice, side by side XML syntax error when I try to change the PFX password, config path, or certs path.\n\nI've tried forward and back slash, with and without quotes. ",
    "FreakyBigFoot": "What do you mean still exist? We're using manual generating with certralized ssl. So there isn't anything in IIS associating the sites except the centralized ssl that says \"if the binding matches this, use it\". Does that make sense? So am I going to be able to write something like  \"lets.exe --remove www.domain.com\" ?. How would you remove them using command line if they've been manually generated?. I'm using HKCU. I can follow the update procedure and test. . Hey that worked. Thanks!. ",
    "clafast": "Hi WounterTinus,\nHere is the version number registered in the version.txt file:\nv1.9.8-beta1\nI now use the version: v1.9.8-beta4\nthank you I was able to advance!\nanother error now \"Plugin IISBinding was unable to generate a target with two other\" warning \"I look in the requests on this project if I find a track\n. solved thanks again!. ",
    "skfd": "I think we can write some Disclaimer about false positives and start tracking this stuff for each release?\nI'm sure they will start to be negatives in time, but there might be a way to do something proactively?. By the way, is there some config to ask Appveyor to use specific version of Powershell?. As part of the release file can be sumbitted to https://www.microsoft.com/en-us/wdsi/filesubmission -- this is the tool to report false positives.. I can guess that exe file got sniped by anti-virus. Try using stable version, not beta. Antiviruses do not hate it.. ",
    "GrimGX": "I was dumb, using wrong options. Sorry if i wasted anyones time.. ",
    "rdwebdevel": "\nWould be interesting to see the log from that error (and the list of domains that you issued for).\n\nSure thing.  Tell me how to obtain a log, I'll be happy to share.\n\nWith Central SSL the trick is make a copy the .pfx file for each domain that you want IIS to use it for. For example if you issued a certificate for a.com, b.com and c.om, you should make three copies of it named a.com.pfx, b.com.pfx and c.com.pfx. That's all LEWS does when copying over to the CSS.\n\nI'm no sure that I follow.  It looks like my old central store has maybe 20 or so pfx files.  My latest request made just the one file - sampledomain.com-all.pfx.  Are you saying that I'd need to copy that to, say,  autodiscover.sampledomain.com.pfx,  vpn.sampledomain.com.pfx,  and so on?  Of course, as I mentioned, windows says the key isn't usable...\n\nAnother workaround that you could try is to issue individual certificates for the domains, to circumvent the \"exact set of domains\" criterium of the rate limit.\n\nOkay, that's worth a shot for sure.\n. ",
    "cpirie": "The downloaded version of v1.9.8.0-beta6 triggers Windows Defender. Per your request, I downloaded and built latest build with no issues. \nLooks like it might be your machine after all! :(. Interesting enough, Malewarebytes finds the same backdoor. Windows Defender on your build was something else entirely. Can you see closed issues? I had posted info there before realizing it was a duplicate.\nMy build:\nhttps://www.virustotal.com/#/file/39d6ed63653f17a530c7552377fb1f723902f5ac26f692cba89c0b923576a64d/detection\n. Woops, duplicate.. ",
    "NicoJuicy": "Thanks @skfd i submitted it to Windows Defender there as false positive. I hope it speeds up the approval workflow.. ",
    "marietteknap": "Hi guys, I will do a rewrite of the tutorial with the latest version soon. The tutorial is now based on 1.9.3 of win-simple client.. ",
    "Michael-the-Great": "Wow, Thanks! WouterTinus, I am grateful for the help.\nAnd marietteknap, I would be nowhere without your article. But if you could put the version you're using when you do that rewrite it would be helpful. I originally used your article 3 months ago and it worked very well. Then it didn't renew. I tried to solve things by downloading the latest version. Then I had to get used to the new version and not everything matched your article. But your quick update at the top about the certificate store sent me in the right direction here. Marietteknap, I really do appreciate the time and effort you put into that article! :). ",
    "untotren": "Yeah my AV deleted, my mistake, it runs like a dream now.  Thank you so much @Lone-Coder I almost gave up using lets encrypt but you have solved my frustration.  Do you have a donate link?  You deserve atleast half of what I spend on SSL's yearly.. ",
    "RasmusVoss": "I have the same issue on .net 4.7.1 . ",
    "dermase": "@WouterTinus both build script and debug produce the same error\nAnd sorry for the duplicate. ",
    "smarques84": "I am also having this problem in Windows Server 2012, somehow the challenge is never written to the expecting folder (.well-known) do i also need to create the acme-challenge folder before hand?\nThis is the options i am using:\n1 - N (New certificate)\n2 - 4 (Manually input)\n3 - mysubdomain.dyndns.org\n4 - 6 (Self hosting Verification)\n5 - 3 (Do not run any instalation files)\nI am trying to make it work this with a apache server in windows i am trying with xampp where the domain on port 80 redirects to \"c:\\xampp\\htdocs\" both this folder and .well-known folders are accessible from the domain.\nTried to run on verbose and everything seems fine until it says \"Answer should now be browsable at ...dydns.org/well-known/acme-challenge/......\" and when i press yes browser can\u00b4t find the challenge, it simple isn\u00b4t in the folder!\nI tried the latest stable release and also the latest beta 1.9.8.0 beta 8.1\nAny ideas?\n. @WouterTinus i misunderstood how your program works i thought that (Self hosting Verification) was to be used if you wanted to validate with your apache installation then i realized that letsencrypt-win-simple run its own http service on port 80 to validate the challange with this option. \nI was running apache on port 9090 with my domain 80 port redirecting to my server port 9090, i had IIS running on port 80 but never got any error and the challenge was never written on the specified folder which is weird.\nWhen i tried FileSystem validation (Validate through network folder) which was the option i really wanted everything started working! \nThank you for your time!. ",
    "oladipo": "Thanks!\nProblem solved..\nOn Thu, Dec 28, 2017 at 10:25 AM, Wouter Tinus notifications@github.com\nwrote:\n\nThis is by design, to prevent you from running into Let's Encrypt rate\nlimits while experimenting with the program. In the past some people have\ngotten very much stuck by having broken bindings etc. and not being able to\nrecover because the same certificate has been requested more than a couple\nof times in a row already.\nIf you really want to have a new certificate within 24 hrs of the last\nissue, you can delete the .pfx file from the CertificatePath.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/679#issuecomment-354257728,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ACkuqL94TkwEKNiQQce_oNlnTCdbp2ohks5tE16CgaJpZM4RJ4C6\n.\n\n\n-- \nOlasemo Oladipo\n+234 803 6677 937\n+234 809 8765 476\n\"A dream that is too big is the right size!\"\nSubscribe to the Yoruba Word of the Day : http://bit.ly/16lwgT9\nDo you have a windows phone? download the yoruba dictionary app\nhttp://bit.ly/ZMDSqs\nan Android device maybe? Get the SupaStrikas Augmented Reality app\nhttp://bit.ly/16lwrxW\n. ",
    "Scippy": "Hi,\nI don't know why but manually adding all the Nuget's dlls referenced by the code in the app folder resolves. The same configuration (the output code of the project in VS2017 that include only the primary bin but without the referenced Nuget's dlls) on a server with .NET 4.7 installed, works like a charm. I hope this can help you. Thanks in advance, Riccardo.. ",
    "rsgabriel": "@WouterTinus You are correct, the number I enter for the site in the console is 3, and the IIS site ID is 17. I see by my language that it may have been implied to be the same.\nI tested the issue again and this time LetsEncrypt shows \"Unable to find IIS SiteID#24\" for the same site.\nI ran \"appcmd list site\" and the iis site id for the site in question is 9\n. @WouterTinus \n\nCan you think of any reason why the site IDs could get mixed up?\nDid you change site names / host names / servers between creating and renewing the certificates?\nIs there a site 24 and if so what does it look like?\n\nNo to all.\n\nCan you show the --verbose output?\n\nhttps://pastebin.com/fbGLc31e\n. >Can you think of any reason why the site IDs could get mixed up?\nActually, I was using letsencrypt-win-simple.V1.9.1 until recently but upgraded due to an issue I had with the authorization process (which seems resolved in this version). \nSo the config in the Renewals registry key is from that version.\nHow can this data be refreshed? Deleting the key does not cause it to regenerate on the next launch of LE.\nAlso  like you said this data could go stale, seems like it would be ideal to fetch it each time LE starts.\n. >Do you by any chance have a backup of the registry entry from before the upgrade?\nI do not.\n\nDoes it increase every time you run it?\n\nI suspected this as well when I saw the output earlier but I ran it again then and the number did not increase. I ran it again and its still 24.\n. Thanks.\nSo if the property is obsolete what is the best way to remove/renew the existing data and use whatever new method is in place?. ",
    "feamsr00": "MIght I suggest that option be renamed to --css-creation or --create-in-ccs. ",
    "Ionaru": "Under [VERB] Settings SettingsService it shows some values like Host and WebRootPath that I did not enter anywhere, where does it get those values from? . Found an error in the Windows event log that may be related:\nUnable to bind to the underlying transport for [::]:80. The IP Listen-Only list may contain a reference to an interface which may not exist on this machine.  The data field contains the error number.. The error does not happen when I close Apache, maybe the error happens because port 80 is in use?\nIf that is the case then why doesn't the program say so?. When renewing certificates I need to bring my webserver down. Because of this, the renewal is done through commands in a script.\nYes I could delete the file in that same script, but it would be nice if it would overwrite the file using the --forcerenewal option. ",
    "Hackashaq666": "UPDATE and CLOSED\nI ran letsencrypt.exe again in an administrator cmd window and it created the proper registry values in HKLM.. ",
    "AdamBohil": "Thank you both for your time and suggestions on my failed renewal issue.\nAfter the first suggestion, I was hopeful that adding \".org\" to the value would fix the problem.  But, it didn't.  After a couple more rounds of trial and error, I ended up chatting with a helpful GoDaddy support agent who told me I needed to remove the quotes from around the value letsencrypt.org.  That did the trick!  Based on everything I was seeing, I wouldn't have guessed removing the quotes would've been the solution.. ",
    "petrnejedly": "I needed to get the website running right away so after I made sure the certificate is OK (successfully renewed) I went to bindings and selected the certificate from the dropdown list manually (before it said \"Not selected\"). That fixed it immediatelly. \nNow when I run this command (letsencrypt.exe --verbose --renew), I get: \n```\n [DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [VERB] Using registry key HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\n [VERB] Settings Settings {}\n [DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\n [DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Certificate store: WebHosting\n [DBUG] Renewal period: 60\n[INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Software version 1.9.7.19809 (RELEASE)\n [INFO] IIS version 10.0\n [INFO] ACME Server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n [VERB] Verbose mode logging enabled\n [VERB] Checking renewals\n [VERB] Checking xanonymizedx.eu\n [INFO] Renewal for certificate xanonymizedx.eu not scheduled, due after 2018. 3. 3 3:11:22 odp.\n [VERB] Checking www.xanonymizedx.eu\n [INFO] Renewal for certificate www.xanonymizedx.eu not scheduled, due after 2018. 3. 4 8:00:28 dop.\n```\nKind regards, \nPetr. Ok, let's say I own a domain \"site.eu\". In my IIS there are (among others) two separate WebSites: \n\nSiteEuWww  (D:\\WebSites\\SiteEu\\www)\nSiteEuNoWww (D:\\WebSites\\SiteEu\\nowww)\n\nI prefer the no-www version of my domain (\"site.eu\" instead of \"www.site.eu\") by default. The nowww directory is the root directory of my website. The www directory contains only a Web.Config file managing 301 redirects from www to no-www. \nBindigs are set as follows: \n\nhttps://site.eu/ ==> SiteEuNoWww (website content)\nhttp://site.eu/ ==> SiteEuWww (301 redirect to https://site.eu/)\nhttp://www.site.eu/ ==> SiteEuWww (301 redirect to https://site.eu/)\nhttps://www.site.eu/ ==> SiteEuWww (301 redirect to https://site.eu/)\n\nI had one certificate file with two bindings: site.eu,www.site.eu\nI ran the command letsencrypt.exe --verbose --forcerenewal and it looks like success but:\n- Now I have two separate certificate files, one for site.eu, second for www.site.eu\nThe output is like this: \n```\n [DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [VERB] Using registry key HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\n [VERB] Settings Settings {}\n [DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\n [DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Certificate store: WebHosting\n [DBUG] Renewal period: 60\n[INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Software version 1.9.7.19809 (RELEASE)\n [INFO] IIS version 10.0\n [INFO] ACME Server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n [VERB] Verbose mode logging enabled\n [VERB] Checking renewals\n [INFO] Renewing certificate for site.eu\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Cached authorization result: valid\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Cached authorization result: valid\n [DBUG] RSAKeyBits: 2048\n [INFO] Requesting certificate site.eu 2018. 1. 5 7:40:44 odp.\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n [INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Set private key exportable\n [INFO] Installing certificate in the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Adding certificate site.eu 2018. 1. 5 7:40:44 odp. to store WebHosting\n [VERB] CN=site.eu - CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US (A7E40C2FB9787921D1CF1166999D7BEB280DAFA3)\n [VERB] CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US - CN=DST Root CA X3, O=Digital Signature Trust Co. (E6A3B45B062D509B3382282D196EFE97D5956CCB) to CA store\n [VERB] CN=DST Root CA X3, O=Digital Signature Trust Co. - CN=DST Root CA X3, O=Digital Signature Trust Co. (DAC9024F54D8F6DF94935FB1732638CA6AD77C13) to AuthRoot\n [DBUG] Closing certificate store\n [INFO] Installing SSL certificate in server software\n [WARN] No script configured.\n [INFO] Uninstalling certificate from the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Removing certificate site.eu 2018. 1. 5 7:16:32 odp. from store WebHosting\n [DBUG] Closing certificate store\n [INFO] Renewal for site.eu succeeded, next one scheduled for 2018. 3. 6 6:40:47 odp.\n [INFO] Renewing certificate for www.site.eu\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Cached authorization result: valid\n [DBUG] RSAKeyBits: 2048\n [INFO] Requesting certificate www.site.eu 2018. 1. 5 7:40:48 odp.\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n [INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Set private key exportable\n [INFO] Installing certificate in the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Adding certificate www.site.eu 2018. 1. 5 7:40:48 odp. to store WebHosting\n [VERB] CN=www.site.eu - CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US (CD50B749FB3506E64FD3270CEC2E2AF93735617F)\n [VERB] CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US - CN=DST Root CA X3, O=Digital Signature Trust Co. (E6A3B45B062D509B3382282D196EFE97D5956CCB) to CA store\n [VERB] CN=DST Root CA X3, O=Digital Signature Trust Co. - CN=DST Root CA X3, O=Digital Signature Trust Co. (DAC9024F54D8F6DF94935FB1732638CA6AD77C13) to AuthRoot\n [DBUG] Closing certificate store\n [INFO] Installing SSL certificate in server software\n [WARN] No script configured.\n [INFO] Uninstalling certificate from the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Removing certificate www.site.eu 2018. 1. 5 7:16:38 odp. from store WebHosting\n [DBUG] Closing certificate store\n [INFO] Renewal for www.site.eu succeeded, next one scheduled for 2018. 3. 6 6:40:51 odp.\n```\nLooks OK, but when I check the website binding, it looks like this: \n\nIs this going to help?. Sorry, my bad, I accidentally ran the command twice. First run deleted the single certificate file with two bindings (site.eu,www.site.eu) and created two separate certificate files (it would be great to keep just this one file with two bindings). Second run successfully renewed these two separate certificate files (but failed to correctly update the binding).\nI deleted these two new certificate files and created single certificate file with two bindings (site.eu,www.site.eu) again. Then I ran the command letsencrypt.exe --verbose --forcerenewal and here is the result:\n```\n [DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [VERB] Using registry key HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\n [VERB] Settings Settings {}\n [DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\n [DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Certificate store: WebHosting\n [DBUG] Renewal period: 60\n[INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Software version 1.9.7.19809 (RELEASE)\n [INFO] IIS version 10.0\n [INFO] ACME Server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n [VERB] Verbose mode logging enabled\n [VERB] Checking renewals\n [INFO] Renewing certificate for site.eu\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Cached authorization result: valid\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Cached authorization result: valid\n [DBUG] RSAKeyBits: 2048\n [INFO] Requesting certificate site.eu 2018. 1. 6 11:22:58 dop.\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n [INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Set private key exportable\n [INFO] Installing certificate in the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Adding certificate site.eu 2018. 1. 6 11:22:58 dop. to store WebHosting\n [VERB] CN=site.eu - CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US (2B0E1551F4AB143EF5664231A3398317EC29803F)\n [VERB] CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US - CN=DST Root CA X3, O=Digital Signature Trust Co. (E6A3B45B062D509B3382282D196EFE97D5956CCB) to CA store\n [VERB] CN=DST Root CA X3, O=Digital Signature Trust Co. - CN=DST Root CA X3, O=Digital Signature Trust Co. (DAC9024F54D8F6DF94935FB1732638CA6AD77C13) to AuthRoot\n [DBUG] Closing certificate store\n [INFO] Installing SSL certificate in server software\n [WARN] No script configured.\n [INFO] Uninstalling certificate from the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Removing certificate site.eu 2018. 1. 6 10:58:59 dop. from store WebHosting\n [DBUG] Closing certificate store\n [INFO] Renewal for site.eu succeeded, next one scheduled for 2018. 3. 7 10:23:00 dop.\n [INFO] Renewing certificate for www.site.eu\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Cached authorization result: valid\n [DBUG] RSAKeyBits: 2048\n [INFO] Requesting certificate www.site.eu 2018. 1. 6 11:23:01 dop.\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n [INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Set private key exportable\n [INFO] Installing certificate in the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Adding certificate www.site.eu 2018. 1. 6 11:23:01 dop. to store WebHosting\n [VERB] CN=www.site.eu - CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US (769CFD83381FC99B5346E12B313ECA36BA8B0344)\n [VERB] CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US - CN=DST Root CA X3, O=Digital Signature Trust Co. (E6A3B45B062D509B3382282D196EFE97D5956CCB) to CA store\n [VERB] CN=DST Root CA X3, O=Digital Signature Trust Co. - CN=DST Root CA X3, O=Digital Signature Trust Co. (DAC9024F54D8F6DF94935FB1732638CA6AD77C13) to AuthRoot\n [DBUG] Closing certificate store\n [INFO] Installing SSL certificate in server software\n [WARN] No script configured.\n [INFO] Renewal for www.site.eu succeeded, next one scheduled for 2018. 3. 7 10:23:04 dop.\n```\nThe binding now looks like this:\n\nand the website is not working. Now looking at the certificate file properties, I found there is Enable Automatic Rebind or Renewed Cerrtificate. I turned this option on so I am now currious if it helps.\n\nUnfortunately I am not able to try it now because I have just achieved the rate limit. I will try it again a bit later, I will also try the new version.. ",
    "redfox1977": "Hi,\nI tryed the new Version, but there is an new Error.\nWhen i enter the same Site, there are the Error:\n[INFO] Authorizing remote.demo-test.de using tls-sni-01 validation (IIS)\n [EROR] Error authorizing [IISBinding] remote.demo-test.de (SiteId 1) [ @ %SystemDrive%\\inetpub\\wwwroot]\n [EROR] NullReferenceException: Der Objektverweis wurde nicht auf eine Objektinstanz festgelegt.\n [EROR] Create certificate failed\nWhat that?\nMFG redFOX. Thank you. that was the Error...\nIt work's now.... ",
    "Somebodyisnobody": "Thank you very much for this fast answer.\nSo i'll set it to true like you told me. (For a few month - until the next version - the key is exportable, that's a 1st world problem). yeah forgot to say that, using the self-hosting method. I told skype to never use port 80 but what is with another program in future. I'll not recognize if certification does not work until I want to connect to RDP. There is no option with arguments etc. to say \"I use the self-hosting method on port 83 and tell LE to send the http-request to port 80\"?. Ouh! One more program on the pc for 1 challenge in 3 month. Where can i request features?. I wana cert my terminal services on a Windows Professional 10.1703 computer. I wrote an Powershellscript which pushes the new certificate to the remotedesktop-host after the LE-Client got the new certificate. All this is done by an task in the windows-taskplaner.\nBecause i've running a cloud-http-redirect on external port 80 + LE-certificate for this cloud i set up nginx that the requested hostname X will be redirected trough the proxy-function to a client in my NATed network.\nAnd this redirect is also possible to another port, for example i said 83, and the external port would be still 80. It's like a load balancer, or webhosting. This nginx-server is just the man who passes the packets.. Hmmm that's a linux gateway. I am running termsrv on different ports outgoing and disabled RC4-ciphers. Of course it's a risk but the PC is online when i waked him up from outside and then i access immiedently on it so i think it's ok.. Hmm ok. I recreated the certificate. Thanks.. ",
    "enrmbigg": "Let's Encrypt have confirmed that they have permanently disabled TLS-SNI-01\nhttps://community.letsencrypt.org/t/2018-01-11-update-regarding-acme-tls-sni-and-shared-hosting-infrastructure/50188/3. ",
    "gherbstman": "This issue affect other apps as well. ConnectWise Labtech does not like hostnames in the bindings either. Is there any way to set parameters for WinSimple to tell it what it needs to function without using hostnames?. ",
    "gabrielpotumati": "is a server hosting with few sites. in the March 2017 version everything works fine, in version v1.9.7.2 some menus give this error, and in this last version, all options return this error.. Hi, thanks for the reply. Yes, all sites I can edit by GUI. The FerrarisIV solution did not work for me.\nhow do I make an anonymous version of applicationHost.config\nAnd where do I send it to you?\nThank you. hi guys, any news about this errors?. Hi WouterTinus follow the link http://equipea.com.br/aph.zip\nTks for u help!. ",
    "pbh-stu": "thank god for for v 1.9.3 :) managed to install 2 certs just now in seconds after spending a whole afternoon failing with the latest version on server 2012 R2, dot net could not load... issues all over the place. Keep up the good work though, been using certbot on linux for a long time and it's nice to have a solution for IIS as well.. @WouterTinus hi, I used whatever was already built in the bin folder. I also tried to rebuild, but I get this error \"ClickOnce does not support the request execution level 'requireAdministrator'.\". Perfect, great work. thank you. We'll now be using across our entire estate.\nAlthough is did only renew 1 of the 2 sites and i selected renew all. I was able to renew both certs using other options so it's all good.\n\n. ",
    "cts1085": "I attempted to follow the directions - including using a central ssl store \nI executed: ./letsencrypt --installation manual --centralsslstore C:\\Central_SSL\\\nI setup a comma separated list of hostnames (mail.host.com, server.host.com, autodiscover.host.com) and all sites verified and the pfx files are created in the folder - but when i issue a forcerenew after putting the new certificates in the store i get the following error: \n[INFO] Installing with Create or update IIS bindings...\n [EROR] Error updating binding 127.0.0.1:443:\nSystem.InvalidOperationException: Central SSL is not supported without a hostname\n   at LetsEncrypt.ACME.Simple.Clients.IISClient.CheckFlags(String host, SSLFlags flags)\n   at LetsEncrypt.ACME.Simple.Clients.IISClient.UpdateBinding(Site site, Binding existingBinding, SSLFlags flags, Byte[]\n thumbprint, String store)\n   at LetsEncrypt.ACME.Simple.Clients.IISClient.AddOrUpdateBindings(Target target, SSLFlags flags, CertificateInfo newCe\nrtificate, CertificateInfo oldCertificate)\n [EROR] Error installing\nSystem.InvalidOperationException: Central SSL is not supported without a hostname\n   at LetsEncrypt.ACME.Simple.Clients.IISClient.CheckFlags(String host, SSLFlags flags)\n   at LetsEncrypt.ACME.Simple.Clients.IISClient.UpdateBinding(Site site, Binding existingBinding, SSLFlags flags, Byte[]\n thumbprint, String store)\n   at LetsEncrypt.ACME.Simple.Clients.IISClient.AddOrUpdateBindings(Target target, SSLFlags flags, CertificateInfo newCe\nrtificate, CertificateInfo oldCertificate)\n [EROR] Unable to install certificate\nSystem.InvalidOperationException: Central SSL is not supported without a hostname\n   at LetsEncrypt.ACME.Simple.Clients.IISClient.CheckFlags(String host, SSLFlags flags)\n   at LetsEncrypt.ACME.Simple.Clients.IISClient.UpdateBinding(Site site, Binding existingBinding, SSLFlags flags, Byte[]\n thumbprint, String store)\n   at LetsEncrypt.ACME.Simple.Clients.IISClient.AddOrUpdateBindings(Target target, SSLFlags flags, CertificateInfo newCe\nrtificate, CertificateInfo oldCertificate)\n   at LetsEncrypt.ACME.Simple.Plugins.InstallationPlugins.IISInstaller.LetsEncrypt.ACME.Simple.Plugins.Interfaces.IInsta\nllationPlugin.Install(CertificateInfo newCertificate, CertificateInfo oldCertificate)\n   at LetsEncrypt.ACME.Simple.Program.OnRenewSuccess(ILifetimeScope renewalScope, ScheduledRenewal renewal)\n [INFO] Removing certificate from the Central SSL store\nIf i want to try the install command @WouterTinus suggested what is the proper way to \"undo\" what I have done? or is there something I am missing from my current install?\nThank you!. ok - this may have been my fault - i had a binding for 127.0.01 IP address that was not needed - when i removed the script ended with no errors - BUT - i am wondering if i did not use the exchange script if i am going to have problems going forward? thoughts?\n. so... it would be better to not use Central_SSL and then let the scripts do what they do? (At this point I only have one server so I don't really need Central_SSL - it just looked like it would be more transparent for me.  If that is the case - should I just \"reinstall\" using the above command?\n. So - just to confirm - is it \"safe\" to reinstall over an existing installation?. Perfect...  Ok - so i got the manual install of the \"ImportExchange.ps1\" script to start running during install. The only issue is that with using the Central_SSL store the certificate has to be manually imported to the local store for the script to \"see\" it - otherwise i got a thumbprint certificate not found message.\nalso, i did indicate that now the script starts - it does not end gracefully however.  Not sure what this means...\n```\n [INFO] Installation step 2/2: Run external script...\n [INFO] Script ./Scripts/PSScript.bat starting with parameters D:/letsencrypt/letsencrypt-win-simple.v1.9.8.1/scripts/ImportExchange.ps1 302AA8B540EE3BDAB15C55D6097D31E61D63AC80 IIS,IMAP,POP,SMTP\nIt appeared to timeout after 5 minutes:\n [INFO] D:\\letsencrypt\\letsencrypt-win-simple.v1.9.8.1>REM Generic batch script to execute powershell scripts along with positional parameters\nD:\\letsencrypt\\letsencrypt-win-simple.v1.9.8.1>REM Pass path to PS1 script as well as any parameters you want to pass\nD:\\letsencrypt\\letsencrypt-win-simple.v1.9.8.1>REM Spaces are not supported in script path\nD:\\letsencrypt\\letsencrypt-win-simple.v1.9.8.1>REM Ex. \"PSScript.bat c:\\scripts\\test.ps1 value\"\nD:\\letsencrypt\\letsencrypt-win-simple.v1.9.8.1>powershell.exe -ExecutionPolicy RemoteSigned -File D:/letsencrypt/letsencrypt-win-simple.v1.9.8.1/scripts/ImportExchange.ps1 02AA8B540EE3BDAB15C55D6097D31E61D63AC80 IIS,IMAP,POP,SMTP\n[WARN] Script execution timed out after 5 minutes, will keep running in the background\n```\nNote: I did need to Unblock-File the script to allow it to execute.\n. Also, just an FYI and this is probably my mistake - running my script multiple times created multiple scheduled renewals - I just cancelled the duplicates.\nThank you all for your patience with me  -- this solution is awesome!. Team: Note that I have combined the existing script with @LBegnaud and have something now that works for me.  If it helps I would be happy to post what I have done. Just let me know how...\nI needed to add 2 arguments, the TargetHost and the Central Store\n. BTW - I determined what was holding up the script for me and causing the timeout.  the script was asking for a confirmation so i needed to add the '-Force' or '-confirm:$false' as appropriate.\n. Here is the script: - I hope it makes sense...\n```\nparam(\n    [Parameter(Position=0,Mandatory=$true)]\n    [string]$NewCertThumbprint,\n    [Parameter(Position=1,Mandatory=$true)]\n    [string]$ExchangeServices,\n    [Parameter(Position=2,Mandatory=$false)]\n    [string]$TargetHost,\n    [Parameter(Position=3,Mandatory=$false)]\n    [string]$StorePath\n)\nWrite-Debug -Message ('NewCertThumbprint: {0}' -f $NewCertThumbprint)\nWrite-Debug -Message ('ExchangeServices: {0}' -f $ExchangeServices)\nWrite-Debug -Message ('TargetHost: {0}' -f $TargetHost)\nWrite-Debug -Message ('StorePath: {0}' -f $StorePath)\nImports new cert thumbprint into the Exchange roles defined in the $ExchangeServices comma-separate list\nexample: $ExchangeServices = IMAP,POP,IIS\nThat will import the certificate for IMAP, POP, and IIS roles in exchange\nValid services:  IMAP | POP | UM | IIS | SMTP | Federation | UMCallRouter\nTHIS SCRIPT IS INCOMPLETE AND UNTESTED\nDocumentation referenced from https://technet.microsoft.com/en-us/library/aa997231(v=exchg.160).aspx\nShould work with exchange 2007 and higher\nGet-PSSnapin -registered | ? {$.Name -match \"Microsoft.Exchange.Management.PowerShell\" -and ($.Name -match \"Admin\" -or $.Name -match \"E2010\" -or $.Name -match \"SnapIn\")} | Add-PSSnapin -ErrorAction SilentlyContinue\n$OldThumbprint = (Get-Item -Path RDS:\\GatewayServer\\SSLCertificate\\Thumbprint).CurrentValue\n$CertInStore = Get-ChildItem -Path Cert:\\LocalMachine -Recurse | Where-Object {$_.thumbprint -eq $NewCertThumbprint} | Sort-Object -Descending | Select-Object -f 1\nif($CertInStore.PSPath -notlike \"*LocalMachine\\My*\"){\n    \"Cert thumbprint not found in the cert store... which means we should load it.\"\n    if ($StorePath -and $TargetHost){\n        \"Try to load certificate from store\"\n        $importExchangeCertificateParameters = @{\n        FileName = (Join-Path -Path $StorePath -ChildPath \"$TargetHost.pfx\")\n        FriendlyName = $TargetHost\n        PrivateKeyExportable = $true\n    }\n    $newExchangeCertificate = Import-ExchangeCertificate @importExchangeCertificateParameters -ErrorAction Stop\n# Now try to find it again...\n$CertInStore = Get-ChildItem -Path Cert:\\LocalMachine -Recurse | Where-Object {$_.thumbprint -eq $NewCertThumbprint} | Sort-Object -Descending | Select-Object -f 1\n} else {\nthrow 'Certificate not found and no certificate store or Target Host provided, can NOT enble the new certificate.'\n}\n\n}\ntry{\n    # Cert must exist in the personal store of machine to bind to RD Gateway\n    if($CertInStore.PSPath -notlike \"*LocalMachine\\My*\"){\n        $SourceStoreScope = 'LocalMachine'\n        $SourceStorename = $CertInStore.PSParentPath.split(\"\\\")[-1]\n    $SourceStore = New-Object  -TypeName System.Security.Cryptography.X509Certificates.X509Store  -ArgumentList $SourceStorename, $SourceStoreScope\n    $SourceStore.Open([System.Security.Cryptography.X509Certificates.OpenFlags]::ReadOnly)\n\n    $cert = $SourceStore.Certificates | Where-Object {$_.thumbprint -eq $CertInStore.Thumbprint}\n\n\n\n    $DestStoreScope = 'LocalMachine'\n    $DestStoreName = 'My'\n\n    $DestStore = New-Object  -TypeName System.Security.Cryptography.X509Certificates.X509Store  -ArgumentList $DestStoreName, $DestStoreScope\n    $DestStore.Open([System.Security.Cryptography.X509Certificates.OpenFlags]::ReadWrite)\n    $DestStore.Add($cert)\n\n\n    $SourceStore.Close()\n    $DestStore.Close()\n\n    $CertInStore = Get-ChildItem -Path Cert:\\LocalMachine\\My -Recurse | Where-Object {$_.thumbprint -eq $NewCertThumbprint} | Sort-Object -Descending | Select-Object -f 1\n}\nEnable-ExchangeCertificate -Services $ExchangeServices -Thumbprint $CertInStore.Thumbprint -Force -ErrorAction Stop\n\"Cert thumbprint set to the following exchange services: $ExchangeServices\"\n\n}catch{\n    \"Cert thumbprint was not set successfully\"\n    \"Error: $($Error[0])\"\n}\n\"Now Remove old certs?\"\n    Get-ExchangeCertificate -DomainName $TargetHost | Where-Object -FilterScript {\n        $_.Thumbprint -ne $newCertThumbprint\n    } | Remove-ExchangeCertificate -Confirm:$false\n```\n. No difference for me - i am not looking for the credit or glory, just want to see a successful solution! I appreciate your assistance!. Yes - I have tested the script - the \"install cert\" does not run if the cert is already present. I created a command line to test the script outside of the let's encrypt process to make sure it would load and remove as expected.  The target host is the FQDN of exchange - this may be one area that needs improvement for those with multiple exchange server installations. In my case the targethost is the same as the cert name loaded into exchange.. I like the comments - the only suggestion i have is for the comment on the StorePath - this is the \"Source\" of the certificate if not loaded into LocalMachine/My location. It will be \"found\" in this location if needed. It is only needed if the SSL certs are located in a central SSL store.. ok - it does look like some error checking is missing:\nPseudo logic:\nfind cert locally\nif not found and using central store try to load cert locally from central store\nfind cert locally again within load cert process\nif cert not found locally - exit with error - do not execute binding or cleanup\nbind certificate to exchange\nonly if successful - and requested - clean up old certs\n. Good point - let me test and see if this is the case.  I just don't know if load cert from the central store fails if that will be caught.. ok - the boolean logic for the clearing of old certs seems to be backwards from the comments - to remove the certs the comments say to have an argument of 1 but 1 will cause them to be left alone - seems backwards . Ah - seems the data type for parameter two is wrong - should be LeaveOldExchangeCerts not $LeaveOldExchangeCerts - thinks it should be a string not a boolean..\nI searched the net and found this solution:\n```\n  [Parameter(Position=2,Mandatory=$false)][ValidateSet(\"true\",\"false\")]\n    [string]$LeaveOldExchangeCerts = \"true\",\n...\nif($LeaveOldExchangeCerts -ne \"true\"){\n        \"Old Exchange certificates being cleaned up\"\n        Get-ExchangeCertificate -DomainName $CertInStore.Subject.split(\"=\")[1] | Where-Object -FilterScript {\n            $_.Thumbprint -ne $NewCertThumbprint\n        } | Remove-ExchangeCertificate -Confirm:$false\n    }\n```\nAlso - the try catch worked - but i got an error on the catch:\nCert thumbprint was not set successfully\nError: You cannot call a method on a null-valued expression.\nMaybe a \"Throw\" would be better????. I think the PSScript.ps1 wrapper is going to make this difficult. I tried it direct and the bool works - via PSSCript.ps1 and it does not.\nFor example:\n./Scripts/PSScript.bat ./scripts/ImportExchange2.ps1 CC37AC4D03F0FF275FE4B5EA2EE60F42D6F56570 IIS,IMAP,POP,SMTP 1 mail.domain.com C:\\Central_SSL\n. Tried that as well - it passed the $True as a string and not a boolean.. It never gets to the \"write-debug\". I hope you can make it work - it would be \"cleaner\". ",
    "johlju": "I configured this a couple of weeks back. I made my own small script that update the script using Exchange PowerShell Cmdlets. I can post what I did tomorrow. The wiki page seemed old and didn\u2019t help. Happy to share my steps so others can confirm or find bugs. Then we can get proper steps in the wiki. :smile:. The steps I did.\nPrerequisites\nDid this manually, one time thing.\npowershell\nNew-Item -Path C:\\inetpub\\wwwroot\\.well-known\\acme-challenge -ItemType Directory -Force\nCopy-Item -Path 'C:\\letsencrypt\\Web_Config.xml' -Destination 'C:\\inetpub\\wwwroot\\.well-known\\acme-challenge\\web.config' \nNew-Item -Path C:\\letsencrypt\\Central_SSL -ItemType Directory\nSet-Location C:\\letsencrypt\n\nDisable Require SSL on the new folder in IIS Manager. \nMake sure port 80 is open in the firewall (both external and internal Windows firewall).\n\nPSScript.bat\nLocation:  C:\\letsencrypt\\scripts\nThis might be the original one that came with 'letsencrypt.exe'.\n```plaintext\nREM Generic batch script to execute powershell scripts along with positional parameters\nREM Pass path to PS1 script as well as any parameters you want to pass\nREM Spaces are not supported in script path\nREM Ex. \"PSScript.bat c:\\scripts\\test.ps1 value\"\npowershell.exe -ExecutionPolicy RemoteSigned -File %*\n```\nConfigureExchangeCertificate.ps1\nLocation: C:\\letsencrypt\\scripts \n```powershell\n[CmdletBinding()]\nparam(\n    [Parameter(Position=0, Mandatory=$false)]\n    [System.String]\n    $TargetHost,\n[Parameter(Position=1, Mandatory=$false)]\n[System.String]\n$PfxPassword,\n\n[Parameter(Position=2, Mandatory=$false)]\n[System.String]\n$StorePath\n\n)\nWrite-Debug -Message ('TargetHost: {0}' -f $TargetHost)\nWrite-Debug -Message ('PfxPassword: {0}' -f $PfxPassword)\nWrite-Debug -Message ('StorePath: {0}' -f $StorePath)\nWrite-Verbose 'Add Exchange snap-ins.' -Verbose\nAdd-PSSnapin -Name 'Microsoft.Exchange*' -ErrorAction Stop\nWrite-Verbose 'Import new certificate' -Verbose\n$importExchangeCertificateParameters = @{\n    FileName = (Join-Path -Path $StorePath -ChildPath \"$TargetHost.pfx\")\n    FriendlyName = $TargetHost\n    PrivateKeyExportable = $true\n}\nif ($PfxPassword)\n{\n    $importExchangeCertificateParameters['Password'] = $PfxPassword\n}\n$newExchangeCertificate = Import-ExchangeCertificate @importExchangeCertificateParameters -ErrorAction Stop\nif ($newExchangeCertificate)\n{\n    Write-Verbose 'Enable new certificate' -Verbose\nEnable-ExchangeCertificate -Thumbprint $newExchangeCertificate.Thumbprint -Services 'IIS,POP,IMAP,SMTP' -Force -ErrorAction Stop\n\nWrite-Verbose 'Remove old certificate(s)' -Verbose\n\n# TODO 1: Enable this when certain everything works.\n# TODO 2: This is hard-coded to a specific domain.\n<#\nGet-ExchangeCertificate -DomainName 'mail.company.com' | Where-Object -FilterScript {\n    $_.Thumbprint -ne $newExchangeCertificate.Thumbprint\n} | Remove-ExchangeCertificate\n#>\n\n}\nelse\n{\n    throw 'Certificate faild to import into Exchange (certificate store), can NOT enble the new certificate.'\n}\n```\nAnd this creates the certificate and runs the script.\n```powershell\nMust be run in PowerShell Console (not ISE)\n.\\letsencrypt.exe --centralsslstore C:\\letsencrypt\\Central_SSL\\ --plugin manual --manualhost \"mail.company.com,autodiscover.company.com\" --accepttos --emailaddress myemail@company.com --validationmode http-01 --validation selfhosting --verbose --script C:\\letsencrypt\\scripts\\PSScript.bat --scriptparameters 'C:\\letsencrypt\\scripts\\ConfigureExchangeCertificate.ps1 {0} \\\"{1}\\\" {3} -Verbose' --usedefaulttaskuser\n```\n. @nemchik Great! Tag me when you have sent in the PR and I can help review.. Maybe we should make this a ValidateSet() with the possible values 'IMAP', 'POP', 'UM',  'IIS', 'SMTP', 'Federation', 'UMCallRouter'. Could we use $true and $false instead of 0 and 1?. We can remove this comment.. Does Sort-Object -Descending by default sort on the correct date field, so that the newest are on top? . Could we add comment-based help with a .SYNOPSIS,  and an .EXAMPLE in the comment-based help how to call this using Let's encrypt? If there are more than one option to call we should add more than one .EXAMPLE.. We should not need to do this, Import-ExchangeCertificate returns the certificate if you add $CertInStore = Import-ExchangeCertificate @importExchangeCertificateParameters -ErrorAction Stop or throws an error (stops) if it can't find the certificate.\nIf you keep this row, the same comment about -Descending as above.. Question: Are we using this code path as a fail safe if the Import-ExchangeCertificate did not add the certificate to the LocalMachine\\My store? Is there a scenario when Import-ExchangeCertificate does not import the certificate to the LocalMachine\\My store?. > $CertInStore.Subject.split(\"=\")[1]\nCould we use $TargetHost instead of this? . > \"Error: $($Error[0])\"\nCould we use throw $_ instead, to throw a real error? Or after this row maybe?. Looks good to me.. Since it is not certain that $TargetHost and $StorePath is passed, then if they are not, we should not go down this code path since Import-ExchangeCertificate will fail.\nSo we should add something like\nif ($TargetHost -and $StorePath)\n{ \n    ...\n    $null = Import-ExchangeCertificate @importExchangeCertificateParameters -ErrorAction Stop\n    ...\n}. We expect the certificate to me in LocalMachine\\My. Why don't we just look for it there?\n```\n$CertInStore = Get-ChildItem -Path Cert:\\LocalMachine\\My | Where-Object {$_.thumbprint -eq $NewCertThumbprint}\ntry\n{\n    if (-not $CertInStore)\n    {\n        ...\n        $null = Import-ExchangeCertificate @importExchangeCertificateParameters -ErrorAction Stop\n        ...\n    }\n}. If we do the change above, and below, then this row is not needed.. We could use the same check as above here.\ntry\n{\n    if (-not $CertInStore)\n    {\n        ...\n        $SourceStoreScope = 'LocalMachine'\n        $SourceStoreName = 'My'\n        ...\n    }\n}. We could just do $CertInStore = Import-ExchangeCertificate ... here and skip the row below.. Okay. Didn't thought about that. Looks good to me.. Okay. Your way works as well if outputting is the only requirement and not stopping execution telling the user something failed with red error text. :)\nLooks good to me.. ",
    "joebartlett94": "PSScript.bat doesn't seem to pass the boolean through properly - I got it working by changing -File to -Command, as described in this StackOverflow answer.\nI also had to wrap my list of services to apply to in single quotes.. ",
    "KiwiMorpheus": "Some new ones get added, some old ones get deleted.\nI think really I'm asking is the renewal process able to detect the new sites and install the new certificates.\nActually the more I think about this the more I see the problems this entails. I think I will just document the add new site to Let's Encrypt process and run that as part of a setting up a new IIS site procedure.. ",
    "alan-strickland": "I am also getting the error \"[EROR] Unable to find validation plugin http-01\", but unlike the above with verbose mode enabled it is able to find the plugin iisites.\nDid you find a solution to this?\nVersion: 1.9.8.1\nletsencrypt.exe --verbose --plugin iissites --siteid 13,14 --emailaddress xxxxx@example.com --accepttos --usedefaulttaskuser --warmup\n```\n [DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [VERB] Using registry key HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\n [VERB] Settings SettingsService {ConfigPath=\"C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\", RenewalStore=null, HostsPerPage=50, ScheduledTaskRandomDelay=00:00:00, ScheduledTaskStartBoundary=09:00:00, ScheduledTaskExecutionTimeLimit=02:00:00}\n [VERB] .NET Framework >=4.7 detected\n[INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Software version 198.1.6583.38308 (RELEASE)\n [INFO] IIS version 10.0\n [INFO] ACME Server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n [VERB] Verbose mode logging enabled\n[DBUG] Renewal period: 55\n [INFO] Running in unattended mode.\n [DBUG] Scanning IIS sites\n [INFO] Plugin IISSites generated target [IISSites] 13,14 (SiteId -1) [3 bindings - xxx@example.com, ... @ x]\n [EROR] Unable to find validation plugin http-01.\n```. Yes thank you, worked for me too.. ",
    "DiginessForever": "This command works, thank you for the help WouterTinus!\nletsencrypt-win-simple.v1.9.8.1>letsencrypt.exe --test --plugin iissites --siteid 1,2 --emailaddress myEmail@gmail.com --accepttos --notaskscheduler --validation selfhosting\nNow I'm just fiddling with it to get rid of any prompts / pre-specify the options if I can.  Going to try to have it run completely autonomously via scripts (of course once everything has been done, take off the --test before going to production).. ",
    "PatrickRUG": "I think if we remove the OrderBy(s => s.Name) in IISClient.cs and remove the OrderBy(target => target.Host) in IISSite.cs we have full control over which site we want to use for the CN.\nThan the way we order the parameter of the provided site IDs (example: --siteid 3,2,4) is the way we can control which one will be the CN. By default the ServerManager gets the Sites ordered by SiteID.\n@WouterTinus is this maybe an option to consider?\nNot entirely sure if it works.... ",
    "georg-jung": "See my PR #835 which is going to give you this option.. I totally agree with you: \"doing this right\" is the way to go. I was just lacking your broader view of the project to see the changes needed. As far as I can see I just implemented all the things you pointed out. Do you think there's anything more to do?. I'm working on getting CI up and running for the project to prevent things like this in future.. I think what we want to achieve is something like this. For making this work we need to change GitHub's webhook settings. After doing this, PRs should automatically work and look like this one for example. Seems like they did not need to change their appveyor.yml to achieve this.. Let's Encrypt uses the Public Suffix List for their rate-limiting. Just the portion before a public suffix is considered a \"registered domain\", for which the limits apply.  Unfortunately your DynDNS provider dlinkddns.com is not listed as a public suffix, which may lead to many other problems than just not getting LE certificates (see the list's website for more examples). I think you could either reach out to your DDNS provider to get them listed or it might be a good idea to change the provider, if they don't stick to those standards, which might be security relevant too.\nReverting the changes done by win-acme:\n\nIf win-acme was unable to get a valid certificate it should not have run any installation steps, so your IIS config should be unchanged. Maybe @WouterTinus or another member of PKISharp can confirm this.\nFurthermore win-acme saves it's settings to file on your system, so you might consider deleting C:\\ProgramData\\win-acme and the folder containing letsencrypt.exe \"to revert ALL change\".\nPart of those settings is your registration at Let's Encrypt which is why you were not asked for your e-mail address (and ToS) the second time.\nAdditionally win-acme probably wrote some logging info to your windows event log.\n\nThis list is not intended to be exhaustive.. While I'm not quite an expert for AppVeyor too I wouldn't mind trying my best.. ",
    "happycxz": "Thanks Wouter Tinus, I had fixed my problem.. ",
    "scleach": "Hey thank you for the response, with a little playing around I was able to generate the 3 certificates needed  using LEWS version 1.8 for the main site and the subdomains.  Just have to figure how to get the all to auto-update. \nbtw Great program, thanks!!. ",
    "gusarov": "OK, I just checked on 1.9.8.2 - same thing. I've Ctrl+H-ed my domain name on the output\n[INFO] Renewing certificate for b.xxxxxx.xxx\n [DBUG] Scanning IIS site bindings for hosts\n [DBUG] Loading signer from C:\\Users\\xa\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\Users\\xa\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: b.xxxxxx.xxx\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Cached authorization result: valid\n [DBUG] Certificate folder: C:\\Users\\xa\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Certificate store: WebHosting\n [DBUG] RSAKeyBits: 2048\n [INFO] Requesting certificate b.xxxxxx.xxx 2018/1/24 11:34:57 AM\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n [INFO] Saving certificate to C:\\Users\\xa\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n [VERB] Converting private key...\n [DBUG] Set private key exportable\n [INFO] Installing certificate in the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Adding certificate b.xxxxxx.xxx 2018/1/24 11:34:57 AM to store WebHosting\n [VERB] CN=b.xxxxxx.xxx - CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US (CC9CA68FD00BABAFEB4EC042ED083FEC61B98C82)\n [VERB] CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US - CN=DST Root CA X3, O=Digital Signature Trust Co. (E6A3B45B062D509B3382282D196EFE97D5956CCB) to CA store\n [VERB] CN=DST Root CA X3, O=Digital Signature Trust Co. - CN=DST Root CA X3, O=Digital Signature Trust Co. (DAC9024F54D8F6DF94935FB1732638CA6AD77C13) to AuthRoot store\n [DBUG] Closing certificate stores\n [INFO] Installing with Create or update IIS bindings...\n [INFO] Updating existing https binding b.xxxxxx.xxx:443\n [INFO] Committing 1 binding changes to IIS\n [INFO] IIS will serve the new certificates after the Application Pool IdleTimeout has been reached.\n [INFO] Uninstalling certificate from the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Removing certificate b.xxxxxx.xxx 2018/1/20 5:00:13 PM from store WebHosting\n [DBUG] Closing certificate store\n [INFO] Renewal for b.xxxxxx.xxx succeeded\n [INFO] Next renewal scheduled at 2018/3/20 11:34:59 AM\nlooks like there is nothing strange in log, but besides that, my site a.xxxxxx.xxx in IIS binding now also have this new certificate for b.xxxxxx.xxx. And of course it is not opening in browser, until I manually choose proper certificate in IIS.. No, they are all \"*\"\nAre you saying you can't reproduce this? Because I think as long as you have any public 2nd level domain it is trivial to reproduce and add some logging e.t.c.... You know what? You are right... I just realized that when I change certificate manually on A to A, it is changed also on B to A... right in IIS Manager! And vice versa. Without any external tool... This is ridiculous. It happens on Azure hosted Windows 2016 but it is not happens on local Windows 10. My eyes can't believe that... I don't know what to do now :) I'll try to make a new site.... I think I know the source of an issue... When I removing binding and creating new one it says:\nAt least one other site is using the same HTTPS binding and the binding is configured with a different certificate. Are you sure that you want to reuse this HTTPS binding and reassign the other site or sites to use the new certificate?\nAnd I just noticed that checkbox 'Require Server Name Indication' is not set... If I set this for both site, everything works perfectly. On my local Win10 machine this check box is checked from the beginning (the ssl binding been added by LEWS). But in my server the binding been added in the previous version of LEWS... And looks like it been initially added without the checkbox. So, May be the best solution would be to assign this binding property even for updates? As far as I can see, I got SSLFlags.SNI for a new binding, but when updating, this flag not been set (just copied from existing binding). Maybe it makes sense to do only if host header is specified...\nUPD: yep, that's exactly what is happening for new binding now:\nif (!string.IsNullOrEmpty(host) && Version.Major >= 8)\n            {\n                flags |= SSLFlags.SNI;\n            }. this is a verbose output (binding deleted manually, 2nd attempt - with cached certificate)\n[INFO] Plugin IISBinding generated target [IISBinding] xxx.yyy (SiteId 5) [ @ C:\\inetpub\\xxx.yyy]\n[DBUG] Scanning IIS site bindings for hosts\n[DBUG] Loading signer from C:\\Users\\xxx\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\n[DBUG] Getting AcmeServerDirectory\n[DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n[DBUG] Loading registration from C:\\Users\\xxx\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\n[INFO] Authorize identifier: xxx.yyy\n[DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n[INFO] Cached authorization result: valid\n[DBUG] Certificate folder: C:\\Users\\xxx\\AppData\\Roaming\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n[DBUG] Certificate store: WebHosting\n[DBUG] Set private key exportable\n[WARN] Using cached certificate for xxx.yyy 2018/3/3 8:48:22 PM. To force issue of a new certificate within 24 hours, delete the .pfx file from the CertificatePath or run with the --forcerenewal switch. Be ware that you might run into rate limits doing so.\n[WARN] Certificate with thumbprint 22190D7FD8AxxxxxxxxxxxxEAD74B6456E3F11C3 is already in the store\n[INFO] Installing with Create or update IIS bindings...\n[INFO] Adding new https binding xxx.yyy:443\n[INFO] Committing 1 binding changes to IIS\n[INFO] IIS will serve the new certificates after the Application Pool IdleTimeout has been reached.\n[INFO] Deleting existing task letsencrypt-win-simple httpsacme-v01.api.letsencrypt.org from Windows Task Scheduler.\n[INFO] Adding Task Scheduler entry with the following settings\n[INFO] - Name letsencrypt-win-simple httpsacme-v01.api.letsencrypt.org\n[INFO] - Path C:\\Apps\\LetsEncrypt\n[INFO] - Command letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\n[INFO] - Start at 09:00:00\n[INFO] - Time limit 02:00:00\n[DBUG] Creating task to run with previously chosen credentials\n[INFO] Adding renewal for xxx.yyy\n[INFO] Next renewal scheduled at 2018/4/27 8:48:22 PM. By kernel bindings you mean\nnetsh http show iplisten\n?. But this is not a problem. Default kernel binding is 0.0.0.0 and if there is a custom set of interfaces (like in my case) the binding for the same site wouldn't hurt, it can't interfer with a set of web sites... This is a bindings for http.sys driver, not for iis, even if it gets entire 0.0.0.0 web site can choose whatever it wants. And even if there is 0.0.0.0 on a web site, but only 10.0.0.2 on http driver, web site would only respond to 10.0.0.2 (while other software could use 80 port on other addresses). So, iis goes via http driver and can use only those interfaces that is bunded to driver. How that can be a problem?. This is interesting. I've seen such problem indeed. But I've solved this on IIS level, after some reconfiguration. Just realized there is a 'netsh http show sslcert' section, I never configured this manually yet... So, you mean via API call it will add *:10.0.0.2 here even if there is a host header in a call?. hm, yep, thanks, now I can see the error...\n[EROR] ACME server reported:\n[EROR] [type] urn:acme:error:dns\n[EROR] [detail] DNS problem: SERVFAIL looking up A for xxx.yyy\n[EROR] [status] 400\nBut this is strange :( it resolves everywhere perfectly. May be you've seen something like this already?. Looks like my DNSSEC settings are off... I'm trying to reconfigure. All dns sec tests are now green... But I still getting the error\n[EROR] Authorization result: invalid\n [DBUG] Deleting web.config\n [VERB] Deleting file ...\\acme-challenge\\web.config\n [DBUG] Deleting answer\n [VERB] Deleting file ...\\acme-challenge\\7gOwErOt0JS-BngHOI1UPIxxxxxNDJnyEEZFsN92EJI\n [VERB] Deleting folder ...\\acme-challenge\n [VERB] Deleting folder ...\n [EROR] ACME server reported:\n [EROR] [type] urn:acme:error:unauthorized\n [EROR] [detail] Invalid response from http://xxx.yyy/.well-known/acme-challenge/7gOwErOt0JS-BngHOI1UPIxxxxxNDJnyEEZFsN92EJI: \"?<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n<meta charset=\"utf-8\" />\n<meta name=\"viewport\" content=\"wi\"\n [EROR] [status] 403\n [EROR] Renewal for xxx.yyy failed, will retry on next run. I've tried to reproduce the let's encrypt request... to do that I need the tool to stop when answer files and web config are populated. I've denied 'delete' to keep those files.\nThen I issued the request by fiddler (because browser is not able to connect to HTTP when site is HSTS & HSTS preloaded). And now I see that this is CloudFlare which is configured to force HTTPS and it responded with 302 redirect...\nThe sad story here - I still can't find the CloudFlare rule to disable redirect for the pattern (can only enable for the wildcard pattern). Then I realized that my 'Always use HTTPS' already disabled (and this is configured in root web config). So, I've temporary removed all redirects, configured the acme web config with static file so that it is now able to serve it (on a server itself, without cloudflare). Also, CloudFlare connects to my server only via HTTPS (this is another setting), which should not be a problem (while I'm updating certificate in time). But still, it gives me 302... I think because of HSTS enabled on cloudflare.... looks like this is not CloudFlare... this is my iis now who forces SSL for root page... This is actually intended :) but now I'm just curious why I'm unable to disable this :)\nI've even added this but it still forces redirect\n<security>\n            <access sslFlags=\"None\" />\n        </security>\nI mean, disabling 'Always use HTTPS' is enough and fair for this purpose... the 'well known' now works.. Can I keep /.well-known/acme-challenge/web.config permanently? I've denied an access to this and now letsencrypt.exe fails because of this... \"web.config is denied\"\nHow can I make use of this option and prevent copying web.config template?. ManualTargetIsIIS = false?. ",
    "cdebel2005": "Thanks a lot for your help.  I'll look forward this new version and will try another method.. ",
    "davidgeary": "This article gives a date of 27 February 2018 for public support.. ",
    "Gruski": "Still getting a \"wildcard certificates are not supported\" message in .v1.9.12. Has this not been implemented yet?. ",
    "nom3d": "I still do not understand, I type N for new certificate, then 4 for manual input, then I type mydomian.com and then 5 for self host verification, then is asks which installer, this is where I'm lost, What is an external script? Are there examples? What does this ext script do? Is there somewhere that I need to input the path of where the website is hosted (C:\\xampp\\htdocs\\servername)? Is this letsencrypt.exe supposed to be run from the same computer that is running the server? Can this work with XAMPP? Thank you for your hard work, I'm just trying to understand how to do this, perhaps I can help you make this more clear for others like me who don't quite get it... Is there a way to direct message you? I'm running XAMPP php 7.2.1 on Windows 7 Pro. I'd like to create a step by step guide for how to do this with my setup. I think I need something that goes question by question 1 at a time specific for XAMPP on Windows.. I found a site that worked for me.. https://www.sslforfree.com/\nI did try using the verify by FTP, it uploaded the files to the .wellknown/acme-challenge/ folder but then failed with Error authorizing [manual] [1 binding - myserver.com]. ",
    "earth55": "I successfully got a certificate by using the 'M' option.\nI appreciate your information!. ",
    "Unknown6656": "My problem is that I cannot remove the A record.\nI have it pointed to an invalid IP-Address, but it still exist. Is there a possibility to force Let'sEncrypt to ignore the A-record?. On your security concern, I concur.\nHowever, it would be bad for me ..... oh well....\nThank you very much anyway for your support, Sir.. ",
    "Ciwan1859": "Thank you @WouterTinus, that makes sense. Much appreciated. I'm loving this tool!. ",
    "JCH2k": "Having this issue, too... Changed nothing, but have \"No DNS identifiers found\" since may.. I use Win10 and Apache HTTPd.\n\"Solved\" the problem by deleting my configuration and creating a new one.. ",
    "lexo13": "same for my sub domain on 1.9.11.2. Windows 2013\nIis 8\nYes my website is correctly binding\nFranck\nLe mer. 22 ao\u00fbt 2018 \u00e0 13:08, Christopher Cook notifications@github.com a\n\u00e9crit :\n\nFor those experiencing this issue, what OS version are you on, what\nversion of .Net do you have installed? Can you confirm your website has\nexplicit hostname bindings present for your domain(s)?\n\u2014\nYou are receiving this because you commented.\nReply to this email directly, view it on GitHub\nhttps://github.com/PKISharp/win-acme/issues/725#issuecomment-414996156,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ALSF1pRJV1p2s4B1heYR9F1VLM6VJKENks5uTTucgaJpZM4Ry55L\n.\n. \n",
    "ferital": "it's running on another computer now (other configuration?)\nthank you. ",
    "sanketmthakare": "anyone got solution for this. ",
    "sajxe": "Great! I will try to make a new cert again this weekend and see if it works, thank you so much!\nUpdate: I deleted all the files in the cache, all the existing https bindings in IIS, and the test cert in My/Personal, then I ran win-simple again. Everything went very smoothly and my new cert was issued with no problems. Thank you very much once again for all your help! :). ",
    "hardhub": "What is default one if not specified (by default)?. ",
    "doronsd": "I did: letsencrypt.exe --plugin manual --manualhost www.domain.com,domain.com --siteid 1 --validationmode http-01 --validation iis\nGetting error: Validation plugin IIS is unable to validate target\nI don't know how to use the selfhosting with -script, do have any samples?. using --plugin iissite runs on all bindings (I have more than 300 there) and all of them already have certificates, how can I target only bindings without certificate? using --excludebindings is not an option cuz of the long long list.\nWhy am I getting erros when I did: letsencrypt.exe --plugin manual --manualhost www.domain.com,domain.com --siteid 1 --validationmode http-01 --validation iis\nGetting error: Validation plugin IIS is unable to validate target.\nsorry for my poor english.. works fine using:\nletsencrypt.exe --plugin manual --manualhost www.domain.com,domain.com --siteid 1 --webroot c:\\www\\website\\\nEdit:\nThe above does not create\\update bindings, am I missing command?\nEdit 2: \nI was missing \"--installationsiteid 1 --installation iis\"... the new command:\nletsencrypt.exe --plugin manual --manualhost www.domain.com,domain.com --webroot c:\\www\\website\\ --installation iis --siteid 1 --installationsiteid 1\nThanks. ",
    "Ivn78": "Apache 2.4 supports the Certificate Chain in the SSLCertificateFile parameter. Thus, the config can be written as follows:\nDefine CERTROOT \"C:/web/cert\"\nDefine SITEROOT \"C:/web/www\"\n....\n<VirtualHost *:443>\n    ServerName domain.com\n    DocumentRoot \"${SITEROOT}/domain.com\"\n....\n    SSLEngine on\n    SSLCertificateFile \"${CERTROOT}/domain.com-chain.pem\"\n    SSLCertificateKeyFile \"${CERTROOT}/domain.com-key.pem\"\n</VirtualHost>\nI also wrote the bat script to copy the certificate files from the default folder to the server folder:\n@echo off\nif \"%~1\" == \"\" exit\nset certlist=ca-%3-crt.der,ca-%3-crt.pem,%3-all.pfx,%3-crt.der,%3-chain.pem,%3-crt.pem,%3-csr.pem,%3-key.pem\necho Script running...\nfor %%a in (%certlist%) do (\n    copy /y \"%AppData%\\letsencrypt-win-simple\\%1\\%%a\" \"%2\\\" >nul && echo. [INFO] Install %%a to Certificate Store in %2... OK || echo. [WARN] Install certificate %%a fieled!\n)\necho. [INFO] Restarting service(s)...\nhttpd.exe -k restart\necho. [INFO] Service(s) restarted.\necho. [INFO] Script finished.\nThis script is called with parameters:\nLEWSuriDirectory CertFolder DomainName\nFor example:\nletsencrypt.exe --script \".\\scripts\\installcert.cmd\" --scriptparameters \"httpsacme-v01.api.letsencrypt.org C:\\web\\cert domain.com\". Specify all the command-line options that you use at run letsencrypt.exe.. You have an error in the parameters. Try this:\nletsencrypt.exe --baseuri https://acme-v01.api.letsencrypt.org --plugin manual --manualhost www.domainname.com --webroot \"C:\\htdocs\\www\\mywebsiteroot\". With XAMPP I didn't work, try using this manual. As far as I understand, error 404 has nothing to do with certificates. Bring the contents of httpd-vhosts.conf and httpd.conf. And more httpd-ssl.conf please. Try this: replace DocumentRoot \"C:/Users/Yes/Desktop/Servers/XAMPP/htdocs\" on DocumentRoot \"C:/Users/Yes/Desktop/Servers/XAMPP/htdocs/thefriendlyfire.one in httpd-ssl.conf. Have you restarted Apache after changes?\nAnd try comment string Include conf/extra/httpd-ssl.conf in httpd.conf. @DumbJoe, better to amend step 3 for output for latest version 1.9.8.4. It is very different, and takes less space :-). I've talked about it here: https://github.com/Lone-Coder/letsencrypt-win-simple/issues/738#issuecomment-364340418 I will try in the near future to rewrite the article in a wiki. Done. :-). Perhaps we should add timeout after calling the script to add a record, say, 60 seconds? After all, in almost every case, such a pause is necessary to update the DNS. And if the user needs more time, you can add an optional --timeout parameter.. winacme.exe :). Do not use environment variables. Specify the path as C:\\inetpub\\wwwroot. Yeah, it really works. Excuse me.. Maybe I don't understand something, but if the task already exists in the scheduler, it contains the path to the executable file of the previous version. And running a new version and getting certificates with it does not change anything, unless you force a task to be re-created. Therefore, I think it is quite possible to create new tasks with a new name executable file.\nCan you run the new version to ask the user to Update the task? (y/n): And update already with a new name exe.. And the application folder name also remained the same. Offer the clean install and rename it :). Is it possible to pass the certificate name as the first parameter to --scriptparametres?. Why 8? :) If the process of obtaining certificates is automated, then to automate their use, for example, together with Apache, the script must know the name of the certificate. Previously, when files had domain names, it was easier.. Understood, thanks!\nAnd yet in the parameters is not enough to transfer the name with characters. This is necessary, for example, to rename the certificate files for future use.\nIt would be great if you added it.. Before the identifier is translated to {id}.pem, the user script knows nothing about this ID. My script works like this: the certificate files are copied from the CertificatePath to the installation directory of Apache. Accordingly, in order to copy and rename them according to the domain name, the script needs to know this ID.. That's enough. Thanks. Parameters --script and --script parametres do not work in any mode.. When using the new parameters --store pemfiles and --pemfilespath \"%ApacheSertFolder%\" the installation script now requires only a reboot Apache command C:\\Apache24\\bin\\httpd.exe -k restart :-). I apologize, did not read the updates ReadMe.. ",
    "tschallacka": "Added it under basic usage, https://github.com/Lone-Coder/letsencrypt-win-simple/wiki/Apache-2.4-Basic-usage. If you wonder about the difference, I'm using standalone apache from apache haus, not xampp or any other mix mash.. Like I said, I'm using the apache download from apache haus. Not xampp, xammp is a whole other beast, with custom configs, and other things. I usually stay way way away from xamp and such varieties and just set up apache and php and mysql seperately with my own settings.\nI have no idea what files xamp has pre-configured and set up to use that differs from the original. These apache from apache haus behaves the same as the apache you install on linux, with same configuration files etc...\nYou will have to take it up with xampp to configure ssl certificates the xampp way, or experiment around with xampp and then post a tutorial for xampp.. @DumbJoe can you make a wiki entry for Xampp? so others can avoid the struggle you had?. ",
    "SASFMONTOYA": "I tried to do the guide but I still can not install it\n :c. ",
    "Mangaard": "Thanks for the answer,\n\"Microsoft RSA SChannel Cryptographic Provider\" is installed and enabled - see copy of Result in Powershell:\nPS C:\\Users\\Public\\Downloads\\letsencrypt-win-simple.v1.9.8.4\\scripts> Get-CSP\nName                                                                                                 Type                                                                                              \n----                                                                                                 ----                                                                                              \nMicrosoft Base Cryptographic Provider v1.0                                                           RSA Full (Signature and Key Exchange)                                                             \nMicrosoft Base DSS and Diffie-Hellman Cryptographic Provider                                         DSS Signature with Diffie-Hellman Key Exchange                                                    \nMicrosoft Base DSS Cryptographic Provider                                                            DSS Signature                                                                                     \nMicrosoft Base Smart Card Crypto Provider                                                            RSA Full (Signature and Key Exchange)                                                             \nMicrosoft DH SChannel Cryptographic Provider                                                         Diffie-Hellman SChannel                                                                           \nMicrosoft Enhanced Cryptographic Provider v1.0                                                       RSA Full (Signature and Key Exchange)                                                             \nMicrosoft Enhanced DSS and Diffie-Hellman Cryptographic Provider                                     DSS Signature with Diffie-Hellman Key Exchange                                                    \nMicrosoft Enhanced RSA and AES Cryptographic Provider                                                RSA Full and AES                                                                                  \nMicrosoft RSA SChannel Cryptographic Provider                                                        RSA SChannel                                                                                      \nMicrosoft Strong Cryptographic Provider                                                              RSA Full (Signature and Key Exchange)                                                               \nMaybee Process is interferred throuh installed Certsrv.\n## certutil -getconfig\nKonfiguration: \"MNG-SBS2012.mib.local\\mib-MNG-SBS2012-CA\"\nLog with --verbose\nPS C:\\Windows\\system32> C:\\Users\\Public\\Downloads\\letsencrypt-win-simple.v1.9.8.4\\letsencrypt.exe --test --verbose\n [DBUG] Options: Options {BaseUri=\"https://acme-v01.api.letsencrypt.org/\", Test=True, Verbose=True, Renew=False, ForceRenewal=False, Plugin=null, SiteId=null, ExcludeBindings=null, HideHttps=False, ManualHost=null,\nManualTargetIsIIS=False, Validation=null, ValidationMode=\"http-01\", WebRoot=null, ValidationSiteId=null, Warmup=False, UserName=null, Password=null, AzureTenantId=null, AzureClientId=null, AzureSecret=null, AzureSub\nscriptionId=null, AzureResourceGroupName=null, DnsCreateScript=null, DnsDeleteScript=null, KeepExisting=False, CentralSslStore=null, CertificateStore=null, Installation=[], InstallationSiteId=null, SSLPort=443, Scri\npt=null, ScriptParameters=null, CloseOnFinish=False, NoTaskScheduler=False, UseDefaultTaskUser=False, Cancel=False, AcceptTos=False, EmailAddress=null}\n [DBUG] Test parameter set: https://acme-staging.api.letsencrypt.org/\n [DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n[INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Software version 198.4.6605.15190 (RELEASE)\n [INFO] IIS version 7.5\n [INFO] ACME Server https://acme-staging.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n[DBUG] Renewal period: 55\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: n\n[INFO] Running in Simple mode\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: 3\n[DBUG] Scanning IIS sites\n [INFO] No valid hosts found for SBS SharePoint.\n [INFO] No valid hosts found for SharePoint Central Administration v4.\n [INFO] No valid hosts found for SharePoint Web Services.\n [INFO] No valid hosts found for WSUS-Verwaltung.\n1312694709: Companyweb (1 bindings) [@C:\\inetpub\\wwwroot\\wss\\VirtualDirectories\\Companyweb80]\n 1: Default Web Site (4 bindings) [@C:\\inetpub\\wwwroot]\n 7: Mangaard.de (1 bindings) [@C:\\Web-Hosting\\www.mangaard.de]\n 2: SBS Client Deployment Applications (2 bindings) [@C:\\Program Files\\Windows Small Business Server\\Bin\\webapp\\ClientDeployment]\n 6: www.magneticpower.de (3 bindings) [@C:\\Web-Hosting\\www.magneticpower.de]\n 4: www.Mangaard.ch (3 bindings) [@C:\\Web-Hosting\\www.Mangaard.ch]\n 5: www.Mangaard-Physio.de (3 bindings) [@C:\\Web-Hosting\\www.Mangaard-Physio.de]\nEnter a comma separated list of site IDs, or 'S' to run for all sites: 1,4,5,6,7\n\nmangaard-informatik.de\nwww.mangaard-informatik.de\nremote.mangaard-informatik.de\nmail.mangaard-informatik.de\nwww.mangaard.ch\nmangaard.ch\nmail.mangaard.ch\nwww.mangaard-physio.de\nmangaard-physio.de\nmail.mangaard-physio.de\nwww.magneticpower.de\nmagneticpower.de\nmail.magneticpower.de\nmangaard.de\n\nPress enter to include all listed hosts, or type a comma-separated lists of exclusions:\n[INFO] Plugin IISSites generated target [IISSites] 1,4,5,6,7 [14 bindings - mangaard-informatik.de, ...]\n [DBUG] Scanning IIS sites\n [DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: mangaard-informatik.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mangaard-informatik.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mangaard-informatik.de/.well-known/acme-challenge/h-rYk4Fg5TA8odc9MNitk8CtHfequNX0t4wC--JQN_Q\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/spkhOH-HsMUPVVqJFkSdrkkyl_RIed5WjBXICCz2E5E/92207937\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: www.mangaard-informatik.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing www.mangaard-informatik.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://www.mangaard-informatik.de/.well-known/acme-challenge/ueoxUUGYUpUqR7KZGJDXcM1yShAd3D6W_1cXhXI-0k8\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/EWX6mxP3HfX6-oFKwATNMENW8ZKjEHD3mcCzYclRtQQ/92208029\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: remote.mangaard-informatik.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing remote.mangaard-informatik.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://remote.mangaard-informatik.de/.well-known/acme-challenge/qCIEdevn_JbzreHr26s_kCLBgycoAYhAuPv1zXcb4KI\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/OPWcHTzD7qZ4OlaF4yYvx2R8KnWvUxI7SaZpbZTIVUc/92208924\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mail.mangaard-informatik.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mail.mangaard-informatik.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mail.mangaard-informatik.de/.well-known/acme-challenge/0kflFUAv9CGRFQfqZs8mF7DoHSXlxqAm-uJyCywnDqU\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/vQq51Ccz7aJIUK_CaBIjfl3il86nX_xE7DB3kirW1Bc/92209054\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mangaard.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mangaard.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mangaard.de/.well-known/acme-challenge/q8gkqNnM7tXxcmP6bplhyjO6VMYVsWOqFWHDlrlTxt8\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/3C7q3c74DlkuUcPoMgEIiOgqp288Nq9vhABoFQpb8B8/98124681\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: www.magneticpower.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing www.magneticpower.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://www.magneticpower.de/.well-known/acme-challenge/hdlFdxlkzFvwBk_a1aVHBUhHKmI2dIqCI2wMRoNjZ4c\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/lAabum5OEeEvCpHDFCuo-KbT5qcVGt6PKtPNjx6Y9R4/92209108\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: magneticpower.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing magneticpower.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://magneticpower.de/.well-known/acme-challenge/JDcr_A51x6-4Kl6_ceCphZOKnsqwdI2pCLhtTCy8c8E\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/rtzwlhTz4q-gUgJ14hmfpUfM4SCASrl2fqF6TxsrDRg/92391744\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mail.magneticpower.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mail.magneticpower.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mail.magneticpower.de/.well-known/acme-challenge/MQaj2rcr8QICYqt7hDcVYs-V8z0RDN4Q8Se8-bHTbDE\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/OlnVSRbCOsWfJetfmB2nm3iKDbVJXGlOu2gnlzqeRsM/92391784\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: www.mangaard.ch\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing www.mangaard.ch using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://www.mangaard.ch/.well-known/acme-challenge/VYgj-T5NQgJ3xYWNKVBvFhDwwfXJ3lorzfkd8hDB_6c\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/z19g4ZgriBA-MxmfYpY2rs6o-qyd3llbcR_EnCsWeuE/92209150\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mangaard.ch\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mangaard.ch using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mangaard.ch/.well-known/acme-challenge/IWV3qamjuMUxe5Ctu2ntVmmVhuZzPIbhVLIssUkalBY\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/vxeJUSwMsIx-Pmzns7-96fOYk9SMdGiA0XM6gNRtwXw/92391569\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mail.mangaard.ch\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mail.mangaard.ch using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mail.mangaard.ch/.well-known/acme-challenge/WvGFkdJDEn_ci8iMhUHy0yM2xyUSOqL77_GLGeegcXc\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/-5wPZxRODAhoSZbRDC5dLTZi7B1Ciw-ozOj8744F2s8/92391602\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: www.mangaard-physio.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing www.mangaard-physio.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://www.mangaard-physio.de/.well-known/acme-challenge/UGgL_AwyJWgiWTLTQQFpB5j8hbvXCEwrj5S8NEMz9HA\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/_u8y6AzVLY0EoV5iNsqJJZDGmGXoGEcpaj0C4zNaP9E/92209191\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mangaard-physio.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mangaard-physio.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mangaard-physio.de/.well-known/acme-challenge/f4aUk-1bHt01nGLHFYYwZvxJnMr9d75bbs0SsFAXqjg\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/subV1_lpPgtts8i35g1Sk6S2FQgBs-QYrhVfIP33yCg/92209214\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mail.mangaard-physio.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mail.mangaard-physio.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mail.mangaard-physio.de/.well-known/acme-challenge/xoAQumc7sdr_pa5lS9UT4DYbXwqM3y9mVHJpNHuA-dk\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/XU6dN-UA1CfWoCCHYWGMNk3Tfbqk_1DqtFRkNavipc4/92209262\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n [DBUG] Certificate store: My\n [DBUG] RSAKeyBits: 2048\n [INFO] Requesting certificate 1,4,5,6,7 2018.2.11 4:15:23\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-cert\n [INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n [EROR] Create certificate failed\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu:. After Unzipping your File and running it i bekame a Message about missing files.\nI copied them from Version: 1.9.8.4\nand Ran your version.\nEssensial is the Warning at the end:\nPress enter to continue...  [DBUG] Submitting answer\n[DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/sjuaYOIj7xezJas22lX1CbF4ftOK_OBMEOQEYl4docc/101105800\n[DBUG] Refreshing authorization\n[DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/sjuaYOIj7xezJas22lX1CbF4ftOK_OBMEOQEYl4docc\n[INFO] Authorization result: valid\n[DBUG] Deleting web.config\n[DBUG] Deleting answer\n[DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n[DBUG] Certificate store: My\n[DBUG] RSAKeyBits: 2048\n[INFO] Requesting certificate 1,4,5,6,7 2018.2.13 12:39:56\n[DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-cert\n[INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n[WARN] Error converting private key to Microsoft RSA SChannel Cryptographic Provider, which means it might not be usable for Exchange.\n[DBUG] Set private key exportable\n[--test] Do you want to install the certificate? (y/n): - no\nThe debug messages commes because of setting \u201c\u201d in the \u201cletsencrypt.exe.config\u201d\nYou find the complete Log in attached file.\nKindly Regards\nMangaard Informatik\nPeer-Ren\u00e8 Mangaard\nBerchenstr. 42A\nD-78467 Konstanz\nTelefon: +49 (0)7531 78632\nTelefax: +49 (0)7531 78602\nMobil:    +49 (0)171 6247 110\nInternet:  http://www.mangaard-informatik.de/\nP  Bitte denken Sie an die Umwelt und drucken Sie diese E-Mail nur aus, wenn es unbedingt erforderlich ist!\nDiese Nachricht wurde auf Viren \u00fcberpr\u00fcft.\nThis mail was checked for viruses.\nCe mail a \u00e9t\u00e9 v\u00e9rifi\u00e9.\n\nE-Mail Disclaimer\nDer Inhalt dieser E-Mail ist ausschliesslich fuer den bezeichneten Adressaten bestimmt. Wenn Sie nicht der vorgesehene Adressat dieser E-Mail oder dessen Vertreter sein sollten, so beachten Sie bitte, dass jede Form der Kenntnisnahme, Veroeffentlichung, Vervielfaeltigung oder Weitergabe des Inhalts dieser E-Mail unzulaessig ist. Wir bitten Sie, sich in diesem Fall mit dem Absender der E-Mail in Verbindung zu setzen.\nThe information contained in this email is intended solely for the addressee. Access to this email by anyone else is unauthorized. If you are not the intended recipient, any form of disclosure, reproduction, distribution or any action taken or refrained from in reliance on it, is prohibited and may be unlawful. Please notify the sender immediately.\nL'information contenue dans cet email est pr\u00e9vue seulement pour le destinataire. L'Access \u00e0 cet email par n'importe qui est autrement non autoris\u00e9. Si vous n'\u00eates pas le destinataire pr\u00e9vu, aucune forme de r\u00e9v\u00e9lation, reproduction, distribution ou aucune mesure prise ou abstenue \u00e0 dans la confiance l\u00e0-dessus, est interdit et peut \u00eatre ill\u00e9gal. Veuillez informer l'exp\u00e9diteur imm\u00e9diatement.\n\nVon: Wouter Tinus [mailto:notifications@github.com]\nGesendet: Montag, 12. Februar 2018 18:41\nAn: Lone-Coder/letsencrypt-win-simple letsencrypt-win-simple@noreply.github.com\nCc: Mangaard-Informatik Mangaard@Mangaard-Informatik.de; Author author@noreply.github.com\nBetreff: Re: [Lone-Coder/letsencrypt-win-simple] Create certificate failed in SBS2012 (all authorization result: valid) (#741)\nThis is odd, the logger seems to be acting up. I don't see any of the [VERB] messages in your log. Also it shows a debug message which I don't see in my builds.\nWould you mind trying this build to see if it gives you a proper error message?\nletsencrypt.ziphttps://github.com/Lone-Coder/letsencrypt-win-simple/files/1717198/letsencrypt.zip\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHubhttps://github.com/Lone-Coder/letsencrypt-win-simple/issues/741#issuecomment-365001519, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ATyjAjIVzUK_5ahwZMzZtZBkRmMJFGTtks5tUHefgaJpZM4SBA8m.\nC:\\inetpub\\AdminScripts>C:\\Users\\Public\\Downloads__Wouter_Tinus_Build_letsencrypt\\letsencrypt.exe --test --verbose\n [DBUG] Options: Options {BaseUri=\"https://acme-v01.api.letsencrypt.org/\", Test=True, Verbose=True, Renew=False, ForceRenewal=False, Plugin=null, SiteId=null, ExcludeBindings=null, Hide\nHttps=False, ManualHost=null, ManualTargetIsIIS=False, Validation=null, ValidationMode=\"http-01\", WebRoot=null, ValidationPort=null, ValidationSiteId=null, Warmup=False, UserName=null,\nPassword=null, AzureTenantId=null, AzureClientId=null, AzureSecret=null, AzureSubscriptionId=null, AzureResourceGroupName=null, DnsCreateScript=null, DnsDeleteScript=null, KeepExisting=\nFalse, CentralSslStore=null, CertificateStore=null, Installation=[], InstallationSiteId=null, SSLPort=443, Script=null, ScriptParameters=null, CloseOnFinish=False, NoTaskScheduler=False\n, UseDefaultTaskUser=False, Cancel=False, AcceptTos=False, EmailAddress=null}\n [DBUG] Test parameter set: https://acme-staging.api.letsencrypt.org/\n [DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n[INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Software version 198.4.6617.33472 (DEBUG)\n [INFO] IIS version 7.5\n [INFO] ACME Server https://acme-staging.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n[DBUG] Renewal period: 55\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: m\n[INFO] Running in Advanced mode\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: 3\n[DBUG] Scanning IIS sites\n [INFO] No valid hosts found for SBS SharePoint.\n [INFO] No valid hosts found for SharePoint Central Administration v4.\n [INFO] No valid hosts found for SharePoint Web Services.\n [INFO] No valid hosts found for WSUS-Verwaltung.\n1312694709: Companyweb (1 bindings) [@C:\\inetpub\\wwwroot\\wss\\VirtualDirectories\\Companyweb80]\n 1: Default Web Site (4 bindings) [@C:\\inetpub\\wwwroot]\n 7: Mangaard.de (1 bindings) [@C:\\Web-Hosting\\www.mangaard.de]\n 2: SBS Client Deployment Applications (2 bindings) [@C:\\Program Files\\Windows Small Business Server\\Bin\\webapp\\ClientDeployment]\n 6: www.magneticpower.de (3 bindings) [@C:\\Web-Hosting\\www.magneticpower.de]\n 4: www.Mangaard.ch (3 bindings) [@C:\\Web-Hosting\\www.Mangaard.ch]\n 5: www.Mangaard-Physio.de (3 bindings) [@C:\\Web-Hosting\\www.Mangaard-Physio.de]\nEnter a comma separated list of site IDs, or 'S' to run for all sites: 1,4,5,6,7\n\nmangaard-informatik.de\nwww.mangaard-informatik.de\nremote.mangaard-informatik.de\nmail.mangaard-informatik.de\nwww.mangaard.ch\nmangaard.ch\nmail.mangaard.ch\nwww.mangaard-physio.de\nmangaard-physio.de\nmail.mangaard-physio.de\nwww.magneticpower.de\nmagneticpower.de\nmail.magneticpower.de\nmangaard.de\n\nPress enter to include all listed hosts, or type a comma-separated lists of exclusions:\n[INFO] Plugin IISSites generated target [IISSites] 1,4,5,6,7 [14 bindings - mangaard-informatik.de, ...]\n1: [dns-01] Azure DNS\n 2: [dns-01] Run external program/script to create and update records\n 3: [http-01] Create temporary application in IIS\n 4: [http-01] Save file on local (network) path\n 5: [http-01] Upload verification file to FTP(S) server\n 6: [http-01] Self-host verification files (recommended)\n 7: [http-01] Upload verification file to WebDav path\n C: Cancel\nHow would you like to validate this certificate?: 6\n1: Create or update IIS bindings\n 2: Run external script\n 3: Do not run any installation steps\n C: Cancel\nWhich installer should run for the certificate?: 3\n[DBUG] Scanning IIS sites\n [DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: mangaard-informatik.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mangaard-informatik.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mangaard-informatik.de/.well-known/acme-challenge/pq3o2aVVKiWbG1EQXlJGvCZCHkalRnvU-Zg7JB89b-E\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/K1j9vAPnm9gVu77xC5P745uV9IZhsC4HUK4vrQLBiL4/101104206\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/K1j9vAPnm9gVu77xC5P745uV9IZhsC4HUK4vrQLBiL4\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: www.mangaard-informatik.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing www.mangaard-informatik.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://www.mangaard-informatik.de/.well-known/acme-challenge/-zR6fxEfRBgZDdYha3ldFDrL0UcqwUJpzNulYZ0Msvg\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/Igh8zikyuRnmyTPri0SNr1V-5sj30cWEkp4hI-qm-d0/101104906\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/Igh8zikyuRnmyTPri0SNr1V-5sj30cWEkp4hI-qm-d0\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: remote.mangaard-informatik.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing remote.mangaard-informatik.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://remote.mangaard-informatik.de/.well-known/acme-challenge/v9PG16GMJ12NIGwyPGFeiSRMC2bKzGlS9tGeTE3KXl8\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/jjqeLO1HdUrczJ1rb8tvytUn6F8WnJPfqEG1ecg0ZiI/101104938\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/jjqeLO1HdUrczJ1rb8tvytUn6F8WnJPfqEG1ecg0ZiI\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mail.mangaard-informatik.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mail.mangaard-informatik.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mail.mangaard-informatik.de/.well-known/acme-challenge/HmgnCSz_o6RIWpqhUphsP3dubctxbi_PKDVMzdihz3g\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/6Jgq_D0Wns3P9AOAJB64GkhNOlAtgovyt4S20CHFDks/101104962\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/6Jgq_D0Wns3P9AOAJB64GkhNOlAtgovyt4S20CHFDks\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mangaard.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mangaard.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mangaard.de/.well-known/acme-challenge/q8gkqNnM7tXxcmP6bplhyjO6VMYVsWOqFWHDlrlTxt8\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/3C7q3c74DlkuUcPoMgEIiOgqp288Nq9vhABoFQpb8B8/98124681\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: www.magneticpower.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing www.magneticpower.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://www.magneticpower.de/.well-known/acme-challenge/ToBezvdeDUkeg1ZBIO9pLDGWQ3xN_da_veWk8q2zm_U\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/IXLwOGVhqRBBajd_knS7Mp2xRc6XyxZyqhyknl-QxYM/101105009\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/IXLwOGVhqRBBajd_knS7Mp2xRc6XyxZyqhyknl-QxYM\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: magneticpower.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing magneticpower.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://magneticpower.de/.well-known/acme-challenge/msjEUxmMHnVQvbqD--FrCYAw2DGLKDupZzFY7iPWwh8\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/rEmM3w3djdyDRg-xHf1yDDV2VHI8vR7ZmF9duQjeP_8/101105049\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/rEmM3w3djdyDRg-xHf1yDDV2VHI8vR7ZmF9duQjeP_8\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mail.magneticpower.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mail.magneticpower.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mail.magneticpower.de/.well-known/acme-challenge/7IGKz_CJae2K8MGG2ekdUm9RLcvEOaqXpU9dF4LzVM0\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/QiZu2HUTUDnYXUsmYkREi_5R-gxxXtPtF6H-lOCr2yA/101105513\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/QiZu2HUTUDnYXUsmYkREi_5R-gxxXtPtF6H-lOCr2yA\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: www.mangaard.ch\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing www.mangaard.ch using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://www.mangaard.ch/.well-known/acme-challenge/-fUDR0yRURm_NRcgRz7q_7uL5kx2mfyaO4An0-f2hr8\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/5lBqc4FUl0qm0dWlYalJ4AadIj39rfFSwLrzNccOjl8/101105544\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/5lBqc4FUl0qm0dWlYalJ4AadIj39rfFSwLrzNccOjl8\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mangaard.ch\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mangaard.ch using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mangaard.ch/.well-known/acme-challenge/GZAKcLraTKw3XM5v2rJVRyOPtOFAJD_QWfPSfETkji8\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/QTxO0lzTPq90nDGrVYS5zFxxOigpawzErL16ffjtBYk/101105586\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/QTxO0lzTPq90nDGrVYS5zFxxOigpawzErL16ffjtBYk\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mail.mangaard.ch\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mail.mangaard.ch using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mail.mangaard.ch/.well-known/acme-challenge/ekeZ4BsI-Geor1d5MtV8AWmgcgnOK-BnzZb3uea3W6Y\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/yxXlq5S0hSLNTJm4VnmP86haaz6hIwABnn9iJUOtZw8/101105673\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/yxXlq5S0hSLNTJm4VnmP86haaz6hIwABnn9iJUOtZw8\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: www.mangaard-physio.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing www.mangaard-physio.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://www.mangaard-physio.de/.well-known/acme-challenge/nuUQFQlmFIj9bH7-TWeDQiYl7FsTDpQqp8fRB9_Pj5Y\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/7LJFpP-NtpF5Qp8lFm4epH-wRU4m5rcHDrQGRYIegXg/101105731\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/7LJFpP-NtpF5Qp8lFm4epH-wRU4m5rcHDrQGRYIegXg\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mangaard-physio.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mangaard-physio.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mangaard-physio.de/.well-known/acme-challenge/srdcIx1SU-nwi3w6R2jbKvMmWVY-laZZeJ5h83eZMw4\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/oHBMHD4D8A1_vhAIDGmp0tco5hHcs4h-pahEWBKp8ZE/101105767\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/oHBMHD4D8A1_vhAIDGmp0tco5hHcs4h-pahEWBKp8ZE\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: mail.mangaard-physio.de\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mail.mangaard-physio.de using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mail.mangaard-physio.de/.well-known/acme-challenge/IG8KB4bAy0m-FWd0Mndz_OsciCbZLgdt7QrS3nLBtgg\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/sjuaYOIj7xezJas22lX1CbF4ftOK_OBMEOQEYl4docc/101105800\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/sjuaYOIj7xezJas22lX1CbF4ftOK_OBMEOQEYl4docc\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [DBUG] Certificate folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n [DBUG] Certificate store: My\n [DBUG] RSAKeyBits: 2048\n [INFO] Requesting certificate 1,4,5,6,7 2018.2.13 12:39:56\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-cert\n [INFO] Saving certificate to C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-staging.api.letsencrypt.org\n [WARN] Error converting private key to Microsoft RSA SChannel Cryptographic Provider, which means it might not be usable for Exchange.\n [DBUG] Set private key exportable\n[--test] Do you want to install the certificate? (y/n): - no\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu:. ",
    "lonesomewalker": "First of all i would check if it is SBS2012 OR SBS2011...\nThe issuer ignored the warnings that .net framework 4.6.1 is NOT supported on a SBS an breaks many other stuff.\n(and according to his mail signature, he seems to be a neighbor :-P )\nSo i suggest it's not a bug in win-acme... seems like PEBKAC.. ",
    "varzaman": "Ah, thank you for the explanation. That makes sense.. I'm just a simple user but I also like the name win-acme.. I see what you are saying, but I think I might have a more unique case.\nThe domain points to the public IP of the server which then gets routed to an internal IP and port, where the IIS site resides.  www and non www already works.\nThe only reason I add any bindings to the IIS site is so win-simple picks up the hostnames for the cert. I simply need the names added to the cert itself to get everything working nicely.\nI understand if it is still considered outside of the scope of the program however.. I\u2019ll take a closer look at the command line parameters for adding host names. Thanks.\nFrom: Wouter Tinus\nSent: Monday, February 12, 2018 3:46 PM\nTo: Lone-Coder/letsencrypt-win-simple\nCc: Stefan Neamtu; Author\nSubject: Re: [Lone-Coder/letsencrypt-win-simple] Is it possible to haveautomatic www and non www hostnames added? (#745)\nAh that changes things a bit. I think there's already an alternative though. Rather than adding HTTP bindings just for the sake of LEWS, you can use the advanced mode (\"M\") to manually input the host names that you want the certificate to be generated for, and then point the installation plugin to the site where you want them. LEWS will then automatically add or update HTTPS bindings if needed. This is also possible from the command line if you want to automate the process.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub, or mute the thread.\n. ",
    "b-rewired": "By a strange coincidence, I was having the same issue this morning and I came back to this thread to see that you, @WouterTinus , had added the new parameter.\nI'm having an issue with it though, I'm launching the executable with --validationport 88 parameter but my attempts to get a cert fail.  I've verified that my site is reachable through it's host and port externally so it's not a firewall/routing issue.  \nI haven't dug into the source code but when the output says: \"Answer should now be browsable at [followed with url]\" - the port number (88) is not in the URL.  Should it be?\nDo you want me to open a new issue for this?. Thanks, @LBegnaud , for the quick response.  I think, then, I'm stuck.  My residential ISP blocks port 80 so I was trying to work around this by hosting on a different port (and routing the firewall traffic all through the same port).  \nBased on your knowledge of LetsEncrypt and win-acme, is this something that can be overcome?  Does LetsEncrypt only look at port 80 or is it win-acme that is hardcoded to do the validation on port 80?. Thank you for pointing me in the right direction.  As for the ISP, I agree with you - they've had it this way for 20 years now, I don't see them changing and they'll likely want to upsell me some business package.. Honestly, this was just an exercise in learning LetsEncrypt with IIS on a Windows 2012 R2 virtual machine. I wanted to be able have a nicer looking TLS encryption, rather than a self-signed certificate, for a custom application I'm exposing externally.\nThanks for the info on Cloudflare hosting - good to know they have a free tier for blogs and personal sites. I'm not using Azure for this so if I figure out how to use the DNS-01 validation technique for IIS I can post back here.\nEdit: Well it appears that I won't be able to do this, unless I use Azure or switch my DNS provider to someone who supports script-creation of the TXT records. . ",
    "ScottHuston": "I'm not sure that they have wordmark case against letsencrypt-win-simple.  \nhttps://en.wikipedia.org/wiki/Trademark_infringement\nWhile Wikipedia is not a perfect legal resource, none of the issues presented there seem to indicate there is an infringement issue.\nUnder \"Factors\" I would say that your use of letsencrypt is not \"in commerce\" (unless you're making money from it which is not obvious) nor likely to confuse consumers.\nUnder \"Consumer Confusion\" I would suggest:\n1.  Unknown\n2.  The proximity of the goods enhances ISRG brand\n3.  Again, enhances ISRG brand\n4.  Have them demonstrate this\n5.  You are not marketing letsencrypt-win-simple are you?\n6.  Do they offer their own client for Windows?  No.\n7.  Do you have the intent to confuse consumers or steal business or notoriety from ISRG?\n8.  They have no stated intention in this regard, nor have I heard you're intending to move into ISRGs space.\nAnd, they have another client listed on their site \"Let's Encrypt for Hiawatha\"...\nIf you opt to, change it the least amount possible.\nletsacme-win-simple.exe\n(and ISRG guys reading this, \"No\" I have no affiliation with this project except as a user, however, you do have better things to do than to chase a project that is working to help you accomplish your stated goals. \nNotably:  \nWe do this because we want to create a more secure and privacy-respecting Web.\nCooperative: Much like the underlying Internet protocols themselves, Let\u2019s Encrypt is a joint effort to benefit the community, beyond the control of any one organization.\nMaybe you're not joint enough.. I don't disagree.  Much.\nI would have a different reaction except they claimed to not allow it but they have another client listed on their website and their use of the word insist which moves it out of the realm of reasonable request.\nAnd, they could resolve the issue of \"later down the line\" by just granting the use of the wordmark in a limited application.  No blind-eye is turned.  Explicit permission is given.\nI like acme-win-simple.exe.  \nI wouldn't be in a hurry @Lone-Coder.  As I don't think they actually can make a case, make whatever change on your terms and timing.. My host name is scott.example.com\nletsencrypt-win-simple is creating a PFX file named scott.example.com-all.pfx\nThis is not properly named.  IIS will not load the certificate for the site until I rename it scott.example.com.pfx\nWhat am I missing?  Why is there a -all appended to the name?. I ran this again.\n\nDeleted everything from D:\\Certificates\\\nSame command as above, but answered y to installation\n\nAll the same except...\n\n[--test] Do you want to install the certificate? (y/n): - yes\n[WARN] Certificate with thumbprint 1791B5520893868989B859082397768C5C145BF4 is already in the store\n\nThe whole point of CCS is that storing and installing is the same thing.  But, for that to work the name has to be correct. \nWhy is there a -all on the filename?. Perhaps the issue is that the \"cache\" is being stored in the CCS directory?\nAm I doing that unintentionally as part of the parameters I'm passing?\nCan I make a change to where the \"cache\" is put and will the \"store\" then copy it to the CCS without the -all?. I had indeed and have changed CertificatePath back to <value /> and now things are behaving as expected on server #1, where previously I'd used --installation iis.\nOn server # 2, where I've not ever run letsencrypt-win-simple I'm getting this in the browser\n\nValid certificate\nThe connection to this site is using a valid, trusted server certificate issued by unknown name.\n\nARGH!\nThis isn't a letsencrypt-win-simple issue, that's been solved.  Now I just have to wade into the dearth of IIS Central Certificate Store troubleshooting help out there.  Hip boots not required.. Alex,\nSee this https://support.microsoft.com/en-us/help/174070/registry-replication-in-microsoft-cluster-server\nand this https://blogs.msdn.microsoft.com/clustering/2012/05/31/how-to-configure-clustered-tasks-with-windows-server-2012/\nYou'll need to know the registry keys to checkpoint.. I'd like to move to ConfigurationPath storage of my renewal information so that I can set up redundant win-acme instances.  What's the suggestion to convert?. I just migrated to using \n<setting `name=\"ConfigurationPath\"` serializeAs=\"String\">\n        <value>\\\\RHSITES\\Sites\\Certificates\\Win-Acme-Config\\</value>\n</setting>\nbut every time I open letsencrypt-win-simple it tells me I'm using ProgramData...\n```\n [DBUG] Config folder: C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\n[INFO] A Simple ACME Client for Windows (WACS)\n [INFO] Software version 1911.2.6726.40690 (RELEASE)\n [INFO] IIS version 10.0\n [INFO] ACME server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\n```. I faced this, too.  Check out...\nhttps://github.com/PKISharp/win-acme/issues/746\nHint:  Don't make the CertificatePath == central store.  It breaks things!. ",
    "iAmateur": "Doesn't appear to be anything in the  section...\n\n. That worked! Thank you!. ",
    "ijwrighty": "When I run in interactive mode it does detect the site but I get the below error:\n[INFO] Plugin Manual generated target [Manual] [7 bindings - mail.mydomain.com, ...]\n1: Default Web Site\nChoose site to create new bindings: 1\n[INFO] Authorize identifier: mail.mydomain.com \n [INFO] Cached authorization result: valid\n [INFO] Authorize identifier: mydomain.com\n [INFO] Authorizing mydomain.com using http-01 validation (SelfHosting)\n [INFO] Answer should now be browsable at http://mydomain.com/.well-known/acme-challenge/w90LWVEQKO1rltuSquDL855RmtyJ\njMM1_KPJk7mYfz4\n [EROR] Authorization result: invalid\n [INFO] Authorize identifier: autodiscover.mydomain.com\n [INFO] Cached authorization result: valid\n [INFO] Authorize identifier: ex01\n [EROR] Error authorizing [Manual] [7 bindings - mail.mydomain.com, ...]\n [EROR] AcmeWebException: Unexpected error\n +Response from server:\n        + Code: BadRequest\n        + Content: {\n  \"type\": \"urn:acme:error:malformed\",\n  \"detail\": \"Error creating new authz :: DNS name does not have enough labels\",\n  \"status\": 400\n}\n [EROR] Create certificate failed. ive fixed it. The names were not resolvable externally. Is there a way I can use Letsencrypt for internal server names?. That's cool. Its only a lab anyway so can happily drop a few internal names.\nThank you for your help \ud83d\udc4d . ",
    "Donkerg": "Thanks, it worked. . @WouterTinus I thought every time a certificate was registered/requested files would be written to the .well-known directory  as a verification check ?  I must say that I also implemented ipv6 recently  on my webserver and used iiscrypto to strengthen the ciphers. (recently). Ill check that also.\n. It was and still is a ipv6 problem. You can workaround the issue by deleting the dns ipv6 adresses. Running letsencrypt.exe, create the certificates and then adding them again. \n. Im sorry.. ( Letsencrypt as in win-acme client). Its the only client I use.  But im not sure if this problem is withing letsencrypt itself or within the win-acme client.  It might be nice if there is a option not to check for ipv6 aaaa values.  . ",
    "kd8ssq": "Well, I copied both files from one server to another and was able to create several certificates.  It's hard to tell if the new files were used or the original ones used to setup letsencrypt.  Is the data from the Signer and Registration files cached anywhere?  Is there any way to validate what account id is used to create the certificates?. ",
    "gpanucci": "@WouterTinus \nThanks for the response.\nIt is going through the firewall, could possibly be going through something that strips headers from the requests, but I didn't think I'd gotten to the stage where it was requesting anything from the outside world yet.\nI thought it was more of an issue of binding.\nDo you have any suggestions of domains I should whitelist so that they aren't affected by the Firewall?\nI'll take a look at the logs and see if there's anything there but if you've got any further suggestions that'd be great.. That's definitely a possibility, it's not just a home style firewall, it's a Watchguard that has HTTPS content inspection turned on.\nI'll whitelist the letsencrypt.org domain and see if it gets me anywhere.\n. ",
    "WilbertE": "You might be right! I will update the DNS and report back tomorrow. Thanks for your quick reply.. You were right. Working now. Thanks for your help. Awesome piece of software.. ",
    "TerAnYu": "Thanks, everything earned as it is necessary.. ",
    "zonidjan": "Had same issue, figured it out: It wants to run as admin.. ",
    "dwilbanks": "I was able to solve this problem by running as adminitrator. ",
    "scott-ip1": "I am running the renew from the same server I used to create the cert that is still actively hosting the same site (Exchange server).\nDoes the error point to something in paticular being wrong that I need to look for, or is it going to be easier to just revoke this cert and issue a new one?. Can you explain that further? Is the win-acme program not able to find the site, or the Letsencrypt web service can't find the site?\nAs a quick test, I did a renew on some standard IIS web sites on a different server and they were able to renew correctly, so it does appear to be something specific to this Exchange IIS instance.\nHKEY_LOCAL_MACHINE\\SOFTWARE\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\nThe \"Renewals\" has the following\n\n{\"Date\":\"2018-02-20T10:36:32.6683186Z\",\"Binding\":{\"Host\":\"webmail.xxxxxx.net.au\",\"HostIsDns\":true,\"IIS\":true,\"SiteId\":0,\"TargetSiteId\":0,\"InstallationSiteId\":1,\"SSLPort\":443,\"AlternativeNames\":[\"webmail.xxxx.net.au\",\"autodiscover.xxxx.net.au\",\"webmail.yyyyyy.com\",\"autodiscover.yyyy.com\"],\"TargetPluginName\":\"Manual\",\"ValidationPluginName\":\"tls-sni-01.IIS\"},\"KeepExisting\":false,\"InstallationPluginNames\":[\"IIS\"],\"Warmup\":false}\n. I tried removing those strings from the reg key, but as soon as I trigger the renewal I see them get repopulated. Is there another place I need to also remove them from?\n\nHmm, looking at my other server that I was able to trigger a cert renew on, those registry keys don't even exist, and if I remove them from the problem server than I get no certs listed as available for renewal. Is there another config file hidden away somewhere?. OK, thanks. I ended up revoking and creating a new cert and manually added it to the bindings. I'll do a test with the new versoin in a few days to see how it goes.. ",
    "gwes": "Hey All,\nSorry, should have spent another 15 mins investigating myself before posting (although the answer might be helpful for others).\nIn the smoothwall proxy I needed to add api.letsencrypt.org to a proxy exception list. Doing this has allowed the process to finish successfully.. ",
    "tchollingsworth": "I should have double-checked with the latest version before complaining.  ;-)\n[EROR] Authorization result: invalid\n [EROR] ACME server reported:\n [EROR] [type] urn:acme:error:caa\n [EROR] [detail] CAA record for example.com prevents issuance\n [EROR] [status] 403\n [EROR] Create certificate failed\nSorry for the noise.. ",
    "westofsa": "Thanks @alexhass and @WouterTinus. I had tried the --script option a while back when going through different options, but ran into the problem that it requires me to use script parameters. In my case I have everything defined in the bat file, where the files are, where to load them etc, so I don't need (or want) to be using \"parameters\" in the script simply to run a bat file. But without a parameter defined the script does not run. So it seems mandatory to use additional parameters which shouldn't be necessary. That is why I tried running the update from the bat file instead.. I will go back to try and get win-ACME to call the script instead. Thanks. Sorry, got dragged away, but now back at it, plus needed to wait a while to accommodate rate limits. Staging option doesn't seem to allow renewals so a little more challenging trying to keep testing.\nI also just upgraded to the latest version today but don't seem to be able to get the --script to invoke.\nMy preference would be to simply update the automatically configured Scheduled Task with the --script parameters.. worst case I would change it to call the Bat file with everything defined.\nFor testing I created a bat file with the same values as the Scheduled Task and then added the --script values.\nHere is what my command line looks like to run the script , but it does not seem to follow through after the renewal.\nCall C:\\win-acme\\letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\" --installation manual --script c:\\certimport.bat\nPause\nI watch and see where it downloads the new certificate, but does not complete the script. I used with and without the \"--installation manual\". I don't get any error messages, and once complete I see the Pause and of course as soon as I press a key to continue the window closes.\nI see the cert renew but shouldn't it be running the certimport.bat... Or is running it this way just causing a problem and I should rather set the values in the Task Scheduler and run it from there (although I may not have visibility at that point).. Should that command line not have worked though ?\n@WouterTinus As far as renewals go, in my case I only have 1 renewal on this server that has 3 certs included in the single request. Technically I could get rid of two of the 3 subdomains as they all point to the same place. Just easy to remember URL's for end users.\nAny Ideas ? \nThanks. @WouterTinus - Thanks for the Reply. \nI am trying to renew a previously created certificate.. Don't get me wrong.. that all works. The issue that I am trying to overcome, is that I need to use the renewed certificate to update certificates stored in a Java Keystore (tomcat.jks file) which is used by Tomcat to store certificates.\nI have a batch file that will take the LetsEncrypt Chain and Cert, create a Combined PFX file, apply a common Alias, and set a PFX password. Then it will automatically update the certifcates in the Java Store, and restart the Tomcat services so that the newly renewed and valid certificates are presented to someone connecting to the site... \nSo what I am hoping to do, is when Win-Acme renews the certificates, ideally I would like for the same process to be able to call my batch file so that the rest of the process can also be automatic. I was hoping that the --script option would do that, but if not then I will look at other options. If it cannot do it today maybe it can be added as an enhancement so that when an update does successfully renew a certificate it will then be able to run a script to allow me to automate everything.\nIf not I will look at creating an additional Task Schedule to run my batch file every x number of days (maybe 56) and add in the new certificate, or maybe I will try and use a file compare to look for a newer file date and if yes then complete the import.\nThe other option I had been looking at was to simply run the entire update process through the same batch file and if a success based on an error level returned, I could then have it continue the script and if not have it exit... \nSo there are a few options, was just looking for the lesser of the evils to get there. Adding a few parameters like --script to the string in the already created Scheduled Task would have been the easiest.\nDoes that make sense.. . Actually I think I have a simple fix to my issue. Whenever certificates are renewed, new files are created in the win-acme directory. I don't need all of them, so I am simply going to look for the existence of a particular file, if it is there, will run the rest of my script and delete the file. That way I can run it daily but if the file is not there it will end the batch file.... Sometimes it is the simple solutions that are the hardest to see.\nStill would be nice for a feature enhancement, but I have my solution for now.\nThanks. Did some more troubleshooting and determined that the issue was related to the Squid Reverse Proxy that I had installed. With a regular browser it didn't seem to have an issue, but Lets Encrypt appears to have an issue with it during validation.\nSwitched to NGINX and it is working. \nWill try and figure out why Squid doesn't work another time as it is embedded on my firewall so would prefer to be able to use that.. ",
    "shywel": "the same issue. ",
    "digitaltoast": "Hi there; just got the same for 1.9.10 but now 1.9.9.0 doesn't complain, so I guess they've updated the definitions but whatever is in the exe, MS doesn't like it.. ",
    "HaraldMuehlhoffCC": "Currently Microsoft Windows Defenders on Windows 10 Prof. & Windows Server 2016 are also complaining about a Trojan:Win32/Woreflint.A!cl in letsencrypt.exe in win-acme.v1.9.10.0.zip. Microsoft Safety Scanner (the download version) doesn't find anything. At first virustotal.com returned 1 / 59 (Cylance; Microsoft ok) but is back to 0 now.\nPeople (I mean, MICROSOFT), I'm recovering from flu symptoms ... give me a break!\nTo the great people working on win-acme. Thanks you so much for an invaluable tool! No computer should be left behind when it comes to https!. Windows Defender with current signatures no longer detects any threats!\nThank you, @WouterTinus, for your super-fast response! \nBTW - the link for submission to Microsoft is: https://www.microsoft.com/en-us/wdsi/filesubmission\n(\"file\" was missing).\n\n. ",
    "FerrarisIV": "Dear Wouter, I have the same problem: how can I share with you my applicationHost.config ?\nThanks\nEDIT\nSOLVED :)\nProbably I fixed the problem simply running these commands in DOS:\nIISRESET /STOP and then IISRESET /START\n. @gabrielpotumati \ndear Gabriel sorry I cannot help you because I did not send the applicationHost.config file to @WouterTinus . This because I solved with that DOS commands.\nWait for wouter will reply you\nAnyway WinAcme is fantastic!!. ",
    "mjibmaster": "Same here, Windows Defender report \"Trojan:Win32/Fuerboos.A!cl\"\nWindows 10, IE V11. ",
    "rhymeswithmogul": "I administer several 2012 R2 servers and they all get an A rating.  Your IISCrypto screenshot looks good.  Are you willing to share a link to your SSL Labs result?. Ah, I see. Unfortunately, Windows requires you to use an ECDSA certificate to get the GCM suites with PFS.\nThe grading system isn\u2019t perfect. If you enable the two RSA/GCM suites in the list, you\u2019ll get an A, even though those ciphers will be flagged as weak (non-PFS).. The feature on the roadmap is for a fully-validated ECDSA chain, meaning that everything from the leaf certificate up to the root (\"Let's Encrypt Authority X5?\") is signed with an \"sha256ECDSA\" signature instead of the \"sha256RSA\" that you get now.  You can still request a certificate with an ECDSA public key certificate through Let's Encrypt today.\nHowever, because Win-Acme only creates RSA certificates due to limitations in the ACMESharp library, you'll have to make and submit your own CSR via some other ACME client.  On Linux, it'd go something like this:\n```\nIf you don't already have a private key, or if you want a new one.\nopenssl ecparam -genkey -name secp256r1 -out private.key\nThis will generate a certificate signing request.  I also use a handwritten OpenSSL config file.\nopenssl req -new -sha256 -key private.key -nodes -out public.csr -outform pem -config openssl.cnf\nStop your web server so Certbot can bind to port 80\nservice webserverd stop\ncertbot standalone --csr public.csr\nNow, do whatever to get your certificate and private key into your Web server, then restart it.\ncp 0000_chain.pem /var/webserver/cert/mycert.crt\ncp private.key /var/webserver/cert/private.key\nservice webserverd start\n```\nIf it's any consolation, the official release of Certbot only creates RSA certificates, too.. Thank you, win-acme developers!\nAnd to the original poster: since my last comment a year ago, Microsoft added some DHE_RSA-GCM suites in a security update, so you can continue using RSA certificates and still get a good rating.. ",
    "tienuit": "\nCancel all scheduled renewal\nRevoke all certificate\nDelete all files in %programdata%/win-acme\nQuit and reopen\nCreate new certificate\nHope that help. \n",
    "Careidas77": "Thanks guys for your answers, I appreciate them, and especially @WouterTinus for taking the time to clarify what\u2019s what with ACME and Let\u2019s Encrypt etc.. ",
    "ShanghaiTimes": "Sorry, seems to be a different issue\nletsencrypt.exe --verbose --plugin manual --manualhost quantum-radio.uk  --validationport 8065 --webroot \"C:\\Apache24\\htdocs\u201d\n\u2026..\n[EROR] ACME server reported:\n [EROR] [type] urn:acme:error:connection\n [EROR] [detail] Fetching http://quantum-radio.uk:8065/.well-known/acme-challenge/4AJrTHb6JDJgOHA9UgAziMLa4wDdhKUl29aBO7zpUrI: Invalid port in redirect target. Only ports 80 and 443 are supported, not 8065\n [EROR] [status] 400\n [EROR] Create certificate failed\n\nOn 21 Mar 2018, at 08:02, Wouter Tinus notifications@github.com wrote:\nIt depends what you mean exactly by \"support\".\nIf you're talking about handling validation requests, which seems most likely to me, then the ACME standard does not allow it. The only way is to use NAT to map the incoming port 80 to a different internal port and let the program listen to that with the --validationport parameter.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub https://github.com/PKISharp/win-acme/issues/792#issuecomment-374858628, or mute the thread https://github.com/notifications/unsubscribe-auth/ADyhQgHfmEcPh1onP77C5GPSuta8cfBqks5tggkBgaJpZM4Sx1Be.\n\n\nRobert Chalmers\nhttps://robert-chalmers.uk\nauthor@robert-chalmers.uk\n@R_A_Chalmers\n. ",
    "DWBNStreaming": "Unfortunately I cannot show you any longer. When executing the old client it tells me the same renewal date as with the most recents one.\nBut however my point is that that one month before the cert expiration it does not make sense to renew??. ",
    "CCNST": "An important behaviour is that the file in the Web-Root is not created anyway.\nFrom the letsencrypt side we get the correct file request in the webserver log.\n. Hi,\nyes I am sure, the server returns a 404 and while the tool is running there is no file created.\n64.78.149.164 - - [27/Mar/2018 18:23:34] \"GET /.well-known/acme-challenge/dc-1e9OIDMKqGEC2NVb8aTYf5J4eATa_aXjI9WP13zM HTTP/1.1\" 404 -\nThe server root is C:\\SSL\\, file should be placed in C:\\SSL\\.well-known\\acme-challenge\\.\nServer is a python, used only for letsencrypt while the renew is running).\nletsencrypt.exe is started the with the following options:\nletsencrypt.exe --renew --forcerenewal --baseuri \"https://acme-v01.api.letsencrypt.org/\" --validation filesystem --validationmode http-01 --webroot \"C:\\SSL\\\" --verbose\n--selfhosted also doesnt work.. Just wondering, when I use the --test option I always get the following:\nC:\\SSL>letsencrypt.exe --test\n\n[INFO] Let's Encrypt Windows Simple (LEWS)\n [INFO] Software version 198.4.6605.15190 (RELEASE)\n [INFO] IIS version 7.5\n [INFO] ACME Server https://acme-staging.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/Lone-Coder/letsencrypt-win-simple\n[WARN] No scheduled renewals found.\n[--test] Quit? (y/n): - no\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: S\n[WARN] No options available\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\n\nWhen using without --test S works.. Creating a new one with the existing webserver in testmode and renewing it works without any error.\nMaybe it makes sense to create a new one on the v01 and give it a try?. Creating a new one with 1.9.8.4 fixed the problem on my side (selfhosted as well as filesystem).\nNow even the renewal works. Sorry for not being able to test the filesystem problem anymore.\nThe new 1.9.10.1 doesnt crash like 1.9.10.0 but I get the following error: [EROR] Error loading assemblies for plugins.. @WouterTinus \nYes, that was exactly the problem. Now it works without any errors! \ud83d\udc4d \n. Having the same problem. In my case the file on the server is not created.. Hi,\nfound the right registry key with the wrong value, what else do I have to change beside URL and renewal date?\n. No sadly not, I thought that only depends on the planned task. I run another script to call letsencrypt instead of doing it directly.. @WouterTinus: Thank you very much for your help.. ",
    "dws1": "I think I found my root cause. IIS7.5 was configured (default?) without a MIME type entry for a blank file extension. I added an entry Filename extension=. and MIME/type of text/plain. This allows the challenge file to be read from outside, and the verification succeeds. Thanks!. ",
    "cherzog": "Version 1.9.10.1:\n[DBUG] Scanning IIS sites\n [DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: xyz.com\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing xyz.com using http-01 validation (FileSystem)\n [VERB] Writing file to D:\\xyz\\www.well-known\\acme-challenge\\FITfz4HqVNo2WPpF_2fPZhMm5oRKKoAIUx2Z9JXDD1A\n [DBUG] Writing web.config\n [VERB] Writing file to D:\\xyz\\www.well-known\\acme-challenge\\web.config\n [INFO] Answer should now be browsable at http://xyz.com/.well-known/acme-challenge/FITfz4HqVNo2WPpF_2fPZhMm5oRKKoAIUx2Z9JXDD1A\n [INFO] Waiting for site to warmup...\n [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/J8KXIXMl7tcOzBeOtDrjgCCuuBIuwWm5jE7LNykMUBA/4004949762\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/J8KXIXMl7tcOzBeOtDrjgCCuuBIuwWm5jE7LNykMUBA\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/J8KXIXMl7tcOzBeOtDrjgCCuuBIuwWm5jE7LNykMUBA\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/J8KXIXMl7tcOzBeOtDrjgCCuuBIuwWm5jE7LNykMUBA\n [EROR] Authorization result: invalid\n [DBUG] Deleting web.config\n [VERB] Deleting file D:\\xyz\\www.well-known\\acme-challenge\\web.config\n [DBUG] Deleting answer\n [VERB] Deleting file D:\\xyz\\www.well-known\\acme-challenge\\FITfz4HqVNo2WPpF_2fPZhMm5oRKKoAIUx2Z9JXDD1A\n [DBUG] Additional files or folders exist in D:\\xyz\\www.well-known\\acme-challenge, not deleting.\n [EROR] ACME server reported:\n [EROR] [type] urn:acme:error:connection\n [EROR] [detail] Fetching http://xyz.com/.well-known/acme-challenge/FITfz4HqVNo2WPpF_2fPZhMm5oRKKoAIUx2Z9JXDD1A: Timeout\n [EROR] [status] 400\n [EROR] Create certificate failed. @WouterTinus Sorry, still Problems:\n\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: M\n[INFO] Running in Advanced mode\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: 1\n[DBUG] Scanning IIS site bindings for hosts\n1: xyz.com (SiteId 2) [@D:\\xyz\\www]\n C: Cancel\nChoose site: 1\n[INFO] Plugin IISBinding generated target [IISBinding] xyz.com\n(SiteId 2) [ @ D:\\xyz\\www]\n1: [dns-01] Azure DNS\n 2: [dns-01] Run external program/script to create and update records\n 3: [http-01] Create temporary application in IIS\n 4: [http-01] Save file on local (network) path\n 5: [http-01] Self-host verification files (recommended)\n C: Cancel\nHow would you like to validate this certificate?: 4\nUse different site for validation? (y/n): - no\n1: Create or update https bindings in IIS\n 2: Do not run any installation steps\n 3: Run a custom script\n C: Cancel\nWhich installer should run for the certificate?:\nWhich installer should run for the certificate?: 1\nWould you like to add another installer step? (y/n): - no\nUse different site for installation? (y/n): - no\n[DBUG] Scanning IIS site bindings for hosts\n [DBUG] Loading signer from C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-stag\ning.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\letsencrypt-win-simple\\httpsacm\ne-staging.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: xyz.com\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-a\nuthz\n [INFO] Authorizing xyz.com using http-01 validation (FileSystem\n)\n [VERB] Writing file to D:\\xyz\\www.well-known\\acme-challenge\\mPdglH\nGKpho3H28QT1Kc49OwzNFomiJyWDIHPUbTcMo\n [DBUG] Writing web.config\n [VERB] Writing file to D:\\xyz\\www.well-known\\acme-challenge\\web.co\nnfig\n [INFO] Answer should now be browsable at http://xyz.com/.well-k\nnown/acme-challenge/mPdglHGKpho3H28QT1Kc49OwzNFomiJyWDIHPUbTcMo\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [INFO] Waiting for site to warmup...\n [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/chall\nenge/gUUkc9OnPMVsssnOSR2x06dsW77xr5MzU4QnkFIo2II/114571355\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/\ngUUkc9OnPMVsssnOSR2x06dsW77xr5MzU4QnkFIo2II\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/\ngUUkc9OnPMVsssnOSR2x06dsW77xr5MzU4QnkFIo2II\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/\ngUUkc9OnPMVsssnOSR2x06dsW77xr5MzU4QnkFIo2II\n [EROR] Authorization result: invalid\n [DBUG] Deleting web.config\n [VERB] Deleting file D:\\xyz\\www.well-known\\acme-challenge\\web.conf\nig\n [DBUG] Deleting answer\n [VERB] Deleting file D:\\xyz\\www.well-known\\acme-challenge\\mPdglHGK\npho3H28QT1Kc49OwzNFomiJyWDIHPUbTcMo\n [DBUG] Additional files or folders exist in D:\\xyz\\www.well-known\\\nacme-challenge, not deleting.\n [EROR] ACME server reported:\n [EROR] [type] urn:acme:error:connection\n [EROR] [detail] Fetching http://xyz.com/.well-known/acme-challe\nnge/mPdglHGKpho3H28QT1Kc49OwzNFomiJyWDIHPUbTcMo: Timeout\n [EROR] [status] 400\n [EROR] Create certificate failed\n\n\nI made the browser-test and the browser downloaded a file. So, that part seems to work.... @WouterTinus You are right! Not yet solved, but now I know where the problem lies. Thank you!. ",
    "cirk0": "To me it happens mostly when the domain doesn't point to the server's ip address where win-simple is being run.. ",
    "ptsoccer": "Tried your suggestion in duplicating the renewals (did this via the Renewals file in programdata). Seemed to work even without changing the target plugin on the second one, thanks for the suggestion. Also, thank you for considering this enhancement.. I checked out the latest commit and it seems like the IISFtpInstallerFactory ends up writing the FtpSiteId parameter  to the ScheduledRenewal.Binding.InstallationSiteId property which ends up conflicting with the IISWebInstallerFactory writing its installation site id value to the same property. The net result of this ends up with the iis web installer erroring out saying it couldn't find the the IIS web site with id .\nI was thinking the fix would be a dedicated ftp site ID property on the binding which the ftp installer would always write to. I could make this change if you want unless you had another idea.. There should be a windows schedueld task under the \"Task Scheduler Library\" named something like \"win-acme httpsacme-v01.api.letsencrypt.org\". For me, my renewals are stored in \"C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Renewals\". ",
    "jkk88": "Thanks for explanation. We can live with 1.9.7.2.\nOn Sat, Mar 31, 2018 at 6:21 AM, Wouter Tinus notifications@github.com\nwrote:\n\nUnfortunately it's not that easy.\nWe'd have to regress to a six year old version of the IIS Management\nlibrary to run on .NET 4.5.2, which I'm not quite willing to do for the\nmaster branch. That's because .NET 4.5.2 is limited to .NET Standard 1.2,\nwhereas the latest version requires .NET Standard 1.6.\nThe only sane way'd be to support a separate branch with a different set\nof dependencies, but that'd be a lot of extra work. I would encourage the\neffort but I'm not sure I can take it on personally, unless it turns out\nthat there is a lot of demand for it.\nThe latest version with the old library is v1.9.7.2, that should run on\n.NET 4.5.2 without issues. If you can live with the features and\nlimitations of that release, you might already have your solution.\nOtherwise you might be able set up the current release on a different\nserver and use a script or the central ssl store to install to your target\nserver.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/PKISharp/win-acme/issues/806#issuecomment-377664798,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AJ827CWBoTzYGOCD5WWrJCZuYNKTdWhkks5tjwRSgaJpZM4TCNxa\n.\n. \n",
    "isachko": "Looks like but i checked everywhere and can't find any proxy settings.. I disabled antivirus but still get this error.\nCan I add manual setting to override this url and port?. Thanks but it was my first command\nC:\\Windows\\win-acme>netsh winhttp show pro\nCurrent WinHTTP proxy settings:\nDirect access (no proxy server).\n\n. ",
    "charterwarranty": "Thanks. ",
    "alibehrouzi": "No, I haven't touched any of the cipher/protocol settings.  It's driving me crazy.. No it doesn't.  That reminded me that I messed with the certs indeed.  Thanks very much WouterTinus for the tip.  I'll either restore my server back to before I had messed with it or rebuild it.  Appreciate the help.. ",
    "pmorriss": "I created scripts to do this that work on server 2012. As my server is behind a firewall this turned out to be the wrong method to use, but you may find them useful. Replace DNSServer with the name of your DNSserver and repeat that line if you have more than one server. Replace YourZoneName with your domain name.\ncreate-dns.bat:\npowershell -file ./create-dns.ps1 %1 %2 %3\ncreate-dns.ps1:\n```\nImport-module dnsserver\nAdd-DnsServerResourceRecord -Name $args[1] -Computername DNSServer-TXT -ZoneName \"YourZoneName\" -DescriptiveText $args[2]\n``\ndelete-dns.bat:powershell -file ./delete-dns.ps1 %1 %2`\ndelete-dns.ps1:\nImport-module dnsserver\nRemove-DnsServerResourceRecord -Force -Computername DNSServer-ZoneName \"YourZoneName\" -RRType \"Txt\" -Name $args[1]\n. I think I made a mistake in my comment. Try this:\ncreate-dns.bat:\npowershell -file ./create-dns.ps1 %1 %2 %3\ncreate-dns.ps1:\n```\nImport-module dnsserver\nAdd-DnsServerResourceRecord -Name $args[2] -Computername DNSServer-TXT -ZoneName $args[1] -DescriptiveText $args[3]\n. They aren't public, they are only on the DNS servers behind the firewall. Is DNS not the right approach to use behind a firewall?. ",
    "bmasephol": "@WouterTinus can you review this and let me know if this is a bug or if I've got my setup wrong.\nI'm working off the info provided by @pmorriss as I host my own lab nameservers and internal DNS.  I'm having a problem with the external add script creating the DNS record at the wrong level.  \nI think that the win-acme program is sending the wrong value for the parameters, either that or I'm doing something wrong.\nAn example is I'm trying to create a certificate for something call remote.mydomain.com.\n\nI run win-acme\nChoose option M\nThen option 4\nThen enter my host as \"remote.mydomain.com\"\nNext I choose option 2 to do dns-01 external script\nEnter the path to my add script, .\\Scripts\\DNS\\Add.bat\nEnter the path to my delete script, .\\Scripts\\DNS\\Delete.bat\nChoose option 3 (just for testing)\n\nProgram executes, runs my create script and I can find the TXT file in my DNS records of my nameserver, but I believe it is at the wrong path...\nThese are the parameters to my script...\npowershell.exe -ExecutionPolicy RemoteSigned -File .\\Scripts\\DNS\\Add.ps1 remote.mydomain.com _acme-challenge.remote.mydomain.com TXT_RECORD_CONTENTS\nThe script creates an entry but it is at this level in the DNS\nmydomain.com\\com\\mydomain\\remote\\ _acme-challenge\nI believe the record is to be at\nmydomain.com\\remote\\ _acme_challenge\n(I had to put a space between the \\ and the _ to make it show up correct otherwise the \\ was missing)\nI've actually manually moved the record to that location and then did a DNS lookup based off of what the log is telling me it is querying and it is successful.\n_acme_challenge.remote.mydomain.com\nBased on the input to the add DNS script I'm expecting the first value to be just the hostname, without the domain attached to it...  Is that what it should be?\n. I have both, and I'm using the external, I have one lab server for the internal DNS and one for the external NS.  I have my domain hosted with namecheap.com and have them pointed to my public IP for the NS.  \nWhen I queried for the response after manually creating the TXT record I can see it.  I use a public web site for the DNS query, can't remember exactly which one, but it was successful at seeing the TXT record after I moved it to the correct location.. So here is the log from my last attempt.\n[INFO] Authorize identifier: remote.masephol.com\n [INFO] Authorizing remote.masephol.com using dns-01 validation (DnsScript)\n [INFO] Script .\\Scripts\\DNS\\Add.bat starting with parameters remote.masephol.com _acme-challenge.remote.masephol.com 7pNCrNyuwwVm_BtW6CRbXMzRk3TZauZCdXyCnZ7tLHU\n [INFO]\nC:\\LetsEncrypt>REM Generic batch script to execute powershell scripts along with positional parameters\nC:\\LetsEncrypt>REM Pass path to PS1 script as well as any parameters you want to pass\nC:\\LetsEncrypt>REM Spaces are not supported in script path\nC:\\LetsEncrypt>REM Ex. \"PSScript.bat c:\\scripts\\test.ps1 value\"\nC:\\LetsEncrypt>powershell.exe -ExecutionPolicy RemoteSigned -File ./Scripts/DNS/Add.ps1 remote.masephol.com _acme-challenge.remote.masephol.com 7pNCrNyuwwVm_BtW6CRbXMzRk3TZauZCdXyCnZ7tLHU\n[INFO] Answer should now be available at _acme-challenge.remote.masephol.com\n [EROR] Authorization result: invalid\n [INFO] Script .\\Scripts\\DNS\\Delete.bat starting with parameters remote.masephol.com _acme-challenge.remote.masephol.com\n [INFO]\nC:\\LetsEncrypt>REM Generic batch script to execute powershell scripts along with positional parameters\nC:\\LetsEncrypt>REM Pass path to PS1 script as well as any parameters you want to pass\nC:\\LetsEncrypt>REM Spaces are not supported in script path\nC:\\LetsEncrypt>REM Ex. \"PSScript.bat c:\\scripts\\test.ps1 value\"\nC:\\LetsEncrypt>powershell.exe -ExecutionPolicy RemoteSigned -File ./Scripts/DNS/Delete.ps1 remote.masephol.com _acme-challenge.remote.masephol.com\n* END OF LOG ***\nThis would work if the first parameter to the add script (.\\Scripts\\DNS\\Add.bat) was just remote instead of remote.masephol.com\nMaybe this is a windows/powershell specific DNS script thing?. I appreciate the response.  I think I might have caused some confusion by calling referring to things as the hostname.  The first parameter the script doesn't use, the name of the TXT record to create is probably where my question.  I'm asking if the name of the TXT record should be a FQDN or if it should just be the _acme-challenge.remote part.\nWhen I dig through Microsoft's support for the powershell command that is being used it seems like they are expecting the -Name parameters to just be the _acme-challenge.remote, not the fqdn.  \nMaybe other DNS services (Linux) work that way, maybe they don't, I don't know.\nI guess I'm wondering if in the code you have just the actual name to create without the domain available that could be passed as an additional parameter for Windows DNS to work.\nhttps://docs.microsoft.com/en-us/powershell/module/dnsserver/add-dnsserverresourcerecord?view=win10-ps#description. Appreciate the responses people gave.  I figured that some work was going to be needed in the script to make this work.  I  just wanted to get something out there to see if anybody else had successfully implemented the DNS validation and possibly they would post their solutions.  I will work on handling this in my add/delete scripts and go from there.  Thanks for all the work you guys are doing!. ",
    "heavyguidence": "@pmorriss Thank you for your reply. I tried to use your script, however seems like it hangs on step below. where is %3 argument being used shown in here\n[INFO] Script C:\\testing\\createdns.bat starting with parameters hostname.domain.com _acme-challenge.hostname.domain.com bukzhPuSozc7WVFtEYYRsuBh55u2GNZw9Zn7mIX1YYQ\nno record is created as the script is stuck on above.. ",
    "EddieGreen": "Just reading this thread helped a great deal in creating the scripts for DNS-01. Thanks to @pmorriss \nThe scripts weren't quite correct - see working copies in zip file, or contents below:\ncreate-dns.bat:\npowershell -file ./create-dns.ps1 %1 %2 %3\ndelete-dns.bat\npowershell -file ./delete-dns.ps1 %1 %2\ncreate-dns.ps1\nNote: Replace DNSSERVERNAME with your DNS server name\nImport-module dnsserver\nAdd-DnsServerResourceRecord -TXT -Computername DNSSERVERNAME -ZoneName $args[0] -Name $args[1] -DescriptiveText $args[2]\ndelete-dns.ps1\nNote: Replace DNSSERVERNAME with your DNS server name\nImport-module dnsserver\nRemove-DnsServerResourceRecord -RRType \"Txt\" -Computername DNSSERVERNAME -ZoneName $args[0] -Name $args[1] -Force\nTest CMDs\nNote: Modify zone and name arguments to a domain already on your DNS\n```\npowershell -file ./create-dns.ps1 yourdomain.com _acme-challenge.yourdomain.com bukzhPuSozc7WVFtEYYRsuBh55u2GNZw9Zn7mIX1YYQ\npowershell -file ./delete-dns.ps1 yourdomain.com _acme-challenge.yourdomain.com\n```\nDNS-01 Scripts.zip\n. ",
    "StrontiumGIT": "Big thanks. Actually yeah, when I first created the certificates I did do the binding manually. So that makes total sense. \nI'm guessing the only way to get round that would be to create them all again taking the auto bind option?. ",
    "yooshimooshi": "i have the lastet release 1.9.10  but when i type letsencrypt.exe --version it returns : 'Let's Encrypt Simple Windows Client 1.9.3.21006'\nbut when i see file properties of  letsencrypt.exe file the version is 1.9.10.1\nand my problem exist about command lines and none of plugin Arguments could not be found\nwhat is the problem?. i know what i am running very well!\ni never downloaded any old version previously that i can run!\ni have downloaded the lastest version a few days ago and cd to currect folder and run that! and before that time i never downloaded letsencrypt!. ",
    "stamster": "I'm having exact same issues, but none of the listed domains are advertising IPv6 DNS records.\nSomething is not quite right with multiple DNS records (all listed in ALT names certificate section) and Let's encrypt...\nI'm using pure letsencrypt certonly --standalone - with nginx stopped before procedure.\n. It has nothing to do with IPv6.\nIt turned out that internal, --standalone web server (written in Python) which serves for the purpose of ACME challenge by CA fails under heavy load, e.g. when there are many client requests at the same time coming through web ports (80 and 443).\nSo the real solution is to use web-root and serve ACME challenge files by nginx.\n```bash\n!/bin/bash\nWEB-root renewal\nletsencrypt renew --webroot -w /var/www/html/acme\nReload web server\nsystemctl reload nginx.service\n```\nOf course rule for nginx must be applied to handle the requested files:\n```nginx\nServing ACME challenge for each instance\nlocation ^~ /.well-known/acme-challenge/ {\n        default_type 'text/plain';\n        root /var/www/html/acme;\n}\n```\nThis works :100: - no more issues and kernel messages with SYN cookies etc.\n. ",
    "Tessando": "Just a quick addendum to help me hone in more on this question:\nIn the Advanced Usage section of the wiki, it mentions the Registry Key:\nHKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple{BASEURI}\\Renewals\nI do not see \"letsencrypt-win-simple\" as a subkey.\nIs there a command that I can run to initiate the Scheduled Task? Or should I revoke these certificates and start all over again?\nThank you for your help. \nwin-acme (v1.9.10.1)\n. Ah ha, there is. Thank you for posting your location. I see it now that I dig a bit deeper. Thank you.. Thank you.\nIn the URL you mentioned it says to create a script, for example, \"create-dns.bat\" and then \"delete-dns.bat\".\nI'm a little lost at this: (1) What language do I write the scripts in to create the TEXT Records? (2) How do I invoke this in the Win-ACME v 1.9.10.1?\nThank you for your help.\n.... Thank you @WouterTinus  - In my particular case I am using Amazon Route53 for DNS, so yes there are ways to integrate with Route53 via Script (either CLI or one of my new favorites, which is CLI53).\nThat said, how do I know what record to add in the invocation script? In other words, how can I tell Route53 to create a text record if I don't know what it's going to be? Is there a way to see this in the Win-ACME Powershell window before invoking?\nThank you for your help.\n...\n.... ",
    "TAnthrax": "Thank you! I simply followed the steps in the OP and it appears to work unattended on Exchange 2016 running on Server 2012R2. WACS Version 1911.2.6726.40690. . ",
    "GilchristT": "+1 that the OP changes worked for me with a fresh install of Exchange 2016 CU10 and Windows Server 2016.\nOne additional change I had to make was to specify the path to powershell.exe in the PSExchange.bat script i.e. \n%SYSTEMROOT%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -ExecutionPolicy Bypass -File ./Scripts/ImportExchange.ps1 %2 IIS,SMTP,IMAP,POP 1 %1 %3\nNot sure if this is a Windows 2016 issue or a problem with my Windows 2016 template VM.. ",
    "galoou": "I don't know why but the generated cert is put into 2 store : WebHosting and My.\nIn ImportExchange.ps1 the line 87\npowershell\n$CertInStore = Get-ChildItem -Path Cert:\\LocalMachine -Recurse | Where-Object {$_.thumbprint -eq $NewCertThumbprint} | Select-Object -f 1\nretrieve the WebHosting one.\nSo the test at line 89\npowershell\nif($CertInStore.PSPath -notlike \"*LocalMachine\\My\\*\")\nis true and an error is raised.\nTo retrieve the My store cert, I have to replace line 87 by\npowershell\n$CertInStore = Get-ChildItem -Path Cert:\\LocalMachine -Recurse | Where-Object {$_.thumbprint -eq $NewCertThumbprint -and $_.PSPath -like \"*LocalMachine\\My\\*\"} | Select-Object -f 1\nI don't know the PowerShell script language so I don't know if it's a good solution as I do not understand the whole script.. ",
    "damianlavalle": "\n@galoou is an error raised because the cert is already in the local store? The script could probably be improved to return the one in the personal store if they are in both (I thought it already did that with a sort, but looks like it doesn't)\nI've made some changes similar to the ImportRDGateway.ps1 script. Could you test first by using the script from my PR here? #959\n\nI can confirm It's working for me. Copied your revised script from git as raw, overwrote the contents of ImportExchange.ps1 and ran the full command: \nletsencrypt.exe --plugin manual --manualhost mail.domain.tld,webmail.domain.tld,autodiscover.domain.tld,hostname.domain.tld --validation selfhosting --installation iis,manual --installationsiteid 1 --script \"./Scripts/PSScript.bat\" --scriptparameters \"./Scripts/ImportExchange.ps1 {5} IIS,SMTP,IMAP,POP 1\"\nEven added POP to the Exchange services and it worked perfectly.\nBut If I try to run the command with a Cert store I get an error, but it's something else.... Can't tell if it's something on my side... I ran the command exactly like:\nletsencrypt.exe --plugin manual --manualhost mail.domain.tld,webmail.domain.tld,autodiscover.domain.tld,hostname.domain.tld --validation selfhosting --centralsslstore C:\\Central_SSL\\ --installation iis,manual --installationsiteid 1 --script \"./Scripts/PSScript.bat\" --scriptparameters \"./Scripts/ImportExchange.ps1 {5} IIS,SMTP,IMAP 1 \"mail.domain.tld\" C:\\Central_SSL\\\"\n[INFO] Script ./Scripts/PSScript.bat starting with parameters ./Scripts/ImportExchange.ps1 DebugOn XXXXXXXXXXXXXXXXXXXXXXXXXXXXX IIS,SMTP,IMAP 1\n [EROR] Script error: C:\\Program Files (x86)\\Letsencrypt\\Scripts\\ImportExchange.ps1 : Cannot process\n [EROR] Script error: argument transformation on parameter 'LeaveOldExchangeCerts'. Cannot convert\n [EROR] Script error: value \"IIS,SMTP,IMAP\" to type \"System.Int32\". Error: \"Input string was not in\n [EROR] Script error: a correct format.\"\n [EROR] Script error:     + CategoryInfo          : InvalidData: (:) [ImportExchange.ps1], ParentCon\n [EROR] Script error:    tainsErrorRecordException\n [EROR] Script error:     + FullyQualifiedErrorId : ParameterArgumentTransformationError,ImportExcha\n [EROR] Script error:    nge.ps1\n [INFO]\nC:\\Program Files (x86)\\Letsencrypt>REM Generic batch script to execute powershell scripts along with positional parameters\nC:\\Program Files (x86)\\Letsencrypt>REM Pass path to PS1 script as well as any parameters you want to pass\nC:\\Program Files (x86)\\Letsencrypt>REM Spaces are not supported in script path\nC:\\Program Files (x86)\\Letsencrypt>REM Also, in testing, powershell script must use positional parameters. Results may vary\nC:\\Program Files (x86)\\Letsencrypt>REM Ex. \"./Scripts/PSScript.bat c:\\scripts\\test.ps1 value\"\nC:\\Program Files (x86)\\Letsencrypt>powershell.exe -ExecutionPolicy RemoteSigned -File ./Scripts/ImportExchange.ps1 DebugOn XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX IIS,SMTP,IMAP 1\nError: C:\\Program Files (x86)\\Letsencrypt\\Scripts\\ImportExchange.ps1 : Cannot process\nError: argument transformation on parameter 'LeaveOldExchangeCerts'. Cannot convert\nError: value \"IIS,SMTP,IMAP\" to type \"System.Int32\". Error: \"Input string was not in\nError: a correct format.\"\nError:     + CategoryInfo          : InvalidData: (:) [ImportExchange.ps1], ParentCon\nError:    tainsErrorRecordException\nError:     + FullyQualifiedErrorId : ParameterArgumentTransformationError,ImportExcha\nError:    nge.ps1\n. After tracing the steps, and  trying to manually pass the \"Enable-ExchangeCertificate\" command directly I got an error stating that no cert with the thumbprint was found. Sure enough when I went to go look, the certificate that is saved as a pfx file in the Central_SSL folder is not in either the Webhosting Or the My Cert Stores. . ",
    "vdellaglio": "Hi all,\nI tried everything on this topic, but I keep getting:\n`Cert thumbprint not found in the cert store... which means we should load it. This means TargetHost and StorePath must b\ne specified\nTry to load certificate from store\nCert thumbprint was not set successfully\nError: Cannot bind argument to parameter 'Path' because it is an empty string.\n[INFO] Uninstalling certificate from the certificate store\n [INFO] Removing certificate aaaaaaaaa.info 2018/12/14 14:56:38 PM from store WebHosting\n [INFO] Renewal for aaaaaaaaa.info succeeded\n [INFO] Next renewal scheduled at 2019/2/7 14:58:05 PM`\nAny ideas? Thanks in advance!. ",
    "Atlantis1979": "Nice work OP... we have a 2012R2 server running Exchange 2013.\nHad to edit the scripts to match your as we were getting nowhere except we get this result at the end of the Exchange certificate import:\nC:\\WACS>Powershell.exe -ExecutionPolicy Bypass -File ./Scripts/ImportExchange.ps1 xxxCertificateKeyxxx IIS,SMTP,IMAP,POP 1 servername.com C:\\ProgramData\\win\n-acme\\acme-staging-v02.api.letsencrypt.org\\Certificates\\RnFOUfskGkuH6SHwaTB4CQ-all.pfx\nCert thumbprint not found in the cert store... which means we should load it. This means TargetHost and StorePath must be specified\nTry to load certificate from store\nCert thumbprint was not set successfully\nError: A special Rpc error occurs on server WIN2012R2: The source data cannot be imported or the wrong password was specified.\nAny ideas on this one? We're getting so close to making this work, but just need to jump this final hurdle and can do away with out DigiCert certificate that expires in a few weeks.. Thanks Wouter,\nWhat store is suggested to use instead of the default Web Hosting?. Thank you! I managed to get it working with:\nwacs --certificatestore My\nWouldn't work when I added it to settings.config as follows however:\n<setting name=\"CertificateStore\" serializeAs=\"String\">\n    <value>\"My\"</value>\nWill this successfully update itself via the scheduled task in the future?. Thank you. We are already running 2.0.0-beta1-hotfix1.. ",
    "lddhappy": "it seems work now. ",
    "frankhommers": "@WouterTinus, How do you point it toward the right .dll and class name then? . ",
    "cloudy0mike": "Thanks for your advised. :). ",
    "jmar83": "For the next try, i didn't get asked for an e-mail-address anymore ...? That's a lil bit strange too...!!\nRegards, Jan. Now it works when i use the parameter \"\", but not i get that error with a xxx.dlinkddns.com domain:\n[INFO] Plugin IISBinding generated target [IISBinding] aaa.dlinkddns.com (Si\nteId 2) [ @ C:\\inetpub\\wwwroot]\n [INFO] Authorize identifier: aaa.dlinkddns.com\n [INFO] Authorizing aaa.dlinkddns.com using http-01 validation (SelfHosting)\n [INFO] Answer should now be browsable at http://aaa.dlinkddns.com/.well-know\nn/acme-challenge/e74IsiobKzxDn6XbghY9WpbGQoniqMDTnzEttrdbvGU\n [INFO] Authorization result: valid\n [INFO] Requesting certificate aaa.dlinkddns.com 2018.5.3 8:54:06\n [EROR] AcmeWebException: Unexpected error\n +Response from server:\n        + Code: 429\n        + Content: {\n  \"type\": \"urn:acme:error:rateLimited\",\n  \"detail\": \"Error creating new cert :: too many certificates already issued for\n: dlinkddns.com: see https://letsencrypt.org/docs/rate-limits/\",\n  \"status\": 429\n}\n [EROR] Create certificate failed\nIs there a problem because of \"too many certificates already issued for\n: dlinkddns.com\" - because there are (too) many certificates used for dlinkddns.com subdomains?\nRegards, Jan. How can i revert ALL changed that your tool applied on my IIS configuration? I don't like an inconsistent configuration!!\n\"Revoke certificate\" shows nothing.. no entries..\nRegards, Jan. Problem seems to persist until now, right? \"we want to find a better solution for dynamic DNS providers but we haven\u2019t deployed one yet. I\u2019m sorry for the delay.\"\n-> https://community.letsencrypt.org/t/too-many-certificates-already-issued-for-dlinkddns-com-status-429/10886/6 (Submission date Feb '16..)\nSo, there is still the question how to revert ALL change that your software made on my system. (IIS and so on..)\nRegards, Jan. Hi there!\nOK, thx. Later, i think i will try it with some other domains..\nBest regards,\nJan. ",
    "AniInABox": "Actually i have no clue what an IIS Target Plugin is. So no i hasn't tried it.\nThe only way we have found to get a working certificate for an IDN Domain is:\n1. Manually enter the host name, but this gives an error when creating the binding\n2. Manually add the Binding to the Site and select this certificate\nBut then we have no renew schedule for this Domain.\nWe are hosting around 800 Sites on this IIS, and it is not a good way to renew IDN Domains manually.. ",
    "IIIdefconIII": "@webprofusion-chrisc @WouterTinus \nIts not a internal domain. Maybe the system detect it like this way. So i used option 4 instead and used the real domainname: webaccess.jpg-bouw.nl and choosed for 2 SBS client deployment applications, getting the following error:\n23821864: Companyweb\n 1: Default Web Site\n 2: SBS Client Deployment Applications\n 284337142: SBS SharePoint\n 1178717237: SharePoint Central Administration v4\n 3: SharePoint Web Services\nChoose site to create new bindings: \n [INFO] Authorize identifier: webaccess.jpg-bouw.nl\n [INFO] Authorizing webaccess.jpg-bouw.nl using http-01 validation (SelfHosting)\n [INFO] Answer should now be browsable at http://webaccess.jpg-bouw.nl/.well-known/acme-challenge/7OEihSfdJzyP7kN_QabN4M_qhvHgoWHtXOUN4NLjoMk\n [EROR] Authorization result: invalid\n [EROR] NullReferenceException: Object reference not set to an instance of an object.\n. installed the latest version, still getting errors, invalid response \niis and win acme runs on the same server\nEnter comma-separated list of host names, starting with the primary one: \n [INFO] Plugin Manual generated target [Manual] [1 binding - webaccess.jpg-bouw.nl]\n [DBUG] Loading signer from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: webaccess.jpg-bouw.nl\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing webaccess.jpg-bouw.nl using http-01 validation (SelfHosting)\n [INFO] Answer should now be browsable at http://webaccess.jpg-bouw.nl/.well-known/acme-challenge/xg3mtGwraY8AoSgO1ypBAt6zVyjoN2Ni5XkyTQ6rn-c\n [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/CqeepTBf2y1r3F9F7NDNn9yQOBXl1R9uQn49clU2CaM/4637071406\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/CqeepTBf2y1r3F9F7NDNn9yQOBXl1R9uQn49clU2CaM\n [EROR] Authorization result: invalid\n [DBUG] Deleting answer\n [EROR] ACME server reported:\n [EROR] [type] urn:acme:error:unauthorized\n [EROR] [detail] Invalid response from http://webaccess.jpg-bouw.nl/.well-known/acme-challenge/xg3mtGwraY8AoSgO1ypBAt6zVyjoN2Ni5XkyTQ6rn-c: \"<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n\n404 Not Found\n\nNot Found\n<p\"\n [EROR] [status] 403\n [EROR] Create certificate failed. yes IIS is binded to port 80, can we change the port of acme? i also cant find the file that should be created, but it may that im looking at the wrong directory.\nWhat i have tried so far.\n1. I tried putting up the staticfile above extensions but that doesnt work either\n2. added mime type . as text/plain\n3. deleted unnecessarily ipv6 AAAA records. So i checked and the website gives me a http 404 not found error.\n[DBUG] Test parameter set: https://acme-staging.api.letsencrypt.org/\n [DBUG] Config folder: C:\\ProgramData\\win-acme\\httpsacme-staging.api.letsencrypt.org\n [VERB] Settings SettingsService {ConfigPath=\"C:\\ProgramData\\win-acme\\httpsacme-staging.api.letsencrypt.org\", ClientNames=[\"win-acme\", \"letsencrypt-win-simple\"], RenewalDays=55, HostsPerPage=50, ScheduledTaskRandomDelay=00:00:00, ScheduledTaskStartBoundary=09:00:00, ScheduledTaskExecutionTimeLimit=02:00:00}\n [VERB] .NET Framework >=4.7 detected\n[INFO] A Simple ACME Client for Windows (WACS)\n [INFO] Software version 1911.0.6706.12865 (RELEASE)\n [INFO] IIS version 7.5\n [INFO] ACME server https://acme-staging.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\n [VERB] Verbose mode logging enabled\n[DBUG] Renewal period: 55 days\n [VERB] Store renewals in file C:\\ProgramData\\win-acme\\httpsacme-staging.api.letsencrypt.org\\Renewals\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: \n [INFO] Running in Advanced mode\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: \n Enter comma-separated list of host names, starting with the primary one: \n [INFO] Plugin Manual generated target [Manual] [1 binding - webaccess.jpg-bouw.nl]\n1: [dns-01] Azure DNS\n 2: [dns-01] Run external program/script to create and update records\n 3: [http-01] Save file on local (network) path\n 4: [http-01] Self-host verification files (recommended)\n 5: [http-01] Upload verification file to FTP(S) server\n 6: [http-01] Upload verification file to WebDav path\n C: Cancel\nHow would you like to validate this certificate?: \n 1: Create or update https bindings in IIS\n 2: Do not run any installation steps\n 3: Run a custom script\n C: Cancel\nWhich installer should run for the certificate?: \n Would you like to add another installer step? (y/n): - no\n[DBUG] Loading signer from C:\\ProgramData\\win-acme\\httpsacme-staging.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\win-acme\\httpsacme-staging.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: webaccess.jpg-bouw.nl\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing webaccess.jpg-bouw.nl using http-01 validation (SelfHosting)\n [INFO] Answer should now be browsable at http://webaccess.jpg-bouw.nl/.well-known/acme-challenge/1t8lhnqYS5m1ThyCGyi_u6tEs04LF44LlcReIgy4cV4\n[--test] Try in default browser? (y/n): - yes\nPress enter to continue...  [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-staging.api.letsencrypt.org/acme/challenge/BdJIm9A9982l3H1cUPmg54u3VxEqH1yN98rj9V7eqWs/128201480\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-staging.api.letsencrypt.org/acme/authz/BdJIm9A9982l3H1cUPmg54u3VxEqH1yN98rj9V7eqWs\n [EROR] Authorization result: invalid\n [DBUG] Deleting answer\n [EROR] ACME server reported:\n [EROR] [type] urn:acme:error:unauthorized\n [EROR] [detail] Invalid response from http://webaccess.jpg-bouw.nl/.well-known/acme-challenge/1t8lhnqYS5m1ThyCGyi_u6tEs04LF44LlcReIgy4cV4: \"<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n\n404 Not Found\n\nNot Found\n<p\"\n [EROR] [status] 403\n [EROR] Create certificate failed\n. first of all, thank you so much for youre time. second of all, im feeling so gooddamn stupid now. the domain name is jpg-sbs. so i assumed it was jpg-bouw.nl instead it was jpgbouw.nl you see? im sorry, think i worked to much last few days.\nstill having troubling with the apply of the certification tough, The does excist now in test mode, \n[INFO] Installing certificate in the certificate store\n [INFO] Adding certificate webaccess.jpgbouw.nl 2018-5-18 0:29:07  to store My\n [INFO] Installing with IIS...\n [EROR] Error installing\nSystem.Exception: Unable to find IIS SiteId #-1\n   at PKISharp.WACS.Clients.IISClient.GetWebSite(Int64 id)\n   at PKISharp.WACS.Clients.IISClient.AddOrUpdateBindings(Target target, SSLFlag\ns flags, CertificateInfo newCertificate, CertificateInfo oldCertificate)\n [EROR] Unable to install certificate\nSystem.Exception: Unable to find IIS SiteId #-1\n   at PKISharp.WACS.Clients.IISClient.GetWebSite(Int64 id)\n   at PKISharp.WACS.Clients.IISClient.AddOrUpdateBindings(Target target, SSLFlag\ns flags, CertificateInfo newCertificate, CertificateInfo oldCertificate)\n   at PKISharp.WACS.Plugins.InstallationPlugins.IISWebInstaller.PKISharp.WACS.Pl\nugins.Interfaces.IInstallationPlugin.Install(CertificateInfo newCertificate, Cer\ntificateInfo oldCertificate)\n   at PKISharp.WACS.Program.OnRenewSuccess(ILifetimeScope renewalScope, Schedule\ndRenewal renewal)\ni tried to look it up but cant find alot of it to be honest.  [DBUG] Config folder: C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\n [VERB] Settings SettingsService {ConfigPath=\"C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\", ClientNames=[\"win-acme\", \"letsencrypt-win-simple\"], RenewalDays=55, HostsPerPage=50, ScheduledTaskRandomDelay=00:00:00, ScheduledTaskStartBoundary=09:00:00, ScheduledTaskExecutionTimeLimit=02:00:00}\n [VERB] .NET Framework >=4.7 detected\n[INFO] A Simple ACME Client for Windows (WACS)\n [INFO] Software version 1911.0.6706.12865 (RELEASE)\n [INFO] IIS version 7.5\n [INFO] ACME server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\n [VERB] Verbose mode logging enabled\n[DBUG] Renewal period: 55 days\n [VERB] Store renewals in file C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Renewals\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: \n [INFO] Running in Simple mode\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: \n Enter comma-separated list of host names, starting with the primary one: \n [INFO] Plugin Manual generated target [Manual] [1 binding - webaccess.jpgbouw.nl]\n [DBUG] Loading signer from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: webaccess.jpgbouw.nl\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Cached authorization result: valid\n [DBUG] Certificate folder: C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Certificate store: My\n [DBUG] Set private key exportable\n [WARN] Using cached certificate for webaccess.jpgbouw.nl 2018-5-18 0:56:48 . To force issue of a new certificate within 24 hours, delete the .pfx file from the CertificatePath or run with the --forcerenewal switch. Be ware that you might run into rate limits doing so.\n [WARN] Certificate with thumbprint C3E8BB1BD778AB814518B9B2E2836A04470F8646 is already in the store\n [INFO] Installing with IIS...\n [EROR] Error installing\nSystem.Exception: Unable to find IIS SiteId #-1\n   at PKISharp.WACS.Clients.IISClient.GetWebSite(Int64 id)\n   at PKISharp.WACS.Clients.IISClient.AddOrUpdateBindings(Target target, SSLFlags flags, CertificateInfo newCertificate, CertificateInfo oldCertificate)\n [EROR] Unable to install certificate\nSystem.Exception: Unable to find IIS SiteId #-1\n   at PKISharp.WACS.Clients.IISClient.GetWebSite(Int64 id)\n   at PKISharp.WACS.Clients.IISClient.AddOrUpdateBindings(Target target, SSLFlags flags, CertificateInfo newCertificate, CertificateInfo oldCertificate)\n   at PKISharp.WACS.Plugins.InstallationPlugins.IISWebInstaller.PKISharp.WACS.Plugins.Interfaces.IInstallationPlugin.Install(CertificateInfo newCertificate, CertificateInfo oldCertificate)\n   at PKISharp.WACS.Program.OnRenewSuccess(ILifetimeScope renewalScope, ScheduledRenewal renewal)\n [EROR] Create certificate failed\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: . It still doesnt work arg, i went 1 version lower and it reports that its ok when i do a manual input, but its not applying to the website. When i use interactive mode it keeps failing with not anough dns labels...i have google some solution but without avail. It has been fixed. I had to select the certificate in IIS itself. Thank much. ",
    "pollardd": "Thanks for the quick response.  I'm not sure I understand the reasons but I understand the outcome.\nThe --script only runs for new certificates and not for renewals.\nI don't really want to automate removal of my certificate(s) in case the recreate process fails and I'm left with nothing.\nAs my install script works when I run it from the command line I'll just schedule it to run once a week from the task scheduler.  If there are new renewed certificates waiting there it should install them.\nIf there are no updated certificates then it may produce an error but that's OK if I'm expecting it.\nMy renewal script is scheduled to run every morning.\nSo I think this will be a successful work around.\nThanks\nDavid\n. Hi Wouter,\nI have finally gotten back to my install problem.  I have tried to recreate a new certificate and the new version of letsencrypt.exe has all different options compared to what I answered the last time.  I'm currently running version  1.98.10.1 which I think is only one point off the latest.    I have about 2 weeks before my current certificates expire and I can't get them to renew at all now.\nI spent the whole day trying to figure this out and I seem to be going backwards now.\nI started Letsencrypt.exe from an elevated command prompt like this.\nC:\\LetsEncrypt>letsencrypt.exe  --centralsslstore c:\\Central_SSL\\ --script  \"C:\\LetsEncrypt\\InstallCertificate.cmd\"\nOutput.txt\nAttached is the output from how I answered the questions.\nSome of them were a bit of a guess.  Where can I find instructions on how to answer these correctly in my situation?\nPreviously my IIS 7 install worked automatically.  At least I don't remember doing anything specifically.\nIs that no longer supported?\nI just went to look at buying a commercial certificate and the total crap on their websites just makes me sick.\nAny assistance greatly appreciated.   I don't mind starting from scratch but I just need some clear instructions.\nThanks\nDavid\n. Hello Wouter,\nI have added the the new CertificatePath in Settings.config.\n(FYI i received an unhandled exception error and it turned out I had Value instead of value which was not at all obvious.  Luckily it was the only thing I had changed)\n<setting name=\"CertificatePath\" serializeAs=\"String\">\n    <value>c:\\Central_SSL\\</value>\n</setting>\nI ran this from the command line and received much better results.\nMy new certificate was created and installed.   My install script still timed out which is odd.\nC:\\LetsEncrypt>letsencrypt.exe --script \"c:\\LetsEncrypt\\InstallCertificate.cmd\" --forcerenewal\n[INFO] A Simple ACME Client for Windows (WACS)\n [INFO] Software version 1910.1.6661.39349 (RELEASE)\n [INFO] IIS version 7.5\n [INFO] ACME server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: m\n[INFO] Running in Advanced mode\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: 4\nEnter comma-separated list of host names, starting with the primary one: mail.vjray.com.au,campsie.vjray.com.au\n[INFO] Plugin Manual generated target [Manual] [2 bindings - mail.vjray.com.au, ...]\n1: [dns-01] Azure DNS\n 2: [dns-01] Run external program/script to create and update records\n 3: [http-01] Save file on local (network) path\n 4: [http-01] Self-host verification files (recommended)\n 5: [http-01] Upload verification file to FTP(S) server\n 6: [http-01] Upload verification file to WebDav path\n C: Cancel\nHow would you like to validate this certificate?: 4\n1: Create or update https bindings in IIS\n 2: Do not run any installation steps\n 3: Run a custom script\n C: Cancel\nWhich installer should run for the certificate?: 3\nWould you like to add another installer step? (y/n): - yes\n1: Create or update https bindings in IIS\n C: Cancel\nWhich installer should run for the certificate?: 1\nFull instructions:  https://github.com/PKISharp/win-acme/wiki/Install-Script\n {0}:                Hostname\n {1}:                .pfx password\n {2}:                .pfx path\n {3}:                Certificate store name\n {4}:                Certificate friendly name\n {5}:                Certificate thumbprint\n {6}:                Central SSL store path\nEnter the parameter format string for the script, e.g. \"--hostname {0}\":\n1515693492: Companyweb\n 1: Default Web Site\n 4: PortfolioMap\n 2: SBS Client Deployment Applications\n 1451638019: SBS SharePoint\n 1926277976: SharePoint Central Administration v4\n 3: SharePoint Web Services\n 1572271583: WSUS Administration\nChoose site to create new bindings: 1\n[INFO] Authorize identifier: mail.vjray.com.au\n [INFO] Cached authorization result: valid\n [INFO] Authorize identifier: campsie.vjray.com.au\n [INFO] Cached authorization result: valid\n [INFO] Requesting certificate mail.vjray.com.au 2018/7/12 13:55:12 PM\n [INFO] Saving certificate to c:\\Central_SSL\\\n [INFO] Installing certificate in the certificate store\n [INFO] Adding certificate mail.vjray.com.au 2018/7/12 13:55:12 PM to store My\n [INFO] Installation step 1/2: Manual...\n [INFO] Script c:\\LetsEncrypt\\InstallCertificate.cmd starting...\n\n[INFO]\nC:\\LetsEncrypt>REM\nC:\\LetsEncrypt>REM Call the powershell script to import the generated certificate into Exchange\nC:\\LetsEncrypt>REM\nC:\\LetsEncrypt>REM THis script (InstallCertificate.cmd) is called from the scheuld task Using the --script option\nC:\\LetsEncrypt>SET logfile=C:\\Letsencrypt\\Installcertificate.log\nC:\\LetsEncrypt>set logfile2=c:\\Letsencrypt\\LetsEncrypt.log\nC:\\LetsEncrypt>del c:\\Letsencrypt\\LetsEncrypt.log\nC:\\LetsEncrypt>SET SUBJECT=Install_Exchange_Certificate_for_campsie.vjray.com.au_and_mail.vjray.com.au\nC:\\LetsEncrypt>echo --------------------------------------------------------------------------------------------------------  1>\"C:\\Letsencrypt\\Installcertificate.log\"\nC:\\LetsEncrypt>echo -- Begin InstallCertificate.cmd --  1>>\"C:\\Letsencrypt\\Installcertificate.log\"\nC:\\LetsEncrypt>date /t   1>>\"C:\\Letsencrypt\\Installcertificate.log\"  && time /t  1>>\"C:\\Letsencrypt\\Installcertificate.log\"\nC:\\LetsEncrypt>echo --------------------------------------------------------------------------------------------------------  1>>\"C:\\Letsencrypt\\Installcertificate.log\"\nC:\\LetsEncrypt>powershell.exe -PSConsoleFile \"C:\\Program Files\\Microsoft\\Exchange Server\\V14\\Bin\\ExShell.Psc1\" -command \". 'c:\\letsencrypt\\InstallCertificate.ps1'\"  1>>C:\\Letsencrypt\\Installcertificate.log 2>&1\n[WARN] Script execution timed out after 5 minutes, will keep running in the background\n [INFO] Installation step 2/2: IIS...\n [INFO] Committing 1 https binding changes to IIS\n [INFO] IIS will serve the new certificates after the Application Pool IdleTimeout has been reached.\n Do you want to replace the existing task? (y/n): - yes\n [INFO] Deleting existing task win-acme httpsacme-v01.api.letsencrypt.org from Windows Task Scheduler.\n [INFO] Adding Task Scheduler entry with the following settings\n [INFO] - Name win-acme httpsacme-v01.api.letsencrypt.org\n [INFO] - Path C:\\LetsEncrypt\n [INFO] - Command letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\n [INFO] - Start at 09:00:00\n [INFO] - Time limit 02:00:00\n Do you want to specify the user the task will run as? (y/n): - yes\n Enter the username (Domain\\username): campsie**\nEnter the user's password: ***\n [INFO] Renewal for mail.vjray.com.au succeeded\n [INFO] Next renewal scheduled at 2018/9/5 4:02:02 AM\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: q\nI found this in the log file created by my install script.\n```\nGet-Content : Cannot find path 'C:\\Central_SSL\\campsie.vjray.com.au.pfx' because it does not exist.\nAt C:\\letsencrypt\\InstallCertificate.ps1:45 char:61\n+     Import-ExchangeCertificate -FileData ([Byte[]]$(Get-Content <<<<  -Path C:\\Central_SSL\\campsie.vjray.com.au.pfx -Encoding byte -ReadCount 0)) -\nPassword:$PfxPassword \n    + CategoryInfo          : ObjectNotFound: (C:\\Central_SSL\\campsie.vjray.com.au.pfx:String) [Get-Content], ItemNotFoundException\n    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetContentCommand\n```\nThere is indeed no campsie.vjray.com.au.pfx file.  the primary domain name is mail.vjray.com.au and the secondary name is campsie.vjray.com.au so there is only one PFX file.  I have updated my script to use this new filename.\nMy script appears to have exited before it reached the end so maybe that it what the timeout is about.\nSo now I think it is time again to wait for an automatic renewal in 60 days or so to see if it works end to end.  I am however a bit confused about how it actually succeeded in installing and assigning the certificate given the errors I found.\n. Hello Again,\nJust for completeness I thought I'd let anyone reading this thread that my renewal worked end to end today without me touching it and with no funny work arounds.\nThe last thing I did in July was to Recreate my certificate and include the --script parameter as part of the creation process.  There was no need to include this parameter in the renewal process.\nI'm now looking forward to years of smooth sailing :)\nThanks to all who assisted.\nDavid.. ",
    "engbert": "What if you forgot the script installation step in the setup?\nIs there a way to add it? Do you have to revoke the cerificate and restart?. ",
    "larsen0815": "Same problem here. How do I run a script after renewal?\nI have seen https://github.com/PKISharp/win-acme/wiki/Install-Script but don't understand what I would have to do now.. Error is gone after deleting the history file. I probably have emptied that file (instead of deleting it) when I was debugging a renewal script.\nThx!. ",
    "josegerez": "Yes, That was a problem with our proxy server. It requires authentication. I've tried also changing proxy settings in settings.config with no luck. Bypassing proxy, it works correctly. It seems is working now. Thanks!!. ",
    "marcoD22": "Sorry but I've the same problem. I downloaded the new version but the problem remain.\n\n. ",
    "hitnrun30": "I was able to update by adding the --emailaddress to the command line but I don't get why the scheduled task is created, it doesn't do what i specifically did originally, i.e. email address, or put the files where the config defaulted to.  What is a best practice?. Yes the registration file was created in the ProgramData Folder, but only after i added emailaddress to the command.  I then copied it to my cert folder and all was good.  I would rather the scheduled task do all that.  Is it that I just add the email address to the scheduled task and then create a script to copy the files to the correct folder of is there a way for it to create it to the correct folder?. BTW, just renewed, was getting the error, added email address to the command line, put it in the right place.  You may either change that or alert people to the same.. ",
    "bdukes": "We're seeing this error when the scheduled task is running.  It doesn't happen when running the command directly, or even when logging into the machine and running the scheduled task.\nI don't see files in C:\\ProgramData\\letsencrypt-win-simple\\httpsacme-v01.api.letsencrypt.org for these sites.  They were setup using an older version of letsencrypt-win-simple which, I guess, stored these in the registry.. ",
    "Rotrap": "Maybe.  I am more a familar with things on Unix systems than Windows, so needs some pointers on where to start to look into that.   Any CryptoProvider unit tests available?  A post I made on reddit ( https://www.reddit.com/r/exchangeserver/comments/8j0skm/getting_a_lets_encrypt_certificate_working/   ) led to being told about https://community.letsencrypt.org/t/ssl-cert-for-exchange-2013/1364/30  which shows another package for Powershell being used to convert a cert for use with Exchange 2010.  I could not try that though as I have Powershell 2.0 available and I think that needs 3.0.   So I thought it could be an older CryptoProvider, but I did not see any real code changes from a quick look at the changelog here that would seem to have broken it since February.. I have done that.  While logged in, and from the same user/session that ran the program.  I have imported the pfx file using the Exchange Console and using the Powershell Import-ExchangeCertificate command, and that part seems to work.  It then fails on the EnableExchangeCertificate complaining about the private key not being accessible. The same cert though is running just fine on IIS from the installation that was just done during the certificate creation.   Take a look at the reddit post I linked to above, and you will see I also tried the certutil --repairstore command that says it worked but EnableExchangeCertificate still fails.   It really is strange, and the only hints I found where in that thread on the community.letsencrypt.com forum, and the error message from letsencrypt.exe I posted in the first message.  The pfx file is on the system  and readable in the same login/shell that ran letsencrypt.exe to create it.. Indeed.  Makes no sense.   The account is an administration account with full local admin and domain admin rights.\n. Any ideas for more things to look into?\nBTW,  I am not sure I agree with labelling this a question.  I consider the resulting certificate not being usable to encrypt the email server a bug somewhere.\n. ",
    "elizabeth-young": "@webprofusion-chrisc Thank you, I'll take a look.. Thanks, it didn't occur to me to change the baseuri. ",
    "2000c5": "I have had several other request go through now, but these domains still give me the above cryptic error. I have deleted and created the IIS sites, and have verified their DNS.\ndomain names removed. Seems the issue resolved itself and I can now issue certificates for these domains. The error message was still odd and cryptic.. No, it was definitely the correct URI. I could even run though the \"GUI\" and choose the site(s) and generate the same error. (yet it would issue correctly in --test mode)\nIn test mode I could navigate to the auth response on the server without issue.\nHave not had it happen since with lots of certificates issued. It was just odd that I had two that were doing this at the same time while others would issue flawlessly.\nThese same two issued correctly later after many attempts. The issuance did not seem to have anything to do with any corrections or changes I made.\nIf I run across this problem again I will most certainly post again. Is there any additional information I can collect or steps I can take in assisting in troubleshooting?. ",
    "i3laze": "Nice shot! Just one trim!\nTested v1.9.11.2 - works as intented!\nWill now maintain my Exchange 2013 cluster for a very long time.\nP.S. Changelog better be more descriptive: issue was related to CCS, not just language.. Damn, you\u2019re right - it\u2019s getting alphabetized on Let\u2019s Encrypt server side. More viewable though.\nIt just happens that my CN is below all Autodiscover records.\nNothing to do here. Windows XP is quite legacy OS to worry about.\nI don\u2019t believe problem is worth solving, but still made a post:\nhttps://community.letsencrypt.org/t/san-domain-name-mismatch-android-2-windows-xp/4060/36?u=i3laze. ",
    "Spongman": "can you expand on this explanation? the terms you use don't match up with the questions that the program asks, it's not clear what to do at each step.\nnormally i'd just fiddle around with it until it works, but every time i get it wrong i have to wait an hour... super frustrating.. ",
    "isideweb": "N.B. : WORK On Version 1.9.6.39968! Does not work on 1.9.11\nI have done a lot of test, but i doesn't success.\nI was found a workaround:\nMy configuration is:\nWeb Site 1 : Domain in Https \nWeb Site 2 : Domain in Http (with \"redirect\" to Https, each * url).\nAcme work in this way:\n1) Identify IIS ID of domain to renew, i suppose reading config IIS File (\\Windows\\system\\inetsrv\\config\\applicationhost.config)\n2) Write challenge token in folder of Web Site identified.\n3) Invoke \"http://domain/.well-known/acme-challenge\" (nb. : HTTP, not HTTPS).\nIf in applicationHost.config https version appear first than http version return Site ID of https version, elsewhere return Site ID of http version. \nAfter that write token in Site ID folder found (http or https in dependency of position in file).\nPossible scenario are:\nA) First HTTP and after HTTPS in ApplicationHost.config, Redirect From HTTP to HTTPS of all page (DOES NOT WORK renew)\nB) First HTTP and after HTTPS in ApplicationHost.config, NO Redirect of \".well-known...\" folder From HTTP to HTTPS (renew WORK correctly)\nC) First HTTPS and after HTTP in ApplicationHost.config, Redirect From HTTP to HTTPS (Renew WORK correctly)\nD) First HTTPS and after HTTP in ApplicationHost.config, NO Redirect \".well-known...\" (DOES NOT WORK renew)\nWorkaround is move \"HTTP site configuration block text\" in ApplicationHost.config in desired position relatively to \"HTTPS site configuration block text\". SiteID number seems no important.\nExample first HTTPS and AFTER HTTP: \n      <site name=\"Domain\" id=\"20\">\n            <application path=\"/\" applicationPool=\"WP\">\n                <virtualDirectory path=\"/\" physicalPath=\"E:\\Web\\Php\\Domain\" />\n            </application>\n            <bindings>\n                <binding protocol=\"https\" bindingInformation=\"*:443:www.domain.it\" sslFlags=\"1\" />\n            </bindings>\n        </site>\n\n\n        <site name=\"Domain\" id=\"10\" serverAutoStart=\"true\">\n            <application path=\"/\" applicationPool=\"Servizi\">\n                <virtualDirectory path=\"/\" physicalPath=\"E:\\Web\\DomainHTTP\" />\n            </application>\n            <bindings>\n                <binding protocol=\"http\" bindingInformation=\"*:80:www.domain.it\" />\n            </bindings>\n        </site>\n\nI suggest to modify SCRIPT adding parameters to specify if script must find http or https version of domain, instead to find the \"first occurrence\".. On Acme script 1.9.11, script identify always HTTPS Web Site in wich folder write challenge file, but after call \"HTTP\" domain. If Domain HTTPS and HTTP is in different directory it necessary to write redirect RULE from http:\\domain.well-known\\ to https:\\domain.well-known.\n. ",
    "lucyh-t": "The first run IIS Manager was open and I wondered about that. The other two runs IIS Manager was closed and I still got the same error.\nI have downloaded and am now using 1.9.11.1 which is working fine.\n[cid:image003.jpg@01D3FCA9.34B499C0]Lucy Hyde-Thomson\nBusiness Integrations Ltd\nM: 07710 491941\nE:  lucyht@business-integrations.comlucyht@business-integrations.com\nW: business-integrations.comhttp://business-integrations.com/\nBusiness Integrations Ltd is registered in England and Wales. Number: 06087926\nIntegrations Ltd is registered in England and Wales. Number: 06087926\nFrom: Wouter Tinus notifications@github.com\nSent: 05 June 2018 08:14\nTo: PKISharp/win-acme win-acme@noreply.github.com\nCc: Lucy Hyde-Thomson lucyht@business-integrations.com; Author author@noreply.github.com\nSubject: Re: [PKISharp/win-acme] v1.9.11.2 Error: Cannot commit configuration changes because the file has changed on disk (#871)\nHave you made any changes to IIS (e.g. through the IIS Manager GUI) while win-acme was running?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHubhttps://github.com/PKISharp/win-acme/issues/871#issuecomment-394605963, or mute the threadhttps://github.com/notifications/unsubscribe-auth/AcNeNG-1FEN7FPtRFQ5UwvFWhEGr9at-ks5t5i-8gaJpZM4UZv7u.\n. Hi there,\nI have downloaded version 1.9.11.2 again and run it with a fresh domain and it ran fine. I did not touch IIS Manager before using Win ACME this time.\nWould the fact that IIS Manager was open, but with no changes affect the program? Or the fact that IIS Manager was open for the first run, then closed before the second run but the same Win ACME session was open? I can\u2019t remember if I quit between those runs. I think so but I couldn\u2019t guarantee it.\nCheers,\nLucy\n[cid:image003.jpg@01D3FD05.88927600]Lucy Hyde-Thomson\nBusiness Integrations Ltd\nM: 07710 491941\nE:  lucyht@business-integrations.comlucyht@business-integrations.com\nW: business-integrations.comhttp://business-integrations.com/\nBusiness Integrations Ltd is registered in England and Wales. Number: 06087926\nIntegrations Ltd is registered in England and Wales. Number: 06087926\nFrom: Wouter Tinus notifications@github.com\nSent: 05 June 2018 16:55\nTo: PKISharp/win-acme win-acme@noreply.github.com\nCc: Lucy Hyde-Thomson lucyht@business-integrations.com; Author author@noreply.github.com\nSubject: Re: [PKISharp/win-acme] v1.9.11.2 Error: Cannot commit configuration changes because the file has changed on disk (#871)\nThat's very odd, the difference between 1.9.11.1 and 1.9.11.2 is just two checkins and both of them aren't anywhere near the IIS management code.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHubhttps://github.com/PKISharp/win-acme/issues/871#issuecomment-394763290, or mute the threadhttps://github.com/notifications/unsubscribe-auth/AcNeNKPySQlemCPwXrmDHkEl5OVHrDbKks5t5qnXgaJpZM4UZv7u.\n. ",
    "Zyxious": "I too have got this error and I'm not doing any changes to the configuration, just listing details. Have tested this in version 1.9.11.1 and 1.9.11.2, same problem occurs on both versions.\n\n. ",
    "FIAlM": "I had same error in 1.9.11.2, restarted server and tried again and then no more errors, changes commited successfully.\nThanks for the tool!! It makes our life easier.. ",
    "KampfFussel": "Let me know if you need any assistance. Great Project!. ",
    "MaiklT": "Thanks for the answer. It is done by the Scheduled Task, so I wonder if there is any kind of log file where I can find some output. What I found in the Windows Event Log was the following:\n09:00:04 - Let's Encrypt Windows Simple (LEWS)\n09:00:04 - Software version \"198.4.6605.15190\" (\"RELEASE\")\n09:00:05 - Renewing certificate for \"www.mydomain.com\"\n09:00:22 - Adding certificate \"www.mydomain.com 2018.6.1 9:00:15 \" to store \"WebHosting\"\n09:00:22 - Removing certificate \"www.mydomain.com 2018.4.6 9:00:18 \" from store \"WebHosting\"\n09:00:22 - Renewal for \"www.mydomain.com\" succeeded\n09:00:22 - Next renewal scheduled at \"2018.7.26 7:00:22 \"\nSo obviously it gets a new certificate, removes the old certificate but does not assign the new certificate.\nBest wishes\nMichael\n. It happened again:\n09:00:02 A Simple ACME Client for Windows (WACS)\n09:00:02 Software version \"1911.2.6726.40690\" (\"RELEASE\")\n09:00:03 Renewing certificate for \"www.anotherdomain.com\"\n09:01:00 Adding certificate \"www.anotherdomain.com 2018.6.11 9:00:41 \" to store \"WebHosting\"\n09:01:02 Removing certificate \"www.anotherdomain.com 2018.4.16 9:00:13 \" from store \"WebHosting\"\n09:01:02 Renewal for \"www.anotherdomain.com\" succeeded\n09:01:02 Next renewal scheduled at \"2018.8.5 7:01:02 \"\nBest wishes\nMichael\n. Thank you, I am trying this, and will give Feedback in two months (so please don't close it, I will when it worked)\nJust a question of interest: What is missing in the command line that I used to set up the certificates?\nletsencrypt.exe --accepttos --plugin manual --manualhost www.somewebsite.com --webroot X:\\Sites\\somewebsite.com\nBest wishes\nMichael\n. Thanks, that worked perfectly.\nBest wishes\nMichael. ",
    "Predator75": "thank you very much for the support, I will check all the services\nthank you. ",
    "hanschou": "Thanks for the explanation of  --certificatestore et al.\nI have tried to have the following in 'settings.config' without success:\n```\n   \nQ:\\ssl\n\n\nQ:\\ssl\n\n```\nBut it still writes:\n[INFO] Saving certificate to C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\nWell, I have a work around for that: Just copy the files from \"CertificatePath\" to Q:\nI use the Q: drive because my web server is not allowed to contact say\n  https://acme-v01.api.letsencrypt.org/\nThen I mount a share as Q: from the web server to my desktop and then run letsencrypt.exe on my desktop pc.\n. On 19 June 2018 at 19:29, Wouter Tinus notifications@github.com wrote:\n\nHave you restarted the application after making those changes to the\n.config file?\nRestart? I run it as a oneliner not interactive.\nAnd are you sure you didn't change settings_default.config instead of\nsettings.config?\nYes\n\nE:\\tool\\wacs>findstr \"ConfigurationPath CertificatePath Q:\" settings.config\n  \nQ:\\ssl\n\nQ:\\ssl\nCan you post the log in --verbose mode? I'd be curious to see if it does\n\npick up the ConfigPath\nE:\\tool\\wacs>letsencrypt.exe --verbose --plugin manual --installation none\n--webroot Q:\\inetpub\\wwwroot --manualhost www.example.org\n [DBUG] Config folder: C:\\ProgramData\\win-acme\\\nhttpsacme-v01.api.letsencrypt.org\n [VERB] Settings SettingsService {ConfigPath=\"C:\\ProgramData\\win-acme\\\nhttpsacme-v01.api.letsencrypt.org\", ClientNames=[\"win-acme\",\n\"letsencrypt-win-simple\"], Renewal\nledTaskRandomDelay=00:00:00, ScheduledTaskStartBoundary=09:00:00,\nScheduledTaskExecutionTimeLimit=02:00:00}\n [VERB] .NET Framework >=4.7 detected\n [INFO] A Simple ACME Client for Windows (WACS)\n [INFO] Software version 1911.2.6726.40690 (RELEASE)\n [INFO] IIS not detected\n\n(I will not be back again on this server before monday)\n-- \nVenlig hilsen - best regards\nHans Schou\n. ",
    "Oritsuro": "i think more Users have this problem and are not pro`s in this...\nCould You please write down an exsample for generate new certificate with the script options???\n\nfrom renew File:\n\"Date\":\"2018-08-12T18:33:42.977114Z\",\n\"Binding:{\"Host\":\"domain.de\",\n\"HostIsDns\":true,\n\"IIS\":true,\n\"WebRootPath\":\"C:\\inetpub\\wwwroot\",\n\"SiteId\":4,\n\"TargetSiteId\":4,\n\"AlternativeNames\":[],\n\"TargetPluginName\":\"IISBinding\",\n\"ValidationPluginName\":\"http-01.IIS\",\n\"PluginName\":\"IIS\"},\n\"KeepExisting\":false,\n\"InstallationPluginNames\":[\"IIS\"],\n\"Warmup\":false\n\ni think the script options for set the certificate in RDS too\n\n--script \"./Scripts/PSRDSCerts.bat\" --scriptparameters \"./Scripts/ImportRDListener.ps1 {5}\"\n\nand now what had i entered i an commandline after letsencrypt.exe generate a new certificate with the script options\nmaybe something like that:\n\nletsencrypt.exe --plugin iissite --siteid 4 --emailaddress exsample@home.de --accepttos --usedefaulttaskuser --script \"./Scripts/PSRDSCerts.bat\" --scriptparameters \"./Scripts/ImportRDListener.ps1 {5}\"\n\nthanks in advance :-). ",
    "arunprasathv": "@WouterTinus \ngetting same error without http. . ",
    "tgice": "I ran into the same (or very similar) error myself first trying to setup 1.9.12.2.\nAnd for others trying to do the same: I was able to get this to run on Windows Server 2008 (I was afraid I would not be able to when seeing somewhere that the min requirements were 2008 R2+), but so far it's working great.\nI did have to install the .NET Framework 4.6.1, I think it was, but once I did that (and rebooted the server), letsencrypt.exe ran and worked fine.\nExcept for the Scheduled Task issue.  Here's what I did to work around this.  After that failure, I used the\nT: (Re)create scheduled task\noption in the menu, and when it prompted to use an alternate user name, I entered yes, and then used the main login & password I use for that server.\nIt's not as clean as using the normal SYSTEM account, I suppose, and I did try going back and running the 1.9.10.1 version, but didn't see an equivalent menu option about manually re-creating the scheduled task, so I just went back to the other later version.\nOnce I did that, I saw the new \"win-acme...\"-named scheduled task in my root library in Server 2008, and it seemed to run fine, but I wanted to make sure it'd run and actually renew, so I edited the task, and just stuck the\n--forcerenewal\noption on the front of the command line, and then manually ran the task.  It then successfully pulled a fully new cert (and of course removed that option so as to not hit a rate limit), so I think I'm good.\nVery pleased with this project.  It's the easiest ACME client I've dealt with so far, and very happy with how it handles all of the IIS work itself, and even (mostly, w/ this moderate intervention) handles task scheduling.\nThanks to all who work on the project!. ",
    "mpinardon": "I checked all .conf file and i didn't see any reverse proxy enable\nI added this to httpd.conf but nothing changed\n\n    AllowOverride All\n    Require all granted\n. Yeah git ate end of my paste.\nSo I corrected error, it was a structure problem of many websites on the same server.\nThank you for your help . ",
    "iisuser": "I have rebooted the server, key store is not under a user account , tried importing .pfx file but get same error when I try to bind cert to site. Verified APP Pol has permissions to cert folder.\nthe program created the certificate .der and .pem files in the cert home folder. \nHowever I do see that it cannot read from certificate cache.\n I am assuming this is not the cert home folder? \nThen acme states it cannot convert the private key...\nAlso noticed that it says it is removing the cert from the store but it does not actually do this.\nWhat I do not understand it was working on 6/2/18 but when I added sites and tried to use it now I get the errors above.\neven when everything looks good and the certs are in the store it does not attache the ssl  to a binding. Manual attempts give the error as above also.. Thanks to everyone for the help. I am totally stumped on this now.\nI have given permissions all over the dang place. I also added the --test parameter to see if anything else is going wrong.\n\n\n\nAs you can see everything is going great until the  committing binding changes to IIS\nget error 0x80070520 for the site then Create Certificate failed.\non the cert folder  there are 2 ca-(site domain name) files with  der and a pem extentions\nthen 8 files with out the ca- in front of the domain name  with \n  extentions.\nAn intermittent authentication issue (restarting the server can sometimes fix this)\n    This has been done many times - same error\nYour private key is stored under a user account that IIS cannot access the keys for. \nThis is most common if you are using something other than the default Administrator account to run your certificate generation. \nA workaround for this is to export the stored certificate using the account that created it, then re-import it.\n    I am using the default Administrator account to generate the certificates. I have also tried importing the pfx file but is says it cannot find the private key.\nYour private key for this cert is no longer accessible by any account, if you still have the pfx you can re-import it.\nYour application pool identity may just not have access to the certificate store:\nhttps://stackoverflow.com/questions/2609859/how-to-give-asp-net-access-to-a-private-key-in-a-certificate-in-the-certificate\nIIS 7.5 Website is running under ApplicationPoolIdentity. Open MMC => Add Certificates (Local computer) snap-in => Certificates (Local Computer) => Personal => Certificates => Right click the certificate of interest => All tasks => Manage private key => Add IIS AppPool\\AppPoolName and grant it Full control. Replace \"AppPoolName\" with the name of your application pool (sometimes IIS_IUSRS)\nWhen I do this I get \"No keys found for the certificate!\"\nAs ever with weirdness on Windows, make sure your %TEMP% folder (inc subfolders) does not contain more than 65535 items as various apps/parts of windows stop working reliably after that.\nnether %TEMP% nor %TMP% have even close to that number of files.\n. one last thing.  I used version 1.9.10.0 and I created certs for 7 sites.\nwhen I upgraded to 1.9.11.1 and tried to create a cert for a new site it failed.\ntried 1.9.10.0 again and it too failed with the same error.\nThen went to version 1.9.11.2 and all attempts have failed. all come back now with the same error.\nThanks for any information and/or help. All the sites that worked  in 1.9.10.0 have dates behind them without the ca- in front of the domain name.\nall sites that have failed now have CN= in front of the domain name ( in the Certificate store).. OK, I am slow sometimes. I thought you were talking about win-acme cert folder.\nIt was actually is window's key folder at \"C:\\ProgramData\\Microsoft\\Crypto\\RSA\\MachineKeys\" \nwindows could not access its own key folder (odd) , the Administrator group and system account have to have full rights to this folder. \nThanks all for the help. hope this helps someone else at some time. ",
    "wst-ci": "Thanks for the detailed response!\nI am looking to defend against (b) and (c).\nI think that signing the executable is a great idea. But which type of signing do you mean? GPG or Authenticode, etc? GPG would be preferred as it's much more cross-platform and generally easier to assert trust, especially if the key used is already widely distributed.\nI guess if you were to provide just plain hashes, you could give them through an alternate channel, however I'm not sure how you could reliably verify/prove that you control the other channel. Perhaps keybase.io?. Awesome stuff @WouterTinus, this is great to see. I second @webprofusion-chrisc in regards to the paid support angle, as for most organisation $10 a month is negligible for such a critical service (as long as there aren't unreasonable limits on certificate issuance/licenses, etc).\nChris' Certify GUI is a great example, as $349,99 for 18 months on 100 servers is a tiny expense for the scale of the deployment.\nThanks again!. ",
    "pnocera": "I've got the exact same error here . firewall is opened on port 80 and IPv6 is on.. ",
    "sl4cky": "Thanks, I will check it out\n. Thanks a lot guys I will check it out. I think this solves the issue. I'll give some updates.. Hey guys, I tried to setup a separate server as the Centralized certificate store. On this server I installed IIS and enabled centralized certificate store, and an open share to this server. I then setup another IIS server that would connect to this centralized certificate store remotely over the internet using its UNC path. When trying to connect with the correct credentials I get the error message \"Cannot connect to the specified path. Make sure that the path and credentials are valid\" it works to connect locally to the path but not remotely, anyone has any clues? I am so close to success \ud83d\udc4d . Other than that the name generated by the script for the .pfx file is bezeqpoc.info-all.pfx instead of bezeqpoc.info.pfx which I need is it any option to control that? . ",
    "mtwalsh": "Thanks for the response, I did try that but I couldn't see a way to update an FTP site, should there be another option when choosing the installer?\n```\n [INFO] A Simple ACME Client for Windows (WACS)\n [INFO] Software version 1911.2.6726.40690 (RELEASE)\n [INFO] IIS version 8.5\n [INFO] ACME server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: M\n[INFO] Running in Advanced mode\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: 4\nEnter comma-separated list of host names, starting with the primary one: ftp.do\nmain.com\n[INFO] Plugin Manual generated target [Manual] [1 binding - ftp.domain.com]\n1: [dns-01] Azure DNS\n 2: [dns-01] Run external program/script to create and update records\n 3: [http-01] Save file on local (network) path\n 4: [http-01] Self-host verification files (recommended)\n 5: [http-01] Upload verification file to FTP(S) server\n 6: [http-01] Upload verification file to WebDav path\n C: Cancel\nHow would you like to validate this certificate?: 4\n1: Create or update https bindings in IIS\n 2: Do not run any installation steps\n 3: Run a custom script\n C: Cancel\nWhich installer should run for the certificate?: 1\n```. Ah, thanks.. ",
    "pascuario": "Hi, same issue here.\nInstallation looks normal (no errors), if I go to IIS manager and edit the site bindings, I can see the certificate properly assigned; but when browsing the https is not connecting.\nFrom doing Test-NetConnection -Port 443 -ComputerName yourdomain.com I got:\nTcpTestSucceeded : True\nWhat do you mean by IIS configuration problem ?\nThanks.. ",
    "iamseanduffy": "Opened in error. ",
    "EricQTI": "OK, thanks for the information.  We will take a look at that.  If we find anything that might be useful for others, I will post back what we found here.  Thanks.. it looks like it is pausing before it even tries to access the distributed storage (where the central SSL store is located).  The last log entry is \"Set private key exportable\".  After the long pause, the next entry is \"Copying certificate to the Central SSL store\".  Looking at the code, that log entry happens before it tries to start copying to the central SSL store.  I also confirmed that the cert is being created in the configuration path before the long delay and I can read it during the long delay.  Interestingly, when the cert is in the cache I see \"Using Centralized SSL Path\" log entry and then the long pause and then \"Set private key exportable\" and then it finished quickly (with the message about using cached certificate).  \nThe pause is about 2-3 minutes.  Any idea what it may be doing at that time that could be taking so long?. Perhaps some more debug logging could be added in that area to see where the issue may be?. I just ran procmon on it. During the long delay (which is about 3-4 minutes) it logged 4.6 million entries in procmon.  Most of that is opening, querying and closing registry keys related to Cryptogrophy and opening and closing PFX files in the central SSL store.   We have about 3900 PFX files in our central store right now.  It seems that it's going through all of these for some reason when creating a new one.  I think that is why we didn't have this issue initially and it seems to be getting worse (as we get more and more certs in that central store).  Do you know why it might be cycling through every single PFX file in the store at that point and is there anything that can be done in the code to prevent it?  Thanks!. We were able to resolve this issue.  In case anyone else is having this delay issue - it seems to be caused by having a lot of certs int he central SSL store.  It's doing some kind of checking on every cert in that store each time a new one is created, which takes a very long time when you have a lot of certs.  We were able to apply a workaround by changing the central SSL store path for LetsEncrypt to a different temp path (subfolder within the central store folder) and then we added a routine to move the PFX files from there to the real central store folder after the process completes.  Now the 3-4 minute delay we were seeing when creating certs is gone.  Problem solved!. I was referring to the log output of the script.  We just write it to a file using the \">logfile.txt\" parameter at the end of the command line.  The file contains all of the log output from the script but it doesn't have the timestamps for each log entry.. We do this using Centralized Certificate Store option.  You specify a central path (shared folder location) as a parameter in the command line and it will install the pfx cert to that folder.  Then on each IIS server set it up to use centralized certificate store in Bindings and it will look in that folder for the cert without you having to actually \"install\" it in IIS.  It does it by name so you just have to make sure the filename is the same as the domain name (other than the .pfx extension).  Search online about that option for IIS and you'll find more inf on it.  As far as this script, it's very easy.  Just add that command line to specify the destination folder for the pfx.. ",
    "jochenwezel": "Adding these config lines requires to manually add the files to the app directory, too:\n Serilog.Sinks.File.dll\n Serilog.Sinks.RollingFile.dll\nWithout these files, you will see\n``\nC:\\letsencrypt-win-simple>letsencrypt.exe --help\n Error while creating logger: Die Datei oder Assembly \"Serilog.Sinks.RollingFile\" oder eine Abh\u00e4ngigkeit davon wurde nicht gefunden. Das System kann die angegebene Datei nicht finden. -    bei System.Reflection.RuntimeAssembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark& stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks)\n   bei System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, Evidence assemblySecurity, RuntimeAssembly reqAssembly, StackCrawlMark& stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks)\n   bei System.Reflection.Assembly.Load(AssemblyName assemblyRef)\n   bei Serilog.Settings.KeyValuePairs.KeyValuePairSettings.LoadConfigurationAssemblies(IReadOnlyDictionary2 directives)\n   bei Serilog.Settings.KeyValuePairs.KeyValuePairSettings.Configure(LoggerConfiguration loggerConfiguration)\n   bei Serilog.Configuration.LoggerSettingsConfiguration.Settings(ILoggerSettings settings)\n   bei Serilog.Configuration.LoggerSettingsConfiguration.KeyValuePairs(IEnumerable`1 settings)\n   bei Serilog.Configuration.LoggerSettingsConfiguration.Settings(ILoggerSettings settings)\n   bei PKISharp.WACS.Services.LogService..ctor()\nC:\\letsencrypt-win-simple>letsencrypt.exe --help\n Error while creating logger: Die Datei oder Assembly \"Serilog.Sinks.File, Version=2.0.0.0, Culture=neutral, PublicKeyToken=24c2f752a8e58a10\" oder eine Abh\u00e4ngigkeit davon wurde nicht gefunden. Das System kann die angegebene Datei nicht finden. -    bei System.Reflection.RuntimeAssembly.GetExportedTypes(RuntimeAssembly assembly, ObjectHandleOnStack retTypes)\n   bei System.Reflection.RuntimeAssembly.GetExportedTypes()\n   bei Serilog.Settings.KeyValuePairs.CallableConfigurationMethodFinder.<>c.b__2_0(Assembly a)\n   bei System.Linq.Enumerable.d__172.MoveNext()\n   bei System.Linq.Enumerable.<SelectManyIterator>d__172.MoveNext()\n   bei System.Linq.Enumerable.WhereEnumerableIterator1.MoveNext()\n   bei System.Collections.Generic.List1..ctor(IEnumerable1 collection)\n   bei System.Linq.Enumerable.ToList[TSource](IEnumerable1 source)\n   bei Serilog.Settings.KeyValuePairs.CallableConfigurationMethodFinder.FindConfigurationMethods(IEnumerable1 configurationAssemblies, Type configType)\n   bei Serilog.Settings.KeyValuePairs.KeyValuePairSettings.Configure(LoggerConfiguration loggerConfiguration)\n   bei Serilog.Configuration.LoggerSettingsConfiguration.Settings(ILoggerSettings settings)\n   bei Serilog.Configuration.LoggerSettingsConfiguration.KeyValuePairs(IEnumerable1 settings)\n   bei Serilog.Configuration.LoggerSettingsConfiguration.Settings(ILoggerSettings settings)\n   bei PKISharp.WACS.Services.LogService..ctor()\n```. As I can understand the opinion of @davidpeden3 and @WouterTinus , to the same time I also understand the point of @tsimmons and @alexhass . In fact, a software application typically comes with //all// required DLLs that are needed. What is \"needed\"? Typically this is every DLL in the dependency list of the assembly plus maybe other required files.\nRelease v2.0.3.206 currently lists following dependencies:\n\nSo, a complete deployment should contain all these dependencies and files (if not belonging to .NET framework itself like System, System.Core, etc.). \nIf the dependency is \"not needed\", there should be no reason, why the assembly references that library and no reason why there is a line of code using the dependency.\n. As a suggestion: maybe it makes sense to always publish 2 releases: a \"light\" version as currently and a \"full\" version containing the additional DLLs.. ",
    "davidpeden3": "For those interested in wiring up Seq via XML configuration, you need to add the following keys to AppSettings:\nXML\n    <add key=\"serilog:using:Seq\" value=\"Serilog.Sinks.Seq\" />\n    <add key=\"serilog:write-to:Seq.serverUrl\" value=\"http://localhost:5341\" />\nYou will also need to manually copy Serilog.Sinks.PeriodicBatching.dll and Serilog.Sinks.Seq.dll to the output folder of the build. These DLLs can be found here and here, respectively.. @alexhass I respectfully disagree with your opinion. As @WouterTinus and @tsimmons have noted, the files in question actually don't belong to the project and are not necessary at all for it to function. There are a handful of us that coincidentally are familiar with (or even use) Serilog and are taking advantage of functionality provided by that logging library to get the logs that this product generates into a different format/location. It would be ridiculous for this project to include any/all additional sinks that Serilog supports. Those change over time and add no explicit value to this project.\nFor those of us that do care about standing up extraneous logging, we can follow the instructions guidance collected/aggregated in the wiki page that @WouterTinus created from the comments in this thread.. Thanks for your response. I did put in a 5 second delay which sufficiently covered the nslookup calls getting the right result. Of course I can bump that to 1 or 2 minutes. But I'm not sure that will specifically help because unlike the actual Let's Encrpyt verification call, the preliminary verification call never returns a logical result (current or current-1). In fact, I'm not sure where it gets it's information from because as I mentioned, even when I explicitly configure the DNS server to point to the IP of ns71.domaincontrol.com, it never ever yields a value (even an incorrect one). It always returns null.\nI'd be happy to debug it and see why but, as I mentioned, I couldn't get the solution to build straight from source. Do you have instructions for building successfully? Should I open a new issue to specifically address this topic?\nRegarding Seq, it is written by @nblumhardt, the very same author of Serilog. You should check it out, it's awesome. Thanks for the tip on loading additional sinks, I'll poke around for the issue.. Predominantly fixed in https://github.com/PKISharp/win-acme/pull/1054.\nI will close this issue pending adoption of https://github.com/PKISharp/win-acme/pull/1058.. @WouterTinus How do you feel about making the code async? I'm not sure how large of an undertaking it would be to convert the entire app but the DNS client work that I'm doing could stand to benefit from utilizing the async APIs. The challenge here is that async spreads like a virus.. E.g.:\n```c#\nprivate async Task> GetIpAddressesAsync(string rootDomain)\n{\n    _log.Debug(\"Querying name servers for {Domain}\", rootDomain);\n    var nsResponse = await Default.QueryAsync(rootDomain, QueryType.NS);\nvar getNameServerIpTasks = nsResponse.Answers.NsRecords().Select(async nsRecord =>\n{\n    var aResponse = await Default.QueryAsync(nsRecord.NSDName, QueryType.A);\n    return aResponse.Answers.ARecords().FirstOrDefault()?.Address;\n});\n\nreturn await Task.WhenAll(getNameServerIpTasks);\n\n}\n```\nvs.\n```c#\nprivate IEnumerable GetIpAddresses(string rootDomain)\n{\n    _log.Debug(\"Querying name servers for {Domain}\", rootDomain);\n    var nsResponse = Default.Query(rootDomain, QueryType.NS);\nforeach (var nsRecord in nsResponse.Answers.NsRecords())\n{\n    var aResponse = Default.Query(nsRecord.NSDName, QueryType.A);\n    yield return aResponse.Answers.ARecords().FirstOrDefault()?.Address;\n}\n\n}\n```. Ok, I figured that might be the case. I'll avoid it for now. Running multiple DNS queries synchronously and serially is probably ok for a single renewal scenarios but if multiple renewals are run, this thing will be unnecessarily slow.. I'm going to close this issue now that https://github.com/PKISharp/win-acme/pull/1058 has been merged. Thanks!. This PR addresses a couple of the issues discussed in https://github.com/PKISharp/win-acme/issues/1053.\nSpecifically:\n\nThe first issue that I have is that 100% of the time, I always get failure on the preliminary validation.\n\nThe  original code had a bug where the logging reported using the variable foundValue (https://github.com/PKISharp/win-acme/blob/master/src/main/Plugins/ValidationPlugins/Dns/DnsValidation.cs#L39) instead of using value which is the variable initialized with the actual value (https://github.com/PKISharp/win-acme/blob/master/src/main/Plugins/ValidationPlugins/Dns/DnsValidation.cs#L32).\n\nDespite changing the DNS server in the configuration file to the authoritative name server for my domain, the code never sees a value there.\n\nThrough trial and error, I discovered that the settings file used by the app is generated the first time that the app is run if, and only if, the file does not already exist on disk. The settings file is actually generated by the IoC container when it resolves EmailClient (https://github.com/PKISharp/win-acme/blob/master/src/main/Program.cs#L94) by making a copy of the default settings.\nI had not actually discovered this mechanism until after many runs of the app which explains why after fixing the default value, the code never used it.\n\nIMO, changing the DNS shouldn't even be necessary. I believe the code should simply determine the correct name server to use itself and the configuration setting should strictly used as an override.\n\nThe bulk of this PR addresses this concern. The code will determine the authoritative name server for the given challenge domain and optionally override it if configured to do so. I did not remove the default IP address in https://github.com/PKISharp/win-acme/blob/master/src/main/settings_default.config#L96 as this would be a breaking change. I figured this might be a point of discussion. In other words, if the pre-existing IP address remains, the looked up authoritative server will always be overridden (and ignored), thus maintaining backwards compatibility but eliminating the value of this feature unless the user removes the value from the configuration before running the app for the first time.. Yeah, no problem. If DnsClient.NET addresses my question and updates their API, I will consider submitting a new, separate PR.\nSo unless you have any further feedback, I think we're good.. Sorry, I forgot to update the settings per our conversation above. I submitted a new PR.. This PR addresses the final bit of feedback from https://github.com/PKISharp/win-acme/pull/1054 that I forgot to address.\n. yep, i can look at it tomorrow. @ericcan is sort of correct about the recursion. @michaco addressed this topic in the question i posted in https://github.com/MichaCo/DnsClient.NET/issues/43.\n\nThere might be additional answers in the query result which resolve the FQNs of the nameservers.\nPublic DNS servers usually don't recursively resolve answers though and you'd have to do that yourself.\n\ni didn't see this in my testing but with a repro (as mentioned above), it should be easy to address. i'll just have to walk the results until the end of the line. @WouterTinus this makes supporting async all the more important... ;). @ericcan i need a real example in order to fix this. if you are not comfortable posting one here, you can shoot me an email at [my username]@gmail.com. thanks. @WouterTinus @ericcan i have pushed a fix in my fork for your review and feedback. i have a supporting test that verifies this code works as expected using both my personal and @ericcan's personal dns configurations.\nplease review https://github.com/davidpeden3/win-acme/commit/96c32cbae1069cd394e5b6257aed459f7f9fc388 and provide feedback. once we get things settled (including figuring out the testing part), i will push the pr here.\n@WouterTinus, please shoot me an email (see comment above for address) so that i can loop you into the conversation that @ericcan and i have going, specifically around testing with potentially sensitive data.\nthanks.. My PR adds support for both of the issues that you cite, @ericcan. And, if you prefer, you can override the name server via configuration to get your desired behavior. In my case, the default name server didn't know about my DNS records which is why I pursued going to an authoritative source.\nRegarding your feature request, can you explain that in more detail?. fixed in https://github.com/PKISharp/win-acme/pull/1054/commits/110d1587dab198dc3d173189078b794fc1b26551. for sure, totally agree. i wanted to get a simple implementation up and working and in front of you first. i'll make the changes. looks pretty simple, actually.. well, i agree that it should be unnecessary at this point but i don't think it hurts to keep the setting (empty) and allow it to be used. we can't assume how people might be using the setting. so honoring the setting as an override seems to me the best way to maintain backwards compatibility. that also minimizes the scope of the breaking change (which would be to remove 208.67.222.222) from https://github.com/PKISharp/win-acme/blob/master/src/main/settings_default.config#L96.\ni need you to make a decision on this one as it affects the implementation. ;). i agree that the net effect is the same if you were to remove static here. however, it\n\nsignals intent and\nguards against a future change to the container registration\n\nit also doesn't cost anything. since i'm wrapping the explicit consumption in the provider implementation, i think it's important to leave it as-is.\nguidance from DnsClient.NET:\n\nIt is important to note, that it is highly recommended to instantiate the lookup client only once per application and to always use the same reference (singleton). . well, it turns out that DnsClient.NET doesn't support this use case. i opened an issue inquiring why. i'm still going to do some minor code clean up and submit a PR. but i don't think we can address multiple name servers without jumping through a lot of hoops. also, while on that topic, DnsClient.NET rotates through registered name servers on subsequent calls so i don't even think it really adds value even if the client provided a list of all name servers for a given SOA. see here and here for more details. . > i'm still going to do some minor code clean up and submit a PR.\n\naddressed in https://github.com/PKISharp/win-acme/pull/1054/commits/0d89b527c7fdd49cad99962245faa00f4211bf1b. ",
    "izydorkowalsky": "\"C:\\win-acme.v1.9.11.2\\letsencrypt.exe\" (or whatever your path to the executable is)\nArguments: --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\". https://docs.microsoft.com/en-us/windows/desktop/taskschd/schtasks. @RvdHout: Manually started renewal aborted after the not running website, automatic Task was  aborted by the system itself after 2h(!) running.\n@WouterTinus: Thx. Will try it the newest version.. ",
    "bollard": "Thanks! Out of interest, is it possible to regenerate from the CLI?. Sorry I meant the letsencrypt.exe. ",
    "jmalczak": "Thanks. I will definitely try recompilation.. Thanks. One more question though. If for example I will copy this folder and restore it on virtual machine where I haven't executed win acme before. Will the same account id be used for both of those machines?\nThanks!. Thanks!. ",
    "flashydreams": "I've found more information on this and I'm now closing this issue on my own.. ",
    "DNNhost": "Please inform what additional information you found on this issue . ",
    "FransdeJong": "Hi Wouter,\nThanks for the answer.\nI didn't create the task but changed the task created by a previous\nversion. The version was in the folder name.\nDo I just delete the existing task and create a new certificate for a\nexisting site?\nThanks again,\nFrans\nOp wo 8 aug. 2018 21:20 schreef Wouter Tinus notifications@github.com:\n\nIt sounds like you created the task manually, perhaps it's better to have\nthe program create it using the default settings - by (re)creating a\ncertificate with the program. I never heard of this problem before so it\nmust be doing something right :).\nThere's a lot of Google results about the message so it seems like a\ncommon issue with Windows Task Scheduler in general.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/PKISharp/win-acme/issues/909#issuecomment-411521641,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AcOxclcvs1YS6J5PdNDFu_B5Q__hW_i1ks5uOznrgaJpZM4Vv0HB\n.\n. \n",
    "ac130kz": "@WouterTinus I'm not sure where I could have made this mistake. I ran the exe without any arguments and the following steps are described above. Is there something in the config that needs to be changed?. ",
    "metafarion": "Oh good, and that still appears to work fine!  Thanks!. ",
    "Borekss": "Hi\nFirst let me appreciate your surprisingly fast answer!\nYou named the circumstances very well. I agree with you that in that particular case It will be useful to turn SNI support on. Or at least ask user if he wants to change certificate on all affected sites (due to a disabled SNI).\n. Thank you for your information :)\nBorek\nFrom: Wouter Tinus [mailto:notifications@github.com]\nSent: Thursday, October 25, 2018 9:06 PM\nTo: PKISharp/win-acme win-acme@noreply.github.com\nCc: Borek Straka straka@bo-net.cz; Author author@noreply.github.com\nSubject: Re: [PKISharp/win-acme] win-acme changes SSL cert for different site then requested (#915)\nClosed #915https://github.com/PKISharp/win-acme/issues/915.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHubhttps://github.com/PKISharp/win-acme/issues/915#event-1927109264, or mute the threadhttps://github.com/notifications/unsubscribe-auth/AoUJMA9CEc9B9T_XvnfdA9ody_2Y9_I3ks5uogufgaJpZM4V4MSq.\n. ",
    "ejrebirth": "Certainly,\nI'm using the built in GUI (through command prompt - by running letsencrypt.exe), then make a manual request and put in all the gubbins (bare in mind the certificate generation part is working fine)\nI select the option to run a custom script and use the PSScript batch file that comes with the build as a start.\n./Scripts/PSScript.bat\nThen on the parameters I use\n./Scripts/ImportIntranet.ps1 {5} {2}\nImportIntranet.ps1 is effectively the code in my previous post. This then cycles through the validation and saves the certificate.\nIt then prompts with\npowershell.exe -ExecutionPolicy RemoteSigned -File ./scripts/ImportIntranet.ps1 FFFF3021FFFFFFFFFFFF647FF236FFFF6916FFFF C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\intranet.domain.co.uk-all.pfx \n(I've redacted some info here that is sensitive)\nAt this point it just stops. Then eventually times out and the powershell script is left running in the background forever. Now If I rerun that exact same line manually in CMD, it works perfectly. I'm running everything as an administrator to ensure it's not a permissions issue.. > and I'm assuming that exact command is being run after it times out and it completes properly?\nThe command is the last I see in the log before it times out, and the script never actually runs. Powershell.exe sits in task manager but doesn't dissapear. It feels like it fails on opening the script, rather than during it. No amount of verbose logging seems to have helped me out. I did think that running the script manually exactly how I see WACS runs it would of highlighted an error - but nothing. I even included an echo on the first line - but this does not appear.\n\nif that's the case, i suspect wacs is running as a different user that can't access the hidden share. As a test, i would actually share out the folder with full ACL and share permissions to authenticated users (again, only temporarily, as a test) and adjust the ImportIntranet.ps1 script to reflect the new path.\n\nIt's actually a lot simpler than that, WACS is stored in C:\\win-acme, and the scripts are stored in c:\\win-acme\\scripts.\nI also have other scripts running on the same server that work correctly too, but it just seems to be this script that it hangs on. So I was starting to feel the issue was directly related to the script itself (since other scripts ran fine). However, the puzzlement was running the script manually via command line, works.. > are you sitting in the directory c:\\win-acme when you run the GUI?\nI am sitting in c:\\win-acme when i run the letsencrypt executable yes.\n\nchange ./Scripts... in both to c:/win-acme/Scripts...\n\nThat was a good shout to try, sadly it still hangs.\n\ninteresting.\n\nIt most certainly is... not really sure what the next avenue is to diagnose. Maybe process explorer - but that could get very heavy.. Thanks for your help so far, I shall endavour to give your suggestions a go. I do have verbose output set in the letsencrypt.settings file to give me more information, but it's as you said - I think there is something deep in the bowels that's not reaching the surface.\n\nlso a separate point about your script in general. I'm not sure i understand why you have the foreachobject loop, then later in the script you directly run commands against WEBSERVER. Really shouldn't cause issues, just pointing out that it's odd.\n\nI suppose that's the problem with showing unfinished scripts publicly! It's in the midst of being altered to support multi servers - but I wanted to make sure that it worked on a single server first before doing multiple. . ",
    "desdougan": "My Web site is on another host on my network, and is using port 80 - so external traffic coming through the firewall is directed there. \nWhat is the best way of resolving this? I imagine many people have multiple sites running different functions.\nThanks,\nDes. I think you misunderstood me, so apologies for being unclear. I was running the script on the server I wanted it for (a Windows box), for a different subdomain of my domain (managedstorage.douganconsulting.com); my www.douganconsulting.com site is on a different host on my LAN, and port 80 points to that host, while 443 is forwarded to the server I am running the script on.. Thanks for this - much appreciated.\nDes\n--\nDes Dougan\nPrincipal\nDougan Consulting Group Inc.\nO: 604-628-5434\nC: 604-866-2848\nE: des@douganconsulting.com\nW: http://DouganConsulting.com\nPeace of Mind, One Computer at a Time.\nRemote Support URL:\nhttp://sc.douganconsulting.com:8040\nOn 13 Nov 2018, at 10:32, Wouter Tinus wrote:\n\nThe thing is that Let's Encrypt only works on port 80, so you will \nhave to serve the validation response from the server that responds to \nport 80.\nThere is more than one way to get the validation file from one server \nto the other (ftp, networkshare, etc.) or you can go the other way and \ngenerate the certificate on the server that listens to 80 and then \nmove the .pfx to the other one.\n-- \nYou are receiving this because you authored the thread.\nReply to this email directly or view it on GitHub:\nhttps://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_PKISharp_win-2Dacme_issues_918-23issuecomment-2D438385314&d=DwICaQ&c=euGZstcaTDllvimEN8b7jXrwqOf-v5A_CdpgnVfiiMM&r=vYZk9Bq5wR7P77crNsXm_AyXc7zhxg104ZsXEt2NX98&m=9Y8-NSrpSUamglHtCiMoH6BlU450WzOGSmtfSg7PT6E&s=Cefz8cu-kDdK1u5p0TzQffQbggV2NBFTJ6zgf6YrZqM&e=\n\n. ",
    "bavta": "Thank you. ",
    "sim2github": "Fetch validation don't check trailing slash in URL. In my case URI:\nhttps://example.com.well-known/... return status 400 because there no / between example.com and .well-known.\nBrowsable URI http://example.com/.well-known/... is available externally.. My previous version [INFO] Software version 1.9.7.10258 (RELEASE) was scheduled and stops updating this month. Update to last version show me details of error.. SORRY. Its my bad. Trailing slash missed in configuration of redirect from http to https.\n. ",
    "energywave": "I'm also adding to the requests. This utility is actually so useful! But I'm in need of a wildcard certificate and it's a pity that I can't handle it with it :(. ",
    "guaasamo": "Also need of a wildcard certificates. ",
    "Steffen187": "Thanks for the fast reply! Yes that's exactly my situation and problem.\nYour advice to manage the DNS via PowerShell was great. Azure offers commands to update DNS entries (in this example adding the TXT record for validation) via PowerShell scripts:\nExample 8 (Create a RecordSet of type TXT):\nhttps://docs.microsoft.com/en-us/powershell/module/azurerm.dns/New-AzureRmDnsRecordSet?view=azurermps-6.9.0. ",
    "braian87b": "how ?. Ah, but I had multiple sites each one has their domain.com and www.domain.com, I had only one IP, is a IIS 7.5. ",
    "timhowling": "Site is behind a firewall. Need to get the verification to another server via a proxy the other side of the firewall.\nRegards\nTim Howling\n01189773763\nhttp://interads.net\nFrom: Wouter Tinus [mailto:notifications@github.com]\nSent: 23 September 2018 14:21\nTo: PKISharp/win-acme\nCc: Tim Howling; Author\nSubject: {Disarmed} Re: [PKISharp/win-acme] Verification options missing (#933)\nNo options for Webdav, SFTP of FTP etc I need FTP verification\nSince the program has already established that your target is a local IIS site (since that's what you picked) it typically doesn't make sense anymore to offer FTP verification. Can I ask why you want to use that?\nAs a workaround, you can choose a manual target (\"Manually input host names\"), then all cards will be on the table for validation.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHubhttps://github.com/PKISharp/win-acme/issues/933#issuecomment-423816084, or mute the threadhttps://github.com/notifications/unsubscribe-auth/ApfH-tuI3N5JRBwWuLsBqgYWTPRbwPA9ks5ud4rMgaJpZM4W1XpO.\n{\"api_version\":\"1.0\",\"publisher\":{\"api_key\":\"05dde50f1d1a384dd78767c55493e4bb\",\"name\":\"GitHub\"},\"entity\":{\"external_key\":\"github/PKISharp/win-acme\",\"title\":\"PKISharp/win-acme\",\"subtitle\":\"GitHub repository\",\"main_image_url\":\"https://assets-cdn.github.com/images/email/message_cards/header.png\",\"avatar_image_url\":\"https://assets-cdn.github.com/images/email/message_cards/avatar.png\",\"action\":{\"name\":\"Open in GitHub\",\"url\":\"https://github.com/PKISharp/win-acme\"}},\"updates\":{\"snippets\":[{\"icon\":\"PERSON\",\"message\":\"@WouterTinus in #933: \\u003e No options for Webdav, SFTP of FTP etc I need FTP verification\\r\\n\\r\\nSince the program has already established that your target is a local IIS site (since that's what you picked) it typically doesn't make sense anymore to offer FTP verification. Can I ask why you want to use that?\\r\\n\\r\\nAs a workaround, you can choose a manual target (\\\"Manually input host names\\\"), then all cards will be on the table for validation.\"}],\"action\":{\"name\":\"View Issue\",\"url\":\"https://github.com/PKISharp/win-acme/issues/933#issuecomment-423816084\"}}} [ { \"@context\": \"http://schema.org\", \"@type\": \"EmailMessage\", \"potentialAction\": { \"@type\": \"ViewAction\", \"target\": \"https://github.com/PKISharp/win-acme/issues/933#issuecomment-423816084\", \"url\": \"https://github.com/PKISharp/win-acme/issues/933#issuecomment-423816084\", \"name\": \"View Issue\" }, \"description\": \"View this Issue on GitHub\", \"publisher\": { \"@type\": \"Organization\", \"name\": \"GitHub\", \"url\": \"https://github.com\" } }, { \"@type\": \"MessageCard\", \"@context\": \"http://schema.org/extensions\", \"hideOriginalBody\": \"false\", \"originator\": \"AF6C5A86-E920-430C-9C59-A73278B5EFEB\", \"title\": \"Re: [PKISharp/win-acme] Verification options missing (#933)\", \"sections\": [ { \"text\": \"\", \"activityTitle\": \"Wouter Tinus\", \"activityImage\": \"https://assets-cdn.github.com/images/email/message_cards/avatar.png\", \"activitySubtitle\": \"@WouterTinus\", \"facts\": [ ] } ], \"potentialAction\": [ { \"name\": \"Add a comment\", \"@type\": \"ActionCard\", \"inputs\": [ { \"isMultiLine\": true, \"@type\": \"TextInput\", \"id\": \"IssueComment\", \"isRequired\": false } ], \"actions\": [ { \"name\": \"Comment\", \"@type\": \"HttpPOST\", \"target\": \"https://api.github.com\", \"body\": \"{\\n\\\"commandName\\\": \\\"IssueComment\\\",\\n\\\"repositoryFullName\\\": \\\"PKISharp/win-acme\\\",\\n\\\"issueId\\\": 933,\\n\\\"IssueComment\\\": \\\"{{IssueComment.value}}\\\"\\n}\" } ] }, { \"name\": \"Close issue\", \"@type\": \"HttpPOST\", \"target\": \"https://api.github.com\", \"body\": \"{\\n\\\"commandName\\\": \\\"IssueClose\\\",\\n\\\"repositoryFullName\\\": \\\"PKISharp/win-acme\\\",\\n\\\"issueId\\\": 933\\n}\" }, { \"targets\": [ { \"os\": \"default\", \"uri\": \"https://github.com/PKISharp/win-acme/issues/933#issuecomment-423816084\" } ], \"@type\": \"OpenUri\", \"name\": \"View on GitHub\" }, { \"name\": \"Unsubscribe\", \"@type\": \"HttpPOST\", \"target\": \"https://api.github.com\", \"body\": \"{\\n\\\"commandName\\\": \\\"MuteNotification\\\",\\n\\\"threadId\\\": 383089230\\n}\" } ], \"themeColor\": \"26292E\" } ]\n. ",
    "MatsStam": "Sorry, messed up on the phone... :*)\nAnyways, heres what i was trying to say:\nYou were right. It's just me not understanding quite how it could behave so differently when it was the same scheduled task running. After I found the Renewals-file everything kind of fell into place.\nNow here's my next issue. Since I on the redirect have example.com:80, example.org:80, example.nu:80 etc up to 40 and growing domains, that I want redirected to the :443 sites.\nWhats the best way to manage the exclusions on those domains?\nWill I be forced to mange the Renewals-file for hand? Because typing in the exclusions every time I have to remake the certificate (when adding a new site) doesn't seem very pleasant :)\nThanks so much for taking the time to answer my clueless questions man. You are a super-hero :). I believe the date for next renewal is set in the config file for the letsencrypt.exe. By default I believe it's 55 days, your's might be set to something else?\nAnyways, that's the date when the scheduled task is supposed to pick up the certificate and renew it. (Well, 9:00 am the next day anyways).\nThis happens before the actual certificate expires, or else if something went wrong with the renewal, you'd be in trouble :)\nI'm no expert mind you, but atleast I can try and help a little ;)\n. ",
    "brainwipe": "Thank you for your reply. Office colleague @wozzo solved it!\nYou can call the letsencrypt service every day at 9am but it won't actually renew you until this date, which is a long time before the certificate expires - giving you plenty of time to fix whatever the issue might be.\nThanks again for a great tool. \ud83d\udc4d \n. ",
    "diaphoni": "Same issue here with same version 1.9.12.0 on Windows 2016 server.\nEverything runs fine, except installing the certificate in IIS.\n[WARN] No bindings have been changed\nIt happens both when adding new or renewing.. ",
    "pv2b": "Not sure if this is the exact same bug but this is broken for me in a similar way v1.9.12.1.\nIn my scenario, I was testing with a staging certificate which is still in place in IIS, even after trying to force a renewal:\n```\nPS C:\\Users\\Administrator> C:\\win-acme\\letsencrypt.exe\n[INFO] A Simple ACME Client for Windows (WACS)\n [INFO] Software version 1912.1.6872.39942 (RELEASE)\n [INFO] IIS version 7.5\n [INFO] ACME server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: s\n1: example.net - renew after 2018-12-25 8:55:23\n C: Cancel\nWhich renewal would you like to run?: 1\n[INFO] Renewing certificate for example.net\n [INFO] Authorize identifier: example.net\n [INFO] Cached authorization result: valid\n [WARN] Using cached certificate for example.net 2018-10-31 9:56:42 . To force issue of a new certificate wi\nthin 24 hours, delete the .pfx file from the CertificatePath or run with the --forcerenewal switch. Be ware that you mig\nht run into rate limits doing so.\n [WARN] Certificate with thumbprint  is already in the store\n [INFO] Installation step 1/2: IIS...\n [INFO] Updating existing https binding :443\n [WARN] No bindings have been changed\n [INFO] Installation step 2/2: Manual...\n [INFO] Script C:\\win-acme\\scripts\\InstallRedacted.bat starting...\n [INFO]\nC:\\Users\\Administrator>net stop RedactedServiceName\nTj\u00e4nsten RedactedServiceName stoppas.\nTj\u00e4nsten RedactedServiceName stoppades.\nC:\\Users\\Administrator>net start RedactedServiceName\nTj\u00e4nsten RedactedServiceName startar.\nTj\u00e4nsten RedactedServiceName \u00e4r ig\u00e5ng.\n[INFO] Renewal for example.net succeeded\n [INFO] Next renewal scheduled at 2018-12-25 8:56:47\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu:\n```\nThis is Windows Server 2008 R2, with IIS 7. There is only a single web site named Default Web Site. There is only a single https binding set up as per:\nType: https\nIP-address: All non-assigned\nPort: 443\nSSL-certificate: (the wrong certificate)\nIt doesn't matter if I try changing from the staging LE cert to some random self-signed cert, it still won't change it over.\nCurrent workaround in place: Manually select the correct certificate after renewal.. ",
    "marcotibben": "I must add.. all individual domains are registered and scheduled, but sometimes www. variants of the identical domain are not..\nso I have 2 certificates domain.com and www.domain.com, both are in my certificates folder, but the www. variant is not listed in the renewal list.. Meanwhile I found the renewals file in the programdata folder. Now I see a difference.\nI used to register certificates using the 'N - 1: single binding for an IIS site' option. All these domains have the field 'AlternativeNames\":[]' in the renewals file empty, and both domains with and without www. are individually listed in the file.\nLast time I used the 'N - 4: Manually input host names' option and now the 'AlternativeNames\":[\"marcotibben.nl\",\"www.marcotibben.nl\"]' field contains the www. and no www. variations. And now uses just one single line in the file. Though I still have both single certificates in my certificates folder, so this is not a SAN certificate? or is it?\nSo I guess I don't have to worry about the fact the certificates not getting renewed.. pfeeew.. :)\nGuess changing methods got me off guard there..\n. yes that is right, i'm using the central certificate store.\nthanks for the reply and the insight!. saw I used 1.9.11.2 instead of 12.2.. installed 12.2 which works perfectly.. but importing with 2.0 still same issue... perfect! I'll check. mmm first try after download got me this result;\n[INFO] A simple Windows ACMEv2 client (WACS)\n[INFO] Software version 200.0.6959.25723 (RELEASE)\n[INFO] IIS version 8.0\nN: Create new certificate\nM: Create new certificate with advanced options\nL: List scheduled renewals\nR: Renew scheduled\nS: Renew specific\nA: Renew all\nC: Cancel scheduled renewal\nX: Cancel all scheduled renewals\nT: (Re)create scheduled task\nI: Import scheduled renewals from WACS/LEWS 1.9.x\nQ: Quit\nPlease choose from the menu: i\nImporting renewals for , enter to accept or type an alternative:\n[EROR] NullReferenceException: Object reference not set to an instance of an object.\n--\nthere seems to be an empty space between 'renewals for' and the comma.. I just hit enter after the importing question\n. that's right; I had a wildcard certificate via comodo before on my server 2012, and now want to switch to lets encrypt wildcard for that. I have a lot single certificates with WACS 1.9 on my server 2012. I tried getting a wildcard for .domain.nl in WACS but got a not supported on windows 2012 error.. but now doubt myself if it maybe was with 1.9 instead of 2.0... going to dubbelcheck it straight away. aah remember.. on server 2012 I tried adding a host value of .mydomain.nl in IIS to later use the single binding option in WACS 2.0.. IIS came with the error..\njust tried with WACS 2.0-alpha4 in server 2012 via the manually input host name option and got this result:\n[INFO] A simple Windows ACMEv2 client (WACS)\n [INFO] Software version 200.0.6960.39303 (RELEASE)\n [INFO] IIS version 8.0\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n T: (Re)create scheduled task\n I: Import scheduled renewals from WACS/LEWS 1.9.x\n Q: Quit\nPlease choose from the menu: m\n[INFO] Running in mode: Interactive, Advanced\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: 4\nEnter comma-separated list of host names, starting with the common name: *.mydomain.nl\nSuggested FriendlyName is '*.mydomain.nl', press enter to accept or type an alternative:\n[INFO] Target generated using plugin Manual: *.mydomain.nl\n1: [dns-01] CNAME the record to a server that supports the acme-dns API\n 2: [dns-01] Manually create record\n 3: [dns-01] Run external program/script to create and update records\n C: Cancel\nHow would you like to validate this certificate?: 2\n[EROR] Unable to find store plugin centralsslstore\n [EROR] No store plugin could be selected\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n T: (Re)create scheduled task\n I: Import scheduled renewals from WACS/LEWS 1.9.x\n Q: Quit\nPlease choose from the menu:\nso no go there too.. the wiki told me to use these options at the command prompt;\nwacs --store centralsslstore --centralsslstore \"C:\\dir\" --pfxpassword \"password\"\ncould the fault be in there?\n. aaah well, the wiki states --store centralsslstore and the comment at the download area states --store centralssl\u2026 maybe improve this in the wiki?!?\nthat worked..\nbut now I chose the manual dns authentication, and WACS doesn't give time to manually change my DNS.. it states the record (but not which.. TXT I presume).. but then instantly goes and tries to authorize it.. well that wont work ofcourse, haha..\nso could there be a pause or a key press there?. a second time it did wait.. think I pressed enter after marking the authentication token in the CMD..\nsuggestion; put a text there that the programm waits for a specific key te be entered.. this was a bit unclear... also, in my batch file I started wacs with the --pfxpassword option, but when trying to create a certificate it again asked for the password.. is that normal?. back to windows server 2019, I still get this;\nPlease choose from the menu: n\n[INFO] Running in mode: Interactive, Simple\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: 1\n[WARN] No options available\n [EROR] Target plugin IISBinding aborted or failed\n---------------. addition; \n- I do have only the default website running there..\n- the default website has a hostname *.mydomain.nl\n(real domain hidden for demonstation purposes). created an extra website with the .mydomain.nl binding, but error stays the same... changed the binding from .mydomain.nl to test.mydomain.nl and then the error disappeared... the text on the download page also states:\n--centralsslpath \"dir\"\nwhile the wiki says:\n--centralsslstore \"dir\" \nwhich one is 'the one to use' in WACS 2.0?. --centralsslpath seems the better function description indeed.. fits better with --store centralssl. I have multiple TXT records for that domain.. but ofcourse just only one '_acme-challenge' TXT record.. maybe it checks one of those other TXT records incidently?!? (just guessing). - letsdebug says 'all ok'\n- normally the TransIP is always very fast on all name servers; but i'll try waiting an hour even if TTL is 60sec, mxtoolbox.com almost instantly picked the change up; so not expecting that to be the problem\n- Time zone Amsterdam, Region Netherlands, Regional Format English US\n. and language English UK sorry. uuhm.. windows taskbar says English UK, though through settings it says English US. both servers (2012/2019) in settings it says English US everywhere.. except on the taskbar it says English UK (on both servers).. 2012 - region US, 2019 region Netherlands. i'm only trying to get a certificate for .example.com and not a SAN for .example.com,example.com\nI also choose the 'don't run any installation steps'. still 35 min. to go of the hour waiting time :). mxtoolbox picked the change up fast again.. so just trying the hour waiting time to eliminate that one..\nhttps://mxtoolbox.com/Pro/#/lookup/txt:_acme-challenge.example.com. nope.. again: [EROR] Authorization result: invalid. tried a complete other location with a windows 10 laptop; same result.. \nmxtoolbox.com again showed the TXT record with the right token before validating. just also tried if it worked trying to get a certificate for another domain;\n[EROR] Authorization result: invalid\nmxtoolbox.com again showed the _acme-challenge TXT record with the right token before validating. ok.. was just trying to be as helpful as possible finding the cause... No don't use quotes.. I found that problem on google indeed, but I don't use quotes. And I did copy all of the token (and checked). Windows 2016 and 2019 allows the cmd screen to be pulled wider now so it even fits on one line..\nCould somehow firewall have something to do with it..? but I did try 3 machines, so don't know if that would be the case\nMeanwhile i'm working on an api script to automate the process and see if that makes any difference; if there is something wrong on my side or if it's wacs..\nupdate; \n- checked with firewall off; no difference\n- I also always check for not copying extra spaces with cut and paste; so also no cause..\nupdate;\n[INFO] A simple Windows ACMEv2 client (WACS)\n [INFO] Software version 200.0.6960.39303 (RELEASE)\n [INFO] IIS version 10.0\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\nN: Create new certificate\n M: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n T: (Re)create scheduled task\n I: Import scheduled renewals from WACS/LEWS 1.9.x\n Q: Quit\nPlease choose from the menu: m\n[INFO] Running in mode: Interactive, Advanced\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: 4\nEnter comma-separated list of host names, starting with the common name: *.example.com\nSuggested FriendlyName is '*.example.com', press enter to accept or type an alternative:\n[INFO] Target generated using plugin Manual: *.example.com\n1: [dns-01] CNAME the record to a server that supports the acme-dns API\n 2: [dns-01] Manually create record\n 3: [dns-01] Run external program/script to create and update records\n C: Cancel\nHow would you like to validate this certificate?: 2\nPassword to use for the PFX files: ***\n1: Create or update https bindings in IIS\n 2: Do not run any installation steps\n 3: Run a custom script\n C: Cancel\nWhich installer should run for the certificate?: 2\n[INFO] Authorize identifier: example.com\n [INFO] Authorizing example.com using dns-01 validation (Manual)\n [WARN] Create record _acme-challenge.example.com for domain example.com with content 4tkm2Xgay5Fe6a0jjTLbKkNi4tFTp4IKxrDqm037o74\n[INFO] Answer should now be available at _acme-challenge.example.com\n [EROR] Authorization result: invalid\n [WARN] Delete record _acme-challenge.example.com for domain example.com\n\nthough the code isn't entirely visible here due to the width of the field.. it is completely there without extra space or quotes\nupdate; could the friendly name have something to do with it?!? with my comodo wildcard certificate I remember it being _.example.com and not *.example.com in the central store directory. Tried it with my just made API script instead of manually. The scripts are individually tested, work, and change the TransIP DNS accordingly (create and delete). The result is sadly the same\n\ncmd; getcertificate.bat *.example.com 7\n\ncd C:\\Users\\example\\Downloads\\win-acme.v2.0.0-alpha4\n\nC:\\Users\\example\\Downloads\\win-acme.v2.0.0-alpha4>wacs --store centralssl --centralsslstore \"C:\\example\\certificates\" --pfxpassword \"example\" --target manual --host *.example.com --validationmode dns-01 --dnscreatescript transip_dns_validation.bat --dnsdeletescript transip_dns_validation.bat --validation dnsscript --installation iis --installationsiteid 7 --accepttos\n[INFO] A simple Windows ACMEv2 client (WACS)\n [INFO] Software version 200.0.6960.39303 (RELEASE)\n [INFO] IIS version 10.0\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\n[INFO] Running in mode: Unattended\n [INFO] Target generated using plugin Manual: *.example.com\n [INFO] Authorize identifier: example.com\n [INFO] Authorizing example.com using dns-01 validation (DnsScript)\n [INFO] Script transip_dns_validation.bat starting with parameters create example.com _acme-challenge.example.com o4aunu9fKt3hjPzwAvK3684OhLSfsIE7mPmeIKJw57M\n [INFO]\n [INFO] Answer should now be available at _acme-challenge.example.com\n [EROR] Authorization result: invalid\n [INFO] Script transip_dns_validation.bat starting with parameters delete example.com _acme-challenge.example.com\n [INFO]\n [EROR] Create certificate failed: Authorization failed\n\nmy own script logfile also confirms the DNS was changed accordinglyby the create and delete scripts\ncould it have something to do with wacs being run in a users download folder instead of C:wacs for instance? (never had any problem with that with non-wildcard certificates though)\nUPDATE; placed it in c:\\wacs, made no difference..\nUPDATE; I had been really focussed on the wildcard thingy, so didn't check the normal certificate procedures in WACS2.0 at all.. digging into the user rights related stuff I asked above, I tried getting a 'normal' certificate with selfhosting, which works perfectly fine with WACS1.9 on all tested machines.. Turns out that also doesn't work with WACS2.0.. all authorization seems to fail. Even in interactive mode. So WACS2.0 isn't actually working at all for me at the moment.\nI double checked;\n- located in c:\\wacs\n- wacs.exe is run as administrator (for all users) via properties 'compatibility'\n- even ran my batch file from an elevated cmd\n- wacs1.9 works perfectly with same settings and procedures on same machines (windows10, Server2012, Server2019)\n- machines are located at two different locations, different IP's, etc.\nUPDATE; looking into .net framework stuff now. mmm... maybe build in a requirement check at the startup of wacs.. ~enhancement for php noobs who don't use .net \ud83d\ude1c wacs works perfectly fine in every way until that very last important moment of validating.. so it doesn't show in any way something is not right in the background..\nI found out it was differences in .net versions (or even lacking one on my pristine server 2019) that did it.. I in an instance assumed (wrong ofcourse) using the latest server software, automatically had me the latest .net versions. using php instead of .net I also didn't bother checking up on that \ud83d\ude48\nat least for normal certificates it works now having installed .net 4.7 on my 2019 server..\nI didn't have time to check the wildcard domain certificates yet, because that still gave an error at the first try, but that could well have been a dns timing issue then.\nI'll have a look into that later..\nif it turns out to be a dns timing issue; then how to fix that in the automatic validation process? could a validation waiting time be implemented as an argument or something? to keep wacs waiting before validating? or some build in dns check to see if the _acme validation record is actually there, and if not, wait a bit and then check again.. only to really validate when a record is found?\nsorry for the oversight at my behalf.. \ud83d\ude33 maybe a quick requirements check in wacs could help others too..\ni'll keep you updated how the wildcard validation turns out after some testing. yes.. when I first installed roles on my vm windows 2019 server I didn't install asp.net 4.7 (.net extensibily and no isapi) because I don't need that... I only installed the cgi option from the 'application development' section under 'webserver' roles..\nfew days later installed and got working with wacs2 without any problems and forgot about not having installed asp.net 4.7 \nafter all the wacs problems found out I didn't have asp.net 4.7, installed that from the add roles wizard (and .net extensibility 4.7, and isapi extensions and filters; required for asp.net 4.7), and now normal certificates are working again..\nupdate; no, never saw any wacs installation error/message like that..\nupdate; automatic wildcard registration still not working. both my own script log file and the control panel of provider TransIP, confirm my script made the appropriate dns challenge changes. \nto rule out a timing issue I'll do a manual certificate request too now. same installation as I did indeed, I didn't uninstall .net 4.7 or something.. was a standard installation, except for adding iis and cgi\nupdate; well just got my first wildcard certificate...! \ud83c\udf89 manually though.. and waiting to validate until mxtoolbox.com showed the acme txt record.\ninstalling asp.net 4.7 did fix my initial problems at least; I didn't do anything different than before getting a certificate..\nnew problem now is the dns timing for the validation in an automatic process.. doing this manually for about 400 domains doesn't feel an option \ud83d\ude48 \nupdate; wacs now also asks if I want to replace my current task in scheduler. something changed, reset, or got restored apparently when I installed asp.net 4.7 (and with the for asp.net required .net extensibillity, and asapi). it was a clean install before that.\nafter installing asp.net if worked like a charme instantly\nbeats me.. it cost me a lot of time, frustration, and increased self doubt \ud83e\udd23, the latter luckily restored instantly and fully when it worked after hitting the asp.net light switch.\nI know too little about the innerworkings of wacs to help you any further im afraid , but if you have any questions; go ahead..\nthanks for the help in any case!. or make it optional.. default behaviour as it is; instantly.. but if one (like me) needs the check for the TXT record, or some waiting for the TXT field to be working, it can be activated with an argument... just like one would activate central store.. \nthen anyone can choose if its necessary, or not, for them.. and the user knows best how long it takes in their case, or can easily do some testing. lets encrypt will probably use the same procedure for the same geolocation each time I presume? so far it was around 210 secs for me at each attempt.. or could the time it took be stored in the renewal json, wacs can then figure out how long to wait next renewal for instance?\nI tested it, and indeed it also works doing a sleep(210) in my script, but I've got no idea if all users can create their own script..\nwhich also leaves me with the question; how does a manually dns registered certificate renewal work? if the renewal starts automatically at 09;00, then how to manually change the dns in time? (just wondering). ",
    "ValentinKuzub": "Hi\nThanks, found some files there which look good.\nCopied them on the new box, but when I run letsencrypt.exe there and hit L to list certificates it shows nothing.\nWhat to do now? How to debug the problem? . Well, unfortunately, it is still not working.\nSo let's say the first server is destroyed and I cannot migrate.\nWhat to do then? How to setup it so the new server overtakes the\ncertificate & can renew it when needed?\nOn Tue, Oct 16, 2018 at 7:32 PM Wouter Tinus notifications@github.com\nwrote:\n\nIf you are - or started out with - using an older version of the program,\nthe list of configured certificates might be in the registry. This should\nhelp you locate the key and move it to the new server. I'd recommend to\nstart using the file-based method, rather than re-importing the registry\nkey.\nhttps://github.com/PKISharp/win-acme/wiki/Migration-to-v1.9.9\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/PKISharp/win-acme/issues/946#issuecomment-430305919,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AA8yn2IveObYkRiObXGIgr2Bb-QZoBd2ks5ulgnegaJpZM4XVBh9\n.\n. That's just 1 certificate.\nHowever, since I do not understand all the underlying details (is there a\ncompletely detailed instruction anywhere?) of this I am a little worried\nthat some critical information from the first server is required to\nsuccessfully transfer the certificate \"process\" to the new server.\n\nFor example, please help with this question.\nCurrently, we've exported certificate as pfx file and imported it on the\nnew box.\nThere are no autorenewal tasks though and that is the problem.\nIf I just launch letsencrypt.exe and request a new certificate as you\ndescribe, what happens to the currently imported certificate?\nHow does this work when you request a new certificate with an existing old\ncertificate?\nTo clients who use our website (the new certificate will have a different\nissue date and potentially something else (some signature), will they not\nbecome suspicious of it and potentially harm server behavior due to this\nchange)?\nSince it is now a production box I am trying to be extremely cautious.\nAny help is greatly appreciated.\nOn Wed, Oct 17, 2018 at 2:56 PM Chris Hynes notifications@github.com\nwrote:\n\nHow many certificates is it? If it's just a couple, just do over the\nrequest from scratch steps on the new server -- that'll grab you new certs\nand start the renewal task etc.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/PKISharp/win-acme/issues/946#issuecomment-430599214,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/AA8yn3p3PXyGvEIJadfZvXv2FV8VqrdJks5ulxr4gaJpZM4XVBh9\n.\n. \n",
    "MasterChiefJon": "WouterTinus, should renewing the certificate create the scheduled task (I've done that several times), or do I have to create it anew (the 'N' command-line option)?. OK, I did a 'N' to create a new certificate.  It completed normally (I ran letsencrypt.exe with the --forcerenewal option).   Here is what I saw on the screen:\nPlease choose from the menu: n\n[INFO] Running in Simple mode\n1: Single binding of an IIS site\n 2: SAN certificate for all bindings of an IIS site\n 3: SAN certificate for all bindings of multiple IIS sites\n 4: Manually input host names\n C: Cancel\nWhich kind of certificate would you like to create?: 1\n[DBUG] Scanning IIS site bindings for hosts\n1: cms.leoncountyfl.gov (SiteId 2) [@D:\\www\\websites\\cmsprod_v_703b]\n 2: growinggreen.org (SiteId 3) [@D:\\www\\websites\\redirects\\growinggreen]\n 3: leonworksexpo.com (SiteId 4) [@D:\\www\\websites\\redirects\\leonworksexpo]\n 4: leonworksexpo.org (SiteId 4) [@D:\\www\\websites\\redirects\\leonworksexpo]\n 5: m.leoncountyfl.gov (SiteId 2) [@D:\\www\\websites\\cmsprod_v_703b]\n 6: www.growinggreen.org (SiteId 3) [@D:\\www\\websites\\redirects\\growinggreen]\n 7: www.leonworksexpo.com (SiteId 4) [@D:\\www\\websites\\redirects\\leonworksexpo]\n 8: www.leonworksexpo.org (SiteId 4) [@D:\\www\\websites\\redirects\\leonworksexpo]\n 9: www.sao2fl.org (SiteId 2) [@D:\\www\\websites\\cmsprod_v_703b]\n C: Cancel\nChoose site: 9\n[INFO] Plugin IISBinding generated target [IISBinding] www.sao2fl.org (SiteId 2) [ @ D:\\www\\websites\\cmsprod_v_703b]\n [DBUG] Scanning IIS site bindings for hosts\n [DBUG] Loading signer from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: www.sao2fl.org\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Cached authorization result: valid\n [DBUG] Certificate folder: C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Certificate store: WebHosting\n [DBUG] Set private key exportable\n [WARN] Cached certificate available but not used with --forcerenewal. Use 'Renew specific' or 'Renew all' in the main menu to run unscheduled renewals without hitting rate limits.\n [DBUG] RSAKeyBits: 2048\n [INFO] Requesting certificate www.sao2fl.org 2018/10/16 13:26:06 PM\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n [INFO] Saving certificate to C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Set private key exportable\n [INFO] Installing certificate in the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Adding certificate www.sao2fl.org 2018/10/16 13:26:06 PM to store WebHosting\n [DBUG] Closing certificate stores\n [INFO] Installing with IIS...\n [INFO] Updating existing https binding www.sao2fl.org:443\n [INFO] Committing 1 https binding changes to IIS\n [INFO] IIS will serve the new certificates after the Application Pool IdleTimeout has been reached.\n [INFO] Uninstalling certificate from the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Removing certificate www.sao2fl.org 2018/10/15 14:21:18 PM from store WebHosting\n [DBUG] Closing certificate store\n [INFO] Renewal for www.sao2fl.org succeeded\n [INFO] Next renewal scheduled at 2018/12/10 17:27:10 PM\n\nApplication Event Log:\nInformation 10/16/2018 1:27:10 PM   win-acme        60347   None\nInformation 10/16/2018 1:27:10 PM   win-acme        34515   None\nInformation 10/16/2018 1:27:10 PM   win-acme        40429   None\nInformation 10/16/2018 1:27:09 PM   win-acme        6115    None\nInformation 10/16/2018 1:26:09 PM   win-acme        42425   None\nWarning     10/16/2018 1:26:06 PM   win-acme        14631   None\n    Cached certificate available but not used with --forcerenewal. Use 'Renew specific' or 'Renew all' in the main menu to run unscheduled renewals without hitting rate limits.\nInformation 10/16/2018 1:25:58 PM   win-acme        43787   None\nInformation 10/16/2018 1:25:54 PM   win-acme        36328   None\nInformation 10/16/2018 1:25:54 PM   win-acme        28006   None\n\nStill no scheduled task.. OK, I selected the 'X' option to cancel all renewals (I only had one), then selected 'N' to create a new certificate and it worked.   I do now have the scheduled task to renew the certificate.\n[INFO] Installing with IIS...\n [INFO] Committing 1 https binding changes to IIS\n [INFO] IIS will serve the new certificates after the Application Pool IdleTimeout has been reached.\n [INFO] Adding Task Scheduler entry with the following settings\n [INFO] - Name win-acme httpsacme-v01.api.letsencrypt.org\n [INFO] - Path d:\\Software\\LetsEncrypt-Dont-Delete\n [INFO] - Command letsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\"\n [INFO] - Start at 09:00:00\n [INFO] - Time limit 02:00:00\n [DBUG] Creating task to run as system user\n [INFO] Adding renewal for www.sao2fl.org\n [INFO] Next renewal scheduled at 2018/12/11 11:28:19 AM. ",
    "toussam": "Hi @WouterTinus ,\nI did as you said: checkout if the file is available during the creation of a new certificate and it was indeed possible to access it locally and remotely ! Since I had no issue with this, I tried one more time to renew my certificate and it worked fine...\nI don't know if the test changed anything, but it's kinda weird since I didn't change anything since I posted this issue. Anyway, thank you for your response and your time. ~\nWish you a great weekend !!\nBest regards,. ",
    "JustinWebDev": "I'll +1 this request.  What about TLS challenge for renewals?  I'd like to not have to use port 80 at all. . It looks like the TLS challenge was fixed and re-implemented.  Correct?\nhttps://letsencrypt.org/upcoming-features/\nhttps://datatracker.ietf.org/doc/draft-ietf-acme-tls-alpn/\nWas it blocked again after July?. ",
    "joerussbowman": "Adding a +1 to this.\nWe have Windows servers but our DNS complex is still *nix/bind. We have different people responsible for DNS changes. We're also looking at other DNS solutions (still nothing Windows based) so really I need a solution that allows me to get the challenge data from letsencrypt, manually update DNS and then tell the process to continue.  . Just making sure I understand, manual dns setup wasn't added, rather TLS-ALPN-01 validation support was added instead? We automated DNS validation using ansible for our Linux complex, I can see if there is a way to plug into that from a Windows host somehow, setting up to support TLS-ALPN-01 is something completely different than what this ticket was about though?. ",
    "SylwesterZarebski": "I'm not sure what ConfigPath is, but found Renewals file in c:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org:\n{\"Date\":\"2018-10-10T11:04:11.7885136Z\",\"Binding\":{\"Host\":\"enova\",\"HostIsDns\":false,\"CommonName\":\"mydomain.pl\",\"IIS\":true,\"WebRootPath\":\"C:\\\\inetpub\\\\wwwroot\\\\enova365Web\",\"TargetSiteId\":2,\"SSLPort\":443,\"ValidationPort\":81,\"ExcludeBindings\":\"\",\"AlternativeNames\":[\"mydomain.pl\",\"www.mydomain.pl\"],\"TargetPluginName\":\"IISSite\",\"ValidationPluginName\":\"http-01.SelfHosting\"},\"KeepExisting\":false,\"InstallationPluginNames\":[\"IIS\"],\"Warmup\":false}\nPS. File settings.config is:\n<PKISharp.WACS.Properties.Settings>\n  <setting name=\"FileDateFormat\" serializeAs=\"String\">\n    <value>yyyy/M/d H:mm:ss tt</value>\n  </setting>\n  <setting name=\"PFXPassword\" serializeAs=\"String\">\n    <value />\n  </setting>\n  <setting name=\"RSAKeyBits\" serializeAs=\"String\">\n    <value>2048</value>\n  </setting>\n  <setting name=\"HostsPerPage\" serializeAs=\"String\">\n    <value>50</value>\n  </setting>\n  <setting name=\"CertificatePath\" serializeAs=\"String\">\n    <value />\n  </setting>\n  <setting name=\"CleanupFolders\" serializeAs=\"String\">\n    <value>True</value>\n  </setting>\n  <setting name=\"PrivateKeyExportable\" serializeAs=\"String\">\n    <value>True</value>\n  </setting>\n  <setting name=\"ConfigurationPath\" serializeAs=\"String\">\n    <value />\n  </setting>\n  <setting name=\"Proxy\" serializeAs=\"String\">\n    <value>[System]</value>\n  </setting>\n  <setting name=\"ProxyUsername\" serializeAs=\"String\">\n    <value />\n  </setting>\n  <setting name=\"ProxyPassword\" serializeAs=\"String\">\n    <value />\n  </setting>\n  <setting name=\"RenewalDays\" serializeAs=\"String\">\n    <value>55</value>\n  </setting>\n  <setting name=\"CertificateStore\" serializeAs=\"String\">\n    <value />\n  </setting>\n  <setting name=\"ScheduledTaskExecutionTimeLimit\" serializeAs=\"String\">\n    <value>02:00:00</value>\n  </setting>\n  <setting name=\"ScheduledTaskRandomDelay\" serializeAs=\"String\">\n    <value>00:00:00</value>\n  </setting>\n  <setting name=\"ScheduledTaskStartBoundary\" serializeAs=\"String\">\n    <value>09:00:00</value>\n  </setting>\n  <setting name=\"ClientName\" serializeAs=\"String\">\n    <value>win-acme</value>\n  </setting>\n</PKISharp.WACS.Properties.Settings>. Verbose command line:\nletsencrypt.exe --renew --baseuri \"https://acme-v01.api.letsencrypt.org/\" --validationport 81 --verbose\nFull log (with masked domain name):\n```\n [DBUG] Config folder: C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\n [VERB] Settings SettingsService {ConfigPath=\"C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\", ClientNames=[\"win-acme\", \"letsencrypt-win-simple\"], RenewalDays=55, HostsPerPage=50, ScheduledTaskRandomDelay=00:00:00, ScheduledTaskStartBoundary=09:00:00, ScheduledTaskExecutionTimeLimit=02:00:00}\n [VERB] .NET Framework 4.6.2 detected\n[INFO] A Simple ACME Client for Windows (WACS)\n [INFO] Software version 1912.1.6872.39942 (RELEASE)\n [INFO] IIS version 10.0\n [INFO] ACME server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\n [VERB] Verbose mode logging enabled\n[DBUG] Renewal period: 55 days\n [VERB] Store renewals in registry HKEY_LOCAL_MACHINE\\Software\\letsencrypt-win-simple\\https://acme-v01.api.letsencrypt.org/\n [VERB] Checking renewals\n [VERB] Checking mydomain.pl\n [INFO] Renewing certificate for mydomain.pl\n [DBUG] Scanning IIS sites\n [DBUG] Loading signer from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: mydomain.pl\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [EROR] Unable to find validation plugin CHALLENGE_TYPE_HTTP.SelfHosting\n [EROR] Error resolving validation plugin\nAutofac.Core.DependencyResolutionException: An error occurred during the activation of a particular registration. See the inner exception for details. Registration: Autofac.Core.Registration.ComponentRegistrationLifetimeDecorator ---> The requested service 'System.Object' has not been registered. To avoid this exception, either register a component to provide the service, check for service registration using IsRegistered(), or use the ResolveOptional() method to resolve an optional dependency. (See inner exception for details.) ---> Autofac.Core.Registration.ComponentNotRegisteredException: The requested service 'System.Object' has not been registered. To avoid this exception, either register a component to provide the service, check for service registration using IsRegistered(), or use the ResolveOptional() method to resolve an optional dependency.\n   w Autofac.ResolutionExtensions.ResolveService(IComponentContext context, Service service, IEnumerable1 parameters)\n   w Autofac.ResolutionExtensions.Resolve(IComponentContext context, Type serviceType, Parameter[] parameters)\n   w PKISharp.WACS.AutofacBuilder.<>c__DisplayClass2_0.<Identifier>b__1(IComponentContext c)\n   w Autofac.Builder.RegistrationBuilder.<>c__DisplayClass0_01.b__0(IComponentContext c, IEnumerable1 p)\n   w Autofac.Core.Activators.Delegate.DelegateActivator.ActivateInstance(IComponentContext context, IEnumerable1 parameters)\n   w Autofac.Core.Resolving.InstanceLookup.Activate(IEnumerable1 parameters)\n   --- Koniec \u015bladu stosu wyj\u0105tk\u00f3w wewn\u0119trznych ---\n   w Autofac.Core.Resolving.InstanceLookup.Activate(IEnumerable1 parameters)\n   w Autofac.Core.Lifetime.LifetimeScope.GetOrCreateAndShare(Guid id, Func1 creator)\n   w Autofac.Core.Resolving.InstanceLookup.Execute()\n   w Autofac.Core.Resolving.ResolveOperation.GetOrCreateInstance(ISharingLifetimeScope currentOperationScope, IComponentRegistration registration, IEnumerable1 parameters)\n   w Autofac.Core.Resolving.ResolveOperation.Execute(IComponentRegistration registration, IEnumerable1 parameters)\n   w Autofac.ResolutionExtensions.TryResolveService(IComponentContext context, Service service, IEnumerable1 parameters, Object& instance)\n   w Autofac.ResolutionExtensions.ResolveService(IComponentContext context, Service service, IEnumerable1 parameters)\n   w Autofac.ResolutionExtensions.Resolve[TService](IComponentContext context, IEnumerable1 parameters)\n   w PKISharp.WACS.Program.Authorize(ILifetimeScope renewalScope, Target target)\n [EROR] Validation plugin not found or not created.\n [EROR] Renewal for mydomain.pl failed, will retry on next run\n. Is it possible to workaround this bug? Our certificate will expire tomorrow and I do not know what i should do.. Thanks, i've generated new certificate on the same domain name, it worked.\nI've used:\nletsencrypt.exe --baseuri \"https://acme-v01.api.letsencrypt.org/\" --validationport 81 --verbose\nLog:\n [INFO] Plugin IISSite generated target [IISSite] enova (SiteId 2) [2 bindings - mydomain.pl, ... @ C:\\inetpub\\wwwroot\\enova365Web]\n [DBUG] Scanning IIS sites\n [DBUG] Loading signer from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: mydomain.pl\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing mydomain.pl using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://mydomain.pl/.well-known/acme-challenge/jB09qnikwEQTd-Dfs4o6pDTQdHdknVbbIqqy1C7oYyE\n [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/htwEvgJtydWBDAMiVwfR02PQirQ5pagJpcfxGOrGzMM/9107954563\n [DBUG] Refreshing authorization\n [VERB] SelfHosting plugin serving file /.well-known/acme-challenge/jB09qnikwEQTd-Dfs4o6pDTQdHdknVbbIqqy1C7oYyE\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/htwEvgJtydWBDAMiVwfR02PQirQ5pagJpcfxGOrGzMM\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [INFO] Authorize identifier: www.mydomain.pl\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing www.mydomain.pl using http-01 validation (SelfHosting)\n [DBUG] Writing web.config\n [INFO] Answer should now be browsable at http://www.mydomain.pl/.well-known/acme-challenge/tdcOD196EwO2QFuaahA4rCWk5FNQZfBqzToT7gfWlMI\n [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/egLpLcaPJf2IOTHdr2ikl4dO9MnCKp0KxTKJTQ39U3Q/9276697639\n [DBUG] Refreshing authorization\n [VERB] SelfHosting plugin serving file /.well-known/acme-challenge/tdcOD196EwO2QFuaahA4rCWk5FNQZfBqzToT7gfWlMI\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/egLpLcaPJf2IOTHdr2ikl4dO9MnCKp0KxTKJTQ39U3Q\n [INFO] Authorization result: valid\n [DBUG] Deleting web.config\n [DBUG] Deleting answer\n [DBUG] Certificate folder: C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\n [DBUG] Certificate store: WebHosting\n [DBUG] RSAKeyBits: 2048\n [INFO] Requesting certificate enova 2018-11-14 8:29:20 AM\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-cert\n [INFO] Saving certificate to C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\n [VERB] Converting private key...\n [DBUG] Set private key exportable\n [INFO] Installing certificate in the certificate store\n [DBUG] Opened certificate store WebHosting\n [INFO] Adding certificate enova 2018-11-14 8:29:20 AM to store WebHosting\n [VERB] CN=mydomain.pl - CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US (961384CC72DDC4A8615DD583CD274CEDE8912A90)\n [VERB] CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US - CN=DST Root CA X3, O=Digital Signature Trust Co. (E6A3B45B062D509B3382282D196EFE97D5956CCB) to CA store\n [VERB] CN=DST Root CA X3, O=Digital Signature Trust Co. - CN=DST Root CA X3, O=Digital Signature Trust Co. (DAC9024F54D8F6DF94935FB1732638CA6AD77C13) to AuthRoot store\n [DBUG] Closing certificate stores\n [INFO] Installing with IIS...\n [INFO] Updating existing https binding mydomain.pl:443\n [INFO] Updating existing https binding www.mydomain.pl:443\n [INFO] Committing 2 https binding changes to IIS\n [INFO] IIS will serve the new certificates after the Application Pool IdleTimeout has been reached.\n [INFO] Adding renewal for enova\n [INFO] Next renewal scheduled at 2019-1-8 7:29:24 AM\n. Uhm, issue should not be closed, because it is not fixed.\nGenerating **new** certificate (but the same name) worked out, but **renewing** did **not** as i first wrote.. I've used exactly the same options registering new certificate few months ago, and renewing didn't work on November:\nletsencrypt.exe --baseuri \"https://acme-v01.api.letsencrypt.org/\" --validationport 81 --verbose\n```\nbut still, i'll check if renew will work, it should be executed next week or so.\nPS. I'm still using version 1.9.12.2.. Sorry for delay, but i do not have access to server now, i've asked our chief for access and i'm waiting for it.. Sorry for delay, everything works now. No configuration file has changed, i did not find anything different, this is mistery for me.\nThanks for Your help.. ",
    "Derphammer": "Yes still not in there . it actually does not create the binding, it also does not say anything is wrong . Sure not a problem tomorrow I'll try to take some screenshots as this is actually part of my final now. We are having to rebuild a windows 2016 data center edition machine with IIS In tomorrow is when I'm actually doing that Part. Tomorrow I have to make sure that my https in redirect stuff is set up and I will be using the script that you have on here. Are there any specific screenshots that I can take to help troubleshoot this problem?. Hey I'm super sorry about blanking on this. I actually did not get it working on the final as I was having an apipa issue and ran out of time before I could fix it. We are doing it again this semester but as of right now we can put this on hold I know to keep an eye out for it so if it ever happens again I will let you know and I will take screenshots this time. . ",
    "Tittan31": "thx for the hint, i needed to put the /.well-known/acme-challenge/ path to the exclusions for HTTP acces on my apache proxy server and now the renewal process is working... ",
    "gristxx": "This one for instance, remained not renewed during ~15 days, and finally went renewed...\n13/09/2018 | \u00a0-- | -- First time\n22/11/2018 | 70 days\n16/01/2019 | 55 days\nName:               dr-marine-petitjean.chirurgiens-dentistes.fr\nTarget plugin:      Manually input host names\nValidation plugin:  Save file on local (network) path\nStore plugin:       CentralSsl\nInstall plugin(s):  Do not run any installation steps\nRenewal due:        2019/1/16 13:34:52\nCentralSslStore:    D:\\CCS\nKeepExisting:       False\nWarmup:             False\nRenewed:            2 times\n1: 2018/9/13 12:59:39  - Success - Thumbprint 2859DCE\n2: 2018/11/22 14:33:26  - Success - Thumbprint 950F4F8\n. Can't find anything relevant since then... keeping on investigating.... Hi, nope sorry, all seems to work normally, may be a reboot during\noperation or something like that, for all's working fine now...\nThanks again for your follow-up.\nGreg.\nLe dim. 27 janv. 2019 \u00e0 21:24, Wouter Tinus notifications@github.com a\n\u00e9crit :\n\nAny updates on this issue?\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/PKISharp/win-acme/issues/964#issuecomment-457951014,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ACC1LRoAu3fvv_FyPMyDVBCwsQJ0L9fZks5vHgsUgaJpZM4YvMx0\n.\n. \n",
    "LorryMoller": "From the source, I think the script is only run if there is a successful renewal, correct? \n(the docs don't specify that)\nIf so, is that by design (ie  future releases won't change to run it in any failure cases)? \n. ",
    "Snowily": "i found it, that option disappear when IIS is stopped. That is a logic error: Please enable it and when user use it, warning about it, hide option is a bad practice:\nFor example, in our case we have a custom application for create domains and bindings on IIS and our app create certificates with WinACME trought COM console communication.\nI know that WinACME have nugget for do it but i dont want to learn how to do it and we implemented directly com. with console.\nPlease, dont do that kind of logic breaking things.\n. Haha,\nI know it's bad practice use the app sending keystrokes but my application is a little internal tool \ud83d\ude1b \nThe problem hidding \"n\" key isnt that my tool doesnt work.\nThe prolbem is because when I ran it  manullay I didnt see the \"n\" option and I didnt found the reason. Nowhere is it explained, even in the documentation\nMy IIS was stopped by error and im going crazy since i found it. I think that is better practice leave the \"n\" option and show an error of reason when use it.\nOr maybe continue with certification anyway and leave error to the letmeencrypt denegation of validation, its not reasonable hide the option with no explanation.\nSorry if you have offended, I did not mean to be rude, I think WinACME are a great job and I just want to contribute my point of view to improve it.\nMaybe the problem is that I speak English with my ass. Sorry for that too.\n. Really? haha i tryied to do it by args but no found it on documentation or help in app.\nCan you link the documentation to arguments especs. please?\nthabks\n. OMG... maybe I need a year of vacations.\nthnks.. ",
    "gchampion": "I didnt see the files, I'll do some more testing to confirm. Though didnt see in webroots or specified path.. Can confirm not in IIS webroot or file system path specified. Would you think in virutal app home or default website (Default website doesnt exist on this setup). ",
    "ehinolakingsley": "Thanks for the update. I actually closed the issue because i thought i asked the wrong question. The issue is that i have a domain name with https on apache server on the same server with port 443. I also want to use the same domain name on IIS but on another port. maybe port 81. So i don't know how i can configure it to run. Any help please . Hi. Thanks for your response. Please is can u describe the workflow flow\nfrom removing it from Ubuntu Apache which runs on window server vm and\nsetting it up on the window server and reconnecting it back to the Ubuntu\nApache.\nPlease.\nOn Fri, Dec 28, 2018, 5:37 PM Wouter Tinus <notifications@github.com wrote:\n\nI think the best option is to set it up for IIS first (manually changing\nthe port) and then point Apache to the *.pem version of certificate in the\nCertificatePath (under %programdata% by default).\nIf you want this kind of things to be set up automatically there are also\noptions, but I'm guessing this is more of a one-time thing.\n\u2014\nYou are receiving this because you modified the open/close state.\nReply to this email directly, view it on GitHub\nhttps://github.com/PKISharp/win-acme/issues/971#issuecomment-450438145,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/ALNfTCxZbGoAWBuEPL-BJaP85OStzF1Mks5u9p1FgaJpZM4ZiT79\n.\n. \n. \n",
    "jernejs": "Interesting. I was looking at https://docs.microsoft.com/en-us/exchange/plan-and-deploy/system-requirements?view=exchserver-2016 , which only lists 4.7.1 (but doesn't list CU11 for Exchange 2016 yet).. ",
    "ekoome": "Thanks for getting back to me. Scenario 1 fits my usecase. \nProbably we need to add to the docs that file names don\u2019t change on renewal.. ",
    "Trolldemorted": "What do you think of supporting windows server's own dns server? It is very unfortunate that I could use fancy remote apis on azure, but not my local dns server on the same machine.. ",
    "trondvh": "Acme v2 support is in the making, and is available for testing here:\nhttps://api.test4.buypass.no/acme-v02/directory\nWill support wildcard and up to 15 domains in one certificate.. ",
    "JimWolff": "Scott Helme tests buypass as a lets encrypt \"backup\" in this article\nAlthough he uses certbot and acme_tiny, i noticed him mentioning a possible issue:\n\nThe Buypass ACME API endpoint isn't actually fully compliant with the spec and while other clients can tolerate that and still function, acme_tiny can't.\n. \n",
    "poundy": "ok, but how do I get that report automatically, what command line switch produces that output? :) \n(edit: so really I want a way to generate that at the command-line switch level, so that I can run it as a scheduled task, and for example output to a file). ",
    "Weychris": "I have 2 bindings, all unassigned for 80 and 443. I am trying to get a cert installed on a RDSH server, when I run wacs from the server this is the error I get about iisbinding. \nsame issue?\nhttps://github.com/PKISharp/win-acme/issues/625\nFigured it out. Had to go into IIS and add FQDN to ssl binding under Default Web Site.. ",
    "ASwinglerDVC": "Understood. Thanks for the quick response. I'll close this ticket.. That makes sense to me. Thanks for the update.. ",
    "Gi-Force": "Ahhaa \nI guess it's called wacs.exe (I hope) now.\nGRTZ\nGi. ",
    "Gerardsc": "DNS issue, solved this now. Does the acme tool actualy update the certificate when it's due to renewal?\n\nIf so, how does it do that, i can not find a scheduled task in my windows enviroment???. ",
    "jonsamwell": "Thanks for replying so quickly!\n@WouterTinus Yes, it makes sense to do them one by one.  Would it be possible to collect the required DNS record values first then display all the records that need to be added?  I'm not sure if the Let's Encrypt API would work like this though.  Otherwise some users may face TTL issue on DNS entries if they need to change them in short succession?\n@webprofusion-chrisc It seems the seconds domain in my above example *.domain.tld fails the validation then the error gets thrown and I cannot continue.  It also appears that the same DNS entry is requested for the second domain as the first which doesn't appear correct.. @WouterTinus Agree, this isn't worth an architecture overhaul.  Step by step validation should work well and be more logical from a user perspective.\nI will give @WouterTinus suggestion a try.\nMany thanks.. @WouterTinus Amazing, thank you!. ",
    "peacepenguin": "Is your windows DNS server exposed to the internet publicly as the root Name Server for your domain? If it is, great, that feature would be handy. But in my experience not many people are using Windows DNS as the public DNS server for thier domains, so you may have a hard time finding help to build this new feature. Although with PowerShell, DNS modifications to a windows DNS server are very easy to script.. ",
    "MadMatt25": "I have done just this today, but using the dnsscript method and a very simple PowerShell script that I call from the bat file provided to win-acme. The case here is that the _acme-challenge subdomain DNS is delegated to that server, which then has the temporary TXT record available. This works much like the acme-dns plugin (if I understood correctly), but without the need of this external plugin.\nBecause it can be done this way, I'm not sure of the actual need to incorporate it into this tool. Just my two cents :). ",
    "Danielh21": "Thanks a Lot. I will do that! I'll close the issue :). ",
    "highstrike": "this goes away if you rename settings_default.config into settings.config and open it again though. i would assume replacing the default values with quoted ones would work fine:\ncreate {Identifier} {RecordName} {Token} -> create \"{Identifier}\" \"{RecordName}\" \"{Token}\"\ndelete {Identifier} {RecordName} {Token} -> delete \"{Identifier}\" \"{RecordName}\" \"{Token}\". I wonder how often does the token generate with a dash right at the beginning, might have been a 1 in a million chance.... oh well, such is my luck, always ending up with the rarest bugs \ud83d\ude05 \nI don't know if the pre-relelease .210 fixed it because I can't test it, the random nature of the token does not obey my will!\nBut anyway, if you say it's fixed, thank you for the very prompt reply, release and support! \u2764\ufe0f . I've tried absolute paths, i've tried relative paths, i've tried / and \\, i've tried escaping the directory separator \\\\, nothing worked.. Oh wow, that was silly of me...\nI forgot, while creating the certificate, to put my common name in there...\nI actually wanted my certificate for my domain name AND my subdomains (as wildcard)\nI've downloaded the pre-release .210 version and tested it with wildcard only and the files were saved with _.domain.tld now so as you pointed out, the error was from the fact that it was trying to save a file with *.\nAdding my common name to it AND THEN the wildcard saves the files with just my domain name and avoids this, now fixed, issue all together.\nI mean maybe there are some people out there that will only generate certificates for wildcards only and on the main domain they use another certificate... \ud83d\ude05 \nSoooooo, anyway, thanks for the very prompt fix! \u2764\ufe0f . ",
    "crbeckman": "You are awesome.\nI am not so cutting edge (and lack knowledge in this area) so I did not\nwant to try the 'hotfix'.\nI figured I MUST be missing something, as that would have been caught long\nbefore I tried.\nThank you for your efforts.\n(And I completely agree with your reasons.)\nchuck\nOn Thu, Jan 31, 2019 at 9:08 PM Wouter Tinus notifications@github.com\nwrote:\n\nThe file name settings-default.config is the right one, but what's\nsupposed to happen is that if there is no settings.config yet, i.e. on a\nclean install, it makes a copy of that template. That allows us to change\nthe defaults for clean installs without messing up existing users'\nconfiguration changes on updates.\nThis was broken in beta1, hence the hotfix build. I've since removed the\noriginal beta1 download so nobody else can run into this.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub\nhttps://github.com/PKISharp/win-acme/issues/1009#issuecomment-459598935,\nor mute the thread\nhttps://github.com/notifications/unsubscribe-auth/Ak-P-oYdVaZP7dSCilWha34PkB7T0-01ks5vI73WgaJpZM4adb2t\n.\n. \n",
    "DwijadasDey": "This is what i get in verbose mode.\n```\nPS C:\\Users\\Administrator\\Downloads\\win-acme.v1.9.11.2> .\\letsencrypt.exe --verbose\n [DBUG] Config folder: C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\n [VERB] Settings SettingsService {ConfigPath=\"C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\", ClientNames\n=[\"win-acme\", \"letsencrypt-win-simple\"], RenewalDays=55, HostsPerPage=50, ScheduledTaskRandomDelay=00:00:00, ScheduledTa\nskStartBoundary=09:00:00, ScheduledTaskExecutionTimeLimit=02:00:00}\n [VERB] .NET Framework >=4.7 detected\n[INFO] A Simple ACME Client for Windows (WACS)\n [INFO] Software version 1911.2.6726.40690 (RELEASE)\n [INFO] IIS not detected\n [INFO] ACME server https://acme-v01.api.letsencrypt.org/\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\n [VERB] Verbose mode logging enabled\n[DBUG] Renewal period: 55 days\n [VERB] Store renewals in file C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Renewals\nM: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: L\n1: domain1.com - renew after 2018/12/26 3:05:07 AM\n 2: domain2.com  - renew after 2018/12/26 3:05:18 AM\n 3: domain3.com  - renew after 2018/12/26 3:05:37 AM\n 4: domain4.com  - renew after 2019/3/27 13:28:51 PM\n 5: domain5.com  - renew after 2019/3/27 13:29:06 PM\n 6: domain6.com  - renew after 2019/3/27 13:29:13 PM\n C: Cancel\nShow details for renewal?: 1\nName:               domain1.com\n AlternativeNames:   domain1.com\n CommonName:         \n Target plugin:      Manually input host names\n Validation plugin:  Save file on local (network) path\n Store plugin:       CertificateStore\n Install plugin(s):  Do not run any installation steps\n Renewal due:        2018/12/26 3:05:07 AM\n KeepExisting:       False\n Warmup:             False\n Renewed:            48 times\n1: 2018/7/31 12:26:09 PM - Success - Thumbprint A35C709709969C8DF5497F5A46C760489FD74D6B\n 2: 2018/9/25 9:00:25 AM - Success - Thumbprint 08C764BDC9D4F098DA14D1BA0912327324C7C130\n 3: 2018/11/1 11:05:07 AM - Success - Thumbprint 36E73B98282545F27E44A12670CCC31FE0E89EB4\n 4: 2018/12/27 9:00:29 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 5: 2018/12/28 9:00:12 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 6: 2018/12/29 9:00:08 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 7: 2018/12/30 9:00:15 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 8: 2018/12/31 9:00:14 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 9: 2019/1/1 9:00:11 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 10: 2019/1/2 9:00:16 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 11: 2019/1/3 9:00:13 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 12: 2019/1/4 9:00:12 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 13: 2019/1/5 9:00:30 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 14: 2019/1/6 9:00:11 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 15: 2019/1/7 9:00:15 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 16: 2019/1/8 9:00:13 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 17: 2019/1/9 9:00:18 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 18: 2019/1/10 9:00:19 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 19: 2019/1/11 9:00:12 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 20: 2019/1/12 9:00:12 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 21: 2019/1/13 9:00:11 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 22: 2019/1/14 9:00:22 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 23: 2019/1/15 9:00:09 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 24: 2019/1/16 9:00:24 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 25: 2019/1/17 9:00:22 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 26: 2019/1/18 9:00:12 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 27: 2019/1/19 9:00:12 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 28: 2019/1/20 9:00:11 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 29: 2019/1/21 9:00:11 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 30: 2019/1/22 9:00:14 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 31: 2019/1/23 9:00:18 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 32: 2019/1/24 9:00:16 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 33: 2019/1/25 9:00:15 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 34: 2019/1/26 9:00:11 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 35: 2019/1/27 9:00:12 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 36: 2019/1/28 9:00:13 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 37: 2019/1/29 9:00:16 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 38: 2019/1/30 9:00:13 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 39: 2019/1/31 9:00:16 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 40: 2019/1/31 16:56:47 PM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 41: 2019/1/31 17:12:35 PM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 42: 2019/1/31 17:21:04 PM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 43: 2019/1/31 17:55:46 PM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 44: 2019/1/31 18:04:18 PM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 45: 2019/1/31 18:26:25 PM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 46: 2019/1/31 21:03:28 PM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 47: 2019/1/31 21:28:58 PM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\n 48: 2019/2/1 9:00:19 AM - Error - Exception of type 'PKISharp.WACS.AuthorizationFailedException' was thrown.\nM: Create new certificate with advanced options\n L: List scheduled renewals\n R: Renew scheduled\n S: Renew specific\n A: Renew all\n V: Revoke certificate\n C: Cancel scheduled renewal\n X: Cancel all scheduled renewals\n Q: Quit\nPlease choose from the menu: q\n. This is the output for specific renewal:\nWhich renewal would you like to run?: 1\n[INFO] Renewing certificate for domain1.com\n [DBUG] Loading signer from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Signer\n [DBUG] Getting AcmeServerDirectory\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/directory\n [DBUG] Loading registration from C:\\ProgramData\\win-acme\\httpsacme-v01.api.letsencrypt.org\\Registration\n [INFO] Authorize identifier: domain1.com\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/new-authz\n [INFO] Authorizing domain1.com using http-01 validation (FileSystem)\n [VERB] Writing file to C:\\TAOPIX\\MediaAlbumWeb\\webroot.well-known\\acme-challenge\\Pv0yfR8_JSe5gpbSKCkvBetLd0WLheJzH0VsJ\nvSV6RU\n [INFO] Answer should now be browsable at domain1.com/.well-known/acme-challenge/Pv0yfR8_JSe\n5gpbSKCkvBetLd0WLheJzH0VsJvSV6RU\n [DBUG] Submitting answer\n [DBUG] Send POST request to https://acme-v01.api.letsencrypt.org/acme/challenge/r2XCkPPqHMJaQ2Jj7TRi9obR4fa9vnYDBhb4T70\n-G84/12127482055\n [DBUG] Refreshing authorization\n [DBUG] Send GET request to https://acme-v01.api.letsencrypt.org/acme/authz/r2XCkPPqHMJaQ2Jj7TRi9obR4fa9vnYDBhb4T70-G84\n [EROR] Authorization result: invalid\n [DBUG] Deleting answer\n [VERB] Deleting file C:\\TAOPIX\\MediaAlbumWeb\\webroot.well-known\\acme-challenge\\Pv0yfR8_JSe5gpbSKCkvBetLd0WLheJzH0VsJvS\nV6RU\n [VERB] Deleting folder C:\\TAOPIX\\MediaAlbumWeb\\webroot.well-known\\acme-challenge\n [VERB] Deleting folder C:\\TAOPIX\\MediaAlbumWeb\\webroot.well-known\n [EROR] ACME server reported:\n [EROR] [type] urn:acme:error:unauthorized\n [EROR] [detail] Invalid response from http://domain1.com/.well-known/acme-challenge/Pv0yfR8_JSe5gp\nbSKCkvBetLd0WLheJzH0VsJvSV6RU: \"<!DOCTYPE HTML PUBLIC \\\"-//IETF//DTD HTML 2.0//EN\\\">\\n\\n404 Not Found\n\\n\\nNot Found\\n<p\"\n [EROR] [status] 403\n [EROR] Renewal for domain1.com failed, will retry on next run\n```. ",
    "bill-long": "Thanks! I confirmed that replacing {7} with 'a' does get me past that error.. ",
    "angrrybird": "Hi Wouter,\nThanks for your quick reply! I ran ImportRDGateway.ps1 by itself and the certificate gets imported into RD Gateway without any issues. Or maybe you're asking whether the thumbprint makes it to --scriptparameters \"{5}\"?\nHow can I run letsencrypt.exe without re-issuing the certificate because I ran into rate limits due to too many certificate requests for my domain and run the PowerShell script at the same time?. Hey Wouter,\nApologies for not getting back to the thread. I did manage to get the PowerShell script to execute by creating a new scheduled task via the advanced option that renews a certificate through the staging server. I should be able to do the same against the production CA. Will let you know if I face any issues. Thanks for the help, it's much appreciated!. ",
    "DrNaferio": "Fixed the problem. It was simply an issue of propagation delay. It took significantly longer than the TTL you specify for the TXT record to become visible. This is compounded by the fact that dig (windows version) doesn't seem to see the record, so proper verification is difficult. Building a way of verifying the TXT record into WAS would be very useful. I'll add a separate new feature suggestion.\nIn answer to your question re quotes. Google Domains puts these in for you if you haven't done this, but recognises you've included them if you have. \nThanks for your assistance. . ",
    "moesphere": "\nIt looks like IIS is installed, but either the whole service is stopped or no websites are configured/started.\n\nThere was no website configured. Thanks for your help!. ",
    "dovonob": "Sorry command was 'LetsEncrypt.exe --validationport 8015' rather than just port :)\nI'll give it a razz.. Good stuff I'll give it another go on the next release and let you know if there's any problems :)\nIn regards to the SNI, maybe this one is a bit of a odd one as this stupid server uses a the same IP but separate port for each site and its bindings so none of them have SNI on. Don't ask me why...whoever set this server up needs a slap :). ",
    "h3mp": "If i type that, it sits and thinks for half a minute, then returns (no error message, no output). Thanks - I have tried it and the output is below.\nI checked google for that error - my IISadmin service is running and service packs are up to date, so not found anything to help me yet but i shall continue researching.\n\nC:\\letsencrypt\\win-acme.v2.0.0-beta2>wacs.exe --target manual --host mail.somewhere.com,autodiscover.somewhere.com --certificatestore My --installation iis,script --installationsiteid 1 --script \"./Scripts/PSScript.bat\" --scriptparameters \"./Scripts/ImportExchange.ps1 {5} IIS,SMTP,IMAP 1 {7} \\\"{6}\\\" {1} \\\"{4}\\\"\"\n[INFO] A simple Windows ACMEv2 client (WACS)\n [INFO] Software version 200.0.6982.39228 (RELEASE)\n [INFO] IIS version 7.5\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\n[INFO] Running in mode: Unattended\n [INFO] Target generated using plugin Manual: mail.somewhere.com and 1 alternatives\n [WARN] Overwriting previously created renewal\n [INFO] Authorize identifier: autodiscover.somewhere.com\n [INFO] Cached authorization result: valid\n [INFO] Authorize identifier: mail.somewhere.com\n [INFO] Cached authorization result: valid\n [INFO] Requesting certificate mail.somewhere.com\n [INFO] Saving certificate to C:\\ProgramData\\win-acme\\acme-v02.api.letsencrypt.org\\Certificates\n [INFO] Installing certificate in the certificate store\n [INFO] Adding certificate mail.somewhere.com 2019/2/15 9:11:12 to store My\n [INFO] Installation step 1/2: IIS...\n [INFO] Updating existing https binding :443\n [INFO] Committing 1 https binding changes to IIS\n [INFO] Installation step 2/2: Script...\n [INFO] Script ./Scripts/PSScript.bat starting with parameters ./Scripts/ImportExchange.ps1 37xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx07 IIS,SMTP,IMAP 1 8tACIF5_GUeM3aX4_V2rfg \"C:\\ProgramData\\win-acme\\acme-v02.api.letsencrypt.org\\Certificates\" /zWxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxjM= \"mail.somewhere.com 2019/2/15 9:11:12\n [EROR] Script error: C:\\letsencrypt\\win-acme.v2.0.0-beta2\\Scripts\\ImportExchange.ps1 : Error in\n [EROR] Script error: Enable-ExchangeCertificate\n [EROR] Script error:     + CategoryInfo          : NotSpecified: (:) [Write-Error], WriteErrorExcep\n [EROR] Script error:    tion\n [EROR] Script error:     + FullyQualifiedErrorId : Microsoft.PowerShell.Commands.WriteErrorExceptio\n [EROR] Script error:    n,ImportExchange.ps1\n [EROR] Script error: C:\\letsencrypt\\win-acme.v2.0.0-beta2\\Scripts\\ImportExchange.ps1 : Script\n [EROR] Script error: hasn't completed.\n [EROR] Script error:     + CategoryInfo          : NotSpecified: (:) [Write-Error], WriteErrorExcep\n [EROR] Script error:    tion\n [EROR] Script error:     + FullyQualifiedErrorId : Microsoft.PowerShell.Commands.WriteErrorExceptio\n [EROR] Script error:    n,ImportExchange.ps1\n [INFO]\nC:\\letsencrypt\\win-acme.v2.0.0-beta2>REM Generic batch script to execute powershell scripts along with positional parameters\nC:\\letsencrypt\\win-acme.v2.0.0-beta2>REM Pass path to PS1 script as well as any parameters you want to pass\nC:\\letsencrypt\\win-acme.v2.0.0-beta2>REM Spaces are not supported in script path\nC:\\letsencrypt\\win-acme.v2.0.0-beta2>REM Also, in testing, powershell script must use positional parameters. Results may vary\nC:\\letsencrypt\\win-acme.v2.0.0-beta2>REM Ex. \"./Scripts/PSScript.bat c:\\scripts\\test.ps1 value\"\nC:\\letsencrypt\\win-acme.v2.0.0-beta2>powershell.exe -ExecutionPolicy RemoteSigned -File ./Scripts/ImportExchange.ps1 37xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx07 IIS,SMTP,IMAP 1 8tACIF5_GUeM3aX4_V2rfg \"C:\\ProgramData\\win-acme\\acme-v02.api.letsencrypt.org\\Certificates\" /zWxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxjM= \"mail.somewhere.com 2019/2/15 9:11:12\nNewCertThumbprint: 37xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx07\nExchangeServices: IIS,SMTP,IMAP\nLeaveOldExchangeCerts: 1\nRenewalId: 8txxxxxxxxxxxxxxxxxxfg\nCertificatePath: C:\\ProgramData\\win-acme\\acme-v02.api.letsencrypt.org\\Certificates\nFriendlyName: mail.somewhere.com 2019/2/15 9:11:12\nSearching for Exchange snapin...\nMicrosoft.Exchange.Management.PowerShell.E2010\nChecking if certificate can be found in the right store...\nUpdating Exchange services...\nError: C:\\letsencrypt\\win-acme.v2.0.0-beta2\\Scripts\\ImportExchange.ps1 : Error in\nError: Enable-ExchangeCertificate\nError:     + CategoryInfo          : NotSpecified: (:) [Write-Error], WriteErrorExcep\nError:    tion\nError:     + FullyQualifiedErrorId : Microsoft.PowerShell.Commands.WriteErrorExceptio\nError:    n,ImportExchange.ps1\nError: C:\\letsencrypt\\win-acme.v2.0.0-beta2\\Scripts\\ImportExchange.ps1 : Script\nError: hasn't completed.\nError:     + CategoryInfo          : NotSpecified: (:) [Write-Error], WriteErrorExcep\nError:    tion\nError:     + FullyQualifiedErrorId : Microsoft.PowerShell.Commands.WriteErrorExceptio\nError:    n,ImportExchange.ps1\n[INFO] Uninstalling certificate from the certificate store\n [INFO] Removing certificate mail.somewhere.com 2019/2/14 8:48:49 from store My\n [INFO] Renewal for mail.somewhere.com succeeded\n [INFO] Next renewal scheduled at 2019/4/11 10:11:12\n. I tried the command on it's own in powershell, it then prompts for thumbprint and then for services. - it then generates the following error.\nI tried it again using a completely wrong thumbprint and it gets the exact same error - i guess this suggests it is failing to find the certificate from the thumbprint?\n\nEnable-ExchangeCertificate : The Exchange Certificate operation has failed with an exception.  The error message is: Unknown error (0xe0434f4d)\nAt line:1 char:1\n+ Enable-ExchangeCertificate\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : InvalidOperation: (:) [Enable-ExchangeCertificate], LocalizedException\n    + FullyQualifiedErrorId : AA21DCE6,Microsoft.Exchange.Management.SystemConfigurationTasks.EnableExchangeCertificate. i tried Enable-ExchangeServices from the \"exchange management shell\" rather than a regular powershell....\nin this shell, it asks for services then thumbprint (instead of thumbprint then services), and then returns with no error!?. Yes, the powershell was run elevated as administrator. ...I can make the regular powershell window complete without error if i simulate what happens in the EMS:\ni open elevated powershell and try Enable-ExchangeCertificate - this fails as before\ni then issue these commands:\n.\\\"C:\\Program Files\\Microsoft\\Exchange Server\\V14\\bin\\RemoteExchange.ps1\"\nConnect-ExchangeServer -auto\nI then try Enable-ExchangeCertificate again - this time it completes without error. from powershell it needs these 3 lines before Enable-ExchangeCertificate works without error messages:\nAdd-PSSnapin Microsoft.Exchange.Management.PowerShell.E2010\n.\"C:\\Program Files\\Microsoft\\Exchange Server\\V14\\bin\\RemoteExchange.ps1\"\nConnect-ExchangeServer -auto\nshould i just need the last two? where is best in the script for them to be placed?\n. for the moment I have added the lines at line 129 and it look promising:\nnew bit added by Mark to see if we can fix this:\n.\"C:\\Program Files\\Microsoft\\Exchange Server\\V14\\bin\\RemoteExchange.ps1\"\nConnect-ExchangeServer -auto\n...\nTest if the Cmdlet is there now\n$Command = Get-Command \"Enable-ExchangeCertificate\" -errorAction SilentlyContinue\nif ($Command -eq $null) \n{\n    Write-Error \"Exchange Management Tools for Powershell not installed\"\n    return\n}. ",
    "jmckenna": "@WouterTinus thank you so much.  Works great. For good karma I'll follow this ticket and test whatever you add and give feedback.\nThanks again.. ",
    "melema123": "Thank you so much for your reply.\nI requested the certificate too many times, so I have to wait for a week. How can I get pfx password? There is this file named xxxxxxxxx.renewal.json.\nPassword looks encrypted. Or am I missing something?\n\n. Thank you. ",
    "perryanton": "No \u2013 just two: Autodiscover and hostname. Validation worked fine \u2013 ran false cert creation out of ECP to validate.\nAll virtual apps are in place, cannot create replacement VDs  as I get a warning that app exists already.\nIs the SNI flag something that may have stuck \u2013 be removed?  Currently parsing ApplicationHost.config and all VDs are in there. Just not running.\nFrom: Wouter Tinus notifications@github.com \nSent: Wednesday, February 20, 2019 1:07 PM\nTo: PKISharp/win-acme win-acme@noreply.github.com\nCc: perryanton perryanton@gmail.com; Author author@noreply.github.com\nSubject: Re: [PKISharp/win-acme] Trashed Exchange Front End (#1034)\nI think the problem might be that you requested an additional host name that you didn't have a binding for, so the program matched with the default binding. Additionally it recognized that if it changed the certificate for a non-SNI binding, it would create problems for other bindings. So it tried to apply the SNI flag to the default binding, which I believe it was caused the crash of the IIS Manager.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub https://github.com/PKISharp/win-acme/issues/1034#issuecomment-465734113 , or mute the thread https://github.com/notifications/unsubscribe-auth/AkVOelE84BR8mS0UEewnCqQsM8Zmcjzyks5vParSgaJpZM4bF9SB .  https://github.com/notifications/beacon/AkVOesWfXa4J5F9ZYiXeys0_kapgJ99-ks5vParSgaJpZM4bF9SB.gif \n. Ya, I\u2019m on the same path. Launching Bindings gives me a parameter incorrect. All bindings were accurate/in place. Was running external tests against Autodiscover. \nFrom: Wouter Tinus notifications@github.com \nSent: Wednesday, February 20, 2019 1:19 PM\nTo: PKISharp/win-acme win-acme@noreply.github.com\nCc: perryanton perryanton@gmail.com; Author author@noreply.github.com\nSubject: Re: [PKISharp/win-acme] Trashed Exchange Front End (#1034)\nI can tell from the log that the program updated the default binding i.e. :433. I'm guessing that you have a binding in IIS for the main domain but not for the autodiscover domain, or the other way around. Alternatively, you may have had a typo in the program. At least that's the way that I've been able to reproduce your issue.\nI'd suggest removing the whole HTTPS binding from applicationHost.config and recreating it from the IIS Manager.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub https://github.com/PKISharp/win-acme/issues/1034#issuecomment-465738097 , or mute the thread https://github.com/notifications/unsubscribe-auth/AkVOeuaCp1DfWuWi6a_zOLEuJ_Z7Xl_Bks5vPa26gaJpZM4bF9SB .  https://github.com/notifications/beacon/AkVOer6sM-nn5bCv7A6CewnyFufJQWQAks5vPa26gaJpZM4bF9SB.gif \n. FYI \u2013 got access to all bindings thru direct edits to config file \u2013 changed all SSL flags to 0.\nAll frontend VDs are still missing (apps in place) \u2013 at a loss as to why running WACS would corrupt all VDs.\nFrom: Wouter Tinus notifications@github.com \nSent: Wednesday, February 20, 2019 1:19 PM\nTo: PKISharp/win-acme win-acme@noreply.github.com\nCc: perryanton perryanton@gmail.com; Author author@noreply.github.com\nSubject: Re: [PKISharp/win-acme] Trashed Exchange Front End (#1034)\nI can tell from the log that the program updated the default binding i.e. :433. I'm guessing that you have a binding in IIS for the main domain but not for the autodiscover domain, or the other way around. Alternatively, you may have had a typo in the program. At least that's the way that I've been able to reproduce your issue.\nI'd suggest removing the whole HTTPS binding from applicationHost.config and recreating it from the IIS Manager.\n\u2014\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub https://github.com/PKISharp/win-acme/issues/1034#issuecomment-465738097 , or mute the thread https://github.com/notifications/unsubscribe-auth/AkVOeuaCp1DfWuWi6a_zOLEuJ_Z7Xl_Bks5vPa26gaJpZM4bF9SB .  https://github.com/notifications/beacon/AkVOer6sM-nn5bCv7A6CewnyFufJQWQAks5vPa26gaJpZM4bF9SB.gif \n. ",
    "Sanandreas21": "Tested it and not an issue... ",
    "21307369": "yes.  is administraror account ,. System APP Evnent \n- System \n  - Provider \n   [ Name]  Microsoft-Windows-Immersive-Shell \n- EventData \n   AppId Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy:App.AppXc99k5qnnsvxj5szemm7fp3g7y08we5vm.mca \n  ErrorCode -2144927149 \n\nCMD running wacs.exe  --verbose\n[INFO] A simple Windows ACMEv2 client (WACS)\n [INFO] Software version 2.0.1.183 (RELEASE)\n [INFO] IIS version 10.0\n [INFO] Please report issues at https://github.com/PKISharp/win-acme\n [VERB] Verbose mode logging enabled\n [VERB] Arguments: --verbose\n [DBUG] Config folder: C:\\ProgramData\\win-acme\\acme-v02.api.letsencrypt.org\n [DBUG] Certificate cache: C:\\ProgramData\\win-acme\\acme-v02.api.letsencrypt.org\\Certificates\n [VERB] Settings SettingsService {ConfigPath=\"C:\\ProgramData\\win-acme\\acme-v02.api.letsencrypt.org\", CertificatePath=\"C:\\ProgramData\\win-acme\\acme-v02.api.letsencrypt.org\\Certificates\", ClientNames=[\"win-acme\", \"win-acme\"], RenewalDays=55, HostsPerPage=50, ScheduledTaskRandomDelay=00:00:00, ScheduledTaskStartBoundary=09:00:00, ScheduledTaskExecutionTimeLimit=02:00:00}\n[VERB] Sending e-mails False\n[DBUG] Renewal period: 55 days\n\nSystem APP Evnent \nEventData \n   A simple Windows ACMEv2 client (WACS)\n. yes Chinese language version of Windows Server\nprint [DBUG] Renewal period: 55 days else after \nmenu\nN:Create new certificate\nM: Create new certificate with advanced options. Double-click the left mouse button to run wass.exe without displaying any windows.\nBut using the console program to execute wacs.exe is no problem.\nThis is the problem I am having.. ",
    "Freakshows": "Thanks, :). ",
    "xBotRaid": "\nThe default behavior of the program is to install the certificate into the certificate store, though as you noted it ends up in the WebHosting store rather than Personal. You can change that either with the setting DefaultCertificateStore or the command line argument -certificatestore.\nThe thumbprint usually respresented by this kind of hex string like 3a7aa8a2058a55128ddb207d7e66749faa5df127. Maybe the only problem is that it's in the wrong store?\n\nThanks alot! Got it working by changing the DefaultCertificateStore to \"My\" and then deleting the PI Connector with netsh http delete sslcert ipport=0.0.0.0:[SSL-Port-of-Service].\nThen reassigning the new certificate in Sonarr/Radarr/Lidarr.\nNow I'd like to get SSL certificates for my NZBGet as well, and since I'm not very experienced with win-acme, I don't really know what to do, after searching.\nSo NZBGet needs a fullchain.pem and a privkey.pem.\nBut as stated in my previous post I only find two files in the C:\\ProgramData\\win-acme\\acme-v02.api.letsencrypt.org\\Certificates folder.\n1. \"9Jt6l4L6WECLLbjf_FQ88A-cache.pfx\"\n2. \"9Jt6l4L6WECLLbjf_FQ88A-csr.pem\"\nWhich is which and can I just convert the .pfx file to a .pem file?. > You can convert the .pfx with some trickery but the program can actually do it for you with the PemFiles plugin, which you can choose from advanced mode or trigger with --store pemfiles. Note that you cannot output to the certificate store and pemfiles at the same time though, so you have to set up two renewals even if these are for the same domain.\nWorked just fine! Thanks!. ",
    "Kamalifar": "I used this link and created a web.config to \".well-known/acme-challenge/\" manually by below content. So my problem has been resolved.\n`\n<system.webServer>\n\n    <staticContent>\n\n        <mimeMap fileExtension=\".\" mimeType=\"text/plain\" />\n\n    </staticContent>\n\n</system.webServer>\n\n`. ",
    "kabilan-baskaran": "@WouterTinus Thanks for the confirmation. It would be even better if it sends the successful email also. So that user would know the job is succeeded & no manual check is needed.\nWhat is your thoughts? . Got your point. But however like you said even if they have 100/1000 renewals it would be pain to check them manually, Isn't? \nLike you said, it is up to the end users how they want it. So i like to suggest if you add an one more configuration in settings.config where the end user can config email for success also? For ex ...\n\nTrue/False\n\nMake sense ? . @WouterTinus  The answer is simple. What would happen if the failure mail is not sent due to some reasons? Lets say the scheduler stopped working for some reason or some unidentified issue happened.  The end user thinks that everything is working fine until he sees it by himself something happened. . @WouterTinus :+1: Thank you. I am not interested in the failure rather foolproof system. :+1:  \nThanks for letting me know the email subscription from Let's Encrypt. I will try to use it. . @WouterTinus : Thank you for the great job. :+1: But today i was trying to implement the success mail unfortunately it didn't worked for me. Can you please verify it is working for you ? . @WouterTinus : I too facing the similar issue. App says email has been sent but i am not receiving any emails. I have tested the SMTP connection with other apps it works fine. I am not sure it only happens to me. Could you please verify it again ?. @WouterTinus : Sorry. My mistake. It does sent mails but almost 8 hours delay. I am not sure why this much delay since when i sent a mail from PHP code i got it within a minute. Not sure about the behavior.FYI, i am using SMTP relay service. . Might be. Trying to figure it out.. ",
    "fishfin": "I think adding a separate parm to even send out a \"success\" message is going to be helpful. IMO, there are so many things that happen automatically, that it is difficult to keep track of what succeeded, or that it even ran. We have some instances in Win Srv 2012 R2 in a cloud env, where arbitrarily the scheduled tasks have not run (still not figured out why). A positive confirmation certainly helps.. ",
    "ahmedalmulki": "Yes you are right the problem was from IIS binding in Default Web site, For some reason, I found  2 sites binding for port 443 and I delete one of them and restart IIS , it solves 404 Error but now when I try to access to ecp or owa I just get an empty page after login in local and through the internet !!. Thanks for your help I solved my problem by changing the https binding site in Exchange back end.. Hi sorry for the late response, I used v2.0.3.206 version, I think maybe this problem appear because I already did the process two times, one by the code which I mentioned before and one by double click on the wacs.exe file and follow the wizard ... \n. ",
    "ericcan": "I should also add that when I look at the logs of my acme-dns server, the DNS lookup by WACS shows no sign of querying my server (meaning that the lookup doesn't appear to have followed the CNAME alias). The lookup for letsencrypt shows in the logs just fine.. Just to summarize, there are two separate issues with the preliminary DNS search that occurs during DNS validation (both result from usage of the acme-dns server):\n1) Handling multiple TXT records\n2) Handling CNAME records when using an authoritative DNS Server for the preliminary test.\nI definitely think it's worth handling the first one. For the second, given the added complexity, I could make the case that it would be a reasonable tradeoff to go back to the approach of using a recursive DNS server (like OpenDNS) instead of building in all the logic of recursing. For an informational preliminary test, relying on a publicly available option will provide nearly as much information without a lot of extra complexity.\nIf we did want to utilize our newly found DNS expertise, I think it could be a nice feature for the acme-dns plug-in to actually check that the challenge domain was CNAME'd to the appropriate location, but again, not a requirement by any means.. Current behavior:\nIn AcmeDnsClient, the user is instructed in the case of a new registration to create a CNAME for the _acme-challenge subdomain. In the case of an existing registration, the user is asked to confirm that the mapping exists as well.\nProposed behavior:\nNew registration: Once the user confirms they have set up the CNAME record, we could do a DNS lookup to see that the mapping indeed exists and matches what it should. If it doesn't, we would allow the user to choose to retry (to allow for double checking their DNS records or just to give additional time for the change to propagate) or to ignore. \nIn the case where the the registration already exists, we could do the lookup proactively and only wait for input if a dns query shows that the CNAME mapping is not yet established. In the case of waiting, we would offer the same retry/ignore as the new registration case.. @WouterTinus Done! (#1070) . ",
    "Joaquim3": "Tools to access PFX : Windows Certificate Import Wizard\nI get the same problem when I use Windows Certificate Import Wizard\nAfter selecting the PFX file. I need to type the password, but I get a window \"The password you entered is incorrect\". \n. Hello WouterTinus,\nThanks a lot for your answer, VERY CLEAR :-) \nYes, I was mistaking the \"DefaultCentralSslPfxPassword\" with the \"Random Password Generated\" in the CACHE PFX file.\nNow, I understand the difference between both.\nIn the dirty way, I can easily Call my C:\\ProgramData\\win-acme\\acme-v02.api.letsencrypt.org\\Certificates\\MYID-cache.pfx file using its random generated password, that I found in (List scheduled renewals > Show details for certificate) where you told me to search for.\nProblem SOLVED !!! Thanks a lot !!! :-) \n\nBUT (If I try the CLEAN way  I get the ERROR MESSAGE BELOW, sorry for that), \nI'm managing 65 domains on another server that I will be migrating to this new one. \nAre SAN Certificates the best solution, because I added the domains manually in WACS ? All domains point to the same Server and the same Website.\nI am then trying the CLEAN SOLUTION are you suggested :\nI installed Central Certificate Store (CCS) following the instructions in the link below (my server is Windows 2012 R2). Everything OK\nhttps://blogs.msdn.microsoft.com/kaushal/2012/10/11/central-certificate-store-ccs-with-iis-8-windows-server-2012/ \nMy Wacs setting.config:\n<setting name=\"DefaultCentralSslStore\" serializeAs=\"String\"><value>MYSERVERCCSPATH...\n<setting name=\"DefaultCentralSslPfxPassword\" serializeAs=\"String\"><value>MYPERSONALPFXPASSWORD...\nI entered this DefaultCentralSslPfxPassword in CCS in IIS.\nWACS.exe\nM: Create new certificate with advanced options\n Please choose from the menu: m\n[INFO] Running in mode: Interactive, Advanced\n4: Manually input host names\n Which kind of certificate would you like to create?: 4\nEnter comma-separated list of host names, starting with the common name: MYWEBSITE.com,www.MYWEBSITE.com\n[INFO] Target generated using plugin Manual: MYWEBSITE.com and 1 alternatives\nSuggested FriendlyName is '[Manual] MYWEBSITE.com', press enter to accept or type an alternative:\n4: [http-01] Host the validation files from memory (recommended)\n    How would you like to validate this certificate?: 4\n2: Standard RSA key pair\n    What kind of CSR would you like to create?: 2\n1: IIS Central Certificate Store\n    How would you like to store this certificate?: 1\n1: Create or update https bindings in IIS\n    Which installer should run for the certificate?: 1\n    Would you like to add another installer step? (y/n*)  - no\n1: Default Web Site\n Choose site to create new bindings: 1\n[INFO] Authorize identifier: MYWEBSITE.com\n [INFO] Authorizing virginal.be using http-01 validation (SelfHosting)\n [INFO] Authorization result: valid\n [INFO] Authorize identifier: www.MYWEBSITE.com\n [INFO] Authorizing www.MYWEBSITE.com using http-01 validation (SelfHosting)\n [INFO] Authorization result: valid\n [INFO] Requesting certificate [Manual] MYWEBSITE.com\n [INFO] Copying certificate to the Central SSL store\n [INFO] Saving certificate to Central SSL location c:\\ccs\\MYWEBSITE.com.pfx\n [EROR] Error copying certificate to Central SSL store\nSystem.Security.Cryptography.CryptographicException: Key not valid for use in specified state.\n   at System.Security.Cryptography.CryptographicException.ThrowCryptographicException(Int32 hr)\n   at System.Security.Cryptography.X509Certificates.X509Utils._ExportCertificatesToBlob(SafeCertStoreHandle safeCertStoreHandle, X509ContentType contentType, IntPtr password)\n   at System.Security.Cryptography.X509Certificates.X509Certificate.ExportHelper(X509ContentType contentType, Object password)\n   at PKISharp.WACS.Plugins.StorePlugins.CentralSsl.Save(CertificateInfo input) [INFO] Saving certificate to Central SSL location c:\\ccs\\www.MYWEBSITE.com.pfx\n [EROR] Error copying certificate to Central SSL store\nSystem.Security.Cryptography.CryptographicException: Key not valid for use in specified state.\n   at System.Security.Cryptography.CryptographicException.ThrowCryptographicException(Int32 hr)\n   at System.Security.Cryptography.X509Certificates.X509Utils._ExportCertificatesToBlob(SafeCertStoreHandle safeCertStoreHandle, X509ContentType contentType, IntPtr password)\n   at System.Security.Cryptography.X509Certificates.X509Certificate.ExportHelper(X509ContentType contentType, Object password)\n   at PKISharp.WACS.Plugins.StorePlugins.CentralSsl.Save(CertificateInfo input)\n [INFO] Installing with IIS...\n [INFO] Adding new https binding :443:MYWEBSITE.com\n [INFO] Adding new https binding :443:www.MYWEBSITE.com\n [INFO] Committing 2 https binding changes to IIS\n. ",
    "tobiastromm": "Here is the file https://github.com/EricssonResearch/openwebrtc-examples/blob/master/web/channel_server.js where certs are needed.. ",
    "Anushiravani": "thanks a lot, problem fixed after checked all domain . all domain on iis must checked RNSI to work fine together. ",
    "lpkant": "never mind me, if I got it wrong - just stumbled over it, but what if someone customized the certification store in the app.config? \nthen \"WebHosting\" as default would not be fully correct, wouldn't it?\n. "
}